<html>
<head><meta charset="utf-8"><title>An idea for lifetime elision · t-lang · Zulip Chat Archive</title></head>
<h2>Stream: <a href="https://zulip-archive.rust-lang.org/stream/213817-t-lang/index.html">t-lang</a></h2>
<h3>Topic: <a href="https://zulip-archive.rust-lang.org/stream/213817-t-lang/topic/An.20idea.20for.20lifetime.20elision.html">An idea for lifetime elision</a></h3>

<hr>

<base href="https://rust-lang.zulipchat.com">

<head><link href="https://zulip-archive.rust-lang.org/style.css" rel="stylesheet"></head>

<a name="264917734"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/An%20idea%20for%20lifetime%20elision/near/264917734" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> scottmcm <a href="https://zulip-archive.rust-lang.org/stream/213817-t-lang/topic/An.20idea.20for.20lifetime.20elision.html#264917734">(Dec 14 2021 at 20:06)</a>:</h4>
<p>I was scrolling through <a href="https://github.com/rust-lang/rust/issues/91931">#91931</a> looking at the diffs for removing in-band.  This one jumped out to me</p>
<div class="codehilite" data-code-language="Diff"><pre><span></span><code><span class="gd">-fn llvm_asm_scalar_type(cx: &amp;CodegenCx&lt;'ll, 'tcx&gt;, scalar: Scalar) -&gt; &amp;'ll Type {</span>
<span class="gi">+fn llvm_asm_scalar_type&lt;'ll&gt;(cx: &amp;CodegenCx&lt;'ll, '_&gt;, scalar: Scalar) -&gt; &amp;'ll Type {</span>
</code></pre></div>
<p>It made me think that perhaps what we need most of the time is to say which one is the lifetime of the return value, as the elision error says, so maybe we could do something more specifically targeted for that case?</p>
<p>I haven't thought this through yet, but what do people think of</p>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="k">fn</span> <span class="nf">llvm_asm_scalar_type</span><span class="p">(</span><span class="n">cx</span>: <span class="kp">&amp;</span><span class="nc">CodegenCx</span><span class="o">&lt;'</span><span class="na">return</span><span class="p">,</span><span class="w"> </span><span class="o">'</span><span class="nb">_</span><span class="o">&gt;</span><span class="p">,</span><span class="w"> </span><span class="n">scalar</span>: <span class="nc">Scalar</span><span class="p">)</span><span class="w"> </span>-&gt; <span class="kp">&amp;</span><span class="nc">Type</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
</code></pre></div>
<p>Non-breaking, since keywords (like <code>return</code>) can't be used as lifetime names today.  And it's not short, but that's almost good to help it (along with syntax highlighting) stand out as "this is the one".  But it's not as long as <code>&lt;'ll&gt; 'll 'll</code> either.</p>



<a name="264921175"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/An%20idea%20for%20lifetime%20elision/near/264921175" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Triplett <a href="https://zulip-archive.rust-lang.org/stream/213817-t-lang/topic/An.20idea.20for.20lifetime.20elision.html#264921175">(Dec 14 2021 at 20:34)</a>:</h4>
<p>I like the concept.</p>



<a name="264921250"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/An%20idea%20for%20lifetime%20elision/near/264921250" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Triplett <a href="https://zulip-archive.rust-lang.org/stream/213817-t-lang/topic/An.20idea.20for.20lifetime.20elision.html#264921250">(Dec 14 2021 at 20:35)</a>:</h4>
<p>Though I think from an understandability point of view, it seems unusual to derive a lifetime name from return, when the borrow goes in the other direction, from the argument to the return value.</p>



<a name="264921465"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/An%20idea%20for%20lifetime%20elision/near/264921465" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> cuviper <a href="https://zulip-archive.rust-lang.org/stream/213817-t-lang/topic/An.20idea.20for.20lifetime.20elision.html#264921465">(Dec 14 2021 at 20:36)</a>:</h4>
<p>would <code>'return</code> fill <em>all</em> inferred lifetimes in the return type, or just references?<br>
e.g. what about something <code>-&gt; Iter&lt;'_, T&gt;</code>?</p>



<a name="264924892"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/An%20idea%20for%20lifetime%20elision/near/264924892" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> scottmcm <a href="https://zulip-archive.rust-lang.org/stream/213817-t-lang/topic/An.20idea.20for.20lifetime.20elision.html#264924892">(Dec 14 2021 at 21:02)</a>:</h4>
<p>I was thinking all of them, <span class="user-mention" data-user-id="138448">@cuviper</span>.  My mental model is that <code>&amp;Foo</code> always behaves exactly the same as if it were <code>::std::typealiases::Reference&lt;'_, Foo&gt;</code>.  (No that modules doesn't exist.)</p>



<a name="264924941"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/An%20idea%20for%20lifetime%20elision/near/264924941" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Triplett <a href="https://zulip-archive.rust-lang.org/stream/213817-t-lang/topic/An.20idea.20for.20lifetime.20elision.html#264924941">(Dec 14 2021 at 21:02)</a>:</h4>
<p>I wonder sometimes if it should. :)</p>



<a name="264929128"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/An%20idea%20for%20lifetime%20elision/near/264929128" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Lokathor <a href="https://zulip-archive.rust-lang.org/stream/213817-t-lang/topic/An.20idea.20for.20lifetime.20elision.html#264929128">(Dec 14 2021 at 21:37)</a>:</h4>
<p>when does it not?</p>



<a name="264931355"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/An%20idea%20for%20lifetime%20elision/near/264931355" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jubilee <a href="https://zulip-archive.rust-lang.org/stream/213817-t-lang/topic/An.20idea.20for.20lifetime.20elision.html#264931355">(Dec 14 2021 at 21:51)</a>:</h4>
<p>I would prefer <code>'ret</code> &lt;/asmbrain&gt; but I grok the reasoning, and we could have <code>'return</code> now and maybe <code>'ret</code> later.</p>



<a name="264931542"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/An%20idea%20for%20lifetime%20elision/near/264931542" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Noah Lev <a href="https://zulip-archive.rust-lang.org/stream/213817-t-lang/topic/An.20idea.20for.20lifetime.20elision.html#264931542">(Dec 14 2021 at 21:53)</a>:</h4>
<p>I think the advantage of using <code>'return</code> is probably that it's consistent with the rest of the language and IIRC keyword lifetimes currently cause an error.</p>



<a name="264931798"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/An%20idea%20for%20lifetime%20elision/near/264931798" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jubilee <a href="https://zulip-archive.rust-lang.org/stream/213817-t-lang/topic/An.20idea.20for.20lifetime.20elision.html#264931798">(Dec 14 2021 at 21:55)</a>:</h4>
<p>Yeah, that's why it would be trivial to impl <code>'return</code> now.</p>



<a name="264931909"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/An%20idea%20for%20lifetime%20elision/near/264931909" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Lokathor <a href="https://zulip-archive.rust-lang.org/stream/213817-t-lang/topic/An.20idea.20for.20lifetime.20elision.html#264931909">(Dec 14 2021 at 21:56)</a>:</h4>
<p>on the other hand, <code>'return</code> is long enough that i'd just write <code>&lt;'a&gt;</code> on the function's declaration and use 'a</p>



<a name="264935527"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/An%20idea%20for%20lifetime%20elision/near/264935527" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> scottmcm <a href="https://zulip-archive.rust-lang.org/stream/213817-t-lang/topic/An.20idea.20for.20lifetime.20elision.html#264935527">(Dec 14 2021 at 22:25)</a>:</h4>
<p><span class="user-mention silent" data-user-id="281757">Jubilee</span> <a href="#narrow/stream/213817-t-lang/topic/An.20idea.20for.20lifetime.20elision/near/264931355">said</a>:</p>
<blockquote>
<p>I would prefer <code>'ret</code> &lt;/asmbrain&gt; but I grok the reasoning, and we could have <code>'return</code> now and maybe <code>'ret</code> later.</p>
</blockquote>
<p>Rust used to have <code>ret</code> as the keyword because it had a "no keywords more than 3 characters" guideline, IIRC.  That was well before my time here, though <span aria-label="upside down" class="emoji emoji-1f643" role="img" title="upside down">:upside_down:</span></p>



<a name="264945088"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/An%20idea%20for%20lifetime%20elision/near/264945088" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jubilee <a href="https://zulip-archive.rust-lang.org/stream/213817-t-lang/topic/An.20idea.20for.20lifetime.20elision.html#264945088">(Dec 14 2021 at 23:39)</a>:</h4>
<p><span class="user-mention silent" data-user-id="224471">Lokathor</span> <a href="#narrow/stream/213817-t-lang/topic/An.20idea.20for.20lifetime.20elision/near/264931909">said</a>:</p>
<blockquote>
<p>on the other hand, <code>'return</code> is long enough that i'd just write <code>&lt;'a&gt;</code> on the function's declaration and use 'a</p>
</blockquote>
<p>Yeah this is why I think reserving <code>'ret</code> in Rust Next would be a good idea: because while <code>'return</code> is easy to do right now, if we want to add a magic lifetime for the purpose of <strong>syntax sugar</strong>, then it helps if it actually is sweet.</p>



<a name="264945229"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/An%20idea%20for%20lifetime%20elision/near/264945229" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Noah Lev <a href="https://zulip-archive.rust-lang.org/stream/213817-t-lang/topic/An.20idea.20for.20lifetime.20elision.html#264945229">(Dec 14 2021 at 23:41)</a>:</h4>
<p>There does seem to be existing usage of <code>'ret</code> "in the wild": <a href="https://grep.app/search?q=%27ret%5B%2C%3E%5D&amp;regexp=true&amp;filter[lang][0]=Rust">https://grep.app/search?q=%27ret%5B%2C%3E%5D&amp;regexp=true&amp;filter[lang][0]=Rust</a></p>



<a name="264945359"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/An%20idea%20for%20lifetime%20elision/near/264945359" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jubilee <a href="https://zulip-archive.rust-lang.org/stream/213817-t-lang/topic/An.20idea.20for.20lifetime.20elision.html#264945359">(Dec 14 2021 at 23:42)</a>:</h4>
<p>Is it by any chance consistently in alignment with this convention?</p>



<a name="264945390"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/An%20idea%20for%20lifetime%20elision/near/264945390" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Noah Lev <a href="https://zulip-archive.rust-lang.org/stream/213817-t-lang/topic/An.20idea.20for.20lifetime.20elision.html#264945390">(Dec 14 2021 at 23:43)</a>:</h4>
<p>I don't think so, but I'm not sure.</p>



<a name="264945403"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/An%20idea%20for%20lifetime%20elision/near/264945403" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jubilee <a href="https://zulip-archive.rust-lang.org/stream/213817-t-lang/topic/An.20idea.20for.20lifetime.20elision.html#264945403">(Dec 14 2021 at 23:43)</a>:</h4>
<p>It seems to usually be, except for this odd one:</p>
<blockquote>
<p>impl&lt;'ret, 'cache: 'ret&gt; Resolver&lt;'ret, 'cache&gt; {</p>
</blockquote>



<a name="264947877"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/An%20idea%20for%20lifetime%20elision/near/264947877" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> scottmcm <a href="https://zulip-archive.rust-lang.org/stream/213817-t-lang/topic/An.20idea.20for.20lifetime.20elision.html#264947877">(Dec 15 2021 at 00:11)</a>:</h4>
<p><span class="user-mention silent" data-user-id="224471">Lokathor</span> <a href="#narrow/stream/213817-t-lang/topic/An.20idea.20for.20lifetime.20elision/near/264931909">said</a>:</p>
<blockquote>
<p>on the other hand, <code>'return</code> is long enough that i'd just write <code>&lt;'a&gt;</code> on the function's declaration and use 'a</p>
</blockquote>
<p>Well, <code>'return</code> is still technically shorter than the full <code>&lt;'a&gt;'a'a</code> dance to declare it, mention it in the parameter, and mention it in the return type.</p>
<p>(<em>Usefully</em> shorter?  That's a different question.  But it's fewer characters and in one place instead of three, so I think it could still be easier.)</p>



<a name="264986929"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/An%20idea%20for%20lifetime%20elision/near/264986929" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Nick Cameron <a href="https://zulip-archive.rust-lang.org/stream/213817-t-lang/topic/An.20idea.20for.20lifetime.20elision.html#264986929">(Dec 15 2021 at 10:06)</a>:</h4>
<p>Given the small difference between 'return and &lt;'a&gt;'a'a, I feel like this is adding significant complexity for little benefit (having to explain these special case lifetimes feels like its adding a fair amount)</p>



<a name="265063491"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/An%20idea%20for%20lifetime%20elision/near/265063491" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> DevinR528 <a href="https://zulip-archive.rust-lang.org/stream/213817-t-lang/topic/An.20idea.20for.20lifetime.20elision.html#265063491">(Dec 15 2021 at 19:39)</a>:</h4>
<p>I've been trying to come up with a good way of articulating this difference: rust lifetimes are not "prescriptive" (what I mean by this is that you can't say this thing has this lifetime and it magically lives that long) all you can do is mark the relationships. <code>'static</code> is a bit different but also not since your just marking it in relation to the whole program.</p>
<p>That said I feel like the <code>'return</code> lifetime may blur the line? The not being able to prescribe a lifetime to an object was one of my mental hurdle to understanding lifetimes.</p>



<a name="265063851"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/An%20idea%20for%20lifetime%20elision/near/265063851" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Noah Lev <a href="https://zulip-archive.rust-lang.org/stream/213817-t-lang/topic/An.20idea.20for.20lifetime.20elision.html#265063851">(Dec 15 2021 at 19:41)</a>:</h4>
<p>In some sense, lifetimes are not prescriptive in the same way that ordinary types are not prescriptive; you can't say <code>42</code> has the type <code>String</code>.</p>
<p>But I think I know what you mean. My recollection is it confused me when I was learning the language too.</p>



<a name="265070950"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/An%20idea%20for%20lifetime%20elision/near/265070950" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> DevinR528 <a href="https://zulip-archive.rust-lang.org/stream/213817-t-lang/topic/An.20idea.20for.20lifetime.20elision.html#265070950">(Dec 15 2021 at 20:29)</a>:</h4>
<p>That's a good point, that they are just like types, which is exactly how they are treated in the compiler (and what they are). <span aria-label="thumbs up" class="emoji emoji-1f44d" role="img" title="thumbs up">:thumbs_up:</span></p>



<a name="265083696"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/An%20idea%20for%20lifetime%20elision/near/265083696" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> scottmcm <a href="https://zulip-archive.rust-lang.org/stream/213817-t-lang/topic/An.20idea.20for.20lifetime.20elision.html#265083696">(Dec 15 2021 at 22:13)</a>:</h4>
<p>So <code>'_</code> is (sortof) <code>impl Lifetime</code> <span aria-label="thinking" class="emoji emoji-1f914" role="img" title="thinking">:thinking:</span></p>



<a name="265499490"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/An%20idea%20for%20lifetime%20elision/near/265499490" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Aaron Hill <a href="https://zulip-archive.rust-lang.org/stream/213817-t-lang/topic/An.20idea.20for.20lifetime.20elision.html#265499490">(Dec 19 2021 at 20:52)</a>:</h4>
<p><span class="user-mention silent" data-user-id="125270">scottmcm</span> <a href="#narrow/stream/213817-t-lang/topic/An.20idea.20for.20lifetime.20elision/near/264917734">said</a>:</p>
<blockquote>
<p>I was scrolling through <a href="https://github.com/rust-lang/rust/issues/91931">#91931</a> looking at the diffs for removing in-band.  This one jumped out to me</p>
<div class="codehilite" data-code-language="Diff"><pre><span></span><code><span class="gd">-fn llvm_asm_scalar_type(cx: &amp;CodegenCx&lt;'ll, 'tcx&gt;, scalar: Scalar) -&gt; &amp;'ll Type {</span>
<span class="gi">+fn llvm_asm_scalar_type&lt;'ll&gt;(cx: &amp;CodegenCx&lt;'ll, '_&gt;, scalar: Scalar) -&gt; &amp;'ll Type {</span>
</code></pre></div>
<p>It made me think that perhaps what we need most of the time is to say which one is the lifetime of the return value, as the elision error says, so maybe we could do something more specifically targeted for that case?</p>
<p>I haven't thought this through yet, but what do people think of</p>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="k">fn</span> <span class="nf">llvm_asm_scalar_type</span><span class="p">(</span><span class="n">cx</span>: <span class="kp">&amp;</span><span class="nc">CodegenCx</span><span class="o">&lt;'</span><span class="na">return</span><span class="p">,</span><span class="w"> </span><span class="o">'</span><span class="nb">_</span><span class="o">&gt;</span><span class="p">,</span><span class="w"> </span><span class="n">scalar</span>: <span class="nc">Scalar</span><span class="p">)</span><span class="w"> </span>-&gt; <span class="kp">&amp;</span><span class="nc">Type</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
</code></pre></div>
<p>Non-breaking, since keywords (like <code>return</code>) can't be used as lifetime names today.  And it's not short, but that's almost good to help it (along with syntax highlighting) stand out as "this is the one".  But it's not as long as <code>&lt;'ll&gt; 'll 'll</code> either.</p>
</blockquote>
<p>Personally, I don't think that that example is verbose enough to warrant further elision</p>



<a name="265499513"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/An%20idea%20for%20lifetime%20elision/near/265499513" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Aaron Hill <a href="https://zulip-archive.rust-lang.org/stream/213817-t-lang/topic/An.20idea.20for.20lifetime.20elision.html#265499513">(Dec 19 2021 at 20:53)</a>:</h4>
<p>When I'm reading over a signature, I think it's very useful to be able to look for occurrences of the same lifetime, instead of needing to mentally match up something like <code>'return</code> with an elided lifetime</p>



<hr><p>Last updated: Apr 12 2022 at 20:01 UTC</p>
</html>