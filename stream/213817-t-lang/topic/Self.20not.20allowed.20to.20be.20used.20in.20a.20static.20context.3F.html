<html>
<head><meta charset="utf-8"><title>Self not allowed to be used in a static context? · t-lang · Zulip Chat Archive</title></head>
<h2>Stream: <a href="https://zulip-archive.rust-lang.org/stream/213817-t-lang/index.html">t-lang</a></h2>
<h3>Topic: <a href="https://zulip-archive.rust-lang.org/stream/213817-t-lang/topic/Self.20not.20allowed.20to.20be.20used.20in.20a.20static.20context.3F.html">Self not allowed to be used in a static context?</a></h3>

<hr>

<base href="https://rust-lang.zulipchat.com">

<head><link href="https://zulip-archive.rust-lang.org/style.css" rel="stylesheet"></head>

<a name="260595052"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/Self%20not%20allowed%20to%20be%20used%20in%20a%20static%20context%3F/near/260595052" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jasmine Burnside <a href="https://zulip-archive.rust-lang.org/stream/213817-t-lang/topic/Self.20not.20allowed.20to.20be.20used.20in.20a.20static.20context.3F.html#260595052">(Nov 07 2021 at 20:54)</a>:</h4>
<p>I am confused as why the former doesn't work but the latter does:<br>
<a href="https://play.rust-lang.org/?version=stable&amp;mode=debug&amp;edition=2021&amp;gist=7dbaa22e643951cd337500e197c779da">https://play.rust-lang.org/?version=stable&amp;mode=debug&amp;edition=2021&amp;gist=7dbaa22e643951cd337500e197c779da</a><br>
<a href="https://play.rust-lang.org/?version=stable&amp;mode=debug&amp;edition=2021&amp;gist=a09315d3b59f9d39791f69e301ec8a78">https://play.rust-lang.org/?version=stable&amp;mode=debug&amp;edition=2021&amp;gist=a09315d3b59f9d39791f69e301ec8a78</a></p>



<a name="260597103"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/Self%20not%20allowed%20to%20be%20used%20in%20a%20static%20context%3F/near/260597103" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Eric Huss <a href="https://zulip-archive.rust-lang.org/stream/213817-t-lang/topic/Self.20not.20allowed.20to.20be.20used.20in.20a.20static.20context.3F.html#260597103">(Nov 07 2021 at 21:43)</a>:</h4>
<p><code>Self</code> isn't an alias. It is treated as a generic parameter that just happens to have the same type as <code>Bar</code>.</p>



<a name="260597168"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/Self%20not%20allowed%20to%20be%20used%20in%20a%20static%20context%3F/near/260597168" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jasmine Burnside <a href="https://zulip-archive.rust-lang.org/stream/213817-t-lang/topic/Self.20not.20allowed.20to.20be.20used.20in.20a.20static.20context.3F.html#260597168">(Nov 07 2021 at 21:45)</a>:</h4>
<p>Why isn't it an alias?</p>



<a name="260599496"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/Self%20not%20allowed%20to%20be%20used%20in%20a%20static%20context%3F/near/260599496" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Eric Huss <a href="https://zulip-archive.rust-lang.org/stream/213817-t-lang/topic/Self.20not.20allowed.20to.20be.20used.20in.20a.20static.20context.3F.html#260599496">(Nov 07 2021 at 22:35)</a>:</h4>
<p>I'm not sure if I can answer that well. Imagine if your <code>Bar</code> was generic as in <code>Bar&lt;T&gt;</code>, then <code>Self</code> would depend on the type of T. When <code>Self</code> is referenced inside another item like a <code>static</code>, there wouldn't be just one <code>Self</code> that it was referring to.  (Not to mention, nested uses of <code>Self</code> could get really confusing.)</p>



<a name="260600010"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/Self%20not%20allowed%20to%20be%20used%20in%20a%20static%20context%3F/near/260600010" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jasmine Burnside <a href="https://zulip-archive.rust-lang.org/stream/213817-t-lang/topic/Self.20not.20allowed.20to.20be.20used.20in.20a.20static.20context.3F.html#260600010">(Nov 07 2021 at 22:47)</a>:</h4>
<p>that doesn't make sense Self would refer to a single <code>Bar&lt;T&gt;</code> instance correct? you don't have to do <code>Self&lt;T&gt;</code></p>



<a name="260601459"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/Self%20not%20allowed%20to%20be%20used%20in%20a%20static%20context%3F/near/260601459" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Gary Guo <a href="https://zulip-archive.rust-lang.org/stream/213817-t-lang/topic/Self.20not.20allowed.20to.20be.20used.20in.20a.20static.20context.3F.html#260601459">(Nov 07 2021 at 23:17)</a>:</h4>
<p>nested items couldn't refer to generic parameters. Self may refer to generic parameters though.</p>



<a name="260602038"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/Self%20not%20allowed%20to%20be%20used%20in%20a%20static%20context%3F/near/260602038" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jasmine Burnside <a href="https://zulip-archive.rust-lang.org/stream/213817-t-lang/topic/Self.20not.20allowed.20to.20be.20used.20in.20a.20static.20context.3F.html#260602038">(Nov 07 2021 at 23:29)</a>:</h4>
<p>Well shouldn't Self resolve to a single type no matter what?</p>



<a name="260608035"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/Self%20not%20allowed%20to%20be%20used%20in%20a%20static%20context%3F/near/260608035" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Gary Guo <a href="https://zulip-archive.rust-lang.org/stream/213817-t-lang/topic/Self.20not.20allowed.20to.20be.20used.20in.20a.20static.20context.3F.html#260608035">(Nov 08 2021 at 01:57)</a>:</h4>
<p>How?</p>



<a name="260608074"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/Self%20not%20allowed%20to%20be%20used%20in%20a%20static%20context%3F/near/260608074" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Gary Guo <a href="https://zulip-archive.rust-lang.org/stream/213817-t-lang/topic/Self.20not.20allowed.20to.20be.20used.20in.20a.20static.20context.3F.html#260608074">(Nov 08 2021 at 01:58)</a>:</h4>
<p>You can use Self in a generic impl.</p>



<a name="260610337"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/Self%20not%20allowed%20to%20be%20used%20in%20a%20static%20context%3F/near/260610337" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jasmine Burnside <a href="https://zulip-archive.rust-lang.org/stream/213817-t-lang/topic/Self.20not.20allowed.20to.20be.20used.20in.20a.20static.20context.3F.html#260610337">(Nov 08 2021 at 02:53)</a>:</h4>
<p>but not as a Generic arg. and Self should refer to a concrete type no?</p>



<a name="260610403"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/Self%20not%20allowed%20to%20be%20used%20in%20a%20static%20context%3F/near/260610403" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Gary Guo <a href="https://zulip-archive.rust-lang.org/stream/213817-t-lang/topic/Self.20not.20allowed.20to.20be.20used.20in.20a.20static.20context.3F.html#260610403">(Nov 08 2021 at 02:55)</a>:</h4>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="k">const</span><span class="w"> </span><span class="k">fn</span> <span class="nf">empty</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;</span><span class="p">()</span><span class="w"> </span>-&gt; <span class="kp">&amp;</span><span class="o">'</span><span class="nb">static</span> <span class="kt">str</span> <span class="p">{</span><span class="w"> </span><span class="s">""</span><span class="w"> </span><span class="p">}</span><span class="w"></span>

<span class="k">struct</span> <span class="nc">Foo</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;</span><span class="p">(</span><span class="n">T</span><span class="p">);</span><span class="w"></span>
<span class="k">impl</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;</span><span class="w"> </span><span class="n">Foo</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="k">fn</span> <span class="nf">foo</span><span class="p">()</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">        </span><span class="k">static</span><span class="w"> </span><span class="n">FOO</span>: <span class="kp">&amp;</span><span class="kt">str</span> <span class="o">=</span><span class="w"> </span><span class="n">empty</span>::<span class="o">&lt;</span><span class="bp">Self</span><span class="o">&gt;</span><span class="p">();</span><span class="w"></span>
<span class="w">    </span><span class="p">}</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>
</code></pre></div>



<a name="260610405"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/Self%20not%20allowed%20to%20be%20used%20in%20a%20static%20context%3F/near/260610405" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Gary Guo <a href="https://zulip-archive.rust-lang.org/stream/213817-t-lang/topic/Self.20not.20allowed.20to.20be.20used.20in.20a.20static.20context.3F.html#260610405">(Nov 08 2021 at 02:55)</a>:</h4>
<p>What concrete type is <code>Self</code> referring to here?</p>



<a name="260611261"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/Self%20not%20allowed%20to%20be%20used%20in%20a%20static%20context%3F/near/260611261" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Charles Lew <a href="https://zulip-archive.rust-lang.org/stream/213817-t-lang/topic/Self.20not.20allowed.20to.20be.20used.20in.20a.20static.20context.3F.html#260611261">(Nov 08 2021 at 03:14)</a>:</h4>
<p>const/static are items. Since they're not associated items here, they don't have access to <code>Self</code>.</p>



<a name="260611374"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/Self%20not%20allowed%20to%20be%20used%20in%20a%20static%20context%3F/near/260611374" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Charles Lew <a href="https://zulip-archive.rust-lang.org/stream/213817-t-lang/topic/Self.20not.20allowed.20to.20be.20used.20in.20a.20static.20context.3F.html#260611374">(Nov 08 2021 at 03:16)</a>:</h4>
<p>You can imagine them defined within an imaginary module that has the scope of the function body.</p>



<a name="260652650"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/Self%20not%20allowed%20to%20be%20used%20in%20a%20static%20context%3F/near/260652650" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jasmine Burnside <a href="https://zulip-archive.rust-lang.org/stream/213817-t-lang/topic/Self.20not.20allowed.20to.20be.20used.20in.20a.20static.20context.3F.html#260652650">(Nov 08 2021 at 12:56)</a>:</h4>
<p>Foo&lt;T&gt; isn't yet concrete in that example.  it would refer to Foo&lt;T&gt; when T is provided</p>



<a name="260654272"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/Self%20not%20allowed%20to%20be%20used%20in%20a%20static%20context%3F/near/260654272" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Daniel Henry-Mantilla <a href="https://zulip-archive.rust-lang.org/stream/213817-t-lang/topic/Self.20not.20allowed.20to.20be.20used.20in.20a.20static.20context.3F.html#260654272">(Nov 08 2021 at 13:10)</a>:</h4>
<p>You can't have generic statics in Rust, for incidentally similar reasons to <code>dyn Trait</code>s not supporting generic methods: in both cases the compiler would need to know, at that point in the compilation, of all the possible instantiations of that generic, which is problematic to say the least given that such instantiations could stem from downstream / dependent crates.</p>
<p>More generally, as <span class="user-mention" data-user-id="303710">@Gary Guo</span> pointed out, you can only have items that depend on the generics introduced by an <code>impl</code> block if they are written directly inside that block, in a non-nested fashion, since that makes those items be <em>associated</em> items (<code>Foo::&lt;T&gt;::assoc_item</code>). The moment something is written elsewhere or in a nested fashion (such as a type / const / static def inside a function's body), the "being inside a generic context / scope" is lost, even if <em>syntactically</em> it does look like we are inside that scope:</p>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="k">struct</span> <span class="nc">Foo</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;</span><span class="p">(</span><span class="n">T</span><span class="p">);</span><span class="w"></span>
<span class="k">impl</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;</span><span class="w"> </span><span class="n">Foo</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="k">fn</span> <span class="nf">foo</span><span class="p">()</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">        </span><span class="k">static</span><span class="w"> </span><span class="n">FOO</span>: <span class="kp">&amp;</span><span class="kt">str</span> <span class="o">=</span><span class="w"> </span><span class="err">…</span><span class="p">;</span><span class="w"></span>
<span class="w">    </span><span class="p">}</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>
</code></pre></div>
<p>is actually equivalent to:</p>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="k">struct</span> <span class="nc">Foo</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;</span><span class="p">(</span><span class="n">T</span><span class="p">);</span><span class="w"></span>
<span class="k">impl</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;</span><span class="w"> </span><span class="n">Foo</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="k">fn</span> <span class="nf">foo</span><span class="p">()</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="p">}</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>

<span class="k">pub</span><span class="p">(</span><span class="n">kind</span><span class="w"> </span><span class="n">of</span><span class="w"> </span><span class="n">only</span><span class="w"> </span><span class="n">accessible</span><span class="w"> </span><span class="n">from</span><span class="w"> </span><span class="n">within</span><span class="w"> </span><span class="err">`</span><span class="n">Foo</span>::<span class="n">foo</span><span class="err">`</span><span class="o">'</span><span class="na">s</span><span class="w"> </span><span class="n">body</span><span class="p">)</span><span class="w"></span>
<span class="k">static</span><span class="w"> </span><span class="n">FOO</span>: <span class="kp">&amp;</span><span class="kt">str</span> <span class="o">=</span><span class="w"> </span><span class="err">…</span><span class="p">;</span><span class="w"></span>
</code></pre></div>
<p>Which is why even if we replaced that <code>static</code> with a <code>const</code> (those can be generic / associated items in a generic impl), the code would still not compile, since the <code>const</code> would be defined <em>outside</em> the generic context.</p>



<hr><p>Last updated: Apr 12 2022 at 20:01 UTC</p>
</html>