<html>
<head><meta charset="utf-8"><title>.match suffix · t-lang · Zulip Chat Archive</title></head>
<h2>Stream: <a href="https://zulip-archive.rust-lang.org/stream/213817-t-lang/index.html">t-lang</a></h2>
<h3>Topic: <a href="https://zulip-archive.rust-lang.org/stream/213817-t-lang/topic/.2Ematch.20suffix.html">.match suffix</a></h3>

<hr>

<base href="https://rust-lang.zulipchat.com">

<head><link href="https://zulip-archive.rust-lang.org/style.css" rel="stylesheet"></head>

<a name="255229912"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/.match%20suffix/near/255229912" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> pnkfelix <a href="https://zulip-archive.rust-lang.org/stream/213817-t-lang/topic/.2Ematch.20suffix.html#255229912">(Sep 28 2021 at 14:53)</a>:</h4>
<p>I just experienced where one wants <code>.match</code> : when given an existing method chain like <code>x.foo()?.bar()?</code>, and you want to convert the <code>?</code> into some kind of more error handling that cannot be put into a closure (e.g. error processing that involves <code>continue</code> of a surrounding loop). The current “best” practice AFAICT is to first rewrite into something that let-binds the intermediate expressions, so that you can <code>match</code> on the names introduced by the lets.</p>



<a name="255230081"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/.match%20suffix/near/255230081" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> pnkfelix <a href="https://zulip-archive.rust-lang.org/stream/213817-t-lang/topic/.2Ematch.20suffix.html#255230081">(Sep 28 2021 at 14:54)</a>:</h4>
<p>We talked about suffix <code>.match</code> back when we were debating about the introduction of <code>.await</code>, but this is my first experience I can remember of thinking “suffix .match <em>is</em> the right thing here."</p>



<a name="255231600"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/.match%20suffix/near/255231600" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> pnkfelix <a href="https://zulip-archive.rust-lang.org/stream/213817-t-lang/topic/.2Ematch.20suffix.html#255231600">(Sep 28 2021 at 15:03)</a>:</h4>
<p>Is there any existing thread with serious discussion of whether to add <code>expr.match { … }</code> ?</p>



<a name="255232160"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/.match%20suffix/near/255232160" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Triplett <a href="https://zulip-archive.rust-lang.org/stream/213817-t-lang/topic/.2Ematch.20suffix.html#255232160">(Sep 28 2021 at 15:06)</a>:</h4>
<p>Not that I'm aware of, but I'd love to see this.</p>



<a name="255233040"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/.match%20suffix/near/255233040" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> pnkfelix <a href="https://zulip-archive.rust-lang.org/stream/213817-t-lang/topic/.2Ematch.20suffix.html#255233040">(Sep 28 2021 at 15:10)</a>:</h4>
<p>(I just also realized that another “solution” to my problem, though much much harder to implement, would be a way to <code>continue</code>/<code>break</code> out of closures.)</p>



<a name="255233481"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/.match%20suffix/near/255233481" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Triplett <a href="https://zulip-archive.rust-lang.org/stream/213817-t-lang/topic/.2Ematch.20suffix.html#255233481">(Sep 28 2021 at 15:13)</a>:</h4>
<p>I'd like to have that as well, and especially the ability to <code>?</code> in a closure to the containing context. I'm not sure what the best way to accomplish that is, and it needs some very careful syntax handling, but I'm interested in some solution for that problem too.</p>



<a name="255249176"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/.match%20suffix/near/255249176" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Mara <a href="https://zulip-archive.rust-lang.org/stream/213817-t-lang/topic/.2Ematch.20suffix.html#255249176">(Sep 28 2021 at 16:46)</a>:</h4>
<p>yess, postfix <em>all the things</em>!</p>



<a name="255249256"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/.match%20suffix/near/255249256" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> oli <a href="https://zulip-archive.rust-lang.org/stream/213817-t-lang/topic/.2Ematch.20suffix.html#255249256">(Sep 28 2021 at 16:47)</a>:</h4>
<p>postfix inline const XD</p>



<a name="255249378"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/.match%20suffix/near/255249378" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Boxy [she/her] <a href="https://zulip-archive.rust-lang.org/stream/213817-t-lang/topic/.2Ematch.20suffix.html#255249378">(Sep 28 2021 at 16:48)</a>:</h4>
<p><span class="user-mention silent" data-user-id="124288">oli</span> <a href="#narrow/stream/213817-t-lang/topic/.2Ematch.20suffix/near/255249256">said</a>:</p>
<blockquote>
<p>postfix inline const XD</p>
</blockquote>
<p>nononono not that one</p>



<a name="255249450"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/.match%20suffix/near/255249450" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Boxy [she/her] <a href="https://zulip-archive.rust-lang.org/stream/213817-t-lang/topic/.2Ematch.20suffix.html#255249450">(Sep 28 2021 at 16:48)</a>:</h4>
<p><span aria-label="sweat smile" class="emoji emoji-1f605" role="img" title="sweat smile">:sweat_smile:</span></p>



<a name="255268855"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/.match%20suffix/near/255268855" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/213817-t-lang/topic/.2Ematch.20suffix.html#255268855">(Sep 28 2021 at 18:00)</a>:</h4>
<p>I'd be in favor of suffix <code>.match</code>, I believe</p>



<a name="255268876"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/.match%20suffix/near/255268876" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/213817-t-lang/topic/.2Ematch.20suffix.html#255268876">(Sep 28 2021 at 18:01)</a>:</h4>
<p><code>try { foo }.match { ... }</code>-- super duper :)</p>



<a name="257411628"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/.match%20suffix/near/257411628" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> scottmcm <a href="https://zulip-archive.rust-lang.org/stream/213817-t-lang/topic/.2Ematch.20suffix.html#257411628">(Oct 13 2021 at 18:10)</a>:</h4>
<p>C# has postfix-<code>switch</code> now (<a href="https://docs.microsoft.com/en-us/dotnet/csharp/language-reference/operators/switch-expression">https://docs.microsoft.com/en-us/dotnet/csharp/language-reference/operators/switch-expression</a>) which might help assuage some of the "this is too weird" feedback.</p>



<a name="257549736"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/.match%20suffix/near/257549736" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Triplett <a href="https://zulip-archive.rust-lang.org/stream/213817-t-lang/topic/.2Ematch.20suffix.html#257549736">(Oct 14 2021 at 14:59)</a>:</h4>
<p>Oooh.</p>



<a name="257549800"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/.match%20suffix/near/257549800" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Triplett <a href="https://zulip-archive.rust-lang.org/stream/213817-t-lang/topic/.2Ematch.20suffix.html#257549800">(Oct 14 2021 at 15:00)</a>:</h4>
<p><span class="user-mention" data-user-id="125270">@scottmcm</span> That's good precedent!</p>



<a name="257563084"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/.match%20suffix/near/257563084" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> cuviper <a href="https://zulip-archive.rust-lang.org/stream/213817-t-lang/topic/.2Ematch.20suffix.html#257563084">(Oct 14 2021 at 16:21)</a>:</h4>
<p>so they appear to have the statement <code>switch (value) { case X: ... break; default: ...}</code> that's C-ish, and now the expression <code>value switch { X =&gt; val, ... }</code> that's Rust-ish</p>



<a name="257563168"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/.match%20suffix/near/257563168" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> cuviper <a href="https://zulip-archive.rust-lang.org/stream/213817-t-lang/topic/.2Ematch.20suffix.html#257563168">(Oct 14 2021 at 16:22)</a>:</h4>
<p>(whereas our <code>match value</code> is already an expression)</p>



<a name="257563357"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/.match%20suffix/near/257563357" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> cuviper <a href="https://zulip-archive.rust-lang.org/stream/213817-t-lang/topic/.2Ematch.20suffix.html#257563357">(Oct 14 2021 at 16:23)</a>:</h4>
<p>so my "this is too weird" feedback is that they have two <em>very</em> different kinds of <code>switch</code></p>



<a name="257563552"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/.match%20suffix/near/257563552" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> cuviper <a href="https://zulip-archive.rust-lang.org/stream/213817-t-lang/topic/.2Ematch.20suffix.html#257563552">(Oct 14 2021 at 16:24)</a>:</h4>
<p>I do like the idea of <code>.match</code>, but I'm not sure C# is a great model because of that</p>



<a name="257594682"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/.match%20suffix/near/257594682" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> scottmcm <a href="https://zulip-archive.rust-lang.org/stream/213817-t-lang/topic/.2Ematch.20suffix.html#257594682">(Oct 14 2021 at 19:51)</a>:</h4>
<p>Yeah, all the new <code>=&gt;</code> versions of everything is adding a ton of new syntax to C#.</p>



<a name="257607783"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/.match%20suffix/near/257607783" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Connor Horman <a href="https://zulip-archive.rust-lang.org/stream/213817-t-lang/topic/.2Ematch.20suffix.html#257607783">(Oct 14 2021 at 21:18)</a>:</h4>
<p>Java did the same, but it's introduced the same was as the old switch.</p>



<a name="257607926"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/.match%20suffix/near/257607926" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Connor Horman <a href="https://zulip-archive.rust-lang.org/stream/213817-t-lang/topic/.2Ematch.20suffix.html#257607926">(Oct 14 2021 at 21:19)</a>:</h4>
<p>(It also separated the "switch expression" feature from the new syntax, though added both at the same time)</p>



<a name="257608218"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/.match%20suffix/near/257608218" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Connor Horman <a href="https://zulip-archive.rust-lang.org/stream/213817-t-lang/topic/.2Ematch.20suffix.html#257608218">(Oct 14 2021 at 21:21)</a>:</h4>
<p>I would agree that it was kinda weird, but, at least from that perspective, it is as weird as match in rust is.</p>



<a name="257619149"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/.match%20suffix/near/257619149" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/213817-t-lang/topic/.2Ematch.20suffix.html#257619149">(Oct 14 2021 at 22:57)</a>:</h4>
<p>Let's do <code>.match</code>!</p>



<a name="257619189"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/.match%20suffix/near/257619189" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/213817-t-lang/topic/.2Ematch.20suffix.html#257619189">(Oct 14 2021 at 22:57)</a>:</h4>
<p>I feel like we've crossed the rubicon of weirdness with <code>.await</code> and we have plenty of evidence that "it's not that weird"</p>



<a name="257620597"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/.match%20suffix/near/257620597" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Gary Guo <a href="https://zulip-archive.rust-lang.org/stream/213817-t-lang/topic/.2Ematch.20suffix.html#257620597">(Oct 14 2021 at 23:10)</a>:</h4>
<p>We could prototype postfix match with postfix macros as well, couldn't we?</p>



<a name="257622158"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/.match%20suffix/near/257622158" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> cuviper <a href="https://zulip-archive.rust-lang.org/stream/213817-t-lang/topic/.2Ematch.20suffix.html#257622158">(Oct 14 2021 at 23:26)</a>:</h4>
<p>I <em>think</em> postfix <code>.match</code> is just a parsing change, still creating an <code>ExprKind::Match</code>, then the rest of the compiler doesn't need to care how it was written</p>



<a name="257622338"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/.match%20suffix/near/257622338" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> cuviper <a href="https://zulip-archive.rust-lang.org/stream/213817-t-lang/topic/.2Ematch.20suffix.html#257622338">(Oct 14 2021 at 23:28)</a>:</h4>
<p>something like this (untested)<br>
<a href="https://gist.github.com/cuviper/a02ecfb0ef068adbb4ae9d7da871f010">https://gist.github.com/cuviper/a02ecfb0ef068adbb4ae9d7da871f010</a></p>



<a name="257622865"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/.match%20suffix/near/257622865" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> cuviper <a href="https://zulip-archive.rust-lang.org/stream/213817-t-lang/topic/.2Ematch.20suffix.html#257622865">(Oct 14 2021 at 23:33)</a>:</h4>
<p>hey, it actually works!</p>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="k">fn</span> <span class="nf">main</span><span class="p">()</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="nb">Some</span><span class="p">(</span><span class="mi">42</span><span class="p">).</span><span class="k">match</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">        </span><span class="nb">Some</span><span class="p">(</span><span class="n">x</span><span class="p">)</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="fm">println!</span><span class="p">(</span><span class="s">"Hello, world {}!"</span><span class="p">,</span><span class="w"> </span><span class="n">x</span><span class="p">),</span><span class="w"></span>
<span class="w">        </span><span class="nb">None</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="fm">panic!</span><span class="p">(),</span><span class="w"></span>
<span class="w">    </span><span class="p">}</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>
</code></pre></div>



<a name="257649708"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/.match%20suffix/near/257649708" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Kestrer <a href="https://zulip-archive.rust-lang.org/stream/213817-t-lang/topic/.2Ematch.20suffix.html#257649708">(Oct 15 2021 at 05:54)</a>:</h4>
<p>If we were to add this, we need to decide on some guidelines for which one to use. Otherwise there would be lots of cases where it would just be a choice, leading to increasingly divergent code styles.</p>



<a name="257649759"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/.match%20suffix/near/257649759" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Kestrer <a href="https://zulip-archive.rust-lang.org/stream/213817-t-lang/topic/.2Ematch.20suffix.html#257649759">(Oct 15 2021 at 05:55)</a>:</h4>
<p>Is it suggested that this would replace prefix match entirely? Or somehow supplement it</p>



<a name="257666864"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/.match%20suffix/near/257666864" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> kennytm <a href="https://zulip-archive.rust-lang.org/stream/213817-t-lang/topic/.2Ematch.20suffix.html#257666864">(Oct 15 2021 at 09:02)</a>:</h4>
<p>supplement please. i'd hate if <code>(&amp;self.0).match {}</code> is preferred over <code>match &amp;self.0 {}</code> <span aria-label="upside down" class="emoji emoji-1f643" role="img" title="upside down">:upside_down:</span></p>



<a name="257667029"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/.match%20suffix/near/257667029" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Boxy [she/her] <a href="https://zulip-archive.rust-lang.org/stream/213817-t-lang/topic/.2Ematch.20suffix.html#257667029">(Oct 15 2021 at 09:03)</a>:</h4>
<p>if we had postfix borrow you could write it as <code>self.0&amp;.match {}</code> which would be neat :P</p>



<a name="257668623"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/.match%20suffix/near/257668623" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> kennytm <a href="https://zulip-archive.rust-lang.org/stream/213817-t-lang/topic/.2Ematch.20suffix.html#257668623">(Oct 15 2021 at 09:17)</a>:</h4>
<p>it is neat until it appears before a binary operator like <code>x&amp; - y</code> which is ambiguous 🥲<br>
(same for postfix-star <code>x* - y</code>)</p>
<p>i guess <code>x.*.*.&amp;</code> (<code>&amp;**x</code>) works though.</p>



<a name="257672245"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/.match%20suffix/near/257672245" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Triplett <a href="https://zulip-archive.rust-lang.org/stream/213817-t-lang/topic/.2Ematch.20suffix.html#257672245">(Oct 15 2021 at 09:50)</a>:</h4>
<p>I definitely wouldn't want it to be a complete replacement; I'm envisioning using it anytime you have a chain of operations, with match at the end.</p>



<a name="257672305"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/.match%20suffix/near/257672305" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Triplett <a href="https://zulip-archive.rust-lang.org/stream/213817-t-lang/topic/.2Ematch.20suffix.html#257672305">(Oct 15 2021 at 09:51)</a>:</h4>
<p>Effectively, consider it a peephole optimization for let x = a.b().c()...; match x { ...</p>



<a name="257690884"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/.match%20suffix/near/257690884" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Triplett <a href="https://zulip-archive.rust-lang.org/stream/213817-t-lang/topic/.2Ematch.20suffix.html#257690884">(Oct 15 2021 at 12:40)</a>:</h4>
<p>Or, perhaps slightly more controversially, an optimization for <code>match exceedingly.long.multiline.expression</code>.</p>



<a name="257690927"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/.match%20suffix/near/257690927" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Triplett <a href="https://zulip-archive.rust-lang.org/stream/213817-t-lang/topic/.2Ematch.20suffix.html#257690927">(Oct 15 2021 at 12:40)</a>:</h4>
<p>I'd be happy to see any case of <code>match multiline.expression {</code> converted to <code>multiline.expression.match {</code>, because it'll break more nicely across lines.</p>



<a name="257692197"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/.match%20suffix/near/257692197" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Mario Carneiro <a href="https://zulip-archive.rust-lang.org/stream/213817-t-lang/topic/.2Ematch.20suffix.html#257692197">(Oct 15 2021 at 12:50)</a>:</h4>
<p>It will add another layer of indentation though, which might be worse if the match is big (especially since <code>match</code> already has one too many levels of indentation, compared to <code>if let</code>)</p>



<a name="257749105"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/.match%20suffix/near/257749105" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Lokathor <a href="https://zulip-archive.rust-lang.org/stream/213817-t-lang/topic/.2Ematch.20suffix.html#257749105">(Oct 15 2021 at 19:10)</a>:</h4>
<p>Well that's why 2-space indentation is the best possible style</p>



<a name="257760926"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/.match%20suffix/near/257760926" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Kestrer <a href="https://zulip-archive.rust-lang.org/stream/213817-t-lang/topic/.2Ematch.20suffix.html#257760926">(Oct 15 2021 at 20:32)</a>:</h4>
<p>2-space indentation for matches, 4-space for everything else</p>



<a name="257793929"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/.match%20suffix/near/257793929" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> scottmcm <a href="https://zulip-archive.rust-lang.org/stream/213817-t-lang/topic/.2Ematch.20suffix.html#257793929">(Oct 16 2021 at 02:43)</a>:</h4>
<p><span class="user-mention silent" data-user-id="360486">Kestrer</span> <a href="#narrow/stream/213817-t-lang/topic/.2Ematch.20suffix/near/257649759">said</a>:</p>
<blockquote>
<p>Is it suggested that this would replace prefix match entirely? Or somehow supplement it</p>
</blockquote>
<p>Definitely supplement, not replace.  I'd treat it like <code>for ... in</code> vs <code>.for_each(...)</code> for iterators -- the bigger the body the more I use the former, the bigger the iterator expression the more I use the latter.</p>



<a name="257794399"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/.match%20suffix/near/257794399" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> scottmcm <a href="https://zulip-archive.rust-lang.org/stream/213817-t-lang/topic/.2Ematch.20suffix.html#257794399">(Oct 16 2021 at 02:51)</a>:</h4>
<p>Hmm, <code>rustfmt</code> has some "simple" heuristics already, right?  Though I suppose that only matters if we decide that <code>rustfmt</code> should pick instead of preserve -- I could see arguments either way.</p>



<a name="257805070"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/.match%20suffix/near/257805070" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Triplett <a href="https://zulip-archive.rust-lang.org/stream/213817-t-lang/topic/.2Ematch.20suffix.html#257805070">(Oct 16 2021 at 05:55)</a>:</h4>
<p>I don't think I would want rustfmt to switch between the two.</p>



<a name="257805084"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/.match%20suffix/near/257805084" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Triplett <a href="https://zulip-archive.rust-lang.org/stream/213817-t-lang/topic/.2Ematch.20suffix.html#257805084">(Oct 16 2021 at 05:55)</a>:</h4>
<p>I would just want it to format the one the user used.</p>



<a name="257806610"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/.match%20suffix/near/257806610" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Lokathor <a href="https://zulip-archive.rust-lang.org/stream/213817-t-lang/topic/.2Ematch.20suffix.html#257806610">(Oct 16 2021 at 06:21)</a>:</h4>
<p>yeah it absolutely shouldn't change the code</p>



<a name="258233893"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/.match%20suffix/near/258233893" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> cuviper <a href="https://zulip-archive.rust-lang.org/stream/213817-t-lang/topic/.2Ematch.20suffix.html#258233893">(Oct 19 2021 at 17:05)</a>:</h4>
<p>so my little parser diff is the easy part -- what actually needs to happen to make this a thing? MCP?</p>



<a name="258234027"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/.match%20suffix/near/258234027" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/213817-t-lang/topic/.2Ematch.20suffix.html#258234027">(Oct 19 2021 at 17:06)</a>:</h4>
<p>Yes, this seems like an initiative to me</p>



<a name="258251952"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/.match%20suffix/near/258251952" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Triplett <a href="https://zulip-archive.rust-lang.org/stream/213817-t-lang/topic/.2Ematch.20suffix.html#258251952">(Oct 19 2021 at 18:51)</a>:</h4>
<p><span aria-label="+1" class="emoji emoji-1f44d" role="img" title="+1">:+1:</span></p>



<a name="258251990"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/.match%20suffix/near/258251990" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Triplett <a href="https://zulip-archive.rust-lang.org/stream/213817-t-lang/topic/.2Ematch.20suffix.html#258251990">(Oct 19 2021 at 18:51)</a>:</h4>
<p>A fairly small initiative, given that the implementation already exists...</p>



<a name="258252012"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/.match%20suffix/near/258252012" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Triplett <a href="https://zulip-archive.rust-lang.org/stream/213817-t-lang/topic/.2Ematch.20suffix.html#258252012">(Oct 19 2021 at 18:51)</a>:</h4>
<p>The tests may end up being larger than the implementation.</p>



<a name="258263997"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/.match%20suffix/near/258263997" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> cuviper <a href="https://zulip-archive.rust-lang.org/stream/213817-t-lang/topic/.2Ematch.20suffix.html#258263997">(Oct 19 2021 at 20:12)</a>:</h4>
<p>I guess it will need some unstable boilerplate too</p>



<a name="258267557"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/.match%20suffix/near/258267557" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Triplett <a href="https://zulip-archive.rust-lang.org/stream/213817-t-lang/topic/.2Ematch.20suffix.html#258267557">(Oct 19 2021 at 20:37)</a>:</h4>
<p>True; it needs a feature flag.</p>



<a name="258267637"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/.match%20suffix/near/258267637" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Triplett <a href="https://zulip-archive.rust-lang.org/stream/213817-t-lang/topic/.2Ematch.20suffix.html#258267637">(Oct 19 2021 at 20:37)</a>:</h4>
<p><code>#![feature(postfix_match)]</code> ?</p>



<a name="258267657"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/.match%20suffix/near/258267657" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> cuviper <a href="https://zulip-archive.rust-lang.org/stream/213817-t-lang/topic/.2Ematch.20suffix.html#258267657">(Oct 19 2021 at 20:37)</a>:</h4>
<p>Sure</p>



<a name="258268900"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/.match%20suffix/near/258268900" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> lqd <a href="https://zulip-archive.rust-lang.org/stream/213817-t-lang/topic/.2Ematch.20suffix.html#258268900">(Oct 19 2021 at 20:45)</a>:</h4>
<p>(IIRC unstable syntax also needs to collect and use "gated spans" to prevent accidental stabilization)</p>



<a name="258315230"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/.match%20suffix/near/258315230" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> scottmcm <a href="https://zulip-archive.rust-lang.org/stream/213817-t-lang/topic/.2Ematch.20suffix.html#258315230">(Oct 20 2021 at 05:40)</a>:</h4>
<p>(Yeah, I don't know how it's implemented, but something to keep it from being parsed under <code>#[cfg(false)]</code>.)</p>



<a name="258320076"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/.match%20suffix/near/258320076" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> lqd <a href="https://zulip-archive.rust-lang.org/stream/213817-t-lang/topic/.2Ematch.20suffix.html#258320076">(Oct 20 2021 at 06:49)</a>:</h4>
<p>it may have changed since then but here’s an example collecting gated spans from parsing const generic defaults <a href="https://github.com/rust-lang/rust/pull/80547/commits/942b7ce2c14b1c4fde5b9f27aa5bef39e0b990d5">https://github.com/rust-lang/rust/pull/80547/commits/942b7ce2c14b1c4fde5b9f27aa5bef39e0b990d5</a></p>



<a name="258404994"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/.match%20suffix/near/258404994" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> cuviper <a href="https://zulip-archive.rust-lang.org/stream/213817-t-lang/topic/.2Ematch.20suffix.html#258404994">(Oct 20 2021 at 17:05)</a>:</h4>
<p>thanks for the example -- seems like it just needs to be gated in the parser and not a later AST pass</p>



<a name="258405100"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/.match%20suffix/near/258405100" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Triplett <a href="https://zulip-archive.rust-lang.org/stream/213817-t-lang/topic/.2Ematch.20suffix.html#258405100">(Oct 20 2021 at 17:06)</a>:</h4>
<p>Right, because in a later AST pass it should be indistinguishable.</p>



<a name="258406276"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/.match%20suffix/near/258406276" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> cuviper <a href="https://zulip-archive.rust-lang.org/stream/213817-t-lang/topic/.2Ematch.20suffix.html#258406276">(Oct 20 2021 at 17:13)</a>:</h4>
<p>well, yeah, in this case I'm giving it the same kind. other new syntax might have more possible gating points.</p>



<a name="258407131"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/.match%20suffix/near/258407131" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Taylor Cramer <a href="https://zulip-archive.rust-lang.org/stream/213817-t-lang/topic/.2Ematch.20suffix.html#258407131">(Oct 20 2021 at 17:18)</a>:</h4>
<blockquote>
<p>in a later AST pass it should be indistinguishable</p>
</blockquote>
<p>Presumably you'd have to save which syntax was used so that you can e.g. pretty print correctly later on</p>



<a name="258441092"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/.match%20suffix/near/258441092" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/213817-t-lang/topic/.2Ematch.20suffix.html#258441092">(Oct 20 2021 at 20:44)</a>:</h4>
<p><span class="user-mention silent" data-user-id="239881">Josh Triplett</span> <a href="#narrow/stream/213817-t-lang/topic/.2Ematch.20suffix/near/258251990">said</a>:</p>
<blockquote>
<p>A fairly small initiative, given that the implementation already exists...</p>
</blockquote>
<p>well, there's an RFC to be written :)</p>



<a name="258441142"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/.match%20suffix/near/258441142" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/213817-t-lang/topic/.2Ematch.20suffix.html#258441142">(Oct 20 2021 at 20:44)</a>:</h4>
<p>and some kind of guidelines to be given about when this makes sense</p>



<a name="258441169"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/.match%20suffix/near/258441169" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/213817-t-lang/topic/.2Ematch.20suffix.html#258441169">(Oct 20 2021 at 20:45)</a>:</h4>
<p>(I think we mostly hit upon them in this zulip discussion though)</p>



<hr><p>Last updated: Apr 12 2022 at 20:01 UTC</p>
</html>