<html>
<head><meta charset="utf-8"><title>`yeet` in a dozen lines · t-lang · Zulip Chat Archive</title></head>
<h2>Stream: <a href="https://zulip-archive.rust-lang.org/stream/213817-t-lang/index.html">t-lang</a></h2>
<h3>Topic: <a href="https://zulip-archive.rust-lang.org/stream/213817-t-lang/topic/.60yeet.60.20in.20a.20dozen.20lines.html">`yeet` in a dozen lines</a></h3>

<hr>

<base href="https://rust-lang.zulipchat.com">

<head><link href="https://zulip-archive.rust-lang.org/style.css" rel="stylesheet"></head>

<a name="263748817"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/%60yeet%60%20in%20a%20dozen%20lines/near/263748817" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> scottmcm <a href="https://zulip-archive.rust-lang.org/stream/213817-t-lang/topic/.60yeet.60.20in.20a.20dozen.20lines.html#263748817">(Dec 05 2021 at 04:28)</a>:</h4>
<p>As I'm back to <a href="https://github.com/rust-lang/rust/pull/91286">futzing with <code>Try</code></a>, I figured I'd start this conversation up again.</p>
<p>A yeet is the canonical thing that is its own residual.  It's the dual of the <a href="https://github.com/rust-lang/rust/blob/5e93f6e318e687c05c8c44517de4586ed75ce3f4/library/core/src/ops/try_trait.rs#L370"><code>NeverShortCircuit</code></a> type.  That's about a dozen lines:</p>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="cp">#[derive(Debug, Eq, PartialEq)]</span><span class="w"></span>
<span class="k">struct</span> <span class="nc">Yeet</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;</span><span class="p">(</span><span class="n">T</span><span class="p">);</span><span class="w"></span>
<span class="k">const</span><span class="w"> </span><span class="n">YEET</span>: <span class="nc">Yeet</span><span class="o">&lt;</span><span class="p">()</span><span class="o">&gt;</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Yeet</span><span class="p">(());</span><span class="w"></span>

<span class="k">impl</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;</span><span class="w"> </span><span class="n">Try</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="n">Yeet</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="k">type</span> <span class="nc">Output</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">!</span><span class="p">;</span><span class="w"></span>
<span class="w">    </span><span class="k">type</span> <span class="nc">Residual</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="bp">Self</span><span class="p">;</span><span class="w"></span>
<span class="w">    </span><span class="k">fn</span> <span class="nf">branch</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span><span class="w"> </span>-&gt; <span class="nc">ControlFlow</span><span class="o">&lt;</span><span class="bp">Self</span><span class="p">,</span><span class="w"> </span><span class="o">!&gt;</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">ControlFlow</span>::<span class="n">Break</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span><span class="w"> </span><span class="p">}</span><span class="w"></span>
<span class="w">    </span><span class="k">fn</span> <span class="nf">from_output</span><span class="p">(</span><span class="n">never</span>: <span class="o">!</span><span class="p">)</span><span class="w"> </span>-&gt; <span class="nc">Self</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">never</span><span class="w"> </span><span class="p">}</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>

<span class="k">impl</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;</span><span class="w"> </span><span class="n">FromResidual</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="n">Yeet</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="k">fn</span> <span class="nf">from_residual</span><span class="p">(</span><span class="n">r</span>: <span class="nc">Self</span><span class="p">)</span><span class="w"> </span>-&gt; <span class="nc">Self</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">r</span><span class="w"> </span><span class="p">}</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>
</code></pre></div>
<p>Add a few <code>FromResult&lt;Yeet&lt;_&gt;&gt;</code> impls for results and options and you get this working:</p>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="k">pub</span><span class="w"> </span><span class="k">fn</span> <span class="nf">my_checked_div</span><span class="p">(</span><span class="n">x</span>: <span class="kt">u32</span><span class="p">,</span><span class="w"> </span><span class="n">y</span>: <span class="kt">u32</span><span class="p">)</span><span class="w"> </span>-&gt; <span class="nb">Option</span><span class="o">&lt;</span><span class="kt">u32</span><span class="o">&gt;</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="kr">try</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="n">y</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">YEET</span><span class="o">?</span><span class="w"> </span><span class="p">}</span><span class="w"></span>
<span class="w">        </span><span class="n">x</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="n">y</span><span class="w"></span>
<span class="w">    </span><span class="p">}</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>

<span class="k">pub</span><span class="w"> </span><span class="k">fn</span> <span class="nf">my_try_into</span><span class="p">(</span><span class="n">x</span>: <span class="kt">u32</span><span class="p">)</span><span class="w"> </span>-&gt; <span class="nb">Result</span><span class="o">&lt;</span><span class="kt">u8</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;'</span><span class="nb">static</span><span class="w"> </span><span class="kt">str</span><span class="o">&gt;</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="kr">try</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="n">x</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="kt">u32</span>::<span class="n">from</span><span class="p">(</span><span class="kt">u8</span>::<span class="n">MAX</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">Yeet</span><span class="p">(</span><span class="s">"naw"</span><span class="p">)</span><span class="o">?</span><span class="w"> </span><span class="p">}</span><span class="w"></span>
<span class="w">        </span><span class="n">x</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="n">_</span><span class="w"></span>
<span class="w">    </span><span class="p">}</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>
</code></pre></div>
<p>Full playground demo: &lt;<a href="https://play.rust-lang.org/?version=nightly&amp;mode=debug&amp;edition=2021&amp;gist=3d8c1e4513e5fada5da2f9aff9c36e41">https://play.rust-lang.org/?version=nightly&amp;mode=debug&amp;edition=2021&amp;gist=3d8c1e4513e5fada5da2f9aff9c36e41</a>&gt; (With local versions of option and result because coherence)</p>
<p>Thoughts?  Are these the semantics you'd expect?  Does this working oddly well without parser support scare or excite you?</p>
<p>cc <code>yeet</code> aficionados <span class="user-mention" data-user-id="239881">@Josh Triplett</span> <span class="user-mention" data-user-id="246502">@Jake Vossen</span> <span class="user-mention" data-user-id="326176">@Boxy [she/her]</span> <span class="user-mention" data-user-id="220273">@Jane Lusby [she/her]</span></p>



<a name="263752160"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/%60yeet%60%20in%20a%20dozen%20lines/near/263752160" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Triplett <a href="https://zulip-archive.rust-lang.org/stream/213817-t-lang/topic/.60yeet.60.20in.20a.20dozen.20lines.html#263752160">(Dec 05 2021 at 06:08)</a>:</h4>
<p>My first thought is that something has gone very right with my career to this point to be referred to as a "<code>yeet</code> afficionado".</p>



<a name="263752211"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/%60yeet%60%20in%20a%20dozen%20lines/near/263752211" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Triplett <a href="https://zulip-archive.rust-lang.org/stream/213817-t-lang/topic/.60yeet.60.20in.20a.20dozen.20lines.html#263752211">(Dec 05 2021 at 06:10)</a>:</h4>
<blockquote>
<p>Does this working oddly well without parser support scare or excite you?</p>
</blockquote>
<p>Honestly, it feels a lot like <code>Err(e)?</code>, which I use all the time.</p>



<a name="263752232"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/%60yeet%60%20in%20a%20dozen%20lines/near/263752232" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Triplett <a href="https://zulip-archive.rust-lang.org/stream/213817-t-lang/topic/.60yeet.60.20in.20a.20dozen.20lines.html#263752232">(Dec 05 2021 at 06:11)</a>:</h4>
<p>It's <em>impressive</em>, and in particular it's impressive that it works for multiple kinds of return values. But I don't think it lessens the desire for <code>yeet e;</code>.</p>



<a name="263765516"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/%60yeet%60%20in%20a%20dozen%20lines/near/263765516" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Daniel Henry-Mantilla <a href="https://zulip-archive.rust-lang.org/stream/213817-t-lang/topic/.60yeet.60.20in.20a.20dozen.20lines.html#263765516">(Dec 05 2021 at 12:14)</a>:</h4>
<p><code>FromResidual</code> is such a nice abstraction; it's nice seeing hoe many things we can do with it (this reminds me of <code>Poll::ready</code>).</p>
<p>Speaking of which, though, this is the second time, together with <code>Poll::ready?</code>, that having <code>from_output</code> and <code>.branch()</code> be in the same trait feels a bit over-restrictive / out of place for these things to implement <code>FromResidual</code> and <code>from_output</code>: <strong>we don't expect to have <code>try</code> blocks or functions of a <code>task::Ready</code> or <code>Yeet</code> type, do we?</strong> What we want is for both of these things to be <code>.branch</code>able, and for the outer <code>Try</code> type to be <code>FromResidual</code>-compatible.</p>



<a name="263786704"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/%60yeet%60%20in%20a%20dozen%20lines/near/263786704" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> scottmcm <a href="https://zulip-archive.rust-lang.org/stream/213817-t-lang/topic/.60yeet.60.20in.20a.20dozen.20lines.html#263786704">(Dec 05 2021 at 20:14)</a>:</h4>
<p><code>fn main() -&gt; Yeet&lt;E&gt;</code> is pretty similar to <code>fn main() -&gt; Result&lt;!, E&gt;</code>, so it's not totally implausible.  It very clearly communicates "hey, the only way this exits is by <code>yeet</code>ing".</p>



<a name="263812489"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/%60yeet%60%20in%20a%20dozen%20lines/near/263812489" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Daniel Henry-Mantilla <a href="https://zulip-archive.rust-lang.org/stream/213817-t-lang/topic/.60yeet.60.20in.20a.20dozen.20lines.html#263812489">(Dec 06 2021 at 06:19)</a>:</h4>
<p>Heh, I do remember having used <code>type None = Option&lt;!&gt;;</code> and a <code>-&gt; None</code> function once when I was in a loop with checked ops and the <code>?</code> in there being he only way to exit it <span aria-label="upside down" class="emoji emoji-1f643" role="img" title="upside down">:upside_down:</span></p>



<a name="263815744"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/%60yeet%60%20in%20a%20dozen%20lines/near/263815744" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> scottmcm <a href="https://zulip-archive.rust-lang.org/stream/213817-t-lang/topic/.60yeet.60.20in.20a.20dozen.20lines.html#263815744">(Dec 06 2021 at 07:28)</a>:</h4>
<p>I'm not actually opposed conceptually to splitting the traits, BTW -- I've just never found a structure of doing so that I really like.  (See <a href="https://rust-lang.github.io/rfcs/3058-try-trait-v2.html#splitting-up-try-more">https://rust-lang.github.io/rfcs/3058-try-trait-v2.html#splitting-up-try-more</a> -- ending up at 4 different traits and a trait alias to keep all the things I like about the current version doesn't make me excited.)</p>
<p>Because of that, I'm generally willing to accept "well, it's not going to be common but at least its meaning is reasonable" as enough to keep something from being evidence for the split being <em>needed</em>.  Not having a good way of doing the split (yet?) means I'm looking more for "oh, no, that's just bad" or "it blocks this particular scenario from working" to say we should split it up.</p>



<a name="263815858"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/%60yeet%60%20in%20a%20dozen%20lines/near/263815858" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> scottmcm <a href="https://zulip-archive.rust-lang.org/stream/213817-t-lang/topic/.60yeet.60.20in.20a.20dozen.20lines.html#263815858">(Dec 06 2021 at 07:30)</a>:</h4>
<p>And yeah, <code>loop{}</code> with <code>?</code> is surprisingly handy -- it works wonderfully in implementing <code>Iterator::next</code>, for example.</p>



<hr><p>Last updated: Apr 12 2022 at 20:01 UTC</p>
</html>