<html>
<head><meta charset="utf-8"><title>Convenient `into` syntax [was: try blocks] · t-lang · Zulip Chat Archive</title></head>
<h2>Stream: <a href="https://zulip-archive.rust-lang.org/stream/213817-t-lang/index.html">t-lang</a></h2>
<h3>Topic: <a href="https://zulip-archive.rust-lang.org/stream/213817-t-lang/topic/Convenient.20.60into.60.20syntax.20.5Bwas.3A.20try.20blocks.5D.html">Convenient `into` syntax [was: try blocks]</a></h3>

<hr>

<base href="https://rust-lang.zulipchat.com">

<head><link href="https://zulip-archive.rust-lang.org/style.css" rel="stylesheet"></head>

<a name="276132572"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/Convenient%20%60into%60%20syntax%20%5Bwas%3A%20try%20blocks%5D/near/276132572" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> scottmcm <a href="https://zulip-archive.rust-lang.org/stream/213817-t-lang/topic/Convenient.20.60into.60.20syntax.20.5Bwas.3A.20try.20blocks.5D.html#276132572">(Mar 22 2022 at 00:59)</a>:</h4>
<p><span class="user-mention silent" data-user-id="256342">bstrie</span> <a href="#narrow/stream/213817-t-lang/topic/Convenient.20.60into.60.20syntax.20.5Bwas.3A.20try.20blocks.5D/near/276118998">said</a>:</p>
<blockquote>
<p>overloadable <code>as</code> :P</p>
</blockquote>
<p>I'm not sure whether the ":P" implies that's a joke, but I think that could be it somewhat seriously in 2 editions from now.</p>
<p>2024 we remove all the weird things from <code>as</code>; 2027 we have <code>x as T</code> be sugar for <code>&lt;_ as Into&lt;T&gt;&gt;::into(x)</code>.</p>



<a name="276134419"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/Convenient%20%60into%60%20syntax%20%5Bwas%3A%20try%20blocks%5D/near/276134419" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jane Lusby [she/her] <a href="https://zulip-archive.rust-lang.org/stream/213817-t-lang/topic/Convenient.20.60into.60.20syntax.20.5Bwas.3A.20try.20blocks.5D.html#276134419">(Mar 22 2022 at 01:38)</a>:</h4>
<p>prior art: <a href="https://docs.rs/tap/latest/tap/conv/index.html">https://docs.rs/tap/latest/tap/conv/index.html</a></p>



<a name="276138019"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/Convenient%20%60into%60%20syntax%20%5Bwas%3A%20try%20blocks%5D/near/276138019" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jacob Pratt <a href="https://zulip-archive.rust-lang.org/stream/213817-t-lang/topic/Convenient.20.60into.60.20syntax.20.5Bwas.3A.20try.20blocks.5D.html#276138019">(Mar 22 2022 at 02:50)</a>:</h4>
<p>Removing <code>as</code> weirdness sure (let's not digress a second time), but I'm not sure how I feel about changing <code>as</code> to be sugar for <code>.into()</code>. Almost feels <em>too</em> magical.</p>



<a name="276139518"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/Convenient%20%60into%60%20syntax%20%5Bwas%3A%20try%20blocks%5D/near/276139518" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> scottmcm <a href="https://zulip-archive.rust-lang.org/stream/213817-t-lang/topic/Convenient.20.60into.60.20syntax.20.5Bwas.3A.20try.20blocks.5D.html#276139518">(Mar 22 2022 at 03:20)</a>:</h4>
<p><span class="user-mention silent" data-user-id="245610">Jacob Pratt</span> <a href="#narrow/stream/213817-t-lang/topic/Convenient.20.60into.60.20syntax.20.5Bwas.3A.20try.20blocks.5D/near/276138019">said</a>:</p>
<blockquote>
<p>Almost feels <em>too</em> magical.</p>
</blockquote>
<p>Can you elaborate on how?  Doesn't seem more magical than <code>x[i]</code> becoming <code>*x.index_mut(i)</code>, to me.</p>



<a name="276144283"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/Convenient%20%60into%60%20syntax%20%5Bwas%3A%20try%20blocks%5D/near/276144283" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jacob Pratt <a href="https://zulip-archive.rust-lang.org/stream/213817-t-lang/topic/Convenient.20.60into.60.20syntax.20.5Bwas.3A.20try.20blocks.5D.html#276144283">(Mar 22 2022 at 05:07)</a>:</h4>
<p>Difficult to articulate. Probably that I'm used to <code>as</code> being free, while <code>.into()</code> can have some expense. I suppose in theory implementing <code>Index</code> could have cost as well, but I presume that's generally not the case.</p>



<a name="276146684"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/Convenient%20%60into%60%20syntax%20%5Bwas%3A%20try%20blocks%5D/near/276146684" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> scottmcm <a href="https://zulip-archive.rust-lang.org/stream/213817-t-lang/topic/Convenient.20.60into.60.20syntax.20.5Bwas.3A.20try.20blocks.5D.html#276146684">(Mar 22 2022 at 06:00)</a>:</h4>
<p>I suppose there <em>are</em> a bunch of <code>From</code>s I'm not a fan of where I'd also not really like them in <code>as</code>.  But I don't really like those in <code>.into()</code> either, so I don't know if it'd be materially worse with <code>as</code>.</p>



<a name="276190368"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/Convenient%20%60into%60%20syntax%20%5Bwas%3A%20try%20blocks%5D/near/276190368" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> bstrie <a href="https://zulip-archive.rust-lang.org/stream/213817-t-lang/topic/Convenient.20.60into.60.20syntax.20.5Bwas.3A.20try.20blocks.5D.html#276190368">(Mar 22 2022 at 13:45)</a>:</h4>
<p>I was sort of half-joking, as it would be a lot of effort to remove the existing <code>as</code> casts, and it's unclear how users would receive that (particularly wrt the uncertain solution to the need for excessive integer conversions). It would be <em>kind</em> of nice if it worked, although as mentioned it would require retraining users that <code>as</code> is no longer a free operation and can run arbitrary code. The other downside is that while <code>.into()</code> and <code>.try_into()</code> have some symmetry, <code>as</code> and <code>.try_into()</code> do not... would we have some magic where <code>as Result&lt;...&gt;</code> desugars to <code>.try_into()</code>? (I admit I'm unclear on the arguments as to why TryInto was necessary in the first place as opposed to just having an <code>Into</code> impl that infallibly returns a Result).</p>



<a name="276266824"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/Convenient%20%60into%60%20syntax%20%5Bwas%3A%20try%20blocks%5D/near/276266824" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> RalfJ <a href="https://zulip-archive.rust-lang.org/stream/213817-t-lang/topic/Convenient.20.60into.60.20syntax.20.5Bwas.3A.20try.20blocks.5D.html#276266824">(Mar 22 2022 at 23:10)</a>:</h4>
<p><code>as?</code> for <code>try_into</code>? hm but that's rather different from regular <code>?</code> so probably not...</p>



<a name="276266832"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/Convenient%20%60into%60%20syntax%20%5Bwas%3A%20try%20blocks%5D/near/276266832" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> RalfJ <a href="https://zulip-archive.rust-lang.org/stream/213817-t-lang/topic/Convenient.20.60into.60.20syntax.20.5Bwas.3A.20try.20blocks.5D.html#276266832">(Mar 22 2022 at 23:10)</a>:</h4>
<p><code>as</code> for <code>into</code> makes a lot of sense to me though</p>



<a name="276288245"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/Convenient%20%60into%60%20syntax%20%5Bwas%3A%20try%20blocks%5D/near/276288245" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> David Hewitt <a href="https://zulip-archive.rust-lang.org/stream/213817-t-lang/topic/Convenient.20.60into.60.20syntax.20.5Bwas.3A.20try.20blocks.5D.html#276288245">(Mar 23 2022 at 04:50)</a>:</h4>
<p><code>try x as Bar?</code></p>



<a name="276288277"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/Convenient%20%60into%60%20syntax%20%5Bwas%3A%20try%20blocks%5D/near/276288277" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> David Hewitt <a href="https://zulip-archive.rust-lang.org/stream/213817-t-lang/topic/Convenient.20.60into.60.20syntax.20.5Bwas.3A.20try.20blocks.5D.html#276288277">(Mar 23 2022 at 04:51)</a>:</h4>
<p>Though the placement of <code>?</code> is a bit awkward, it reminds me of why we went for <code>x.await?</code> rather than <code>(await x)?</code></p>



<a name="276288638"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/Convenient%20%60into%60%20syntax%20%5Bwas%3A%20try%20blocks%5D/near/276288638" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> scottmcm <a href="https://zulip-archive.rust-lang.org/stream/213817-t-lang/topic/Convenient.20.60into.60.20syntax.20.5Bwas.3A.20try.20blocks.5D.html#276288638">(Mar 23 2022 at 04:58)</a>:</h4>
<p>Yeah, I've often been sad about <code>as</code> precedence.</p>
<p>Being able to use <code>.cast()</code> on pointers has been a <em>way</em> better experience than <code>as *const U</code></p>



<a name="276290250"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/Convenient%20%60into%60%20syntax%20%5Bwas%3A%20try%20blocks%5D/near/276290250" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Triplett <a href="https://zulip-archive.rust-lang.org/stream/213817-t-lang/topic/Convenient.20.60into.60.20syntax.20.5Bwas.3A.20try.20blocks.5D.html#276290250">(Mar 23 2022 at 05:26)</a>:</h4>
<p>One thing we could do even without requiring an edition would be something like <code>.as&lt;T&gt;()</code>.</p>



<a name="276290284"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/Convenient%20%60into%60%20syntax%20%5Bwas%3A%20try%20blocks%5D/near/276290284" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Triplett <a href="https://zulip-archive.rust-lang.org/stream/213817-t-lang/topic/Convenient.20.60into.60.20syntax.20.5Bwas.3A.20try.20blocks.5D.html#276290284">(Mar 23 2022 at 05:27)</a>:</h4>
<p>Personally, I'd also be happy just writing <code>.into::&lt;T&gt;()</code> and <code>.try_into::&lt;T&gt;()?</code>; we <em>could</em> make those work with a bit of hackery.</p>



<a name="276300241"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/Convenient%20%60into%60%20syntax%20%5Bwas%3A%20try%20blocks%5D/near/276300241" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> David Hewitt <a href="https://zulip-archive.rust-lang.org/stream/213817-t-lang/topic/Convenient.20.60into.60.20syntax.20.5Bwas.3A.20try.20blocks.5D.html#276300241">(Mar 23 2022 at 08:22)</a>:</h4>
<p>The number of times I've written <code>.into::&lt;T&gt;()</code> by mistake, I'd definitely be happy if that was valid!</p>



<a name="276323481"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/Convenient%20%60into%60%20syntax%20%5Bwas%3A%20try%20blocks%5D/near/276323481" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> bstrie <a href="https://zulip-archive.rust-lang.org/stream/213817-t-lang/topic/Convenient.20.60into.60.20syntax.20.5Bwas.3A.20try.20blocks.5D.html#276323481">(Mar 23 2022 at 12:09)</a>:</h4>
<p>or we could have a whole new keyword, <code>foo into Bar</code>, which would be understood as "like <code>as</code>, but user-overloadable". sort of like how Clone is to Copy</p>



<a name="276323565"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/Convenient%20%60into%60%20syntax%20%5Bwas%3A%20try%20blocks%5D/near/276323565" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> bstrie <a href="https://zulip-archive.rust-lang.org/stream/213817-t-lang/topic/Convenient.20.60into.60.20syntax.20.5Bwas.3A.20try.20blocks.5D.html#276323565">(Mar 23 2022 at 12:10)</a>:</h4>
<p>then the safe transmute folks might be able to reuse <code>as</code> themselves</p>



<a name="276336063"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/Convenient%20%60into%60%20syntax%20%5Bwas%3A%20try%20blocks%5D/near/276336063" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Daniel Henry-Mantilla <a href="https://zulip-archive.rust-lang.org/stream/213817-t-lang/topic/Convenient.20.60into.60.20syntax.20.5Bwas.3A.20try.20blocks.5D.html#276336063">(Mar 23 2022 at 13:53)</a>:</h4>
<p><span class="user-mention silent" data-user-id="239881">Josh Triplett</span> <a href="#narrow/stream/213817-t-lang/topic/Convenient.20.60into.60.20syntax.20.5Bwas.3A.20try.20blocks.5D/near/276290284">said</a>:</p>
<blockquote>
<p>Personally, I'd also be happy just writing <code>.into::&lt;T&gt;()</code> and <code>.try_into::&lt;T&gt;()?</code>; we <em>could</em> make those work with a bit of hackery.</p>
</blockquote>
<p>is the "bit of hackery" detailed somewhere?</p>
<p>I could imagine having an extra prelude trait:</p>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="k">trait</span><span class="w"> </span><span class="n">Turbofish</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="k">fn</span> <span class="nf">into</span><span class="o">&lt;</span><span class="n">Dst</span><span class="o">&gt;</span><span class="w"> </span><span class="p">(</span><span class="bp">self</span>: <span class="nc">Self</span><span class="p">)</span><span class="w"></span>
<span class="w">      </span>-&gt; <span class="nc">Dst</span><span class="w"></span>
<span class="w">    </span><span class="k">where</span><span class="w"></span>
<span class="w">        </span><span class="bp">Self</span><span class="w"> </span>: <span class="nb">Into</span><span class="o">&lt;</span><span class="n">Dst</span><span class="o">&gt;</span><span class="p">,</span><span class="w"></span>
<span class="w">    </span><span class="p">{</span><span class="w"></span>
<span class="w">        </span><span class="k">impl</span><span class="o">&lt;</span><span class="n">T</span><span class="w"> </span>: <span class="o">?</span><span class="nb">Sized</span><span class="o">&gt;</span><span class="w"> </span><span class="n">Turbofish</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="n">T</span><span class="w"> </span><span class="p">{}</span><span class="w"></span>

<span class="w">        </span><span class="nb">Into</span>::<span class="n">into</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span><span class="w"></span>
<span class="w">    </span><span class="p">}</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>
</code></pre></div>
<p>and somehow cheating in method resolution like it already happens with <code>&lt; edition2021</code> Rust code, <code>.into_iter()</code>, and arrays, so as to resolve the ambiguity when calling <code>.into()</code> in favor of <code>Turbofish::into</code>.</p>
<hr>
<p>Another approach, would be to actually have a new <code>Into</code> trait which in a future edition would replace <code>convert::Into</code> <em>w.r.t.</em> the prelude:</p>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="k">trait</span><span class="w"> </span><span class="nb">Into</span><span class="o">&lt;</span><span class="n">Dst</span><span class="o">&gt;</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="k">fn</span> <span class="nf">into</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;</span><span class="w"> </span><span class="p">(</span><span class="bp">self</span>: <span class="nc">Self</span><span class="p">)</span><span class="w"></span>
<span class="w">      </span>-&gt; <span class="nc">Dst</span><span class="w"></span>
<span class="w">    </span><span class="k">where</span><span class="w"></span>
<span class="w">        </span><span class="c1">// Both directions are required for type inference to behave.</span>
<span class="w">        </span><span class="n">T</span><span class="w"> </span>: <span class="nc">Is</span><span class="o">&lt;</span><span class="n">EqTo</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Dst</span><span class="o">&gt;</span><span class="p">,</span><span class="w"></span>
<span class="w">        </span><span class="n">Dst</span><span class="w"> </span>: <span class="nc">Is</span><span class="o">&lt;</span><span class="n">EqTo</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">T</span><span class="o">&gt;</span><span class="p">,</span><span class="w"></span>
<span class="w">    </span><span class="p">;</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>
</code></pre></div>
<ul>
<li>where <code>trait Is { type EqTo : ?Sized; } impl&lt;T : ?Sized&gt; Is for T { type EqTo = Self; }</code> is the usual workaround for the "no direct type equality bounds" restriction.</li>
</ul>
<p>but then the difficulty/annoyance would be code with explicit <code>impl Into</code> that would have to amend the trait path:</p>
<div class="codehilite" data-code-language="Diff"><pre><span></span><code><span class="w"> </span> /* cargo fix */<span class="w"></span>
<span class="gd">- impl Into&lt;Foo&gt; for Bar {</span><span class="w"></span>
<span class="gi">+ impl core::convert::Into&lt;Foo&gt; for Bar {</span><span class="w"></span>
</code></pre></div>
<p>given that that's something which <code>cargo fix</code> could take care of / the compiler could suggest, maybe that's not <em>that</em> bad? Since <code>.into()</code> use sites greatly outnumber explicit <code>Into</code> impls, it seems like a decent tradeoff needing no compiler hacks, just good old edition/prelude + blanket impl dance.</p>
<ul>
<li><a href="https://play.rust-lang.org/?version=stable&amp;mode=debug&amp;edition=2021&amp;gist=4a25f05c1c5ed53ff5c0bd2fe015bcd0">Demo</a></li>
</ul>



<a name="276338790"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/Convenient%20%60into%60%20syntax%20%5Bwas%3A%20try%20blocks%5D/near/276338790" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> bstrie <a href="https://zulip-archive.rust-lang.org/stream/213817-t-lang/topic/Convenient.20.60into.60.20syntax.20.5Bwas.3A.20try.20blocks.5D.html#276338790">(Mar 23 2022 at 14:12)</a>:</h4>
<p>if we're going to have a magical solution anyway, then we can surely do better than forcing users to use the turbofish :P</p>



<a name="276339237"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/Convenient%20%60into%60%20syntax%20%5Bwas%3A%20try%20blocks%5D/near/276339237" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Daniel Henry-Mantilla <a href="https://zulip-archive.rust-lang.org/stream/213817-t-lang/topic/Convenient.20.60into.60.20syntax.20.5Bwas.3A.20try.20blocks.5D.html#276339237">(Mar 23 2022 at 14:16)</a>:</h4>
<p><span class="user-mention" data-user-id="256342">@bstrie</span> if you mean at call-sites, know that neither suggestion I've made forces users to use the turbofish: they ought to work the same <em>w.r.t</em> type inference.<br>
<del>It may just break code that currently would be doing <code>.into::&lt;&gt;()</code> —empty turbofish is a thing—, since with the change that would be a generic param mismatch <span aria-label="sweat smile" class="emoji emoji-1f605" role="img" title="sweat smile">:sweat_smile:</span></del> Actually, I misremembered: empty turbofish in the value realm stands for "infer all the generics" so <code>::&lt;&gt;</code> would still work with the suggested traits <span aria-label="laughing" class="emoji emoji-1f606" role="img" title="laughing">:laughing:</span> </p>
<p>They'd only be forced to somehow change the <code>impl Into</code> blocks, unless compiler magic were to occur (and I personally think such a small inconvenience does not warrant compiler-code burden)</p>



<a name="276340133"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/Convenient%20%60into%60%20syntax%20%5Bwas%3A%20try%20blocks%5D/near/276340133" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> bstrie <a href="https://zulip-archive.rust-lang.org/stream/213817-t-lang/topic/Convenient.20.60into.60.20syntax.20.5Bwas.3A.20try.20blocks.5D.html#276340133">(Mar 23 2022 at 14:22)</a>:</h4>
<p>ok, good to know that the intent is to still allow type inference :)</p>



<a name="276349781"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/Convenient%20%60into%60%20syntax%20%5Bwas%3A%20try%20blocks%5D/near/276349781" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Triplett <a href="https://zulip-archive.rust-lang.org/stream/213817-t-lang/topic/Convenient.20.60into.60.20syntax.20.5Bwas.3A.20try.20blocks.5D.html#276349781">(Mar 23 2022 at 15:23)</a>:</h4>
<p>The hack I was imagining was an attribute on <code>into</code> that tells the compiler what to do with a type argument on it.</p>



<a name="276349990"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/Convenient%20%60into%60%20syntax%20%5Bwas%3A%20try%20blocks%5D/near/276349990" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Triplett <a href="https://zulip-archive.rust-lang.org/stream/213817-t-lang/topic/Convenient.20.60into.60.20syntax.20.5Bwas.3A.20try.20blocks.5D.html#276349990">(Mar 23 2022 at 15:24)</a>:</h4>
<p>Effectively, "treat a type argument on this as if it were a constraint on the return value".</p>



<a name="276351967"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/Convenient%20%60into%60%20syntax%20%5Bwas%3A%20try%20blocks%5D/near/276351967" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Tavian Barnes <a href="https://zulip-archive.rust-lang.org/stream/213817-t-lang/topic/Convenient.20.60into.60.20syntax.20.5Bwas.3A.20try.20blocks.5D.html#276351967">(Mar 23 2022 at 15:37)</a>:</h4>
<p>Would type ascription work for this?  <code>x.into() : u32</code></p>



<a name="276354532"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/Convenient%20%60into%60%20syntax%20%5Bwas%3A%20try%20blocks%5D/near/276354532" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> bstrie <a href="https://zulip-archive.rust-lang.org/stream/213817-t-lang/topic/Convenient.20.60into.60.20syntax.20.5Bwas.3A.20try.20blocks.5D.html#276354532">(Mar 23 2022 at 15:54)</a>:</h4>
<p>I believe it would, but type ascription has been in-progress since 2014...</p>



<a name="276360714"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/Convenient%20%60into%60%20syntax%20%5Bwas%3A%20try%20blocks%5D/near/276360714" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> scottmcm <a href="https://zulip-archive.rust-lang.org/stream/213817-t-lang/topic/Convenient.20.60into.60.20syntax.20.5Bwas.3A.20try.20blocks.5D.html#276360714">(Mar 23 2022 at 16:26)</a>:</h4>
<p>One part of the problem there has been syntax, but if <code>as</code> is no longer casts (because we have functions for those cases instead) then <em>it</em> could become the ascription syntax, which might be interesting.</p>



<a name="276361678"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/Convenient%20%60into%60%20syntax%20%5Bwas%3A%20try%20blocks%5D/near/276361678" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> bstrie <a href="https://zulip-archive.rust-lang.org/stream/213817-t-lang/topic/Convenient.20.60into.60.20syntax.20.5Bwas.3A.20try.20blocks.5D.html#276361678">(Mar 23 2022 at 16:31)</a>:</h4>
<p>I was going to say it might be hard to get rid of <em>all</em> <code>as</code> casts, but I guess you could re-frame anything left over as coercion, e.g. dyn coercion, which fits both the mental model for <code>as</code> and for type ascription</p>



<a name="276363064"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/Convenient%20%60into%60%20syntax%20%5Bwas%3A%20try%20blocks%5D/near/276363064" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ben Kimock (Saethlin) <a href="https://zulip-archive.rust-lang.org/stream/213817-t-lang/topic/Convenient.20.60into.60.20syntax.20.5Bwas.3A.20try.20blocks.5D.html#276363064">(Mar 23 2022 at 16:39)</a>:</h4>
<p>I'll admit I haven't been following every message in this conversation but</p>
<ol>
<li>I'm afraid of type ascription because of how often the compiler used to misdiagnose common typos as incorrect type ascription</li>
<li>I'm afraid of adding more coercion because what we have already leads to constructs which don't compile in some contexts compiling in others but being UB according to Stacked Borrows, due to coercion.</li>
</ol>



<a name="276364982"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/Convenient%20%60into%60%20syntax%20%5Bwas%3A%20try%20blocks%5D/near/276364982" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> bstrie <a href="https://zulip-archive.rust-lang.org/stream/213817-t-lang/topic/Convenient.20.60into.60.20syntax.20.5Bwas.3A.20try.20blocks.5D.html#276364982">(Mar 23 2022 at 16:50)</a>:</h4>
<p>In any case this is very far away, we need to actually have a plan for getting rid of the current <code>as</code> casts first, which is going to be a large task.</p>



<a name="276453193"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/Convenient%20%60into%60%20syntax%20%5Bwas%3A%20try%20blocks%5D/near/276453193" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Nick Cameron <a href="https://zulip-archive.rust-lang.org/stream/213817-t-lang/topic/Convenient.20.60into.60.20syntax.20.5Bwas.3A.20try.20blocks.5D.html#276453193">(Mar 24 2022 at 10:03)</a>:</h4>
<p>I would love for the lang team to have a roadmap for what is happening with casting, coercion, and type ascription. I use the latter in most of my projects and would love for it to get stabilised, but more importantly, I feel like the uncertainty here is holding up design work (or even feasiblity discussions) on all sorts of language features.</p>



<a name="276453270"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/Convenient%20%60into%60%20syntax%20%5Bwas%3A%20try%20blocks%5D/near/276453270" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Nick Cameron <a href="https://zulip-archive.rust-lang.org/stream/213817-t-lang/topic/Convenient.20.60into.60.20syntax.20.5Bwas.3A.20try.20blocks.5D.html#276453270">(Mar 24 2022 at 10:04)</a>:</h4>
<p>And by roadmap, I don't mean a full plan, I just mean a direction, really</p>



<a name="276454725"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/Convenient%20%60into%60%20syntax%20%5Bwas%3A%20try%20blocks%5D/near/276454725" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Nick Cameron <a href="https://zulip-archive.rust-lang.org/stream/213817-t-lang/topic/Convenient.20.60into.60.20syntax.20.5Bwas.3A.20try.20blocks.5D.html#276454725">(Mar 24 2022 at 10:18)</a>:</h4>
<p>One source of friction with <code>into</code> is that there is an ergonomic cliff with <code>?</code>. I have found multiple times that I want that implicit <code>into</code> on the error, without the whole <code>?</code> behaviour.</p>



<a name="276455025"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/Convenient%20%60into%60%20syntax%20%5Bwas%3A%20try%20blocks%5D/near/276455025" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Nick Cameron <a href="https://zulip-archive.rust-lang.org/stream/213817-t-lang/topic/Convenient.20.60into.60.20syntax.20.5Bwas.3A.20try.20blocks.5D.html#276455025">(Mar 24 2022 at 10:21)</a>:</h4>
<p>Another rough edge I see in Rust is functions which take <code>impl Into&lt;Foo&gt;</code> or especially <code>impl Into&lt;Option&lt;Foo&gt;&gt;</code> as argument types, the latter as a work around for optional arguments. I think if <code>into</code> were as  easy as it should be we wouldn't need these things because the conversion would be done at the call site which would make the conversion explicit to the caller (but in an unobtrusive way) and the signature of the callee clearer</p>



<a name="276455053"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/Convenient%20%60into%60%20syntax%20%5Bwas%3A%20try%20blocks%5D/near/276455053" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Nick Cameron <a href="https://zulip-archive.rust-lang.org/stream/213817-t-lang/topic/Convenient.20.60into.60.20syntax.20.5Bwas.3A.20try.20blocks.5D.html#276455053">(Mar 24 2022 at 10:21)</a>:</h4>
<p>I think that would need a sigil-level of ease of use though</p>



<a name="276557399"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/Convenient%20%60into%60%20syntax%20%5Bwas%3A%20try%20blocks%5D/near/276557399" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jubilee <a href="https://zulip-archive.rust-lang.org/stream/213817-t-lang/topic/Convenient.20.60into.60.20syntax.20.5Bwas.3A.20try.20blocks.5D.html#276557399">(Mar 25 2022 at 00:28)</a>:</h4>
<p><span class="user-mention silent" data-user-id="256841">Nick Cameron</span> <a href="#narrow/stream/213817-t-lang/topic/Convenient.20.60into.60.20syntax.20.5Bwas.3A.20try.20blocks.5D/near/276453270">said</a>:</p>
<blockquote>
<p>And by roadmap, I don't mean a full plan, I just mean a direction, really</p>
</blockquote>
<p>even just "a map" (as in finding all the graph edges that touch each other) would be nice.</p>



<hr><p>Last updated: Apr 12 2022 at 20:01 UTC</p>
</html>