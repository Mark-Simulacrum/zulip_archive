<html>
<head><meta charset="utf-8"><title>Documenting complicated type system shenanigans · t-lang · Zulip Chat Archive</title></head>
<h2>Stream: <a href="https://zulip-archive.rust-lang.org/stream/213817-t-lang/index.html">t-lang</a></h2>
<h3>Topic: <a href="https://zulip-archive.rust-lang.org/stream/213817-t-lang/topic/Documenting.20complicated.20type.20system.20shenanigans.html">Documenting complicated type system shenanigans</a></h3>

<hr>

<base href="https://rust-lang.zulipchat.com">

<head><link href="https://zulip-archive.rust-lang.org/style.css" rel="stylesheet"></head>

<a name="275122912"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/Documenting%20complicated%20type%20system%20shenanigans/near/275122912" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jake <a href="https://zulip-archive.rust-lang.org/stream/213817-t-lang/topic/Documenting.20complicated.20type.20system.20shenanigans.html#275122912">(Mar 12 2022 at 23:50)</a>:</h4>
<p>I had wanted to bring this up at some point in the past with regards to GATified Iterators, and now <span class="user-mention" data-user-id="125270">@scottmcm</span> also pointed out <a href="https://doc.rust-lang.org/std/iter/trait.Iterator.html#method.try_find">https://doc.rust-lang.org/std/iter/trait.Iterator.html#method.try_find</a> . I think that the appearance of the method signatures of these functions in docs is a thing that we should take seriously. Especially given that "take a look at all the methods that are implemented on <code>Iterator</code>, <code>Option</code>, and <code>Result</code>, you'll need them" is a common piece of advice given to beginners, the clarity of these method signatures gradually degrading as we allow more and more generalization using fancy new APIs and type system tricks is a real problem. The <code>try_find</code> method is a good example of this, but if we have to start adding higher kinded lifetime bounds to make GATs and Iterators play nice, I'm worried about similar looking signatures there.</p>
<p>Maybe this is more of a rustdoc/T-Libs issue than a T-Lang issue (and certainly there are other things involved, like IDEs), but I do think that this needs to be a part of the feature design. I also do have a couple ideas as to how this could be addressed from the documentation PoV, but they're not great. In any case I did at least want to explicitly file a "concern" about this</p>



<a name="275126770"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/Documenting%20complicated%20type%20system%20shenanigans/near/275126770" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> scottmcm <a href="https://zulip-archive.rust-lang.org/stream/213817-t-lang/topic/Documenting.20complicated.20type.20system.20shenanigans.html#275126770">(Mar 13 2022 at 01:40)</a>:</h4>
<p>The return type is particularly bad, I agree.</p>
<p>Interestingly, it's not written that way in the code.  Instead, there's a convenience alias:</p>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="k">fn</span> <span class="nf">try_find</span><span class="o">&lt;</span><span class="n">F</span><span class="p">,</span><span class="w"> </span><span class="n">R</span><span class="o">&gt;</span><span class="p">(</span><span class="o">&amp;</span><span class="k">mut</span><span class="w"> </span><span class="bp">self</span><span class="p">,</span><span class="w"> </span><span class="n">f</span>: <span class="nc">F</span><span class="p">)</span><span class="w"> </span>-&gt; <span class="nc">ChangeOutputType</span><span class="o">&lt;</span><span class="n">R</span><span class="p">,</span><span class="w"> </span><span class="nb">Option</span><span class="o">&lt;</span><span class="bp">Self</span>::<span class="n">Item</span><span class="o">&gt;&gt;</span><span class="w"></span>
</code></pre></div>
<p>That's not public, so it's probably good that it's not shown in the rust doc right now, but it's one possible direction to think about for simplification.</p>
<p>Here's another example: <a href="https://doc.rust-lang.org/std/array/fn.try_from_fn.html">https://doc.rust-lang.org/std/array/fn.try_from_fn.html</a></p>
<p>One lang thing we could consider here would be allowing associated types to be used from traits without forcing the <code>as</code> syntax every time.  At least in places where they're on generic type parameters where the <code>where</code> clauses constrain them to something specific.</p>
<p>Even just simplifying to <code>&lt;R::Residual as Residual&lt;[T::Output; N]&gt;&gt;::TryType</code> would already be way nicer than the version that needs to put <code>as Try&gt;</code> in there twice.</p>



<a name="275144338"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/Documenting%20complicated%20type%20system%20shenanigans/near/275144338" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Nick Cameron <a href="https://zulip-archive.rust-lang.org/stream/213817-t-lang/topic/Documenting.20complicated.20type.20system.20shenanigans.html#275144338">(Mar 13 2022 at 09:45)</a>:</h4>
<p>Couple of things: I think the return type of iterator functions in general is bad, the reader doesn't care about the concrete type they care that they have a iterator over whatever. That is basically the <code>impl Iterator&lt;Item=Foo&gt;</code> type, but even that is a pain to read. I'm not sure if the solution is cleverer docs, better type signatures (using an alias or something?), or a language feature or some combination, but I think it is a problem worth solving since it affects beginners and it affects experienced users who still need to click through a link and mentally substitute type parameters to figure out what a function is doing.</p>



<a name="275144476"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/Documenting%20complicated%20type%20system%20shenanigans/near/275144476" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Nick Cameron <a href="https://zulip-archive.rust-lang.org/stream/213817-t-lang/topic/Documenting.20complicated.20type.20system.20shenanigans.html#275144476">(Mar 13 2022 at 09:48)</a>:</h4>
<p>Second, this is just another downside of adding complexity to the type system which I have been muttering about fairly frequently. Clever features like GATs are nice, but there are big downsides to adding complexity to the language and this is an example of that. I worry we are not taking the downsides of complexity seriously enough when considering new features. We might be able to improve things here (I hope so), but IMO we should implement such mitigations before stabilisation of new features, and we should acknowledge that we can't mitigate everything.</p>



<a name="275144583"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/Documenting%20complicated%20type%20system%20shenanigans/near/275144583" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Nick Cameron <a href="https://zulip-archive.rust-lang.org/stream/213817-t-lang/topic/Documenting.20complicated.20type.20system.20shenanigans.html#275144583">(Mar 13 2022 at 09:51)</a>:</h4>
<p>A third thought, in this particular case, some of the complexity comes from using traits which are mostly meant to be an implementation detail. I wonder if there is some specific backwards encoding we could do here? I doubt we can use <code>?</code> but there might be something smart we can do</p>



<a name="275144644"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/Documenting%20complicated%20type%20system%20shenanigans/near/275144644" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Nick Cameron <a href="https://zulip-archive.rust-lang.org/stream/213817-t-lang/topic/Documenting.20complicated.20type.20system.20shenanigans.html#275144644">(Mar 13 2022 at 09:52)</a>:</h4>
<p>"Interestingly, it's not written that way in the code. Instead, there's a convenience alias:" - the rustdoc team were talking about whether/when to use aliases recently, might be worth discussing this example with them</p>



<a name="275144670"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/Documenting%20complicated%20type%20system%20shenanigans/near/275144670" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Nick Cameron <a href="https://zulip-archive.rust-lang.org/stream/213817-t-lang/topic/Documenting.20complicated.20type.20system.20shenanigans.html#275144670">(Mar 13 2022 at 09:54)</a>:</h4>
<p>I linked from there: <a href="#narrow/stream/266220-rustdoc/topic/To.20alias.20or.20not.20to.20alias">https://rust-lang.zulipchat.com/#narrow/stream/266220-rustdoc/topic/To.20alias.20or.20not.20to.20alias</a></p>



<a name="275150464"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/Documenting%20complicated%20type%20system%20shenanigans/near/275150464" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> bjorn3 <a href="https://zulip-archive.rust-lang.org/stream/213817-t-lang/topic/Documenting.20complicated.20type.20system.20shenanigans.html#275150464">(Mar 13 2022 at 12:16)</a>:</h4>
<p>For <code>impl Iterator&lt;Item=Foo&gt;</code> rustdoc already shows implementations of <code>Iterator</code> and some other types for return values. For example <a href="https://doc.rust-lang.org/stable/std/primitive.array.html#method.into_iter">https://doc.rust-lang.org/stable/std/primitive.array.html#method.into_iter</a> If you click on the i with a circle around it, it shows:</p>
<div class="codehilite"><pre><span></span><code>Notable traits for IterMut&lt;&#39;a, T&gt;

impl&lt;&#39;a, T&gt; Iterator for IterMut&lt;&#39;a, T&gt; type Item = &amp;&#39;a mut T;
</code></pre></div>



<a name="275204797"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/Documenting%20complicated%20type%20system%20shenanigans/near/275204797" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Nick Cameron <a href="https://zulip-archive.rust-lang.org/stream/213817-t-lang/topic/Documenting.20complicated.20type.20system.20shenanigans.html#275204797">(Mar 14 2022 at 08:22)</a>:</h4>
<p>I wonder whether that type should be the primary one? I doubt many beginners click on the i</p>



<a name="275233944"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/Documenting%20complicated%20type%20system%20shenanigans/near/275233944" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ben Kimock (Saethlin) <a href="https://zulip-archive.rust-lang.org/stream/213817-t-lang/topic/Documenting.20complicated.20type.20system.20shenanigans.html#275233944">(Mar 14 2022 at 13:18)</a>:</h4>
<p>You can click on the i????</p>



<a name="275236898"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/Documenting%20complicated%20type%20system%20shenanigans/near/275236898" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> bstrie <a href="https://zulip-archive.rust-lang.org/stream/213817-t-lang/topic/Documenting.20complicated.20type.20system.20shenanigans.html#275236898">(Mar 14 2022 at 13:44)</a>:</h4>
<p>There's an i????</p>



<a name="275239959"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/Documenting%20complicated%20type%20system%20shenanigans/near/275239959" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> cuviper <a href="https://zulip-archive.rust-lang.org/stream/213817-t-lang/topic/Documenting.20complicated.20type.20system.20shenanigans.html#275239959">(Mar 14 2022 at 14:05)</a>:</h4>
<p>aye ℹ️</p>



<a name="275300517"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/Documenting%20complicated%20type%20system%20shenanigans/near/275300517" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/213817-t-lang/topic/Documenting.20complicated.20type.20system.20shenanigans.html#275300517">(Mar 14 2022 at 21:25)</a>:</h4>
<p>I do think it should be the primary one, with the "i" reserved for the details</p>



<a name="275300525"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/Documenting%20complicated%20type%20system%20shenanigans/near/275300525" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/213817-t-lang/topic/Documenting.20complicated.20type.20system.20shenanigans.html#275300525">(Mar 14 2022 at 21:25)</a>:</h4>
<p>I'm glad this is being discussed</p>



<a name="275301418"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/Documenting%20complicated%20type%20system%20shenanigans/near/275301418" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> mejrs <a href="https://zulip-archive.rust-lang.org/stream/213817-t-lang/topic/Documenting.20complicated.20type.20system.20shenanigans.html#275301418">(Mar 14 2022 at 21:34)</a>:</h4>
<p>When you hide information like that the vast majority of readers are not going to see it</p>



<a name="275301888"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/Documenting%20complicated%20type%20system%20shenanigans/near/275301888" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jake <a href="https://zulip-archive.rust-lang.org/stream/213817-t-lang/topic/Documenting.20complicated.20type.20system.20shenanigans.html#275301888">(Mar 14 2022 at 21:39)</a>:</h4>
<p><span class="user-mention silent" data-user-id="256841">Nick Cameron</span> <a href="#narrow/stream/213817-t-lang/topic/Documenting.20complicated.20type.20system.20shenanigans/near/275144476">said</a>:</p>
<blockquote>
<p>Second, this is just another downside of adding complexity to the type system which I have been muttering about fairly frequently. Clever features like GATs are nice, but there are big downsides to adding complexity to the language and this is an example of that. I worry we are not taking the downsides of complexity seriously enough when considering new features. We might be able to improve things here (I hope so), but IMO we should implement such mitigations before stabilisation of new features, and we should acknowledge that we can't mitigate everything.</p>
</blockquote>
<p>So, I'm also somewhat concerned about the feature set of Rust gradually increasing over time and this potentially becoming a problem; however, I actually am not worried about that in this case. In particular, I think the nice thing about features like GATs is that they are (with sufficient work) opt-in. In other words, people that don't use them don't have to learn them. As a matter of fact, I think "can people that do not want to deal with GATs avoid them" might even be a pretty good measure of how successfully we have addressed the concerns in this thread</p>



<a name="275449205"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/Documenting%20complicated%20type%20system%20shenanigans/near/275449205" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> The 8472 <a href="https://zulip-archive.rust-lang.org/stream/213817-t-lang/topic/Documenting.20complicated.20type.20system.20shenanigans.html#275449205">(Mar 15 2022 at 23:23)</a>:</h4>
<p>~const stuff is making it worse too, see e.g. <a href="https://github.com/rust-lang/rust/pull/92433#pullrequestreview-865702419">https://github.com/rust-lang/rust/pull/92433#pullrequestreview-865702419</a></p>



<a name="275486091"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/Documenting%20complicated%20type%20system%20shenanigans/near/275486091" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> fee1-dead <a href="https://zulip-archive.rust-lang.org/stream/213817-t-lang/topic/Documenting.20complicated.20type.20system.20shenanigans.html#275486091">(Mar 16 2022 at 09:37)</a>:</h4>
<p>Making it worse (in 2024 or later)</p>



<hr><p>Last updated: Apr 12 2022 at 20:01 UTC</p>
</html>