<html>
<head><meta charset="utf-8"><title>.postfix all the things Â· t-lang Â· Zulip Chat Archive</title></head>
<h2>Stream: <a href="https://zulip-archive.rust-lang.org/stream/213817-t-lang/index.html">t-lang</a></h2>
<h3>Topic: <a href="https://zulip-archive.rust-lang.org/stream/213817-t-lang/topic/.2Epostfix.20all.20the.20things.html">.postfix all the things</a></h3>

<hr>

<base href="https://rust-lang.zulipchat.com">

<head><link href="https://zulip-archive.rust-lang.org/style.css" rel="stylesheet"></head>

<a name="255257946"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/.postfix%20all%20the%20things/near/255257946" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> The 8472 <a href="https://zulip-archive.rust-lang.org/stream/213817-t-lang/topic/.2Epostfix.20all.20the.20things.html#255257946">(Sep 28 2021 at 17:12)</a>:</h4>
<p>we must go further. postfix let. values flow into bindings.</p>



<a name="255257955"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/.postfix%20all%20the%20things/near/255257955" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> bjorn3 <a href="https://zulip-archive.rust-lang.org/stream/213817-t-lang/topic/.2Epostfix.20all.20the.20things.html#255257955">(Sep 28 2021 at 17:12)</a>:</h4>
<p>What about postfix unsafe? <span aria-label="laughing" class="emoji emoji-1f606" role="img" title="laughing">:laughing:</span></p>



<a name="255260598"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/.postfix%20all%20the%20things/near/255260598" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> pnkfelix <a href="https://zulip-archive.rust-lang.org/stream/213817-t-lang/topic/.2Epostfix.20all.20the.20things.html#255260598">(Sep 28 2021 at 17:14)</a>:</h4>
<p><span class="user-mention silent" data-user-id="330154">The 8472</span> <a href="#narrow/stream/213817-t-lang/topic/.2Ematch.20suffix/near/255257946">said</a>:</p>
<blockquote>
<p>we must go further. postfix let. values flow into bindings.</p>
</blockquote>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="n">expr</span><span class="p">.</span><span class="w"></span>
<span class="kd">let</span><span class="w"> </span><span class="n">x</span><span class="p">;</span><span class="w"></span>
</code></pre></div>
<p>Wowie. Supreme obfuscation.</p>



<a name="255260727"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/.postfix%20all%20the%20things/near/255260727" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> bjorn3 <a href="https://zulip-archive.rust-lang.org/stream/213817-t-lang/topic/.2Epostfix.20all.20the.20things.html#255260727">(Sep 28 2021 at 17:15)</a>:</h4>
<p>No no no. <code>x.let = expr</code>!</p>



<a name="255260851"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/.postfix%20all%20the%20things/near/255260851" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> pnkfelix <a href="https://zulip-archive.rust-lang.org/stream/213817-t-lang/topic/.2Epostfix.20all.20the.20things.html#255260851">(Sep 28 2021 at 17:16)</a>:</h4>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="n">expr</span><span class="p">.</span><span class="w"></span>
<span class="kd">let</span><span class="w"> </span><span class="n">x</span><span class="w"> </span><span class="o">=</span><span class="p">;</span><span class="w"></span>
</code></pre></div>
<p>might actually buy you something.</p>



<a name="255261227"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/.postfix%20all%20the%20things/near/255261227" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> pnkfelix <a href="https://zulip-archive.rust-lang.org/stream/213817-t-lang/topic/.2Epostfix.20all.20the.20things.html#255261227">(Sep 28 2021 at 17:18)</a>:</h4>
<p>(no, <code>.operation</code> should only be used for expression =&gt; expression operations.)</p>



<a name="255261609"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/.postfix%20all%20the%20things/near/255261609" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> The 8472 <a href="https://zulip-archive.rust-lang.org/stream/213817-t-lang/topic/.2Epostfix.20all.20the.20things.html#255261609">(Sep 28 2021 at 17:20)</a>:</h4>
<p>Just add <code>ðŸ‘†</code> as a sigil so the next one can refer to the result of the expression on the previous line.</p>



<a name="255265229"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/.postfix%20all%20the%20things/near/255265229" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> cuviper <a href="https://zulip-archive.rust-lang.org/stream/213817-t-lang/topic/.2Epostfix.20all.20the.20things.html#255265229">(Sep 28 2021 at 17:40)</a>:</h4>
<p>don't forget postfix divergence! <code>.break</code> <code>.continue</code> <code>.return</code> <code>.yeet</code></p>



<a name="255266244"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/.postfix%20all%20the%20things/near/255266244" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> The 8472 <a href="https://zulip-archive.rust-lang.org/stream/213817-t-lang/topic/.2Epostfix.20all.20the.20things.html#255266244">(Sep 28 2021 at 17:47)</a>:</h4>
<p>you get those for free with postfix blocks</p>



<a name="255268981"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/.postfix%20all%20the%20things/near/255268981" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/213817-t-lang/topic/.2Epostfix.20all.20the.20things.html#255268981">(Sep 28 2021 at 18:01)</a>:</h4>
<p>you people are sick &lt;3</p>



<a name="255269200"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/.postfix%20all%20the%20things/near/255269200" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Connor Horman <a href="https://zulip-archive.rust-lang.org/stream/213817-t-lang/topic/.2Epostfix.20all.20the.20things.html#255269200">(Sep 28 2021 at 18:02)</a>:</h4>
<p>Make sure to postfix <code>unsafe</code> as well.<br>
<code>(*ptr).unsafe</code></p>



<a name="255269510"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/.postfix%20all%20the%20things/near/255269510" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Connor Horman <a href="https://zulip-archive.rust-lang.org/stream/213817-t-lang/topic/.2Epostfix.20all.20the.20things.html#255269510">(Sep 28 2021 at 18:04)</a>:</h4>
<p>Oh, and function defintions as well. Rewrite <code>dangling&lt;T&gt;()</code> as <code>(NonNull&lt;T&gt;::new_unchecked(core::mem::align_of::&lt;T&gt;() as *mut T).unsafe).fn dangling&lt;T&gt;() -&gt; Self{}</code></p>



<a name="255271143"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/.postfix%20all%20the%20things/near/255271143" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Gary Guo <a href="https://zulip-archive.rust-lang.org/stream/213817-t-lang/topic/.2Epostfix.20all.20the.20things.html#255271143">(Sep 28 2021 at 18:14)</a>:</h4>
<p>We can do all of these given postfix macro!</p>



<a name="255271414"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/.postfix%20all%20the%20things/near/255271414" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Triplett <a href="https://zulip-archive.rust-lang.org/stream/213817-t-lang/topic/.2Epostfix.20all.20the.20things.html#255271414">(Sep 28 2021 at 18:15)</a>:</h4>
<p><span class="user-mention" data-user-id="116009">@nikomatsakis</span> Join the side.dark, we have syntax.postfix!</p>



<a name="255284246"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/.postfix%20all%20the%20things/near/255284246" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Gus Wynn <a href="https://zulip-archive.rust-lang.org/stream/213817-t-lang/topic/.2Epostfix.20all.20the.20things.html#255284246">(Sep 28 2021 at 19:32)</a>:</h4>
<p>cpp energy: <code>fn deref_mut(self) -&gt; Self::Target &amp;mut</code></p>



<a name="255284968"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/.postfix%20all%20the%20things/near/255284968" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Boxy [she/her] <a href="https://zulip-archive.rust-lang.org/stream/213817-t-lang/topic/.2Epostfix.20all.20the.20things.html#255284968">(Sep 28 2021 at 19:37)</a>:</h4>
<p>postfix borrow and deref would be really nice for real though</p>



<a name="255285025"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/.postfix%20all%20the%20things/near/255285025" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Boxy [she/her] <a href="https://zulip-archive.rust-lang.org/stream/213817-t-lang/topic/.2Epostfix.20all.20the.20things.html#255285025">(Sep 28 2021 at 19:37)</a>:</h4>
<p>I often see code like <code>(&amp;*foo).bar</code> and it feels weird</p>



<a name="255285251"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/.postfix%20all%20the%20things/near/255285251" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Gary Guo <a href="https://zulip-archive.rust-lang.org/stream/213817-t-lang/topic/.2Epostfix.20all.20the.20things.html#255285251">(Sep 28 2021 at 19:39)</a>:</h4>
<p>Just call deref() :)</p>



<a name="255290424"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/.postfix%20all%20the%20things/near/255290424" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Lokathor <a href="https://zulip-archive.rust-lang.org/stream/213817-t-lang/topic/.2Epostfix.20all.20the.20things.html#255290424">(Sep 28 2021 at 20:11)</a>:</h4>
<p>I'd like the <code>-&gt;</code> operator before new types of deref ;3</p>



<a name="255306166"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/.postfix%20all%20the%20things/near/255306166" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> cuviper <a href="https://zulip-archive.rust-lang.org/stream/213817-t-lang/topic/.2Epostfix.20all.20the.20things.html#255306166">(Sep 28 2021 at 21:53)</a>:</h4>
<p>I just remembered, there was also the <code>.move</code> idea:<br>
<a href="#narrow/stream/213817-t-lang/topic/Spitballing.3A.20a.20.60move.28x.29.60.20expression.3F/near/212463117">https://rust-lang.zulipchat.com/#narrow/stream/213817-t-lang/topic/Spitballing.3A.20a.20.60move.28x.29.60.20expression.3F/near/212463117</a></p>



<a name="255329373"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/.postfix%20all%20the%20things/near/255329373" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> isHavvy <a href="https://zulip-archive.rust-lang.org/stream/213817-t-lang/topic/.2Epostfix.20all.20the.20things.html#255329373">(Sep 29 2021 at 01:54)</a>:</h4>
<p><code>true.if { println!("true"); }</code></p>



<a name="255363034"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/.postfix%20all%20the%20things/near/255363034" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Daniel Wagner-Hall <a href="https://zulip-archive.rust-lang.org/stream/213817-t-lang/topic/.2Epostfix.20all.20the.20things.html#255363034">(Sep 29 2021 at 08:45)</a>:</h4>
<p>The empty postfix macro?</p>
<p><code>false.!.if { println!("false"); }</code></p>



<a name="255368751"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/.postfix%20all%20the%20things/near/255368751" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> kennytm <a href="https://zulip-archive.rust-lang.org/stream/213817-t-lang/topic/.2Epostfix.20all.20the.20things.html#255368751">(Sep 29 2021 at 09:33)</a>:</h4>
<p>that is <code>.not()</code>...</p>



<a name="256277810"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/.postfix%20all%20the%20things/near/256277810" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Taylor Cramer <a href="https://zulip-archive.rust-lang.org/stream/213817-t-lang/topic/.2Epostfix.20all.20the.20things.html#256277810">(Oct 05 2021 at 16:36)</a>:</h4>
<p><span class="user-mention" data-user-id="296643">@isHavvy</span> I dunno if that was supposed to be ironic but I completely seriously want <code>some_bool.if { ... }</code></p>



<a name="256277867"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/.postfix%20all%20the%20things/near/256277867" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Taylor Cramer <a href="https://zulip-archive.rust-lang.org/stream/213817-t-lang/topic/.2Epostfix.20all.20the.20things.html#256277867">(Oct 05 2021 at 16:37)</a>:</h4>
<p>coming from scala it always messed me up that we say <code>match</code> before the expr</p>



<a name="256278197"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/.postfix%20all%20the%20things/near/256278197" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> The 8472 <a href="https://zulip-archive.rust-lang.org/stream/213817-t-lang/topic/.2Epostfix.20all.20the.20things.html#256278197">(Oct 05 2021 at 16:39)</a>:</h4>
<p><code>bool</code> already has <code>.then()</code></p>



<a name="257410900"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/.postfix%20all%20the%20things/near/257410900" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> scottmcm <a href="https://zulip-archive.rust-lang.org/stream/213817-t-lang/topic/.2Epostfix.20all.20the.20things.html#257410900">(Oct 13 2021 at 18:05)</a>:</h4>
<p><span class="user-mention silent" data-user-id="133247">bjorn3</span> <a href="#narrow/stream/213817-t-lang/topic/.2Epostfix.20all.20the.20things/near/255257955">said</a>:</p>
<blockquote>
<p>What about postfix unsafe? <span aria-label="laughing" class="emoji emoji-1f606" role="img" title="laughing">:laughing:</span></p>
</blockquote>
<p>As a serious answer to a <span aria-label="laughing" class="emoji emoji-1f606" role="img" title="laughing">:laughing:</span>, postfix everything that takes a <em>value</em> (like <code>match</code> and <code>await</code> and <code>?</code>) but prefix everything that affects a <em>block-thunk</em> (like <code>while</code> and <code>async</code> and <code>try</code>).</p>



<a name="257411166"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/.postfix%20all%20the%20things/near/257411166" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> scottmcm <a href="https://zulip-archive.rust-lang.org/stream/213817-t-lang/topic/.2Epostfix.20all.20the.20things.html#257411166">(Oct 13 2021 at 18:07)</a>:</h4>
<p>Which, I suppose, does mean that postfix let could be allowed.  Arguably in shadowing cases the name resolution is even clearer for <code>x.parse()? -&gt; let x;</code> than in the prefix form.</p>
<p>Similarly, <code>x.return</code> would be fine, though I wouldn't actually argue for it.  (Anything that's <code>-&gt; !</code> is a bit of an exception.)</p>



<a name="257413992"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/.postfix%20all%20the%20things/near/257413992" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Charles Lew <a href="https://zulip-archive.rust-lang.org/stream/213817-t-lang/topic/.2Epostfix.20all.20the.20things.html#257413992">(Oct 13 2021 at 18:26)</a>:</h4>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="kc">true</span><span class="p">.</span><span class="n">then</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="fm">println!</span><span class="p">(</span><span class="s">"true"</span><span class="p">);</span><span class="w"> </span><span class="p">}</span><span class="w"></span>

<span class="k">fn</span> <span class="nf">sum</span><span class="p">()</span><span class="w"> </span>-&gt; <span class="kt">usize</span> <span class="p">{</span><span class="w"></span>
<span class="w">      </span><span class="n">expr1</span><span class="p">().</span><span class="n">is</span><span class="w"> </span><span class="n">value_a</span><span class="p">;</span><span class="w"></span>
<span class="w">      </span><span class="n">expr2</span><span class="p">().</span><span class="n">is</span><span class="w"> </span><span class="n">value_b</span><span class="p">;</span><span class="w"></span>
<span class="w">      </span><span class="n">value_a</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">value_b</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>
</code></pre></div>



<a name="257417445"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/.postfix%20all%20the%20things/near/257417445" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Gary Guo <a href="https://zulip-archive.rust-lang.org/stream/213817-t-lang/topic/.2Epostfix.20all.20the.20things.html#257417445">(Oct 13 2021 at 18:48)</a>:</h4>
<p>Let's just revive postfix macros :)</p>



<a name="257435560"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/.postfix%20all%20the%20things/near/257435560" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Connor Horman <a href="https://zulip-archive.rust-lang.org/stream/213817-t-lang/topic/.2Epostfix.20all.20the.20things.html#257435560">(Oct 13 2021 at 20:50)</a>:</h4>
<p>Yeah, that seems like a slightly easier alternative.</p>



<a name="257549649"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/.postfix%20all%20the%20things/near/257549649" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Triplett <a href="https://zulip-archive.rust-lang.org/stream/213817-t-lang/topic/.2Epostfix.20all.20the.20things.html#257549649">(Oct 14 2021 at 14:59)</a>:</h4>
<p>I'd like to revive postfix macros, but I'd <em>also</em> like to have <code>.match</code>.</p>



<a name="257583036"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/.postfix%20all%20the%20things/near/257583036" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Wrenn <a href="https://zulip-archive.rust-lang.org/stream/213817-t-lang/topic/.2Epostfix.20all.20the.20things.html#257583036">(Oct 14 2021 at 18:32)</a>:</h4>
<p>It'd be a great to have a postfix way of calling free functions. Itertools could ditch its <a href="https://github.com/rust-lang/rust/issues/88878">problematic extension trait</a> and define free functions instead, without totally sacrificing the ability to chain iterator adapters. (Maybe postfix macros could help with that too; not sure.)</p>



<a name="257595195"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/.postfix%20all%20the%20things/near/257595195" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Gary Guo <a href="https://zulip-archive.rust-lang.org/stream/213817-t-lang/topic/.2Epostfix.20all.20the.20things.html#257595195">(Oct 14 2021 at 19:55)</a>:</h4>
<p><span class="user-mention silent" data-user-id="219211">Jack Wrenn</span> <a href="#narrow/stream/213817-t-lang/topic/.2Epostfix.20all.20the.20things/near/257583036">said</a>:</p>
<blockquote>
<p>It'd be a great to have a postfix way of calling free functions. Itertools could ditch its <a href="https://github.com/rust-lang/rust/issues/88878">problematic extension trait</a> and define free functions instead, without totally sacrificing the ability to chain iterator adapters. (Maybe postfix macros could help with that too; not sure.)</p>
</blockquote>
<p>That should be as easy as</p>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="fm">macro_rules!</span><span class="w"> </span><span class="n">map</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="p">(</span><span class="cp">$self</span>:<span class="nc">self</span><span class="p">,</span><span class="w"> </span><span class="cp">$f</span>:<span class="nc">expr</span><span class="w"> </span><span class="cp">$(,</span><span class="w"> </span><span class="cp">$arg</span>: <span class="nc">expr</span><span class="p">)</span><span class="o">*</span><span class="w"> </span><span class="cp">$(,</span><span class="p">)</span><span class="o">?</span><span class="p">)</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">        </span><span class="cp">$f</span><span class="p">(</span><span class="cp">$self</span><span class="w"> </span><span class="cp">$(,</span><span class="w"> </span><span class="cp">$arg</span><span class="p">)</span><span class="o">*</span><span class="p">)</span><span class="w"></span>
<span class="w">    </span><span class="p">}</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>
</code></pre></div>
<p>with postfix macros, then you can do <code>expr.map!(free_fn, extra_args)</code></p>



<a name="257595573"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/.postfix%20all%20the%20things/near/257595573" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> scottmcm <a href="https://zulip-archive.rust-lang.org/stream/213817-t-lang/topic/.2Epostfix.20all.20the.20things.html#257595573">(Oct 14 2021 at 19:57)</a>:</h4>
<p>Of course, postfix <code>match</code> is kindof a pipe <a href="https://docs.rs/tap/1.0.1/tap/#piping">https://docs.rs/tap/1.0.1/tap/#piping</a></p>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="n">expr</span><span class="p">.</span><span class="k">match</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">x</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="n">free_fn</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="w"> </span><span class="n">extra</span><span class="p">,</span><span class="w"> </span><span class="n">args</span><span class="p">)</span><span class="w"> </span><span class="p">}</span><span class="w"></span>
</code></pre></div>



<a name="257596120"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/.postfix%20all%20the%20things/near/257596120" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Gary Guo <a href="https://zulip-archive.rust-lang.org/stream/213817-t-lang/topic/.2Epostfix.20all.20the.20things.html#257596120">(Oct 14 2021 at 20:00)</a>:</h4>
<p>Oh yeah, with extension traits macros are not needed for that</p>



<a name="257619289"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/.postfix%20all%20the%20things/near/257619289" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/213817-t-lang/topic/.2Epostfix.20all.20the.20things.html#257619289">(Oct 14 2021 at 22:58)</a>:</h4>
<p><span class="user-mention silent" data-user-id="303710">Gary Guo</span> <a href="#narrow/stream/213817-t-lang/topic/.2Epostfix.20all.20the.20things/near/257595195">said</a>:</p>
<blockquote>
<p><span class="user-mention silent" data-user-id="219211">Jack Wrenn</span> <a href="#narrow/stream/213817-t-lang/topic/.2Epostfix.20all.20the.20things/near/257583036">said</a>:<br>
with postfix macros, then you can do <code>expr.map!(free_fn, extra_args)</code></p>
</blockquote>
<p>this...is not equivalent in terms of ergonomics though =)</p>



<a name="257690734"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/.postfix%20all%20the%20things/near/257690734" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Triplett <a href="https://zulip-archive.rust-lang.org/stream/213817-t-lang/topic/.2Epostfix.20all.20the.20things.html#257690734">(Oct 15 2021 at 12:39)</a>:</h4>
<p><span class="user-mention silent" data-user-id="303710">Gary Guo</span> <a href="#narrow/stream/213817-t-lang/topic/.2Epostfix.20all.20the.20things/near/257595195">said</a>:</p>
<blockquote>
<p><span class="user-mention silent" data-user-id="219211">Jack Wrenn</span> <a href="#narrow/stream/213817-t-lang/topic/.2Epostfix.20all.20the.20things/near/257583036">said</a>:</p>
<blockquote>
<p>It'd be a great to have a postfix way of calling free functions. Itertools could ditch its <a href="https://github.com/rust-lang/rust/issues/88878">problematic extension trait</a> and define free functions instead, without totally sacrificing the ability to chain iterator adapters. (Maybe postfix macros could help with that too; not sure.)</p>
</blockquote>
<p>That should be as easy as</p>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="fm">macro_rules!</span><span class="w"> </span><span class="n">map</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="p">(</span><span class="cp">$self</span>:<span class="nc">self</span><span class="p">,</span><span class="w"> </span><span class="cp">$f</span>:<span class="nc">expr</span><span class="w"> </span><span class="cp">$(,</span><span class="w"> </span><span class="cp">$arg</span>: <span class="nc">expr</span><span class="p">)</span><span class="o">*</span><span class="w"> </span><span class="cp">$(,</span><span class="p">)</span><span class="o">?</span><span class="p">)</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">        </span><span class="cp">$f</span><span class="p">(</span><span class="cp">$self</span><span class="w"> </span><span class="cp">$(,</span><span class="w"> </span><span class="cp">$arg</span><span class="p">)</span><span class="o">*</span><span class="p">)</span><span class="w"></span>
<span class="w">    </span><span class="p">}</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>
</code></pre></div>
<p>with postfix macros, then you can do <code>expr.map!(free_fn, extra_args)</code></p>
</blockquote>
<p>As a nit, I think I'd call that <code>.apply!</code>, but otherwise that seems reasonable.</p>



<a name="257793642"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/.postfix%20all%20the%20things/near/257793642" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> scottmcm <a href="https://zulip-archive.rust-lang.org/stream/213817-t-lang/topic/.2Epostfix.20all.20the.20things.html#257793642">(Oct 16 2021 at 02:38)</a>:</h4>
<p><span class="user-mention silent" data-user-id="219211">Jack Wrenn</span> <a href="#narrow/stream/213817-t-lang/topic/.2Epostfix.20all.20the.20things/near/257583036">said</a>:</p>
<blockquote>
<p>Itertools could ditch its <a href="https://github.com/rust-lang/rust/issues/88878">problematic extension trait</a> and define free functions instead</p>
</blockquote>
<p>I've often wished we allowed <code>foo.Display::fmt(...)</code> and <code>foo.Debug::fmt(...)</code> or something for disambiguating.  Would be nice to not have to make the big jump to UFCS for this stuff.</p>
<p>That could even be a opt-in <code>cargo fix</code> for people who want extra protection against breakage when dependencies add new methods.</p>



<a name="258230689"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/.postfix%20all%20the%20things/near/258230689" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/213817-t-lang/topic/.2Epostfix.20all.20the.20things.html#258230689">(Oct 19 2021 at 16:51)</a>:</h4>
<p>that'd be relatively easy to do, we considered it back in the day</p>



<a name="263089181"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/.postfix%20all%20the%20things/near/263089181" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ibraheem Ahmed <a href="https://zulip-archive.rust-lang.org/stream/213817-t-lang/topic/.2Epostfix.20all.20the.20things.html#263089181">(Nov 30 2021 at 00:51)</a>:</h4>
<p>What needs to happen to move <a href="https://github.com/rust-lang/rust/issues/2442">#2442</a> forward?</p>



<a name="263089300"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/.postfix%20all%20the%20things/near/263089300" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Triplett <a href="https://zulip-archive.rust-lang.org/stream/213817-t-lang/topic/.2Epostfix.20all.20the.20things.html#263089300">(Nov 30 2021 at 00:52)</a>:</h4>
<p>Do you mean <a href="https://github.com/rust-lang/rfcs/pull/2442">https://github.com/rust-lang/rfcs/pull/2442</a> ?</p>



<a name="263093115"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/.postfix%20all%20the%20things/near/263093115" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Triplett <a href="https://zulip-archive.rust-lang.org/stream/213817-t-lang/topic/.2Epostfix.20all.20the.20things.html#263093115">(Nov 30 2021 at 01:53)</a>:</h4>
<p>I think what that needs is a nomination for lang-team re-discussion, and the energy to re-discuss it.</p>



<a name="263093120"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/.postfix%20all%20the%20things/near/263093120" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Triplett <a href="https://zulip-archive.rust-lang.org/stream/213817-t-lang/topic/.2Epostfix.20all.20the.20things.html#263093120">(Nov 30 2021 at 01:53)</a>:</h4>
<p>I'm happy to provide the former.</p>



<a name="263093126"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/.postfix%20all%20the%20things/near/263093126" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Triplett <a href="https://zulip-archive.rust-lang.org/stream/213817-t-lang/topic/.2Epostfix.20all.20the.20things.html#263093126">(Nov 30 2021 at 01:53)</a>:</h4>
<p>We can hope for the latter.</p>



<a name="263093183"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/.postfix%20all%20the%20things/near/263093183" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Triplett <a href="https://zulip-archive.rust-lang.org/stream/213817-t-lang/topic/.2Epostfix.20all.20the.20things.html#263093183">(Nov 30 2021 at 01:54)</a>:</h4>
<p>Actually, hmmm. It's possible that all it needs is an FCP.</p>



<a name="263095580"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/.postfix%20all%20the%20things/near/263095580" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ibraheem Ahmed <a href="https://zulip-archive.rust-lang.org/stream/213817-t-lang/topic/.2Epostfix.20all.20the.20things.html#263095580">(Nov 30 2021 at 02:38)</a>:</h4>
<p>The one big issue I see that hasn't been addressed is <code>$self</code> analogous to <code>$crate</code></p>



<a name="263096591"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/.postfix%20all%20the%20things/near/263096591" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jacob Pratt <a href="https://zulip-archive.rust-lang.org/stream/213817-t-lang/topic/.2Epostfix.20all.20the.20things.html#263096591">(Nov 30 2021 at 02:59)</a>:</h4>
<p>I haven't looked over the RFC in a while, but I thought it was understood that <code>$self</code> referred to the preceding expression as an opaque value.</p>



<a name="263097202"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/.postfix%20all%20the%20things/near/263097202" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Triplett <a href="https://zulip-archive.rust-lang.org/stream/213817-t-lang/topic/.2Epostfix.20all.20the.20things.html#263097202">(Nov 30 2021 at 03:09)</a>:</h4>
<p>Oh, that's right, the RFC had to use <code>$self:self</code> rather than <code>$self</code> for compatibility reasons.</p>



<a name="263097266"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/.postfix%20all%20the%20things/near/263097266" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Triplett <a href="https://zulip-archive.rust-lang.org/stream/213817-t-lang/topic/.2Epostfix.20all.20the.20things.html#263097266">(Nov 30 2021 at 03:10)</a>:</h4>
<p><span class="user-mention" data-user-id="245610">@Jacob Pratt</span> Right, it does.</p>



<a name="263097273"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/.postfix%20all%20the%20things/near/263097273" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Triplett <a href="https://zulip-archive.rust-lang.org/stream/213817-t-lang/topic/.2Epostfix.20all.20the.20things.html#263097273">(Nov 30 2021 at 03:10)</a>:</h4>
<p>The desugar is approximately equivalent to <code>let _temp = ...; macro!(_temp, ...)</code></p>



<a name="263097385"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/.postfix%20all%20the%20things/near/263097385" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jacob Pratt <a href="https://zulip-archive.rust-lang.org/stream/213817-t-lang/topic/.2Epostfix.20all.20the.20things.html#263097385">(Nov 30 2021 at 03:12)</a>:</h4>
<p>Ah, right, forgot about the compatibility. Either way it's not a huge drawback.</p>



<a name="263097967"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/.postfix%20all%20the%20things/near/263097967" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ibraheem Ahmed <a href="https://zulip-archive.rust-lang.org/stream/213817-t-lang/topic/.2Epostfix.20all.20the.20things.html#263097967">(Nov 30 2021 at 03:25)</a>:</h4>
<p>So if all that's needed is a FCP...</p>



<a name="263099223"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/.postfix%20all%20the%20things/near/263099223" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Triplett <a href="https://zulip-archive.rust-lang.org/stream/213817-t-lang/topic/.2Epostfix.20all.20the.20things.html#263099223">(Nov 30 2021 at 03:54)</a>:</h4>
<p>It's not clear if that's all that's needed.</p>



<a name="263099225"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/.postfix%20all%20the%20things/near/263099225" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Triplett <a href="https://zulip-archive.rust-lang.org/stream/213817-t-lang/topic/.2Epostfix.20all.20the.20things.html#263099225">(Nov 30 2021 at 03:54)</a>:</h4>
<p>I'm investigating now to see.</p>



<a name="263107383"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/.postfix%20all%20the%20things/near/263107383" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Triplett <a href="https://zulip-archive.rust-lang.org/stream/213817-t-lang/topic/.2Epostfix.20all.20the.20things.html#263107383">(Nov 30 2021 at 06:55)</a>:</h4>
<p>For the moment, since there's a lang meeting tomorrow, I'm going to go ahead and nominate it, and consider proposing FCP in the meeting.</p>



<a name="263108305"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/.postfix%20all%20the%20things/near/263108305" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jacob Pratt <a href="https://zulip-archive.rust-lang.org/stream/213817-t-lang/topic/.2Epostfix.20all.20the.20things.html#263108305">(Nov 30 2021 at 07:14)</a>:</h4>
<p>Awesome. Even though they're not typed (that's a whole different level of implementation), I think in practice they'll be largely restricted to some type. I know I've got some use cases in my head that would make reading code significantly better.</p>



<a name="263108350"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/.postfix%20all%20the%20things/near/263108350" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jacob Pratt <a href="https://zulip-archive.rust-lang.org/stream/213817-t-lang/topic/.2Epostfix.20all.20the.20things.html#263108350">(Nov 30 2021 at 07:15)</a>:</h4>
<p>Now that I think of it, the lack of a postfix macro being typed could sort of be worked around by throwing an error if it's not the expected type</p>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="fm">macro_rules!</span><span class="w"> </span><span class="n">foo</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="p">(</span><span class="cp">$self</span>:<span class="nc">self</span><span class="p">)</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">        </span><span class="kd">let</span><span class="w"> </span><span class="n">_</span>: <span class="kp">&amp;</span><span class="o">&lt;</span><span class="n">expected_type</span><span class="o">&gt;</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">&amp;</span><span class="bp">self</span><span class="p">;</span><span class="w"></span>
<span class="w">        </span><span class="c1">// everything else</span>
<span class="w">    </span><span class="p">};</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>
</code></pre></div>
<p>The static assertions crate might be able to be used in more complicated situations.</p>



<a name="263109718"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/.postfix%20all%20the%20things/near/263109718" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Triplett <a href="https://zulip-archive.rust-lang.org/stream/213817-t-lang/topic/.2Epostfix.20all.20the.20things.html#263109718">(Nov 30 2021 at 07:41)</a>:</h4>
<p><span class="user-mention" data-user-id="245610">@Jacob Pratt</span> I can easily imagine common cases where they're restricted to things implementing a trait, or even "things implementing a pseudo-trait I haven't actually defined but which consists of having a function/field like this".</p>



<a name="263109781"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/.postfix%20all%20the%20things/near/263109781" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Triplett <a href="https://zulip-archive.rust-lang.org/stream/213817-t-lang/topic/.2Epostfix.20all.20the.20things.html#263109781">(Nov 30 2021 at 07:42)</a>:</h4>
<p>But I do think the convention of giving <code>$self</code> a type with a binding may be useful in cases where it has a specific expected type.</p>



<a name="263109901"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/.postfix%20all%20the%20things/near/263109901" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jacob Pratt <a href="https://zulip-archive.rust-lang.org/stream/213817-t-lang/topic/.2Epostfix.20all.20the.20things.html#263109901">(Nov 30 2021 at 07:44)</a>:</h4>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="k">fn</span> <span class="nf">foo</span><span class="p">(</span><span class="n">x</span>: <span class="nc">impl</span><span class="w"> </span><span class="n">T</span><span class="p">)</span><span class="w"> </span>-&gt; <span class="nc">impl</span><span class="w"> </span><span class="n">T</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="n">x</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>
<span class="c1">// ...</span>
</code></pre></div>
<p>could be used for something expecting a trait. The same but using a closure would work for needing a function/field.</p>



<a name="263109915"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/.postfix%20all%20the%20things/near/263109915" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jacob Pratt <a href="https://zulip-archive.rust-lang.org/stream/213817-t-lang/topic/.2Epostfix.20all.20the.20things.html#263109915">(Nov 30 2021 at 07:45)</a>:</h4>
<p>basically I don't think it'll be too hard to work around. Though it's probably a bit off topic, admittedly.</p>



<a name="263109952"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/.postfix%20all%20the%20things/near/263109952" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Triplett <a href="https://zulip-archive.rust-lang.org/stream/213817-t-lang/topic/.2Epostfix.20all.20the.20things.html#263109952">(Nov 30 2021 at 07:45)</a>:</h4>
<p>It seems <em>useful</em> to have conventional ways of up-front defining what your macro expects in a checkable way.</p>



<a name="263110052"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/.postfix%20all%20the%20things/near/263110052" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jacob Pratt <a href="https://zulip-archive.rust-lang.org/stream/213817-t-lang/topic/.2Epostfix.20all.20the.20things.html#263110052">(Nov 30 2021 at 07:47)</a>:</h4>
<p>You know, syntactically it should be possible to do something along the lines of <code>macro_rules! foo&lt;impl T&gt;</code>â€¦</p>



<a name="263110058"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/.postfix%20all%20the%20things/near/263110058" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jacob Pratt <a href="https://zulip-archive.rust-lang.org/stream/213817-t-lang/topic/.2Epostfix.20all.20the.20things.html#263110058">(Nov 30 2021 at 07:47)</a>:</h4>
<p>just a random thought</p>



<a name="263110108"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/.postfix%20all%20the%20things/near/263110108" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jacob Pratt <a href="https://zulip-archive.rust-lang.org/stream/213817-t-lang/topic/.2Epostfix.20all.20the.20things.html#263110108">(Nov 30 2021 at 07:48)</a>:</h4>
<p>certainly best to work on the basic untyped version first, though</p>



<a name="263110226"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/.postfix%20all%20the%20things/near/263110226" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Triplett <a href="https://zulip-archive.rust-lang.org/stream/213817-t-lang/topic/.2Epostfix.20all.20the.20things.html#263110226">(Nov 30 2021 at 07:50)</a>:</h4>
<p>Interesting. Not type-based dispatch, just name-based dispatch with type-based "nope" once found?</p>



<a name="263110266"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/.postfix%20all%20the%20things/near/263110266" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jacob Pratt <a href="https://zulip-archive.rust-lang.org/stream/213817-t-lang/topic/.2Epostfix.20all.20the.20things.html#263110266">(Nov 30 2021 at 07:50)</a>:</h4>
<p>Basically</p>



<a name="263110276"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/.postfix%20all%20the%20things/near/263110276" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jacob Pratt <a href="https://zulip-archive.rust-lang.org/stream/213817-t-lang/topic/.2Epostfix.20all.20the.20things.html#263110276">(Nov 30 2021 at 07:50)</a>:</h4>
<p>It would effectively be the same as what I was saying above</p>



<a name="263110290"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/.postfix%20all%20the%20things/near/263110290" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Triplett <a href="https://zulip-archive.rust-lang.org/stream/213817-t-lang/topic/.2Epostfix.20all.20the.20things.html#263110290">(Nov 30 2021 at 07:51)</a>:</h4>
<p>So no contribution to inference, you have to already know that <code>impl T</code> applies or you get a type error?</p>



<a name="263110321"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/.postfix%20all%20the%20things/near/263110321" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Triplett <a href="https://zulip-archive.rust-lang.org/stream/213817-t-lang/topic/.2Epostfix.20all.20the.20things.html#263110321">(Nov 30 2021 at 07:51)</a>:</h4>
<p>I'm broadly in favor of an idea like that, though I'd love to see it prototyped as a macro-for-making-postfix-macros first.</p>



<a name="263110379"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/.postfix%20all%20the%20things/near/263110379" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jacob Pratt <a href="https://zulip-archive.rust-lang.org/stream/213817-t-lang/topic/.2Epostfix.20all.20the.20things.html#263110379">(Nov 30 2021 at 07:52)</a>:</h4>
<p>I'd have to think about that one. Can't hurt to start there once (if) postfix macros are a thing. Adding inference could always come later.</p>



<a name="263110433"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/.postfix%20all%20the%20things/near/263110433" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jacob Pratt <a href="https://zulip-archive.rust-lang.org/stream/213817-t-lang/topic/.2Epostfix.20all.20the.20things.html#263110433">(Nov 30 2021 at 07:53)</a>:</h4>
<p>We're also both in favor of much more powerful macros, I'm pretty sure. Other people might have something to say about this, naturally.</p>



<a name="263110815"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/.postfix%20all%20the%20things/near/263110815" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Triplett <a href="https://zulip-archive.rust-lang.org/stream/213817-t-lang/topic/.2Epostfix.20all.20the.20things.html#263110815">(Nov 30 2021 at 07:59)</a>:</h4>
<p>Agreed, with the caveat that "more powerful in what effects they can produce and how expressively they can do so" and "more powerful in how you can invoke them with more brevity of syntax" are two different things and I'm not generally in favor of the latter.</p>



<a name="263139072"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/.postfix%20all%20the%20things/near/263139072" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Daniel Henry-Mantilla <a href="https://zulip-archive.rust-lang.org/stream/213817-t-lang/topic/.2Epostfix.20all.20the.20things.html#263139072">(Nov 30 2021 at 12:51)</a>:</h4>
<p>So, <em>allowing</em> postfix <em>syntax</em> would do the one thing that macros can't handle. Having to make the macro emit some extra boilerplate to add type-based refinement or w/e is something typical and easy for macro authors to do. Inference can still be nudged by what the macro emits, by the way. We could later allow for type-scoped macros by having them either fail or be shadowed by already existing postfix macros. And by using poor-man's specialization, we can already feature macros featuring <em>code</em> which is interpreted differently for stuff that is known to implement a trait and stuff for which it's unknown (and with true <code>specialization</code> this meaning could even take into account the actual type the generic is instanced with). That is: (very-far-)future <em>features</em> may make writing some of these macros <em>easier</em>, but it can't make them more powerful (and regarding the "writing macros more easily" part, that's a task that a helper meta-macro can already tackle <span aria-label="upside down" class="emoji emoji-1f643" role="img" title="upside down">:upside_down:</span>)</p>



<a name="263231914"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/.postfix%20all%20the%20things/near/263231914" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jacob Pratt <a href="https://zulip-archive.rust-lang.org/stream/213817-t-lang/topic/.2Epostfix.20all.20the.20things.html#263231914">(Dec 01 2021 at 01:03)</a>:</h4>
<p><span class="user-mention" data-user-id="239881">@Josh Triplett</span> I just checked your latest push to the RFC. With regard to correctness, couldn't we desugar into a closure now that disjoint captures are a thing? That would work for any situation, I think.</p>



<a name="263231999"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/.postfix%20all%20the%20things/near/263231999" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Triplett <a href="https://zulip-archive.rust-lang.org/stream/213817-t-lang/topic/.2Epostfix.20all.20the.20things.html#263231999">(Dec 01 2021 at 01:05)</a>:</h4>
<p>I thought about that, but then a postfix macro couldn't do control flow.</p>



<a name="263232015"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/.postfix%20all%20the%20things/near/263232015" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jacob Pratt <a href="https://zulip-archive.rust-lang.org/stream/213817-t-lang/topic/.2Epostfix.20all.20the.20things.html#263232015">(Dec 01 2021 at 01:05)</a>:</h4>
<p>true</p>



<a name="263239599"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/.postfix%20all%20the%20things/near/263239599" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> scottmcm <a href="https://zulip-archive.rust-lang.org/stream/213817-t-lang/topic/.2Epostfix.20all.20the.20things.html#263239599">(Dec 01 2021 at 03:15)</a>:</h4>
<p>Hmm.  While I like the <code>self</code> matcher to distinguish that it's not getting the token tree, I'm less convinced by the <code>self</code>/<code>&amp;self</code>/<code>&amp;mut</code> thing here.  That feels to me like it shouldn't matter at the <em>token</em> level that the macro is operating.</p>



<a name="263239967"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/.postfix%20all%20the%20things/near/263239967" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> scottmcm <a href="https://zulip-archive.rust-lang.org/stream/213817-t-lang/topic/.2Epostfix.20all.20the.20things.html#263239967">(Dec 01 2021 at 03:23)</a>:</h4>
<p>Can it somehow lower into whatever the HIR thing is that creates autoref opportunities at type checking time?</p>



<a name="263241235"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/.postfix%20all%20the%20things/near/263241235" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Charles Lew <a href="https://zulip-archive.rust-lang.org/stream/213817-t-lang/topic/.2Epostfix.20all.20the.20things.html#263241235">(Dec 01 2021 at 03:47)</a>:</h4>
<p><span class="user-mention silent" data-user-id="245610">Jacob Pratt</span> <a href="#narrow/stream/213817-t-lang/topic/.2Epostfix.20all.20the.20things/near/263108350">said</a>:</p>
<blockquote>
<p>Now that I think of it, the lack of a postfix macro being typed could sort of be worked around by throwing an error if it's not the expected type</p>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="fm">macro_rules!</span><span class="w"> </span><span class="n">foo</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="p">(</span><span class="cp">$self</span>:<span class="nc">self</span><span class="p">)</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">        </span><span class="kd">let</span><span class="w"> </span><span class="n">_</span>: <span class="kp">&amp;</span><span class="o">&lt;</span><span class="n">expected_type</span><span class="o">&gt;</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">&amp;</span><span class="bp">self</span><span class="p">;</span><span class="w"></span>
<span class="w">        </span><span class="c1">// everything else</span>
<span class="w">    </span><span class="p">};</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>
</code></pre></div>
<p>The static assertions crate might be able to be used in more complicated situations.</p>
</blockquote>
<p>The goal is legimate,  but the implementation doesn't really work... Please take "place-expression macros"(don't know if there's a official term for this) into extra consideration:</p>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="fm">macro_rules!</span><span class="w"> </span><span class="n">foo</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="p">(</span><span class="cp">$self</span>:<span class="nc">self</span><span class="p">)</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">        </span><span class="cp">$self</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="w"></span>
<span class="w">    </span><span class="p">};</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>
</code></pre></div>
<p>Usage: <code>array.foo!() = 42; </code></p>
<p>Please note that there's no chance to insert any statement(<code>let</code> or items) here, and adding braces is not possible too (that will convert this place expression into value expression)</p>



<a name="263245459"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/.postfix%20all%20the%20things/near/263245459" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jacob Pratt <a href="https://zulip-archive.rust-lang.org/stream/213817-t-lang/topic/.2Epostfix.20all.20the.20things.html#263245459">(Dec 01 2021 at 05:14)</a>:</h4>
<p>That's fair. I'm largely envisioning expression context, as I think that'll be most common. It certainly won't work for everything.</p>



<a name="263252341"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/.postfix%20all%20the%20things/near/263252341" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Triplett <a href="https://zulip-archive.rust-lang.org/stream/213817-t-lang/topic/.2Epostfix.20all.20the.20things.html#263252341">(Dec 01 2021 at 07:14)</a>:</h4>
<p><span class="user-mention silent" data-user-id="125270">scottmcm</span> <a href="#narrow/stream/213817-t-lang/topic/.2Epostfix.20all.20the.20things/near/263239967">said</a>:</p>
<blockquote>
<p>Can it somehow lower into whatever the HIR thing is that creates autoref opportunities at type checking time?</p>
</blockquote>
<p>I would <em>love</em> to get a suggestion for text to that effect.</p>



<a name="263252342"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/.postfix%20all%20the%20things/near/263252342" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Triplett <a href="https://zulip-archive.rust-lang.org/stream/213817-t-lang/topic/.2Epostfix.20all.20the.20things.html#263252342">(Dec 01 2021 at 07:14)</a>:</h4>
<p>That sounds substantially cleaner.</p>



<a name="263252789"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/.postfix%20all%20the%20things/near/263252789" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Charles Lew <a href="https://zulip-archive.rust-lang.org/stream/213817-t-lang/topic/.2Epostfix.20all.20the.20things.html#263252789">(Dec 01 2021 at 07:22)</a>:</h4>
<p>Idea that can do this but involves larger overall change to the language and compiler:</p>
<ol>
<li>Introduce associated macro as a new kind of associated item, but allowed on inherent impls only.</li>
<li>Add a special "associated macro" resolution, record usage when doing expansion.</li>
<li>Typecheck during analysis.</li>
</ol>



<a name="263252989"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/.postfix%20all%20the%20things/near/263252989" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Triplett <a href="https://zulip-archive.rust-lang.org/stream/213817-t-lang/topic/.2Epostfix.20all.20the.20things.html#263252989">(Dec 01 2021 at 07:25)</a>:</h4>
<p><span class="user-mention" data-user-id="116458">@Charles Lew</span> The first two of those sound a lot like type-based dispatch, which this was supposed to be simple enough to avoid.</p>



<a name="263253005"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/.postfix%20all%20the%20things/near/263253005" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Triplett <a href="https://zulip-archive.rust-lang.org/stream/213817-t-lang/topic/.2Epostfix.20all.20the.20things.html#263253005">(Dec 01 2021 at 07:25)</a>:</h4>
<p>(It's <em>simpler</em> type-based dispatch, since it only cares about &amp;/&amp;mut/owned, but it still sounds more complex than desired.)</p>



<a name="263253075"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/.postfix%20all%20the%20things/near/263253075" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Triplett <a href="https://zulip-archive.rust-lang.org/stream/213817-t-lang/topic/.2Epostfix.20all.20the.20things.html#263253075">(Dec 01 2021 at 07:26)</a>:</h4>
<p>Is there some reasonable way we could make this always look up by name alone, then substitute in code that leads to autoref during inference?</p>



<a name="263253457"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/.postfix%20all%20the%20things/near/263253457" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> scottmcm <a href="https://zulip-archive.rust-lang.org/stream/213817-t-lang/topic/.2Epostfix.20all.20the.20things.html#263253457">(Dec 01 2021 at 07:33)</a>:</h4>
<p>I don't think I have enough knowledge of where autoref happens in type checking to know how to phrase it.</p>



<a name="263253637"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/.postfix%20all%20the%20things/near/263253637" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> scottmcm <a href="https://zulip-archive.rust-lang.org/stream/213817-t-lang/topic/.2Epostfix.20all.20the.20things.html#263253637">(Dec 01 2021 at 07:36)</a>:</h4>
<p>Maybe this ties into the <code>let</code> vs <code>match</code> desugaring question?  If there was a kind of forwarding that preserved "place-ness" then it might happen naturally?</p>



<a name="263254176"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/.postfix%20all%20the%20things/near/263254176" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> scottmcm <a href="https://zulip-archive.rust-lang.org/stream/213817-t-lang/topic/.2Epostfix.20all.20the.20things.html#263254176">(Dec 01 2021 at 07:45)</a>:</h4>
<p>Hmm, if this only needed to support <code>&amp;mut self</code> and <code>&amp;self</code>, then I think we could do it as </p>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="k">match</span><span class="w"> </span><span class="o">&amp;</span><span class="k">mut</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="cp">$LHS</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="n">internal_temporary</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="cp">$RHS</span><span class="p">(</span><span class="o">*</span><span class="n">internal_temporary</span><span class="p">)</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>
</code></pre></div>
<p>because then it'd get passed a place that could be assigned to or autoref'd or whatever.</p>
<p>But of course that doesn't work for RHSs that want to move out of the LHS.</p>



<a name="263254285"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/.postfix%20all%20the%20things/near/263254285" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> scottmcm <a href="https://zulip-archive.rust-lang.org/stream/213817-t-lang/topic/.2Epostfix.20all.20the.20things.html#263254285">(Dec 01 2021 at 07:46)</a>:</h4>
<p>(Obviously I'm not going to <em>propose</em> <code>&amp;own</code> for this, but if we had that I think it would work to solve this.)</p>



<a name="263254477"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/.postfix%20all%20the%20things/near/263254477" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Charles Lew <a href="https://zulip-archive.rust-lang.org/stream/213817-t-lang/topic/.2Epostfix.20all.20the.20things.html#263254477">(Dec 01 2021 at 07:49)</a>:</h4>
<p><span class="user-mention silent" data-user-id="239881">Josh Triplett</span> <a href="#narrow/stream/213817-t-lang/topic/.2Epostfix.20all.20the.20things/near/263252989">said</a>:</p>
<blockquote>
<p><span class="user-mention silent" data-user-id="116458">Charles Lew</span> The first two of those sound a lot like type-based dispatch, which this was supposed to be simple enough to avoid.</p>
</blockquote>
<blockquote>
<p>Is there some reasonable way we could make this always look up by name alone, then substitute in code that leads to autoref during inference?</p>
</blockquote>
<p>Indeed this is type-based. (I thought auto-ref is fundamentally a type-level thing?) I meant these three steps as a whole. I think i'm trying to define it exactly this way, just naming it "associated macro" for surface syntax level consistency.</p>



<a name="263254799"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/.postfix%20all%20the%20things/near/263254799" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Charles Lew <a href="https://zulip-archive.rust-lang.org/stream/213817-t-lang/topic/.2Epostfix.20all.20the.20things.html#263254799">(Dec 01 2021 at 07:53)</a>:</h4>
<p><span class="user-mention silent" data-user-id="125270">scottmcm</span> <a href="#narrow/stream/213817-t-lang/topic/.2Epostfix.20all.20the.20things/near/263253457">said</a>:</p>
<blockquote>
<p>I don't think I have enough knowledge of where autoref happens in type checking to know how to phrase it.</p>
</blockquote>
<p>The reference corresponding part is here: <a href="https://doc.rust-lang.org/stable/reference/expressions/method-call-expr.html">https://doc.rust-lang.org/stable/reference/expressions/method-call-expr.html</a> It's defined as algorithm visiting impls, looking up associated items in a certain order.</p>



<a name="263256152"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/.postfix%20all%20the%20things/near/263256152" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Charles Lew <a href="https://zulip-archive.rust-lang.org/stream/213817-t-lang/topic/.2Epostfix.20all.20the.20things.html#263256152">(Dec 01 2021 at 08:10)</a>:</h4>
<p>I think this simple postfix macro doesn't need to deal with any autoref mechnaism. <code>$self:self</code> is fundamentally <code>$self:expr</code>, the expr might get evaluated many times within the macro body. It's the macro writer's job to get any necessary borrowing correct on each occurrence.</p>



<a name="263259653"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/.postfix%20all%20the%20things/near/263259653" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Mario Carneiro <a href="https://zulip-archive.rust-lang.org/stream/213817-t-lang/topic/.2Epostfix.20all.20the.20things.html#263259653">(Dec 01 2021 at 08:51)</a>:</h4>
<p><span class="user-mention" data-user-id="116458">@Charles Lew</span> As I understand it, that was explicitly <em>not</em> supposed to be the case for postfix macros; fancy evaluation semantics of something not even in the macro parens was considered confusing</p>



<a name="263311241"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/.postfix%20all%20the%20things/near/263311241" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Daniel Henry-Mantilla <a href="https://zulip-archive.rust-lang.org/stream/213817-t-lang/topic/.2Epostfix.20all.20the.20things.html#263311241">(Dec 01 2021 at 15:54)</a>:</h4>
<p>I think we are somehow missing a bit the comparisons to <code>.match</code>, which I think are quite nice to represent the lack of syntactical access to the <code>$self</code>, and make sense as the keystone of <code>.postfix</code>. That is, assuming the existence of <code>.match</code>, let's imagine unsugaring some of these things:</p>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="o">*</span><span class="n">indexable</span><span class="p">.</span><span class="n">first</span><span class="o">!</span><span class="p">()</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">42</span><span class="p">;</span><span class="w"></span>
<span class="c1">// becomes</span>
<span class="o">*</span><span class="n">indexable</span><span class="p">.</span><span class="k">match</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="k">ref</span><span class="w"> </span><span class="k">mut</span><span class="w"> </span><span class="n">slice</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="n">_</span>: <span class="p">[</span><span class="kt">u8</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">*</span><span class="n">slice</span><span class="p">;</span><span class="w"></span>
<span class="w">    </span><span class="o">&amp;</span><span class="k">mut</span><span class="w"> </span><span class="n">slice</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="w"></span>
<span class="p">}}</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">42</span><span class="p">;</span><span class="w"></span>
</code></pre></div>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="n">option</span><span class="p">.</span><span class="n">unwrap_or_else</span><span class="o">!</span><span class="p">(</span><span class="k">return</span><span class="p">)</span><span class="w"></span>
<span class="c1">// becomes (modulo qualified paths)</span>
<span class="n">option</span><span class="p">.</span><span class="k">match</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nb">None</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="k">return</span><span class="p">,</span><span class="w"> </span><span class="nb">Some</span><span class="p">(</span><span class="n">it</span><span class="p">)</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="n">it</span><span class="w"> </span><span class="p">}</span><span class="w"></span>
</code></pre></div>
<p>From there, it seems sensible to implement such as macros as:</p>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="fm">macro_rules!</span><span class="w"> </span><span class="n">unwrap_or_return</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w"> </span><span class="c1">// Feel free to bikeshed this syntax.</span>
<span class="w"> </span><span class="c1">// |                        Mandatory for postfix / receiver rules!</span>
<span class="w"> </span><span class="c1">// v                        vvvvvvvv</span>
<span class="w">    </span><span class="p">.(</span><span class="w"> </span><span class="cp">$else</span>:<span class="nc">expr</span><span class="w"> </span><span class="cp">$(,</span><span class="p">)</span><span class="o">?</span><span class="p">)</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="p">(.</span><span class="k">match</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">        </span><span class="nb">None</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="cp">$else</span><span class="p">,</span><span class="w"></span>
<span class="w">        </span><span class="nb">Some</span><span class="p">(</span><span class="n">it</span><span class="p">)</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="n">it</span><span class="p">,</span><span class="w"> </span><span class="c1">// &lt;- ownership works just fine!</span>
<span class="w">    </span><span class="p">});</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>

<span class="fm">macro_rules!</span><span class="w"> </span><span class="n">first</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="p">.()</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="p">(.</span><span class="k">match</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="k">ref</span><span class="w"> </span><span class="k">mut</span><span class="w"> </span><span class="n">slice</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">        </span><span class="kd">let</span><span class="w"> </span><span class="n">_</span>: <span class="p">[</span><span class="kt">u8</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">*</span><span class="n">slice</span><span class="p">;</span><span class="w"></span>
<span class="w">        </span><span class="o">&amp;</span><span class="k">mut</span><span class="w"> </span><span class="n">slice</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="w"></span>
<span class="w">    </span><span class="p">}});</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>
</code></pre></div>
<p>The key idea is kind of similar to that of <a href="https://internals.rust-lang.org/t/pre-rfc-a-value-matcher-for-macro-rules/14357"><code>$:value</code> matchers for macros</a> (why isn't that proposal mentioned more often in this thread? To me it looks like <code>:value</code> semantics are the starting point of any postfix proposal): <strong>we want to make sure the expression itself is evaluated, exactly once, and before the macro-expanded stuff happens</strong> (since violating any of these rules could lead to very confusing call-sites). With the <code>=&gt; (.match { â€¦ })</code> macro rule rhs, the receiver, syntactically, is never visible, sidestepping most of the questions that would otherwise arise. And, inversely, the only way to "eagerly bind" an expression (with potential temporaries) is with a <code>match</code> expression, so any <code>:value</code> or <code>:self</code> macro would have to require anyways that the rhs be of the form <code>match ($($values ,)*) { ($($bindings ,)*) =&gt; ( â€¦ )}</code> (that's how I'd implement <code>$thing:value</code> matchers, for instance):</p>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="k">match</span><span class="w"> </span><span class="cp">$thing</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">thing</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="err">â€¦</span><span class="w"> </span><span class="p">}}</span><span class="w"></span>
<span class="c1">// or</span>
<span class="k">match</span><span class="w"> </span><span class="cp">$thing</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="k">ref</span><span class="w"> </span><span class="k">mut</span><span class="w"> </span><span class="n">thing</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="err">â€¦</span><span class="w"> </span><span class="p">}}</span><span class="w"></span>
<span class="c1">// or</span>
<span class="k">match</span><span class="w"> </span><span class="cp">$thing</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="k">ref</span><span class="w"> </span><span class="n">thing</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="err">â€¦</span><span class="w"> </span><span class="p">}}</span><span class="w"></span>
</code></pre></div>
<p>But this is redundant / cumbersome, and "enforcing" such a rhs could be a bit weird (this is the main rough edge of <code>:value</code> matchers). But in the case of <code>$self</code>, both issues are sidestepped thanks to <code>.match</code> not having to mention the scrutinee.</p>
<p>Finally, the postfix macro, as implemented, would not be able to modify its "capture mode" of the receiver based on the type of the latter. While this could be viewed as a limitation of my proposal, it could actually be a healthy limitation: let's start off this limited API, and see where does that lead us. My claim is thus that with this approach, we'd have almost all of the benefits of postfix macros (we could already do so many things!), with almost none of the readability drawbacks (-&gt; <span class="user-mention" data-user-id="256841">@Nick Cameron</span>, regarding your "where does this 'method macro' come from" readability concern: if all the dot-macros were to be namespaced as free items, completely type agnostic in their expansion (<em>e.g.</em>, to mentally map <code>expr.foo!()</code> to <code>expr.match { foo!() }</code>), would that be that confusing? I think that while it could require some getting used to, such an adaptation period would in practice end up being quite short)</p>



<a name="263315777"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/.postfix%20all%20the%20things/near/263315777" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Triplett <a href="https://zulip-archive.rust-lang.org/stream/213817-t-lang/topic/.2Epostfix.20all.20the.20things.html#263315777">(Dec 01 2021 at 16:21)</a>:</h4>
<p>My only concern is what happens if you already have a &amp;mut and you call a macro that uses ref mut. You'd get a double reference.</p>



<a name="263317958"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/.postfix%20all%20the%20things/near/263317958" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Daniel Henry-Mantilla <a href="https://zulip-archive.rust-lang.org/stream/213817-t-lang/topic/.2Epostfix.20all.20the.20things.html#263317958">(Dec 01 2021 at 16:35)</a>:</h4>
<p>Since</p>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="k">fn</span> <span class="nf">foo</span><span class="p">(</span><span class="n">it</span>: <span class="kp">&amp;</span><span class="nc">mut</span><span class="w"> </span><span class="o">&amp;</span><span class="k">mut</span><span class="w"> </span><span class="o">&amp;</span><span class="k">mut</span><span class="w"> </span><span class="p">())</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="nb">drop</span>::<span class="o">&lt;&amp;</span><span class="k">mut</span><span class="w"> </span><span class="p">()</span><span class="o">&gt;</span><span class="p">(</span><span class="n">it</span><span class="p">)</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>
</code></pre></div>
<p>compiles fine (thanks to auto-deref) I wouldn't worry too much about that</p>



<hr><p>Last updated: Apr 12 2022 at 20:01 UTC</p>
</html>