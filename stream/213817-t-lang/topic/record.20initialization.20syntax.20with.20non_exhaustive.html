<html>
<head><meta charset="utf-8"><title>record initialization syntax with non_exhaustive · t-lang · Zulip Chat Archive</title></head>
<h2>Stream: <a href="https://zulip-archive.rust-lang.org/stream/213817-t-lang/index.html">t-lang</a></h2>
<h3>Topic: <a href="https://zulip-archive.rust-lang.org/stream/213817-t-lang/topic/record.20initialization.20syntax.20with.20non_exhaustive.html">record initialization syntax with non_exhaustive</a></h3>

<hr>

<base href="https://rust-lang.zulipchat.com">

<head><link href="https://zulip-archive.rust-lang.org/style.css" rel="stylesheet"></head>

<a name="278607974"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/record%20initialization%20syntax%20with%20non_exhaustive/near/278607974" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Manish Goregaokar <a href="https://zulip-archive.rust-lang.org/stream/213817-t-lang/topic/record.20initialization.20syntax.20with.20non_exhaustive.html#278607974">(Apr 11 2022 at 19:57)</a>:</h4>
<p>Hey, so I found <a href="https://internals.rust-lang.org/t/allow-constructing-non-exhaustive-structs-using-default-default/13868">https://internals.rust-lang.org/t/allow-constructing-non-exhaustive-structs-using-default-default/13868</a> , and seems like there's a lot of lang planning around record initialization syntax (and defaults), and there are a bunch of compat hazards.</p>
<p>OTOH, I don't see any similar issue around <code>non_exhaustive</code> allowing record initialization: is there a holdup here? does an RFC need to be written? TBH I consider this a bug in the <code>non_exhaustive</code> feature.</p>
<p>cc <span class="user-mention" data-user-id="119031">@Esteban Küber</span></p>



<a name="278615263"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/record%20initialization%20syntax%20with%20non_exhaustive/near/278615263" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Triplett <a href="https://zulip-archive.rust-lang.org/stream/213817-t-lang/topic/record.20initialization.20syntax.20with.20non_exhaustive.html#278615263">(Apr 11 2022 at 20:54)</a>:</h4>
<p><span class="user-mention" data-user-id="132040">@Manish Goregaokar</span> I believe that there are two holdups:</p>



<a name="278615408"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/record%20initialization%20syntax%20with%20non_exhaustive/near/278615408" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Triplett <a href="https://zulip-archive.rust-lang.org/stream/213817-t-lang/topic/record.20initialization.20syntax.20with.20non_exhaustive.html#278615408">(Apr 11 2022 at 20:55)</a>:</h4>
<p>First, this potentially interacts with defaults, and there are some complex interactions between defaults, initialization, and non_exhaustive, to the point where I think there needs to be a clear story for how those three fit together rather than trying to solve one of them in isolation. (We don't have to <em>fix</em> them all simultaneously, but the solution for one needs to make us feel confident in forwards-compatibility with what we may want to do with the others.)</p>



<a name="278615526"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/record%20initialization%20syntax%20with%20non_exhaustive/near/278615526" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Triplett <a href="https://zulip-archive.rust-lang.org/stream/213817-t-lang/topic/record.20initialization.20syntax.20with.20non_exhaustive.html#278615526">(Apr 11 2022 at 20:56)</a>:</h4>
<p>Second, the handling of non_exhaustive interacts with privacy, and there's disagreement about how initialization interacts with a struct that has private fields, and whether that should differ for code that has those fields visible vs code that doesn't. And in particular, that applies even for a struct that <em>currently</em> has only public fields, because in theory non_exhaustive could let you add a private field.</p>



<a name="278616017"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/record%20initialization%20syntax%20with%20non_exhaustive/near/278616017" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Triplett <a href="https://zulip-archive.rust-lang.org/stream/213817-t-lang/topic/record.20initialization.20syntax.20with.20non_exhaustive.html#278616017">(Apr 11 2022 at 21:00)</a>:</h4>
<p>I personally currently feel that you should never be able to write an initializer from scratch (as opposed to one with a base struct like <code>..Default::default()</code> or <code>..some_value</code>) for a struct that has private fields. I know that others disagree on that point, and feel that it should be possible to construct a struct that has private fields under some circumstances, such as if those private fields have defaults (which raises questions like "who are those defaults visible to").</p>



<a name="278637872"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/record%20initialization%20syntax%20with%20non_exhaustive/near/278637872" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> scottmcm <a href="https://zulip-archive.rust-lang.org/stream/213817-t-lang/topic/record.20initialization.20syntax.20with.20non_exhaustive.html#278637872">(Apr 12 2022 at 01:32)</a>:</h4>
<p><span class="user-mention silent" data-user-id="132040">Manish Goregaokar</span> <a href="#narrow/stream/213817-t-lang/topic/record.20initialization.20syntax.20with.20non_exhaustive/near/278607974">said</a>:</p>
<blockquote>
<p>OTOH, I don't see any similar issue around <code>non_exhaustive</code> allowing record initialization: is there a holdup here? does an RFC need to be written? TBH I consider this a bug in the <code>non_exhaustive</code> feature.</p>
</blockquote>
<p>I'm not sure exactly what you mean by "record initialization" here.  Is that something different from FRU?  Something specific to field-defaults?</p>



<a name="278714652"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/record%20initialization%20syntax%20with%20non_exhaustive/near/278714652" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Manish Goregaokar <a href="https://zulip-archive.rust-lang.org/stream/213817-t-lang/topic/record.20initialization.20syntax.20with.20non_exhaustive.html#278714652">(Apr 12 2022 at 16:06)</a>:</h4>
<p>no, i just mean FRU</p>



<a name="278724117"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/record%20initialization%20syntax%20with%20non_exhaustive/near/278724117" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Triplett <a href="https://zulip-archive.rust-lang.org/stream/213817-t-lang/topic/record.20initialization.20syntax.20with.20non_exhaustive.html#278724117">(Apr 12 2022 at 17:20)</a>:</h4>
<p><span class="user-mention" data-user-id="132040">@Manish Goregaokar</span> <a href="https://github.com/rust-lang/lang-team/issues/143">https://github.com/rust-lang/lang-team/issues/143</a> needs a new owner; interested?</p>



<a name="278725309"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/record%20initialization%20syntax%20with%20non_exhaustive/near/278725309" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Manish Goregaokar <a href="https://zulip-archive.rust-lang.org/stream/213817-t-lang/topic/record.20initialization.20syntax.20with.20non_exhaustive.html#278725309">(Apr 12 2022 at 17:30)</a>:</h4>
<p>i don't think i have time to do it myself, unfortunately</p>



<a name="278725355"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/record%20initialization%20syntax%20with%20non_exhaustive/near/278725355" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Triplett <a href="https://zulip-archive.rust-lang.org/stream/213817-t-lang/topic/record.20initialization.20syntax.20with.20non_exhaustive.html#278725355">(Apr 12 2022 at 17:30)</a>:</h4>
<p>Do you know someone who might have the bandwidth to own it?</p>



<a name="278725356"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/record%20initialization%20syntax%20with%20non_exhaustive/near/278725356" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Manish Goregaokar <a href="https://zulip-archive.rust-lang.org/stream/213817-t-lang/topic/record.20initialization.20syntax.20with.20non_exhaustive.html#278725356">(Apr 12 2022 at 17:30)</a>:</h4>
<p>i was def interested in working on a more scoped thing that's just non_exhaustive + FRU but this seems to be a larger design space</p>



<a name="278725380"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/record%20initialization%20syntax%20with%20non_exhaustive/near/278725380" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Manish Goregaokar <a href="https://zulip-archive.rust-lang.org/stream/213817-t-lang/topic/record.20initialization.20syntax.20with.20non_exhaustive.html#278725380">(Apr 12 2022 at 17:30)</a>:</h4>
<p>unsure!</p>



<a name="278725595"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/record%20initialization%20syntax%20with%20non_exhaustive/near/278725595" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Manish Goregaokar <a href="https://zulip-archive.rust-lang.org/stream/213817-t-lang/topic/record.20initialization.20syntax.20with.20non_exhaustive.html#278725595">(Apr 12 2022 at 17:32)</a>:</h4>
<p>i'll ask around but unlikely</p>



<hr><p>Last updated: Apr 12 2022 at 20:01 UTC</p>
</html>