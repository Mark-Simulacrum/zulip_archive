<html>
<head><meta charset="utf-8"><title>try blocks Â· t-lang Â· Zulip Chat Archive</title></head>
<h2>Stream: <a href="https://zulip-archive.rust-lang.org/stream/213817-t-lang/index.html">t-lang</a></h2>
<h3>Topic: <a href="https://zulip-archive.rust-lang.org/stream/213817-t-lang/topic/try.20blocks.html">try blocks</a></h3>

<hr>

<base href="https://rust-lang.zulipchat.com">

<head><link href="https://zulip-archive.rust-lang.org/style.css" rel="stylesheet"></head>

<a name="275117936"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/try%20blocks/near/275117936" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jacob Pratt ðŸ‡ºðŸ‡¦ <a href="https://zulip-archive.rust-lang.org/stream/213817-t-lang/topic/try.20blocks.html#275117936">(Mar 12 2022 at 21:24)</a>:</h4>
<p>Are there any blockers to <code>try</code> blocks (<a href="https://github.com/rust-lang/rust/issues/31436">#31436</a>) other than the question of inference? I think the benefit of having it could be quite a bit even if it couldn't be used without type annotations everywhere.</p>



<a name="275118306"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/try%20blocks/near/275118306" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> scottmcm <a href="https://zulip-archive.rust-lang.org/stream/213817-t-lang/topic/try.20blocks.html#275118306">(Mar 12 2022 at 21:35)</a>:</h4>
<p>The problem is that I think the vanilla form should do something different, which isn't a backwards-compatible change.</p>
<p>I've got an RFC started; I should try to get it to 1st draft this weekend...</p>



<a name="275118361"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/try%20blocks/near/275118361" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jacob Pratt ðŸ‡ºðŸ‡¦ <a href="https://zulip-archive.rust-lang.org/stream/213817-t-lang/topic/try.20blocks.html#275118361">(Mar 12 2022 at 21:36)</a>:</h4>
<p>What do you mean by "something different"? If it 's something that can be explained briefly.</p>



<a name="275118445"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/try%20blocks/near/275118445" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> scottmcm <a href="https://zulip-archive.rust-lang.org/stream/213817-t-lang/topic/try.20blocks.html#275118445">(Mar 12 2022 at 21:38)</a>:</h4>
<p>Something that uses the type of the argument to <code>?</code> inside the block to fully-determine the type of the <code>try</code> block, rather than depending on context.  Since that's necessary for <code>try { ... }.a_method()</code> to work, for example.</p>
<p>It will use the (currently unstable on nightly) <code>Residual</code> trait, like <a href="https://doc.rust-lang.org/std/iter/trait.Iterator.html#method.try_find">https://doc.rust-lang.org/std/iter/trait.Iterator.html#method.try_find</a> does</p>



<a name="275118525"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/try%20blocks/near/275118525" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jacob Pratt ðŸ‡ºðŸ‡¦ <a href="https://zulip-archive.rust-lang.org/stream/213817-t-lang/topic/try.20blocks.html#275118525">(Mar 12 2022 at 21:40)</a>:</h4>
<p>Basically setting a fallback for inference? I would definitely like that.</p>



<a name="275118598"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/try%20blocks/near/275118598" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> scottmcm <a href="https://zulip-archive.rust-lang.org/stream/213817-t-lang/topic/try.20blocks.html#275118598">(Mar 12 2022 at 21:42)</a>:</h4>
<p>Conceptually sortof, but not in actual implementation.  I don't want to block on the completely-unknown-whether-it's-possible idea of inference fallbacks.  So it's just a trait with an associated type, such that when you use <code>?</code> on an <code>Option</code>, it can use that trait to go "oh, you'd like one of these but holding a U?  Sure, here's an <code>Option&lt;U&gt;</code>".</p>



<a name="275118612"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/try%20blocks/near/275118612" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> scottmcm <a href="https://zulip-archive.rust-lang.org/stream/213817-t-lang/topic/try.20blocks.html#275118612">(Mar 12 2022 at 21:43)</a>:</h4>
<p>See the (rather long) return type in that <code>try_find</code> I linked.</p>



<a name="275118614"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/try%20blocks/near/275118614" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jacob Pratt ðŸ‡ºðŸ‡¦ <a href="https://zulip-archive.rust-lang.org/stream/213817-t-lang/topic/try.20blocks.html#275118614">(Mar 12 2022 at 21:43)</a>:</h4>
<p><span aria-label="+1" class="emoji emoji-1f44d" role="img" title="+1">:+1:</span></p>



<a name="275118688"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/try%20blocks/near/275118688" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> scottmcm <a href="https://zulip-archive.rust-lang.org/stream/213817-t-lang/topic/try.20blocks.html#275118688">(Mar 12 2022 at 21:46)</a>:</h4>
<p>(More specifically, <code>?</code> on an <code>Option&lt;T&gt;</code> splits it into a <code>T</code> and an <code>Option&lt;!&gt;</code>, and then there's a generic trait implemented for <code>Option&lt;!&gt;</code> so that it combines with a <code>U</code> to get <code>Option&lt;U&gt;</code> again.  <code>Iterator::try_fold</code> doesn't need this dance since it returns the same type that the closure does, but <code>try_find</code> has a closure that returns <code>Result&lt;bool, E&gt;</code> but the method wants to return <code>Result&lt;Option&lt;Item&gt;, E&gt;</code>.)</p>



<a name="275123124"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/try%20blocks/near/275123124" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Daniel Henry-Mantilla <a href="https://zulip-archive.rust-lang.org/stream/213817-t-lang/topic/try.20blocks.html#275123124">(Mar 12 2022 at 23:57)</a>:</h4>
<p>If that can help inference it would be quite nice indeed <span aria-label="ok" class="emoji emoji-1f44c" role="img" title="ok">:ok:</span> </p>
<div class="spoiler-block"><div class="spoiler-header">
<p>Bikeshed  / aside</p>
</div><div class="spoiler-content" aria-hidden="true">
<p>when I see <code>...Residual as Residual&lt;...&gt;</code> I don't feel like it reads very nicely / I always have to go back to the trait definitions, re-read some of them a couple times, until I remember that <code>Residual as Residual&lt;T&gt;</code> is actually sticking back a <code>T</code> as the <code>Output</code> of that "<code>Output</code>-less" <code>Residual</code>. So, what about: <code>WithOutput&lt;O&gt;</code>, <code>ChangeOutputTo&lt;O&gt;</code>, <code>IntoTryWithOutput&lt;O&gt;</code>, <code>WrapOutput&lt;O&gt;</code> or something like that instead?</p>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="sd">/// Currently</span>
<span class="k">fn</span> <span class="nf">try_find</span><span class="o">&lt;</span><span class="n">F</span><span class="p">,</span><span class="w"> </span><span class="n">R</span><span class="o">&gt;</span><span class="p">(</span><span class="w"></span>
<span class="w">    </span><span class="o">&amp;</span><span class="k">mut</span><span class="w"> </span><span class="bp">self</span><span class="p">,</span><span class="w"></span>
<span class="w">    </span><span class="n">f</span>: <span class="nc">F</span><span class="w"></span>
<span class="p">)</span><span class="w"> </span>-&gt; <span class="o">&lt;&lt;</span><span class="n">R</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="n">Try</span><span class="o">&gt;</span>::<span class="n">Residual</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="n">Residual</span><span class="o">&lt;</span><span class="nb">Option</span><span class="o">&lt;</span><span class="bp">Self</span>::<span class="n">Item</span><span class="o">&gt;&gt;&gt;</span>::<span class="n">TryType</span><span class="w"></span>
<span class="k">where</span><span class="w"></span>
<span class="w">    </span><span class="n">F</span>: <span class="nb">FnMut</span><span class="p">(</span><span class="o">&amp;</span><span class="bp">Self</span>::<span class="n">Item</span><span class="p">)</span><span class="w"> </span>-&gt; <span class="nc">R</span><span class="p">,</span><span class="w"></span>
<span class="w">    </span><span class="n">R</span>: <span class="nc">Try</span><span class="o">&lt;</span><span class="n">Output</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kt">bool</span><span class="o">&gt;</span><span class="p">,</span><span class="w"></span>
<span class="w">    </span><span class="o">&lt;</span><span class="n">R</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="n">Try</span><span class="o">&gt;</span>::<span class="n">Residual</span>: <span class="nc">Residual</span><span class="o">&lt;</span><span class="nb">Option</span><span class="o">&lt;</span><span class="bp">Self</span>::<span class="n">Item</span><span class="o">&gt;&gt;</span><span class="n">rs</span><span class="w"></span>

<span class="sd">/// Suggestion</span>
<span class="k">fn</span> <span class="nf">try_find</span><span class="o">&lt;</span><span class="n">F</span><span class="p">,</span><span class="w"> </span><span class="n">R</span><span class="o">&gt;</span><span class="p">(</span><span class="w"></span>
<span class="w">    </span><span class="o">&amp;</span><span class="k">mut</span><span class="w"> </span><span class="bp">self</span><span class="p">,</span><span class="w"></span>
<span class="w">    </span><span class="n">f</span>: <span class="nc">F</span><span class="w"></span>
<span class="p">)</span><span class="w"> </span>-&gt; <span class="o">&lt;</span><span class="n">R</span>::<span class="n">Residual</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="n">WrapOutput</span><span class="o">&lt;</span><span class="nb">Option</span><span class="o">&lt;</span><span class="bp">Self</span>::<span class="n">Item</span><span class="o">&gt;&gt;&gt;</span>::<span class="n">TryType</span><span class="w"></span>
<span class="k">where</span><span class="w"></span>
<span class="w">    </span><span class="n">F</span>: <span class="nb">FnMut</span><span class="p">(</span><span class="o">&amp;</span><span class="bp">Self</span>::<span class="n">Item</span><span class="p">)</span><span class="w"> </span>-&gt; <span class="nc">R</span><span class="p">,</span><span class="w"></span>
<span class="w">    </span><span class="n">R</span>: <span class="nc">Try</span><span class="o">&lt;</span><span class="n">Output</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kt">bool</span><span class="o">&gt;</span><span class="p">,</span><span class="w"></span>
<span class="w">    </span><span class="n">R</span>::<span class="n">Residual</span>: <span class="nc">WrapOutput</span><span class="o">&lt;</span><span class="nb">Option</span><span class="o">&lt;</span><span class="bp">Self</span>::<span class="n">Item</span><span class="o">&gt;&gt;</span><span class="p">,</span><span class="w"></span>
</code></pre></div>
</div></div>



<a name="275126453"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/try%20blocks/near/275126453" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> scottmcm <a href="https://zulip-archive.rust-lang.org/stream/213817-t-lang/topic/try.20blocks.html#275126453">(Mar 13 2022 at 01:30)</a>:</h4>
<p>re the aside: please leave that in the trait's tracking issue, <a href="https://github.com/rust-lang/rust/issues/91285">#91285</a> .  I'm always in favour of better names.  (And names are still an open question for TryV2 too, like <a href="https://github.com/rust-lang/rust/issues/84277#issuecomment-1035922689">https://github.com/rust-lang/rust/issues/84277#issuecomment-1035922689</a> )</p>



<a name="275766941"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/try%20blocks/near/275766941" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> scottmcm <a href="https://zulip-archive.rust-lang.org/stream/213817-t-lang/topic/try.20blocks.html#275766941">(Mar 18 2022 at 07:14)</a>:</h4>
<p><span class="user-mention" data-user-id="245610">@Jacob Pratt ðŸ‡ºðŸ‡¦</span> Well, I was overly optimistic once again, but here's what I've got so far:</p>
<p><a href="https://github.com/scottmcm/rfcs/blob/try-again/text/0000-resolving-try-annotations.md#summary">https://github.com/scottmcm/rfcs/blob/try-again/text/0000-resolving-try-annotations.md#summary</a></p>
<p>Still needs drawbacks and rationales and such.  If you have any questions or suggestions, please let me know as they can make good sections <span aria-label="smile" class="emoji emoji-1f642" role="img" title="smile">:smile:</span> </p>
<p>It's also using <a href="https://unicodesnowmanforyou.com/"><code>â˜ƒ</code></a> as a bikeshed-avoidance token.  Please concentrate on the semantics, folks, and leave discussion for what token should go there for later.</p>



<a name="275767082"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/try%20blocks/near/275767082" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jacob Pratt ðŸ‡ºðŸ‡¦ <a href="https://zulip-archive.rust-lang.org/stream/213817-t-lang/topic/try.20blocks.html#275767082">(Mar 18 2022 at 07:18)</a>:</h4>
<p>I'll take a look at it in the morning. Looking forward to the infamous snowman.</p>



<a name="275866707"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/try%20blocks/near/275866707" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> The 8472 <a href="https://zulip-archive.rust-lang.org/stream/213817-t-lang/topic/try.20blocks.html#275866707">(Mar 18 2022 at 21:45)</a>:</h4>
<p>Wouldn't the snowman variant just be type ascription?</p>



<a name="275869803"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/try%20blocks/near/275869803" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> scottmcm <a href="https://zulip-archive.rust-lang.org/stream/213817-t-lang/topic/try.20blocks.html#275869803">(Mar 18 2022 at 22:22)</a>:</h4>
<p><span class="user-mention silent" data-user-id="330154">The 8472</span> <a href="#narrow/stream/213817-t-lang/topic/try.20blocks/near/275866707">said</a>:</p>
<blockquote>
<p>Wouldn't the snowman variant just be type ascription?</p>
</blockquote>
<p><code>let x = try â˜ƒ T { ... stuff ... };</code> and <code>let x: T = try { ... stuff ... };</code> do different things, so no, not exactly.</p>



<a name="275870267"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/try%20blocks/near/275870267" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jacob Pratt ðŸ‡ºðŸ‡¦ <a href="https://zulip-archive.rust-lang.org/stream/213817-t-lang/topic/try.20blocks.html#275870267">(Mar 18 2022 at 22:29)</a>:</h4>
<p>If the desugaring works (I trust you did your due diligence), then I think this looks good.</p>



<a name="275870385"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/try%20blocks/near/275870385" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jacob Pratt ðŸ‡ºðŸ‡¦ <a href="https://zulip-archive.rust-lang.org/stream/213817-t-lang/topic/try.20blocks.html#275870385">(Mar 18 2022 at 22:30)</a>:</h4>
<p>For snowman-building, I'd say something turbofish-like would make sense. <code>let x = try::&lt;_&gt; { â€¦ };</code>, or omitting the <code>::</code> because it's not syntactically necessary I believe: <code>let x = try&lt;_&gt; { â€¦ };</code></p>



<a name="275871045"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/try%20blocks/near/275871045" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Triplett <a href="https://zulip-archive.rust-lang.org/stream/213817-t-lang/topic/try.20blocks.html#275871045">(Mar 18 2022 at 22:38)</a>:</h4>
<p>Oh, interesting! I haven't seen that suggestion before, and I think it looks good.</p>



<a name="275871052"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/try%20blocks/near/275871052" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Triplett <a href="https://zulip-archive.rust-lang.org/stream/213817-t-lang/topic/try.20blocks.html#275871052">(Mar 18 2022 at 22:38)</a>:</h4>
<p>It allows knowledge transfer from people's existing understanding of turbofish.</p>



<a name="275871080"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/try%20blocks/near/275871080" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jacob Pratt ðŸ‡ºðŸ‡¦ <a href="https://zulip-archive.rust-lang.org/stream/213817-t-lang/topic/try.20blocks.html#275871080">(Mar 18 2022 at 22:39)</a>:</h4>
<p>Precisely. I honestly don't know what else could possibly make sense in that place.</p>



<a name="275871307"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/try%20blocks/near/275871307" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> cuviper <a href="https://zulip-archive.rust-lang.org/stream/213817-t-lang/topic/try.20blocks.html#275871307">(Mar 18 2022 at 22:42)</a>:</h4>
<p><code>try -&gt; T { ... }</code></p>



<a name="275871365"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/try%20blocks/near/275871365" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jacob Pratt ðŸ‡ºðŸ‡¦ <a href="https://zulip-archive.rust-lang.org/stream/213817-t-lang/topic/try.20blocks.html#275871365">(Mar 18 2022 at 22:43)</a>:</h4>
<p>Is there anywhere outside of function/closure return types where that syntax is used to indicate types?</p>



<a name="275871563"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/try%20blocks/near/275871563" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> cuviper <a href="https://zulip-archive.rust-lang.org/stream/213817-t-lang/topic/try.20blocks.html#275871563">(Mar 18 2022 at 22:45)</a>:</h4>
<p>not that I know of, but I could imagine it for <code>async</code> blocks too</p>



<a name="275871582"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/try%20blocks/near/275871582" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jacob Pratt ðŸ‡ºðŸ‡¦ <a href="https://zulip-archive.rust-lang.org/stream/213817-t-lang/topic/try.20blocks.html#275871582">(Mar 18 2022 at 22:45)</a>:</h4>
<p>True; the syntax would likely end up being the same.</p>



<a name="275873982"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/try%20blocks/near/275873982" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> scottmcm <a href="https://zulip-archive.rust-lang.org/stream/213817-t-lang/topic/try.20blocks.html#275873982">(Mar 18 2022 at 23:18)</a>:</h4>
<p><span class="user-mention silent" data-user-id="245610">Jacob Pratt ðŸ‡ºðŸ‡¦</span> <a href="#narrow/stream/213817-t-lang/topic/try.20blocks/near/275870267">said</a>:</p>
<blockquote>
<p>If the desugaring works [...]</p>
</blockquote>
<p>If you want to play with it a bit, here's the playground I was using to make sure: &lt;<a href="https://play.rust-lang.org/?version=nightly&amp;mode=debug&amp;edition=2021&amp;gist=1d23417d06d1abb109da548df9024e54">https://play.rust-lang.org/?version=nightly&amp;mode=debug&amp;edition=2021&amp;gist=1d23417d06d1abb109da548df9024e54</a>&gt;</p>



<a name="275882748"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/try%20blocks/near/275882748" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> David Hewitt <a href="https://zulip-archive.rust-lang.org/stream/213817-t-lang/topic/try.20blocks.html#275882748">(Mar 19 2022 at 02:01)</a>:</h4>
<p><code>try -&gt; T</code> was my first thought for the snowman too</p>



<a name="275882893"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/try%20blocks/near/275882893" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> David Hewitt <a href="https://zulip-archive.rust-lang.org/stream/213817-t-lang/topic/try.20blocks.html#275882893">(Mar 19 2022 at 02:04)</a>:</h4>
<p>It fits really nicely into closure syntax <code>|x| try -&gt; Result&lt;Foo&gt; { ... }</code></p>



<a name="275883475"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/try%20blocks/near/275883475" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> scottmcm <a href="https://zulip-archive.rust-lang.org/stream/213817-t-lang/topic/try.20blocks.html#275883475">(Mar 19 2022 at 02:16)</a>:</h4>
<p>Note that it's useless there, though.  <code>|x| -&gt; Result&lt;Foo&gt; { ... }</code> does exactly the same thing as <code>|x| try â˜ƒ Result&lt;Foo&gt; { ... }</code>, so there's no need to ever write the latter -- it's just longer for no reason.</p>



<a name="275883691"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/try%20blocks/near/275883691" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> scottmcm <a href="https://zulip-archive.rust-lang.org/stream/213817-t-lang/topic/try.20blocks.html#275883691">(Mar 19 2022 at 02:21)</a>:</h4>
<p>Tangentially, that's one of the things I like about new desugaring -- it means that top-level (un-annotated) <code>try{ ... }</code> becomes actually useful.</p>



<a name="275884399"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/try%20blocks/near/275884399" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> David Hewitt <a href="https://zulip-archive.rust-lang.org/stream/213817-t-lang/topic/try.20blocks.html#275884399">(Mar 19 2022 at 02:37)</a>:</h4>
<p>I think there is a difference in ok-wrapping? i.e. <code>|x| -&gt; Result&lt;_, !&gt; { Ok(x) }</code> vs <code>|x| try â˜ƒ Result&lt;_, !&gt; { x }</code></p>



<a name="275885085"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/try%20blocks/near/275885085" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> scottmcm <a href="https://zulip-archive.rust-lang.org/stream/213817-t-lang/topic/try.20blocks.html#275885085">(Mar 19 2022 at 02:52)</a>:</h4>
<p>Oh, that's right.  I guess that's a reason to use the latter.</p>



<a name="275885168"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/try%20blocks/near/275885168" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> scottmcm <a href="https://zulip-archive.rust-lang.org/stream/213817-t-lang/topic/try.20blocks.html#275885168">(Mar 19 2022 at 02:55)</a>:</h4>
<p>That also gets into the whole <code>async || { ... }</code> vs <code>|| async { ... }</code> conversation -- arguably <code>try || { ... }</code> vs <code>|| try { ... }</code> should analogously exist too, though they don't today.</p>



<a name="275885413"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/try%20blocks/near/275885413" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> David Hewitt <a href="https://zulip-archive.rust-lang.org/stream/213817-t-lang/topic/try.20blocks.html#275885413">(Mar 19 2022 at 03:01)</a>:</h4>
<p>Continuing that thought to <code>async fn</code> and <code>try fn</code>, a complication of using <code>-&gt;</code> would be you'd imagine people would start asking for the same kind of structure for normal functions to get ok-wrapping, something like <code>fn(x: i32) try -&gt; Result&lt;i32, !&gt; { x }</code>. Unclear to me if that's desirable even if the syntax would suggest it.</p>



<a name="275885931"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/try%20blocks/near/275885931" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> David Hewitt <a href="https://zulip-archive.rust-lang.org/stream/213817-t-lang/topic/try.20blocks.html#275885931">(Mar 19 2022 at 03:15)</a>:</h4>
<p><code>try || { ... }</code> vs <code>|| try { ... }</code> - where would snowman go in the first form? <code>try â˜ƒ Result&lt;_, !&gt; |x| { x }</code>, presumably. With <code>-&gt;</code> I'd be tempted to split it and have <code>try |x| -&gt; Result&lt;_, !&gt; { x }</code> enable the Into desugaring.</p>
<p>At least, that makes sense to me as long as there's no semantic difference in how <code>try || { ... }</code> vs <code>|| try { ... }</code> would behave.</p>



<a name="275886009"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/try%20blocks/near/275886009" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Triplett <a href="https://zulip-archive.rust-lang.org/stream/213817-t-lang/topic/try.20blocks.html#275886009">(Mar 19 2022 at 03:17)</a>:</h4>
<p><span class="user-mention" data-user-id="249430">@David Hewitt</span> I would expect to spell that <code>|x| -&gt; Result&lt;...&gt; { try { ... } }</code>.</p>



<a name="275886056"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/try%20blocks/near/275886056" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Triplett <a href="https://zulip-archive.rust-lang.org/stream/213817-t-lang/topic/try.20blocks.html#275886056">(Mar 19 2022 at 03:18)</a>:</h4>
<p>Or if need be <code>|x| try&lt;Result&lt;...&gt;&gt; { ... }</code>.</p>



<a name="275886568"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/try%20blocks/near/275886568" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> David Hewitt <a href="https://zulip-archive.rust-lang.org/stream/213817-t-lang/topic/try.20blocks.html#275886568">(Mar 19 2022 at 03:31)</a>:</h4>
<p>I think in this proposal those two aren't equivalent? <code>|x| -&gt; Result&lt;...&gt; { try { ... } }</code> would use the "inference-friendly" <code>?</code> desugaring, <code>|x| try&lt;Result&lt;...&gt;&gt; { ... }</code> would use the current desugaring.</p>
<p>That seems like a good reason to not use <code>-&gt;</code> for the snowman; <code>|| -&gt; Result&lt;...&gt; try { ... }</code> and <code>|| try -&gt; Result&lt;...&gt; { ... }</code> look very similar but would have different desugaring of <code>?</code> inside the block.</p>
<p>EDIT: above <code>|| -&gt; Result&lt;...&gt; try { ... }</code> isn't legal syntax. It would have to be <code>|| -&gt; Result&lt;...&gt; { try { ... } }</code>. So I hold my opinion that <code>-&gt;</code> seems a good fit.</p>



<a name="275886626"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/try%20blocks/near/275886626" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Triplett <a href="https://zulip-archive.rust-lang.org/stream/213817-t-lang/topic/try.20blocks.html#275886626">(Mar 19 2022 at 03:32)</a>:</h4>
<p>That was what I meant by "if need be"; the desugaring of <code>try</code> was the difference between the two cases I posted.</p>



<a name="275886636"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/try%20blocks/near/275886636" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Triplett <a href="https://zulip-archive.rust-lang.org/stream/213817-t-lang/topic/try.20blocks.html#275886636">(Mar 19 2022 at 03:33)</a>:</h4>
<p>But I don't think either case motivates a <code>try ||</code> syntax.</p>



<a name="275886699"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/try%20blocks/near/275886699" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> David Hewitt <a href="https://zulip-archive.rust-lang.org/stream/213817-t-lang/topic/try.20blocks.html#275886699">(Mar 19 2022 at 03:34)</a>:</h4>
<p>Right <span aria-label="+1" class="emoji emoji-1f44d" role="img" title="+1">:+1:</span></p>



<a name="275887101"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/try%20blocks/near/275887101" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> David Hewitt <a href="https://zulip-archive.rust-lang.org/stream/213817-t-lang/topic/try.20blocks.html#275887101">(Mar 19 2022 at 03:44)</a>:</h4>
<p>Corrected my comment above. Agree with you that <code>try ||</code> doesn't seem necessary.</p>



<a name="275887163"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/try%20blocks/near/275887163" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Triplett <a href="https://zulip-archive.rust-lang.org/stream/213817-t-lang/topic/try.20blocks.html#275887163">(Mar 19 2022 at 03:46)</a>:</h4>
<p>For top-level functions, there's a rationale: it avoids writing an extra set of braces. But since closures don't require braces, that's not an issue here.</p>



<a name="275887232"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/try%20blocks/near/275887232" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> David Hewitt <a href="https://zulip-archive.rust-lang.org/stream/213817-t-lang/topic/try.20blocks.html#275887232">(Mar 19 2022 at 03:48)</a>:</h4>
<p>Yep absolutely. That's why I wondered how this syntax might interact with <code>try fn</code></p>



<a name="275887302"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/try%20blocks/near/275887302" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Triplett <a href="https://zulip-archive.rust-lang.org/stream/213817-t-lang/topic/try.20blocks.html#275887302">(Mar 19 2022 at 03:50)</a>:</h4>
<p>(Tangent: for the purposes of avoiding braces, I'm still finding the <code>fn func() -&gt; Type = try { ... }</code> syntax growing on me.)</p>



<a name="275887394"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/try%20blocks/near/275887394" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> David Hewitt <a href="https://zulip-archive.rust-lang.org/stream/213817-t-lang/topic/try.20blocks.html#275887394">(Mar 19 2022 at 03:53)</a>:</h4>
<p>Would it need to be <code>fn func() -&gt; Type = try â˜ƒ Type { ... }</code> to get "normal" <code>?</code> desugaring under this proposal?</p>



<a name="275887440"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/try%20blocks/near/275887440" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> David Hewitt <a href="https://zulip-archive.rust-lang.org/stream/213817-t-lang/topic/try.20blocks.html#275887440">(Mar 19 2022 at 03:54)</a>:</h4>
<p>Given that <code>try { ... }</code> in other contexts would lead to non-converting desugaring.</p>



<a name="275887609"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/try%20blocks/near/275887609" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> David Hewitt <a href="https://zulip-archive.rust-lang.org/stream/213817-t-lang/topic/try.20blocks.html#275887609">(Mar 19 2022 at 03:59)</a>:</h4>
<p>(That's why with <code>-&gt;</code> snowman it seems to me like this collapses cleanly to <code>fn func() try -&gt; Type { ... }</code>. I'm unconvinced I love <code>try</code> in that position despite the consistency.)</p>



<a name="275889309"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/try%20blocks/near/275889309" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> scottmcm <a href="https://zulip-archive.rust-lang.org/stream/213817-t-lang/topic/try.20blocks.html#275889309">(Mar 19 2022 at 04:43)</a>:</h4>
<p><code>fn func() -&gt; Type = try â˜ƒ _ { ... }</code> would be fine.</p>
<p><span class="user-mention silent" data-user-id="249430">David Hewitt</span> <a href="#narrow/stream/213817-t-lang/topic/try.20blocks/near/275886568">said</a>:</p>
<blockquote>
<p>That seems like a good reason to not use <code>-&gt;</code> for the snowman; <code>|| -&gt; Result&lt;...&gt; try { ... }</code> and <code>|| try -&gt; Result&lt;...&gt; { ... }</code> look very similar but would have different desugaring of <code>?</code> inside the block.</p>
</blockquote>
<p>This is my primary thought when it comes to <code>â˜ƒ</code>.  Since <code>try â˜ƒ _ { ... }</code> and <code>try { ... }</code> do different things, I think it's important that <code>â˜ƒ</code> <em>not</em> be something where <code>â˜ƒ _</code> is commonly the same as leaving it off.</p>
<p>That, to me, argues against a bunch of common options.  For example, <code>try&lt;_&gt; {</code> or <code>try::&lt;_&gt;</code> where mentioned, but I'm not a fan since <code>foo()</code> and <code>foo::&lt;_&gt;()</code> do the same thing (assuming <code>foo</code> has exactly one generic parameter).  Type ascription was also mentioned, but <code>let x: _ =</code> and <code>let x =</code> are equivalent, so I don't think <code>try:_{</code> and <code>try{</code> being different would be good.</p>
<p><span class="user-mention silent" data-user-id="116009">nikomatsakis</span>'s <a href="https://github.com/rust-lang/rust/issues/70941#issuecomment-612167041">instinct here</a> was <code>try as _</code>, which <em>does</em> pass the test, since <code>foo()</code> and <code>foo() as _</code> are often not equivalent.</p>
<p>EDIT: Oh, looks like Niko's use of <code>try as</code> is older than that -- <a href="https://github.com/rust-lang/rfcs/pull/2388#issuecomment-378750364">here's a comment from 4 years ago</a> also using it, in the "reserve <code>try</code>" RFC.</p>



<a name="275889421"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/try%20blocks/near/275889421" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Triplett <a href="https://zulip-archive.rust-lang.org/stream/213817-t-lang/topic/try.20blocks.html#275889421">(Mar 19 2022 at 04:46)</a>:</h4>
<p>I'm trying (heh) to not break the minimal-change approach to improving <code>try</code> here, but the possible snowman syntaxes feel really confusing to me.</p>



<a name="275889432"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/try%20blocks/near/275889432" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Triplett <a href="https://zulip-archive.rust-lang.org/stream/213817-t-lang/topic/try.20blocks.html#275889432">(Mar 19 2022 at 04:47)</a>:</h4>
<p>In the current state of the various evaluated alternatives, is it that it's <em>impossible</em> to make <code>try</code> do inference that gives "priority" to the outer type rather than the inner, or is it that it's <em>hard</em>?</p>



<a name="275889473"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/try%20blocks/near/275889473" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Triplett <a href="https://zulip-archive.rust-lang.org/stream/213817-t-lang/topic/try.20blocks.html#275889473">(Mar 19 2022 at 04:48)</a>:</h4>
<p>FWIW, I had been assuming that <code>try&lt;_&gt; {</code> <em>would</em> be the same as <code>try {</code>.</p>



<a name="275889596"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/try%20blocks/near/275889596" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> scottmcm <a href="https://zulip-archive.rust-lang.org/stream/213817-t-lang/topic/try.20blocks.html#275889596">(Mar 19 2022 at 04:52)</a>:</h4>
<p>I think it depends on the mythical "type inference defaults" stuff, but that doesn't exist and AFAIK isn't designed, so I don't know whether it'd work to solve this.</p>



<a name="275889664"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/try%20blocks/near/275889664" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Triplett <a href="https://zulip-archive.rust-lang.org/stream/213817-t-lang/topic/try.20blocks.html#275889664">(Mar 19 2022 at 04:54)</a>:</h4>
<p>So, I have a kinda awful proposal.</p>



<a name="275889677"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/try%20blocks/near/275889677" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> scottmcm <a href="https://zulip-archive.rust-lang.org/stream/213817-t-lang/topic/try.20blocks.html#275889677">(Mar 19 2022 at 04:55)</a>:</h4>
<p>And because of how method resolution works, anything that cares about the context is going to have trouble with <code>try { ... }.foo()</code>.</p>



<a name="275889730"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/try%20blocks/near/275889730" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Triplett <a href="https://zulip-archive.rust-lang.org/stream/213817-t-lang/topic/try.20blocks.html#275889730">(Mar 19 2022 at 04:56)</a>:</h4>
<p>If, hypothetically, we think we <em>might</em> be able to make <code>try</code> do better inference in the future, but not soon, we could <em>just</em> support your proposed <code>try</code>/<code>?</code> desugaring without adding any snowman-syntax, and add a special case for try directly within an expression that gives it a concrete type (e.g. <code>let var: Result&lt;...&gt; = try {</code></p>



<a name="275889735"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/try%20blocks/near/275889735" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Triplett <a href="https://zulip-archive.rust-lang.org/stream/213817-t-lang/topic/try.20blocks.html#275889735">(Mar 19 2022 at 04:56)</a>:</h4>
<p>Effectively a small subset of the desired inference.</p>



<a name="275889753"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/try%20blocks/near/275889753" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Triplett <a href="https://zulip-archive.rust-lang.org/stream/213817-t-lang/topic/try.20blocks.html#275889753">(Mar 19 2022 at 04:57)</a>:</h4>
<p>I think part of my concern here is that the proposed <code>try</code>/<code>?</code> desugaring doesn't seem forwards-compatible with better inference?</p>



<a name="275889760"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/try%20blocks/near/275889760" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Triplett <a href="https://zulip-archive.rust-lang.org/stream/213817-t-lang/topic/try.20blocks.html#275889760">(Mar 19 2022 at 04:57)</a>:</h4>
<p>Unless I'm missing something.</p>



<a name="275889983"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/try%20blocks/near/275889983" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> scottmcm <a href="https://zulip-archive.rust-lang.org/stream/213817-t-lang/topic/try.20blocks.html#275889983">(Mar 19 2022 at 05:00)</a>:</h4>
<p>I'd be totally game to <em>only</em> have the un-annotated <code>try</code> with the new desugaring.  We could always start with that and leave another form to the future.</p>
<p>I really don't like special-casing <code>try</code> in an annotated <code>let</code>, though.  That breaks the "you can put it in a local" thing that otherwise always works for typeck.  (It might make borrowck fail because of lifetimes, but the types work out.)</p>



<a name="275890074"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/try%20blocks/near/275890074" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Triplett <a href="https://zulip-archive.rust-lang.org/stream/213817-t-lang/topic/try.20blocks.html#275890074">(Mar 19 2022 at 05:02)</a>:</h4>
<p>No argument there; I said "kinda awful proposal" for a reason. :)</p>



<a name="275890086"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/try%20blocks/near/275890086" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Triplett <a href="https://zulip-archive.rust-lang.org/stream/213817-t-lang/topic/try.20blocks.html#275890086">(Mar 19 2022 at 05:03)</a>:</h4>
<p>But yeah, adding <em>just</em> the alternate desugaring and not having an escape hatch seems forwards-compatible.</p>



<a name="275890170"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/try%20blocks/near/275890170" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> scottmcm <a href="https://zulip-archive.rust-lang.org/stream/213817-t-lang/topic/try.20blocks.html#275890170">(Mar 19 2022 at 05:04)</a>:</h4>
<p><span class="user-mention silent" data-user-id="239881">Josh Triplett</span> <a href="#narrow/stream/213817-t-lang/topic/try.20blocks/near/275889753">said</a>:</p>
<blockquote>
<p>I think part of my concern here is that the proposed <code>try</code>/<code>?</code> desugaring doesn't seem forwards-compatible with better inference?</p>
</blockquote>
<p>It's really just a type ascription in the desugaring, so I think it'd be mostly fine.</p>
<p>The change to the <code>?</code> desugaring is essentially</p>
<div class="codehilite" data-code-language="Diff"><pre><span></span><code><span class="w"> </span>match Try::branch(x) {<span class="w"></span>
<span class="w"> </span>    ControlFlow::Continue(v) =&gt; v,<span class="w"></span>
<span class="gd">-    ControlFlow::Break(r) =&gt; break 'try FromResidual::from_residual(r),</span><span class="w"></span>
<span class="gi">+    ControlFlow::Break(r) =&gt; break 'try FromResidual::from_residual(r) : SpecialAnnotationHere,</span><span class="w"></span>
<span class="w"> </span>}<span class="w"></span>
</code></pre></div>
<p>So it really is just a matter of how that type gets picked.</p>



<a name="275890240"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/try%20blocks/near/275890240" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> scottmcm <a href="https://zulip-archive.rust-lang.org/stream/213817-t-lang/topic/try.20blocks.html#275890240">(Mar 19 2022 at 05:06)</a>:</h4>
<p>I don't know that it'd necessarily be 100% inside-an-edition compatible, but I think that we could definitely remove that hint over an edition boundary without requiring any code changes to the vast majority of cases.</p>



<a name="275890302"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/try%20blocks/near/275890302" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> scottmcm <a href="https://zulip-archive.rust-lang.org/stream/213817-t-lang/topic/try.20blocks.html#275890302">(Mar 19 2022 at 05:08)</a>:</h4>
<p>If nothing else, it could migrate code using that to <code>try â˜ƒ WhateverTheActualTypeIs {</code> 100% reliably, as it's <code>FromResidual::from_residual</code> either way, so the behaviour is guaranteed to be the same for that case.</p>



<a name="275890726"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/try%20blocks/near/275890726" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> scottmcm <a href="https://zulip-archive.rust-lang.org/stream/213817-t-lang/topic/try.20blocks.html#275890726">(Mar 19 2022 at 05:20)</a>:</h4>
<p><span class="user-mention silent" data-user-id="239881">Josh Triplett</span> <a href="#narrow/stream/213817-t-lang/topic/try.20blocks/near/275890086">said</a>:</p>
<blockquote>
<p>But yeah, adding <em>just</em> the alternate desugaring and not having an escape hatch seems forwards-compatible.</p>
</blockquote>
<p>Hmm, come to think of it, this is the easy part to prototype, since it doesn't touch the parser at all.</p>
<p>If it then turns out that all (or nearly so) of the uses in the compiler code pass with the restrictive form, that might be good evidence that the non-annotated version is useful enough on its own to just add.</p>
<p>(Though the annotated form opens a whole bunch of interesting possibilities, like <code>fn foo() { try â˜ƒ IgnoreErrors { ... code here using ? ... } }</code> for the "can I use <code>?</code> in a <code>-&gt; ()</code> function?" questions that come up a bunch on URLO.)</p>



<a name="275890820"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/try%20blocks/near/275890820" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> David Hewitt <a href="https://zulip-archive.rust-lang.org/stream/213817-t-lang/topic/try.20blocks.html#275890820">(Mar 19 2022 at 05:23)</a>:</h4>
<p>I got the impression that the snowman escape hatch is desirable to give users of existing try blocks on nightly a migration path?</p>



<a name="275890874"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/try%20blocks/near/275890874" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> David Hewitt <a href="https://zulip-archive.rust-lang.org/stream/213817-t-lang/topic/try.20blocks.html#275890874">(Mar 19 2022 at 05:24)</a>:</h4>
<p><code>try as</code> seems good to me, as it's a verb we already use for conversion (which is what the snowman is enabling).</p>



<a name="275892852"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/try%20blocks/near/275892852" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> scottmcm <a href="https://zulip-archive.rust-lang.org/stream/213817-t-lang/topic/try.20blocks.html#275892852">(Mar 19 2022 at 06:15)</a>:</h4>
<p>Note that because <code>try</code> is a keyword, <code>â˜ƒ</code> doesn't even need to be a keyword.  I do like <code>as</code>, but if we want some other token like <code>try using anyhow::Result { ... }</code> that would work too.</p>



<a name="275904384"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/try%20blocks/near/275904384" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> scottmcm <a href="https://zulip-archive.rust-lang.org/stream/213817-t-lang/topic/try.20blocks.html#275904384">(Mar 19 2022 at 11:05)</a>:</h4>
<p>Well, I implemented it: <a href="https://github.com/scottmcm/rust/commit/9484aba9bd707dedf49b5d8622cecd53f03b8797">https://github.com/scottmcm/rust/commit/9484aba9bd707dedf49b5d8622cecd53f03b8797</a></p>
<p>It turns out that 17 of the 18 <code>try</code> blocks in the compiler are totally fine without error conversion in <code>?</code>.</p>
<p>And the one exception would actually be solved with a primitive <code>yeet</code> instead of the <code>Err(...)?</code> hack: <a href="https://github.com/scottmcm/rust/blob/9484aba9bd707dedf49b5d8622cecd53f03b8797/compiler/rustc_const_eval/src/interpret/terminator.rs#L456">https://github.com/scottmcm/rust/blob/9484aba9bd707dedf49b5d8622cecd53f03b8797/compiler/rustc_const_eval/src/interpret/terminator.rs#L456</a></p>



<a name="275924463"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/try%20blocks/near/275924463" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> RalfJ <a href="https://zulip-archive.rust-lang.org/stream/213817-t-lang/topic/try.20blocks.html#275924463">(Mar 19 2022 at 19:03)</a>:</h4>
<p><span class="user-mention silent" data-user-id="125270">scottmcm</span> <a href="#narrow/stream/213817-t-lang/topic/try.20blocks/near/275766941">said</a>:</p>
<blockquote>
<p><span class="user-mention silent" data-user-id="245610">Jacob Pratt ðŸ‡ºðŸ‡¦</span> Well, I was overly optimistic once again, but here's what I've got so far:</p>
<p><a href="https://github.com/scottmcm/rfcs/blob/try-again/text/0000-resolving-try-annotations.md#summary">https://github.com/scottmcm/rfcs/blob/try-again/text/0000-resolving-try-annotations.md#summary</a></p>
</blockquote>
<p>this example is missing a crucial <code>?</code>:</p>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="kd">let</span><span class="w"> </span><span class="n">pair_result</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kr">try</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">std</span>::<span class="n">fs</span>::<span class="n">read_to_string</span><span class="p">(</span><span class="s">"hello"</span><span class="p">)</span><span class="o">?</span><span class="p">;</span><span class="w"></span>
<span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="n">b</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">std</span>::<span class="n">fs</span>::<span class="n">read_to_string</span><span class="p">(</span><span class="s">"world"</span><span class="p">)</span><span class="o">?</span><span class="p">;</span><span class="w"></span>
<span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="n">c</span>: <span class="kt">i32</span> <span class="o">=</span><span class="w"> </span><span class="n">b</span><span class="p">.</span><span class="n">parse</span><span class="p">();</span><span class="w"> </span><span class="c1">// &lt;-- missing right here</span>
<span class="w">    </span><span class="p">(</span><span class="n">a</span><span class="p">,</span><span class="w"> </span><span class="n">c</span><span class="p">)</span><span class="w"></span>
<span class="p">};</span><span class="w"></span>
</code></pre></div>
<p>(and again a few paragraphs down, with the snowman)</p>



<a name="275929844"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/try%20blocks/near/275929844" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> scottmcm <a href="https://zulip-archive.rust-lang.org/stream/213817-t-lang/topic/try.20blocks.html#275929844">(Mar 19 2022 at 21:10)</a>:</h4>
<p>Thanks, <span class="user-mention silent" data-user-id="120791">RalfJ</span>!  Looks like I remembered it in the error, but not the code example, oops.  Fixed.</p>



<a name="275930704"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/try%20blocks/near/275930704" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Daniel Henry-Mantilla <a href="https://zulip-archive.rust-lang.org/stream/213817-t-lang/topic/try.20blocks.html#275930704">(Mar 19 2022 at 21:32)</a>:</h4>
<p>I like the suggested semantics very much, and the idea that <code>try</code> unannotated feature a "best-effort" semantic rather than our current <code>_</code> semantics. Nice!</p>
<hr>
<p>Now, i know you warned against syntax bikeshed, but in my defense it looks like it's too late and we may already be there, given the history of the discussion <span aria-label="sweat smile" class="emoji emoji-1f605" role="img" title="sweat smile">:sweat_smile:</span></p>
<p>So, in that regard, would simple "inner" ascription be a decent candidate?</p>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="kd">let</span><span class="w"> </span><span class="n">pair_result</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kr">try</span>: <span class="nb">Result</span><span class="o">&lt;</span><span class="n">_</span><span class="p">,</span><span class="w"> </span><span class="nb">Box</span><span class="o">&lt;</span><span class="k">dyn</span><span class="w"> </span><span class="n">std</span>::<span class="n">error</span>::<span class="n">Error</span><span class="o">&gt;&gt;</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">std</span>::<span class="n">fs</span>::<span class="n">read_to_string</span><span class="p">(</span><span class="s">"hello"</span><span class="p">)</span><span class="o">?</span><span class="p">;</span><span class="w"></span>
<span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="n">b</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">std</span>::<span class="n">fs</span>::<span class="n">read_to_string</span><span class="p">(</span><span class="s">"world"</span><span class="p">)</span><span class="o">?</span><span class="p">;</span><span class="w"></span>
<span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="n">c</span>: <span class="kt">i32</span> <span class="o">=</span><span class="w"> </span><span class="n">b</span><span class="p">.</span><span class="n">parse</span><span class="p">()</span><span class="o">?</span><span class="p">;</span><span class="w"></span>
<span class="w">    </span><span class="p">(</span><span class="n">a</span><span class="p">,</span><span class="w"> </span><span class="n">c</span><span class="p">)</span><span class="w"></span>
<span class="p">};</span><span class="w"></span>
</code></pre></div>
<ul>
<li>
<p>Indeed,  for some reason <code>try as</code> does not sound right to my ears; I guess it's because <code>as</code> involves an idea of <em>forced coercion</em>, where here we're just talking of a very gentle type inference nudging.</p>
</li>
<li>
<p>and regarding <code>try -&gt;</code>, it's not great either (although preferable to <code>as</code>, imho), since arrows have, historically, a quite heavy functional taint attached to them, which could suggest / hint at the idea of a <em>suspension</em> within the <code>try</code> block, which is very much not the case (contrary to closures or <code>async</code>).</p>
</li>
<li>
<p>The turbofish would be the other very nice candidate, imho (semantically unambiguous) â€” but it's true that it's syntactically a tad more heavyweight than <code>:</code></p>
</li>
</ul>



<a name="275933421"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/try%20blocks/near/275933421" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> scottmcm <a href="https://zulip-archive.rust-lang.org/stream/213817-t-lang/topic/try.20blocks.html#275933421">(Mar 19 2022 at 22:28)</a>:</h4>
<p><span class="user-mention" data-user-id="232018">@Daniel Henry-Mantilla</span> <a href="#narrow/stream/213817-t-lang/topic/try.20blocks/near/275930704">said</a>:</p>
<blockquote>
<p>I like the suggested semantics very much, and the idea that <code>try</code> unannotated feature a "best-effort" semantic rather than our current <code>_</code> semantics. Nice!</p>
</blockquote>
<p>Thanks!</p>
<blockquote>
<p>Now, i know you warned against syntax bikeshed, but in my defense it looks like it's too late and we may already be there, given the history of the discussion <span aria-label="sweat smile" class="emoji emoji-1f605" role="img" title="sweat smile">:sweat_smile:</span></p>
</blockquote>
<p>Yeah, sadly.</p>
<blockquote>
<p>So, in that regard, would simple "inner" ascription be a decent candidate?</p>
</blockquote>
<p>I mention that one in<br>
<a href="#narrow/stream/213817-t-lang/topic/try.20blocks/near/275889309">https://rust-lang.zulipchat.com/#narrow/stream/213817-t-lang/topic/try.20blocks/near/275889309</a></p>
<blockquote>
<p>I guess it's because <code>as</code> involves an idea of <em>forced coercion</em>, where here we're just talking of a very gentle type inference nudging.</p>
</blockquote>
<p>I think it's important to look at the <em>effect</em> of that nudging.  Because in the new desugaring for the non-annotated case, a <code>Result&lt;_, E&gt;</code> can only become a <code>Result&lt;_, E&gt;</code> -- no transformation is applied to the error value at all.  While the difference in the desugaring is just a type nudge, the <code>â˜ƒ Result&lt;_, F&gt;</code> annotation is causing <code>F::from(e)</code> to be called in every <code>?</code> .  Which is why I think "forced" conversion is at least somewhat appropriate.</p>
<p>I suppose one could lean into that by picking something like <code>try into Result&lt;_, Box&lt;dyn std::error::Error&gt;&gt; { ... }</code> for <code>â˜ƒ</code>.  (Though that then starts to look like <code>try_into</code>, which might also be a bad parallel.)</p>



<a name="275937238"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/try%20blocks/near/275937238" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Daniel Henry-Mantilla <a href="https://zulip-archive.rust-lang.org/stream/213817-t-lang/topic/try.20blocks.html#275937238">(Mar 20 2022 at 00:06)</a>:</h4>
<p>I think that the distinction of <code>_</code> vs nothing that you pointed out already (which I overlooked when skimming, my bad) is indeed a good argument against <code>:</code> (with all that considered, maybe the argument against <code>try -&gt;</code> and "lazy or not" evaluation is the mootest of them all, that is to say I recant my objection in that regard)</p>



<a name="275945948"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/try%20blocks/near/275945948" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jacob Pratt ðŸ‡ºðŸ‡¦ <a href="https://zulip-archive.rust-lang.org/stream/213817-t-lang/topic/try.20blocks.html#275945948">(Mar 20 2022 at 04:01)</a>:</h4>
<p><span class="user-mention silent" data-user-id="232018">Daniel Henry-Mantilla</span> <a href="#narrow/stream/213817-t-lang/topic/try.20blocks/near/275930704">said</a>:</p>
<blockquote>
<p>i know you warned against syntax bikeshed, but in my defense it looks like it's too late and we may already be there, given the history of the discussion</p>
</blockquote>
<p>I think that's because it's quite clear that <em>something</em> should be done here, so we may as well move ahead to bikeshedding <span aria-label="shrug" class="emoji emoji-1f937" role="img" title="shrug">:shrug:</span></p>



<a name="276104672"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/try%20blocks/near/276104672" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/213817-t-lang/topic/try.20blocks.html#276104672">(Mar 21 2022 at 19:51)</a>:</h4>
<p><span class="user-mention" data-user-id="125270">@scottmcm</span> I'm skimming the link you gave, is the tl;dr that <code>?</code> inside of <code>try</code> does not use <code>From</code>?</p>



<a name="276104686"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/try%20blocks/near/276104686" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/213817-t-lang/topic/try.20blocks.html#276104686">(Mar 21 2022 at 19:51)</a>:</h4>
<p>(unless you manually annotate)</p>



<a name="276106127"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/try%20blocks/near/276106127" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> scottmcm <a href="https://zulip-archive.rust-lang.org/stream/213817-t-lang/topic/try.20blocks.html#276106127">(Mar 21 2022 at 20:03)</a>:</h4>
<p><span class="user-mention" data-user-id="116009">@nikomatsakis</span> Yes.</p>
<p>The slightly longer TLDR is that it blocks all interoperations, so if you'd made a <code>MyResult</code> (that's not just a type alias for <code>Result</code>) that wouldn't be allowed either.</p>



<a name="276106226"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/try%20blocks/near/276106226" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/213817-t-lang/topic/try.20blocks.html#276106226">(Mar 21 2022 at 20:04)</a>:</h4>
<p>OK. I'm not sure what an "interoperation" is</p>



<a name="276106240"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/try%20blocks/near/276106240" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/213817-t-lang/topic/try.20blocks.html#276106240">(Mar 21 2022 at 20:04)</a>:</h4>
<p>this is probably a reasonable step to take</p>



<a name="276106357"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/try%20blocks/near/276106357" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> scottmcm <a href="https://zulip-archive.rust-lang.org/stream/213817-t-lang/topic/try.20blocks.html#276106357">(Mar 21 2022 at 20:05)</a>:</h4>
<p>You can make a <code>NikoResult</code> that implements <code>FromResidual&lt;Option&lt;!&gt;&gt;</code>, and that would allow <code>?</code> on <code>Option</code>s inside something returning <code>NikoResult</code>.  That wouldn't be allowed here; <code>?</code> on <code>Option</code>s would <em>only</em> give back <code>Option</code>s.  (Unless you used the annotated version that allows the generality again.)</p>



<a name="276106516"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/try%20blocks/near/276106516" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> scottmcm <a href="https://zulip-archive.rust-lang.org/stream/213817-t-lang/topic/try.20blocks.html#276106516">(Mar 21 2022 at 20:06)</a>:</h4>
<p>Said otherwise, there's more freedom than <em>just</em> the <code>From</code>.  So it blocks that freedom too.</p>



<a name="276110594"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/try%20blocks/near/276110594" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Nick Cameron <a href="https://zulip-archive.rust-lang.org/stream/213817-t-lang/topic/try.20blocks.html#276110594">(Mar 21 2022 at 20:43)</a>:</h4>
<p>Sorry for the tangent, but Iâ€™ve often wondered if we should have some convenient syntax for â€˜intoâ€™ conversions, which might help here (convenient as in less noisy to read/write but also letâ€™s you easily specify the target type)</p>



<a name="276111181"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/try%20blocks/near/276111181" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Triplett <a href="https://zulip-archive.rust-lang.org/stream/213817-t-lang/topic/try.20blocks.html#276111181">(Mar 21 2022 at 20:48)</a>:</h4>
<p><span aria-label="+1" class="emoji emoji-1f44d" role="img" title="+1">:+1:</span>, I've wanted something equivalent to <code>.into::&lt;Type&gt;()</code> for a while.</p>



<a name="276112116"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/try%20blocks/near/276112116" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jacob Pratt <a href="https://zulip-archive.rust-lang.org/stream/213817-t-lang/topic/try.20blocks.html#276112116">(Mar 21 2022 at 20:55)</a>:</h4>
<p>I'm pretty sure everyone has wanted that on a number of occasions.</p>



<a name="276118998"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/try%20blocks/near/276118998" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> bstrie <a href="https://zulip-archive.rust-lang.org/stream/213817-t-lang/topic/try.20blocks.html#276118998">(Mar 21 2022 at 21:52)</a>:</h4>
<p>overloadable <code>as</code> :P</p>



<a name="276120944"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/try%20blocks/near/276120944" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jules Bertholet <a href="https://zulip-archive.rust-lang.org/stream/213817-t-lang/topic/try.20blocks.html#276120944">(Mar 21 2022 at 22:14)</a>:</h4>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="k">pub</span><span class="w"> </span><span class="k">trait</span><span class="w"> </span><span class="n">To</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="k">fn</span> <span class="nf">to</span><span class="o">&lt;</span><span class="n">Dest</span><span class="o">&gt;</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span><span class="w"> </span>-&gt; <span class="nc">Dest</span><span class="w"> </span><span class="k">where</span><span class="w"> </span><span class="bp">Self</span>: <span class="nb">Into</span><span class="o">&lt;</span><span class="n">Dest</span><span class="o">&gt;</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">        </span><span class="o">&lt;</span><span class="bp">Self</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nb">Into</span><span class="o">&lt;</span><span class="n">Dest</span><span class="o">&gt;&gt;</span>::<span class="n">into</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span><span class="w"></span>
<span class="w">    </span><span class="p">}</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>

<span class="k">impl</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;</span><span class="w"> </span><span class="n">To</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="n">T</span><span class="w"> </span><span class="p">{}</span><span class="w"></span>

<span class="k">fn</span> <span class="nf">main</span><span class="p">()</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="n">a</span>: <span class="kt">u8</span> <span class="o">=</span><span class="w"> </span><span class="mi">3</span><span class="p">;</span><span class="w"></span>
<span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="n">b</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">a</span><span class="p">.</span><span class="n">to</span>::<span class="o">&lt;</span><span class="kt">u16</span><span class="o">&gt;</span><span class="p">();</span><span class="w"></span>
<span class="w">    </span><span class="fm">println!</span><span class="p">(</span><span class="s">"{}"</span><span class="p">,</span><span class="w"> </span><span class="n">b</span><span class="p">)</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>
</code></pre></div>
<p><a href="https://play.rust-lang.org/?edition=2021&amp;gist=c7605f7eb605f56788942c26505907a6">https://play.rust-lang.org/?edition=2021&amp;gist=c7605f7eb605f56788942c26505907a6</a></p>



<a name="276820787"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/try%20blocks/near/276820787" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> scottmcm <a href="https://zulip-archive.rust-lang.org/stream/213817-t-lang/topic/try.20blocks.html#276820787">(Mar 28 2022 at 02:35)</a>:</h4>
<p>I've been thinking more about this, and about the feedback here.</p>
<p>I realized I've been thinking too narrowly about this.  I had mentally restricted myself to <code>â˜ƒ</code> being a single token, but of course that's not actually a requirement.</p>
<p>The "why not <code>:</code>?"feedback is common, and TBH I'd like using <code>:</code> for types best.  But there's an obvious way we can do that while still making it different: add a <em>different</em> token for that.</p>
<p>Concretely, we could have </p>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="kr">try</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="o">..</span><span class="p">.</span><span class="w"> </span><span class="p">}</span><span class="w"></span>
</code></pre></div>
<p>be the new way (and possibly allow <code>try : Foo { ... }</code> as well if we wanted, though it's not terribly useful there)</p>
<p>But then have both of these exist for the other way:</p>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="kr">try</span><span class="w"> </span><span class="err">â˜ƒ</span>: <span class="nc">Foo</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="o">..</span><span class="p">.</span><span class="w"> </span><span class="p">}</span><span class="w"></span>
<span class="kr">try</span><span class="w"> </span><span class="err">â˜ƒ</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="o">..</span><span class="p">.</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="c1">// same as `try â˜ƒ: _ { ... }`</span>
</code></pre></div>
<p>Where <code>â˜ƒ</code> is again a placeholder.  For a "too verbose, please invent something better" strawman, it could for example be </p>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="kr">try</span><span class="w"> </span><span class="n">with</span><span class="w"> </span><span class="n">conversions</span><span class="w"> </span>: <span class="nc">anyhow</span>::<span class="nb">Result</span><span class="o">&lt;</span><span class="n">_</span><span class="o">&gt;</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="o">..</span><span class="p">.</span><span class="w"> </span><span class="p">}</span><span class="w"></span>
</code></pre></div>
<p>How would people feel about that variation?</p>



<a name="276820845"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/try%20blocks/near/276820845" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> scottmcm <a href="https://zulip-archive.rust-lang.org/stream/213817-t-lang/topic/try.20blocks.html#276820845">(Mar 28 2022 at 02:37)</a>:</h4>
<p>(Or the other order could work too, still without reserving extra keywords, like <code>converting try : anyhow::Result&lt;_&gt; { ... }</code>.)</p>



<a name="276823107"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/try%20blocks/near/276823107" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jane Lusby [she/her] <a href="https://zulip-archive.rust-lang.org/stream/213817-t-lang/topic/try.20blocks.html#276823107">(Mar 28 2022 at 03:11)</a>:</h4>
<blockquote>
<p>how would people feel about that variation?</p>
</blockquote>
<p>Initial reaction is "that's way too long"</p>



<a name="276823434"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/try%20blocks/near/276823434" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jane Lusby [she/her] <a href="https://zulip-archive.rust-lang.org/stream/213817-t-lang/topic/try.20blocks.html#276823434">(Mar 28 2022 at 03:18)</a>:</h4>
<p>Debating throwing more paint at the bikeshed or not</p>



<a name="276823438"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/try%20blocks/near/276823438" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jane Lusby [she/her] <a href="https://zulip-archive.rust-lang.org/stream/213817-t-lang/topic/try.20blocks.html#276823438">(Mar 28 2022 at 03:19)</a>:</h4>
<p>Yolo</p>



<a name="276823456"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/try%20blocks/near/276823456" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jane Lusby [she/her] <a href="https://zulip-archive.rust-lang.org/stream/213817-t-lang/topic/try.20blocks.html#276823456">(Mar 28 2022 at 03:19)</a>:</h4>
<p>Monad brain be like <code>try within anyhow::Result&lt;_&gt; {}</code></p>



<a name="276873456"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/try%20blocks/near/276873456" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> RalfJ <a href="https://zulip-archive.rust-lang.org/stream/213817-t-lang/topic/try.20blocks.html#276873456">(Mar 28 2022 at 13:33)</a>:</h4>
<p><code>try into anyhow::Result&lt;_&gt; {}</code>?</p>



<a name="276886413"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/try%20blocks/near/276886413" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Triplett <a href="https://zulip-archive.rust-lang.org/stream/213817-t-lang/topic/try.20blocks.html#276886413">(Mar 28 2022 at 15:01)</a>:</h4>
<p><span class="user-mention" data-user-id="120791">@RalfJ</span> That came up earlier in the thread, but it has the issue of being confusingly similar to <code>tty_into</code>.</p>



<a name="276900367"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/try%20blocks/near/276900367" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Christopher Durham <a href="https://zulip-archive.rust-lang.org/stream/213817-t-lang/topic/try.20blocks.html#276900367">(Mar 28 2022 at 16:40)</a>:</h4>
<p><code>try in</code> works with monad brain</p>



<a name="276900765"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/try%20blocks/near/276900765" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jane Lusby [she/her] <a href="https://zulip-archive.rust-lang.org/stream/213817-t-lang/topic/try.20blocks.html#276900765">(Mar 28 2022 at 16:43)</a>:</h4>
<p><span class="user-mention silent" data-user-id="132829">Christopher Durham</span> <a href="#narrow/stream/213817-t-lang/topic/try.20blocks/near/276900367">said</a>:</p>
<blockquote>
<p><code>try in</code> works with monad brain</p>
</blockquote>
<p>it also works with effect systems brain</p>



<a name="276900786"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/try%20blocks/near/276900786" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jane Lusby [she/her] <a href="https://zulip-archive.rust-lang.org/stream/213817-t-lang/topic/try.20blocks.html#276900786">(Mar 28 2022 at 16:43)</a>:</h4>
<p>and is vaguely consistent with <code>for _ in _</code></p>



<a name="276903053"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/try%20blocks/near/276903053" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> RalfJ <a href="https://zulip-archive.rust-lang.org/stream/213817-t-lang/topic/try.20blocks.html#276903053">(Mar 28 2022 at 17:00)</a>:</h4>
<p><span class="user-mention silent" data-user-id="220273">Jane Lusby [she/her]</span> <a href="#narrow/stream/213817-t-lang/topic/try.20blocks/near/276900786">said</a>:</p>
<blockquote>
<p>and is vaguely consistent with <code>for _ in _</code></p>
</blockquote>
<p>is it? in <code>for</code>, there's an expression after <code>in</code>, whereas with <code>try in</code> it's a type...</p>



<a name="276903157"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/try%20blocks/near/276903157" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> The 8472 <a href="https://zulip-archive.rust-lang.org/stream/213817-t-lang/topic/try.20blocks.html#276903157">(Mar 28 2022 at 17:01)</a>:</h4>
<p>I think the placement operator is still reserved.</p>



<a name="276903430"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/try%20blocks/near/276903430" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> cuviper <a href="https://zulip-archive.rust-lang.org/stream/213817-t-lang/topic/try.20blocks.html#276903430">(Mar 28 2022 at 17:03)</a>:</h4>
<p><code>try as Foo { ... }</code> ?</p>



<a name="276903532"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/try%20blocks/near/276903532" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> cuviper <a href="https://zulip-archive.rust-lang.org/stream/213817-t-lang/topic/try.20blocks.html#276903532">(Mar 28 2022 at 17:03)</a>:</h4>
<p>oh I guess that was mentioned already</p>



<a name="276904341"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/try%20blocks/near/276904341" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jane Lusby [she/her] <a href="https://zulip-archive.rust-lang.org/stream/213817-t-lang/topic/try.20blocks.html#276904341">(Mar 28 2022 at 17:10)</a>:</h4>
<p><span class="user-mention silent" data-user-id="120791">RalfJ</span> <a href="#narrow/stream/213817-t-lang/topic/try.20blocks/near/276903053">said</a>:</p>
<blockquote>
<p><span class="user-mention silent" data-user-id="220273">Jane Lusby [she/her]</span> <a href="#narrow/stream/213817-t-lang/topic/try.20blocks/near/276900786">said</a>:</p>
<blockquote>
<p>and is vaguely consistent with <code>for _ in _</code></p>
</blockquote>
<p>is it? in <code>for</code>, there's an expression after <code>in</code>, whereas with <code>try in</code> it's a type...</p>
</blockquote>
<p>yea, like I said it's only vaguely similar. The best framing I can come up with is that for is operating inside of an existing value and try is operating inside of a value yet to be constructed</p>



<a name="276910961"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/try%20blocks/near/276910961" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> scottmcm <a href="https://zulip-archive.rust-lang.org/stream/213817-t-lang/topic/try.20blocks.html#276910961">(Mar 28 2022 at 18:07)</a>:</h4>
<p>I think <code>try {}</code> vs <code>try as _ {}</code> <em>is</em> my favourite of that form, <span class="user-mention silent" data-user-id="138448">cuviper</span>.  Like how <code>box e</code> and <code>box e as _</code> do slightly things.</p>



<a name="276911007"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/try%20blocks/near/276911007" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> scottmcm <a href="https://zulip-archive.rust-lang.org/stream/213817-t-lang/topic/try.20blocks.html#276911007">(Mar 28 2022 at 18:07)</a>:</h4>
<p><code>try mixed { ... }</code> vs <code>try { ... }</code>?</p>



<a name="276915038"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/try%20blocks/near/276915038" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jane Lusby [she/her] <a href="https://zulip-archive.rust-lang.org/stream/213817-t-lang/topic/try.20blocks.html#276915038">(Mar 28 2022 at 18:41)</a>:</h4>
<p><span class="user-mention silent" data-user-id="125270">scottmcm</span> <a href="#narrow/stream/213817-t-lang/topic/try.20blocks/near/276911007">said</a>:</p>
<blockquote>
<p><code>try mixed { ... }</code> vs <code>try { ... }</code>?</p>
</blockquote>
<p>you lost me on this one, what is try mixed?</p>



<a name="276915124"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/try%20blocks/near/276915124" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jane Lusby [she/her] <a href="https://zulip-archive.rust-lang.org/stream/213817-t-lang/topic/try.20blocks.html#276915124">(Mar 28 2022 at 18:42)</a>:</h4>
<p>my confusion may be all the answer you needed to your question, lol</p>



<a name="276920537"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/try%20blocks/near/276920537" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> scottmcm <a href="https://zulip-archive.rust-lang.org/stream/213817-t-lang/topic/try.20blocks.html#276920537">(Mar 28 2022 at 19:31)</a>:</h4>
<p>Well, as in heterogeneous try vs homogeneous try.</p>
<p>But <code>try heterogeneous : anyhow::Result&lt;_&gt; { ... }</code> is definitely too long :P</p>



<a name="276920699"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/try%20blocks/near/276920699" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jane Lusby [she/her] <a href="https://zulip-archive.rust-lang.org/stream/213817-t-lang/topic/try.20blocks.html#276920699">(Mar 28 2022 at 19:32)</a>:</h4>
<p>ah, but the mixed one would still have to include a type</p>



<a name="276920719"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/try%20blocks/near/276920719" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jane Lusby [she/her] <a href="https://zulip-archive.rust-lang.org/stream/213817-t-lang/topic/try.20blocks.html#276920719">(Mar 28 2022 at 19:32)</a>:</h4>
<p>you just left it out for brevity in your example</p>



<a name="276921117"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/try%20blocks/near/276921117" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> scottmcm <a href="https://zulip-archive.rust-lang.org/stream/213817-t-lang/topic/try.20blocks.html#276921117">(Mar 28 2022 at 19:36)</a>:</h4>
<p>Well, having the extra word means that it <em>could</em> just be <code>try heterogeneous  { ... }</code>, and it would behave like <code>try heterogeneous : _ { ... }</code>.</p>
<p>So if you wanted to write </p>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="kd">let</span><span class="w"> </span><span class="n">x</span>: <span class="nc">anyhow</span>::<span class="nb">Result</span><span class="o">&lt;</span><span class="n">_</span><span class="o">&gt;</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kr">try</span><span class="w"> </span><span class="n">heterogeneous</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="o">..</span><span class="p">.</span><span class="w"> </span><span class="p">};</span><span class="w"></span>
</code></pre></div>
<p>instead, you could.</p>
<p>I don't have a good intuition right now of how often someone would end up wanting <code>try as _ {</code> in that version of it -- if it's rare that's fine, if it's common then the version where the type hint is separate from the semantic change might be better.</p>
<p>(Hopefully I'm clearer this time.)</p>



<a name="276921468"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/try%20blocks/near/276921468" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jane Lusby [she/her] <a href="https://zulip-archive.rust-lang.org/stream/213817-t-lang/topic/try.20blocks.html#276921468">(Mar 28 2022 at 19:39)</a>:</h4>
<p>oh I quite like that</p>



<a name="276921681"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/try%20blocks/near/276921681" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jane Lusby [she/her] <a href="https://zulip-archive.rust-lang.org/stream/213817-t-lang/topic/try.20blocks.html#276921681">(Mar 28 2022 at 19:41)</a>:</h4>
<p>laughing at some of these</p>



<a name="276921728"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/try%20blocks/near/276921728" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jane Lusby [she/her] <a href="https://zulip-archive.rust-lang.org/stream/213817-t-lang/topic/try.20blocks.html#276921728">(Mar 28 2022 at 19:42)</a>:</h4>
<blockquote>
<p>Synonyms for heterogeneous<br>
   assorted, eclectic, indiscriminate, kitchen-sink, magpie, miscellaneous, mixed, motley, patchwork, piebald, promiscuous, raggle-taggle, ragtag, varied</p>
</blockquote>



<a name="276921766"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/try%20blocks/near/276921766" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jane Lusby [she/her] <a href="https://zulip-archive.rust-lang.org/stream/213817-t-lang/topic/try.20blocks.html#276921766">(Mar 28 2022 at 19:42)</a>:</h4>
<p>mixed really does seem like the best option (if not the most fun)</p>



<a name="276921989"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/try%20blocks/near/276921989" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Thom Chiovoloni <a href="https://zulip-archive.rust-lang.org/stream/213817-t-lang/topic/try.20blocks.html#276921989">(Mar 28 2022 at 19:45)</a>:</h4>
<p>my vote is for <code>try raggle-taggle { ... }</code>, the most fun option. It does bring up the issue of the <code>-</code> though... can a keyword have a hyphen <span aria-label="thinking" class="emoji emoji-1f914" role="img" title="thinking">:thinking:</span></p>



<a name="276924974"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/try%20blocks/near/276924974" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> scottmcm <a href="https://zulip-archive.rust-lang.org/stream/213817-t-lang/topic/try.20blocks.html#276924974">(Mar 28 2022 at 20:11)</a>:</h4>
<p>Whatever we put here doesn't need to be a keyword -- it's hidden by the <code>try</code> keyword, so the only restrictions are:</p>
<ul>
<li>doesn't have <code>{</code></li>
<li>doesn't have <code>:</code></li>
<li>doesn't have unbalanced token tree delimiters</li>
</ul>



<a name="276925484"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/try%20blocks/near/276925484" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> scottmcm <a href="https://zulip-archive.rust-lang.org/stream/213817-t-lang/topic/try.20blocks.html#276925484">(Mar 28 2022 at 20:14)</a>:</h4>
<p>(<code>mixed try { ... }</code> could work too, though a prefix means lookahead to find the <code>try</code>, so for that one I wouldn't want it to be <code>some long &amp; complicated try { ... }</code>, even though it'd "work".  That doesn't have the same parsing implications if it's a suffix.)</p>



<a name="276925792"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/try%20blocks/near/276925792" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> scottmcm <a href="https://zulip-archive.rust-lang.org/stream/213817-t-lang/topic/try.20blocks.html#276925792">(Mar 28 2022 at 20:16)</a>:</h4>
<p>(<code>try but long &amp; complicated {</code> is still LL(1), I think <span aria-label="smiling devil" class="emoji emoji-1f608" role="img" title="smiling devil">:smiling_devil:</span>)</p>



<a name="276928244"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/try%20blocks/near/276928244" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> mejrs <a href="https://zulip-archive.rust-lang.org/stream/213817-t-lang/topic/try.20blocks.html#276928244">(Mar 28 2022 at 20:39)</a>:</h4>
<p>tbh i don't feel most of these are compelling over the existing syntax, e.g.</p>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="kd">let</span><span class="w"> </span><span class="n">_</span>: <span class="nb">Result</span><span class="o">&lt;</span><span class="n">_</span><span class="p">,</span><span class="w"> </span><span class="nb">Box</span><span class="o">&lt;</span><span class="k">dyn</span><span class="w"> </span><span class="n">Error</span><span class="o">&gt;&gt;</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kr">try</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">std</span>::<span class="n">fs</span>::<span class="n">read_to_string</span><span class="p">(</span><span class="s">"hello"</span><span class="p">)</span><span class="o">?</span><span class="p">;</span><span class="w"></span>
<span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="n">b</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">std</span>::<span class="n">fs</span>::<span class="n">read_to_string</span><span class="p">(</span><span class="s">"world"</span><span class="p">)</span><span class="o">?</span><span class="p">;</span><span class="w"></span>
<span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="n">c</span>: <span class="kt">i32</span> <span class="o">=</span><span class="w"> </span><span class="n">b</span><span class="p">.</span><span class="n">parse</span><span class="p">()</span><span class="o">?</span><span class="p">;</span><span class="w"></span>
<span class="w">    </span><span class="p">(</span><span class="n">a</span><span class="p">,</span><span class="w"> </span><span class="n">c</span><span class="p">)</span><span class="w"></span>
<span class="p">};</span><span class="w"></span>
</code></pre></div>



<a name="276928783"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/try%20blocks/near/276928783" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jane Lusby [she/her] <a href="https://zulip-archive.rust-lang.org/stream/213817-t-lang/topic/try.20blocks.html#276928783">(Mar 28 2022 at 20:44)</a>:</h4>
<p><span class="user-mention silent" data-user-id="433532">mejrs</span> <a href="#narrow/stream/213817-t-lang/topic/try.20blocks/near/276928244">said</a>:</p>
<blockquote>
<p>tbh i don't feel most of these are compelling over the existing syntax, e.g.</p>
<p><div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="kd">let</span><span class="w"> </span><span class="n">_</span>: <span class="nb">Result</span><span class="o">&lt;</span><span class="n">_</span><span class="p">,</span><span class="w"> </span><span class="nb">Box</span><span class="o">&lt;</span><span class="k">dyn</span><span class="w"> </span><span class="n">Error</span><span class="o">&gt;&gt;</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kr">try</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">std</span>::<span class="n">fs</span>::<span class="n">read_to_string</span><span class="p">(</span><span class="s">"hello"</span><span class="p">)</span><span class="o">?</span><span class="p">;</span><span class="w"></span>
<span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="n">b</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">std</span>::<span class="n">fs</span>::<span class="n">read_to_string</span><span class="p">(</span><span class="s">"world"</span><span class="p">)</span><span class="o">?</span><span class="p">;</span><span class="w"></span>
<span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="n">c</span>: <span class="kt">i32</span> <span class="o">=</span><span class="w"> </span><span class="n">b</span><span class="p">.</span><span class="n">parse</span><span class="p">()</span><span class="o">?</span><span class="p">;</span><span class="w"></span>
<span class="w">    </span><span class="p">(</span><span class="n">a</span><span class="p">,</span><span class="w"> </span><span class="n">c</span><span class="p">)</span><span class="w"></span>
<span class="p">};</span><span class="w"></span>
</code></pre></div><br>
</p>
</blockquote>
<p>did you read <a href="https://github.com/scottmcm/rfcs/blob/try-again/text/0000-resolving-try-annotations.md#summary">https://github.com/scottmcm/rfcs/blob/try-again/text/0000-resolving-try-annotations.md#summary</a>? I think it pretty clearly outlines why the existing syntax is insufficient by itself</p>



<a name="276933231"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/try%20blocks/near/276933231" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> mejrs <a href="https://zulip-archive.rust-lang.org/stream/213817-t-lang/topic/try.20blocks.html#276933231">(Mar 28 2022 at 21:23)</a>:</h4>
<p>Fair enough. I have used <code>try</code> blocks in my own code and never found them problematic w/r having to give type hints</p>



<a name="276933581"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/try%20blocks/near/276933581" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> scottmcm <a href="https://zulip-archive.rust-lang.org/stream/213817-t-lang/topic/try.20blocks.html#276933581">(Mar 28 2022 at 21:26)</a>:</h4>
<p>Do you have a link I could look at, <span class="user-mention" data-user-id="433532">@mejrs</span>?  I'd like to see how you use them to have better context for the RFC I'm writing.</p>



<a name="276933825"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/try%20blocks/near/276933825" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> mejrs <a href="https://zulip-archive.rust-lang.org/stream/213817-t-lang/topic/try.20blocks.html#276933825">(Mar 28 2022 at 21:28)</a>:</h4>
<p>For example, <a href="https://github.com/mejrs/rs3cache/blob/master/src/definitions/location_configs.rs#L234">https://github.com/mejrs/rs3cache/blob/master/src/definitions/location_configs.rs#L234</a> (i don't know how easy this is to parse, the data format it decodes is somewhat cursed)</p>



<a name="276933841"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/try%20blocks/near/276933841" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> mejrs <a href="https://zulip-archive.rust-lang.org/stream/213817-t-lang/topic/try.20blocks.html#276933841">(Mar 28 2022 at 21:28)</a>:</h4>
<p>it boils down to </p>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="k">fn</span> <span class="nf">deserialize</span><span class="p">(</span><span class="n">id</span>: <span class="kt">u32</span><span class="p">,</span><span class="w"> </span><span class="k">mut</span><span class="w"> </span><span class="n">buffer</span>: <span class="nc">Bytes</span><span class="p">)</span><span class="w"> </span>-&gt; <span class="nb">Result</span><span class="o">&lt;</span><span class="bp">Self</span><span class="p">,</span><span class="w"> </span><span class="n">ReadError</span><span class="o">&gt;</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="k">mut</span><span class="w"> </span><span class="n">loc</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="bp">Self</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">        </span><span class="n">id</span><span class="p">,</span><span class="w"></span>
<span class="w">        </span><span class="o">..</span><span class="nb">Default</span>::<span class="n">default</span><span class="p">()</span><span class="w"></span>
<span class="w">    </span><span class="p">};</span><span class="w"></span>
<span class="w">    </span><span class="k">loop</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">        </span><span class="kd">let</span><span class="w"> </span><span class="n">opcode</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">buffer</span><span class="p">.</span><span class="n">try_get_u8</span><span class="p">()</span><span class="o">?</span><span class="p">;</span><span class="w"></span>

<span class="w">        </span><span class="kd">let</span><span class="w"> </span><span class="n">read</span>: <span class="nb">Result</span><span class="o">&lt;</span><span class="p">(),</span><span class="w"> </span><span class="n">ReadError</span><span class="o">&gt;</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kr">try</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">            </span><span class="k">match</span><span class="w"> </span><span class="n">opcode</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">                </span><span class="mi">0</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">                    </span><span class="k">if</span><span class="w"> </span><span class="n">buffer</span><span class="p">.</span><span class="n">has_remaining</span><span class="p">()</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">                        </span><span class="nb">Err</span><span class="p">(</span><span class="cm">/* .. */</span><span class="p">)</span><span class="o">?</span><span class="p">;</span><span class="w"></span>
<span class="w">                    </span><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">                        </span><span class="k">break</span><span class="w"> </span><span class="nb">Ok</span><span class="p">(</span><span class="n">loc</span><span class="p">);</span><span class="w"></span>
<span class="w">                    </span><span class="p">}</span><span class="w"></span>
<span class="w">                </span><span class="p">}</span><span class="w"> </span><span class="c1">// big match block</span>
<span class="w">            </span><span class="p">}</span><span class="w"></span>
<span class="w">        </span><span class="p">};</span><span class="w"></span>
<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="kd">let</span><span class="w"> </span><span class="nb">Err</span><span class="p">(</span><span class="n">e</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">read</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">            </span><span class="k">return</span><span class="w"> </span><span class="nb">Err</span><span class="p">(</span><span class="cm">/* .. */</span><span class="p">);</span><span class="w"></span>
<span class="w">        </span><span class="p">};</span><span class="w"></span>
<span class="w">    </span><span class="p">}</span><span class="w"></span>
<span class="p">}</span><span class="err">```</span><span class="w"></span>
</code></pre></div>



<a name="276933933"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/try%20blocks/near/276933933" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> scottmcm <a href="https://zulip-archive.rust-lang.org/stream/213817-t-lang/topic/try.20blocks.html#276933933">(Mar 28 2022 at 21:29)</a>:</h4>
<p>Ah, even has a <code>break</code>, nice.  That extra helps for the "just use an IIFE" comments that are sure to come when <code>try</code> gets talked about.</p>



<a name="276934125"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/try%20blocks/near/276934125" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> scottmcm <a href="https://zulip-archive.rust-lang.org/stream/213817-t-lang/topic/try.20blocks.html#276934125">(Mar 28 2022 at 21:31)</a>:</h4>
<p>Are all your <code>?</code>s on <code>Result&lt;_, ReadError&gt;</code>?</p>
<p><code>try_get_u8</code> and friends seems to be, at least <a href="https://github.com/mejrs/rs3cache/blob/19abad75314f6a5faadc6d7fd03cdf58eb80e9aa/rs3cache_backend/src/buf.rs#L162">https://github.com/mejrs/rs3cache/blob/19abad75314f6a5faadc6d7fd03cdf58eb80e9aa/rs3cache_backend/src/buf.rs#L162</a></p>



<a name="276934134"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/try%20blocks/near/276934134" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> mejrs <a href="https://zulip-archive.rust-lang.org/stream/213817-t-lang/topic/try.20blocks.html#276934134">(Mar 28 2022 at 21:31)</a>:</h4>
<p>Yeah, i originally tried to use an iife, but you cannot break out of it. That's the nice thing about hobby projects though - you can just keep adding nightly features</p>



<a name="276945057"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/try%20blocks/near/276945057" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> scottmcm <a href="https://zulip-archive.rust-lang.org/stream/213817-t-lang/topic/try.20blocks.html#276945057">(Mar 29 2022 at 00:09)</a>:</h4>
<p>I don't know all the types, but it looks like that example is homogeneous, right <span class="user-mention" data-user-id="433532">@mejrs</span>?  So it'd just be <code>let read = try {</code> and success.</p>



<a name="276945120"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/try%20blocks/near/276945120" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> scottmcm <a href="https://zulip-archive.rust-lang.org/stream/213817-t-lang/topic/try.20blocks.html#276945120">(Mar 29 2022 at 00:10)</a>:</h4>
<p>It's seeming like the <em>vast</em> majority of the <code>try</code> cases I'm finding are homogeneous</p>



<a name="276947895"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/try%20blocks/near/276947895" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jacob Pratt <a href="https://zulip-archive.rust-lang.org/stream/213817-t-lang/topic/try.20blocks.html#276947895">(Mar 29 2022 at 01:05)</a>:</h4>
<p>Would it be worthwhile to attempt the proposed desugaring <em>without</em> permitting conversions, at least initially? That would let us judge just how much desire/demand there is for heterogeneous cases.</p>



<a name="276950711"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/try%20blocks/near/276950711" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> scottmcm <a href="https://zulip-archive.rust-lang.org/stream/213817-t-lang/topic/try.20blocks.html#276950711">(Mar 29 2022 at 02:04)</a>:</h4>
<p>Indeed, I've already implemented it <span aria-label="smile" class="emoji emoji-1f642" role="img" title="smile">:smile:</span> <a href="https://github.com/scottmcm/rust/commit/9484aba9bd707dedf49b5d8622cecd53f03b8797">https://github.com/scottmcm/rust/commit/9484aba9bd707dedf49b5d8622cecd53f03b8797</a></p>
<p>That's how I know that 17/18 of the try blocks in <code>rustc</code> are homogeneous.</p>



<a name="276950790"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/try%20blocks/near/276950790" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> scottmcm <a href="https://zulip-archive.rust-lang.org/stream/213817-t-lang/topic/try.20blocks.html#276950790">(Mar 29 2022 at 02:06)</a>:</h4>
<p>I guess I'm hitting the "what process approval do I need" trouble.</p>
<p>Maybe I should just write the RFC for the simple homogeneous case, and leave the heterogeneous case as Future Work.</p>



<a name="276950798"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/try%20blocks/near/276950798" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> scottmcm <a href="https://zulip-archive.rust-lang.org/stream/213817-t-lang/topic/try.20blocks.html#276950798">(Mar 29 2022 at 02:06)</a>:</h4>
<p>(Maybe that last statement is also what you were saying)</p>



<a name="276975854"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/try%20blocks/near/276975854" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Christopher Durham <a href="https://zulip-archive.rust-lang.org/stream/213817-t-lang/topic/try.20blocks.html#276975854">(Mar 29 2022 at 08:59)</a>:</h4>
<p>Something I realized: while <code>in</code> is followed by an expression in <code>for _ in _</code>, it's followed by a path in the (admittedly rare) <code>pub(in path)</code></p>



<a name="276985040"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/try%20blocks/near/276985040" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Daniel Henry-Mantilla <a href="https://zulip-archive.rust-lang.org/stream/213817-t-lang/topic/try.20blocks.html#276985040">(Mar 29 2022 at 10:31)</a>:</h4>
<p><span class="user-mention" data-user-id="125270">@scottmcm</span> would it be possible to start with a method for the heterogenous case? Similar to how we already have <code>.ready()?</code>, we could have a <code>.yeet_into()?</code> <del>yeento</del> adapter?</p>
<p>And whenever <code>try { â€¦ .yeento()? â€¦ .yeento()? }</code> ends up being more frequent than we'd like, if ever, ony then would we could consider the <code>try yeentoing { â€¦ }</code> shorthand <span aria-label="big smile" class="emoji emoji-1f604" role="img" title="big smile">:big_smile:</span></p>
<ul>
<li>or would it be <code>yeeto</code> <span aria-label="thinking" class="emoji emoji-1f914" role="img" title="thinking">:thinking:</span> <span aria-label="thinking" class="emoji emoji-1f914" role="img" title="thinking">:thinking:</span></li>
</ul>



<a name="277009096"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/try%20blocks/near/277009096" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jake Goulding <a href="https://zulip-archive.rust-lang.org/stream/213817-t-lang/topic/try.20blocks.html#277009096">(Mar 29 2022 at 14:03)</a>:</h4>
<p><span class="user-mention silent" data-user-id="125270">scottmcm</span> <a href="#narrow/stream/213817-t-lang/topic/try.20blocks/near/276945120">said</a>:</p>
<blockquote>
<p>It's seeming like the <em>vast</em> majority of the <code>try</code> cases I'm finding are homogeneous</p>
</blockquote>
<p>FWIW, I've avoided using try blocks as they are nightly (IIFEs are generally good enough, otherwise I bite the bullet and make a new function), but I'd expect most of my usages to be heterogenous as that's kind of how SNAFU works.</p>



<a name="277037351"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/try%20blocks/near/277037351" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> scottmcm <a href="https://zulip-archive.rust-lang.org/stream/213817-t-lang/topic/try.20blocks.html#277037351">(Mar 29 2022 at 17:13)</a>:</h4>
<p><span class="user-mention" data-user-id="232018">@Daniel Henry-Mantilla</span> I'd rather not <em>aim</em> for that approach since the tradeoff of needing to update it on most, if not all, of the <code>?</code> is poor.  It's like how we could have had people do <code>.map_err(Into::into)?</code> whenever they wanted the heterogeneous case, but we didn't.</p>
<p>But the "let's just address the homogeneous case first" seems like the way forward I should do for the RFC, at least.</p>
<p>(And maybe have <code>try heterogeneous {</code> with today's behaviour as a placeholder for nightly users to migrate to if needed.)</p>



<a name="277041088"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/try%20blocks/near/277041088" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> bstrie <a href="https://zulip-archive.rust-lang.org/stream/213817-t-lang/topic/try.20blocks.html#277041088">(Mar 29 2022 at 17:40)</a>:</h4>
<p>Honestly, if it isn't <code>try {</code> with no extra syntax, or at most some syntax that looks like type ascription, then I can't see myself ever using try or recommending that anyone else does either. It needs to Just Work without looking weird or being more verbose than current solutions.</p>



<a name="277041327"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/try%20blocks/near/277041327" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> bstrie <a href="https://zulip-archive.rust-lang.org/stream/213817-t-lang/topic/try.20blocks.html#277041327">(Mar 29 2022 at 17:42)</a>:</h4>
<p>"Read my lips: no new syntaxes."</p>



<a name="277044252"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/try%20blocks/near/277044252" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jane Lusby [she/her] <a href="https://zulip-archive.rust-lang.org/stream/213817-t-lang/topic/try.20blocks.html#277044252">(Mar 29 2022 at 18:05)</a>:</h4>
<p><em>breathes in deeply... sighs</em> ah yes, I do love the smell of fresh paint in the morning</p>



<a name="277065049"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/try%20blocks/near/277065049" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Lokathor <a href="https://zulip-archive.rust-lang.org/stream/213817-t-lang/topic/try.20blocks.html#277065049">(Mar 29 2022 at 21:08)</a>:</h4>
<p>yeah it has to <em>work</em> with <code>try{</code> even if there's also like, <code>try as MyType {</code> available</p>



<a name="277074965"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/try%20blocks/near/277074965" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Mario Carneiro <a href="https://zulip-archive.rust-lang.org/stream/213817-t-lang/topic/try.20blocks.html#277074965">(Mar 29 2022 at 22:52)</a>:</h4>
<p>My vote goes to <code>try {</code> and <code>try: _ {</code> being different. We'll get over it, there are already things which are at least as weird:</p>
<ul>
<li><code>&amp;ref x</code> not always being equivalent to <code>x</code> in a <code>&amp;T</code> pattern</li>
<li><code>(&amp;x,)</code> not working even though <code>(x,)</code> yields a variable of type <code>&amp;T</code> if matching <code>&amp;(T,)</code></li>
<li><code>for x in mut_ref {</code> consumes <code>mut_ref: &amp;mut T</code> instead of reborrowing like it does in most other places</li>
<li><code>let x = a;</code> and <code>match a { x =&gt; ... }</code> are not equivalent because of temporary lifetimes</li>
<li><code>e;</code> and <code>let _ = e;</code> are not equivalent</li>
</ul>



<a name="277076457"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/try%20blocks/near/277076457" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> scottmcm <a href="https://zulip-archive.rust-lang.org/stream/213817-t-lang/topic/try.20blocks.html#277076457">(Mar 29 2022 at 23:14)</a>:</h4>
<p><span class="user-mention silent" data-user-id="224471">Lokathor</span> <a href="#narrow/stream/213817-t-lang/topic/try.20blocks/near/277065049">said</a>:</p>
<blockquote>
<p>yeah it has to <em>work</em> with <code>try{</code></p>
</blockquote>
<p>Can you clarify what "it" is, specifically?  The plan is certainly that <code>try {</code> will usually "just work".</p>



<a name="277077892"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/try%20blocks/near/277077892" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jane Lusby [she/her] <a href="https://zulip-archive.rust-lang.org/stream/213817-t-lang/topic/try.20blocks.html#277077892">(Mar 29 2022 at 23:34)</a>:</h4>
<p>I don't think the fact that we already have inconsistencies is a sufficiently strong justification for adding new inconsistencies.</p>



<a name="277078460"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/try%20blocks/near/277078460" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Lokathor <a href="https://zulip-archive.rust-lang.org/stream/213817-t-lang/topic/try.20blocks.html#277078460">(Mar 29 2022 at 23:42)</a>:</h4>
<p><span class="user-mention silent" data-user-id="125270">scottmcm</span> <a href="#narrow/stream/213817-t-lang/topic/try.20blocks/near/277076457">said</a>:</p>
<blockquote>
<p><span class="user-mention silent" data-user-id="224471">Lokathor</span> <a href="#narrow/stream/213817-t-lang/topic/try.20blocks/near/277065049">said</a>:</p>
<blockquote>
<p>yeah it has to <em>work</em> with <code>try{</code></p>
</blockquote>
<p>Can you clarify what "it" is, specifically?  The plan is certainly that <code>try {</code> will usually "just work".</p>
</blockquote>
<p>defined as "the compiler accepts it and continues the build, though maybe something else fails later on".</p>
<p>Similar to <code>let x =</code> being valid, though maybe <code>let x: MyType =</code> is what you need in advanced cases.</p>



<a name="277078728"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/try%20blocks/near/277078728" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jane Lusby [she/her] <a href="https://zulip-archive.rust-lang.org/stream/213817-t-lang/topic/try.20blocks.html#277078728">(Mar 29 2022 at 23:47)</a>:</h4>
<p>i think that's the whole point of making the default mode homogenous and based on Residual</p>



<a name="277078735"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/try%20blocks/near/277078735" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jane Lusby [she/her] <a href="https://zulip-archive.rust-lang.org/stream/213817-t-lang/topic/try.20blocks.html#277078735">(Mar 29 2022 at 23:47)</a>:</h4>
<p>it makes the default <code>try { }</code> syntax work in many more places without extra annotations</p>



<a name="277079613"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/try%20blocks/near/277079613" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> scottmcm <a href="https://zulip-archive.rust-lang.org/stream/213817-t-lang/topic/try.20blocks.html#277079613">(Mar 30 2022 at 00:00)</a>:</h4>
<p>Yup, that's exactly it.  Right now unannotated try fails in too many situations (see Niko's comment in <a href="https://github.com/rust-lang/rust/issues/70941#issuecomment-612167041">https://github.com/rust-lang/rust/issues/70941#issuecomment-612167041</a>) so the whole goal here is to make the easy cases easier today (with the nice short syntax), and make the advanced ones still possible (just with a few characters more typing in those advanced ones)</p>



<a name="277113119"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/try%20blocks/near/277113119" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/213817-t-lang/topic/try.20blocks.html#277113119">(Mar 30 2022 at 08:56)</a>:</h4>
<p>let me just add one more thought</p>



<a name="277113141"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/try%20blocks/near/277113141" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/213817-t-lang/topic/try.20blocks.html#277113141">(Mar 30 2022 at 08:56)</a>:</h4>
<p>even though I've resisted talking about inference fallback...</p>



<a name="277113148"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/try%20blocks/near/277113148" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/213817-t-lang/topic/try.20blocks.html#277113148">(Mar 30 2022 at 08:56)</a>:</h4>
<p>...there are definitely uses for it...</p>



<a name="277113191"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/try%20blocks/near/277113191" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/213817-t-lang/topic/try.20blocks.html#277113191">(Mar 30 2022 at 08:57)</a>:</h4>
<p>it certainly seems plausible that we could detect "<code>?</code> was applied to homogeneous types"--</p>



<a name="277113227"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/try%20blocks/near/277113227" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/213817-t-lang/topic/try.20blocks.html#277113227">(Mar 30 2022 at 08:57)</a>:</h4>
<p>/me thinks a bit more</p>



<a name="277113246"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/try%20blocks/near/277113246" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/213817-t-lang/topic/try.20blocks.html#277113246">(Mar 30 2022 at 08:57)</a>:</h4>
<p>that may not be true I guess :) I could see it getting stuck</p>



<a name="277113341"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/try%20blocks/near/277113341" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/213817-t-lang/topic/try.20blocks.html#277113341">(Mar 30 2022 at 08:58)</a>:</h4>
<p>still, I've been working a lot on a newer approach to type inference (in the formality repo, to be clear, not actual code) and I feel like there's a <em>universe</em> where we could design more advanced fallback questions without being totally adhoc</p>



<a name="277113352"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/try%20blocks/near/277113352" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/213817-t-lang/topic/try.20blocks.html#277113352">(Mar 30 2022 at 08:58)</a>:</h4>
<p>but I can't say that with confidence yet</p>



<a name="277142950"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/try%20blocks/near/277142950" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Daniel Henry-Mantilla <a href="https://zulip-archive.rust-lang.org/stream/213817-t-lang/topic/try.20blocks.html#277142950">(Mar 30 2022 at 13:19)</a>:</h4>
<p><span class="user-mention silent" data-user-id="271719">Mario Carneiro</span> <a href="#narrow/stream/213817-t-lang/topic/try.20blocks/near/277074965">said</a>:</p>
<blockquote>
<p>My vote goes to <code>try {</code> and <code>try: _ {</code> being different. We'll get over it, there are already things which are at least as weird:</p>
</blockquote>
<p>Yeah, this may not be as bad as it looks. I think another nice example of this distinction already existing in current code is:</p>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="kd">let</span><span class="w"> </span><span class="n">f</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">|</span><span class="n">x</span><span class="o">|</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="n">_</span>: <span class="kp">&amp;</span><span class="kt">i32</span> <span class="o">=</span><span class="w"> </span><span class="n">x</span><span class="p">;</span><span class="w"> </span><span class="c1">// nudge inference here</span>
<span class="w">    </span><span class="n">x</span><span class="w"></span>
<span class="p">};</span><span class="w"></span>
</code></pre></div>
<p>and</p>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="kd">let</span><span class="w"> </span><span class="n">f</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">|</span><span class="n">x</span>: <span class="kp">&amp;</span><span class="kt">i32</span><span class="o">|</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">x</span><span class="w"> </span><span class="p">}</span><span class="w"></span>
</code></pre></div>
<p>not meaning the same (currently the latter fails to compile, while the former will yield a closure that can't be fed to APIs expecting a higher-order closure).</p>



<a name="277143484"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/try%20blocks/near/277143484" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Daniel Henry-Mantilla <a href="https://zulip-archive.rust-lang.org/stream/213817-t-lang/topic/try.20blocks.html#277143484">(Mar 30 2022 at 13:23)</a>:</h4>
<p><span class="user-mention silent" data-user-id="125270">scottmcm</span> <a href="#narrow/stream/213817-t-lang/topic/try.20blocks/near/277037351">said</a>:</p>
<blockquote>
<p>It's like how we could have had people do <code>.map_err(Into::into)?</code> whenever they wanted the heterogeneous case, but we didn't.</p>
</blockquote>
<p>even though we didn't (and rightfully so, don't get me wrong), there is still an operation there, the <code>FromResidual::from_residual</code> mapping on the <code>Residual</code> variant, which is something that could deserve a name in and of itself (I have joked about calling it <code>yeento</code> or <code>yeeto</code>, for instance). Should we have such a name, it could help us find a name for the modifier to use with the <code>try</code> block. This is to nuance the suggestion from some people to use <code>into</code>, when the <code>try</code> semantics no longer use the <code>Into</code> trait, which is why I'm not fond of that.</p>



<a name="277169838"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/try%20blocks/near/277169838" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> scottmcm <a href="https://zulip-archive.rust-lang.org/stream/213817-t-lang/topic/try.20blocks.html#277169838">(Mar 30 2022 at 16:23)</a>:</h4>
<p><span class="user-mention silent" data-user-id="232018">Daniel Henry-Mantilla</span> <a href="#narrow/stream/213817-t-lang/topic/try.20blocks/near/277143484">said</a>:</p>
<blockquote>
<p>when the <code>try</code> semantics no longer use the <code>Into</code> trait, which is why I'm not fond of that.</p>
</blockquote>
<p>AFAIK neither <code>r#try!</code> nor <code>?</code> have ever used <code>Into</code>.</p>
<p>That one I do think that we can change eventually.  It's technically a minor change -- the breakage currently is inference breakage -- so a smarter algorithm for that could absolutely let it work.</p>



<hr><p>Last updated: Apr 12 2022 at 20:01 UTC</p>
</html>