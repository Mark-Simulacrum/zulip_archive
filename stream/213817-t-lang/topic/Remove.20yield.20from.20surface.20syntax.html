<html>
<head><meta charset="utf-8"><title>Remove yield from surface syntax · t-lang · Zulip Chat Archive</title></head>
<h2>Stream: <a href="https://zulip-archive.rust-lang.org/stream/213817-t-lang/index.html">t-lang</a></h2>
<h3>Topic: <a href="https://zulip-archive.rust-lang.org/stream/213817-t-lang/topic/Remove.20yield.20from.20surface.20syntax.html">Remove yield from surface syntax</a></h3>

<hr>

<base href="https://rust-lang.zulipchat.com">

<head><link href="https://zulip-archive.rust-lang.org/style.css" rel="stylesheet"></head>

<a name="261901413"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/Remove%20yield%20from%20surface%20syntax/near/261901413" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Nick Cameron <a href="https://zulip-archive.rust-lang.org/stream/213817-t-lang/topic/Remove.20yield.20from.20surface.20syntax.html#261901413">(Nov 18 2021 at 09:01)</a>:</h4>
<p>Hi <span class="user-group-mention" data-user-group-id="1977">@T-lang</span> I think it would be a good idea to remove yield from the surface syntax (it's currently unstable), this implies removing the ability to write generators/coroutines. We should also make the Generator trait private. Since we're actively working on a new design for generators, this would give us a 'blank page' to start from. IMO the current (2033) is very specifically a design for implementing async/await, rather than working well for end users, and trying to incorporate it into the new design will lead to a sub-optimal result. Furthermore, trying to change it incrementally will be a high friction/inertia task. The obvious downside is that it makes it harder to experiment with syntax, etc. But presumably that would only require a very simple fork of the compiler since we'd want to keep all the internals in tact for the async/await implementation.</p>



<a name="261901503"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/Remove%20yield%20from%20surface%20syntax/near/261901503" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Nick Cameron <a href="https://zulip-archive.rust-lang.org/stream/213817-t-lang/topic/Remove.20yield.20from.20surface.20syntax.html#261901503">(Nov 18 2021 at 09:02)</a>:</h4>
<p>Is this a ridiculous idea? If not I will propose a formal MCP thing, but I wanted to get some informal feedback first</p>



<a name="261929487"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/Remove%20yield%20from%20surface%20syntax/near/261929487" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Triplett <a href="https://zulip-archive.rust-lang.org/stream/213817-t-lang/topic/Remove.20yield.20from.20surface.20syntax.html#261929487">(Nov 18 2021 at 13:53)</a>:</h4>
<p>Hmmm.</p>



<a name="261929561"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/Remove%20yield%20from%20surface%20syntax/near/261929561" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Triplett <a href="https://zulip-archive.rust-lang.org/stream/213817-t-lang/topic/Remove.20yield.20from.20surface.20syntax.html#261929561">(Nov 18 2021 at 13:54)</a>:</h4>
<p>It seems exceedingly likely that we will want to use the keyword "yield" for the operation of producing the next item from a generator.</p>



<a name="261929589"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/Remove%20yield%20from%20surface%20syntax/near/261929589" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Triplett <a href="https://zulip-archive.rust-lang.org/stream/213817-t-lang/topic/Remove.20yield.20from.20surface.20syntax.html#261929589">(Nov 18 2021 at 13:54)</a>:</h4>
<p>I don't think we should un-reserve it.</p>



<a name="261929619"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/Remove%20yield%20from%20surface%20syntax/near/261929619" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Triplett <a href="https://zulip-archive.rust-lang.org/stream/213817-t-lang/topic/Remove.20yield.20from.20surface.20syntax.html#261929619">(Nov 18 2021 at 13:54)</a>:</h4>
<p>I do absolutely agree that we should design generators without regard for the unstable prototype that was used to implement futures.</p>



<a name="261929649"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/Remove%20yield%20from%20surface%20syntax/near/261929649" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Triplett <a href="https://zulip-archive.rust-lang.org/stream/213817-t-lang/topic/Remove.20yield.20from.20surface.20syntax.html#261929649">(Nov 18 2021 at 13:55)</a>:</h4>
<p>And ditto for any currently unstable surface syntax.</p>



<a name="261929675"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/Remove%20yield%20from%20surface%20syntax/near/261929675" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Triplett <a href="https://zulip-archive.rust-lang.org/stream/213817-t-lang/topic/Remove.20yield.20from.20surface.20syntax.html#261929675">(Nov 18 2021 at 13:55)</a>:</h4>
<p>But I think we should keep the keyword <code>yield</code>.</p>



<a name="261929904"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/Remove%20yield%20from%20surface%20syntax/near/261929904" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Triplett <a href="https://zulip-archive.rust-lang.org/stream/213817-t-lang/topic/Remove.20yield.20from.20surface.20syntax.html#261929904">(Nov 18 2021 at 13:56)</a>:</h4>
<p>I also think that while that might produce some anchoring on the keyword, we still have the option of choosing a surface syntax that doesn't involve that keyword, if something compelling arises.</p>



<a name="261929929"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/Remove%20yield%20from%20surface%20syntax/near/261929929" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Triplett <a href="https://zulip-archive.rust-lang.org/stream/213817-t-lang/topic/Remove.20yield.20from.20surface.20syntax.html#261929929">(Nov 18 2021 at 13:57)</a>:</h4>
<p><span class="user-mention" data-user-id="256841">@Nick Cameron</span> Does that seem reasonable?</p>



<a name="261929970"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/Remove%20yield%20from%20surface%20syntax/near/261929970" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Triplett <a href="https://zulip-archive.rust-lang.org/stream/213817-t-lang/topic/Remove.20yield.20from.20surface.20syntax.html#261929970">(Nov 18 2021 at 13:57)</a>:</h4>
<p>Also, if you're proposing to discard the existing unstable surface syntax for generators, I don't think that needs an MCP.</p>



<a name="261930475"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/Remove%20yield%20from%20surface%20syntax/near/261930475" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Nick Cameron <a href="https://zulip-archive.rust-lang.org/stream/213817-t-lang/topic/Remove.20yield.20from.20surface.20syntax.html#261930475">(Nov 18 2021 at 14:00)</a>:</h4>
<p>"It seems exceedingly likely that we will want to use the keyword "yield" for the operation of producing the next item from a generator." - indeed, though possible with different semantics around resume args (or maybe something else as yet unforeseen)</p>



<a name="261930542"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/Remove%20yield%20from%20surface%20syntax/near/261930542" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Triplett <a href="https://zulip-archive.rust-lang.org/stream/213817-t-lang/topic/Remove.20yield.20from.20surface.20syntax.html#261930542">(Nov 18 2021 at 14:01)</a>:</h4>
<p>Oh, absolutely: I think the exact usage of the keyword may be different.</p>



<a name="261930561"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/Remove%20yield%20from%20surface%20syntax/near/261930561" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Triplett <a href="https://zulip-archive.rust-lang.org/stream/213817-t-lang/topic/Remove.20yield.20from.20surface.20syntax.html#261930561">(Nov 18 2021 at 14:01)</a>:</h4>
<p>We may or may not end up with resume arguments, for example.</p>



<a name="261930581"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/Remove%20yield%20from%20surface%20syntax/near/261930581" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Nick Cameron <a href="https://zulip-archive.rust-lang.org/stream/213817-t-lang/topic/Remove.20yield.20from.20surface.20syntax.html#261930581">(Nov 18 2021 at 14:01)</a>:</h4>
<p>exactly</p>



<a name="261930646"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/Remove%20yield%20from%20surface%20syntax/near/261930646" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Triplett <a href="https://zulip-archive.rust-lang.org/stream/213817-t-lang/topic/Remove.20yield.20from.20surface.20syntax.html#261930646">(Nov 18 2021 at 14:02)</a>:</h4>
<p>To clarify, I just meant that I'd be shocked if the final syntax doesn't use the yield keyword, so I don't think we need to unreserve it.</p>



<a name="261930652"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/Remove%20yield%20from%20surface%20syntax/near/261930652" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Nick Cameron <a href="https://zulip-archive.rust-lang.org/stream/213817-t-lang/topic/Remove.20yield.20from.20surface.20syntax.html#261930652">(Nov 18 2021 at 14:02)</a>:</h4>
<p>In fact, its because we expect to use yield that I'm a bit uncomfortable leaving the current version around</p>



<a name="261930689"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/Remove%20yield%20from%20surface%20syntax/near/261930689" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Triplett <a href="https://zulip-archive.rust-lang.org/stream/213817-t-lang/topic/Remove.20yield.20from.20surface.20syntax.html#261930689">(Nov 18 2021 at 14:02)</a>:</h4>
<p>Would you be up for sending in a PR eliminating the unstable surface syntax?</p>



<a name="261930727"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/Remove%20yield%20from%20surface%20syntax/near/261930727" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Triplett <a href="https://zulip-archive.rust-lang.org/stream/213817-t-lang/topic/Remove.20yield.20from.20surface.20syntax.html#261930727">(Nov 18 2021 at 14:02)</a>:</h4>
<p>I'd be happy to propose FCP on that PR.</p>



<a name="261930790"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/Remove%20yield%20from%20surface%20syntax/near/261930790" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Nick Cameron <a href="https://zulip-archive.rust-lang.org/stream/213817-t-lang/topic/Remove.20yield.20from.20surface.20syntax.html#261930790">(Nov 18 2021 at 14:03)</a>:</h4>
<p>Sure, though I'd rather check nobody will strongly object first.</p>



<a name="261930804"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/Remove%20yield%20from%20surface%20syntax/near/261930804" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Triplett <a href="https://zulip-archive.rust-lang.org/stream/213817-t-lang/topic/Remove.20yield.20from.20surface.20syntax.html#261930804">(Nov 18 2021 at 14:03)</a>:</h4>
<p>Fair enough.</p>



<a name="261930809"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/Remove%20yield%20from%20surface%20syntax/near/261930809" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Nick Cameron <a href="https://zulip-archive.rust-lang.org/stream/213817-t-lang/topic/Remove.20yield.20from.20surface.20syntax.html#261930809">(Nov 18 2021 at 14:03)</a>:</h4>
<p>I probably don't have time until next week in any case</p>



<a name="261930917"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/Remove%20yield%20from%20surface%20syntax/near/261930917" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> simulacrum <a href="https://zulip-archive.rust-lang.org/stream/213817-t-lang/topic/Remove.20yield.20from.20surface.20syntax.html#261930917">(Nov 18 2021 at 14:04)</a>:</h4>
<p>Hm, what is the benefit of removing it? I would guess that a good bit of the parsing etc may be somewhat similar in the future, so it seems like churn to drop it and then re-add it?</p>



<a name="261930922"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/Remove%20yield%20from%20surface%20syntax/near/261930922" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Triplett <a href="https://zulip-archive.rust-lang.org/stream/213817-t-lang/topic/Remove.20yield.20from.20surface.20syntax.html#261930922">(Nov 18 2021 at 14:04)</a>:</h4>
<p>Then sure, go ahead and submit a minimal MCP; I don't think it needs any more detail then you put in this thread.</p>



<a name="261930966"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/Remove%20yield%20from%20surface%20syntax/near/261930966" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Triplett <a href="https://zulip-archive.rust-lang.org/stream/213817-t-lang/topic/Remove.20yield.20from.20surface.20syntax.html#261930966">(Nov 18 2021 at 14:05)</a>:</h4>
<p><span class="user-mention" data-user-id="116122">@simulacrum</span> I think it makes sense to eliminate a large source of anchoring. People proposing designs for generators shouldn't have to present them as an incremental evolution of the existing surface syntax.</p>



<a name="261930998"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/Remove%20yield%20from%20surface%20syntax/near/261930998" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> simulacrum <a href="https://zulip-archive.rust-lang.org/stream/213817-t-lang/topic/Remove.20yield.20from.20surface.20syntax.html#261930998">(Nov 18 2021 at 14:05)</a>:</h4>
<p>Sure? But that seems ... independent of whether the compiler logic is there</p>



<a name="261931034"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/Remove%20yield%20from%20surface%20syntax/near/261931034" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Triplett <a href="https://zulip-archive.rust-lang.org/stream/213817-t-lang/topic/Remove.20yield.20from.20surface.20syntax.html#261931034">(Nov 18 2021 at 14:05)</a>:</h4>
<p>In theory yes. In practice, though, will it be?</p>



<a name="261931036"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/Remove%20yield%20from%20surface%20syntax/near/261931036" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> simulacrum <a href="https://zulip-archive.rust-lang.org/stream/213817-t-lang/topic/Remove.20yield.20from.20surface.20syntax.html#261931036">(Nov 18 2021 at 14:05)</a>:</h4>
<p>We can mark the feature as unstable etc, that seems fine</p>



<a name="261931097"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/Remove%20yield%20from%20surface%20syntax/near/261931097" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> simulacrum <a href="https://zulip-archive.rust-lang.org/stream/213817-t-lang/topic/Remove.20yield.20from.20surface.20syntax.html#261931097">(Nov 18 2021 at 14:06)</a>:</h4>
<p>(incomplete, that is, not unstable)</p>



<a name="261931180"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/Remove%20yield%20from%20surface%20syntax/near/261931180" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> simulacrum <a href="https://zulip-archive.rust-lang.org/stream/213817-t-lang/topic/Remove.20yield.20from.20surface.20syntax.html#261931180">(Nov 18 2021 at 14:07)</a>:</h4>
<p>It feels quite easy to tell anyone working on such a proposal "don't worry about the current syntax" -- put that in the tracking issue, amend the RFC discussing it, etc.</p>



<a name="261931245"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/Remove%20yield%20from%20surface%20syntax/near/261931245" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> simulacrum <a href="https://zulip-archive.rust-lang.org/stream/213817-t-lang/topic/Remove.20yield.20from.20surface.20syntax.html#261931245">(Nov 18 2021 at 14:07)</a>:</h4>
<p>but adjusting the compiler and requiring e.g. proc macros experimenting with <em>different</em> syntax to say "use this fork of rustc" or "this pinned nightly" seems ... weird</p>



<a name="261931368"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/Remove%20yield%20from%20surface%20syntax/near/261931368" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Triplett <a href="https://zulip-archive.rust-lang.org/stream/213817-t-lang/topic/Remove.20yield.20from.20surface.20syntax.html#261931368">(Nov 18 2021 at 14:08)</a>:</h4>
<p>Sometimes I wonder if it would make sense on nightly to let a proc macro directly generate MIR rather than surface syntax. That's a can of worms though.</p>



<a name="261932679"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/Remove%20yield%20from%20surface%20syntax/near/261932679" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> The 8472 <a href="https://zulip-archive.rust-lang.org/stream/213817-t-lang/topic/Remove.20yield.20from.20surface.20syntax.html#261932679">(Nov 18 2021 at 14:18)</a>:</h4>
<p>couldn't the interpretation of the syntax depend on the enabled feature flags in that context?</p>



<a name="261932782"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/Remove%20yield%20from%20surface%20syntax/near/261932782" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> The 8472 <a href="https://zulip-archive.rust-lang.org/stream/213817-t-lang/topic/Remove.20yield.20from.20surface.20syntax.html#261932782">(Nov 18 2021 at 14:20)</a>:</h4>
<p>assuming there's any value in having a new implementation temporarily overlap with the old one</p>



<a name="261958720"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/Remove%20yield%20from%20surface%20syntax/near/261958720" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Esteban Küber <a href="https://zulip-archive.rust-lang.org/stream/213817-t-lang/topic/Remove.20yield.20from.20surface.20syntax.html#261958720">(Nov 18 2021 at 17:13)</a>:</h4>
<p>I understand the rationale (would we want <code>expr.yield</code> instead of <code>yield expr</code>, and other questions), but it feels like removing it from the parser will be churn for churn sake for  two reasons: existing nightly-only explorations around these (not just mine but others') rely on that syntax, but more importantly because <em>we will have to parse this regardless of the final syntax</em> in order to provide appropriate suggestions, just like we do for <code>await</code></p>



<a name="261958902"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/Remove%20yield%20from%20surface%20syntax/near/261958902" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Esteban Küber <a href="https://zulip-archive.rust-lang.org/stream/213817-t-lang/topic/Remove.20yield.20from.20surface.20syntax.html#261958902">(Nov 18 2021 at 17:14)</a>:</h4>
<p>I agree that this should have been <code>yield!()</code> instead, and we could progressively move towards that, but we should make <code>yield</code> either a parse synonym or an error telling you to use <code>yield!()</code> at least for now</p>



<a name="261959132"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/Remove%20yield%20from%20surface%20syntax/near/261959132" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Esteban Küber <a href="https://zulip-archive.rust-lang.org/stream/213817-t-lang/topic/Remove.20yield.20from.20surface.20syntax.html#261959132">(Nov 18 2021 at 17:16)</a>:</h4>
<p>We've had cases in the past of removal of unstable syntax breaking havoc, the one I recall was <code>&lt;-</code>, but there were others. I know some things have been put in place to avoid such a problem where stable crates stop working after removing nightly syntax, but I have little confidence in them (mainly due to ignorance, not because I <em>know</em> they are wrong or insufficient)</p>



<a name="261965803"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/Remove%20yield%20from%20surface%20syntax/near/261965803" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Sam Sartor <a href="https://zulip-archive.rust-lang.org/stream/213817-t-lang/topic/Remove.20yield.20from.20surface.20syntax.html#261965803">(Nov 18 2021 at 18:01)</a>:</h4>
<p><span class="user-mention silent" data-user-id="330154">The 8472</span> <a href="#narrow/stream/213817-t-lang/topic/Remove.20yield.20from.20surface.20syntax/near/261932679">said</a>:</p>
<blockquote>
<p>couldn't the interpretation of the syntax depend on the enabled feature flags in that context?</p>
</blockquote>
<p>I've been doing exactly this while quietly prototyping a version of yield closures over the last year or so. The 2033 generators feature flag and yield_closures feature flag can be mutually incompatible without too much headache.</p>



<a name="261966295"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/Remove%20yield%20from%20surface%20syntax/near/261966295" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Sam Sartor <a href="https://zulip-archive.rust-lang.org/stream/213817-t-lang/topic/Remove.20yield.20from.20surface.20syntax.html#261966295">(Nov 18 2021 at 18:04)</a>:</h4>
<p>Really the syntax logic for 2033-style generators is not very significant in rustc. The logic for the generator type in rustc_middle and rustc_typeck is much more annoying to hack around TBH. If there is anything that I would advocate cleaning up, it is that.</p>



<a name="261966751"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/Remove%20yield%20from%20surface%20syntax/near/261966751" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Sam Sartor <a href="https://zulip-archive.rust-lang.org/stream/213817-t-lang/topic/Remove.20yield.20from.20surface.20syntax.html#261966751">(Nov 18 2021 at 18:08)</a>:</h4>
<p>Of course, there is really no point in doing all the work to clean it up without knowing what sort of coroutine semantics should actually underlay futures. So the design will probably have to happen first and the cleanup happen after.</p>



<a name="261967273"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/Remove%20yield%20from%20surface%20syntax/near/261967273" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Sam Sartor <a href="https://zulip-archive.rust-lang.org/stream/213817-t-lang/topic/Remove.20yield.20from.20surface.20syntax.html#261967273">(Nov 18 2021 at 18:12)</a>:</h4>
<p><span class="user-mention silent" data-user-id="239881">Josh Triplett</span> <a href="#narrow/stream/213817-t-lang/topic/Remove.20yield.20from.20surface.20syntax/near/261931368">said</a>:</p>
<blockquote>
<p>Sometimes I wonder if it would make sense on nightly to let a proc macro directly generate MIR rather than surface syntax. That's a can of worms though.</p>
</blockquote>
<p>I do really like this idea overall. But like I said above, the interaction with layout, type checking, the trait system, etc is really the difficult part of all this IMO. Not sure how a proc macro could define the weird sort of types like <del>Generator</del> Coroutine that interact with MIR passes and so on.</p>



<a name="261970767"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/Remove%20yield%20from%20surface%20syntax/near/261970767" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Esteban Küber <a href="https://zulip-archive.rust-lang.org/stream/213817-t-lang/topic/Remove.20yield.20from.20surface.20syntax.html#261970767">(Nov 18 2021 at 18:40)</a>:</h4>
<p>That's what Josh is proposing: extending the proc-macro machinery to be able to integrate further into rustc, like plugins used to (still can, technically? has that finally atrophied to the point of unusability?), not just token expansion.</p>



<a name="261990732"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/Remove%20yield%20from%20surface%20syntax/near/261990732" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> bjorn3 <a href="https://zulip-archive.rust-lang.org/stream/213817-t-lang/topic/Remove.20yield.20from.20surface.20syntax.html#261990732">(Nov 18 2021 at 21:06)</a>:</h4>
<p>Plugins have long been limited to just lint passes.</p>



<a name="261990925"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/Remove%20yield%20from%20surface%20syntax/near/261990925" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> bjorn3 <a href="https://zulip-archive.rust-lang.org/stream/213817-t-lang/topic/Remove.20yield.20from.20surface.20syntax.html#261990925">(Nov 18 2021 at 21:08)</a>:</h4>
<p>Proc-macros can't directly create rustc data structures. They need a stable abi (when compiled by different rustc versions from the same libproc_macro source) to allow rustc itself to use proc macros.</p>



<a name="261991029"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/Remove%20yield%20from%20surface%20syntax/near/261991029" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> bjorn3 <a href="https://zulip-archive.rust-lang.org/stream/213817-t-lang/topic/Remove.20yield.20from.20surface.20syntax.html#261991029">(Nov 18 2021 at 21:09)</a>:</h4>
<p>Plugins are currently only used by servo and once/if servo migrates away from it, plugins will likely be removed completely.</p>



<a name="261992226"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/Remove%20yield%20from%20surface%20syntax/near/261992226" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> cuviper <a href="https://zulip-archive.rust-lang.org/stream/213817-t-lang/topic/Remove.20yield.20from.20surface.20syntax.html#261992226">(Nov 18 2021 at 21:18)</a>:</h4>
<p>is clippy a plugin in this regard?</p>



<a name="262038366"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/Remove%20yield%20from%20surface%20syntax/near/262038366" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> bjorn3 <a href="https://zulip-archive.rust-lang.org/stream/213817-t-lang/topic/Remove.20yield.20from.20surface.20syntax.html#262038366">(Nov 19 2021 at 08:18)</a>:</h4>
<p>No, a custom driver.</p>



<a name="262042721"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/Remove%20yield%20from%20surface%20syntax/near/262042721" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Nick Cameron <a href="https://zulip-archive.rust-lang.org/stream/213817-t-lang/topic/Remove.20yield.20from.20surface.20syntax.html#262042721">(Nov 19 2021 at 09:08)</a>:</h4>
<p>Yeah, the downside of letting proc macros output MIR or whatever is it means there is stabilisation pressure. It was a nightmare when plugins were still a thing</p>



<a name="262042753"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/Remove%20yield%20from%20surface%20syntax/near/262042753" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Nick Cameron <a href="https://zulip-archive.rust-lang.org/stream/213817-t-lang/topic/Remove.20yield.20from.20surface.20syntax.html#262042753">(Nov 19 2021 at 09:08)</a>:</h4>
<p>Even the old style proc macros where they created AST nodes rather than tokens was really bad</p>



<a name="262043050"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/Remove%20yield%20from%20surface%20syntax/near/262043050" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Nick Cameron <a href="https://zulip-archive.rust-lang.org/stream/213817-t-lang/topic/Remove.20yield.20from.20surface.20syntax.html#262043050">(Nov 19 2021 at 09:12)</a>:</h4>
<p>It sounds like keeping yield around is desirable, so lets leave it be</p>



<a name="262197784"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/Remove%20yield%20from%20surface%20syntax/near/262197784" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> bstrie <a href="https://zulip-archive.rust-lang.org/stream/213817-t-lang/topic/Remove.20yield.20from.20surface.20syntax.html#262197784">(Nov 20 2021 at 18:33)</a>:</h4>
<p>it still might be worthwhile to introduce <code>yield!()</code> with identical behavior to <code>yield</code>, to make it easier to transition when they keyword gets reclaimed</p>



<a name="262197950"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/Remove%20yield%20from%20surface%20syntax/near/262197950" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> bstrie <a href="https://zulip-archive.rust-lang.org/stream/213817-t-lang/topic/Remove.20yield.20from.20surface.20syntax.html#262197950">(Nov 20 2021 at 18:35)</a>:</h4>
<p>sort of like how <code>llvm_asm!</code> is still around even though it's both unstable and deprecated</p>



<a name="262205924"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/Remove%20yield%20from%20surface%20syntax/near/262205924" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Nick Cameron <a href="https://zulip-archive.rust-lang.org/stream/213817-t-lang/topic/Remove.20yield.20from.20surface.20syntax.html#262205924">(Nov 20 2021 at 21:35)</a>:</h4>
<p>I hope nobody is actually using yield in anything serious, it’s unstable so we can totally just change the semantics as long as we don’t break await</p>



<hr><p>Last updated: Apr 12 2022 at 20:01 UTC</p>
</html>