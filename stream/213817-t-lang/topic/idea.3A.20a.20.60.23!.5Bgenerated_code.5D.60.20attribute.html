<html>
<head><meta charset="utf-8"><title>idea: a `#![generated_code]` attribute · t-lang · Zulip Chat Archive</title></head>
<h2>Stream: <a href="https://zulip-archive.rust-lang.org/stream/213817-t-lang/index.html">t-lang</a></h2>
<h3>Topic: <a href="https://zulip-archive.rust-lang.org/stream/213817-t-lang/topic/idea.3A.20a.20.60.23!.5Bgenerated_code.5D.60.20attribute.html">idea: a `#![generated_code]` attribute</a></h3>

<hr>

<base href="https://rust-lang.zulipchat.com">

<head><link href="https://zulip-archive.rust-lang.org/style.css" rel="stylesheet"></head>

<a name="277672429"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/idea%3A%20a%20%60%23%21%5Bgenerated_code%5D%60%20attribute/near/277672429" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> scottmcm <a href="https://zulip-archive.rust-lang.org/stream/213817-t-lang/topic/idea.3A.20a.20.60.23!.5Bgenerated_code.5D.60.20attribute.html#277672429">(Apr 04 2022 at 01:29)</a>:</h4>
<p>The conversation about some lints not always mattering (and related things like how some lints disable themselves in macro-generated code) made me think about the possibility of a <code>generated_code</code> attribute.</p>
<p>So if you generate an rs file (like <a href="https://github.com/rust-lang/rust/blob/master/library/core/src/unicode/printable.rs#L1-L2">https://github.com/rust-lang/rust/blob/master/library/core/src/unicode/printable.rs#L1-L2</a> , or bindgen, or protobuf, or whatever) you could stick a <code>#![generated_code]</code> at the top, rather than potentially needing to <code>allow</code> a long and changing list of things.  For example, the non-standard style lints could completely ignore it, clippy's style category could ignore it, rustfmt could know not to look at it, etc.</p>
<p>Thoughts?  I suppose one easier alternative would be to just add a lint category, so you could allow a bunch of stuff at once, and we could add new lints to that category as part of checking new things, if they're just stylistic.</p>



<a name="277673379"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/idea%3A%20a%20%60%23%21%5Bgenerated_code%5D%60%20attribute/near/277673379" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Triplett <a href="https://zulip-archive.rust-lang.org/stream/213817-t-lang/topic/idea.3A.20a.20.60.23!.5Bgenerated_code.5D.60.20attribute.html#277673379">(Apr 04 2022 at 01:54)</a>:</h4>
<p><span class="user-mention" data-user-id="125270">@scottmcm</span> I'd be in favor of the concept, though I think there are still <em>some</em> lints I'd want to keep enabled for such code.</p>



<a name="277673392"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/idea%3A%20a%20%60%23%21%5Bgenerated_code%5D%60%20attribute/near/277673392" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Triplett <a href="https://zulip-archive.rust-lang.org/stream/213817-t-lang/topic/idea.3A.20a.20.60.23!.5Bgenerated_code.5D.60.20attribute.html#277673392">(Apr 04 2022 at 01:54)</a>:</h4>
<p>I think there are a couple of kinds of generated code, and I wonder if we should distinguish between them.</p>



<a name="277673414"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/idea%3A%20a%20%60%23%21%5Bgenerated_code%5D%60%20attribute/near/277673414" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Triplett <a href="https://zulip-archive.rust-lang.org/stream/213817-t-lang/topic/idea.3A.20a.20.60.23!.5Bgenerated_code.5D.60.20attribute.html#277673414">(Apr 04 2022 at 01:54)</a>:</h4>
<p>There's generated code for bindings, where it's appropriate to disable naming lints.</p>



<a name="277673426"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/idea%3A%20a%20%60%23%21%5Bgenerated_code%5D%60%20attribute/near/277673426" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Triplett <a href="https://zulip-archive.rust-lang.org/stream/213817-t-lang/topic/idea.3A.20a.20.60.23!.5Bgenerated_code.5D.60.20attribute.html#277673426">(Apr 04 2022 at 01:55)</a>:</h4>
<p>But for other kinds of generated code, it may still be appropriate to keep the naming lints.</p>



<a name="277673472"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/idea%3A%20a%20%60%23%21%5Bgenerated_code%5D%60%20attribute/near/277673472" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Triplett <a href="https://zulip-archive.rust-lang.org/stream/213817-t-lang/topic/idea.3A.20a.20.60.23!.5Bgenerated_code.5D.60.20attribute.html#277673472">(Apr 04 2022 at 01:56)</a>:</h4>
<p>Aside: I wonder if we should just make <code>extern "C" functionNameHere(...);</code> always disable naming lints? In general, if you're referencing an extern function, you probably don't get to pick the name.</p>



<a name="277673503"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/idea%3A%20a%20%60%23%21%5Bgenerated_code%5D%60%20attribute/near/277673503" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> scottmcm <a href="https://zulip-archive.rust-lang.org/stream/213817-t-lang/topic/idea.3A.20a.20.60.23!.5Bgenerated_code.5D.60.20attribute.html#277673503">(Apr 04 2022 at 01:56)</a>:</h4>
<p><span class="user-mention silent" data-user-id="239881">Josh Triplett</span> <a href="#narrow/stream/213817-t-lang/topic/idea.3A.20a.20.60.23!.5Bgenerated_code.5D.60.20attribute/near/277673379">said</a>:</p>
<blockquote>
<p>I think there are still <em>some</em> lints I'd want to keep enabled for such code.</p>
</blockquote>
<p>Absolutely.  Especially deny-by-default correctness lints we would presumably still want on.</p>



<a name="277673531"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/idea%3A%20a%20%60%23%21%5Bgenerated_code%5D%60%20attribute/near/277673531" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> scottmcm <a href="https://zulip-archive.rust-lang.org/stream/213817-t-lang/topic/idea.3A.20a.20.60.23!.5Bgenerated_code.5D.60.20attribute.html#277673531">(Apr 04 2022 at 01:57)</a>:</h4>
<p><span class="user-mention silent" data-user-id="239881">Josh Triplett</span> <a href="#narrow/stream/213817-t-lang/topic/idea.3A.20a.20.60.23!.5Bgenerated_code.5D.60.20attribute/near/277673472">said</a>:</p>
<blockquote>
<p>In general, if you're referencing an extern function, you probably don't get to pick the name.</p>
</blockquote>
<p>Looks like we already don't lint there: <a href="https://play.rust-lang.org/?version=stable&amp;mode=debug&amp;edition=2021&amp;gist=3108f182ed84a85d87f32756c9a9d137">https://play.rust-lang.org/?version=stable&amp;mode=debug&amp;edition=2021&amp;gist=3108f182ed84a85d87f32756c9a9d137</a></p>



<a name="277673547"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/idea%3A%20a%20%60%23%21%5Bgenerated_code%5D%60%20attribute/near/277673547" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Triplett <a href="https://zulip-archive.rust-lang.org/stream/213817-t-lang/topic/idea.3A.20a.20.60.23!.5Bgenerated_code.5D.60.20attribute.html#277673547">(Apr 04 2022 at 01:57)</a>:</h4>
<p>Oh, nice. For some reason I thought we did, given all the lints I see disabled in FFI code and bindgen-generated code and similar.</p>



<a name="277673609"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/idea%3A%20a%20%60%23%21%5Bgenerated_code%5D%60%20attribute/near/277673609" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> scottmcm <a href="https://zulip-archive.rust-lang.org/stream/213817-t-lang/topic/idea.3A.20a.20.60.23!.5Bgenerated_code.5D.60.20attribute.html#277673609">(Apr 04 2022 at 01:59)</a>:</h4>
<p><span class="user-mention silent" data-user-id="239881">Josh Triplett</span> <a href="#narrow/stream/213817-t-lang/topic/idea.3A.20a.20.60.23!.5Bgenerated_code.5D.60.20attribute/near/277673426">said</a>:</p>
<blockquote>
<p>But for other kinds of generated code, it may still be appropriate to keep the naming lints.</p>
</blockquote>
<p>I wonder how much it'd be handled by</p>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="k">fn</span> <span class="nf">blah</span><span class="p">(</span><span class="n">still_lint_here</span>: <span class="kt">i32</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="cp">#![generated_code]</span><span class="w"></span>

<span class="w">    </span><span class="o">..</span><span class="p">.</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>
</code></pre></div>



<a name="277684404"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/idea%3A%20a%20%60%23%21%5Bgenerated_code%5D%60%20attribute/near/277684404" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Charles Lew <a href="https://zulip-archive.rust-lang.org/stream/213817-t-lang/topic/idea.3A.20a.20.60.23!.5Bgenerated_code.5D.60.20attribute.html#277684404">(Apr 04 2022 at 05:42)</a>:</h4>
<p>If there's a similar <code>#![unfinished_code]</code> attribute and todo!() macro can somehow "inject" this attribute it would also be very useful.</p>



<a name="277692930"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/idea%3A%20a%20%60%23%21%5Bgenerated_code%5D%60%20attribute/near/277692930" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> matt rice <a href="https://zulip-archive.rust-lang.org/stream/213817-t-lang/topic/idea.3A.20a.20.60.23!.5Bgenerated_code.5D.60.20attribute.html#277692930">(Apr 04 2022 at 07:43)</a>:</h4>
<p>I think it's great, on a number of occasions i've had to resort to a hack like <code>mod disable_lints { #![allow(...)] use generated; } use disable_lints::*;</code>, which I think would be less of an issue if it was a non-moving target like <code>#![generated_code]</code>.</p>



<a name="277695766"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/idea%3A%20a%20%60%23%21%5Bgenerated_code%5D%60%20attribute/near/277695766" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> tm <a href="https://zulip-archive.rust-lang.org/stream/213817-t-lang/topic/idea.3A.20a.20.60.23!.5Bgenerated_code.5D.60.20attribute.html#277695766">(Apr 04 2022 at 08:10)</a>:</h4>
<p>BTW, there is undocumented <code>#[automatically_derived]</code> attribute that is used for this purpose.</p>



<a name="277714089"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/idea%3A%20a%20%60%23%21%5Bgenerated_code%5D%60%20attribute/near/277714089" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Connor Horman <a href="https://zulip-archive.rust-lang.org/stream/213817-t-lang/topic/idea.3A.20a.20.60.23!.5Bgenerated_code.5D.60.20attribute.html#277714089">(Apr 04 2022 at 11:00)</a>:</h4>
<p><span class="user-mention silent" data-user-id="116458">Charles Lew</span> <a href="#narrow/stream/213817-t-lang/topic/idea.3A.20a.20.60.23!.5Bgenerated_code.5D.60.20attribute/near/277684404">said</a>:</p>
<blockquote>
<p>If there's a similar <code>#![unfinished_code]</code> attribute and todo!() macro can somehow "inject" this attribute it would also be very useful.</p>
</blockquote>
<p>Yes please. clippy especially is very obnoxious when I have code that's obviously incomplete. I just want something that works and clippy wants me to have written the whole program and rigoursly proved it correct.</p>



<a name="277714411"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/idea%3A%20a%20%60%23%21%5Bgenerated_code%5D%60%20attribute/near/277714411" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Boxy [she/her] <a href="https://zulip-archive.rust-lang.org/stream/213817-t-lang/topic/idea.3A.20a.20.60.23!.5Bgenerated_code.5D.60.20attribute.html#277714411">(Apr 04 2022 at 11:04)</a>:</h4>
<p>Do you run clippy on <code>ctrl-s</code> or something?</p>



<a name="277714556"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/idea%3A%20a%20%60%23%21%5Bgenerated_code%5D%60%20attribute/near/277714556" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Connor Horman <a href="https://zulip-archive.rust-lang.org/stream/213817-t-lang/topic/idea.3A.20a.20.60.23!.5Bgenerated_code.5D.60.20attribute.html#277714556">(Apr 04 2022 at 11:06)</a>:</h4>
<p>Nah, in CI.</p>



<a name="277714607"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/idea%3A%20a%20%60%23%21%5Bgenerated_code%5D%60%20attribute/near/277714607" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Connor Horman <a href="https://zulip-archive.rust-lang.org/stream/213817-t-lang/topic/idea.3A.20a.20.60.23!.5Bgenerated_code.5D.60.20attribute.html#277714607">(Apr 04 2022 at 11:07)</a>:</h4>
<p>(This is on something like <a href="https://github.com/LightningCreations/lccc">https://github.com/LightningCreations/lccc</a>, where getting something fully working would take a few months - or I can finish stuff as it's needed)</p>



<a name="277728664"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/idea%3A%20a%20%60%23%21%5Bgenerated_code%5D%60%20attribute/near/277728664" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ben Kimock (Saethlin) <a href="https://zulip-archive.rust-lang.org/stream/213817-t-lang/topic/idea.3A.20a.20.60.23!.5Bgenerated_code.5D.60.20attribute.html#277728664">(Apr 04 2022 at 13:12)</a>:</h4>
<p>I run into a lot of similar grumbling due to clippy and picky rustc lints in CI that would be alleviated by a <code>#![unfinished_code]</code>. Currently we have a group of allows that get pasted into files people are working on in a dev branch. It would be nicer to have something with clearer semantic meaning than <code>#![allow(dead_code)]</code> and friends.</p>
<p>Also voicing my support for <code>#![generated_code]</code> not silencing everything. <code>bindgen</code> generates a lot of UB by default and it's good that rustc complains very loudly about this.</p>



<a name="277731650"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/idea%3A%20a%20%60%23%21%5Bgenerated_code%5D%60%20attribute/near/277731650" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jake Goulding <a href="https://zulip-archive.rust-lang.org/stream/213817-t-lang/topic/idea.3A.20a.20.60.23!.5Bgenerated_code.5D.60.20attribute.html#277731650">(Apr 04 2022 at 13:37)</a>:</h4>
<p>I want this (or something similar) for SNAFU:</p>
<blockquote>
<p>I think the problem is that we generate structs for each variant, and each struct has methods and/or trait implementations which generate that variant, which means that the variant isn't unused.</p>
</blockquote>
<blockquote>
<p>I think that the struct itself isn't marked as unused because nothing generated by a procedural macro is marked as unused. I don't know of a way to indicate otherwise.</p>
</blockquote>
<p>See also <a href="https://github.com/rust-lang/rust/issues/47851">impls should not inhibit the unused_item lint #47851</a></p>



<a name="277754724"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/idea%3A%20a%20%60%23%21%5Bgenerated_code%5D%60%20attribute/near/277754724" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Eric Huss <a href="https://zulip-archive.rust-lang.org/stream/213817-t-lang/topic/idea.3A.20a.20.60.23!.5Bgenerated_code.5D.60.20attribute.html#277754724">(Apr 04 2022 at 16:10)</a>:</h4>
<p><span class="user-mention silent" data-user-id="352985">tm</span> <a href="#narrow/stream/213817-t-lang/topic/idea.3A.20a.20.60.23!.5Bgenerated_code.5D.60.20attribute/near/277695766">said</a>:</p>
<blockquote>
<p>BTW, there is undocumented <code>#[automatically_derived]</code> attribute that is used for this purpose.</p>
</blockquote>
<p>It is documented here: <a href="https://doc.rust-lang.org/nightly/reference/attributes/derive.html#the-automatically_derived-attribute">https://doc.rust-lang.org/nightly/reference/attributes/derive.html#the-automatically_derived-attribute</a></p>



<a name="277812215"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/idea%3A%20a%20%60%23%21%5Bgenerated_code%5D%60%20attribute/near/277812215" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Lokathor <a href="https://zulip-archive.rust-lang.org/stream/213817-t-lang/topic/idea.3A.20a.20.60.23!.5Bgenerated_code.5D.60.20attribute.html#277812215">(Apr 05 2022 at 00:29)</a>:</h4>
<p>just as a note, I'd still like to run rustfmt on my generated code.</p>



<a name="277914146"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/idea%3A%20a%20%60%23%21%5Bgenerated_code%5D%60%20attribute/near/277914146" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Daniel Henry-Mantilla <a href="https://zulip-archive.rust-lang.org/stream/213817-t-lang/topic/idea.3A.20a.20.60.23!.5Bgenerated_code.5D.60.20attribute.html#277914146">(Apr 05 2022 at 17:23)</a>:</h4>
<p>FWIW, on the topic of formatting generated code, there is also <a href="https://docs.rs/prettyplease">https://docs.rs/prettyplease</a> —or <a href="https://crates.io/crates/prettyplease-cli">https://crates.io/crates/prettyplease-cli</a> as a basic standalone cli wrapper. (although it will crash on certain Rust code, since <a href="https://github.com/dtolnay/syn/issues/1143">there is Rust code that <code>syn</code> is unable to parse</a>)</p>



<a name="277924873"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/idea%3A%20a%20%60%23%21%5Bgenerated_code%5D%60%20attribute/near/277924873" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Lokathor <a href="https://zulip-archive.rust-lang.org/stream/213817-t-lang/topic/idea.3A.20a.20.60.23!.5Bgenerated_code.5D.60.20attribute.html#277924873">(Apr 05 2022 at 18:36)</a>:</h4>
<p>I don't use <code>syn</code> during my code generation.</p>
<p>I just want to be able to run rustfmt on the file</p>



<hr><p>Last updated: Apr 12 2022 at 20:01 UTC</p>
</html>