<html>
<head><meta charset="utf-8"><title>stabilizing #[derive(Default)]` on enums Â· t-lang Â· Zulip Chat Archive</title></head>
<h2>Stream: <a href="https://zulip-archive.rust-lang.org/stream/213817-t-lang/index.html">t-lang</a></h2>
<h3>Topic: <a href="https://zulip-archive.rust-lang.org/stream/213817-t-lang/topic/stabilizing.20.23.5Bderive(Default).5D.60.20on.20enums.html">stabilizing #[derive(Default)]` on enums</a></h3>

<hr>

<base href="https://rust-lang.zulipchat.com">

<head><link href="https://zulip-archive.rust-lang.org/style.css" rel="stylesheet"></head>

<a name="272843760"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/stabilizing%20%23%5Bderive%28Default%29%5D%60%20on%20enums/near/272843760" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jacob Pratt <a href="https://zulip-archive.rust-lang.org/stream/213817-t-lang/topic/stabilizing.20.23.5Bderive(Default).5D.60.20on.20enums.html#272843760">(Feb 22 2022 at 18:10)</a>:</h4>
<p>Thoughts on stabilizing <a href="https://github.com/rust-lang/rust/issues/87517">#87517</a>?</p>



<a name="272850043"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/stabilizing%20%23%5Bderive%28Default%29%5D%60%20on%20enums/near/272850043" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Triplett <a href="https://zulip-archive.rust-lang.org/stream/213817-t-lang/topic/stabilizing.20.23.5Bderive(Default).5D.60.20on.20enums.html#272850043">(Feb 22 2022 at 18:55)</a>:</h4>
<p><span aria-label="+1" class="emoji emoji-1f44d" role="img" title="+1">:+1:</span></p>



<a name="272850130"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/stabilizing%20%23%5Bderive%28Default%29%5D%60%20on%20enums/near/272850130" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Triplett <a href="https://zulip-archive.rust-lang.org/stream/213817-t-lang/topic/stabilizing.20.23.5Bderive(Default).5D.60.20on.20enums.html#272850130">(Feb 22 2022 at 18:56)</a>:</h4>
<p>I think we have a ways to go before we get there on structs, but on enums, seems good to me.</p>



<a name="272850134"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/stabilizing%20%23%5Bderive%28Default%29%5D%60%20on%20enums/near/272850134" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> simulacrum <a href="https://zulip-archive.rust-lang.org/stream/213817-t-lang/topic/stabilizing.20.23.5Bderive(Default).5D.60.20on.20enums.html#272850134">(Feb 22 2022 at 18:56)</a>:</h4>
<p>Yeah, I think there's no strong concerns here that would prevent stabilization</p>



<a name="272852181"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/stabilizing%20%23%5Bderive%28Default%29%5D%60%20on%20enums/near/272852181" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Mario Carneiro <a href="https://zulip-archive.rust-lang.org/stream/213817-t-lang/topic/stabilizing.20.23.5Bderive(Default).5D.60.20on.20enums.html#272852181">(Feb 22 2022 at 19:09)</a>:</h4>
<p>The unit variant thing seems quite limiting, especially if the enum doesn't have any type arguments in the first place. Prohibiting variants with type arguments would also satisfy the bikeshed avoidance issue and would be a lot more permissive</p>



<a name="272852522"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/stabilizing%20%23%5Bderive%28Default%29%5D%60%20on%20enums/near/272852522" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> scottmcm <a href="https://zulip-archive.rust-lang.org/stream/213817-t-lang/topic/stabilizing.20.23.5Bderive(Default).5D.60.20on.20enums.html#272852522">(Feb 22 2022 at 19:12)</a>:</h4>
<p>Hmm, does this do anything that a user-written proc macro couldn't do?</p>
<p>Because I didn't think it does, and if that's the case, then IMHO it's a <a class="stream" data-stream-id="219381" href="/#narrow/stream/219381-t-libs">#t-libs</a> (T-libs-api) issue, not a lang one.</p>



<a name="272854092"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/stabilizing%20%23%5Bderive%28Default%29%5D%60%20on%20enums/near/272854092" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jacob Pratt <a href="https://zulip-archive.rust-lang.org/stream/213817-t-lang/topic/stabilizing.20.23.5Bderive(Default).5D.60.20on.20enums.html#272854092">(Feb 22 2022 at 19:23)</a>:</h4>
<p><span class="user-mention" data-user-id="271719">@Mario Carneiro</span> There was significant discussion about this previously. The RFC was scaled back specifically to avoid the issue of bounds. It was generally understood that this is a first step.</p>
<p><span class="user-mention" data-user-id="125270">@scottmcm</span> Good point. This would be T-libs-api in that case, as this could be done in userspace. There's nothing special about the behavior here, just that it's a built-in macro (for convenience, I presume).</p>



<a name="272854232"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/stabilizing%20%23%5Bderive%28Default%29%5D%60%20on%20enums/near/272854232" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Mario Carneiro <a href="https://zulip-archive.rust-lang.org/stream/213817-t-lang/topic/stabilizing.20.23.5Bderive(Default).5D.60.20on.20enums.html#272854232">(Feb 22 2022 at 19:24)</a>:</h4>
<p>Right, I gathered as much. My point is that you can still avoid the question of bounds if the constraint is "does not mention type variables" instead of "does not have fields"</p>



<a name="272854300"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/stabilizing%20%23%5Bderive%28Default%29%5D%60%20on%20enums/near/272854300" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jacob Pratt <a href="https://zulip-archive.rust-lang.org/stream/213817-t-lang/topic/stabilizing.20.23.5Bderive(Default).5D.60.20on.20enums.html#272854300">(Feb 22 2022 at 19:25)</a>:</h4>
<p>It's still not agreed what the bounds should be, though.</p>



<a name="272854375"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/stabilizing%20%23%5Bderive%28Default%29%5D%60%20on%20enums/near/272854375" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Mario Carneiro <a href="https://zulip-archive.rust-lang.org/stream/213817-t-lang/topic/stabilizing.20.23.5Bderive(Default).5D.60.20on.20enums.html#272854375">(Feb 22 2022 at 19:26)</a>:</h4>
<p>The RFC is at least committing to no bounds in the unit variant case</p>



<a name="272854405"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/stabilizing%20%23%5Bderive%28Default%29%5D%60%20on%20enums/near/272854405" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Mario Carneiro <a href="https://zulip-archive.rust-lang.org/stream/213817-t-lang/topic/stabilizing.20.23.5Bderive(Default).5D.60.20on.20enums.html#272854405">(Feb 22 2022 at 19:26)</a>:</h4>
<p>like the <code>Option&lt;T&gt;</code> example</p>



<a name="272854407"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/stabilizing%20%23%5Bderive%28Default%29%5D%60%20on%20enums/near/272854407" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jacob Pratt <a href="https://zulip-archive.rust-lang.org/stream/213817-t-lang/topic/stabilizing.20.23.5Bderive(Default).5D.60.20on.20enums.html#272854407">(Feb 22 2022 at 19:26)</a>:</h4>
<p>Because everybody agreed that was the sensible thing to do.</p>



<a name="272854429"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/stabilizing%20%23%5Bderive%28Default%29%5D%60%20on%20enums/near/272854429" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jacob Pratt <a href="https://zulip-archive.rust-lang.org/stream/213817-t-lang/topic/stabilizing.20.23.5Bderive(Default).5D.60.20on.20enums.html#272854429">(Feb 22 2022 at 19:26)</a>:</h4>
<p>Discussion about bounds is separate to what I'm asking here. I'm solely asking about stabilization of what has already been agreed upon, has been through the RFC process, and been implemented.</p>



<a name="272854599"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/stabilizing%20%23%5Bderive%28Default%29%5D%60%20on%20enums/near/272854599" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Mario Carneiro <a href="https://zulip-archive.rust-lang.org/stream/213817-t-lang/topic/stabilizing.20.23.5Bderive(Default).5D.60.20on.20enums.html#272854599">(Feb 22 2022 at 19:28)</a>:</h4>
<p>You can still trivially do no bounds in the case <code>enum Foo&lt;T&gt; { #[default] A(u32), B(T) }</code></p>



<a name="272854632"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/stabilizing%20%23%5Bderive%28Default%29%5D%60%20on%20enums/near/272854632" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jacob Pratt <a href="https://zulip-archive.rust-lang.org/stream/213817-t-lang/topic/stabilizing.20.23.5Bderive(Default).5D.60.20on.20enums.html#272854632">(Feb 22 2022 at 19:28)</a>:</h4>
<p>Please create a separate thread to discuss this if you'd like.</p>



<a name="272854642"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/stabilizing%20%23%5Bderive%28Default%29%5D%60%20on%20enums/near/272854642" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Mario Carneiro <a href="https://zulip-archive.rust-lang.org/stream/213817-t-lang/topic/stabilizing.20.23.5Bderive(Default).5D.60.20on.20enums.html#272854642">(Feb 22 2022 at 19:28)</a>:</h4>
<p>but it's a fair point that this is not super relevant to the stabilization question</p>



<a name="273573476"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/stabilizing%20%23%5Bderive%28Default%29%5D%60%20on%20enums/near/273573476" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/213817-t-lang/topic/stabilizing.20.23.5Bderive(Default).5D.60.20on.20enums.html#273573476">(Mar 01 2022 at 00:13)</a>:</h4>
<p>JFYI I've been working towards a model that enables "perfect derive"</p>



<a name="273575189"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/stabilizing%20%23%5Bderive%28Default%29%5D%60%20on%20enums/near/273575189" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jacob Pratt ðŸ‡ºðŸ‡¦ <a href="https://zulip-archive.rust-lang.org/stream/213817-t-lang/topic/stabilizing.20.23.5Bderive(Default).5D.60.20on.20enums.html#273575189">(Mar 01 2022 at 00:32)</a>:</h4>
<p>"perfect" in the sense of bounds or something else?</p>



<a name="273580618"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/stabilizing%20%23%5Bderive%28Default%29%5D%60%20on%20enums/near/273580618" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Triplett <a href="https://zulip-archive.rust-lang.org/stream/213817-t-lang/topic/stabilizing.20.23.5Bderive(Default).5D.60.20on.20enums.html#273580618">(Mar 01 2022 at 01:46)</a>:</h4>
<p><span class="user-mention silent" data-user-id="116009">nikomatsakis</span> <a href="#narrow/stream/213817-t-lang/topic/stabilizing.20.23.5Bderive.28Default.29.5D.60.20on.20enums/near/273573476">said</a>:</p>
<blockquote>
<p>JFYI I've been working towards a model that enables "perfect derive"</p>
</blockquote>
<p>I'd love to hear more about this!</p>



<a name="273580917"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/stabilizing%20%23%5Bderive%28Default%29%5D%60%20on%20enums/near/273580917" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jake Goulding <a href="https://zulip-archive.rust-lang.org/stream/213817-t-lang/topic/stabilizing.20.23.5Bderive(Default).5D.60.20on.20enums.html#273580917">(Mar 01 2022 at 01:50)</a>:</h4>
<blockquote>
<p>I have discovered a truly marvelous proof of [perfect derives], which this margin is too narrow to contain.</p>
</blockquote>



<a name="275177662"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/stabilizing%20%23%5Bderive%28Default%29%5D%60%20on%20enums/near/275177662" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jacob Pratt ðŸ‡ºðŸ‡¦ <a href="https://zulip-archive.rust-lang.org/stream/213817-t-lang/topic/stabilizing.20.23.5Bderive(Default).5D.60.20on.20enums.html#275177662">(Mar 13 2022 at 22:08)</a>:</h4>
<p>So this doesn't fall off the radar, a stabilization report and PR are up. Just needs FCP at this point.</p>



<a name="275178315"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/stabilizing%20%23%5Bderive%28Default%29%5D%60%20on%20enums/near/275178315" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jacob Pratt ðŸ‡ºðŸ‡¦ <a href="https://zulip-archive.rust-lang.org/stream/213817-t-lang/topic/stabilizing.20.23.5Bderive(Default).5D.60.20on.20enums.html#275178315">(Mar 13 2022 at 22:25)</a>:</h4>
<p>Thanks <span class="user-mention" data-user-id="239881">@Josh Triplett</span></p>



<hr><p>Last updated: Apr 12 2022 at 20:01 UTC</p>
</html>