<html>
<head><meta charset="utf-8"><title>Use cases for always const `const` trait bounds · t-lang · Zulip Chat Archive</title></head>
<h2>Stream: <a href="https://zulip-archive.rust-lang.org/stream/213817-t-lang/index.html">t-lang</a></h2>
<h3>Topic: <a href="https://zulip-archive.rust-lang.org/stream/213817-t-lang/topic/Use.20cases.20for.20always.20const.20.60const.60.20trait.20bounds.html">Use cases for always const `const` trait bounds</a></h3>

<hr>

<base href="https://rust-lang.zulipchat.com">

<head><link href="https://zulip-archive.rust-lang.org/style.css" rel="stylesheet"></head>

<a name="266498740"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/Use%20cases%20for%20always%20const%20%60const%60%20trait%20bounds/near/266498740" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> fee1-dead <a href="https://zulip-archive.rust-lang.org/stream/213817-t-lang/topic/Use.20cases.20for.20always.20const.20.60const.60.20trait.20bounds.html#266498740">(Dec 31 2021 at 11:39)</a>:</h4>
<p>In the 12-22 meeting, we discussed whether <code>~const</code> could just be reduced to <code>const</code> without the tilde to make it easier to write.</p>
<p>AFAIK, there might be some problems: it makes it harder to write "always const" bounds. Some use case for "always" const bounds (could be useful):</p>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="k">const</span><span class="w"> </span><span class="k">fn</span> <span class="nf">do_something_with_hashable_thing</span><span class="o">&lt;</span><span class="n">T</span>: <span class="nc">const</span><span class="w"> </span><span class="nb">Default</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="n">Hash</span><span class="o">&gt;</span><span class="p">(</span><span class="n">thing</span>: <span class="nc">T</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="k">const</span><span class="w"> </span><span class="k">fn</span> <span class="nf">default_hash</span><span class="o">&lt;</span><span class="n">T</span>: <span class="nc">const</span><span class="w"> </span><span class="nb">Default</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="n">Hash</span><span class="o">&gt;</span><span class="p">()</span><span class="w"> </span>-&gt; <span class="kt">u64</span> <span class="p">{</span><span class="w"> </span><span class="cm">/* ... */</span><span class="w"> </span><span class="p">}</span><span class="w"></span>
<span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="n">default_hash</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">default_hash</span>::<span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;</span><span class="p">();</span><span class="w"></span>
<span class="w">    </span><span class="cm">/* do something */</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>
</code></pre></div>
<p>I think we could make <code>const Trait</code> mean "const-if-const" and figure out how to allow "always const" bounds later. But it could interfere with future extensions: if <code>const fn</code> pointers become a thing, it is natural to denote them as <code>const fn(ARGS) -&gt; RET</code>, if we decided that <code>const Trait</code> means "const-if-const" then <code>const fn</code> pointers would be inconsistent with this.</p>



<a name="266507980"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/Use%20cases%20for%20always%20const%20%60const%60%20trait%20bounds/near/266507980" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> oli <a href="https://zulip-archive.rust-lang.org/stream/213817-t-lang/topic/Use.20cases.20for.20always.20const.20.60const.60.20trait.20bounds.html#266507980">(Dec 31 2021 at 15:03)</a>:</h4>
<p>I think const fn pointers should behave like const trait bounds, so const-if-const. Any syntax we come up with should definitely be in sync between the two</p>



<a name="266508059"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/Use%20cases%20for%20always%20const%20%60const%60%20trait%20bounds/near/266508059" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> oli <a href="https://zulip-archive.rust-lang.org/stream/213817-t-lang/topic/Use.20cases.20for.20always.20const.20.60const.60.20trait.20bounds.html#266508059">(Dec 31 2021 at 15:04)</a>:</h4>
<p>I think const-if-const fn pointers are the only ones that really make sense, unless we have some sort of purity concept that runtime could rely on. You can't move a const(always) fn pointer from runtime to compile-time anyway</p>



<a name="267271565"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/Use%20cases%20for%20always%20const%20%60const%60%20trait%20bounds/near/267271565" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Gary Guo <a href="https://zulip-archive.rust-lang.org/stream/213817-t-lang/topic/Use.20cases.20for.20always.20const.20.60const.60.20trait.20bounds.html#267271565">(Jan 08 2022 at 03:17)</a>:</h4>
<p>Always const trait bounds can be useful for non-const fns as well. Hypothetically we could have:</p>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="k">fn</span> <span class="nf">foo</span><span class="o">&lt;</span><span class="n">T</span>: <span class="nc">const</span><span class="w"> </span><span class="n">Foo</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="nb">Default</span><span class="o">&gt;</span><span class="p">()</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">   </span><span class="k">const</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="cm">/*do something*/</span><span class="w"> </span><span class="n">T</span>::<span class="n">default</span><span class="p">().</span><span class="n">foo</span><span class="p">()</span><span class="w"> </span><span class="p">};</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>
</code></pre></div>
<p>when const block is allowed to refer to params non-trivially.</p>



<a name="267306652"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/Use%20cases%20for%20always%20const%20%60const%60%20trait%20bounds/near/267306652" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> oli <a href="https://zulip-archive.rust-lang.org/stream/213817-t-lang/topic/Use.20cases.20for.20always.20const.20.60const.60.20trait.20bounds.html#267306652">(Jan 08 2022 at 17:41)</a>:</h4>
<p>Yea, that's the main use case, the question is, is it frequent enough to warrant making the syntax for const-if-const something more complicated?</p>



<hr><p>Last updated: Apr 12 2022 at 20:01 UTC</p>
</html>