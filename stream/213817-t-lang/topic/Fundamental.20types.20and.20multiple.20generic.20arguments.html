<html>
<head><meta charset="utf-8"><title>Fundamental types and multiple generic arguments · t-lang · Zulip Chat Archive</title></head>
<h2>Stream: <a href="https://zulip-archive.rust-lang.org/stream/213817-t-lang/index.html">t-lang</a></h2>
<h3>Topic: <a href="https://zulip-archive.rust-lang.org/stream/213817-t-lang/topic/Fundamental.20types.20and.20multiple.20generic.20arguments.html">Fundamental types and multiple generic arguments</a></h3>

<hr>

<base href="https://rust-lang.zulipchat.com">

<head><link href="https://zulip-archive.rust-lang.org/style.css" rel="stylesheet"></head>

<a name="253322865"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/Fundamental%20types%20and%20multiple%20generic%20arguments/near/253322865" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Gary Guo <a href="https://zulip-archive.rust-lang.org/stream/213817-t-lang/topic/Fundamental.20types.20and.20multiple.20generic.20arguments.html#253322865">(Sep 14 2021 at 20:57)</a>:</h4>
<p>An interesting snippets: <a href="https://play.rust-lang.org/?version=nightly&amp;mode=debug&amp;edition=2018&amp;gist=b9e28b5591d37e57ffc773d82c795e21">https://play.rust-lang.org/?version=nightly&amp;mode=debug&amp;edition=2018&amp;gist=b9e28b5591d37e57ffc773d82c795e21</a></p>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="cp">#![feature(allocator_api)]</span><span class="w"></span>
<span class="k">use</span><span class="w"> </span><span class="n">core</span>::<span class="n">alloc</span>::<span class="n">Allocator</span><span class="p">;</span><span class="w"></span>

<span class="k">struct</span> <span class="nc">MyVec</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;</span><span class="p">(</span><span class="nb">Vec</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;</span><span class="p">);</span><span class="w"></span>

<span class="k">impl</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;</span><span class="w"> </span><span class="nb">Into</span><span class="o">&lt;</span><span class="nb">Box</span><span class="o">&lt;</span><span class="p">[</span><span class="n">T</span><span class="p">]</span><span class="o">&gt;&gt;</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="n">MyVec</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="k">fn</span> <span class="nf">into</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span><span class="w"> </span>-&gt; <span class="nb">Box</span><span class="o">&lt;</span><span class="p">[</span><span class="n">T</span><span class="p">]</span><span class="o">&gt;</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">        </span><span class="fm">todo!</span><span class="p">();</span><span class="w"></span>
<span class="w">    </span><span class="p">}</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>

<span class="k">struct</span> <span class="nc">MyVec2</span><span class="o">&lt;</span><span class="n">T</span><span class="p">,</span><span class="w"> </span><span class="n">A</span>: <span class="nc">Allocator</span><span class="o">&gt;</span><span class="p">(</span><span class="nb">Box</span><span class="o">&lt;</span><span class="n">T</span><span class="p">,</span><span class="w"> </span><span class="n">A</span><span class="o">&gt;</span><span class="p">);</span><span class="w"></span>

<span class="k">impl</span><span class="o">&lt;</span><span class="n">T</span><span class="p">,</span><span class="w"> </span><span class="n">A</span>: <span class="nc">Allocator</span><span class="o">&gt;</span><span class="w"> </span><span class="nb">Into</span><span class="o">&lt;</span><span class="nb">Box</span><span class="o">&lt;</span><span class="p">[</span><span class="n">T</span><span class="p">],</span><span class="w"> </span><span class="n">A</span><span class="o">&gt;&gt;</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="n">MyVec2</span><span class="o">&lt;</span><span class="n">T</span><span class="p">,</span><span class="w"> </span><span class="n">A</span><span class="o">&gt;</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="k">fn</span> <span class="nf">into</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span><span class="w"> </span>-&gt; <span class="nb">Box</span><span class="o">&lt;</span><span class="p">[</span><span class="n">T</span><span class="p">],</span><span class="w"> </span><span class="n">A</span><span class="o">&gt;</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">        </span><span class="fm">todo!</span><span class="p">();</span><span class="w"></span>
<span class="w">    </span><span class="p">}</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>
</code></pre></div>
<p>The first part works while the second part doesn't. I assume this is related to Box being fundamental? A crate defining an allocator <code>MyAlloc</code> could impl Box&lt;[T], MyAlloc&gt;, I am not sure if it's intended?</p>



<a name="253850153"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/Fundamental%20types%20and%20multiple%20generic%20arguments/near/253850153" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> eddyb <a href="https://zulip-archive.rust-lang.org/stream/213817-t-lang/topic/Fundamental.20types.20and.20multiple.20generic.20arguments.html#253850153">(Sep 18 2021 at 08:11)</a>:</h4>
<p>looks like <code>#[fundamental]</code>, "hiding" <code>A</code> makes coherence happy (<a href="https://play.rust-lang.org/?version=nightly&amp;mode=debug&amp;edition=2018&amp;gist=0ff0b7758e09078ed2c1bfbf1fd539ae">https://play.rust-lang.org/?version=nightly&amp;mode=debug&amp;edition=2018&amp;gist=0ff0b7758e09078ed2c1bfbf1fd539ae</a>)</p>



<a name="253850239"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/Fundamental%20types%20and%20multiple%20generic%20arguments/near/253850239" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> eddyb <a href="https://zulip-archive.rust-lang.org/stream/213817-t-lang/topic/Fundamental.20types.20and.20multiple.20generic.20arguments.html#253850239">(Sep 18 2021 at 08:12)</a>:</h4>
<p>same thing happens with <code>T</code>, the only difference in your snippet is that <code>[T]</code> hides <code>T</code> (which is a bit weird, I would've expected it to be considered <code>#[fundamental]</code>): <a href="https://play.rust-lang.org/?version=nightly&amp;mode=debug&amp;edition=2018&amp;gist=76db15051bbbb7f065e41b160bf790e1">https://play.rust-lang.org/?version=nightly&amp;mode=debug&amp;edition=2018&amp;gist=76db15051bbbb7f065e41b160bf790e1</a></p>



<a name="253850331"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/Fundamental%20types%20and%20multiple%20generic%20arguments/near/253850331" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> eddyb <a href="https://zulip-archive.rust-lang.org/stream/213817-t-lang/topic/Fundamental.20types.20and.20multiple.20generic.20arguments.html#253850331">(Sep 18 2021 at 08:14)</a>:</h4>
<p>perhaps the smart thing to do would be to augment <code>#[fundamental]</code> with a set of generic parameters that a type is fundamental "over", and make sure <code>Box</code> has the right semantics, before the feature is stabilized and we can't change this anymore</p>



<a name="253888528"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/Fundamental%20types%20and%20multiple%20generic%20arguments/near/253888528" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Gary Guo <a href="https://zulip-archive.rust-lang.org/stream/213817-t-lang/topic/Fundamental.20types.20and.20multiple.20generic.20arguments.html#253888528">(Sep 18 2021 at 19:27)</a>:</h4>
<p>Or maybe make fundamental an attribute of generic parameter instead?</p>



<a name="254575574"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/Fundamental%20types%20and%20multiple%20generic%20arguments/near/254575574" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/213817-t-lang/topic/Fundamental.20types.20and.20multiple.20generic.20arguments.html#254575574">(Sep 23 2021 at 17:46)</a>:</h4>
<p>fundamental is not meant to be used on traits with type parameters :)</p>



<a name="254575591"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/Fundamental%20types%20and%20multiple%20generic%20arguments/near/254575591" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/213817-t-lang/topic/Fundamental.20types.20and.20multiple.20generic.20arguments.html#254575591">(Sep 23 2021 at 17:46)</a>:</h4>
<p>iirc chalk asserts that it is not</p>



<a name="254576917"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/Fundamental%20types%20and%20multiple%20generic%20arguments/near/254576917" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://zulip-archive.rust-lang.org/stream/213817-t-lang/topic/Fundamental.20types.20and.20multiple.20generic.20arguments.html#254576917">(Sep 23 2021 at 17:55)</a>:</h4>
<p>Chalk does not</p>



<a name="254577117"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/Fundamental%20types%20and%20multiple%20generic%20arguments/near/254577117" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://zulip-archive.rust-lang.org/stream/213817-t-lang/topic/Fundamental.20types.20and.20multiple.20generic.20arguments.html#254577117">(Sep 23 2021 at 17:56)</a>:</h4>
<p>At this point, we only assert that the length of generics on adts is &gt;= 1</p>



<a name="254577148"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/Fundamental%20types%20and%20multiple%20generic%20arguments/near/254577148" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://zulip-archive.rust-lang.org/stream/213817-t-lang/topic/Fundamental.20types.20and.20multiple.20generic.20arguments.html#254577148">(Sep 23 2021 at 17:56)</a>:</h4>
<p>(fundamental adts, that is)</p>



<a name="254578110"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/Fundamental%20types%20and%20multiple%20generic%20arguments/near/254578110" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/213817-t-lang/topic/Fundamental.20types.20and.20multiple.20generic.20arguments.html#254578110">(Sep 23 2021 at 18:02)</a>:</h4>
<p>I'll have to check. I remember hardcoding some similar assumption.</p>



<a name="254578115"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/Fundamental%20types%20and%20multiple%20generic%20arguments/near/254578115" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/213817-t-lang/topic/Fundamental.20types.20and.20multiple.20generic.20arguments.html#254578115">(Sep 23 2021 at 18:02)</a>:</h4>
<p>It might've been that</p>



<a name="254617642"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/Fundamental%20types%20and%20multiple%20generic%20arguments/near/254617642" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://zulip-archive.rust-lang.org/stream/213817-t-lang/topic/Fundamental.20types.20and.20multiple.20generic.20arguments.html#254617642">(Sep 23 2021 at 22:49)</a>:</h4>
<p>The check for adts used to be parameters == 1, but it was changed for <code>Box</code>/etc.</p>



<a name="254618726"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/Fundamental%20types%20and%20multiple%20generic%20arguments/near/254618726" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Gary Guo <a href="https://zulip-archive.rust-lang.org/stream/213817-t-lang/topic/Fundamental.20types.20and.20multiple.20generic.20arguments.html#254618726">(Sep 23 2021 at 22:59)</a>:</h4>
<p><span class="user-mention silent" data-user-id="116009">nikomatsakis</span> <a href="#narrow/stream/213817-t-lang/topic/Fundamental.20types.20and.20multiple.20generic.20arguments/near/254575574">said</a>:</p>
<blockquote>
<p>fundamental is not meant to be used on traits with type parameters :)</p>
</blockquote>
<p>Sorry I didn't quite follow. Which usage is not intended?</p>



<a name="257626139"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/Fundamental%20types%20and%20multiple%20generic%20arguments/near/257626139" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Gary Guo <a href="https://zulip-archive.rust-lang.org/stream/213817-t-lang/topic/Fundamental.20types.20and.20multiple.20generic.20arguments.html#257626139">(Oct 15 2021 at 00:05)</a>:</h4>
<p>Had another look at this issue today, and reduced to this:</p>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="cp">#![feature(allocator_api)]</span><span class="w"></span>
<span class="k">use</span><span class="w"> </span><span class="n">std</span>::<span class="n">alloc</span>::<span class="n">Allocator</span><span class="p">;</span><span class="w"></span>

<span class="k">struct</span> <span class="nc">MyType</span><span class="o">&lt;</span><span class="n">A</span>: <span class="nc">Allocator</span><span class="o">&gt;</span><span class="p">(</span><span class="n">A</span><span class="p">);</span><span class="w"></span>

<span class="c1">// Not allowed</span>
<span class="k">impl</span><span class="o">&lt;</span><span class="n">A</span>: <span class="nc">Allocator</span><span class="o">&gt;</span><span class="w"> </span><span class="nb">Into</span><span class="o">&lt;</span><span class="nb">Box</span><span class="o">&lt;</span><span class="kt">u32</span><span class="p">,</span><span class="w"> </span><span class="n">A</span><span class="o">&gt;&gt;</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="n">MyType</span><span class="o">&lt;</span><span class="n">A</span><span class="o">&gt;</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="k">fn</span> <span class="nf">into</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span><span class="w"> </span>-&gt; <span class="nb">Box</span><span class="o">&lt;</span><span class="kt">u32</span><span class="p">,</span><span class="w"> </span><span class="n">A</span><span class="o">&gt;</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">        </span><span class="fm">todo!</span><span class="p">();</span><span class="w"></span>
<span class="w">    </span><span class="p">}</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>

<span class="c1">// Allowed</span>
<span class="k">impl</span><span class="o">&lt;</span><span class="n">A</span>: <span class="nc">Allocator</span><span class="o">&gt;</span><span class="w"> </span><span class="nb">Into</span><span class="o">&lt;</span><span class="nb">Vec</span><span class="o">&lt;</span><span class="kt">u32</span><span class="p">,</span><span class="w"> </span><span class="n">A</span><span class="o">&gt;&gt;</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="n">MyType</span><span class="o">&lt;</span><span class="n">A</span><span class="o">&gt;</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="k">fn</span> <span class="nf">into</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span><span class="w"> </span>-&gt; <span class="nb">Vec</span><span class="o">&lt;</span><span class="kt">u32</span><span class="p">,</span><span class="w"> </span><span class="n">A</span><span class="o">&gt;</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">        </span><span class="fm">todo!</span><span class="p">();</span><span class="w"></span>
<span class="w">    </span><span class="p">}</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>
</code></pre></div>
<p>Got rid of the <code>T</code> and <code>[T]</code> and hopefully this is clearer.</p>
<p>The error says a downstream crate may implement <code>impl From&lt;Foreign&gt; for Box&lt;Foreign, Local&gt;</code> (which is indeed permitted today).</p>



<hr><p>Last updated: Apr 12 2022 at 20:01 UTC</p>
</html>