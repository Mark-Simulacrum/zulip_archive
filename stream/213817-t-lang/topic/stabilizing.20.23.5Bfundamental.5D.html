<html>
<head><meta charset="utf-8"><title>stabilizing #[fundamental] · t-lang · Zulip Chat Archive</title></head>
<h2>Stream: <a href="https://zulip-archive.rust-lang.org/stream/213817-t-lang/index.html">t-lang</a></h2>
<h3>Topic: <a href="https://zulip-archive.rust-lang.org/stream/213817-t-lang/topic/stabilizing.20.23.5Bfundamental.5D.html">stabilizing #[fundamental]</a></h3>

<hr>

<base href="https://rust-lang.zulipchat.com">

<head><link href="https://zulip-archive.rust-lang.org/style.css" rel="stylesheet"></head>

<a name="270427340"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/stabilizing%20%23%5Bfundamental%5D/near/270427340" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Triplett <a href="https://zulip-archive.rust-lang.org/stream/213817-t-lang/topic/stabilizing.20.23.5Bfundamental.5D.html#270427340">(Feb 02 2022 at 17:44)</a>:</h4>
<p><span class="user-mention" data-user-id="213696">@Armin Ronacher</span> The lang team discussed that not too long ago, and came to the conclusion that it'd be potentially risky to use outside the standard library. We didn't rule out stabilizing it, but we were hesitant.</p>



<a name="270427438"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/stabilizing%20%23%5Bfundamental%5D/near/270427438" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Daniel Henry-Mantilla <a href="https://zulip-archive.rust-lang.org/stream/213817-t-lang/topic/stabilizing.20.23.5Bfundamental.5D.html#270427438">(Feb 02 2022 at 17:44)</a>:</h4>
<p>Which <code>#[fundamental]</code> btw? The one for traits, or for generic types?</p>



<a name="270427529"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/stabilizing%20%23%5Bfundamental%5D/near/270427529" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Triplett <a href="https://zulip-archive.rust-lang.org/stream/213817-t-lang/topic/stabilizing.20.23.5Bfundamental.5D.html#270427529">(Feb 02 2022 at 17:45)</a>:</h4>
<p>The one for generic types was the one we discussed recently.</p>



<a name="270427558"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/stabilizing%20%23%5Bfundamental%5D/near/270427558" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Daniel Henry-Mantilla <a href="https://zulip-archive.rust-lang.org/stream/213817-t-lang/topic/stabilizing.20.23.5Bfundamental.5D.html#270427558">(Feb 02 2022 at 17:45)</a>:</h4>
<p>The former <em>may</em> be kind of covered by "negative traits integrated into coherence", whereas the latter seems indeed quite special / subtle</p>



<a name="270427869"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/stabilizing%20%23%5Bfundamental%5D/near/270427869" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/213817-t-lang/topic/stabilizing.20.23.5Bfundamental.5D.html#270427869">(Feb 02 2022 at 17:46)</a>:</h4>
<p><span class="user-mention" data-user-id="213696">@Armin Ronacher</span> so</p>



<a name="270427893"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/stabilizing%20%23%5Bfundamental%5D/near/270427893" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/213817-t-lang/topic/stabilizing.20.23.5Bfundamental.5D.html#270427893">(Feb 02 2022 at 17:47)</a>:</h4>
<p>I would like to remove <code>#[fundamental]</code></p>



<a name="270427913"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/stabilizing%20%23%5Bfundamental%5D/near/270427913" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/213817-t-lang/topic/stabilizing.20.23.5Bfundamental.5D.html#270427913">(Feb 02 2022 at 17:47)</a>:</h4>
<p>and replace it with explicit negative impls</p>



<a name="270427921"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/stabilizing%20%23%5Bfundamental%5D/near/270427921" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/213817-t-lang/topic/stabilizing.20.23.5Bfundamental.5D.html#270427921">(Feb 02 2022 at 17:47)</a>:</h4>
<p>I don't know if this is truly possible</p>



<a name="270427969"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/stabilizing%20%23%5Bfundamental%5D/near/270427969" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/213817-t-lang/topic/stabilizing.20.23.5Bfundamental.5D.html#270427969">(Feb 02 2022 at 17:47)</a>:</h4>
<p>but it'd be good to get a bit more of an idea of what you want to do with it</p>



<a name="270428182"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/stabilizing%20%23%5Bfundamental%5D/near/270428182" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Triplett <a href="https://zulip-archive.rust-lang.org/stream/213817-t-lang/topic/stabilizing.20.23.5Bfundamental.5D.html#270428182">(Feb 02 2022 at 17:48)</a>:</h4>
<p><span class="user-mention" data-user-id="116009">@nikomatsakis</span> <a href="https://github.com/rust-lang/rust/issues/29635#issuecomment-1028178273">https://github.com/rust-lang/rust/issues/29635#issuecomment-1028178273</a></p>



<a name="270428215"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/stabilizing%20%23%5Bfundamental%5D/near/270428215" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> scottmcm <a href="https://zulip-archive.rust-lang.org/stream/213817-t-lang/topic/stabilizing.20.23.5Bfundamental.5D.html#270428215">(Feb 02 2022 at 17:49)</a>:</h4>
<p>If nothing else, we'll definitely be able to remove a bunch of its uses (like &lt;<a href="https://doc.rust-lang.org/1.52.0/src/core/ops/function.rs.html#65">https://doc.rust-lang.org/1.52.0/src/core/ops/function.rs.html#65</a>&gt;) with negative impls.  Whether we could remove it forever is harder, given things like <code>Box&lt;T&gt;</code> being <code>fundamental</code>.</p>



<a name="270428695"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/stabilizing%20%23%5Bfundamental%5D/near/270428695" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Armin Ronacher <a href="https://zulip-archive.rust-lang.org/stream/213817-t-lang/topic/stabilizing.20.23.5Bfundamental.5D.html#270428695">(Feb 02 2022 at 17:51)</a>:</h4>
<p>So for the context of what I'm doing it's part of an experimental serialization system. It follows the design from miniserde largely where the deserialization interface is by putting values into slots. So this is the API I wanted to enable:</p>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="k">use</span><span class="w"> </span><span class="n">deser</span>::<span class="n">de</span>::<span class="p">{</span><span class="n">Sink</span><span class="p">,</span><span class="w"> </span><span class="n">Slot</span><span class="p">,</span><span class="w"> </span><span class="n">DeserializerState</span><span class="p">};</span><span class="w"></span>
<span class="k">use</span><span class="w"> </span><span class="n">deser</span>::<span class="n">Error</span><span class="p">;</span><span class="w"></span>

<span class="k">struct</span> <span class="nc">MyBool</span><span class="p">(</span><span class="kt">bool</span><span class="p">);</span><span class="w"></span>

<span class="k">impl</span><span class="w"> </span><span class="n">Sink</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="n">Slot</span><span class="o">&lt;</span><span class="n">MyBool</span><span class="o">&gt;</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="k">fn</span> <span class="nf">bool</span><span class="p">(</span><span class="w"></span>
<span class="w">        </span><span class="o">&amp;</span><span class="k">mut</span><span class="w"> </span><span class="bp">self</span><span class="p">,</span><span class="w"></span>
<span class="w">        </span><span class="n">value</span>: <span class="kt">bool</span><span class="p">,</span><span class="w"></span>
<span class="w">        </span><span class="n">_state</span>: <span class="kp">&amp;</span><span class="nc">DeserializerState</span><span class="p">,</span><span class="w"></span>
<span class="w">    </span><span class="p">)</span><span class="w"> </span>-&gt; <span class="nb">Result</span><span class="o">&lt;</span><span class="p">(),</span><span class="w"> </span><span class="n">Error</span><span class="o">&gt;</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">        </span><span class="bp">self</span><span class="p">.</span><span class="n">place</span><span class="p">(</span><span class="n">MyBool</span><span class="p">(</span><span class="n">value</span><span class="p">));</span><span class="w"></span>
<span class="w">        </span><span class="nb">Ok</span><span class="p">(())</span><span class="w"></span>
<span class="w">    </span><span class="p">}</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>
</code></pre></div>



<a name="270428812"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/stabilizing%20%23%5Bfundamental%5D/near/270428812" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Armin Ronacher <a href="https://zulip-archive.rust-lang.org/stream/213817-t-lang/topic/stabilizing.20.23.5Bfundamental.5D.html#270428812">(Feb 02 2022 at 17:52)</a>:</h4>
<p>It's not possible to implement this at the moment because the user does not control either <code>Sink</code> or <code>Slot</code> (different crates). <code>#[fundamental]</code> is a nice workaround for this.</p>



<a name="270429001"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/stabilizing%20%23%5Bfundamental%5D/near/270429001" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Daniel Henry-Mantilla <a href="https://zulip-archive.rust-lang.org/stream/213817-t-lang/topic/stabilizing.20.23.5Bfundamental.5D.html#270429001">(Feb 02 2022 at 17:53)</a>:</h4>
<p>Miniserde itself offers a macro to allow users to have access to <code>Slot</code> in a local-to-the-caller's-crate kind of way: <a href="https://docs.rs/miniserde/0.1.19/miniserde/de/index.html#deserializing-a-primitive">https://docs.rs/miniserde/0.1.19/miniserde/de/index.html#deserializing-a-primitive</a></p>



<a name="270429242"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/stabilizing%20%23%5Bfundamental%5D/near/270429242" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Armin Ronacher <a href="https://zulip-archive.rust-lang.org/stream/213817-t-lang/topic/stabilizing.20.23.5Bfundamental.5D.html#270429242">(Feb 02 2022 at 17:54)</a>:</h4>
<p>Yeah. But unfortunately that comes with a lot of restrictions that make using this quite unwieldy. miniserde also uses unsafe internally to transmute between <code>&amp;mut Option&lt;T&gt;</code> and <code>&amp;mut TheirPlace&lt;T&gt;</code> which I was trying to avoid.</p>



<a name="270429938"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/stabilizing%20%23%5Bfundamental%5D/near/270429938" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/213817-t-lang/topic/stabilizing.20.23.5Bfundamental.5D.html#270429938">(Feb 02 2022 at 17:58)</a>:</h4>
<p>Hmm, ok, this is interesting</p>



<a name="270429978"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/stabilizing%20%23%5Bfundamental%5D/near/270429978" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/213817-t-lang/topic/stabilizing.20.23.5Bfundamental.5D.html#270429978">(Feb 02 2022 at 17:58)</a>:</h4>
<p>This is indeed what <code>#[fundamental]</code>on types is sort of meant for</p>



<a name="270430042"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/stabilizing%20%23%5Bfundamental%5D/near/270430042" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/213817-t-lang/topic/stabilizing.20.23.5Bfundamental.5D.html#270430042">(Feb 02 2022 at 17:59)</a>:</h4>
<p>I guess earlier I should've said that I would like to remove <code>#[fundamental]</code> <em>on traits</em></p>



<a name="270430058"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/stabilizing%20%23%5Bfundamental%5D/near/270430058" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/213817-t-lang/topic/stabilizing.20.23.5Bfundamental.5D.html#270430058">(Feb 02 2022 at 17:59)</a>:</h4>
<p>I think that explicit negative impls are just better</p>



<a name="270430101"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/stabilizing%20%23%5Bfundamental%5D/near/270430101" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/213817-t-lang/topic/stabilizing.20.23.5Bfundamental.5D.html#270430101">(Feb 02 2022 at 17:59)</a>:</h4>
<p>I'm not sure about types</p>



<a name="270430103"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/stabilizing%20%23%5Bfundamental%5D/near/270430103" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Triplett <a href="https://zulip-archive.rust-lang.org/stream/213817-t-lang/topic/stabilizing.20.23.5Bfundamental.5D.html#270430103">(Feb 02 2022 at 17:59)</a>:</h4>
<p><span class="user-mention" data-user-id="116009">@nikomatsakis</span> Do you know where we took notes from the team discussion about <code>#[fundamental]</code>?</p>



<a name="270430171"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/stabilizing%20%23%5Bfundamental%5D/near/270430171" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/213817-t-lang/topic/stabilizing.20.23.5Bfundamental.5D.html#270430171">(Feb 02 2022 at 17:59)</a>:</h4>
<p>I don't remember this</p>



<a name="270430686"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/stabilizing%20%23%5Bfundamental%5D/near/270430686" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> simulacrum <a href="https://zulip-archive.rust-lang.org/stream/213817-t-lang/topic/stabilizing.20.23.5Bfundamental.5D.html#270430686">(Feb 02 2022 at 18:02)</a>:</h4>
<p>Backlog bonanza doc, presumably?</p>



<a name="270431273"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/stabilizing%20%23%5Bfundamental%5D/near/270431273" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Armin Ronacher <a href="https://zulip-archive.rust-lang.org/stream/213817-t-lang/topic/stabilizing.20.23.5Bfundamental.5D.html#270431273">(Feb 02 2022 at 18:05)</a>:</h4>
<p>I don't think enough about <code>#[fundamental]</code> on traits but on types with at least one generic type parameter it seems quite useful. Maybe it could be restricted to that</p>



<a name="270431310"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/stabilizing%20%23%5Bfundamental%5D/near/270431310" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ibraheem Ahmed <a href="https://zulip-archive.rust-lang.org/stream/213817-t-lang/topic/stabilizing.20.23.5Bfundamental.5D.html#270431310">(Feb 02 2022 at 18:05)</a>:</h4>
<p>What's preventing just allowing <code>impl ExternalTrait for ExternalType&lt;MyType&gt; { ... }</code>?</p>



<a name="270431982"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/stabilizing%20%23%5Bfundamental%5D/near/270431982" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> scottmcm <a href="https://zulip-archive.rust-lang.org/stream/213817-t-lang/topic/stabilizing.20.23.5Bfundamental.5D.html#270431982">(Feb 02 2022 at 18:09)</a>:</h4>
<p>I think it depends on the rules for blanket impls.  Those are already a bit fundamental-like in that IIRC there are some restrictions on adding them already...</p>



<a name="270431997"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/stabilizing%20%23%5Bfundamental%5D/near/270431997" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Daniel Henry-Mantilla <a href="https://zulip-archive.rust-lang.org/stream/213817-t-lang/topic/stabilizing.20.23.5Bfundamental.5D.html#270431997">(Feb 02 2022 at 18:10)</a>:</h4>
<p><span class="user-mention" data-user-id="363998">@Ibraheem Ahmed</span> what if in a new version the owner of <code>ExternalType</code> were to write <code>impl&lt;T : ?Sized&gt; ExternalTrait of ExternalType&lt;T&gt; {}</code> or other similar blanket impls?</p>
<p>I imagine that <code>#[fundamental]</code> on <code>ExternalType</code> may thus works by asserting to the coherence system that no new blanket impls (of existing traits) shall be added to that type (constructor)</p>



<a name="270432163"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/stabilizing%20%23%5Bfundamental%5D/near/270432163" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ibraheem Ahmed <a href="https://zulip-archive.rust-lang.org/stream/213817-t-lang/topic/stabilizing.20.23.5Bfundamental.5D.html#270432163">(Feb 02 2022 at 18:11)</a>:</h4>
<p>So a <code>#[fundamental]</code> type is not allowed to add new blanket trait impls?</p>



<a name="270432251"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/stabilizing%20%23%5Bfundamental%5D/near/270432251" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Daniel Henry-Mantilla <a href="https://zulip-archive.rust-lang.org/stream/213817-t-lang/topic/stabilizing.20.23.5Bfundamental.5D.html#270432251">(Feb 02 2022 at 18:11)</a>:</h4>
<p>Doing so for an existing trait would be breaking, since a downstream user would have been allowed to write an impl such as the one you suggested</p>



<a name="270432414"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/stabilizing%20%23%5Bfundamental%5D/near/270432414" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Daniel Henry-Mantilla <a href="https://zulip-archive.rust-lang.org/stream/213817-t-lang/topic/stabilizing.20.23.5Bfundamental.5D.html#270432414">(Feb 02 2022 at 18:12)</a>:</h4>
<p>(But for a new trait I'd imagine it to be fine)</p>



<a name="270432477"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/stabilizing%20%23%5Bfundamental%5D/near/270432477" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ibraheem Ahmed <a href="https://zulip-archive.rust-lang.org/stream/213817-t-lang/topic/stabilizing.20.23.5Bfundamental.5D.html#270432477">(Feb 02 2022 at 18:13)</a>:</h4>
<p>I see.</p>



<a name="270432766"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/stabilizing%20%23%5Bfundamental%5D/near/270432766" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> cuviper <a href="https://zulip-archive.rust-lang.org/stream/213817-t-lang/topic/stabilizing.20.23.5Bfundamental.5D.html#270432766">(Feb 02 2022 at 18:15)</a>:</h4>
<p><a href="https://rust-lang.github.io/rfcs/1023-rebalancing-coherence.html#errors-from-cargo-and-the-fundamental-attribute">https://rust-lang.github.io/rfcs/1023-rebalancing-coherence.html#errors-from-cargo-and-the-fundamental-attribute</a></p>
<blockquote>
<p>A #[fundamental] type Foo is one where implementing a blanket impl over Foo is a breaking change. As described, &amp; and &amp;mut are fundamental. This attribute would be applied to Box, making Box behave the same as &amp; and &amp;mut with respect to coherence.</p>
</blockquote>



<a name="270432835"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/stabilizing%20%23%5Bfundamental%5D/near/270432835" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Daniel Henry-Mantilla <a href="https://zulip-archive.rust-lang.org/stream/213817-t-lang/topic/stabilizing.20.23.5Bfundamental.5D.html#270432835">(Feb 02 2022 at 18:15)</a>:</h4>
<p>I guess that in <span class="user-mention" data-user-id="213696">@Armin Ronacher</span>'s case, maybe negative traits could be enough? <span aria-label="thinking" class="emoji emoji-1f914" role="img" title="thinking">:thinking:</span> </p>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="k">pub</span><span class="w"> </span><span class="k">trait</span><span class="w"> </span><span class="n">Sink</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="o">..</span><span class="p">.</span><span class="w"> </span><span class="p">}</span><span class="w"></span>
<span class="k">pub</span><span class="w"> </span><span class="k">struct</span> <span class="nc">Slot</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;</span><span class="w"> </span><span class="o">..</span><span class="p">.</span><span class="w"></span>

<span class="k">impl</span><span class="o">&lt;</span><span class="n">T</span><span class="w"> </span>: <span class="o">?</span><span class="nb">Sized</span><span class="o">&gt;</span><span class="w"> </span><span class="o">!</span><span class="n">Sink</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="n">Slot</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;</span><span class="w"> </span><span class="p">{}</span><span class="w"></span>
</code></pre></div>
<p>EDIT: nope nope nope</p>



<a name="270433008"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/stabilizing%20%23%5Bfundamental%5D/near/270433008" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ibraheem Ahmed <a href="https://zulip-archive.rust-lang.org/stream/213817-t-lang/topic/stabilizing.20.23.5Bfundamental.5D.html#270433008">(Feb 02 2022 at 18:16)</a>:</h4>
<p>Could this maybe be replaced with <code>impl&lt;T&gt; !_ for Box&lt;T&gt; {}</code>?</p>



<a name="270433042"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/stabilizing%20%23%5Bfundamental%5D/near/270433042" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ibraheem Ahmed <a href="https://zulip-archive.rust-lang.org/stream/213817-t-lang/topic/stabilizing.20.23.5Bfundamental.5D.html#270433042">(Feb 02 2022 at 18:16)</a>:</h4>
<p>Where <code>_</code> is saying, "I'm commiting to not implementing any trait I haven't already"</p>



<a name="270433100"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/stabilizing%20%23%5Bfundamental%5D/near/270433100" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ibraheem Ahmed <a href="https://zulip-archive.rust-lang.org/stream/213817-t-lang/topic/stabilizing.20.23.5Bfundamental.5D.html#270433100">(Feb 02 2022 at 18:17)</a>:</h4>
<p>And then adding a new impl would be a breaking change, because it breaks that guarantee</p>



<a name="270433110"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/stabilizing%20%23%5Bfundamental%5D/near/270433110" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> scottmcm <a href="https://zulip-archive.rust-lang.org/stream/213817-t-lang/topic/stabilizing.20.23.5Bfundamental.5D.html#270433110">(Feb 02 2022 at 18:17)</a>:</h4>
<p>I don't think that works, because negative impls are a promise that can be relied upon -- so others can't implement it either.</p>



<a name="270433281"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/stabilizing%20%23%5Bfundamental%5D/near/270433281" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ibraheem Ahmed <a href="https://zulip-archive.rust-lang.org/stream/213817-t-lang/topic/stabilizing.20.23.5Bfundamental.5D.html#270433281">(Feb 02 2022 at 18:18)</a>:</h4>
<p>I suppose <code>!_</code> would be special in that regard</p>



<a name="270433365"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/stabilizing%20%23%5Bfundamental%5D/near/270433365" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ibraheem Ahmed <a href="https://zulip-archive.rust-lang.org/stream/213817-t-lang/topic/stabilizing.20.23.5Bfundamental.5D.html#270433365">(Feb 02 2022 at 18:19)</a>:</h4>
<p>e.g. unsafe code can rely on <code>unsafe&lt;T&gt; impl !Sync for Box&lt;T&gt;</code> because it's explicit, but it can't rely on traits <em>implied</em> by <code>_</code></p>



<a name="270433394"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/stabilizing%20%23%5Bfundamental%5D/near/270433394" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Daniel Henry-Mantilla <a href="https://zulip-archive.rust-lang.org/stream/213817-t-lang/topic/stabilizing.20.23.5Bfundamental.5D.html#270433394">(Feb 02 2022 at 18:19)</a>:</h4>
<p><span class="user-mention" data-user-id="125270">@scottmcm</span> yeah I realize that now</p>



<a name="270433396"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/stabilizing%20%23%5Bfundamental%5D/near/270433396" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> bstrie <a href="https://zulip-archive.rust-lang.org/stream/213817-t-lang/topic/stabilizing.20.23.5Bfundamental.5D.html#270433396">(Feb 02 2022 at 18:19)</a>:</h4>
<p>That's pretty line-noisy, I'd rather just have an attribute than new syntax for an obscure feature</p>



<a name="270433415"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/stabilizing%20%23%5Bfundamental%5D/near/270433415" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> cuviper <a href="https://zulip-archive.rust-lang.org/stream/213817-t-lang/topic/stabilizing.20.23.5Bfundamental.5D.html#270433415">(Feb 02 2022 at 18:19)</a>:</h4>
<p>if it's going to be "special", it doesn't seem better than the truly different <code>#[fundamental]</code></p>



<a name="270433617"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/stabilizing%20%23%5Bfundamental%5D/near/270433617" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ibraheem Ahmed <a href="https://zulip-archive.rust-lang.org/stream/213817-t-lang/topic/stabilizing.20.23.5Bfundamental.5D.html#270433617">(Feb 02 2022 at 18:20)</a>:</h4>
<p><code>#[fundamental]</code> just feels like an internal hack for a missing language feature, to me</p>



<a name="270433664"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/stabilizing%20%23%5Bfundamental%5D/near/270433664" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ibraheem Ahmed <a href="https://zulip-archive.rust-lang.org/stream/213817-t-lang/topic/stabilizing.20.23.5Bfundamental.5D.html#270433664">(Feb 02 2022 at 18:21)</a>:</h4>
<p>But that could just be the name <span aria-label="sweat smile" class="emoji emoji-1f605" role="img" title="sweat smile">:sweat_smile:</span></p>



<a name="270433802"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/stabilizing%20%23%5Bfundamental%5D/near/270433802" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Triplett <a href="https://zulip-archive.rust-lang.org/stream/213817-t-lang/topic/stabilizing.20.23.5Bfundamental.5D.html#270433802">(Feb 02 2022 at 18:22)</a>:</h4>
<p><span class="user-mention silent" data-user-id="116122">simulacrum</span> <a href="#narrow/stream/213817-t-lang/topic/stabilizing.20.23.5Bfundamental.5D/near/270430686">said</a>:</p>
<blockquote>
<p>Backlog bonanza doc, presumably?</p>
</blockquote>
<p>I thought so but didn't find it. Is it in one of the backlog bonanza docs that didn't end up in the lang team hackmd area?</p>



<a name="270433846"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/stabilizing%20%23%5Bfundamental%5D/near/270433846" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Daniel Henry-Mantilla <a href="https://zulip-archive.rust-lang.org/stream/213817-t-lang/topic/stabilizing.20.23.5Bfundamental.5D.html#270433846">(Feb 02 2022 at 18:22)</a>:</h4>
<p>Yeah I find that <code>fundamental</code> for traits and generic types are too different to be named the same (this problem also occurs for <code>default fn</code> and <code>default impl</code>, btw, the latter ought to be <code>partial impl</code>, and ppl could add <code>default fn</code> to the items of a <code>partial impl</code>, which would thus otherwise be final).</p>



<a name="270433964"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/stabilizing%20%23%5Bfundamental%5D/near/270433964" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> cuviper <a href="https://zulip-archive.rust-lang.org/stream/213817-t-lang/topic/stabilizing.20.23.5Bfundamental.5D.html#270433964">(Feb 02 2022 at 18:23)</a>:</h4>
<p><code>#[incoherent]</code></p>



<a name="270434150"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/stabilizing%20%23%5Bfundamental%5D/near/270434150" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ibraheem Ahmed <a href="https://zulip-archive.rust-lang.org/stream/213817-t-lang/topic/stabilizing.20.23.5Bfundamental.5D.html#270434150">(Feb 02 2022 at 18:24)</a>:</h4>
<p>What if say, <span class="user-mention" data-user-id="213696">@Armin Ronacher</span> wanted to allow <code>impl Serialize for Slot&lt;Foo&gt;</code>, but nothing else?</p>



<a name="270434175"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/stabilizing%20%23%5Bfundamental%5D/near/270434175" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ibraheem Ahmed <a href="https://zulip-archive.rust-lang.org/stream/213817-t-lang/topic/stabilizing.20.23.5Bfundamental.5D.html#270434175">(Feb 02 2022 at 18:24)</a>:</h4>
<p><code>#[fundamental]</code> isn't specific enough then</p>



<a name="270434261"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/stabilizing%20%23%5Bfundamental%5D/near/270434261" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Armin Ronacher <a href="https://zulip-archive.rust-lang.org/stream/213817-t-lang/topic/stabilizing.20.23.5Bfundamental.5D.html#270434261">(Feb 02 2022 at 18:25)</a>:</h4>
<p>so basically what the feature is looking for is a way to promise that the base crate never implements a specific trait, right?</p>



<a name="270434265"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/stabilizing%20%23%5Bfundamental%5D/near/270434265" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Triplett <a href="https://zulip-archive.rust-lang.org/stream/213817-t-lang/topic/stabilizing.20.23.5Bfundamental.5D.html#270434265">(Feb 02 2022 at 18:25)</a>:</h4>
<p><span class="user-mention" data-user-id="363998">@Ibraheem Ahmed</span> If it was only one specific trait, it might be possible to <code>impl&lt;T: MyTrait&gt; Serialize for Slot&lt;T&gt;</code> and then tell people to implement <code>MyTrait</code> if they want Serialize.</p>



<a name="270434341"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/stabilizing%20%23%5Bfundamental%5D/near/270434341" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Daniel Henry-Mantilla <a href="https://zulip-archive.rust-lang.org/stream/213817-t-lang/topic/stabilizing.20.23.5Bfundamental.5D.html#270434341">(Feb 02 2022 at 18:25)</a>:</h4>
<div class="codehilite" data-code-language="Diff"><pre><span></span><code><span class="gd">- impl&lt;T&gt; !Serialize for Slot&lt;T&gt; {}</span><span class="w"></span>
<span class="gi">+ ! impl&lt;T&gt; Serialize for Slot&lt;T&gt; {}</span><span class="w"></span>
</code></pre></div>



<a name="270434456"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/stabilizing%20%23%5Bfundamental%5D/near/270434456" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ibraheem Ahmed <a href="https://zulip-archive.rust-lang.org/stream/213817-t-lang/topic/stabilizing.20.23.5Bfundamental.5D.html#270434456">(Feb 02 2022 at 18:26)</a>:</h4>
<p><code>extern impl&lt;T&gt; Serialize for Slot&lt;T&gt;</code> <span aria-label="thinking" class="emoji emoji-1f914" role="img" title="thinking">:thinking:</span></p>



<a name="270434545"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/stabilizing%20%23%5Bfundamental%5D/near/270434545" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ibraheem Ahmed <a href="https://zulip-archive.rust-lang.org/stream/213817-t-lang/topic/stabilizing.20.23.5Bfundamental.5D.html#270434545">(Feb 02 2022 at 18:27)</a>:</h4>
<p>Doesn't specialization cover this?</p>



<a name="270434604"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/stabilizing%20%23%5Bfundamental%5D/near/270434604" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ibraheem Ahmed <a href="https://zulip-archive.rust-lang.org/stream/213817-t-lang/topic/stabilizing.20.23.5Bfundamental.5D.html#270434604">(Feb 02 2022 at 18:27)</a>:</h4>
<p>Can I have a <code>default impl&lt;T&gt; Serialize for Slot&lt;T&gt; { ... }</code> and allow users to override that for a more specific type?</p>



<a name="270434616"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/stabilizing%20%23%5Bfundamental%5D/near/270434616" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Armin Ronacher <a href="https://zulip-archive.rust-lang.org/stream/213817-t-lang/topic/stabilizing.20.23.5Bfundamental.5D.html#270434616">(Feb 02 2022 at 18:27)</a>:</h4>
<p><span class="user-mention silent" data-user-id="232018">Daniel Henry-Mantilla</span> <a href="#narrow/stream/213817-t-lang/topic/stabilizing.20.23.5Bfundamental.5D/near/270434341">said</a>:<br>
doesn't negative impl say that nobody can implement this?</p>



<a name="270434784"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/stabilizing%20%23%5Bfundamental%5D/near/270434784" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Daniel Henry-Mantilla <a href="https://zulip-archive.rust-lang.org/stream/213817-t-lang/topic/stabilizing.20.23.5Bfundamental.5D.html#270434784">(Feb 02 2022 at 18:29)</a>:</h4>
<p><span class="user-mention silent" data-user-id="363998">Ibraheem Ahmed</span> <a href="#narrow/stream/213817-t-lang/topic/stabilizing.20.23.5Bfundamental.5D/near/270434456">said</a>:</p>
<blockquote>
<p><code>extern impl&lt;T&gt; Serialize for Slot&lt;T&gt;</code> <span aria-label="thinking" class="emoji emoji-1f914" role="img" title="thinking">:thinking:</span></p>
</blockquote>
<p>That looks like a nice idea, but despite tempting, we shouldn't be using a linkage / abi term here:</p>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="cp">#[downstream_may]</span><span class="w"></span>
<span class="k">impl</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;</span><span class="w"> </span><span class="n">Serialize</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="n">Slot</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="o">..</span><span class="w"> </span><span class="p">}</span><span class="w"></span>
</code></pre></div>



<a name="270435024"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/stabilizing%20%23%5Bfundamental%5D/near/270435024" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Armin Ronacher <a href="https://zulip-archive.rust-lang.org/stream/213817-t-lang/topic/stabilizing.20.23.5Bfundamental.5D.html#270435024">(Feb 02 2022 at 18:30)</a>:</h4>
<p>i will say that this conveys the idea much better than <code>#[fundamental]</code> at the very least.</p>



<a name="270435118"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/stabilizing%20%23%5Bfundamental%5D/near/270435118" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Daniel Henry-Mantilla <a href="https://zulip-archive.rust-lang.org/stream/213817-t-lang/topic/stabilizing.20.23.5Bfundamental.5D.html#270435118">(Feb 02 2022 at 18:31)</a>:</h4>
<p>Or</p>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="k">impl</span><span class="o">&lt;</span><span class="cp">#[downstream]</span><span class="w"> </span><span class="n">T</span><span class="o">&gt;</span><span class="w"> </span><span class="n">Serialize</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="n">Slot</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">_</span><span class="w"> </span><span class="p">}</span><span class="w"></span>
</code></pre></div>



<a name="270435120"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/stabilizing%20%23%5Bfundamental%5D/near/270435120" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Armin Ronacher <a href="https://zulip-archive.rust-lang.org/stream/213817-t-lang/topic/stabilizing.20.23.5Bfundamental.5D.html#270435120">(Feb 02 2022 at 18:31)</a>:</h4>
<p>the challenge now though is that this is a very specific type of API promise that I'm not sure will address the issues people have with building their own <code>Box&lt;T&gt;</code> types</p>



<a name="270435121"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/stabilizing%20%23%5Bfundamental%5D/near/270435121" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> cuviper <a href="https://zulip-archive.rust-lang.org/stream/213817-t-lang/topic/stabilizing.20.23.5Bfundamental.5D.html#270435121">(Feb 02 2022 at 18:31)</a>:</h4>
<p>is that transitive? is downstream allowed to blanket <code>impl&lt;T&gt; Serialize for Slot&lt;Local&lt;T&gt;&gt;</code>?</p>



<a name="270435170"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/stabilizing%20%23%5Bfundamental%5D/near/270435170" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ibraheem Ahmed <a href="https://zulip-archive.rust-lang.org/stream/213817-t-lang/topic/stabilizing.20.23.5Bfundamental.5D.html#270435170">(Feb 02 2022 at 18:31)</a>:</h4>
<p><span class="user-mention silent" data-user-id="213696">Armin Ronacher</span> <a href="#narrow/stream/213817-t-lang/topic/stabilizing.20.23.5Bfundamental.5D/near/270435120">said</a>:</p>
<blockquote>
<p>the challenge now though is that this is a very specific type of API promise that I'm not sure will address the issues people have with building their own <code>Box&lt;T&gt;</code> types</p>
</blockquote>
<p>Which is where <code>impl&lt;#[downstream] T&gt; _ for Box&lt;T&gt;</code> comes in <span aria-label="wink" class="emoji emoji-1f609" role="img" title="wink">:wink:</span></p>



<a name="270435332"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/stabilizing%20%23%5Bfundamental%5D/near/270435332" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ibraheem Ahmed <a href="https://zulip-archive.rust-lang.org/stream/213817-t-lang/topic/stabilizing.20.23.5Bfundamental.5D.html#270435332">(Feb 02 2022 at 18:32)</a>:</h4>
<p><span class="user-mention silent" data-user-id="138448">cuviper</span> <a href="#narrow/stream/213817-t-lang/topic/stabilizing.20.23.5Bfundamental.5D/near/270435121">said</a>:</p>
<blockquote>
<p>is that transitive? is downstream allowed to blanket <code>impl&lt;T&gt; Serialize for Slot&lt;Local&lt;T&gt;&gt;</code>?</p>
</blockquote>
<p>Presumably yes</p>



<a name="270435425"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/stabilizing%20%23%5Bfundamental%5D/near/270435425" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Daniel Henry-Mantilla <a href="https://zulip-archive.rust-lang.org/stream/213817-t-lang/topic/stabilizing.20.23.5Bfundamental.5D.html#270435425">(Feb 02 2022 at 18:33)</a>:</h4>
<p><span class="user-mention" data-user-id="138448">@cuviper</span> I'd say so, yes, because they own <code>Local</code>. As, in, imagining a middle dependent having a <code>Middle&lt;T&gt;</code> type,<br>
then a downstream crate wouldn't be able to <code>impl&lt;T&gt; Serialize for Slot&lt;Middle&lt;Local&gt;&gt;</code> unless the middle-layer had "forwarded it" with:</p>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="k">impl</span><span class="o">&lt;</span><span class="cp">#[downstream]</span><span class="w"> </span><span class="n">T</span><span class="o">&gt;</span><span class="w"> </span><span class="n">Serialize</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="n">Slot</span><span class="o">&lt;</span><span class="n">Middle</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;&gt;</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">_</span><span class="w"> </span><span class="p">}</span><span class="w"></span>
</code></pre></div>



<a name="270435603"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/stabilizing%20%23%5Bfundamental%5D/near/270435603" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Daniel Henry-Mantilla <a href="https://zulip-archive.rust-lang.org/stream/213817-t-lang/topic/stabilizing.20.23.5Bfundamental.5D.html#270435603">(Feb 02 2022 at 18:34)</a>:</h4>
<p>What I like about this approach is that it would show coherence errors for the crates exposing this, so it would be way less of a semver hazard than <code>#[fundamental]</code>-on-generic-type</p>



<a name="270436394"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/stabilizing%20%23%5Bfundamental%5D/near/270436394" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Daniel Henry-Mantilla <a href="https://zulip-archive.rust-lang.org/stream/213817-t-lang/topic/stabilizing.20.23.5Bfundamental.5D.html#270436394">(Feb 02 2022 at 18:39)</a>:</h4>
<p>As in:</p>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="k">impl</span><span class="o">&lt;</span><span class="cp">#[downstream]</span><span class="w"> </span><span class="n">T</span><span class="o">&gt;</span><span class="w"> </span><span class="n">Serialize</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="n">Slot</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">_</span><span class="w"> </span><span class="p">}</span><span class="w"></span>

<span class="k">impl</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;</span><span class="w"> </span><span class="n">Serialize</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="n">Slot</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="cm">/* items */</span><span class="w"> </span><span class="p">}</span><span class="w"></span>
</code></pre></div>
<p>and the following one, albeit subtle, should also be denied:</p>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="k">impl</span><span class="o">&lt;</span><span class="cp">#[downstream]</span><span class="w"> </span><span class="n">T</span><span class="o">&gt;</span><span class="w"> </span><span class="n">Serialize</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="n">Slot</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">_</span><span class="w"> </span><span class="p">}</span><span class="w"></span>

<span class="k">impl</span><span class="o">&lt;</span><span class="n">T</span><span class="w"> </span>: <span class="nb">ToString</span><span class="o">&gt;</span><span class="w"> </span><span class="n">Serialize</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="n">Slot</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="cm">/* items */</span><span class="w"> </span><span class="p">}</span><span class="w"></span>
</code></pre></div>



<a name="270436698"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/stabilizing%20%23%5Bfundamental%5D/near/270436698" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ibraheem Ahmed <a href="https://zulip-archive.rust-lang.org/stream/213817-t-lang/topic/stabilizing.20.23.5Bfundamental.5D.html#270436698">(Feb 02 2022 at 18:41)</a>:</h4>
<p>This feels a lot like specialization</p>



<a name="270436805"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/stabilizing%20%23%5Bfundamental%5D/near/270436805" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ibraheem Ahmed <a href="https://zulip-archive.rust-lang.org/stream/213817-t-lang/topic/stabilizing.20.23.5Bfundamental.5D.html#270436805">(Feb 02 2022 at 18:42)</a>:</h4>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="k">impl</span><span class="o">&lt;</span><span class="cp">#[downstream]</span><span class="w"> </span><span class="n">T</span><span class="o">&gt;</span><span class="w"> </span><span class="n">Serialize</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="n">Slot</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">_</span><span class="w"> </span><span class="p">}</span><span class="w"></span>
<span class="n">default</span><span class="w"> </span><span class="k">impl</span><span class="o">&lt;</span><span class="n">T</span><span class="w"> </span>: <span class="nb">ToString</span><span class="o">&gt;</span><span class="w"> </span><span class="n">Serialize</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="n">Slot</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="cm">/* items */</span><span class="w"> </span><span class="p">}</span><span class="w"></span>
</code></pre></div>
<p>Could be effectively:</p>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="k">impl</span><span class="o">&lt;</span><span class="cp">#[downstream]</span><span class="w"> </span><span class="n">T</span>: <span class="o">!</span><span class="nb">ToString</span><span class="o">&gt;</span><span class="w"> </span><span class="n">Serialize</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="n">Slot</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">_</span><span class="w"> </span><span class="p">}</span><span class="w"></span>
<span class="n">default</span><span class="w"> </span><span class="k">impl</span><span class="o">&lt;</span><span class="n">T</span>: <span class="nb">ToString</span><span class="o">&gt;</span><span class="w"> </span><span class="n">Serialize</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="n">Slot</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="cm">/* items */</span><span class="w"> </span><span class="p">}</span><span class="w"></span>
</code></pre></div>



<a name="270437108"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/stabilizing%20%23%5Bfundamental%5D/near/270437108" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Armin Ronacher <a href="https://zulip-archive.rust-lang.org/stream/213817-t-lang/topic/stabilizing.20.23.5Bfundamental.5D.html#270437108">(Feb 02 2022 at 18:44)</a>:</h4>
<p>I’m not sure if this really relates to specializations. It’s “just” a restriction in the orphan check. There are no overlapping implementations</p>



<a name="270437197"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/stabilizing%20%23%5Bfundamental%5D/near/270437197" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Daniel Henry-Mantilla <a href="https://zulip-archive.rust-lang.org/stream/213817-t-lang/topic/stabilizing.20.23.5Bfundamental.5D.html#270437197">(Feb 02 2022 at 18:45)</a>:</h4>
<p>Anyhow, I don't think we'd need to handle "complementary set" reasonings to start with (I know they can easily become problematic), but I think that both</p>
<ul>
<li>
<p>the <em>specificity</em>, as <span class="user-mention" data-user-id="363998">@Ibraheem Ahmed</span> put it, of providing the trait over which a generic type would be fundamental,</p>
</li>
<li>
<p>as well as the readability of the statement in and of itself, which potentially includes better coherence-related error messages,</p>
</li>
</ul>
<p>does make me think there is a nice venue worth pursuing, here, even if the initial release weren't able to handle partial overlaps of blanket impls.</p>



<a name="270437922"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/stabilizing%20%23%5Bfundamental%5D/near/270437922" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Armin Ronacher <a href="https://zulip-archive.rust-lang.org/stream/213817-t-lang/topic/stabilizing.20.23.5Bfundamental.5D.html#270437922">(Feb 02 2022 at 18:51)</a>:</h4>
<p>I think that feature would also be rather nice to "discover" from a user via the error message. I ran into this having built an API that basically can't be implemented by a third party, but it worked in the crate itself. So if someone else also goes down that path, they could dig themselves out via the error message they get, with an example of how to whitelist their own trait.</p>



<a name="270437965"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/stabilizing%20%23%5Bfundamental%5D/near/270437965" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Armin Ronacher <a href="https://zulip-archive.rust-lang.org/stream/213817-t-lang/topic/stabilizing.20.23.5Bfundamental.5D.html#270437965">(Feb 02 2022 at 18:51)</a>:</h4>
<p>right now it's a bit of a shitty experience discovering that such a designed API cannot work for anyone other than the original crate itself.</p>



<a name="270438433"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/stabilizing%20%23%5Bfundamental%5D/near/270438433" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Armin Ronacher <a href="https://zulip-archive.rust-lang.org/stream/213817-t-lang/topic/stabilizing.20.23.5Bfundamental.5D.html#270438433">(Feb 02 2022 at 18:54)</a>:</h4>
<p>My point is basically that it doesn't make the language significantly more complex as one mostly only runs into this that way.</p>



<a name="270450735"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/stabilizing%20%23%5Bfundamental%5D/near/270450735" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Connor Horman <a href="https://zulip-archive.rust-lang.org/stream/213817-t-lang/topic/stabilizing.20.23.5Bfundamental.5D.html#270450735">(Feb 02 2022 at 20:16)</a>:</h4>
<p>For <code>impl !Trait</code>, this would still work, right:</p>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="k">pub</span><span class="w"> </span><span class="k">trait</span><span class="w"> </span><span class="n">Foo</span><span class="p">{}</span><span class="w"></span>
<span class="k">impl</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;</span><span class="w"> </span><span class="o">!</span><span class="n">Foo</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="n">T</span><span class="p">{}</span><span class="w"></span>
<span class="k">impl</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;</span><span class="w"> </span><span class="o">!</span><span class="n">Foo</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="p">[</span><span class="n">T</span><span class="p">]{}</span><span class="w"></span>
</code></pre></div>



<a name="270450803"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/stabilizing%20%23%5Bfundamental%5D/near/270450803" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> bjorn3 <a href="https://zulip-archive.rust-lang.org/stream/213817-t-lang/topic/stabilizing.20.23.5Bfundamental.5D.html#270450803">(Feb 02 2022 at 20:17)</a>:</h4>
<p>I would guess so, <code>T</code> is implicitly bound by <code>Sized</code> and <code>[T]</code> doesn't implement <code>Sized</code>.</p>



<a name="270451573"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/stabilizing%20%23%5Bfundamental%5D/near/270451573" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Connor Horman <a href="https://zulip-archive.rust-lang.org/stream/213817-t-lang/topic/stabilizing.20.23.5Bfundamental.5D.html#270451573">(Feb 02 2022 at 20:24)</a>:</h4>
<p>(Although what I really want is a way to negative impl for non-trait objects).</p>
<p>I guess even without <code>#[fundamental]</code>, the compiler can make that work by automagically implementing <code>!Sized</code> everywhere that it doesn't implement <code>Sized</code>.</p>



<a name="270451713"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/stabilizing%20%23%5Bfundamental%5D/near/270451713" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Boxy [she/her] <a href="https://zulip-archive.rust-lang.org/stream/213817-t-lang/topic/stabilizing.20.23.5Bfundamental.5D.html#270451713">(Feb 02 2022 at 20:24)</a>:</h4>
<p>"auto magic impl <code>!Trait</code> for everything that doesnt implement <code>Trait</code>" is exactly how ive been understanding fundamental traits</p>



<a name="270451781"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/stabilizing%20%23%5Bfundamental%5D/near/270451781" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Connor Horman <a href="https://zulip-archive.rust-lang.org/stream/213817-t-lang/topic/stabilizing.20.23.5Bfundamental.5D.html#270451781">(Feb 02 2022 at 20:25)</a>:</h4>
<p>I do have a trait I'd want to put <code>#[fundamental]</code> on, as part of the shim I need to do to soundly allow <code>DynRef&lt;Trait&gt;</code>/<code>DynMut&lt;Trait&gt;</code> to be used to call methods on <code>Trait</code>.</p>



<a name="270452300"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/stabilizing%20%23%5Bfundamental%5D/near/270452300" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Armin Ronacher <a href="https://zulip-archive.rust-lang.org/stream/213817-t-lang/topic/stabilizing.20.23.5Bfundamental.5D.html#270452300">(Feb 02 2022 at 20:29)</a>:</h4>
<p>Just for my understanding: is the main concern with <code>#[fundamental]</code> on traits today the semver hazard or something else as well?</p>



<hr><p>Last updated: Apr 12 2022 at 20:01 UTC</p>
</html>