<html>
<head><meta charset="utf-8"><title>inferring numeric type through a cast Â· t-lang Â· Zulip Chat Archive</title></head>
<h2>Stream: <a href="https://zulip-archive.rust-lang.org/stream/213817-t-lang/index.html">t-lang</a></h2>
<h3>Topic: <a href="https://zulip-archive.rust-lang.org/stream/213817-t-lang/topic/inferring.20numeric.20type.20through.20a.20cast.html">inferring numeric type through a cast</a></h3>

<hr>

<base href="https://rust-lang.zulipchat.com">

<head><link href="https://zulip-archive.rust-lang.org/style.css" rel="stylesheet"></head>

<a name="274561954"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/inferring%20numeric%20type%20through%20a%20cast/near/274561954" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Nick Cameron <a href="https://zulip-archive.rust-lang.org/stream/213817-t-lang/topic/inferring.20numeric.20type.20through.20a.20cast.html#274561954">(Mar 08 2022 at 16:05)</a>:</h4>
<p>There seems to be an interesting edge case around numeric types and casts:</p>
<div class="codehilite"><pre><span></span><code>    // let nope = &amp;[0; 4] as &amp;[u8];
    let a = &amp;[0: u8; 4] as &amp;[u8];
    let b = &amp;[true; 4] as &amp;[bool];
</code></pre></div>
<p>In the first statement, the zero is inferred to be an isize (default integer type) and the cast fails. I'd hope the u8 could flow through the cast and we could make it type check. Anyone think it is possible/impossible? (Note, that the unsizing is irrelevant, it's just the motivation for doing the cast in the first place, <code>[0; 4] as [u8; 4]</code> also fails).</p>



<a name="274577066"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/inferring%20numeric%20type%20through%20a%20cast/near/274577066" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jacob Pratt ðŸ‡ºðŸ‡¦ <a href="https://zulip-archive.rust-lang.org/stream/213817-t-lang/topic/inferring.20numeric.20type.20through.20a.20cast.html#274577066">(Mar 08 2022 at 17:44)</a>:</h4>
<p>Wait, it's inferred to be isize? The default integer type is actually i32. Either way it would be great to make this work.</p>



<a name="274578248"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/inferring%20numeric%20type%20through%20a%20cast/near/274578248" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Nick Cameron <a href="https://zulip-archive.rust-lang.org/stream/213817-t-lang/topic/inferring.20numeric.20type.20through.20a.20cast.html#274578248">(Mar 08 2022 at 17:52)</a>:</h4>
<p>Sorry, typo, i32</p>



<a name="274579279"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/inferring%20numeric%20type%20through%20a%20cast/near/274579279" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> simulacrum <a href="https://zulip-archive.rust-lang.org/stream/213817-t-lang/topic/inferring.20numeric.20type.20through.20a.20cast.html#274579279">(Mar 08 2022 at 17:59)</a>:</h4>
<p>casts currently happen after inference, and the code is pretty specific to make that the case, though I don't know why</p>



<a name="274579311"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/inferring%20numeric%20type%20through%20a%20cast/near/274579311" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> simulacrum <a href="https://zulip-archive.rust-lang.org/stream/213817-t-lang/topic/inferring.20numeric.20type.20through.20a.20cast.html#274579311">(Mar 08 2022 at 17:59)</a>:</h4>
<p>(at least unsizing casts, not sure if that's true in all cases).</p>



<a name="274587819"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/inferring%20numeric%20type%20through%20a%20cast/near/274587819" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> scottmcm <a href="https://zulip-archive.rust-lang.org/stream/213817-t-lang/topic/inferring.20numeric.20type.20through.20a.20cast.html#274587819">(Mar 08 2022 at 18:53)</a>:</h4>
<p><span class="user-mention silent" data-user-id="256841">Nick Cameron</span> <a href="#narrow/stream/213817-t-lang/topic/inferring.20numeric.20type.20through.20a.20cast/near/274561954">said</a>:</p>
<blockquote>
<p>Anyone think it is possible/impossible? (Note, that the unsizing is irrelevant, it's just the motivation for doing the cast in the first place, <code>[0; 4] as [u8; 4]</code> also fails).</p>
</blockquote>
<p>I think this is essentially the same as the "type inference defaults/fallback" wish that people want in a bunch of places.  I don't know how hard that'll be.  In general, all the fallback/coercion stuff is just hardâ„¢.  Seems like a place I just say "chalk?" and point to <span class="user-mention silent" data-user-id="116009">nikomatsakis</span>'s new team: <a href="#narrow/stream/144729-wg-traits/topic/making.20a.20team.20for.20traits.2C.20polonius.2C.20etc/near/273563728">https://rust-lang.zulipchat.com/#narrow/stream/144729-wg-traits/topic/making.20a.20team.20for.20traits.2C.20polonius.2C.20etc/near/273563728</a></p>
<p>The one core complication I know about is that something like <code>Box::new(e) as Box&lt;dyn Error&gt;</code> is sometimes really important that it <em>not</em> flow that type into the first expression.  That was particularly the case if <code>e</code> is a type variable, IIRC -- there was something like this that blocked never type stabilization once upon a time.</p>



<hr><p>Last updated: Apr 12 2022 at 20:01 UTC</p>
</html>