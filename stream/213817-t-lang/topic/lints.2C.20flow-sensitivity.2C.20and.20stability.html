<html>
<head><meta charset="utf-8"><title>lints, flow-sensitivity, and stability · t-lang · Zulip Chat Archive</title></head>
<h2>Stream: <a href="https://zulip-archive.rust-lang.org/stream/213817-t-lang/index.html">t-lang</a></h2>
<h3>Topic: <a href="https://zulip-archive.rust-lang.org/stream/213817-t-lang/topic/lints.2C.20flow-sensitivity.2C.20and.20stability.html">lints, flow-sensitivity, and stability</a></h3>

<hr>

<base href="https://rust-lang.zulipchat.com">

<head><link href="https://zulip-archive.rust-lang.org/style.css" rel="stylesheet"></head>

<a name="271596442"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/lints%2C%20flow-sensitivity%2C%20and%20stability/near/271596442" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> pnkfelix <a href="https://zulip-archive.rust-lang.org/stream/213817-t-lang/topic/lints.2C.20flow-sensitivity.2C.20and.20stability.html#271596442">(Feb 11 2022 at 15:58)</a>:</h4>
<p>Hey y'all. <span class="user-mention" data-user-id="125250">@Wesley Wiser</span> recently raised a question on a PR and then brought it to me as well, and I couldn't quickly find precedent one way or another for the answer I gave to Wesley, so I'm hoping to get attention over here on it.</p>



<a name="271596494"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/lints%2C%20flow-sensitivity%2C%20and%20stability/near/271596494" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> pnkfelix <a href="https://zulip-archive.rust-lang.org/stream/213817-t-lang/topic/lints.2C.20flow-sensitivity.2C.20and.20stability.html#271596494">(Feb 11 2022 at 15:58)</a>:</h4>
<p>the heart of the question is: Are lints allowed to change their behavior based on flow-sensitive information?</p>



<a name="271596538"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/lints%2C%20flow-sensitivity%2C%20and%20stability/near/271596538" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> pnkfelix <a href="https://zulip-archive.rust-lang.org/stream/213817-t-lang/topic/lints.2C.20flow-sensitivity.2C.20and.20stability.html#271596538">(Feb 11 2022 at 15:59)</a>:</h4>
<p>or is that considered a stability hazard (in terms of code breaking between Rust versions)</p>



<a name="271596616"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/lints%2C%20flow-sensitivity%2C%20and%20stability/near/271596616" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> pnkfelix <a href="https://zulip-archive.rust-lang.org/stream/213817-t-lang/topic/lints.2C.20flow-sensitivity.2C.20and.20stability.html#271596616">(Feb 11 2022 at 15:59)</a>:</h4>
<p>My current answer is that some language features, like unsafety-checking, are deliberately not meant to be control-flow sensitive, at least in principle.</p>



<a name="271596627"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/lints%2C%20flow-sensitivity%2C%20and%20stability/near/271596627" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> pnkfelix <a href="https://zulip-archive.rust-lang.org/stream/213817-t-lang/topic/lints.2C.20flow-sensitivity.2C.20and.20stability.html#271596627">(Feb 11 2022 at 15:59)</a>:</h4>
<p>but that lints do not fall into that category</p>



<a name="271597208"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/lints%2C%20flow-sensitivity%2C%20and%20stability/near/271597208" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> oli <a href="https://zulip-archive.rust-lang.org/stream/213817-t-lang/topic/lints.2C.20flow-sensitivity.2C.20and.20stability.html#271597208">(Feb 11 2022 at 16:02)</a>:</h4>
<p>Introducing a new lint is not a breaking change. Thus I think making a lint smarter isn't one either. But what if people are relying on a lint telling them about a serious problem and due to internal control flow changes we stop reporting in situations in which we reported before?</p>



<a name="271597288"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/lints%2C%20flow-sensitivity%2C%20and%20stability/near/271597288" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> pnkfelix <a href="https://zulip-archive.rust-lang.org/stream/213817-t-lang/topic/lints.2C.20flow-sensitivity.2C.20and.20stability.html#271597288">(Feb 11 2022 at 16:03)</a>:</h4>
<p>The specific issue in this case is this: <a href="https://github.com/rust-lang/rust/pull/93313#discussion_r802135975">https://github.com/rust-lang/rust/pull/93313#discussion_r802135975</a></p>



<a name="271597404"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/lints%2C%20flow-sensitivity%2C%20and%20stability/near/271597404" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> pnkfelix <a href="https://zulip-archive.rust-lang.org/stream/213817-t-lang/topic/lints.2C.20flow-sensitivity.2C.20and.20stability.html#271597404">(Feb 11 2022 at 16:04)</a>:</h4>
<p><span class="user-mention" data-user-id="124288">@oli</span> is your point that maybe the answer to the question should depend on the lint itself? In terms of the kinds of bugs that it catches?</p>



<a name="271597558"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/lints%2C%20flow-sensitivity%2C%20and%20stability/near/271597558" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> oli <a href="https://zulip-archive.rust-lang.org/stream/213817-t-lang/topic/lints.2C.20flow-sensitivity.2C.20and.20stability.html#271597558">(Feb 11 2022 at 16:04)</a>:</h4>
<p>Well, only if it changes in ways that it misses things to report on which it reported on before</p>



<a name="271597582"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/lints%2C%20flow-sensitivity%2C%20and%20stability/near/271597582" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> oli <a href="https://zulip-archive.rust-lang.org/stream/213817-t-lang/topic/lints.2C.20flow-sensitivity.2C.20and.20stability.html#271597582">(Feb 11 2022 at 16:05)</a>:</h4>
<p>Being louder is always fine imo</p>



<a name="271597631"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/lints%2C%20flow-sensitivity%2C%20and%20stability/near/271597631" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> oli <a href="https://zulip-archive.rust-lang.org/stream/213817-t-lang/topic/lints.2C.20flow-sensitivity.2C.20and.20stability.html#271597631">(Feb 11 2022 at 16:05)</a>:</h4>
<p>(Assuming the new messages are correct, we should fix bugs of course)</p>



<a name="271597758"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/lints%2C%20flow-sensitivity%2C%20and%20stability/near/271597758" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wesley Wiser <a href="https://zulip-archive.rust-lang.org/stream/213817-t-lang/topic/lints.2C.20flow-sensitivity.2C.20and.20stability.html#271597758">(Feb 11 2022 at 16:06)</a>:</h4>
<p>Specifically, one of the things the PR does is resolve this FIXME: <a href="https://github.com/rust-lang/rust/blob/e273fca380c5d28bc32b25ac1a885c61d4c5e75e/compiler/rustc_mir_build/src/build/expr/into.rs#L258-L260">https://github.com/rust-lang/rust/blob/e273fca380c5d28bc32b25ac1a885c61d4c5e75e/compiler/rustc_mir_build/src/build/expr/into.rs#L258-L260</a>. </p>
<p>However, that has the effect of causing this current UI test:</p>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="k">enum</span> <span class="nc">Never</span><span class="w"> </span><span class="p">{}</span><span class="w"></span>
<span class="k">fn</span> <span class="nf">never</span><span class="p">()</span><span class="w"> </span>-&gt; <span class="nc">Never</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="fm">panic!</span><span class="p">()</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>

<span class="k">async</span><span class="w"> </span><span class="k">fn</span> <span class="nf">includes_never</span><span class="p">(</span><span class="n">crash</span>: <span class="kt">bool</span><span class="p">,</span><span class="w"> </span><span class="n">x</span>: <span class="kt">u32</span><span class="p">)</span><span class="w"> </span>-&gt; <span class="kt">u32</span> <span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="k">mut</span><span class="w"> </span><span class="n">result</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">async</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">x</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">x</span><span class="w"> </span><span class="p">}.</span><span class="k">await</span><span class="p">;</span><span class="w"></span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="o">!</span><span class="n">crash</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">result</span><span class="p">;</span><span class="w"></span>
<span class="w">    </span><span class="p">}</span><span class="w"></span>
<span class="w">    </span><span class="cp">#[allow(unused)]</span><span class="w"></span>
<span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="n">bad</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">never</span><span class="p">();</span><span class="w"></span>
<span class="w">    </span><span class="n">result</span><span class="w"> </span><span class="o">*=</span><span class="w"> </span><span class="k">async</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">x</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">x</span><span class="w"> </span><span class="p">}.</span><span class="k">await</span><span class="p">;</span><span class="w"></span>
<span class="w">    </span><span class="nb">drop</span><span class="p">(</span><span class="n">bad</span><span class="p">);</span><span class="w"></span>
<span class="w">    </span><span class="n">result</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>
</code></pre></div>
<p>to generate a new "unnecessary mut" lint.</p>



<a name="271597786"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/lints%2C%20flow-sensitivity%2C%20and%20stability/near/271597786" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> oli <a href="https://zulip-archive.rust-lang.org/stream/213817-t-lang/topic/lints.2C.20flow-sensitivity.2C.20and.20stability.html#271597786">(Feb 11 2022 at 16:06)</a>:</h4>
<p>In sciency terms: more false negatives are bad, more false positives are bad, fewer false positives are good, fewer false negatives are good</p>



<a name="271597878"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/lints%2C%20flow-sensitivity%2C%20and%20stability/near/271597878" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wesley Wiser <a href="https://zulip-archive.rust-lang.org/stream/213817-t-lang/topic/lints.2C.20flow-sensitivity.2C.20and.20stability.html#271597878">(Feb 11 2022 at 16:07)</a>:</h4>
<p>This seems like the correct thing to do to me but I want to make sure of the compatibility implications before merging.</p>



<a name="271597895"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/lints%2C%20flow-sensitivity%2C%20and%20stability/near/271597895" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> oli <a href="https://zulip-archive.rust-lang.org/stream/213817-t-lang/topic/lints.2C.20flow-sensitivity.2C.20and.20stability.html#271597895">(Feb 11 2022 at 16:07)</a>:</h4>
<p>Yea, I read the comment on the PR after my first comment here, and it is fine in the design I described. But that design is not ratified anywhere</p>



<a name="271598043"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/lints%2C%20flow-sensitivity%2C%20and%20stability/near/271598043" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> oli <a href="https://zulip-archive.rust-lang.org/stream/213817-t-lang/topic/lints.2C.20flow-sensitivity.2C.20and.20stability.html#271598043">(Feb 11 2022 at 16:08)</a>:</h4>
<p>Well, again: considering new deny lints are not a breaking change, I think an existing lint triggering on code it didn't before is fine, too</p>



<a name="271598176"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/lints%2C%20flow-sensitivity%2C%20and%20stability/near/271598176" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> simulacrum <a href="https://zulip-archive.rust-lang.org/stream/213817-t-lang/topic/lints.2C.20flow-sensitivity.2C.20and.20stability.html#271598176">(Feb 11 2022 at 16:09)</a>:</h4>
<p>The main worry in this case is that if we stop being that good about flow-sensitivity, we would have a breaking change here, right?</p>
<p>IOW, this is not necessarily just about the lint -- previously, the <code>mut</code> was presumably required, so reverting this PR would be a breaking change, since the mut would once more be required</p>



<a name="271598247"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/lints%2C%20flow-sensitivity%2C%20and%20stability/near/271598247" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> simulacrum <a href="https://zulip-archive.rust-lang.org/stream/213817-t-lang/topic/lints.2C.20flow-sensitivity.2C.20and.20stability.html#271598247">(Feb 11 2022 at 16:09)</a>:</h4>
<p>So I think the focus on the <em>lint</em> is maybe the wrong thing.</p>



<a name="271598335"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/lints%2C%20flow-sensitivity%2C%20and%20stability/near/271598335" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> oli <a href="https://zulip-archive.rust-lang.org/stream/213817-t-lang/topic/lints.2C.20flow-sensitivity.2C.20and.20stability.html#271598335">(Feb 11 2022 at 16:10)</a>:</h4>
<p>Yea, that makes sense to me</p>



<a name="271603663"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/lints%2C%20flow-sensitivity%2C%20and%20stability/near/271603663" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Daniel Henry-Mantilla <a href="https://zulip-archive.rust-lang.org/stream/213817-t-lang/topic/lints.2C.20flow-sensitivity.2C.20and.20stability.html#271603663">(Feb 11 2022 at 16:49)</a>:</h4>
<p>(the example seems tangentially related to "missing <code>mut</code>" being a hard error <em>vs.</em> being a lint)</p>



<a name="271603819"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/lints%2C%20flow-sensitivity%2C%20and%20stability/near/271603819" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Daniel Henry-Mantilla <a href="https://zulip-archive.rust-lang.org/stream/213817-t-lang/topic/lints.2C.20flow-sensitivity.2C.20and.20stability.html#271603819">(Feb 11 2022 at 16:50)</a>:</h4>
<p>But known-to-be-divergent control flows already allow certain code to pass that would otherwise trigger a hard error, mostly related to borrow-checking and drop-checking</p>



<a name="271607755"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/lints%2C%20flow-sensitivity%2C%20and%20stability/near/271607755" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> scottmcm <a href="https://zulip-archive.rust-lang.org/stream/213817-t-lang/topic/lints.2C.20flow-sensitivity.2C.20and.20stability.html#271607755">(Feb 11 2022 at 17:17)</a>:</h4>
<p><span class="user-mention silent" data-user-id="116122">simulacrum</span> <a href="#narrow/stream/213817-t-lang/topic/lints.2C.20flow-sensitivity.2C.20and.20stability/near/271598247">said</a>:</p>
<blockquote>
<p>So I think the focus on the <em>lint</em> is maybe the wrong thing.</p>
</blockquote>
<p>+1 to this.  Lints are allowed to change however they want, subject only to practical restrictions like "maybe it if in practice lints on everything everywhere now we shouldn't".</p>
<p><span class="user-mention silent" data-user-id="116122">simulacrum</span> <a href="#narrow/stream/213817-t-lang/topic/lints.2C.20flow-sensitivity.2C.20and.20stability/near/271598176">said</a>:</p>
<blockquote>
<p>so reverting this PR would be a breaking change, since the mut would once more be required</p>
</blockquote>
<p>This is the essential part.  It needs an FCP if reverting it would be a breaking change.</p>



<a name="273861909"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/lints%2C%20flow-sensitivity%2C%20and%20stability/near/273861909" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/213817-t-lang/topic/lints.2C.20flow-sensitivity.2C.20and.20stability.html#273861909">(Mar 02 2022 at 19:17)</a>:</h4>
<p><span class="user-mention silent" data-user-id="124288">oli</span> <a href="#narrow/stream/213817-t-lang/topic/lints.2C.20flow-sensitivity.2C.20and.20stability/near/271597786">said</a>:</p>
<blockquote>
<p>In sciency terms: more false negatives are bad, more false positives are bad, fewer false positives are good, fewer false negatives are good</p>
</blockquote>
<p>side note, I strongly recommend the terms "false warning" over "false positive". It's always kind of unclear to me what a positive means. :)</p>



<hr><p>Last updated: Apr 12 2022 at 20:01 UTC</p>
</html>