<html>
<head><meta charset="utf-8"><title>`let pattern = expr else { ... }` statements · t-lang · Zulip Chat Archive</title></head>
<h2>Stream: <a href="https://rust-lang.github.io/zulip_archive/stream/213817-t-lang/index.html">t-lang</a></h2>
<h3>Topic: <a href="https://rust-lang.github.io/zulip_archive/stream/213817-t-lang/topic/.60let.20pattern.20.3D.20expr.20else.20.7B.20.2E.2E.2E.20.7D.60.20statements.html">`let pattern = expr else { ... }` statements</a></h3>

<hr>

<base href="https://rust-lang.zulipchat.com">

<head><link href="https://rust-lang.github.io/zulip_archive/style.css" rel="stylesheet"></head>

<a name="234894839"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/%60let%20pattern%20%3D%20expr%20else%20%7B%20...%20%7D%60%20statements/near/234894839" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jeremiah Senkpiel <a href="https://rust-lang.github.io/zulip_archive/stream/213817-t-lang/topic/.60let.20pattern.20.3D.20expr.20else.20.7B.20.2E.2E.2E.20.7D.60.20statements.html#234894839">(Apr 16 2021 at 17:49)</a>:</h4>
<p>Does anyone happen to know what the status of <code>let Pattern else { ... }</code> / inverse <code>if let Pattern { ... }</code> statements is? (Or, what people have been calling them, if anything?) Has this ever been RFC'd? They would be very useful for avoiding both <code>unwrap</code> and overly zealous indentation.</p>



<a name="234894921"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/%60let%20pattern%20%3D%20expr%20else%20%7B%20...%20%7D%60%20statements/near/234894921" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Triplett <a href="https://rust-lang.github.io/zulip_archive/stream/213817-t-lang/topic/.60let.20pattern.20.3D.20expr.20else.20.7B.20.2E.2E.2E.20.7D.60.20statements.html#234894921">(Apr 16 2021 at 17:50)</a>:</h4>
<p><span class="user-mention" data-user-id="319552">@Jeremiah Senkpiel</span> The last status I'm aware of is "the RFC was postponed some time ago and we didn't pick it up again yet".</p>



<a name="234894935"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/%60let%20pattern%20%3D%20expr%20else%20%7B%20...%20%7D%60%20statements/near/234894935" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Triplett <a href="https://rust-lang.github.io/zulip_archive/stream/213817-t-lang/topic/.60let.20pattern.20.3D.20expr.20else.20.7B.20.2E.2E.2E.20.7D.60.20statements.html#234894935">(Apr 16 2021 at 17:50)</a>:</h4>
<p>It desperately needs a champion.</p>



<a name="234894975"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/%60let%20pattern%20%3D%20expr%20else%20%7B%20...%20%7D%60%20statements/near/234894975" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Triplett <a href="https://rust-lang.github.io/zulip_archive/stream/213817-t-lang/topic/.60let.20pattern.20.3D.20expr.20else.20.7B.20.2E.2E.2E.20.7D.60.20statements.html#234894975">(Apr 16 2021 at 17:50)</a>:</h4>
<p>I would love to see it happen.</p>



<a name="234894989"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/%60let%20pattern%20%3D%20expr%20else%20%7B%20...%20%7D%60%20statements/near/234894989" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jeremiah Senkpiel <a href="https://rust-lang.github.io/zulip_archive/stream/213817-t-lang/topic/.60let.20pattern.20.3D.20expr.20else.20.7B.20.2E.2E.2E.20.7D.60.20statements.html#234894989">(Apr 16 2021 at 17:50)</a>:</h4>
<p>Mind to find me the RFC? I am unsure what to search for</p>



<a name="234895022"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/%60let%20pattern%20%3D%20expr%20else%20%7B%20...%20%7D%60%20statements/near/234895022" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jeremiah Senkpiel <a href="https://rust-lang.github.io/zulip_archive/stream/213817-t-lang/topic/.60let.20pattern.20.3D.20expr.20else.20.7B.20.2E.2E.2E.20.7D.60.20statements.html#234895022">(Apr 16 2021 at 17:50)</a>:</h4>
<p>I care a lot about this, much more than my other topic</p>



<a name="234895105"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/%60let%20pattern%20%3D%20expr%20else%20%7B%20...%20%7D%60%20statements/near/234895105" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Triplett <a href="https://rust-lang.github.io/zulip_archive/stream/213817-t-lang/topic/.60let.20pattern.20.3D.20expr.20else.20.7B.20.2E.2E.2E.20.7D.60.20statements.html#234895105">(Apr 16 2021 at 17:51)</a>:</h4>
<p><a href="https://github.com/rust-lang/rfcs/pull/1303">https://github.com/rust-lang/rfcs/pull/1303</a> is the original RFC. Looking for others...</p>



<a name="234895183"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/%60let%20pattern%20%3D%20expr%20else%20%7B%20...%20%7D%60%20statements/near/234895183" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Triplett <a href="https://rust-lang.github.io/zulip_archive/stream/213817-t-lang/topic/.60let.20pattern.20.3D.20expr.20else.20.7B.20.2E.2E.2E.20.7D.60.20statements.html#234895183">(Apr 16 2021 at 17:52)</a>:</h4>
<p>Also see <a href="#narrow/stream/213817-t-lang/topic/let.20.2E.2E.2E.20else">https://rust-lang.zulipchat.com/#narrow/stream/213817-t-lang/topic/let.20.2E.2E.2E.20else</a> for an extensive recent discussion.</p>



<a name="234896499"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/%60let%20pattern%20%3D%20expr%20else%20%7B%20...%20%7D%60%20statements/near/234896499" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jeremiah Senkpiel <a href="https://rust-lang.github.io/zulip_archive/stream/213817-t-lang/topic/.60let.20pattern.20.3D.20expr.20else.20.7B.20.2E.2E.2E.20.7D.60.20statements.html#234896499">(Apr 16 2021 at 18:00)</a>:</h4>
<p>Hmm should this topic be merged with that one? It's a little hard to follow what end feeling was of that thread. I'm not sure why I didn't see that topic, maybe the subject is less clear</p>



<a name="234896720"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/%60let%20pattern%20%3D%20expr%20else%20%7B%20...%20%7D%60%20statements/near/234896720" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Triplett <a href="https://rust-lang.github.io/zulip_archive/stream/213817-t-lang/topic/.60let.20pattern.20.3D.20expr.20else.20.7B.20.2E.2E.2E.20.7D.60.20statements.html#234896720">(Apr 16 2021 at 18:01)</a>:</h4>
<p>I don't think it should be merged, no.</p>



<a name="234897059"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/%60let%20pattern%20%3D%20expr%20else%20%7B%20...%20%7D%60%20statements/near/234897059" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Triplett <a href="https://rust-lang.github.io/zulip_archive/stream/213817-t-lang/topic/.60let.20pattern.20.3D.20expr.20else.20.7B.20.2E.2E.2E.20.7D.60.20statements.html#234897059">(Apr 16 2021 at 18:03)</a>:</h4>
<p>I think the primary open question in that thread was how we should handle the bindings. One proposal was to make <code>let Some(x) = expr() else { ... }</code> allow assigning to <code>x</code> in the <code>else { ... }</code>. I personally prefer just requiring that the <code>else { ... }</code> diverge (typically via <code>return</code> or <code>break</code>).</p>



<a name="234897352"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/%60let%20pattern%20%3D%20expr%20else%20%7B%20...%20%7D%60%20statements/near/234897352" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jeremiah Senkpiel <a href="https://rust-lang.github.io/zulip_archive/stream/213817-t-lang/topic/.60let.20pattern.20.3D.20expr.20else.20.7B.20.2E.2E.2E.20.7D.60.20statements.html#234897352">(Apr 16 2021 at 18:05)</a>:</h4>
<p>Mm. Ok well, I'm coming into this with slightly more assumptions than I think are held in that thread. (I have not yet read the old RFC).</p>
<p>My clueless assumptions are:</p>
<ul>
<li>Syntax should be exactly opposite of <code>if let</code>, in terms of how <code>if else</code> conditionals in general work. (hence <code>let pattern else {}</code>)</li>
<li>Scoping should be exactly opposite (any assignment from this statement being invisible to the inner block)</li>
</ul>



<a name="234897529"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/%60let%20pattern%20%3D%20expr%20else%20%7B%20...%20%7D%60%20statements/near/234897529" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Triplett <a href="https://rust-lang.github.io/zulip_archive/stream/213817-t-lang/topic/.60let.20pattern.20.3D.20expr.20else.20.7B.20.2E.2E.2E.20.7D.60.20statements.html#234897529">(Apr 16 2021 at 18:06)</a>:</h4>
<p><span class="user-mention" data-user-id="319552">@Jeremiah Senkpiel</span> The latter I agree with; any bindings from the pattern should not be visible inside the <code>else</code>.</p>



<a name="234897560"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/%60let%20pattern%20%3D%20expr%20else%20%7B%20...%20%7D%60%20statements/near/234897560" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jeremiah Senkpiel <a href="https://rust-lang.github.io/zulip_archive/stream/213817-t-lang/topic/.60let.20pattern.20.3D.20expr.20else.20.7B.20.2E.2E.2E.20.7D.60.20statements.html#234897560">(Apr 16 2021 at 18:07)</a>:</h4>
<p>What I mean by the latter point is:</p>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="kd">let</span><span class="w"> </span><span class="n">y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="kd">let</span><span class="w"> </span><span class="nb">Some</span><span class="p">(</span><span class="n">x</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">option</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="n">y</span><span class="w"> </span><span class="c1">// not visible</span>
<span class="p">}</span><span class="w"></span>
</code></pre></div>



<a name="234897594"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/%60let%20pattern%20%3D%20expr%20else%20%7B%20...%20%7D%60%20statements/near/234897594" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jeremiah Senkpiel <a href="https://rust-lang.github.io/zulip_archive/stream/213817-t-lang/topic/.60let.20pattern.20.3D.20expr.20else.20.7B.20.2E.2E.2E.20.7D.60.20statements.html#234897594">(Apr 16 2021 at 18:07)</a>:</h4>
<p>Having <code>else</code> be different would be confusing.</p>



<a name="234897668"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/%60let%20pattern%20%3D%20expr%20else%20%7B%20...%20%7D%60%20statements/near/234897668" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Triplett <a href="https://rust-lang.github.io/zulip_archive/stream/213817-t-lang/topic/.60let.20pattern.20.3D.20expr.20else.20.7B.20.2E.2E.2E.20.7D.60.20statements.html#234897668">(Apr 16 2021 at 18:08)</a>:</h4>
<p>For the former, I'd be expecting <code>let Pattern = expr else { ... }</code> as the syntax. What would <code>let Pattern else { ... }</code> mean without something to bind the pattern to?</p>



<a name="234897748"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/%60let%20pattern%20%3D%20expr%20else%20%7B%20...%20%7D%60%20statements/near/234897748" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jeremiah Senkpiel <a href="https://rust-lang.github.io/zulip_archive/stream/213817-t-lang/topic/.60let.20pattern.20.3D.20expr.20else.20.7B.20.2E.2E.2E.20.7D.60.20statements.html#234897748">(Apr 16 2021 at 18:08)</a>:</h4>
<p>So therefore:</p>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="kd">let</span><span class="w"> </span><span class="nb">Some</span><span class="p">(</span><span class="n">y</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">option</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="n">y</span><span class="w"> </span><span class="c1">// also not visible</span>
<span class="p">}</span><span class="w"></span>
</code></pre></div>



<a name="234897766"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/%60let%20pattern%20%3D%20expr%20else%20%7B%20...%20%7D%60%20statements/near/234897766" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> scottmcm <a href="https://rust-lang.github.io/zulip_archive/stream/213817-t-lang/topic/.60let.20pattern.20.3D.20expr.20else.20.7B.20.2E.2E.2E.20.7D.60.20statements.html#234897766">(Apr 16 2021 at 18:08)</a>:</h4>
<p><span class="user-mention silent" data-user-id="239881">Josh Triplett</span> <a href="#narrow/stream/213817-t-lang/topic/.60let.20Pattern.20else.20.7B.20.2E.2E.2E.20.7D.60.20statements/near/234894935">said</a>:</p>
<blockquote>
<p>It desperately needs a champion.</p>
</blockquote>
<p>Yeah, I think it's reached the point where there are a bunch of known questions that need decisions.</p>
<p>It might just need someone to write an RFC that has a bunch of good Rationale &amp; Alternatives sections that make decisions for each of those things and justify them.</p>
<p>Bindings (where are they in scope), syntax (shift-reduce conflicts or things like <code>unless</code>), types (such as whether the else block needs to be <code>!</code> or <code>()</code> or can return values), and general feature scoping (does it need to allow access to the value in the <code>else</code> somehow) are the core things that come to mind.</p>
<p>I think there's a couple reasonable design points in there, though I also agree there's a definite undercurrent in favour of one of them.</p>



<a name="234897849"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/%60let%20pattern%20%3D%20expr%20else%20%7B%20...%20%7D%60%20statements/near/234897849" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Triplett <a href="https://rust-lang.github.io/zulip_archive/stream/213817-t-lang/topic/.60let.20pattern.20.3D.20expr.20else.20.7B.20.2E.2E.2E.20.7D.60.20statements.html#234897849">(Apr 16 2021 at 18:09)</a>:</h4>
<p><span class="user-mention" data-user-id="319552">@Jeremiah Senkpiel</span> Yeah, that's the syntax I'd expect. (And also the formatting I'd expect, which is something the RFC should cover.)</p>



<a name="234897859"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/%60let%20pattern%20%3D%20expr%20else%20%7B%20...%20%7D%60%20statements/near/234897859" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jeremiah Senkpiel <a href="https://rust-lang.github.io/zulip_archive/stream/213817-t-lang/topic/.60let.20pattern.20.3D.20expr.20else.20.7B.20.2E.2E.2E.20.7D.60.20statements.html#234897859">(Apr 16 2021 at 18:09)</a>:</h4>
<p><span class="user-mention silent" data-user-id="239881">Josh Triplett</span> <a href="#narrow/stream/213817-t-lang/topic/.60let.20Pattern.20else.20.7B.20.2E.2E.2E.20.7D.60.20statements/near/234897668">said</a>:</p>
<blockquote>
<p>For the former, I'd be expecting <code>let Pattern = expr else { ... }</code> as the syntax. What would <code>let Pattern else { ... }</code> mean without something to bind the pattern to?</p>
</blockquote>
<p>Sorry, this is correct, I wasn't quite sure how to describe it.</p>



<a name="234898168"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/%60let%20pattern%20%3D%20expr%20else%20%7B%20...%20%7D%60%20statements/near/234898168" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jeremiah Senkpiel <a href="https://rust-lang.github.io/zulip_archive/stream/213817-t-lang/topic/.60let.20pattern.20.3D.20expr.20else.20.7B.20.2E.2E.2E.20.7D.60.20statements.html#234898168">(Apr 16 2021 at 18:11)</a>:</h4>
<p>What would it mean for the else block to return a value? This is a good question, I guess in most cases for where I'd use this, it would be in early returns, but I think some of <span class="user-mention" data-user-id="239881">@Josh Triplett</span>'s examples in the other thread _may_ have had returns?</p>



<a name="234898406"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/%60let%20pattern%20%3D%20expr%20else%20%7B%20...%20%7D%60%20statements/near/234898406" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> scottmcm <a href="https://rust-lang.github.io/zulip_archive/stream/213817-t-lang/topic/.60let.20pattern.20.3D.20expr.20else.20.7B.20.2E.2E.2E.20.7D.60.20statements.html#234898406">(Apr 16 2021 at 18:13)</a>:</h4>
<p>This is probably <em>way</em> too cute, but it could be <code>let Some(x) = y else { 4 };</code>.</p>
<p>(I think that if that were going to be a realistic option it'd be the <code>let Some(x) = y else { x = 4 };</code> version.)</p>



<a name="234898419"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/%60let%20pattern%20%3D%20expr%20else%20%7B%20...%20%7D%60%20statements/near/234898419" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Triplett <a href="https://rust-lang.github.io/zulip_archive/stream/213817-t-lang/topic/.60let.20pattern.20.3D.20expr.20else.20.7B.20.2E.2E.2E.20.7D.60.20statements.html#234898419">(Apr 16 2021 at 18:13)</a>:</h4>
<p><span class="user-mention" data-user-id="319552">@Jeremiah Senkpiel</span> There was a proposal in the other thread to allow something like <code>let Some(x) = expr() else { x = ... }</code>.</p>



<a name="234898454"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/%60let%20pattern%20%3D%20expr%20else%20%7B%20...%20%7D%60%20statements/near/234898454" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jeremiah Senkpiel <a href="https://rust-lang.github.io/zulip_archive/stream/213817-t-lang/topic/.60let.20pattern.20.3D.20expr.20else.20.7B.20.2E.2E.2E.20.7D.60.20statements.html#234898454">(Apr 16 2021 at 18:13)</a>:</h4>
<p>That's just <code>unwrap_or_else(|| {})</code> though</p>



<a name="234898497"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/%60let%20pattern%20%3D%20expr%20else%20%7B%20...%20%7D%60%20statements/near/234898497" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Triplett <a href="https://rust-lang.github.io/zulip_archive/stream/213817-t-lang/topic/.60let.20pattern.20.3D.20expr.20else.20.7B.20.2E.2E.2E.20.7D.60.20statements.html#234898497">(Apr 16 2021 at 18:14)</a>:</h4>
<p>No argument there.</p>



<a name="234898589"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/%60let%20pattern%20%3D%20expr%20else%20%7B%20...%20%7D%60%20statements/near/234898589" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Triplett <a href="https://rust-lang.github.io/zulip_archive/stream/213817-t-lang/topic/.60let.20pattern.20.3D.20expr.20else.20.7B.20.2E.2E.2E.20.7D.60.20statements.html#234898589">(Apr 16 2021 at 18:14)</a>:</h4>
<p>I think allowing that would be a complicated addition for what wouldn't be the common case of <code>let ... else</code>.</p>



<a name="234898591"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/%60let%20pattern%20%3D%20expr%20else%20%7B%20...%20%7D%60%20statements/near/234898591" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> scottmcm <a href="https://rust-lang.github.io/zulip_archive/stream/213817-t-lang/topic/.60let.20pattern.20.3D.20expr.20else.20.7B.20.2E.2E.2E.20.7D.60.20statements.html#234898591">(Apr 16 2021 at 18:14)</a>:</h4>
<p><span class="user-mention silent" data-user-id="319552">Jeremiah Senkpiel</span> <a href="#narrow/stream/213817-t-lang/topic/.60let.20Pattern.20else.20.7B.20.2E.2E.2E.20.7D.60.20statements/near/234898454">said</a>:</p>
<blockquote>
<p>That's just <code>unwrap_or_else()</code> though</p>
</blockquote>
<p>Only for <code>Option</code>.  To me the point of this feature is for things like matching syntax trees the way clippy does, for which one doesn't have all those extra methods</p>



<a name="234898614"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/%60let%20pattern%20%3D%20expr%20else%20%7B%20...%20%7D%60%20statements/near/234898614" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jeremiah Senkpiel <a href="https://rust-lang.github.io/zulip_archive/stream/213817-t-lang/topic/.60let.20pattern.20.3D.20expr.20else.20.7B.20.2E.2E.2E.20.7D.60.20statements.html#234898614">(Apr 16 2021 at 18:14)</a>:</h4>
<p>The problem with <code>unwrap_or_else()</code> here is that you cannot cause a return in the other scope from it.</p>



<a name="234898661"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/%60let%20pattern%20%3D%20expr%20else%20%7B%20...%20%7D%60%20statements/near/234898661" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Triplett <a href="https://rust-lang.github.io/zulip_archive/stream/213817-t-lang/topic/.60let.20pattern.20.3D.20expr.20else.20.7B.20.2E.2E.2E.20.7D.60.20statements.html#234898661">(Apr 16 2021 at 18:15)</a>:</h4>
<p>In any case, my preference would be to <em>start</em> by requiring that the <code>else</code> must diverge, and we could always extend it later.</p>



<a name="234898789"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/%60let%20pattern%20%3D%20expr%20else%20%7B%20...%20%7D%60%20statements/near/234898789" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> scottmcm <a href="https://rust-lang.github.io/zulip_archive/stream/213817-t-lang/topic/.60let.20pattern.20.3D.20expr.20else.20.7B.20.2E.2E.2E.20.7D.60.20statements.html#234898789">(Apr 16 2021 at 18:15)</a>:</h4>
<p>(TBH, for <code>Option</code> specifically I would really like something like C#'s <code>??</code> operator: <code>let x = some_opt() ☃ (calculate() + default());</code> or  <code>let x = some_opt() ☃ continue;</code> or whatever.)</p>



<a name="234899063"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/%60let%20pattern%20%3D%20expr%20else%20%7B%20...%20%7D%60%20statements/near/234899063" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> scottmcm <a href="https://rust-lang.github.io/zulip_archive/stream/213817-t-lang/topic/.60let.20pattern.20.3D.20expr.20else.20.7B.20.2E.2E.2E.20.7D.60.20statements.html#234899063">(Apr 16 2021 at 18:17)</a>:</h4>
<p><span class="user-mention silent" data-user-id="239881">Josh Triplett</span> <a href="#narrow/stream/213817-t-lang/topic/.60let.20Pattern.20else.20.7B.20.2E.2E.2E.20.7D.60.20statements/near/234898661">said</a>:</p>
<blockquote>
<p>In any case, my preference would be to <em>start</em> by requiring that the <code>else</code> must diverge, and we could always extend it later.</p>
</blockquote>
<p>I think shadowing means that we'd need some extra restrictions if we really wanted to leave the door open.</p>
<p>For example,</p>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="kd">let</span><span class="w"> </span><span class="nb">Ok</span><span class="p">(</span><span class="n">x</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">x</span><span class="w"></span>
<span class="k">else</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="fm">panic!</span><span class="p">(</span><span class="s">"x was {:?}"</span><span class="p">,</span><span class="w"> </span><span class="n">x</span><span class="p">)</span><span class="w"> </span><span class="p">}</span><span class="w"></span>
</code></pre></div>
<p>would break if the uninitialized <code>x</code> started to be in-scope.</p>



<a name="234899135"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/%60let%20pattern%20%3D%20expr%20else%20%7B%20...%20%7D%60%20statements/near/234899135" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jeremiah Senkpiel <a href="https://rust-lang.github.io/zulip_archive/stream/213817-t-lang/topic/.60let.20pattern.20.3D.20expr.20else.20.7B.20.2E.2E.2E.20.7D.60.20statements.html#234899135">(Apr 16 2021 at 18:18)</a>:</h4>
<p>_If_ we wanted <code>else</code> to return I think this would be better syntax:</p>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="kd">let</span><span class="w"> </span><span class="nb">Some</span><span class="p">(</span><span class="n">x</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">y</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="nb">Some</span><span class="p">(</span><span class="mi">4</span><span class="p">)</span><span class="w"> </span><span class="c1">// where this is an implicit return of the same type as `y`.</span>
<span class="p">};</span><span class="w"></span>
</code></pre></div>



<a name="234899198"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/%60let%20pattern%20%3D%20expr%20else%20%7B%20...%20%7D%60%20statements/near/234899198" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> scottmcm <a href="https://rust-lang.github.io/zulip_archive/stream/213817-t-lang/topic/.60let.20pattern.20.3D.20expr.20else.20.7B.20.2E.2E.2E.20.7D.60.20statements.html#234899198">(Apr 16 2021 at 18:18)</a>:</h4>
<p>Oh, and another very silly syntax question: should this require a <code>;</code> (like <code>let</code>) or not (like most things that end in <code>}</code>).</p>



<a name="234899255"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/%60let%20pattern%20%3D%20expr%20else%20%7B%20...%20%7D%60%20statements/near/234899255" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Triplett <a href="https://rust-lang.github.io/zulip_archive/stream/213817-t-lang/topic/.60let.20pattern.20.3D.20expr.20else.20.7B.20.2E.2E.2E.20.7D.60.20statements.html#234899255">(Apr 16 2021 at 18:18)</a>:</h4>
<p><span class="user-mention silent" data-user-id="125270">scottmcm</span> <a href="#narrow/stream/213817-t-lang/topic/.60let.20Pattern.20else.20.7B.20.2E.2E.2E.20.7D.60.20statements/near/234898789">said</a>:</p>
<blockquote>
<p>(TBH, for <code>Option</code> specifically I would really like something like C#'s <code>??</code> operator: <code>let x = some_opt() ☃ (calculate() + default());</code> or  <code>let x = some_opt() ☃ continue;</code> or whatever.)</p>
</blockquote>
<p>Honestly, I would love to have a general-purpose mechanism for a lambda to return/continue/break in the containing scope, and then we could do that with <code>unwrap_or_else</code>.</p>



<a name="234899262"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/%60let%20pattern%20%3D%20expr%20else%20%7B%20...%20%7D%60%20statements/near/234899262" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jeremiah Senkpiel <a href="https://rust-lang.github.io/zulip_archive/stream/213817-t-lang/topic/.60let.20pattern.20.3D.20expr.20else.20.7B.20.2E.2E.2E.20.7D.60.20statements.html#234899262">(Apr 16 2021 at 18:19)</a>:</h4>
<p>I was assuming it was like a <code>let</code> delcaration</p>



<a name="234899287"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/%60let%20pattern%20%3D%20expr%20else%20%7B%20...%20%7D%60%20statements/near/234899287" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Triplett <a href="https://rust-lang.github.io/zulip_archive/stream/213817-t-lang/topic/.60let.20pattern.20.3D.20expr.20else.20.7B.20.2E.2E.2E.20.7D.60.20statements.html#234899287">(Apr 16 2021 at 18:19)</a>:</h4>
<p>I was as well; I think it needs a <code>;</code>.</p>



<a name="234899293"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/%60let%20pattern%20%3D%20expr%20else%20%7B%20...%20%7D%60%20statements/near/234899293" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> scottmcm <a href="https://rust-lang.github.io/zulip_archive/stream/213817-t-lang/topic/.60let.20pattern.20.3D.20expr.20else.20.7B.20.2E.2E.2E.20.7D.60.20statements.html#234899293">(Apr 16 2021 at 18:19)</a>:</h4>
<p><span class="user-mention silent" data-user-id="319552">Jeremiah Senkpiel</span> <a href="#narrow/stream/213817-t-lang/topic/.60let.20Pattern.20else.20.7B.20.2E.2E.2E.20.7D.60.20statements/near/234899135">said</a>:</p>
<blockquote>
<p>_If_ we wanted <code>else</code> to return I think this would be better syntax:</p>
<p><div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="kd">let</span><span class="w"> </span><span class="nb">Some</span><span class="p">(</span><span class="n">x</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">y</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="nb">Some</span><span class="p">(</span><span class="mi">4</span><span class="p">)</span><span class="w"> </span><span class="c1">// where this is an implicit return of the same type as `y`.</span>
<span class="p">};</span><span class="w"></span>
</code></pre></div><br>
</p>
</blockquote>
<p>I don't think that quite works because I could do <code>else { None }</code>, which wouldn't fix the problem, and that can't be detected with just the (current) type system.</p>



<a name="234899344"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/%60let%20pattern%20%3D%20expr%20else%20%7B%20...%20%7D%60%20statements/near/234899344" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Triplett <a href="https://rust-lang.github.io/zulip_archive/stream/213817-t-lang/topic/.60let.20pattern.20.3D.20expr.20else.20.7B.20.2E.2E.2E.20.7D.60.20statements.html#234899344">(Apr 16 2021 at 18:19)</a>:</h4>
<p><span class="user-mention silent" data-user-id="125270">scottmcm</span> <a href="#narrow/stream/213817-t-lang/topic/.60let.20Pattern.20else.20.7B.20.2E.2E.2E.20.7D.60.20statements/near/234899063">said</a>:</p>
<blockquote>
<p><span class="user-mention silent" data-user-id="239881">Josh Triplett</span> <a href="#narrow/stream/213817-t-lang/topic/.60let.20Pattern.20else.20.7B.20.2E.2E.2E.20.7D.60.20statements/near/234898661">said</a>:</p>
<blockquote>
<p>In any case, my preference would be to <em>start</em> by requiring that the <code>else</code> must diverge, and we could always extend it later.</p>
</blockquote>
<p>I think shadowing means that we'd need some extra restrictions if we really wanted to leave the door open.</p>
<p>For example,</p>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="kd">let</span><span class="w"> </span><span class="nb">Ok</span><span class="p">(</span><span class="n">x</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">x</span><span class="w"></span>
<span class="k">else</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="fm">panic!</span><span class="p">(</span><span class="s">"x was {:?}"</span><span class="p">,</span><span class="w"> </span><span class="n">x</span><span class="p">)</span><span class="w"> </span><span class="p">}</span><span class="w"></span>
</code></pre></div>
<p>would break if the uninitialized <code>x</code> started to be in-scope.</p>
</blockquote>
<p>True. We could error on the use of <code>x</code> in that scope, but that would make some uses more difficult.</p>



<a name="234899347"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/%60let%20pattern%20%3D%20expr%20else%20%7B%20...%20%7D%60%20statements/near/234899347" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jeremiah Senkpiel <a href="https://rust-lang.github.io/zulip_archive/stream/213817-t-lang/topic/.60let.20pattern.20.3D.20expr.20else.20.7B.20.2E.2E.2E.20.7D.60.20statements.html#234899347">(Apr 16 2021 at 18:19)</a>:</h4>
<p>oh, right</p>



<a name="234899535"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/%60let%20pattern%20%3D%20expr%20else%20%7B%20...%20%7D%60%20statements/near/234899535" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> scottmcm <a href="https://rust-lang.github.io/zulip_archive/stream/213817-t-lang/topic/.60let.20pattern.20.3D.20expr.20else.20.7B.20.2E.2E.2E.20.7D.60.20statements.html#234899535">(Apr 16 2021 at 18:20)</a>:</h4>
<p><span class="user-mention silent" data-user-id="239881">Josh Triplett</span> <a href="#narrow/stream/213817-t-lang/topic/.60let.20Pattern.20else.20.7B.20.2E.2E.2E.20.7D.60.20statements/near/234899287">said</a>:</p>
<blockquote>
<p>I was as well; I think it needs a <code>;</code>.</p>
</blockquote>
<p>Can you elaborate on why?</p>
<p>Not saying you're wrong, just that it's not obvious to me.</p>



<a name="234899615"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/%60let%20pattern%20%3D%20expr%20else%20%7B%20...%20%7D%60%20statements/near/234899615" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jeremiah Senkpiel <a href="https://rust-lang.github.io/zulip_archive/stream/213817-t-lang/topic/.60let.20pattern.20.3D.20expr.20else.20.7B.20.2E.2E.2E.20.7D.60.20statements.html#234899615">(Apr 16 2021 at 18:21)</a>:</h4>
<p>It would keep it the closest to being like a regular <code>let </code>statement.</p>



<a name="234899639"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/%60let%20pattern%20%3D%20expr%20else%20%7B%20...%20%7D%60%20statements/near/234899639" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jeremiah Senkpiel <a href="https://rust-lang.github.io/zulip_archive/stream/213817-t-lang/topic/.60let.20pattern.20.3D.20expr.20else.20.7B.20.2E.2E.2E.20.7D.60.20statements.html#234899639">(Apr 16 2021 at 18:21)</a>:</h4>
<p>Whereas <code>if let</code> is kept similar to an <code>if</code> statement</p>



<a name="234899868"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/%60let%20pattern%20%3D%20expr%20else%20%7B%20...%20%7D%60%20statements/near/234899868" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> scottmcm <a href="https://rust-lang.github.io/zulip_archive/stream/213817-t-lang/topic/.60let.20pattern.20.3D.20expr.20else.20.7B.20.2E.2E.2E.20.7D.60.20statements.html#234899868">(Apr 16 2021 at 18:23)</a>:</h4>
<p>I could also argue that</p>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="kd">let</span><span class="w"> </span><span class="nb">Some</span><span class="p">(</span><span class="n">x</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">c</span><span class="w"></span>
<span class="k">else</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="fm">panic!</span><span class="p">()</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>
</code></pre></div>
<p>is more like</p>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="k">for</span><span class="w"> </span><span class="n">x</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="n">c</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">   </span><span class="fm">panic!</span><span class="p">()</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>
</code></pre></div>
<p>which doesn't use a <code>;</code>.</p>



<a name="234899884"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/%60let%20pattern%20%3D%20expr%20else%20%7B%20...%20%7D%60%20statements/near/234899884" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jeremiah Senkpiel <a href="https://rust-lang.github.io/zulip_archive/stream/213817-t-lang/topic/.60let.20pattern.20.3D.20expr.20else.20.7B.20.2E.2E.2E.20.7D.60.20statements.html#234899884">(Apr 16 2021 at 18:23)</a>:</h4>
<p>Suggestion for how we could do shadowing in the future, because it seems very strange to me that anything on the left side of the <code>else</code> would be assignable:</p>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="kd">let</span><span class="w"> </span><span class="nb">Some</span><span class="p">(</span><span class="n">x</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">x</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="n">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="mi">4</span><span class="w"> </span><span class="p">};</span><span class="w"></span>
</code></pre></div>



<a name="234900071"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/%60let%20pattern%20%3D%20expr%20else%20%7B%20...%20%7D%60%20statements/near/234900071" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jeremiah Senkpiel <a href="https://rust-lang.github.io/zulip_archive/stream/213817-t-lang/topic/.60let.20pattern.20.3D.20expr.20else.20.7B.20.2E.2E.2E.20.7D.60.20statements.html#234900071">(Apr 16 2021 at 18:24)</a>:</h4>
<p>actually that probably can't work, hmm</p>



<a name="234900078"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/%60let%20pattern%20%3D%20expr%20else%20%7B%20...%20%7D%60%20statements/near/234900078" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> scottmcm <a href="https://rust-lang.github.io/zulip_archive/stream/213817-t-lang/topic/.60let.20pattern.20.3D.20expr.20else.20.7B.20.2E.2E.2E.20.7D.60.20statements.html#234900078">(Apr 16 2021 at 18:24)</a>:</h4>
<p><span class="user-mention silent" data-user-id="319552">Jeremiah Senkpiel</span> <a href="#narrow/stream/213817-t-lang/topic/.60let.20Pattern.20else.20.7B.20.2E.2E.2E.20.7D.60.20statements/near/234899884">said</a>:</p>
<blockquote>
<p>because it seems very strange to me that anything on the left side of the <code>lese</code> would be assignable</p>
</blockquote>
<p>Well, <code>let x;</code> is assignable.  So it'd behave like that, to me.</p>



<a name="234900204"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/%60let%20pattern%20%3D%20expr%20else%20%7B%20...%20%7D%60%20statements/near/234900204" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jeremiah Senkpiel <a href="https://rust-lang.github.io/zulip_archive/stream/213817-t-lang/topic/.60let.20pattern.20.3D.20expr.20else.20.7B.20.2E.2E.2E.20.7D.60.20statements.html#234900204">(Apr 16 2021 at 18:25)</a>:</h4>
<p><span class="user-mention silent" data-user-id="125270">scottmcm</span> <a href="#narrow/stream/213817-t-lang/topic/.60let.20Pattern.20else.20.7B.20.2E.2E.2E.20.7D.60.20statements/near/234900078">said</a>:</p>
<blockquote>
<p><span class="user-mention silent" data-user-id="319552">Jeremiah Senkpiel</span> <a href="#narrow/stream/213817-t-lang/topic/.60let.20Pattern.20else.20.7B.20.2E.2E.2E.20.7D.60.20statements/near/234899884">said</a>:</p>
<blockquote>
<p>because it seems very strange to me that anything on the left side of the <code>lese</code> would be assignable</p>
</blockquote>
<p>Well, <code>let x;</code> is assignable.  So it'd behave like that, to me.</p>
</blockquote>
<p>Not during the assignment:</p>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="kd">let</span><span class="w"> </span><span class="n">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">option</span><span class="p">.</span><span class="n">unwrap_or_else</span><span class="p">(</span><span class="o">||</span><span class="w"> </span><span class="n">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">4</span><span class="w"> </span><span class="cm">/* oops */</span><span class="p">);</span><span class="w"></span>
</code></pre></div>



<a name="234900252"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/%60let%20pattern%20%3D%20expr%20else%20%7B%20...%20%7D%60%20statements/near/234900252" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> scottmcm <a href="https://rust-lang.github.io/zulip_archive/stream/213817-t-lang/topic/.60let.20pattern.20.3D.20expr.20else.20.7B.20.2E.2E.2E.20.7D.60.20statements.html#234900252">(Apr 16 2021 at 18:26)</a>:</h4>
<p>And I think it'd be important for it to work for multiple values too, like</p>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="kd">let</span><span class="w"> </span><span class="n">Color</span>::<span class="n">RGB</span><span class="p">{</span><span class="w"> </span><span class="n">r</span><span class="p">,</span><span class="w"> </span><span class="n">g</span><span class="p">,</span><span class="w"> </span><span class="n">b</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">get_color_override</span><span class="p">()</span><span class="w"></span>
<span class="k">else</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="n">r</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">255</span><span class="p">;</span><span class="w"></span>
<span class="w">    </span><span class="n">g</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">255</span><span class="p">;</span><span class="w"></span>
<span class="w">    </span><span class="n">b</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">whatever</span><span class="p">();</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>
</code></pre></div>



<a name="234900558"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/%60let%20pattern%20%3D%20expr%20else%20%7B%20...%20%7D%60%20statements/near/234900558" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jeremiah Senkpiel <a href="https://rust-lang.github.io/zulip_archive/stream/213817-t-lang/topic/.60let.20pattern.20.3D.20expr.20else.20.7B.20.2E.2E.2E.20.7D.60.20statements.html#234900558">(Apr 16 2021 at 18:28)</a>:</h4>
<p>I'd like that to work but I'd also like it to have different syntax</p>



<a name="234900596"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/%60let%20pattern%20%3D%20expr%20else%20%7B%20...%20%7D%60%20statements/near/234900596" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jeremiah Senkpiel <a href="https://rust-lang.github.io/zulip_archive/stream/213817-t-lang/topic/.60let.20pattern.20.3D.20expr.20else.20.7B.20.2E.2E.2E.20.7D.60.20statements.html#234900596">(Apr 16 2021 at 18:28)</a>:</h4>
<p><code>or else</code> or <code>else assign</code> or... <em>something</em></p>



<a name="234900657"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/%60let%20pattern%20%3D%20expr%20else%20%7B%20...%20%7D%60%20statements/near/234900657" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jeremiah Senkpiel <a href="https://rust-lang.github.io/zulip_archive/stream/213817-t-lang/topic/.60let.20pattern.20.3D.20expr.20else.20.7B.20.2E.2E.2E.20.7D.60.20statements.html#234900657">(Apr 16 2021 at 18:29)</a>:</h4>
<p>Usually I find myself like Josh in the position of wanting to not shadow and do an early return</p>



<a name="234900867"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/%60let%20pattern%20%3D%20expr%20else%20%7B%20...%20%7D%60%20statements/near/234900867" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> scottmcm <a href="https://rust-lang.github.io/zulip_archive/stream/213817-t-lang/topic/.60let.20pattern.20.3D.20expr.20else.20.7B.20.2E.2E.2E.20.7D.60.20statements.html#234900867">(Apr 16 2021 at 18:30)</a>:</h4>
<p>But practically, it might be best to spec this as a desugar, and see if we can live with the variable scoping that falls out from that.</p>
<p>Like could we just get away with saying that <code>let PAT = EXPR else { ALT }</code> → <code>let FREE_VARS_TUPLE = if let PAT = EXPR { FREE_VARS_TUPLE } else { let _never: ! = { ALT }; match _never {} }</code>?</p>
<p>That might be the easiest way to teach it and to avoid any weird surprises: like was done for <code>?</code>, it's just a handy shorthand for the way one would write it today.</p>



<a name="234901151"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/%60let%20pattern%20%3D%20expr%20else%20%7B%20...%20%7D%60%20statements/near/234901151" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Triplett <a href="https://rust-lang.github.io/zulip_archive/stream/213817-t-lang/topic/.60let.20pattern.20.3D.20expr.20else.20.7B.20.2E.2E.2E.20.7D.60.20statements.html#234901151">(Apr 16 2021 at 18:33)</a>:</h4>
<p><span class="user-mention" data-user-id="125270">@scottmcm</span> My rationale for the <code>;</code> is that <code>let ...</code> is a let, just as <code>if ...</code> is an if. <code>if let</code> doesn't get a semicolon because <code>if</code> doesn't. <code>let ... else</code> gets a semicolon because it's just an optional extension to <code>let</code> which gets a semicolon.</p>



<a name="234901373"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/%60let%20pattern%20%3D%20expr%20else%20%7B%20...%20%7D%60%20statements/near/234901373" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jeremiah Senkpiel <a href="https://rust-lang.github.io/zulip_archive/stream/213817-t-lang/topic/.60let.20pattern.20.3D.20expr.20else.20.7B.20.2E.2E.2E.20.7D.60.20statements.html#234901373">(Apr 16 2021 at 18:34)</a>:</h4>
<p>To write our your example today would be like:</p>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="kd">let</span><span class="w"> </span><span class="p">(</span><span class="n">r</span><span class="p">,</span><span class="w"> </span><span class="n">g</span><span class="p">,</span><span class="w"> </span><span class="n">b</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="kd">let</span><span class="w"> </span><span class="n">Color</span>::<span class="n">RGB</span><span class="p">{</span><span class="w"> </span><span class="n">r</span><span class="p">,</span><span class="w"> </span><span class="n">g</span><span class="p">,</span><span class="w"> </span><span class="n">b</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">get_color</span><span class="p">()</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="p">(</span><span class="n">r</span><span class="p">,</span><span class="w"> </span><span class="n">g</span><span class="p">,</span><span class="w"> </span><span class="n">b</span><span class="p">)</span><span class="w"></span>
<span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="p">(</span><span class="mi">255</span><span class="p">,</span><span class="w"> </span><span class="mi">255</span><span class="p">,</span><span class="w"> </span><span class="n">something</span><span class="p">())</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>
</code></pre></div>
<p>Which, under <code>let FREE_VARS_TUPLE = if let PAT = EXPR { FREE_VARS_TUPLE } else { let _never: ! = { ALT }; match _never {} }</code> would be:</p>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="kd">let</span><span class="w"> </span><span class="n">Color</span>::<span class="n">RGB</span><span class="p">{</span><span class="w"> </span><span class="n">r</span><span class="p">,</span><span class="w"> </span><span class="n">g</span><span class="p">,</span><span class="w"> </span><span class="n">b</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">get_color</span><span class="p">()</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="p">(</span><span class="mi">255</span><span class="p">,</span><span class="w"> </span><span class="mi">255</span><span class="p">,</span><span class="w"> </span><span class="n">something</span><span class="p">())</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>
</code></pre></div>
<p>I think?</p>



<a name="234901463"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/%60let%20pattern%20%3D%20expr%20else%20%7B%20...%20%7D%60%20statements/near/234901463" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> scottmcm <a href="https://rust-lang.github.io/zulip_archive/stream/213817-t-lang/topic/.60let.20pattern.20.3D.20expr.20else.20.7B.20.2E.2E.2E.20.7D.60.20statements.html#234901463">(Apr 16 2021 at 18:35)</a>:</h4>
<p>The <code>let _never: ! =</code> part there is forcing it to diverge, so it can't do my color example.</p>



<a name="234901505"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/%60let%20pattern%20%3D%20expr%20else%20%7B%20...%20%7D%60%20statements/near/234901505" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jeremiah Senkpiel <a href="https://rust-lang.github.io/zulip_archive/stream/213817-t-lang/topic/.60let.20pattern.20.3D.20expr.20else.20.7B.20.2E.2E.2E.20.7D.60.20statements.html#234901505">(Apr 16 2021 at 18:35)</a>:</h4>
<p>oh ah</p>



<a name="234901533"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/%60let%20pattern%20%3D%20expr%20else%20%7B%20...%20%7D%60%20statements/near/234901533" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Triplett <a href="https://rust-lang.github.io/zulip_archive/stream/213817-t-lang/topic/.60let.20pattern.20.3D.20expr.20else.20.7B.20.2E.2E.2E.20.7D.60.20statements.html#234901533">(Apr 16 2021 at 18:36)</a>:</h4>
<p><span class="user-mention" data-user-id="125270">@scottmcm</span> Your proposed desugar seems fine. That would likely commit us to not allowing access to any of the variables in FREE_VARS_TUPLE, which is fine by me but would mean we couldn't in the future change that.</p>



<a name="234901621"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/%60let%20pattern%20%3D%20expr%20else%20%7B%20...%20%7D%60%20statements/near/234901621" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jeremiah Senkpiel <a href="https://rust-lang.github.io/zulip_archive/stream/213817-t-lang/topic/.60let.20pattern.20.3D.20expr.20else.20.7B.20.2E.2E.2E.20.7D.60.20statements.html#234901621">(Apr 16 2021 at 18:36)</a>:</h4>
<p>I think additional syntax could allow it easily enough though</p>



<a name="234901623"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/%60let%20pattern%20%3D%20expr%20else%20%7B%20...%20%7D%60%20statements/near/234901623" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> scottmcm <a href="https://rust-lang.github.io/zulip_archive/stream/213817-t-lang/topic/.60let.20pattern.20.3D.20expr.20else.20.7B.20.2E.2E.2E.20.7D.60.20statements.html#234901623">(Apr 16 2021 at 18:36)</a>:</h4>
<p>I don't know if that color example is actually important.  I could probably be convinced either way by a well-written RFC <span aria-label="smile" class="emoji emoji-1f642" role="img" title="smile">:smile:</span></p>



<a name="234901685"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/%60let%20pattern%20%3D%20expr%20else%20%7B%20...%20%7D%60%20statements/near/234901685" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jeremiah Senkpiel <a href="https://rust-lang.github.io/zulip_archive/stream/213817-t-lang/topic/.60let.20pattern.20.3D.20expr.20else.20.7B.20.2E.2E.2E.20.7D.60.20statements.html#234901685">(Apr 16 2021 at 18:37)</a>:</h4>
<p>Hmm</p>



<a name="234901909"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/%60let%20pattern%20%3D%20expr%20else%20%7B%20...%20%7D%60%20statements/near/234901909" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> scottmcm <a href="https://rust-lang.github.io/zulip_archive/stream/213817-t-lang/topic/.60let.20pattern.20.3D.20expr.20else.20.7B.20.2E.2E.2E.20.7D.60.20statements.html#234901909">(Apr 16 2021 at 18:38)</a>:</h4>
<p><span class="user-mention silent" data-user-id="239881">Josh Triplett</span> <a href="#narrow/stream/213817-t-lang/topic/.60let.20Pattern.20else.20.7B.20.2E.2E.2E.20.7D.60.20statements/near/234901151">said</a>:</p>
<blockquote>
<p><span class="user-mention silent" data-user-id="125270">scottmcm</span> My rationale for the <code>;</code> is that <code>let ...</code> is a let, just as <code>if ...</code> is an if. <code>if let</code> doesn't get a semicolon because <code>if</code> doesn't. <code>let ... else</code> gets a semicolon because it's just an optional extension to <code>let</code> which gets a semicolon.</p>
</blockquote>
<p>I think I'm just stuck on <em>why</em> <code>if</code> doesn't.  As far as I can tell the rule is "you don't have to put semicolons after <code>}</code>s (unless you care about the value of the expression)", but this isn't an expression, so...</p>



<a name="234902116"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/%60let%20pattern%20%3D%20expr%20else%20%7B%20...%20%7D%60%20statements/near/234902116" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Triplett <a href="https://rust-lang.github.io/zulip_archive/stream/213817-t-lang/topic/.60let.20pattern.20.3D.20expr.20else.20.7B.20.2E.2E.2E.20.7D.60.20statements.html#234902116">(Apr 16 2021 at 18:40)</a>:</h4>
<p>That's a fair consideration. But I'm less concerned about "why <code>if</code> doesn't" in this context, and more observing that <code>let</code> does.</p>



<a name="234902152"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/%60let%20pattern%20%3D%20expr%20else%20%7B%20...%20%7D%60%20statements/near/234902152" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Triplett <a href="https://rust-lang.github.io/zulip_archive/stream/213817-t-lang/topic/.60let.20pattern.20.3D.20expr.20else.20.7B.20.2E.2E.2E.20.7D.60.20statements.html#234902152">(Apr 16 2021 at 18:40)</a>:</h4>
<p>My rationale is primarily that <code>let ... else</code> should act like an extension of <code>let</code>.</p>



<a name="234902178"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/%60let%20pattern%20%3D%20expr%20else%20%7B%20...%20%7D%60%20statements/near/234902178" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Triplett <a href="https://rust-lang.github.io/zulip_archive/stream/213817-t-lang/topic/.60let.20pattern.20.3D.20expr.20else.20.7B.20.2E.2E.2E.20.7D.60.20statements.html#234902178">(Apr 16 2021 at 18:41)</a>:</h4>
<p>I'm assuming you'd agree that <code>let</code> <em>should</em> have a semicolon.</p>



<a name="234902231"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/%60let%20pattern%20%3D%20expr%20else%20%7B%20...%20%7D%60%20statements/near/234902231" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Triplett <a href="https://rust-lang.github.io/zulip_archive/stream/213817-t-lang/topic/.60let.20pattern.20.3D.20expr.20else.20.7B.20.2E.2E.2E.20.7D.60.20statements.html#234902231">(Apr 16 2021 at 18:41)</a>:</h4>
<p>And I think it's more important for <code>let ... else</code> to be consistent with <code>let</code> than it is important to override that with "but it ends in a <code>}</code>".</p>



<a name="234902556"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/%60let%20pattern%20%3D%20expr%20else%20%7B%20...%20%7D%60%20statements/near/234902556" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Triplett <a href="https://rust-lang.github.io/zulip_archive/stream/213817-t-lang/topic/.60let.20pattern.20.3D.20expr.20else.20.7B.20.2E.2E.2E.20.7D.60.20statements.html#234902556">(Apr 16 2021 at 18:44)</a>:</h4>
<p>Syntactically, the else seems like a part of the let. <code>let $pattern = $expr [ else { $stmts } ] ;</code>. It'd seems <em>more</em> complex to me, from a language-understanding point of view, to make that <code>let $pattern = $expr $( ; $| else { $stmts } $)</code>. (<code>$</code> here meaning "this is metasyntax, not syntax".)</p>



<a name="234902711"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/%60let%20pattern%20%3D%20expr%20else%20%7B%20...%20%7D%60%20statements/near/234902711" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Amanieu <a href="https://rust-lang.github.io/zulip_archive/stream/213817-t-lang/topic/.60let.20pattern.20.3D.20expr.20else.20.7B.20.2E.2E.2E.20.7D.60.20statements.html#234902711">(Apr 16 2021 at 18:45)</a>:</h4>
<p>Honestly if you're not diverging in the <code>else</code> branch then you should really be using <code>match</code> instead.</p>



<a name="234902750"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/%60let%20pattern%20%3D%20expr%20else%20%7B%20...%20%7D%60%20statements/near/234902750" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Triplett <a href="https://rust-lang.github.io/zulip_archive/stream/213817-t-lang/topic/.60let.20pattern.20.3D.20expr.20else.20.7B.20.2E.2E.2E.20.7D.60.20statements.html#234902750">(Apr 16 2021 at 18:45)</a>:</h4>
<p><span class="user-mention" data-user-id="143274">@Amanieu</span> Agreed.</p>



<a name="234903468"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/%60let%20pattern%20%3D%20expr%20else%20%7B%20...%20%7D%60%20statements/near/234903468" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jeremiah Senkpiel <a href="https://rust-lang.github.io/zulip_archive/stream/213817-t-lang/topic/.60let.20pattern.20.3D.20expr.20else.20.7B.20.2E.2E.2E.20.7D.60.20statements.html#234903468">(Apr 16 2021 at 18:51)</a>:</h4>
<p>Reading back old RFC comments but translated to 2021:<br>
In the case of <code>Option</code>/<code>Result</code> (including the other scope) this is the same as <code>Try</code>:</p>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="kd">let</span><span class="w"> </span><span class="n">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">x</span><span class="o">?</span><span class="p">;</span><span class="w"></span>
</code></pre></div>
<p>Even in the opposite case:</p>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="kd">let</span><span class="w"> </span><span class="n">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">x</span><span class="p">.</span><span class="n">ok_or_else</span><span class="p">(</span><span class="o">||</span><span class="w"> </span><span class="nb">Err</span><span class="p">(</span><span class="cm">/* something */</span><span class="p">))</span><span class="o">?</span><span class="p">;</span><span class="w"></span>
</code></pre></div>



<a name="234904107"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/%60let%20pattern%20%3D%20expr%20else%20%7B%20...%20%7D%60%20statements/near/234904107" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> scottmcm <a href="https://rust-lang.github.io/zulip_archive/stream/213817-t-lang/topic/.60let.20pattern.20.3D.20expr.20else.20.7B.20.2E.2E.2E.20.7D.60.20statements.html#234904107">(Apr 16 2021 at 18:56)</a>:</h4>
<p><span class="user-mention silent" data-user-id="239881">Josh Triplett</span> <a href="#narrow/stream/213817-t-lang/topic/.60let.20Pattern.20else.20.7B.20.2E.2E.2E.20.7D.60.20statements/near/234902178">said</a>:</p>
<blockquote>
<p>I'm assuming you'd agree that <code>let</code> <em>should</em> have a semicolon.</p>
</blockquote>
<p>Absolutely, but it also doesn't syntactically end with a <code>}</code>, so it needs <em>a</em> marker to know that it's the end.  (I don't really care whether it's a semicolon, other than that it already is.  If it was a <code>,</code> that'd be fine too, since the <code>let</code> isn't an expression so doesn't need to follow expression rules for statements.)</p>
<p>TBH, <code>loop</code> (and <code>if</code> and ...) needs the semicolon "more" (in a sense) than let-else would, because of the ol' <code>loop{}-loop{}</code> ambiguity.  (Which let-else doesn't have, because the end of the else is unambiguously the end of the statement.)</p>



<a name="234904374"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/%60let%20pattern%20%3D%20expr%20else%20%7B%20...%20%7D%60%20statements/near/234904374" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jeremiah Senkpiel <a href="https://rust-lang.github.io/zulip_archive/stream/213817-t-lang/topic/.60let.20pattern.20.3D.20expr.20else.20.7B.20.2E.2E.2E.20.7D.60.20statements.html#234904374">(Apr 16 2021 at 18:58)</a>:</h4>
<p>Hmm, at work we have <em>at least</em> one instance of the following:</p>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="kd">let</span><span class="w"> </span><span class="n">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">match</span><span class="w"> </span><span class="n">y</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="n">Thing</span>::<span class="n">A</span><span class="p">(</span><span class="n">y</span><span class="p">)</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="nb">Ok</span><span class="p">(</span><span class="n">y</span><span class="p">),</span><span class="w"></span>
<span class="w">    </span><span class="n">other</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="n">WrapError</span><span class="p">(</span><span class="n">eyre</span><span class="o">!</span><span class="p">(</span><span class="s">"{}"</span><span class="p">,</span><span class="w"> </span><span class="n">other</span><span class="p">)),</span><span class="w"></span>
<span class="p">}</span><span class="o">?</span><span class="p">;</span><span class="w"></span>
</code></pre></div>



<a name="234904609"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/%60let%20pattern%20%3D%20expr%20else%20%7B%20...%20%7D%60%20statements/near/234904609" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> scottmcm <a href="https://rust-lang.github.io/zulip_archive/stream/213817-t-lang/topic/.60let.20pattern.20.3D.20expr.20else.20.7B.20.2E.2E.2E.20.7D.60.20statements.html#234904609">(Apr 16 2021 at 19:00)</a>:</h4>
<p><span class="user-mention silent" data-user-id="319552">Jeremiah Senkpiel</span> <a href="#narrow/stream/213817-t-lang/topic/.60let.20Pattern.20else.20.7B.20.2E.2E.2E.20.7D.60.20statements/near/234903468">said</a>:</p>
<blockquote>
<p>Reading back old RFC comments but translated to 2021:<br>
In the case of <code>Option</code>/<code>Result</code> (including the other scope) this is the same as <code>Try</code>:</p>
</blockquote>
<p>Notably, with the variable scoping rules that we've been discussing here, you <em>cannot</em> describe <code>?</code> in terms of <code>let else</code>.</p>



<a name="234904629"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/%60let%20pattern%20%3D%20expr%20else%20%7B%20...%20%7D%60%20statements/near/234904629" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jeremiah Senkpiel <a href="https://rust-lang.github.io/zulip_archive/stream/213817-t-lang/topic/.60let.20pattern.20.3D.20expr.20else.20.7B.20.2E.2E.2E.20.7D.60.20statements.html#234904629">(Apr 16 2021 at 19:00)</a>:</h4>
<p>This would then sugar as:</p>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="kd">let</span><span class="w"> </span><span class="n">Thing</span>::<span class="n">A</span><span class="p">(</span><span class="n">x</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">y</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="k">return</span><span class="w"> </span><span class="n">WrapError</span><span class="p">(</span><span class="n">eyre</span><span class="o">!</span><span class="p">(</span><span class="s">"{}"</span><span class="p">,</span><span class="w"> </span><span class="n">y</span><span class="p">));</span><span class="w"> </span><span class="p">}</span><span class="w"></span>
</code></pre></div>



<a name="234904733"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/%60let%20pattern%20%3D%20expr%20else%20%7B%20...%20%7D%60%20statements/near/234904733" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jeremiah Senkpiel <a href="https://rust-lang.github.io/zulip_archive/stream/213817-t-lang/topic/.60let.20pattern.20.3D.20expr.20else.20.7B.20.2E.2E.2E.20.7D.60.20statements.html#234904733">(Apr 16 2021 at 19:01)</a>:</h4>
<p><span class="user-mention" data-user-id="125270">@scottmcm</span> Could you elaborate?</p>



<a name="234904766"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/%60let%20pattern%20%3D%20expr%20else%20%7B%20...%20%7D%60%20statements/near/234904766" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Triplett <a href="https://rust-lang.github.io/zulip_archive/stream/213817-t-lang/topic/.60let.20pattern.20.3D.20expr.20else.20.7B.20.2E.2E.2E.20.7D.60.20statements.html#234904766">(Apr 16 2021 at 19:01)</a>:</h4>
<p>It'd be <code>let Thing::A(x) = y else { ... }</code>.</p>



<a name="234904784"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/%60let%20pattern%20%3D%20expr%20else%20%7B%20...%20%7D%60%20statements/near/234904784" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jeremiah Senkpiel <a href="https://rust-lang.github.io/zulip_archive/stream/213817-t-lang/topic/.60let.20pattern.20.3D.20expr.20else.20.7B.20.2E.2E.2E.20.7D.60.20statements.html#234904784">(Apr 16 2021 at 19:01)</a>:</h4>
<p>Oh, oops, thanks (edited).</p>



<a name="234905151"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/%60let%20pattern%20%3D%20expr%20else%20%7B%20...%20%7D%60%20statements/near/234905151" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> scottmcm <a href="https://rust-lang.github.io/zulip_archive/stream/213817-t-lang/topic/.60let.20pattern.20.3D.20expr.20else.20.7B.20.2E.2E.2E.20.7D.60.20statements.html#234905151">(Apr 16 2021 at 19:04)</a>:</h4>
<p><span class="user-mention silent" data-user-id="319552">Jeremiah Senkpiel</span> <a href="#narrow/stream/213817-t-lang/topic/.60let.20Pattern.20else.20.7B.20.2E.2E.2E.20.7D.60.20statements/near/234904733">said</a>:</p>
<blockquote>
<p><span class="user-mention silent" data-user-id="125270">scottmcm</span> Could you elaborate?</p>
</blockquote>
<p>The problem is that it doesn't return <code>y</code>, it returns the value of the <code>Err</code> variant.</p>



<a name="234905220"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/%60let%20pattern%20%3D%20expr%20else%20%7B%20...%20%7D%60%20statements/near/234905220" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> scottmcm <a href="https://rust-lang.github.io/zulip_archive/stream/213817-t-lang/topic/.60let.20pattern.20.3D.20expr.20else.20.7B.20.2E.2E.2E.20.7D.60.20statements.html#234905220">(Apr 16 2021 at 19:04)</a>:</h4>
<p>Which I guess could technically be pulled out, but without typestate you end up needing an <code>Ok</code> arm inside the <code>else</code>, at which point using <code>let else</code> is materially worse than using <code>match</code>.</p>



<a name="234905461"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/%60let%20pattern%20%3D%20expr%20else%20%7B%20...%20%7D%60%20statements/near/234905461" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> scottmcm <a href="https://rust-lang.github.io/zulip_archive/stream/213817-t-lang/topic/.60let.20pattern.20.3D.20expr.20else.20.7B.20.2E.2E.2E.20.7D.60.20statements.html#234905461">(Apr 16 2021 at 19:06)</a>:</h4>
<p>The usual (if not exactly correct) explanation of <code>let y = x?;</code> is <code>let y = match x { Ok(v) =&gt; v, Err(e) =&gt; return Err(e.into()) };</code>.</p>
<p>But with <code>let else</code> that'd end up being something like</p>
<div class="codehilite"><pre><span></span><code>let y = Ok(x)
else {
    match x {
        Ok(_) =&gt; unreachable!(),
        Err(e) =&gt; return Err(e.into()),
    }
}
</code></pre></div>
<p>which is materially worse than the <code>match</code>.</p>



<a name="234905724"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/%60let%20pattern%20%3D%20expr%20else%20%7B%20...%20%7D%60%20statements/near/234905724" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jeremiah Senkpiel <a href="https://rust-lang.github.io/zulip_archive/stream/213817-t-lang/topic/.60let.20pattern.20.3D.20expr.20else.20.7B.20.2E.2E.2E.20.7D.60.20statements.html#234905724">(Apr 16 2021 at 19:08)</a>:</h4>
<p>Why would we want to describe <code>?</code> in terms of <code>let else</code>?</p>



<a name="234905737"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/%60let%20pattern%20%3D%20expr%20else%20%7B%20...%20%7D%60%20statements/near/234905737" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> scottmcm <a href="https://rust-lang.github.io/zulip_archive/stream/213817-t-lang/topic/.60let.20pattern.20.3D.20expr.20else.20.7B.20.2E.2E.2E.20.7D.60.20statements.html#234905737">(Apr 16 2021 at 19:08)</a>:</h4>
<p>That's why in the other thread I was spitballing</p>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="kd">let</span><span class="w"> </span><span class="n">y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">Ok</span><span class="p">(</span><span class="n">x</span><span class="p">)</span><span class="w"></span>
<span class="k">else</span><span class="w"> </span><span class="k">match</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="nb">Err</span><span class="p">(</span><span class="n">e</span><span class="p">)</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="k">return</span><span class="w"> </span><span class="nb">Err</span><span class="p">(</span><span class="n">e</span><span class="p">.</span><span class="n">into</span><span class="p">()),</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>
</code></pre></div>



<a name="234905813"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/%60let%20pattern%20%3D%20expr%20else%20%7B%20...%20%7D%60%20statements/near/234905813" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jeremiah Senkpiel <a href="https://rust-lang.github.io/zulip_archive/stream/213817-t-lang/topic/.60let.20pattern.20.3D.20expr.20else.20.7B.20.2E.2E.2E.20.7D.60.20statements.html#234905813">(Apr 16 2021 at 19:09)</a>:</h4>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="kd">let</span><span class="w"> </span><span class="nb">Ok</span><span class="p">(</span><span class="n">x</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">y</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="nb">Err</span><span class="p">(</span><span class="n">x</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">y</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="k">return</span><span class="w"> </span><span class="nb">Err</span><span class="p">(</span><span class="n">e</span><span class="p">.</span><span class="n">into</span><span class="p">())</span><span class="w"> </span><span class="p">};</span><span class="w"></span>
</code></pre></div>



<a name="234905838"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/%60let%20pattern%20%3D%20expr%20else%20%7B%20...%20%7D%60%20statements/near/234905838" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jeremiah Senkpiel <a href="https://rust-lang.github.io/zulip_archive/stream/213817-t-lang/topic/.60let.20pattern.20.3D.20expr.20else.20.7B.20.2E.2E.2E.20.7D.60.20statements.html#234905838">(Apr 16 2021 at 19:10)</a>:</h4>
<p>(Do we allow <code>else</code> to be followed by an <code>if</code> here?)</p>



<a name="234905892"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/%60let%20pattern%20%3D%20expr%20else%20%7B%20...%20%7D%60%20statements/near/234905892" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> scottmcm <a href="https://rust-lang.github.io/zulip_archive/stream/213817-t-lang/topic/.60let.20pattern.20.3D.20expr.20else.20.7B.20.2E.2E.2E.20.7D.60.20statements.html#234905892">(Apr 16 2021 at 19:10)</a>:</h4>
<p><span class="user-mention silent" data-user-id="319552">Jeremiah Senkpiel</span> <a href="#narrow/stream/213817-t-lang/topic/.60let.20Pattern.20else.20.7B.20.2E.2E.2E.20.7D.60.20statements/near/234905724">said</a>:</p>
<blockquote>
<p>Why would we want to describe <code>?</code> in terms of <code>let else</code>?</p>
</blockquote>
<p>I don't know, but I thought that's what your earlier "this is the same as Try" post was discussing, though.</p>



<a name="234905959"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/%60let%20pattern%20%3D%20expr%20else%20%7B%20...%20%7D%60%20statements/near/234905959" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jeremiah Senkpiel <a href="https://rust-lang.github.io/zulip_archive/stream/213817-t-lang/topic/.60let.20pattern.20.3D.20expr.20else.20.7B.20.2E.2E.2E.20.7D.60.20statements.html#234905959">(Apr 16 2021 at 19:10)</a>:</h4>
<p>Oh I meant that our examples thus far could be modeled via <code>ok_or_else</code> + <code>?</code>.</p>



<a name="234906238"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/%60let%20pattern%20%3D%20expr%20else%20%7B%20...%20%7D%60%20statements/near/234906238" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jeremiah Senkpiel <a href="https://rust-lang.github.io/zulip_archive/stream/213817-t-lang/topic/.60let.20pattern.20.3D.20expr.20else.20.7B.20.2E.2E.2E.20.7D.60.20statements.html#234906238">(Apr 16 2021 at 19:12)</a>:</h4>
<p><code>else match</code> isn't a thing for <code>if</code> statements either, I think?</p>



<a name="234906650"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/%60let%20pattern%20%3D%20expr%20else%20%7B%20...%20%7D%60%20statements/near/234906650" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Triplett <a href="https://rust-lang.github.io/zulip_archive/stream/213817-t-lang/topic/.60let.20pattern.20.3D.20expr.20else.20.7B.20.2E.2E.2E.20.7D.60.20statements.html#234906650">(Apr 16 2021 at 19:16)</a>:</h4>
<p><span class="user-mention" data-user-id="125270">@scottmcm</span> I think we shouldn't extend this just so that it can be used to desugar <code>?</code>, because we already have a desugaring for <code>?</code> that works.</p>



<a name="234906687"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/%60let%20pattern%20%3D%20expr%20else%20%7B%20...%20%7D%60%20statements/near/234906687" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Triplett <a href="https://rust-lang.github.io/zulip_archive/stream/213817-t-lang/topic/.60let.20pattern.20.3D.20expr.20else.20.7B.20.2E.2E.2E.20.7D.60.20statements.html#234906687">(Apr 16 2021 at 19:16)</a>:</h4>
<p>I can understand how it would work, but it feels far more complex to me.</p>



<a name="234907058"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/%60let%20pattern%20%3D%20expr%20else%20%7B%20...%20%7D%60%20statements/near/234907058" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Triplett <a href="https://rust-lang.github.io/zulip_archive/stream/213817-t-lang/topic/.60let.20pattern.20.3D.20expr.20else.20.7B.20.2E.2E.2E.20.7D.60.20statements.html#234907058">(Apr 16 2021 at 19:19)</a>:</h4>
<p>That said, <code>else match { ... }</code> could be introduced in the future <em>if</em> we want to do so, and that wouldn't be incompatible with an <code>else { ... }</code> that must diverge.</p>



<a name="234909355"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/%60let%20pattern%20%3D%20expr%20else%20%7B%20...%20%7D%60%20statements/near/234909355" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nagisa <a href="https://rust-lang.github.io/zulip_archive/stream/213817-t-lang/topic/.60let.20pattern.20.3D.20expr.20else.20.7B.20.2E.2E.2E.20.7D.60.20statements.html#234909355">(Apr 16 2021 at 19:38)</a>:</h4>
<p>Regular if-else requires a block and IMO this should require a block too for consistency.</p>



<a name="234928489"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/%60let%20pattern%20%3D%20expr%20else%20%7B%20...%20%7D%60%20statements/near/234928489" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> rpjohnst <a href="https://rust-lang.github.io/zulip_archive/stream/213817-t-lang/topic/.60let.20pattern.20.3D.20expr.20else.20.7B.20.2E.2E.2E.20.7D.60.20statements.html#234928489">(Apr 16 2021 at 22:06)</a>:</h4>
<p>another question- what if we don't require the <code>else</code> block to diverge, but just let the pattern bindings be possibly-uninitialized if it doesn't? i.e. if those bindings are never used then we don't report an error; if they are used then we report an error the same way as e.g. <code>let x; if EXPR { x = 3 }; use(x)</code></p>



<a name="234929957"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/%60let%20pattern%20%3D%20expr%20else%20%7B%20...%20%7D%60%20statements/near/234929957" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jeremiah Senkpiel <a href="https://rust-lang.github.io/zulip_archive/stream/213817-t-lang/topic/.60let.20pattern.20.3D.20expr.20else.20.7B.20.2E.2E.2E.20.7D.60.20statements.html#234929957">(Apr 16 2021 at 22:21)</a>:</h4>
<p><span class="user-mention silent" data-user-id="117495">rpjohnst</span> <a href="#narrow/stream/213817-t-lang/topic/.60let.20pattern.20.3D.20expr.20else.20.7B.20.2E.2E.2E.20.7D.60.20statements/near/234928489">said</a>:</p>
<blockquote>
<p>another question- what if we don't require the <code>else</code> block to diverge, but just let the pattern bindings be possibly-uninitialized if it doesn't? i.e. if those bindings are never used then we don't report an error; if they are used then we report an error the same way as e.g. <code>let x; if EXPR { x = 3 }; use(x)</code></p>
</blockquote>
<p>What would the advantage of this be?</p>



<a name="234956555"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/%60let%20pattern%20%3D%20expr%20else%20%7B%20...%20%7D%60%20statements/near/234956555" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Mario Carneiro <a href="https://rust-lang.github.io/zulip_archive/stream/213817-t-lang/topic/.60let.20pattern.20.3D.20expr.20else.20.7B.20.2E.2E.2E.20.7D.60.20statements.html#234956555">(Apr 17 2021 at 03:45)</a>:</h4>
<p>Assuming the else block has no way to initialize the bindings, that means that <code>let Some((x, y, z)) = bla else { foo() };</code> or similar will always make all the bindings in the pattern inaccessible, in which case it may as well be <code>let Some((_, _, _)) = bla else { foo() };</code> which can also be written as <code>if let Some((_, _, _)) = bla {} else { foo() }</code>, so let-else is useless here. You can't even assign to <code>x,y,z</code> like you would with <code>let (x, y, z);</code> because they are possibly already initialized and they aren't mutable bindings.</p>



<a name="234956655"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/%60let%20pattern%20%3D%20expr%20else%20%7B%20...%20%7D%60%20statements/near/234956655" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Mario Carneiro <a href="https://rust-lang.github.io/zulip_archive/stream/213817-t-lang/topic/.60let.20pattern.20.3D.20expr.20else.20.7B.20.2E.2E.2E.20.7D.60.20statements.html#234956655">(Apr 17 2021 at 03:47)</a>:</h4>
<p>FWIW I think let-else should require a semicolon. It is a statement, and all statements require a semicolon after them. The only time semicolons are optional is for expressions that are also (ignore-)statements, which end in a brace. The semicolon in <code>let x = if cond {};</code> is not optional even though it ends in a brace.</p>



<a name="234958359"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/%60let%20pattern%20%3D%20expr%20else%20%7B%20...%20%7D%60%20statements/near/234958359" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> scottmcm <a href="https://rust-lang.github.io/zulip_archive/stream/213817-t-lang/topic/.60let.20pattern.20.3D.20expr.20else.20.7B.20.2E.2E.2E.20.7D.60.20statements.html#234958359">(Apr 17 2021 at 04:22)</a>:</h4>
<p><span class="user-mention silent" data-user-id="123586">nagisa</span> <a href="#narrow/stream/213817-t-lang/topic/.60let.20pattern.20.3D.20expr.20else.20.7B.20.2E.2E.2E.20.7D.60.20statements/near/234909355">said</a>:</p>
<blockquote>
<p>Regular if-else requires a block and IMO this should require a block too for consistency.</p>
</blockquote>
<p>I agree with that in general, but here I'm actually using it as something different from what <code>else { match</code> would do -- this match would need to desugar into the same match as the one implied by the <code>let</code> to be able to omit the <code>Ok</code> arm without needing typestate.</p>
<p>That said, I'm mentioning more for the sake of exploring the space ("what might it be if it does need to be able to look at other variants?") than as something that I really think is necessary for the feature.</p>



<a name="234958485"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/%60let%20pattern%20%3D%20expr%20else%20%7B%20...%20%7D%60%20statements/near/234958485" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> scottmcm <a href="https://rust-lang.github.io/zulip_archive/stream/213817-t-lang/topic/.60let.20pattern.20.3D.20expr.20else.20.7B.20.2E.2E.2E.20.7D.60.20statements.html#234958485">(Apr 17 2021 at 04:26)</a>:</h4>
<p><span class="user-mention silent" data-user-id="271719">Mario Carneiro</span> <a href="#narrow/stream/213817-t-lang/topic/.60let.20pattern.20.3D.20expr.20else.20.7B.20.2E.2E.2E.20.7D.60.20statements/near/234956655">said</a>:</p>
<blockquote>
<p>FWIW I think let-else should require a semicolon. It is a statement, and all statements require a semicolon after them. The only time semicolons are optional is for expressions that are also (ignore-)statements, which end in a brace. The semicolon in <code>let x = if cond {};</code> is not optional even though it ends in a brace.</p>
</blockquote>
<p>I feel like the precedent of "don't need a semicolon after a brace" is pretty strong:</p>
<h2>No brace, so semicolon</h2>
<div class="codehilite"><pre><span></span><code>struct Foo;
struct Foo(i32);
type Foo = i32;
const FOO: u32 = 4;
mod foo;
pub use foo::bar;
</code></pre></div>
<h2>Ends in brace, so no semicolon</h2>
<div class="codehilite"><pre><span></span><code>struct Foo { x: i32 }
mod foo { ... }
fn foo() { ... }
impl Foo { ... }
trait Foo { ... }
</code></pre></div>



<a name="234959826"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/%60let%20pattern%20%3D%20expr%20else%20%7B%20...%20%7D%60%20statements/near/234959826" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Mario Carneiro <a href="https://rust-lang.github.io/zulip_archive/stream/213817-t-lang/topic/.60let.20pattern.20.3D.20expr.20else.20.7B.20.2E.2E.2E.20.7D.60.20statements.html#234959826">(Apr 17 2021 at 04:52)</a>:</h4>
<p>All of those examples are items though</p>



<a name="234959980"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/%60let%20pattern%20%3D%20expr%20else%20%7B%20...%20%7D%60%20statements/near/234959980" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jeremiah Senkpiel <a href="https://rust-lang.github.io/zulip_archive/stream/213817-t-lang/topic/.60let.20pattern.20.3D.20expr.20else.20.7B.20.2E.2E.2E.20.7D.60.20statements.html#234959980">(Apr 17 2021 at 04:56)</a>:</h4>
<p>The following does not compile:</p>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="kd">let</span><span class="w"> </span><span class="n">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="kc">true</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="mi">3</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="mi">4</span><span class="w"> </span><span class="p">}</span><span class="w"></span>
</code></pre></div>



<a name="234960054"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/%60let%20pattern%20%3D%20expr%20else%20%7B%20...%20%7D%60%20statements/near/234960054" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jeremiah Senkpiel <a href="https://rust-lang.github.io/zulip_archive/stream/213817-t-lang/topic/.60let.20pattern.20.3D.20expr.20else.20.7B.20.2E.2E.2E.20.7D.60.20statements.html#234960054">(Apr 17 2021 at 04:56)</a>:</h4>
<p>Any RFC I write for this will include a trailing semicolon.</p>



<a name="234960382"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/%60let%20pattern%20%3D%20expr%20else%20%7B%20...%20%7D%60%20statements/near/234960382" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Mario Carneiro <a href="https://rust-lang.github.io/zulip_archive/stream/213817-t-lang/topic/.60let.20pattern.20.3D.20expr.20else.20.7B.20.2E.2E.2E.20.7D.60.20statements.html#234960382">(Apr 17 2021 at 05:02)</a>:</h4>
<p>The counter-argument is that <code>let x = {};</code> and <code>let x = if cond {};</code> have required semicolons because they are composite objects, and <code>let x = expr;</code> requires a semicolon because it doesn't itself end in a brace, even though <code>expr</code> might. By contrast <code>let x = expr else { expr* }</code> is a single thing, and braces are a required part of that thing, so it's okay to leave off the semicolon. I don't agree with this reasoning because it depends essentially on let-else being a single "thing", which seems incidental. If we think of it as <code>let x = expr (optional_trailing_thing)?;</code> then there is no brace to be seen</p>



<a name="234960841"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/%60let%20pattern%20%3D%20expr%20else%20%7B%20...%20%7D%60%20statements/near/234960841" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> scottmcm <a href="https://rust-lang.github.io/zulip_archive/stream/213817-t-lang/topic/.60let.20pattern.20.3D.20expr.20else.20.7B.20.2E.2E.2E.20.7D.60.20statements.html#234960841">(Apr 17 2021 at 05:11)</a>:</h4>
<p>I don't think of it as "optional trailing thing", because it fundamentally changes what patterns are allowed.  For example, there's no reason to ever put the trailing part on <code>let x = expr</code>, because that's an irrefutable pattern.  And <code>let Some(x) = expr</code> the trailing thing isn't <em>optional</em>.</p>



<a name="234961134"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/%60let%20pattern%20%3D%20expr%20else%20%7B%20...%20%7D%60%20statements/near/234961134" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Mario Carneiro <a href="https://rust-lang.github.io/zulip_archive/stream/213817-t-lang/topic/.60let.20pattern.20.3D.20expr.20else.20.7B.20.2E.2E.2E.20.7D.60.20statements.html#234961134">(Apr 17 2021 at 05:16)</a>:</h4>
<p>that seems more like a type checking concern than syntax though</p>



<a name="234961150"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/%60let%20pattern%20%3D%20expr%20else%20%7B%20...%20%7D%60%20statements/near/234961150" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Mario Carneiro <a href="https://rust-lang.github.io/zulip_archive/stream/213817-t-lang/topic/.60let.20pattern.20.3D.20expr.20else.20.7B.20.2E.2E.2E.20.7D.60.20statements.html#234961150">(Apr 17 2021 at 05:17)</a>:</h4>
<p>as far as syntax is concerned a <code>let</code> may or may not have an <code>else</code> after it</p>



<a name="234961218"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/%60let%20pattern%20%3D%20expr%20else%20%7B%20...%20%7D%60%20statements/near/234961218" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Mario Carneiro <a href="https://rust-lang.github.io/zulip_archive/stream/213817-t-lang/topic/.60let.20pattern.20.3D.20expr.20else.20.7B.20.2E.2E.2E.20.7D.60.20statements.html#234961218">(Apr 17 2021 at 05:18)</a>:</h4>
<p>in the same way that a <code>match</code> can have zero or more branches, even though the types will generally determine the number of branches (assuming only simple matches)</p>



<a name="236100147"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/%60let%20pattern%20%3D%20expr%20else%20%7B%20...%20%7D%60%20statements/near/236100147" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jeremiah Senkpiel <a href="https://rust-lang.github.io/zulip_archive/stream/213817-t-lang/topic/.60let.20pattern.20.3D.20expr.20else.20.7B.20.2E.2E.2E.20.7D.60.20statements.html#236100147">(Apr 25 2021 at 22:57)</a>:</h4>
<p>Reading back through the old RFC, this comment is interesting, as it suggests the part after the else could be any expression rather than a block: </p>
<p><a href="https://github.com/rust-lang/rfcs/pull/1303#issuecomment-144975266">https://github.com/rust-lang/rfcs/pull/1303#issuecomment-144975266</a></p>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="kd">let</span><span class="w"> </span><span class="nb">Some</span><span class="p">(</span><span class="n">a</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">x</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="kc">true</span><span class="p">;</span><span class="w"> </span><span class="c1">// default value?!</span>
<span class="kd">let</span><span class="w"> </span><span class="nb">Err</span><span class="p">(</span><span class="n">string</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">err</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="s">"no error"</span><span class="p">;</span><span class="w"></span>
<span class="kd">let</span><span class="w"> </span><span class="n">Token</span><span class="p">(</span><span class="n">TokenLiteral</span>::<span class="nb">String</span><span class="p">(</span><span class="n">s</span><span class="p">))</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">token</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="k">return</span><span class="w"> </span><span class="nb">Err</span><span class="p">(</span><span class="s">"string token expected"</span><span class="p">);</span><span class="w"></span>
</code></pre></div>



<a name="236100527"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/%60let%20pattern%20%3D%20expr%20else%20%7B%20...%20%7D%60%20statements/near/236100527" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nagisa <a href="https://rust-lang.github.io/zulip_archive/stream/213817-t-lang/topic/.60let.20pattern.20.3D.20expr.20else.20.7B.20.2E.2E.2E.20.7D.60.20statements.html#236100527">(Apr 25 2021 at 23:02)</a>:</h4>
<p>It is not syntactically ambiguous but today I believe it'd probably be a mistake for consistency reasons.</p>



<a name="236103004"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/%60let%20pattern%20%3D%20expr%20else%20%7B%20...%20%7D%60%20statements/near/236103004" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jeremiah Senkpiel <a href="https://rust-lang.github.io/zulip_archive/stream/213817-t-lang/topic/.60let.20pattern.20.3D.20expr.20else.20.7B.20.2E.2E.2E.20.7D.60.20statements.html#236103004">(Apr 25 2021 at 23:46)</a>:</h4>
<p><span class="user-mention" data-user-id="123586">@nagisa</span> no rush, but I’d love to hear an elaboration</p>



<a name="236103165"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/%60let%20pattern%20%3D%20expr%20else%20%7B%20...%20%7D%60%20statements/near/236103165" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jeremiah Senkpiel <a href="https://rust-lang.github.io/zulip_archive/stream/213817-t-lang/topic/.60let.20pattern.20.3D.20expr.20else.20.7B.20.2E.2E.2E.20.7D.60.20statements.html#236103165">(Apr 25 2021 at 23:48)</a>:</h4>
<p>Although it is a pretty easy argument to only allow a block for consistency with <code>if let</code>.</p>



<a name="236103753"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/%60let%20pattern%20%3D%20expr%20else%20%7B%20...%20%7D%60%20statements/near/236103753" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nagisa <a href="https://rust-lang.github.io/zulip_archive/stream/213817-t-lang/topic/.60let.20pattern.20.3D.20expr.20else.20.7B.20.2E.2E.2E.20.7D.60.20statements.html#236103753">(Apr 25 2021 at 23:58)</a>:</h4>
<p>It's for consistency with else of if-else.</p>



<a name="236103783"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/%60let%20pattern%20%3D%20expr%20else%20%7B%20...%20%7D%60%20statements/near/236103783" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nagisa <a href="https://rust-lang.github.io/zulip_archive/stream/213817-t-lang/topic/.60let.20pattern.20.3D.20expr.20else.20.7B.20.2E.2E.2E.20.7D.60.20statements.html#236103783">(Apr 25 2021 at 23:59)</a>:</h4>
<p>If people see <code>let x = y else z;</code> they will naturally expect that <code>if a {} else b</code> should work too.</p>



<a name="236104253"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/%60let%20pattern%20%3D%20expr%20else%20%7B%20...%20%7D%60%20statements/near/236104253" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jeremiah Senkpiel <a href="https://rust-lang.github.io/zulip_archive/stream/213817-t-lang/topic/.60let.20pattern.20.3D.20expr.20else.20.7B.20.2E.2E.2E.20.7D.60.20statements.html#236104253">(Apr 26 2021 at 00:07)</a>:</h4>
<p>Agreed</p>



<a name="236119000"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/%60let%20pattern%20%3D%20expr%20else%20%7B%20...%20%7D%60%20statements/near/236119000" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Triplett <a href="https://rust-lang.github.io/zulip_archive/stream/213817-t-lang/topic/.60let.20pattern.20.3D.20expr.20else.20.7B.20.2E.2E.2E.20.7D.60.20statements.html#236119000">(Apr 26 2021 at 04:33)</a>:</h4>
<p>Does anyone in this thread have the bandwidth and inclination to push this forward, perhaps by proposing a lang MCP? I'd be happy to provide guidance for anyone interested in doing so.</p>



<a name="236196889"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/%60let%20pattern%20%3D%20expr%20else%20%7B%20...%20%7D%60%20statements/near/236196889" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jeremiah Senkpiel <a href="https://rust-lang.github.io/zulip_archive/stream/213817-t-lang/topic/.60let.20pattern.20.3D.20expr.20else.20.7B.20.2E.2E.2E.20.7D.60.20statements.html#236196889">(Apr 26 2021 at 15:38)</a>:</h4>
<p>I want to but it may be a couple weeks</p>



<a name="236197004"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/%60let%20pattern%20%3D%20expr%20else%20%7B%20...%20%7D%60%20statements/near/236197004" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jeremiah Senkpiel <a href="https://rust-lang.github.io/zulip_archive/stream/213817-t-lang/topic/.60let.20pattern.20.3D.20expr.20else.20.7B.20.2E.2E.2E.20.7D.60.20statements.html#236197004">(Apr 26 2021 at 15:39)</a>:</h4>
<p>Why an MCP and not an RFC? I was planning to write an updated RFC with argument answers from here.</p>



<a name="236213700"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/%60let%20pattern%20%3D%20expr%20else%20%7B%20...%20%7D%60%20statements/near/236213700" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Triplett <a href="https://rust-lang.github.io/zulip_archive/stream/213817-t-lang/topic/.60let.20pattern.20.3D.20expr.20else.20.7B.20.2E.2E.2E.20.7D.60.20statements.html#236213700">(Apr 26 2021 at 17:35)</a>:</h4>
<p>That may potentially be reasonable, but I want to account for the fact that the previous efforts in this area weren't postponed for lack of interest, but for lack of available bandwidth. So at a minimum, even if the right next step is an updated RFC, I think it would be important to confirm with the rest of the language team that an updated RFC would be something we'd be prepared to consider at this time.</p>



<a name="236213749"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/%60let%20pattern%20%3D%20expr%20else%20%7B%20...%20%7D%60%20statements/near/236213749" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Triplett <a href="https://rust-lang.github.io/zulip_archive/stream/213817-t-lang/topic/.60let.20pattern.20.3D.20expr.20else.20.7B.20.2E.2E.2E.20.7D.60.20statements.html#236213749">(Apr 26 2021 at 17:35)</a>:</h4>
<p>I'm hopeful that it would be, but I would hate to see a bunch of work go into updating the RFC if the bandwidth isn't available to review it.</p>



<a name="236246138"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/%60let%20pattern%20%3D%20expr%20else%20%7B%20...%20%7D%60%20statements/near/236246138" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jeremiah Senkpiel <a href="https://rust-lang.github.io/zulip_archive/stream/213817-t-lang/topic/.60let.20pattern.20.3D.20expr.20else.20.7B.20.2E.2E.2E.20.7D.60.20statements.html#236246138">(Apr 26 2021 at 21:18)</a>:</h4>
<p>If you mean <a href="https://forge.rust-lang.org/compiler/mcp.html">https://forge.rust-lang.org/compiler/mcp.html</a> - that seems unsuitable? Or does the language team have it's own MCPs?</p>



<a name="236249720"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/%60let%20pattern%20%3D%20expr%20else%20%7B%20...%20%7D%60%20statements/near/236249720" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> scottmcm <a href="https://rust-lang.github.io/zulip_archive/stream/213817-t-lang/topic/.60let.20pattern.20.3D.20expr.20else.20.7B.20.2E.2E.2E.20.7D.60.20statements.html#236249720">(Apr 26 2021 at 21:43)</a>:</h4>
<p>Perhaps <a href="https://github.com/rust-lang/lang-team/issues/new?assignees=&amp;labels=major-change%2C+T-lang&amp;template=project_proposal.md&amp;title=%28My+project+proposal%29">https://github.com/rust-lang/lang-team/issues/new?assignees=&amp;labels=major-change%2C+T-lang&amp;template=project_proposal.md&amp;title=%28My+project+proposal%29</a></p>



<a name="236249998"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/%60let%20pattern%20%3D%20expr%20else%20%7B%20...%20%7D%60%20statements/near/236249998" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jeremiah Senkpiel <a href="https://rust-lang.github.io/zulip_archive/stream/213817-t-lang/topic/.60let.20pattern.20.3D.20expr.20else.20.7B.20.2E.2E.2E.20.7D.60.20statements.html#236249998">(Apr 26 2021 at 21:45)</a>:</h4>
<p>I don't see how this deserves it's own Zulip topic and whatnot. That seems more heavyweight for this change rather than lightweight...</p>



<a name="236919830"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/%60let%20pattern%20%3D%20expr%20else%20%7B%20...%20%7D%60%20statements/near/236919830" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jeremiah Senkpiel <a href="https://rust-lang.github.io/zulip_archive/stream/213817-t-lang/topic/.60let.20pattern.20.3D.20expr.20else.20.7B.20.2E.2E.2E.20.7D.60.20statements.html#236919830">(May 01 2021 at 00:11)</a>:</h4>
<p>Another question, based on some code I saw in the old RFC - What would be the behavior of:</p>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="kd">let</span><span class="w"> </span><span class="n">Enum</span><span class="p">(</span><span class="n">x</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="n">y</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">b</span><span class="w"> </span><span class="p">};</span><span class="w"></span>
</code></pre></div>
<p>And potentially also:</p>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="kd">let</span><span class="w"> </span><span class="n">Enum</span><span class="p">(</span><span class="n">x</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="n">y</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">b</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">c</span><span class="w"> </span><span class="p">};</span><span class="w"></span>
</code></pre></div>
<p>This case really seems quite confusing... (Maybe it should be disallowed?)</p>



<a name="236919972"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/%60let%20pattern%20%3D%20expr%20else%20%7B%20...%20%7D%60%20statements/near/236919972" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jeremiah Senkpiel <a href="https://rust-lang.github.io/zulip_archive/stream/213817-t-lang/topic/.60let.20pattern.20.3D.20expr.20else.20.7B.20.2E.2E.2E.20.7D.60.20statements.html#236919972">(May 01 2021 at 00:14)</a>:</h4>
<p>Personally I take the 'ab' example as being a compile error, and the 'c' branch in the 'abc' example to be the divergent branch.</p>
<p>This would be fine syntax wise (I think?) but it may be hard to teach / introduce people to / have people read code with it.</p>



<a name="236920302"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/%60let%20pattern%20%3D%20expr%20else%20%7B%20...%20%7D%60%20statements/near/236920302" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Mario Carneiro <a href="https://rust-lang.github.io/zulip_archive/stream/213817-t-lang/topic/.60let.20pattern.20.3D.20expr.20else.20.7B.20.2E.2E.2E.20.7D.60.20statements.html#236920302">(May 01 2021 at 00:19)</a>:</h4>
<p>I would say make them both invalid and require/suggest <code>let Enum(x) = (if y { a } else { b }) else { c };</code></p>



<a name="236920361"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/%60let%20pattern%20%3D%20expr%20else%20%7B%20...%20%7D%60%20statements/near/236920361" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Mario Carneiro <a href="https://rust-lang.github.io/zulip_archive/stream/213817-t-lang/topic/.60let.20pattern.20.3D.20expr.20else.20.7B.20.2E.2E.2E.20.7D.60.20statements.html#236920361">(May 01 2021 at 00:20)</a>:</h4>
<p>Ah, we can't make the first one invalid</p>



<a name="236920493"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/%60let%20pattern%20%3D%20expr%20else%20%7B%20...%20%7D%60%20statements/near/236920493" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Mario Carneiro <a href="https://rust-lang.github.io/zulip_archive/stream/213817-t-lang/topic/.60let.20pattern.20.3D.20expr.20else.20.7B.20.2E.2E.2E.20.7D.60.20statements.html#236920493">(May 01 2021 at 00:22)</a>:</h4>
<p>The first one can never be validly interpreted as <code>let Enum(x) = (if y { a }) else { b };</code> because <code>()</code> is not an enum</p>



<a name="236920531"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/%60let%20pattern%20%3D%20expr%20else%20%7B%20...%20%7D%60%20statements/near/236920531" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Mario Carneiro <a href="https://rust-lang.github.io/zulip_archive/stream/213817-t-lang/topic/.60let.20pattern.20.3D.20expr.20else.20.7B.20.2E.2E.2E.20.7D.60.20statements.html#236920531">(May 01 2021 at 00:23)</a>:</h4>
<p>so it should always be interpreted as <code>let Enum(x) = (if y { a } else { b });</code>, and I don't think there are any options for hinting the other pattern</p>



<a name="236921161"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/%60let%20pattern%20%3D%20expr%20else%20%7B%20...%20%7D%60%20statements/near/236921161" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jeremiah Senkpiel <a href="https://rust-lang.github.io/zulip_archive/stream/213817-t-lang/topic/.60let.20pattern.20.3D.20expr.20else.20.7B.20.2E.2E.2E.20.7D.60.20statements.html#236921161">(May 01 2021 at 00:33)</a>:</h4>
<p><code>let Pattern(x) = y;</code> isn't valid though <em>(well, see below)</em>, which would have to make the 'ab' example invalid if <code>if y { a } else { b }</code> always has to be interpreted as <code>(if y { a } else { b })</code></p>
<p>I also don't think that <code>let Enum(x) = (if y { a }) else { b };</code> can ever be valid? isn't the return of <code>if expr block</code> without an <code>else</code> always <code>()</code>?<br>
<em>(I don't actually know, but I assume it must be unit because I don't know what else it could be.)</em></p>



<a name="236921292"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/%60let%20pattern%20%3D%20expr%20else%20%7B%20...%20%7D%60%20statements/near/236921292" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jeremiah Senkpiel <a href="https://rust-lang.github.io/zulip_archive/stream/213817-t-lang/topic/.60let.20pattern.20.3D.20expr.20else.20.7B.20.2E.2E.2E.20.7D.60.20statements.html#236921292">(May 01 2021 at 00:34)</a>:</h4>
<p>(Ok theoretically it could be <code>Option</code> because <code>Some</code> and <code>None</code> map to <code>if expr block;</code>, but I as far as I am aware, that isn't a thing which exists.)</p>



<a name="236921415"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/%60let%20pattern%20%3D%20expr%20else%20%7B%20...%20%7D%60%20statements/near/236921415" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jeremiah Senkpiel <a href="https://rust-lang.github.io/zulip_archive/stream/213817-t-lang/topic/.60let.20pattern.20.3D.20expr.20else.20.7B.20.2E.2E.2E.20.7D.60.20statements.html#236921415">(May 01 2021 at 00:36)</a>:</h4>
<div class="codehilite"><pre><span></span><code>error[E0317]: `if` may be missing an `else` clause
 --&gt; src/main.rs:2:13
  |
2 |     let x = if true { 1 };
  |             ^^^^^^^^^^-^^
  |             |         |
  |             |         found here
  |             expected `()`, found integer
  |
  = note: `if` expressions without `else` evaluate to `()`
  = help: consider adding an `else` block that evaluates to the expected type
</code></pre></div>
<p>Yeah, my assumptions appear correct.</p>



<a name="236921608"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/%60let%20pattern%20%3D%20expr%20else%20%7B%20...%20%7D%60%20statements/near/236921608" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jeremiah Senkpiel <a href="https://rust-lang.github.io/zulip_archive/stream/213817-t-lang/topic/.60let.20pattern.20.3D.20expr.20else.20.7B.20.2E.2E.2E.20.7D.60.20statements.html#236921608">(May 01 2021 at 00:40)</a>:</h4>
<div class="codehilite"><pre><span></span><code>error[E0005]: refutable pattern in local binding: `None` not covered
   --&gt; src/main.rs:2:9
    |
2   |     let Some(x) = Some(1);
    |         ^^^^^^^ pattern `None` not covered
    |
    = note: `let` bindings require an &quot;irrefutable pattern&quot;, like a `struct` or an `enum` with only one variant
    = note: for more information, visit https://doc.rust-lang.org/book/ch18-02-refutability.html
    = note: the matched value is of type `Option&lt;i32&gt;`
help: you might want to use `if let` to ignore the variant that isn&#39;t matched
    |
2   |     if let Some(x) = Some(1) { /* */ }
</code></pre></div>
<p>TIL you can do that with single variant enums. The following compiles, to my surprise:</p>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="k">enum</span> <span class="nc">Only</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">  </span><span class="n">Only</span><span class="p">(</span><span class="n">T</span><span class="p">)</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>
<span class="kd">let</span><span class="w"> </span><span class="n">Only</span>::<span class="n">Only</span><span class="p">(</span><span class="n">x</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Only</span>::<span class="n">Only</span><span class="p">(</span><span class="mi">1</span><span class="p">);</span><span class="w"></span>
</code></pre></div>



<a name="236921745"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/%60let%20pattern%20%3D%20expr%20else%20%7B%20...%20%7D%60%20statements/near/236921745" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jeremiah Senkpiel <a href="https://rust-lang.github.io/zulip_archive/stream/213817-t-lang/topic/.60let.20pattern.20.3D.20expr.20else.20.7B.20.2E.2E.2E.20.7D.60.20statements.html#236921745">(May 01 2021 at 00:43)</a>:</h4>
<p>Maybe this is identical to what you said and I just didn't understand it. <span aria-label="sweat smile" class="emoji emoji-1f605" role="img" title="sweat smile">:sweat_smile:</span></p>



<a name="236923359"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/%60let%20pattern%20%3D%20expr%20else%20%7B%20...%20%7D%60%20statements/near/236923359" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jeremiah Senkpiel <a href="https://rust-lang.github.io/zulip_archive/stream/213817-t-lang/topic/.60let.20pattern.20.3D.20expr.20else.20.7B.20.2E.2E.2E.20.7D.60.20statements.html#236923359">(May 01 2021 at 01:08)</a>:</h4>
<p>Niko's suggestion (from <a href="https://github.com/rust-lang/rfcs/pull/1303#issuecomment-188526691">https://github.com/rust-lang/rfcs/pull/1303#issuecomment-188526691</a>) of requiring <code>else return</code> or <code>else continue</code> or <code>else break</code> would probably solve that <code>else {} else {}</code> (which was cited as one of the reasons the lang team at the time moved to postpone the old rfc: <a href="https://github.com/rust-lang/rfcs/pull/1303#issuecomment-183437307">https://github.com/rust-lang/rfcs/pull/1303#issuecomment-183437307</a>), but conflicts with the other things in this thread about why <code>else</code> should always be followed by a block.</p>



<a name="236923987"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/%60let%20pattern%20%3D%20expr%20else%20%7B%20...%20%7D%60%20statements/near/236923987" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jeremiah Senkpiel <a href="https://rust-lang.github.io/zulip_archive/stream/213817-t-lang/topic/.60let.20pattern.20.3D.20expr.20else.20.7B.20.2E.2E.2E.20.7D.60.20statements.html#236923987">(May 01 2021 at 01:18)</a>:</h4>
<p>A potential issue with that proposal is that not every diverging statement is a <code>return</code>, <code>continue</code>, or <code>break</code> but rather anything which returns <code>!</code>.</p>



<a name="236926187"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/%60let%20pattern%20%3D%20expr%20else%20%7B%20...%20%7D%60%20statements/near/236926187" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Mario Carneiro <a href="https://rust-lang.github.io/zulip_archive/stream/213817-t-lang/topic/.60let.20pattern.20.3D.20expr.20else.20.7B.20.2E.2E.2E.20.7D.60.20statements.html#236926187">(May 01 2021 at 01:56)</a>:</h4>
<p><span class="user-mention silent" data-user-id="319552">Jeremiah Senkpiel</span> <a href="#narrow/stream/213817-t-lang/topic/.60let.20pattern.20.3D.20expr.20else.20.7B.20.2E.2E.2E.20.7D.60.20statements/near/236921161">said</a>:</p>
<blockquote>
<p><code>let Pattern(x) = y;</code> isn't valid though <em>(well, see below)</em>, which would have to make the 'ab' example invalid if <code>if y { a } else { b }</code> always has to be interpreted as <code>(if y { a } else { b })</code></p>
</blockquote>
<p>Note that syntactic disambiguation has to happen at parse time, before types are available. Besides single variant enums, tuple structs also have exactly the same syntax, so we can't be sure that the user didn't mean <code>let Struct(x) = (if y { a } else { b });</code>, which is valid and stable</p>



<a name="236926341"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/%60let%20pattern%20%3D%20expr%20else%20%7B%20...%20%7D%60%20statements/near/236926341" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Mario Carneiro <a href="https://rust-lang.github.io/zulip_archive/stream/213817-t-lang/topic/.60let.20pattern.20.3D.20expr.20else.20.7B.20.2E.2E.2E.20.7D.60.20statements.html#236926341">(May 01 2021 at 01:59)</a>:</h4>
<p>My point is that even if we knew that it is a refutable pattern, there is still no way <code>let Some(x) = if y { a } else { b };</code> can be correct. If we interpret it as <code>let Some(x) = (if y { a } else { b });</code> then it's a let binding on a refutable pattern, which is invalid, and if we interpret it as <code>let Some(x) = (if y { a }) else { b };</code> then it's a type error because <code>if y { a }</code> has type <code>()</code>, not <code>Option&lt;_&gt;</code>. Conceivably we can have a smart error message here, but I would be inclined to always interpret this case as <code>let Some(x) = (if y { a } else { b });</code> with the other interpretation only appearing in error hints</p>



<a name="236926516"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/%60let%20pattern%20%3D%20expr%20else%20%7B%20...%20%7D%60%20statements/near/236926516" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Mario Carneiro <a href="https://rust-lang.github.io/zulip_archive/stream/213817-t-lang/topic/.60let.20pattern.20.3D.20expr.20else.20.7B.20.2E.2E.2E.20.7D.60.20statements.html#236926516">(May 01 2021 at 02:02)</a>:</h4>
<p><span class="user-mention silent" data-user-id="319552">Jeremiah Senkpiel</span> <a href="#narrow/stream/213817-t-lang/topic/.60let.20pattern.20.3D.20expr.20else.20.7B.20.2E.2E.2E.20.7D.60.20statements/near/236923987">said</a>:</p>
<blockquote>
<p>A potential issue with that proposal is that not every diverging statement is a <code>return</code>, <code>continue</code>, or <code>break</code> but rather anything which returns <code>!</code>.</p>
</blockquote>
<p>This is not a significant problem, since you can always write <code>else return panic!()</code>, although it is a little bit misleading.</p>



<a name="236926568"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/%60let%20pattern%20%3D%20expr%20else%20%7B%20...%20%7D%60%20statements/near/236926568" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jeremiah Senkpiel <a href="https://rust-lang.github.io/zulip_archive/stream/213817-t-lang/topic/.60let.20pattern.20.3D.20expr.20else.20.7B.20.2E.2E.2E.20.7D.60.20statements.html#236926568">(May 01 2021 at 02:02)</a>:</h4>
<p>Makes sense. I've come around to it having to be <code>let Some(x) = (if y { a } else { b });</code> and not a compile error. (Although in most cases the compiler will <em>then</em> tell you <code>error[E0005]: refutable pattern in local binding: ...</code>)</p>



<a name="236926646"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/%60let%20pattern%20%3D%20expr%20else%20%7B%20...%20%7D%60%20statements/near/236926646" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Mario Carneiro <a href="https://rust-lang.github.io/zulip_archive/stream/213817-t-lang/topic/.60let.20pattern.20.3D.20expr.20else.20.7B.20.2E.2E.2E.20.7D.60.20statements.html#236926646">(May 01 2021 at 02:03)</a>:</h4>
<p>Right, and for the <code>else {} else {}</code> issue requiring parentheses seems like the most natural solution (we already have a precedent of doing this inside if-conditions)</p>



<a name="236926666"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/%60let%20pattern%20%3D%20expr%20else%20%7B%20...%20%7D%60%20statements/near/236926666" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jeremiah Senkpiel <a href="https://rust-lang.github.io/zulip_archive/stream/213817-t-lang/topic/.60let.20pattern.20.3D.20expr.20else.20.7B.20.2E.2E.2E.20.7D.60.20statements.html#236926666">(May 01 2021 at 02:03)</a>:</h4>
<p>And yes this is true, with Niko's proposal from the RFC, you could write <code>else return function_which_returns_never()</code>.</p>



<a name="236926750"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/%60let%20pattern%20%3D%20expr%20else%20%7B%20...%20%7D%60%20statements/near/236926750" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jeremiah Senkpiel <a href="https://rust-lang.github.io/zulip_archive/stream/213817-t-lang/topic/.60let.20pattern.20.3D.20expr.20else.20.7B.20.2E.2E.2E.20.7D.60.20statements.html#236926750">(May 01 2021 at 02:04)</a>:</h4>
<blockquote>
<p>(we already have a precedent of doing this inside if-conditions)</p>
</blockquote>
<p>I don't think I've seen this, could you provide or link to an example? (I also don't know what I'd search for that?)</p>



<a name="236926759"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/%60let%20pattern%20%3D%20expr%20else%20%7B%20...%20%7D%60%20statements/near/236926759" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Mario Carneiro <a href="https://rust-lang.github.io/zulip_archive/stream/213817-t-lang/topic/.60let.20pattern.20.3D.20expr.20else.20.7B.20.2E.2E.2E.20.7D.60.20statements.html#236926759">(May 01 2021 at 02:05)</a>:</h4>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="k">match</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="kc">true</span><span class="w"> </span><span class="p">{}</span><span class="w"> </span><span class="p">{}</span><span class="w"></span>
</code></pre></div>
<p>is a parse error</p>



<a name="236926762"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/%60let%20pattern%20%3D%20expr%20else%20%7B%20...%20%7D%60%20statements/near/236926762" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jeremiah Senkpiel <a href="https://rust-lang.github.io/zulip_archive/stream/213817-t-lang/topic/.60let.20pattern.20.3D.20expr.20else.20.7B.20.2E.2E.2E.20.7D.60.20statements.html#236926762">(May 01 2021 at 02:05)</a>:</h4>
<p>Wait, do you mean <code>if (if ...) ...</code>?</p>



<a name="236926804"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/%60let%20pattern%20%3D%20expr%20else%20%7B%20...%20%7D%60%20statements/near/236926804" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Mario Carneiro <a href="https://rust-lang.github.io/zulip_archive/stream/213817-t-lang/topic/.60let.20pattern.20.3D.20expr.20else.20.7B.20.2E.2E.2E.20.7D.60.20statements.html#236926804">(May 01 2021 at 02:05)</a>:</h4>
<p>wait no that's the wrong example</p>



<a name="236927338"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/%60let%20pattern%20%3D%20expr%20else%20%7B%20...%20%7D%60%20statements/near/236927338" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Mario Carneiro <a href="https://rust-lang.github.io/zulip_archive/stream/213817-t-lang/topic/.60let.20pattern.20.3D.20expr.20else.20.7B.20.2E.2E.2E.20.7D.60.20statements.html#236927338">(May 01 2021 at 02:13)</a>:</h4>
<p>Ah, here it is</p>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="k">struct</span> <span class="nc">Foo</span><span class="w"> </span><span class="p">{}</span><span class="w"></span>
<span class="k">match</span><span class="w"> </span><span class="n">Foo</span><span class="w"> </span><span class="p">{}</span><span class="w"> </span><span class="p">{}</span><span class="w"></span>
</code></pre></div>



<a name="236927459"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/%60let%20pattern%20%3D%20expr%20else%20%7B%20...%20%7D%60%20statements/near/236927459" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Mario Carneiro <a href="https://rust-lang.github.io/zulip_archive/stream/213817-t-lang/topic/.60let.20pattern.20.3D.20expr.20else.20.7B.20.2E.2E.2E.20.7D.60.20statements.html#236927459">(May 01 2021 at 02:14)</a>:</h4>
<p>here's a version of the syntax ambiguity inside an if condition</p>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="w">    </span><span class="k">struct</span> <span class="nc">Foo</span><span class="w"> </span><span class="p">{}</span><span class="w"></span>
<span class="w">    </span><span class="k">impl</span><span class="w"> </span><span class="n">Foo</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">        </span><span class="k">fn</span> <span class="nf">bla</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span><span class="w"> </span>-&gt; <span class="kt">bool</span> <span class="p">{</span><span class="w"> </span><span class="kc">true</span><span class="w"> </span><span class="p">}</span><span class="w"></span>
<span class="w">    </span><span class="p">}</span><span class="w"></span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="n">Foo</span><span class="w"> </span><span class="p">{}.</span><span class="n">bla</span><span class="p">()</span><span class="w"> </span><span class="p">{}</span><span class="w"></span>
</code></pre></div>



<a name="236927512"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/%60let%20pattern%20%3D%20expr%20else%20%7B%20...%20%7D%60%20statements/near/236927512" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jeremiah Senkpiel <a href="https://rust-lang.github.io/zulip_archive/stream/213817-t-lang/topic/.60let.20pattern.20.3D.20expr.20else.20.7B.20.2E.2E.2E.20.7D.60.20statements.html#236927512">(May 01 2021 at 02:15)</a>:</h4>
<p>The following compiles (somewhat surprisingly):</p>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="kd">let</span><span class="w"> </span><span class="n">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="kc">true</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="kc">false</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="kc">true</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="sc">'a'</span><span class="w"></span>
<span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="sc">'b'</span><span class="w"></span>
<span class="p">};</span><span class="w"></span>
</code></pre></div>



<a name="236927594"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/%60let%20pattern%20%3D%20expr%20else%20%7B%20...%20%7D%60%20statements/near/236927594" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Mario Carneiro <a href="https://rust-lang.github.io/zulip_archive/stream/213817-t-lang/topic/.60let.20pattern.20.3D.20expr.20else.20.7B.20.2E.2E.2E.20.7D.60.20statements.html#236927594">(May 01 2021 at 02:16)</a>:</h4>
<p>The issue seems to be mainly around struct literals used with <code>{}</code> syntax inside the condition of a match, if, or while</p>



<a name="236927633"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/%60let%20pattern%20%3D%20expr%20else%20%7B%20...%20%7D%60%20statements/near/236927633" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Mario Carneiro <a href="https://rust-lang.github.io/zulip_archive/stream/213817-t-lang/topic/.60let.20pattern.20.3D.20expr.20else.20.7B.20.2E.2E.2E.20.7D.60.20statements.html#236927633">(May 01 2021 at 02:17)</a>:</h4>
<p>I guess nested if statements are okay because of the <code>if if</code></p>



<a name="236927639"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/%60let%20pattern%20%3D%20expr%20else%20%7B%20...%20%7D%60%20statements/near/236927639" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jeremiah Senkpiel <a href="https://rust-lang.github.io/zulip_archive/stream/213817-t-lang/topic/.60let.20pattern.20.3D.20expr.20else.20.7B.20.2E.2E.2E.20.7D.60.20statements.html#236927639">(May 01 2021 at 02:17)</a>:</h4>
<p>The difference between my example there and <code>if ... let</code> is <code>else { } { } else {}</code> vs <code>else {} else {}</code>.</p>



<a name="236927697"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/%60let%20pattern%20%3D%20expr%20else%20%7B%20...%20%7D%60%20statements/near/236927697" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jeremiah Senkpiel <a href="https://rust-lang.github.io/zulip_archive/stream/213817-t-lang/topic/.60let.20pattern.20.3D.20expr.20else.20.7B.20.2E.2E.2E.20.7D.60.20statements.html#236927697">(May 01 2021 at 02:18)</a>:</h4>
<p>(And the presence of <code>if</code>.)</p>



<a name="236928032"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/%60let%20pattern%20%3D%20expr%20else%20%7B%20...%20%7D%60%20statements/near/236928032" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Mario Carneiro <a href="https://rust-lang.github.io/zulip_archive/stream/213817-t-lang/topic/.60let.20pattern.20.3D.20expr.20else.20.7B.20.2E.2E.2E.20.7D.60.20statements.html#236928032">(May 01 2021 at 02:22)</a>:</h4>
<p>Ooh, this is actually ambiguous:</p>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="w">    </span><span class="k">struct</span> <span class="nc">Bla</span><span class="p">;</span><span class="w"></span>
<span class="w">    </span><span class="k">impl</span><span class="w"> </span><span class="n">std</span>::<span class="n">ops</span>::<span class="n">Add</span><span class="o">&lt;</span><span class="p">()</span><span class="o">&gt;</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="n">Bla</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">        </span><span class="k">type</span> <span class="nc">Output</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">Option</span><span class="o">&lt;</span><span class="p">()</span><span class="o">&gt;</span><span class="p">;</span><span class="w"></span>
<span class="w">        </span><span class="k">fn</span> <span class="nf">add</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="w"> </span><span class="n">_</span>: <span class="p">())</span><span class="w"> </span>-&gt; <span class="nc">Self</span>::<span class="n">Output</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nb">None</span><span class="w"> </span><span class="p">}</span><span class="w"></span>
<span class="w">    </span><span class="p">}</span><span class="w"></span>
<span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="nb">Some</span><span class="p">(</span><span class="n">x</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Bla</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="kc">true</span><span class="w"> </span><span class="p">{}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="k">break</span><span class="w"> </span><span class="p">};</span><span class="w"></span>
</code></pre></div>



<a name="236928545"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/%60let%20pattern%20%3D%20expr%20else%20%7B%20...%20%7D%60%20statements/near/236928545" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Mario Carneiro <a href="https://rust-lang.github.io/zulip_archive/stream/213817-t-lang/topic/.60let.20pattern.20.3D.20expr.20else.20.7B.20.2E.2E.2E.20.7D.60.20statements.html#236928545">(May 01 2021 at 02:30)</a>:</h4>
<p>My thinking on these examples is that we should always prefer the interpretation which doesn't use let-else, and if it matches the <code>let pat = expr else block</code> grammar but not the <code>let pat = expr</code> grammar then it should still be rejected if <code>expr</code> ends in a <code>}</code>, unless it is a block expression (and in this case we recommend putting <code>expr</code> in parentheses)</p>



<a name="236929250"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/%60let%20pattern%20%3D%20expr%20else%20%7B%20...%20%7D%60%20statements/near/236929250" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Mario Carneiro <a href="https://rust-lang.github.io/zulip_archive/stream/213817-t-lang/topic/.60let.20pattern.20.3D.20expr.20else.20.7B.20.2E.2E.2E.20.7D.60.20statements.html#236929250">(May 01 2021 at 02:40)</a>:</h4>
<p>Looking at the expr grammar, the ones that end in <code>}</code> are: <code>{ }</code>, <code>unsafe { }</code>, <code>const { }</code>, <code>async { }</code>, <code>for ... { }</code>, <code>while ... { }</code>, <code>loop { }</code>, <code>if ... (else if...) { }</code>, <code>match ... { }</code>, <code>Struct { }</code>, <code>macro! { }</code>.</p>
<p>If we don't ban their use at the end of <code>expr</code> in <code>let pat = expr else block</code>, then we are essentially committing to never allowing <code>else</code> to follow the expression. At the very least <code>if</code> needs to be banned, but I think that for future growth it would be best to ban all of them except for blocks, unsafe/const/async, and maybe struct literals.</p>



<a name="236942064"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/%60let%20pattern%20%3D%20expr%20else%20%7B%20...%20%7D%60%20statements/near/236942064" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Triplett <a href="https://rust-lang.github.io/zulip_archive/stream/213817-t-lang/topic/.60let.20pattern.20.3D.20expr.20else.20.7B.20.2E.2E.2E.20.7D.60.20statements.html#236942064">(May 01 2021 at 06:06)</a>:</h4>
<p>So, our conclusion at the time was that we weren't worried about if returning (), and didn't think that would come up in existing code.</p>



<a name="237245447"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/%60let%20pattern%20%3D%20expr%20else%20%7B%20...%20%7D%60%20statements/near/237245447" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jeremiah Senkpiel <a href="https://rust-lang.github.io/zulip_archive/stream/213817-t-lang/topic/.60let.20pattern.20.3D.20expr.20else.20.7B.20.2E.2E.2E.20.7D.60.20statements.html#237245447">(May 03 2021 at 23:18)</a>:</h4>
<p>Is that why the <code>else {} else {}</code> case seemed to be the only one mentioned in the RFC (if memory serves)?</p>



<a name="237245790"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/%60let%20pattern%20%3D%20expr%20else%20%7B%20...%20%7D%60%20statements/near/237245790" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jeremiah Senkpiel <a href="https://rust-lang.github.io/zulip_archive/stream/213817-t-lang/topic/.60let.20pattern.20.3D.20expr.20else.20.7B.20.2E.2E.2E.20.7D.60.20statements.html#237245790">(May 03 2021 at 23:22)</a>:</h4>
<p>So at work we have a bunch of both <code>if let Some(x) = y { .. }</code> code, but we also have a large state machine which uses enums for a kind of variadic overloading, and there is a lot of <code>if let Enum::Type(...) = y { ... big statement ... } else { /* this is an error */}</code> code. I'd like to try a refactoring pass to gauge the existing cited solutions (such as <code>let x = if let T(x) = y { x } else { ... };</code>, which i always forget about. I'll try to collect the results of that into some form that can be shared in an RFC. The plan was to do that this week but I may not get to it this week and I'm off next week so this might still be a few weeks until RFC is written up.</p>



<a name="240877418"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/%60let%20pattern%20%3D%20expr%20else%20%7B%20...%20%7D%60%20statements/near/240877418" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jeremiah Senkpiel <a href="https://rust-lang.github.io/zulip_archive/stream/213817-t-lang/topic/.60let.20pattern.20.3D.20expr.20else.20.7B.20.2E.2E.2E.20.7D.60.20statements.html#240877418">(May 31 2021 at 22:50)</a>:</h4>
<p>Writing some words - are <code>if let</code> and <code>let else</code> <em>statements</em> or are they  <em>expressions</em>?</p>



<a name="240877558"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/%60let%20pattern%20%3D%20expr%20else%20%7B%20...%20%7D%60%20statements/near/240877558" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jeremiah Senkpiel <a href="https://rust-lang.github.io/zulip_archive/stream/213817-t-lang/topic/.60let.20pattern.20.3D.20expr.20else.20.7B.20.2E.2E.2E.20.7D.60.20statements.html#240877558">(May 31 2021 at 22:53)</a>:</h4>
<p>Oh, <code>if let</code> is an expression because it can return things, right?</p>



<a name="240877651"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/%60let%20pattern%20%3D%20expr%20else%20%7B%20...%20%7D%60%20statements/near/240877651" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jacob Lifshay <a href="https://rust-lang.github.io/zulip_archive/stream/213817-t-lang/topic/.60let.20pattern.20.3D.20expr.20else.20.7B.20.2E.2E.2E.20.7D.60.20statements.html#240877651">(May 31 2021 at 22:55)</a>:</h4>
<p><code>if let ...</code> is an expression, <code>let ... else { ... }</code> is a statement</p>



<a name="240877667"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/%60let%20pattern%20%3D%20expr%20else%20%7B%20...%20%7D%60%20statements/near/240877667" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jacob Lifshay <a href="https://rust-lang.github.io/zulip_archive/stream/213817-t-lang/topic/.60let.20pattern.20.3D.20expr.20else.20.7B.20.2E.2E.2E.20.7D.60.20statements.html#240877667">(May 31 2021 at 22:55)</a>:</h4>
<p>like how <code>let a = 23;</code> is a statement</p>



<a name="240884629"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/%60let%20pattern%20%3D%20expr%20else%20%7B%20...%20%7D%60%20statements/near/240884629" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jeremiah Senkpiel <a href="https://rust-lang.github.io/zulip_archive/stream/213817-t-lang/topic/.60let.20pattern.20.3D.20expr.20else.20.7B.20.2E.2E.2E.20.7D.60.20statements.html#240884629">(Jun 01 2021 at 01:08)</a>:</h4>
<p>I wrote most of an updated RFC for this, if anyone would like to review it. I still need to gather some examples and copy edit it a bunch.</p>
<p><a href="https://github.com/Fishrock123/rfcs/blob/2b92ef583be8521ec9506cb11d99a02963ffb398/text/0000-let-else.md">https://github.com/Fishrock123/rfcs/blob/2b92ef583be8521ec9506cb11d99a02963ffb398/text/0000-let-else.md</a></p>



<a name="240884791"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/%60let%20pattern%20%3D%20expr%20else%20%7B%20...%20%7D%60%20statements/near/240884791" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jeremiah Senkpiel <a href="https://rust-lang.github.io/zulip_archive/stream/213817-t-lang/topic/.60let.20pattern.20.3D.20expr.20else.20.7B.20.2E.2E.2E.20.7D.60.20statements.html#240884791">(Jun 01 2021 at 01:11)</a>:</h4>
<p>I have largely preferred <code>match</code> as the existing counterpoint example, as I've never seen <code>if let { assignment ] else { }</code> in real code, but I've seen <code>match</code> with early return quite a lot, and there was a servo example in the old rfc too.</p>



<a name="240902424"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/%60let%20pattern%20%3D%20expr%20else%20%7B%20...%20%7D%60%20statements/near/240902424" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Dirkjan Ochtman <a href="https://rust-lang.github.io/zulip_archive/stream/213817-t-lang/topic/.60let.20pattern.20.3D.20expr.20else.20.7B.20.2E.2E.2E.20.7D.60.20statements.html#240902424">(Jun 01 2021 at 07:10)</a>:</h4>
<p>Looks quite good! I'd maybe spend less space on examples of the current situation in the Examples section, instead showing some further examples of the new situation, like maybe with <code>Result</code> and another enum (<code>std::task::Poll</code>?)</p>
<p>For the drawbacks (diverging blocks), maybe talk about what diagnostics could do make this more friendly to less experienced users. Maybe the word "diverging" should be used less, instead using "return/continue/break" more?</p>
<p>There's a broken link to <code>original-rfc</code> and a few typos: proceding, guarenteed, Fundimentally, Varient. But in general I think this is definitely of high enough quality to become an actual rfcs repo PR.</p>



<a name="240971030"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/%60let%20pattern%20%3D%20expr%20else%20%7B%20...%20%7D%60%20statements/near/240971030" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> bstrie <a href="https://rust-lang.github.io/zulip_archive/stream/213817-t-lang/topic/.60let.20pattern.20.3D.20expr.20else.20.7B.20.2E.2E.2E.20.7D.60.20statements.html#240971030">(Jun 01 2021 at 16:50)</a>:</h4>
<p><span class="user-mention" data-user-id="319552">@Jeremiah Senkpiel</span> As I mention in my comment on the old RFC: <a href="https://github.com/rust-lang/rfcs/pull/1303#issuecomment-840744369">https://github.com/rust-lang/rfcs/pull/1303#issuecomment-840744369</a> , the syntax should be <code>let PATTERN = EXPRESSION_WITHOUT_BLOCK else BLOCK</code>. The "expression without block" syntactic class is defined at <a href="https://doc.rust-lang.org/reference/expressions.html#expressions">https://doc.rust-lang.org/reference/expressions.html#expressions</a> . Among other things, this also makes sure to disallow <code>if let</code> in your expression position, which this draft RFC seems to overlook.</p>



<a name="240974411"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/%60let%20pattern%20%3D%20expr%20else%20%7B%20...%20%7D%60%20statements/near/240974411" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jeremiah Senkpiel <a href="https://rust-lang.github.io/zulip_archive/stream/213817-t-lang/topic/.60let.20pattern.20.3D.20expr.20else.20.7B.20.2E.2E.2E.20.7D.60.20statements.html#240974411">(Jun 01 2021 at 17:15)</a>:</h4>
<p><span class="user-mention" data-user-id="256342">@bstrie</span> Ah, thanks. Does that still allow e.g. <code>let foo = unsafe { bar } else { qux };</code> to be written with parenthesis as <code>let foo = (unsafe { bar }) else { qux };</code>?</p>
<p>The draft implicitly considers <code>if let else</code> in the expression position to be equivalent to <code>if else</code>. I could clarify that, but I'm also not sure it really matters, since it is essentially the same.</p>



<a name="240974840"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/%60let%20pattern%20%3D%20expr%20else%20%7B%20...%20%7D%60%20statements/near/240974840" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jeremiah Senkpiel <a href="https://rust-lang.github.io/zulip_archive/stream/213817-t-lang/topic/.60let.20pattern.20.3D.20expr.20else.20.7B.20.2E.2E.2E.20.7D.60.20statements.html#240974840">(Jun 01 2021 at 17:19)</a>:</h4>
<p><code>let Enum:V(a) = (if let Some(b) { b.get_enum() } else { some_fallback() }) else { return make_an_error(); };</code> is somewhat convoluted but doesn't seem invalid.</p>



<a name="240975014"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/%60let%20pattern%20%3D%20expr%20else%20%7B%20...%20%7D%60%20statements/near/240975014" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jeremiah Senkpiel <a href="https://rust-lang.github.io/zulip_archive/stream/213817-t-lang/topic/.60let.20pattern.20.3D.20expr.20else.20.7B.20.2E.2E.2E.20.7D.60.20statements.html#240975014">(Jun 01 2021 at 17:20)</a>:</h4>
<p>Clippy should probably suggest against putting conditionals in the expression though, due do how it once again separates the <code>let</code> assignment conditional from the <code>else</code> block, like stated in the draft RFC.</p>
<p>(though, the same thing can be said for <code>if else</code> nested within the expression position of <code>if let</code>.)</p>



<a name="240975494"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/%60let%20pattern%20%3D%20expr%20else%20%7B%20...%20%7D%60%20statements/near/240975494" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> bstrie <a href="https://rust-lang.github.io/zulip_archive/stream/213817-t-lang/topic/.60let.20pattern.20.3D.20expr.20else.20.7B.20.2E.2E.2E.20.7D.60.20statements.html#240975494">(Jun 01 2021 at 17:24)</a>:</h4>
<blockquote>
<p>Does that still allow e.g. let foo = unsafe { bar } else { qux }; to be written with parenthesis as let foo = (unsafe { bar }) else { qux };?</p>
</blockquote>
<p>Yes it would, <code>(unsafe { bar })</code> is a GroupedExpression, which in the category of ExpressionWithoutBlock</p>
<blockquote>
<p>The draft implicitly considers if let else in the expression position to be equivalent to if else.</p>
</blockquote>
<p>Sure, still worth clarifying though (and they are technically separate expression classes, both ExpressionWithBlock).</p>



<a name="240977526"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/%60let%20pattern%20%3D%20expr%20else%20%7B%20...%20%7D%60%20statements/near/240977526" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Scott Olson <a href="https://rust-lang.github.io/zulip_archive/stream/213817-t-lang/topic/.60let.20pattern.20.3D.20expr.20else.20.7B.20.2E.2E.2E.20.7D.60.20statements.html#240977526">(Jun 01 2021 at 17:38)</a>:</h4>
<p>As an aside, I think <span class="user-mention" data-user-id="256342">@bstrie</span>'s suggestion of <code>ExpressionWithoutBlock</code> (rather than excluding only <code>if</code>/<code>if let</code>) is especially reasonable for loops, since there have for a long time been proposals floating around for <code>else</code> on various loop types, so it's more backwards compatible to exclude those just in case.</p>
<p>And while it would be unambiguous for some block types like <code>unsafe</code>, it seems bad for human readers to encounter <code>let pat = some_block { ... } else { ... }</code> and not know how to parse it if they aren't yet familiar with the particular <code>some_block</code> type in question.</p>



<a name="240977877"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/%60let%20pattern%20%3D%20expr%20else%20%7B%20...%20%7D%60%20statements/near/240977877" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jeremiah Senkpiel <a href="https://rust-lang.github.io/zulip_archive/stream/213817-t-lang/topic/.60let.20pattern.20.3D.20expr.20else.20.7B.20.2E.2E.2E.20.7D.60.20statements.html#240977877">(Jun 01 2021 at 17:41)</a>:</h4>
<p>Yeah, I also like the suggestion of <code>ExpressionWithoutBlock</code> now that I have some understanding of <code>GroupedExpression</code>. (these details are all new to me!)</p>



<a name="240978265"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/%60let%20pattern%20%3D%20expr%20else%20%7B%20...%20%7D%60%20statements/near/240978265" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Scott Olson <a href="https://rust-lang.github.io/zulip_archive/stream/213817-t-lang/topic/.60let.20pattern.20.3D.20expr.20else.20.7B.20.2E.2E.2E.20.7D.60.20statements.html#240978265">(Jun 01 2021 at 17:44)</a>:</h4>
<p>Thanks for redrafting this RFC, by the way. I can't believe it's been almost 6 years since I started arguing for this feature. :P</p>



<a name="240979375"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/%60let%20pattern%20%3D%20expr%20else%20%7B%20...%20%7D%60%20statements/near/240979375" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Scott Olson <a href="https://rust-lang.github.io/zulip_archive/stream/213817-t-lang/topic/.60let.20pattern.20.3D.20expr.20else.20.7B.20.2E.2E.2E.20.7D.60.20statements.html#240979375">(Jun 01 2021 at 17:53)</a>:</h4>
<p>Hmm, not to devolve into bikeshedding, but the <code>try</code> keyword was <em>not</em> available when the original RFC was drafted, and now is (in 2018 edition and newer). So we <em>could</em> suggest <code>try let ... = ... else { ... }</code> to match more closely with Swift's <code>guard let</code>, but some people might dislike this overloading of <code>try</code>.</p>



<a name="240979540"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/%60let%20pattern%20%3D%20expr%20else%20%7B%20...%20%7D%60%20statements/near/240979540" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Scott Olson <a href="https://rust-lang.github.io/zulip_archive/stream/213817-t-lang/topic/.60let.20pattern.20.3D.20expr.20else.20.7B.20.2E.2E.2E.20.7D.60.20statements.html#240979540">(Jun 01 2021 at 17:54)</a>:</h4>
<p>Though I'm not sure where else <code>try</code> is even used, maybe just <a href="https://doc.rust-lang.org/nightly/unstable-book/language-features/try-blocks.html">this unstable feature</a>?</p>



<a name="240979842"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/%60let%20pattern%20%3D%20expr%20else%20%7B%20...%20%7D%60%20statements/near/240979842" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Scott Olson <a href="https://rust-lang.github.io/zulip_archive/stream/213817-t-lang/topic/.60let.20pattern.20.3D.20expr.20else.20.7B.20.2E.2E.2E.20.7D.60.20statements.html#240979842">(Jun 01 2021 at 17:56)</a>:</h4>
<p>I personally think it would be quite clear that <code>try let</code> is distinct from <code>try { ... }</code> blocks, and I'm not bothered that <code>try let</code> would not be directly related to the <code>Try</code> trait, but I'm sure opinions will differ.</p>



<a name="240980120"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/%60let%20pattern%20%3D%20expr%20else%20%7B%20...%20%7D%60%20statements/near/240980120" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> bstrie <a href="https://rust-lang.github.io/zulip_archive/stream/213817-t-lang/topic/.60let.20pattern.20.3D.20expr.20else.20.7B.20.2E.2E.2E.20.7D.60.20statements.html#240980120">(Jun 01 2021 at 17:58)</a>:</h4>
<p>the current status of the <code>try</code> keyword is so vague and confusing that it really ought to just be punted back to the RFC process, IMO. probably best to ignore that quagmire for now and mention it as an alternative</p>



<a name="240980931"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/%60let%20pattern%20%3D%20expr%20else%20%7B%20...%20%7D%60%20statements/near/240980931" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jeremiah Senkpiel <a href="https://rust-lang.github.io/zulip_archive/stream/213817-t-lang/topic/.60let.20pattern.20.3D.20expr.20else.20.7B.20.2E.2E.2E.20.7D.60.20statements.html#240980931">(Jun 01 2021 at 18:04)</a>:</h4>
<p>I'll note it as an alternative, but this RFC attempts to keep maximum consistency with existing language features first and foremost.</p>



<a name="240982340"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/%60let%20pattern%20%3D%20expr%20else%20%7B%20...%20%7D%60%20statements/near/240982340" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Scott Olson <a href="https://rust-lang.github.io/zulip_archive/stream/213817-t-lang/topic/.60let.20pattern.20.3D.20expr.20else.20.7B.20.2E.2E.2E.20.7D.60.20statements.html#240982340">(Jun 01 2021 at 18:14)</a>:</h4>
<p>I agree with that motivation for simply listing it as an alternative, but <code>try let</code> is <em>more</em> consistent with existing languages I'm familiar with.</p>



<a name="240982456"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/%60let%20pattern%20%3D%20expr%20else%20%7B%20...%20%7D%60%20statements/near/240982456" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jeremiah Senkpiel <a href="https://rust-lang.github.io/zulip_archive/stream/213817-t-lang/topic/.60let.20pattern.20.3D.20expr.20else.20.7B.20.2E.2E.2E.20.7D.60.20statements.html#240982456">(Jun 01 2021 at 18:15)</a>:</h4>
<p>(I meant <em>rust</em> language features that already exist.)</p>



<a name="240982533"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/%60let%20pattern%20%3D%20expr%20else%20%7B%20...%20%7D%60%20statements/near/240982533" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Scott Olson <a href="https://rust-lang.github.io/zulip_archive/stream/213817-t-lang/topic/.60let.20pattern.20.3D.20expr.20else.20.7B.20.2E.2E.2E.20.7D.60.20statements.html#240982533">(Jun 01 2021 at 18:15)</a>:</h4>
<p>Ah, well then I think it's very highly subjective. :P</p>



<a name="240986965"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/%60let%20pattern%20%3D%20expr%20else%20%7B%20...%20%7D%60%20statements/near/240986965" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> scottmcm <a href="https://rust-lang.github.io/zulip_archive/stream/213817-t-lang/topic/.60let.20pattern.20.3D.20expr.20else.20.7B.20.2E.2E.2E.20.7D.60.20statements.html#240986965">(Jun 01 2021 at 18:49)</a>:</h4>
<p>I still think <code>unless let Some(x) = x { continue }</code> is the <em>most</em> consistent, but I understand that people don't like that one :P</p>



<a name="240987603"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/%60let%20pattern%20%3D%20expr%20else%20%7B%20...%20%7D%60%20statements/near/240987603" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jeremiah Senkpiel <a href="https://rust-lang.github.io/zulip_archive/stream/213817-t-lang/topic/.60let.20pattern.20.3D.20expr.20else.20.7B.20.2E.2E.2E.20.7D.60.20statements.html#240987603">(Jun 01 2021 at 18:54)</a>:</h4>
<p><code>unless</code> isn't even an existing keyword though (which isn't necessarily a bad thing but isn't how I am aiming at this)</p>



<a name="240987759"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/%60let%20pattern%20%3D%20expr%20else%20%7B%20...%20%7D%60%20statements/near/240987759" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> scottmcm <a href="https://rust-lang.github.io/zulip_archive/stream/213817-t-lang/topic/.60let.20pattern.20.3D.20expr.20else.20.7B.20.2E.2E.2E.20.7D.60.20statements.html#240987759">(Jun 01 2021 at 18:55)</a>:</h4>
<p>Well, I suspect that it could be contextual in the <code>unless let</code> case, but yes, it certainly would need to a proper keyword for <code>unless x &gt; 0 { continue }</code> to also work.</p>



<a name="241062382"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/%60let%20pattern%20%3D%20expr%20else%20%7B%20...%20%7D%60%20statements/near/241062382" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> bstrie <a href="https://rust-lang.github.io/zulip_archive/stream/213817-t-lang/topic/.60let.20pattern.20.3D.20expr.20else.20.7B.20.2E.2E.2E.20.7D.60.20statements.html#241062382">(Jun 01 2021 at 19:21)</a>:</h4>
<p>rather than <code>unless let</code> I'll speculatively bikeshed for <code>if not let</code>, so that we can replace <code>!</code> with <code>not</code> and start reclaiming the sigils :P Python/C++-style <code>and</code> and <code>or</code>, here we come!</p>



<a name="241081102"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/%60let%20pattern%20%3D%20expr%20else%20%7B%20...%20%7D%60%20statements/near/241081102" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Frank Steffahn <a href="https://rust-lang.github.io/zulip_archive/stream/213817-t-lang/topic/.60let.20pattern.20.3D.20expr.20else.20.7B.20.2E.2E.2E.20.7D.60.20statements.html#241081102">(Jun 01 2021 at 21:58)</a>:</h4>
<p>How does this interact with <a href="https://rust-lang.github.io/rfcs/2497-if-let-chains.html"><code>if-let-chains</code></a>?</p>
<p>If you’re eventually able to write</p>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="k">if</span><span class="w"> </span><span class="kd">let</span><span class="w"> </span><span class="nb">Some</span><span class="p">(</span><span class="n">foo</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">expr</span><span class="p">()</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="n">foo</span><span class="p">.</span><span class="n">is_baz</span><span class="p">()</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="kd">let</span><span class="w"> </span><span class="nb">Ok</span><span class="p">(</span><span class="n">yay</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">qux</span><span class="p">(</span><span class="n">foo</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="o">..</span><span class="p">.</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="cm">/* else { ... } */</span><span class="w"></span>
</code></pre></div>
<p>then people will be confused if there is no way to do the same thing in a let-else statement (or whatever it’s going to be called).</p>
<p>You can’t allow</p>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="kd">let</span><span class="w"> </span><span class="nb">Some</span><span class="p">(</span><span class="n">foo</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">expr</span><span class="p">()</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="n">foo</span><span class="p">.</span><span class="n">is_baz</span><span class="p">()</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="kd">let</span><span class="w"> </span><span class="nb">Ok</span><span class="p">(</span><span class="n">yay</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">qux</span><span class="p">(</span><span class="n">foo</span><span class="p">)</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="o">..</span><span class="p">.</span><span class="w"> </span><span class="p">}</span><span class="w"></span>
</code></pre></div>
<p>because with ordinary <code>let</code>, the <code>&amp;&amp;</code> binds weaker, so this will (try to) be parsed</p>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="kd">let</span><span class="w"> </span><span class="nb">Some</span><span class="p">(</span><span class="n">foo</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="n">expr</span><span class="p">()</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="n">foo</span><span class="p">.</span><span class="n">is_baz</span><span class="p">()</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="kd">let</span><span class="w"> </span><span class="nb">Ok</span><span class="p">(</span><span class="n">yay</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">qux</span><span class="p">(</span><span class="n">foo</span><span class="p">)</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="o">..</span><span class="p">.</span><span class="w"> </span><span class="p">})</span><span class="w"></span>
</code></pre></div>
<p>Not 100% sure if this can’t be rectified at all, but it looks pretty bad. This would be another major advantage of <code>unless</code> (or <code>if not</code> or similar), which can “just” work</p>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="n">unless</span><span class="w"> </span><span class="kd">let</span><span class="w"> </span><span class="nb">Some</span><span class="p">(</span><span class="n">foo</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">expr</span><span class="p">()</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="n">foo</span><span class="p">.</span><span class="n">is_baz</span><span class="p">()</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="kd">let</span><span class="w"> </span><span class="nb">Ok</span><span class="p">(</span><span class="n">yay</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">qux</span><span class="p">(</span><span class="n">foo</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="o">..</span><span class="p">.</span><span class="w"> </span><span class="p">}</span><span class="w"></span>
</code></pre></div>



<a name="241081857"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/%60let%20pattern%20%3D%20expr%20else%20%7B%20...%20%7D%60%20statements/near/241081857" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Frank Steffahn <a href="https://rust-lang.github.io/zulip_archive/stream/213817-t-lang/topic/.60let.20pattern.20.3D.20expr.20else.20.7B.20.2E.2E.2E.20.7D.60.20statements.html#241081857">(Jun 01 2021 at 22:06)</a>:</h4>
<p>Doing these with <code>if !let …</code>, it could look like</p>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="k">if</span><span class="w"> </span><span class="o">!</span><span class="p">(</span><span class="kd">let</span><span class="w"> </span><span class="nb">Some</span><span class="p">(</span><span class="n">foo</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">expr</span><span class="p">()</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="n">foo</span><span class="p">.</span><span class="n">is_baz</span><span class="p">()</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="kd">let</span><span class="w"> </span><span class="nb">Ok</span><span class="p">(</span><span class="n">yay</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">qux</span><span class="p">(</span><span class="n">foo</span><span class="p">))</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="o">..</span><span class="p">.</span><span class="w"> </span><span class="p">}</span><span class="w"></span>
</code></pre></div>
<p>and/or</p>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="k">if</span><span class="w"> </span><span class="o">!</span><span class="kd">let</span><span class="w"> </span><span class="nb">Some</span><span class="p">(</span><span class="n">foo</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">expr</span><span class="p">()</span><span class="w"> </span><span class="o">||</span><span class="w"> </span><span class="n">foo</span><span class="p">.</span><span class="n">is_not_baz</span><span class="p">()</span><span class="w"> </span><span class="o">||</span><span class="w"> </span><span class="o">!</span><span class="kd">let</span><span class="w"> </span><span class="nb">Ok</span><span class="p">(</span><span class="n">yay</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">qux</span><span class="p">(</span><span class="n">foo</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="o">..</span><span class="p">.</span><span class="w"> </span><span class="p">}</span><span class="w"></span>
</code></pre></div>



<a name="241082018"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/%60let%20pattern%20%3D%20expr%20else%20%7B%20...%20%7D%60%20statements/near/241082018" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Thom Chiovoloni <a href="https://rust-lang.github.io/zulip_archive/stream/213817-t-lang/topic/.60let.20pattern.20.3D.20expr.20else.20.7B.20.2E.2E.2E.20.7D.60.20statements.html#241082018">(Jun 01 2021 at 22:08)</a>:</h4>
<p>a binding introduced that far to the right seems kind of hard to read to me</p>



<a name="241082077"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/%60let%20pattern%20%3D%20expr%20else%20%7B%20...%20%7D%60%20statements/near/241082077" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Frank Steffahn <a href="https://rust-lang.github.io/zulip_archive/stream/213817-t-lang/topic/.60let.20pattern.20.3D.20expr.20else.20.7B.20.2E.2E.2E.20.7D.60.20statements.html#241082077">(Jun 01 2021 at 22:09)</a>:</h4>
<p>That’s kind-of the case with ordinary let-chains as-well. Better formatting would probably put each condition of a long chain on a separate line.</p>



<a name="241082243"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/%60let%20pattern%20%3D%20expr%20else%20%7B%20...%20%7D%60%20statements/near/241082243" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Frank Steffahn <a href="https://rust-lang.github.io/zulip_archive/stream/213817-t-lang/topic/.60let.20pattern.20.3D.20expr.20else.20.7B.20.2E.2E.2E.20.7D.60.20statements.html#241082243">(Jun 01 2021 at 22:11)</a>:</h4>
<p>So roughly following the line-breaking and indentation of the let-chain RFC, it looks like</p>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="k">if</span><span class="w"> </span><span class="o">!</span><span class="kd">let</span><span class="w"> </span><span class="nb">Some</span><span class="p">(</span><span class="n">foo</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">expr</span><span class="p">()</span><span class="w"></span>
<span class="w">    </span><span class="o">||</span><span class="w"> </span><span class="n">foo</span><span class="p">.</span><span class="n">is_not_baz</span><span class="p">()</span><span class="w"></span>
<span class="w">    </span><span class="o">||</span><span class="w"> </span><span class="o">!</span><span class="kd">let</span><span class="w"> </span><span class="nb">Ok</span><span class="p">(</span><span class="n">yay</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">qux</span><span class="p">(</span><span class="n">foo</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="o">..</span><span class="p">.</span><span class="w"> </span><span class="p">}</span><span class="w"></span>
</code></pre></div>
<p>or</p>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="n">unless</span><span class="w"> </span><span class="kd">let</span><span class="w"> </span><span class="nb">Some</span><span class="p">(</span><span class="n">foo</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">expr</span><span class="p">()</span><span class="w"></span>
<span class="w">    </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="n">foo</span><span class="p">.</span><span class="n">is_not_baz</span><span class="p">()</span><span class="w"></span>
<span class="w">    </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="kd">let</span><span class="w"> </span><span class="nb">Ok</span><span class="p">(</span><span class="n">yay</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">qux</span><span class="p">(</span><span class="n">foo</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="o">..</span><span class="p">.</span><span class="w"> </span><span class="p">}</span><span class="w"></span>
</code></pre></div>



<a name="241082275"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/%60let%20pattern%20%3D%20expr%20else%20%7B%20...%20%7D%60%20statements/near/241082275" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Frank Steffahn <a href="https://rust-lang.github.io/zulip_archive/stream/213817-t-lang/topic/.60let.20pattern.20.3D.20expr.20else.20.7B.20.2E.2E.2E.20.7D.60.20statements.html#241082275">(Jun 01 2021 at 22:11)</a>:</h4>
<p>Haha, <code>unless</code> is precisely the right length to make all the <code>let</code>s align!</p>



<a name="241082400"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/%60let%20pattern%20%3D%20expr%20else%20%7B%20...%20%7D%60%20statements/near/241082400" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jeremiah Senkpiel <a href="https://rust-lang.github.io/zulip_archive/stream/213817-t-lang/topic/.60let.20pattern.20.3D.20expr.20else.20.7B.20.2E.2E.2E.20.7D.60.20statements.html#241082400">(Jun 01 2021 at 22:13)</a>:</h4>
<p>Good question, this has not been discussed before I think.</p>



<a name="241082415"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/%60let%20pattern%20%3D%20expr%20else%20%7B%20...%20%7D%60%20statements/near/241082415" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jeremiah Senkpiel <a href="https://rust-lang.github.io/zulip_archive/stream/213817-t-lang/topic/.60let.20pattern.20.3D.20expr.20else.20.7B.20.2E.2E.2E.20.7D.60.20statements.html#241082415">(Jun 01 2021 at 22:13)</a>:</h4>
<p>Are "ordinary let-chains" a thing which exists?</p>



<a name="241082667"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/%60let%20pattern%20%3D%20expr%20else%20%7B%20...%20%7D%60%20statements/near/241082667" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Frank Steffahn <a href="https://rust-lang.github.io/zulip_archive/stream/213817-t-lang/topic/.60let.20pattern.20.3D.20expr.20else.20.7B.20.2E.2E.2E.20.7D.60.20statements.html#241082667">(Jun 01 2021 at 22:16)</a>:</h4>
<p>They are a thing for which an accepted RFC exists, as linked above. Currently (AFAIK) they only exists in the parser in order “to make <code>if let PAT = EXPR &amp;&amp; ..</code> a possible option for Rust 2018”.</p>
<p>Well, that was 3 years ago, seems like someone overestimated the time it takes to implement. No need to “rush” it into edition 2018 in retrospect. (Of course I wasn’t involved, so I don’t actually know if there was any “rushing” involved).</p>



<a name="241082730"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/%60let%20pattern%20%3D%20expr%20else%20%7B%20...%20%7D%60%20statements/near/241082730" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> bstrie <a href="https://rust-lang.github.io/zulip_archive/stream/213817-t-lang/topic/.60let.20pattern.20.3D.20expr.20else.20.7B.20.2E.2E.2E.20.7D.60.20statements.html#241082730">(Jun 01 2021 at 22:17)</a>:</h4>
<p>I don't know if theoretical let-else-chaining really makes sense. The reason for if-let-chaining is to condense multiple conditions together and avoid rightward drift, but there's no rightward drift with let-else. If you want to put multiple new variables in scope, you can just do multiple let-elses.</p>



<a name="241082918"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/%60let%20pattern%20%3D%20expr%20else%20%7B%20...%20%7D%60%20statements/near/241082918" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jeremiah Senkpiel <a href="https://rust-lang.github.io/zulip_archive/stream/213817-t-lang/topic/.60let.20pattern.20.3D.20expr.20else.20.7B.20.2E.2E.2E.20.7D.60.20statements.html#241082918">(Jun 01 2021 at 22:20)</a>:</h4>
<p>I see an RFC for "if let chains", but not "let chains".</p>



<a name="241082974"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/%60let%20pattern%20%3D%20expr%20else%20%7B%20...%20%7D%60%20statements/near/241082974" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Frank Steffahn <a href="https://rust-lang.github.io/zulip_archive/stream/213817-t-lang/topic/.60let.20pattern.20.3D.20expr.20else.20.7B.20.2E.2E.2E.20.7D.60.20statements.html#241082974">(Jun 01 2021 at 22:20)</a>:</h4>
<p>Ah, I’m sorry, I abbreviated if-let-chains to let-chains to save a few letters of typing.</p>



<a name="241083002"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/%60let%20pattern%20%3D%20expr%20else%20%7B%20...%20%7D%60%20statements/near/241083002" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Frank Steffahn <a href="https://rust-lang.github.io/zulip_archive/stream/213817-t-lang/topic/.60let.20pattern.20.3D.20expr.20else.20.7B.20.2E.2E.2E.20.7D.60.20statements.html#241083002">(Jun 01 2021 at 22:21)</a>:</h4>
<p>They also cover <code>while let</code> chains, so if-let-chains is not 100% accurate terminology anyway</p>



<a name="241083023"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/%60let%20pattern%20%3D%20expr%20else%20%7B%20...%20%7D%60%20statements/near/241083023" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> bstrie <a href="https://rust-lang.github.io/zulip_archive/stream/213817-t-lang/topic/.60let.20pattern.20.3D.20expr.20else.20.7B.20.2E.2E.2E.20.7D.60.20statements.html#241083023">(Jun 01 2021 at 22:21)</a>:</h4>
<p>well, <code>while</code> is just a <code>loop-if</code> statement :P</p>



<a name="241083097"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/%60let%20pattern%20%3D%20expr%20else%20%7B%20...%20%7D%60%20statements/near/241083097" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jeremiah Senkpiel <a href="https://rust-lang.github.io/zulip_archive/stream/213817-t-lang/topic/.60let.20pattern.20.3D.20expr.20else.20.7B.20.2E.2E.2E.20.7D.60.20statements.html#241083097">(Jun 01 2021 at 22:22)</a>:</h4>
<p>So I think this would technically be possible to support with an edition change to how existing irrefutable patterns for <code>let</code> are parsed.</p>
<p>But also I don't see the value, as <span class="user-mention" data-user-id="256342">@bstrie</span> noted above. In common cases where you are making errors for these it is better to have unique error messages per failure case.</p>



<a name="241083129"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/%60let%20pattern%20%3D%20expr%20else%20%7B%20...%20%7D%60%20statements/near/241083129" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jeremiah Senkpiel <a href="https://rust-lang.github.io/zulip_archive/stream/213817-t-lang/topic/.60let.20pattern.20.3D.20expr.20else.20.7B.20.2E.2E.2E.20.7D.60.20statements.html#241083129">(Jun 01 2021 at 22:22)</a>:</h4>
<p>I will note something in future possibilities though, and maybe also open questions.</p>



<a name="241083168"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/%60let%20pattern%20%3D%20expr%20else%20%7B%20...%20%7D%60%20statements/near/241083168" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Frank Steffahn <a href="https://rust-lang.github.io/zulip_archive/stream/213817-t-lang/topic/.60let.20pattern.20.3D.20expr.20else.20.7B.20.2E.2E.2E.20.7D.60.20statements.html#241083168">(Jun 01 2021 at 22:23)</a>:</h4>
<p>Just saying, I’ll <em>guarantee</em> that people will ask for it once both if-let-chains and let-else are a thing in stable Rust.</p>



<a name="241083216"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/%60let%20pattern%20%3D%20expr%20else%20%7B%20...%20%7D%60%20statements/near/241083216" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Frank Steffahn <a href="https://rust-lang.github.io/zulip_archive/stream/213817-t-lang/topic/.60let.20pattern.20.3D.20expr.20else.20.7B.20.2E.2E.2E.20.7D.60.20statements.html#241083216">(Jun 01 2021 at 22:23)</a>:</h4>
<p>You can use them to avoid repetition of the same else block.</p>



<a name="241083525"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/%60let%20pattern%20%3D%20expr%20else%20%7B%20...%20%7D%60%20statements/near/241083525" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jeremiah Senkpiel <a href="https://rust-lang.github.io/zulip_archive/stream/213817-t-lang/topic/.60let.20pattern.20.3D.20expr.20else.20.7B.20.2E.2E.2E.20.7D.60.20statements.html#241083525">(Jun 01 2021 at 22:27)</a>:</h4>
<p><span class="user-mention silent" data-user-id="280891">Frank Steffahn</span> <a href="#narrow/stream/213817-t-lang/topic/.60let.20pattern.20.3D.20expr.20else.20.7B.20.2E.2E.2E.20.7D.60.20statements/near/241083216">said</a>:</p>
<blockquote>
<p>You can use them to avoid repetition of the same else block.</p>
</blockquote>
<p>Yes, but also in the case of <code>Result&lt;&gt;</code> this will almost certainly result in a worse program.</p>
<p>It seems acceptable for <code>Option</code> I suppose. Also, there are some cases where you want to chain in <code>if let</code> which do not include multiple <code>let</code> assignments (I forget off the top of my head if that exists already today). However, let-else is not an <code>if</code> expression in any other way either...</p>



<a name="241083648"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/%60let%20pattern%20%3D%20expr%20else%20%7B%20...%20%7D%60%20statements/near/241083648" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Frank Steffahn <a href="https://rust-lang.github.io/zulip_archive/stream/213817-t-lang/topic/.60let.20pattern.20.3D.20expr.20else.20.7B.20.2E.2E.2E.20.7D.60.20statements.html#241083648">(Jun 01 2021 at 22:28)</a>:</h4>
<p>Also, I personally consider (some form of) guards an essential part of (fallible) patterns. You can do a few fancy things without any guards like e.g. using range-patterns or slice patterns, but as soon as there’s a bit of complexity involved, you won’t want to miss your <code>PAT if GUARD =&gt; …</code> in <code>match</code> expressions or <code>matches!</code> macros. Admitted, <code>if let</code> doesn’t _directly_ support guards, the nicest way to do something like guards in <code>if let</code> or <code>while let</code> patterns is with a <code>&amp;&amp;</code>, as soon as if-let-chains are a thing (so <code>if let PAT = EXPR &amp;&amp; GUARD { ... }</code>). Before that (i.e. currently) you can make do with another nested <code>if</code> (so: <code>if let PAT = EXPR { if GUARD { ... } }</code>) for <code>if let</code> and you can use <code>break</code> for <code>while let</code> (i.e. <code>while let PAT = EXPR { if !GUARD { break; } ... }</code>).</p>



<a name="241083701"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/%60let%20pattern%20%3D%20expr%20else%20%7B%20...%20%7D%60%20statements/near/241083701" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jeremiah Senkpiel <a href="https://rust-lang.github.io/zulip_archive/stream/213817-t-lang/topic/.60let.20pattern.20.3D.20expr.20else.20.7B.20.2E.2E.2E.20.7D.60.20statements.html#241083701">(Jun 01 2021 at 22:28)</a>:</h4>
<p>That is to say, would the following make sense?</p>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="kd">let</span><span class="w"> </span><span class="nb">Some</span><span class="p">(</span><span class="n">x</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="n">b</span><span class="p">.</span><span class="n">thing</span><span class="p">()</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="k">return</span><span class="p">;</span><span class="w"> </span><span class="p">};</span><span class="w"></span>
</code></pre></div>



<a name="241083772"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/%60let%20pattern%20%3D%20expr%20else%20%7B%20...%20%7D%60%20statements/near/241083772" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jeremiah Senkpiel <a href="https://rust-lang.github.io/zulip_archive/stream/213817-t-lang/topic/.60let.20pattern.20.3D.20expr.20else.20.7B.20.2E.2E.2E.20.7D.60.20statements.html#241083772">(Jun 01 2021 at 22:29)</a>:</h4>
<p>Maybe <code>if let</code> <em>should</em> support guards?</p>



<a name="241083861"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/%60let%20pattern%20%3D%20expr%20else%20%7B%20...%20%7D%60%20statements/near/241083861" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Frank Steffahn <a href="https://rust-lang.github.io/zulip_archive/stream/213817-t-lang/topic/.60let.20pattern.20.3D.20expr.20else.20.7B.20.2E.2E.2E.20.7D.60.20statements.html#241083861">(Jun 01 2021 at 22:30)</a>:</h4>
<p>If you know a reasonably syntax for guards in <code>if let</code> ;-)</p>
<p>I think the <code>&amp;&amp; GUARD</code> option from if-let-chains is pretty nice already.</p>



<a name="241083951"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/%60let%20pattern%20%3D%20expr%20else%20%7B%20...%20%7D%60%20statements/near/241083951" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Frank Steffahn <a href="https://rust-lang.github.io/zulip_archive/stream/213817-t-lang/topic/.60let.20pattern.20.3D.20expr.20else.20.7B.20.2E.2E.2E.20.7D.60.20statements.html#241083951">(Jun 01 2021 at 22:31)</a>:</h4>
<p><span class="user-mention silent" data-user-id="319552">Jeremiah Senkpiel</span> <a href="#narrow/stream/213817-t-lang/topic/.60let.20pattern.20.3D.20expr.20else.20.7B.20.2E.2E.2E.20.7D.60.20statements/near/241083701">said</a>:</p>
<blockquote>
<p>That is to say, would the following make sense?</p>
<p><div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="kd">let</span><span class="w"> </span><span class="nb">Some</span><span class="p">(</span><span class="n">x</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="n">b</span><span class="p">.</span><span class="n">thing</span><span class="p">()</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="k">return</span><span class="p">;</span><span class="w"> </span><span class="p">};</span><span class="w"></span>
</code></pre></div><br>
</p>
</blockquote>
<p>Yes, basically. Except for the fact that the <code>&amp;&amp;</code> binding weaker than <code>let</code> still feels weird. And that a single <code>return;</code> is such a simple block that it probably wouldn’t hurt anyone if they needed to repeat it.</p>



<a name="241084003"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/%60let%20pattern%20%3D%20expr%20else%20%7B%20...%20%7D%60%20statements/near/241084003" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jeremiah Senkpiel <a href="https://rust-lang.github.io/zulip_archive/stream/213817-t-lang/topic/.60let.20pattern.20.3D.20expr.20else.20.7B.20.2E.2E.2E.20.7D.60.20statements.html#241084003">(Jun 01 2021 at 22:32)</a>:</h4>
<p><code>&amp;&amp; GUARD</code> is weird because <code>let PATTERN = EXPR</code> isn't otherwise an expression, and doesn't evaluate to anything, so the operator order is pretty funky, but I guess it is what it is ...</p>



<a name="241084546"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/%60let%20pattern%20%3D%20expr%20else%20%7B%20...%20%7D%60%20statements/near/241084546" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Frank Steffahn <a href="https://rust-lang.github.io/zulip_archive/stream/213817-t-lang/topic/.60let.20pattern.20.3D.20expr.20else.20.7B.20.2E.2E.2E.20.7D.60.20statements.html#241084546">(Jun 01 2021 at 22:39)</a>:</h4>
<p>Anyways, I haven’t thought through this all that much so far, I just had the idea that if-let-chains could be relevant to this discussion when discovering this thread today. I guess it’s at the very least worth a mention as a thing to consider / an alternative option / a future possibility / whatever in the RFC. Some more practical code examples (which I don’t currently have) wouldn’t hurt either before discussing this in too much more detail, especially to aid answering the question if this would be all that useful.</p>



<a name="241084552"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/%60let%20pattern%20%3D%20expr%20else%20%7B%20...%20%7D%60%20statements/near/241084552" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> bstrie <a href="https://rust-lang.github.io/zulip_archive/stream/213817-t-lang/topic/.60let.20pattern.20.3D.20expr.20else.20.7B.20.2E.2E.2E.20.7D.60.20statements.html#241084552">(Jun 01 2021 at 22:39)</a>:</h4>
<p>I'm having a hard time thinking of a circumstance where a let-else chain would be useful. An if-let chain is useful because you're steadily refining the data: you have an Option, now you have a Some, now you have a struct, is the struct field equal to something, and so on. But the conditions in a let-else chain would exist in the <em>absence</em> of any new data to refine, yes? It feels like you'd be saying "diverge when this one thing false, but only if this other, completely unrelated thing is also false", which doesn't feel especially common.</p>



<a name="241085369"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/%60let%20pattern%20%3D%20expr%20else%20%7B%20...%20%7D%60%20statements/near/241085369" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jeremiah Senkpiel <a href="https://rust-lang.github.io/zulip_archive/stream/213817-t-lang/topic/.60let.20pattern.20.3D.20expr.20else.20.7B.20.2E.2E.2E.20.7D.60.20statements.html#241085369">(Jun 01 2021 at 22:49)</a>:</h4>
<p>Most of the rust code I've written is on the level of <code>Result</code>s and not <code>Option</code>s, code at work that would fit into this general sort of pattern never would anyways because we always want to have distinguishable error messages when possible.</p>



<a name="241085448"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/%60let%20pattern%20%3D%20expr%20else%20%7B%20...%20%7D%60%20statements/near/241085448" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jeremiah Senkpiel <a href="https://rust-lang.github.io/zulip_archive/stream/213817-t-lang/topic/.60let.20pattern.20.3D.20expr.20else.20.7B.20.2E.2E.2E.20.7D.60.20statements.html#241085448">(Jun 01 2021 at 22:50)</a>:</h4>
<p>That is to say, to me, if-let-chain is an antipattern <strong>except</strong> with <code>Option</code>, and I'd rather suggest against it entirely.</p>



<a name="241086220"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/%60let%20pattern%20%3D%20expr%20else%20%7B%20...%20%7D%60%20statements/near/241086220" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Frank Steffahn <a href="https://rust-lang.github.io/zulip_archive/stream/213817-t-lang/topic/.60let.20pattern.20.3D.20expr.20else.20.7B.20.2E.2E.2E.20.7D.60.20statements.html#241086220">(Jun 01 2021 at 22:58)</a>:</h4>
<p>Another point would probably be refactoring.<br>
Suppose you start with</p>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="k">if</span><span class="w"> </span><span class="kd">let</span><span class="w"> </span><span class="nb">Some</span><span class="p">(</span><span class="n">x</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">foo</span><span class="p">()</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="n">x</span><span class="p">.</span><span class="n">bar</span><span class="p">()</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="c1">// LOTS OF CODE HERE</span>
<span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="c1">// A BIT OF CODE, ALWAYS DIVERGING</span>
<span class="p">}</span><span class="w"></span>
</code></pre></div>
<p>then you could always remove the depth of indentation of <code>LOTS OF CODE</code> by refactoring into</p>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="n">unless</span><span class="w"> </span><span class="kd">let</span><span class="w"> </span><span class="nb">Some</span><span class="p">(</span><span class="n">x</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">foo</span><span class="p">()</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="n">x</span><span class="p">.</span><span class="n">bar</span><span class="p">()</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="c1">// A BIT OF CODE, ALWAYS DIVERGING</span>
<span class="p">}</span><span class="w"></span>
<span class="c1">// LOTS OF CODE HERE</span>
</code></pre></div>
<p>Prohibiting unless-let-chains in the presence of a stable language feature for if-let-chains makes refactoring harder</p>
<p>(The above argument of course assumes that if-let-chains are going to become a thing at all.)</p>
<hr>
<p>but my main point is just on the general usefulness of guards.</p>
<p>I can do </p>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="k">match</span><span class="w"> </span><span class="n">EXPR</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nb">Some</span><span class="p">(</span><span class="n">x</span><span class="o">@</span><span class="p">(</span><span class="mi">1</span><span class="o">..=</span><span class="mi">10</span><span class="p">))</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="o">....</span><span class="w"> </span><span class="p">}</span><span class="w"></span>
</code></pre></div>
<p>but</p>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="k">match</span><span class="w"> </span><span class="n">EXPR</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nb">Some</span><span class="p">(</span><span class="n">x</span><span class="p">)</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="o">&lt;=</span><span class="w"> </span><span class="n">x</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="n">x</span><span class="w"> </span><span class="o">&lt;=</span><span class="w"> </span><span class="mi">10</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="o">....</span><span class="w"> </span><span class="p">}</span><span class="w"></span>
</code></pre></div>
<p>is also possible. Similarly</p>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="k">if</span><span class="w"> </span><span class="kd">let</span><span class="w"> </span><span class="nb">Some</span><span class="p">(</span><span class="n">x</span><span class="o">@</span><span class="p">(</span><span class="mi">1</span><span class="o">..=</span><span class="mi">10</span><span class="p">))</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">EXPR</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="o">....</span><span class="w"> </span><span class="p">}</span><span class="w"></span>
</code></pre></div>
<p>and</p>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="k">if</span><span class="w"> </span><span class="kd">let</span><span class="w"> </span><span class="nb">Some</span><span class="p">(</span><span class="n">x</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">EXPR</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="o">&lt;=</span><span class="w"> </span><span class="n">x</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="n">x</span><span class="w"> </span><span class="o">&lt;=</span><span class="w"> </span><span class="mi">10</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="o">....</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="p">}</span><span class="w"></span>
</code></pre></div>
<p>and eventually</p>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="k">if</span><span class="w"> </span><span class="kd">let</span><span class="w"> </span><span class="nb">Some</span><span class="p">(</span><span class="n">x</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">EXPR</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="o">&lt;=</span><span class="w"> </span><span class="n">x</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="n">x</span><span class="w"> </span><span class="o">&lt;=</span><span class="w"> </span><span class="mi">10</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="o">....</span><span class="w"> </span><span class="p">}</span><span class="w"></span>
</code></pre></div>
<p>will work.</p>
<p>But while</p>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="kd">let</span><span class="w"> </span><span class="nb">Some</span><span class="p">(</span><span class="n">x</span><span class="o">@</span><span class="p">(</span><span class="mi">1</span><span class="o">..=</span><span class="mi">10</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">EXPR</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="o">....</span><span class="w"> </span><span class="p">}</span><span class="w"></span>
<span class="o">....</span><span class="w"></span>
</code></pre></div>
<p>can be used, there’s no alternative way using a guard except for</p>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="kd">let</span><span class="w"> </span><span class="nb">Some</span><span class="p">(</span><span class="n">x</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">EXPR</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="o">....</span><span class="w"> </span><span class="p">}</span><span class="w"></span>
<span class="k">if</span><span class="w"> </span><span class="o">!</span><span class="p">(</span><span class="mi">1</span><span class="w"> </span><span class="o">&lt;=</span><span class="w"> </span><span class="n">x</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="n">x</span><span class="w"> </span><span class="o">&lt;=</span><span class="w"> </span><span class="mi">10</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="cm">/* duplicate the code */</span><span class="w"> </span><span class="o">....</span><span class="w"> </span><span class="p">}</span><span class="w"></span>
<span class="o">....</span><span class="w"></span>
</code></pre></div>
<p>(The main point of guards then, as mentioned, are cases where there is <em>no</em> magical compiler-provided alternative like range patterns.)</p>



<a name="241087349"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/%60let%20pattern%20%3D%20expr%20else%20%7B%20...%20%7D%60%20statements/near/241087349" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> bstrie <a href="https://rust-lang.github.io/zulip_archive/stream/213817-t-lang/topic/.60let.20pattern.20.3D.20expr.20else.20.7B.20.2E.2E.2E.20.7D.60.20statements.html#241087349">(Jun 01 2021 at 23:12)</a>:</h4>
<p>ah ok, I see the semantics that you're going for now</p>



<a name="241087494"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/%60let%20pattern%20%3D%20expr%20else%20%7B%20...%20%7D%60%20statements/near/241087494" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> bstrie <a href="https://rust-lang.github.io/zulip_archive/stream/213817-t-lang/topic/.60let.20pattern.20.3D.20expr.20else.20.7B.20.2E.2E.2E.20.7D.60.20statements.html#241087494">(Jun 01 2021 at 23:15)</a>:</h4>
<p>if we want this to be the perfect inverse of <code>if-let</code> even taking chaining into account, then I resubmit <code>if not let</code> with 25% less facetiousness</p>



<a name="241088669"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/%60let%20pattern%20%3D%20expr%20else%20%7B%20...%20%7D%60%20statements/near/241088669" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jeremiah Senkpiel <a href="https://rust-lang.github.io/zulip_archive/stream/213817-t-lang/topic/.60let.20pattern.20.3D.20expr.20else.20.7B.20.2E.2E.2E.20.7D.60.20statements.html#241088669">(Jun 01 2021 at 23:31)</a>:</h4>
<p><span class="user-mention silent" data-user-id="280891">Frank Steffahn</span> <a href="#narrow/stream/213817-t-lang/topic/.60let.20pattern.20.3D.20expr.20else.20.7B.20.2E.2E.2E.20.7D.60.20statements/near/241081102">said</a>:</p>
<blockquote>
<p>You can’t allow</p>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="kd">let</span><span class="w"> </span><span class="nb">Some</span><span class="p">(</span><span class="n">foo</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">expr</span><span class="p">()</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="n">foo</span><span class="p">.</span><span class="n">is_baz</span><span class="p">()</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="kd">let</span><span class="w"> </span><span class="nb">Ok</span><span class="p">(</span><span class="n">yay</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">qux</span><span class="p">(</span><span class="n">foo</span><span class="p">)</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="o">..</span><span class="p">.</span><span class="w"> </span><span class="p">}</span><span class="w"></span>
</code></pre></div>
<p>because with ordinary <code>let</code>, the <code>&amp;&amp;</code> binds weaker, so this will (try to) be parsed</p>
<p><div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="kd">let</span><span class="w"> </span><span class="nb">Some</span><span class="p">(</span><span class="n">foo</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="n">expr</span><span class="p">()</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="n">foo</span><span class="p">.</span><span class="n">is_baz</span><span class="p">()</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="kd">let</span><span class="w"> </span><span class="nb">Ok</span><span class="p">(</span><span class="n">yay</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">qux</span><span class="p">(</span><span class="n">foo</span><span class="p">)</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="o">..</span><span class="p">.</span><span class="w"> </span><span class="p">})</span><span class="w"></span>
</code></pre></div><br>
</p>
</blockquote>
<p>If we suggest that pattern-matching <code>let</code> statements be changed to have an operator precedence which matches if-let-chain in an edition, that seems like it can be overcome without too much trouble.</p>
<p>We can suggest the following would be possible for 2018 edition:</p>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="kd">let</span><span class="w"> </span><span class="p">(</span><span class="nb">Some</span><span class="p">(</span><span class="n">foo</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">expr</span><span class="p">())</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="n">foo</span><span class="p">.</span><span class="n">is_baz</span><span class="p">()</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="p">(</span><span class="kd">let</span><span class="w"> </span><span class="nb">Ok</span><span class="p">(</span><span class="n">yay</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">qux</span><span class="p">(</span><span class="n">foo</span><span class="p">))</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="o">..</span><span class="p">.</span><span class="w"> </span><span class="p">};</span><span class="w"></span>
</code></pre></div>



<a name="241088742"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/%60let%20pattern%20%3D%20expr%20else%20%7B%20...%20%7D%60%20statements/near/241088742" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jeremiah Senkpiel <a href="https://rust-lang.github.io/zulip_archive/stream/213817-t-lang/topic/.60let.20pattern.20.3D.20expr.20else.20.7B.20.2E.2E.2E.20.7D.60.20statements.html#241088742">(Jun 01 2021 at 23:32)</a>:</h4>
<p>Note that if-let-chain also required edition changes</p>



<a name="241094248"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/%60let%20pattern%20%3D%20expr%20else%20%7B%20...%20%7D%60%20statements/near/241094248" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Mario Carneiro <a href="https://rust-lang.github.io/zulip_archive/stream/213817-t-lang/topic/.60let.20pattern.20.3D.20expr.20else.20.7B.20.2E.2E.2E.20.7D.60.20statements.html#241094248">(Jun 02 2021 at 00:53)</a>:</h4>
<p>It's a bit odd that only the first <code>let</code> is not in parentheses there</p>



<a name="241095041"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/%60let%20pattern%20%3D%20expr%20else%20%7B%20...%20%7D%60%20statements/near/241095041" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jeremiah Senkpiel <a href="https://rust-lang.github.io/zulip_archive/stream/213817-t-lang/topic/.60let.20pattern.20.3D.20expr.20else.20.7B.20.2E.2E.2E.20.7D.60.20statements.html#241095041">(Jun 02 2021 at 01:06)</a>:</h4>
<p>Oh, good catch. Hrm. Yeah.</p>



<a name="241095416"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/%60let%20pattern%20%3D%20expr%20else%20%7B%20...%20%7D%60%20statements/near/241095416" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jeremiah Senkpiel <a href="https://rust-lang.github.io/zulip_archive/stream/213817-t-lang/topic/.60let.20pattern.20.3D.20expr.20else.20.7B.20.2E.2E.2E.20.7D.60.20statements.html#241095416">(Jun 02 2021 at 01:12)</a>:</h4>
<p>Ok so thinking about this if-let-chaining problem more, I don't think it is actually an issue, because all existing possibilities of this are errors aside from a single case which would be added in this RFC and therefore could be avoided.</p>
<p>Consider the following:</p>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="kd">let</span><span class="w"> </span><span class="n">maybe</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">Some</span><span class="p">(</span><span class="mi">2</span><span class="p">);</span><span class="w"></span>
<span class="kd">let</span><span class="w"> </span><span class="n">has_thing</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">true</span><span class="p">;</span><span class="w"></span>

<span class="kd">let</span><span class="w"> </span><span class="nb">Some</span><span class="p">(</span><span class="n">x</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">maybe</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="n">has_thing</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="k">return</span><span class="p">;</span><span class="w"></span>
<span class="p">};</span><span class="w"></span>
</code></pre></div>
<p>This will always be an error regardless, because <code>&amp;&amp;</code> only operates on booleans.</p>
<p>But, you say, you can pattern-match booleans! This is true:</p>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="kd">let</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">false</span><span class="p">;</span><span class="w"></span>
<span class="kd">let</span><span class="w"> </span><span class="n">b</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">false</span><span class="p">;</span><span class="w"></span>

<span class="kd">let</span><span class="w"> </span><span class="kc">true</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="n">b</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="k">return</span><span class="p">;</span><span class="w"></span>
<span class="p">};</span><span class="w"></span>
</code></pre></div>
<p>But this is  certainly not useful: You've re-invented a worse <code>if</code>.<br>
It may also be an error anyways because there is no actual assignment happening.</p>
<p>Also, this doesn't work today either, in ways which probably leave the door open for us:</p>
<div class="codehilite"><pre><span></span><code>error[E0005]: refutable pattern in local binding: `false` not covered
 --&gt; src/main.rs:5:9
  |
5 |     let true = a &amp;&amp; b;
  |         ^^^^ pattern `false` not covered
  |
  = note: `let` bindings require an &quot;irrefutable pattern&quot;, like a `struct` or an `enum` with only one variant
</code></pre></div>



<a name="241095527"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/%60let%20pattern%20%3D%20expr%20else%20%7B%20...%20%7D%60%20statements/near/241095527" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jeremiah Senkpiel <a href="https://rust-lang.github.io/zulip_archive/stream/213817-t-lang/topic/.60let.20pattern.20.3D.20expr.20else.20.7B.20.2E.2E.2E.20.7D.60.20statements.html#241095527">(Jun 02 2021 at 01:14)</a>:</h4>
<p>Unless I'm missing something compiler-level, it seems fair to just reject <code>let true = a &amp;&amp; b else { }</code> due to ambiguity, and  leave the door open for if-let-chaining style <code>&amp;&amp;</code> chaining.</p>



<a name="241297349"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/%60let%20pattern%20%3D%20expr%20else%20%7B%20...%20%7D%60%20statements/near/241297349" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jeremiah Senkpiel <a href="https://rust-lang.github.io/zulip_archive/stream/213817-t-lang/topic/.60let.20pattern.20.3D.20expr.20else.20.7B.20.2E.2E.2E.20.7D.60.20statements.html#241297349">(Jun 02 2021 at 18:11)</a>:</h4>
<p>Updated RFC draft (including if-let-else, a practical refactor, etc): <a href="https://github.com/Fishrock123/rfcs/blob/let-else/text/0000-let-else.md">https://github.com/Fishrock123/rfcs/blob/let-else/text/0000-let-else.md</a></p>
<p>I'm hoping to be able to PR this tomorrow (maybe)?</p>



<a name="241311839"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/%60let%20pattern%20%3D%20expr%20else%20%7B%20...%20%7D%60%20statements/near/241311839" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Triplett <a href="https://rust-lang.github.io/zulip_archive/stream/213817-t-lang/topic/.60let.20pattern.20.3D.20expr.20else.20.7B.20.2E.2E.2E.20.7D.60.20statements.html#241311839">(Jun 02 2021 at 20:01)</a>:</h4>
<p><span class="user-mention" data-user-id="319552">@Jeremiah Senkpiel</span> I think it would be helpful if the reference-level explanation gave an <em>exact</em> desugaring, rather than just alluding to if let or match.</p>



<a name="241311976"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/%60let%20pattern%20%3D%20expr%20else%20%7B%20...%20%7D%60%20statements/near/241311976" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Triplett <a href="https://rust-lang.github.io/zulip_archive/stream/213817-t-lang/topic/.60let.20pattern.20.3D.20expr.20else.20.7B.20.2E.2E.2E.20.7D.60.20statements.html#241311976">(Jun 02 2021 at 20:02)</a>:</h4>
<p>(You can still use pseudo-syntax to handle <code>(all, the, bindings)</code> of a pattern.)</p>



<a name="241312146"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/%60let%20pattern%20%3D%20expr%20else%20%7B%20...%20%7D%60%20statements/near/241312146" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Triplett <a href="https://rust-lang.github.io/zulip_archive/stream/213817-t-lang/topic/.60let.20pattern.20.3D.20expr.20else.20.7B.20.2E.2E.2E.20.7D.60.20statements.html#241312146">(Jun 02 2021 at 20:03)</a>:</h4>
<p>But it'd be nice to have something like this:</p>
<div class="codehilite" data-code-language="Markdown"><pre><span></span><code><span class="sb">`let pattern = expr else { diverging_expr }`</span> desugars to <span class="sb">`let (each, binding) = match expr { pattern =&gt; (each, binding), _ =&gt; { diverging_expr } };`</span>
</code></pre></div>



<a name="241316566"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/%60let%20pattern%20%3D%20expr%20else%20%7B%20...%20%7D%60%20statements/near/241316566" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jeremiah Senkpiel <a href="https://rust-lang.github.io/zulip_archive/stream/213817-t-lang/topic/.60let.20pattern.20.3D.20expr.20else.20.7B.20.2E.2E.2E.20.7D.60.20statements.html#241316566">(Jun 02 2021 at 20:39)</a>:</h4>
<p>Ok, added that (a bit more formatted).</p>



<a name="241318637"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/%60let%20pattern%20%3D%20expr%20else%20%7B%20...%20%7D%60%20statements/near/241318637" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Frank Steffahn <a href="https://rust-lang.github.io/zulip_archive/stream/213817-t-lang/topic/.60let.20pattern.20.3D.20expr.20else.20.7B.20.2E.2E.2E.20.7D.60.20statements.html#241318637">(Jun 02 2021 at 20:55)</a>:</h4>
<blockquote>
<p><div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="c1">// The RFC proposes boolean matches like this be either:</span>
<span class="c1">// - Made into a compile error, or</span>
<span class="c1">// - Made to be parsed like if-let-chains: `(true = a) &amp;&amp; b`</span>
<span class="kd">let</span><span class="w"> </span><span class="kc">true</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="n">b</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="k">return</span><span class="p">;</span><span class="w"></span>
<span class="p">};</span><span class="w"></span>
</code></pre></div><br>
</p>
</blockquote>
<p>AFAIK, let chains like</p>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="k">if</span><span class="w"> </span><span class="kd">let</span><span class="w"> </span><span class="kc">true</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="n">b</span><span class="w"> </span><span class="p">{}</span><span class="w"></span>
</code></pre></div>
<p>parse as</p>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="kd">let</span><span class="w"> </span><span class="kc">true</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">a</span><span class="p">)</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="n">b</span><span class="w"> </span><span class="p">{}</span><span class="w"></span>
</code></pre></div>
<p>and <em>not</em> as</p>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="k">if</span><span class="w"> </span><span class="kd">let</span><span class="w"> </span><span class="p">(</span><span class="kc">true</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">a</span><span class="p">)</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="n">b</span><span class="w"> </span><span class="p">{}</span><span class="w"></span>
</code></pre></div>



<a name="241319068"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/%60let%20pattern%20%3D%20expr%20else%20%7B%20...%20%7D%60%20statements/near/241319068" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Frank Steffahn <a href="https://rust-lang.github.io/zulip_archive/stream/213817-t-lang/topic/.60let.20pattern.20.3D.20expr.20else.20.7B.20.2E.2E.2E.20.7D.60.20statements.html#241319068">(Jun 02 2021 at 20:59)</a>:</h4>
<p>As demonstrated by</p>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="k">fn</span> <span class="nf">f</span><span class="p">()</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="kd">let</span><span class="w"> </span><span class="kc">true</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">true</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="kc">true</span><span class="w"> </span><span class="p">{}</span><span class="w"> </span><span class="c1">// --&gt; `let` expressions in this position are experimental</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="kd">let</span><span class="w"> </span><span class="kc">true</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">true</span><span class="p">)</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="kc">true</span><span class="w"> </span><span class="p">{}</span><span class="w"> </span><span class="c1">// --&gt; `let` expressions in this position are experimental</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="kd">let</span><span class="w"> </span><span class="p">(</span><span class="kc">true</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">true</span><span class="p">)</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="kc">true</span><span class="w"> </span><span class="p">{}</span><span class="w"> </span><span class="c1">// -&gt; error: expected one of `)`, `,`, `...`, `..=`, `..`, or `|`, found `=`</span>
<span class="p">}</span><span class="w"></span>
</code></pre></div>



<a name="241320147"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/%60let%20pattern%20%3D%20expr%20else%20%7B%20...%20%7D%60%20statements/near/241320147" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jeremiah Senkpiel <a href="https://rust-lang.github.io/zulip_archive/stream/213817-t-lang/topic/.60let.20pattern.20.3D.20expr.20else.20.7B.20.2E.2E.2E.20.7D.60.20statements.html#241320147">(Jun 02 2021 at 21:08)</a>:</h4>
<p>Oh, second time I've made that mistake huh.</p>
<p>Hmm, what would be the equivalent? Is <code>(let true = a) &amp;&amp; b</code> a problem?</p>



<a name="241320228"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/%60let%20pattern%20%3D%20expr%20else%20%7B%20...%20%7D%60%20statements/near/241320228" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jeremiah Senkpiel <a href="https://rust-lang.github.io/zulip_archive/stream/213817-t-lang/topic/.60let.20pattern.20.3D.20expr.20else.20.7B.20.2E.2E.2E.20.7D.60.20statements.html#241320228">(Jun 02 2021 at 21:09)</a>:</h4>
<p>You might not be able to write it manually, but does that matter to internals?</p>



<a name="241346955"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/%60let%20pattern%20%3D%20expr%20else%20%7B%20...%20%7D%60%20statements/near/241346955" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Mario Carneiro <a href="https://rust-lang.github.io/zulip_archive/stream/213817-t-lang/topic/.60let.20pattern.20.3D.20expr.20else.20.7B.20.2E.2E.2E.20.7D.60.20statements.html#241346955">(Jun 03 2021 at 04:18)</a>:</h4>
<blockquote>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="kd">let</span><span class="w"> </span><span class="n">subpage_layer_info</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">match</span><span class="w"> </span><span class="n">layer_properties</span><span class="p">.</span><span class="n">subpage_layer_info</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="nb">Some</span><span class="p">(</span><span class="k">ref</span><span class="w"> </span><span class="n">subpage_layer_info</span><span class="p">)</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="o">*</span><span class="n">subpage_layer_info</span><span class="p">,</span><span class="w"></span>
<span class="w">    </span><span class="nb">None</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="k">return</span><span class="p">,</span><span class="w"></span>
<span class="p">};</span><span class="w"></span>
</code></pre></div>
<p>is equivalent to this much simpler let-else statement:</p>
<p><div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="kd">let</span><span class="w"> </span><span class="nb">Some</span><span class="p">(</span><span class="k">ref</span><span class="w"> </span><span class="n">subpage_layer_info</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">layer_properties</span><span class="p">.</span><span class="n">subpage_layer_info</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="k">return</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>
</code></pre></div><br>
</p>
</blockquote>
<p>There is an extra dereference in the first code block, so I think this isn't true. I don't know what the types are but it seems like the field should be copy, so that you could write <code>let Some(subpage_layer_info) = layer_properties.subpage_layer_info ...</code> instead</p>



<a name="241347164"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/%60let%20pattern%20%3D%20expr%20else%20%7B%20...%20%7D%60%20statements/near/241347164" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Mario Carneiro <a href="https://rust-lang.github.io/zulip_archive/stream/213817-t-lang/topic/.60let.20pattern.20.3D.20expr.20else.20.7B.20.2E.2E.2E.20.7D.60.20statements.html#241347164">(Jun 03 2021 at 04:24)</a>:</h4>
<p>Rather than saying "this block must diverge", it might be more understandable to say that the type of the expression in the block is <code>!</code>, so it must early exit using <code>return</code>, <code>continue</code> or similar (unless you had a value of type <code>!</code> lying around, I suppose, in which case what are you doing with your life)</p>



<a name="241349581"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/%60let%20pattern%20%3D%20expr%20else%20%7B%20...%20%7D%60%20statements/near/241349581" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Triplett <a href="https://rust-lang.github.io/zulip_archive/stream/213817-t-lang/topic/.60let.20pattern.20.3D.20expr.20else.20.7B.20.2E.2E.2E.20.7D.60.20statements.html#241349581">(Jun 03 2021 at 05:20)</a>:</h4>
<p>It could panic, for instance.</p>



<a name="241349590"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/%60let%20pattern%20%3D%20expr%20else%20%7B%20...%20%7D%60%20statements/near/241349590" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Triplett <a href="https://rust-lang.github.io/zulip_archive/stream/213817-t-lang/topic/.60let.20pattern.20.3D.20expr.20else.20.7B.20.2E.2E.2E.20.7D.60.20statements.html#241349590">(Jun 03 2021 at 05:21)</a>:</h4>
<p>Or exit the process, or similar.</p>



<a name="241359553"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/%60let%20pattern%20%3D%20expr%20else%20%7B%20...%20%7D%60%20statements/near/241359553" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> scottmcm <a href="https://rust-lang.github.io/zulip_archive/stream/213817-t-lang/topic/.60let.20pattern.20.3D.20expr.20else.20.7B.20.2E.2E.2E.20.7D.60.20statements.html#241359553">(Jun 03 2021 at 08:06)</a>:</h4>
<p>Could also say that its result is uninhabited, to avoid the <code>!</code> mention.</p>
<p>So you get something like <code>let Some(x) = opt else BLOCK;</code> → </p>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="kd">let</span><span class="w"> </span><span class="n">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">match</span><span class="w"> </span><span class="n">opt</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="nb">Some</span><span class="p">(</span><span class="n">x</span><span class="p">)</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="n">x</span><span class="p">,</span><span class="w"></span>
<span class="w">    </span><span class="n">_</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="k">match</span><span class="w"> </span><span class="p">(</span><span class="n">BLOCK</span><span class="p">)</span><span class="w"> </span><span class="p">{}</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>
</code></pre></div>
<p>to leverage existing "things that don't need arms in <code>match</code>" understanding.</p>



<a name="241360146"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/%60let%20pattern%20%3D%20expr%20else%20%7B%20...%20%7D%60%20statements/near/241360146" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Mario Carneiro <a href="https://rust-lang.github.io/zulip_archive/stream/213817-t-lang/topic/.60let.20pattern.20.3D.20expr.20else.20.7B.20.2E.2E.2E.20.7D.60.20statements.html#241360146">(Jun 03 2021 at 08:14)</a>:</h4>
<p>We don't need to hide from <code>!</code>, right? It already exists on stable in functions <code>fn foo() -&gt; ! { &lt;what type is expected here?&gt; }</code></p>



<a name="241360396"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/%60let%20pattern%20%3D%20expr%20else%20%7B%20...%20%7D%60%20statements/near/241360396" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Mario Carneiro <a href="https://rust-lang.github.io/zulip_archive/stream/213817-t-lang/topic/.60let.20pattern.20.3D.20expr.20else.20.7B.20.2E.2E.2E.20.7D.60.20statements.html#241360396">(Jun 03 2021 at 08:16)</a>:</h4>
<p>In fact, you can even get types with <code>!</code> in other positions on stable, although they are unnameable:</p>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="k">fn</span> <span class="nf">foo</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;</span><span class="p">(</span><span class="n">f</span>: <span class="nc">impl</span><span class="w"> </span><span class="nb">Fn</span><span class="p">(</span><span class="nb">Result</span><span class="o">&lt;</span><span class="n">T</span><span class="p">,</span><span class="w"> </span><span class="p">()</span><span class="o">&gt;</span><span class="p">))</span><span class="w"> </span>-&gt; <span class="nc">T</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">f</span><span class="p">(</span><span class="nb">Err</span><span class="p">(()));</span><span class="w"> </span><span class="k">loop</span><span class="w"> </span><span class="p">{}</span><span class="w"> </span><span class="p">}</span><span class="w"></span>

<span class="k">fn</span> <span class="nf">bar</span><span class="p">()</span><span class="w"> </span>-&gt; <span class="o">!</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="n">foo</span><span class="p">(</span><span class="o">|</span><span class="n">r</span><span class="o">|</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="c1">// r: Result&lt;!, ()&gt;</span>
<span class="w">        </span><span class="k">match</span><span class="w"> </span><span class="n">r</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">            </span><span class="nb">Ok</span><span class="p">(</span><span class="n">x</span><span class="p">)</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="k">match</span><span class="w"> </span><span class="n">x</span><span class="w"> </span><span class="p">{}</span><span class="w"></span>
<span class="w">            </span><span class="nb">Err</span><span class="p">(())</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="p">()</span><span class="w"></span>
<span class="w">        </span><span class="p">}</span><span class="w"></span>
<span class="w">    </span><span class="p">})</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>
</code></pre></div>
<p>I think it's not possible to avoid the conclusion that <code>!</code> is a type</p>



<a name="241424209"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/%60let%20pattern%20%3D%20expr%20else%20%7B%20...%20%7D%60%20statements/near/241424209" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jeremiah Senkpiel <a href="https://rust-lang.github.io/zulip_archive/stream/213817-t-lang/topic/.60let.20pattern.20.3D.20expr.20else.20.7B.20.2E.2E.2E.20.7D.60.20statements.html#241424209">(Jun 03 2021 at 17:27)</a>:</h4>
<p><span class="user-mention silent" data-user-id="271719">Mario Carneiro</span> <a href="#narrow/stream/213817-t-lang/topic/.60let.20pattern.20.3D.20expr.20else.20.7B.20.2E.2E.2E.20.7D.60.20statements/near/241346955">said</a>:</p>
<blockquote>
<p>There is an extra dereference in the first code block, so I think this isn't true. I don't know what the types are but it seems like the field should be copy, so that you could write <code>let Some(subpage_layer_info) = layer_properties.subpage_layer_info ...</code> instead</p>
</blockquote>
<p>That example was taken from the old RFC; I've removed it in favor of the practical refactor example which shows the same thing and uses code which I am actually familiar with.</p>
<p>I already mentioned <code>!</code> in the reference explanation but I'll also add it to the summary.</p>



<a name="241427912"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/%60let%20pattern%20%3D%20expr%20else%20%7B%20...%20%7D%60%20statements/near/241427912" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jeremiah Senkpiel <a href="https://rust-lang.github.io/zulip_archive/stream/213817-t-lang/topic/.60let.20pattern.20.3D.20expr.20else.20.7B.20.2E.2E.2E.20.7D.60.20statements.html#241427912">(Jun 03 2021 at 17:50)</a>:</h4>
<p><span class="user-mention silent" data-user-id="125270">scottmcm</span> <a href="#narrow/stream/213817-t-lang/topic/.60let.20pattern.20.3D.20expr.20else.20.7B.20.2E.2E.2E.20.7D.60.20statements/near/241359553">said</a>:</p>
<blockquote>
<p>Could also say that its result is uninhabited, to avoid the <code>!</code> mention.</p>
<p>So you get something like <code>let Some(x) = opt else BLOCK;</code> → </p>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="kd">let</span><span class="w"> </span><span class="n">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">match</span><span class="w"> </span><span class="n">opt</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="nb">Some</span><span class="p">(</span><span class="n">x</span><span class="p">)</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="n">x</span><span class="p">,</span><span class="w"></span>
<span class="w">    </span><span class="n">_</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="k">match</span><span class="w"> </span><span class="p">(</span><span class="n">BLOCK</span><span class="p">)</span><span class="w"> </span><span class="p">{}</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>
</code></pre></div>
<p>to leverage existing "things that don't need arms in <code>match</code>" understanding.</p>
</blockquote>
<p>I don't understand this, could you clarify what you're trying to get at here?</p>



<a name="241432416"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/%60let%20pattern%20%3D%20expr%20else%20%7B%20...%20%7D%60%20statements/near/241432416" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> scottmcm <a href="https://rust-lang.github.io/zulip_archive/stream/213817-t-lang/topic/.60let.20pattern.20.3D.20expr.20else.20.7B.20.2E.2E.2E.20.7D.60.20statements.html#241432416">(Jun 03 2021 at 18:26)</a>:</h4>
<p>I guess it could be phrased as "does it need to return <code>!</code>, or can it return something uninhabited-but-not-<code>!</code> like <code>std::convert::Infallible</code>?"</p>



<a name="241432658"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/%60let%20pattern%20%3D%20expr%20else%20%7B%20...%20%7D%60%20statements/near/241432658" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> scottmcm <a href="https://rust-lang.github.io/zulip_archive/stream/213817-t-lang/topic/.60let.20pattern.20.3D.20expr.20else.20.7B.20.2E.2E.2E.20.7D.60.20statements.html#241432658">(Jun 03 2021 at 18:28)</a>:</h4>
<p>For example, &lt;<a href="https://play.rust-lang.org/?version=stable&amp;mode=debug&amp;edition=2018&amp;gist=ae5b6a7a44e83c2ad8350af8b578e04a">https://play.rust-lang.org/?version=stable&amp;mode=debug&amp;edition=2018&amp;gist=ae5b6a7a44e83c2ad8350af8b578e04a</a>&gt;</p>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="k">use</span><span class="w"> </span><span class="n">std</span>::<span class="n">convert</span>::<span class="n">TryFrom</span><span class="p">;</span><span class="w"></span>
<span class="k">fn</span> <span class="nf">demo</span><span class="p">(</span><span class="n">x</span>: <span class="kt">u32</span><span class="p">)</span><span class="w"> </span>-&gt; <span class="o">!</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="kt">u64</span>::<span class="n">try_from</span><span class="p">(</span><span class="n">x</span><span class="p">).</span><span class="n">unwrap_err</span><span class="p">()</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>
</code></pre></div>
<p>fails with </p>
<div class="codehilite"><pre><span></span><code>error[E0308]: mismatched types
 --&gt; src/lib.rs:3:5
  |
2 | fn demo(x: u32) -&gt; ! {
  |                    - expected `!` because of return type
3 |     u64::try_from(x).unwrap_err()
  |     ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^ expected `!`, found enum `Infallible`
  |
  = note: expected type `!`
             found enum `Infallible`
</code></pre></div>



<a name="241432742"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/%60let%20pattern%20%3D%20expr%20else%20%7B%20...%20%7D%60%20statements/near/241432742" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> scottmcm <a href="https://rust-lang.github.io/zulip_archive/stream/213817-t-lang/topic/.60let.20pattern.20.3D.20expr.20else.20.7B.20.2E.2E.2E.20.7D.60.20statements.html#241432742">(Jun 03 2021 at 18:29)</a>:</h4>
<p>so <code>let _: ! = { BLOCK };</code> and <code>match ({BLOCK}) {}</code> in the desugaring would have different behaviour.</p>



<a name="241432750"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/%60let%20pattern%20%3D%20expr%20else%20%7B%20...%20%7D%60%20statements/near/241432750" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Mario Carneiro <a href="https://rust-lang.github.io/zulip_archive/stream/213817-t-lang/topic/.60let.20pattern.20.3D.20expr.20else.20.7B.20.2E.2E.2E.20.7D.60.20statements.html#241432750">(Jun 03 2021 at 18:29)</a>:</h4>
<p>I don't think there is any precedent for returning something uninhabited-but-not-<code>!</code> and having it coerce to <code>!</code> or any other uninhabited type. Only <code>!</code> is magic like that</p>



<a name="241432778"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/%60let%20pattern%20%3D%20expr%20else%20%7B%20...%20%7D%60%20statements/near/241432778" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jeremiah Senkpiel <a href="https://rust-lang.github.io/zulip_archive/stream/213817-t-lang/topic/.60let.20pattern.20.3D.20expr.20else.20.7B.20.2E.2E.2E.20.7D.60.20statements.html#241432778">(Jun 03 2021 at 18:29)</a>:</h4>
<p>Isn't <a class="stream" data-stream-id="259160" href="/#narrow/stream/259160-t-lang.2Fproject-never-type">#t-lang/project-never-type</a>  working on fixing that, or am I mistaken on how <code>!</code> is intended to interact with Infallible / empty enums?</p>



<a name="241432902"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/%60let%20pattern%20%3D%20expr%20else%20%7B%20...%20%7D%60%20statements/near/241432902" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> scottmcm <a href="https://rust-lang.github.io/zulip_archive/stream/213817-t-lang/topic/.60let.20pattern.20.3D.20expr.20else.20.7B.20.2E.2E.2E.20.7D.60.20statements.html#241432902">(Jun 03 2021 at 18:30)</a>:</h4>
<p><code>!</code> is special, because it has the coercion-to-anything.  I don't know that a general <code>enum Never {}</code> is expected to have that magic coercion.</p>



<a name="241432935"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/%60let%20pattern%20%3D%20expr%20else%20%7B%20...%20%7D%60%20statements/near/241432935" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Mario Carneiro <a href="https://rust-lang.github.io/zulip_archive/stream/213817-t-lang/topic/.60let.20pattern.20.3D.20expr.20else.20.7B.20.2E.2E.2E.20.7D.60.20statements.html#241432935">(Jun 03 2021 at 18:30)</a>:</h4>
<p>is "uninhabited" even a language concept? There is "<code>match x {}</code> typechecks" as an approximation but coercion doesn't come into it</p>



<a name="241433309"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/%60let%20pattern%20%3D%20expr%20else%20%7B%20...%20%7D%60%20statements/near/241433309" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jeremiah Senkpiel <a href="https://rust-lang.github.io/zulip_archive/stream/213817-t-lang/topic/.60let.20pattern.20.3D.20expr.20else.20.7B.20.2E.2E.2E.20.7D.60.20statements.html#241433309">(Jun 03 2021 at 18:33)</a>:</h4>
<p>What would having the return type be <code>enum Uninhabited {}</code> get us over <code>!</code>?</p>



<a name="241433344"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/%60let%20pattern%20%3D%20expr%20else%20%7B%20...%20%7D%60%20statements/near/241433344" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Mario Carneiro <a href="https://rust-lang.github.io/zulip_archive/stream/213817-t-lang/topic/.60let.20pattern.20.3D.20expr.20else.20.7B.20.2E.2E.2E.20.7D.60.20statements.html#241433344">(Jun 03 2021 at 18:33)</a>:</h4>
<p>Also <code>match ({BLOCK}) {}</code> would cause type inference problems</p>



<a name="241433746"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/%60let%20pattern%20%3D%20expr%20else%20%7B%20...%20%7D%60%20statements/near/241433746" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Mario Carneiro <a href="https://rust-lang.github.io/zulip_archive/stream/213817-t-lang/topic/.60let.20pattern.20.3D.20expr.20else.20.7B.20.2E.2E.2E.20.7D.60.20statements.html#241433746">(Jun 03 2021 at 18:36)</a>:</h4>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="k">fn</span> <span class="nf">foo</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;</span><span class="p">()</span><span class="w"> </span>-&gt; <span class="nc">T</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="k">loop</span><span class="w"> </span><span class="p">{}</span><span class="w"> </span><span class="p">}</span><span class="w"></span>
<span class="k">fn</span> <span class="nf">bar</span><span class="p">()</span><span class="w"> </span>-&gt; <span class="o">!</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">foo</span><span class="p">()</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="c1">// typechecks</span>
<span class="k">fn</span> <span class="nf">baz</span><span class="p">()</span><span class="w"> </span>-&gt; <span class="o">!</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="k">match</span><span class="w"> </span><span class="n">foo</span><span class="p">()</span><span class="w"> </span><span class="p">{}</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="c1">// type annotations needed</span>
</code></pre></div>



<a name="241434206"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/%60let%20pattern%20%3D%20expr%20else%20%7B%20...%20%7D%60%20statements/near/241434206" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> scottmcm <a href="https://rust-lang.github.io/zulip_archive/stream/213817-t-lang/topic/.60let.20pattern.20.3D.20expr.20else.20.7B.20.2E.2E.2E.20.7D.60.20statements.html#241434206">(Jun 03 2021 at 18:40)</a>:</h4>
<p><span class="user-mention silent" data-user-id="319552">Jeremiah Senkpiel</span> <a href="#narrow/stream/213817-t-lang/topic/.60let.20pattern.20.3D.20expr.20else.20.7B.20.2E.2E.2E.20.7D.60.20statements/near/241433309">said</a>:</p>
<blockquote>
<p>What would having the return type be <code>enum Uninhabited {}</code> get us over <code>!</code>?</p>
</blockquote>
<p>Well, for example, it might let things like <code>Result&lt;!, !&gt;</code> work, which show up as residuals in the <code>?</code> stuff.</p>



<a name="241434250"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/%60let%20pattern%20%3D%20expr%20else%20%7B%20...%20%7D%60%20statements/near/241434250" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Mario Carneiro <a href="https://rust-lang.github.io/zulip_archive/stream/213817-t-lang/topic/.60let.20pattern.20.3D.20expr.20else.20.7B.20.2E.2E.2E.20.7D.60.20statements.html#241434250">(Jun 03 2021 at 18:40)</a>:</h4>
<p>Does <code>match x {}</code> even work for that?</p>



<a name="241434324"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/%60let%20pattern%20%3D%20expr%20else%20%7B%20...%20%7D%60%20statements/near/241434324" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jeremiah Senkpiel <a href="https://rust-lang.github.io/zulip_archive/stream/213817-t-lang/topic/.60let.20pattern.20.3D.20expr.20else.20.7B.20.2E.2E.2E.20.7D.60.20statements.html#241434324">(Jun 03 2021 at 18:41)</a>:</h4>
<p>Do enums with all options being <code>!</code> not coerce to <code>!</code>?</p>



<a name="241434326"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/%60let%20pattern%20%3D%20expr%20else%20%7B%20...%20%7D%60%20statements/near/241434326" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> scottmcm <a href="https://rust-lang.github.io/zulip_archive/stream/213817-t-lang/topic/.60let.20pattern.20.3D.20expr.20else.20.7B.20.2E.2E.2E.20.7D.60.20statements.html#241434326">(Jun 03 2021 at 18:41)</a>:</h4>
<p><span class="user-mention silent" data-user-id="271719">Mario Carneiro</span> <a href="#narrow/stream/213817-t-lang/topic/.60let.20pattern.20.3D.20expr.20else.20.7B.20.2E.2E.2E.20.7D.60.20statements/near/241433746">said</a>:</p>
<blockquote>
<p><div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="k">fn</span> <span class="nf">foo</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;</span><span class="p">()</span><span class="w"> </span>-&gt; <span class="nc">T</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="k">loop</span><span class="w"> </span><span class="p">{}</span><span class="w"> </span><span class="p">}</span><span class="w"></span>
<span class="k">fn</span> <span class="nf">bar</span><span class="p">()</span><span class="w"> </span>-&gt; <span class="o">!</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">foo</span><span class="p">()</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="c1">// typechecks</span>
<span class="k">fn</span> <span class="nf">baz</span><span class="p">()</span><span class="w"> </span>-&gt; <span class="o">!</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="k">match</span><span class="w"> </span><span class="n">foo</span><span class="p">()</span><span class="w"> </span><span class="p">{}</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="c1">// type annotations needed</span>
</code></pre></div><br>
</p>
</blockquote>
<p>Part of me says that you <em>should</em> have to specify a type on <code>foo</code> there, since presumably that's the point of it being generic instead of just being <code>-&gt;</code> itself.</p>



<a name="241434371"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/%60let%20pattern%20%3D%20expr%20else%20%7B%20...%20%7D%60%20statements/near/241434371" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> scottmcm <a href="https://rust-lang.github.io/zulip_archive/stream/213817-t-lang/topic/.60let.20pattern.20.3D.20expr.20else.20.7B.20.2E.2E.2E.20.7D.60.20statements.html#241434371">(Jun 03 2021 at 18:41)</a>:</h4>
<p><span class="user-mention silent" data-user-id="271719">Mario Carneiro</span> <a href="#narrow/stream/213817-t-lang/topic/.60let.20pattern.20.3D.20expr.20else.20.7B.20.2E.2E.2E.20.7D.60.20statements/near/241434250">said</a>:</p>
<blockquote>
<p>Does <code>match x {}</code> even work for that?</p>
</blockquote>
<p>Only with <a href="https://doc.rust-lang.org/nightly/unstable-book/language-features/exhaustive-patterns.html">https://doc.rust-lang.org/nightly/unstable-book/language-features/exhaustive-patterns.html</a></p>



<a name="241434441"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/%60let%20pattern%20%3D%20expr%20else%20%7B%20...%20%7D%60%20statements/near/241434441" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jeremiah Senkpiel <a href="https://rust-lang.github.io/zulip_archive/stream/213817-t-lang/topic/.60let.20pattern.20.3D.20expr.20else.20.7B.20.2E.2E.2E.20.7D.60.20statements.html#241434441">(Jun 03 2021 at 18:42)</a>:</h4>
<p>Also, <code>Result&lt;!, !&gt;</code> doesn't coerce to <code>enum Uninhabited {}</code>... I... think?</p>



<a name="241434498"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/%60let%20pattern%20%3D%20expr%20else%20%7B%20...%20%7D%60%20statements/near/241434498" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Mario Carneiro <a href="https://rust-lang.github.io/zulip_archive/stream/213817-t-lang/topic/.60let.20pattern.20.3D.20expr.20else.20.7B.20.2E.2E.2E.20.7D.60.20statements.html#241434498">(Jun 03 2021 at 18:42)</a>:</h4>
<p>I don't think either result in my example is incorrect, I just think that in the <code>let .. else { &lt;block&gt; }</code> it should act like the body of <code>bar</code></p>



<a name="241434695"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/%60let%20pattern%20%3D%20expr%20else%20%7B%20...%20%7D%60%20statements/near/241434695" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jeremiah Senkpiel <a href="https://rust-lang.github.io/zulip_archive/stream/213817-t-lang/topic/.60let.20pattern.20.3D.20expr.20else.20.7B.20.2E.2E.2E.20.7D.60.20statements.html#241434695">(Jun 03 2021 at 18:44)</a>:</h4>
<p>(Also I'm having trouble figuring out how <code>Result&lt;!, &gt;</code> would even exist from <code>?</code>, links to examples would probably helpful if we want to go down this rabbit hole</p>



<a name="241434709"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/%60let%20pattern%20%3D%20expr%20else%20%7B%20...%20%7D%60%20statements/near/241434709" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Mario Carneiro <a href="https://rust-lang.github.io/zulip_archive/stream/213817-t-lang/topic/.60let.20pattern.20.3D.20expr.20else.20.7B.20.2E.2E.2E.20.7D.60.20statements.html#241434709">(Jun 03 2021 at 18:44)</a>:</h4>
<p>Only <code>!</code> has coercions to any type, and I don't think project-never-type plans to change that</p>



<a name="241434783"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/%60let%20pattern%20%3D%20expr%20else%20%7B%20...%20%7D%60%20statements/near/241434783" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Mario Carneiro <a href="https://rust-lang.github.io/zulip_archive/stream/213817-t-lang/topic/.60let.20pattern.20.3D.20expr.20else.20.7B.20.2E.2E.2E.20.7D.60.20statements.html#241434783">(Jun 03 2021 at 18:45)</a>:</h4>
<p>so if you wanted to use <code>MyVoid</code> in a let-else you would need to add <code>match ... {}</code></p>



<a name="241434859"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/%60let%20pattern%20%3D%20expr%20else%20%7B%20...%20%7D%60%20statements/near/241434859" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Mario Carneiro <a href="https://rust-lang.github.io/zulip_archive/stream/213817-t-lang/topic/.60let.20pattern.20.3D.20expr.20else.20.7B.20.2E.2E.2E.20.7D.60.20statements.html#241434859">(Jun 03 2021 at 18:45)</a>:</h4>
<p>at least, with my suggestion with the <code>let x: ! = BLOCK</code> desugaring</p>



<a name="241435079"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/%60let%20pattern%20%3D%20expr%20else%20%7B%20...%20%7D%60%20statements/near/241435079" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Mario Carneiro <a href="https://rust-lang.github.io/zulip_archive/stream/213817-t-lang/topic/.60let.20pattern.20.3D.20expr.20else.20.7B.20.2E.2E.2E.20.7D.60.20statements.html#241435079">(Jun 03 2021 at 18:47)</a>:</h4>
<p>If <code>Result&lt;!, !&gt;</code> implemented <code>Into&lt;!&gt;</code>, you could just write <code>else { x.into() }</code> which doesn't seem so bad</p>



<a name="241435308"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/%60let%20pattern%20%3D%20expr%20else%20%7B%20...%20%7D%60%20statements/near/241435308" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Mario Carneiro <a href="https://rust-lang.github.io/zulip_archive/stream/213817-t-lang/topic/.60let.20pattern.20.3D.20expr.20else.20.7B.20.2E.2E.2E.20.7D.60.20statements.html#241435308">(Jun 03 2021 at 18:49)</a>:</h4>
<p>which also seems like a reasonably generic way for a custom type to indicate that it is uninhabited</p>



<a name="241435419"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/%60let%20pattern%20%3D%20expr%20else%20%7B%20...%20%7D%60%20statements/near/241435419" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jeremiah Senkpiel <a href="https://rust-lang.github.io/zulip_archive/stream/213817-t-lang/topic/.60let.20pattern.20.3D.20expr.20else.20.7B.20.2E.2E.2E.20.7D.60.20statements.html#241435419">(Jun 03 2021 at 18:50)</a>:</h4>
<p>We could maybe desugar into anything which returns <code>Into&lt;!&gt;</code>, but... idk I'm not quite seeing the value?</p>



<a name="241435642"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/%60let%20pattern%20%3D%20expr%20else%20%7B%20...%20%7D%60%20statements/near/241435642" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Mario Carneiro <a href="https://rust-lang.github.io/zulip_archive/stream/213817-t-lang/topic/.60let.20pattern.20.3D.20expr.20else.20.7B.20.2E.2E.2E.20.7D.60.20statements.html#241435642">(Jun 03 2021 at 18:51)</a>:</h4>
<p>I think that genericity in the result type will just lead to type inference pains, because the type of a diverging expression is often unconstrained</p>



<a name="241435922"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/%60let%20pattern%20%3D%20expr%20else%20%7B%20...%20%7D%60%20statements/near/241435922" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Mario Carneiro <a href="https://rust-lang.github.io/zulip_archive/stream/213817-t-lang/topic/.60let.20pattern.20.3D.20expr.20else.20.7B.20.2E.2E.2E.20.7D.60.20statements.html#241435922">(Jun 03 2021 at 18:53)</a>:</h4>
<p>and if you have a custom uninhabited type, you will generally be either an <code>.into()</code> or <code>match _ {}</code> away from regaining that generality anyway</p>



<a name="241436165"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/%60let%20pattern%20%3D%20expr%20else%20%7B%20...%20%7D%60%20statements/near/241436165" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Mario Carneiro <a href="https://rust-lang.github.io/zulip_archive/stream/213817-t-lang/topic/.60let.20pattern.20.3D.20expr.20else.20.7B.20.2E.2E.2E.20.7D.60.20statements.html#241436165">(Jun 03 2021 at 18:55)</a>:</h4>
<p>I think project-never-type is working on changing type inference so that unconstrained types default to <code>!</code> where possible, so maybe my <code>baz</code> example will typecheck then, but it seems unnecessary to rely on that</p>



<a name="241437754"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/%60let%20pattern%20%3D%20expr%20else%20%7B%20...%20%7D%60%20statements/near/241437754" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Triplett <a href="https://rust-lang.github.io/zulip_archive/stream/213817-t-lang/topic/.60let.20pattern.20.3D.20expr.20else.20.7B.20.2E.2E.2E.20.7D.60.20statements.html#241437754">(Jun 03 2021 at 19:06)</a>:</h4>
<p>It's not at all clear to me why the diverging expression needs to have any type other than <code>!</code>.</p>



<a name="241439782"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/%60let%20pattern%20%3D%20expr%20else%20%7B%20...%20%7D%60%20statements/near/241439782" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jeremiah Senkpiel <a href="https://rust-lang.github.io/zulip_archive/stream/213817-t-lang/topic/.60let.20pattern.20.3D.20expr.20else.20.7B.20.2E.2E.2E.20.7D.60.20statements.html#241439782">(Jun 03 2021 at 19:23)</a>:</h4>
<p>Ok folks, RFC PR is up: <a href="https://github.com/rust-lang/rfcs/pull/3137">https://github.com/rust-lang/rfcs/pull/3137</a></p>



<a name="241442265"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/%60let%20pattern%20%3D%20expr%20else%20%7B%20...%20%7D%60%20statements/near/241442265" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Triplett <a href="https://rust-lang.github.io/zulip_archive/stream/213817-t-lang/topic/.60let.20pattern.20.3D.20expr.20else.20.7B.20.2E.2E.2E.20.7D.60.20statements.html#241442265">(Jun 03 2021 at 19:42)</a>:</h4>
<p><span class="user-mention" data-user-id="319552">@Jeremiah Senkpiel</span> I posted a few nits and additional verbiage, almost all of it as GitHub suggestions for simplicity.</p>



<a name="241442275"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/%60let%20pattern%20%3D%20expr%20else%20%7B%20...%20%7D%60%20statements/near/241442275" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Triplett <a href="https://rust-lang.github.io/zulip_archive/stream/213817-t-lang/topic/.60let.20pattern.20.3D.20expr.20else.20.7B.20.2E.2E.2E.20.7D.60.20statements.html#241442275">(Jun 03 2021 at 19:42)</a>:</h4>
<p>Apart from those, I think this is ready for review.</p>



<a name="241517316"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/%60let%20pattern%20%3D%20expr%20else%20%7B%20...%20%7D%60%20statements/near/241517316" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Daniel Henry-Mantilla <a href="https://rust-lang.github.io/zulip_archive/stream/213817-t-lang/topic/.60let.20pattern.20.3D.20expr.20else.20.7B.20.2E.2E.2E.20.7D.60.20statements.html#241517316">(Jun 04 2021 at 10:38)</a>:</h4>
<p><span class="user-mention silent" data-user-id="239881">Josh Triplett</span> <a href="#narrow/stream/213817-t-lang/topic/.60let.20pattern.20.3D.20expr.20else.20.7B.20.2E.2E.2E.20.7D.60.20statements/near/241437754">said</a>:</p>
<blockquote>
<p>It's not at all clear to me why the diverging expression needs to have any type other than <code>!</code>.</p>
</blockquote>
<p>I agree: <span class="user-mention" data-user-id="125270">@scottmcm</span>, on top of not everybody being aquainted with pattern-matching against empty enums (or <code>!</code>; but we still have the issue of it not covering all uninhabited types), we also need to take into account consistency with how other parts of the language treat <code>!</code> <em>vs.</em> other uninhabited types. Indeed, even though the <code>!</code> type is still unstable, we've had diverging functions for a while, <strong>as well as borrowck / dropck featuring special behavior for diverging blocks</strong>. Consider, for instance:</p>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="kd">let</span><span class="w"> </span><span class="n">it</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">&amp;</span><span class="k">mut</span><span class="w"> </span><span class="p">();</span><span class="w"></span>
<span class="k">if</span><span class="w"> </span><span class="kc">false</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="nb">drop</span><span class="p">(</span><span class="n">it</span><span class="p">);</span><span class="w"></span>
<span class="w">    </span><span class="k">enum</span> <span class="nc">Void</span><span class="w"> </span><span class="p">{}</span><span class="w"> </span><span class="cm">/* with `type Void = !;` it passes */</span><span class="w"></span>
<span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="n">_</span>: <span class="nc">Void</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">None</span><span class="p">.</span><span class="n">unwrap</span><span class="p">();</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>
<span class="nb">drop</span><span class="p">(</span><span class="n">it</span><span class="p">);</span><span class="w"> </span><span class="c1">// Error, `it` was moved into the `if` body.</span>
</code></pre></div>
<ul>
<li><a href="https://play.rust-lang.org/?version=nightly&amp;mode=debug&amp;edition=2018&amp;gist=c9929b02b0a32febd10b78ec12ab1747">Playground</a></li>
</ul>
<p>We can see that Rust does not really infer that having an instance of an uninhabited type such as empty enums means that that code path is unreachable. Granted, it could be made smarter <em>there</em>, and thus, also at the RFC level, but I think that so doing should be general. In other words, I think that the above snippet failing to compile but the following one passing would be <em>inconsistent</em> and thus not as useful:</p>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="k">if</span><span class="w"> </span><span class="kd">let</span><span class="w"> </span><span class="err">…</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="nb">None</span>::<span class="o">&lt;</span><span class="n">Void</span><span class="o">&gt;</span><span class="p">.</span><span class="n">unwrap</span><span class="p">()</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>
</code></pre></div>
<p>I thus think that if somebody were to produce something like the <code>Infallible</code> in your example, then they'd be the ones expected to <code>match … {}</code>-wrap their value; it should be rare enough not to be a problem.</p>



<a name="241590435"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/%60let%20pattern%20%3D%20expr%20else%20%7B%20...%20%7D%60%20statements/near/241590435" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jeremiah Senkpiel <a href="https://rust-lang.github.io/zulip_archive/stream/213817-t-lang/topic/.60let.20pattern.20.3D.20expr.20else.20.7B.20.2E.2E.2E.20.7D.60.20statements.html#241590435">(Jun 04 2021 at 20:42)</a>:</h4>
<p>I don’t understand what this comment is saying regarding “divergent <em>patterns</em>”, my understanding is that it would allow for a refutable pattern, is there a potential difference there internally with let-else? Anyone understand these semantics well enough to clarity? <a href="https://github.com/rust-lang/rfcs/pull/3137#issuecomment-854973177">https://github.com/rust-lang/rfcs/pull/3137#issuecomment-854973177</a></p>



<a name="241646644"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/%60let%20pattern%20%3D%20expr%20else%20%7B%20...%20%7D%60%20statements/near/241646644" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Daniel Henry-Mantilla <a href="https://rust-lang.github.io/zulip_archive/stream/213817-t-lang/topic/.60let.20pattern.20.3D.20expr.20else.20.7B.20.2E.2E.2E.20.7D.60.20statements.html#241646644">(Jun 05 2021 at 17:19)</a>:</h4>
<p>Yeah, I agree with your answer there: this is just about allowing refutable patterns in <code>let</code> bindings, provided they are followed by a diverging <em>block</em> (there are no "diverging patterns" anywhere). And we do have the notion of divergence in the language already, with <code>-&gt; !</code> returning functions, as well as my previous example regarding dropck or borrowck.</p>
<p>The whole PR ought to talk about it being <em>sugar</em>, and thus, with very explicit semantics:</p>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="kd">let</span><span class="w"> </span><span class="o">&lt;</span><span class="n">pat</span><span class="o">&gt;</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">&lt;</span><span class="n">expr</span><span class="o">&gt;</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="o">&lt;</span><span class="n">block</span><span class="o">&gt;</span><span class="w"></span>
</code></pre></div>
<p>being sugar for</p>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="kd">let</span><span class="w"> </span><span class="o">&lt;</span><span class="n">pat</span><span class="o">&gt;</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">match</span><span class="w"> </span><span class="o">&lt;</span><span class="n">expr</span><span class="o">&gt;</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="o">&lt;</span><span class="n">pat</span><span class="o">&gt;</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="o">&lt;</span><span class="n">pat</span><span class="o">&gt;</span><span class="p">,</span><span class="w"></span>
<span class="w">    </span><span class="cm">/* this branch must be reachable; "#[deny(unreachable_patterns)]"-like */</span><span class="w"></span>
<span class="w">    </span><span class="n">_</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="kd">let</span><span class="w"> </span><span class="n">_</span>: <span class="o">!</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">&lt;</span><span class="n">block</span><span class="o">&gt;</span><span class="p">;</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="cm">/* ensuring the block must diverge */</span><span class="w"></span>
<span class="p">};</span><span class="w"></span>
</code></pre></div>
<ul>
<li>(modulo the <code>&lt;pat&gt;</code> ordeal being more subtle <em>w.r.t.</em> destructuring and rebinding stuff).</li>
</ul>



<a name="241647076"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/%60let%20pattern%20%3D%20expr%20else%20%7B%20...%20%7D%60%20statements/near/241647076" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Daniel Henry-Mantilla <a href="https://rust-lang.github.io/zulip_archive/stream/213817-t-lang/topic/.60let.20pattern.20.3D.20expr.20else.20.7B.20.2E.2E.2E.20.7D.60.20statements.html#241647076">(Jun 05 2021 at 17:29)</a>:</h4>
<p>And if you need to show that the pattern is pervasive, feel free to look at <a href="https://grep.app/search?q=if%20let%20.%2A%20%7B%20%5Ba-zA-Z_%5D%5Cw%2A%20%7D%20else%20%7B%20return&amp;regexp=true&amp;filter[lang][0]=Rust">https://grep.app/search?q=if%20let%20.%2A%20%7B%20%5Ba-zA-Z_%5D%5Cw%2A%20%7D%20else%20%7B%20return&amp;regexp=true&amp;filter[lang][0]=Rust</a></p>
<ul>
<li>With common panics added: <a href="https://grep.app/search?q=if%20let%20.%2B%20%5C%7B%20%5Cw%2B%20%5C%7D%20else%20%7B%20%28%3F%3Areturn%7Cpanic%5C%21%7Cunreachable%5C%21%29&amp;regexp=true&amp;case=true&amp;filter[lang][0]=Rust">https://grep.app/search?q=if%20let%20.%2B%20%5C%7B%20%5Cw%2B%20%5C%7D%20else%20%7B%20%28%3F%3Areturn%7Cpanic%5C%21%7Cunreachable%5C%21%29&amp;regexp=true&amp;case=true&amp;filter[lang][0]=Rust</a></li>
</ul>



<a name="241647145"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/%60let%20pattern%20%3D%20expr%20else%20%7B%20...%20%7D%60%20statements/near/241647145" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Daniel Henry-Mantilla <a href="https://rust-lang.github.io/zulip_archive/stream/213817-t-lang/topic/.60let.20pattern.20.3D.20expr.20else.20.7B.20.2E.2E.2E.20.7D.60.20statements.html#241647145">(Jun 05 2021 at 17:30)</a>:</h4>
<p>(which is a subset of the usages of this pattern, more precisely, a subset of <code>let … = if let … { var } else { return</code> happening <em>on the same line</em> (else <a href="http://grep.app">grep.app</a> misses it))</p>



<a name="241927945"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/%60let%20pattern%20%3D%20expr%20else%20%7B%20...%20%7D%60%20statements/near/241927945" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Triplett <a href="https://rust-lang.github.io/zulip_archive/stream/213817-t-lang/topic/.60let.20pattern.20.3D.20expr.20else.20.7B.20.2E.2E.2E.20.7D.60.20statements.html#241927945">(Jun 08 2021 at 14:27)</a>:</h4>
<p>I've nominated the RFC for lang team discussion.</p>



<a name="242097810"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/%60let%20pattern%20%3D%20expr%20else%20%7B%20...%20%7D%60%20statements/near/242097810" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jeremiah Senkpiel <a href="https://rust-lang.github.io/zulip_archive/stream/213817-t-lang/topic/.60let.20pattern.20.3D.20expr.20else.20.7B.20.2E.2E.2E.20.7D.60.20statements.html#242097810">(Jun 09 2021 at 17:00)</a>:</h4>
<p>Is this diverging block type-check de-sugaring with <code>!</code> also invalid within the rust compiler itself?</p>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="n">_</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="n">nope</span>: <span class="o">!</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="cm">/* diverging expr */</span><span class="w"> </span><span class="p">};</span><span class="w"></span>
<span class="w">    </span><span class="k">match</span><span class="w"> </span><span class="n">nope</span><span class="w"> </span><span class="p">{}</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>
</code></pre></div>
<p>(I am unsure if the rust compiler bypasses public stable on some lang feature or not)</p>



<a name="242124966"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/%60let%20pattern%20%3D%20expr%20else%20%7B%20...%20%7D%60%20statements/near/242124966" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jonas Schievink  [he/him] <a href="https://rust-lang.github.io/zulip_archive/stream/213817-t-lang/topic/.60let.20pattern.20.3D.20expr.20else.20.7B.20.2E.2E.2E.20.7D.60.20statements.html#242124966">(Jun 09 2021 at 20:27)</a>:</h4>
<p>it can use arbitrary unstable features internally</p>



<a name="242131094"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/%60let%20pattern%20%3D%20expr%20else%20%7B%20...%20%7D%60%20statements/near/242131094" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Mario Carneiro <a href="https://rust-lang.github.io/zulip_archive/stream/213817-t-lang/topic/.60let.20pattern.20.3D.20expr.20else.20.7B.20.2E.2E.2E.20.7D.60.20statements.html#242131094">(Jun 09 2021 at 21:13)</a>:</h4>
<p>I assume that let..else won't actually be implemented as a macro-style desugaring though, but would instead stick around until HIR for diagnostic reasons. The desugaring is just a "just-so" story for documentation purposes. So the only worry about using unstable notation is if it is not familiar to users, and in this case I think using <code>let nope: ! = ...</code> is clearer than the typechecker hack I posted on the issue</p>



<a name="242134900"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/%60let%20pattern%20%3D%20expr%20else%20%7B%20...%20%7D%60%20statements/near/242134900" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> scottmcm <a href="https://rust-lang.github.io/zulip_archive/stream/213817-t-lang/topic/.60let.20pattern.20.3D.20expr.20else.20.7B.20.2E.2E.2E.20.7D.60.20statements.html#242134900">(Jun 09 2021 at 21:43)</a>:</h4>
<p>Hard to say.  It could well disappear in AST-&gt;HIR lowering, and just use <a href="https://doc.rust-lang.org/nightly/nightly-rustc/rustc_span/hygiene/enum.DesugaringKind.html"><code>DesugaringKind</code></a> to report diagnostics differently (like <code>?</code> and <code>try{}</code> and <code>for{}</code> and such do).</p>
<p>If it can be done as a desugar it'd definitely be preferable, to me, since it avoids needing to specifically add type checking rules and name resolution rules and such -- much nicer to have it just fall out of existing rules from the desugar.</p>



<a name="242135340"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/%60let%20pattern%20%3D%20expr%20else%20%7B%20...%20%7D%60%20statements/near/242135340" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Mario Carneiro <a href="https://rust-lang.github.io/zulip_archive/stream/213817-t-lang/topic/.60let.20pattern.20.3D.20expr.20else.20.7B.20.2E.2E.2E.20.7D.60.20statements.html#242135340">(Jun 09 2021 at 21:47)</a>:</h4>
<p>Given how all match-likes seem to get desugared to <code>match</code> in AST-&gt;HIR, it makes sense for let-else to get desugared there as well</p>



<a name="242135769"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/%60let%20pattern%20%3D%20expr%20else%20%7B%20...%20%7D%60%20statements/near/242135769" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Mario Carneiro <a href="https://rust-lang.github.io/zulip_archive/stream/213817-t-lang/topic/.60let.20pattern.20.3D.20expr.20else.20.7B.20.2E.2E.2E.20.7D.60.20statements.html#242135769">(Jun 09 2021 at 21:51)</a>:</h4>
<p>it's not clear whether the unusual scoping here presents any problems. I see that <code>hir::Local</code> still has a <code>Pat</code>, so I guess it is still doing pattern matching. Adding an optional else branch there seems doable</p>



<a name="242143713"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/%60let%20pattern%20%3D%20expr%20else%20%7B%20...%20%7D%60%20statements/near/242143713" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jeremiah Senkpiel <a href="https://rust-lang.github.io/zulip_archive/stream/213817-t-lang/topic/.60let.20pattern.20.3D.20expr.20else.20.7B.20.2E.2E.2E.20.7D.60.20statements.html#242143713">(Jun 09 2021 at 23:30)</a>:</h4>
<p>As much as I'd also like to implement this feature if some version of this RFC is accepted, this is all a little beyond me. (I understand the general AST-&gt;HIR-&gt;MIR concept but little in concrete detail)</p>



<a name="242143971"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/%60let%20pattern%20%3D%20expr%20else%20%7B%20...%20%7D%60%20statements/near/242143971" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Mario Carneiro <a href="https://rust-lang.github.io/zulip_archive/stream/213817-t-lang/topic/.60let.20pattern.20.3D.20expr.20else.20.7B.20.2E.2E.2E.20.7D.60.20statements.html#242143971">(Jun 09 2021 at 23:34)</a>:</h4>
<p>I'm curious where the MCP process sits with respect to the RFC. Does the RFC have to be accepted before the unstable feature is added?</p>



<a name="242145332"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/%60let%20pattern%20%3D%20expr%20else%20%7B%20...%20%7D%60%20statements/near/242145332" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> scottmcm <a href="https://rust-lang.github.io/zulip_archive/stream/213817-t-lang/topic/.60let.20pattern.20.3D.20expr.20else.20.7B.20.2E.2E.2E.20.7D.60.20statements.html#242145332">(Jun 09 2021 at 23:55)</a>:</h4>
<p>I think an MCP is how something can be added to the compiler as unstable without having an RFC for it.  Basically, if you're not trying to put it on stabilization path, you can convince compiler that it won't be to annoying to have the code in the compiler.</p>
<p>Whereas you don't need an MCP if there was an RFC, but of course you do still need to pass code review and such.</p>



<a name="242145595"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/%60let%20pattern%20%3D%20expr%20else%20%7B%20...%20%7D%60%20statements/near/242145595" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Mario Carneiro <a href="https://rust-lang.github.io/zulip_archive/stream/213817-t-lang/topic/.60let.20pattern.20.3D.20expr.20else.20.7B.20.2E.2E.2E.20.7D.60.20statements.html#242145595">(Jun 09 2021 at 23:59)</a>:</h4>
<p>So if the RFC was accepted and then implemented, does that mean there would never be a feature flag for it? Just missing in one version and then stable in the next?</p>



<a name="242146131"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/%60let%20pattern%20%3D%20expr%20else%20%7B%20...%20%7D%60%20statements/near/242146131" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> scottmcm <a href="https://rust-lang.github.io/zulip_archive/stream/213817-t-lang/topic/.60let.20pattern.20.3D.20expr.20else.20.7B.20.2E.2E.2E.20.7D.60.20statements.html#242146131">(Jun 10 2021 at 00:06)</a>:</h4>
<p>Nope, it still goes in unstable, then needs another FCP for the stabilization (even with an RFC).</p>



<a name="242146284"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/%60let%20pattern%20%3D%20expr%20else%20%7B%20...%20%7D%60%20statements/near/242146284" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> scottmcm <a href="https://rust-lang.github.io/zulip_archive/stream/213817-t-lang/topic/.60let.20pattern.20.3D.20expr.20else.20.7B.20.2E.2E.2E.20.7D.60.20statements.html#242146284">(Jun 10 2021 at 00:09)</a>:</h4>
<p>Everyone does their best in RFCs, but it's happened before and will happen again that once something is implemented, it turns out not to be as good as hoped, and gets changed again or removed.</p>



<a name="242642441"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/%60let%20pattern%20%3D%20expr%20else%20%7B%20...%20%7D%60%20statements/near/242642441" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jeremiah Senkpiel <a href="https://rust-lang.github.io/zulip_archive/stream/213817-t-lang/topic/.60let.20pattern.20.3D.20expr.20else.20.7B.20.2E.2E.2E.20.7D.60.20statements.html#242642441">(Jun 14 2021 at 18:47)</a>:</h4>
<p>Does <code>return;</code> (with a semicolon) return <code>!</code>, or does it have to be without the semicolon?</p>



<a name="242643690"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/%60let%20pattern%20%3D%20expr%20else%20%7B%20...%20%7D%60%20statements/near/242643690" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> bstrie <a href="https://rust-lang.github.io/zulip_archive/stream/213817-t-lang/topic/.60let.20pattern.20.3D.20expr.20else.20.7B.20.2E.2E.2E.20.7D.60.20statements.html#242643690">(Jun 14 2021 at 18:56)</a>:</h4>
<p><code>return</code> is an expression with type <code>!</code>, the semicolon doesn't have an effect because the code never "gets" to it. it's like the difference between <code>panic!()</code> and <code>panic!();</code>, or the difference between <code>return</code> and <code>return break break return break return</code>. Though in some contexts the semicolon may be syntactically required, e.g. <code>let x: ! = return;</code> requires a semicolon because of the <code>let</code>.</p>



<a name="242646242"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/%60let%20pattern%20%3D%20expr%20else%20%7B%20...%20%7D%60%20statements/near/242646242" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jeremiah Senkpiel <a href="https://rust-lang.github.io/zulip_archive/stream/213817-t-lang/topic/.60let.20pattern.20.3D.20expr.20else.20.7B.20.2E.2E.2E.20.7D.60.20statements.html#242646242">(Jun 14 2021 at 19:17)</a>:</h4>
<p>Ok good, I was worried that somehow that would end up being <code>()</code> instead.</p>



<a name="242647160"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/%60let%20pattern%20%3D%20expr%20else%20%7B%20...%20%7D%60%20statements/near/242647160" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jeremiah Senkpiel <a href="https://rust-lang.github.io/zulip_archive/stream/213817-t-lang/topic/.60let.20pattern.20.3D.20expr.20else.20.7B.20.2E.2E.2E.20.7D.60.20statements.html#242647160">(Jun 14 2021 at 19:24)</a>:</h4>
<p>I do wonder if we shouldn't just recommend that let-else supersede if-let-chains, since that topic is apparently so complex that no one has worked on it in 3 years and seems to conflict with the approach here.</p>



<a name="242647218"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/%60let%20pattern%20%3D%20expr%20else%20%7B%20...%20%7D%60%20statements/near/242647218" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jeremiah Senkpiel <a href="https://rust-lang.github.io/zulip_archive/stream/213817-t-lang/topic/.60let.20pattern.20.3D.20expr.20else.20.7B.20.2E.2E.2E.20.7D.60.20statements.html#242647218">(Jun 14 2021 at 19:25)</a>:</h4>
<p>If wonder if, were <code>&amp;&amp;</code> to already be implemented, would we prefer the much more complex <code>||</code> idea? I dunno. Unknowable, I suppose.</p>



<a name="242647450"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/%60let%20pattern%20%3D%20expr%20else%20%7B%20...%20%7D%60%20statements/near/242647450" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Triplett <a href="https://rust-lang.github.io/zulip_archive/stream/213817-t-lang/topic/.60let.20pattern.20.3D.20expr.20else.20.7B.20.2E.2E.2E.20.7D.60.20statements.html#242647450">(Jun 14 2021 at 19:27)</a>:</h4>
<p>So, I genuinely think that if-let chains are still quite valuable, and I want them regularly.</p>



<a name="242647472"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/%60let%20pattern%20%3D%20expr%20else%20%7B%20...%20%7D%60%20statements/near/242647472" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Triplett <a href="https://rust-lang.github.io/zulip_archive/stream/213817-t-lang/topic/.60let.20pattern.20.3D.20expr.20else.20.7B.20.2E.2E.2E.20.7D.60.20statements.html#242647472">(Jun 14 2021 at 19:27)</a>:</h4>
<p>I don't think they're as high a priority as let-else.</p>



<a name="242647605"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/%60let%20pattern%20%3D%20expr%20else%20%7B%20...%20%7D%60%20statements/near/242647605" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Triplett <a href="https://rust-lang.github.io/zulip_archive/stream/213817-t-lang/topic/.60let.20pattern.20.3D.20expr.20else.20.7B.20.2E.2E.2E.20.7D.60.20statements.html#242647605">(Jun 14 2021 at 19:28)</a>:</h4>
<p>But I do often want <code>if let Pat(x) = expr() &amp;&amp; cond(x) &amp;&amp; let OtherPat(y) = anotherfunc(x)</code>.</p>



<a name="242647907"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/%60let%20pattern%20%3D%20expr%20else%20%7B%20...%20%7D%60%20statements/near/242647907" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Lukas Wirth <a href="https://rust-lang.github.io/zulip_archive/stream/213817-t-lang/topic/.60let.20pattern.20.3D.20expr.20else.20.7B.20.2E.2E.2E.20.7D.60.20statements.html#242647907">(Jun 14 2021 at 19:30)</a>:</h4>
<p>I'm pretty sure <code>return;</code> evaluates to <code>()</code> no? as in the the semicolon is significant for the return type of a block here</p>



<a name="242647911"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/%60let%20pattern%20%3D%20expr%20else%20%7B%20...%20%7D%60%20statements/near/242647911" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> scottmcm <a href="https://rust-lang.github.io/zulip_archive/stream/213817-t-lang/topic/.60let.20pattern.20.3D.20expr.20else.20.7B.20.2E.2E.2E.20.7D.60.20statements.html#242647911">(Jun 14 2021 at 19:30)</a>:</h4>
<p>I do wonder if we should think more about how they mix.  I tried find some nice let-else examples in clippy, but they seemed to be mostly wanting the chain.</p>



<a name="242647977"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/%60let%20pattern%20%3D%20expr%20else%20%7B%20...%20%7D%60%20statements/near/242647977" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> scottmcm <a href="https://rust-lang.github.io/zulip_archive/stream/213817-t-lang/topic/.60let.20pattern.20.3D.20expr.20else.20.7B.20.2E.2E.2E.20.7D.60.20statements.html#242647977">(Jun 14 2021 at 19:31)</a>:</h4>
<p>But they also often had <code>else { continue }</code> or similar, so being able to do both might be nice.</p>



<a name="242648219"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/%60let%20pattern%20%3D%20expr%20else%20%7B%20...%20%7D%60%20statements/near/242648219" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> bstrie <a href="https://rust-lang.github.io/zulip_archive/stream/213817-t-lang/topic/.60let.20pattern.20.3D.20expr.20else.20.7B.20.2E.2E.2E.20.7D.60.20statements.html#242648219">(Jun 14 2021 at 19:33)</a>:</h4>
<p><span class="user-mention silent" data-user-id="300586">Lukas Wirth</span> <a href="#narrow/stream/213817-t-lang/topic/.60let.20pattern.20.3D.20expr.20else.20.7B.20.2E.2E.2E.20.7D.60.20statements/near/242647907">said</a>:</p>
<blockquote>
<p>I'm pretty sure <code>return;</code> evaluates to <code>()</code> no? as in the the semicolon is significant for the return type of a block here</p>
</blockquote>
<p><code>let x: ! = { return; };</code> works, which it wouldn't if <code>return;</code> was <code>()</code> rather than <code>!</code>, although of course I'm using the unstable never_type feature and it's possible that the type inference might change before stabilization for the sake of backcompat</p>



<a name="242648572"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/%60let%20pattern%20%3D%20expr%20else%20%7B%20...%20%7D%60%20statements/near/242648572" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Lukas Wirth <a href="https://rust-lang.github.io/zulip_archive/stream/213817-t-lang/topic/.60let.20pattern.20.3D.20expr.20else.20.7B.20.2E.2E.2E.20.7D.60.20statements.html#242648572">(Jun 14 2021 at 19:36)</a>:</h4>
<p>Oh, I tried this in a function like</p>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="k">fn</span> <span class="nf">foo</span><span class="p">()</span><span class="w"> </span>-&gt; <span class="o">!</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="k">return</span><span class="p">;</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>
</code></pre></div>
<p>which doesn't type check.  Interesting that this differs in that case</p>



<a name="242648616"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/%60let%20pattern%20%3D%20expr%20else%20%7B%20...%20%7D%60%20statements/near/242648616" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Lukas Wirth <a href="https://rust-lang.github.io/zulip_archive/stream/213817-t-lang/topic/.60let.20pattern.20.3D.20expr.20else.20.7B.20.2E.2E.2E.20.7D.60.20statements.html#242648616">(Jun 14 2021 at 19:36)</a>:</h4>
<p>oh wait I'm dumb of course this doesn't work here <span aria-label="sweat smile" class="emoji emoji-1f605" role="img" title="sweat smile">:sweat_smile:</span> Ye now this make sense</p>



<a name="242650782"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/%60let%20pattern%20%3D%20expr%20else%20%7B%20...%20%7D%60%20statements/near/242650782" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jeremiah Senkpiel <a href="https://rust-lang.github.io/zulip_archive/stream/213817-t-lang/topic/.60let.20pattern.20.3D.20expr.20else.20.7B.20.2E.2E.2E.20.7D.60.20statements.html#242650782">(Jun 14 2021 at 19:53)</a>:</h4>
<p><span class="user-mention" data-user-id="239881">@Josh Triplett</span> Would you ever want:</p>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="k">if</span><span class="w"> </span><span class="kd">let</span><span class="w"> </span><span class="n">Enum</span>::<span class="n">Var1</span><span class="p">(</span><span class="n">x</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="o">||</span><span class="w"> </span><span class="n">b</span><span class="w"> </span><span class="o">||</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="k">return</span><span class="w"> </span><span class="n">anyhow</span><span class="o">!</span><span class="p">(</span><span class="s">"Bad x"</span><span class="p">)</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="kd">let</span><span class="w"> </span><span class="nb">Some</span><span class="p">(</span><span class="n">z</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">x</span><span class="w"> </span><span class="o">||</span><span class="w"> </span><span class="n">y</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="c1">// Complex.</span>
<span class="p">}</span><span class="w"></span>
</code></pre></div>
<p>As elaborated on in <a href="https://github.com/rust-lang/rfcs/pull/3137#issuecomment-860883577">https://github.com/rust-lang/rfcs/pull/3137#issuecomment-860883577</a></p>



<a name="242652636"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/%60let%20pattern%20%3D%20expr%20else%20%7B%20...%20%7D%60%20statements/near/242652636" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Triplett <a href="https://rust-lang.github.io/zulip_archive/stream/213817-t-lang/topic/.60let.20pattern.20.3D.20expr.20else.20.7B.20.2E.2E.2E.20.7D.60.20statements.html#242652636">(Jun 14 2021 at 20:08)</a>:</h4>
<p>I don't think I'd ever want <code>if let Pat(x) = expr() || </code> in general, for the same reason that I don't want to use <code>if !let Pat(x)</code> instead of <code>let</code>-<code>else</code>.</p>



<a name="242652659"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/%60let%20pattern%20%3D%20expr%20else%20%7B%20...%20%7D%60%20statements/near/242652659" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Triplett <a href="https://rust-lang.github.io/zulip_archive/stream/213817-t-lang/topic/.60let.20pattern.20.3D.20expr.20else.20.7B.20.2E.2E.2E.20.7D.60.20statements.html#242652659">(Jun 14 2021 at 20:08)</a>:</h4>
<p>It's absolutely possible for the compiler to figure out the rules for which bindings apply where.</p>



<a name="242652687"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/%60let%20pattern%20%3D%20expr%20else%20%7B%20...%20%7D%60%20statements/near/242652687" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Triplett <a href="https://rust-lang.github.io/zulip_archive/stream/213817-t-lang/topic/.60let.20pattern.20.3D.20expr.20else.20.7B.20.2E.2E.2E.20.7D.60.20statements.html#242652687">(Jun 14 2021 at 20:08)</a>:</h4>
<p>It's not, on the other hand, straightforward for the <em>human</em> to figure out those rules in arbitrary code.</p>



<a name="242652741"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/%60let%20pattern%20%3D%20expr%20else%20%7B%20...%20%7D%60%20statements/near/242652741" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Triplett <a href="https://rust-lang.github.io/zulip_archive/stream/213817-t-lang/topic/.60let.20pattern.20.3D.20expr.20else.20.7B.20.2E.2E.2E.20.7D.60.20statements.html#242652741">(Jun 14 2021 at 20:09)</a>:</h4>
<p>I like <code>if let ... &amp;&amp; cond &amp;&amp; let ... </code> because the bindings all build on each other one after another, and each one exists after the corresponding part of the expression.</p>



<a name="242652792"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/%60let%20pattern%20%3D%20expr%20else%20%7B%20...%20%7D%60%20statements/near/242652792" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Triplett <a href="https://rust-lang.github.io/zulip_archive/stream/213817-t-lang/topic/.60let.20pattern.20.3D.20expr.20else.20.7B.20.2E.2E.2E.20.7D.60.20statements.html#242652792">(Jun 14 2021 at 20:09)</a>:</h4>
<p>We talked about <code>||</code> back when we talked about <code>if</code>-<code>let</code> chains, and I had the same thought back then: we could, but we shouldn't.</p>



<a name="242666524"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/%60let%20pattern%20%3D%20expr%20else%20%7B%20...%20%7D%60%20statements/near/242666524" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jeremiah Senkpiel <a href="https://rust-lang.github.io/zulip_archive/stream/213817-t-lang/topic/.60let.20pattern.20.3D.20expr.20else.20.7B.20.2E.2E.2E.20.7D.60.20statements.html#242666524">(Jun 14 2021 at 22:25)</a>:</h4>
<p>I do think that same thing was much more difficult to write without <code>||</code>, and wasn't much clearer. I have no evidence that the kind of code where this is applicable is at all prevalent or good practice though.</p>



<a name="242667834"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/%60let%20pattern%20%3D%20expr%20else%20%7B%20...%20%7D%60%20statements/near/242667834" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jeremiah Senkpiel <a href="https://rust-lang.github.io/zulip_archive/stream/213817-t-lang/topic/.60let.20pattern.20.3D.20expr.20else.20.7B.20.2E.2E.2E.20.7D.60.20statements.html#242667834">(Jun 14 2021 at 22:41)</a>:</h4>
<p>Also just noting that if-let-chains also has problems if <code>&amp;&amp;</code> is ever overload-able.</p>



<a name="242670122"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/%60let%20pattern%20%3D%20expr%20else%20%7B%20...%20%7D%60%20statements/near/242670122" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> scottmcm <a href="https://rust-lang.github.io/zulip_archive/stream/213817-t-lang/topic/.60let.20pattern.20.3D.20expr.20else.20.7B.20.2E.2E.2E.20.7D.60.20statements.html#242670122">(Jun 14 2021 at 23:09)</a>:</h4>
<p><span class="user-mention silent" data-user-id="319552">Jeremiah Senkpiel</span> <a href="#narrow/stream/213817-t-lang/topic/.60let.20pattern.20.3D.20expr.20else.20.7B.20.2E.2E.2E.20.7D.60.20statements/near/242667834">said</a>:</p>
<blockquote>
<p>Also just noting that if-let-chains also has problems if <code>&amp;&amp;</code> is ever overload-able.</p>
</blockquote>
<p>I think that depends on how it's overloadable.  If <code>a &amp;&amp; b</code> desugars to something like <code>match Something::something(a)</code>, then the binding lifetimes could still be clear.</p>



<a name="242670264"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/%60let%20pattern%20%3D%20expr%20else%20%7B%20...%20%7D%60%20statements/near/242670264" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> scottmcm <a href="https://rust-lang.github.io/zulip_archive/stream/213817-t-lang/topic/.60let.20pattern.20.3D.20expr.20else.20.7B.20.2E.2E.2E.20.7D.60.20statements.html#242670264">(Jun 14 2021 at 23:10)</a>:</h4>
<p>Like <code>a &amp;&amp; b</code> is <code>if let false = a { false } else { b }</code>, so if it was allowed on Options as <code>if let None = a { None } else { b }</code> that feels like it'd still work fine for bindings.</p>



<a name="242822531"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/%60let%20pattern%20%3D%20expr%20else%20%7B%20...%20%7D%60%20statements/near/242822531" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Triplett <a href="https://rust-lang.github.io/zulip_archive/stream/213817-t-lang/topic/.60let.20pattern.20.3D.20expr.20else.20.7B.20.2E.2E.2E.20.7D.60.20statements.html#242822531">(Jun 16 2021 at 02:11)</a>:</h4>
<p><span class="user-mention" data-user-id="319552">@Jeremiah Senkpiel</span> Could you please add <code>let</code>-<code>else</code>-<code>else</code> to the "future possibilities" section, with the explanation that it could be added as a future extension?</p>



<a name="242823370"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/%60let%20pattern%20%3D%20expr%20else%20%7B%20...%20%7D%60%20statements/near/242823370" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jeremiah Senkpiel <a href="https://rust-lang.github.io/zulip_archive/stream/213817-t-lang/topic/.60let.20pattern.20.3D.20expr.20else.20.7B.20.2E.2E.2E.20.7D.60.20statements.html#242823370">(Jun 16 2021 at 02:27)</a>:</h4>
<p>I’ve been meaning to, will try to get to it tomorrow or Thursday.</p>



<a name="242823445"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/%60let%20pattern%20%3D%20expr%20else%20%7B%20...%20%7D%60%20statements/near/242823445" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Triplett <a href="https://rust-lang.github.io/zulip_archive/stream/213817-t-lang/topic/.60let.20pattern.20.3D.20expr.20else.20.7B.20.2E.2E.2E.20.7D.60.20statements.html#242823445">(Jun 16 2021 at 02:28)</a>:</h4>
<p>No rush.</p>



<a name="242823448"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/%60let%20pattern%20%3D%20expr%20else%20%7B%20...%20%7D%60%20statements/near/242823448" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Triplett <a href="https://rust-lang.github.io/zulip_archive/stream/213817-t-lang/topic/.60let.20pattern.20.3D.20expr.20else.20.7B.20.2E.2E.2E.20.7D.60.20statements.html#242823448">(Jun 16 2021 at 02:28)</a>:</h4>
<p>Just asking because once that's present, I'm inclined to try proposing FCP.</p>



<a name="242823758"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/%60let%20pattern%20%3D%20expr%20else%20%7B%20...%20%7D%60%20statements/near/242823758" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Triplett <a href="https://rust-lang.github.io/zulip_archive/stream/213817-t-lang/topic/.60let.20pattern.20.3D.20expr.20else.20.7B.20.2E.2E.2E.20.7D.60.20statements.html#242823758">(Jun 16 2021 at 02:34)</a>:</h4>
<p>(That and the comment I made about prohibiting <code>if let pat = expr else { ... diverge ... } { ... }</code>.)</p>



<a name="242824435"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/%60let%20pattern%20%3D%20expr%20else%20%7B%20...%20%7D%60%20statements/near/242824435" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jeremiah Senkpiel <a href="https://rust-lang.github.io/zulip_archive/stream/213817-t-lang/topic/.60let.20pattern.20.3D.20expr.20else.20.7B.20.2E.2E.2E.20.7D.60.20statements.html#242824435">(Jun 16 2021 at 02:48)</a>:</h4>
<p>That would need to be explicitly included because if-let is not a let statement, but I can note it anyways.</p>



<a name="242825360"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/%60let%20pattern%20%3D%20expr%20else%20%7B%20...%20%7D%60%20statements/near/242825360" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Mario Carneiro <a href="https://rust-lang.github.io/zulip_archive/stream/213817-t-lang/topic/.60let.20pattern.20.3D.20expr.20else.20.7B.20.2E.2E.2E.20.7D.60.20statements.html#242825360">(Jun 16 2021 at 03:06)</a>:</h4>
<p><span class="user-mention silent" data-user-id="239881">Josh Triplett</span> <a href="#narrow/stream/213817-t-lang/topic/.60let.20pattern.20.3D.20expr.20else.20.7B.20.2E.2E.2E.20.7D.60.20statements/near/242823758">said</a>:</p>
<blockquote>
<p>(That and the comment I made about prohibiting <code>if let pat = expr else { ... diverge ... } { ... }</code>.)</p>
</blockquote>
<p>How does that parse? It looks like an <code>if let</code> but it's missing a body</p>



<a name="243097661"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/%60let%20pattern%20%3D%20expr%20else%20%7B%20...%20%7D%60%20statements/near/243097661" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jeremiah Senkpiel <a href="https://rust-lang.github.io/zulip_archive/stream/213817-t-lang/topic/.60let.20pattern.20.3D.20expr.20else.20.7B.20.2E.2E.2E.20.7D.60.20statements.html#243097661">(Jun 17 2021 at 23:15)</a>:</h4>
<p><span class="user-mention" data-user-id="239881">@Josh Triplett</span> Which of these were you suggesting?</p>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="kd">let</span><span class="w"> </span><span class="o">..</span><span class="p">.</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="n">b</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="n">c</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="o">!</span><span class="w"> </span><span class="p">};</span><span class="w"></span>
</code></pre></div>
<p>or </p>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="kd">let</span><span class="w"> </span><span class="o">..</span><span class="p">.</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">b</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">c</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="o">!</span><span class="w"> </span><span class="p">};</span><span class="w"></span>
</code></pre></div>



<a name="243097940"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/%60let%20pattern%20%3D%20expr%20else%20%7B%20...%20%7D%60%20statements/near/243097940" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jeremiah Senkpiel <a href="https://rust-lang.github.io/zulip_archive/stream/213817-t-lang/topic/.60let.20pattern.20.3D.20expr.20else.20.7B.20.2E.2E.2E.20.7D.60.20statements.html#243097940">(Jun 17 2021 at 23:19)</a>:</h4>
<p>I really don't like this. I would rather have <code>||</code> in pattern matching - even if <code>||</code>-patterns could be refutable, such as still needing let-else:</p>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="kd">let</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="o">||</span><span class="w"> </span><span class="n">b</span><span class="w"> </span><span class="o">||</span><span class="w"> </span><span class="n">c</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="o">!</span><span class="w"> </span><span class="p">};</span><span class="w"></span>
</code></pre></div>



<a name="243098247"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/%60let%20pattern%20%3D%20expr%20else%20%7B%20...%20%7D%60%20statements/near/243098247" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jeremiah Senkpiel <a href="https://rust-lang.github.io/zulip_archive/stream/213817-t-lang/topic/.60let.20pattern.20.3D.20expr.20else.20.7B.20.2E.2E.2E.20.7D.60.20statements.html#243098247">(Jun 17 2021 at 23:22)</a>:</h4>
<p>I presume you mean the former, this reads... eeeeh, ok I guess:</p>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="kd">let</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">None</span><span class="p">;</span><span class="w"></span>
<span class="kd">let</span><span class="w"> </span><span class="n">b</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">Some</span><span class="p">(</span><span class="mi">42</span><span class="p">);</span><span class="w"></span>

<span class="kd">let</span><span class="w"> </span><span class="nb">Some</span><span class="p">(</span><span class="n">x</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="n">b</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="o">!</span><span class="w"> </span><span class="p">};</span><span class="w"></span>
</code></pre></div>



<a name="243098294"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/%60let%20pattern%20%3D%20expr%20else%20%7B%20...%20%7D%60%20statements/near/243098294" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jeremiah Senkpiel <a href="https://rust-lang.github.io/zulip_archive/stream/213817-t-lang/topic/.60let.20pattern.20.3D.20expr.20else.20.7B.20.2E.2E.2E.20.7D.60.20statements.html#243098294">(Jun 17 2021 at 23:23)</a>:</h4>
<p>Alternative is:</p>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="kd">let</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">None</span><span class="p">;</span><span class="w"></span>
<span class="kd">let</span><span class="w"> </span><span class="n">b</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">Some</span><span class="p">(</span><span class="mi">42</span><span class="p">);</span><span class="w"></span>

<span class="kd">let</span><span class="w"> </span><span class="nb">Some</span><span class="p">(</span><span class="n">x</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="o">||</span><span class="w"> </span><span class="n">b</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="o">!</span><span class="w"> </span><span class="p">};</span><span class="w"></span>
</code></pre></div>



<a name="243100800"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/%60let%20pattern%20%3D%20expr%20else%20%7B%20...%20%7D%60%20statements/near/243100800" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jeremiah Senkpiel <a href="https://rust-lang.github.io/zulip_archive/stream/213817-t-lang/topic/.60let.20pattern.20.3D.20expr.20else.20.7B.20.2E.2E.2E.20.7D.60.20statements.html#243100800">(Jun 17 2021 at 23:59)</a>:</h4>
<p>Ok, RFC has gotten another round of updates.</p>



<a name="243265430"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/%60let%20pattern%20%3D%20expr%20else%20%7B%20...%20%7D%60%20statements/near/243265430" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Triplett <a href="https://rust-lang.github.io/zulip_archive/stream/213817-t-lang/topic/.60let.20pattern.20.3D.20expr.20else.20.7B.20.2E.2E.2E.20.7D.60.20statements.html#243265430">(Jun 19 2021 at 19:36)</a>:</h4>
<p>So, I definitely don't want to do either; it's just an issue of recording an alternative.</p>



<a name="243265512"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/%60let%20pattern%20%3D%20expr%20else%20%7B%20...%20%7D%60%20statements/near/243265512" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Triplett <a href="https://rust-lang.github.io/zulip_archive/stream/213817-t-lang/topic/.60let.20pattern.20.3D.20expr.20else.20.7B.20.2E.2E.2E.20.7D.60.20statements.html#243265512">(Jun 19 2021 at 19:38)</a>:</h4>
<p>If we were going to do either, I would prefer the braces. But I don't think we should do either of those. :)</p>



<a name="243597252"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/%60let%20pattern%20%3D%20expr%20else%20%7B%20...%20%7D%60%20statements/near/243597252" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jeremiah Senkpiel <a href="https://rust-lang.github.io/zulip_archive/stream/213817-t-lang/topic/.60let.20pattern.20.3D.20expr.20else.20.7B.20.2E.2E.2E.20.7D.60.20statements.html#243597252">(Jun 23 2021 at 01:09)</a>:</h4>
<p>Can I still make minor updates / corrections under the proposed fcp / disposition-merge?</p>



<a name="243599240"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/%60let%20pattern%20%3D%20expr%20else%20%7B%20...%20%7D%60%20statements/near/243599240" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Triplett <a href="https://rust-lang.github.io/zulip_archive/stream/213817-t-lang/topic/.60let.20pattern.20.3D.20expr.20else.20.7B.20.2E.2E.2E.20.7D.60.20statements.html#243599240">(Jun 23 2021 at 01:48)</a>:</h4>
<p><span class="user-mention" data-user-id="319552">@Jeremiah Senkpiel</span> Absolutely. Feel free to make minor updates, corrections, or for that matter incorporations of other "alternative approaches".</p>



<a name="243599250"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/%60let%20pattern%20%3D%20expr%20else%20%7B%20...%20%7D%60%20statements/near/243599250" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Triplett <a href="https://rust-lang.github.io/zulip_archive/stream/213817-t-lang/topic/.60let.20pattern.20.3D.20expr.20else.20.7B.20.2E.2E.2E.20.7D.60.20statements.html#243599250">(Jun 23 2021 at 01:48)</a>:</h4>
<p>If you make any non-minor changes or corrections that you think would affect our review, please do call our attention to them.</p>



<a name="243695986"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/%60let%20pattern%20%3D%20expr%20else%20%7B%20...%20%7D%60%20statements/near/243695986" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Cameron Steffen <a href="https://rust-lang.github.io/zulip_archive/stream/213817-t-lang/topic/.60let.20pattern.20.3D.20expr.20else.20.7B.20.2E.2E.2E.20.7D.60.20statements.html#243695986">(Jun 23 2021 at 18:48)</a>:</h4>
<p>Me again. I think the RFC needs to address type annotations. They seem to be disallowed but I don't know if that's intentional?</p>



<a name="243700683"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/%60let%20pattern%20%3D%20expr%20else%20%7B%20...%20%7D%60%20statements/near/243700683" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Mario Carneiro <a href="https://rust-lang.github.io/zulip_archive/stream/213817-t-lang/topic/.60let.20pattern.20.3D.20expr.20else.20.7B.20.2E.2E.2E.20.7D.60.20statements.html#243700683">(Jun 23 2021 at 19:28)</a>:</h4>
<p>I guess the rule should be the same as for let: <code>let PAT (: TY)? = EXPR else BLOCK;</code></p>



<a name="243700785"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/%60let%20pattern%20%3D%20expr%20else%20%7B%20...%20%7D%60%20statements/near/243700785" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Mario Carneiro <a href="https://rust-lang.github.io/zulip_archive/stream/213817-t-lang/topic/.60let.20pattern.20.3D.20expr.20else.20.7B.20.2E.2E.2E.20.7D.60.20statements.html#243700785">(Jun 23 2021 at 19:29)</a>:</h4>
<p>although really this should be handled by type ascriptions in patterns so you get this automatically</p>



<a name="243708230"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/%60let%20pattern%20%3D%20expr%20else%20%7B%20...%20%7D%60%20statements/near/243708230" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Triplett <a href="https://rust-lang.github.io/zulip_archive/stream/213817-t-lang/topic/.60let.20pattern.20.3D.20expr.20else.20.7B.20.2E.2E.2E.20.7D.60.20statements.html#243708230">(Jun 23 2021 at 20:29)</a>:</h4>
<p><span class="user-mention silent" data-user-id="360405">Cameron Steffen</span> <a href="#narrow/stream/213817-t-lang/topic/.60let.20pattern.20.3D.20expr.20else.20.7B.20.2E.2E.2E.20.7D.60.20statements/near/243695986">said</a>:</p>
<blockquote>
<p>Me again. I think the RFC needs to address type annotations. They seem to be disallowed but I don't know if that's intentional?</p>
</blockquote>
<p>I'd guess that's an accident of not having an exact grammar for existing let statements.</p>



<a name="243708313"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/%60let%20pattern%20%3D%20expr%20else%20%7B%20...%20%7D%60%20statements/near/243708313" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Triplett <a href="https://rust-lang.github.io/zulip_archive/stream/213817-t-lang/topic/.60let.20pattern.20.3D.20expr.20else.20.7B.20.2E.2E.2E.20.7D.60.20statements.html#243708313">(Jun 23 2021 at 20:30)</a>:</h4>
<p>let-else should absolutely allow type annotations.</p>



<a name="243711672"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/%60let%20pattern%20%3D%20expr%20else%20%7B%20...%20%7D%60%20statements/near/243711672" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Mario Carneiro <a href="https://rust-lang.github.io/zulip_archive/stream/213817-t-lang/topic/.60let.20pattern.20.3D.20expr.20else.20.7B.20.2E.2E.2E.20.7D.60.20statements.html#243711672">(Jun 23 2021 at 20:55)</a>:</h4>
<p>Interestingly, <code>if let</code> <em>doesn't</em> allow type annotations there</p>



<a name="243714082"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/%60let%20pattern%20%3D%20expr%20else%20%7B%20...%20%7D%60%20statements/near/243714082" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> scottmcm <a href="https://rust-lang.github.io/zulip_archive/stream/213817-t-lang/topic/.60let.20pattern.20.3D.20expr.20else.20.7B.20.2E.2E.2E.20.7D.60.20statements.html#243714082">(Jun 23 2021 at 21:17)</a>:</h4>
<p>Type annotations are a bit weird here, since it's <code>let Some(x): Option&lt;i32&gt; =</code> not <code>let x: Option&lt;i32&gt; =</code>.</p>



<a name="243714314"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/%60let%20pattern%20%3D%20expr%20else%20%7B%20...%20%7D%60%20statements/near/243714314" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> scottmcm <a href="https://rust-lang.github.io/zulip_archive/stream/213817-t-lang/topic/.60let.20pattern.20.3D.20expr.20else.20.7B.20.2E.2E.2E.20.7D.60.20statements.html#243714314">(Jun 23 2021 at 21:18)</a>:</h4>
<p>I might be tempted to leave ascription off of this for now, and wait for internal ascription, so it could be <code>let Some(x: i32) =</code>, which is way nicer.</p>



<a name="243716029"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/%60let%20pattern%20%3D%20expr%20else%20%7B%20...%20%7D%60%20statements/near/243716029" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Cameron Steffen <a href="https://rust-lang.github.io/zulip_archive/stream/213817-t-lang/topic/.60let.20pattern.20.3D.20expr.20else.20.7B.20.2E.2E.2E.20.7D.60.20statements.html#243716029">(Jun 23 2021 at 21:33)</a>:</h4>
<p>I thought of that, but maybe that would be unnecessary crippling let-else.</p>



<a name="243807500"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/%60let%20pattern%20%3D%20expr%20else%20%7B%20...%20%7D%60%20statements/near/243807500" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Cameron Steffen <a href="https://rust-lang.github.io/zulip_archive/stream/213817-t-lang/topic/.60let.20pattern.20.3D.20expr.20else.20.7B.20.2E.2E.2E.20.7D.60.20statements.html#243807500">(Jun 24 2021 at 15:59)</a>:</h4>
<p>Can I volunteer to implement this?</p>



<a name="243807576"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/%60let%20pattern%20%3D%20expr%20else%20%7B%20...%20%7D%60%20statements/near/243807576" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Triplett <a href="https://rust-lang.github.io/zulip_archive/stream/213817-t-lang/topic/.60let.20pattern.20.3D.20expr.20else.20.7B.20.2E.2E.2E.20.7D.60.20statements.html#243807576">(Jun 24 2021 at 15:59)</a>:</h4>
<p>By all means, if you've got the bandwidth.</p>



<a name="243807608"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/%60let%20pattern%20%3D%20expr%20else%20%7B%20...%20%7D%60%20statements/near/243807608" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Triplett <a href="https://rust-lang.github.io/zulip_archive/stream/213817-t-lang/topic/.60let.20pattern.20.3D.20expr.20else.20.7B.20.2E.2E.2E.20.7D.60.20statements.html#243807608">(Jun 24 2021 at 15:59)</a>:</h4>
<p>I would love to see this in nightly soon.</p>



<a name="243807782"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/%60let%20pattern%20%3D%20expr%20else%20%7B%20...%20%7D%60%20statements/near/243807782" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Cameron Steffen <a href="https://rust-lang.github.io/zulip_archive/stream/213817-t-lang/topic/.60let.20pattern.20.3D.20expr.20else.20.7B.20.2E.2E.2E.20.7D.60.20statements.html#243807782">(Jun 24 2021 at 16:00)</a>:</h4>
<p>I might just have an MVP already :)</p>



<a name="243929529"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/%60let%20pattern%20%3D%20expr%20else%20%7B%20...%20%7D%60%20statements/near/243929529" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jeremiah Senkpiel <a href="https://rust-lang.github.io/zulip_archive/stream/213817-t-lang/topic/.60let.20pattern.20.3D.20expr.20else.20.7B.20.2E.2E.2E.20.7D.60.20statements.html#243929529">(Jun 25 2021 at 15:15)</a>:</h4>
<p>I was hoping to implement it as well as having written the RFC, not sure if I mentioned that. (I’d need help for it for sure though)</p>



<a name="243930193"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/%60let%20pattern%20%3D%20expr%20else%20%7B%20...%20%7D%60%20statements/near/243930193" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jeremiah Senkpiel <a href="https://rust-lang.github.io/zulip_archive/stream/213817-t-lang/topic/.60let.20pattern.20.3D.20expr.20else.20.7B.20.2E.2E.2E.20.7D.60.20statements.html#243930193">(Jun 25 2021 at 15:21)</a>:</h4>
<p>I figured it would probably be simple enough for my first substantial contribution to rustc, since I at least  understand the problem space now <span aria-label="upside down" class="emoji emoji-1f643" role="img" title="upside down">:upside_down:</span></p>



<a name="244033112"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/%60let%20pattern%20%3D%20expr%20else%20%7B%20...%20%7D%60%20statements/near/244033112" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Cameron Steffen <a href="https://rust-lang.github.io/zulip_archive/stream/213817-t-lang/topic/.60let.20pattern.20.3D.20expr.20else.20.7B.20.2E.2E.2E.20.7D.60.20statements.html#244033112">(Jun 26 2021 at 20:35)</a>:</h4>
<p><span class="user-mention" data-user-id="319552">@Jeremiah Senkpiel</span> I think you get first dibs since you put in the work for the RFC. Here is what I have so far if you want to use it. <a href="https://github.com/camsteffen/rust/tree/let-else">https://github.com/camsteffen/rust/tree/let-else</a></p>



<a name="244089571"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/%60let%20pattern%20%3D%20expr%20else%20%7B%20...%20%7D%60%20statements/near/244089571" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jeremiah Senkpiel <a href="https://rust-lang.github.io/zulip_archive/stream/213817-t-lang/topic/.60let.20pattern.20.3D.20expr.20else.20.7B.20.2E.2E.2E.20.7D.60.20statements.html#244089571">(Jun 27 2021 at 23:05)</a>:</h4>
<p>i plan to spend some time tomorrow morning responding to RFC comments and making RFC updates. i’ve been off this week so that was why there was extra delays</p>



<a name="244215115"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/%60let%20pattern%20%3D%20expr%20else%20%7B%20...%20%7D%60%20statements/near/244215115" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jeremiah Senkpiel <a href="https://rust-lang.github.io/zulip_archive/stream/213817-t-lang/topic/.60let.20pattern.20.3D.20expr.20else.20.7B.20.2E.2E.2E.20.7D.60.20statements.html#244215115">(Jun 28 2021 at 22:59)</a>:</h4>
<blockquote>
<p>If the pattern does not match, the expression is not consumed, and so any existing variables from the surrounding scope are<br>
accessible as they would normally be.</p>
</blockquote>
<p>I'm not sure if someone missed this, but can someone confirm this would indeed be possible?</p>



<a name="244217368"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/%60let%20pattern%20%3D%20expr%20else%20%7B%20...%20%7D%60%20statements/near/244217368" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jeremiah Senkpiel <a href="https://rust-lang.github.io/zulip_archive/stream/213817-t-lang/topic/.60let.20pattern.20.3D.20expr.20else.20.7B.20.2E.2E.2E.20.7D.60.20statements.html#244217368">(Jun 28 2021 at 23:30)</a>:</h4>
<p><span class="user-mention" data-user-id="360405">@Cameron Steffen</span> I'll be honest: I don't really understand very much at all about that code.</p>
<p>I may not have time right now anyways, so as much as I'd like to, if you have time I say go for an MVP</p>



<a name="244219073"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/%60let%20pattern%20%3D%20expr%20else%20%7B%20...%20%7D%60%20statements/near/244219073" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Cameron Steffen <a href="https://rust-lang.github.io/zulip_archive/stream/213817-t-lang/topic/.60let.20pattern.20.3D.20expr.20else.20.7B.20.2E.2E.2E.20.7D.60.20statements.html#244219073">(Jun 28 2021 at 23:59)</a>:</h4>
<p>well I think we're waiting for it to get merged for now anyways</p>



<a name="244955130"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/%60let%20pattern%20%3D%20expr%20else%20%7B%20...%20%7D%60%20statements/near/244955130" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jeremiah Senkpiel <a href="https://rust-lang.github.io/zulip_archive/stream/213817-t-lang/topic/.60let.20pattern.20.3D.20expr.20else.20.7B.20.2E.2E.2E.20.7D.60.20statements.html#244955130">(Jul 05 2021 at 16:35)</a>:</h4>
<p>A somewhat non-trivial update may need to be made: disallow patterns which produce no bindings: <a href="https://github.com/rust-lang/rfcs/pull/3137#issuecomment-874228689">https://github.com/rust-lang/rfcs/pull/3137#issuecomment-874228689</a></p>



<a name="244955612"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/%60let%20pattern%20%3D%20expr%20else%20%7B%20...%20%7D%60%20statements/near/244955612" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Triplett <a href="https://rust-lang.github.io/zulip_archive/stream/213817-t-lang/topic/.60let.20pattern.20.3D.20expr.20else.20.7B.20.2E.2E.2E.20.7D.60.20statements.html#244955612">(Jul 05 2021 at 16:41)</a>:</h4>
<p>I added a comment in that regard; while I think it's unusual, I don't think we should prohibit it.</p>



<a name="244965406"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/%60let%20pattern%20%3D%20expr%20else%20%7B%20...%20%7D%60%20statements/near/244965406" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jeremiah Senkpiel <a href="https://rust-lang.github.io/zulip_archive/stream/213817-t-lang/topic/.60let.20pattern.20.3D.20expr.20else.20.7B.20.2E.2E.2E.20.7D.60.20statements.html#244965406">(Jul 05 2021 at 18:57)</a>:</h4>
<p>Does anyone have links about the implications / requirements for introducing a keyword ala <code>guard</code>? I don't really want to make the case for a new keyword but I'd like to at least know what it would take.</p>



<a name="244966910"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/%60let%20pattern%20%3D%20expr%20else%20%7B%20...%20%7D%60%20statements/near/244966910" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> The 8472 <a href="https://rust-lang.github.io/zulip_archive/stream/213817-t-lang/topic/.60let.20pattern.20.3D.20expr.20else.20.7B.20.2E.2E.2E.20.7D.60.20statements.html#244966910">(Jul 05 2021 at 19:19)</a>:</h4>
<p>Well, it would be part of an RFC introducing a new language feature and discussion settling on a new keyword being the best  way to do that. a keyword is more of a byproduct. In the past keywords were reserved preemptively because they might be useful, but iirc that was changed with the editions system where new editions would serve as the point where new keywords could be introduced if needed.</p>



<a name="244968028"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/%60let%20pattern%20%3D%20expr%20else%20%7B%20...%20%7D%60%20statements/near/244968028" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> XAMPPRocky <a href="https://rust-lang.github.io/zulip_archive/stream/213817-t-lang/topic/.60let.20pattern.20.3D.20expr.20else.20.7B.20.2E.2E.2E.20.7D.60.20statements.html#244968028">(Jul 05 2021 at 19:36)</a>:</h4>
<p>Not an entirely serious suggestion, but just reading the RFC and the discussion about the syntax, what about the following? Using <code>match</code> here might make it more clear that pattern matching is going on.</p>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="kd">let</span><span class="w"> </span><span class="nb">Some</span><span class="p">(</span><span class="n">pat</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">match</span><span class="w"> </span><span class="n">expr</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="o">!</span><span class="w"> </span><span class="p">};</span><span class="w"></span>
<span class="c1">// Transforms into</span>
<span class="kd">let</span><span class="w"> </span><span class="n">pat</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">match</span><span class="w"> </span><span class="n">expr</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nb">Some</span><span class="p">(</span><span class="n">pat</span><span class="p">)</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="n">pat</span><span class="p">,</span><span class="w"> </span><span class="n">_</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="o">!</span><span class="p">,</span><span class="w"> </span><span class="p">};</span><span class="w"></span>
</code></pre></div>



<a name="244968598"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/%60let%20pattern%20%3D%20expr%20else%20%7B%20...%20%7D%60%20statements/near/244968598" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> bstrie <a href="https://rust-lang.github.io/zulip_archive/stream/213817-t-lang/topic/.60let.20pattern.20.3D.20expr.20else.20.7B.20.2E.2E.2E.20.7D.60.20statements.html#244968598">(Jul 05 2021 at 19:45)</a>:</h4>
<p>one thing that I hadn't considered yet is that pattern binding is being extended to allow <code>(a, b) = foo;</code>, <em>without</em> a <code>let</code> being involved, and I wonder how that interacts with all this</p>



<a name="244968682"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/%60let%20pattern%20%3D%20expr%20else%20%7B%20...%20%7D%60%20statements/near/244968682" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jeremiah Senkpiel <a href="https://rust-lang.github.io/zulip_archive/stream/213817-t-lang/topic/.60let.20pattern.20.3D.20expr.20else.20.7B.20.2E.2E.2E.20.7D.60.20statements.html#244968682">(Jul 05 2021 at 19:46)</a>:</h4>
<p><span class="user-mention" data-user-id="256342">@bstrie</span> Link(s)?</p>



<a name="244968783"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/%60let%20pattern%20%3D%20expr%20else%20%7B%20...%20%7D%60%20statements/near/244968783" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> bstrie <a href="https://rust-lang.github.io/zulip_archive/stream/213817-t-lang/topic/.60let.20pattern.20.3D.20expr.20else.20.7B.20.2E.2E.2E.20.7D.60.20statements.html#244968783">(Jul 05 2021 at 19:48)</a>:</h4>
<p><a href="https://github.com/rust-lang/rfcs/blob/master/text/2909-destructuring-assignment.md">https://github.com/rust-lang/rfcs/blob/master/text/2909-destructuring-assignment.md</a></p>



<a name="244968820"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/%60let%20pattern%20%3D%20expr%20else%20%7B%20...%20%7D%60%20statements/near/244968820" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> bstrie <a href="https://rust-lang.github.io/zulip_archive/stream/213817-t-lang/topic/.60let.20pattern.20.3D.20expr.20else.20.7B.20.2E.2E.2E.20.7D.60.20statements.html#244968820">(Jul 05 2021 at 19:49)</a>:</h4>
<p>worth noting that this is intended to only allow a hand-picked subset of the pattern syntax on the LHS</p>



<a name="244970230"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/%60let%20pattern%20%3D%20expr%20else%20%7B%20...%20%7D%60%20statements/near/244970230" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> scottmcm <a href="https://rust-lang.github.io/zulip_archive/stream/213817-t-lang/topic/.60let.20pattern.20.3D.20expr.20else.20.7B.20.2E.2E.2E.20.7D.60.20statements.html#244970230">(Jul 05 2021 at 20:09)</a>:</h4>
<p>Note that it's technically a subset of expression syntax on the LHS; it doesn't use the pattern grammar.</p>



<a name="244970613"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/%60let%20pattern%20%3D%20expr%20else%20%7B%20...%20%7D%60%20statements/near/244970613" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> bstrie <a href="https://rust-lang.github.io/zulip_archive/stream/213817-t-lang/topic/.60let.20pattern.20.3D.20expr.20else.20.7B.20.2E.2E.2E.20.7D.60.20statements.html#244970613">(Jul 05 2021 at 20:15)</a>:</h4>
<p><span class="user-mention" data-user-id="219696">@XAMPPRocky</span> 's suggestion wouldn't be extremely disruptive, but it's worth nothing that <code>let</code> already always indicates a pattern matching context, and maybe it's not necessary to further emphasize that pattern matching is going on. Rather than emphasizing that pattern matching is happening, I think that what needs emphasizing is that a refutable pattern is allowed, which is what the proposed <code>else</code> is for, and while I'm not completely without misgivings WRT <code>else</code> I also don't exactly dislike it.</p>



<a name="244970729"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/%60let%20pattern%20%3D%20expr%20else%20%7B%20...%20%7D%60%20statements/near/244970729" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> bstrie <a href="https://rust-lang.github.io/zulip_archive/stream/213817-t-lang/topic/.60let.20pattern.20.3D.20expr.20else.20.7B.20.2E.2E.2E.20.7D.60.20statements.html#244970729">(Jul 05 2021 at 20:17)</a>:</h4>
<p>I am convinced now that the equivalent of if-let-chains should be ensured to be compatible with this feature, and though I see some language in the RFC indicating that it is probably compatible, I'd like someone more sure to weigh in</p>



<a name="244970773"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/%60let%20pattern%20%3D%20expr%20else%20%7B%20...%20%7D%60%20statements/near/244970773" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> XAMPPRocky <a href="https://rust-lang.github.io/zulip_archive/stream/213817-t-lang/topic/.60let.20pattern.20.3D.20expr.20else.20.7B.20.2E.2E.2E.20.7D.60.20statements.html#244970773">(Jul 05 2021 at 20:17)</a>:</h4>
<p>Sure, though <code>let</code>’s patterns is irrefutable where as <code>match</code> implies some pattern that has two or more variants</p>



<a name="244970884"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/%60let%20pattern%20%3D%20expr%20else%20%7B%20...%20%7D%60%20statements/near/244970884" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> bstrie <a href="https://rust-lang.github.io/zulip_archive/stream/213817-t-lang/topic/.60let.20pattern.20.3D.20expr.20else.20.7B.20.2E.2E.2E.20.7D.60.20statements.html#244970884">(Jul 05 2021 at 20:19)</a>:</h4>
<p>well it's refutable unless it's an <code>if let</code>. maybe we should have indicated that that form allows refutable patterns by having the syntax <code>if let? pat</code>, and then we could have done <code>let? pat</code> here</p>



<a name="244971010"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/%60let%20pattern%20%3D%20expr%20else%20%7B%20...%20%7D%60%20statements/near/244971010" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> bstrie <a href="https://rust-lang.github.io/zulip_archive/stream/213817-t-lang/topic/.60let.20pattern.20.3D.20expr.20else.20.7B.20.2E.2E.2E.20.7D.60.20statements.html#244971010">(Jul 05 2021 at 20:20)</a>:</h4>
<p>but then again that wouldn't help with the destructuring assignment RFC, where there's no <code>let</code> in sight at all</p>



<a name="244973248"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/%60let%20pattern%20%3D%20expr%20else%20%7B%20...%20%7D%60%20statements/near/244973248" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> bstrie <a href="https://rust-lang.github.io/zulip_archive/stream/213817-t-lang/topic/.60let.20pattern.20.3D.20expr.20else.20.7B.20.2E.2E.2E.20.7D.60.20statements.html#244973248">(Jul 05 2021 at 20:51)</a>:</h4>
<p>if people are worried that it's too easy to overlook the <code>else</code> then there's still the option of <code>else return</code>, which would syntactically disambiguate this from <code>if</code></p>



<a name="244974495"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/%60let%20pattern%20%3D%20expr%20else%20%7B%20...%20%7D%60%20statements/near/244974495" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> bstrie <a href="https://rust-lang.github.io/zulip_archive/stream/213817-t-lang/topic/.60let.20pattern.20.3D.20expr.20else.20.7B.20.2E.2E.2E.20.7D.60.20statements.html#244974495">(Jul 05 2021 at 21:09)</a>:</h4>
<p><span class="user-mention" data-user-id="319552">@Jeremiah Senkpiel</span> having only given it brief thought, I don't think there should be any reason that this feature wouldn't also be applicable to destructuring assignment with the same syntax, i.e. <code>(a, b) = foo else {</code> (although with the same restrictions about what <code>foo</code> can be). I don't think that also needs to be a part of this proposal, but it is worth mentioning in the future work section.</p>



<a name="244974648"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/%60let%20pattern%20%3D%20expr%20else%20%7B%20...%20%7D%60%20statements/near/244974648" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jeremiah Senkpiel <a href="https://rust-lang.github.io/zulip_archive/stream/213817-t-lang/topic/.60let.20pattern.20.3D.20expr.20else.20.7B.20.2E.2E.2E.20.7D.60.20statements.html#244974648">(Jul 05 2021 at 21:11)</a>:</h4>
<p>This also re-opens questions about if-let-chains, because the previous premise was that it didn't make sense without a starting <code>let</code>, however then one could imagine:</p>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="p">(</span><span class="n">a</span><span class="p">,</span><span class="w"> </span><span class="n">b</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">foo</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="nb">Some</span><span class="p">(</span><span class="n">c</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">bar</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="o">..</span><span class="p">.</span><span class="w"> </span><span class="p">};</span><span class="w"></span>
</code></pre></div>



<a name="244974717"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/%60let%20pattern%20%3D%20expr%20else%20%7B%20...%20%7D%60%20statements/near/244974717" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jeremiah Senkpiel <a href="https://rust-lang.github.io/zulip_archive/stream/213817-t-lang/topic/.60let.20pattern.20.3D.20expr.20else.20.7B.20.2E.2E.2E.20.7D.60.20statements.html#244974717">(Jul 05 2021 at 21:12)</a>:</h4>
<p>(I personally am a not a big fan of that decoupled destructuring, but, oh well i guess.)</p>



<a name="244974815"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/%60let%20pattern%20%3D%20expr%20else%20%7B%20...%20%7D%60%20statements/near/244974815" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jeremiah Senkpiel <a href="https://rust-lang.github.io/zulip_archive/stream/213817-t-lang/topic/.60let.20pattern.20.3D.20expr.20else.20.7B.20.2E.2E.2E.20.7D.60.20statements.html#244974815">(Jul 05 2021 at 21:14)</a>:</h4>
<p>This all makes <code>||</code> pattern-expressions (whatever you want to call that, the counterpart to if-let-chain &amp;&amp;) seem like more of a potential idea in the back of my brain ...</p>



<a name="244974927"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/%60let%20pattern%20%3D%20expr%20else%20%7B%20...%20%7D%60%20statements/near/244974927" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> bstrie <a href="https://rust-lang.github.io/zulip_archive/stream/213817-t-lang/topic/.60let.20pattern.20.3D.20expr.20else.20.7B.20.2E.2E.2E.20.7D.60.20statements.html#244974927">(Jul 05 2021 at 21:16)</a>:</h4>
<p>hm, that's a good point, but also that problem probably also exists for if-let chains as well, and I don't know if anyone's considered that yet. we may need to leave it as an unresolved question, to be resolved before stabilization can occur</p>



<a name="244975669"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/%60let%20pattern%20%3D%20expr%20else%20%7B%20...%20%7D%60%20statements/near/244975669" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Frank Steffahn <a href="https://rust-lang.github.io/zulip_archive/stream/213817-t-lang/topic/.60let.20pattern.20.3D.20expr.20else.20.7B.20.2E.2E.2E.20.7D.60.20statements.html#244975669">(Jul 05 2021 at 21:30)</a>:</h4>
<p>I feel like destructuring assignment would need an <code>if let</code>-style expression, too, if it’s supposed to be supported in a <code>let else</code>-style statement. <code>if let</code>-style means: basically just <em>some</em> way to use refutable patterns and <em>some</em> way check for success. There’s always the question of how failure works for this, I’d personally assume a “match everything first, then write everything” strategy to be the most natural, where it’s “all or nothing” regarding on which assignments happened if only some parts of the pattern match. (The alternative could be some form of left-to-right progression, stopping at the first failure, but leaving everything up to that point assigned.)</p>
<p>This becomes harder / impossible with an <code>if let</code>-chain-style expression though, because one would expect subsequent parts of the chain to be able to “see” previous results. </p>
<p>I don’t feel like this extension to desctucturing assignment is best discussed in a <code>let else</code>-style context first because that would already be combining multiple things IMO. I do however think that some “sanity check” on whether there’s any sensible way to adapt the syntax from <code>let</code> to destructuring assignment is reasonable.</p>



<a name="244975904"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/%60let%20pattern%20%3D%20expr%20else%20%7B%20...%20%7D%60%20statements/near/244975904" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> bstrie <a href="https://rust-lang.github.io/zulip_archive/stream/213817-t-lang/topic/.60let.20pattern.20.3D.20expr.20else.20.7B.20.2E.2E.2E.20.7D.60.20statements.html#244975904">(Jul 05 2021 at 21:35)</a>:</h4>
<p>I suppose it's too late to make assignment expressions evaluate to bool instead of unit, and indicate whether their pattern matched :P</p>



<a name="244995981"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/%60let%20pattern%20%3D%20expr%20else%20%7B%20...%20%7D%60%20statements/near/244995981" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Triplett <a href="https://rust-lang.github.io/zulip_archive/stream/213817-t-lang/topic/.60let.20pattern.20.3D.20expr.20else.20.7B.20.2E.2E.2E.20.7D.60.20statements.html#244995981">(Jul 06 2021 at 05:04)</a>:</h4>
<p><span class="user-mention" data-user-id="319552">@Jeremiah Senkpiel</span> I agree that it's worth listing an extra keyword as an alternative, even though we don't want to go that way.</p>



<a name="244995995"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/%60let%20pattern%20%3D%20expr%20else%20%7B%20...%20%7D%60%20statements/near/244995995" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Triplett <a href="https://rust-lang.github.io/zulip_archive/stream/213817-t-lang/topic/.60let.20pattern.20.3D.20expr.20else.20.7B.20.2E.2E.2E.20.7D.60.20statements.html#244995995">(Jul 06 2021 at 05:05)</a>:</h4>
<p>With the new reserved syntax proposal, adding a keyword would be as simple as using <code>k#guard</code> for now, and then introducing the new keyword in a future edition.</p>



<a name="245028615"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/%60let%20pattern%20%3D%20expr%20else%20%7B%20...%20%7D%60%20statements/near/245028615" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Frank Steffahn <a href="https://rust-lang.github.io/zulip_archive/stream/213817-t-lang/topic/.60let.20pattern.20.3D.20expr.20else.20.7B.20.2E.2E.2E.20.7D.60.20statements.html#245028615">(Jul 06 2021 at 12:05)</a>:</h4>
<p>Assignment expressions evaluating to unit (instead of e.g. bool) is needed to making writing <code>if x = 42</code> instead of <code>if x == 42</code> a compilation error. Avoiding the <code>==</code> vs <code>=</code> bug is a great feature of Rust that we’ll never want to remove. <span class="user-mention" data-user-id="256342">@bstrie</span></p>



<a name="245056055"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/%60let%20pattern%20%3D%20expr%20else%20%7B%20...%20%7D%60%20statements/near/245056055" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> bstrie <a href="https://rust-lang.github.io/zulip_archive/stream/213817-t-lang/topic/.60let.20pattern.20.3D.20expr.20else.20.7B.20.2E.2E.2E.20.7D.60.20statements.html#245056055">(Jul 06 2021 at 15:33)</a>:</h4>
<p><span class="user-mention" data-user-id="280891">@Frank Steffahn</span>  yes, that occurred to me after I sent that. I think that argument alone suffices to guarantee that we can safely ignore destructuring assignment ever working with these conditional-like refutable pattern matching forms</p>



<a name="245056097"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/%60let%20pattern%20%3D%20expr%20else%20%7B%20...%20%7D%60%20statements/near/245056097" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> bstrie <a href="https://rust-lang.github.io/zulip_archive/stream/213817-t-lang/topic/.60let.20pattern.20.3D.20expr.20else.20.7B.20.2E.2E.2E.20.7D.60.20statements.html#245056097">(Jul 06 2021 at 15:33)</a>:</h4>
<p>at least, not unless we want to replace <code>=</code> with something else :P</p>



<a name="245057899"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/%60let%20pattern%20%3D%20expr%20else%20%7B%20...%20%7D%60%20statements/near/245057899" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> bstrie <a href="https://rust-lang.github.io/zulip_archive/stream/213817-t-lang/topic/.60let.20pattern.20.3D.20expr.20else.20.7B.20.2E.2E.2E.20.7D.60.20statements.html#245057899">(Jul 06 2021 at 15:46)</a>:</h4>
<p>So I've been trying to consider the interaction between let-else and if-let-chaining (or more generally, refutable-let chaining). One of the issues with the if-let chaining RFC was the interaction with <code>&amp;&amp;</code>. Specifically, <code>&amp;&amp;</code> has higher precedence than <code>=</code>, so while the whole point of that RFC was to allow you to do <code>if let Some(y) = x &amp;&amp; foo</code>, this naturally gets parsed as <code>if let Some(y) = (x &amp;&amp; foo)</code>. This was resolved by making <code>=</code> bind more tightly than <code>&amp;&amp;</code> <em>only</em> in <code>if</code> contexts. Thus <code>if let x = y &amp;&amp; z</code> has a different parse than <code>let x = y &amp;&amp; z</code>. That's already kind of a hack. If this were extended to let-else, then that would mean <code>let x = y &amp;&amp; z</code> has a different parse than <code>let x = y &amp;&amp; z else</code>, compounding the hack. Furthermore, while the RFC suggests that at first <code>let x = y &amp;&amp; z else</code> would just become a syntax error until the details are worked out (which is how <code>if let x = y &amp;&amp; z</code> was treated, and remains to this day), unlike if-let, let-else has to use unbounded lookahead to determine whether it's in a <code>let</code> or a let-else context, which I believe Rust has tried to avoid.</p>



<a name="245062188"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/%60let%20pattern%20%3D%20expr%20else%20%7B%20...%20%7D%60%20statements/near/245062188" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jeremiah Senkpiel <a href="https://rust-lang.github.io/zulip_archive/stream/213817-t-lang/topic/.60let.20pattern.20.3D.20expr.20else.20.7B.20.2E.2E.2E.20.7D.60.20statements.html#245062188">(Jul 06 2021 at 16:12)</a>:</h4>
<p>if-let-chains feels like it should use different syntax than <code>&amp;&amp;</code>, honestly.</p>



<a name="245062426"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/%60let%20pattern%20%3D%20expr%20else%20%7B%20...%20%7D%60%20statements/near/245062426" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> bstrie <a href="https://rust-lang.github.io/zulip_archive/stream/213817-t-lang/topic/.60let.20pattern.20.3D.20expr.20else.20.7B.20.2E.2E.2E.20.7D.60.20statements.html#245062426">(Jul 06 2021 at 16:14)</a>:</h4>
<p>I recommend you read the if-let-chain RFC, it goes over many options and includes survey results from users. People intuitively like <code>&amp;&amp;</code>, but there's no doubt that it causes some problems. Swift uses <code>,</code> for this.</p>



<a name="245069591"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/%60let%20pattern%20%3D%20expr%20else%20%7B%20...%20%7D%60%20statements/near/245069591" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> scottmcm <a href="https://rust-lang.github.io/zulip_archive/stream/213817-t-lang/topic/.60let.20pattern.20.3D.20expr.20else.20.7B.20.2E.2E.2E.20.7D.60.20statements.html#245069591">(Jul 06 2021 at 17:11)</a>:</h4>
<p>It does feel unsurprising to me that a survey would say "well <code>&amp;&amp;</code> seems reasonable", so I'm unsure how much weight to give it if there are troubles that it causes.</p>
<p>I recall arguing in favour of <code>,</code> at the time.  Interesting to know that's what Swift uses.</p>
<p>I forget, does if-let-chain allow nesting <code>||</code>s in parens?  If that's supposed to work, it would be harder to find something to fit with <code>,</code>.</p>



<a name="245069694"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/%60let%20pattern%20%3D%20expr%20else%20%7B%20...%20%7D%60%20statements/near/245069694" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> bstrie <a href="https://rust-lang.github.io/zulip_archive/stream/213817-t-lang/topic/.60let.20pattern.20.3D.20expr.20else.20.7B.20.2E.2E.2E.20.7D.60.20statements.html#245069694">(Jul 06 2021 at 17:12)</a>:</h4>
<p>the if-let-chain RFC does not specify behavior for <code>||</code>, but does deliberately leave the door open for that syntax in the future</p>



<a name="245070203"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/%60let%20pattern%20%3D%20expr%20else%20%7B%20...%20%7D%60%20statements/near/245070203" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> bstrie <a href="https://rust-lang.github.io/zulip_archive/stream/213817-t-lang/topic/.60let.20pattern.20.3D.20expr.20else.20.7B.20.2E.2E.2E.20.7D.60.20statements.html#245070203">(Jul 06 2021 at 17:16)</a>:</h4>
<p>I fear that I am drawing the conclusion that the "proper" way to solve this RFC might be to introduce a broader notion of a refutable let somehow, which would impact all existing <code>if let</code> in the wild. Something like <code>let? pat = expr</code> or <code>let try pat = expr</code> or <code>let pat =? expr</code> or <code>let pat match? expr</code>. It's not like such a mass syntax migration hasn't happened before (with <code>dyn Trait</code>), and it could be mechanically automated, but still...</p>



<a name="245070519"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/%60let%20pattern%20%3D%20expr%20else%20%7B%20...%20%7D%60%20statements/near/245070519" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> bstrie <a href="https://rust-lang.github.io/zulip_archive/stream/213817-t-lang/topic/.60let.20pattern.20.3D.20expr.20else.20.7B.20.2E.2E.2E.20.7D.60.20statements.html#245070519">(Jul 06 2021 at 17:18)</a>:</h4>
<p>(although with the upside that if such a "refutable pattern" construct was an expression that returned bool, it would subsume the <code>matches!</code> macro)</p>



<a name="245070809"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/%60let%20pattern%20%3D%20expr%20else%20%7B%20...%20%7D%60%20statements/near/245070809" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> scottmcm <a href="https://rust-lang.github.io/zulip_archive/stream/213817-t-lang/topic/.60let.20pattern.20.3D.20expr.20else.20.7B.20.2E.2E.2E.20.7D.60.20statements.html#245070809">(Jul 06 2021 at 17:21)</a>:</h4>
<p>We've long discussed the possibility of just <code>is</code>, like <code>if y is Some(x) {</code>.</p>
<p>If we can figure out how the scoping for that should be, I'd love to have it.  (With shadowing and such I suspect the exact details will end up being relied upon.)</p>



<a name="245070903"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/%60let%20pattern%20%3D%20expr%20else%20%7B%20...%20%7D%60%20statements/near/245070903" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> bstrie <a href="https://rust-lang.github.io/zulip_archive/stream/213817-t-lang/topic/.60let.20pattern.20.3D.20expr.20else.20.7B.20.2E.2E.2E.20.7D.60.20statements.html#245070903">(Jul 06 2021 at 17:21)</a>:</h4>
<p>I don't think that works for this RFC though, which really wants a <code>let</code> somewhere in order to re-use the existing notion of "we're introducing a binding into this scope", and if you're using <code>let</code> you want the bindings on the left, not on the right</p>



<a name="245071759"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/%60let%20pattern%20%3D%20expr%20else%20%7B%20...%20%7D%60%20statements/near/245071759" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> bstrie <a href="https://rust-lang.github.io/zulip_archive/stream/213817-t-lang/topic/.60let.20pattern.20.3D.20expr.20else.20.7B.20.2E.2E.2E.20.7D.60.20statements.html#245071759">(Jul 06 2021 at 17:28)</a>:</h4>
<p>I also think there's a good argument against <code>,</code> for <code>&amp;&amp;</code>, since in <code>match</code> we use <code>,</code> after match arms to indicate the exact opposite, "if you <em>didn't</em> match the previous, then try this". So then <code>,</code> is closer to <code>||</code></p>



<a name="245072130"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/%60let%20pattern%20%3D%20expr%20else%20%7B%20...%20%7D%60%20statements/near/245072130" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> bstrie <a href="https://rust-lang.github.io/zulip_archive/stream/213817-t-lang/topic/.60let.20pattern.20.3D.20expr.20else.20.7B.20.2E.2E.2E.20.7D.60.20statements.html#245072130">(Jul 06 2021 at 17:31)</a>:</h4>
<p>The syntax is being stressed to the breaking point here. I'm beginning to understand the appeal of just forfeiting and using s-expressions :P</p>



<a name="245074105"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/%60let%20pattern%20%3D%20expr%20else%20%7B%20...%20%7D%60%20statements/near/245074105" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> bstrie <a href="https://rust-lang.github.io/zulip_archive/stream/213817-t-lang/topic/.60let.20pattern.20.3D.20expr.20else.20.7B.20.2E.2E.2E.20.7D.60.20statements.html#245074105">(Jul 06 2021 at 17:45)</a>:</h4>
<p>btw <span class="user-mention" data-user-id="319552">@Jeremiah Senkpiel</span> I commend you for sticking through with all this so far, the RFC process is often not for the faint of heart and this is a difficult one for being your first RFC ever (although maybe you suspected that it would be difficult after reading the original RFC :P )</p>



<a name="245074693"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/%60let%20pattern%20%3D%20expr%20else%20%7B%20...%20%7D%60%20statements/near/245074693" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jeremiah Senkpiel <a href="https://rust-lang.github.io/zulip_archive/stream/213817-t-lang/topic/.60let.20pattern.20.3D.20expr.20else.20.7B.20.2E.2E.2E.20.7D.60.20statements.html#245074693">(Jul 06 2021 at 17:50)</a>:</h4>
<p>I'll try to read through the if-let-chains rfc in detail at some point. My offhand though is something like <code>x then y</code> rather than <code>x &amp;&amp; y</code>. Though I am sure polling will probably should most people find <code>&amp;&amp;</code> the most natural from other languages.</p>



<a name="245074822"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/%60let%20pattern%20%3D%20expr%20else%20%7B%20...%20%7D%60%20statements/near/245074822" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jeremiah Senkpiel <a href="https://rust-lang.github.io/zulip_archive/stream/213817-t-lang/topic/.60let.20pattern.20.3D.20expr.20else.20.7B.20.2E.2E.2E.20.7D.60.20statements.html#245074822">(Jul 06 2021 at 17:51)</a>:</h4>
<p>And thanks yeah. I did suspect this would be quite debated, but it ended up being less debated in ways that I expected and more in ways I didn't suspect (maybe I made a good enough base argument? not sure!)</p>
<p>It certainly not my first open source rodeo though, although it may be the largest so far. :P</p>



<a name="245075183"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/%60let%20pattern%20%3D%20expr%20else%20%7B%20...%20%7D%60%20statements/near/245075183" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jeremiah Senkpiel <a href="https://rust-lang.github.io/zulip_archive/stream/213817-t-lang/topic/.60let.20pattern.20.3D.20expr.20else.20.7B.20.2E.2E.2E.20.7D.60.20statements.html#245075183">(Jul 06 2021 at 17:54)</a>:</h4>
<p>I will note that I didn't really have a strong sense of direction for the language syntax-wise outside of the existing syntax, so I am mostly neutral to proposals like a more flexible <code>guard</code>, for better or worse.</p>



<a name="245076604"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/%60let%20pattern%20%3D%20expr%20else%20%7B%20...%20%7D%60%20statements/near/245076604" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Triplett <a href="https://rust-lang.github.io/zulip_archive/stream/213817-t-lang/topic/.60let.20pattern.20.3D.20expr.20else.20.7B.20.2E.2E.2E.20.7D.60.20statements.html#245076604">(Jul 06 2021 at 18:03)</a>:</h4>
<p><span class="user-mention" data-user-id="319552">@Jeremiah Senkpiel</span> FWIW, this is reminding me strongly of my own first RFC, for <code>union</code>. They both have that quality of "this touches so many things and needs to document all the interactions".</p>



<a name="245076631"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/%60let%20pattern%20%3D%20expr%20else%20%7B%20...%20%7D%60%20statements/near/245076631" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Triplett <a href="https://rust-lang.github.io/zulip_archive/stream/213817-t-lang/topic/.60let.20pattern.20.3D.20expr.20else.20.7B.20.2E.2E.2E.20.7D.60.20statements.html#245076631">(Jul 06 2021 at 18:04)</a>:</h4>
<p>Also, you're doing a <em>great</em> job of capturing all those interactions and alternatives and similar.</p>



<a name="245076674"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/%60let%20pattern%20%3D%20expr%20else%20%7B%20...%20%7D%60%20statements/near/245076674" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Triplett <a href="https://rust-lang.github.io/zulip_archive/stream/213817-t-lang/topic/.60let.20pattern.20.3D.20expr.20else.20.7B.20.2E.2E.2E.20.7D.60.20statements.html#245076674">(Jul 06 2021 at 18:04)</a>:</h4>
<p>We just discussed the RFC in today's lang meeting.</p>



<a name="245076715"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/%60let%20pattern%20%3D%20expr%20else%20%7B%20...%20%7D%60%20statements/near/245076715" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Triplett <a href="https://rust-lang.github.io/zulip_archive/stream/213817-t-lang/topic/.60let.20pattern.20.3D.20expr.20else.20.7B.20.2E.2E.2E.20.7D.60.20statements.html#245076715">(Jul 06 2021 at 18:04)</a>:</h4>
<p>We generally felt like most of the questions should be settled by going ahead with an implementation and letting people experiment.</p>



<a name="245076797"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/%60let%20pattern%20%3D%20expr%20else%20%7B%20...%20%7D%60%20statements/near/245076797" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Triplett <a href="https://rust-lang.github.io/zulip_archive/stream/213817-t-lang/topic/.60let.20pattern.20.3D.20expr.20else.20.7B.20.2E.2E.2E.20.7D.60.20statements.html#245076797">(Jul 06 2021 at 18:05)</a>:</h4>
<p>We did feel, though, that the RFC needs to capture a few of these under "unresolved questions" rather than just "alternatives", because "unresolved questions" become checkboxes on the tracking/stabilization thread.</p>



<a name="245076851"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/%60let%20pattern%20%3D%20expr%20else%20%7B%20...%20%7D%60%20statements/near/245076851" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jeremiah Senkpiel <a href="https://rust-lang.github.io/zulip_archive/stream/213817-t-lang/topic/.60let.20pattern.20.3D.20expr.20else.20.7B.20.2E.2E.2E.20.7D.60.20statements.html#245076851">(Jul 06 2021 at 18:05)</a>:</h4>
<p>I was actually wondering about that</p>



<a name="245077335"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/%60let%20pattern%20%3D%20expr%20else%20%7B%20...%20%7D%60%20statements/near/245077335" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jeremiah Senkpiel <a href="https://rust-lang.github.io/zulip_archive/stream/213817-t-lang/topic/.60let.20pattern.20.3D.20expr.20else.20.7B.20.2E.2E.2E.20.7D.60.20statements.html#245077335">(Jul 06 2021 at 18:09)</a>:</h4>
<p>Which ones, specifically?</p>
<p>Aside from the recent <code>guard</code> discussion, which should I suppose be in there in some form</p>



<a name="245077551"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/%60let%20pattern%20%3D%20expr%20else%20%7B%20...%20%7D%60%20statements/near/245077551" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> bstrie <a href="https://rust-lang.github.io/zulip_archive/stream/213817-t-lang/topic/.60let.20pattern.20.3D.20expr.20else.20.7B.20.2E.2E.2E.20.7D.60.20statements.html#245077551">(Jul 06 2021 at 18:11)</a>:</h4>
<p>I could get behind a <code>then</code> proposal to replace <code>&amp;&amp;</code> in these contexts, although that doesn't suggest what <code>||</code> might be (if people want it, which I'm not sure?), and it's sure to trigger a fresh round of bikeshedding</p>



<a name="245077793"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/%60let%20pattern%20%3D%20expr%20else%20%7B%20...%20%7D%60%20statements/near/245077793" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> bstrie <a href="https://rust-lang.github.io/zulip_archive/stream/213817-t-lang/topic/.60let.20pattern.20.3D.20expr.20else.20.7B.20.2E.2E.2E.20.7D.60.20statements.html#245077793">(Jul 06 2021 at 18:13)</a>:</h4>
<p>other languages do have "pipelining operators" of that sort, although this would need to be pretty different from those if the idea was ever to generalize it</p>



<a name="245077975"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/%60let%20pattern%20%3D%20expr%20else%20%7B%20...%20%7D%60%20statements/near/245077975" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> bstrie <a href="https://rust-lang.github.io/zulip_archive/stream/213817-t-lang/topic/.60let.20pattern.20.3D.20expr.20else.20.7B.20.2E.2E.2E.20.7D.60.20statements.html#245077975">(Jul 06 2021 at 18:14)</a>:</h4>
<p><span class="user-mention" data-user-id="319552">@Jeremiah Senkpiel</span> I think the most important unresolved question is the interaction with if-let chains; it's clear that neither this feature nor that feature should be stabilized without considering the other</p>



<a name="245078085"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/%60let%20pattern%20%3D%20expr%20else%20%7B%20...%20%7D%60%20statements/near/245078085" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> bstrie <a href="https://rust-lang.github.io/zulip_archive/stream/213817-t-lang/topic/.60let.20pattern.20.3D.20expr.20else.20.7B.20.2E.2E.2E.20.7D.60.20statements.html#245078085">(Jul 06 2021 at 18:15)</a>:</h4>
<p>fortunately if-let chains do not look to be stabilizing any time soon, so there's at least no time pressure</p>



<a name="245079734"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/%60let%20pattern%20%3D%20expr%20else%20%7B%20...%20%7D%60%20statements/near/245079734" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> The 8472 <a href="https://rust-lang.github.io/zulip_archive/stream/213817-t-lang/topic/.60let.20pattern.20.3D.20expr.20else.20.7B.20.2E.2E.2E.20.7D.60.20statements.html#245079734">(Jul 06 2021 at 18:28)</a>:</h4>
<p><code>elsewise</code> of course</p>



<a name="245080099"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/%60let%20pattern%20%3D%20expr%20else%20%7B%20...%20%7D%60%20statements/near/245080099" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Triplett <a href="https://rust-lang.github.io/zulip_archive/stream/213817-t-lang/topic/.60let.20pattern.20.3D.20expr.20else.20.7B.20.2E.2E.2E.20.7D.60.20statements.html#245080099">(Jul 06 2021 at 18:31)</a>:</h4>
<p><span class="user-mention" data-user-id="319552">@Jeremiah Senkpiel</span> So, unresolved questions shouldn't necessarily have a <em>specific</em> alternative or proposal in mind. Rather, unresolved questions needs to capture the high-level problems, like "do we need an introducer syntax rather than just <code>let</code>".</p>



<a name="245080168"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/%60let%20pattern%20%3D%20expr%20else%20%7B%20...%20%7D%60%20statements/near/245080168" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> scottmcm <a href="https://rust-lang.github.io/zulip_archive/stream/213817-t-lang/topic/.60let.20pattern.20.3D.20expr.20else.20.7B.20.2E.2E.2E.20.7D.60.20statements.html#245080168">(Jul 06 2021 at 18:31)</a>:</h4>
<p><span class="user-mention silent" data-user-id="319552">Jeremiah Senkpiel</span> <a href="#narrow/stream/213817-t-lang/topic/.60let.20pattern.20.3D.20expr.20else.20.7B.20.2E.2E.2E.20.7D.60.20statements/near/245077335">said</a>:</p>
<blockquote>
<p>Which ones, specifically?</p>
</blockquote>
<p>My thought was a general one about "how's the readability of this in practice?" to encompass various things like the "does it need an introducer keyword?" and such.</p>



<a name="245080429"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/%60let%20pattern%20%3D%20expr%20else%20%7B%20...%20%7D%60%20statements/near/245080429" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Triplett <a href="https://rust-lang.github.io/zulip_archive/stream/213817-t-lang/topic/.60let.20pattern.20.3D.20expr.20else.20.7B.20.2E.2E.2E.20.7D.60.20statements.html#245080429">(Jul 06 2021 at 18:33)</a>:</h4>
<p>Or "are there too many special-case exceptions (e.g. interaction with if-let)".</p>



<a name="245209251"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/%60let%20pattern%20%3D%20expr%20else%20%7B%20...%20%7D%60%20statements/near/245209251" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jeremiah Senkpiel <a href="https://rust-lang.github.io/zulip_archive/stream/213817-t-lang/topic/.60let.20pattern.20.3D.20expr.20else.20.7B.20.2E.2E.2E.20.7D.60.20statements.html#245209251">(Jul 07 2021 at 16:46)</a>:</h4>
<p><span class="user-mention" data-user-id="360405">@Cameron Steffen</span> </p>
<blockquote>
<p>I suggest we disallow match, if (let) else, while and try blocks from being at the trailing position of the initializer. </p>
</blockquote>
<p>Any idea what the grammar for that would be like?</p>



<a name="245209795"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/%60let%20pattern%20%3D%20expr%20else%20%7B%20...%20%7D%60%20statements/near/245209795" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Cameron Steffen <a href="https://rust-lang.github.io/zulip_archive/stream/213817-t-lang/topic/.60let.20pattern.20.3D.20expr.20else.20.7B.20.2E.2E.2E.20.7D.60.20statements.html#245209795">(Jul 07 2021 at 16:50)</a>:</h4>
<p>I'm not sure if you could (easily) put a formal grammar on it. But implementation-wise I think it is as simple as traversing through any unary or binary operators and then looking at the expression kind.</p>



<a name="245210751"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/%60let%20pattern%20%3D%20expr%20else%20%7B%20...%20%7D%60%20statements/near/245210751" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Triplett <a href="https://rust-lang.github.io/zulip_archive/stream/213817-t-lang/topic/.60let.20pattern.20.3D.20expr.20else.20.7B.20.2E.2E.2E.20.7D.60.20statements.html#245210751">(Jul 07 2021 at 16:57)</a>:</h4>
<p>You're just looking to avoid anything that takes a braced block?</p>



<a name="245212015"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/%60let%20pattern%20%3D%20expr%20else%20%7B%20...%20%7D%60%20statements/near/245212015" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Cameron Steffen <a href="https://rust-lang.github.io/zulip_archive/stream/213817-t-lang/topic/.60let.20pattern.20.3D.20expr.20else.20.7B.20.2E.2E.2E.20.7D.60.20statements.html#245212015">(Jul 07 2021 at 17:06)</a>:</h4>
<p>I think we could allow <code>loop {}</code> or <code>const {}</code></p>



<a name="245212978"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/%60let%20pattern%20%3D%20expr%20else%20%7B%20...%20%7D%60%20statements/near/245212978" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Cameron Steffen <a href="https://rust-lang.github.io/zulip_archive/stream/213817-t-lang/topic/.60let.20pattern.20.3D.20expr.20else.20.7B.20.2E.2E.2E.20.7D.60.20statements.html#245212978">(Jul 07 2021 at 17:14)</a>:</h4>
<p>but maybe "anything with a braced block" is a better approach. it's simpler.</p>



<a name="245215275"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/%60let%20pattern%20%3D%20expr%20else%20%7B%20...%20%7D%60%20statements/near/245215275" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Triplett <a href="https://rust-lang.github.io/zulip_archive/stream/213817-t-lang/topic/.60let.20pattern.20.3D.20expr.20else.20.7B.20.2E.2E.2E.20.7D.60.20statements.html#245215275">(Jul 07 2021 at 17:31)</a>:</h4>
<p>Yeah, I think disallowing anything with a braced block is more consistent. You can always write <code>= { ... loop {} ... }</code>.</p>



<a name="245220707"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/%60let%20pattern%20%3D%20expr%20else%20%7B%20...%20%7D%60%20statements/near/245220707" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> rpjohnst <a href="https://rust-lang.github.io/zulip_archive/stream/213817-t-lang/topic/.60let.20pattern.20.3D.20expr.20else.20.7B.20.2E.2E.2E.20.7D.60.20statements.html#245220707">(Jul 07 2021 at 18:15)</a>:</h4>
<p>is there a difference between this and the already-existing restriction on if condition expressions?</p>



<a name="245220936"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/%60let%20pattern%20%3D%20expr%20else%20%7B%20...%20%7D%60%20statements/near/245220936" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> rpjohnst <a href="https://rust-lang.github.io/zulip_archive/stream/213817-t-lang/topic/.60let.20pattern.20.3D.20expr.20else.20.7B.20.2E.2E.2E.20.7D.60.20statements.html#245220936">(Jul 07 2021 at 18:16)</a>:</h4>
<p>i guess we do allow some trailing {}s in if conditions so this is probably a larger set of restrictions?</p>



<a name="245221882"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/%60let%20pattern%20%3D%20expr%20else%20%7B%20...%20%7D%60%20statements/near/245221882" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Triplett <a href="https://rust-lang.github.io/zulip_archive/stream/213817-t-lang/topic/.60let.20pattern.20.3D.20expr.20else.20.7B.20.2E.2E.2E.20.7D.60.20statements.html#245221882">(Jul 07 2021 at 18:23)</a>:</h4>
<p>What is the list of things prohibited in if conditions?</p>



<a name="245232950"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/%60let%20pattern%20%3D%20expr%20else%20%7B%20...%20%7D%60%20statements/near/245232950" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> bstrie <a href="https://rust-lang.github.io/zulip_archive/stream/213817-t-lang/topic/.60let.20pattern.20.3D.20expr.20else.20.7B.20.2E.2E.2E.20.7D.60.20statements.html#245232950">(Jul 07 2021 at 19:48)</a>:</h4>
<p>I know structs are weird in if conditions, e.g. <code>if Foo{} == Foo{} {</code> has to be written <code>if (Foo{}) == (Foo{}) {</code></p>



<a name="245340549"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/%60let%20pattern%20%3D%20expr%20else%20%7B%20...%20%7D%60%20statements/near/245340549" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Frank Steffahn <a href="https://rust-lang.github.io/zulip_archive/stream/213817-t-lang/topic/.60let.20pattern.20.3D.20expr.20else.20.7B.20.2E.2E.2E.20.7D.60.20statements.html#245340549">(Jul 08 2021 at 16:55)</a>:</h4>
<p><span class="user-mention" data-user-id="117495">@rpjohnst</span> if conditions only disallow structs. And operator expressions containing structs (this is not properly documented in the reference, I just noticed).<br>
other things with blocks, e.g. something like <code>if if true { true } else { false } { foo() }</code> work fine</p>



<a name="245342498"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/%60let%20pattern%20%3D%20expr%20else%20%7B%20...%20%7D%60%20statements/near/245342498" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> rpjohnst <a href="https://rust-lang.github.io/zulip_archive/stream/213817-t-lang/topic/.60let.20pattern.20.3D.20expr.20else.20.7B.20.2E.2E.2E.20.7D.60.20statements.html#245342498">(Jul 08 2021 at 17:10)</a>:</h4>
<p>ah, thanks for the clarification- at that point, would it make sense to aim for using the same set of restrictions in both places, or is there a technical difference between <code>if bla {</code> and <code>let ... = bla else {</code> (e.g. presence or absense of a keyword between the bla and then {) that means we want different restrictions?</p>



<a name="245343269"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/%60let%20pattern%20%3D%20expr%20else%20%7B%20...%20%7D%60%20statements/near/245343269" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Triplett <a href="https://rust-lang.github.io/zulip_archive/stream/213817-t-lang/topic/.60let.20pattern.20.3D.20expr.20else.20.7B.20.2E.2E.2E.20.7D.60.20statements.html#245343269">(Jul 08 2021 at 17:16)</a>:</h4>
<p>There isn't necessarily a technical difference, but we have a compatibility requirement for <code>if</code> (which already exists) that we don't have for let-else (because it doesn't exist yet).</p>



<a name="245343310"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/%60let%20pattern%20%3D%20expr%20else%20%7B%20...%20%7D%60%20statements/near/245343310" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Triplett <a href="https://rust-lang.github.io/zulip_archive/stream/213817-t-lang/topic/.60let.20pattern.20.3D.20expr.20else.20.7B.20.2E.2E.2E.20.7D.60.20statements.html#245343310">(Jul 08 2021 at 17:17)</a>:</h4>
<p>I think "prohibit anything that takes a braced block" is a sensible rule for <em>any</em> new construct that itself accepts an expression and has a braced block that immediately follows the expression.</p>



<a name="245343343"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/%60let%20pattern%20%3D%20expr%20else%20%7B%20...%20%7D%60%20statements/near/245343343" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Triplett <a href="https://rust-lang.github.io/zulip_archive/stream/213817-t-lang/topic/.60let.20pattern.20.3D.20expr.20else.20.7B.20.2E.2E.2E.20.7D.60.20statements.html#245343343">(Jul 08 2021 at 17:17)</a>:</h4>
<p>If we add any <code>newthing expr { ... }</code>, I think we should place the same restriction on <code>expr</code>.</p>



<a name="245348993"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/%60let%20pattern%20%3D%20expr%20else%20%7B%20...%20%7D%60%20statements/near/245348993" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://rust-lang.github.io/zulip_archive/stream/213817-t-lang/topic/.60let.20pattern.20.3D.20expr.20else.20.7B.20.2E.2E.2E.20.7D.60.20statements.html#245348993">(Jul 08 2021 at 18:02)</a>:</h4>
<p>I wonder about <code>, else</code>...</p>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="kd">let</span><span class="w"> </span><span class="nb">Some</span><span class="p">(</span><span class="n">x</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">foo</span><span class="p">,</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="p">};</span><span class="w"></span>
</code></pre></div>
<p>It solves any grammar problems, I'm not sure how much it helps with readability. I guess it's kind of random, doesn't have much precedent. Not sure if that was discussed already though so I thought I'd throw it out.</p>



<a name="245356776"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/%60let%20pattern%20%3D%20expr%20else%20%7B%20...%20%7D%60%20statements/near/245356776" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jeremiah Senkpiel <a href="https://rust-lang.github.io/zulip_archive/stream/213817-t-lang/topic/.60let.20pattern.20.3D.20expr.20else.20.7B.20.2E.2E.2E.20.7D.60.20statements.html#245356776">(Jul 08 2021 at 19:02)</a>:</h4>
<p><code>, else</code> has been proposed but has not been talked about to any extensive degree: <a href="https://github.com/rust-lang/rfcs/pull/3137#issuecomment-866252458">https://github.com/rust-lang/rfcs/pull/3137#issuecomment-866252458</a></p>
<p>I personally am neutral on it, I don't feel like I have a grasp on the kind of language impact of that kind of entirely new syntax.</p>



<a name="245357028"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/%60let%20pattern%20%3D%20expr%20else%20%7B%20...%20%7D%60%20statements/near/245357028" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jeremiah Senkpiel <a href="https://rust-lang.github.io/zulip_archive/stream/213817-t-lang/topic/.60let.20pattern.20.3D.20expr.20else.20.7B.20.2E.2E.2E.20.7D.60.20statements.html#245357028">(Jul 08 2021 at 19:04)</a>:</h4>
<p>I think the sensible question to ask: are there other similar keyword places that could also eventually benefit from <code>, keyword</code>?</p>



<a name="245357034"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/%60let%20pattern%20%3D%20expr%20else%20%7B%20...%20%7D%60%20statements/near/245357034" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://rust-lang.github.io/zulip_archive/stream/213817-t-lang/topic/.60let.20pattern.20.3D.20expr.20else.20.7B.20.2E.2E.2E.20.7D.60.20statements.html#245357034">(Jul 08 2021 at 19:04)</a>:</h4>
<p>Yeah. My take on all of this is that I would like to be able to experiment.</p>



<a name="245357041"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/%60let%20pattern%20%3D%20expr%20else%20%7B%20...%20%7D%60%20statements/near/245357041" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://rust-lang.github.io/zulip_archive/stream/213817-t-lang/topic/.60let.20pattern.20.3D.20expr.20else.20.7B.20.2E.2E.2E.20.7D.60.20statements.html#245357041">(Jul 08 2021 at 19:04)</a>:</h4>
<p>One thing I'm wondering about</p>



<a name="245357045"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/%60let%20pattern%20%3D%20expr%20else%20%7B%20...%20%7D%60%20statements/near/245357045" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://rust-lang.github.io/zulip_archive/stream/213817-t-lang/topic/.60let.20pattern.20.3D.20expr.20else.20.7B.20.2E.2E.2E.20.7D.60.20statements.html#245357045">(Jul 08 2021 at 19:04)</a>:</h4>
<p>Maybe it makes sense to prototype in a procedural macro?</p>



<a name="245357060"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/%60let%20pattern%20%3D%20expr%20else%20%7B%20...%20%7D%60%20statements/near/245357060" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://rust-lang.github.io/zulip_archive/stream/213817-t-lang/topic/.60let.20pattern.20.3D.20expr.20else.20.7B.20.2E.2E.2E.20.7D.60.20statements.html#245357060">(Jul 08 2021 at 19:04)</a>:</h4>
<p>It might be fun to be able to switch between variants</p>



<a name="245357066"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/%60let%20pattern%20%3D%20expr%20else%20%7B%20...%20%7D%60%20statements/near/245357066" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://rust-lang.github.io/zulip_archive/stream/213817-t-lang/topic/.60let.20pattern.20.3D.20expr.20else.20.7B.20.2E.2E.2E.20.7D.60.20statements.html#245357066">(Jul 08 2021 at 19:04)</a>:</h4>
<p>Not sure how easy it is to do this sort of thing with <code>syn</code> though</p>



<a name="245357068"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/%60let%20pattern%20%3D%20expr%20else%20%7B%20...%20%7D%60%20statements/near/245357068" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jeremiah Senkpiel <a href="https://rust-lang.github.io/zulip_archive/stream/213817-t-lang/topic/.60let.20pattern.20.3D.20expr.20else.20.7B.20.2E.2E.2E.20.7D.60.20statements.html#245357068">(Jul 08 2021 at 19:04)</a>:</h4>
<p>A macro already exists, and has for 5-6 years</p>



<a name="245357103"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/%60let%20pattern%20%3D%20expr%20else%20%7B%20...%20%7D%60%20statements/near/245357103" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jeremiah Senkpiel <a href="https://rust-lang.github.io/zulip_archive/stream/213817-t-lang/topic/.60let.20pattern.20.3D.20expr.20else.20.7B.20.2E.2E.2E.20.7D.60.20statements.html#245357103">(Jul 08 2021 at 19:05)</a>:</h4>
<p><a href="https://crates.io/crates/guard">https://crates.io/crates/guard</a></p>



<a name="245357105"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/%60let%20pattern%20%3D%20expr%20else%20%7B%20...%20%7D%60%20statements/near/245357105" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://rust-lang.github.io/zulip_archive/stream/213817-t-lang/topic/.60let.20pattern.20.3D.20expr.20else.20.7B.20.2E.2E.2E.20.7D.60.20statements.html#245357105">(Jul 08 2021 at 19:05)</a>:</h4>
<p>Heh, ok, I probably knew that at one point</p>



<a name="245357129"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/%60let%20pattern%20%3D%20expr%20else%20%7B%20...%20%7D%60%20statements/near/245357129" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://rust-lang.github.io/zulip_archive/stream/213817-t-lang/topic/.60let.20pattern.20.3D.20expr.20else.20.7B.20.2E.2E.2E.20.7D.60.20statements.html#245357129">(Jul 08 2021 at 19:05)</a>:</h4>
<p>but does it offer more variants? maybe we could alter it...</p>



<a name="245357149"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/%60let%20pattern%20%3D%20expr%20else%20%7B%20...%20%7D%60%20statements/near/245357149" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jeremiah Senkpiel <a href="https://rust-lang.github.io/zulip_archive/stream/213817-t-lang/topic/.60let.20pattern.20.3D.20expr.20else.20.7B.20.2E.2E.2E.20.7D.60.20statements.html#245357149">(Jul 08 2021 at 19:05)</a>:</h4>
<p>(I don't think it does any enforcement on edge cases mind you)</p>



<a name="245357150"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/%60let%20pattern%20%3D%20expr%20else%20%7B%20...%20%7D%60%20statements/near/245357150" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://rust-lang.github.io/zulip_archive/stream/213817-t-lang/topic/.60let.20pattern.20.3D.20expr.20else.20.7B.20.2E.2E.2E.20.7D.60.20statements.html#245357150">(Jul 08 2021 at 19:05)</a>:</h4>
<p>oh, that's not the macro I had in mind</p>



<a name="245357195"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/%60let%20pattern%20%3D%20expr%20else%20%7B%20...%20%7D%60%20statements/near/245357195" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://rust-lang.github.io/zulip_archive/stream/213817-t-lang/topic/.60let.20pattern.20.3D.20expr.20else.20.7B.20.2E.2E.2E.20.7D.60.20statements.html#245357195">(Jul 08 2021 at 19:05)</a>:</h4>
<p>I was thinking more like <code>#[guarded_let(variant_name)]</code> as a decorator on the fn</p>



<a name="245357207"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/%60let%20pattern%20%3D%20expr%20else%20%7B%20...%20%7D%60%20statements/near/245357207" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://rust-lang.github.io/zulip_archive/stream/213817-t-lang/topic/.60let.20pattern.20.3D.20expr.20else.20.7B.20.2E.2E.2E.20.7D.60.20statements.html#245357207">(Jul 08 2021 at 19:05)</a>:</h4>
<p>so that you can use it <em>naturally</em></p>



<a name="245357217"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/%60let%20pattern%20%3D%20expr%20else%20%7B%20...%20%7D%60%20statements/near/245357217" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://rust-lang.github.io/zulip_archive/stream/213817-t-lang/topic/.60let.20pattern.20.3D.20expr.20else.20.7B.20.2E.2E.2E.20.7D.60.20statements.html#245357217">(Jul 08 2021 at 19:05)</a>:</h4>
<p>we could of course just implement the feature that way to start</p>



<a name="245357277"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/%60let%20pattern%20%3D%20expr%20else%20%7B%20...%20%7D%60%20statements/near/245357277" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://rust-lang.github.io/zulip_archive/stream/213817-t-lang/topic/.60let.20pattern.20.3D.20expr.20else.20.7B.20.2E.2E.2E.20.7D.60.20statements.html#245357277">(Jul 08 2021 at 19:06)</a>:</h4>
<p>so e.g. you might write</p>



<a name="245357313"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/%60let%20pattern%20%3D%20expr%20else%20%7B%20...%20%7D%60%20statements/near/245357313" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://rust-lang.github.io/zulip_archive/stream/213817-t-lang/topic/.60let.20pattern.20.3D.20expr.20else.20.7B.20.2E.2E.2E.20.7D.60.20statements.html#245357313">(Jul 08 2021 at 19:06)</a>:</h4>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="cp">#[guarded_let]</span><span class="w"></span>
<span class="k">fn</span> <span class="nf">main</span><span class="p">()</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="c1">// read configuration from a certain environment variable</span>
<span class="w">    </span><span class="c1">// do nothing if the variable is missing</span>
<span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="nb">Ok</span><span class="p">(</span><span class="n">foo</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">env</span>::<span class="n">var</span><span class="p">(</span><span class="s">"FOO"</span><span class="p">)</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="k">return</span><span class="w"> </span><span class="p">};</span><span class="w"></span>

<span class="w">    </span><span class="fm">println!</span><span class="p">(</span><span class="s">"FOO = {}"</span><span class="p">,</span><span class="w"> </span><span class="n">foo</span><span class="p">);</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>

<span class="cp">#[guarded_let(comma)]</span><span class="w"></span>
<span class="k">fn</span> <span class="nf">main</span><span class="p">()</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="c1">// read configuration from a certain environment variable</span>
<span class="w">    </span><span class="c1">// do nothing if the variable is missing</span>
<span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="nb">Ok</span><span class="p">(</span><span class="n">foo</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">env</span>::<span class="n">var</span><span class="p">(</span><span class="s">"FOO"</span><span class="p">),</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="k">return</span><span class="w"> </span><span class="p">};</span><span class="w"></span>

<span class="w">    </span><span class="fm">println!</span><span class="p">(</span><span class="s">"FOO = {}"</span><span class="p">,</span><span class="w"> </span><span class="n">foo</span><span class="p">);</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>
</code></pre></div>



<a name="245357336"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/%60let%20pattern%20%3D%20expr%20else%20%7B%20...%20%7D%60%20statements/near/245357336" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jeremiah Senkpiel <a href="https://rust-lang.github.io/zulip_archive/stream/213817-t-lang/topic/.60let.20pattern.20.3D.20expr.20else.20.7B.20.2E.2E.2E.20.7D.60.20statements.html#245357336">(Jul 08 2021 at 19:06)</a>:</h4>
<p>Yeah that would be a step up in prototype improvement for UX</p>



<a name="245357347"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/%60let%20pattern%20%3D%20expr%20else%20%7B%20...%20%7D%60%20statements/near/245357347" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://rust-lang.github.io/zulip_archive/stream/213817-t-lang/topic/.60let.20pattern.20.3D.20expr.20else.20.7B.20.2E.2E.2E.20.7D.60.20statements.html#245357347">(Jul 08 2021 at 19:06)</a>:</h4>
<p>anyway, as I said, to me the high order bit is wanting to play with it. I'm not sure how much doubt I have about the right approach.</p>



<a name="245357366"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/%60let%20pattern%20%3D%20expr%20else%20%7B%20...%20%7D%60%20statements/near/245357366" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://rust-lang.github.io/zulip_archive/stream/213817-t-lang/topic/.60let.20pattern.20.3D.20expr.20else.20.7B.20.2E.2E.2E.20.7D.60.20statements.html#245357366">(Jul 08 2021 at 19:07)</a>:</h4>
<p>let...else still feels pretty "right" to me</p>



<a name="245363779"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/%60let%20pattern%20%3D%20expr%20else%20%7B%20...%20%7D%60%20statements/near/245363779" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jeremiah Senkpiel <a href="https://rust-lang.github.io/zulip_archive/stream/213817-t-lang/topic/.60let.20pattern.20.3D.20expr.20else.20.7B.20.2E.2E.2E.20.7D.60.20statements.html#245363779">(Jul 08 2021 at 19:59)</a>:</h4>
<blockquote>
<p>I think "prohibit anything that takes a braced block" is a sensible rule for any new construct that itself accepts an expression and has a braced block that immediately follows the expression.</p>
</blockquote>
<p>Is this specific enough to update the RFC with or do I need some kind of grammar for this?</p>



<a name="245379377"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/%60let%20pattern%20%3D%20expr%20else%20%7B%20...%20%7D%60%20statements/near/245379377" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Mario Carneiro <a href="https://rust-lang.github.io/zulip_archive/stream/213817-t-lang/topic/.60let.20pattern.20.3D.20expr.20else.20.7B.20.2E.2E.2E.20.7D.60.20statements.html#245379377">(Jul 08 2021 at 22:22)</a>:</h4>
<p>I think that this should not be implemented as a syntax restriction in the grammar, but it is possible to do so analogously to EXPRESSION-WITHOUT-BLOCK; you just have to make sure that operators like <code>-t</code> and <code>e - t</code> use a EXPR-DOESNT-END-IN-BRACE in the right argument.</p>
<p>A simpler approach is just to say that the expression can't end in a brace unless that brace comes from a [list valid alternatives here: <code>{ expr }</code> and <code>const { expr }</code>? bikeshedding is required], and implement it as a post processing stage after parsing the grammar <code>let PAT = EXPR else { BLOCK };</code> with longest-match rules (meaning that <code>let PAT = if c { e1 } else { e2 };</code> is not parsed as a let-else and causes no warnings, which must be the case because of backward compatibility).</p>



<a name="245385419"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/%60let%20pattern%20%3D%20expr%20else%20%7B%20...%20%7D%60%20statements/near/245385419" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Triplett <a href="https://rust-lang.github.io/zulip_archive/stream/213817-t-lang/topic/.60let.20pattern.20.3D.20expr.20else.20.7B.20.2E.2E.2E.20.7D.60.20statements.html#245385419">(Jul 08 2021 at 23:43)</a>:</h4>
<p>FWIW I think comma would cause <em>human</em> parsing difficulties: when you're reading an expression, a comma makes you expect more expression.</p>



<a name="245386460"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/%60let%20pattern%20%3D%20expr%20else%20%7B%20...%20%7D%60%20statements/near/245386460" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jeremiah Senkpiel <a href="https://rust-lang.github.io/zulip_archive/stream/213817-t-lang/topic/.60let.20pattern.20.3D.20expr.20else.20.7B.20.2E.2E.2E.20.7D.60.20statements.html#245386460">(Jul 09 2021 at 00:00)</a>:</h4>
<p>/me terrible proposal: <code>ELSE { }</code>, in all caps</p>



<a name="245388809"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/%60let%20pattern%20%3D%20expr%20else%20%7B%20...%20%7D%60%20statements/near/245388809" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Triplett <a href="https://rust-lang.github.io/zulip_archive/stream/213817-t-lang/topic/.60let.20pattern.20.3D.20expr.20else.20.7B.20.2E.2E.2E.20.7D.60.20statements.html#245388809">(Jul 09 2021 at 00:46)</a>:</h4>
<p>We have unicode identifiers now, clearly we need unicode keywords. <code>ᴇʟsᴇ {}</code></p>



<a name="245390400"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/%60let%20pattern%20%3D%20expr%20else%20%7B%20...%20%7D%60%20statements/near/245390400" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> inquisitivecrystal <a href="https://rust-lang.github.io/zulip_archive/stream/213817-t-lang/topic/.60let.20pattern.20.3D.20expr.20else.20.7B.20.2E.2E.2E.20.7D.60.20statements.html#245390400">(Jul 09 2021 at 01:14)</a>:</h4>
<p>We should convince unicode to add an emoji of someone throwing a ball so we can use it as the solution to the <code>yeet</code> keyword debate.</p>



<a name="245391515"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/%60let%20pattern%20%3D%20expr%20else%20%7B%20...%20%7D%60%20statements/near/245391515" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Triplett <a href="https://rust-lang.github.io/zulip_archive/stream/213817-t-lang/topic/.60let.20pattern.20.3D.20expr.20else.20.7B.20.2E.2E.2E.20.7D.60.20statements.html#245391515">(Jul 09 2021 at 01:39)</a>:</h4>
<p>(╯°□°)╯︵ ┻━┻ operator</p>



<a name="245466521"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/%60let%20pattern%20%3D%20expr%20else%20%7B%20...%20%7D%60%20statements/near/245466521" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jeremiah Senkpiel <a href="https://rust-lang.github.io/zulip_archive/stream/213817-t-lang/topic/.60let.20pattern.20.3D.20expr.20else.20.7B.20.2E.2E.2E.20.7D.60.20statements.html#245466521">(Jul 09 2021 at 16:40)</a>:</h4>
<p>Should we delay RFC bot’s merge so I can address some of the recommended updates? Sorry I’ve been a bit busy</p>



<a name="245467283"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/%60let%20pattern%20%3D%20expr%20else%20%7B%20...%20%7D%60%20statements/near/245467283" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Triplett <a href="https://rust-lang.github.io/zulip_archive/stream/213817-t-lang/topic/.60let.20pattern.20.3D.20expr.20else.20.7B.20.2E.2E.2E.20.7D.60.20statements.html#245467283">(Jul 09 2021 at 16:47)</a>:</h4>
<p><span class="user-mention" data-user-id="319552">@Jeremiah Senkpiel</span> I added a quick note to the thread.</p>



<a name="245467322"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/%60let%20pattern%20%3D%20expr%20else%20%7B%20...%20%7D%60%20statements/near/245467322" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Triplett <a href="https://rust-lang.github.io/zulip_archive/stream/213817-t-lang/topic/.60let.20pattern.20.3D.20expr.20else.20.7B.20.2E.2E.2E.20.7D.60.20statements.html#245467322">(Jul 09 2021 at 16:48)</a>:</h4>
<p>If you have time to work on that today, I think we can just wait for it before merging the RFC. If you need some additional time to not feel rushed, I can register a concern on your behalf.</p>



<a name="245467428"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/%60let%20pattern%20%3D%20expr%20else%20%7B%20...%20%7D%60%20statements/near/245467428" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jeremiah Senkpiel <a href="https://rust-lang.github.io/zulip_archive/stream/213817-t-lang/topic/.60let.20pattern.20.3D.20expr.20else.20.7B.20.2E.2E.2E.20.7D.60.20statements.html#245467428">(Jul 09 2021 at 16:48)</a>:</h4>
<p>I will not be at my computer most of today</p>



<a name="245467453"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/%60let%20pattern%20%3D%20expr%20else%20%7B%20...%20%7D%60%20statements/near/245467453" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Triplett <a href="https://rust-lang.github.io/zulip_archive/stream/213817-t-lang/topic/.60let.20pattern.20.3D.20expr.20else.20.7B.20.2E.2E.2E.20.7D.60.20statements.html#245467453">(Jul 09 2021 at 16:48)</a>:</h4>
<p>No problem. I'll register a concern then.</p>



<a name="245467573"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/%60let%20pattern%20%3D%20expr%20else%20%7B%20...%20%7D%60%20statements/near/245467573" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Triplett <a href="https://rust-lang.github.io/zulip_archive/stream/213817-t-lang/topic/.60let.20pattern.20.3D.20expr.20else.20.7B.20.2E.2E.2E.20.7D.60.20statements.html#245467573">(Jul 09 2021 at 16:49)</a>:</h4>
<p>Done.</p>



<a name="245552824"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/%60let%20pattern%20%3D%20expr%20else%20%7B%20...%20%7D%60%20statements/near/245552824" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> The 8472 <a href="https://rust-lang.github.io/zulip_archive/stream/213817-t-lang/topic/.60let.20pattern.20.3D.20expr.20else.20.7B.20.2E.2E.2E.20.7D.60.20statements.html#245552824">(Jul 10 2021 at 14:20)</a>:</h4>
<p>How about <code>let PAT = EXPR ? { BLOCK };</code>. Think of it as a custom try bailout.</p>



<a name="245555760"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/%60let%20pattern%20%3D%20expr%20else%20%7B%20...%20%7D%60%20statements/near/245555760" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Triplett <a href="https://rust-lang.github.io/zulip_archive/stream/213817-t-lang/topic/.60let.20pattern.20.3D.20expr.20else.20.7B.20.2E.2E.2E.20.7D.60.20statements.html#245555760">(Jul 10 2021 at 15:09)</a>:</h4>
<p>That seems ambiguous, given that the question mark could legitimately just apply to the expression.</p>



<a name="245555821"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/%60let%20pattern%20%3D%20expr%20else%20%7B%20...%20%7D%60%20statements/near/245555821" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Triplett <a href="https://rust-lang.github.io/zulip_archive/stream/213817-t-lang/topic/.60let.20pattern.20.3D.20expr.20else.20.7B.20.2E.2E.2E.20.7D.60.20statements.html#245555821">(Jul 10 2021 at 15:10)</a>:</h4>
<p>The parser couldn't actually know which case applied until it saw the opening curly brace.</p>



<a name="245555847"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/%60let%20pattern%20%3D%20expr%20else%20%7B%20...%20%7D%60%20statements/near/245555847" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Triplett <a href="https://rust-lang.github.io/zulip_archive/stream/213817-t-lang/topic/.60let.20pattern.20.3D.20expr.20else.20.7B.20.2E.2E.2E.20.7D.60.20statements.html#245555847">(Jul 10 2021 at 15:10)</a>:</h4>
<p>And in theory we might actually want to use that syntax for a custom try handler.</p>



<a name="245555856"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/%60let%20pattern%20%3D%20expr%20else%20%7B%20...%20%7D%60%20statements/near/245555856" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Triplett <a href="https://rust-lang.github.io/zulip_archive/stream/213817-t-lang/topic/.60let.20pattern.20.3D.20expr.20else.20.7B.20.2E.2E.2E.20.7D.60.20statements.html#245555856">(Jul 10 2021 at 15:10)</a>:</h4>
<p>(which would then make that entirely ambiguous)</p>



<a name="245581470"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/%60let%20pattern%20%3D%20expr%20else%20%7B%20...%20%7D%60%20statements/near/245581470" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Mario Carneiro <a href="https://rust-lang.github.io/zulip_archive/stream/213817-t-lang/topic/.60let.20pattern.20.3D.20expr.20else.20.7B.20.2E.2E.2E.20.7D.60.20statements.html#245581470">(Jul 11 2021 at 01:35)</a>:</h4>
<p>That also looks more like an expr production than a statement, i.e. <code>EXPR ? { BLOCK }</code> should be a thing</p>



<a name="245612523"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/%60let%20pattern%20%3D%20expr%20else%20%7B%20...%20%7D%60%20statements/near/245612523" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Triplett <a href="https://rust-lang.github.io/zulip_archive/stream/213817-t-lang/topic/.60let.20pattern.20.3D.20expr.20else.20.7B.20.2E.2E.2E.20.7D.60.20statements.html#245612523">(Jul 11 2021 at 15:31)</a>:</h4>
<p>Exactly.</p>



<a name="245904356"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/%60let%20pattern%20%3D%20expr%20else%20%7B%20...%20%7D%60%20statements/near/245904356" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jeremiah Senkpiel <a href="https://rust-lang.github.io/zulip_archive/stream/213817-t-lang/topic/.60let.20pattern.20.3D.20expr.20else.20.7B.20.2E.2E.2E.20.7D.60.20statements.html#245904356">(Jul 13 2021 at 23:56)</a>:</h4>
<p>RFC updated. <span class="user-mention" data-user-id="239881">@Josh Triplett</span> could you review and unblock my own concern?</p>



<a name="245904372"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/%60let%20pattern%20%3D%20expr%20else%20%7B%20...%20%7D%60%20statements/near/245904372" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jeremiah Senkpiel <a href="https://rust-lang.github.io/zulip_archive/stream/213817-t-lang/topic/.60let.20pattern.20.3D.20expr.20else.20.7B.20.2E.2E.2E.20.7D.60.20statements.html#245904372">(Jul 13 2021 at 23:56)</a>:</h4>
<p><a href="https://github.com/rust-lang/rfcs/pull/3137#issuecomment-879476671">https://github.com/rust-lang/rfcs/pull/3137#issuecomment-879476671</a></p>



<a name="245907052"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/%60let%20pattern%20%3D%20expr%20else%20%7B%20...%20%7D%60%20statements/near/245907052" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Triplett <a href="https://rust-lang.github.io/zulip_archive/stream/213817-t-lang/topic/.60let.20pattern.20.3D.20expr.20else.20.7B.20.2E.2E.2E.20.7D.60.20statements.html#245907052">(Jul 14 2021 at 00:40)</a>:</h4>
<p>Reading...</p>



<a name="245907175"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/%60let%20pattern%20%3D%20expr%20else%20%7B%20...%20%7D%60%20statements/near/245907175" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Triplett <a href="https://rust-lang.github.io/zulip_archive/stream/213817-t-lang/topic/.60let.20pattern.20.3D.20expr.20else.20.7B.20.2E.2E.2E.20.7D.60.20statements.html#245907175">(Jul 14 2021 at 00:42)</a>:</h4>
<p>Ah, one clarification on something...</p>



<a name="245907195"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/%60let%20pattern%20%3D%20expr%20else%20%7B%20...%20%7D%60%20statements/near/245907195" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Triplett <a href="https://rust-lang.github.io/zulip_archive/stream/213817-t-lang/topic/.60let.20pattern.20.3D.20expr.20else.20.7B.20.2E.2E.2E.20.7D.60.20statements.html#245907195">(Jul 14 2021 at 00:42)</a>:</h4>
<p><span class="user-mention" data-user-id="319552">@Jeremiah Senkpiel</span> I think it's actually OK to have <code>let PAT = { braced expr } else { diverge };</code>.</p>



<a name="245907217"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/%60let%20pattern%20%3D%20expr%20else%20%7B%20...%20%7D%60%20statements/near/245907217" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Triplett <a href="https://rust-lang.github.io/zulip_archive/stream/213817-t-lang/topic/.60let.20pattern.20.3D.20expr.20else.20.7B.20.2E.2E.2E.20.7D.60.20statements.html#245907217">(Jul 14 2021 at 00:43)</a>:</h4>
<p>Based on the lang team consensus, the thing we wanted to avoid was <code>let PAT = some_construct_with { braces } else { diverge };</code>.</p>



<a name="245907219"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/%60let%20pattern%20%3D%20expr%20else%20%7B%20...%20%7D%60%20statements/near/245907219" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Triplett <a href="https://rust-lang.github.io/zulip_archive/stream/213817-t-lang/topic/.60let.20pattern.20.3D.20expr.20else.20.7B.20.2E.2E.2E.20.7D.60.20statements.html#245907219">(Jul 14 2021 at 00:43)</a>:</h4>
<p>loop, for, while, if, etc.</p>



<a name="245907273"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/%60let%20pattern%20%3D%20expr%20else%20%7B%20...%20%7D%60%20statements/near/245907273" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Triplett <a href="https://rust-lang.github.io/zulip_archive/stream/213817-t-lang/topic/.60let.20pattern.20.3D.20expr.20else.20.7B.20.2E.2E.2E.20.7D.60.20statements.html#245907273">(Jul 14 2021 at 00:44)</a>:</h4>
<p>The issue being that <code>some_construct_with { braces } else { diverge }</code> feels like it groups together, which seems confusing.</p>



<a name="245907304"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/%60let%20pattern%20%3D%20expr%20else%20%7B%20...%20%7D%60%20statements/near/245907304" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Triplett <a href="https://rust-lang.github.io/zulip_archive/stream/213817-t-lang/topic/.60let.20pattern.20.3D.20expr.20else.20.7B.20.2E.2E.2E.20.7D.60.20statements.html#245907304">(Jul 14 2021 at 00:44)</a>:</h4>
<p>So, nothing that ends in <code>}</code> <em>and doesn't start with <code>{</code></em> unless it's wrapped in parentheses or braces.</p>



<a name="245907347"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/%60let%20pattern%20%3D%20expr%20else%20%7B%20...%20%7D%60%20statements/near/245907347" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Triplett <a href="https://rust-lang.github.io/zulip_archive/stream/213817-t-lang/topic/.60let.20pattern.20.3D.20expr.20else.20.7B.20.2E.2E.2E.20.7D.60.20statements.html#245907347">(Jul 14 2021 at 00:45)</a>:</h4>
<p>I like the suggested change of <code>1. May not end with a `}` unless this brace is the terminating brace of a [`BlockExpression`][block-expr].</code>.</p>



<a name="245907602"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/%60let%20pattern%20%3D%20expr%20else%20%7B%20...%20%7D%60%20statements/near/245907602" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Triplett <a href="https://rust-lang.github.io/zulip_archive/stream/213817-t-lang/topic/.60let.20pattern.20.3D.20expr.20else.20.7B.20.2E.2E.2E.20.7D.60.20statements.html#245907602">(Jul 14 2021 at 00:50)</a>:</h4>
<p>Just posted a comment. I think, with the suggested additional changes merged in, this LGTM.</p>



<a name="245949299"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/%60let%20pattern%20%3D%20expr%20else%20%7B%20...%20%7D%60%20statements/near/245949299" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Frank Steffahn <a href="https://rust-lang.github.io/zulip_archive/stream/213817-t-lang/topic/.60let.20pattern.20.3D.20expr.20else.20.7B.20.2E.2E.2E.20.7D.60.20statements.html#245949299">(Jul 14 2021 at 11:53)</a>:</h4>
<p><span class="user-mention silent" data-user-id="239881">Josh Triplett</span> <a href="#narrow/stream/213817-t-lang/topic/.60let.20pattern.20.3D.20expr.20else.20.7B.20.2E.2E.2E.20.7D.60.20statements/near/245907347">said</a>:</p>
<blockquote>
<p>I like the suggested change of <code>1. May not end with a `}` unless this brace is the terminating brace of a [`BlockExpression`][block-expr].</code>.</p>
</blockquote>
<hr>
<p>I’m not sure if this is optimal. Looking at something like the following example as a human</p>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="kd">let</span><span class="w"> </span><span class="n">Constructor</span><span class="p">(</span><span class="n">field</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="c1">// Lorem ipsum dolor sit amet, consetetur sadipscing elitr, sed diam</span>
<span class="w">    </span><span class="c1">// nonumy eirmod tempor invidunt ut labore et dolore magna aliquyam erat,</span>
<span class="w">    </span><span class="c1">// sed diam voluptua. At vero eos et accusam et justo duo dolores et ea rebum.</span>
<span class="w">    </span><span class="c1">// Stet clita kasd gubergren, no sea takimata sanctus est Lorem ipsum dolor sit amet.</span>
<span class="w">    </span><span class="c1">// Lorem ipsum dolor sit amet, consetetur sadipscing elitr, sed diam nonumy eirmod tempor</span>
<span class="w">    </span><span class="c1">// invidunt ut labore et dolore magna aliquyam erat, sed diam voluptua.</span>
<span class="w">    </span><span class="n">bar</span><span class="p">();</span><span class="w"></span>

<span class="w">    </span><span class="c1">// At vero eos et accusam et justo duo dolores et ea rebum. Stet clita kasd</span>
<span class="w">    </span><span class="c1">// gubergren, no sea takimata sanctus est Lorem ipsum dolor sit amet.</span>
<span class="w">    </span><span class="n">baz</span><span class="p">()</span><span class="w"></span>
<span class="p">}</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="n">cond</span><span class="p">()</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="c1">// Lorem ipsum dolor sit amet, consetetur sadipscing elitr, sed diam</span>
<span class="w">    </span><span class="c1">// nonumy eirmod tempor invidunt ut labore et dolore magna aliquyam erat,</span>
<span class="w">    </span><span class="c1">// sed diam voluptua. At vero eos et accusam et justo duo dolores et ea rebum.</span>
<span class="w">    </span><span class="c1">// Stet clita kasd gubergren, no sea takimata sanctus est Lorem ipsum dolor sit amet.</span>
<span class="w">    </span><span class="c1">// Lorem ipsum dolor sit amet, consetetur sadipscing elitr, sed diam nonumy eirmod tempor</span>
<span class="w">    </span><span class="c1">// invidunt ut labore et dolore magna aliquyam erat, sed diam voluptua.</span>
<span class="w">    </span><span class="n">qux</span><span class="p">();</span><span class="w"></span>

<span class="w">    </span><span class="c1">// At vero eos et accusam et justo duo dolores et ea rebum. Stet clita kasd</span>
<span class="w">    </span><span class="c1">// gubergren, no sea takimata sanctus est Lorem ipsum dolor sit amet.</span>
<span class="w">    </span><span class="n">baz</span><span class="p">()</span><span class="w"></span>
<span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="c1">// Stet clita kasd gubergren, no sea takimata sanctus est Lorem ipsum dolor sit amet.</span>
<span class="w">    </span><span class="c1">// Lorem ipsum dolor sit amet, consetetur sadipscing elitr.</span>
<span class="w">    </span><span class="fm">panic!</span><span class="p">()</span><span class="w"></span>
<span class="p">};</span><span class="w"></span>
</code></pre></div>
<p>A reader could have the following thought process:</p>
<ul>
<li>A <code>let</code> statement, but might be <code>let … else</code>, I don’t know if <code>Constructor(field)</code> is irrefutable.</li>
<li>It ends with <code>} else { … };</code> block that diverges, still could be either</li>
<li>It starts with <code>let … = {</code>, so it might be a block and thus <code>let … else</code></li>
<li><strong><em>reading through the whole thing…</em></strong> <span aria-label="unamused" class="emoji emoji-1f612" role="img" title="unamused">:unamused:</span> </li>
<li>Ah, it’s <code>let</code> and not <code>let … else</code>, because even though it starts with <code>{</code> and ends with <code>}</code> it’s actually <code>{ block } + some_construct_with { braces } else { block }</code></li>
</ul>
<p>I’m not sure what you guys are thinking but IMO this is <em>way too difficult</em> to tell <code>let</code> from <code>let else</code>.</p>
<hr>
<p>I like the idea that for some <code>let … = … else { … }</code>, the presence of absence of <code>}</code> immediately before the <code>else</code> could unambiguously indicate whether it’s <code>let</code> or <code>let-else</code>.  I think it’s hard enough that you’ll have to</p>
<ol>
<li>search for the corresponding <code>;</code></li>
<li>if there’s a block, parse backwards to see it it’s an <code>else</code></li>
<li>check for <code>}</code></li>
</ol>
<p>in order to tell <code>let</code> from <code>let-else</code> reliably as a human reader. Let’s not introduce further exceptions with counter-exceptions to this.</p>
<p>Everything with a block just needs some parentheses then, including a block itself. It’s the syntactic price to pay in order to (ab)use <code>else</code> in an entirely new way. I’m personally probably still preferring a prefix keyword like <code>unless</code> that doesn’t need the <code>else</code>, but that’s a different topic.</p>



<a name="245954531"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/%60let%20pattern%20%3D%20expr%20else%20%7B%20...%20%7D%60%20statements/near/245954531" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Mario Carneiro <a href="https://rust-lang.github.io/zulip_archive/stream/213817-t-lang/topic/.60let.20pattern.20.3D.20expr.20else.20.7B.20.2E.2E.2E.20.7D.60.20statements.html#245954531">(Jul 14 2021 at 12:48)</a>:</h4>
<p>To be fair, anyone who writes code that obtuse should be fired. But I am totally okay with taking out the exception for block expressions, which was suggested by @camsteffen . I just posted a list of 11 grammar productions ending in <code>}</code> on the RFC; pick your favorite subset</p>



<a name="245970811"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/%60let%20pattern%20%3D%20expr%20else%20%7B%20...%20%7D%60%20statements/near/245970811" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Triplett <a href="https://rust-lang.github.io/zulip_archive/stream/213817-t-lang/topic/.60let.20pattern.20.3D.20expr.20else.20.7B.20.2E.2E.2E.20.7D.60.20statements.html#245970811">(Jul 14 2021 at 14:53)</a>:</h4>
<p>That example would fail "unless this brace is the terminating brace of a BlockExpression" as far as I can tell.</p>



<a name="245971065"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/%60let%20pattern%20%3D%20expr%20else%20%7B%20...%20%7D%60%20statements/near/245971065" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Triplett <a href="https://rust-lang.github.io/zulip_archive/stream/213817-t-lang/topic/.60let.20pattern.20.3D.20expr.20else.20.7B.20.2E.2E.2E.20.7D.60.20statements.html#245971065">(Jul 14 2021 at 14:55)</a>:</h4>
<p>Might need some clearer phrasing, like "BlockExpression that spans the entire expr of the let-else".</p>



<a name="245985690"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/%60let%20pattern%20%3D%20expr%20else%20%7B%20...%20%7D%60%20statements/near/245985690" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Cameron Steffen <a href="https://rust-lang.github.io/zulip_archive/stream/213817-t-lang/topic/.60let.20pattern.20.3D.20expr.20else.20.7B.20.2E.2E.2E.20.7D.60.20statements.html#245985690">(Jul 14 2021 at 16:41)</a>:</h4>
<p>I think the <code>} + if</code> is clear enough. That is not very nice code with or without let else. Maybe we should have a clippy lint for <code>\n} binop</code>.</p>



<a name="245987750"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/%60let%20pattern%20%3D%20expr%20else%20%7B%20...%20%7D%60%20statements/near/245987750" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Poliorcetics <a href="https://rust-lang.github.io/zulip_archive/stream/213817-t-lang/topic/.60let.20pattern.20.3D.20expr.20else.20.7B.20.2E.2E.2E.20.7D.60.20statements.html#245987750">(Jul 14 2021 at 16:55)</a>:</h4>
<p>The long example above is exactly why I would like some keyword for this instead of (or in addition to) else.</p>



<a name="245988218"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/%60let%20pattern%20%3D%20expr%20else%20%7B%20...%20%7D%60%20statements/near/245988218" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Poliorcetics <a href="https://rust-lang.github.io/zulip_archive/stream/213817-t-lang/topic/.60let.20pattern.20.3D.20expr.20else.20.7B.20.2E.2E.2E.20.7D.60.20statements.html#245988218">(Jul 14 2021 at 16:58)</a>:</h4>
<p>We can all agree it’s an extreme example, but it’s an example we spent attention on. Reading a normal code base I know already, I’ll not read each and every line, I’ll fly over it looking for the overall meaning or some specific part, and a specific keyword is a very powerful indicator whereas else alone would just become confusing in a normal function, especially if there was an if earlier for which I didn’t see the end</p>



<a name="245988582"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/%60let%20pattern%20%3D%20expr%20else%20%7B%20...%20%7D%60%20statements/near/245988582" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Triplett <a href="https://rust-lang.github.io/zulip_archive/stream/213817-t-lang/topic/.60let.20pattern.20.3D.20expr.20else.20.7B.20.2E.2E.2E.20.7D.60.20statements.html#245988582">(Jul 14 2021 at 17:01)</a>:</h4>
<p>I think it's possible to write spaghetti with many different constructs already.</p>



<a name="245988663"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/%60let%20pattern%20%3D%20expr%20else%20%7B%20...%20%7D%60%20statements/near/245988663" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Triplett <a href="https://rust-lang.github.io/zulip_archive/stream/213817-t-lang/topic/.60let.20pattern.20.3D.20expr.20else.20.7B.20.2E.2E.2E.20.7D.60.20statements.html#245988663">(Jul 14 2021 at 17:02)</a>:</h4>
<p>I don't know that we should add syntactic salt just to make that harder, when it also makes practical usage more annoying.</p>



<a name="245991246"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/%60let%20pattern%20%3D%20expr%20else%20%7B%20...%20%7D%60%20statements/near/245991246" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> The 8472 <a href="https://rust-lang.github.io/zulip_archive/stream/213817-t-lang/topic/.60let.20pattern.20.3D.20expr.20else.20.7B.20.2E.2E.2E.20.7D.60.20statements.html#245991246">(Jul 14 2021 at 17:20)</a>:</h4>
<p>Another random idea. <code>let pat match expr else expr</code>. Note the absence of a <code>=</code></p>



<a name="245991866"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/%60let%20pattern%20%3D%20expr%20else%20%7B%20...%20%7D%60%20statements/near/245991866" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jeremiah Senkpiel <a href="https://rust-lang.github.io/zulip_archive/stream/213817-t-lang/topic/.60let.20pattern.20.3D.20expr.20else.20.7B.20.2E.2E.2E.20.7D.60.20statements.html#245991866">(Jul 14 2021 at 17:25)</a>:</h4>
<p>I think I would personally prefer for parenthesis to be required in this case:</p>
<div class="codehilite"><pre><span></span><code>let PATTERN = ({ ... }) else { ... };
</code></pre></div>



<a name="245994308"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/%60let%20pattern%20%3D%20expr%20else%20%7B%20...%20%7D%60%20statements/near/245994308" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Cameron Steffen <a href="https://rust-lang.github.io/zulip_archive/stream/213817-t-lang/topic/.60let.20pattern.20.3D.20expr.20else.20.7B.20.2E.2E.2E.20.7D.60.20statements.html#245994308">(Jul 14 2021 at 17:42)</a>:</h4>
<p><span class="user-mention silent" data-user-id="239881">Josh Triplett</span> <a href="#narrow/stream/213817-t-lang/topic/.60let.20pattern.20.3D.20expr.20else.20.7B.20.2E.2E.2E.20.7D.60.20statements/near/245907217">said</a>:</p>
<blockquote>
<p>Based on the lang team consensus, the thing we wanted to avoid was <code>let PAT = some_construct_with { braces } else { diverge };</code>.</p>
</blockquote>
<p>I think we should move forward with that. We can re-evaluate disallowing any block before stabilization.</p>



<a name="246010029"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/%60let%20pattern%20%3D%20expr%20else%20%7B%20...%20%7D%60%20statements/near/246010029" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nagisa <a href="https://rust-lang.github.io/zulip_archive/stream/213817-t-lang/topic/.60let.20pattern.20.3D.20expr.20else.20.7B.20.2E.2E.2E.20.7D.60.20statements.html#246010029">(Jul 14 2021 at 19:45)</a>:</h4>
<p>If we disallow <code>let PAT = unsafe { ... } else { ... }</code> then there's no way to have an unsafe expr without either including <code>else</code> into the unsafe block or introducing an intermediate <code>let</code> which defeats the purpose of using this construct that way in the fist place.</p>



<a name="246010358"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/%60let%20pattern%20%3D%20expr%20else%20%7B%20...%20%7D%60%20statements/near/246010358" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> bstrie <a href="https://rust-lang.github.io/zulip_archive/stream/213817-t-lang/topic/.60let.20pattern.20.3D.20expr.20else.20.7B.20.2E.2E.2E.20.7D.60.20statements.html#246010358">(Jul 14 2021 at 19:47)</a>:</h4>
<p><code>let PAT = (unsafe { ... }) else { ... }</code> should do it</p>



<a name="246010371"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/%60let%20pattern%20%3D%20expr%20else%20%7B%20...%20%7D%60%20statements/near/246010371" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nagisa <a href="https://rust-lang.github.io/zulip_archive/stream/213817-t-lang/topic/.60let.20pattern.20.3D.20expr.20else.20.7B.20.2E.2E.2E.20.7D.60.20statements.html#246010371">(Jul 14 2021 at 19:48)</a>:</h4>
<p>ah right ^^</p>



<a name="246012649"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/%60let%20pattern%20%3D%20expr%20else%20%7B%20...%20%7D%60%20statements/near/246012649" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Cameron Steffen <a href="https://rust-lang.github.io/zulip_archive/stream/213817-t-lang/topic/.60let.20pattern.20.3D.20expr.20else.20.7B.20.2E.2E.2E.20.7D.60.20statements.html#246012649">(Jul 14 2021 at 20:04)</a>:</h4>
<p>You could argue that <code>unsafe {}</code> is still "just a block". Perhaps we could disambiguate "types of blocks" from "language constructs with braces, other than blocks".</p>



<a name="246015037"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/%60let%20pattern%20%3D%20expr%20else%20%7B%20...%20%7D%60%20statements/near/246015037" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> bstrie <a href="https://rust-lang.github.io/zulip_archive/stream/213817-t-lang/topic/.60let.20pattern.20.3D.20expr.20else.20.7B.20.2E.2E.2E.20.7D.60.20statements.html#246015037">(Jul 14 2021 at 20:24)</a>:</h4>
<p>the grammar in the reference does, it's called "ExpressionWithBlock"</p>



<a name="246020492"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/%60let%20pattern%20%3D%20expr%20else%20%7B%20...%20%7D%60%20statements/near/246020492" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jeremiah Senkpiel <a href="https://rust-lang.github.io/zulip_archive/stream/213817-t-lang/topic/.60let.20pattern.20.3D.20expr.20else.20.7B.20.2E.2E.2E.20.7D.60.20statements.html#246020492">(Jul 14 2021 at 21:03)</a>:</h4>
<p><code>-unsafe { }</code> is <code>GroupedExpression</code>, though.</p>



<a name="246020615"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/%60let%20pattern%20%3D%20expr%20else%20%7B%20...%20%7D%60%20statements/near/246020615" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nagisa <a href="https://rust-lang.github.io/zulip_archive/stream/213817-t-lang/topic/.60let.20pattern.20.3D.20expr.20else.20.7B.20.2E.2E.2E.20.7D.60.20statements.html#246020615">(Jul 14 2021 at 21:03)</a>:</h4>
<p>No it isn't. <code>GroupedExpression = "(" InnerAttribute* Expression ")"</code> (<a href="https://doc.rust-lang.org/reference/expressions/grouped-expr.html">https://doc.rust-lang.org/reference/expressions/grouped-expr.html</a>)</p>



<a name="246021002"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/%60let%20pattern%20%3D%20expr%20else%20%7B%20...%20%7D%60%20statements/near/246021002" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nagisa <a href="https://rust-lang.github.io/zulip_archive/stream/213817-t-lang/topic/.60let.20pattern.20.3D.20expr.20else.20.7B.20.2E.2E.2E.20.7D.60.20statements.html#246021002">(Jul 14 2021 at 21:05)</a>:</h4>
<p>I think using <code>ExpressionWithoutBlock</code> here makes sense and we can expand as people express frustrations with certain <code>ExpressionWithBlock</code> alternatives.</p>



<a name="246021277"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/%60let%20pattern%20%3D%20expr%20else%20%7B%20...%20%7D%60%20statements/near/246021277" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jeremiah Senkpiel <a href="https://rust-lang.github.io/zulip_archive/stream/213817-t-lang/topic/.60let.20pattern.20.3D.20expr.20else.20.7B.20.2E.2E.2E.20.7D.60.20statements.html#246021277">(Jul 14 2021 at 21:07)</a>:</h4>
<p>Ohhh those are operator expressions. Huh ok that makes thing easier then. We can just say <code>ExpressionWithoutBlock</code> in that case then?</p>



<a name="246021499"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/%60let%20pattern%20%3D%20expr%20else%20%7B%20...%20%7D%60%20statements/near/246021499" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jeremiah Senkpiel <a href="https://rust-lang.github.io/zulip_archive/stream/213817-t-lang/topic/.60let.20pattern.20.3D.20expr.20else.20.7B.20.2E.2E.2E.20.7D.60.20statements.html#246021499">(Jul 14 2021 at 21:08)</a>:</h4>
<p>Oh, no, that does not make things easier, under those rules <code>-unsafe { }</code> would still be allowed.</p>



<a name="246021520"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/%60let%20pattern%20%3D%20expr%20else%20%7B%20...%20%7D%60%20statements/near/246021520" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nagisa <a href="https://rust-lang.github.io/zulip_archive/stream/213817-t-lang/topic/.60let.20pattern.20.3D.20expr.20else.20.7B.20.2E.2E.2E.20.7D.60.20statements.html#246021520">(Jul 14 2021 at 21:08)</a>:</h4>
<p>Yeah, with a LazyBooleanExpression exception.</p>



<a name="246021677"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/%60let%20pattern%20%3D%20expr%20else%20%7B%20...%20%7D%60%20statements/near/246021677" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nagisa <a href="https://rust-lang.github.io/zulip_archive/stream/213817-t-lang/topic/.60let.20pattern.20.3D.20expr.20else.20.7B.20.2E.2E.2E.20.7D.60.20statements.html#246021677">(Jul 14 2021 at 21:09)</a>:</h4>
<p>Or I guess with generic <code>OperatorExpression</code> exception?</p>



<a name="246021694"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/%60let%20pattern%20%3D%20expr%20else%20%7B%20...%20%7D%60%20statements/near/246021694" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jeremiah Senkpiel <a href="https://rust-lang.github.io/zulip_archive/stream/213817-t-lang/topic/.60let.20pattern.20.3D.20expr.20else.20.7B.20.2E.2E.2E.20.7D.60.20statements.html#246021694">(Jul 14 2021 at 21:09)</a>:</h4>
<p><code>StructExpression</code>s are also considered <code>ExpressionWithoutBlock</code></p>



<a name="246021906"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/%60let%20pattern%20%3D%20expr%20else%20%7B%20...%20%7D%60%20statements/near/246021906" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nagisa <a href="https://rust-lang.github.io/zulip_archive/stream/213817-t-lang/topic/.60let.20pattern.20.3D.20expr.20else.20.7B.20.2E.2E.2E.20.7D.60.20statements.html#246021906">(Jul 14 2021 at 21:10)</a>:</h4>
<p>Hm, I would say that this is perhaps a grammar definition error, in this specific case.</p>



<a name="246022116"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/%60let%20pattern%20%3D%20expr%20else%20%7B%20...%20%7D%60%20statements/near/246022116" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nagisa <a href="https://rust-lang.github.io/zulip_archive/stream/213817-t-lang/topic/.60let.20pattern.20.3D.20expr.20else.20.7B.20.2E.2E.2E.20.7D.60.20statements.html#246022116">(Jul 14 2021 at 21:11)</a>:</h4>
<p>(technically it isn't, but the intent is clearly different)</p>



<a name="246022298"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/%60let%20pattern%20%3D%20expr%20else%20%7B%20...%20%7D%60%20statements/near/246022298" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nagisa <a href="https://rust-lang.github.io/zulip_archive/stream/213817-t-lang/topic/.60let.20pattern.20.3D.20expr.20else.20.7B.20.2E.2E.2E.20.7D.60.20statements.html#246022298">(Jul 14 2021 at 21:12)</a>:</h4>
<p>So, are we comfortable with not requiring GroupedExpression for something like <code>let 42 = unsafe { ... } + 0 else { ... }</code>?</p>



<a name="246022710"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/%60let%20pattern%20%3D%20expr%20else%20%7B%20...%20%7D%60%20statements/near/246022710" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nagisa <a href="https://rust-lang.github.io/zulip_archive/stream/213817-t-lang/topic/.60let.20pattern.20.3D.20expr.20else.20.7B.20.2E.2E.2E.20.7D.60.20statements.html#246022710">(Jul 14 2021 at 21:14)</a>:</h4>
<p>Or more obnoxiously:</p>
<p><code>let 42 = if cond { ... } else { ... } + 0 else { ... }</code>?</p>



<a name="246022782"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/%60let%20pattern%20%3D%20expr%20else%20%7B%20...%20%7D%60%20statements/near/246022782" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nagisa <a href="https://rust-lang.github.io/zulip_archive/stream/213817-t-lang/topic/.60let.20pattern.20.3D.20expr.20else.20.7B.20.2E.2E.2E.20.7D.60.20statements.html#246022782">(Jul 14 2021 at 21:15)</a>:</h4>
<p>(I think both should be allowed, on the grounds that they aren't ambiguous)</p>



<a name="246022792"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/%60let%20pattern%20%3D%20expr%20else%20%7B%20...%20%7D%60%20statements/near/246022792" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jeremiah Senkpiel <a href="https://rust-lang.github.io/zulip_archive/stream/213817-t-lang/topic/.60let.20pattern.20.3D.20expr.20else.20.7B.20.2E.2E.2E.20.7D.60.20statements.html#246022792">(Jul 14 2021 at 21:15)</a>:</h4>
<p>Yes, because you cannot write <code>if cond { } + 0 else { }</code>.</p>



<a name="246022919"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/%60let%20pattern%20%3D%20expr%20else%20%7B%20...%20%7D%60%20statements/near/246022919" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jeremiah Senkpiel <a href="https://rust-lang.github.io/zulip_archive/stream/213817-t-lang/topic/.60let.20pattern.20.3D.20expr.20else.20.7B.20.2E.2E.2E.20.7D.60.20statements.html#246022919">(Jul 14 2021 at 21:16)</a>:</h4>
<p>Similarly, <code>match { } + 0 else { }</code> doesn't seem like it would ever make sense</p>



<a name="246022921"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/%60let%20pattern%20%3D%20expr%20else%20%7B%20...%20%7D%60%20statements/near/246022921" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nagisa <a href="https://rust-lang.github.io/zulip_archive/stream/213817-t-lang/topic/.60let.20pattern.20.3D.20expr.20else.20.7B.20.2E.2E.2E.20.7D.60.20statements.html#246022921">(Jul 14 2021 at 21:16)</a>:</h4>
<p>But I don't know what to do about prefix operators. And if you allow postfix operators but disallow prefix operators, then there's a sort of… arbitrary-looking restrictions from the user's view IMO.</p>



<a name="246023043"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/%60let%20pattern%20%3D%20expr%20else%20%7B%20...%20%7D%60%20statements/near/246023043" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jeremiah Senkpiel <a href="https://rust-lang.github.io/zulip_archive/stream/213817-t-lang/topic/.60let.20pattern.20.3D.20expr.20else.20.7B.20.2E.2E.2E.20.7D.60.20statements.html#246023043">(Jul 14 2021 at 21:17)</a>:</h4>
<p>Can we infer from the following that it will always be let-else even if <code>match x { } else { }</code> were to become a thing?</p>
<p><code>let Some(x) = match x { ... } else { ... };</code></p>



<a name="246023067"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/%60let%20pattern%20%3D%20expr%20else%20%7B%20...%20%7D%60%20statements/near/246023067" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nagisa <a href="https://rust-lang.github.io/zulip_archive/stream/213817-t-lang/topic/.60let.20pattern.20.3D.20expr.20else.20.7B.20.2E.2E.2E.20.7D.60.20statements.html#246023067">(Jul 14 2021 at 21:18)</a>:</h4>
<p>From Rust's grammar/parser standpoint making a request of "must not end with a curly brace" is pretty weird.</p>



<a name="246023203"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/%60let%20pattern%20%3D%20expr%20else%20%7B%20...%20%7D%60%20statements/near/246023203" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jeremiah Senkpiel <a href="https://rust-lang.github.io/zulip_archive/stream/213817-t-lang/topic/.60let.20pattern.20.3D.20expr.20else.20.7B.20.2E.2E.2E.20.7D.60.20statements.html#246023203">(Jul 14 2021 at 21:19)</a>:</h4>
<p>(I think we can likely infer it is let-else off of the pattern infer unless it's infallible anyways?)</p>



<a name="246023539"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/%60let%20pattern%20%3D%20expr%20else%20%7B%20...%20%7D%60%20statements/near/246023539" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Triplett <a href="https://rust-lang.github.io/zulip_archive/stream/213817-t-lang/topic/.60let.20pattern.20.3D.20expr.20else.20.7B.20.2E.2E.2E.20.7D.60.20statements.html#246023539">(Jul 14 2021 at 21:22)</a>:</h4>
<p>I think I'd be fine with limiting it to ExpressionWithoutBlock, and letting anything else be the domain of a lint.</p>



<a name="246023556"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/%60let%20pattern%20%3D%20expr%20else%20%7B%20...%20%7D%60%20statements/near/246023556" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Triplett <a href="https://rust-lang.github.io/zulip_archive/stream/213817-t-lang/topic/.60let.20pattern.20.3D.20expr.20else.20.7B.20.2E.2E.2E.20.7D.60.20statements.html#246023556">(Jul 14 2021 at 21:22)</a>:</h4>
<p>A lint could, after the fact, handle things like "you have an expression ending in a brace that isn't a braced block".</p>



<a name="246023578"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/%60let%20pattern%20%3D%20expr%20else%20%7B%20...%20%7D%60%20statements/near/246023578" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Triplett <a href="https://rust-lang.github.io/zulip_archive/stream/213817-t-lang/topic/.60let.20pattern.20.3D.20expr.20else.20.7B.20.2E.2E.2E.20.7D.60.20statements.html#246023578">(Jul 14 2021 at 21:22)</a>:</h4>
<p>In a way that's more of a pain in the grammar.</p>



<a name="246023736"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/%60let%20pattern%20%3D%20expr%20else%20%7B%20...%20%7D%60%20statements/near/246023736" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jeremiah Senkpiel <a href="https://rust-lang.github.io/zulip_archive/stream/213817-t-lang/topic/.60let.20pattern.20.3D.20expr.20else.20.7B.20.2E.2E.2E.20.7D.60.20statements.html#246023736">(Jul 14 2021 at 21:24)</a>:</h4>
<p>I was also thinking of suggesting just changing it back to <code>ExpressionWithoutBlock</code> for the first rule... And maybe adding the inference question as an unresolved question...</p>



<a name="246024097"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/%60let%20pattern%20%3D%20expr%20else%20%7B%20...%20%7D%60%20statements/near/246024097" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nagisa <a href="https://rust-lang.github.io/zulip_archive/stream/213817-t-lang/topic/.60let.20pattern.20.3D.20expr.20else.20.7B.20.2E.2E.2E.20.7D.60.20statements.html#246024097">(Jul 14 2021 at 21:27)</a>:</h4>
<p><span class="user-mention" data-user-id="239881">@Josh Triplett</span> Problem <em>is</em> that <code>ExpressionWithoutBlock</code> allows for ambiguous grammar if we decide to in the future add an <code>else</code> to other blocky expressions.</p>



<a name="246024190"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/%60let%20pattern%20%3D%20expr%20else%20%7B%20...%20%7D%60%20statements/near/246024190" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nagisa <a href="https://rust-lang.github.io/zulip_archive/stream/213817-t-lang/topic/.60let.20pattern.20.3D.20expr.20else.20.7B.20.2E.2E.2E.20.7D.60.20statements.html#246024190">(Jul 14 2021 at 21:28)</a>:</h4>
<p>like for example: <code>-if foo { bar } else { baz }</code> (note the <code>-</code>) is a valid <code>ExpressionWithoutBlock</code>.</p>



<a name="246024270"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/%60let%20pattern%20%3D%20expr%20else%20%7B%20...%20%7D%60%20statements/near/246024270" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nagisa <a href="https://rust-lang.github.io/zulip_archive/stream/213817-t-lang/topic/.60let.20pattern.20.3D.20expr.20else.20.7B.20.2E.2E.2E.20.7D.60.20statements.html#246024270">(Jul 14 2021 at 21:29)</a>:</h4>
<p>Though I guess in that situation <code>else</code> branch is necessary either way, because otherwise the expression doesn't always produce a value for <code>-</code> to negate...</p>



<a name="246024388"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/%60let%20pattern%20%3D%20expr%20else%20%7B%20...%20%7D%60%20statements/near/246024388" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nagisa <a href="https://rust-lang.github.io/zulip_archive/stream/213817-t-lang/topic/.60let.20pattern.20.3D.20expr.20else.20.7B.20.2E.2E.2E.20.7D.60.20statements.html#246024388">(Jul 14 2021 at 21:30)</a>:</h4>
<p>I guess a better example is loops here: <code>-while true { ... }</code> is a valid <code>ExpressionWithoutBlock</code>.</p>



<a name="246024480"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/%60let%20pattern%20%3D%20expr%20else%20%7B%20...%20%7D%60%20statements/near/246024480" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> bstrie <a href="https://rust-lang.github.io/zulip_archive/stream/213817-t-lang/topic/.60let.20pattern.20.3D.20expr.20else.20.7B.20.2E.2E.2E.20.7D.60.20statements.html#246024480">(Jul 14 2021 at 21:31)</a>:</h4>
<p>ah good point, I hadn't considered how those expressions compose</p>



<a name="246024533"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/%60let%20pattern%20%3D%20expr%20else%20%7B%20...%20%7D%60%20statements/near/246024533" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nagisa <a href="https://rust-lang.github.io/zulip_archive/stream/213817-t-lang/topic/.60let.20pattern.20.3D.20expr.20else.20.7B.20.2E.2E.2E.20.7D.60.20statements.html#246024533">(Jul 14 2021 at 21:31)</a>:</h4>
<p>But then again, I'm wondering if that's not a bug in our grammar, really.</p>



<a name="246024638"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/%60let%20pattern%20%3D%20expr%20else%20%7B%20...%20%7D%60%20statements/near/246024638" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nagisa <a href="https://rust-lang.github.io/zulip_archive/stream/213817-t-lang/topic/.60let.20pattern.20.3D.20expr.20else.20.7B.20.2E.2E.2E.20.7D.60.20statements.html#246024638">(Jul 14 2021 at 21:32)</a>:</h4>
<p>It shouldn't be difficult to express these situations in slightly more non-terminals.</p>



<a name="246024742"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/%60let%20pattern%20%3D%20expr%20else%20%7B%20...%20%7D%60%20statements/near/246024742" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nagisa <a href="https://rust-lang.github.io/zulip_archive/stream/213817-t-lang/topic/.60let.20pattern.20.3D.20expr.20else.20.7B.20.2E.2E.2E.20.7D.60.20statements.html#246024742">(Jul 14 2021 at 21:33)</a>:</h4>
<p>My concern is somewhat that its gonna be hard to also check for this after the fact if we decide to just allow <code>Expression</code> and then in a validation pass later on discard undesirable combinations.</p>



<a name="246025022"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/%60let%20pattern%20%3D%20expr%20else%20%7B%20...%20%7D%60%20statements/near/246025022" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jeremiah Senkpiel <a href="https://rust-lang.github.io/zulip_archive/stream/213817-t-lang/topic/.60let.20pattern.20.3D.20expr.20else.20.7B.20.2E.2E.2E.20.7D.60.20statements.html#246025022">(Jul 14 2021 at 21:35)</a>:</h4>
<p>Actually, that makes this case ambiguous today:<br>
<code>let Some(x) = *if { a } else { /* ? */ }</code>;</p>



<a name="246025126"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/%60let%20pattern%20%3D%20expr%20else%20%7B%20...%20%7D%60%20statements/near/246025126" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nagisa <a href="https://rust-lang.github.io/zulip_archive/stream/213817-t-lang/topic/.60let.20pattern.20.3D.20expr.20else.20.7B.20.2E.2E.2E.20.7D.60.20statements.html#246025126">(Jul 14 2021 at 21:36)</a>:</h4>
<p>Looks like we do some specialized handling for <code>if</code> at least <a href="https://play.rust-lang.org/?version=stable&amp;mode=debug&amp;edition=2018&amp;gist=235b1e7612fb3b1c4501ed1d36146c3f">https://play.rust-lang.org/?version=stable&amp;mode=debug&amp;edition=2018&amp;gist=235b1e7612fb3b1c4501ed1d36146c3f</a> which contradicts <a href="https://doc.rust-lang.org/reference/expressions/if-expr.html#if-expressions">the reference</a>.</p>



<a name="246025158"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/%60let%20pattern%20%3D%20expr%20else%20%7B%20...%20%7D%60%20statements/near/246025158" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jeremiah Senkpiel <a href="https://rust-lang.github.io/zulip_archive/stream/213817-t-lang/topic/.60let.20pattern.20.3D.20expr.20else.20.7B.20.2E.2E.2E.20.7D.60.20statements.html#246025158">(Jul 14 2021 at 21:37)</a>:</h4>
<p>But I feel like it's not truely ambiguous? The match needs the <code>if</code> to return, and the pattern is failliable</p>



<a name="246025194"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/%60let%20pattern%20%3D%20expr%20else%20%7B%20...%20%7D%60%20statements/near/246025194" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nagisa <a href="https://rust-lang.github.io/zulip_archive/stream/213817-t-lang/topic/.60let.20pattern.20.3D.20expr.20else.20.7B.20.2E.2E.2E.20.7D.60.20statements.html#246025194">(Jul 14 2021 at 21:37)</a>:</h4>
<p>(Not super surprising, given that reference is a best-effort document)</p>



<a name="246025217"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/%60let%20pattern%20%3D%20expr%20else%20%7B%20...%20%7D%60%20statements/near/246025217" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Lukas Wirth <a href="https://rust-lang.github.io/zulip_archive/stream/213817-t-lang/topic/.60let.20pattern.20.3D.20expr.20else.20.7B.20.2E.2E.2E.20.7D.60.20statements.html#246025217">(Jul 14 2021 at 21:37)</a>:</h4>
<p>I was wondering, if you don't mind me chiming in, since the else block is required to diverge. Would it make sense to instead require the else to be followed by a return expression?<br>
As in <code>let PAT = expr else return expr</code>, then one could also use a block like <code>let PAT = expr else return { ... }</code> etc, this would resolve the ambiguity problems right? Though whether people would like that requirement is another question of course</p>



<a name="246025222"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/%60let%20pattern%20%3D%20expr%20else%20%7B%20...%20%7D%60%20statements/near/246025222" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jeremiah Senkpiel <a href="https://rust-lang.github.io/zulip_archive/stream/213817-t-lang/topic/.60let.20pattern.20.3D.20expr.20else.20.7B.20.2E.2E.2E.20.7D.60.20statements.html#246025222">(Jul 14 2021 at 21:37)</a>:</h4>
<p><code>let () = *if true { &amp;() } else { /* ??? */ };</code> would be a truly onerous case</p>



<a name="246025295"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/%60let%20pattern%20%3D%20expr%20else%20%7B%20...%20%7D%60%20statements/near/246025295" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Triplett <a href="https://rust-lang.github.io/zulip_archive/stream/213817-t-lang/topic/.60let.20pattern.20.3D.20expr.20else.20.7B.20.2E.2E.2E.20.7D.60.20statements.html#246025295">(Jul 14 2021 at 21:38)</a>:</h4>
<p><span class="user-mention" data-user-id="300586">@Lukas Wirth</span> We don't require that it returns, only that it diverges. For example, it might panic, or use the exit function, or similar.</p>



<a name="246025340"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/%60let%20pattern%20%3D%20expr%20else%20%7B%20...%20%7D%60%20statements/near/246025340" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Lukas Wirth <a href="https://rust-lang.github.io/zulip_archive/stream/213817-t-lang/topic/.60let.20pattern.20.3D.20expr.20else.20.7B.20.2E.2E.2E.20.7D.60.20statements.html#246025340">(Jul 14 2021 at 21:39)</a>:</h4>
<p>Yes I know but then you could just write <code>return panic!()</code> was my thought</p>



<a name="246025369"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/%60let%20pattern%20%3D%20expr%20else%20%7B%20...%20%7D%60%20statements/near/246025369" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jeremiah Senkpiel <a href="https://rust-lang.github.io/zulip_archive/stream/213817-t-lang/topic/.60let.20pattern.20.3D.20expr.20else.20.7B.20.2E.2E.2E.20.7D.60.20statements.html#246025369">(Jul 14 2021 at 21:39)</a>:</h4>
<p>Might as well just use a different keyword then, I'd wager</p>



<a name="246025389"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/%60let%20pattern%20%3D%20expr%20else%20%7B%20...%20%7D%60%20statements/near/246025389" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Lukas Wirth <a href="https://rust-lang.github.io/zulip_archive/stream/213817-t-lang/topic/.60let.20pattern.20.3D.20expr.20else.20.7B.20.2E.2E.2E.20.7D.60.20statements.html#246025389">(Jul 14 2021 at 21:39)</a>:</h4>
<p>Though then the question is whether that just makes code more confusing or not</p>



<a name="246025398"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/%60let%20pattern%20%3D%20expr%20else%20%7B%20...%20%7D%60%20statements/near/246025398" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Triplett <a href="https://rust-lang.github.io/zulip_archive/stream/213817-t-lang/topic/.60let.20pattern.20.3D.20expr.20else.20.7B.20.2E.2E.2E.20.7D.60.20statements.html#246025398">(Jul 14 2021 at 21:39)</a>:</h4>
<p>Having to write return when you're not actually returning seems even more confusing to me.</p>



<a name="246025412"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/%60let%20pattern%20%3D%20expr%20else%20%7B%20...%20%7D%60%20statements/near/246025412" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Lukas Wirth <a href="https://rust-lang.github.io/zulip_archive/stream/213817-t-lang/topic/.60let.20pattern.20.3D.20expr.20else.20.7B.20.2E.2E.2E.20.7D.60.20statements.html#246025412">(Jul 14 2021 at 21:40)</a>:</h4>
<p>ye, understandable</p>



<a name="246025477"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/%60let%20pattern%20%3D%20expr%20else%20%7B%20...%20%7D%60%20statements/near/246025477" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jeremiah Senkpiel <a href="https://rust-lang.github.io/zulip_archive/stream/213817-t-lang/topic/.60let.20pattern.20.3D.20expr.20else.20.7B.20.2E.2E.2E.20.7D.60.20statements.html#246025477">(Jul 14 2021 at 21:40)</a>:</h4>
<p>I'd rather either <code>guard let else</code> or <code>let otherwise</code> compared to <code>let else return</code></p>



<a name="246025880"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/%60let%20pattern%20%3D%20expr%20else%20%7B%20...%20%7D%60%20statements/near/246025880" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nagisa <a href="https://rust-lang.github.io/zulip_archive/stream/213817-t-lang/topic/.60let.20pattern.20.3D.20expr.20else.20.7B.20.2E.2E.2E.20.7D.60.20statements.html#246025880">(Jul 14 2021 at 21:45)</a>:</h4>
<p>I'm not sure <code>guard let</code> is a valid option as it'd require infinite look-ahead AFAICT.</p>



<a name="246025972"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/%60let%20pattern%20%3D%20expr%20else%20%7B%20...%20%7D%60%20statements/near/246025972" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Triplett <a href="https://rust-lang.github.io/zulip_archive/stream/213817-t-lang/topic/.60let.20pattern.20.3D.20expr.20else.20.7B.20.2E.2E.2E.20.7D.60.20statements.html#246025972">(Jul 14 2021 at 21:46)</a>:</h4>
<p>I'm not a fan of guard let, but why would it require more than a token of look ahead?</p>



<a name="246026101"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/%60let%20pattern%20%3D%20expr%20else%20%7B%20...%20%7D%60%20statements/near/246026101" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nagisa <a href="https://rust-lang.github.io/zulip_archive/stream/213817-t-lang/topic/.60let.20pattern.20.3D.20expr.20else.20.7B.20.2E.2E.2E.20.7D.60.20statements.html#246026101">(Jul 14 2021 at 21:47)</a>:</h4>
<p>that is at <code>⸘</code> in <code>guard let = if { ... } ⸘ else { ... }</code> you won't know if you're parsing <code>else</code>  for the <code>if ... else ...</code> or for the <code>guard let</code>. And deciding that requires parsing the entirety of <code>else { ... }</code>.</p>



<a name="246032093"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/%60let%20pattern%20%3D%20expr%20else%20%7B%20...%20%7D%60%20statements/near/246032093" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Mario Carneiro <a href="https://rust-lang.github.io/zulip_archive/stream/213817-t-lang/topic/.60let.20pattern.20.3D.20expr.20else.20.7B.20.2E.2E.2E.20.7D.60.20statements.html#246032093">(Jul 14 2021 at 22:52)</a>:</h4>
<p><span class="user-mention silent" data-user-id="123586">nagisa</span> <a href="#narrow/stream/213817-t-lang/topic/.60let.20pattern.20.3D.20expr.20else.20.7B.20.2E.2E.2E.20.7D.60.20statements/near/246024270">said</a>:</p>
<blockquote>
<p>Though I guess in that situation <code>else</code> branch is necessary either way, because otherwise the expression doesn't always produce a value for <code>-</code> to negate...</p>
</blockquote>
<p>You can make that example work if you use <code>+</code> instead: <code>Foo + if cond { expr }</code> can typecheck if <code>Foo</code> implements <code>Add&lt;()&gt;</code> and can have any type you like</p>



<a name="246032610"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/%60let%20pattern%20%3D%20expr%20else%20%7B%20...%20%7D%60%20statements/near/246032610" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Mario Carneiro <a href="https://rust-lang.github.io/zulip_archive/stream/213817-t-lang/topic/.60let.20pattern.20.3D.20expr.20else.20.7B.20.2E.2E.2E.20.7D.60.20statements.html#246032610">(Jul 14 2021 at 22:58)</a>:</h4>
<p><span class="user-mention silent" data-user-id="319552">Jeremiah Senkpiel</span> <a href="#narrow/stream/213817-t-lang/topic/.60let.20pattern.20.3D.20expr.20else.20.7B.20.2E.2E.2E.20.7D.60.20statements/near/246025222">said</a>:</p>
<blockquote>
<p><code>let () = *if true { &amp;() } else { /* ??? */ };</code> would be a truly onerous case</p>
</blockquote>
<p>To reiterate what I said earlier: this presents no parsing difficulties for the compiler, because it uses longest match rules to pair the <code>else</code>, so this will always be parsed as a let statement. It is only if you have some trailing else after the expression is done, e.g. <code>let () = *(if true { &amp;() }) else { /* ??? */ };</code> or <code>let () = *if true { &amp;() } else { bla } else { /* ??? */ };</code>, that it will be parsed as a let-else; then, once it is determined to be a let-else, the grammar restrictions are applied, which would cause the second example to be rejected because the final brace in the expression is not coming from a member of the (undetermined pending bikeshedding) list of whitelisted expression productions.</p>



<a name="246033010"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/%60let%20pattern%20%3D%20expr%20else%20%7B%20...%20%7D%60%20statements/near/246033010" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Mario Carneiro <a href="https://rust-lang.github.io/zulip_archive/stream/213817-t-lang/topic/.60let.20pattern.20.3D.20expr.20else.20.7B.20.2E.2E.2E.20.7D.60.20statements.html#246033010">(Jul 14 2021 at 23:02)</a>:</h4>
<p>I don't think <code>ExpressionWithoutBlock</code> should be used for this RFC. It approximates what we want but it is intended for different purposes and it doesn't really work here.</p>



<a name="246033562"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/%60let%20pattern%20%3D%20expr%20else%20%7B%20...%20%7D%60%20statements/near/246033562" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Mario Carneiro <a href="https://rust-lang.github.io/zulip_archive/stream/213817-t-lang/topic/.60let.20pattern.20.3D.20expr.20else.20.7B.20.2E.2E.2E.20.7D.60.20statements.html#246033562">(Jul 14 2021 at 23:09)</a>:</h4>
<p>Also, I don't know if this has been mentioned yet, but invisible grouping should also count as parentheses and should be allowed. That is:</p>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="fm">macro_rules!</span><span class="w"> </span><span class="n">foo</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="p">(</span><span class="cp">$e</span>:<span class="nc">expr</span><span class="p">)</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="kd">let</span><span class="w"> </span><span class="nb">Some</span><span class="p">(</span><span class="n">x</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="cp">$e</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="k">return</span><span class="w"> </span><span class="p">};</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="p">}</span><span class="w"></span>
<span class="k">fn</span> <span class="nf">main</span><span class="p">()</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">  </span><span class="n">foo</span><span class="o">!</span><span class="p">(</span><span class="k">if</span><span class="w"> </span><span class="kc">true</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nb">Some</span><span class="p">(())</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nb">None</span><span class="w"> </span><span class="p">})</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>
</code></pre></div>
<p>produces this after macro expansion:</p>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="k">fn</span> <span class="nf">main</span><span class="p">()</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">  </span><span class="kd">let</span><span class="w"> </span><span class="nb">Some</span><span class="p">(</span><span class="n">x</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">&lt;</span><span class="k">if</span><span class="w"> </span><span class="kc">true</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nb">Some</span><span class="p">(())</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nb">None</span><span class="w"> </span><span class="p">}</span><span class="o">&gt;</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="k">return</span><span class="w"> </span><span class="p">};</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>
</code></pre></div>
<p>where <code>&lt;e&gt;</code> is "invisible grouping", which acts like parentheses but has no actual token (the angle brackets are for illustration). When we analyze the parse tree for this expression, we will see a grouping expression with no tokens at the top level, and so allow it without peeking past the grouping.</p>



<a name="246077237"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/%60let%20pattern%20%3D%20expr%20else%20%7B%20...%20%7D%60%20statements/near/246077237" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Frank Steffahn <a href="https://rust-lang.github.io/zulip_archive/stream/213817-t-lang/topic/.60let.20pattern.20.3D.20expr.20else.20.7B.20.2E.2E.2E.20.7D.60.20statements.html#246077237">(Jul 15 2021 at 10:43)</a>:</h4>
<p>I feel like the main value of a dedicated keyword would be that there’s no need for the syntactically problematic <code>else</code> at all. Since people seem to suggest <code>guard let …</code> to still come with <code>else</code>, maybe <code>unless</code> is the better keyword after all. <code>unless let Some(x) = foo() { … }</code> doesn’t need the <code>else</code>. The only downside to current let-else proposals might be that it’s less clear that the construct introduces bindings in its containing scope, something that previously only statements starting with <code>let</code> as well as statement macro invocation could to.</p>



<a name="246102129"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/%60let%20pattern%20%3D%20expr%20else%20%7B%20...%20%7D%60%20statements/near/246102129" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Triplett <a href="https://rust-lang.github.io/zulip_archive/stream/213817-t-lang/topic/.60let.20pattern.20.3D.20expr.20else.20.7B.20.2E.2E.2E.20.7D.60.20statements.html#246102129">(Jul 15 2021 at 14:29)</a>:</h4>
<p><span class="user-mention" data-user-id="280891">@Frank Steffahn</span> I think that construct is the most compelling alternative I've seen. I still prefer let-else because it feels more like a natural extension of let to me, but having only one keyword "unless" is an improvement over other alternative syntax proposals.</p>



<a name="246103059"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/%60let%20pattern%20%3D%20expr%20else%20%7B%20...%20%7D%60%20statements/near/246103059" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nagisa <a href="https://rust-lang.github.io/zulip_archive/stream/213817-t-lang/topic/.60let.20pattern.20.3D.20expr.20else.20.7B.20.2E.2E.2E.20.7D.60.20statements.html#246103059">(Jul 15 2021 at 14:34)</a>:</h4>
<p>Not having a keyword between an expression and <code>{}</code> is somewhat ambiguous but we can apply the same treatment as for <code>if</code> and since that's already done, it'd be easy to apply it here too.</p>



<a name="246103384"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/%60let%20pattern%20%3D%20expr%20else%20%7B%20...%20%7D%60%20statements/near/246103384" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nagisa <a href="https://rust-lang.github.io/zulip_archive/stream/213817-t-lang/topic/.60let.20pattern.20.3D.20expr.20else.20.7B.20.2E.2E.2E.20.7D.60.20statements.html#246103384">(Jul 15 2021 at 14:37)</a>:</h4>
<p>shed colour: <code>maybe let Everyone = use() { rust?(); }</code></p>



<a name="246103497"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/%60let%20pattern%20%3D%20expr%20else%20%7B%20...%20%7D%60%20statements/near/246103497" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Triplett <a href="https://rust-lang.github.io/zulip_archive/stream/213817-t-lang/topic/.60let.20pattern.20.3D.20expr.20else.20.7B.20.2E.2E.2E.20.7D.60.20statements.html#246103497">(Jul 15 2021 at 14:37)</a>:</h4>
<p>"maybe" will confuse a lot of Haskell programmers. :)</p>



<a name="246103787"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/%60let%20pattern%20%3D%20expr%20else%20%7B%20...%20%7D%60%20statements/near/246103787" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Triplett <a href="https://rust-lang.github.io/zulip_archive/stream/213817-t-lang/topic/.60let.20pattern.20.3D.20expr.20else.20.7B.20.2E.2E.2E.20.7D.60.20statements.html#246103787">(Jul 15 2021 at 14:39)</a>:</h4>
<p>Also, I think it doesn't introduce the construct in a fashion that reads like a description. <code>if let x = e { ... }</code> feels like a natural description of when the block is run. "maybe" in that context seems ambiguous about when the block is run.</p>



<a name="246103903"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/%60let%20pattern%20%3D%20expr%20else%20%7B%20...%20%7D%60%20statements/near/246103903" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Triplett <a href="https://rust-lang.github.io/zulip_archive/stream/213817-t-lang/topic/.60let.20pattern.20.3D.20expr.20else.20.7B.20.2E.2E.2E.20.7D.60.20statements.html#246103903">(Jul 15 2021 at 14:40)</a>:</h4>
<p>"for" and "while" and "if" all describe how the block is used. So does "unless", for that matter.</p>



<a name="246104236"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/%60let%20pattern%20%3D%20expr%20else%20%7B%20...%20%7D%60%20statements/near/246104236" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nagisa <a href="https://rust-lang.github.io/zulip_archive/stream/213817-t-lang/topic/.60let.20pattern.20.3D.20expr.20else.20.7B.20.2E.2E.2E.20.7D.60.20statements.html#246104236">(Jul 15 2021 at 14:43)</a>:</h4>
<p>If we're introducing a different keyword, I don't see why it wouldn't make it more sense to have it between expression and the block either way.</p>



<a name="246104347"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/%60let%20pattern%20%3D%20expr%20else%20%7B%20...%20%7D%60%20statements/near/246104347" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Triplett <a href="https://rust-lang.github.io/zulip_archive/stream/213817-t-lang/topic/.60let.20pattern.20.3D.20expr.20else.20.7B.20.2E.2E.2E.20.7D.60.20statements.html#246104347">(Jul 15 2021 at 14:43)</a>:</h4>
<p><span class="user-mention" data-user-id="123586">@nagisa</span> I agree. I would prefer that. I just don't think we need a new keyword.</p>



<a name="246104351"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/%60let%20pattern%20%3D%20expr%20else%20%7B%20...%20%7D%60%20statements/near/246104351" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> The 8472 <a href="https://rust-lang.github.io/zulip_archive/stream/213817-t-lang/topic/.60let.20pattern.20.3D.20expr.20else.20.7B.20.2E.2E.2E.20.7D.60.20statements.html#246104351">(Jul 15 2021 at 14:43)</a>:</h4>
<p>We could put it in suffix position, like perl or ruby do <code>{ return Err("") } unless let Some(x) = foo();</code></p>



<a name="246104444"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/%60let%20pattern%20%3D%20expr%20else%20%7B%20...%20%7D%60%20statements/near/246104444" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Triplett <a href="https://rust-lang.github.io/zulip_archive/stream/213817-t-lang/topic/.60let.20pattern.20.3D.20expr.20else.20.7B.20.2E.2E.2E.20.7D.60.20statements.html#246104444">(Jul 15 2021 at 14:44)</a>:</h4>
<p><span class="user-mention" data-user-id="330154">@The 8472</span> That would really hide the binding.</p>



<a name="246104484"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/%60let%20pattern%20%3D%20expr%20else%20%7B%20...%20%7D%60%20statements/near/246104484" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> The 8472 <a href="https://rust-lang.github.io/zulip_archive/stream/213817-t-lang/topic/.60let.20pattern.20.3D.20expr.20else.20.7B.20.2E.2E.2E.20.7D.60.20statements.html#246104484">(Jul 15 2021 at 14:44)</a>:</h4>
<p>depends on how you newline</p>



<a name="246104517"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/%60let%20pattern%20%3D%20expr%20else%20%7B%20...%20%7D%60%20statements/near/246104517" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Triplett <a href="https://rust-lang.github.io/zulip_archive/stream/213817-t-lang/topic/.60let.20pattern.20.3D.20expr.20else.20.7B.20.2E.2E.2E.20.7D.60.20statements.html#246104517">(Jul 15 2021 at 14:44)</a>:</h4>
<p>Most of the time, the error handling code is less interesting than the binding and the expression, so it shouldn't be in a more prominent position than the binding and the expression.</p>



<a name="246105010"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/%60let%20pattern%20%3D%20expr%20else%20%7B%20...%20%7D%60%20statements/near/246105010" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> The 8472 <a href="https://rust-lang.github.io/zulip_archive/stream/213817-t-lang/topic/.60let.20pattern.20.3D.20expr.20else.20.7B.20.2E.2E.2E.20.7D.60.20statements.html#246105010">(Jul 15 2021 at 14:48)</a>:</h4>
<p>It has the advantage of being less confusing with and/or patterns and let chains that may follow, the error case would be clearly separate from all that</p>



<a name="246105033"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/%60let%20pattern%20%3D%20expr%20else%20%7B%20...%20%7D%60%20statements/near/246105033" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Frank Steffahn <a href="https://rust-lang.github.io/zulip_archive/stream/213817-t-lang/topic/.60let.20pattern.20.3D.20expr.20else.20.7B.20.2E.2E.2E.20.7D.60.20statements.html#246105033">(Jul 15 2021 at 14:48)</a>:</h4>
<p><code>unless</code> can also trivially support let-chains the same way that <code>if</code> does, in particular using <code>unless</code> with a boolean as a guard/assertion with custom error behavior could be useful.</p>
<p><code>unless condition() { … }</code> would be like <code>if !condition() { … }</code> except you immediately know that the block <code>{ … }</code> is diverging (so you can skip it when reading the code and still know that <code>condition()</code> is <em>true</em> after the <code>unless</code> statement). </p>
<p><code>unless condition() { panic!(…) }</code> would be similar to <code>assert!(condition())</code>.</p>



<a name="246105300"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/%60let%20pattern%20%3D%20expr%20else%20%7B%20...%20%7D%60%20statements/near/246105300" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Triplett <a href="https://rust-lang.github.io/zulip_archive/stream/213817-t-lang/topic/.60let.20pattern.20.3D.20expr.20else.20.7B.20.2E.2E.2E.20.7D.60.20statements.html#246105300">(Jul 15 2021 at 14:50)</a>:</h4>
<p>I feel like it would be confusing to allow let-chains in unless. Would the semantic be that you run the diverging block if any of the bindings fail? Does each binding have the previous binding in scope? Which bindings does the block have in scope?</p>



<a name="246105404"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/%60let%20pattern%20%3D%20expr%20else%20%7B%20...%20%7D%60%20statements/near/246105404" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Frank Steffahn <a href="https://rust-lang.github.io/zulip_archive/stream/213817-t-lang/topic/.60let.20pattern.20.3D.20expr.20else.20.7B.20.2E.2E.2E.20.7D.60.20statements.html#246105404">(Jul 15 2021 at 14:51)</a>:</h4>
<blockquote>
<p>Would the semantic be that you run the diverging block if any of the bindings fail?</p>
</blockquote>
<p>yes, or any of the boolean guards</p>
<blockquote>
<p>Does each binding have the previous binding in scope?</p>
</blockquote>
<p>yes</p>
<blockquote>
<p>Which bindings does the block have in scope?</p>
</blockquote>
<p>no bindings</p>



<a name="246105542"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/%60let%20pattern%20%3D%20expr%20else%20%7B%20...%20%7D%60%20statements/near/246105542" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Triplett <a href="https://rust-lang.github.io/zulip_archive/stream/213817-t-lang/topic/.60let.20pattern.20.3D.20expr.20else.20.7B.20.2E.2E.2E.20.7D.60.20statements.html#246105542">(Jul 15 2021 at 14:52)</a>:</h4>
<p>Hmmm. So, one advantage of unless would be if you want to have exactly the same failure handling for multiple bindings.</p>



<a name="246105608"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/%60let%20pattern%20%3D%20expr%20else%20%7B%20...%20%7D%60%20statements/near/246105608" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Triplett <a href="https://rust-lang.github.io/zulip_archive/stream/213817-t-lang/topic/.60let.20pattern.20.3D.20expr.20else.20.7B.20.2E.2E.2E.20.7D.60.20statements.html#246105608">(Jul 15 2021 at 14:53)</a>:</h4>
<p>That said, most of the time I find that I want different failure handling for each binding, if only because I need a different error message.</p>



<a name="246105673"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/%60let%20pattern%20%3D%20expr%20else%20%7B%20...%20%7D%60%20statements/near/246105673" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> The 8472 <a href="https://rust-lang.github.io/zulip_archive/stream/213817-t-lang/topic/.60let.20pattern.20.3D.20expr.20else.20.7B.20.2E.2E.2E.20.7D.60.20statements.html#246105673">(Jul 15 2021 at 14:53)</a>:</h4>
<p>then chaining might not be the right choice? it only makes sense if you want to condense a lot of conditions into one happy path</p>



<a name="246105802"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/%60let%20pattern%20%3D%20expr%20else%20%7B%20...%20%7D%60%20statements/near/246105802" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Frank Steffahn <a href="https://rust-lang.github.io/zulip_archive/stream/213817-t-lang/topic/.60let.20pattern.20.3D.20expr.20else.20.7B.20.2E.2E.2E.20.7D.60.20statements.html#246105802">(Jul 15 2021 at 14:54)</a>:</h4>
<p>basically</p>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="n">unless</span><span class="w"> </span><span class="n">CHAIN</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="n">DIVERGING_BLOCK</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>
<span class="n">SUBSEQUENT</span><span class="w"></span>
<span class="n">STATEMENTS</span><span class="w"></span>
<span class="c1">// end of containing block</span>
</code></pre></div>
<p>would be the same as</p>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="k">if</span><span class="w"> </span><span class="n">CHAIN</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="n">SUBSEQUENT</span><span class="w"></span>
<span class="w">    </span><span class="n">STATEMENTS</span><span class="w"></span>
<span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="n">DIVERGING_BLOCK</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>
</code></pre></div>
<p>(note that unlike <code>if</code>, <code>unless</code> is a statement, not an expression)</p>



<a name="246105941"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/%60let%20pattern%20%3D%20expr%20else%20%7B%20...%20%7D%60%20statements/near/246105941" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Triplett <a href="https://rust-lang.github.io/zulip_archive/stream/213817-t-lang/topic/.60let.20pattern.20.3D.20expr.20else.20.7B.20.2E.2E.2E.20.7D.60.20statements.html#246105941">(Jul 15 2021 at 14:55)</a>:</h4>
<p>I've found many times that I do want chaining within an if-let, but in those cases, I don't typically want to diverge in the else.</p>



<a name="246106040"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/%60let%20pattern%20%3D%20expr%20else%20%7B%20...%20%7D%60%20statements/near/246106040" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Triplett <a href="https://rust-lang.github.io/zulip_archive/stream/213817-t-lang/topic/.60let.20pattern.20.3D.20expr.20else.20.7B.20.2E.2E.2E.20.7D.60.20statements.html#246106040">(Jul 15 2021 at 14:56)</a>:</h4>
<p>But in any case, I do feel like unless has become the leading alternative contender.</p>



<a name="246144585"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/%60let%20pattern%20%3D%20expr%20else%20%7B%20...%20%7D%60%20statements/near/246144585" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Poliorcetics <a href="https://rust-lang.github.io/zulip_archive/stream/213817-t-lang/topic/.60let.20pattern.20.3D.20expr.20else.20.7B.20.2E.2E.2E.20.7D.60.20statements.html#246144585">(Jul 15 2021 at 19:37)</a>:</h4>
<p><span class="user-mention" data-user-id="239881">@Josh Triplett</span> I have this Swift example of a long chain where the divergence is the same for all failures: I get one « None », I return a « None » <a href="https://github.com/poliorcetics/ffn-dl/blob/c9aec0e7c8b52fa92434a949dbf443d01886a7f5/Sources/ffn-dl/Sites/Fanfiction.net/FFNStory.swift#L76">https://github.com/poliorcetics/ffn-dl/blob/c9aec0e7c8b52fa92434a949dbf443d01886a7f5/Sources/ffn-dl/Sites/Fanfiction.net/FFNStory.swift#L76</a></p>



<a name="246144743"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/%60let%20pattern%20%3D%20expr%20else%20%7B%20...%20%7D%60%20statements/near/246144743" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Poliorcetics <a href="https://rust-lang.github.io/zulip_archive/stream/213817-t-lang/topic/.60let.20pattern.20.3D.20expr.20else.20.7B.20.2E.2E.2E.20.7D.60.20statements.html#246144743">(Jul 15 2021 at 19:38)</a>:</h4>
<div class="codehilite" data-code-language="Swift"><pre><span></span><code>    <span class="k">guard</span> <span class="kd">let</span> <span class="nv">head</span> <span class="p">=</span> <span class="n">doc</span><span class="p">.</span><span class="n">head</span><span class="p">,</span>
      <span class="kd">let</span> <span class="nv">url</span> <span class="p">=</span> <span class="kc">Self</span><span class="p">.</span><span class="n">_site</span><span class="p">.</span><span class="n">findCanonicalUrl</span><span class="p">(</span><span class="k">in</span><span class="p">:</span> <span class="n">head</span><span class="p">)?.</span><span class="n">makeChapterURL</span><span class="p">(</span><span class="k">for</span><span class="p">:</span> <span class="mi">1</span><span class="p">),</span>
      <span class="kd">let</span> <span class="nv">body</span> <span class="p">=</span> <span class="n">doc</span><span class="p">.</span><span class="n">body</span><span class="p">,</span>
      <span class="kd">let</span> <span class="nv">title</span> <span class="p">=</span> <span class="n">findTitle</span><span class="p">(</span><span class="k">in</span><span class="p">:</span> <span class="n">body</span><span class="p">),</span>
      <span class="kd">let</span> <span class="nv">author</span> <span class="p">=</span> <span class="n">Author</span><span class="p">(</span><span class="n">from</span><span class="p">:</span> <span class="n">doc</span><span class="p">,</span> <span class="n">withFinder</span><span class="p">:</span> <span class="kc">Self</span><span class="p">.</span><span class="n">site</span><span class="p">.</span><span class="n">authorFinder</span><span class="p">),</span>
      <span class="kd">let</span> <span class="nv">summary</span> <span class="p">=</span> <span class="n">findSummary</span><span class="p">(</span><span class="k">in</span><span class="p">:</span> <span class="n">body</span><span class="p">),</span>
      <span class="kd">let</span> <span class="nv">tokens</span> <span class="p">=</span> <span class="n">findTokens</span><span class="p">(</span><span class="k">in</span><span class="p">:</span> <span class="n">body</span><span class="p">),</span>
      <span class="kd">let</span> <span class="nv">universe</span> <span class="p">=</span> <span class="n">Universe</span><span class="p">(</span><span class="n">from</span><span class="p">:</span> <span class="n">doc</span><span class="p">,</span> <span class="n">withFinder</span><span class="p">:</span> <span class="kc">Self</span><span class="p">.</span><span class="n">site</span><span class="p">.</span><span class="n">universeFinder</span><span class="p">)</span>
      <span class="k">else</span> <span class="p">{</span>
        <span class="k">return</span> <span class="kc">nil</span>
    <span class="p">}</span>
</code></pre></div>



<a name="246145221"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/%60let%20pattern%20%3D%20expr%20else%20%7B%20...%20%7D%60%20statements/near/246145221" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Poliorcetics <a href="https://rust-lang.github.io/zulip_archive/stream/213817-t-lang/topic/.60let.20pattern.20.3D.20expr.20else.20.7B.20.2E.2E.2E.20.7D.60.20statements.html#246145221">(Jul 15 2021 at 19:42)</a>:</h4>
<p>Since I'm in a failable initializer like <code>Self::new() -&gt; Option&lt;Self&gt;</code> I cannot return anything but an <code>Option</code> and panicking is not the answer here so all preconditions are checked at once and return the same thing if even only one of them fails.</p>



<a name="246145297"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/%60let%20pattern%20%3D%20expr%20else%20%7B%20...%20%7D%60%20statements/near/246145297" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Poliorcetics <a href="https://rust-lang.github.io/zulip_archive/stream/213817-t-lang/topic/.60let.20pattern.20.3D.20expr.20else.20.7B.20.2E.2E.2E.20.7D.60.20statements.html#246145297">(Jul 15 2021 at 19:42)</a>:</h4>
<p>Note that <code>body</code> is also used after it was successfully bound (<code>let body = doc.body, let title = findTitle(in: body),</code>)</p>



<a name="246150682"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/%60let%20pattern%20%3D%20expr%20else%20%7B%20...%20%7D%60%20statements/near/246150682" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jacob Lifshay <a href="https://rust-lang.github.io/zulip_archive/stream/213817-t-lang/topic/.60let.20pattern.20.3D.20expr.20else.20.7B.20.2E.2E.2E.20.7D.60.20statements.html#246150682">(Jul 15 2021 at 20:27)</a>:</h4>
<p>that one particular case seems better covered by <code>?</code></p>



<a name="246151976"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/%60let%20pattern%20%3D%20expr%20else%20%7B%20...%20%7D%60%20statements/near/246151976" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Poliorcetics <a href="https://rust-lang.github.io/zulip_archive/stream/213817-t-lang/topic/.60let.20pattern.20.3D.20expr.20else.20.7B.20.2E.2E.2E.20.7D.60.20statements.html#246151976">(Jul 15 2021 at 20:38)</a>:</h4>
<p>That’s true, Swift doesn’t have that, I forgot about it in my comparison</p>



<a name="246183162"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/%60let%20pattern%20%3D%20expr%20else%20%7B%20...%20%7D%60%20statements/near/246183162" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Cameron Steffen <a href="https://rust-lang.github.io/zulip_archive/stream/213817-t-lang/topic/.60let.20pattern.20.3D.20expr.20else.20.7B.20.2E.2E.2E.20.7D.60.20statements.html#246183162">(Jul 16 2021 at 04:17)</a>:</h4>
<p>unless let has a surprising symmetry with if let and while let</p>



<a name="246183303"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/%60let%20pattern%20%3D%20expr%20else%20%7B%20...%20%7D%60%20statements/near/246183303" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Cameron Steffen <a href="https://rust-lang.github.io/zulip_archive/stream/213817-t-lang/topic/.60let.20pattern.20.3D.20expr.20else.20.7B.20.2E.2E.2E.20.7D.60.20statements.html#246183303">(Jul 16 2021 at 04:21)</a>:</h4>
<p>and resolves the introducer syntax question</p>



<a name="246183913"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/%60let%20pattern%20%3D%20expr%20else%20%7B%20...%20%7D%60%20statements/near/246183913" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Cameron Steffen <a href="https://rust-lang.github.io/zulip_archive/stream/213817-t-lang/topic/.60let.20pattern.20.3D.20expr.20else.20.7B.20.2E.2E.2E.20.7D.60.20statements.html#246183913">(Jul 16 2021 at 04:37)</a>:</h4>
<p>This feels like a game-changer for me. And I don't feel that let chains would be confusing. It's very much like if let but the scope of the bindings is flipped.</p>



<a name="246184813"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/%60let%20pattern%20%3D%20expr%20else%20%7B%20...%20%7D%60%20statements/near/246184813" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Mario Carneiro <a href="https://rust-lang.github.io/zulip_archive/stream/213817-t-lang/topic/.60let.20pattern.20.3D.20expr.20else.20.7B.20.2E.2E.2E.20.7D.60.20statements.html#246184813">(Jul 16 2021 at 04:58)</a>:</h4>
<p>Isn't this just circling back to the original <code>if !let</code> proposal?</p>



<a name="246185295"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/%60let%20pattern%20%3D%20expr%20else%20%7B%20...%20%7D%60%20statements/near/246185295" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Cameron Steffen <a href="https://rust-lang.github.io/zulip_archive/stream/213817-t-lang/topic/.60let.20pattern.20.3D.20expr.20else.20.7B.20.2E.2E.2E.20.7D.60.20statements.html#246185295">(Jul 16 2021 at 05:08)</a>:</h4>
<p>Subtle, but I think <code>if !let</code> is too much like <code>if let</code> and it's harder to see that the scope of the bindings is different.</p>



<a name="246185410"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/%60let%20pattern%20%3D%20expr%20else%20%7B%20...%20%7D%60%20statements/near/246185410" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Mario Carneiro <a href="https://rust-lang.github.io/zulip_archive/stream/213817-t-lang/topic/.60let.20pattern.20.3D.20expr.20else.20.7B.20.2E.2E.2E.20.7D.60.20statements.html#246185410">(Jul 16 2021 at 05:11)</a>:</h4>
<p>While I like the idea of <code>unless</code> as a swapped <code>if</code>, which is useful in particular for asserts, if (let) expressions are expressions, not statements, so <code>unless let</code> being a statement would break the symmetry (and also make things more confusing if <code>unless cond { expr }</code> and <code>unless cond { expr } else { expr }</code> become a thing)</p>



<a name="246185597"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/%60let%20pattern%20%3D%20expr%20else%20%7B%20...%20%7D%60%20statements/near/246185597" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Cameron Steffen <a href="https://rust-lang.github.io/zulip_archive/stream/213817-t-lang/topic/.60let.20pattern.20.3D.20expr.20else.20.7B.20.2E.2E.2E.20.7D.60.20statements.html#246185597">(Jul 16 2021 at 05:15)</a>:</h4>
<p>There is a bit of a comprehension obstacle with the word "unless". In English we typically say, "unless something unusual happens, do the normal thing". When you map that onto Rust, you might get "unless this variable happens to match the pattern, do the normal thing and <code>panic</code>". In other words, the word"unless" may invoke a misconception that matching the pattern is <em>exceptional</em> and underlying block is the normal case. I don't think this is a blocker, but something to voice.</p>



<a name="246188823"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/%60let%20pattern%20%3D%20expr%20else%20%7B%20...%20%7D%60%20statements/near/246188823" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Triplett <a href="https://rust-lang.github.io/zulip_archive/stream/213817-t-lang/topic/.60let.20pattern.20.3D.20expr.20else.20.7B.20.2E.2E.2E.20.7D.60.20statements.html#246188823">(Jul 16 2021 at 06:29)</a>:</h4>
<p>I do think <code>unless let pat = expr { ... }</code> is better than <code>if !let pat = expr else { ... }</code> or <code>let pat = expr, else</code> or some of the other alternative proposals. I still don't think it's better than <code>let pat = expr else { ... }</code>.</p>



<a name="246188930"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/%60let%20pattern%20%3D%20expr%20else%20%7B%20...%20%7D%60%20statements/near/246188930" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Mario Carneiro <a href="https://rust-lang.github.io/zulip_archive/stream/213817-t-lang/topic/.60let.20pattern.20.3D.20expr.20else.20.7B.20.2E.2E.2E.20.7D.60.20statements.html#246188930">(Jul 16 2021 at 06:31)</a>:</h4>
<p>(actually the <code>unless let</code> proposal doesn't have an <code>else</code>. I forget if <code>if !let</code> does)</p>



<a name="246189541"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/%60let%20pattern%20%3D%20expr%20else%20%7B%20...%20%7D%60%20statements/near/246189541" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Triplett <a href="https://rust-lang.github.io/zulip_archive/stream/213817-t-lang/topic/.60let.20pattern.20.3D.20expr.20else.20.7B.20.2E.2E.2E.20.7D.60.20statements.html#246189541">(Jul 16 2021 at 06:41)</a>:</h4>
<p>(Ah, sorry, correcting.)</p>



<a name="246215237"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/%60let%20pattern%20%3D%20expr%20else%20%7B%20...%20%7D%60%20statements/near/246215237" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Cameron Steffen <a href="https://rust-lang.github.io/zulip_archive/stream/213817-t-lang/topic/.60let.20pattern.20.3D.20expr.20else.20.7B.20.2E.2E.2E.20.7D.60.20statements.html#246215237">(Jul 16 2021 at 12:16)</a>:</h4>
<p>I do think <code>let else</code> is the most <em>immediately</em> intuitive. But <code>unless let</code> has an advantage of fewer syntactic special cases and it's the most similar to existing constructs. I wonder if <code>unless let</code> would feel the most "at home" in the language given the opportunity to adjust to it.</p>



<a name="246244088"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/%60let%20pattern%20%3D%20expr%20else%20%7B%20...%20%7D%60%20statements/near/246244088" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Triplett <a href="https://rust-lang.github.io/zulip_archive/stream/213817-t-lang/topic/.60let.20pattern.20.3D.20expr.20else.20.7B.20.2E.2E.2E.20.7D.60.20statements.html#246244088">(Jul 16 2021 at 16:11)</a>:</h4>
<p><span class="user-mention" data-user-id="360405">@Cameron Steffen</span> I appreciate the distinction you're making. I'll grant that <code>unless let</code> might be easier to parse. But I personally feel <code>let else</code> will be easier for humans to work with.</p>



<a name="246244112"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/%60let%20pattern%20%3D%20expr%20else%20%7B%20...%20%7D%60%20statements/near/246244112" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Triplett <a href="https://rust-lang.github.io/zulip_archive/stream/213817-t-lang/topic/.60let.20pattern.20.3D.20expr.20else.20.7B.20.2E.2E.2E.20.7D.60.20statements.html#246244112">(Jul 16 2021 at 16:11)</a>:</h4>
<p>And I feel fairly certain that <code>let else</code> will be parseable.</p>



<a name="246244198"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/%60let%20pattern%20%3D%20expr%20else%20%7B%20...%20%7D%60%20statements/near/246244198" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Triplett <a href="https://rust-lang.github.io/zulip_archive/stream/213817-t-lang/topic/.60let.20pattern.20.3D.20expr.20else.20.7B.20.2E.2E.2E.20.7D.60.20statements.html#246244198">(Jul 16 2021 at 16:12)</a>:</h4>
<p>I think <code>let</code> ... <code>else</code> will feel like a natural extension of <code>let</code>.</p>



<a name="246245541"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/%60let%20pattern%20%3D%20expr%20else%20%7B%20...%20%7D%60%20statements/near/246245541" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Cameron Steffen <a href="https://rust-lang.github.io/zulip_archive/stream/213817-t-lang/topic/.60let.20pattern.20.3D.20expr.20else.20.7B.20.2E.2E.2E.20.7D.60.20statements.html#246245541">(Jul 16 2021 at 16:22)</a>:</h4>
<blockquote>
<p>I personally feel <code>let else</code> will be easier for humans to work with.</p>
</blockquote>
<p>Yeah, I can see that for sure.</p>



<a name="246263134"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/%60let%20pattern%20%3D%20expr%20else%20%7B%20...%20%7D%60%20statements/near/246263134" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Poliorcetics <a href="https://rust-lang.github.io/zulip_archive/stream/213817-t-lang/topic/.60let.20pattern.20.3D.20expr.20else.20.7B.20.2E.2E.2E.20.7D.60.20statements.html#246263134">(Jul 16 2021 at 18:45)</a>:</h4>
<blockquote>
<p>I personally feel <code>let else</code> will be easier for humans to work with.</p>
</blockquote>
<p>I don’t agree at all (for honesty: I only have my Swift experience and empirical evidence of this, nothing more complete).</p>
<p>Having a keyword like « unless » right at the start helps me ignore a whole block very quickly when I’m interested in the happy path of a method. An « else » that I must find later on is long compared to this.</p>
<p>Also, « unless let = …» could be an expression, just one returning « ! », just like a regular « let o = if cond { happy path } else { break out of scope/block } » is in the « else » case today</p>



<a name="246263876"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/%60let%20pattern%20%3D%20expr%20else%20%7B%20...%20%7D%60%20statements/near/246263876" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Poliorcetics <a href="https://rust-lang.github.io/zulip_archive/stream/213817-t-lang/topic/.60let.20pattern.20.3D.20expr.20else.20.7B.20.2E.2E.2E.20.7D.60.20statements.html#246263876">(Jul 16 2021 at 18:51)</a>:</h4>
<p>Though I don’t know when « let x = unless let y = … { } » would be useful so maybe making it an expression is useless anyway</p>



<a name="246274959"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/%60let%20pattern%20%3D%20expr%20else%20%7B%20...%20%7D%60%20statements/near/246274959" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Mario Carneiro <a href="https://rust-lang.github.io/zulip_archive/stream/213817-t-lang/topic/.60let.20pattern.20.3D.20expr.20else.20.7B.20.2E.2E.2E.20.7D.60.20statements.html#246274959">(Jul 16 2021 at 20:33)</a>:</h4>
<p><span class="user-mention silent" data-user-id="360405">Cameron Steffen</span> <a href="#narrow/stream/213817-t-lang/topic/.60let.20pattern.20.3D.20expr.20else.20.7B.20.2E.2E.2E.20.7D.60.20statements/near/246215237">said</a>:</p>
<blockquote>
<p>But <code>unless let</code> has an advantage of fewer syntactic special cases</p>
</blockquote>
<p>It's worth noting that <code>unless let</code> would need a similar syntactic special case as <code>if</code> conditions, namely you can't put <code>Foo { ... }</code> in there without additional parentheses. It's a special case shared with <code>if</code> and <code>if let</code> and <code>while</code> so you can argue that it's less special, but it's still not the entire <code>expr</code> grammar like it says on the tin</p>



<a name="246275206"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/%60let%20pattern%20%3D%20expr%20else%20%7B%20...%20%7D%60%20statements/near/246275206" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Mario Carneiro <a href="https://rust-lang.github.io/zulip_archive/stream/213817-t-lang/topic/.60let.20pattern.20.3D.20expr.20else.20.7B.20.2E.2E.2E.20.7D.60.20statements.html#246275206">(Jul 16 2021 at 20:35)</a>:</h4>
<blockquote>
<p>Also, « unless let = …» could be an expression, just one returning « ! », just like a regular « let o = if cond { happy path } else { break out of scope/block } » is in the « else » case today</p>
</blockquote>
<p>If it's an expression, it can't contribute bindings to the enclosing block. So this isn't an option</p>



<a name="246316382"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/%60let%20pattern%20%3D%20expr%20else%20%7B%20...%20%7D%60%20statements/near/246316382" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Frank Steffahn <a href="https://rust-lang.github.io/zulip_archive/stream/213817-t-lang/topic/.60let.20pattern.20.3D.20expr.20else.20.7B.20.2E.2E.2E.20.7D.60.20statements.html#246316382">(Jul 17 2021 at 09:54)</a>:</h4>
<p>While it’s true that <code>unless let</code> needs syntactic restrictions, too, this is an entirely different story because these restrictions are the same as for <code>if let</code> and <code>if</code> and <code>while</code> and <code>for</code> (after the <code>in</code>) and <code>match</code>, in other words – super common and the same throughout the language. Furthermore the syntactic restrictions are clear from the first word of the statement. You write <code>unless</code> and you know there will be restrictions. OTOH, <code>let</code> (without <code>else</code>) is free of restrictions, yet we’re “extending” it  with an <code>else</code> syntax that tells you after the fact that – <em>by the way there were syntactic restrictions in the thing you’ve just written</em>.</p>
<p>In my opinion it’s clear that <code>unless let</code> is syntactically superior to <code>let … else</code>. The only potential disadvantage is that <code>unless</code> might not feel ideal to some native English speakers. I mean – programming languages don’t exactly read like English poetry anyways, so I guess everyone would get used to it really quickly – but of course there’s also the option to discuss other alternatives for the keyword. I could come up with</p>
<ul>
<li><code>guard</code>, but without the <code>else</code> – although that might read like it’s guarding the thing in the block, not the code that follows it</li>
<li><code>ensure</code>, or something else that sound somewhat similar to <code>assert</code> – I think the fact that the subsequent block describes the “error”/“failure” case is only just about as confusing as writing <code>foo.expect("error message")</code> is. You get used to it. <code>ensure</code> is probably a less common variable name than <code>guard</code> so it’s perhaps nicer as a new keyword?</li>
<li>For the mathematicians among us, I suppose “<a href="https://en.wikipedia.org/wiki/Without_loss_of_generality"><code>wlog</code></a>” could be a superb choice of keyword. I mean, just look at this:</li>
</ul>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="k">fn</span> <span class="nf">sorted_array_of</span><span class="o">&lt;</span><span class="n">T</span>: <span class="nb">Ord</span><span class="o">&gt;</span><span class="p">(</span><span class="n">x</span>: <span class="nc">T</span><span class="p">,</span><span class="w"> </span><span class="n">y</span>: <span class="nc">T</span><span class="p">,</span><span class="w"> </span><span class="n">z</span>: <span class="nc">T</span><span class="p">)</span><span class="w"> </span>-&gt; <span class="p">[</span><span class="n">T</span><span class="p">;</span><span class="w"> </span><span class="mi">3</span><span class="p">]</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="n">wlog</span><span class="w"> </span><span class="n">x</span><span class="w"> </span><span class="o">&lt;=</span><span class="w"> </span><span class="n">y</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">sorted_array_of</span><span class="p">(</span><span class="n">y</span><span class="p">,</span><span class="w"> </span><span class="n">x</span><span class="p">,</span><span class="w"> </span><span class="n">z</span><span class="p">);</span><span class="w"></span>
<span class="w">    </span><span class="p">}</span><span class="w"></span>
<span class="w">    </span><span class="n">wlog</span><span class="w"> </span><span class="n">y</span><span class="w"> </span><span class="o">&lt;=</span><span class="w"> </span><span class="n">z</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">sorted_array_of</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="w"> </span><span class="n">z</span><span class="p">,</span><span class="w"> </span><span class="n">y</span><span class="p">);</span><span class="w"></span>
<span class="w">    </span><span class="p">}</span><span class="w"></span>

<span class="w">    </span><span class="p">[</span><span class="n">x</span><span class="p">,</span><span class="w"> </span><span class="n">y</span><span class="p">,</span><span class="w"> </span><span class="n">z</span><span class="p">]</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>
</code></pre></div>
<p>okay, that was a boolean example and not doing <code>wlog let</code>, but <code>wlog let</code> just sounds so nice, too <strong>/S</strong></p>



<a name="246318279"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/%60let%20pattern%20%3D%20expr%20else%20%7B%20...%20%7D%60%20statements/near/246318279" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Mario Carneiro <a href="https://rust-lang.github.io/zulip_archive/stream/213817-t-lang/topic/.60let.20pattern.20.3D.20expr.20else.20.7B.20.2E.2E.2E.20.7D.60.20statements.html#246318279">(Jul 17 2021 at 10:42)</a>:</h4>
<p>I don't think that any expression restrictions that can be solved by adding a couple parentheses are a problem in practice. It might give you pause the first time it comes up but it's really no big deal, and the white lie that all expressions are accepted in that position will go unchallenged most of the time, because you have to bend over backwards to hit the restriction - the body of a let-else is supposed to be short, otherwise it defeats the purpose of putting the else branch near the binding and you would be better off to use a match or an auxiliary binding for the scrutinee. This restriction is very much intended as a compiler-driven readability aid in any case.</p>



<a name="246318357"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/%60let%20pattern%20%3D%20expr%20else%20%7B%20...%20%7D%60%20statements/near/246318357" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Mario Carneiro <a href="https://rust-lang.github.io/zulip_archive/stream/213817-t-lang/topic/.60let.20pattern.20.3D.20expr.20else.20.7B.20.2E.2E.2E.20.7D.60.20statements.html#246318357">(Jul 17 2021 at 10:45)</a>:</h4>
<p>the only block expression I find likely to appear in that position in practice is <code>unsafe { ... }</code></p>



<a name="246339613"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/%60let%20pattern%20%3D%20expr%20else%20%7B%20...%20%7D%60%20statements/near/246339613" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Cameron Steffen <a href="https://rust-lang.github.io/zulip_archive/stream/213817-t-lang/topic/.60let.20pattern.20.3D.20expr.20else.20.7B.20.2E.2E.2E.20.7D.60.20statements.html#246339613">(Jul 17 2021 at 19:21)</a>:</h4>
<p>No question that <code>unless let</code> just "fits in" with existing syntax better than other options. But the special cases of <code>let else</code> are just rare enough to be tolerable. Because I think it would just be bad style to write something like <code>let ..  = match .. else ..</code>. In all likelihood it's better to just use <code>let .. = match</code> or introduce an intermediate binding. I think a similar thing could be said about the other special cases. So then I think it just comes down to human readability and intuitiveness. But it's hard for me to decide that either one is clearly better than the other in this regard (I keep going back and forth in my mind). Either one will just take some getting used to. I find myself going back to <code>unless let</code> just to avoid the additional special cases in syntax. Because people <em>will</em> bump into those cases <em>occasionally</em> and it will be a hindrance.</p>
<p><code>unless let</code> feels more blatantly different where <code>let else</code> just blends in more. It feels like <code>let</code> meets <code>if else</code>. So I think the important question is whether or not the blatant differentness of <code>unless</code> is a good thing. I'm thinking that it actually is a good thing because it requires a divergent block - that is different from any other construct. So I guess I am kinda leaning to <code>unless let</code>, but I still think that <code>let else</code> would be okay.</p>
<blockquote>
<p>I don't think that any expression restrictions that can be solved by adding a couple parentheses are a problem in practice.</p>
</blockquote>
<p>This is just a style thing but I have strong reservations about this. Rust usually goes the extra mile to <em>avoid</em> the need for parenthesis. I know we're just talking about special cases, but <code>let else</code> would lower the bar to some degree with regard to how common it is for parenthesis to be required. So I think we should tread carefully there.</p>



<a name="246345857"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/%60let%20pattern%20%3D%20expr%20else%20%7B%20...%20%7D%60%20statements/near/246345857" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://rust-lang.github.io/zulip_archive/stream/213817-t-lang/topic/.60let.20pattern.20.3D.20expr.20else.20.7B.20.2E.2E.2E.20.7D.60.20statements.html#246345857">(Jul 17 2021 at 21:40)</a>:</h4>
<p>If we do have <code>unless let</code>, we also get <code>unless &lt;cond&gt; { ... }</code>, right? as an alternative to <code>if !cond { ... }</code>?</p>



<a name="246345860"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/%60let%20pattern%20%3D%20expr%20else%20%7B%20...%20%7D%60%20statements/near/246345860" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://rust-lang.github.io/zulip_archive/stream/213817-t-lang/topic/.60let.20pattern.20.3D.20expr.20else.20.7B.20.2E.2E.2E.20.7D.60.20statements.html#246345860">(Jul 17 2021 at 21:40)</a>:</h4>
<p>I <em>personally</em> find <code>if !....</code> quite hard to process</p>



<a name="246345863"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/%60let%20pattern%20%3D%20expr%20else%20%7B%20...%20%7D%60%20statements/near/246345863" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://rust-lang.github.io/zulip_archive/stream/213817-t-lang/topic/.60let.20pattern.20.3D.20expr.20else.20.7B.20.2E.2E.2E.20.7D.60.20statements.html#246345863">(Jul 17 2021 at 21:40)</a>:</h4>
<p>e.g. <code>if !foo.is_empty() { .. }</code> kind of hurts my head</p>



<a name="246345866"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/%60let%20pattern%20%3D%20expr%20else%20%7B%20...%20%7D%60%20statements/near/246345866" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://rust-lang.github.io/zulip_archive/stream/213817-t-lang/topic/.60let.20pattern.20.3D.20expr.20else.20.7B.20.2E.2E.2E.20.7D.60.20statements.html#246345866">(Jul 17 2021 at 21:40)</a>:</h4>
<p>compared to <code>if foo.is_not_empty() { </code></p>



<a name="246345872"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/%60let%20pattern%20%3D%20expr%20else%20%7B%20...%20%7D%60%20statements/near/246345872" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://rust-lang.github.io/zulip_archive/stream/213817-t-lang/topic/.60let.20pattern.20.3D.20expr.20else.20.7B.20.2E.2E.2E.20.7D.60.20statements.html#246345872">(Jul 17 2021 at 21:41)</a>:</h4>
<p><code>unless foo.is_empty() { .. }</code> is probably easier for me, though I don't have experience to back that up</p>



<a name="246346603"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/%60let%20pattern%20%3D%20expr%20else%20%7B%20...%20%7D%60%20statements/near/246346603" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://rust-lang.github.io/zulip_archive/stream/213817-t-lang/topic/.60let.20pattern.20.3D.20expr.20else.20.7B.20.2E.2E.2E.20.7D.60.20statements.html#246346603">(Jul 17 2021 at 22:00)</a>:</h4>
<p>I still, I think, lean towards "let else", but I wouldn't be opposed to implementing both as an experiment :)</p>



<a name="246346624"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/%60let%20pattern%20%3D%20expr%20else%20%7B%20...%20%7D%60%20statements/near/246346624" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://rust-lang.github.io/zulip_archive/stream/213817-t-lang/topic/.60let.20pattern.20.3D.20expr.20else.20.7B.20.2E.2E.2E.20.7D.60.20statements.html#246346624">(Jul 17 2021 at 22:00)</a>:</h4>
<p><code>unless let Ok(x) = .... {</code> does not "say" to me that <code>x</code> is bound in the statements that follow, though</p>



<a name="246347056"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/%60let%20pattern%20%3D%20expr%20else%20%7B%20...%20%7D%60%20statements/near/246347056" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Triplett <a href="https://rust-lang.github.io/zulip_archive/stream/213817-t-lang/topic/.60let.20pattern.20.3D.20expr.20else.20.7B.20.2E.2E.2E.20.7D.60.20statements.html#246347056">(Jul 17 2021 at 22:13)</a>:</h4>
<p>That's <em>exactly</em> my concern as well. <code>unless let</code> doesn't feel like a binding statement for the following code; <code>let ... else</code> does.</p>



<a name="246347122"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/%60let%20pattern%20%3D%20expr%20else%20%7B%20...%20%7D%60%20statements/near/246347122" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> The 8472 <a href="https://rust-lang.github.io/zulip_archive/stream/213817-t-lang/topic/.60let.20pattern.20.3D.20expr.20else.20.7B.20.2E.2E.2E.20.7D.60.20statements.html#246347122">(Jul 17 2021 at 22:15)</a>:</h4>
<p>Since it's just supposed to desugar to match anyway why not make the match syntax more compact?</p>
<p><code>let match { (Some(foo), Ok(bar)) ; _ =&gt; return } = expr;</code><br>
<code>let match expr { (Some(foo), Ok(bar)) ; _ =&gt; return };</code></p>
<p>Or closer to <code>&lt;control flow keyword&gt; let pattern = expr</code>:</p>
<p><del><code>match let { (Some(foo), Ok(bar)) ; _ =&gt; return } = expr;</code></del> edit, forget about this one, scoping is differnet compared to if/while let after all.</p>



<a name="246347165"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/%60let%20pattern%20%3D%20expr%20else%20%7B%20...%20%7D%60%20statements/near/246347165" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> The 8472 <a href="https://rust-lang.github.io/zulip_archive/stream/213817-t-lang/topic/.60let.20pattern.20.3D.20expr.20else.20.7B.20.2E.2E.2E.20.7D.60.20statements.html#246347165">(Jul 17 2021 at 22:16)</a>:</h4>
<p>The RFC just doesn't go far enough with the "Assign to outer scope from match" alternative.</p>



<a name="246348692"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/%60let%20pattern%20%3D%20expr%20else%20%7B%20...%20%7D%60%20statements/near/246348692" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Poliorcetics <a href="https://rust-lang.github.io/zulip_archive/stream/213817-t-lang/topic/.60let.20pattern.20.3D.20expr.20else.20.7B.20.2E.2E.2E.20.7D.60.20statements.html#246348692">(Jul 17 2021 at 23:01)</a>:</h4>
<blockquote>
<p>I personally find <code>if !....</code> quite hard to process</p>
</blockquote>
<p>Yes yes yes, <code>!</code> is horrible to read</p>
<blockquote>
<p><code>unless let</code> doesn't feel like a binding statement</p>
</blockquote>
<p>Question of habit I suppose, I never saw anyone complain about it in Swift</p>



<a name="246349657"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/%60let%20pattern%20%3D%20expr%20else%20%7B%20...%20%7D%60%20statements/near/246349657" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Cameron Steffen <a href="https://rust-lang.github.io/zulip_archive/stream/213817-t-lang/topic/.60let.20pattern.20.3D.20expr.20else.20.7B.20.2E.2E.2E.20.7D.60.20statements.html#246349657">(Jul 17 2021 at 23:28)</a>:</h4>
<blockquote>
<p>If we do have <code>unless let</code>, we also get <code>unless &lt;cond&gt; { ... }</code>, right? as an alternative to <code>if !cond { ... }</code>?</p>
</blockquote>
<p>So, I think the <code>guard</code> keyword (without <code>else</code>) makes since IFF we also have that feature. I used to think that feature doesn't fit in Rust, but it makes more since now without <code>else</code>.</p>
<blockquote>
<blockquote>
<p><code>unless let</code> doesn't feel like a binding statement</p>
</blockquote>
<p>Question of habit I suppose, I never saw anyone complain about it in Swift</p>
</blockquote>
<p>I think <code>guard</code> is better in that regard too? It says "guarding a condition/binding for following statements".</p>



<a name="246349728"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/%60let%20pattern%20%3D%20expr%20else%20%7B%20...%20%7D%60%20statements/near/246349728" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Cameron Steffen <a href="https://rust-lang.github.io/zulip_archive/stream/213817-t-lang/topic/.60let.20pattern.20.3D.20expr.20else.20.7B.20.2E.2E.2E.20.7D.60.20statements.html#246349728">(Jul 17 2021 at 23:30)</a>:</h4>
<p>It would be nice to have a consensus between <code>unless</code> and <code>guard</code> so that we only have two options to implement :)</p>



<a name="246349742"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/%60let%20pattern%20%3D%20expr%20else%20%7B%20...%20%7D%60%20statements/near/246349742" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Poliorcetics <a href="https://rust-lang.github.io/zulip_archive/stream/213817-t-lang/topic/.60let.20pattern.20.3D.20expr.20else.20.7B.20.2E.2E.2E.20.7D.60.20statements.html#246349742">(Jul 17 2021 at 23:31)</a>:</h4>
<p><code>unless</code> or <code>guard</code> seem very readable to me, <code>let/else</code> already seems like a nightmare worthy of <code>!</code> for review</p>



<a name="246349787"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/%60let%20pattern%20%3D%20expr%20else%20%7B%20...%20%7D%60%20statements/near/246349787" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Poliorcetics <a href="https://rust-lang.github.io/zulip_archive/stream/213817-t-lang/topic/.60let.20pattern.20.3D.20expr.20else.20.7B.20.2E.2E.2E.20.7D.60.20statements.html#246349787">(Jul 17 2021 at 23:32)</a>:</h4>
<p><span class="user-mention silent" data-user-id="360405">Cameron Steffen</span> <a href="#narrow/stream/213817-t-lang/topic/.60let.20pattern.20.3D.20expr.20else.20.7B.20.2E.2E.2E.20.7D.60.20statements/near/246349728">said</a>:</p>
<blockquote>
<p>It would be nice to have a consensus between <code>unless</code> and <code>guard</code> so that we only have two options to implement <span aria-label="smile" class="emoji emoji-1f642" role="img" title="smile">:smile:</span></p>
</blockquote>
<p>No opinion on that ^^ either is fine to me</p>



<a name="246355973"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/%60let%20pattern%20%3D%20expr%20else%20%7B%20...%20%7D%60%20statements/near/246355973" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Mario Carneiro <a href="https://rust-lang.github.io/zulip_archive/stream/213817-t-lang/topic/.60let.20pattern.20.3D.20expr.20else.20.7B.20.2E.2E.2E.20.7D.60.20statements.html#246355973">(Jul 18 2021 at 02:49)</a>:</h4>
<p><span class="user-mention silent" data-user-id="116009">nikomatsakis</span> <a href="#narrow/stream/213817-t-lang/topic/.60let.20pattern.20.3D.20expr.20else.20.7B.20.2E.2E.2E.20.7D.60.20statements/near/246345860">said</a>:</p>
<blockquote>
<p>I <em>personally</em> find <code>if !....</code> quite hard to process, e.g. <code>if !foo.is_empty() { .. }</code> kind of hurts my head. <code>unless foo.is_empty() { .. }</code> is probably easier for me, though I don't have experience to back that up</p>
</blockquote>
<p>Anecdotally, I recently moved to the new version of lean which has gained an <code>unless</code> keyword which means just what you think it does (there is no <code>unless let</code> though), and I use it by preference over <code>if !cond</code> whenever possible. It is best suited when there is only one branch and I don't want to write <code>if cond {} else { block }</code> or <code>if !cond { block }</code>, and the block is often but not always diverging (it's great for asserts).</p>



<a name="246428015"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/%60let%20pattern%20%3D%20expr%20else%20%7B%20...%20%7D%60%20statements/near/246428015" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://rust-lang.github.io/zulip_archive/stream/213817-t-lang/topic/.60let.20pattern.20.3D.20expr.20else.20.7B.20.2E.2E.2E.20.7D.60.20statements.html#246428015">(Jul 19 2021 at 08:22)</a>:</h4>
<p>The problem I see is that:</p>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="k">if</span><span class="w"> </span><span class="n">foo</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="o">..</span><span class="p">.</span><span class="w"> </span><span class="p">}</span><span class="w"></span>
</code></pre></div>
<p>and</p>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="n">unless</span><span class="w"> </span><span class="n">foo</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="o">..</span><span class="p">.</span><span class="w"> </span><span class="p">}</span><span class="w"></span>
</code></pre></div>
<p>would be very analogous, but the scope of <code>x</code> in</p>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="k">if</span><span class="w"> </span><span class="kd">let</span><span class="w"> </span><span class="nb">Ok</span><span class="p">(</span><span class="n">x</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">..</span><span class="p">.</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="o">..</span><span class="p">.</span><span class="w"> </span><span class="p">}</span><span class="w"></span>
</code></pre></div>
<p>and</p>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="n">unless</span><span class="w"> </span><span class="kd">let</span><span class="w"> </span><span class="nb">Ok</span><span class="p">(</span><span class="n">x</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">..</span><span class="p">.</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="o">..</span><span class="w"> </span><span class="p">}</span><span class="w"></span>
</code></pre></div>
<p>would really not be.</p>



<a name="246428038"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/%60let%20pattern%20%3D%20expr%20else%20%7B%20...%20%7D%60%20statements/near/246428038" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://rust-lang.github.io/zulip_archive/stream/213817-t-lang/topic/.60let.20pattern.20.3D.20expr.20else.20.7B.20.2E.2E.2E.20.7D.60.20statements.html#246428038">(Jul 19 2021 at 08:22)</a>:</h4>
<p>However, I suppose if you wrote an <code>else</code>, that would help</p>



<a name="246428048"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/%60let%20pattern%20%3D%20expr%20else%20%7B%20...%20%7D%60%20statements/near/246428048" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://rust-lang.github.io/zulip_archive/stream/213817-t-lang/topic/.60let.20pattern.20.3D.20expr.20else.20.7B.20.2E.2E.2E.20.7D.60.20statements.html#246428048">(Jul 19 2021 at 08:22)</a>:</h4>
<p>but then it's weird</p>



<a name="246428061"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/%60let%20pattern%20%3D%20expr%20else%20%7B%20...%20%7D%60%20statements/near/246428061" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://rust-lang.github.io/zulip_archive/stream/213817-t-lang/topic/.60let.20pattern.20.3D.20expr.20else.20.7B.20.2E.2E.2E.20.7D.60.20statements.html#246428061">(Jul 19 2021 at 08:22)</a>:</h4>
<p>Still, maybe you get used to it.</p>



<a name="246428236"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/%60let%20pattern%20%3D%20expr%20else%20%7B%20...%20%7D%60%20statements/near/246428236" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> RalfJ <a href="https://rust-lang.github.io/zulip_archive/stream/213817-t-lang/topic/.60let.20pattern.20.3D.20expr.20else.20.7B.20.2E.2E.2E.20.7D.60.20statements.html#246428236">(Jul 19 2021 at 08:25)</a>:</h4>
<p>While I have never programmed in a language with something like <code>unless</code> or <code>until</code>, I do find it very confusing when I have to read code using such "negated conditionals" -- I think mostly that was Perl code, so mayb'e it's a perl thing and not an <code>unless</code> thing, but still I consider these kind of implicit negations to be a big hurdle to readability. I'd also say it adds unnecessary redundancy to the language.</p>



<a name="246428345"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/%60let%20pattern%20%3D%20expr%20else%20%7B%20...%20%7D%60%20statements/near/246428345" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> RalfJ <a href="https://rust-lang.github.io/zulip_archive/stream/213817-t-lang/topic/.60let.20pattern.20.3D.20expr.20else.20.7B.20.2E.2E.2E.20.7D.60.20statements.html#246428345">(Jul 19 2021 at 08:26)</a>:</h4>
<p>my only gripe with <code>if !foo.is_empty() { .. }</code> is that the <code>!</code> is at the wrong end of the chain, but <code>if foo.is_empty().not()</code> is great IMO :D sadly it requires an import</p>



<a name="246429472"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/%60let%20pattern%20%3D%20expr%20else%20%7B%20...%20%7D%60%20statements/near/246429472" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Mario Carneiro <a href="https://rust-lang.github.io/zulip_archive/stream/213817-t-lang/topic/.60let.20pattern.20.3D.20expr.20else.20.7B.20.2E.2E.2E.20.7D.60.20statements.html#246429472">(Jul 19 2021 at 08:39)</a>:</h4>
<p><span class="user-mention silent" data-user-id="120791">RalfJ</span> <a href="#narrow/stream/213817-t-lang/topic/.60let.20pattern.20.3D.20expr.20else.20.7B.20.2E.2E.2E.20.7D.60.20statements/near/246428345">said</a>:</p>
<blockquote>
<p>my only gripe with <code>if !foo.is_empty() { .. }</code> is that the <code>!</code> is at the wrong end of the chain, but <code>if foo.is_empty().not()</code> is great IMO :D sadly it requires an import</p>
</blockquote>
<p>For some reason this reminds me of the scene in indiana jones where the coin with directions to the treasure has an addendum on the other side that adds a negation</p>



<a name="246430388"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/%60let%20pattern%20%3D%20expr%20else%20%7B%20...%20%7D%60%20statements/near/246430388" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> RalfJ <a href="https://rust-lang.github.io/zulip_archive/stream/213817-t-lang/topic/.60let.20pattern.20.3D.20expr.20else.20.7B.20.2E.2E.2E.20.7D.60.20statements.html#246430388">(Jul 19 2021 at 08:50)</a>:</h4>
<p>we add all sorts of things to the end of such chains that are extremely relevant -- it's standard method call syntax</p>



<a name="246430452"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/%60let%20pattern%20%3D%20expr%20else%20%7B%20...%20%7D%60%20statements/near/246430452" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> RalfJ <a href="https://rust-lang.github.io/zulip_archive/stream/213817-t-lang/topic/.60let.20pattern.20.3D.20expr.20else.20.7B.20.2E.2E.2E.20.7D.60.20statements.html#246430452">(Jul 19 2021 at 08:51)</a>:</h4>
<p><code>unless</code> actually has the same problem as <code>if !...</code> here -- for non-trivial conditions, the negation is way removed from what it actually negates</p>



<a name="246430563"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/%60let%20pattern%20%3D%20expr%20else%20%7B%20...%20%7D%60%20statements/near/246430563" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Mario Carneiro <a href="https://rust-lang.github.io/zulip_archive/stream/213817-t-lang/topic/.60let.20pattern.20.3D.20expr.20else.20.7B.20.2E.2E.2E.20.7D.60.20statements.html#246430563">(Jul 19 2021 at 08:52)</a>:</h4>
<p>I think it has more to do with english grammar, but "unless foo is empty" reads a lot better than either "if not foo is empty" or worse, "if foo is empty... not"</p>



<a name="246430681"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/%60let%20pattern%20%3D%20expr%20else%20%7B%20...%20%7D%60%20statements/near/246430681" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> RalfJ <a href="https://rust-lang.github.io/zulip_archive/stream/213817-t-lang/topic/.60let.20pattern.20.3D.20expr.20else.20.7B.20.2E.2E.2E.20.7D.60.20statements.html#246430681">(Jul 19 2021 at 08:53)</a>:</h4>
<p>"unless &lt;very long sentence&gt; is empty" IMO reads quite badly since, again, the negation is so removed from what it negates</p>



<a name="246430739"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/%60let%20pattern%20%3D%20expr%20else%20%7B%20...%20%7D%60%20statements/near/246430739" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> RalfJ <a href="https://rust-lang.github.io/zulip_archive/stream/213817-t-lang/topic/.60let.20pattern.20.3D.20expr.20else.20.7B.20.2E.2E.2E.20.7D.60.20statements.html#246430739">(Jul 19 2021 at 08:54)</a>:</h4>
<p>the natural thing would be "if &lt;foo&gt; is not empty", which is very close to <code>&lt;foo&gt;.is_empty().not()</code></p>



<a name="246430935"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/%60let%20pattern%20%3D%20expr%20else%20%7B%20...%20%7D%60%20statements/near/246430935" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> RalfJ <a href="https://rust-lang.github.io/zulip_archive/stream/213817-t-lang/topic/.60let.20pattern.20.3D.20expr.20else.20.7B.20.2E.2E.2E.20.7D.60.20statements.html#246430935">(Jul 19 2021 at 08:56)</a>:</h4>
<p>maybe it's also a "what's your mother tongue" thing: "unless foo is empty" has no translation into German that sounds even remotely natural -- other than "if foo is not empty"</p>



<a name="246431115"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/%60let%20pattern%20%3D%20expr%20else%20%7B%20...%20%7D%60%20statements/near/246431115" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Mario Carneiro <a href="https://rust-lang.github.io/zulip_archive/stream/213817-t-lang/topic/.60let.20pattern.20.3D.20expr.20else.20.7B.20.2E.2E.2E.20.7D.60.20statements.html#246431115">(Jul 19 2021 at 08:58)</a>:</h4>
<p>Isn't german known for its long relative clauses? You need a lot of stack space</p>



<a name="246431293"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/%60let%20pattern%20%3D%20expr%20else%20%7B%20...%20%7D%60%20statements/near/246431293" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> RalfJ <a href="https://rust-lang.github.io/zulip_archive/stream/213817-t-lang/topic/.60let.20pattern.20.3D.20expr.20else.20.7B.20.2E.2E.2E.20.7D.60.20statements.html#246431293">(Jul 19 2021 at 09:00)</a>:</h4>
<p>well, "unless" is English stacking in ways that not even German dares to do ;)</p>



<a name="246431327"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/%60let%20pattern%20%3D%20expr%20else%20%7B%20...%20%7D%60%20statements/near/246431327" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Mario Carneiro <a href="https://rust-lang.github.io/zulip_archive/stream/213817-t-lang/topic/.60let.20pattern.20.3D.20expr.20else.20.7B.20.2E.2E.2E.20.7D.60.20statements.html#246431327">(Jul 19 2021 at 09:00)</a>:</h4>
<p>(english can be just as bad but people don't normally write like that anymore)</p>



<a name="246431354"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/%60let%20pattern%20%3D%20expr%20else%20%7B%20...%20%7D%60%20statements/near/246431354" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> RalfJ <a href="https://rust-lang.github.io/zulip_archive/stream/213817-t-lang/topic/.60let.20pattern.20.3D.20expr.20else.20.7B.20.2E.2E.2E.20.7D.60.20statements.html#246431354">(Jul 19 2021 at 09:01)</a>:</h4>
<p>(postfix-"unless" has a fairly natural translation to German but that's not what we are talking about here)</p>



<a name="246432668"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/%60let%20pattern%20%3D%20expr%20else%20%7B%20...%20%7D%60%20statements/near/246432668" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Frank Steffahn <a href="https://rust-lang.github.io/zulip_archive/stream/213817-t-lang/topic/.60let.20pattern.20.3D.20expr.20else.20.7B.20.2E.2E.2E.20.7D.60.20statements.html#246432668">(Jul 19 2021 at 09:17)</a>:</h4>
<p>I’d like to reiterate that while <code>unless …</code> and <code>if !…</code> might seem similar, and some cases of boolean <code>unless</code> can already be expressed with <code>if !</code> in the same way, the proposed <code>unless</code> is fundamentally different from <code>if</code> in that</p>
<ul>
<li>it’s a statement, <strong><em>not</em></strong> an expression</li>
<li>it does not support an <code>else</code> branch at all</li>
<li>the following block <strong><em>must</em></strong> diverge</li>
<li><code>unless let</code> allows for bindings that are in scope <em>after</em> the statement</li>
</ul>
<p>At least these are the rules that I would give an <code>unless</code>/<code>guard</code>/<code>ensure</code>/<code>wlog</code> statement</p>



<a name="246433178"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/%60let%20pattern%20%3D%20expr%20else%20%7B%20...%20%7D%60%20statements/near/246433178" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Mario Carneiro <a href="https://rust-lang.github.io/zulip_archive/stream/213817-t-lang/topic/.60let.20pattern.20.3D.20expr.20else.20.7B.20.2E.2E.2E.20.7D.60.20statements.html#246433178">(Jul 19 2021 at 09:24)</a>:</h4>
<p>For me it is exactly these features that make <code>unless let</code> undesirable compared to <code>let ... else</code>. I want it to look like a variation on <code>let</code>, not a variation on <code>unless</code>, because it shares more features with the former than the latter. (One can argue that <code>unless</code> doesn't actually exist in rust, but I think there is enough conceptual baggage from other languages and english itself that its meaning as swapped if is not very malleable.)</p>



<a name="246435341"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/%60let%20pattern%20%3D%20expr%20else%20%7B%20...%20%7D%60%20statements/near/246435341" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> RalfJ <a href="https://rust-lang.github.io/zulip_archive/stream/213817-t-lang/topic/.60let.20pattern.20.3D.20expr.20else.20.7B.20.2E.2E.2E.20.7D.60.20statements.html#246435341">(Jul 19 2021 at 09:50)</a>:</h4>
<blockquote>
<p>I want it to look like a variation on let, not a variation on unless</p>
</blockquote>
<p>did you mean "not a variation on <code>if</code>"? If yes then I agree.</p>



<a name="246436336"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/%60let%20pattern%20%3D%20expr%20else%20%7B%20...%20%7D%60%20statements/near/246436336" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Mario Carneiro <a href="https://rust-lang.github.io/zulip_archive/stream/213817-t-lang/topic/.60let.20pattern.20.3D.20expr.20else.20.7B.20.2E.2E.2E.20.7D.60.20statements.html#246436336">(Jul 19 2021 at 10:01)</a>:</h4>
<p>No, I mean a variation on <code>unless</code>, that is the construction <code>unless cond { block } else { block }</code> for flipped-if that does not exist in rust but conceivably could exist and does exist in english and other computer languages</p>



<a name="246436451"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/%60let%20pattern%20%3D%20expr%20else%20%7B%20...%20%7D%60%20statements/near/246436451" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Mario Carneiro <a href="https://rust-lang.github.io/zulip_archive/stream/213817-t-lang/topic/.60let.20pattern.20.3D.20expr.20else.20.7B.20.2E.2E.2E.20.7D.60.20statements.html#246436451">(Jul 19 2021 at 10:02)</a>:</h4>
<p>That is, I don't want <code>unless let pat = expr { block }</code> to look too much like <code>unless cond { block }</code> because it badly completes the analogy square with <code>if let pat = expr { block }</code> and <code>if cond { block }</code></p>



<a name="246438533"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/%60let%20pattern%20%3D%20expr%20else%20%7B%20...%20%7D%60%20statements/near/246438533" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> RalfJ <a href="https://rust-lang.github.io/zulip_archive/stream/213817-t-lang/topic/.60let.20pattern.20.3D.20expr.20else.20.7B.20.2E.2E.2E.20.7D.60.20statements.html#246438533">(Jul 19 2021 at 10:28)</a>:</h4>
<p>ah I see, makes sense</p>



<a name="246462242"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/%60let%20pattern%20%3D%20expr%20else%20%7B%20...%20%7D%60%20statements/near/246462242" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Cameron Steffen <a href="https://rust-lang.github.io/zulip_archive/stream/213817-t-lang/topic/.60let.20pattern.20.3D.20expr.20else.20.7B.20.2E.2E.2E.20.7D.60.20statements.html#246462242">(Jul 19 2021 at 14:32)</a>:</h4>
<p>I think the <code>unless bool</code> feature does not carry its weight unless it requires a divergent block. And that requirement would only make sense if <code>unless</code> is changed to <code>guard</code>.</p>



<a name="246477998"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/%60let%20pattern%20%3D%20expr%20else%20%7B%20...%20%7D%60%20statements/near/246477998" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Frank Steffahn <a href="https://rust-lang.github.io/zulip_archive/stream/213817-t-lang/topic/.60let.20pattern.20.3D.20expr.20else.20.7B.20.2E.2E.2E.20.7D.60.20statements.html#246477998">(Jul 19 2021 at 16:29)</a>:</h4>
<p><span class="user-mention silent" data-user-id="271719">Mario Carneiro</span> <a href="#narrow/stream/213817-t-lang/topic/.60let.20pattern.20.3D.20expr.20else.20.7B.20.2E.2E.2E.20.7D.60.20statements/near/246436451">said</a>:</p>
<blockquote>
<p>… <code>unless let pat = expr { block }</code> to look too much like <code>unless cond { block }</code></p>
</blockquote>
<p>I would want <em>precisely</em> this relationship in order to enable the possibility that both <code>unless let pat = expr { block }</code> and <code>unless cond { block }</code> will, eventually, just both be special cases of <code>unless LET_CHAIN { block }</code>. But I don’t really care – at all – about the choice of keyword. The choice <code>guard</code> is fine, too. I do care about the absence of the <code>else</code> because the <code>else</code> seems like a syntactic nightmare, and I’d want a prefix keyword anyways because it makes things much more clear for the reader. </p>
<p>An example using a boolean version, depending on the choice of keyword, would look like</p>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="n">guard</span><span class="w"> </span><span class="n">foo</span><span class="p">.</span><span class="n">size</span><span class="p">()</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="nb">Err</span><span class="p">(</span><span class="s">"too small"</span><span class="p">);</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>
<span class="n">handle_nonempty</span><span class="p">(</span><span class="n">foo</span><span class="p">);</span><span class="w"></span>
</code></pre></div>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="n">unless</span><span class="w"> </span><span class="n">foo</span><span class="p">.</span><span class="n">size</span><span class="p">()</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="nb">Err</span><span class="p">(</span><span class="s">"too small"</span><span class="p">);</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>
<span class="n">handle_nonempty</span><span class="p">(</span><span class="n">foo</span><span class="p">);</span><span class="w"></span>
</code></pre></div>
<p>I feel like maybe I’m starting to prefer <code>guard</code>, too.</p>



<a name="246478212"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/%60let%20pattern%20%3D%20expr%20else%20%7B%20...%20%7D%60%20statements/near/246478212" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> RalfJ <a href="https://rust-lang.github.io/zulip_archive/stream/213817-t-lang/topic/.60let.20pattern.20.3D.20expr.20else.20.7B.20.2E.2E.2E.20.7D.60.20statements.html#246478212">(Jul 19 2021 at 16:30)</a>:</h4>
<p>With the <code>guard</code> version I wouldnt even know what it means</p>



<a name="246478894"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/%60let%20pattern%20%3D%20expr%20else%20%7B%20...%20%7D%60%20statements/near/246478894" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> RalfJ <a href="https://rust-lang.github.io/zulip_archive/stream/213817-t-lang/topic/.60let.20pattern.20.3D.20expr.20else.20.7B.20.2E.2E.2E.20.7D.60.20statements.html#246478894">(Jul 19 2021 at 16:36)</a>:</h4>
<p><span class="user-mention silent" data-user-id="239881">Josh Triplett</span> <a href="#narrow/stream/213817-t-lang/topic/.60let.20pattern.20.3D.20expr.20else.20.7B.20.2E.2E.2E.20.7D.60.20statements/near/246244198">said</a>:</p>
<blockquote>
<p>I think <code>let</code> ... <code>else</code> will feel like a natural extension of <code>let</code>.</p>
</blockquote>
<p><span aria-label="point up" class="emoji emoji-1f446" role="img" title="point up">:point_up:</span> I basically find myself in full agreement with Josh. (Also in terms of none of these other proposals being better than <code>let pattern = expr else { ... }</code>)</p>



<a name="246479059"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/%60let%20pattern%20%3D%20expr%20else%20%7B%20...%20%7D%60%20statements/near/246479059" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Mario Carneiro <a href="https://rust-lang.github.io/zulip_archive/stream/213817-t-lang/topic/.60let.20pattern.20.3D.20expr.20else.20.7B.20.2E.2E.2E.20.7D.60.20statements.html#246479059">(Jul 19 2021 at 16:37)</a>:</h4>
<p><span class="user-mention silent" data-user-id="280891">Frank Steffahn</span> <a href="#narrow/stream/213817-t-lang/topic/.60let.20pattern.20.3D.20expr.20else.20.7B.20.2E.2E.2E.20.7D.60.20statements/near/246477998">said</a>:</p>
<blockquote>
<p>I do care about the absence of the <code>else</code> because the <code>else</code> seems like a syntactic nightmare,</p>
</blockquote>
<p>I think this is much too strong. What matters is the common case, and 99% of the time you won't be using a block in the scrutinee, and in the remaining 1% of the time using <code>({ block })</code> is no big deal.</p>
<p>If you mean a nightmare for specification and/or implementation, I disagree less strongly but I still think it's relatively simple to implement, and I've made several stabs at a spec already, modulo bikeshedding.</p>



<a name="246481218"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/%60let%20pattern%20%3D%20expr%20else%20%7B%20...%20%7D%60%20statements/near/246481218" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> The 8472 <a href="https://rust-lang.github.io/zulip_archive/stream/213817-t-lang/topic/.60let.20pattern.20.3D.20expr.20else.20.7B.20.2E.2E.2E.20.7D.60.20statements.html#246481218">(Jul 19 2021 at 16:55)</a>:</h4>
<p>No opinions on just making <code>let match</code> more concise?</p>



<a name="246483132"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/%60let%20pattern%20%3D%20expr%20else%20%7B%20...%20%7D%60%20statements/near/246483132" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Triplett <a href="https://rust-lang.github.io/zulip_archive/stream/213817-t-lang/topic/.60let.20pattern.20.3D.20expr.20else.20.7B.20.2E.2E.2E.20.7D.60.20statements.html#246483132">(Jul 19 2021 at 17:09)</a>:</h4>
<p><span class="user-mention" data-user-id="330154">@The 8472</span> That proposal seems like it moves the <code>expr</code> much too far away from the binding, and changes <code>match</code> syntax too much in a non-obvious way. It doesn't feel like an orthogonal combination of existing language features.</p>



<a name="246483245"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/%60let%20pattern%20%3D%20expr%20else%20%7B%20...%20%7D%60%20statements/near/246483245" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> bstrie <a href="https://rust-lang.github.io/zulip_archive/stream/213817-t-lang/topic/.60let.20pattern.20.3D.20expr.20else.20.7B.20.2E.2E.2E.20.7D.60.20statements.html#246483245">(Jul 19 2021 at 17:10)</a>:</h4>
<p>I think an issue with the <code>let match</code> syntax proposed above is that it doesn't scale down very much for simpler cases. An upside of <code>let else</code> is that simple cases look extremely simple. And for non-simple cases we have full <code>match</code>. This has parallels with how <code>if let</code> works for simple cases, but if you scale up in the complexity of the expression then you might want to just convert to a <code>match</code>.</p>
<p>So I think one of the things we're struggling with is that while it's understood that a complicated-enough <code>if let</code> should just be turned into a <code>match</code>, the <code>let else</code> syntax doesn't scale up as well as <code>if let</code> does, so there's a larger gulf between the simple-and-lightweight <code>let else</code> and the powerful-and-heavyweight <code>match</code> equivalent.</p>



<a name="246483346"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/%60let%20pattern%20%3D%20expr%20else%20%7B%20...%20%7D%60%20statements/near/246483346" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Triplett <a href="https://rust-lang.github.io/zulip_archive/stream/213817-t-lang/topic/.60let.20pattern.20.3D.20expr.20else.20.7B.20.2E.2E.2E.20.7D.60.20statements.html#246483346">(Jul 19 2021 at 17:10)</a>:</h4>
<p><span class="user-mention" data-user-id="330154">@The 8472</span> Also, the placement of the bindings in that proposal has a problem similar to <code>unless let</code>: it doesn't look like it binds something in the outer scope.</p>



<a name="246483410"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/%60let%20pattern%20%3D%20expr%20else%20%7B%20...%20%7D%60%20statements/near/246483410" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> The 8472 <a href="https://rust-lang.github.io/zulip_archive/stream/213817-t-lang/topic/.60let.20pattern.20.3D.20expr.20else.20.7B.20.2E.2E.2E.20.7D.60.20statements.html#246483410">(Jul 19 2021 at 17:11)</a>:</h4>
<p>leading with a <code>let</code> would be a clear sign that something is being bound though</p>



<a name="246483446"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/%60let%20pattern%20%3D%20expr%20else%20%7B%20...%20%7D%60%20statements/near/246483446" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Triplett <a href="https://rust-lang.github.io/zulip_archive/stream/213817-t-lang/topic/.60let.20pattern.20.3D.20expr.20else.20.7B.20.2E.2E.2E.20.7D.60.20statements.html#246483446">(Jul 19 2021 at 17:12)</a>:</h4>
<p>It would, but then you have to scan quite far into the expression to see what's being bound.</p>



<a name="246483586"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/%60let%20pattern%20%3D%20expr%20else%20%7B%20...%20%7D%60%20statements/near/246483586" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> The 8472 <a href="https://rust-lang.github.io/zulip_archive/stream/213817-t-lang/topic/.60let.20pattern.20.3D.20expr.20else.20.7B.20.2E.2E.2E.20.7D.60.20statements.html#246483586">(Jul 19 2021 at 17:12)</a>:</h4>
<p>Not all that far with <code>let match { (Some(foo), Ok(bar)) ; _ =&gt; return } = expr;</code></p>



<a name="246483594"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/%60let%20pattern%20%3D%20expr%20else%20%7B%20...%20%7D%60%20statements/near/246483594" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> bstrie <a href="https://rust-lang.github.io/zulip_archive/stream/213817-t-lang/topic/.60let.20pattern.20.3D.20expr.20else.20.7B.20.2E.2E.2E.20.7D.60.20statements.html#246483594">(Jul 19 2021 at 17:12)</a>:</h4>
<p>I do agree that leading with a <code>let</code> at the beginning is important for expressing that a binding is being introduced, although yes, it's almost as important to also have the binding itself be nearby the let</p>



<a name="246483654"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/%60let%20pattern%20%3D%20expr%20else%20%7B%20...%20%7D%60%20statements/near/246483654" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> The 8472 <a href="https://rust-lang.github.io/zulip_archive/stream/213817-t-lang/topic/.60let.20pattern.20.3D.20expr.20else.20.7B.20.2E.2E.2E.20.7D.60.20statements.html#246483654">(Jul 19 2021 at 17:13)</a>:</h4>
<p>if you put the expression first then yes, there would be quite a distance between the let and the bindings, but if you have it in the tail position then the distance is fixed.</p>



<a name="246483790"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/%60let%20pattern%20%3D%20expr%20else%20%7B%20...%20%7D%60%20statements/near/246483790" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Triplett <a href="https://rust-lang.github.io/zulip_archive/stream/213817-t-lang/topic/.60let.20pattern.20.3D.20expr.20else.20.7B.20.2E.2E.2E.20.7D.60.20statements.html#246483790">(Jul 19 2021 at 17:14)</a>:</h4>
<p>So, one problem there is that the block handling the non-matching case comes before the expression, which pushes the expression too far to the right.</p>



<a name="246483935"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/%60let%20pattern%20%3D%20expr%20else%20%7B%20...%20%7D%60%20statements/near/246483935" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Mario Carneiro <a href="https://rust-lang.github.io/zulip_archive/stream/213817-t-lang/topic/.60let.20pattern.20.3D.20expr.20else.20.7B.20.2E.2E.2E.20.7D.60.20statements.html#246483935">(Jul 19 2021 at 17:15)</a>:</h4>
<p>I would guess that in most medium or larger examples that wouldn't fit on a line, and then indentation looks like a mess</p>



<a name="246483943"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/%60let%20pattern%20%3D%20expr%20else%20%7B%20...%20%7D%60%20statements/near/246483943" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> bstrie <a href="https://rust-lang.github.io/zulip_archive/stream/213817-t-lang/topic/.60let.20pattern.20.3D.20expr.20else.20.7B.20.2E.2E.2E.20.7D.60.20statements.html#246483943">(Jul 19 2021 at 17:15)</a>:</h4>
<p>Something like <code>let PAT = match EXPR else { ... }</code> wouldn't be completely out of the question... just full-on non-exhaustive match where the <code>else</code> is first-class sugar for the inner <code>_</code> arm</p>



<a name="246484045"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/%60let%20pattern%20%3D%20expr%20else%20%7B%20...%20%7D%60%20statements/near/246484045" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Triplett <a href="https://rust-lang.github.io/zulip_archive/stream/213817-t-lang/topic/.60let.20pattern.20.3D.20expr.20else.20.7B.20.2E.2E.2E.20.7D.60.20statements.html#246484045">(Jul 19 2021 at 17:16)</a>:</h4>
<p><span class="user-mention" data-user-id="271719">@Mario Carneiro</span> Not necessarily a mess, but no simpler or briefer than <code>match</code> at that point.</p>



<a name="246484126"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/%60let%20pattern%20%3D%20expr%20else%20%7B%20...%20%7D%60%20statements/near/246484126" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Triplett <a href="https://rust-lang.github.io/zulip_archive/stream/213817-t-lang/topic/.60let.20pattern.20.3D.20expr.20else.20.7B.20.2E.2E.2E.20.7D.60.20statements.html#246484126">(Jul 19 2021 at 17:17)</a>:</h4>
<p><span class="user-mention" data-user-id="256342">@bstrie</span> And the <code>let PAT =</code> is syntactic sugar for the first arm of the match?</p>



<a name="246484187"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/%60let%20pattern%20%3D%20expr%20else%20%7B%20...%20%7D%60%20statements/near/246484187" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> bstrie <a href="https://rust-lang.github.io/zulip_archive/stream/213817-t-lang/topic/.60let.20pattern.20.3D.20expr.20else.20.7B.20.2E.2E.2E.20.7D.60.20statements.html#246484187">(Jul 19 2021 at 17:17)</a>:</h4>
<p>yes, although I wonder if there's a more expression-oriented friendly way to formulate it</p>



<a name="246484197"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/%60let%20pattern%20%3D%20expr%20else%20%7B%20...%20%7D%60%20statements/near/246484197" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Triplett <a href="https://rust-lang.github.io/zulip_archive/stream/213817-t-lang/topic/.60let.20pattern.20.3D.20expr.20else.20.7B.20.2E.2E.2E.20.7D.60.20statements.html#246484197">(Jul 19 2021 at 17:17)</a>:</h4>
<p><span class="user-mention" data-user-id="256342">@bstrie</span> That <em>feels</em> non-orthogonal in a language design sense, because the <code>match EXPR else { ... }</code> on the right feels like a construct that should work outside of the <code>let</code>, but it's not obvious what it could mean.</p>



<a name="246484292"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/%60let%20pattern%20%3D%20expr%20else%20%7B%20...%20%7D%60%20statements/near/246484292" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> The 8472 <a href="https://rust-lang.github.io/zulip_archive/stream/213817-t-lang/topic/.60let.20pattern.20.3D.20expr.20else.20.7B.20.2E.2E.2E.20.7D.60.20statements.html#246484292">(Jul 19 2021 at 17:18)</a>:</h4>
<p>So the preferences seem to be:</p>
<ol>
<li>let in front</li>
<li>pattern</li>
<li>expression</li>
<li>diverging block</li>
</ol>
<p>That doesn't leave many options how to structure this, other than picking keywords and sigils</p>



<a name="246484323"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/%60let%20pattern%20%3D%20expr%20else%20%7B%20...%20%7D%60%20statements/near/246484323" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Triplett <a href="https://rust-lang.github.io/zulip_archive/stream/213817-t-lang/topic/.60let.20pattern.20.3D.20expr.20else.20.7B.20.2E.2E.2E.20.7D.60.20statements.html#246484323">(Jul 19 2021 at 17:18)</a>:</h4>
<p><span class="user-mention" data-user-id="330154">@The 8472</span> Pretty much, yes.</p>



<a name="246484324"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/%60let%20pattern%20%3D%20expr%20else%20%7B%20...%20%7D%60%20statements/near/246484324" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> bstrie <a href="https://rust-lang.github.io/zulip_archive/stream/213817-t-lang/topic/.60let.20pattern.20.3D.20expr.20else.20.7B.20.2E.2E.2E.20.7D.60.20statements.html#246484324">(Jul 19 2021 at 17:18)</a>:</h4>
<p>it does have the advantage that of all the braced expressions that we could add <code>else</code> to, <code>match</code> is the only one that's not complete nonsense :P</p>



<a name="246484506"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/%60let%20pattern%20%3D%20expr%20else%20%7B%20...%20%7D%60%20statements/near/246484506" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Triplett <a href="https://rust-lang.github.io/zulip_archive/stream/213817-t-lang/topic/.60let.20pattern.20.3D.20expr.20else.20.7B.20.2E.2E.2E.20.7D.60.20statements.html#246484506">(Jul 19 2021 at 17:20)</a>:</h4>
<p>1) <code>let</code> in front to advertise that there are bindings<br>
2) <code>pat</code> next for similarity with let and to define what the bindings are early.<br>
3) <code>expr</code> next for similarity with let and because it's executed logically before the diverging block<br>
4) diverging block last because it's executed logically last as part of error handling, and to make it easy to break across lines since it's a braced block that could contain multiple statements.</p>



<a name="246484515"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/%60let%20pattern%20%3D%20expr%20else%20%7B%20...%20%7D%60%20statements/near/246484515" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> bstrie <a href="https://rust-lang.github.io/zulip_archive/stream/213817-t-lang/topic/.60let.20pattern.20.3D.20expr.20else.20.7B.20.2E.2E.2E.20.7D.60.20statements.html#246484515">(Jul 19 2021 at 17:20)</a>:</h4>
<p><code>let PAT if = EXPR else { ... }</code>?</p>



<a name="246484744"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/%60let%20pattern%20%3D%20expr%20else%20%7B%20...%20%7D%60%20statements/near/246484744" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> The 8472 <a href="https://rust-lang.github.io/zulip_archive/stream/213817-t-lang/topic/.60let.20pattern.20.3D.20expr.20else.20.7B.20.2E.2E.2E.20.7D.60.20statements.html#246484744">(Jul 19 2021 at 17:22)</a>:</h4>
<p>valid under the given constraints :P</p>



<a name="246484827"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/%60let%20pattern%20%3D%20expr%20else%20%7B%20...%20%7D%60%20statements/near/246484827" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Triplett <a href="https://rust-lang.github.io/zulip_archive/stream/213817-t-lang/topic/.60let.20pattern.20.3D.20expr.20else.20.7B.20.2E.2E.2E.20.7D.60.20statements.html#246484827">(Jul 19 2021 at 17:23)</a>:</h4>
<p><span class="user-mention" data-user-id="256342">@bstrie</span> That does fit all the above criteria, though its use of <code>if</code> seems confusing. You're trying to find a way to forecast the "else" there? <code>if</code> as a keyword followed immediately by <code>=</code> confuses my internal parser. :)</p>



<a name="246484836"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/%60let%20pattern%20%3D%20expr%20else%20%7B%20...%20%7D%60%20statements/near/246484836" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> bstrie <a href="https://rust-lang.github.io/zulip_archive/stream/213817-t-lang/topic/.60let.20pattern.20.3D.20expr.20else.20.7B.20.2E.2E.2E.20.7D.60.20statements.html#246484836">(Jul 19 2021 at 17:23)</a>:</h4>
<p>it's not half bad... or rather maybe it's <em>only</em> half bad, which might be an improvement over everything else we've got :P</p>



<a name="246484870"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/%60let%20pattern%20%3D%20expr%20else%20%7B%20...%20%7D%60%20statements/near/246484870" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Triplett <a href="https://rust-lang.github.io/zulip_archive/stream/213817-t-lang/topic/.60let.20pattern.20.3D.20expr.20else.20.7B.20.2E.2E.2E.20.7D.60.20statements.html#246484870">(Jul 19 2021 at 17:23)</a>:</h4>
<p>And I'm concerned that <code>if = EXPR</code> will be easy to misread as <code>if EXPR</code>.</p>



<a name="246484920"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/%60let%20pattern%20%3D%20expr%20else%20%7B%20...%20%7D%60%20statements/near/246484920" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> The 8472 <a href="https://rust-lang.github.io/zulip_archive/stream/213817-t-lang/topic/.60let.20pattern.20.3D.20expr.20else.20.7B.20.2E.2E.2E.20.7D.60.20statements.html#246484920">(Jul 19 2021 at 17:23)</a>:</h4>
<p>is &lt;- still reserved?</p>



<a name="246485021"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/%60let%20pattern%20%3D%20expr%20else%20%7B%20...%20%7D%60%20statements/near/246485021" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> bstrie <a href="https://rust-lang.github.io/zulip_archive/stream/213817-t-lang/topic/.60let.20pattern.20.3D.20expr.20else.20.7B.20.2E.2E.2E.20.7D.60.20statements.html#246485021">(Jul 19 2021 at 17:24)</a>:</h4>
<p>oh no, <code>=</code> vs <code>&lt;-</code>... <em>flashbacks to R</em></p>



<a name="246485082"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/%60let%20pattern%20%3D%20expr%20else%20%7B%20...%20%7D%60%20statements/near/246485082" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Triplett <a href="https://rust-lang.github.io/zulip_archive/stream/213817-t-lang/topic/.60let.20pattern.20.3D.20expr.20else.20.7B.20.2E.2E.2E.20.7D.60.20statements.html#246485082">(Jul 19 2021 at 17:24)</a>:</h4>
<p><span class="user-mention" data-user-id="330154">@The 8472</span> Huh. Possibly. Are you thinking that replacing <code>=</code> with <code>&lt;-</code> in a let-else would have a symmetry with match using <code>=&gt;</code>, and thus evoke a different construct?</p>



<a name="246485127"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/%60let%20pattern%20%3D%20expr%20else%20%7B%20...%20%7D%60%20statements/near/246485127" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Triplett <a href="https://rust-lang.github.io/zulip_archive/stream/213817-t-lang/topic/.60let.20pattern.20.3D.20expr.20else.20.7B.20.2E.2E.2E.20.7D.60.20statements.html#246485127">(Jul 19 2021 at 17:25)</a>:</h4>
<p>/me is still trying to figure out the actual problem people are trying to solve.</p>



<a name="246485129"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/%60let%20pattern%20%3D%20expr%20else%20%7B%20...%20%7D%60%20statements/near/246485129" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> The 8472 <a href="https://rust-lang.github.io/zulip_archive/stream/213817-t-lang/topic/.60let.20pattern.20.3D.20expr.20else.20.7B.20.2E.2E.2E.20.7D.60.20statements.html#246485129">(Jul 19 2021 at 17:25)</a>:</h4>
<p>yes</p>



<a name="246485156"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/%60let%20pattern%20%3D%20expr%20else%20%7B%20...%20%7D%60%20statements/near/246485156" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Triplett <a href="https://rust-lang.github.io/zulip_archive/stream/213817-t-lang/topic/.60let.20pattern.20.3D.20expr.20else.20.7B.20.2E.2E.2E.20.7D.60.20statements.html#246485156">(Jul 19 2021 at 17:25)</a>:</h4>
<p>I get that people want to forecast the <code>else</code>, but I haven't yet fully understood <em>why</em>.</p>



<a name="246485269"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/%60let%20pattern%20%3D%20expr%20else%20%7B%20...%20%7D%60%20statements/near/246485269" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Triplett <a href="https://rust-lang.github.io/zulip_archive/stream/213817-t-lang/topic/.60let.20pattern.20.3D.20expr.20else.20.7B.20.2E.2E.2E.20.7D.60.20statements.html#246485269">(Jul 19 2021 at 17:26)</a>:</h4>
<p>I feel like people must read code very differently than I do. Which is completely valid, and I'm trying to understand what goes wrong in people's internal Rust parsers if the <code>else</code> isn't forecast by anything other than "this pattern looks like it might be refutable".</p>



<a name="246485303"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/%60let%20pattern%20%3D%20expr%20else%20%7B%20...%20%7D%60%20statements/near/246485303" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> The 8472 <a href="https://rust-lang.github.io/zulip_archive/stream/213817-t-lang/topic/.60let.20pattern.20.3D.20expr.20else.20.7B.20.2E.2E.2E.20.7D.60.20statements.html#246485303">(Jul 19 2021 at 17:26)</a>:</h4>
<p>because let looks_like_an_infallible_pattern = multi-line expressions... SURPRISE ELSE ?</p>



<a name="246485333"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/%60let%20pattern%20%3D%20expr%20else%20%7B%20...%20%7D%60%20statements/near/246485333" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> bstrie <a href="https://rust-lang.github.io/zulip_archive/stream/213817-t-lang/topic/.60let.20pattern.20.3D.20expr.20else.20.7B.20.2E.2E.2E.20.7D.60.20statements.html#246485333">(Jul 19 2021 at 17:26)</a>:</h4>
<p>I don't particularly care about forecasting the <code>else</code> (well, it would be nice for parsing), but I am a little worried about any future extension re: if-let-chains, where suddenly the RHS of the <code>=</code> is a full-on conditional context without any forewarning</p>



<a name="246485413"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/%60let%20pattern%20%3D%20expr%20else%20%7B%20...%20%7D%60%20statements/near/246485413" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Triplett <a href="https://rust-lang.github.io/zulip_archive/stream/213817-t-lang/topic/.60let.20pattern.20.3D.20expr.20else.20.7B.20.2E.2E.2E.20.7D.60.20statements.html#246485413">(Jul 19 2021 at 17:27)</a>:</h4>
<p><span class="user-mention" data-user-id="256342">@bstrie</span> I feel quite strongly that we should never allow this to mix with if-let chains.</p>



<a name="246485421"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/%60let%20pattern%20%3D%20expr%20else%20%7B%20...%20%7D%60%20statements/near/246485421" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> bstrie <a href="https://rust-lang.github.io/zulip_archive/stream/213817-t-lang/topic/.60let.20pattern.20.3D.20expr.20else.20.7B.20.2E.2E.2E.20.7D.60.20statements.html#246485421">(Jul 19 2021 at 17:27)</a>:</h4>
<p>note that with if-let-chains, <code>if let</code> actually stops being its own distinct thing at all, and now <code>let</code> is just allowed to exist inside of <code>if</code> conditional contexts</p>



<a name="246485566"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/%60let%20pattern%20%3D%20expr%20else%20%7B%20...%20%7D%60%20statements/near/246485566" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Triplett <a href="https://rust-lang.github.io/zulip_archive/stream/213817-t-lang/topic/.60let.20pattern.20.3D.20expr.20else.20.7B.20.2E.2E.2E.20.7D.60.20statements.html#246485566">(Jul 19 2021 at 17:28)</a>:</h4>
<p><span class="user-mention" data-user-id="256342">@bstrie</span> That was one proposal for how to handle if-let chains; another was that you still could only write chains of <code>let</code> and booleans inside an if.</p>



<a name="246485602"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/%60let%20pattern%20%3D%20expr%20else%20%7B%20...%20%7D%60%20statements/near/246485602" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Triplett <a href="https://rust-lang.github.io/zulip_archive/stream/213817-t-lang/topic/.60let.20pattern.20.3D.20expr.20else.20.7B.20.2E.2E.2E.20.7D.60.20statements.html#246485602">(Jul 19 2021 at 17:28)</a>:</h4>
<p>I personally prefer the latter, for simplicity and avoiding the "surprise, I bound a variable inside this complex step" problem.</p>



<a name="246485612"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/%60let%20pattern%20%3D%20expr%20else%20%7B%20...%20%7D%60%20statements/near/246485612" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> bstrie <a href="https://rust-lang.github.io/zulip_archive/stream/213817-t-lang/topic/.60let.20pattern.20.3D.20expr.20else.20.7B.20.2E.2E.2E.20.7D.60.20statements.html#246485612">(Jul 19 2021 at 17:28)</a>:</h4>
<p><span class="user-mention" data-user-id="239881">@Josh Triplett</span> that's part of what I was getting at earlier where I feel like let-else doesn't "scale up" as well as if-let does, which threatens to leave people in a no-man's-land where their code is slightly too complicated for let-else and slightly too simple for match</p>



<a name="246485900"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/%60let%20pattern%20%3D%20expr%20else%20%7B%20...%20%7D%60%20statements/near/246485900" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Triplett <a href="https://rust-lang.github.io/zulip_archive/stream/213817-t-lang/topic/.60let.20pattern.20.3D.20expr.20else.20.7B.20.2E.2E.2E.20.7D.60.20statements.html#246485900">(Jul 19 2021 at 17:30)</a>:</h4>
<p>I would expect let-else to scale up in the complexity of the binding, or the diverging expression. It just doesn't scale to 1) arbitrarily complex expr, in which case you might want to bind the expr to a name first and then let-else on it, or 2) wanting more than one pattern, for either the success or failure cases, in which case you should switch to a full match.</p>



<a name="246485906"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/%60let%20pattern%20%3D%20expr%20else%20%7B%20...%20%7D%60%20statements/near/246485906" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> bstrie <a href="https://rust-lang.github.io/zulip_archive/stream/213817-t-lang/topic/.60let.20pattern.20.3D.20expr.20else.20.7B.20.2E.2E.2E.20.7D.60.20statements.html#246485906">(Jul 19 2021 at 17:30)</a>:</h4>
<p>I don't want to outright disallow the prospect of let-else-chains (I can imagine they'd be useful at times), but I agree that with the current prevailing syntax I think it would be fraught to allow them</p>



<a name="246486020"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/%60let%20pattern%20%3D%20expr%20else%20%7B%20...%20%7D%60%20statements/near/246486020" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Triplett <a href="https://rust-lang.github.io/zulip_archive/stream/213817-t-lang/topic/.60let.20pattern.20.3D.20expr.20else.20.7B.20.2E.2E.2E.20.7D.60.20statements.html#246486020">(Jul 19 2021 at 17:31)</a>:</h4>
<p><span class="user-mention" data-user-id="256342">@bstrie</span> I very much do want to outright disallow that; I think if you write <code>if let ... else { ... } { ... } else { ... }</code>, where the first <code>else</code> binds to the <code>let</code> and the second binds to the <code>if</code>, that turns into spaghetti very quickly and is almost never going to produce readable code.</p>



<a name="246486121"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/%60let%20pattern%20%3D%20expr%20else%20%7B%20...%20%7D%60%20statements/near/246486121" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Triplett <a href="https://rust-lang.github.io/zulip_archive/stream/213817-t-lang/topic/.60let.20pattern.20.3D.20expr.20else.20.7B.20.2E.2E.2E.20.7D.60.20statements.html#246486121">(Jul 19 2021 at 17:32)</a>:</h4>
<p>It's not just "that will get unreadable fast"; I think it's unlikely to ever be readable enough to be useful, outside of carefully formatted sample code.</p>



<a name="246486186"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/%60let%20pattern%20%3D%20expr%20else%20%7B%20...%20%7D%60%20statements/near/246486186" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> The 8472 <a href="https://rust-lang.github.io/zulip_archive/stream/213817-t-lang/topic/.60let.20pattern.20.3D.20expr.20else.20.7B.20.2E.2E.2E.20.7D.60.20statements.html#246486186">(Jul 19 2021 at 17:33)</a>:</h4>
<p><a href="http://weird-exprs.rs">weird-exprs.rs</a> demands sacrifices</p>



<a name="246486197"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/%60let%20pattern%20%3D%20expr%20else%20%7B%20...%20%7D%60%20statements/near/246486197" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> bstrie <a href="https://rust-lang.github.io/zulip_archive/stream/213817-t-lang/topic/.60let.20pattern.20.3D.20expr.20else.20.7B.20.2E.2E.2E.20.7D.60.20statements.html#246486197">(Jul 19 2021 at 17:33)</a>:</h4>
<p>oh you're thinking about allowing let-else inside of if-let-chains, I definitely wouldn't allow that :P if-let-chains should only allow <code>let</code>, and <code>let else</code> is IMO a distinct construct from <code>let</code>, not some kind of subset/superset</p>



<a name="246486364"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/%60let%20pattern%20%3D%20expr%20else%20%7B%20...%20%7D%60%20statements/near/246486364" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Triplett <a href="https://rust-lang.github.io/zulip_archive/stream/213817-t-lang/topic/.60let.20pattern.20.3D.20expr.20else.20.7B.20.2E.2E.2E.20.7D.60.20statements.html#246486364">(Jul 19 2021 at 17:34)</a>:</h4>
<p><span class="user-mention" data-user-id="256342">@bstrie</span> Right. And I personally don't think let chains should exist outside of if-let or while-let, which means let-else never needs to combine with let chains. Were you <em>just</em> thinking of the case of let-chains outside of if-let and while-let?</p>



<a name="246486559"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/%60let%20pattern%20%3D%20expr%20else%20%7B%20...%20%7D%60%20statements/near/246486559" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Triplett <a href="https://rust-lang.github.io/zulip_archive/stream/213817-t-lang/topic/.60let.20pattern.20.3D.20expr.20else.20.7B.20.2E.2E.2E.20.7D.60.20statements.html#246486559">(Jul 19 2021 at 17:36)</a>:</h4>
<p>This is, for the record, one of the things we had in mind when stating that we need to consider let-else and let-chains together before stabilizing, because if we changed our plans on the latter then that would affect the former.</p>



<a name="246487284"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/%60let%20pattern%20%3D%20expr%20else%20%7B%20...%20%7D%60%20statements/near/246487284" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Triplett <a href="https://rust-lang.github.io/zulip_archive/stream/213817-t-lang/topic/.60let.20pattern.20.3D.20expr.20else.20.7B.20.2E.2E.2E.20.7D.60.20statements.html#246487284">(Jul 19 2021 at 17:42)</a>:</h4>
<p><span class="user-mention silent" data-user-id="330154">The 8472</span> <a href="#narrow/stream/213817-t-lang/topic/.60let.20pattern.20.3D.20expr.20else.20.7B.20.2E.2E.2E.20.7D.60.20statements/near/246485303">said</a>:</p>
<blockquote>
<p>because let looks_like_an_infallible_pattern = multi-line expressions... SURPRISE ELSE ?</p>
</blockquote>
<p>I'm expecting that "looks_like_an_infallible_pattern" won't happen very often; it's absolutely possible but I'd expect it to be uncommon. I also expect hugely complex multi-line expressions to be better written as a separate statement, and I'm hoping that expr is <em>usually</em> simple, as it often is with <code>if let</code>. Given both of those things, I'm expecting that code that <em>wants</em> to be readable won't end up combining all three of <code>looks_like_an_infallible_pattern</code> and complex multi-line expressions and let-else.</p>



<a name="246487540"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/%60let%20pattern%20%3D%20expr%20else%20%7B%20...%20%7D%60%20statements/near/246487540" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> bstrie <a href="https://rust-lang.github.io/zulip_archive/stream/213817-t-lang/topic/.60let.20pattern.20.3D.20expr.20else.20.7B.20.2E.2E.2E.20.7D.60.20statements.html#246487540">(Jul 19 2021 at 17:44)</a>:</h4>
<p>yes, WRT "chains" I think we have this implicit notion of a short-circuiting conditional context that allows a <code>let</code> that either succeeds or it doesn't, and you can use that with <code>while</code> and <code>if</code>. So the <code>FOO</code> in <code>if FOO {</code> and <code>while FOO {</code> are this conditional context, where if you have a <code>let</code> in there then it introduces a binding into the following block. I envision a "let-else-chains" proposal to look like <code>let PAT = FOO else {</code>, where <code>FOO</code> is similarly such a conditional context except the first "condition" in the context has to be an expression and a successful pattern match there short-circuits the remainder of the conditional context.</p>



<a name="246487659"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/%60let%20pattern%20%3D%20expr%20else%20%7B%20...%20%7D%60%20statements/near/246487659" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Triplett <a href="https://rust-lang.github.io/zulip_archive/stream/213817-t-lang/topic/.60let.20pattern.20.3D.20expr.20else.20.7B.20.2E.2E.2E.20.7D.60.20statements.html#246487659">(Jul 19 2021 at 17:45)</a>:</h4>
<p>The first sentence there made perfect sense. The second sentence lost me.</p>



<a name="246487676"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/%60let%20pattern%20%3D%20expr%20else%20%7B%20...%20%7D%60%20statements/near/246487676" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Triplett <a href="https://rust-lang.github.io/zulip_archive/stream/213817-t-lang/topic/.60let.20pattern.20.3D.20expr.20else.20.7B.20.2E.2E.2E.20.7D.60.20statements.html#246487676">(Jul 19 2021 at 17:45)</a>:</h4>
<p>What kind of chaining do you have in mind there?</p>



<a name="246487681"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/%60let%20pattern%20%3D%20expr%20else%20%7B%20...%20%7D%60%20statements/near/246487681" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Triplett <a href="https://rust-lang.github.io/zulip_archive/stream/213817-t-lang/topic/.60let.20pattern.20.3D.20expr.20else.20.7B.20.2E.2E.2E.20.7D.60.20statements.html#246487681">(Jul 19 2021 at 17:45)</a>:</h4>
<p>Are you talking about let-else-else?</p>



<a name="246488310"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/%60let%20pattern%20%3D%20expr%20else%20%7B%20...%20%7D%60%20statements/near/246488310" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> bstrie <a href="https://rust-lang.github.io/zulip_archive/stream/213817-t-lang/topic/.60let.20pattern.20.3D.20expr.20else.20.7B.20.2E.2E.2E.20.7D.60.20statements.html#246488310">(Jul 19 2021 at 17:50)</a>:</h4>
<p>I'm extrapolating from if-let-chains, where you have <code>if let Some(x) = y &amp;&amp; a == b { // then do a thing with x</code>, you might also want to have <code>let Some(x) = y || a == b { // then diverge</code>. I don't think it's as useful as if-let-chains, certainly, since one of the advantages of if-let-chains is that you can refer to successful matches from earlier in the chain, whereas here we're guaranteed to have at least one unsuccessful match that we naturally can't use any binding from. However, it would be useful in collapsing multiple identical "failure" blocks into a single one. I don't think it would be the end of the world to not support it, but it might be a missed opportunity if it can be done elegantly</p>



<a name="246488845"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/%60let%20pattern%20%3D%20expr%20else%20%7B%20...%20%7D%60%20statements/near/246488845" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Mario Carneiro <a href="https://rust-lang.github.io/zulip_archive/stream/213817-t-lang/topic/.60let.20pattern.20.3D.20expr.20else.20.7B.20.2E.2E.2E.20.7D.60.20statements.html#246488845">(Jul 19 2021 at 17:54)</a>:</h4>
<p><span class="user-mention silent" data-user-id="330154">The 8472</span> <a href="#narrow/stream/213817-t-lang/topic/.60let.20pattern.20.3D.20expr.20else.20.7B.20.2E.2E.2E.20.7D.60.20statements/near/246485303">said</a>:</p>
<blockquote>
<p>because let looks_like_an_infallible_pattern = multi-line expressions... SURPRISE ELSE ?</p>
</blockquote>
<p>Also, this isn't really a "surprise". If you think the pattern is infallible and read on, it's not like you will be mislead: when you have those bindings the rest of the block applies as normal. When you see the <code>else</code> you know that there are other cases that have to be handled, like a <code>_ =&gt;</code> at the end of a match statement, but it doesn't require a revision to whatever you inferred about the "main" code path.</p>



<a name="246489711"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/%60let%20pattern%20%3D%20expr%20else%20%7B%20...%20%7D%60%20statements/near/246489711" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> The 8472 <a href="https://rust-lang.github.io/zulip_archive/stream/213817-t-lang/topic/.60let.20pattern.20.3D.20expr.20else.20.7B.20.2E.2E.2E.20.7D.60.20statements.html#246489711">(Jul 19 2021 at 18:00)</a>:</h4>
<p>As long as enum variants aren't proper types, I thought there was an RFC for it but it looks like that was closed.</p>



<a name="246489992"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/%60let%20pattern%20%3D%20expr%20else%20%7B%20...%20%7D%60%20statements/near/246489992" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Mario Carneiro <a href="https://rust-lang.github.io/zulip_archive/stream/213817-t-lang/topic/.60let.20pattern.20.3D.20expr.20else.20.7B.20.2E.2E.2E.20.7D.60.20statements.html#246489992">(Jul 19 2021 at 18:02)</a>:</h4>
<p>I'm not sure how that would interact with this</p>



<a name="246490065"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/%60let%20pattern%20%3D%20expr%20else%20%7B%20...%20%7D%60%20statements/near/246490065" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> bstrie <a href="https://rust-lang.github.io/zulip_archive/stream/213817-t-lang/topic/.60let.20pattern.20.3D.20expr.20else.20.7B.20.2E.2E.2E.20.7D.60.20statements.html#246490065">(Jul 19 2021 at 18:03)</a>:</h4>
<p>we'll have infallible bindings on enums as soon as <code>!</code> is stabilized, as IMO the whole point of <code>!</code> is to allow things like <code>let Ok(x) = y;</code> (where <code>y: Result&lt;Foo, !&gt;</code>). But even then I don't expect it to ever be common to assume that an assignment from an enum variant is infallible, rather I expect people to assume the opposite unless something special is going on (such as <code>!</code>, or let-else).</p>



<a name="246490262"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/%60let%20pattern%20%3D%20expr%20else%20%7B%20...%20%7D%60%20statements/near/246490262" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> bstrie <a href="https://rust-lang.github.io/zulip_archive/stream/213817-t-lang/topic/.60let.20pattern.20.3D.20expr.20else.20.7B.20.2E.2E.2E.20.7D.60.20statements.html#246490262">(Jul 19 2021 at 18:04)</a>:</h4>
<p>(and yes, cue the usual joke about when <code>!</code> will finally be stabilized, but it'll still happen before enum-variants-as-types :P )</p>



<a name="246491274"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/%60let%20pattern%20%3D%20expr%20else%20%7B%20...%20%7D%60%20statements/near/246491274" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Triplett <a href="https://rust-lang.github.io/zulip_archive/stream/213817-t-lang/topic/.60let.20pattern.20.3D.20expr.20else.20.7B.20.2E.2E.2E.20.7D.60.20statements.html#246491274">(Jul 19 2021 at 18:11)</a>:</h4>
<p>Also, the compiler will always help you get it right: it'll complain about <code>let Ok(x) = y;</code> if <code>y</code> is <code>Result&lt;T, E&gt;</code>, and it'll complain about <code>let Ok(x) = y else { ... };</code> if <code>y</code> is <code>Result&lt;T, !&gt;</code>.</p>



<a name="246510963"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/%60let%20pattern%20%3D%20expr%20else%20%7B%20...%20%7D%60%20statements/near/246510963" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Cameron Steffen <a href="https://rust-lang.github.io/zulip_archive/stream/213817-t-lang/topic/.60let.20pattern.20.3D.20expr.20else.20.7B.20.2E.2E.2E.20.7D.60.20statements.html#246510963">(Jul 19 2021 at 20:40)</a>:</h4>
<p>Thoughts on <code>let? Some(x) = y else { return }</code>?</p>



<a name="246511227"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/%60let%20pattern%20%3D%20expr%20else%20%7B%20...%20%7D%60%20statements/near/246511227" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Triplett <a href="https://rust-lang.github.io/zulip_archive/stream/213817-t-lang/topic/.60let.20pattern.20.3D.20expr.20else.20.7B.20.2E.2E.2E.20.7D.60.20statements.html#246511227">(Jul 19 2021 at 20:43)</a>:</h4>
<p><span class="user-mention" data-user-id="360405">@Cameron Steffen</span> Seems pretty reasonable. The use of <code>?</code> as syntax there might confuse people slightly who are used to <code>?</code> meaning try, but in <em>general</em> the concept makes sense.</p>



<a name="246511338"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/%60let%20pattern%20%3D%20expr%20else%20%7B%20...%20%7D%60%20statements/near/246511338" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Triplett <a href="https://rust-lang.github.io/zulip_archive/stream/213817-t-lang/topic/.60let.20pattern.20.3D.20expr.20else.20.7B.20.2E.2E.2E.20.7D.60.20statements.html#246511338">(Jul 19 2021 at 20:44)</a>:</h4>
<p>It certainly doesn't cause any of the problems I've seen with other proposals, and it meets all the criteria mentioned earlier. At this point, we're out of "here's a fatal issue" territory, and into "that would not be my preference" territory. :)</p>



<a name="246511387"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/%60let%20pattern%20%3D%20expr%20else%20%7B%20...%20%7D%60%20statements/near/246511387" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Cameron Steffen <a href="https://rust-lang.github.io/zulip_archive/stream/213817-t-lang/topic/.60let.20pattern.20.3D.20expr.20else.20.7B.20.2E.2E.2E.20.7D.60.20statements.html#246511387">(Jul 19 2021 at 20:44)</a>:</h4>
<p>let-else combined with let-chains would be nice for cases like this</p>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="kd">let</span><span class="w"> </span><span class="n">z</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="kd">let</span><span class="w"> </span><span class="nb">Some</span><span class="p">(</span><span class="n">x</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">y</span><span class="p">.</span><span class="n">foo</span><span class="p">()</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="kd">let</span><span class="w"> </span><span class="nb">Some</span><span class="p">(</span><span class="n">z</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">x</span><span class="p">.</span><span class="n">foo</span><span class="p">()</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="n">z</span><span class="w"> </span><span class="c1">// ERROR - `x` does not live long enough</span>
<span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="k">return</span><span class="w"> </span><span class="p">};</span><span class="w"></span>
</code></pre></div>



<a name="246511405"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/%60let%20pattern%20%3D%20expr%20else%20%7B%20...%20%7D%60%20statements/near/246511405" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Triplett <a href="https://rust-lang.github.io/zulip_archive/stream/213817-t-lang/topic/.60let.20pattern.20.3D.20expr.20else.20.7B.20.2E.2E.2E.20.7D.60.20statements.html#246511405">(Jul 19 2021 at 20:44)</a>:</h4>
<p>I think the only major issue with <code>let?</code>, apart from "do we need to forecast the <code>else</code> at all", is "should we use <code>?</code> for that, is that confusing for people who know what <code>?</code> means".</p>



<a name="246511606"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/%60let%20pattern%20%3D%20expr%20else%20%7B%20...%20%7D%60%20statements/near/246511606" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> The 8472 <a href="https://rust-lang.github.io/zulip_archive/stream/213817-t-lang/topic/.60let.20pattern.20.3D.20expr.20else.20.7B.20.2E.2E.2E.20.7D.60.20statements.html#246511606">(Jul 19 2021 at 20:46)</a>:</h4>
<p>if you interpret it as fallible operation then it makes sense.</p>



<a name="246511654"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/%60let%20pattern%20%3D%20expr%20else%20%7B%20...%20%7D%60%20statements/near/246511654" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> The 8472 <a href="https://rust-lang.github.io/zulip_archive/stream/213817-t-lang/topic/.60let.20pattern.20.3D.20expr.20else.20.7B.20.2E.2E.2E.20.7D.60.20statements.html#246511654">(Jul 19 2021 at 20:46)</a>:</h4>
<p>Or it could be put behind the pattern instead of the let?</p>



<a name="246511661"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/%60let%20pattern%20%3D%20expr%20else%20%7B%20...%20%7D%60%20statements/near/246511661" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Cameron Steffen <a href="https://rust-lang.github.io/zulip_archive/stream/213817-t-lang/topic/.60let.20pattern.20.3D.20expr.20else.20.7B.20.2E.2E.2E.20.7D.60.20statements.html#246511661">(Jul 19 2021 at 20:46)</a>:</h4>
<p>(like I said on the issue) I think that would be solved by syntax highlighting. The <code>?</code> would not look like an operator, it is just part of the <code>let?</code> keyword.</p>



<a name="246511721"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/%60let%20pattern%20%3D%20expr%20else%20%7B%20...%20%7D%60%20statements/near/246511721" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Cameron Steffen <a href="https://rust-lang.github.io/zulip_archive/stream/213817-t-lang/topic/.60let.20pattern.20.3D.20expr.20else.20.7B.20.2E.2E.2E.20.7D.60.20statements.html#246511721">(Jul 19 2021 at 20:47)</a>:</h4>
<p>*kinda solved</p>



<a name="246511785"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/%60let%20pattern%20%3D%20expr%20else%20%7B%20...%20%7D%60%20statements/near/246511785" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Cameron Steffen <a href="https://rust-lang.github.io/zulip_archive/stream/213817-t-lang/topic/.60let.20pattern.20.3D.20expr.20else.20.7B.20.2E.2E.2E.20.7D.60.20statements.html#246511785">(Jul 19 2021 at 20:47)</a>:</h4>
<p>it lends to the description "fallible let" which is nice</p>



<a name="246512988"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/%60let%20pattern%20%3D%20expr%20else%20%7B%20...%20%7D%60%20statements/near/246512988" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> The 8472 <a href="https://rust-lang.github.io/zulip_archive/stream/213817-t-lang/topic/.60let.20pattern.20.3D.20expr.20else.20.7B.20.2E.2E.2E.20.7D.60.20statements.html#246512988">(Jul 19 2021 at 20:57)</a>:</h4>
<p>otoh it's not really a property of the let but the assignment, you could have the same fallibility during a reassignment.</p>
<p>So it should be on the pattern or the equals.</p>



<a name="246513028"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/%60let%20pattern%20%3D%20expr%20else%20%7B%20...%20%7D%60%20statements/near/246513028" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Cameron Steffen <a href="https://rust-lang.github.io/zulip_archive/stream/213817-t-lang/topic/.60let.20pattern.20.3D.20expr.20else.20.7B.20.2E.2E.2E.20.7D.60.20statements.html#246513028">(Jul 19 2021 at 20:57)</a>:</h4>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="kd">let</span><span class="w"> </span><span class="nb">Some</span><span class="p">(</span><span class="n">x</span><span class="p">)</span><span class="w"> </span><span class="o">?=</span><span class="w"> </span><span class="n">y</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="k">return</span><span class="w"> </span><span class="p">};</span><span class="w"></span>
</code></pre></div>



<a name="246513094"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/%60let%20pattern%20%3D%20expr%20else%20%7B%20...%20%7D%60%20statements/near/246513094" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> The 8472 <a href="https://rust-lang.github.io/zulip_archive/stream/213817-t-lang/topic/.60let.20pattern.20.3D.20expr.20else.20.7B.20.2E.2E.2E.20.7D.60.20statements.html#246513094">(Jul 19 2021 at 20:58)</a>:</h4>
<p>indeed</p>



<a name="246513184"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/%60let%20pattern%20%3D%20expr%20else%20%7B%20...%20%7D%60%20statements/near/246513184" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Cameron Steffen <a href="https://rust-lang.github.io/zulip_archive/stream/213817-t-lang/topic/.60let.20pattern.20.3D.20expr.20else.20.7B.20.2E.2E.2E.20.7D.60.20statements.html#246513184">(Jul 19 2021 at 20:59)</a>:</h4>
<p>it's like..."test equals"...too weird?</p>



<a name="246513472"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/%60let%20pattern%20%3D%20expr%20else%20%7B%20...%20%7D%60%20statements/near/246513472" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> The 8472 <a href="https://rust-lang.github.io/zulip_archive/stream/213817-t-lang/topic/.60let.20pattern.20.3D.20expr.20else.20.7B.20.2E.2E.2E.20.7D.60.20statements.html#246513472">(Jul 19 2021 at 21:00)</a>:</h4>
<p><code>let Some(x)? = y else { return };</code> move it one whitespace to the left or<br>
<code>let Some(x) ? y : { return };</code> finally we have a ternary operator!</p>



<a name="246513974"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/%60let%20pattern%20%3D%20expr%20else%20%7B%20...%20%7D%60%20statements/near/246513974" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Cameron Steffen <a href="https://rust-lang.github.io/zulip_archive/stream/213817-t-lang/topic/.60let.20pattern.20.3D.20expr.20else.20.7B.20.2E.2E.2E.20.7D.60.20statements.html#246513974">(Jul 19 2021 at 21:02)</a>:</h4>
<p>except it's not like ternary. might be a problem that it looks like ternary.</p>



<a name="246514120"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/%60let%20pattern%20%3D%20expr%20else%20%7B%20...%20%7D%60%20statements/near/246514120" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Triplett <a href="https://rust-lang.github.io/zulip_archive/stream/213817-t-lang/topic/.60let.20pattern.20.3D.20expr.20else.20.7B.20.2E.2E.2E.20.7D.60.20statements.html#246514120">(Jul 19 2021 at 21:03)</a>:</h4>
<p>I like the <em>concept</em> of <code>?=</code> here.</p>



<a name="246514248"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/%60let%20pattern%20%3D%20expr%20else%20%7B%20...%20%7D%60%20statements/near/246514248" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Triplett <a href="https://rust-lang.github.io/zulip_archive/stream/213817-t-lang/topic/.60let.20pattern.20.3D.20expr.20else.20.7B.20.2E.2E.2E.20.7D.60.20statements.html#246514248">(Jul 19 2021 at 21:03)</a>:</h4>
<p>It has the downside that patterns and expressions look similar, and people are used to <code>?</code> after an expression meaning something different.</p>



<a name="246514317"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/%60let%20pattern%20%3D%20expr%20else%20%7B%20...%20%7D%60%20statements/near/246514317" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Cameron Steffen <a href="https://rust-lang.github.io/zulip_archive/stream/213817-t-lang/topic/.60let.20pattern.20.3D.20expr.20else.20.7B.20.2E.2E.2E.20.7D.60.20statements.html#246514317">(Jul 19 2021 at 21:04)</a>:</h4>
<p>yeah it's a nice concept because <code>=</code> usually means "just assign" with no condition</p>



<a name="246514458"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/%60let%20pattern%20%3D%20expr%20else%20%7B%20...%20%7D%60%20statements/near/246514458" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Triplett <a href="https://rust-lang.github.io/zulip_archive/stream/213817-t-lang/topic/.60let.20pattern.20.3D.20expr.20else.20.7B.20.2E.2E.2E.20.7D.60.20statements.html#246514458">(Jul 19 2021 at 21:04)</a>:</h4>
<p><code>let pat ?= expr else { diverge };</code> is the first alternative I've seen where my reaction is "OK, I wouldn't be sad and disappointed if that's what we ended up with".</p>



<a name="246514573"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/%60let%20pattern%20%3D%20expr%20else%20%7B%20...%20%7D%60%20statements/near/246514573" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Cameron Steffen <a href="https://rust-lang.github.io/zulip_archive/stream/213817-t-lang/topic/.60let.20pattern.20.3D.20expr.20else.20.7B.20.2E.2E.2E.20.7D.60.20statements.html#246514573">(Jul 19 2021 at 21:05)</a>:</h4>
<p>Fortunately <code>pat</code> cannot end in <code>?</code> right?</p>



<a name="246514648"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/%60let%20pattern%20%3D%20expr%20else%20%7B%20...%20%7D%60%20statements/near/246514648" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Triplett <a href="https://rust-lang.github.io/zulip_archive/stream/213817-t-lang/topic/.60let.20pattern.20.3D.20expr.20else.20.7B.20.2E.2E.2E.20.7D.60.20statements.html#246514648">(Jul 19 2021 at 21:05)</a>:</h4>
<p>At the moment no, but we'd have to commit to never wanting to use <code>?</code> for something in a patter, and I know we've had some thoughts on doing that.</p>



<a name="246514819"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/%60let%20pattern%20%3D%20expr%20else%20%7B%20...%20%7D%60%20statements/near/246514819" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Triplett <a href="https://rust-lang.github.io/zulip_archive/stream/213817-t-lang/topic/.60let.20pattern.20.3D.20expr.20else.20.7B.20.2E.2E.2E.20.7D.60.20statements.html#246514819">(Jul 19 2021 at 21:06)</a>:</h4>
<p>As an example, we've had proposals to use <code>for pat? in expr { ... }</code> instead of <code>for pat in expr { let pat = pat?; ... }</code></p>



<a name="246514960"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/%60let%20pattern%20%3D%20expr%20else%20%7B%20...%20%7D%60%20statements/near/246514960" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Cameron Steffen <a href="https://rust-lang.github.io/zulip_archive/stream/213817-t-lang/topic/.60let.20pattern.20.3D.20expr.20else.20.7B.20.2E.2E.2E.20.7D.60.20statements.html#246514960">(Jul 19 2021 at 21:06)</a>:</h4>
<p>yeah but no :)</p>



<a name="246514985"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/%60let%20pattern%20%3D%20expr%20else%20%7B%20...%20%7D%60%20statements/near/246514985" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Triplett <a href="https://rust-lang.github.io/zulip_archive/stream/213817-t-lang/topic/.60let.20pattern.20.3D.20expr.20else.20.7B.20.2E.2E.2E.20.7D.60.20statements.html#246514985">(Jul 19 2021 at 21:07)</a>:</h4>
<p>I'm not sure if that's the exact syntax we want, but the <em>concept</em> of "iterate over things that might fail" is useful.</p>



<a name="246515039"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/%60let%20pattern%20%3D%20expr%20else%20%7B%20...%20%7D%60%20statements/near/246515039" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Triplett <a href="https://rust-lang.github.io/zulip_archive/stream/213817-t-lang/topic/.60let.20pattern.20.3D.20expr.20else.20.7B.20.2E.2E.2E.20.7D.60.20statements.html#246515039">(Jul 19 2021 at 21:07)</a>:</h4>
<p>(Other proposals include <code>try for</code> or <code>for try</code>. But usually <code>try</code> is the keyword for "stop propagation of <code>?</code>" rather than "start propagation", with <code>?</code> being used to start propagation.)</p>



<a name="246515379"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/%60let%20pattern%20%3D%20expr%20else%20%7B%20...%20%7D%60%20statements/near/246515379" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> The 8472 <a href="https://rust-lang.github.io/zulip_archive/stream/213817-t-lang/topic/.60let.20pattern.20.3D.20expr.20else.20.7B.20.2E.2E.2E.20.7D.60.20statements.html#246515379">(Jul 19 2021 at 21:08)</a>:</h4>
<p><code>for pat in expr { let pat = pat?; ... }</code> that's just while let else!</p>



<a name="246515400"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/%60let%20pattern%20%3D%20expr%20else%20%7B%20...%20%7D%60%20statements/near/246515400" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Cameron Steffen <a href="https://rust-lang.github.io/zulip_archive/stream/213817-t-lang/topic/.60let.20pattern.20.3D.20expr.20else.20.7B.20.2E.2E.2E.20.7D.60.20statements.html#246515400">(Jul 19 2021 at 21:08)</a>:</h4>
<p>Well now we're discussing another feature, but usually patterns don't <em>do</em> anything, and that shouldn't change IMO. I think try for could be solved with postfix macros somehow.</p>



<a name="246515698"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/%60let%20pattern%20%3D%20expr%20else%20%7B%20...%20%7D%60%20statements/near/246515698" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Triplett <a href="https://rust-lang.github.io/zulip_archive/stream/213817-t-lang/topic/.60let.20pattern.20.3D.20expr.20else.20.7B.20.2E.2E.2E.20.7D.60.20statements.html#246515698">(Jul 19 2021 at 21:10)</a>:</h4>
<p>Possibly. I'm not entirely sure.</p>



<a name="246515746"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/%60let%20pattern%20%3D%20expr%20else%20%7B%20...%20%7D%60%20statements/near/246515746" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Cameron Steffen <a href="https://rust-lang.github.io/zulip_archive/stream/213817-t-lang/topic/.60let.20pattern.20.3D.20expr.20else.20.7B.20.2E.2E.2E.20.7D.60.20statements.html#246515746">(Jul 19 2021 at 21:10)</a>:</h4>
<p><code>for pat in expr.try_each!()</code></p>



<a name="246515882"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/%60let%20pattern%20%3D%20expr%20else%20%7B%20...%20%7D%60%20statements/near/246515882" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Triplett <a href="https://rust-lang.github.io/zulip_archive/stream/213817-t-lang/topic/.60let.20pattern.20.3D.20expr.20else.20.7B.20.2E.2E.2E.20.7D.60.20statements.html#246515882">(Jul 19 2021 at 21:11)</a>:</h4>
<p>Sure. Or for that matter <code>expr.try_for!(|pat| { ... })</code>.</p>



<a name="246515908"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/%60let%20pattern%20%3D%20expr%20else%20%7B%20...%20%7D%60%20statements/near/246515908" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Triplett <a href="https://rust-lang.github.io/zulip_archive/stream/213817-t-lang/topic/.60let.20pattern.20.3D.20expr.20else.20.7B.20.2E.2E.2E.20.7D.60.20statements.html#246515908">(Jul 19 2021 at 21:11)</a>:</h4>
<p>But in any case, to keep it on topic, if we used <code>let pattern ?= expr else { ... }</code>, we'd have to commit to never giving <code>?</code> a meaning at the end of a pattern.</p>



<a name="246516026"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/%60let%20pattern%20%3D%20expr%20else%20%7B%20...%20%7D%60%20statements/near/246516026" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> The 8472 <a href="https://rust-lang.github.io/zulip_archive/stream/213817-t-lang/topic/.60let.20pattern.20.3D.20expr.20else.20.7B.20.2E.2E.2E.20.7D.60.20statements.html#246516026">(Jul 19 2021 at 21:12)</a>:</h4>
<p>how about <code>=?</code> instead? then the pattern could still have a <code>?</code></p>



<a name="246516041"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/%60let%20pattern%20%3D%20expr%20else%20%7B%20...%20%7D%60%20statements/near/246516041" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Boxy [she/her] <a href="https://rust-lang.github.io/zulip_archive/stream/213817-t-lang/topic/.60let.20pattern.20.3D.20expr.20else.20.7B.20.2E.2E.2E.20.7D.60.20statements.html#246516041">(Jul 19 2021 at 21:12)</a>:</h4>
<p><code>let pattern =? expr else { ... }</code> i guess if you want to keep <code>?</code> free for patterns <span aria-label="thinking" class="emoji emoji-1f914" role="img" title="thinking">:thinking:</span></p>



<a name="246516047"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/%60let%20pattern%20%3D%20expr%20else%20%7B%20...%20%7D%60%20statements/near/246516047" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Boxy [she/her] <a href="https://rust-lang.github.io/zulip_archive/stream/213817-t-lang/topic/.60let.20pattern.20.3D.20expr.20else.20.7B.20.2E.2E.2E.20.7D.60.20statements.html#246516047">(Jul 19 2021 at 21:12)</a>:</h4>
<p>ah you got there before me lol</p>



<a name="246516263"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/%60let%20pattern%20%3D%20expr%20else%20%7B%20...%20%7D%60%20statements/near/246516263" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Cameron Steffen <a href="https://rust-lang.github.io/zulip_archive/stream/213817-t-lang/topic/.60let.20pattern.20.3D.20expr.20else.20.7B.20.2E.2E.2E.20.7D.60.20statements.html#246516263">(Jul 19 2021 at 21:14)</a>:</h4>
<p>I think that is a little more likely to be confused with <code>?</code> operator semantics.</p>



<a name="246516318"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/%60let%20pattern%20%3D%20expr%20else%20%7B%20...%20%7D%60%20statements/near/246516318" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Triplett <a href="https://rust-lang.github.io/zulip_archive/stream/213817-t-lang/topic/.60let.20pattern.20.3D.20expr.20else.20.7B.20.2E.2E.2E.20.7D.60.20statements.html#246516318">(Jul 19 2021 at 21:14)</a>:</h4>
<p><code>=?</code> makes sense. <em>Slightly</em> less natural in my opinion, since <code>?=</code> reads like "conditionally assign", while <code>=?</code> reads like "assign conditional", but avoids future ambiguity.</p>



<a name="246516519"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/%60let%20pattern%20%3D%20expr%20else%20%7B%20...%20%7D%60%20statements/near/246516519" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Triplett <a href="https://rust-lang.github.io/zulip_archive/stream/213817-t-lang/topic/.60let.20pattern.20.3D.20expr.20else.20.7B.20.2E.2E.2E.20.7D.60.20statements.html#246516519">(Jul 19 2021 at 21:15)</a>:</h4>
<p>I think it's less likely we would give <code>?</code> a meaning at the <em>start</em> of an expr rather than the <em>end</em> of a pat.</p>



<a name="246516887"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/%60let%20pattern%20%3D%20expr%20else%20%7B%20...%20%7D%60%20statements/near/246516887" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Cameron Steffen <a href="https://rust-lang.github.io/zulip_archive/stream/213817-t-lang/topic/.60let.20pattern.20.3D.20expr.20else.20.7B.20.2E.2E.2E.20.7D.60.20statements.html#246516887">(Jul 19 2021 at 21:18)</a>:</h4>
<p>I like <code>?=</code> a lot more. Can't really explain why. It seems quite unlikely to me we'd ever want <code>let Some(x)? =? y else</code>.</p>



<a name="246516961"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/%60let%20pattern%20%3D%20expr%20else%20%7B%20...%20%7D%60%20statements/near/246516961" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Triplett <a href="https://rust-lang.github.io/zulip_archive/stream/213817-t-lang/topic/.60let.20pattern.20.3D.20expr.20else.20.7B.20.2E.2E.2E.20.7D.60.20statements.html#246516961">(Jul 19 2021 at 21:19)</a>:</h4>
<p>I like <code>?=</code> more as well; I think it'd come down to how much we want to reserve <code>pat?</code>.</p>



<a name="246517142"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/%60let%20pattern%20%3D%20expr%20else%20%7B%20...%20%7D%60%20statements/near/246517142" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Triplett <a href="https://rust-lang.github.io/zulip_archive/stream/213817-t-lang/topic/.60let.20pattern.20.3D.20expr.20else.20.7B.20.2E.2E.2E.20.7D.60.20statements.html#246517142">(Jul 19 2021 at 21:21)</a>:</h4>
<p>We even have the <em>option</em> of allowing both to work and requiring <code>pat? =</code> if you mean to attach the <code>?</code> to the <code>pat</code>, and <code>pat ?=</code> if you're writing let-else.</p>



<a name="246517171"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/%60let%20pattern%20%3D%20expr%20else%20%7B%20...%20%7D%60%20statements/near/246517171" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Triplett <a href="https://rust-lang.github.io/zulip_archive/stream/213817-t-lang/topic/.60let.20pattern.20.3D.20expr.20else.20.7B.20.2E.2E.2E.20.7D.60.20statements.html#246517171">(Jul 19 2021 at 21:21)</a>:</h4>
<p>But in any case, future compatibility can be decided later in the process, as long as the implications are documented.</p>



<a name="246517184"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/%60let%20pattern%20%3D%20expr%20else%20%7B%20...%20%7D%60%20statements/near/246517184" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> bstrie <a href="https://rust-lang.github.io/zulip_archive/stream/213817-t-lang/topic/.60let.20pattern.20.3D.20expr.20else.20.7B.20.2E.2E.2E.20.7D.60.20statements.html#246517184">(Jul 19 2021 at 21:21)</a>:</h4>
<p>speaking purely from aesthetics I'm not extremely keen on just glomming together two sigils</p>



<a name="246517270"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/%60let%20pattern%20%3D%20expr%20else%20%7B%20...%20%7D%60%20statements/near/246517270" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Cameron Steffen <a href="https://rust-lang.github.io/zulip_archive/stream/213817-t-lang/topic/.60let.20pattern.20.3D.20expr.20else.20.7B.20.2E.2E.2E.20.7D.60.20statements.html#246517270">(Jul 19 2021 at 21:22)</a>:</h4>
<p>We already have operators like <code>+=</code></p>



<a name="246517292"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/%60let%20pattern%20%3D%20expr%20else%20%7B%20...%20%7D%60%20statements/near/246517292" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> bstrie <a href="https://rust-lang.github.io/zulip_archive/stream/213817-t-lang/topic/.60let.20pattern.20.3D.20expr.20else.20.7B.20.2E.2E.2E.20.7D.60.20statements.html#246517292">(Jul 19 2021 at 21:22)</a>:</h4>
<p>would it at least be generalizable to anything else? I see sigil syntax as having a higher conceptual cost than keyword syntax</p>



<a name="246517345"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/%60let%20pattern%20%3D%20expr%20else%20%7B%20...%20%7D%60%20statements/near/246517345" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Triplett <a href="https://rust-lang.github.io/zulip_archive/stream/213817-t-lang/topic/.60let.20pattern.20.3D.20expr.20else.20.7B.20.2E.2E.2E.20.7D.60.20statements.html#246517345">(Jul 19 2021 at 21:22)</a>:</h4>
<p><span class="user-mention silent" data-user-id="360405">Cameron Steffen</span> <a href="#narrow/stream/213817-t-lang/topic/.60let.20pattern.20.3D.20expr.20else.20.7B.20.2E.2E.2E.20.7D.60.20statements/near/246517270">said</a>:</p>
<blockquote>
<p>We already have operators like <code>+=</code></p>
</blockquote>
<p>We do, but that's a <em>downside</em>. That means one instinct might be to read <code>let x ?= expr ...</code> as <code>let x = x ? expr</code> (which doesn't mean anything, but...)</p>



<a name="246517375"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/%60let%20pattern%20%3D%20expr%20else%20%7B%20...%20%7D%60%20statements/near/246517375" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> bstrie <a href="https://rust-lang.github.io/zulip_archive/stream/213817-t-lang/topic/.60let.20pattern.20.3D.20expr.20else.20.7B.20.2E.2E.2E.20.7D.60.20statements.html#246517375">(Jul 19 2021 at 21:23)</a>:</h4>
<p>the binary ternary operator, clearly :P</p>



<a name="246517416"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/%60let%20pattern%20%3D%20expr%20else%20%7B%20...%20%7D%60%20statements/near/246517416" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Triplett <a href="https://rust-lang.github.io/zulip_archive/stream/213817-t-lang/topic/.60let.20pattern.20.3D.20expr.20else.20.7B.20.2E.2E.2E.20.7D.60.20statements.html#246517416">(Jul 19 2021 at 21:23)</a>:</h4>
<p>I personally still prefer <code>let pat = expr else { diverge };</code>. I just find <code>let pat ?= expr else { diverge };</code> the least objectionable alternative syntax mentioned thus far.</p>



<a name="246517484"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/%60let%20pattern%20%3D%20expr%20else%20%7B%20...%20%7D%60%20statements/near/246517484" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Triplett <a href="https://rust-lang.github.io/zulip_archive/stream/213817-t-lang/topic/.60let.20pattern.20.3D.20expr.20else.20.7B.20.2E.2E.2E.20.7D.60.20statements.html#246517484">(Jul 19 2021 at 21:24)</a>:</h4>
<p>I don't think "surprise else" will turn out to be a problem in practice.</p>



<a name="246517495"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/%60let%20pattern%20%3D%20expr%20else%20%7B%20...%20%7D%60%20statements/near/246517495" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Cameron Steffen <a href="https://rust-lang.github.io/zulip_archive/stream/213817-t-lang/topic/.60let.20pattern.20.3D.20expr.20else.20.7B.20.2E.2E.2E.20.7D.60.20statements.html#246517495">(Jul 19 2021 at 21:24)</a>:</h4>
<p>ship it.</p>



<a name="246517520"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/%60let%20pattern%20%3D%20expr%20else%20%7B%20...%20%7D%60%20statements/near/246517520" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Triplett <a href="https://rust-lang.github.io/zulip_archive/stream/213817-t-lang/topic/.60let.20pattern.20.3D.20expr.20else.20.7B.20.2E.2E.2E.20.7D.60.20statements.html#246517520">(Jul 19 2021 at 21:24)</a>:</h4>
<p><span class="user-mention silent" data-user-id="360405">Cameron Steffen</span> <a href="#narrow/stream/213817-t-lang/topic/.60let.20pattern.20.3D.20expr.20else.20.7B.20.2E.2E.2E.20.7D.60.20statements/near/246517495">said</a>:</p>
<blockquote>
<p>ship it.</p>
</blockquote>
<p>Which one? :)</p>



<a name="246517542"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/%60let%20pattern%20%3D%20expr%20else%20%7B%20...%20%7D%60%20statements/near/246517542" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> bstrie <a href="https://rust-lang.github.io/zulip_archive/stream/213817-t-lang/topic/.60let.20pattern.20.3D.20expr.20else.20.7B.20.2E.2E.2E.20.7D.60.20statements.html#246517542">(Jul 19 2021 at 21:25)</a>:</h4>
<p>presumably <code>expr</code> will not be extremely long in practice, but it would be nice to have real-world examples</p>



<a name="246517571"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/%60let%20pattern%20%3D%20expr%20else%20%7B%20...%20%7D%60%20statements/near/246517571" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Cameron Steffen <a href="https://rust-lang.github.io/zulip_archive/stream/213817-t-lang/topic/.60let.20pattern.20.3D.20expr.20else.20.7B.20.2E.2E.2E.20.7D.60.20statements.html#246517571">(Jul 19 2021 at 21:25)</a>:</h4>
<p><code>let else</code>. Sorry, got impatient for a moment <span aria-label="laughing" class="emoji emoji-1f606" role="img" title="laughing">:laughing:</span></p>



<a name="246517594"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/%60let%20pattern%20%3D%20expr%20else%20%7B%20...%20%7D%60%20statements/near/246517594" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> bstrie <a href="https://rust-lang.github.io/zulip_archive/stream/213817-t-lang/topic/.60let.20pattern.20.3D.20expr.20else.20.7B.20.2E.2E.2E.20.7D.60.20statements.html#246517594">(Jul 19 2021 at 21:25)</a>:</h4>
<p>you can even pull examples from if let, since this feature and if let are basically the dual of each other. so what's the longest expression you've seen in an if let?</p>



<a name="246517756"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/%60let%20pattern%20%3D%20expr%20else%20%7B%20...%20%7D%60%20statements/near/246517756" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Triplett <a href="https://rust-lang.github.io/zulip_archive/stream/213817-t-lang/topic/.60let.20pattern.20.3D.20expr.20else.20.7B.20.2E.2E.2E.20.7D.60.20statements.html#246517756">(Jul 19 2021 at 21:27)</a>:</h4>
<p>Here's an example from my own code:</p>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="n">service</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="kd">let</span><span class="w"> </span><span class="nb">Some</span><span class="p">(</span><span class="n">service</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">service</span><span class="p">.</span><span class="n">strip_prefix</span><span class="p">(</span><span class="s">"git-"</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">        </span><span class="n">service</span><span class="w"></span>
<span class="w">    </span><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">forbidden</span><span class="p">(</span><span class="s">"Unsupported service"</span><span class="p">);</span><span class="w"></span>
<span class="w">    </span><span class="p">};</span><span class="w"></span>
</code></pre></div>
<p>This would become:</p>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="nb">Some</span><span class="p">(</span><span class="n">service</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">service</span><span class="p">.</span><span class="n">strip_prefix</span><span class="p">(</span><span class="s">"git-"</span><span class="p">)</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">forbidden</span><span class="p">(</span><span class="s">"Unsupported service"</span><span class="p">);</span><span class="w"></span>
<span class="w">    </span><span class="p">};</span><span class="w"></span>
</code></pre></div>



<a name="246517993"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/%60let%20pattern%20%3D%20expr%20else%20%7B%20...%20%7D%60%20statements/near/246517993" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> bstrie <a href="https://rust-lang.github.io/zulip_archive/stream/213817-t-lang/topic/.60let.20pattern.20.3D.20expr.20else.20.7B.20.2E.2E.2E.20.7D.60.20statements.html#246517993">(Jul 19 2021 at 21:29)</a>:</h4>
<p>and this is what I mean when I say this scales down very well, it looks quite nice to me. it's scaling it up that's a little tricky, but maybe I should just stop fretting about that</p>



<a name="246518056"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/%60let%20pattern%20%3D%20expr%20else%20%7B%20...%20%7D%60%20statements/near/246518056" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Triplett <a href="https://rust-lang.github.io/zulip_archive/stream/213817-t-lang/topic/.60let.20pattern.20.3D.20expr.20else.20.7B.20.2E.2E.2E.20.7D.60.20statements.html#246518056">(Jul 19 2021 at 21:30)</a>:</h4>
<p>I think we have many things that don't "scale up" in the way you're describing, and that's normal.</p>



<a name="246518152"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/%60let%20pattern%20%3D%20expr%20else%20%7B%20...%20%7D%60%20statements/near/246518152" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> bstrie <a href="https://rust-lang.github.io/zulip_archive/stream/213817-t-lang/topic/.60let.20pattern.20.3D.20expr.20else.20.7B.20.2E.2E.2E.20.7D.60.20statements.html#246518152">(Jul 19 2021 at 21:30)</a>:</h4>
<p>yes, I'm rather paranoid about accidentally closing off future avenues of development :)</p>



<a name="246518168"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/%60let%20pattern%20%3D%20expr%20else%20%7B%20...%20%7D%60%20statements/near/246518168" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Triplett <a href="https://rust-lang.github.io/zulip_archive/stream/213817-t-lang/topic/.60let.20pattern.20.3D.20expr.20else.20.7B.20.2E.2E.2E.20.7D.60.20statements.html#246518168">(Jul 19 2021 at 21:30)</a>:</h4>
<p>For instance, functions don't scale to arbitrary numbers of parameters; you need to introduce a struct.</p>



<a name="246518243"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/%60let%20pattern%20%3D%20expr%20else%20%7B%20...%20%7D%60%20statements/near/246518243" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Triplett <a href="https://rust-lang.github.io/zulip_archive/stream/213817-t-lang/topic/.60let.20pattern.20.3D.20expr.20else.20.7B.20.2E.2E.2E.20.7D.60.20statements.html#246518243">(Jul 19 2021 at 21:31)</a>:</h4>
<p><code>if let</code> doesn't scale well to multiple patterns on the same expr, you should switch to <code>match</code>. (And on the other hand, it <em>does</em> scale well to doing things with <em>different</em> exprs.)</p>



<a name="246518438"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/%60let%20pattern%20%3D%20expr%20else%20%7B%20...%20%7D%60%20statements/near/246518438" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jacob Pratt <a href="https://rust-lang.github.io/zulip_archive/stream/213817-t-lang/topic/.60let.20pattern.20.3D.20expr.20else.20.7B.20.2E.2E.2E.20.7D.60.20statements.html#246518438">(Jul 19 2021 at 21:33)</a>:</h4>
<p>With the lengthy discussion about syntax, I'd just like to let it be known that I've no issue with the syntax as-is. It is clean, readable, and unambiguous. Just putting it out there because "nothing is wrong" people like myself generally don't participate in discussions like this.</p>



<a name="246519725"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/%60let%20pattern%20%3D%20expr%20else%20%7B%20...%20%7D%60%20statements/near/246519725" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Triplett <a href="https://rust-lang.github.io/zulip_archive/stream/213817-t-lang/topic/.60let.20pattern.20.3D.20expr.20else.20.7B.20.2E.2E.2E.20.7D.60.20statements.html#246519725">(Jul 19 2021 at 21:47)</a>:</h4>
<p><span class="user-mention" data-user-id="245610">@Jacob Pratt</span> Huge appreciation for taking the time to avert that.</p>



<a name="246520175"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/%60let%20pattern%20%3D%20expr%20else%20%7B%20...%20%7D%60%20statements/near/246520175" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Cameron Steffen <a href="https://rust-lang.github.io/zulip_archive/stream/213817-t-lang/topic/.60let.20pattern.20.3D.20expr.20else.20.7B.20.2E.2E.2E.20.7D.60.20statements.html#246520175">(Jul 19 2021 at 21:53)</a>:</h4>
<p>If we're closing in on the current RFC, are there any action items before merging?</p>



<a name="246521540"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/%60let%20pattern%20%3D%20expr%20else%20%7B%20...%20%7D%60%20statements/near/246521540" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Triplett <a href="https://rust-lang.github.io/zulip_archive/stream/213817-t-lang/topic/.60let.20pattern.20.3D.20expr.20else.20.7B.20.2E.2E.2E.20.7D.60.20statements.html#246521540">(Jul 19 2021 at 22:08)</a>:</h4>
<p><span class="user-mention silent" data-user-id="360405">Cameron Steffen</span> <a href="#narrow/stream/213817-t-lang/topic/.60let.20pattern.20.3D.20expr.20else.20.7B.20.2E.2E.2E.20.7D.60.20statements/near/246520175">said</a>:</p>
<blockquote>
<p>If we're closing in on the current RFC, are there any action items before merging?</p>
</blockquote>
<p>I think <span class="user-mention" data-user-id="123586">@nagisa</span> is interested in making sure that the grammar is clear.</p>



<a name="246521824"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/%60let%20pattern%20%3D%20expr%20else%20%7B%20...%20%7D%60%20statements/near/246521824" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Triplett <a href="https://rust-lang.github.io/zulip_archive/stream/213817-t-lang/topic/.60let.20pattern.20.3D.20expr.20else.20.7B.20.2E.2E.2E.20.7D.60.20statements.html#246521824">(Jul 19 2021 at 22:11)</a>:</h4>
<p>That's the only thing that I think needs to be addressed, either by improving the RFC or by deciding it's precise enough for implementation work.</p>



<a name="246522619"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/%60let%20pattern%20%3D%20expr%20else%20%7B%20...%20%7D%60%20statements/near/246522619" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Mario Carneiro <a href="https://rust-lang.github.io/zulip_archive/stream/213817-t-lang/topic/.60let.20pattern.20.3D.20expr.20else.20.7B.20.2E.2E.2E.20.7D.60.20statements.html#246522619">(Jul 19 2021 at 22:20)</a>:</h4>
<p><span class="user-mention silent" data-user-id="239881">Josh Triplett</span> <a href="#narrow/stream/213817-t-lang/topic/.60let.20pattern.20.3D.20expr.20else.20.7B.20.2E.2E.2E.20.7D.60.20statements/near/245907347">said</a>:</p>
<blockquote>
<p>I like the suggested change of <code>1. May not end with a `}` unless this brace is the terminating brace of a [`BlockExpression`][block-expr].</code>.</p>
</blockquote>
<p>Regarding the grammar question, if we're ditching the exception for blocks then this can be stated even more simply:</p>
<div class="codehilite"><pre><span></span><code>1. May not end with a `}`.
</code></pre></div>
<p>Restriction 2, about no lazy boolean ops at the top level, remains as is, and restriction 1 is not expressed through some convoluted <code>EXPRESSION-NOT-ENDING-IN-BRACE</code> nonterminal because that is not easy to read and not how it would be implemented anyway.</p>



<a name="246523297"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/%60let%20pattern%20%3D%20expr%20else%20%7B%20...%20%7D%60%20statements/near/246523297" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Mario Carneiro <a href="https://rust-lang.github.io/zulip_archive/stream/213817-t-lang/topic/.60let.20pattern.20.3D.20expr.20else.20.7B.20.2E.2E.2E.20.7D.60.20statements.html#246523297">(Jul 19 2021 at 22:28)</a>:</h4>
<p>It might be helpful to specify that restriction 1 applies after macro expansion by descending into the right child of prefix and infix operators, and failing if the first other expr constructor we find is a block-like expression. (Actually, the prose spec there probably needs an exception to handle invisible grouping, because <code>&lt;{ e }&gt;</code> is supposed to count as not ending in a brace even though the last physical token is <code>}</code>.)</p>



<a name="246527928"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/%60let%20pattern%20%3D%20expr%20else%20%7B%20...%20%7D%60%20statements/near/246527928" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Frank Steffahn <a href="https://rust-lang.github.io/zulip_archive/stream/213817-t-lang/topic/.60let.20pattern.20.3D.20expr.20else.20.7B.20.2E.2E.2E.20.7D.60.20statements.html#246527928">(Jul 19 2021 at 23:30)</a>:</h4>
<p>A macro call expression <code>foo!{bar}</code> can end in a brace as well. So I'm not sure if “after macro expansion” works too well for detecting this.</p>



<a name="246528809"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/%60let%20pattern%20%3D%20expr%20else%20%7B%20...%20%7D%60%20statements/near/246528809" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jeremiah Senkpiel <a href="https://rust-lang.github.io/zulip_archive/stream/213817-t-lang/topic/.60let.20pattern.20.3D.20expr.20else.20.7B.20.2E.2E.2E.20.7D.60.20statements.html#246528809">(Jul 19 2021 at 23:46)</a>:</h4>
<p>I don't think that <code>macro!{ } else { }</code> is ever confusable though?</p>



<a name="246530210"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/%60let%20pattern%20%3D%20expr%20else%20%7B%20...%20%7D%60%20statements/near/246530210" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jeremiah Senkpiel <a href="https://rust-lang.github.io/zulip_archive/stream/213817-t-lang/topic/.60let.20pattern.20.3D.20expr.20else.20.7B.20.2E.2E.2E.20.7D.60.20statements.html#246530210">(Jul 20 2021 at 00:10)</a>:</h4>
<p>Also, this was a lot to catch up on. Uhh...</p>
<ul>
<li>In regards to if-let-chains, If we _really_ wanted interoperability there I think that extending <code>||</code> syntax would be better than let-else.</li>
<li>In regards to <code>unless bool { ... }</code> I agree also that <code>if !x { ... }</code> doesn't read as easily as I'd hope but that seems a bit separate.</li>
<li>I mention in the RFC that currently only <code>let</code> makes local bindings in scope, which people have brought up in regards to <code>unless let</code>.</li>
<li>I hope we can just settle of disallowing the expression to end in <code>}</code> _before_ macro expansion and be done with it.</li>
</ul>



<a name="246531562"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/%60let%20pattern%20%3D%20expr%20else%20%7B%20...%20%7D%60%20statements/near/246531562" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jacob Lifshay <a href="https://rust-lang.github.io/zulip_archive/stream/213817-t-lang/topic/.60let.20pattern.20.3D.20expr.20else.20.7B.20.2E.2E.2E.20.7D.60.20statements.html#246531562">(Jul 20 2021 at 00:30)</a>:</h4>
<p><span class="user-mention silent" data-user-id="319552">Jeremiah Senkpiel</span> <a href="#narrow/stream/213817-t-lang/topic/.60let.20pattern.20.3D.20expr.20else.20.7B.20.2E.2E.2E.20.7D.60.20statements/near/246530210">said</a>:</p>
<blockquote>
<ul>
<li>I hope we can just settle of disallowing the expression to end in <code>}</code> _before_ macro expansion and be done with it.</li>
</ul>
</blockquote>
<p>Sounds good, as long as the mechanism for disallowing ending in <code>}</code> is a lint that can be disabled, since it would be handy to be able to compile the output of <code>cargo expand</code> if a macro happened to expand to something ending in <code>}</code>. if it were a hard error the generated code would require manual editing to compile.</p>



<a name="246531796"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/%60let%20pattern%20%3D%20expr%20else%20%7B%20...%20%7D%60%20statements/near/246531796" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Mario Carneiro <a href="https://rust-lang.github.io/zulip_archive/stream/213817-t-lang/topic/.60let.20pattern.20.3D.20expr.20else.20.7B.20.2E.2E.2E.20.7D.60.20statements.html#246531796">(Jul 20 2021 at 00:35)</a>:</h4>
<p>ah, that's already a problem with the post-macro expansion version I mentioned, because macros can introduce invisible grouping, and printing and re-parsing that would cause the grouping to go away, resulting in a bad expression. I think this issue is not limited to let-else</p>



<a name="246532057"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/%60let%20pattern%20%3D%20expr%20else%20%7B%20...%20%7D%60%20statements/near/246532057" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Mario Carneiro <a href="https://rust-lang.github.io/zulip_archive/stream/213817-t-lang/topic/.60let.20pattern.20.3D.20expr.20else.20.7B.20.2E.2E.2E.20.7D.60.20statements.html#246532057">(Jul 20 2021 at 00:40)</a>:</h4>
<p>...or not? <code>cargo expand</code> is smarter than I gave it credit for</p>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="k">fn</span> <span class="nf">main</span><span class="p">()</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="k">struct</span> <span class="nc">Foo</span><span class="w"> </span><span class="p">{}</span><span class="w"></span>
<span class="w">    </span><span class="fm">macro_rules!</span><span class="w"> </span><span class="n">foo</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="p">(</span><span class="cp">$e</span>:<span class="nc">expr</span><span class="p">)</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="p">{</span><span class="cp">$e</span><span class="p">}</span><span class="w"> </span><span class="p">}</span><span class="w"></span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="kd">let</span><span class="w"> </span><span class="n">Foo</span><span class="w"> </span><span class="p">{}</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">foo</span><span class="o">!</span><span class="p">(</span><span class="n">Foo</span><span class="w"> </span><span class="p">{})</span><span class="w"> </span><span class="p">{}</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>
</code></pre></div>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="c1">// cargo expand</span>
<span class="cp">#![feature(prelude_import)]</span><span class="w"></span>
<span class="cp">#[prelude_import]</span><span class="w"></span>
<span class="k">use</span><span class="w"> </span><span class="n">std</span>::<span class="n">prelude</span>::<span class="n">rust_2018</span>::<span class="o">*</span><span class="p">;</span><span class="w"></span>
<span class="cp">#[macro_use]</span><span class="w"></span>
<span class="k">extern</span><span class="w"> </span><span class="k">crate</span><span class="w"> </span><span class="n">std</span><span class="p">;</span><span class="w"></span>
<span class="k">fn</span> <span class="nf">main</span><span class="p">()</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="k">struct</span> <span class="nc">Foo</span><span class="w"> </span><span class="p">{}</span><span class="w"></span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="kd">let</span><span class="w"> </span><span class="n">Foo</span><span class="w"> </span><span class="p">{}</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="n">Foo</span><span class="w"> </span><span class="p">{})</span><span class="w"> </span><span class="p">{}</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>
</code></pre></div>



<a name="246532082"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/%60let%20pattern%20%3D%20expr%20else%20%7B%20...%20%7D%60%20statements/near/246532082" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Mario Carneiro <a href="https://rust-lang.github.io/zulip_archive/stream/213817-t-lang/topic/.60let.20pattern.20.3D.20expr.20else.20.7B.20.2E.2E.2E.20.7D.60.20statements.html#246532082">(Jul 20 2021 at 00:41)</a>:</h4>
<p>I don't know what voodoo magic is being used to make this work, but maybe <code>let .. else</code> could borrow a bit of it to make it insert parentheses when needed</p>



<a name="246532148"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/%60let%20pattern%20%3D%20expr%20else%20%7B%20...%20%7D%60%20statements/near/246532148" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jacob Lifshay <a href="https://rust-lang.github.io/zulip_archive/stream/213817-t-lang/topic/.60let.20pattern.20.3D.20expr.20else.20.7B.20.2E.2E.2E.20.7D.60.20statements.html#246532148">(Jul 20 2021 at 00:43)</a>:</h4>
<p>cargo expand is smarter than expected :)</p>



<a name="246532258"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/%60let%20pattern%20%3D%20expr%20else%20%7B%20...%20%7D%60%20statements/near/246532258" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Mario Carneiro <a href="https://rust-lang.github.io/zulip_archive/stream/213817-t-lang/topic/.60let.20pattern.20.3D.20expr.20else.20.7B.20.2E.2E.2E.20.7D.60.20statements.html#246532258">(Jul 20 2021 at 00:46)</a>:</h4>
<p>although, I can't compile the output of cargo expand anyway because of the first line</p>



<a name="246535431"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/%60let%20pattern%20%3D%20expr%20else%20%7B%20...%20%7D%60%20statements/near/246535431" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jacob Lifshay <a href="https://rust-lang.github.io/zulip_archive/stream/213817-t-lang/topic/.60let.20pattern.20.3D.20expr.20else.20.7B.20.2E.2E.2E.20.7D.60.20statements.html#246535431">(Jul 20 2021 at 01:30)</a>:</h4>
<p>just use <code>cargo +nightly</code> :)</p>



<a name="246540358"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/%60let%20pattern%20%3D%20expr%20else%20%7B%20...%20%7D%60%20statements/near/246540358" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Cameron Steffen <a href="https://rust-lang.github.io/zulip_archive/stream/213817-t-lang/topic/.60let.20pattern.20.3D.20expr.20else.20.7B.20.2E.2E.2E.20.7D.60.20statements.html#246540358">(Jul 20 2021 at 03:07)</a>:</h4>
<p>the parenthesis are only added for pretty-printing IIUC</p>



<a name="246613011"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/%60let%20pattern%20%3D%20expr%20else%20%7B%20...%20%7D%60%20statements/near/246613011" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jeremiah Senkpiel <a href="https://rust-lang.github.io/zulip_archive/stream/213817-t-lang/topic/.60let.20pattern.20.3D.20expr.20else.20.7B.20.2E.2E.2E.20.7D.60.20statements.html#246613011">(Jul 20 2021 at 16:11)</a>:</h4>
<p>IMO <code>cargo-expand</code> should just be smart enough to put parenthesis there then...</p>



<a name="246644564"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/%60let%20pattern%20%3D%20expr%20else%20%7B%20...%20%7D%60%20statements/near/246644564" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Cameron Steffen <a href="https://rust-lang.github.io/zulip_archive/stream/213817-t-lang/topic/.60let.20pattern.20.3D.20expr.20else.20.7B.20.2E.2E.2E.20.7D.60.20statements.html#246644564">(Jul 20 2021 at 20:24)</a>:</h4>
<p>Yeah, I think you can say that the <code>} else</code> restriction is pre-expansion and <code>macro! {} else</code> is fine.</p>



<a name="246644642"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/%60let%20pattern%20%3D%20expr%20else%20%7B%20...%20%7D%60%20statements/near/246644642" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Triplett <a href="https://rust-lang.github.io/zulip_archive/stream/213817-t-lang/topic/.60let.20pattern.20.3D.20expr.20else.20.7B.20.2E.2E.2E.20.7D.60.20statements.html#246644642">(Jul 20 2021 at 20:24)</a>:</h4>
<p>Do you mean that <code>macro!() else</code> with the macro expanding to end in <code>}</code> is fine?</p>



<a name="246644671"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/%60let%20pattern%20%3D%20expr%20else%20%7B%20...%20%7D%60%20statements/near/246644671" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Triplett <a href="https://rust-lang.github.io/zulip_archive/stream/213817-t-lang/topic/.60let.20pattern.20.3D.20expr.20else.20.7B.20.2E.2E.2E.20.7D.60.20statements.html#246644671">(Jul 20 2021 at 20:25)</a>:</h4>
<p>Or do you actually mean that <code>macro! {} else</code> should be fine too?</p>



<a name="246644721"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/%60let%20pattern%20%3D%20expr%20else%20%7B%20...%20%7D%60%20statements/near/246644721" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Cameron Steffen <a href="https://rust-lang.github.io/zulip_archive/stream/213817-t-lang/topic/.60let.20pattern.20.3D.20expr.20else.20.7B.20.2E.2E.2E.20.7D.60.20statements.html#246644721">(Jul 20 2021 at 20:25)</a>:</h4>
<p>the latter</p>



<a name="246644847"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/%60let%20pattern%20%3D%20expr%20else%20%7B%20...%20%7D%60%20statements/near/246644847" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Mario Carneiro <a href="https://rust-lang.github.io/zulip_archive/stream/213817-t-lang/topic/.60let.20pattern.20.3D.20expr.20else.20.7B.20.2E.2E.2E.20.7D.60.20statements.html#246644847">(Jul 20 2021 at 20:26)</a>:</h4>
<p>Why would that be fine? It clearly ends in a <code>}</code> pre-expansion</p>



<a name="246644905"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/%60let%20pattern%20%3D%20expr%20else%20%7B%20...%20%7D%60%20statements/near/246644905" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Cameron Steffen <a href="https://rust-lang.github.io/zulip_archive/stream/213817-t-lang/topic/.60let.20pattern.20.3D.20expr.20else.20.7B.20.2E.2E.2E.20.7D.60.20statements.html#246644905">(Jul 20 2021 at 20:27)</a>:</h4>
<p>Well I suppose it's debatable. I'd make it an exception in addition to blocks.</p>



<a name="246644952"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/%60let%20pattern%20%3D%20expr%20else%20%7B%20...%20%7D%60%20statements/near/246644952" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Mario Carneiro <a href="https://rust-lang.github.io/zulip_archive/stream/213817-t-lang/topic/.60let.20pattern.20.3D.20expr.20else.20.7B.20.2E.2E.2E.20.7D.60.20statements.html#246644952">(Jul 20 2021 at 20:27)</a>:</h4>
<p>I think the latest is that the exception for blocks is dropped</p>



<a name="246645078"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/%60let%20pattern%20%3D%20expr%20else%20%7B%20...%20%7D%60%20statements/near/246645078" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Triplett <a href="https://rust-lang.github.io/zulip_archive/stream/213817-t-lang/topic/.60let.20pattern.20.3D.20expr.20else.20.7B.20.2E.2E.2E.20.7D.60.20statements.html#246645078">(Jul 20 2021 at 20:28)</a>:</h4>
<p>On that note...</p>



<a name="246645127"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/%60let%20pattern%20%3D%20expr%20else%20%7B%20...%20%7D%60%20statements/near/246645127" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Triplett <a href="https://rust-lang.github.io/zulip_archive/stream/213817-t-lang/topic/.60let.20pattern.20.3D.20expr.20else.20.7B.20.2E.2E.2E.20.7D.60.20statements.html#246645127">(Jul 20 2021 at 20:29)</a>:</h4>
<p><span class="user-mention" data-user-id="319552">@Jeremiah Senkpiel</span> I'm currently gearing up to merge the RFC. However, if there's further grammar work you'd like to see happen before it gets merged, I'm happy to wait.</p>



<a name="246645236"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/%60let%20pattern%20%3D%20expr%20else%20%7B%20...%20%7D%60%20statements/near/246645236" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Cameron Steffen <a href="https://rust-lang.github.io/zulip_archive/stream/213817-t-lang/topic/.60let.20pattern.20.3D.20expr.20else.20.7B.20.2E.2E.2E.20.7D.60.20statements.html#246645236">(Jul 20 2021 at 20:29)</a>:</h4>
<p>oh I didn't catch that</p>



<a name="246645377"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/%60let%20pattern%20%3D%20expr%20else%20%7B%20...%20%7D%60%20statements/near/246645377" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Mario Carneiro <a href="https://rust-lang.github.io/zulip_archive/stream/213817-t-lang/topic/.60let.20pattern.20.3D.20expr.20else.20.7B.20.2E.2E.2E.20.7D.60.20statements.html#246645377">(Jul 20 2021 at 20:30)</a>:</h4>
<p>the rationale is that if you see <code>let .... &lt;many lines&gt; } else { .... };</code> you can know that it's actually an if statement</p>



<a name="246645678"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/%60let%20pattern%20%3D%20expr%20else%20%7B%20...%20%7D%60%20statements/near/246645678" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Mario Carneiro <a href="https://rust-lang.github.io/zulip_archive/stream/213817-t-lang/topic/.60let.20pattern.20.3D.20expr.20else.20.7B.20.2E.2E.2E.20.7D.60.20statements.html#246645678">(Jul 20 2021 at 20:33)</a>:</h4>
<p>the recommended style for blocks in let-else is e.g.</p>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="kd">let</span><span class="w"> </span><span class="nb">Some</span><span class="p">(</span><span class="n">x</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">({</span><span class="w"></span>
<span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="n">y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="p">;</span><span class="w"></span>
<span class="w">    </span><span class="nb">Some</span><span class="p">(</span><span class="n">y</span><span class="p">)</span><span class="w"></span>
<span class="p">})</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="k">return</span><span class="w"></span>
<span class="p">};</span><span class="w"></span>
</code></pre></div>



<a name="246645832"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/%60let%20pattern%20%3D%20expr%20else%20%7B%20...%20%7D%60%20statements/near/246645832" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Cameron Steffen <a href="https://rust-lang.github.io/zulip_archive/stream/213817-t-lang/topic/.60let.20pattern.20.3D.20expr.20else.20.7B.20.2E.2E.2E.20.7D.60.20statements.html#246645832">(Jul 20 2021 at 20:34)</a>:</h4>
<p>Hm, I don't really like that, and I think indentation would be clear enough, but okay.</p>



<a name="246645869"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/%60let%20pattern%20%3D%20expr%20else%20%7B%20...%20%7D%60%20statements/near/246645869" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Mario Carneiro <a href="https://rust-lang.github.io/zulip_archive/stream/213817-t-lang/topic/.60let.20pattern.20.3D.20expr.20else.20.7B.20.2E.2E.2E.20.7D.60.20statements.html#246645869">(Jul 20 2021 at 20:34)</a>:</h4>
<p>the point is that we <em>don't</em> want it to look just like an if-else</p>



<a name="246645925"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/%60let%20pattern%20%3D%20expr%20else%20%7B%20...%20%7D%60%20statements/near/246645925" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Triplett <a href="https://rust-lang.github.io/zulip_archive/stream/213817-t-lang/topic/.60let.20pattern.20.3D.20expr.20else.20.7B.20.2E.2E.2E.20.7D.60.20statements.html#246645925">(Jul 20 2021 at 20:35)</a>:</h4>
<p>Also, this is forward-compatible, in that if we discover during experimentation that this is onerous and people <em>want</em> braced blocks, that's easy enough to change.</p>



<a name="246645946"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/%60let%20pattern%20%3D%20expr%20else%20%7B%20...%20%7D%60%20statements/near/246645946" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Cameron Steffen <a href="https://rust-lang.github.io/zulip_archive/stream/213817-t-lang/topic/.60let.20pattern.20.3D.20expr.20else.20.7B.20.2E.2E.2E.20.7D.60.20statements.html#246645946">(Jul 20 2021 at 20:35)</a>:</h4>
<p>fair enough</p>



<a name="246646009"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/%60let%20pattern%20%3D%20expr%20else%20%7B%20...%20%7D%60%20statements/near/246646009" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Triplett <a href="https://rust-lang.github.io/zulip_archive/stream/213817-t-lang/topic/.60let.20pattern.20.3D.20expr.20else.20.7B.20.2E.2E.2E.20.7D.60.20statements.html#246646009">(Jul 20 2021 at 20:35)</a>:</h4>
<p>I think this also augurs for "use this with simple exprs".</p>



<a name="246646153"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/%60let%20pattern%20%3D%20expr%20else%20%7B%20...%20%7D%60%20statements/near/246646153" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Triplett <a href="https://rust-lang.github.io/zulip_archive/stream/213817-t-lang/topic/.60let.20pattern.20.3D.20expr.20else.20.7B.20.2E.2E.2E.20.7D.60.20statements.html#246646153">(Jul 20 2021 at 20:36)</a>:</h4>
<p>If you're having to write <code>let pat = ({ complex block }) else { ... };</code>, I personally think the code will almost always be improved by:</p>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="kd">let</span><span class="w"> </span><span class="n">some_name</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">complex</span><span class="w"> </span><span class="n">block</span><span class="w"> </span><span class="p">};</span><span class="w"></span>
<span class="kd">let</span><span class="w"> </span><span class="n">pat</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">some_name</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="o">..</span><span class="p">.</span><span class="w"> </span><span class="p">};</span><span class="w"></span>
</code></pre></div>



<a name="246646175"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/%60let%20pattern%20%3D%20expr%20else%20%7B%20...%20%7D%60%20statements/near/246646175" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Cameron Steffen <a href="https://rust-lang.github.io/zulip_archive/stream/213817-t-lang/topic/.60let.20pattern.20.3D.20expr.20else.20.7B.20.2E.2E.2E.20.7D.60.20statements.html#246646175">(Jul 20 2021 at 20:37)</a>:</h4>
<p>yep, I'm convinced!</p>



<a name="246646371"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/%60let%20pattern%20%3D%20expr%20else%20%7B%20...%20%7D%60%20statements/near/246646371" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Cameron Steffen <a href="https://rust-lang.github.io/zulip_archive/stream/213817-t-lang/topic/.60let.20pattern.20.3D.20expr.20else.20.7B.20.2E.2E.2E.20.7D.60.20statements.html#246646371">(Jul 20 2021 at 20:38)</a>:</h4>
<p>I was imagining blocks would be somewhat common, but on second thought they shouldn't be</p>



<a name="246647457"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/%60let%20pattern%20%3D%20expr%20else%20%7B%20...%20%7D%60%20statements/near/246647457" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jeremiah Senkpiel <a href="https://rust-lang.github.io/zulip_archive/stream/213817-t-lang/topic/.60let.20pattern.20.3D.20expr.20else.20.7B.20.2E.2E.2E.20.7D.60.20statements.html#246647457">(Jul 20 2021 at 20:48)</a>:</h4>
<p><span class="user-mention" data-user-id="239881">@Josh Triplett</span> Yes, I am going to make that last change to specify that everything ending with a <code>}</code>. Hopefully today. I should have time.</p>



<a name="246647585"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/%60let%20pattern%20%3D%20expr%20else%20%7B%20...%20%7D%60%20statements/near/246647585" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Triplett <a href="https://rust-lang.github.io/zulip_archive/stream/213817-t-lang/topic/.60let.20pattern.20.3D.20expr.20else.20.7B.20.2E.2E.2E.20.7D.60.20statements.html#246647585">(Jul 20 2021 at 20:49)</a>:</h4>
<p>Sounds great. Let me know when that's ready, and then I'll merge.</p>



<a name="246648045"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/%60let%20pattern%20%3D%20expr%20else%20%7B%20...%20%7D%60%20statements/near/246648045" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Cameron Steffen <a href="https://rust-lang.github.io/zulip_archive/stream/213817-t-lang/topic/.60let.20pattern.20.3D.20expr.20else.20.7B.20.2E.2E.2E.20.7D.60.20statements.html#246648045">(Jul 20 2021 at 20:53)</a>:</h4>
<p>Do we need to coordinate with rustfmt?</p>



<a name="246650953"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/%60let%20pattern%20%3D%20expr%20else%20%7B%20...%20%7D%60%20statements/near/246650953" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Triplett <a href="https://rust-lang.github.io/zulip_archive/stream/213817-t-lang/topic/.60let.20pattern.20.3D.20expr.20else.20.7B.20.2E.2E.2E.20.7D.60.20statements.html#246650953">(Jul 20 2021 at 21:08)</a>:</h4>
<p>I think we should. Not before merging, but we should coordinate.</p>



<a name="246651065"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/%60let%20pattern%20%3D%20expr%20else%20%7B%20...%20%7D%60%20statements/near/246651065" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Triplett <a href="https://rust-lang.github.io/zulip_archive/stream/213817-t-lang/topic/.60let.20pattern.20.3D.20expr.20else.20.7B.20.2E.2E.2E.20.7D.60.20statements.html#246651065">(Jul 20 2021 at 21:09)</a>:</h4>
<p>I think this <em>mostly</em> should follow existing formatting guidelines: break after <code>{</code> unless the whole thing fits on one line <em>and</em> isn't multiple statements.</p>



<a name="246651134"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/%60let%20pattern%20%3D%20expr%20else%20%7B%20...%20%7D%60%20statements/near/246651134" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Triplett <a href="https://rust-lang.github.io/zulip_archive/stream/213817-t-lang/topic/.60let.20pattern.20.3D.20expr.20else.20.7B.20.2E.2E.2E.20.7D.60.20statements.html#246651134">(Jul 20 2021 at 21:09)</a>:</h4>
<p>But I think there's a useful distinction to be made there...</p>



<a name="246651247"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/%60let%20pattern%20%3D%20expr%20else%20%7B%20...%20%7D%60%20statements/near/246651247" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Triplett <a href="https://rust-lang.github.io/zulip_archive/stream/213817-t-lang/topic/.60let.20pattern.20.3D.20expr.20else.20.7B.20.2E.2E.2E.20.7D.60.20statements.html#246651247">(Jul 20 2021 at 21:10)</a>:</h4>
<p>The style guide says that a braced block can only go on one line if it's an expression rather than a statement.</p>



<a name="246651286"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/%60let%20pattern%20%3D%20expr%20else%20%7B%20...%20%7D%60%20statements/near/246651286" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Triplett <a href="https://rust-lang.github.io/zulip_archive/stream/213817-t-lang/topic/.60let.20pattern.20.3D.20expr.20else.20.7B.20.2E.2E.2E.20.7D.60.20statements.html#246651286">(Jul 20 2021 at 21:10)</a>:</h4>
<p>In general, these diverging blocks will often be <em>effectively</em> a statement, in that they don't produce a meaningful value. They may or may not end with a semicolon.</p>



<a name="246651331"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/%60let%20pattern%20%3D%20expr%20else%20%7B%20...%20%7D%60%20statements/near/246651331" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Triplett <a href="https://rust-lang.github.io/zulip_archive/stream/213817-t-lang/topic/.60let.20pattern.20.3D.20expr.20else.20.7B.20.2E.2E.2E.20.7D.60.20statements.html#246651331">(Jul 20 2021 at 21:10)</a>:</h4>
<p>Do we want to allow <code>let simple_pat = simple_expr else { return simple_value; };</code>?</p>



<a name="246651363"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/%60let%20pattern%20%3D%20expr%20else%20%7B%20...%20%7D%60%20statements/near/246651363" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Triplett <a href="https://rust-lang.github.io/zulip_archive/stream/213817-t-lang/topic/.60let.20pattern.20.3D.20expr.20else.20.7B.20.2E.2E.2E.20.7D.60.20statements.html#246651363">(Jul 20 2021 at 21:11)</a>:</h4>
<p>Or should we require that to use three lines (newline after <code>{</code> and after <code>return simple_value;</code>)?</p>



<a name="246651379"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/%60let%20pattern%20%3D%20expr%20else%20%7B%20...%20%7D%60%20statements/near/246651379" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Triplett <a href="https://rust-lang.github.io/zulip_archive/stream/213817-t-lang/topic/.60let.20pattern.20.3D.20expr.20else.20.7B.20.2E.2E.2E.20.7D.60.20statements.html#246651379">(Jul 20 2021 at 21:11)</a>:</h4>
<p>I personally think we should require three lines there.</p>



<a name="246651481"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/%60let%20pattern%20%3D%20expr%20else%20%7B%20...%20%7D%60%20statements/near/246651481" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Triplett <a href="https://rust-lang.github.io/zulip_archive/stream/213817-t-lang/topic/.60let.20pattern.20.3D.20expr.20else.20.7B.20.2E.2E.2E.20.7D.60.20statements.html#246651481">(Jul 20 2021 at 21:12)</a>:</h4>
<p>The same question applies to <code>yeet e;</code>, or <code>Err(e)?;</code> (assuming the compiler understands that to always diverge), or <code>panic!("...");</code>.</p>



<a name="246651503"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/%60let%20pattern%20%3D%20expr%20else%20%7B%20...%20%7D%60%20statements/near/246651503" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Triplett <a href="https://rust-lang.github.io/zulip_archive/stream/213817-t-lang/topic/.60let.20pattern.20.3D.20expr.20else.20.7B.20.2E.2E.2E.20.7D.60.20statements.html#246651503">(Jul 20 2021 at 21:12)</a>:</h4>
<p>I <em>think</em> we want those to always get a line of their own, because control flow.</p>



<a name="246651519"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/%60let%20pattern%20%3D%20expr%20else%20%7B%20...%20%7D%60%20statements/near/246651519" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Triplett <a href="https://rust-lang.github.io/zulip_archive/stream/213817-t-lang/topic/.60let.20pattern.20.3D.20expr.20else.20.7B.20.2E.2E.2E.20.7D.60.20statements.html#246651519">(Jul 20 2021 at 21:12)</a>:</h4>
<p>Thoughts?</p>



<a name="246657012"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/%60let%20pattern%20%3D%20expr%20else%20%7B%20...%20%7D%60%20statements/near/246657012" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Mario Carneiro <a href="https://rust-lang.github.io/zulip_archive/stream/213817-t-lang/topic/.60let.20pattern.20.3D.20expr.20else.20.7B.20.2E.2E.2E.20.7D.60.20statements.html#246657012">(Jul 20 2021 at 22:04)</a>:</h4>
<p>what about suppressing the semicolon when used in one line style? It should never be needed since it's a diverging expression, and the back to back semicolons look weird.</p>



<a name="246657210"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/%60let%20pattern%20%3D%20expr%20else%20%7B%20...%20%7D%60%20statements/near/246657210" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Mario Carneiro <a href="https://rust-lang.github.io/zulip_archive/stream/213817-t-lang/topic/.60let.20pattern.20.3D.20expr.20else.20.7B.20.2E.2E.2E.20.7D.60.20statements.html#246657210">(Jul 20 2021 at 22:06)</a>:</h4>
<p>I'm strongly against requiring three lines for even simple let-else, but I don't use rustfmt for reasons like this anyway</p>



<a name="246657298"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/%60let%20pattern%20%3D%20expr%20else%20%7B%20...%20%7D%60%20statements/near/246657298" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> bstrie <a href="https://rust-lang.github.io/zulip_archive/stream/213817-t-lang/topic/.60let.20pattern.20.3D.20expr.20else.20.7B.20.2E.2E.2E.20.7D.60.20statements.html#246657298">(Jul 20 2021 at 22:07)</a>:</h4>
<p>you don't need the semicolon after the <code>return</code>, you can omit it</p>



<a name="246657363"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/%60let%20pattern%20%3D%20expr%20else%20%7B%20...%20%7D%60%20statements/near/246657363" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> bstrie <a href="https://rust-lang.github.io/zulip_archive/stream/213817-t-lang/topic/.60let.20pattern.20.3D.20expr.20else.20.7B.20.2E.2E.2E.20.7D.60.20statements.html#246657363">(Jul 20 2021 at 22:08)</a>:</h4>
<p>by which I mean you don't need it today. <code>fn main() { return () }</code> is valid</p>



<a name="246657377"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/%60let%20pattern%20%3D%20expr%20else%20%7B%20...%20%7D%60%20statements/near/246657377" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Mario Carneiro <a href="https://rust-lang.github.io/zulip_archive/stream/213817-t-lang/topic/.60let.20pattern.20.3D.20expr.20else.20.7B.20.2E.2E.2E.20.7D.60.20statements.html#246657377">(Jul 20 2021 at 22:08)</a>:</h4>
<p>I think a recent clippy lint has been encouraging semicolons everywhere</p>



<a name="246657422"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/%60let%20pattern%20%3D%20expr%20else%20%7B%20...%20%7D%60%20statements/near/246657422" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Mario Carneiro <a href="https://rust-lang.github.io/zulip_archive/stream/213817-t-lang/topic/.60let.20pattern.20.3D.20expr.20else.20.7B.20.2E.2E.2E.20.7D.60.20statements.html#246657422">(Jul 20 2021 at 22:09)</a>:</h4>
<p>I always omit the semicolon when I am allowed to, but reasonable minds can disagree</p>



<a name="246657567"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/%60let%20pattern%20%3D%20expr%20else%20%7B%20...%20%7D%60%20statements/near/246657567" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Mario Carneiro <a href="https://rust-lang.github.io/zulip_archive/stream/213817-t-lang/topic/.60let.20pattern.20.3D.20expr.20else.20.7B.20.2E.2E.2E.20.7D.60.20statements.html#246657567">(Jul 20 2021 at 22:10)</a>:</h4>
<p>I like the diverging expr to stay on the right side of the screen, out of the main control flow path. That's the reason I'm using let-else in the first place</p>



<a name="246658043"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/%60let%20pattern%20%3D%20expr%20else%20%7B%20...%20%7D%60%20statements/near/246658043" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> bstrie <a href="https://rust-lang.github.io/zulip_archive/stream/213817-t-lang/topic/.60let.20pattern.20.3D.20expr.20else.20.7B.20.2E.2E.2E.20.7D.60.20statements.html#246658043">(Jul 20 2021 at 22:17)</a>:</h4>
<p>this is kind of a gray area... rustfmt will split <code>if let foo = bar { 1 } else { 2 }</code> onto multiple lines, but <code>let x = if let foo = bar { 1 } else { 2 };</code> remains on a single line</p>



<a name="246658173"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/%60let%20pattern%20%3D%20expr%20else%20%7B%20...%20%7D%60%20statements/near/246658173" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> bstrie <a href="https://rust-lang.github.io/zulip_archive/stream/213817-t-lang/topic/.60let.20pattern.20.3D.20expr.20else.20.7B.20.2E.2E.2E.20.7D.60.20statements.html#246658173">(Jul 20 2021 at 22:19)</a>:</h4>
<p>IMO, whether to format this like <code>if</code> or like <code>let</code> should be consistent with whether we require a semicolon after the statement. no semicolon? treat it like <code>if</code>. semicolon? treat it like <code>let</code>. and I think there should be a semicolon after a let-else.</p>



<a name="246658827"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/%60let%20pattern%20%3D%20expr%20else%20%7B%20...%20%7D%60%20statements/near/246658827" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> bstrie <a href="https://rust-lang.github.io/zulip_archive/stream/213817-t-lang/topic/.60let.20pattern.20.3D.20expr.20else.20.7B.20.2E.2E.2E.20.7D.60.20statements.html#246658827">(Jul 20 2021 at 22:28)</a>:</h4>
<p>but I don't really feel that strongly either way about the formatting</p>



<a name="246659349"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/%60let%20pattern%20%3D%20expr%20else%20%7B%20...%20%7D%60%20statements/near/246659349" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> scottmcm <a href="https://rust-lang.github.io/zulip_archive/stream/213817-t-lang/topic/.60let.20pattern.20.3D.20expr.20else.20.7B.20.2E.2E.2E.20.7D.60.20statements.html#246659349">(Jul 20 2021 at 22:36)</a>:</h4>
<p>I don't know how to write a good formatting heuristic for it.  But I definitely think that the simple cases like</p>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="kd">let</span><span class="w"> </span><span class="nb">Some</span><span class="p">(</span><span class="n">x</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">x</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="k">continue</span><span class="w"> </span><span class="p">};</span><span class="w"></span>
</code></pre></div>
<p>ought not need multiple line.  Especially not</p>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="kd">let</span><span class="w"> </span><span class="nb">Some</span><span class="p">(</span><span class="n">x</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">x</span><span class="w"></span>
<span class="k">else</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="k">continue</span><span class="w"></span>
<span class="p">};</span><span class="w"></span>
</code></pre></div>



<a name="246659441"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/%60let%20pattern%20%3D%20expr%20else%20%7B%20...%20%7D%60%20statements/near/246659441" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> scottmcm <a href="https://rust-lang.github.io/zulip_archive/stream/213817-t-lang/topic/.60let.20pattern.20.3D.20expr.20else.20.7B.20.2E.2E.2E.20.7D.60.20statements.html#246659441">(Jul 20 2021 at 22:37)</a>:</h4>
<p>I guess this is back to the "does it need an introduction syntax?" conversation again.</p>
<p><code>guard let Some(x) = x else { continue }</code> doesn't need the </p>
<blockquote>
<p>I think we want those to always get a line of their own, because control flow.</p>
</blockquote>
<p>thing.</p>



<a name="246659477"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/%60let%20pattern%20%3D%20expr%20else%20%7B%20...%20%7D%60%20statements/near/246659477" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Mario Carneiro <a href="https://rust-lang.github.io/zulip_archive/stream/213817-t-lang/topic/.60let.20pattern.20.3D.20expr.20else.20.7B.20.2E.2E.2E.20.7D.60.20statements.html#246659477">(Jul 20 2021 at 22:38)</a>:</h4>
<p>I don't follow, how are those related to the formatting question?</p>



<a name="246659521"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/%60let%20pattern%20%3D%20expr%20else%20%7B%20...%20%7D%60%20statements/near/246659521" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> scottmcm <a href="https://rust-lang.github.io/zulip_archive/stream/213817-t-lang/topic/.60let.20pattern.20.3D.20expr.20else.20.7B.20.2E.2E.2E.20.7D.60.20statements.html#246659521">(Jul 20 2021 at 22:38)</a>:</h4>
<p>Mostly unimportant: I also find the <code>};</code> awkward.</p>



<a name="246659574"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/%60let%20pattern%20%3D%20expr%20else%20%7B%20...%20%7D%60%20statements/near/246659574" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> The 8472 <a href="https://rust-lang.github.io/zulip_archive/stream/213817-t-lang/topic/.60let.20pattern.20.3D.20expr.20else.20.7B.20.2E.2E.2E.20.7D.60.20statements.html#246659574">(Jul 20 2021 at 22:39)</a>:</h4>
<p>you already have that when doing <code>let foo = match/if { ... };</code></p>



<a name="246659585"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/%60let%20pattern%20%3D%20expr%20else%20%7B%20...%20%7D%60%20statements/near/246659585" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Poliorcetics <a href="https://rust-lang.github.io/zulip_archive/stream/213817-t-lang/topic/.60let.20pattern.20.3D.20expr.20else.20.7B.20.2E.2E.2E.20.7D.60.20statements.html#246659585">(Jul 20 2021 at 22:39)</a>:</h4>
<p>For the length of expr problem, maybe a clippy lint could be added to say « you used let-else/guard-let and the expression is 3 lines, consider making an intermediate variable »</p>



<a name="246659588"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/%60let%20pattern%20%3D%20expr%20else%20%7B%20...%20%7D%60%20statements/near/246659588" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> scottmcm <a href="https://rust-lang.github.io/zulip_archive/stream/213817-t-lang/topic/.60let.20pattern.20.3D.20expr.20else.20.7B.20.2E.2E.2E.20.7D.60.20statements.html#246659588">(Jul 20 2021 at 22:39)</a>:</h4>
<p><span class="user-mention silent" data-user-id="271719">Mario Carneiro</span> <a href="#narrow/stream/213817-t-lang/topic/.60let.20pattern.20.3D.20expr.20else.20.7B.20.2E.2E.2E.20.7D.60.20statements/near/246659477">said</a>:</p>
<blockquote>
<p>I don't follow, how are those related to the formatting question?</p>
</blockquote>
<p>If the formatting is being used to call attention to the control flow, then I think that it might be an indication that the syntax should be calling attention to it instead.</p>



<a name="246659704"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/%60let%20pattern%20%3D%20expr%20else%20%7B%20...%20%7D%60%20statements/near/246659704" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Mario Carneiro <a href="https://rust-lang.github.io/zulip_archive/stream/213817-t-lang/topic/.60let.20pattern.20.3D.20expr.20else.20.7B.20.2E.2E.2E.20.7D.60.20statements.html#246659704">(Jul 20 2021 at 22:41)</a>:</h4>
<p>but I want to not call attention to the control flow. I want it to be a let statement with an asterisk</p>



<a name="246659744"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/%60let%20pattern%20%3D%20expr%20else%20%7B%20...%20%7D%60%20statements/near/246659744" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Mario Carneiro <a href="https://rust-lang.github.io/zulip_archive/stream/213817-t-lang/topic/.60let.20pattern.20.3D.20expr.20else.20.7B.20.2E.2E.2E.20.7D.60.20statements.html#246659744">(Jul 20 2021 at 22:42)</a>:</h4>
<p>Especially with deep pattern matching, it's not unusual to have a whole bunch of these in a row. They should not need three lines each</p>



<a name="246661049"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/%60let%20pattern%20%3D%20expr%20else%20%7B%20...%20%7D%60%20statements/near/246661049" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jeremiah Senkpiel <a href="https://rust-lang.github.io/zulip_archive/stream/213817-t-lang/topic/.60let.20pattern.20.3D.20expr.20else.20.7B.20.2E.2E.2E.20.7D.60.20statements.html#246661049">(Jul 20 2021 at 23:00)</a>:</h4>
<p><span class="user-mention" data-user-id="239881">@Josh Triplett</span> I have updated the RFC with wording which specifies that the expr must not end with a <code>}</code> before macro expansion.</p>
<p>There is also a note about macro groups which I almost forgot but which I hope is reasonable. If that looks good, I'd like to be done with this stage haha.</p>



<a name="246662845"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/%60let%20pattern%20%3D%20expr%20else%20%7B%20...%20%7D%60%20statements/near/246662845" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Cameron Steffen <a href="https://rust-lang.github.io/zulip_archive/stream/213817-t-lang/topic/.60let.20pattern.20.3D.20expr.20else.20.7B.20.2E.2E.2E.20.7D.60.20statements.html#246662845">(Jul 20 2021 at 23:25)</a>:</h4>
<p>nice work <span class="user-mention" data-user-id="319552">@Jeremiah Senkpiel</span> !</p>



<a name="246662988"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/%60let%20pattern%20%3D%20expr%20else%20%7B%20...%20%7D%60%20statements/near/246662988" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Cameron Steffen <a href="https://rust-lang.github.io/zulip_archive/stream/213817-t-lang/topic/.60let.20pattern.20.3D.20expr.20else.20.7B.20.2E.2E.2E.20.7D.60.20statements.html#246662988">(Jul 20 2021 at 23:27)</a>:</h4>
<p>I would think semicolon forces a new line and no semicolon allows for one line</p>



<a name="246664634"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/%60let%20pattern%20%3D%20expr%20else%20%7B%20...%20%7D%60%20statements/near/246664634" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Triplett <a href="https://rust-lang.github.io/zulip_archive/stream/213817-t-lang/topic/.60let.20pattern.20.3D.20expr.20else.20.7B.20.2E.2E.2E.20.7D.60.20statements.html#246664634">(Jul 20 2021 at 23:55)</a>:</h4>
<p><span class="user-mention silent" data-user-id="125270">scottmcm</span> <a href="#narrow/stream/213817-t-lang/topic/.60let.20pattern.20.3D.20expr.20else.20.7B.20.2E.2E.2E.20.7D.60.20statements/near/246659349">said</a>:</p>
<blockquote>
<p>I don't know how to write a good formatting heuristic for it.  But I definitely think that the simple cases like</p>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="kd">let</span><span class="w"> </span><span class="nb">Some</span><span class="p">(</span><span class="n">x</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">x</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="k">continue</span><span class="w"> </span><span class="p">};</span><span class="w"></span>
</code></pre></div>
<p>ought not need multiple line.  Especially not</p>
<p><div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="kd">let</span><span class="w"> </span><span class="nb">Some</span><span class="p">(</span><span class="n">x</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">x</span><span class="w"></span>
<span class="k">else</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="k">continue</span><span class="w"></span>
<span class="p">};</span><span class="w"></span>
</code></pre></div><br>
</p>
</blockquote>
<p>I don't think we want the latter in any case; I think if that needs multiple lines then it should look like:</p>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="kd">let</span><span class="w"> </span><span class="nb">Some</span><span class="p">(</span><span class="n">x</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">x</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="k">continue</span><span class="w"></span>
<span class="p">};</span><span class="w"></span>
</code></pre></div>



<a name="246668843"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/%60let%20pattern%20%3D%20expr%20else%20%7B%20...%20%7D%60%20statements/near/246668843" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Triplett <a href="https://rust-lang.github.io/zulip_archive/stream/213817-t-lang/topic/.60let.20pattern.20.3D.20expr.20else.20.7B.20.2E.2E.2E.20.7D.60.20statements.html#246668843">(Jul 21 2021 at 01:05)</a>:</h4>
<p><span class="user-mention" data-user-id="319552">@Jeremiah Senkpiel</span> Any objections if I fix a couple of typos when merging? (<code>parenthesis</code> -&gt; <code>parentheses</code> when talking about a pair of them.)</p>



<a name="246669552"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/%60let%20pattern%20%3D%20expr%20else%20%7B%20...%20%7D%60%20statements/near/246669552" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jeremiah Senkpiel <a href="https://rust-lang.github.io/zulip_archive/stream/213817-t-lang/topic/.60let.20pattern.20.3D.20expr.20else.20.7B.20.2E.2E.2E.20.7D.60.20statements.html#246669552">(Jul 21 2021 at 01:18)</a>:</h4>
<p>Please go ahead</p>



<a name="246671485"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/%60let%20pattern%20%3D%20expr%20else%20%7B%20...%20%7D%60%20statements/near/246671485" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Triplett <a href="https://rust-lang.github.io/zulip_archive/stream/213817-t-lang/topic/.60let.20pattern.20.3D.20expr.20else.20.7B.20.2E.2E.2E.20.7D.60.20statements.html#246671485">(Jul 21 2021 at 01:54)</a>:</h4>
<p>RFC 3137, let-else statements, has been merged! Thanks to everyone involved with the RFC. And thanks to <span class="user-mention" data-user-id="319552">@Jeremiah Senkpiel</span> for putting so much effort into incorporating feedback, alternatives, unresolved questions, and other content from the GitHub and Zulip threads to make the RFC self-contained.</p>
<p>Tracking issue: <a href="https://github.com/rust-lang/rust/issues/87335">rust-lang/rust#87335</a></p>



<a name="246733295"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/%60let%20pattern%20%3D%20expr%20else%20%7B%20...%20%7D%60%20statements/near/246733295" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> bstrie <a href="https://rust-lang.github.io/zulip_archive/stream/213817-t-lang/topic/.60let.20pattern.20.3D.20expr.20else.20.7B.20.2E.2E.2E.20.7D.60.20statements.html#246733295">(Jul 21 2021 at 15:08)</a>:</h4>
<p>WRT "calling out the control flow", I don't think <code>let foo = bar_bar_bar() else { return };</code> inherently necessitates any more calling out than <code>let foo = bar?;</code></p>



<a name="246895500"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/%60let%20pattern%20%3D%20expr%20else%20%7B%20...%20%7D%60%20statements/near/246895500" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jeremiah Senkpiel <a href="https://rust-lang.github.io/zulip_archive/stream/213817-t-lang/topic/.60let.20pattern.20.3D.20expr.20else.20.7B.20.2E.2E.2E.20.7D.60.20statements.html#246895500">(Jul 22 2021 at 19:41)</a>:</h4>
<p>I encountered a "valid early output &amp; return if None" situation today in real world code, which can't be easily handled by e.g. <code>ok_or_else</code> (no error) and where the "if" would be literally 200 lines long, so I am pretty happy the RFC moved forward. <span aria-label="smile" class="emoji emoji-1f642" role="img" title="smile">:smile:</span></p>



<a name="246897078"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/%60let%20pattern%20%3D%20expr%20else%20%7B%20...%20%7D%60%20statements/near/246897078" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Triplett <a href="https://rust-lang.github.io/zulip_archive/stream/213817-t-lang/topic/.60let.20pattern.20.3D.20expr.20else.20.7B.20.2E.2E.2E.20.7D.60.20statements.html#246897078">(Jul 22 2021 at 19:55)</a>:</h4>
<p>Nice. What would the <code>let else</code> look like from that code? Can you paste it?</p>



<a name="247224951"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/%60let%20pattern%20%3D%20expr%20else%20%7B%20...%20%7D%60%20statements/near/247224951" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jeremiah Senkpiel <a href="https://rust-lang.github.io/zulip_archive/stream/213817-t-lang/topic/.60let.20pattern.20.3D.20expr.20else.20.7B.20.2E.2E.2E.20.7D.60.20statements.html#247224951">(Jul 26 2021 at 16:14)</a>:</h4>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="kd">let</span><span class="w"> </span><span class="n">task_id</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">match</span><span class="w"> </span><span class="n">thing</span><span class="p">.</span><span class="n">task_id</span><span class="p">()</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="nb">Some</span><span class="p">(</span><span class="n">task_id</span><span class="p">)</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="n">task_id</span><span class="p">,</span><span class="w"></span>
<span class="w">    </span><span class="nb">None</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">        </span><span class="c1">// update 'thing' in the database</span>
<span class="w">        </span><span class="n">Something</span>::<span class="n">whatever</span>::<span class="n">adjust</span><span class="p">(</span><span class="n">thing</span><span class="p">).</span><span class="k">await</span><span class="o">?</span><span class="p">;</span><span class="w"></span>

<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="nb">Ok</span><span class="p">(</span><span class="n">json</span><span class="o">!</span><span class="p">({</span><span class="w"> </span><span class="s">"adjusted_thing_id"</span>: <span class="nc">thing</span><span class="p">.</span><span class="n">id</span><span class="p">()</span><span class="w"> </span><span class="p">}));</span><span class="w"></span>
<span class="w">    </span><span class="p">}</span><span class="w"></span>
<span class="p">};</span><span class="w"></span>
</code></pre></div>
<p>Becoming:</p>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="kd">let</span><span class="w"> </span><span class="nb">Some</span><span class="p">(</span><span class="n">task_id</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">thing</span><span class="p">.</span><span class="n">task_id</span><span class="p">()</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="c1">// update 'thing' in the database</span>
<span class="w">    </span><span class="n">Something</span>::<span class="n">whatever</span>::<span class="n">adjust</span><span class="p">(</span><span class="n">thing</span><span class="p">).</span><span class="k">await</span><span class="o">?</span><span class="p">;</span><span class="w"></span>

<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="nb">Ok</span><span class="p">(</span><span class="n">json</span><span class="o">!</span><span class="p">({</span><span class="w"> </span><span class="s">"adjusted_thing_id"</span>: <span class="nc">thing</span><span class="p">.</span><span class="n">id</span><span class="p">()</span><span class="w"> </span><span class="p">}));</span><span class="w"></span>
<span class="p">};</span><span class="w"></span>
</code></pre></div>



<a name="247226227"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/%60let%20pattern%20%3D%20expr%20else%20%7B%20...%20%7D%60%20statements/near/247226227" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Triplett <a href="https://rust-lang.github.io/zulip_archive/stream/213817-t-lang/topic/.60let.20pattern.20.3D.20expr.20else.20.7B.20.2E.2E.2E.20.7D.60.20statements.html#247226227">(Jul 26 2021 at 16:24)</a>:</h4>
<p><span class="user-mention" data-user-id="319552">@Jeremiah Senkpiel</span> Awesome.</p>



<a name="247475140"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/213817-t-lang/topic/%60let%20pattern%20%3D%20expr%20else%20%7B%20...%20%7D%60%20statements/near/247475140" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Chaz Kiker <a href="https://rust-lang.github.io/zulip_archive/stream/213817-t-lang/topic/.60let.20pattern.20.3D.20expr.20else.20.7B.20.2E.2E.2E.20.7D.60.20statements.html#247475140">(Jul 28 2021 at 15:35)</a>:</h4>
<p>just stopping by to say this looks dreamy :). big fan, thanks to everyone that contributed</p>



<hr><p>Last updated: Aug 07 2021 at 22:04 UTC</p>
</html>