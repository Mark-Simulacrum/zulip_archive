<html>
<head><meta charset="utf-8"><title>rec. cmd line for beta testing? · t-release · Zulip Chat Archive</title></head>
<h2>Stream: <a href="https://zulip-archive.rust-lang.org/stream/241545-t-release/index.html">t-release</a></h2>
<h3>Topic: <a href="https://zulip-archive.rust-lang.org/stream/241545-t-release/topic/rec.2E.20cmd.20line.20for.20beta.20testing.3F.html">rec. cmd line for beta testing?</a></h3>

<hr>

<base href="https://rust-lang.zulipchat.com">

<head><link href="https://zulip-archive.rust-lang.org/style.css" rel="stylesheet"></head>

<a name="230413840"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/241545-t-release/topic/rec.%20cmd%20line%20for%20beta%20testing%3F/near/230413840" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> pnkfelix <a href="https://zulip-archive.rust-lang.org/stream/241545-t-release/topic/rec.2E.20cmd.20line.20for.20beta.20testing.3F.html#230413840">(Mar 15 2021 at 20:33)</a>:</h4>
<p>Hey all, when I do <code>x.py test</code> on a beta branch, it does a “tidy check” as part of the testing, which then fails because "x.py fmt is not supported on this channel.” What do people do instead to test beta backports?</p>



<a name="230413921"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/241545-t-release/topic/rec.%20cmd%20line%20for%20beta%20testing%3F/near/230413921" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> simulacrum <a href="https://zulip-archive.rust-lang.org/stream/241545-t-release/topic/rec.2E.20cmd.20line.20for.20beta.20testing.3F.html#230413921">(Mar 15 2021 at 20:34)</a>:</h4>
<p>I don't generally run tests on backports locally (maybe just ui tests)</p>



<a name="230413954"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/241545-t-release/topic/rec.%20cmd%20line%20for%20beta%20testing%3F/near/230413954" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> simulacrum <a href="https://zulip-archive.rust-lang.org/stream/241545-t-release/topic/rec.2E.20cmd.20line.20for.20beta.20testing.3F.html#230413954">(Mar 15 2021 at 20:34)</a>:</h4>
<p>but you should be able to e.g. --exclude src/tools/tidy I think?</p>



<a name="230414075"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/241545-t-release/topic/rec.%20cmd%20line%20for%20beta%20testing%3F/near/230414075" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> simulacrum <a href="https://zulip-archive.rust-lang.org/stream/241545-t-release/topic/rec.2E.20cmd.20line.20for.20beta.20testing.3F.html#230414075">(Mar 15 2021 at 20:35)</a>:</h4>
<p>we should tell people that in the error message, happy to accept pr - it is a bit broader than might be desired</p>



<a name="230414080"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/241545-t-release/topic/rec.%20cmd%20line%20for%20beta%20testing%3F/near/230414080" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> pnkfelix <a href="https://zulip-archive.rust-lang.org/stream/241545-t-release/topic/rec.2E.20cmd.20line.20for.20beta.20testing.3F.html#230414080">(Mar 15 2021 at 20:35)</a>:</h4>
<p>(would it be a bad thing to make the <code>x.py test</code> logic auto exclude src/tools/tidy on beta branch? Hmm.)</p>



<a name="230414118"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/241545-t-release/topic/rec.%20cmd%20line%20for%20beta%20testing%3F/near/230414118" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> pnkfelix <a href="https://zulip-archive.rust-lang.org/stream/241545-t-release/topic/rec.2E.20cmd.20line.20for.20beta.20testing.3F.html#230414118">(Mar 15 2021 at 20:35)</a>:</h4>
<p>Yeah okay I like just making it a suggestion in the error message</p>



<a name="230414144"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/241545-t-release/topic/rec.%20cmd%20line%20for%20beta%20testing%3F/near/230414144" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> pnkfelix <a href="https://zulip-archive.rust-lang.org/stream/241545-t-release/topic/rec.2E.20cmd.20line.20for.20beta.20testing.3F.html#230414144">(Mar 15 2021 at 20:35)</a>:</h4>
<p>That gets the bulk of the desired effect.</p>



<a name="230414170"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/241545-t-release/topic/rec.%20cmd%20line%20for%20beta%20testing%3F/near/230414170" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> simulacrum <a href="https://zulip-archive.rust-lang.org/stream/241545-t-release/topic/rec.2E.20cmd.20line.20for.20beta.20testing.3F.html#230414170">(Mar 15 2021 at 20:35)</a>:</h4>
<p>It's always a conflict between failing if we didn't run something (because you 'maybe didn't want to') vs. warning but continuing</p>



<a name="230414273"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/241545-t-release/topic/rec.%20cmd%20line%20for%20beta%20testing%3F/near/230414273" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> simulacrum <a href="https://zulip-archive.rust-lang.org/stream/241545-t-release/topic/rec.2E.20cmd.20line.20for.20beta.20testing.3F.html#230414273">(Mar 15 2021 at 20:36)</a>:</h4>
<p>e.g., for the debuginfo tests do we fail if you don't have gdb or lldb. kinda similar problem.</p>



<a name="230414377"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/241545-t-release/topic/rec.%20cmd%20line%20for%20beta%20testing%3F/near/230414377" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> pnkfelix <a href="https://zulip-archive.rust-lang.org/stream/241545-t-release/topic/rec.2E.20cmd.20line.20for.20beta.20testing.3F.html#230414377">(Mar 15 2021 at 20:37)</a>:</h4>
<p>right. (Speaking of which, <code>[debuginfo-lldb] debuginfo/pretty-std-collections.rs</code> just failed in my own local (pristine) run.)</p>



<a name="230414422"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/241545-t-release/topic/rec.%20cmd%20line%20for%20beta%20testing%3F/near/230414422" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> simulacrum <a href="https://zulip-archive.rust-lang.org/stream/241545-t-release/topic/rec.2E.20cmd.20line.20for.20beta.20testing.3F.html#230414422">(Mar 15 2021 at 20:37)</a>:</h4>
<p>we don't run that test on ci I think at all these days? not sure. lldb/gdb tests are a bit of a pain point historically</p>



<a name="230414427"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/241545-t-release/topic/rec.%20cmd%20line%20for%20beta%20testing%3F/near/230414427" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> simulacrum <a href="https://zulip-archive.rust-lang.org/stream/241545-t-release/topic/rec.2E.20cmd.20line.20for.20beta.20testing.3F.html#230414427">(Mar 15 2021 at 20:37)</a>:</h4>
<p>(as you know)</p>



<a name="230414501"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/241545-t-release/topic/rec.%20cmd%20line%20for%20beta%20testing%3F/near/230414501" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> pnkfelix <a href="https://zulip-archive.rust-lang.org/stream/241545-t-release/topic/rec.2E.20cmd.20line.20for.20beta.20testing.3F.html#230414501">(Mar 15 2021 at 20:38)</a>:</h4>
<p>yeah not surprised</p>



<a name="230414552"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/241545-t-release/topic/rec.%20cmd%20line%20for%20beta%20testing%3F/near/230414552" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> pnkfelix <a href="https://zulip-archive.rust-lang.org/stream/241545-t-release/topic/rec.2E.20cmd.20line.20for.20beta.20testing.3F.html#230414552">(Mar 15 2021 at 20:38)</a>:</h4>
<p>didn’t I have a steering meeting proposal about this? Maybe I dreamt that.</p>



<a name="230418571"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/241545-t-release/topic/rec.%20cmd%20line%20for%20beta%20testing%3F/near/230418571" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> pnkfelix <a href="https://zulip-archive.rust-lang.org/stream/241545-t-release/topic/rec.2E.20cmd.20line.20for.20beta.20testing.3F.html#230418571">(Mar 15 2021 at 21:07)</a>:</h4>
<p><span class="user-mention silent" data-user-id="116083">pnkfelix</span> <a href="#narrow/stream/241545-t-release/topic/rec.2E.20cmd.20line.20for.20beta.20testing.3F/near/230414080">said</a>:</p>
<blockquote>
<p>(would it be a bad thing to make the <code>x.py test</code> logic auto exclude src/tools/tidy on beta branch? Hmm.)</p>
</blockquote>
<p>hmm, weird; it seems like we’re already <em>trying</em> to do this via an allowlist? <a href="https://github.com/rust-lang/rust/blob/2ccf06302c08d7d4911aad40e66a9a3ee731c6f9/src/bootstrap/test.rs#L792">here</a> in <code>&lt;Tidy as Step&gt;::run</code> …:</p>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="n">builder</span><span class="p">.</span><span class="n">config</span><span class="p">.</span><span class="n">channel</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="s">"dev"</span><span class="w"> </span><span class="o">||</span><span class="w"> </span><span class="n">builder</span><span class="p">.</span><span class="n">config</span><span class="p">.</span><span class="n">channel</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="s">"nightly"</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">            </span><span class="n">builder</span><span class="p">.</span><span class="n">info</span><span class="p">(</span><span class="s">"fmt check"</span><span class="p">);</span><span class="w"></span>
<span class="w">            </span><span class="k">crate</span>::<span class="n">format</span>::<span class="n">format</span><span class="p">(</span><span class="o">&amp;</span><span class="n">builder</span><span class="p">.</span><span class="n">build</span><span class="p">,</span><span class="w"> </span><span class="o">!</span><span class="n">builder</span><span class="p">.</span><span class="n">config</span><span class="p">.</span><span class="n">cmd</span><span class="p">.</span><span class="n">bless</span><span class="p">());</span><span class="w"></span>
<span class="w">        </span><span class="p">}</span><span class="w"></span>
</code></pre></div>



<a name="230418797"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/241545-t-release/topic/rec.%20cmd%20line%20for%20beta%20testing%3F/near/230418797" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> pnkfelix <a href="https://zulip-archive.rust-lang.org/stream/241545-t-release/topic/rec.2E.20cmd.20line.20for.20beta.20testing.3F.html#230418797">(Mar 15 2021 at 21:09)</a>:</h4>
<p><span aria-label="lol" class="emoji emoji-1f606" role="img" title="lol">:lol:</span> well of course that ran; I wasn’t setting <code>rust.channel</code> to <code>beta</code> in my <code>config.toml</code></p>



<a name="230419329"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/241545-t-release/topic/rec.%20cmd%20line%20for%20beta%20testing%3F/near/230419329" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> simulacrum <a href="https://zulip-archive.rust-lang.org/stream/241545-t-release/topic/rec.2E.20cmd.20line.20for.20beta.20testing.3F.html#230419329">(Mar 15 2021 at 21:12)</a>:</h4>
<p>ah, yeah, I guess that'd cause it :)</p>



<a name="230419417"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/241545-t-release/topic/rec.%20cmd%20line%20for%20beta%20testing%3F/near/230419417" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> pnkfelix <a href="https://zulip-archive.rust-lang.org/stream/241545-t-release/topic/rec.2E.20cmd.20line.20for.20beta.20testing.3F.html#230419417">(Mar 15 2021 at 21:12)</a>:</h4>
<p>anyway I think I have a nice (more targetted) fix now</p>



<a name="230419453"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/241545-t-release/topic/rec.%20cmd%20line%20for%20beta%20testing%3F/near/230419453" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Eric Huss <a href="https://zulip-archive.rust-lang.org/stream/241545-t-release/topic/rec.2E.20cmd.20line.20for.20beta.20testing.3F.html#230419453">(Mar 15 2021 at 21:12)</a>:</h4>
<p>Yea, I set <code>channel = "beta"</code> for doing stuff on beta to fix the tidy issue.</p>



<a name="230419525"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/241545-t-release/topic/rec.%20cmd%20line%20for%20beta%20testing%3F/near/230419525" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> pnkfelix <a href="https://zulip-archive.rust-lang.org/stream/241545-t-release/topic/rec.2E.20cmd.20line.20for.20beta.20testing.3F.html#230419525">(Mar 15 2021 at 21:13)</a>:</h4>
<p>what is different about the beta branch that makes <code>build.config.initial_rustfmt</code> end up as <code>None</code> ?</p>



<a name="230419690"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/241545-t-release/topic/rec.%20cmd%20line%20for%20beta%20testing%3F/near/230419690" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> pnkfelix <a href="https://zulip-archive.rust-lang.org/stream/241545-t-release/topic/rec.2E.20cmd.20line.20for.20beta.20testing.3F.html#230419690">(Mar 15 2021 at 21:14)</a>:</h4>
<p>(probably something about how we try to construct it from the <code>config.build.initial_rustc</code>, whatever that is…)</p>



<a name="230419828"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/241545-t-release/topic/rec.%20cmd%20line%20for%20beta%20testing%3F/near/230419828" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> simulacrum <a href="https://zulip-archive.rust-lang.org/stream/241545-t-release/topic/rec.2E.20cmd.20line.20for.20beta.20testing.3F.html#230419828">(Mar 15 2021 at 21:15)</a>:</h4>
<p>we skip rustfmt downloads on beta, since it's a nightly pin</p>



<a name="230419839"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/241545-t-release/topic/rec.%20cmd%20line%20for%20beta%20testing%3F/near/230419839" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> pnkfelix <a href="https://zulip-archive.rust-lang.org/stream/241545-t-release/topic/rec.2E.20cmd.20line.20for.20beta.20testing.3F.html#230419839">(Mar 15 2021 at 21:15)</a>:</h4>
<p>ah that makes sense, okay.</p>



<a name="230419841"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/241545-t-release/topic/rec.%20cmd%20line%20for%20beta%20testing%3F/near/230419841" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> simulacrum <a href="https://zulip-archive.rust-lang.org/stream/241545-t-release/topic/rec.2E.20cmd.20line.20for.20beta.20testing.3F.html#230419841">(Mar 15 2021 at 21:15)</a>:</h4>
<p>we don't want distros to need to deal with rustfmt (since we pin to nightly)</p>



<a name="230419861"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/241545-t-release/topic/rec.%20cmd%20line%20for%20beta%20testing%3F/near/230419861" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> simulacrum <a href="https://zulip-archive.rust-lang.org/stream/241545-t-release/topic/rec.2E.20cmd.20line.20for.20beta.20testing.3F.html#230419861">(Mar 15 2021 at 21:16)</a>:</h4>
<p>and just generally seems like undue burden</p>



<a name="230512058"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/241545-t-release/topic/rec.%20cmd%20line%20for%20beta%20testing%3F/near/230512058" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> pnkfelix <a href="https://zulip-archive.rust-lang.org/stream/241545-t-release/topic/rec.2E.20cmd.20line.20for.20beta.20testing.3F.html#230512058">(Mar 16 2021 at 13:33)</a>:</h4>
<p><span class="user-mention silent" data-user-id="116122">simulacrum</span> <a href="#narrow/stream/241545-t-release/topic/rec.2E.20cmd.20line.20for.20beta.20testing.3F/near/230414075">said</a>:</p>
<blockquote>
<p>we should tell people that in the error message, happy to accept pr - it is a bit broader than might be desired</p>
</blockquote>
<p>PR posted: <a href="https://github.com/rust-lang/rust/pull/83172">https://github.com/rust-lang/rust/pull/83172</a></p>



<hr><p>Last updated: Apr 12 2022 at 20:01 UTC</p>
</html>