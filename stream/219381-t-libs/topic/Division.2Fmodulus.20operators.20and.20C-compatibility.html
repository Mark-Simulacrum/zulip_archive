<html>
<head><meta charset="utf-8"><title>Division/modulus operators and C-compatibility · t-libs · Zulip Chat Archive</title></head>
<h2>Stream: <a href="https://zulip-archive.rust-lang.org/stream/219381-t-libs/index.html">t-libs</a></h2>
<h3>Topic: <a href="https://zulip-archive.rust-lang.org/stream/219381-t-libs/topic/Division.2Fmodulus.20operators.20and.20C-compatibility.html">Division/modulus operators and C-compatibility</a></h3>

<hr>

<base href="https://rust-lang.zulipchat.com">

<head><link href="https://zulip-archive.rust-lang.org/style.css" rel="stylesheet"></head>

<a name="251102023"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/219381-t-libs/topic/Division/modulus%20operators%20and%20C-compatibility/near/251102023" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Mario Carneiro <a href="https://zulip-archive.rust-lang.org/stream/219381-t-libs/topic/Division.2Fmodulus.20operators.20and.20C-compatibility.html#251102023">(Aug 29 2021 at 03:34)</a>:</h4>
<p>I view the behavior of <code>x / y</code> in rust to be unavoidable baggage from our desire to be C-like and make it possible to translate things more or less faithfully, but needless to say I think <code>x.div_floor(y)</code> should definitely exist</p>



<a name="251157362"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/219381-t-libs/topic/Division/modulus%20operators%20and%20C-compatibility/near/251157362" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Gary Guo <a href="https://zulip-archive.rust-lang.org/stream/219381-t-libs/topic/Division.2Fmodulus.20operators.20and.20C-compatibility.html#251157362">(Aug 29 2021 at 20:55)</a>:</h4>
<p><span class="user-mention silent" data-user-id="271719">Mario Carneiro</span> <a href="#narrow/stream/219381-t-libs/topic/Division.2Fmodulus.20operators.20and.20C-compatibility/near/251101369">said</a>:</p>
<blockquote>
<p>That has the nicest mathematical properties, and also happens to be what most processors implement</p>
</blockquote>
<p>That's not true. Both x86 IDIV and RISC-V DIV are truncated divison</p>



<a name="251157434"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/219381-t-libs/topic/Division/modulus%20operators%20and%20C-compatibility/near/251157434" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Gary Guo <a href="https://zulip-archive.rust-lang.org/stream/219381-t-libs/topic/Division.2Fmodulus.20operators.20and.20C-compatibility.html#251157434">(Aug 29 2021 at 20:56)</a>:</h4>
<p>From hardware point of view, truncated division is easier to implement</p>



<a name="251157508"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/219381-t-libs/topic/Division/modulus%20operators%20and%20C-compatibility/near/251157508" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Gary Guo <a href="https://zulip-archive.rust-lang.org/stream/219381-t-libs/topic/Division.2Fmodulus.20operators.20and.20C-compatibility.html#251157508">(Aug 29 2021 at 20:58)</a>:</h4>
<p>It also gives nice property of (-a)/b=-(a/b)=a/(-b) which isn't true for floor division</p>



<a name="251167661"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/219381-t-libs/topic/Division/modulus%20operators%20and%20C-compatibility/near/251167661" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> scottmcm <a href="https://zulip-archive.rust-lang.org/stream/219381-t-libs/topic/Division.2Fmodulus.20operators.20and.20C-compatibility.html#251167661">(Aug 29 2021 at 23:55)</a>:</h4>
<p>Yeah, negative divisors in integer math are weird.</p>



<a name="251167744"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/219381-t-libs/topic/Division/modulus%20operators%20and%20C-compatibility/near/251167744" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Mario Carneiro <a href="https://zulip-archive.rust-lang.org/stream/219381-t-libs/topic/Division.2Fmodulus.20operators.20and.20C-compatibility.html#251167744">(Aug 29 2021 at 23:57)</a>:</h4>
<p><span class="user-mention silent" data-user-id="303710">Gary Guo</span> <a href="#narrow/stream/219381-t-libs/topic/Division.2Fmodulus.20operators.20and.20C-compatibility/near/251157362">said</a>:</p>
<blockquote>
<p><span class="user-mention silent" data-user-id="271719">Mario Carneiro</span> <a href="#narrow/stream/219381-t-libs/topic/Division.2Fmodulus.20operators.20and.20C-compatibility/near/251101369">said</a>:</p>
<blockquote>
<p>That has the nicest mathematical properties, and also happens to be what most processors implement</p>
</blockquote>
<p>That's not true. Both x86 IDIV and RISC-V DIV are truncated divison</p>
</blockquote>
<p>Ah, I take it back. Not the part about the naturalness of implementing it in hardware though; I'm pretty sure truncated division requires an <code>if x &lt; 0 { acc++ }</code> fixup step in hardware</p>



<a name="251168483"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/219381-t-libs/topic/Division/modulus%20operators%20and%20C-compatibility/near/251168483" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Mario Carneiro <a href="https://zulip-archive.rust-lang.org/stream/219381-t-libs/topic/Division.2Fmodulus.20operators.20and.20C-compatibility.html#251168483">(Aug 30 2021 at 00:09)</a>:</h4>
<p><span class="user-mention silent" data-user-id="303710">Gary Guo</span> <a href="#narrow/stream/219381-t-libs/topic/Division.2Fmodulus.20operators.20and.20C-compatibility/near/251157508">said</a>:</p>
<blockquote>
<p>It also gives nice property of (-a)/b=-(a/b)=a/(-b) which isn't true for floor division</p>
</blockquote>
<p>All three conventions have some nice properties that the others don't. I think it is good that the modulus is always nonnegative in euclidean division, that saves a bit and adds some type safety.</p>
<p>By the way, this property is true essentially by definition: I looked around for (truncating) signed integer division circuits and they seem to amount to <code>if (x &lt; 0) != (y &lt; 0) { -(x.abs() / y.abs()) } else { x.abs() / y.abs() }</code> where <code>x / y</code> is unsigned division</p>



<a name="251234230"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/219381-t-libs/topic/Division/modulus%20operators%20and%20C-compatibility/near/251234230" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Gary Guo <a href="https://zulip-archive.rust-lang.org/stream/219381-t-libs/topic/Division.2Fmodulus.20operators.20and.20C-compatibility.html#251234230">(Aug 30 2021 at 14:04)</a>:</h4>
<p><span class="user-mention silent" data-user-id="271719">Mario Carneiro</span> <a href="#narrow/stream/219381-t-libs/topic/Division.2Fmodulus.20operators.20and.20C-compatibility/near/251167744">said</a>:</p>
<blockquote>
<p>Ah, I take it back. Not the part about the naturalness of implementing it in hardware though; I'm pretty sure truncated division requires an <code>if x &lt; 0 { acc++ }</code> fixup step in hardware</p>
</blockquote>
<p>No. Division, unlikely multiplication, doesn't naturally work with 2's complement. What hardware implementations do is to separate the sign and magnitude, perform an unsigned division, and then fixup the signs after division. And that's where the property (or definition) is used. Other types of division would requires a fixup which complicates the logic.</p>



<hr><p>Last updated: Apr 12 2022 at 20:01 UTC</p>
</html>