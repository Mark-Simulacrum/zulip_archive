<html>
<head><meta charset="utf-8"><title>interpretting perf results · t-libs · Zulip Chat Archive</title></head>
<h2>Stream: <a href="https://zulip-archive.rust-lang.org/stream/219381-t-libs/index.html">t-libs</a></h2>
<h3>Topic: <a href="https://zulip-archive.rust-lang.org/stream/219381-t-libs/topic/interpretting.20perf.20results.html">interpretting perf results</a></h3>

<hr>

<base href="https://rust-lang.zulipchat.com">

<head><link href="https://zulip-archive.rust-lang.org/style.css" rel="stylesheet"></head>

<a name="272885597"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/219381-t-libs/topic/interpretting%20perf%20results/near/272885597" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jane Lusby [she/her] <a href="https://zulip-archive.rust-lang.org/stream/219381-t-libs/topic/interpretting.20perf.20results.html#272885597">(Feb 23 2022 at 00:15)</a>:</h4>
<p>So I ran a perf test on a PR that is adding <code>#[track_caller]</code> to <code>Once</code> and it came up with a regression on two of the benchmarks: <a href="https://github.com/rust-lang/rust/pull/94236#issuecomment-1048300388">https://github.com/rust-lang/rust/pull/94236#issuecomment-1048300388</a></p>



<a name="272885702"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/219381-t-libs/topic/interpretting%20perf%20results/near/272885702" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jane Lusby [she/her] <a href="https://zulip-archive.rust-lang.org/stream/219381-t-libs/topic/interpretting.20perf.20results.html#272885702">(Feb 23 2022 at 00:16)</a>:</h4>
<p>and I could use some help figuring out how to interpret these results, my guess from looking at them is that this isn't significant, but I kinda want to try digging into the details on the specific benchmarks to understand how the PR caused them to regress</p>



<a name="272885901"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/219381-t-libs/topic/interpretting%20perf%20results/near/272885901" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jane Lusby [she/her] <a href="https://zulip-archive.rust-lang.org/stream/219381-t-libs/topic/interpretting.20perf.20results.html#272885901">(Feb 23 2022 at 00:19)</a>:</h4>
<p>I tried looking for the source of the <code>alloc</code> and <code>chalk_solve</code> benchmarks in <a href="https://github.com/rust-lang/rustc-perf">https://github.com/rust-lang/rustc-perf</a> and couldn't find either of them, guessing I'm looking in the wrong place</p>



<a name="272885984"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/219381-t-libs/topic/interpretting%20perf%20results/near/272885984" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jane Lusby [she/her] <a href="https://zulip-archive.rust-lang.org/stream/219381-t-libs/topic/interpretting.20perf.20results.html#272885984">(Feb 23 2022 at 00:20)</a>:</h4>
<p>cc <span class="user-mention" data-user-id="116122">@simulacrum</span> and <span class="user-mention" data-user-id="138448">@cuviper</span></p>



<a name="272886244"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/219381-t-libs/topic/interpretting%20perf%20results/near/272886244" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Thom Chiovoloni <a href="https://zulip-archive.rust-lang.org/stream/219381-t-libs/topic/interpretting.20perf.20results.html#272886244">(Feb 23 2022 at 00:23)</a>:</h4>
<p>That might be fine, tbh -- those regressions seem fairly minor.</p>
<p>It's not surprising that adding #[track_caller] to things has a performance cost, it generally prevents optimizations of stuff like deduplicating branches (since it needs to pass something with the correct line info), among other things. This might increase the amount of stuff llvm has to chew on, or might just slow the compiler down (by fractions of a percent) directly.</p>



<a name="272886326"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/219381-t-libs/topic/interpretting%20perf%20results/near/272886326" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> cuviper <a href="https://zulip-archive.rust-lang.org/stream/219381-t-libs/topic/interpretting.20perf.20results.html#272886326">(Feb 23 2022 at 00:24)</a>:</h4>
<p>I haven't done much perf triage, but while it does look curious that one is singled out consistently, I think it's small enough not to worry about it.</p>



<a name="272888627"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/219381-t-libs/topic/interpretting%20perf%20results/near/272888627" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> simulacrum <a href="https://zulip-archive.rust-lang.org/stream/219381-t-libs/topic/interpretting.20perf.20results.html#272888627">(Feb 23 2022 at 00:52)</a>:</h4>
<p>chalk solve and alloc are crates built during rustc bootstrap; those results are likely noise</p>



<a name="272888685"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/219381-t-libs/topic/interpretting%20perf%20results/near/272888685" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jane Lusby [she/her] <a href="https://zulip-archive.rust-lang.org/stream/219381-t-libs/topic/interpretting.20perf.20results.html#272888685">(Feb 23 2022 at 00:53)</a>:</h4>
<p>oh the testcase is just building those crates</p>



<a name="272888690"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/219381-t-libs/topic/interpretting%20perf%20results/near/272888690" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jane Lusby [she/her] <a href="https://zulip-archive.rust-lang.org/stream/219381-t-libs/topic/interpretting.20perf.20results.html#272888690">(Feb 23 2022 at 00:53)</a>:</h4>
<p>i see</p>



<a name="272888710"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/219381-t-libs/topic/interpretting%20perf%20results/near/272888710" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> cuviper <a href="https://zulip-archive.rust-lang.org/stream/219381-t-libs/topic/interpretting.20perf.20results.html#272888710">(Feb 23 2022 at 00:53)</a>:</h4>
<p>oh I only looked at the <code>externs</code> part of the results</p>



<a name="272888717"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/219381-t-libs/topic/interpretting%20perf%20results/near/272888717" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> simulacrum <a href="https://zulip-archive.rust-lang.org/stream/219381-t-libs/topic/interpretting.20perf.20results.html#272888717">(Feb 23 2022 at 00:53)</a>:</h4>
<p>The externs benchmark is probably small enough to be okay</p>



<a name="272888869"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/219381-t-libs/topic/interpretting%20perf%20results/near/272888869" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jane Lusby [she/her] <a href="https://zulip-archive.rust-lang.org/stream/219381-t-libs/topic/interpretting.20perf.20results.html#272888869">(Feb 23 2022 at 00:55)</a>:</h4>
<p>oh i wasn't even looking at the right part of the data</p>



<a name="272888950"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/219381-t-libs/topic/interpretting%20perf%20results/near/272888950" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jane Lusby [she/her] <a href="https://zulip-archive.rust-lang.org/stream/219381-t-libs/topic/interpretting.20perf.20results.html#272888950">(Feb 23 2022 at 00:56)</a>:</h4>
<p>so the first section is actual benchmarks, and then the long list of things below that is just timings from the bootstrap build?</p>



<a name="272889110"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/219381-t-libs/topic/interpretting%20perf%20results/near/272889110" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jane Lusby [she/her] <a href="https://zulip-archive.rust-lang.org/stream/219381-t-libs/topic/interpretting.20perf.20results.html#272889110">(Feb 23 2022 at 00:58)</a>:</h4>
<p>haha, I found the externs benchmark</p>



<a name="272889282"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/219381-t-libs/topic/interpretting%20perf%20results/near/272889282" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jane Lusby [she/her] <a href="https://zulip-archive.rust-lang.org/stream/219381-t-libs/topic/interpretting.20perf.20results.html#272889282">(Feb 23 2022 at 01:00)</a>:</h4>
<p>okay so lmk if I'm understanding this right. The perf suite works by taking the compiler from your build and uses that to compile all of the benchmarks as well as bootstrap the compiler, and then the measured perf is how well your version of the compiler did at building all of those testcases?</p>



<a name="272889575"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/219381-t-libs/topic/interpretting%20perf%20results/near/272889575" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> simulacrum <a href="https://zulip-archive.rust-lang.org/stream/219381-t-libs/topic/interpretting.20perf.20results.html#272889575">(Feb 23 2022 at 01:04)</a>:</h4>
<p>Essentially, yes.</p>



<a name="272890036"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/219381-t-libs/topic/interpretting%20perf%20results/near/272890036" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jane Lusby [she/her] <a href="https://zulip-archive.rust-lang.org/stream/219381-t-libs/topic/interpretting.20perf.20results.html#272890036">(Feb 23 2022 at 01:11)</a>:</h4>
<p>cool okay, tyty</p>



<hr><p>Last updated: Apr 12 2022 at 20:01 UTC</p>
</html>