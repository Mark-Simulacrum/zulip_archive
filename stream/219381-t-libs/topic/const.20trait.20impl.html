<html>
<head><meta charset="utf-8"><title>const trait impl · t-libs · Zulip Chat Archive</title></head>
<h2>Stream: <a href="https://zulip-archive.rust-lang.org/stream/219381-t-libs/index.html">t-libs</a></h2>
<h3>Topic: <a href="https://zulip-archive.rust-lang.org/stream/219381-t-libs/topic/const.20trait.20impl.html">const trait impl</a></h3>

<hr>

<base href="https://rust-lang.zulipchat.com">

<head><link href="https://zulip-archive.rust-lang.org/style.css" rel="stylesheet"></head>

<a name="258472794"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/219381-t-libs/topic/const%20trait%20impl/near/258472794" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jacob Pratt <a href="https://zulip-archive.rust-lang.org/stream/219381-t-libs/topic/const.20trait.20impl.html#258472794">(Oct 21 2021 at 01:29)</a>:</h4>
<p>The only thing unresolved about const trait impls is the current <code>~const</code> syntax, right? If that's the case is there any reason we couldn't stabilize <code>impl const Trait</code> on its own? It wouldn't be possible for all cases, as some traits have bounded generics, but it <em>would</em> permit end users to implement a number of things (such as <code>Add</code>).</p>



<a name="258472816"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/219381-t-libs/topic/const%20trait%20impl/near/258472816" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jacob Pratt <a href="https://zulip-archive.rust-lang.org/stream/219381-t-libs/topic/const.20trait.20impl.html#258472816">(Oct 21 2021 at 01:29)</a>:</h4>
<p>There's no technical reason that I know of that would preclude a partial stabilization here.</p>



<a name="258503587"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/219381-t-libs/topic/const%20trait%20impl/near/258503587" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> oli <a href="https://zulip-archive.rust-lang.org/stream/219381-t-libs/topic/const.20trait.20impl.html#258503587">(Oct 21 2021 at 08:04)</a>:</h4>
<p>Well, const trait impls make adding a new default method to a trait a breaking change. We don't have a good strategy for this yet</p>



<a name="258573005"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/219381-t-libs/topic/const%20trait%20impl/near/258573005" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jacob Pratt <a href="https://zulip-archive.rust-lang.org/stream/219381-t-libs/topic/const.20trait.20impl.html#258573005">(Oct 21 2021 at 16:08)</a>:</h4>
<p>Could you elaborate? I think I understand but want to make sure.</p>



<a name="258573055"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/219381-t-libs/topic/const%20trait%20impl/near/258573055" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Gary Guo <a href="https://zulip-archive.rust-lang.org/stream/219381-t-libs/topic/const.20trait.20impl.html#258573055">(Oct 21 2021 at 16:08)</a>:</h4>
<p>We probably need to separate default impl from declaration for that.</p>



<a name="258573157"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/219381-t-libs/topic/const%20trait%20impl/near/258573157" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Gary Guo <a href="https://zulip-archive.rust-lang.org/stream/219381-t-libs/topic/const.20trait.20impl.html#258573157">(Oct 21 2021 at 16:09)</a>:</h4>
<p>Const impl needs to manually implement all default methods because default method impl can be non-const.</p>



<a name="258573697"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/219381-t-libs/topic/const%20trait%20impl/near/258573697" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> oli <a href="https://zulip-archive.rust-lang.org/stream/219381-t-libs/topic/const.20trait.20impl.html#258573697">(Oct 21 2021 at 16:12)</a>:</h4>
<p>basically even if you implemented all methods yourself, if the <code>trait</code> owner adds a non-const method, your crate breaks</p>



<a name="258573743"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/219381-t-libs/topic/const%20trait%20impl/near/258573743" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> oli <a href="https://zulip-archive.rust-lang.org/stream/219381-t-libs/topic/const.20trait.20impl.html#258573743">(Oct 21 2021 at 16:12)</a>:</h4>
<p>and right now, adding a new non-const defaulted method is not a breaking change</p>



<a name="258573838"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/219381-t-libs/topic/const%20trait%20impl/near/258573838" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jane Lusby [she/her] <a href="https://zulip-archive.rust-lang.org/stream/219381-t-libs/topic/const.20trait.20impl.html#258573838">(Oct 21 2021 at 16:13)</a>:</h4>
<p>Oh god</p>



<a name="258573917"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/219381-t-libs/topic/const%20trait%20impl/near/258573917" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> oli <a href="https://zulip-archive.rust-lang.org/stream/219381-t-libs/topic/const.20trait.20impl.html#258573917">(Oct 21 2021 at 16:13)</a>:</h4>
<p>yea</p>



<a name="258573977"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/219381-t-libs/topic/const%20trait%20impl/near/258573977" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> oli <a href="https://zulip-archive.rust-lang.org/stream/219381-t-libs/topic/const.20trait.20impl.html#258573977">(Oct 21 2021 at 16:14)</a>:</h4>
<p>thus my reluctance to move forward here, and I have no good ideas yet of how to fix it</p>



<a name="258574096"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/219381-t-libs/topic/const%20trait%20impl/near/258574096" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> oli <a href="https://zulip-archive.rust-lang.org/stream/219381-t-libs/topic/const.20trait.20impl.html#258574096">(Oct 21 2021 at 16:14)</a>:</h4>
<p>I need to write up the solution space in a doc and then we can weigh them against each other</p>



<a name="258574162"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/219381-t-libs/topic/const%20trait%20impl/near/258574162" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jane Lusby [she/her] <a href="https://zulip-archive.rust-lang.org/stream/219381-t-libs/topic/const.20trait.20impl.html#258574162">(Oct 21 2021 at 16:15)</a>:</h4>
<p>Yes please</p>



<a name="258574219"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/219381-t-libs/topic/const%20trait%20impl/near/258574219" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jane Lusby [she/her] <a href="https://zulip-archive.rust-lang.org/stream/219381-t-libs/topic/const.20trait.20impl.html#258574219">(Oct 21 2021 at 16:15)</a>:</h4>
<p>I was just about to ask if there's a write-up anywhere explaining why const impls can't inherit default impls</p>



<a name="258575048"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/219381-t-libs/topic/const%20trait%20impl/near/258575048" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> cuviper <a href="https://zulip-archive.rust-lang.org/stream/219381-t-libs/topic/const.20trait.20impl.html#258575048">(Oct 21 2021 at 16:20)</a>:</h4>
<p>there's a world of stuff the default impl could write that would not be supported in <code>const</code></p>



<a name="258575340"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/219381-t-libs/topic/const%20trait%20impl/near/258575340" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> cuviper <a href="https://zulip-archive.rust-lang.org/stream/219381-t-libs/topic/const.20trait.20impl.html#258575340">(Oct 21 2021 at 16:22)</a>:</h4>
<p>can this use some strategy similar to trait-object safety?</p>



<a name="258575396"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/219381-t-libs/topic/const%20trait%20impl/near/258575396" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jane Lusby [she/her] <a href="https://zulip-archive.rust-lang.org/stream/219381-t-libs/topic/const.20trait.20impl.html#258575396">(Oct 21 2021 at 16:22)</a>:</h4>
<p>I'm guessing one of the potential ways forward is to add an opt in restriction on the trait declaration that forces default impls to be always valid in const contexts, and then you could stabilize const impls on traits that have opted I already. But this would be pretty lousy because the std traits wouldn't be able to opt in since it would be breaking.</p>



<a name="258575496"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/219381-t-libs/topic/const%20trait%20impl/near/258575496" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jane Lusby [she/her] <a href="https://zulip-archive.rust-lang.org/stream/219381-t-libs/topic/const.20trait.20impl.html#258575496">(Oct 21 2021 at 16:23)</a>:</h4>
<p>But at least that would make it available to 3rd party traits</p>



<a name="258661477"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/219381-t-libs/topic/const%20trait%20impl/near/258661477" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jacob Pratt <a href="https://zulip-archive.rust-lang.org/stream/219381-t-libs/topic/const.20trait.20impl.html#258661477">(Oct 22 2021 at 04:35)</a>:</h4>
<p>I don't know what form this would take, but the trait definition could have some attribute/syntax that indicates its implementations could be used in const contexts, implicitly providing a forward guarantee of const-capable default implementations. The caller of the trait method wouldn't need to know about this, only whether the trait implementation for the type is const.</p>



<a name="258661620"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/219381-t-libs/topic/const%20trait%20impl/near/258661620" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jacob Pratt <a href="https://zulip-archive.rust-lang.org/stream/219381-t-libs/topic/const.20trait.20impl.html#258661620">(Oct 22 2021 at 04:37)</a>:</h4>
<p>Notably non-const end implementations could still exist. This would allow usage in stdlib.</p>



<a name="258802434"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/219381-t-libs/topic/const%20trait%20impl/near/258802434" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Charles Lew <a href="https://zulip-archive.rust-lang.org/stream/219381-t-libs/topic/const.20trait.20impl.html#258802434">(Oct 23 2021 at 04:20)</a>:</h4>
<p>I feel const traits are a lot like async traits: modifier/transforms on associated function types; and syntax sugar for recognizing the traits that got all its associated functions transformed . Async trait is currently another unsolved problem, maybe these two can be investigated in depth together.</p>



<a name="258802448"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/219381-t-libs/topic/const%20trait%20impl/near/258802448" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Charles Lew <a href="https://zulip-archive.rust-lang.org/stream/219381-t-libs/topic/const.20trait.20impl.html#258802448">(Oct 23 2021 at 04:20)</a>:</h4>
<p>And this is quite a T-lang issue.</p>



<a name="258841975"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/219381-t-libs/topic/const%20trait%20impl/near/258841975" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jacob Pratt <a href="https://zulip-archive.rust-lang.org/stream/219381-t-libs/topic/const.20trait.20impl.html#258841975">(Oct 23 2021 at 20:49)</a>:</h4>
<p>How is this remotely similar to async functions? Those are related to GATs, whereas this is solely about stability of something. Though I agree this discussion quickly moved to T-lang territory</p>



<hr><p>Last updated: Apr 12 2022 at 20:01 UTC</p>
</html>