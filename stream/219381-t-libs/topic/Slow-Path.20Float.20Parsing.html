<html>
<head><meta charset="utf-8"><title>Slow-Path Float Parsing · t-libs · Zulip Chat Archive</title></head>
<h2>Stream: <a href="https://zulip-archive.rust-lang.org/stream/219381-t-libs/index.html">t-libs</a></h2>
<h3>Topic: <a href="https://zulip-archive.rust-lang.org/stream/219381-t-libs/topic/Slow-Path.20Float.20Parsing.html">Slow-Path Float Parsing</a></h3>

<hr>

<base href="https://rust-lang.zulipchat.com">

<head><link href="https://zulip-archive.rust-lang.org/style.css" rel="stylesheet"></head>

<a name="252195915"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/219381-t-libs/topic/Slow-Path%20Float%20Parsing/near/252195915" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Alexander Huszagh (He/Him) <a href="https://zulip-archive.rust-lang.org/stream/219381-t-libs/topic/Slow-Path.20Float.20Parsing.html#252195915">(Sep 06 2021 at 16:10)</a>:</h4>
<p>I'm not sure if there's any interest, but while further optimizing number conversion routines, I noticed that the decimal implementation in <code>dec2flt</code> (which is only for very rare cases) is fairly slow, and can be optimized by ~6-45x using relatively simple big-integer arithmetic. I've described the issue <a href="https://github.com/rust-lang/rust/issues/88656">here</a>, and if there's any interest would be more than happy to submit a PR.</p>



<a name="252201265"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/219381-t-libs/topic/Slow-Path%20Float%20Parsing/near/252201265" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Triplett <a href="https://zulip-archive.rust-lang.org/stream/219381-t-libs/topic/Slow-Path.20Float.20Parsing.html#252201265">(Sep 06 2021 at 17:04)</a>:</h4>
<p>That is a very impressive and detailed write-up.</p>



<a name="252201356"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/219381-t-libs/topic/Slow-Path%20Float%20Parsing/near/252201356" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Triplett <a href="https://zulip-archive.rust-lang.org/stream/219381-t-libs/topic/Slow-Path.20Float.20Parsing.html#252201356">(Sep 06 2021 at 17:05)</a>:</h4>
<p>I think we'd love to have a faster algorithm for decimal-to-float conversion, as long as it comes with benchmarks showing that.</p>



<a name="252202803"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/219381-t-libs/topic/Slow-Path%20Float%20Parsing/near/252202803" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> The 8472 <a href="https://zulip-archive.rust-lang.org/stream/219381-t-libs/topic/Slow-Path.20Float.20Parsing.html#252202803">(Sep 06 2021 at 17:18)</a>:</h4>
<p>are those halfway floats esoteric edge-cases or do large amounts of them occur in realworld serialized data?</p>



<a name="252203754"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/219381-t-libs/topic/Slow-Path%20Float%20Parsing/near/252203754" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Alexander Huszagh (He/Him) <a href="https://zulip-archive.rust-lang.org/stream/219381-t-libs/topic/Slow-Path.20Float.20Parsing.html#252203754">(Sep 06 2021 at 17:27)</a>:</h4>
<p><span class="user-mention silent" data-user-id="330154">The 8472</span> <a href="#narrow/stream/219381-t-libs/topic/Slow-Path.20Float.20Parsing/near/252202803">said</a>:</p>
<blockquote>
<p>are those halfway floats esoteric edge-cases or do large amounts of them occur in realworld serialized data?</p>
</blockquote>
<p>Very esoteric edge-cases. They're very rare in real-world cases, but when they do occur, they can be much, much slower than faster cases. For example, the string <code>8.988465674311580536e307</code>parses in ~30ns, while the string <code>8.9884656743115805365666807213e307</code> takes ~350ns with my implementation, and generally ~15us+ with most other implementations, including netlib's dtoa, fast_float (the C++ implementation upon which Rust's dec2flt is based on), as well as Rust core.</p>



<a name="252203893"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/219381-t-libs/topic/Slow-Path%20Float%20Parsing/near/252203893" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Alexander Huszagh (He/Him) <a href="https://zulip-archive.rust-lang.org/stream/219381-t-libs/topic/Slow-Path.20Float.20Parsing.html#252203893">(Sep 06 2021 at 17:28)</a>:</h4>
<p><span class="user-mention silent" data-user-id="239881">Josh Triplett</span> <a href="#narrow/stream/219381-t-libs/topic/Slow-Path.20Float.20Parsing/near/252201356">said</a>:</p>
<blockquote>
<p>I think we'd love to have a faster algorithm for decimal-to-float conversion, as long as it comes with benchmarks showing that.</p>
</blockquote>
<p>Wonderful, I'll write the implementation then, and show benchmarks demonstrating that.</p>



<hr><p>Last updated: Apr 12 2022 at 20:01 UTC</p>
</html>