<html>
<head><meta charset="utf-8"><title>Inherent function is not prioritized in tests? · t-libs · Zulip Chat Archive</title></head>
<h2>Stream: <a href="https://zulip-archive.rust-lang.org/stream/219381-t-libs/index.html">t-libs</a></h2>
<h3>Topic: <a href="https://zulip-archive.rust-lang.org/stream/219381-t-libs/topic/Inherent.20function.20is.20not.20prioritized.20in.20tests.3F.html">Inherent function is not prioritized in tests?</a></h3>

<hr>

<base href="https://rust-lang.zulipchat.com">

<head><link href="https://zulip-archive.rust-lang.org/style.css" rel="stylesheet"></head>

<a name="270902277"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/219381-t-libs/topic/Inherent%20function%20is%20not%20prioritized%20in%20tests%3F/near/270902277" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Waffle Lapkin <a href="https://zulip-archive.rust-lang.org/stream/219381-t-libs/topic/Inherent.20function.20is.20not.20prioritized.20in.20tests.3F.html#270902277">(Feb 06 2022 at 17:55)</a>:</h4>
<p>While working on <a href="https://github.com/rust-lang/rust/pull/93709">https://github.com/rust-lang/rust/pull/93709</a> I stumbled upon weird behaviour: </p>
<div class="codehilite"><pre><span></span><code>error[E0061]: this function takes 1 argument but 0 arguments were supplied
   --&gt; library/alloc/src/collections/btree/set/tests.rs:383:20
    |
383 |     assert_eq!(set.min().unwrap().id(), 1);
    |                    ^^^- supplied 0 arguments
    |                    |
    |                    expected 1 argument
    |
note: associated function defined here
   --&gt; /home/waffle/projects/repos/rust2/library/core/src/cmp.rs:816:8
    |
816 |     fn min(self, other: Self) -&gt; Self
    |        ^^^
</code></pre></div>
<p>Even though I've <a href="https://github.com/rust-lang/rust/pull/93709/files#diff-9a2ef4e4c7d97aa881a78d345ec96b7238baa4bd06472c3b2d8a436737be15bfR686">defined</a> inherent method <code>BTreeSet::min</code> and <code>library/alloc</code> builds just fine while <a href="https://github.com/rust-lang/rust/pull/93709/files#diff-9a2ef4e4c7d97aa881a78d345ec96b7238baa4bd06472c3b2d8a436737be15bfR327">using this method</a>. Is there something special about compiling tests?</p>



<a name="270902778"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/219381-t-libs/topic/Inherent%20function%20is%20not%20prioritized%20in%20tests%3F/near/270902778" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Waffle Lapkin <a href="https://zulip-archive.rust-lang.org/stream/219381-t-libs/topic/Inherent.20function.20is.20not.20prioritized.20in.20tests.3F.html#270902778">(Feb 06 2022 at 18:04)</a>:</h4>
<p>It's also weird that Rust Analyzer finds the right method</p>
<p><a href="/user_uploads/4715/7Wep-HMcBnerCMSS89QpeSJb/2022-02-06_21-03.png">2022-02-06_21-03.png</a></p>
<div class="message_inline_image"><a href="/user_uploads/4715/7Wep-HMcBnerCMSS89QpeSJb/2022-02-06_21-03.png" title="2022-02-06_21-03.png"><img src="/user_uploads/4715/7Wep-HMcBnerCMSS89QpeSJb/2022-02-06_21-03.png"></a></div>



<a name="270903014"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/219381-t-libs/topic/Inherent%20function%20is%20not%20prioritized%20in%20tests%3F/near/270903014" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Waffle Lapkin <a href="https://zulip-archive.rust-lang.org/stream/219381-t-libs/topic/Inherent.20function.20is.20not.20prioritized.20in.20tests.3F.html#270903014">(Feb 06 2022 at 18:09)</a>:</h4>
<p>Huh? This does not compile too:</p>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="cp">#[derive(PartialEq, PartialOrd, Eq, Ord)]</span><span class="w"></span>
<span class="k">struct</span> <span class="nc">Mine</span><span class="p">;</span><span class="w"></span>

<span class="k">impl</span><span class="w"> </span><span class="n">Mine</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="k">fn</span> <span class="nf">min</span><span class="p">(</span><span class="o">&amp;</span><span class="bp">self</span><span class="p">)</span><span class="w"> </span>-&gt; <span class="nb">Option</span><span class="o">&lt;&amp;</span><span class="kt">u32</span><span class="o">&gt;</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nb">None</span><span class="w"> </span><span class="p">}</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>

<span class="k">fn</span> <span class="nf">main</span><span class="p">()</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="n">Mine</span><span class="p">.</span><span class="n">min</span><span class="p">();</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>
</code></pre></div>
<p><a href="https://play.rust-lang.org/?version=stable&amp;mode=debug&amp;edition=2021&amp;gist=61fcaec8b63c0be18367cf2651aafeb2">https://play.rust-lang.org/?version=stable&amp;mode=debug&amp;edition=2021&amp;gist=61fcaec8b63c0be18367cf2651aafeb2</a></p>
<p>Shouldn't inherent methods always take precedence over trait ones?</p>



<a name="270903234"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/219381-t-libs/topic/Inherent%20function%20is%20not%20prioritized%20in%20tests%3F/near/270903234" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Lukas Wirth <a href="https://zulip-archive.rust-lang.org/stream/219381-t-libs/topic/Inherent.20function.20is.20not.20prioritized.20in.20tests.3F.html#270903234">(Feb 06 2022 at 18:14)</a>:</h4>
<p><del>Not if the trait is in scope afaik, and since <code>Ord</code> is in the prelude it takes over here</del></p>



<a name="270903263"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/219381-t-libs/topic/Inherent%20function%20is%20not%20prioritized%20in%20tests%3F/near/270903263" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Lukas Wirth <a href="https://zulip-archive.rust-lang.org/stream/219381-t-libs/topic/Inherent.20function.20is.20not.20prioritized.20in.20tests.3F.html#270903263">(Feb 06 2022 at 18:15)</a>:</h4>
<p><del>(so r-a resolving it to the inherent method is probably a bug)</del></p>



<a name="270903433"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/219381-t-libs/topic/Inherent%20function%20is%20not%20prioritized%20in%20tests%3F/near/270903433" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Waffle Lapkin <a href="https://zulip-archive.rust-lang.org/stream/219381-t-libs/topic/Inherent.20function.20is.20not.20prioritized.20in.20tests.3F.html#270903433">(Feb 06 2022 at 18:18)</a>:</h4>
<p><span class="user-mention silent" data-user-id="300586">Lukas Wirth</span> <a href="#narrow/stream/219381-t-libs/topic/Inherent.20function.20is.20not.20prioritized.20in.20tests.3F/near/270903234">said</a>:</p>
<blockquote>
<p>Not if the trait is in scope afaik, and since <code>Ord</code> is in the prelude it takes over here</p>
</blockquote>
<p>Nope, the inherent method should take precedence even if the trait is in scope, I think. For example, this compiles just fine:</p>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="cp">#[derive(PartialEq, PartialOrd, Eq, Ord)]</span><span class="w"></span>
<span class="k">struct</span> <span class="nc">Mine</span><span class="p">;</span><span class="w"></span>

<span class="k">impl</span><span class="w"> </span><span class="n">Mine</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="k">pub</span><span class="w"> </span><span class="k">fn</span> <span class="nf">min</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span><span class="w"> </span><span class="p">{}</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>

<span class="k">fn</span> <span class="nf">main</span><span class="p">()</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="n">Mine</span><span class="p">.</span><span class="n">min</span><span class="p">();</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>
</code></pre></div>
<p><a href="https://play.rust-lang.org/?version=nightly&amp;mode=debug&amp;edition=2021&amp;gist=3b83547065f25a1f015b1659901dbed4">https://play.rust-lang.org/?version=nightly&amp;mode=debug&amp;edition=2021&amp;gist=3b83547065f25a1f015b1659901dbed4</a></p>



<a name="270903551"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/219381-t-libs/topic/Inherent%20function%20is%20not%20prioritized%20in%20tests%3F/near/270903551" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Waffle Lapkin <a href="https://zulip-archive.rust-lang.org/stream/219381-t-libs/topic/Inherent.20function.20is.20not.20prioritized.20in.20tests.3F.html#270903551">(Feb 06 2022 at 18:21)</a>:</h4>
<p>Moreover this is a regression introduced in 1.20.0?</p>
<p><a href="/user_uploads/4715/3dwfuRXIMsw8TWNTpqykJjc9/2022-02-06_21-21.png">2022-02-06_21-21.png</a></p>
<div class="message_inline_image"><a href="/user_uploads/4715/3dwfuRXIMsw8TWNTpqykJjc9/2022-02-06_21-21.png" title="2022-02-06_21-21.png"><img src="/user_uploads/4715/3dwfuRXIMsw8TWNTpqykJjc9/2022-02-06_21-21.png"></a></div>



<a name="270903699"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/219381-t-libs/topic/Inherent%20function%20is%20not%20prioritized%20in%20tests%3F/near/270903699" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> bjorn3 <a href="https://zulip-archive.rust-lang.org/stream/219381-t-libs/topic/Inherent.20function.20is.20not.20prioritized.20in.20tests.3F.html#270903699">(Feb 06 2022 at 18:24)</a>:</h4>
<p>I think it looks at the trait impl first before trying to do add a reference to the receiver and trying to resolve the method for this. So inherent <code>fn min(self)</code> -&gt; trait impl <code>fn min(self)</code> -&gt; inherent <code>fn min(&amp;self)</code> -&gt; trait impl <code>fn min(&amp;self)</code>.</p>



<a name="270903788"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/219381-t-libs/topic/Inherent%20function%20is%20not%20prioritized%20in%20tests%3F/near/270903788" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Waffle Lapkin <a href="https://zulip-archive.rust-lang.org/stream/219381-t-libs/topic/Inherent.20function.20is.20not.20prioritized.20in.20tests.3F.html#270903788">(Feb 06 2022 at 18:26)</a>:</h4>
<p>Yes, but since this compiled fine before 1.20, this seems like a bug in auto-ref/method resolution logic</p>



<a name="270903949"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/219381-t-libs/topic/Inherent%20function%20is%20not%20prioritized%20in%20tests%3F/near/270903949" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> The 8472 <a href="https://zulip-archive.rust-lang.org/stream/219381-t-libs/topic/Inherent.20function.20is.20not.20prioritized.20in.20tests.3F.html#270903949">(Feb 06 2022 at 18:29)</a>:</h4>
<p>Ord::min was stabilized in 1.21</p>



<hr><p>Last updated: Apr 12 2022 at 20:01 UTC</p>
</html>