<html>
<head><meta charset="utf-8"><title>Introducing some of itertools into stblib · t-libs · Zulip Chat Archive</title></head>
<h2>Stream: <a href="https://zulip-archive.rust-lang.org/stream/219381-t-libs/index.html">t-libs</a></h2>
<h3>Topic: <a href="https://zulip-archive.rust-lang.org/stream/219381-t-libs/topic/Introducing.20some.20of.20itertools.20into.20stblib.html">Introducing some of itertools into stblib</a></h3>

<hr>

<base href="https://rust-lang.zulipchat.com">

<head><link href="https://zulip-archive.rust-lang.org/style.css" rel="stylesheet"></head>

<a name="257923498"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/219381-t-libs/topic/Introducing%20some%20of%20itertools%20into%20stblib/near/257923498" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Elichai Turkel <a href="https://zulip-archive.rust-lang.org/stream/219381-t-libs/topic/Introducing.20some.20of.20itertools.20into.20stblib.html#257923498">(Oct 17 2021 at 14:35)</a>:</h4>
<p>So I looked for an hour today for how to combine 2 iterators such that I get one element from each iterator at a time.<br>
I tried combining chain and map and could figure it out. and after I failed I started googling for a while until I found <code>interleave</code> in itertools.<br>
this function seem like a natural extension to <code>chain</code> and <code>zip</code>.<br>
I wonder what's the policy here and if we could introduce some of <code>itertools</code> into the standard library</p>



<a name="257923733"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/219381-t-libs/topic/Introducing%20some%20of%20itertools%20into%20stblib/near/257923733" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Elichai Turkel <a href="https://zulip-archive.rust-lang.org/stream/219381-t-libs/topic/Introducing.20some.20of.20itertools.20into.20stblib.html#257923733">(Oct 17 2021 at 14:38)</a>:</h4>
<p>If the only reason is because no one opened a PR I'm willing to open a PR for <code>interleave</code> or a few other ones that seems very useful and simple</p>



<a name="257924802"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/219381-t-libs/topic/Introducing%20some%20of%20itertools%20into%20stblib/near/257924802" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> cuviper <a href="https://zulip-archive.rust-lang.org/stream/219381-t-libs/topic/Introducing.20some.20of.20itertools.20into.20stblib.html#257924802">(Oct 17 2021 at 14:55)</a>:</h4>
<p>It's tricky for compatability -- look what just happened with <code>intersperse</code></p>



<a name="257988846"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/219381-t-libs/topic/Introducing%20some%20of%20itertools%20into%20stblib/near/257988846" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Triplett <a href="https://zulip-archive.rust-lang.org/stream/219381-t-libs/topic/Introducing.20some.20of.20itertools.20into.20stblib.html#257988846">(Oct 18 2021 at 07:40)</a>:</h4>
<p>/me nods</p>



<a name="257988884"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/219381-t-libs/topic/Introducing%20some%20of%20itertools%20into%20stblib/near/257988884" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Triplett <a href="https://zulip-archive.rust-lang.org/stream/219381-t-libs/topic/Introducing.20some.20of.20itertools.20into.20stblib.html#257988884">(Oct 18 2021 at 07:40)</a>:</h4>
<p>I think if we had a better way to avoid breaking compatibility with the same functions in itertools, we'd be much more willing to add more functions from itertools.</p>



<a name="257991885"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/219381-t-libs/topic/Introducing%20some%20of%20itertools%20into%20stblib/near/257991885" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Mario Carneiro <a href="https://zulip-archive.rust-lang.org/stream/219381-t-libs/topic/Introducing.20some.20of.20itertools.20into.20stblib.html#257991885">(Oct 18 2021 at 08:10)</a>:</h4>
<p>Has anyone tried using something like <code>#[cfg(rustc_version = "&lt;1.56.0")]</code> in itertools to make certain trait functions disappear on versions of rustc that upstream the method? I know it's not a perfect solution, but it's a very versatile technique</p>



<a name="257995047"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/219381-t-libs/topic/Introducing%20some%20of%20itertools%20into%20stblib/near/257995047" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> oli <a href="https://zulip-archive.rust-lang.org/stream/219381-t-libs/topic/Introducing.20some.20of.20itertools.20into.20stblib.html#257995047">(Oct 18 2021 at 08:41)</a>:</h4>
<p>Another alternative would be to add the notion of "weak" methods, that will essentially be hidden if there'san ambiguity (like weak linkage). Or have a way of only allowing to call it starting at an edition.</p>



<a name="258002187"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/219381-t-libs/topic/Introducing%20some%20of%20itertools%20into%20stblib/near/258002187" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Simon Sapin <a href="https://zulip-archive.rust-lang.org/stream/219381-t-libs/topic/Introducing.20some.20of.20itertools.20into.20stblib.html#258002187">(Oct 18 2021 at 09:45)</a>:</h4>
<p>If a new method is only "visible" in a new edition, when I migrate my crate the fix is to stop having the itertools trait in scope to resolve the ambiguity. But that means I can’t (as easily) also use other methods of that trait that don’t exist in std</p>



<a name="258004850"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/219381-t-libs/topic/Introducing%20some%20of%20itertools%20into%20stblib/near/258004850" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> The 8472 <a href="https://zulip-archive.rust-lang.org/stream/219381-t-libs/topic/Introducing.20some.20of.20itertools.20into.20stblib.html#258004850">(Oct 18 2021 at 10:08)</a>:</h4>
<p>you could also switch to fully qualified functions, although that's ugly in iterator chains. or use imports more selectively</p>



<a name="258014641"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/219381-t-libs/topic/Introducing%20some%20of%20itertools%20into%20stblib/near/258014641" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> inquisitivecrystal <a href="https://zulip-archive.rust-lang.org/stream/219381-t-libs/topic/Introducing.20some.20of.20itertools.20into.20stblib.html#258014641">(Oct 18 2021 at 11:38)</a>:</h4>
<p>We could also just magic it (make a special attribute that resolves the conflict in favor of our version instead of erroring). I feel like this is an unusually good case for magic, given the unique demands on the standard library.</p>



<a name="258054026"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/219381-t-libs/topic/Introducing%20some%20of%20itertools%20into%20stblib/near/258054026" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> The 8472 <a href="https://zulip-archive.rust-lang.org/stream/219381-t-libs/topic/Introducing.20some.20of.20itertools.20into.20stblib.html#258054026">(Oct 18 2021 at 16:09)</a>:</h4>
<p>not necessarily. a general mechanism to resolve conflicts could also be useful for other kinds of extension trait providing libraries to avoid conflicts with others.</p>



<a name="258055601"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/219381-t-libs/topic/Introducing%20some%20of%20itertools%20into%20stblib/near/258055601" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Triplett <a href="https://zulip-archive.rust-lang.org/stream/219381-t-libs/topic/Introducing.20some.20of.20itertools.20into.20stblib.html#258055601">(Oct 18 2021 at 16:18)</a>:</h4>
<p>/me really wishes someone had the bandwidth to implement a subset of <code>cfg(accessible(...))</code>.</p>



<a name="258055673"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/219381-t-libs/topic/Introducing%20some%20of%20itertools%20into%20stblib/near/258055673" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Triplett <a href="https://zulip-archive.rust-lang.org/stream/219381-t-libs/topic/Introducing.20some.20of.20itertools.20into.20stblib.html#258055673">(Oct 18 2021 at 16:19)</a>:</h4>
<p>(Such as the subset that requires the argument to start with <code>std::</code> or <code>alloc::</code> or <code>core::</code>.)</p>



<a name="258056807"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/219381-t-libs/topic/Introducing%20some%20of%20itertools%20into%20stblib/near/258056807" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Triplett <a href="https://zulip-archive.rust-lang.org/stream/219381-t-libs/topic/Introducing.20some.20of.20itertools.20into.20stblib.html#258056807">(Oct 18 2021 at 16:24)</a>:</h4>
<p><span class="user-mention silent" data-user-id="417924">inquisitivecrystal</span> <a href="#narrow/stream/219381-t-libs/topic/Introducing.20some.20of.20itertools.20into.20stblib/near/258014641">said</a>:</p>
<blockquote>
<p>We could also just magic it (make a special attribute that resolves the conflict in favor of our version instead of erroring). I feel like this is an unusually good case for magic, given the unique demands on the standard library.</p>
</blockquote>
<p>I don't actually think we'd want to resolve in favor of ours; I think we'd want to resolve in favor of the external one, and deprioritize ours. If someone's linking in a crate, let's assume they want the crate.</p>



<a name="258099314"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/219381-t-libs/topic/Introducing%20some%20of%20itertools%20into%20stblib/near/258099314" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> scottmcm <a href="https://zulip-archive.rust-lang.org/stream/219381-t-libs/topic/Introducing.20some.20of.20itertools.20into.20stblib.html#258099314">(Oct 18 2021 at 21:00)</a>:</h4>
<p>Current IRLO thread about this: <a href="https://internals.rust-lang.org/t/pre-pre-rfc-give-trait-methods-a-priority-for-resolving-name-clashes/15455?u=scottmcm">https://internals.rust-lang.org/t/pre-pre-rfc-give-trait-methods-a-priority-for-resolving-name-clashes/15455?u=scottmcm</a></p>



<a name="258099771"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/219381-t-libs/topic/Introducing%20some%20of%20itertools%20into%20stblib/near/258099771" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> scottmcm <a href="https://zulip-archive.rust-lang.org/stream/219381-t-libs/topic/Introducing.20some.20of.20itertools.20into.20stblib.html#258099771">(Oct 18 2021 at 21:02)</a>:</h4>
<p>One version of "deprioritize ours" would be some form of "prefer trait methods not from the prelude before trait methods from the prelude" -- I think that would have also fixed the <code>.try_into()</code> problems.  (And then if you explicitly <code>use Iterator;</code>'d then you'd get the ambiguity again.)</p>
<p>Basically the same thing we already do for type names.</p>



<a name="258173535"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/219381-t-libs/topic/Introducing%20some%20of%20itertools%20into%20stblib/near/258173535" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Triplett <a href="https://zulip-archive.rust-lang.org/stream/219381-t-libs/topic/Introducing.20some.20of.20itertools.20into.20stblib.html#258173535">(Oct 19 2021 at 10:43)</a>:</h4>
<p>That would solve the problem for the prelude, but wouldn't solve the problem for traits that people commonly import that are implemented on types for which external crates also provide additional helpers.</p>



<a name="258173616"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/219381-t-libs/topic/Introducing%20some%20of%20itertools%20into%20stblib/near/258173616" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Triplett <a href="https://zulip-archive.rust-lang.org/stream/219381-t-libs/topic/Introducing.20some.20of.20itertools.20into.20stblib.html#258173616">(Oct 19 2021 at 10:44)</a>:</h4>
<p>For instance, consider what would happen if we add additional methods to the Read trait, and those methods happen to conflict with methods provided by a common third-party trait.</p>



<a name="258173663"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/219381-t-libs/topic/Introducing%20some%20of%20itertools%20into%20stblib/near/258173663" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Triplett <a href="https://zulip-archive.rust-lang.org/stream/219381-t-libs/topic/Introducing.20some.20of.20itertools.20into.20stblib.html#258173663">(Oct 19 2021 at 10:44)</a>:</h4>
<p>Rather than taking the prelude into account, could we (and should we) just deprioritize anything that comes from the standard library, compared to a third party crate?</p>



<a name="258184342"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/219381-t-libs/topic/Introducing%20some%20of%20itertools%20into%20stblib/near/258184342" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> The 8472 <a href="https://zulip-archive.rust-lang.org/stream/219381-t-libs/topic/Introducing.20some.20of.20itertools.20into.20stblib.html#258184342">(Oct 19 2021 at 12:18)</a>:</h4>
<p>why not last-import-wins + a warning?</p>



<a name="258184597"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/219381-t-libs/topic/Introducing%20some%20of%20itertools%20into%20stblib/near/258184597" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> The 8472 <a href="https://zulip-archive.rust-lang.org/stream/219381-t-libs/topic/Introducing.20some.20of.20itertools.20into.20stblib.html#258184597">(Oct 19 2021 at 12:20)</a>:</h4>
<p>mhm, no that would be bad if some formatter rearranges imports</p>



<a name="258185684"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/219381-t-libs/topic/Introducing%20some%20of%20itertools%20into%20stblib/near/258185684" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Triplett <a href="https://zulip-archive.rust-lang.org/stream/219381-t-libs/topic/Introducing.20some.20of.20itertools.20into.20stblib.html#258185684">(Oct 19 2021 at 12:29)</a>:</h4>
<p>Right, normally order doesn't matter.</p>



<a name="258186332"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/219381-t-libs/topic/Introducing%20some%20of%20itertools%20into%20stblib/near/258186332" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> The 8472 <a href="https://zulip-archive.rust-lang.org/stream/219381-t-libs/topic/Introducing.20some.20of.20itertools.20into.20stblib.html#258186332">(Oct 19 2021 at 12:35)</a>:</h4>
<p>A way to more selectively import methods of a trait could work, but that'd require new syntax or annotations.</p>



<a name="258186525"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/219381-t-libs/topic/Introducing%20some%20of%20itertools%20into%20stblib/near/258186525" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Gary Guo <a href="https://zulip-archive.rust-lang.org/stream/219381-t-libs/topic/Introducing.20some.20of.20itertools.20into.20stblib.html#258186525">(Oct 19 2021 at 12:36)</a>:</h4>
<p>We need a way to UFCS an inherent method first</p>



<a name="258186794"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/219381-t-libs/topic/Introducing%20some%20of%20itertools%20into%20stblib/near/258186794" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> The 8472 <a href="https://zulip-archive.rust-lang.org/stream/219381-t-libs/topic/Introducing.20some.20of.20itertools.20into.20stblib.html#258186794">(Oct 19 2021 at 12:38)</a>:</h4>
<p>but you can already do that? <code>Type::method_name(receiver, rest of args)</code></p>



<a name="258187527"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/219381-t-libs/topic/Introducing%20some%20of%20itertools%20into%20stblib/near/258187527" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> The 8472 <a href="https://zulip-archive.rust-lang.org/stream/219381-t-libs/topic/Introducing.20some.20of.20itertools.20into.20stblib.html#258187527">(Oct 19 2021 at 12:44)</a>:</h4>
<p>or do you mean better syntax for chaining them?</p>



<a name="258187931"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/219381-t-libs/topic/Introducing%20some%20of%20itertools%20into%20stblib/near/258187931" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> The 8472 <a href="https://zulip-archive.rust-lang.org/stream/219381-t-libs/topic/Introducing.20some.20of.20itertools.20into.20stblib.html#258187931">(Oct 19 2021 at 12:47)</a>:</h4>
<p>postfix macros could do that. <code>iter.call!(Itertools::interleave, arg, ...)</code></p>



<a name="258187947"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/219381-t-libs/topic/Introducing%20some%20of%20itertools%20into%20stblib/near/258187947" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> cuviper <a href="https://zulip-archive.rust-lang.org/stream/219381-t-libs/topic/Introducing.20some.20of.20itertools.20into.20stblib.html#258187947">(Oct 19 2021 at 12:47)</a>:</h4>
<p><code>Type::method_name</code> can also refer to a trait implementation on that type.</p>



<a name="258199669"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/219381-t-libs/topic/Introducing%20some%20of%20itertools%20into%20stblib/near/258199669" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Simon Sapin <a href="https://zulip-archive.rust-lang.org/stream/219381-t-libs/topic/Introducing.20some.20of.20itertools.20into.20stblib.html#258199669">(Oct 19 2021 at 14:03)</a>:</h4>
<blockquote>
<p>you could also switch to fully qualified functions</p>
</blockquote>
<p>that’s what I meant by not as easily</p>



<a name="258316734"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/219381-t-libs/topic/Introducing%20some%20of%20itertools%20into%20stblib/near/258316734" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Mario Carneiro <a href="https://zulip-archive.rust-lang.org/stream/219381-t-libs/topic/Introducing.20some.20of.20itertools.20into.20stblib.html#258316734">(Oct 20 2021 at 06:02)</a>:</h4>
<p><code>&lt;Type as Self&gt;::method_name</code>?</p>



<hr><p>Last updated: Apr 12 2022 at 20:01 UTC</p>
</html>