<html>
<head><meta charset="utf-8"><title>`swap_unchecked` · t-libs · Zulip Chat Archive</title></head>
<h2>Stream: <a href="https://zulip-archive.rust-lang.org/stream/219381-t-libs/index.html">t-libs</a></h2>
<h3>Topic: <a href="https://zulip-archive.rust-lang.org/stream/219381-t-libs/topic/.60swap_unchecked.60.html">`swap_unchecked`</a></h3>

<hr>

<base href="https://rust-lang.zulipchat.com">

<head><link href="https://zulip-archive.rust-lang.org/style.css" rel="stylesheet"></head>

<a name="273289027"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/219381-t-libs/topic/%60swap_unchecked%60/near/273289027" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ibraheem Ahmed <a href="https://zulip-archive.rust-lang.org/stream/219381-t-libs/topic/.60swap_unchecked.60.html#273289027">(Feb 25 2022 at 21:49)</a>:</h4>
<p>Can someone start an FCP for <a href="https://github.com/rust-lang/rust/issues/88539">https://github.com/rust-lang/rust/issues/88539</a>?</p>



<a name="273289103"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/219381-t-libs/topic/%60swap_unchecked%60/near/273289103" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ibraheem Ahmed <a href="https://zulip-archive.rust-lang.org/stream/219381-t-libs/topic/.60swap_unchecked.60.html#273289103">(Feb 25 2022 at 21:49)</a>:</h4>
<p>It's been around 6 months with no comments, and it's a pretty straightforward addition</p>



<a name="274272568"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/219381-t-libs/topic/%60swap_unchecked%60/near/274272568" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ibraheem Ahmed <a href="https://zulip-archive.rust-lang.org/stream/219381-t-libs/topic/.60swap_unchecked.60.html#274272568">(Mar 05 2022 at 23:48)</a>:</h4>
<p>cc <span class="user-group-mention" data-user-group-id="2645">@T-libs-api</span></p>



<a name="274286780"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/219381-t-libs/topic/%60swap_unchecked%60/near/274286780" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Triplett <a href="https://zulip-archive.rust-lang.org/stream/219381-t-libs/topic/.60swap_unchecked.60.html#274286780">(Mar 06 2022 at 05:33)</a>:</h4>
<p>Do we have any reports of it being used?</p>



<a name="274308818"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/219381-t-libs/topic/%60swap_unchecked%60/near/274308818" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Lokathor <a href="https://zulip-archive.rust-lang.org/stream/219381-t-libs/topic/.60swap_unchecked.60.html#274308818">(Mar 06 2022 at 14:31)</a>:</h4>
<p>(Speaking just for myself, I'd never bother to enable a feature for such a trivial individual function. I'd honestly just rather implement it myself.)</p>



<a name="274311251"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/219381-t-libs/topic/%60swap_unchecked%60/near/274311251" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ben Kimock (Saethlin) <a href="https://zulip-archive.rust-lang.org/stream/219381-t-libs/topic/.60swap_unchecked.60.html#274311251">(Mar 06 2022 at 15:22)</a>:</h4>
<p>I can't find any usage of it in GitHub code search or any attempts at implementation that produce SB invalidation. Though my searching is clearly not very good, I mostly got forks of rust, bitvec, and nalgebra</p>



<a name="276728560"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/219381-t-libs/topic/%60swap_unchecked%60/near/276728560" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nagisa <a href="https://zulip-archive.rust-lang.org/stream/219381-t-libs/topic/.60swap_unchecked.60.html#276728560">(Mar 26 2022 at 14:24)</a>:</h4>
<p>I've a feeling slice type without bound checks would make sense. Naturally ~all methods on it would be unsafe. Also something that could live in a crate.</p>



<a name="276729817"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/219381-t-libs/topic/%60swap_unchecked%60/near/276729817" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> oli <a href="https://zulip-archive.rust-lang.org/stream/219381-t-libs/topic/.60swap_unchecked.60.html#276729817">(Mar 26 2022 at 14:56)</a>:</h4>
<p>Isn't such a slice type just a thin pointer wrapper type? Or do you want to carry the length, but just never check it for index ops or such and leave that to the user?</p>



<a name="276730531"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/219381-t-libs/topic/%60swap_unchecked%60/near/276730531" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Lokathor <a href="https://zulip-archive.rust-lang.org/stream/219381-t-libs/topic/.60swap_unchecked.60.html#276730531">(Mar 26 2022 at 15:12)</a>:</h4>
<p>you'd want to be able to check the length manually at various times, just not on every operation</p>



<a name="276730540"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/219381-t-libs/topic/%60swap_unchecked%60/near/276730540" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Lokathor <a href="https://zulip-archive.rust-lang.org/stream/219381-t-libs/topic/.60swap_unchecked.60.html#276730540">(Mar 26 2022 at 15:12)</a>:</h4>
<p>Also you'd likely want to be able to convert between the two forms</p>



<a name="276731469"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/219381-t-libs/topic/%60swap_unchecked%60/near/276731469" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nagisa <a href="https://zulip-archive.rust-lang.org/stream/219381-t-libs/topic/.60swap_unchecked.60.html#276731469">(Mar 26 2022 at 15:36)</a>:</h4>
<p>Yeah I imagine length to be there primarily to enable conversion, though it might not be a huge deal if the length is not carried around as id anticipate live regions to be small for this tyme</p>



<a name="276731474"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/219381-t-libs/topic/%60swap_unchecked%60/near/276731474" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nagisa <a href="https://zulip-archive.rust-lang.org/stream/219381-t-libs/topic/.60swap_unchecked.60.html#276731474">(Mar 26 2022 at 15:36)</a>:</h4>
<p>The reason to make it a type and not just thin pointer is all the nice slice apis</p>



<a name="276732901"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/219381-t-libs/topic/%60swap_unchecked%60/near/276732901" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> The 8472 <a href="https://zulip-archive.rust-lang.org/stream/219381-t-libs/topic/.60swap_unchecked.60.html#276732901">(Mar 26 2022 at 16:07)</a>:</h4>
<p>Wouldn't an extension trait do the job too? Or do you want to overload existing names?</p>



<a name="276791117"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/219381-t-libs/topic/%60swap_unchecked%60/near/276791117" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nagisa <a href="https://zulip-archive.rust-lang.org/stream/219381-t-libs/topic/.60swap_unchecked.60.html#276791117">(Mar 27 2022 at 14:29)</a>:</h4>
<p>Well, isn't part of the complaint is that there are already too many methods on slice? Extension trait does not solve that..</p>



<a name="276791414"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/219381-t-libs/topic/%60swap_unchecked%60/near/276791414" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> The 8472 <a href="https://zulip-archive.rust-lang.org/stream/219381-t-libs/topic/.60swap_unchecked.60.html#276791414">(Mar 27 2022 at 14:35)</a>:</h4>
<p>I mean one provided by a 3rd party crate. Then those methods wouldn't be there by default.</p>



<a name="276826414"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/219381-t-libs/topic/%60swap_unchecked%60/near/276826414" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Lokathor <a href="https://zulip-archive.rust-lang.org/stream/219381-t-libs/topic/.60swap_unchecked.60.html#276826414">(Mar 28 2022 at 04:32)</a>:</h4>
<p>Honestly, if i needed this, I wouldn't want to write a bunch of code with <code>_unchecked</code> in it on every single call. I'd just plain want something like</p>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="kd">let</span><span class="w"> </span><span class="n">u</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">UncheckedSlice</span>::<span class="n">from</span><span class="p">(</span><span class="n">slice</span><span class="p">);</span><span class="w"></span>
<span class="n">u</span><span class="p">.</span><span class="n">swap</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="p">);</span><span class="w"> </span><span class="c1">// or whatever</span>
</code></pre></div>



<a name="276826735"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/219381-t-libs/topic/%60swap_unchecked%60/near/276826735" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> scottmcm <a href="https://zulip-archive.rust-lang.org/stream/219381-t-libs/topic/.60swap_unchecked.60.html#276826735">(Mar 28 2022 at 04:41)</a>:</h4>
<p>That might be nicer as a crate, since then it could have useful <code>debug_assert</code>s -- have the constructor take <em>a</em> length, and in debug it can do the checks.  But in release, skip storing that field and the checks.</p>



<hr><p>Last updated: Apr 12 2022 at 20:01 UTC</p>
</html>