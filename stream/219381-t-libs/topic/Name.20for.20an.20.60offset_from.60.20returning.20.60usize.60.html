<html>
<head><meta charset="utf-8"><title>Name for an `offset_from` returning `usize` · t-libs · Zulip Chat Archive</title></head>
<h2>Stream: <a href="https://zulip-archive.rust-lang.org/stream/219381-t-libs/index.html">t-libs</a></h2>
<h3>Topic: <a href="https://zulip-archive.rust-lang.org/stream/219381-t-libs/topic/Name.20for.20an.20.60offset_from.60.20returning.20.60usize.60.html">Name for an `offset_from` returning `usize`</a></h3>

<hr>

<base href="https://rust-lang.zulipchat.com">

<head><link href="https://zulip-archive.rust-lang.org/style.css" rel="stylesheet"></head>

<a name="274176111"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/219381-t-libs/topic/Name%20for%20an%20%60offset_from%60%20returning%20%60usize%60/near/274176111" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> scottmcm <a href="https://zulip-archive.rust-lang.org/stream/219381-t-libs/topic/Name.20for.20an.20.60offset_from.60.20returning.20.60usize.60.html#274176111">(Mar 04 2022 at 19:16)</a>:</h4>
<p>I was looking at the new <code>from_ptr_range</code>'s implementation, and it's calling <code>offset_from</code>: <a href="https://github.com/rust-lang/rust/pull/89793/files#diff-b89f9f6546b170c60c697982f8df104a866c66f08d97acb0df1c55a26ae3b83cR289">https://github.com/rust-lang/rust/pull/89793/files#diff-b89f9f6546b170c60c697982f8df104a866c66f08d97acb0df1c55a26ae3b83cR289</a></p>
<p>But it could, <a href="https://github.com/rust-lang/rust/blob/1b14fd3b1063771923e2fcf2110961bfa5ba4ad0/library/core/src/slice/iter/macros.rs#L25-L29">like the slice iterators</a>, be slightly more optimal since it's already UB for it to be called with <code>end &lt; begin</code>, and thus it doesn't need to do a <em>signed</em> length division.</p>
<p>I think it would be nice to add a new API for pointers to do that -- and it's consistent with how we used to just have <code>offset</code> taking <code>isize</code>, but now we have <code>add</code> &amp; <code>sub</code> taking <code>usize</code> too.  Maybe it could be called <code>sub_ptr</code>?</p>
<p>Thoughts?  Better name ideas?</p>



<a name="274177661"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/219381-t-libs/topic/Name%20for%20an%20%60offset_from%60%20returning%20%60usize%60/near/274177661" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jacob Lifshay <a href="https://zulip-archive.rust-lang.org/stream/219381-t-libs/topic/Name.20for.20an.20.60offset_from.60.20returning.20.60usize.60.html#274177661">(Mar 04 2022 at 19:30)</a>:</h4>
<p>how about <code>offset_from_u</code>?</p>



<a name="274178175"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/219381-t-libs/topic/Name%20for%20an%20%60offset_from%60%20returning%20%60usize%60/near/274178175" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> scottmcm <a href="https://zulip-archive.rust-lang.org/stream/219381-t-libs/topic/Name.20for.20an.20.60offset_from.60.20returning.20.60usize.60.html#274178175">(Mar 04 2022 at 19:34)</a>:</h4>
<p>I feel like just <code>u</code> is unusual, for core names.  The precedent from <a href="https://doc.rust-lang.org/std/primitive.i32.html#method.unsigned_abs">https://doc.rust-lang.org/std/primitive.i32.html#method.unsigned_abs</a> says to me that that direction might be spelled more like <code>unsigned_offset_from</code>, or something.</p>



<a name="274201596"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/219381-t-libs/topic/Name%20for%20an%20%60offset_from%60%20returning%20%60usize%60/near/274201596" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> cuviper <a href="https://zulip-archive.rust-lang.org/stream/219381-t-libs/topic/Name.20for.20an.20.60offset_from.60.20returning.20.60usize.60.html#274201596">(Mar 04 2022 at 23:12)</a>:</h4>
<p>how about <code>index_from</code>? especially since this is in "units of <code>T</code>"</p>



<a name="278397269"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/219381-t-libs/topic/Name%20for%20an%20%60offset_from%60%20returning%20%60usize%60/near/278397269" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> scottmcm <a href="https://zulip-archive.rust-lang.org/stream/219381-t-libs/topic/Name.20for.20an.20.60offset_from.60.20returning.20.60usize.60.html#278397269">(Apr 09 2022 at 08:36)</a>:</h4>
<p>Well, I made a PR: <a href="https://github.com/rust-lang/rust/pull/95837">https://github.com/rust-lang/rust/pull/95837</a></p>
<p>Feel free to put name recommendations in there.</p>



<a name="278398782"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/219381-t-libs/topic/Name%20for%20an%20%60offset_from%60%20returning%20%60usize%60/near/278398782" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> scottmcm <a href="https://zulip-archive.rust-lang.org/stream/219381-t-libs/topic/Name.20for.20an.20.60offset_from.60.20returning.20.60usize.60.html#278398782">(Apr 09 2022 at 09:15)</a>:</h4>
<p>Huh, I should have <code>rg</code>'d sooner -- essentially every use of <code>ptr::offset_of</code> is followed by <code>as usize</code>: <a href="https://github.com/rust-lang/rust/search?q=offset_from+path%3Alibrary">https://github.com/rust-lang/rust/search?q=offset_from+path%3Alibrary</a></p>
<p>The main exceptions are those where it's a different <code>offset_of</code> that subtracts slice lengths, and thus isn't the pointer <code>offset_of</code> at all:<br>
<a href="https://github.com/rust-lang/rust/blob/4bb685e4714a2b310774f45c3d023d1743de8bd0/library/core/src/num/dec2flt/common.rs#L87-L90">https://github.com/rust-lang/rust/blob/4bb685e4714a2b310774f45c3d023d1743de8bd0/library/core/src/num/dec2flt/common.rs#L87-L90</a></p>



<hr><p>Last updated: Apr 12 2022 at 20:01 UTC</p>
</html>