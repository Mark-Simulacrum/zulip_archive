<html>
<head><meta charset="utf-8"><title>Possible `HashSet::insert_keep` · t-libs · Zulip Chat Archive</title></head>
<h2>Stream: <a href="https://zulip-archive.rust-lang.org/stream/219381-t-libs/index.html">t-libs</a></h2>
<h3>Topic: <a href="https://zulip-archive.rust-lang.org/stream/219381-t-libs/topic/Possible.20.60HashSet.3A.3Ainsert_keep.60.html">Possible `HashSet::insert_keep`</a></h3>

<hr>

<base href="https://rust-lang.zulipchat.com">

<head><link href="https://zulip-archive.rust-lang.org/style.css" rel="stylesheet"></head>

<a name="262423384"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/219381-t-libs/topic/Possible%20%60HashSet%3A%3Ainsert_keep%60/near/262423384" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jake <a href="https://zulip-archive.rust-lang.org/stream/219381-t-libs/topic/Possible.20.60HashSet.3A.3Ainsert_keep.60.html#262423384">(Nov 23 2021 at 08:04)</a>:</h4>
<p>On <code>HashSet</code>, <code>HashSet::replace(K) -&gt; Option&lt;K&gt;</code> inserts the new element, and returns the old element if it existed. Would there be interest in a "couterpart" to this method, a <code>HashSet::insert_keep(K) -&gt; Option&lt;K&gt;</code> that inserts the input if there was no matching entry in the set already, and returns the input unchanged if there was? (name obviously bikeshedable)</p>



<a name="262423659"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/219381-t-libs/topic/Possible%20%60HashSet%3A%3Ainsert_keep%60/near/262423659" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Dylan MacKenzie (ecstatic-morse) <a href="https://zulip-archive.rust-lang.org/stream/219381-t-libs/topic/Possible.20.60HashSet.3A.3Ainsert_keep.60.html#262423659">(Nov 23 2021 at 08:08)</a>:</h4>
<p>This exists on nightly under the name<a href="https://doc.rust-lang.org/std/collections/struct.HashMap.html#method.try_insert"><code>try_insert</code></a>.</p>



<a name="262423695"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/219381-t-libs/topic/Possible%20%60HashSet%3A%3Ainsert_keep%60/near/262423695" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Hans Kratz <a href="https://zulip-archive.rust-lang.org/stream/219381-t-libs/topic/Possible.20.60HashSet.3A.3Ainsert_keep.60.html#262423695">(Nov 23 2021 at 08:08)</a>:</h4>
<p>There is <a href="https://doc.rust-lang.org/std/collections/struct.HashSet.html#method.get_or_insert"><code>HashSet::get_or_insert(&amp;mut self, value: T) -&gt; &amp;T</code></a> on nightly.</p>



<a name="262423813"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/219381-t-libs/topic/Possible%20%60HashSet%3A%3Ainsert_keep%60/near/262423813" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jake <a href="https://zulip-archive.rust-lang.org/stream/219381-t-libs/topic/Possible.20.60HashSet.3A.3Ainsert_keep.60.html#262423813">(Nov 23 2021 at 08:10)</a>:</h4>
<p><span class="user-mention silent" data-user-id="118594">Dylan MacKenzie (ecstatic-morse)</span> <a href="#narrow/stream/219381-t-libs/topic/Possible.20.60HashSet.3A.3Ainsert_keep.60/near/262423659">said</a>:</p>
<blockquote>
<p>This exists on nightly under the name<a href="https://doc.rust-lang.org/std/collections/struct.HashMap.html#method.try_insert"><code>try_insert</code></a>.</p>
</blockquote>
<p>Only on maps, not on sets</p>



<a name="262423889"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/219381-t-libs/topic/Possible%20%60HashSet%3A%3Ainsert_keep%60/near/262423889" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jake <a href="https://zulip-archive.rust-lang.org/stream/219381-t-libs/topic/Possible.20.60HashSet.3A.3Ainsert_keep.60.html#262423889">(Nov 23 2021 at 08:11)</a>:</h4>
<p><span class="user-mention silent" data-user-id="407656">Hans Kratz</span> <a href="#narrow/stream/219381-t-libs/topic/Possible.20.60HashSet.3A.3Ainsert_keep.60/near/262423695">said</a>:</p>
<blockquote>
<p>There is <a href="https://doc.rust-lang.org/std/collections/struct.HashSet.html#method.get_or_insert"><code>HashSet::get_or_insert(&amp;mut self, value: T) -&gt; &amp;T</code></a> on nightly.</p>
</blockquote>
<p>That doesn't seem to address my use case, since I need the value that I tried to insert back if the insertion failed</p>



<a name="262427125"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/219381-t-libs/topic/Possible%20%60HashSet%3A%3Ainsert_keep%60/near/262427125" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> The 8472 <a href="https://zulip-archive.rust-lang.org/stream/219381-t-libs/topic/Possible.20.60HashSet.3A.3Ainsert_keep.60.html#262427125">(Nov 23 2021 at 08:50)</a>:</h4>
<p>you can make something like that with raw entries on a <code>HashMap&lt;K, ()&gt;</code> at least.</p>



<a name="262428394"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/219381-t-libs/topic/Possible%20%60HashSet%3A%3Ainsert_keep%60/near/262428394" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jake <a href="https://zulip-archive.rust-lang.org/stream/219381-t-libs/topic/Possible.20.60HashSet.3A.3Ainsert_keep.60.html#262428394">(Nov 23 2021 at 09:03)</a>:</h4>
<p>Well, I don't even need raw entries on a <code>HashMap</code> since <code>try_insert</code> exists there; unfortunately, switching from <code>HashSet&lt;K&gt;</code> to <code>HashMap&lt;K, ()&gt;</code> for this kind of thing would be quite annoying though (my use case isnt particularly perf sensitive, so I just wrote a function, but someone else might end up in a different situation)</p>



<hr><p>Last updated: Apr 12 2022 at 20:01 UTC</p>
</html>