<html>
<head><meta charset="utf-8"><title>FCP for const CStr::from_bytes_with_nul_unchecked · t-libs · Zulip Chat Archive</title></head>
<h2>Stream: <a href="https://zulip-archive.rust-lang.org/stream/219381-t-libs/index.html">t-libs</a></h2>
<h3>Topic: <a href="https://zulip-archive.rust-lang.org/stream/219381-t-libs/topic/FCP.20for.20const.20CStr.3A.3Afrom_bytes_with_nul_unchecked.html">FCP for const CStr::from_bytes_with_nul_unchecked</a></h3>

<hr>

<base href="https://rust-lang.zulipchat.com">

<head><link href="https://zulip-archive.rust-lang.org/style.css" rel="stylesheet"></head>

<a name="261999506"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/219381-t-libs/topic/FCP%20for%20const%20CStr%3A%3Afrom_bytes_with_nul_unchecked/near/261999506" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Konrad Borowski <a href="https://zulip-archive.rust-lang.org/stream/219381-t-libs/topic/FCP.20for.20const.20CStr.3A.3Afrom_bytes_with_nul_unchecked.html#261999506">(Nov 18 2021 at 22:15)</a>:</h4>
<p>I would like to request an FCP for <a href="https://github.com/rust-lang/rust/issues/90343">https://github.com/rust-lang/rust/issues/90343</a> (const CStr::from_bytes_with_nul_unchecked).</p>
<p>I think it's important to stabilize const CStr::from_bytes_with_nul_unchecked as there is already code already using transmutes to convert &amp;[u8] to &amp;CStr in constant contexts such as <code>cstr</code> crate (<a href="https://docs.rs/crate/cstr/0.2.9/source/src/lib.rs">https://docs.rs/crate/cstr/0.2.9/source/src/lib.rs</a>). The problem with approach using transmutes is that it will stop working in future releases of Rust when <code>&amp;CStr</code> stops storing its length (<a href="https://github.com/rust-lang/rust/issues/59905">https://github.com/rust-lang/rust/issues/59905</a>). Having a proper way to declare <code>&amp;CStr</code> constants in stable could discourage transmute hacks like this.</p>



<a name="262022124"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/219381-t-libs/topic/FCP%20for%20const%20CStr%3A%3Afrom_bytes_with_nul_unchecked/near/262022124" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Lokathor <a href="https://zulip-archive.rust-lang.org/stream/219381-t-libs/topic/FCP.20for.20const.20CStr.3A.3Afrom_bytes_with_nul_unchecked.html#262022124">(Nov 19 2021 at 03:11)</a>:</h4>
<p>Note that <code>CStr</code> is not <code>repr(transparent)</code> and so any code doing a transmute to get a <code>CStr</code> is really dancing pretty close to UB.</p>



<hr><p>Last updated: Apr 12 2022 at 20:01 UTC</p>
</html>