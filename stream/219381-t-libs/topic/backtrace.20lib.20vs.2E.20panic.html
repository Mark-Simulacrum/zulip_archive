<html>
<head><meta charset="utf-8"><title>backtrace lib vs. panic · t-libs · Zulip Chat Archive</title></head>
<h2>Stream: <a href="https://zulip-archive.rust-lang.org/stream/219381-t-libs/index.html">t-libs</a></h2>
<h3>Topic: <a href="https://zulip-archive.rust-lang.org/stream/219381-t-libs/topic/backtrace.20lib.20vs.2E.20panic.html">backtrace lib vs. panic</a></h3>

<hr>

<base href="https://rust-lang.zulipchat.com">

<head><link href="https://zulip-archive.rust-lang.org/style.css" rel="stylesheet"></head>

<a name="269322510"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/219381-t-libs/topic/backtrace%20lib%20vs.%20panic/near/269322510" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> simulacrum <a href="https://zulip-archive.rust-lang.org/stream/219381-t-libs/topic/backtrace.20lib.20vs.2E.20panic.html#269322510">(Jan 25 2022 at 20:55)</a>:</h4>
<p>As I'm working on the backtrace config without environment variables, one question that comes to mind is if we <em>want</em> to separate the default policy for capturing/displaying backtraces between panics and the (currently unstable) std::backtrace::Backtrace type. If we don't, then the API design becomes rather simpler -- I'm curious if folks have thoughts on this question.</p>
<p>I'm going to try and dig up with RUST_LIB_BACKTRACE was introduced as a separate env variable for the unstable API as it stands today, in the meantime.</p>
<p>cc <span class="user-mention" data-user-id="220273">@Jane Lusby [she/her]</span></p>



<a name="269323015"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/219381-t-libs/topic/backtrace%20lib%20vs.%20panic/near/269323015" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jane Lusby [she/her] <a href="https://zulip-archive.rust-lang.org/stream/219381-t-libs/topic/backtrace.20lib.20vs.2E.20panic.html#269323015">(Jan 25 2022 at 20:59)</a>:</h4>
<p>Like you said, the design is significantly simpler if we make the backtrace capture default a property of backtrace itself and not additionally a feature on the default panic handler</p>



<a name="269323083"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/219381-t-libs/topic/backtrace%20lib%20vs.%20panic/near/269323083" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jane Lusby [she/her] <a href="https://zulip-archive.rust-lang.org/stream/219381-t-libs/topic/backtrace.20lib.20vs.2E.20panic.html#269323083">(Jan 25 2022 at 20:59)</a>:</h4>
<p>Assuming that's what you meant by having a separate default policy</p>



<a name="269323307"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/219381-t-libs/topic/backtrace%20lib%20vs.%20panic/near/269323307" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jane Lusby [she/her] <a href="https://zulip-archive.rust-lang.org/stream/219381-t-libs/topic/backtrace.20lib.20vs.2E.20panic.html#269323307">(Jan 25 2022 at 21:00)</a>:</h4>
<p>I can definitely see the value to having a different configuration for panics, which are in my mind more frequently intended for developers and debugging rather than for users</p>



<a name="269323653"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/219381-t-libs/topic/backtrace%20lib%20vs.%20panic/near/269323653" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jane Lusby [she/her] <a href="https://zulip-archive.rust-lang.org/stream/219381-t-libs/topic/backtrace.20lib.20vs.2E.20panic.html#269323653">(Jan 25 2022 at 21:02)</a>:</h4>
<p>(deleted)</p>



<a name="269323693"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/219381-t-libs/topic/backtrace%20lib%20vs.%20panic/near/269323693" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jane Lusby [she/her] <a href="https://zulip-archive.rust-lang.org/stream/219381-t-libs/topic/backtrace.20lib.20vs.2E.20panic.html#269323693">(Jan 25 2022 at 21:02)</a>:</h4>
<p>(deleted)</p>



<a name="269323771"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/219381-t-libs/topic/backtrace%20lib%20vs.%20panic/near/269323771" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jane Lusby [she/her] <a href="https://zulip-archive.rust-lang.org/stream/219381-t-libs/topic/backtrace.20lib.20vs.2E.20panic.html#269323771">(Jan 25 2022 at 21:03)</a>:</h4>
<p>(deleted)</p>



<a name="269324074"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/219381-t-libs/topic/backtrace%20lib%20vs.%20panic/near/269324074" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> simulacrum <a href="https://zulip-archive.rust-lang.org/stream/219381-t-libs/topic/backtrace.20lib.20vs.2E.20panic.html#269324074">(Jan 25 2022 at 21:05)</a>:</h4>
<p>Well, I just meant having a single toggle rather than two separate ones -- I suppose you can think of it as being attached to Backtrace rather than panic handlers or whatever else, but the important distinction is one vs. two :)</p>



<a name="269324117"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/219381-t-libs/topic/backtrace%20lib%20vs.%20panic/near/269324117" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jane Lusby [she/her] <a href="https://zulip-archive.rust-lang.org/stream/219381-t-libs/topic/backtrace.20lib.20vs.2E.20panic.html#269324117">(Jan 25 2022 at 21:05)</a>:</h4>
<p>Yeah thats precisely what I meant too. Okay perfect! I think we understand each other</p>



<a name="269324207"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/219381-t-libs/topic/backtrace%20lib%20vs.%20panic/near/269324207" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jane Lusby [she/her] <a href="https://zulip-archive.rust-lang.org/stream/219381-t-libs/topic/backtrace.20lib.20vs.2E.20panic.html#269324207">(Jan 25 2022 at 21:06)</a>:</h4>
<p>What's your preference Mark?</p>



<a name="269324323"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/219381-t-libs/topic/backtrace%20lib%20vs.%20panic/near/269324323" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> simulacrum <a href="https://zulip-archive.rust-lang.org/stream/219381-t-libs/topic/backtrace.20lib.20vs.2E.20panic.html#269324323">(Jan 25 2022 at 21:07)</a>:</h4>
<p><span class="user-mention silent" data-user-id="220273">Jane Lusby [she/her]</span> <a href="#narrow/stream/219381-t-libs/topic/backtrace.20lib.20vs.2E.20panic/near/269323307">said</a>:</p>
<blockquote>
<p>I can definitely see the value to having a different configuration for panics, which are in my mind more frequently intended for developers and debugging rather than for users</p>
</blockquote>
<p>I'm not sure I understand this -- for library backtraces, we don't control whether to do any printing (that's done by whatever calls Backtrace::capture)</p>



<a name="269324502"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/219381-t-libs/topic/backtrace%20lib%20vs.%20panic/near/269324502" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> simulacrum <a href="https://zulip-archive.rust-lang.org/stream/219381-t-libs/topic/backtrace.20lib.20vs.2E.20panic.html#269324502">(Jan 25 2022 at 21:08)</a>:</h4>
<p>I think my current inclination is to have a single API that controls the capture behavior -- there's two actual knobs to configure, in theory:</p>
<ul>
<li>Whether to capture (a relatively fast, but not trivial operation)</li>
<li>How to print (full or short today, potentially more options eventually)</li>
</ul>



<a name="269324532"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/219381-t-libs/topic/backtrace%20lib%20vs.%20panic/near/269324532" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jane Lusby [she/her] <a href="https://zulip-archive.rust-lang.org/stream/219381-t-libs/topic/backtrace.20lib.20vs.2E.20panic.html#269324532">(Jan 25 2022 at 21:08)</a>:</h4>
<p><span class="user-mention silent" data-user-id="116122">simulacrum</span> <a href="#narrow/stream/219381-t-libs/topic/backtrace.20lib.20vs.2E.20panic/near/269324323">said</a>:</p>
<blockquote>
<p><span class="user-mention silent" data-user-id="220273">Jane Lusby [she/her]</span> <a href="#narrow/stream/219381-t-libs/topic/backtrace.20lib.20vs.2E.20panic/near/269323307">said</a>:</p>
<blockquote>
<p>I can definitely see the value to having a different configuration for panics, which are in my mind more frequently intended for developers and debugging rather than for users</p>
</blockquote>
<p>I'm not sure I understand this -- for library backtraces, we don't control whether to do any printing (that's done by whatever calls Backtrace::capture)</p>
</blockquote>
<p>I'm referring to how <code>RUST_BACKTRACE</code> only controls if we display a Backtrace in the panic handler, but <code>Backtrace::capture</code> is controlled by <code>RUST_LIB_BACKTRACE</code> (or maybe some combination of both env variables? I can't even remember)</p>



<a name="269324564"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/219381-t-libs/topic/backtrace%20lib%20vs.%20panic/near/269324564" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> simulacrum <a href="https://zulip-archive.rust-lang.org/stream/219381-t-libs/topic/backtrace.20lib.20vs.2E.20panic.html#269324564">(Jan 25 2022 at 21:08)</a>:</h4>
<p>Backtrace::capture is controlled by RUST_LIB_BACKTRACE, if set, with a fallback to RUST_BACKTRACE, today</p>



<a name="269324658"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/219381-t-libs/topic/backtrace%20lib%20vs.%20panic/near/269324658" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jane Lusby [she/her] <a href="https://zulip-archive.rust-lang.org/stream/219381-t-libs/topic/backtrace.20lib.20vs.2E.20panic.html#269324658">(Jan 25 2022 at 21:09)</a>:</h4>
<p>so i guess I'm saying, I can maybe see some value to the fact that today we can do <code>RUST_BACKTRACE=1 RUST_LIB_BACKTRACE=0</code></p>



<a name="269324694"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/219381-t-libs/topic/backtrace%20lib%20vs.%20panic/near/269324694" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> simulacrum <a href="https://zulip-archive.rust-lang.org/stream/219381-t-libs/topic/backtrace.20lib.20vs.2E.20panic.html#269324694">(Jan 25 2022 at 21:10)</a>:</h4>
<p>In general the primary reason to not enable capturing library backtraces but <em>do</em> enable panic captures is that library backtraces may be "commonly" captured -- in something resembling a hot path, unlike panics (which presumably never happen)</p>



<a name="269324784"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/219381-t-libs/topic/backtrace%20lib%20vs.%20panic/near/269324784" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jane Lusby [she/her] <a href="https://zulip-archive.rust-lang.org/stream/219381-t-libs/topic/backtrace.20lib.20vs.2E.20panic.html#269324784">(Jan 25 2022 at 21:10)</a>:</h4>
<p>though honestly I think its very strange that its easier to only enable lib backtraces than it is to only enable panic backtraces</p>



<a name="269324793"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/219381-t-libs/topic/backtrace%20lib%20vs.%20panic/near/269324793" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jane Lusby [she/her] <a href="https://zulip-archive.rust-lang.org/stream/219381-t-libs/topic/backtrace.20lib.20vs.2E.20panic.html#269324793">(Jan 25 2022 at 21:10)</a>:</h4>
<p>that seems backwards</p>



<a name="269324828"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/219381-t-libs/topic/backtrace%20lib%20vs.%20panic/near/269324828" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jane Lusby [she/her] <a href="https://zulip-archive.rust-lang.org/stream/219381-t-libs/topic/backtrace.20lib.20vs.2E.20panic.html#269324828">(Jan 25 2022 at 21:10)</a>:</h4>
<p>maybe I'm just not correctly intuiting when ppl would want to enable one vs the other tho</p>



<a name="269324900"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/219381-t-libs/topic/backtrace%20lib%20vs.%20panic/near/269324900" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> simulacrum <a href="https://zulip-archive.rust-lang.org/stream/219381-t-libs/topic/backtrace.20lib.20vs.2E.20panic.html#269324900">(Jan 25 2022 at 21:11)</a>:</h4>
<p>I suspect the Backtrace::capture API is something of a wart, in practice, in terms of depending on a single env var</p>



<a name="269324908"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/219381-t-libs/topic/backtrace%20lib%20vs.%20panic/near/269324908" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jane Lusby [she/her] <a href="https://zulip-archive.rust-lang.org/stream/219381-t-libs/topic/backtrace.20lib.20vs.2E.20panic.html#269324908">(Jan 25 2022 at 21:11)</a>:</h4>
<p><span class="user-mention silent" data-user-id="116122">simulacrum</span> <a href="#narrow/stream/219381-t-libs/topic/backtrace.20lib.20vs.2E.20panic/near/269324694">said</a>:</p>
<blockquote>
<p>In general the primary reason to not enable capturing library backtraces but <em>do</em> enable panic captures is that library backtraces may be "commonly" captured -- in something resembling a hot path, unlike panics (which presumably never happen)</p>
</blockquote>
<p>yea, that and the fact that library backtraces are more likely to be shown to a user are why I'd expect ppl to learn towards enabling panic backtraces if they're only going to enable it in one place</p>



<a name="269324927"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/219381-t-libs/topic/backtrace%20lib%20vs.%20panic/near/269324927" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jane Lusby [she/her] <a href="https://zulip-archive.rust-lang.org/stream/219381-t-libs/topic/backtrace.20lib.20vs.2E.20panic.html#269324927">(Jan 25 2022 at 21:11)</a>:</h4>
<p><span class="user-mention silent" data-user-id="116122">simulacrum</span> <a href="#narrow/stream/219381-t-libs/topic/backtrace.20lib.20vs.2E.20panic/near/269324900">said</a>:</p>
<blockquote>
<p>I suspect the Backtrace::capture API is something of a wart, in practice, in terms of depending on a single env var</p>
</blockquote>
<p>you mean depending on two env vars?</p>



<a name="269324938"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/219381-t-libs/topic/backtrace%20lib%20vs.%20panic/near/269324938" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> simulacrum <a href="https://zulip-archive.rust-lang.org/stream/219381-t-libs/topic/backtrace.20lib.20vs.2E.20panic.html#269324938">(Jan 25 2022 at 21:11)</a>:</h4>
<p>It feels like it wants to be more of a RUST_LOG with per-module/per-function</p>



<a name="269324962"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/219381-t-libs/topic/backtrace%20lib%20vs.%20panic/near/269324962" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jane Lusby [she/her] <a href="https://zulip-archive.rust-lang.org/stream/219381-t-libs/topic/backtrace.20lib.20vs.2E.20panic.html#269324962">(Jan 25 2022 at 21:11)</a>:</h4>
<p>oh interesting!</p>



<a name="269325057"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/219381-t-libs/topic/backtrace%20lib%20vs.%20panic/near/269325057" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jane Lusby [she/her] <a href="https://zulip-archive.rust-lang.org/stream/219381-t-libs/topic/backtrace.20lib.20vs.2E.20panic.html#269325057">(Jan 25 2022 at 21:12)</a>:</h4>
<p>this kinda gets back to my earlier suggestion to have the backtrace capture be hookable</p>



<a name="269325062"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/219381-t-libs/topic/backtrace%20lib%20vs.%20panic/near/269325062" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> simulacrum <a href="https://zulip-archive.rust-lang.org/stream/219381-t-libs/topic/backtrace.20lib.20vs.2E.20panic.html#269325062">(Jan 25 2022 at 21:12)</a>:</h4>
<p>I wouldn't expect library backtraces to be more commonly shown to users, I don't think -- it feels about the same vis-a-vis panic backtraces</p>



<a name="269325093"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/219381-t-libs/topic/backtrace%20lib%20vs.%20panic/near/269325093" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jane Lusby [she/her] <a href="https://zulip-archive.rust-lang.org/stream/219381-t-libs/topic/backtrace.20lib.20vs.2E.20panic.html#269325093">(Jan 25 2022 at 21:12)</a>:</h4>
<p>so you could install your own capture test function that does act like rustlog by looking at the current module / function</p>



<a name="269325194"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/219381-t-libs/topic/backtrace%20lib%20vs.%20panic/near/269325194" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> simulacrum <a href="https://zulip-archive.rust-lang.org/stream/219381-t-libs/topic/backtrace.20lib.20vs.2E.20panic.html#269325194">(Jan 25 2022 at 21:13)</a>:</h4>
<p>eh, a function can't do that, you need a macro. log crate or tracing could provide a <code>trace_with_backtrace!(...)</code> already, if we stabilized the type, just calling force_capture</p>



<a name="269325197"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/219381-t-libs/topic/backtrace%20lib%20vs.%20panic/near/269325197" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jane Lusby [she/her] <a href="https://zulip-archive.rust-lang.org/stream/219381-t-libs/topic/backtrace.20lib.20vs.2E.20panic.html#269325197">(Jan 25 2022 at 21:13)</a>:</h4>
<p><span class="user-mention silent" data-user-id="116122">simulacrum</span> <a href="#narrow/stream/219381-t-libs/topic/backtrace.20lib.20vs.2E.20panic/near/269325062">said</a>:</p>
<blockquote>
<p>I wouldn't expect library backtraces to be more commonly shown to users, I don't think -- it feels about the same vis-a-vis panic backtraces</p>
</blockquote>
<p>interesting</p>



<a name="269325375"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/219381-t-libs/topic/backtrace%20lib%20vs.%20panic/near/269325375" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jane Lusby [she/her] <a href="https://zulip-archive.rust-lang.org/stream/219381-t-libs/topic/backtrace.20lib.20vs.2E.20panic.html#269325375">(Jan 25 2022 at 21:14)</a>:</h4>
<p><span class="user-mention silent" data-user-id="116122">simulacrum</span> <a href="#narrow/stream/219381-t-libs/topic/backtrace.20lib.20vs.2E.20panic/near/269325194">said</a>:</p>
<blockquote>
<p>eh, a function can't do that, you need a macro. log crate or tracing could provide a <code>trace_with_backtrace!(...)</code> already, if we stabilized the type, just calling force_capture</p>
</blockquote>
<p><span aria-label="smiling devil" class="emoji emoji-1f608" role="img" title="smiling devil">:smiling_devil:</span> simply inspect the backtrace frames after capture then decide if you should throw it away :D</p>



<a name="269325467"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/219381-t-libs/topic/backtrace%20lib%20vs.%20panic/near/269325467" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jane Lusby [she/her] <a href="https://zulip-archive.rust-lang.org/stream/219381-t-libs/topic/backtrace.20lib.20vs.2E.20panic.html#269325467">(Jan 25 2022 at 21:15)</a>:</h4>
<p><span class="user-mention silent" data-user-id="116122">simulacrum</span> <a href="#narrow/stream/219381-t-libs/topic/backtrace.20lib.20vs.2E.20panic/near/269324502">said</a>:</p>
<blockquote>
<p>I think my current inclination is to have a single API that controls the capture behavior -- there's two actual knobs to configure, in theory:</p>
<ul>
<li>Whether to capture (a relatively fast, but not trivial operation)</li>
<li>How to print (full or short today, potentially more options eventually)</li>
</ul>
</blockquote>
<p>regardless, I think I am have the same preference</p>



<a name="269325534"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/219381-t-libs/topic/backtrace%20lib%20vs.%20panic/near/269325534" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jane Lusby [she/her] <a href="https://zulip-archive.rust-lang.org/stream/219381-t-libs/topic/backtrace.20lib.20vs.2E.20panic.html#269325534">(Jan 25 2022 at 21:15)</a>:</h4>
<p>make backtrace capture configurability a property of Backtrace, then if users need to customize backtrace capture further in their error types or panics they can do so in their own error constructors / panic handler</p>



<a name="269325604"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/219381-t-libs/topic/backtrace%20lib%20vs.%20panic/near/269325604" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jane Lusby [she/her] <a href="https://zulip-archive.rust-lang.org/stream/219381-t-libs/topic/backtrace.20lib.20vs.2E.20panic.html#269325604">(Jan 25 2022 at 21:16)</a>:</h4>
<p>I guess on the second bullet point</p>



<a name="269325645"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/219381-t-libs/topic/backtrace%20lib%20vs.%20panic/near/269325645" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jane Lusby [she/her] <a href="https://zulip-archive.rust-lang.org/stream/219381-t-libs/topic/backtrace.20lib.20vs.2E.20panic.html#269325645">(Jan 25 2022 at 21:16)</a>:</h4>
<p>if we add a configurability knob for the format separate from the capture setting, should we also provide a way to override it?</p>



<a name="269325674"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/219381-t-libs/topic/backtrace%20lib%20vs.%20panic/near/269325674" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jane Lusby [she/her] <a href="https://zulip-archive.rust-lang.org/stream/219381-t-libs/topic/backtrace.20lib.20vs.2E.20panic.html#269325674">(Jan 25 2022 at 21:16)</a>:</h4>
<p>like, <code>Backtrace::force_capture(format)</code></p>



<a name="269325721"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/219381-t-libs/topic/backtrace%20lib%20vs.%20panic/near/269325721" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> simulacrum <a href="https://zulip-archive.rust-lang.org/stream/219381-t-libs/topic/backtrace.20lib.20vs.2E.20panic.html#269325721">(Jan 25 2022 at 21:16)</a>:</h4>
<p>No, I don't think it should be a property of Backtrace -- having that depend on environment variables and have a force_capture vs. regular capture feels weird to me.</p>
<p>I'd suggest just having a single hook to configure panic behavior, maybe even just a boolean (capture vs. not), with the default short backtrace printing</p>



<a name="269325783"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/219381-t-libs/topic/backtrace%20lib%20vs.%20panic/near/269325783" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jane Lusby [she/her] <a href="https://zulip-archive.rust-lang.org/stream/219381-t-libs/topic/backtrace.20lib.20vs.2E.20panic.html#269325783">(Jan 25 2022 at 21:17)</a>:</h4>
<p>oh so you mean get rid of <code>force_capture</code> all together</p>



<a name="269325787"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/219381-t-libs/topic/backtrace%20lib%20vs.%20panic/near/269325787" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> simulacrum <a href="https://zulip-archive.rust-lang.org/stream/219381-t-libs/topic/backtrace.20lib.20vs.2E.20panic.html#269325787">(Jan 25 2022 at 21:17)</a>:</h4>
<p>(the format is something that can be decided at formatting time, i.e., in Debug or Display,)</p>



<a name="269325793"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/219381-t-libs/topic/backtrace%20lib%20vs.%20panic/near/269325793" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jane Lusby [she/her] <a href="https://zulip-archive.rust-lang.org/stream/219381-t-libs/topic/backtrace.20lib.20vs.2E.20panic.html#269325793">(Jan 25 2022 at 21:17)</a>:</h4>
<p>and only have the configurability in the panic handler</p>



<a name="269325800"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/219381-t-libs/topic/backtrace%20lib%20vs.%20panic/near/269325800" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jane Lusby [she/her] <a href="https://zulip-archive.rust-lang.org/stream/219381-t-libs/topic/backtrace.20lib.20vs.2E.20panic.html#269325800">(Jan 25 2022 at 21:17)</a>:</h4>
<p>that sounds great too</p>



<a name="269325845"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/219381-t-libs/topic/backtrace%20lib%20vs.%20panic/near/269325845" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jane Lusby [she/her] <a href="https://zulip-archive.rust-lang.org/stream/219381-t-libs/topic/backtrace.20lib.20vs.2E.20panic.html#269325845">(Jan 25 2022 at 21:17)</a>:</h4>
<p><span class="user-mention silent" data-user-id="116122">simulacrum</span> <a href="#narrow/stream/219381-t-libs/topic/backtrace.20lib.20vs.2E.20panic/near/269325787">said</a>:</p>
<blockquote>
<p>(the format is something that can be decided at formatting time, i.e., in Debug or Display,)</p>
</blockquote>
<p>debug vs display doesn't currently correspond to full vs short</p>



<a name="269325919"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/219381-t-libs/topic/backtrace%20lib%20vs.%20panic/near/269325919" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jane Lusby [she/her] <a href="https://zulip-archive.rust-lang.org/stream/219381-t-libs/topic/backtrace.20lib.20vs.2E.20panic.html#269325919">(Jan 25 2022 at 21:18)</a>:</h4>
<p>the debug format is a custom array-like output</p>



<a name="269325977"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/219381-t-libs/topic/backtrace%20lib%20vs.%20panic/near/269325977" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> simulacrum <a href="https://zulip-archive.rust-lang.org/stream/219381-t-libs/topic/backtrace.20lib.20vs.2E.20panic.html#269325977">(Jan 25 2022 at 21:18)</a>:</h4>
<p>Yeah, so I'm envisioning that we:</p>
<ul>
<li>Remove RUST_LIB_BACKTRACE as a knob, with Backtrace::capture always capturing (i.e., basically the force_capture of today).</li>
<li>Expose <code>std::panic::config::set_capture_backtrace(bool)</code>, or so, to configure that behavior</li>
</ul>



<a name="269326010"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/219381-t-libs/topic/backtrace%20lib%20vs.%20panic/near/269326010" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jane Lusby [she/her] <a href="https://zulip-archive.rust-lang.org/stream/219381-t-libs/topic/backtrace.20lib.20vs.2E.20panic.html#269326010">(Jan 25 2022 at 21:18)</a>:</h4>
<p><span aria-label="100" class="emoji emoji-1f4af" role="img" title="100">:100:</span></p>



<a name="269326015"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/219381-t-libs/topic/backtrace%20lib%20vs.%20panic/near/269326015" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jane Lusby [she/her] <a href="https://zulip-archive.rust-lang.org/stream/219381-t-libs/topic/backtrace.20lib.20vs.2E.20panic.html#269326015">(Jan 25 2022 at 21:18)</a>:</h4>
<p>I like it</p>



<a name="269326050"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/219381-t-libs/topic/backtrace%20lib%20vs.%20panic/near/269326050" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> simulacrum <a href="https://zulip-archive.rust-lang.org/stream/219381-t-libs/topic/backtrace.20lib.20vs.2E.20panic.html#269326050">(Jan 25 2022 at 21:19)</a>:</h4>
<p><span class="user-mention silent" data-user-id="220273">Jane Lusby [she/her]</span> <a href="#narrow/stream/219381-t-libs/topic/backtrace.20lib.20vs.2E.20panic/near/269325845">said</a>:</p>
<blockquote>
<p><span class="user-mention silent" data-user-id="116122">simulacrum</span> <a href="#narrow/stream/219381-t-libs/topic/backtrace.20lib.20vs.2E.20panic/near/269325787">said</a>:</p>
<blockquote>
<p>(the format is something that can be decided at formatting time, i.e., in Debug or Display,)</p>
</blockquote>
<p>debug vs display doesn't currently correspond to full vs short</p>
</blockquote>
<p>yes, I know, I mean that it's not something that affects the capture function, it can be configured later -- maybe with the alternate formatting specifier, for example.</p>



<a name="269326079"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/219381-t-libs/topic/backtrace%20lib%20vs.%20panic/near/269326079" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jane Lusby [she/her] <a href="https://zulip-archive.rust-lang.org/stream/219381-t-libs/topic/backtrace.20lib.20vs.2E.20panic.html#269326079">(Jan 25 2022 at 21:19)</a>:</h4>
<p><span aria-label="+1" class="emoji emoji-1f44d" role="img" title="+1">:+1:</span></p>



<a name="269326140"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/219381-t-libs/topic/backtrace%20lib%20vs.%20panic/near/269326140" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> simulacrum <a href="https://zulip-archive.rust-lang.org/stream/219381-t-libs/topic/backtrace.20lib.20vs.2E.20panic.html#269326140">(Jan 25 2022 at 21:19)</a>:</h4>
<p>Ok, I'll adjust the PR with that much simpler API (though not the first bullet, I can take that to a separate PR, seems orthogonal)</p>



<a name="269326337"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/219381-t-libs/topic/backtrace%20lib%20vs.%20panic/near/269326337" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jane Lusby [she/her] <a href="https://zulip-archive.rust-lang.org/stream/219381-t-libs/topic/backtrace.20lib.20vs.2E.20panic.html#269326337">(Jan 25 2022 at 21:21)</a>:</h4>
<p>sounds good, I might also add <code>std::panic::config::get_capture_backtrace() -&gt; bool</code> to the todo list</p>



<a name="269328594"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/219381-t-libs/topic/backtrace%20lib%20vs.%20panic/near/269328594" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> simulacrum <a href="https://zulip-archive.rust-lang.org/stream/219381-t-libs/topic/backtrace.20lib.20vs.2E.20panic.html#269328594">(Jan 25 2022 at 21:37)</a>:</h4>
<p>yeah, sure</p>



<a name="269328671"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/219381-t-libs/topic/backtrace%20lib%20vs.%20panic/near/269328671" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> simulacrum <a href="https://zulip-archive.rust-lang.org/stream/219381-t-libs/topic/backtrace.20lib.20vs.2E.20panic.html#269328671">(Jan 25 2022 at 21:38)</a>:</h4>
<p>maybe it should be a static with a wrapper around an atomicbool, exposing a set/get. not sure yet.</p>



<hr><p>Last updated: Apr 12 2022 at 20:01 UTC</p>
</html>