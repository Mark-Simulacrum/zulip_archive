<html>
<head><meta charset="utf-8"><title>How to replace the core library for cargo build? · t-libs · Zulip Chat Archive</title></head>
<h2>Stream: <a href="https://zulip-archive.rust-lang.org/stream/219381-t-libs/index.html">t-libs</a></h2>
<h3>Topic: <a href="https://zulip-archive.rust-lang.org/stream/219381-t-libs/topic/How.20to.20replace.20the.20core.20library.20for.20cargo.20build.3F.html">How to replace the core library for cargo build?</a></h3>

<hr>

<base href="https://rust-lang.zulipchat.com">

<head><link href="https://zulip-archive.rust-lang.org/style.css" rel="stylesheet"></head>

<a name="274078188"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/219381-t-libs/topic/How%20to%20replace%20the%20core%20library%20for%20cargo%20build%3F/near/274078188" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> JmPotato <a href="https://zulip-archive.rust-lang.org/stream/219381-t-libs/topic/How.20to.20replace.20the.20core.20library.20for.20cargo.20build.3F.html#274078188">(Mar 04 2022 at 04:12)</a>:</h4>
<p>Hello everyone! Sorry to bother you here. I have a noob question on how to replace the core library with my own one. I simply tried to add a crate in <code>Cargo.toml</code> like:</p>
<div class="codehilite" data-code-language="TOML"><pre><span></span><code><span class="k">[dependencies]</span><span class="w"></span>
<span class="n">core</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">path</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">"/Users/jmpotato/Code/rust/library/core"</span><span class="w"> </span><span class="p">}</span><span class="w"></span>
</code></pre></div>
<p>And the <code>cargo build</code> showed these messages which clearly indicate the duplication between my core and the internal library.</p>
<div class="codehilite" data-code-language="Bash"><pre><span></span><code>   <span class="o">=</span> note: the lang item is first defined <span class="k">in</span> crate <span class="sb">`</span>core<span class="sb">`</span>.
   <span class="o">=</span> note: first definition <span class="k">in</span> <span class="sb">`</span>core<span class="sb">`</span> loaded from /Users/jmpotato/.rustup/toolchains/nightly-aarch64-apple-darwin/lib/rustlib/aarch64-apple-darwin/lib/libcore-dd6de681850a671c.rlib
   <span class="o">=</span> note: second definition <span class="k">in</span> the <span class="nb">local</span> crate <span class="o">(</span><span class="sb">`</span>core<span class="sb">`</span><span class="o">)</span><span class="sb">`</span>
</code></pre></div>
<p>So what is the right way to replace the core library?</p>



<a name="274078560"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/219381-t-libs/topic/How%20to%20replace%20the%20core%20library%20for%20cargo%20build%3F/near/274078560" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ibraheem Ahmed <a href="https://zulip-archive.rust-lang.org/stream/219381-t-libs/topic/How.20to.20replace.20the.20core.20library.20for.20cargo.20build.3F.html#274078560">(Mar 04 2022 at 04:18)</a>:</h4>
<p>I'm not sure you can add core as a cargo dep like that, but do you have <code>#![no_core]</code> at the top of your crate?</p>



<a name="274078684"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/219381-t-libs/topic/How%20to%20replace%20the%20core%20library%20for%20cargo%20build%3F/near/274078684" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> JmPotato <a href="https://zulip-archive.rust-lang.org/stream/219381-t-libs/topic/How.20to.20replace.20the.20core.20library.20for.20cargo.20build.3F.html#274078684">(Mar 04 2022 at 04:21)</a>:</h4>
<p><span class="user-mention silent" data-user-id="363998">Ibraheem Ahmed</span> <a href="#narrow/stream/219381-t-libs/topic/How.20to.20replace.20the.20core.20library.20for.20cargo.20build.3F/near/274078560">said</a>:</p>
<blockquote>
<p>I'm not sure you can add core as a cargo dep like that, but do you have <code>#![no_core]</code> at the top of your crate?</p>
</blockquote>
<p>Yes, I have tried<code>#![no_core]</code>, but it did not work. I still got the same error.</p>



<a name="274093192"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/219381-t-libs/topic/How%20to%20replace%20the%20core%20library%20for%20cargo%20build%3F/near/274093192" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> lovelymono <a href="https://zulip-archive.rust-lang.org/stream/219381-t-libs/topic/How.20to.20replace.20the.20core.20library.20for.20cargo.20build.3F.html#274093192">(Mar 04 2022 at 08:02)</a>:</h4>
<p>You might need to add <code>#![no_core]</code> to the top your <code>core</code> library as well.</p>



<a name="274100776"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/219381-t-libs/topic/How%20to%20replace%20the%20core%20library%20for%20cargo%20build%3F/near/274100776" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> bjorn3 <a href="https://zulip-archive.rust-lang.org/stream/219381-t-libs/topic/How.20to.20replace.20the.20core.20library.20for.20cargo.20build.3F.html#274100776">(Mar 04 2022 at 09:18)</a>:</h4>
<p>Do you have any other dependencies? If so they will get the libcore from the sysroot. You could try using xargo in combination with the <code>XARGO_RUST_SRC</code> env var to override the source from which it builds a new sysroot.</p>



<a name="274101368"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/219381-t-libs/topic/How%20to%20replace%20the%20core%20library%20for%20cargo%20build%3F/near/274101368" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> JmPotato <a href="https://zulip-archive.rust-lang.org/stream/219381-t-libs/topic/How.20to.20replace.20the.20core.20library.20for.20cargo.20build.3F.html#274101368">(Mar 04 2022 at 09:23)</a>:</h4>
<p><span class="user-mention" data-user-id="479918">@lovelymono</span> <span class="user-mention" data-user-id="133247">@bjorn3</span> Thank you. I will have a try on these methods!</p>



<hr><p>Last updated: Apr 12 2022 at 20:01 UTC</p>
</html>