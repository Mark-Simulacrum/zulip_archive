<html>
<head><meta charset="utf-8"><title>rustc-dep-of-std explainer? · t-libs · Zulip Chat Archive</title></head>
<h2>Stream: <a href="https://zulip-archive.rust-lang.org/stream/219381-t-libs/index.html">t-libs</a></h2>
<h3>Topic: <a href="https://zulip-archive.rust-lang.org/stream/219381-t-libs/topic/rustc-dep-of-std.20explainer.3F.html">rustc-dep-of-std explainer?</a></h3>

<hr>

<base href="https://rust-lang.zulipchat.com">

<head><link href="https://zulip-archive.rust-lang.org/style.css" rel="stylesheet"></head>

<a name="260908291"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/219381-t-libs/topic/rustc-dep-of-std%20explainer%3F/near/260908291" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Matt H <a href="https://zulip-archive.rust-lang.org/stream/219381-t-libs/topic/rustc-dep-of-std.20explainer.3F.html#260908291">(Nov 10 2021 at 02:28)</a>:</h4>
<p>newbie here, looking into a custom libstd build setup and one of the two blocking issues I'm currently seeing involves the libc dep having the rustc-dep-of-std feature. with the feature enabled I get <code>doesn't have a size known at compile-time</code> errors and without it the build seems to continue to the next blocker. is there a writeup somewhere of how rustc-dep-of-std works so I can understand the implications of that hack? I didn't see it covered in <a href="https://std-dev-guide.rust-lang.org/">https://std-dev-guide.rust-lang.org/</a></p>
<p>specifically what I'm trying to do is use <a href="https://github.com/facebookincubator/reindeer">https://github.com/facebookincubator/reindeer</a> to generate buildfiles for FB's Buck build system based on libstd's in-tree Cargo.toml files. that configuration is turbo-unsupported but the context may help clarify what I'm trying to ramp up on</p>
<p>thanks in advance!</p>



<a name="260913399"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/219381-t-libs/topic/rustc-dep-of-std%20explainer%3F/near/260913399" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> simulacrum <a href="https://zulip-archive.rust-lang.org/stream/219381-t-libs/topic/rustc-dep-of-std.20explainer.3F.html#260913399">(Nov 10 2021 at 02:31)</a>:</h4>
<p>I think there's a long comment in a toml file in tree - try looking for the shim crates we replace with core/std in the root Cargo.toml and then look at their Cargo.tomls</p>



<a name="260913429"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/219381-t-libs/topic/rustc-dep-of-std%20explainer%3F/near/260913429" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> simulacrum <a href="https://zulip-archive.rust-lang.org/stream/219381-t-libs/topic/rustc-dep-of-std.20explainer.3F.html#260913429">(Nov 10 2021 at 02:31)</a>:</h4>
<p>The size errors are likely hiding some actual error in the wall of noise about a missing Lang item or duplicate Lang item</p>



<a name="260914344"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/219381-t-libs/topic/rustc-dep-of-std%20explainer%3F/near/260914344" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Matt H <a href="https://zulip-archive.rust-lang.org/stream/219381-t-libs/topic/rustc-dep-of-std.20explainer.3F.html#260914344">(Nov 10 2021 at 02:38)</a>:</h4>
<p>do you mean library/rustc-std-workspace-core and friends? the Cargo.tomls in those crates in-tree don't have anything useful</p>



<a name="260914365"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/219381-t-libs/topic/rustc-dep-of-std%20explainer%3F/near/260914365" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> simulacrum <a href="https://zulip-archive.rust-lang.org/stream/219381-t-libs/topic/rustc-dep-of-std.20explainer.3F.html#260914365">(Nov 10 2021 at 02:38)</a>:</h4>
<p>Hm I thought they had an explainer</p>



<a name="260914427"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/219381-t-libs/topic/rustc-dep-of-std%20explainer%3F/near/260914427" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> simulacrum <a href="https://zulip-archive.rust-lang.org/stream/219381-t-libs/topic/rustc-dep-of-std.20explainer.3F.html#260914427">(Nov 10 2021 at 02:39)</a>:</h4>
<p>Ah <a href="https://github.com/rust-lang/rust/tree/master/library/rustc-std-workspace-core">https://github.com/rust-lang/rust/tree/master/library/rustc-std-workspace-core</a></p>



<a name="260914432"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/219381-t-libs/topic/rustc-dep-of-std%20explainer%3F/near/260914432" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> simulacrum <a href="https://zulip-archive.rust-lang.org/stream/219381-t-libs/topic/rustc-dep-of-std.20explainer.3F.html#260914432">(Nov 10 2021 at 02:39)</a>:</h4>
<p>(readme)</p>



<a name="260914436"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/219381-t-libs/topic/rustc-dep-of-std%20explainer%3F/near/260914436" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Matt H <a href="https://zulip-archive.rust-lang.org/stream/219381-t-libs/topic/rustc-dep-of-std.20explainer.3F.html#260914436">(Nov 10 2021 at 02:39)</a>:</h4>
<p>the README.md in the core one explains what the shim packages are for, but it's not clear to me what rustc-dep-of-std does. is that just a cfg gate that says to depend on those workspace crates?</p>



<a name="260914650"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/219381-t-libs/topic/rustc-dep-of-std%20explainer%3F/near/260914650" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> simulacrum <a href="https://zulip-archive.rust-lang.org/stream/219381-t-libs/topic/rustc-dep-of-std.20explainer.3F.html#260914650">(Nov 10 2021 at 02:41)</a>:</h4>
<p>Essentially yes</p>



<a name="260914849"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/219381-t-libs/topic/rustc-dep-of-std%20explainer%3F/near/260914849" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> simulacrum <a href="https://zulip-archive.rust-lang.org/stream/219381-t-libs/topic/rustc-dep-of-std.20explainer.3F.html#260914849">(Nov 10 2021 at 02:42)</a>:</h4>
<p>(the library source code may not necessarily reference it directly, e.g. hash brown has <a href="https://github.com/rust-lang/hashbrown/blob/master/Cargo.toml#L44">https://github.com/rust-lang/hashbrown/blob/master/Cargo.toml#L44</a>)</p>



<a name="260915050"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/219381-t-libs/topic/rustc-dep-of-std%20explainer%3F/near/260915050" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Matt H <a href="https://zulip-archive.rust-lang.org/stream/219381-t-libs/topic/rustc-dep-of-std.20explainer.3F.html#260915050">(Nov 10 2021 at 02:45)</a>:</h4>
<p>okay so thinking out loud, removing that feature from libc would result in things that dep on it being built with the distribution's core crate rather than the in-tree one which will cause problems when linking to the libstd/libcore i'm trying to build. so i'm robbing peter to pay paul here</p>
<p>cool cool, thank you for your help!</p>



<hr><p>Last updated: Apr 12 2022 at 20:01 UTC</p>
</html>