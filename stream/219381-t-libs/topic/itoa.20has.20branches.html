<html>
<head><meta charset="utf-8"><title>itoa has branches · t-libs · Zulip Chat Archive</title></head>
<h2>Stream: <a href="https://zulip-archive.rust-lang.org/stream/219381-t-libs/index.html">t-libs</a></h2>
<h3>Topic: <a href="https://zulip-archive.rust-lang.org/stream/219381-t-libs/topic/itoa.20has.20branches.html">itoa has branches</a></h3>

<hr>

<base href="https://rust-lang.zulipchat.com">

<head><link href="https://zulip-archive.rust-lang.org/style.css" rel="stylesheet"></head>

<a name="250420557"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/219381-t-libs/topic/itoa%20has%20branches/near/250420557" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Bot+ <a href="https://zulip-archive.rust-lang.org/stream/219381-t-libs/topic/itoa.20has.20branches.html#250420557">(Aug 23 2021 at 22:30)</a>:</h4>
<p><a href="https://github.com/rust-lang/rust/blob/master/library/core/src/fmt/num.rs#L249-L264">https://github.com/rust-lang/rust/blob/master/library/core/src/fmt/num.rs#L249-L264</a></p>
<p>Edited itoa crate is about 10% faster than itoa 0.4.8 in a local micro bench.</p>
<p><a href="https://play.rust-lang.org/?version=nightly&amp;mode=debug&amp;edition=2018&amp;gist=d9d5f7345ea2609ad7ce053b05cbfc3e">https://play.rust-lang.org/?version=nightly&amp;mode=debug&amp;edition=2018&amp;gist=d9d5f7345ea2609ad7ce053b05cbfc3e</a></p>



<a name="250422983"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/219381-t-libs/topic/itoa%20has%20branches/near/250422983" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jacob Pratt <a href="https://zulip-archive.rust-lang.org/stream/219381-t-libs/topic/itoa.20has.20branches.html#250422983">(Aug 23 2021 at 23:00)</a>:</h4>
<p>Wait, itoa was pulled into stdlib?</p>



<a name="250428669"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/219381-t-libs/topic/itoa%20has%20branches/near/250428669" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Thom Chiovoloni <a href="https://zulip-archive.rust-lang.org/stream/219381-t-libs/topic/itoa.20has.20branches.html#250428669">(Aug 24 2021 at 00:13)</a>:</h4>
<p>the worlds smallest nit: <a href="https://github.com/rust-lang/rust/blob/master/library/core/src/fmt/num.rs#L203">https://github.com/rust-lang/rust/blob/master/library/core/src/fmt/num.rs#L203</a> should use <code>[u8; 200]</code> (not <code>&amp;[u8; 200]</code>) to avoid an extra relocation</p>



<a name="250428798"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/219381-t-libs/topic/itoa%20has%20branches/near/250428798" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Gary Guo <a href="https://zulip-archive.rust-lang.org/stream/219381-t-libs/topic/itoa.20has.20branches.html#250428798">(Aug 24 2021 at 00:15)</a>:</h4>
<p>I guess change <code>static</code> to <code>const</code> would do the same trick.</p>



<a name="250429011"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/219381-t-libs/topic/itoa%20has%20branches/near/250429011" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Thom Chiovoloni <a href="https://zulip-archive.rust-lang.org/stream/219381-t-libs/topic/itoa.20has.20branches.html#250429011">(Aug 24 2021 at 00:19)</a>:</h4>
<p>it might yeah. i'd still suggest making the deref explicit, but const has more leeway here so maybe it can figure it out and not require a reloc for the pointer to the data in addition to the data.</p>



<a name="250429452"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/219381-t-libs/topic/itoa%20has%20branches/near/250429452" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Gary Guo <a href="https://zulip-archive.rust-lang.org/stream/219381-t-libs/topic/itoa.20has.20branches.html#250429452">(Aug 24 2021 at 00:27)</a>:</h4>
<p>Well, <code>const</code> is generally preferred to <code>static</code> because they don't need an unique address. <a href="https://godbolt.org/z/eKG9j4n5G">https://godbolt.org/z/eKG9j4n5G</a></p>
<p>Having said that, I don't think there'll be multiple copies of this string so it wouldn't matter.</p>



<a name="250430304"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/219381-t-libs/topic/itoa%20has%20branches/near/250430304" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Thom Chiovoloni <a href="https://zulip-archive.rust-lang.org/stream/219381-t-libs/topic/itoa.20has.20branches.html#250430304">(Aug 24 2021 at 00:40)</a>:</h4>
<p>well, the multiple copies isn't what i'm referring to, its the two relocations (one for the pointer to the data, and one for the data itself). only one of those is needed. this won't show up in godbolt, though. that said, yeah, in general const is better, i agree.</p>



<a name="250430336"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/219381-t-libs/topic/itoa%20has%20branches/near/250430336" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Thom Chiovoloni <a href="https://zulip-archive.rust-lang.org/stream/219381-t-libs/topic/itoa.20has.20branches.html#250430336">(Aug 24 2021 at 00:41)</a>:</h4>
<p>i think you can still have the same problem here i'm talking about with const, but i'm not positive. anyway, its a super minor complaint. it makes like, 8b/16b of difference in the binary size, and a bit of perf when during loading as well as accessing.</p>



<a name="250430921"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/219381-t-libs/topic/itoa%20has%20branches/near/250430921" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Gary Guo <a href="https://zulip-archive.rust-lang.org/stream/219381-t-libs/topic/itoa.20has.20branches.html#250430921">(Aug 24 2021 at 00:50)</a>:</h4>
<p><code>const</code> won't have the additional deref. It's a value and doesn't have an address.</p>
<p><a href="https://godbolt.org/z/Gr9fc7vjG">https://godbolt.org/z/Gr9fc7vjG</a>  This example shows that all 3 functions are exactly the same so they are merged.  Actually there isn't a runtime overhead of the current approach.</p>



<a name="250430964"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/219381-t-libs/topic/itoa%20has%20branches/near/250430964" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Thom Chiovoloni <a href="https://zulip-archive.rust-lang.org/stream/219381-t-libs/topic/itoa.20has.20branches.html#250430964">(Aug 24 2021 at 00:51)</a>:</h4>
<p>ah, nice, okay</p>



<a name="250430988"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/219381-t-libs/topic/itoa%20has%20branches/near/250430988" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Thom Chiovoloni <a href="https://zulip-archive.rust-lang.org/stream/219381-t-libs/topic/itoa.20has.20branches.html#250430988">(Aug 24 2021 at 00:51)</a>:</h4>
<p>okay, so using const instead would also fix this.</p>



<hr><p>Last updated: Apr 12 2022 at 20:01 UTC</p>
</html>