<html>
<head><meta charset="utf-8"><title>std::sync::mpsc · t-libs · Zulip Chat Archive</title></head>
<h2>Stream: <a href="https://zulip-archive.rust-lang.org/stream/219381-t-libs/index.html">t-libs</a></h2>
<h3>Topic: <a href="https://zulip-archive.rust-lang.org/stream/219381-t-libs/topic/std.3A.3Async.3A.3Ampsc.html">std::sync::mpsc</a></h3>

<hr>

<base href="https://rust-lang.zulipchat.com">

<head><link href="https://zulip-archive.rust-lang.org/style.css" rel="stylesheet"></head>

<a name="252502734"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/219381-t-libs/topic/std%3A%3Async%3A%3Ampsc/near/252502734" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Triplett <a href="https://zulip-archive.rust-lang.org/stream/219381-t-libs/topic/std.3A.3Async.3A.3Ampsc.html#252502734">(Sep 08 2021 at 17:44)</a>:</h4>
<p><a href="https://github.com/rust-lang/rust/pull/88612">https://github.com/rust-lang/rust/pull/88612</a></p>



<a name="252502796"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/219381-t-libs/topic/std%3A%3Async%3A%3Ampsc/near/252502796" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Triplett <a href="https://zulip-archive.rust-lang.org/stream/219381-t-libs/topic/std.3A.3Async.3A.3Ampsc.html#252502796">(Sep 08 2021 at 17:44)</a>:</h4>
<p>I'd love to discuss what we should do about mpsc.</p>



<a name="252502915"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/219381-t-libs/topic/std%3A%3Async%3A%3Ampsc/near/252502915" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Mara <a href="https://zulip-archive.rust-lang.org/stream/219381-t-libs/topic/std.3A.3Async.3A.3Ampsc.html#252502915">(Sep 08 2021 at 17:45)</a>:</h4>
<p>i believe <span class="user-mention" data-user-id="116015">@Alex Crichton</span> has opinions on that ^^</p>



<a name="252503051"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/219381-t-libs/topic/std%3A%3Async%3A%3Ampsc/near/252503051" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Alex Crichton <a href="https://zulip-archive.rust-lang.org/stream/219381-t-libs/topic/std.3A.3Async.3A.3Ampsc.html#252503051">(Sep 08 2021 at 17:46)</a>:</h4>
<p>My opinion is that it should be burned with fire</p>



<a name="252503076"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/219381-t-libs/topic/std%3A%3Async%3A%3Ampsc/near/252503076" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Alex Crichton <a href="https://zulip-archive.rust-lang.org/stream/219381-t-libs/topic/std.3A.3Async.3A.3Ampsc.html#252503076">(Sep 08 2021 at 17:46)</a>:</h4>
<p>aka deprecated-and-forgotten</p>



<a name="252503081"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/219381-t-libs/topic/std%3A%3Async%3A%3Ampsc/near/252503081" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Triplett <a href="https://zulip-archive.rust-lang.org/stream/219381-t-libs/topic/std.3A.3Async.3A.3Ampsc.html#252503081">(Sep 08 2021 at 17:46)</a>:</h4>
<p>There's an element of "who will bell the cat" in it, but I'd like to start with the question of consensus before we try to figure out who will do the work. Can we confirm that we want the work done? Would we take a PR that rewrites mpsc atop another channel library (e.g. flume)? Or a PR that turns it into a low-performance but reliable system, using a mutex?</p>



<a name="252503083"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/219381-t-libs/topic/std%3A%3Async%3A%3Ampsc/near/252503083" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Notification Bot <a href="https://zulip-archive.rust-lang.org/stream/219381-t-libs/topic/std.3A.3Async.3A.3Ampsc.html#252503083">(Sep 08 2021 at 17:46)</a>:</h4>
<p>This topic was moved here from <a class="stream-topic" data-stream-id="259402" href="/#narrow/stream/259402-t-libs.2Fmeetings/topic/Meetings.202021-09-08">#t-libs/meetings &gt; Meetings 2021-09-08</a> by <span class="user-mention silent" data-user-id="310399">Mara</span></p>



<a name="252503112"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/219381-t-libs/topic/std%3A%3Async%3A%3Ampsc/near/252503112" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Triplett <a href="https://zulip-archive.rust-lang.org/stream/219381-t-libs/topic/std.3A.3Async.3A.3Ampsc.html#252503112">(Sep 08 2021 at 17:46)</a>:</h4>
<p>And, orthogonally to those, we could mark it deprecated. I think we might still want to make it not-broken, though.</p>



<a name="252503185"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/219381-t-libs/topic/std%3A%3Async%3A%3Ampsc/near/252503185" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Alex Crichton <a href="https://zulip-archive.rust-lang.org/stream/219381-t-libs/topic/std.3A.3Async.3A.3Ampsc.html#252503185">(Sep 08 2021 at 17:47)</a>:</h4>
<p>well, my recommendation would be to take one of those routes, deprecation or rewrite-with-mutex</p>



<a name="252503211"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/219381-t-libs/topic/std%3A%3Async%3A%3Ampsc/near/252503211" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Alex Crichton <a href="https://zulip-archive.rust-lang.org/stream/219381-t-libs/topic/std.3A.3Async.3A.3Ampsc.html#252503211">(Sep 08 2021 at 17:47)</a>:</h4>
<p>my opinion is the deprecation one</p>



<a name="252503234"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/219381-t-libs/topic/std%3A%3Async%3A%3Ampsc/near/252503234" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Triplett <a href="https://zulip-archive.rust-lang.org/stream/219381-t-libs/topic/std.3A.3Async.3A.3Ampsc.html#252503234">(Sep 08 2021 at 17:47)</a>:</h4>
<p><span class="user-mention silent" data-user-id="116015">Alex Crichton</span> <a href="#narrow/stream/219381-t-libs/topic/std.3A.3Async.3A.3Ampsc/near/252503185">said</a>:</p>
<blockquote>
<p>well, my recommendation would be to take one of those routes, deprecation or rewrite-with-mutex</p>
</blockquote>
<p>What's this "or" business? ;)</p>



<a name="252503246"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/219381-t-libs/topic/std%3A%3Async%3A%3Ampsc/near/252503246" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Alex Crichton <a href="https://zulip-archive.rust-lang.org/stream/219381-t-libs/topic/std.3A.3Async.3A.3Ampsc.html#252503246">(Sep 08 2021 at 17:47)</a>:</h4>
<p>but hey if someone wants to do both I can't disagree :)</p>



<a name="252503329"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/219381-t-libs/topic/std%3A%3Async%3A%3Ampsc/near/252503329" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Alex Crichton <a href="https://zulip-archive.rust-lang.org/stream/219381-t-libs/topic/std.3A.3Async.3A.3Ampsc.html#252503329">(Sep 08 2021 at 17:48)</a>:</h4>
<p>but whatever you do make sure no one uses my code again there please</p>



<a name="252504352"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/219381-t-libs/topic/std%3A%3Async%3A%3Ampsc/near/252504352" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Triplett <a href="https://zulip-archive.rust-lang.org/stream/219381-t-libs/topic/std.3A.3Async.3A.3Ampsc.html#252504352">(Sep 08 2021 at 17:55)</a>:</h4>
<p>Informally gauging consensus (cc <span class="user-group-mention" data-user-group-id="4493">@T-libs</span>):</p>



<a name="252504400"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/219381-t-libs/topic/std%3A%3Async%3A%3Ampsc/near/252504400" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Triplett <a href="https://zulip-archive.rust-lang.org/stream/219381-t-libs/topic/std.3A.3Async.3A.3Ampsc.html#252504400">(Sep 08 2021 at 17:55)</a>:</h4>
<p>Could I get a <span aria-label="+1" class="emoji emoji-1f44d" role="img" title="+1">:+1:</span> or <span aria-label="-1" class="emoji emoji-1f44e" role="img" title="-1">:-1:</span> on a consensus of "please replace mpsc wholesale with the simplest possible code that works, using a mutex and not worrying about performance"?</p>



<a name="252504506"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/219381-t-libs/topic/std%3A%3Async%3A%3Ampsc/near/252504506" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Amanieu <a href="https://zulip-archive.rust-lang.org/stream/219381-t-libs/topic/std.3A.3Async.3A.3Ampsc.html#252504506">(Sep 08 2021 at 17:56)</a>:</h4>
<p>Yes to replacing, no to deprecating since there's a ton of code that uses channels in tests.</p>



<a name="252504507"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/219381-t-libs/topic/std%3A%3Async%3A%3Ampsc/near/252504507" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Mara <a href="https://zulip-archive.rust-lang.org/stream/219381-t-libs/topic/std.3A.3Async.3A.3Ampsc.html#252504507">(Sep 08 2021 at 17:56)</a>:</h4>
<p><del>delete the code and pretend it was never there</del></p>



<a name="252504513"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/219381-t-libs/topic/std%3A%3Async%3A%3Ampsc/near/252504513" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Triplett <a href="https://zulip-archive.rust-lang.org/stream/219381-t-libs/topic/std.3A.3Async.3A.3Ampsc.html#252504513">(Sep 08 2021 at 17:56)</a>:</h4>
<p>And separately, could I get a <span aria-label="+1" class="emoji emoji-1f44d" role="img" title="+1">:+1:</span> or <span aria-label="-1" class="emoji emoji-1f44e" role="img" title="-1">:-1:</span> on a consensus of "mark mpsc as deprecated so everyone using it gets a warning, and steer people towards third-party channel libraries instead"?</p>



<a name="252504623"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/219381-t-libs/topic/std%3A%3Async%3A%3Ampsc/near/252504623" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Triplett <a href="https://zulip-archive.rust-lang.org/stream/219381-t-libs/topic/std.3A.3Async.3A.3Ampsc.html#252504623">(Sep 08 2021 at 17:57)</a>:</h4>
<p><span class="user-mention" data-user-id="143274">@Amanieu</span> Interesting. Why does that use in tests motivate not deprecating it? What would prevent replacing that code with something using a better channel crate?</p>



<a name="252504658"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/219381-t-libs/topic/std%3A%3Async%3A%3Ampsc/near/252504658" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Triplett <a href="https://zulip-archive.rust-lang.org/stream/219381-t-libs/topic/std.3A.3Async.3A.3Ampsc.html#252504658">(Sep 08 2021 at 17:57)</a>:</h4>
<p>(I'm not necessarily trying to argue for deprecating, I'm asking what consideration I'm missing there.)</p>



<a name="252504689"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/219381-t-libs/topic/std%3A%3Async%3A%3Ampsc/near/252504689" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Amanieu <a href="https://zulip-archive.rust-lang.org/stream/219381-t-libs/topic/std.3A.3Async.3A.3Ampsc.html#252504689">(Sep 08 2021 at 17:57)</a>:</h4>
<p>It just feels like a lot of churn in the ecosystem, which I'd like to avoid.</p>



<a name="252505665"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/219381-t-libs/topic/std%3A%3Async%3A%3Ampsc/near/252505665" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> BurntSushi <a href="https://zulip-archive.rust-lang.org/stream/219381-t-libs/topic/std.3A.3Async.3A.3Ampsc.html#252505665">(Sep 08 2021 at 18:03)</a>:</h4>
<p>the churn thing is compelling to me personally, although i could be convinced otherwise with numbers. e.g., if the prevalence of its use is much smaller than i think it is.</p>
<p>i like the idea of replacing it with a simple implementation. the fact that we don't have a <code>select!</code> thingy should make it quite a bit simpler than it otherwise would be i think. and very likely fast enough for most use cases.</p>



<a name="252506900"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/219381-t-libs/topic/std%3A%3Async%3A%3Ampsc/near/252506900" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> The 8472 <a href="https://zulip-archive.rust-lang.org/stream/219381-t-libs/topic/std.3A.3Async.3A.3Ampsc.html#252506900">(Sep 08 2021 at 18:10)</a>:</h4>
<p>from <a href="https://github.com/rust-lang/rust/issues/39364#issuecomment-880136715">https://github.com/rust-lang/rust/issues/39364#issuecomment-880136715</a></p>
<blockquote>
<p>If I recall correctly there were some talks about adding crossbeam-channel to the standard library as additional channel implementation and deprecate std::sync::mpsc. I believe the interface between the two is sufficiently incompatible that it is not possible to make the current channel interface backed by crossbeam-channel. </p>
</blockquote>
<p>it would be good to know where the impedance mismatches are to other libraries. maybe the gaps could be bridged one way or another?</p>



<a name="252508166"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/219381-t-libs/topic/std%3A%3Async%3A%3Ampsc/near/252508166" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> cuviper <a href="https://zulip-archive.rust-lang.org/stream/219381-t-libs/topic/std.3A.3Async.3A.3Ampsc.html#252508166">(Sep 08 2021 at 18:18)</a>:</h4>
<p>back-ref: <a href="#narrow/stream/219381-t-libs/topic/Replacing.20mpsc/near/212616741">https://rust-lang.zulipchat.com/#narrow/stream/219381-t-libs/topic/Replacing.20mpsc/near/212616741</a></p>



<hr><p>Last updated: Apr 12 2022 at 20:01 UTC</p>
</html>