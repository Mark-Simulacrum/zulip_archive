<html>
<head><meta charset="utf-8"><title>heads-up: is it ok to duplicate `primitive_docs.rs` in core? · t-libs · Zulip Chat Archive</title></head>
<h2>Stream: <a href="https://zulip-archive.rust-lang.org/stream/219381-t-libs/index.html">t-libs</a></h2>
<h3>Topic: <a href="https://zulip-archive.rust-lang.org/stream/219381-t-libs/topic/heads-up.3A.20is.20it.20ok.20to.20duplicate.20.60primitive_docs.2Ers.60.20in.20core.3F.html">heads-up: is it ok to duplicate `primitive_docs.rs` in core?</a></h3>

<hr>

<base href="https://rust-lang.zulipchat.com">

<head><link href="https://zulip-archive.rust-lang.org/style.css" rel="stylesheet"></head>

<a name="252557609"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/219381-t-libs/topic/heads-up%3A%20is%20it%20ok%20to%20duplicate%20%60primitive_docs.rs%60%20in%20core%3F/near/252557609" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joshua Nelson <a href="https://zulip-archive.rust-lang.org/stream/219381-t-libs/topic/heads-up.3A.20is.20it.20ok.20to.20duplicate.20.60primitive_docs.2Ers.60.20in.20core.3F.html#252557609">(Sep 09 2021 at 01:23)</a>:</h4>
<p><span aria-label="wave" class="emoji emoji-1f44b" role="img" title="wave">:wave:</span> I pinged on <a href="https://github.com/rust-lang/rust/pull/87073">https://github.com/rust-lang/rust/pull/87073</a> but never got a response - is it ok to duplicate the entire ~1000 line file of <a href="http://primitive_docs.rs">primitive_docs.rs</a> in core? I added a tidy check to make sure it's kept in sync with the version in std, but it is an extra step every time you need to modify it.</p>



<a name="252565253"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/219381-t-libs/topic/heads-up%3A%20is%20it%20ok%20to%20duplicate%20%60primitive_docs.rs%60%20in%20core%3F/near/252565253" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> cuviper <a href="https://zulip-archive.rust-lang.org/stream/219381-t-libs/topic/heads-up.3A.20is.20it.20ok.20to.20duplicate.20.60primitive_docs.2Ers.60.20in.20core.3F.html#252565253">(Sep 09 2021 at 03:14)</a>:</h4>
<p>If it's literally the same, can you <code>#[path]</code> it?</p>



<a name="252565419"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/219381-t-libs/topic/heads-up%3A%20is%20it%20ok%20to%20duplicate%20%60primitive_docs.rs%60%20in%20core%3F/near/252565419" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joshua Nelson <a href="https://zulip-archive.rust-lang.org/stream/219381-t-libs/topic/heads-up.3A.20is.20it.20ok.20to.20duplicate.20.60primitive_docs.2Ers.60.20in.20core.3F.html#252565419">(Sep 09 2021 at 03:16)</a>:</h4>
<p>no, unfortunately - <code>include_str!</code> works relative to the file itself, not the rust module</p>



<a name="252565437"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/219381-t-libs/topic/heads-up%3A%20is%20it%20ok%20to%20duplicate%20%60primitive_docs.rs%60%20in%20core%3F/near/252565437" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joshua Nelson <a href="https://zulip-archive.rust-lang.org/stream/219381-t-libs/topic/heads-up.3A.20is.20it.20ok.20to.20duplicate.20.60primitive_docs.2Ers.60.20in.20core.3F.html#252565437">(Sep 09 2021 at 03:17)</a>:</h4>
<p>see <a href="#narrow/stream/122651-general/topic/Who.20should.20review.20changes.20to.20linkchecker.3F/near/249939598">https://rust-lang.zulipchat.com/#narrow/stream/122651-general/topic/Who.20should.20review.20changes.20to.20linkchecker.3F/near/249939598</a></p>



<a name="252565754"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/219381-t-libs/topic/heads-up%3A%20is%20it%20ok%20to%20duplicate%20%60primitive_docs.rs%60%20in%20core%3F/near/252565754" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joshua Nelson <a href="https://zulip-archive.rust-lang.org/stream/219381-t-libs/topic/heads-up.3A.20is.20it.20ok.20to.20duplicate.20.60primitive_docs.2Ers.60.20in.20core.3F.html#252565754">(Sep 09 2021 at 03:22)</a>:</h4>
<p>(I approved <a href="https://github.com/rust-lang/rust/pull/87073">https://github.com/rust-lang/rust/pull/87073</a> for now, but happy to make changes in follow ups - I just really want to get it merged so it can unblock other rustdoc PRs)</p>



<a name="252577022"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/219381-t-libs/topic/heads-up%3A%20is%20it%20ok%20to%20duplicate%20%60primitive_docs.rs%60%20in%20core%3F/near/252577022" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Mara <a href="https://zulip-archive.rust-lang.org/stream/219381-t-libs/topic/heads-up.3A.20is.20it.20ok.20to.20duplicate.20.60primitive_docs.2Ers.60.20in.20core.3F.html#252577022">(Sep 09 2021 at 06:26)</a>:</h4>
<blockquote>
<p>is it ok to duplicate the entire ~1000 line file of <a href="http://primitive_docs.rs">primitive_docs.rs</a> in core?</p>
</blockquote>
<p>every time we've had duplication in the standard library, only one of the copies ended up being maintained.</p>



<a name="252578010"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/219381-t-libs/topic/heads-up%3A%20is%20it%20ok%20to%20duplicate%20%60primitive_docs.rs%60%20in%20core%3F/near/252578010" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Mara <a href="https://zulip-archive.rust-lang.org/stream/219381-t-libs/topic/heads-up.3A.20is.20it.20ok.20to.20duplicate.20.60primitive_docs.2Ers.60.20in.20core.3F.html#252578010">(Sep 09 2021 at 06:38)</a>:</h4>
<p>but with the tidy check here that's not a risk</p>



<a name="252596818"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/219381-t-libs/topic/heads-up%3A%20is%20it%20ok%20to%20duplicate%20%60primitive_docs.rs%60%20in%20core%3F/near/252596818" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> The 8472 <a href="https://zulip-archive.rust-lang.org/stream/219381-t-libs/topic/heads-up.3A.20is.20it.20ok.20to.20duplicate.20.60primitive_docs.2Ers.60.20in.20core.3F.html#252596818">(Sep 09 2021 at 09:31)</a>:</h4>
<p>why not check a symlink into git?</p>



<a name="252599687"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/219381-t-libs/topic/heads-up%3A%20is%20it%20ok%20to%20duplicate%20%60primitive_docs.rs%60%20in%20core%3F/near/252599687" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> bjorn3 <a href="https://zulip-archive.rust-lang.org/stream/219381-t-libs/topic/heads-up.3A.20is.20it.20ok.20to.20duplicate.20.60primitive_docs.2Ers.60.20in.20core.3F.html#252599687">(Sep 09 2021 at 09:56)</a>:</h4>
<p>Before windows 10 symlinks could only be created by administrators. Even on windows 10 you need to enable developer mode first. <a href="https://blogs.windows.com/windowsdeveloper/2016/12/02/symlinks-windows-10/">https://blogs.windows.com/windowsdeveloper/2016/12/02/symlinks-windows-10/</a></p>



<a name="252603638"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/219381-t-libs/topic/heads-up%3A%20is%20it%20ok%20to%20duplicate%20%60primitive_docs.rs%60%20in%20core%3F/near/252603638" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> The 8472 <a href="https://zulip-archive.rust-lang.org/stream/219381-t-libs/topic/heads-up.3A.20is.20it.20ok.20to.20duplicate.20.60primitive_docs.2Ers.60.20in.20core.3F.html#252603638">(Sep 09 2021 at 10:32)</a>:</h4>
<p>afaik git has workarounds for non-symlink enabled windows. and I assume most developers would have developer mode enabled anyway</p>



<a name="252613642"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/219381-t-libs/topic/heads-up%3A%20is%20it%20ok%20to%20duplicate%20%60primitive_docs.rs%60%20in%20core%3F/near/252613642" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joshua Nelson <a href="https://zulip-archive.rust-lang.org/stream/219381-t-libs/topic/heads-up.3A.20is.20it.20ok.20to.20duplicate.20.60primitive_docs.2Ers.60.20in.20core.3F.html#252613642">(Sep 09 2021 at 12:07)</a>:</h4>
<blockquote>
<blockquote>
<p>is it ok to duplicate the entire ~1000 line file of <a href="http://primitive_docs.rs">primitive_docs.rs</a> in core?</p>
</blockquote>
</blockquote>
<blockquote>
<p>every time we've had duplication in the standard library, only one of the copies ended up being maintained.</p>
</blockquote>
<p>Yeah the tidy check has already fired like 5 times just for my own changes <span aria-label="laughing" class="emoji emoji-1f606" role="img" title="laughing">:laughing:</span> it was a great call by <span class="user-mention" data-user-id="116122">@simulacrum</span></p>



<a name="252613986"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/219381-t-libs/topic/heads-up%3A%20is%20it%20ok%20to%20duplicate%20%60primitive_docs.rs%60%20in%20core%3F/near/252613986" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joshua Nelson <a href="https://zulip-archive.rust-lang.org/stream/219381-t-libs/topic/heads-up.3A.20is.20it.20ok.20to.20duplicate.20.60primitive_docs.2Ers.60.20in.20core.3F.html#252613986">(Sep 09 2021 at 12:09)</a>:</h4>
<p>Lol well you have a little more time if you want to block this, CI keeps failing</p>



<a name="252616200"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/219381-t-libs/topic/heads-up%3A%20is%20it%20ok%20to%20duplicate%20%60primitive_docs.rs%60%20in%20core%3F/near/252616200" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> The 8472 <a href="https://zulip-archive.rust-lang.org/stream/219381-t-libs/topic/heads-up.3A.20is.20it.20ok.20to.20duplicate.20.60primitive_docs.2Ers.60.20in.20core.3F.html#252616200">(Sep 09 2021 at 12:26)</a>:</h4>
<p>or maybe a <a href="http://build.rs">build.rs</a> in std that copies it in from core?</p>



<a name="252616346"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/219381-t-libs/topic/heads-up%3A%20is%20it%20ok%20to%20duplicate%20%60primitive_docs.rs%60%20in%20core%3F/near/252616346" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joshua Nelson <a href="https://zulip-archive.rust-lang.org/stream/219381-t-libs/topic/heads-up.3A.20is.20it.20ok.20to.20duplicate.20.60primitive_docs.2Ers.60.20in.20core.3F.html#252616346">(Sep 09 2021 at 12:27)</a>:</h4>
<p>not sure if that's more or less hacky <span aria-label="laughing" class="emoji emoji-1f606" role="img" title="laughing">:laughing:</span> but t-libs are the one's who'll have to maintain it so I'll let you decide</p>



<a name="252616380"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/219381-t-libs/topic/heads-up%3A%20is%20it%20ok%20to%20duplicate%20%60primitive_docs.rs%60%20in%20core%3F/near/252616380" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joshua Nelson <a href="https://zulip-archive.rust-lang.org/stream/219381-t-libs/topic/heads-up.3A.20is.20it.20ok.20to.20duplicate.20.60primitive_docs.2Ers.60.20in.20core.3F.html#252616380">(Sep 09 2021 at 12:27)</a>:</h4>
<p>(personally I want to just use CARGO_PKG_NAME but <span class="user-mention silent" data-user-id="116122">simulacrum</span> asked me not to)</p>



<a name="252616783"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/219381-t-libs/topic/heads-up%3A%20is%20it%20ok%20to%20duplicate%20%60primitive_docs.rs%60%20in%20core%3F/near/252616783" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joshua Nelson <a href="https://zulip-archive.rust-lang.org/stream/219381-t-libs/topic/heads-up.3A.20is.20it.20ok.20to.20duplicate.20.60primitive_docs.2Ers.60.20in.20core.3F.html#252616783">(Sep 09 2021 at 12:30)</a>:</h4>
<p><span class="user-mention silent" data-user-id="133247">bjorn3</span> <a href="#narrow/stream/219381-t-libs/topic/heads-up.3A.20is.20it.20ok.20to.20duplicate.20.60primitive_docs.2Ers.60.20in.20core.3F/near/252599687">said</a>:</p>
<blockquote>
<p>Before windows 10 symlinks could only be created by administrators. Even on windows 10 you need to enable developer mode first. <a href="https://blogs.windows.com/windowsdeveloper/2016/12/02/symlinks-windows-10/">https://blogs.windows.com/windowsdeveloper/2016/12/02/symlinks-windows-10/</a></p>
</blockquote>
<p>I would be fine with symlinks, but I don't have a way to test on windows</p>



<a name="252616807"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/219381-t-libs/topic/heads-up%3A%20is%20it%20ok%20to%20duplicate%20%60primitive_docs.rs%60%20in%20core%3F/near/252616807" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joshua Nelson <a href="https://zulip-archive.rust-lang.org/stream/219381-t-libs/topic/heads-up.3A.20is.20it.20ok.20to.20duplicate.20.60primitive_docs.2Ers.60.20in.20core.3F.html#252616807">(Sep 09 2021 at 12:30)</a>:</h4>
<p>I guess mingw-check should probably test this case</p>



<a name="252637232"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/219381-t-libs/topic/heads-up%3A%20is%20it%20ok%20to%20duplicate%20%60primitive_docs.rs%60%20in%20core%3F/near/252637232" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> CraftSpider <a href="https://zulip-archive.rust-lang.org/stream/219381-t-libs/topic/heads-up.3A.20is.20it.20ok.20to.20duplicate.20.60primitive_docs.2Ers.60.20in.20core.3F.html#252637232">(Sep 09 2021 at 14:39)</a>:</h4>
<p>Anecdotal Evidence: I use my PC for programming all the time, and have never bothered to enable windows development mode. It's mostly just for developing Windows apps based on the Windows developer docs.<br>
I'd prefer avoiding requiring something like that to make Rust work nicely, Windows already often feels like a second-class environment, and it would be nice if rustc didn't make that worse.</p>



<a name="252661454"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/219381-t-libs/topic/heads-up%3A%20is%20it%20ok%20to%20duplicate%20%60primitive_docs.rs%60%20in%20core%3F/near/252661454" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Triplett <a href="https://zulip-archive.rust-lang.org/stream/219381-t-libs/topic/heads-up.3A.20is.20it.20ok.20to.20duplicate.20.60primitive_docs.2Ers.60.20in.20core.3F.html#252661454">(Sep 09 2021 at 17:12)</a>:</h4>
<p>Is it not possible to pub use the core version in std?</p>



<a name="252674125"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/219381-t-libs/topic/heads-up%3A%20is%20it%20ok%20to%20duplicate%20%60primitive_docs.rs%60%20in%20core%3F/near/252674125" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joshua Nelson <a href="https://zulip-archive.rust-lang.org/stream/219381-t-libs/topic/heads-up.3A.20is.20it.20ok.20to.20duplicate.20.60primitive_docs.2Ers.60.20in.20core.3F.html#252674125">(Sep 09 2021 at 18:36)</a>:</h4>
<p><span class="user-mention" data-user-id="239881">@Josh Triplett</span> the reason these are different is so that std can use intra-doc links, which don't break on re-exports. Core can't use intra-doc links because alloc and std use lang_items to define <code>impl</code>s on primitives.</p>



<a name="252674234"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/219381-t-libs/topic/heads-up%3A%20is%20it%20ok%20to%20duplicate%20%60primitive_docs.rs%60%20in%20core%3F/near/252674234" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joshua Nelson <a href="https://zulip-archive.rust-lang.org/stream/219381-t-libs/topic/heads-up.3A.20is.20it.20ok.20to.20duplicate.20.60primitive_docs.2Ers.60.20in.20core.3F.html#252674234">(Sep 09 2021 at 18:37)</a>:</h4>
<p>changing std not to override the docs from core would be a regression and add a bunch more broken links</p>



<a name="252674440"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/219381-t-libs/topic/heads-up%3A%20is%20it%20ok%20to%20duplicate%20%60primitive_docs.rs%60%20in%20core%3F/near/252674440" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joshua Nelson <a href="https://zulip-archive.rust-lang.org/stream/219381-t-libs/topic/heads-up.3A.20is.20it.20ok.20to.20duplicate.20.60primitive_docs.2Ers.60.20in.20core.3F.html#252674440">(Sep 09 2021 at 18:38)</a>:</h4>
<p>(note that <code>pub use</code> isn't really relevant here - <code>doc(primitive)</code> doesn't have anything to do with public items)</p>



<hr><p>Last updated: Apr 12 2022 at 20:01 UTC</p>
</html>