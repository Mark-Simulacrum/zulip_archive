<html>
<head><meta charset="utf-8"><title>Inspect Waker/RawWaker&#x27;s data and vtable? · t-libs · Zulip Chat Archive</title></head>
<h2>Stream: <a href="https://zulip-archive.rust-lang.org/stream/219381-t-libs/index.html">t-libs</a></h2>
<h3>Topic: <a href="https://zulip-archive.rust-lang.org/stream/219381-t-libs/topic/Inspect.20Waker.2FRawWaker&#x27;s.20data.20and.20vtable.3F.html">Inspect Waker/RawWaker&#x27;s data and vtable?</a></h3>

<hr>

<base href="https://rust-lang.zulipchat.com">

<head><link href="https://zulip-archive.rust-lang.org/style.css" rel="stylesheet"></head>

<a name="262531763"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/219381-t-libs/topic/Inspect%20Waker/RawWaker%27s%20data%20and%20vtable%3F/near/262531763" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> oxalica <a href="https://zulip-archive.rust-lang.org/stream/219381-t-libs/topic/Inspect.20Waker.2FRawWaker&#x27;s.20data.20and.20vtable.3F.html#262531763">(Nov 24 2021 at 00:06)</a>:</h4>
<p>I noticed that <code>RawWaker</code> and <code>Waker</code> are only construct-able but not destruct-able or observable. We cannot inspect the <code>data</code> and <code>vtable</code> after being constructed into a <code>Waker</code> or <code>RawWaker</code>.<br>
Currently the docs of <code>RawWaker</code> clearly said it consist of two pointers: data and vtable pointers[1]. I'd assume it's a guarantee which cannot be changed. Is there any reason for NOT exposing getters or simply make fields public? If we would add more Waker methods in the future, they only affects <code>RawWakerVTable</code>, not changing <code>RawWaker</code> itself, yes?</p>
<p>Also I found <code>Waker</code> is <code>repr(transparent)</code> to <code>RawWaker</code>. Is it expressing it's safe to transmute between them or their pointers?</p>
<p>If we are able to get data and vtable pointers from a given <code>Waker</code>, it would allow my crate async-ffi[2] providing FFI-compatible futures without an extra Box for <code>Waker</code>. It would also be easier for <code>Waker</code> downcasting by simply comparing vtables.</p>
<p>I already created an issue[3] about if this is possible , but no one replies for now.</p>
<p>[1]: <a href="https://doc.rust-lang.org/stable/std/task/struct.RawWaker.html">https://doc.rust-lang.org/stable/std/task/struct.RawWaker.html</a><br>
[2]: <a href="https://github.com/oxalica/async-ffi">https://github.com/oxalica/async-ffi</a><br>
[3]: <a href="https://github.com/rust-lang/rust/issues/87021">https://github.com/rust-lang/rust/issues/87021</a></p>



<hr><p>Last updated: Apr 12 2022 at 20:01 UTC</p>
</html>