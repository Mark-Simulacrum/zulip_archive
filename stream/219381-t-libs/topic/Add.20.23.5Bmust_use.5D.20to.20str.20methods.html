<html>
<head><meta charset="utf-8"><title>Add #[must_use] to str methods · t-libs · Zulip Chat Archive</title></head>
<h2>Stream: <a href="https://zulip-archive.rust-lang.org/stream/219381-t-libs/index.html">t-libs</a></h2>
<h3>Topic: <a href="https://zulip-archive.rust-lang.org/stream/219381-t-libs/topic/Add.20.23.5Bmust_use.5D.20to.20str.20methods.html">Add #[must_use] to str methods</a></h3>

<hr>

<base href="https://rust-lang.zulipchat.com">

<head><link href="https://zulip-archive.rust-lang.org/style.css" rel="stylesheet"></head>

<a name="256505374"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/219381-t-libs/topic/Add%20%23%5Bmust_use%5D%20to%20str%20methods/near/256505374" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> John Kugelman <a href="https://zulip-archive.rust-lang.org/stream/219381-t-libs/topic/Add.20.23.5Bmust_use.5D.20to.20str.20methods.html#256505374">(Oct 07 2021 at 00:28)</a>:</h4>
<p>I answered a <a href="https://stackoverflow.com/q/69459449/68587">question</a> on Stack Overflow where the poster thought <code>str::to_lowercase</code> worked in place. They wrote:</p>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="n">enter</span><span class="p">.</span><span class="n">trim</span><span class="p">().</span><span class="n">to_lowercase</span><span class="p">();</span><span class="w"> </span><span class="c1">//trims the "enter" variable out of non-letter inputs and turns them into lowercase</span>
</code></pre></div>
<p>What are your thoughts on adding <code>#[must_use]</code> to various <code>str</code> methods that return new values? A quick, not at all exhaustive skim turns up:</p>
<ul>
<li><code>str::into_boxed_bytes</code></li>
<li><code>str::into_string</code></li>
<li><code>str::repeat</code></li>
<li><code>str::to_ascii_uppercase</code></li>
<li><code>str::to_ascii_lowercase</code></li>
<li><code>str::to_uppercase</code></li>
<li><code>str::to_lowercase</code></li>
</ul>
<p>(These are all from <code>alloc::str</code>.)</p>



<a name="256505562"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/219381-t-libs/topic/Add%20%23%5Bmust_use%5D%20to%20str%20methods/near/256505562" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jane Lusby <a href="https://zulip-archive.rust-lang.org/stream/219381-t-libs/topic/Add.20.23.5Bmust_use.5D.20to.20str.20methods.html#256505562">(Oct 07 2021 at 00:31)</a>:</h4>
<p>We talked about this in today's libs-api team meeting and I think the general consensus was we only want to add must_use when it's always a misuse to ignore the value, which I'm guessing applies in all of these cases</p>



<a name="256505603"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/219381-t-libs/topic/Add%20%23%5Bmust_use%5D%20to%20str%20methods/near/256505603" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jane Lusby <a href="https://zulip-archive.rust-lang.org/stream/219381-t-libs/topic/Add.20.23.5Bmust_use.5D.20to.20str.20methods.html#256505603">(Oct 07 2021 at 00:32)</a>:</h4>
<p>Like, if the function has no side effects and can only be used for it's return value then we'd want to mark it must_use</p>



<a name="256505704"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/219381-t-libs/topic/Add%20%23%5Bmust_use%5D%20to%20str%20methods/near/256505704" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> John Kugelman <a href="https://zulip-archive.rust-lang.org/stream/219381-t-libs/topic/Add.20.23.5Bmust_use.5D.20to.20str.20methods.html#256505704">(Oct 07 2021 at 00:32)</a>:</h4>
<p>So worth my submitting an issue or PR? I'm a new contributor so I want to make sure it'd be welcome. :)</p>



<a name="256505725"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/219381-t-libs/topic/Add%20%23%5Bmust_use%5D%20to%20str%20methods/near/256505725" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jane Lusby <a href="https://zulip-archive.rust-lang.org/stream/219381-t-libs/topic/Add.20.23.5Bmust_use.5D.20to.20str.20methods.html#256505725">(Oct 07 2021 at 00:33)</a>:</h4>
<p>Yeah, exactly</p>



<a name="256505733"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/219381-t-libs/topic/Add%20%23%5Bmust_use%5D%20to%20str%20methods/near/256505733" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jane Lusby <a href="https://zulip-archive.rust-lang.org/stream/219381-t-libs/topic/Add.20.23.5Bmust_use.5D.20to.20str.20methods.html#256505733">(Oct 07 2021 at 00:33)</a>:</h4>
<p>Definitely worth a PR</p>



<a name="256505743"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/219381-t-libs/topic/Add%20%23%5Bmust_use%5D%20to%20str%20methods/near/256505743" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jane Lusby <a href="https://zulip-archive.rust-lang.org/stream/219381-t-libs/topic/Add.20.23.5Bmust_use.5D.20to.20str.20methods.html#256505743">(Oct 07 2021 at 00:33)</a>:</h4>
<p>Definitely welcome</p>



<a name="256505761"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/219381-t-libs/topic/Add%20%23%5Bmust_use%5D%20to%20str%20methods/near/256505761" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> John Kugelman <a href="https://zulip-archive.rust-lang.org/stream/219381-t-libs/topic/Add.20.23.5Bmust_use.5D.20to.20str.20methods.html#256505761">(Oct 07 2021 at 00:33)</a>:</h4>
<p>Awesome, thanks!</p>



<a name="256505769"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/219381-t-libs/topic/Add%20%23%5Bmust_use%5D%20to%20str%20methods/near/256505769" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jane Lusby <a href="https://zulip-archive.rust-lang.org/stream/219381-t-libs/topic/Add.20.23.5Bmust_use.5D.20to.20str.20methods.html#256505769">(Oct 07 2021 at 00:33)</a>:</h4>
<p>My pleasure ^^</p>



<a name="256506154"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/219381-t-libs/topic/Add%20%23%5Bmust_use%5D%20to%20str%20methods/near/256506154" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> John Kugelman <a href="https://zulip-archive.rust-lang.org/stream/219381-t-libs/topic/Add.20.23.5Bmust_use.5D.20to.20str.20methods.html#256506154">(Oct 07 2021 at 00:38)</a>:</h4>
<p>What happens if I find lots and lots of methods to annotate? I have the suspicion/worry that I might comb the standard library and find hundreds of methods that could get <code>#[must_use]</code>'d.</p>
<p>Should I (a) forge ahead with a big PR; (b) go module-by-module and submit a lot of small PRs; (c) compile a list and get some feedback first; (d) "stop worrying kid you're not going to find much"</p>



<a name="256506414"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/219381-t-libs/topic/Add%20%23%5Bmust_use%5D%20to%20str%20methods/near/256506414" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Gary Guo <a href="https://zulip-archive.rust-lang.org/stream/219381-t-libs/topic/Add.20.23.5Bmust_use.5D.20to.20str.20methods.html#256506414">(Oct 07 2021 at 00:41)</a>:</h4>
<p>I would say group related onces together. E.g. one for str/slices, one for integers, one for collections, etc</p>



<a name="256508601"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/219381-t-libs/topic/Add%20%23%5Bmust_use%5D%20to%20str%20methods/near/256508601" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jane Lusby <a href="https://zulip-archive.rust-lang.org/stream/219381-t-libs/topic/Add.20.23.5Bmust_use.5D.20to.20str.20methods.html#256508601">(Oct 07 2021 at 01:09)</a>:</h4>
<p>I would recommend starting small <span class="user-mention" data-user-id="449326">@John Kugelman</span></p>



<a name="256508613"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/219381-t-libs/topic/Add%20%23%5Bmust_use%5D%20to%20str%20methods/near/256508613" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jane Lusby <a href="https://zulip-archive.rust-lang.org/stream/219381-t-libs/topic/Add.20.23.5Bmust_use.5D.20to.20str.20methods.html#256508613">(Oct 07 2021 at 01:09)</a>:</h4>
<p>It's much harder to review larger PRS which will slow down the process overall</p>



<a name="256508691"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/219381-t-libs/topic/Add%20%23%5Bmust_use%5D%20to%20str%20methods/near/256508691" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jane Lusby <a href="https://zulip-archive.rust-lang.org/stream/219381-t-libs/topic/Add.20.23.5Bmust_use.5D.20to.20str.20methods.html#256508691">(Oct 07 2021 at 01:10)</a>:</h4>
<p>And not everyone was at the libs team meeting so they may end up having different perspectives and it would be good to iron those out on the initial small PRs rather than on a massive one</p>



<a name="256508713"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/219381-t-libs/topic/Add%20%23%5Bmust_use%5D%20to%20str%20methods/near/256508713" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jane Lusby <a href="https://zulip-archive.rust-lang.org/stream/219381-t-libs/topic/Add.20.23.5Bmust_use.5D.20to.20str.20methods.html#256508713">(Oct 07 2021 at 01:11)</a>:</h4>
<p>Then if it becomes smooth sailing you can scale up</p>



<a name="256508736"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/219381-t-libs/topic/Add%20%23%5Bmust_use%5D%20to%20str%20methods/near/256508736" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> John Kugelman <a href="https://zulip-archive.rust-lang.org/stream/219381-t-libs/topic/Add.20.23.5Bmust_use.5D.20to.20str.20methods.html#256508736">(Oct 07 2021 at 01:11)</a>:</h4>
<p>Makes sense</p>



<a name="256508791"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/219381-t-libs/topic/Add%20%23%5Bmust_use%5D%20to%20str%20methods/near/256508791" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jane Lusby <a href="https://zulip-archive.rust-lang.org/stream/219381-t-libs/topic/Add.20.23.5Bmust_use.5D.20to.20str.20methods.html#256508791">(Oct 07 2021 at 01:12)</a>:</h4>
<p>Imo best start would be to focus on str and work to fully clarify the policy on must_use</p>



<a name="256508806"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/219381-t-libs/topic/Add%20%23%5Bmust_use%5D%20to%20str%20methods/near/256508806" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jane Lusby <a href="https://zulip-archive.rust-lang.org/stream/219381-t-libs/topic/Add.20.23.5Bmust_use.5D.20to.20str.20methods.html#256508806">(Oct 07 2021 at 01:12)</a>:</h4>
<p>Apply the attribute everywhere that makes sense for that type with clear and consistent justifications for each method</p>



<a name="256509106"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/219381-t-libs/topic/Add%20%23%5Bmust_use%5D%20to%20str%20methods/near/256509106" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> John Kugelman <a href="https://zulip-archive.rust-lang.org/stream/219381-t-libs/topic/Add.20.23.5Bmust_use.5D.20to.20str.20methods.html#256509106">(Oct 07 2021 at 01:17)</a>:</h4>
<p>I've been looking through and there's a lot of gray area, I can already see it getting muddy<br>
Like <code>slice::to_vec</code> -- should that have it because there's no reason to ignore the return value? Or not, because a slice "obviously" cannot be mutated into a vector in place, and so why would anybody need the warning?</p>



<a name="256509129"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/219381-t-libs/topic/Add%20%23%5Bmust_use%5D%20to%20str%20methods/near/256509129" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> John Kugelman <a href="https://zulip-archive.rust-lang.org/stream/219381-t-libs/topic/Add.20.23.5Bmust_use.5D.20to.20str.20methods.html#256509129">(Oct 07 2021 at 01:17)</a>:</h4>
<p>(I know that's not a string method, it's just the file I happen to have open...)</p>



<a name="256509210"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/219381-t-libs/topic/Add%20%23%5Bmust_use%5D%20to%20str%20methods/near/256509210" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Lokathor <a href="https://zulip-archive.rust-lang.org/stream/219381-t-libs/topic/Add.20.23.5Bmust_use.5D.20to.20str.20methods.html#256509210">(Oct 07 2021 at 01:18)</a>:</h4>
<p>I would advise it in that situation. If the method takes <code>&amp;self</code> and changes no state, there's no reason to call it except for the result. and we'd like to think the optimizer can eliminate an unused call, but that basically doesn't happen in practice with allocations.</p>



<a name="256509214"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/219381-t-libs/topic/Add%20%23%5Bmust_use%5D%20to%20str%20methods/near/256509214" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> John Kugelman <a href="https://zulip-archive.rust-lang.org/stream/219381-t-libs/topic/Add.20.23.5Bmust_use.5D.20to.20str.20methods.html#256509214">(Oct 07 2021 at 01:19)</a>:</h4>
<p>as opposed to <code>str::to_lowercase</code> which could plausibly mutate the string... but doesn't</p>



<a name="256509250"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/219381-t-libs/topic/Add%20%23%5Bmust_use%5D%20to%20str%20methods/near/256509250" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jane Lusby <a href="https://zulip-archive.rust-lang.org/stream/219381-t-libs/topic/Add.20.23.5Bmust_use.5D.20to.20str.20methods.html#256509250">(Oct 07 2021 at 01:19)</a>:</h4>
<p>I think it would apply in both cases</p>



<a name="256509317"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/219381-t-libs/topic/Add%20%23%5Bmust_use%5D%20to%20str%20methods/near/256509317" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jane Lusby <a href="https://zulip-archive.rust-lang.org/stream/219381-t-libs/topic/Add.20.23.5Bmust_use.5D.20to.20str.20methods.html#256509317">(Oct 07 2021 at 01:20)</a>:</h4>
<p>But yea, i think it comes with an associated stability commitment</p>



<a name="256509351"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/219381-t-libs/topic/Add%20%23%5Bmust_use%5D%20to%20str%20methods/near/256509351" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Lokathor <a href="https://zulip-archive.rust-lang.org/stream/219381-t-libs/topic/Add.20.23.5Bmust_use.5D.20to.20str.20methods.html#256509351">(Oct 07 2021 at 01:21)</a>:</h4>
<p>stability commitment?</p>



<a name="256509352"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/219381-t-libs/topic/Add%20%23%5Bmust_use%5D%20to%20str%20methods/near/256509352" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jane Lusby <a href="https://zulip-archive.rust-lang.org/stream/219381-t-libs/topic/Add.20.23.5Bmust_use.5D.20to.20str.20methods.html#256509352">(Oct 07 2021 at 01:21)</a>:</h4>
<p>(deleted)</p>



<a name="256509359"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/219381-t-libs/topic/Add%20%23%5Bmust_use%5D%20to%20str%20methods/near/256509359" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jane Lusby <a href="https://zulip-archive.rust-lang.org/stream/219381-t-libs/topic/Add.20.23.5Bmust_use.5D.20to.20str.20methods.html#256509359">(Oct 07 2021 at 01:21)</a>:</h4>
<p>God damnit</p>



<a name="256509364"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/219381-t-libs/topic/Add%20%23%5Bmust_use%5D%20to%20str%20methods/near/256509364" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jane Lusby <a href="https://zulip-archive.rust-lang.org/stream/219381-t-libs/topic/Add.20.23.5Bmust_use.5D.20to.20str.20methods.html#256509364">(Oct 07 2021 at 01:21)</a>:</h4>
<p>Didn't mean to delete</p>



<a name="256509369"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/219381-t-libs/topic/Add%20%23%5Bmust_use%5D%20to%20str%20methods/near/256509369" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jane Lusby <a href="https://zulip-archive.rust-lang.org/stream/219381-t-libs/topic/Add.20.23.5Bmust_use.5D.20to.20str.20methods.html#256509369">(Oct 07 2021 at 01:21)</a>:</h4>
<p>Phone UI...</p>



<a name="256509374"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/219381-t-libs/topic/Add%20%23%5Bmust_use%5D%20to%20str%20methods/near/256509374" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jane Lusby <a href="https://zulip-archive.rust-lang.org/stream/219381-t-libs/topic/Add.20.23.5Bmust_use.5D.20to.20str.20methods.html#256509374">(Oct 07 2021 at 01:21)</a>:</h4>
<p>One sec</p>



<a name="256509379"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/219381-t-libs/topic/Add%20%23%5Bmust_use%5D%20to%20str%20methods/near/256509379" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> simulacrum <a href="https://zulip-archive.rust-lang.org/stream/219381-t-libs/topic/Add.20.23.5Bmust_use.5D.20to.20str.20methods.html#256509379">(Oct 07 2021 at 01:21)</a>:</h4>
<blockquote>
<p>Choosing to mark to_lowercase as on the basis that it doesn't modify the string should also come with a commitment that we would never want to add internal mutability to that method</p>
</blockquote>



<a name="256509463"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/219381-t-libs/topic/Add%20%23%5Bmust_use%5D%20to%20str%20methods/near/256509463" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jane Lusby <a href="https://zulip-archive.rust-lang.org/stream/219381-t-libs/topic/Add.20.23.5Bmust_use.5D.20to.20str.20methods.html#256509463">(Oct 07 2021 at 01:22)</a>:</h4>
<p>ty</p>



<a name="256509486"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/219381-t-libs/topic/Add%20%23%5Bmust_use%5D%20to%20str%20methods/near/256509486" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jane Lusby <a href="https://zulip-archive.rust-lang.org/stream/219381-t-libs/topic/Add.20.23.5Bmust_use.5D.20to.20str.20methods.html#256509486">(Oct 07 2021 at 01:23)</a>:</h4>
<p>i meant to edit it to say "choosing to mark to_lowercase as #[must_use] on the basis..."</p>



<a name="256509520"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/219381-t-libs/topic/Add%20%23%5Bmust_use%5D%20to%20str%20methods/near/256509520" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jane Lusby <a href="https://zulip-archive.rust-lang.org/stream/219381-t-libs/topic/Add.20.23.5Bmust_use.5D.20to.20str.20methods.html#256509520">(Oct 07 2021 at 01:23)</a>:</h4>
<p>like, I think generally the type of reference used in the function signature should be a decent guide of intent on whether or not we intend for a method to mutate or not</p>



<a name="256509576"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/219381-t-libs/topic/Add%20%23%5Bmust_use%5D%20to%20str%20methods/near/256509576" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jane Lusby <a href="https://zulip-archive.rust-lang.org/stream/219381-t-libs/topic/Add.20.23.5Bmust_use.5D.20to.20str.20methods.html#256509576">(Oct 07 2021 at 01:24)</a>:</h4>
<p>but yea, each case should be explicitly examined on whether or not we want to reserve the right to introduce side effects in the future</p>



<a name="256509594"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/219381-t-libs/topic/Add%20%23%5Bmust_use%5D%20to%20str%20methods/near/256509594" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jane Lusby <a href="https://zulip-archive.rust-lang.org/stream/219381-t-libs/topic/Add.20.23.5Bmust_use.5D.20to.20str.20methods.html#256509594">(Oct 07 2021 at 01:24)</a>:</h4>
<p>for <code>&amp;self</code> methods I'm assuming the answer will usually be no</p>



<a name="256509618"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/219381-t-libs/topic/Add%20%23%5Bmust_use%5D%20to%20str%20methods/near/256509618" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jane Lusby <a href="https://zulip-archive.rust-lang.org/stream/219381-t-libs/topic/Add.20.23.5Bmust_use.5D.20to.20str.20methods.html#256509618">(Oct 07 2021 at 01:24)</a>:</h4>
<p>but its a fair thing to be concerned about</p>



<a name="256509655"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/219381-t-libs/topic/Add%20%23%5Bmust_use%5D%20to%20str%20methods/near/256509655" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Lokathor <a href="https://zulip-archive.rust-lang.org/stream/219381-t-libs/topic/Add.20.23.5Bmust_use.5D.20to.20str.20methods.html#256509655">(Oct 07 2021 at 01:25)</a>:</h4>
<p><code>&amp;str</code> doesn't allow for interior mutability anyway.</p>



<a name="256509725"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/219381-t-libs/topic/Add%20%23%5Bmust_use%5D%20to%20str%20methods/near/256509725" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> simulacrum <a href="https://zulip-archive.rust-lang.org/stream/219381-t-libs/topic/Add.20.23.5Bmust_use.5D.20to.20str.20methods.html#256509725">(Oct 07 2021 at 01:26)</a>:</h4>
<p>It seems to me that <em>dropping</em> must_use from a method is "fine", in the sense that existing users of it likely aren't hurt by that use -- right?</p>



<a name="256509735"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/219381-t-libs/topic/Add%20%23%5Bmust_use%5D%20to%20str%20methods/near/256509735" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Lokathor <a href="https://zulip-archive.rust-lang.org/stream/219381-t-libs/topic/Add.20.23.5Bmust_use.5D.20to.20str.20methods.html#256509735">(Oct 07 2021 at 01:26)</a>:</h4>
<p>correct</p>



<a name="256509738"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/219381-t-libs/topic/Add%20%23%5Bmust_use%5D%20to%20str%20methods/near/256509738" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jane Lusby <a href="https://zulip-archive.rust-lang.org/stream/219381-t-libs/topic/Add.20.23.5Bmust_use.5D.20to.20str.20methods.html#256509738">(Oct 07 2021 at 01:26)</a>:</h4>
<p><span class="user-mention silent" data-user-id="116122">simulacrum</span> <a href="#narrow/stream/219381-t-libs/topic/Add.20.23.5Bmust_use.5D.20to.20str.20methods/near/256509725">said</a>:</p>
<blockquote>
<p>It seems to me that <em>dropping</em> must_use from a method is "fine", in the sense that existing users of it likely aren't hurt by that use -- right?</p>
</blockquote>
<p>yea I think so</p>



<a name="256509748"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/219381-t-libs/topic/Add%20%23%5Bmust_use%5D%20to%20str%20methods/near/256509748" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> John Kugelman <a href="https://zulip-archive.rust-lang.org/stream/219381-t-libs/topic/Add.20.23.5Bmust_use.5D.20to.20str.20methods.html#256509748">(Oct 07 2021 at 01:26)</a>:</h4>
<p>Okay I'll bite off a small piece somewhere and see what I come up with. If I find a lot of methods to change I'll seek out some discussion &amp; clarification from you all. There could be more clarity on when to use it or not. e.g. does the wider Rust community want to see lots of <code>#[must_use]</code> or do they only want it in the most error-prone situations?</p>



<a name="256509768"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/219381-t-libs/topic/Add%20%23%5Bmust_use%5D%20to%20str%20methods/near/256509768" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> John Kugelman <a href="https://zulip-archive.rust-lang.org/stream/219381-t-libs/topic/Add.20.23.5Bmust_use.5D.20to.20str.20methods.html#256509768">(Oct 07 2021 at 01:27)</a>:</h4>
<p>ok that was my next question. it can be added or dropped without affecting stability, correct?</p>



<a name="256509784"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/219381-t-libs/topic/Add%20%23%5Bmust_use%5D%20to%20str%20methods/near/256509784" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Lokathor <a href="https://zulip-archive.rust-lang.org/stream/219381-t-libs/topic/Add.20.23.5Bmust_use.5D.20to.20str.20methods.html#256509784">(Oct 07 2021 at 01:27)</a>:</h4>
<p>yes it's just a potential warn-by-defeault</p>



<a name="256509795"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/219381-t-libs/topic/Add%20%23%5Bmust_use%5D%20to%20str%20methods/near/256509795" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jane Lusby <a href="https://zulip-archive.rust-lang.org/stream/219381-t-libs/topic/Add.20.23.5Bmust_use.5D.20to.20str.20methods.html#256509795">(Oct 07 2021 at 01:27)</a>:</h4>
<blockquote>
<p>e.g. does the wider Rust community want to see lots of #[must_use] or do they only want it in the most error-prone situations?</p>
</blockquote>
<p>might be a good question for social media / irlo / urlo</p>



<a name="256509815"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/219381-t-libs/topic/Add%20%23%5Bmust_use%5D%20to%20str%20methods/near/256509815" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> John Kugelman <a href="https://zulip-archive.rust-lang.org/stream/219381-t-libs/topic/Add.20.23.5Bmust_use.5D.20to.20str.20methods.html#256509815">(Oct 07 2021 at 01:27)</a>:</h4>
<p><a href="https://std-dev-guide.rust-lang.org/code-considerations/design/must-use.html">https://std-dev-guide.rust-lang.org/code-considerations/design/must-use.html</a> says:</p>
<blockquote>
<p>The #[must_use] attribute only produces warnings, so it can technically be introduced at any time. To avoid accumulating nuisance warnings though ping @rust-lang/libs for input before adding new #[must_use] attributes to existing types and functions.</p>
</blockquote>



<a name="256509895"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/219381-t-libs/topic/Add%20%23%5Bmust_use%5D%20to%20str%20methods/near/256509895" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Lokathor <a href="https://zulip-archive.rust-lang.org/stream/219381-t-libs/topic/Add.20.23.5Bmust_use.5D.20to.20str.20methods.html#256509895">(Oct 07 2021 at 01:28)</a>:</h4>
<p>speaking for myself: i'd prefer must_use in all situations where it's true, even if it doesn't seem error prone.</p>



<a name="256509909"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/219381-t-libs/topic/Add%20%23%5Bmust_use%5D%20to%20str%20methods/near/256509909" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> John Kugelman <a href="https://zulip-archive.rust-lang.org/stream/219381-t-libs/topic/Add.20.23.5Bmust_use.5D.20to.20str.20methods.html#256509909">(Oct 07 2021 at 01:28)</a>:</h4>
<p>that's my personal preference too :)</p>



<a name="256509912"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/219381-t-libs/topic/Add%20%23%5Bmust_use%5D%20to%20str%20methods/near/256509912" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Tim McNamara <a href="https://zulip-archive.rust-lang.org/stream/219381-t-libs/topic/Add.20.23.5Bmust_use.5D.20to.20str.20methods.html#256509912">(Oct 07 2021 at 01:28)</a>:</h4>
<p>I think for methods that return new objects, especially allocated ones, it's useful to be told that they're not used</p>



<a name="256509943"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/219381-t-libs/topic/Add%20%23%5Bmust_use%5D%20to%20str%20methods/near/256509943" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> cuviper <a href="https://zulip-archive.rust-lang.org/stream/219381-t-libs/topic/Add.20.23.5Bmust_use.5D.20to.20str.20methods.html#256509943">(Oct 07 2021 at 01:29)</a>:</h4>
<p>every <code>new</code> and <code>from</code> too?</p>



<a name="256509989"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/219381-t-libs/topic/Add%20%23%5Bmust_use%5D%20to%20str%20methods/near/256509989" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Tim McNamara <a href="https://zulip-archive.rust-lang.org/stream/219381-t-libs/topic/Add.20.23.5Bmust_use.5D.20to.20str.20methods.html#256509989">(Oct 07 2021 at 01:30)</a>:</h4>
<p>Maybe?</p>



<a name="256510023"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/219381-t-libs/topic/Add%20%23%5Bmust_use%5D%20to%20str%20methods/near/256510023" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jane Lusby <a href="https://zulip-archive.rust-lang.org/stream/219381-t-libs/topic/Add.20.23.5Bmust_use.5D.20to.20str.20methods.html#256510023">(Oct 07 2021 at 01:30)</a>:</h4>
<p>just remember that if there are ever cases where someone would legitimately and intentionally want to discard the value must_use will only be an annoyance</p>



<a name="256510025"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/219381-t-libs/topic/Add%20%23%5Bmust_use%5D%20to%20str%20methods/near/256510025" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Tim McNamara <a href="https://zulip-archive.rust-lang.org/stream/219381-t-libs/topic/Add.20.23.5Bmust_use.5D.20to.20str.20methods.html#256510025">(Oct 07 2021 at 01:30)</a>:</h4>
<p>They're not being called to produce side effects</p>



<a name="256510037"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/219381-t-libs/topic/Add%20%23%5Bmust_use%5D%20to%20str%20methods/near/256510037" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jane Lusby <a href="https://zulip-archive.rust-lang.org/stream/219381-t-libs/topic/Add.20.23.5Bmust_use.5D.20to.20str.20methods.html#256510037">(Oct 07 2021 at 01:30)</a>:</h4>
<p>this has been discussed at length with things like thread::spawn and tokio::spawn</p>



<a name="256510062"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/219381-t-libs/topic/Add%20%23%5Bmust_use%5D%20to%20str%20methods/near/256510062" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jane Lusby <a href="https://zulip-archive.rust-lang.org/stream/219381-t-libs/topic/Add.20.23.5Bmust_use.5D.20to.20str.20methods.html#256510062">(Oct 07 2021 at 01:30)</a>:</h4>
<p>actually let me double check the tokio thing</p>



<a name="256510063"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/219381-t-libs/topic/Add%20%23%5Bmust_use%5D%20to%20str%20methods/near/256510063" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Daniel Wagner-Hall <a href="https://zulip-archive.rust-lang.org/stream/219381-t-libs/topic/Add.20.23.5Bmust_use.5D.20to.20str.20methods.html#256510063">(Oct 07 2021 at 01:30)</a>:</h4>
<p>I wonder whether some of this can be automated in the compiler? I guess probably not without a more thorough effect system...</p>



<a name="256510096"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/219381-t-libs/topic/Add%20%23%5Bmust_use%5D%20to%20str%20methods/near/256510096" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jane Lusby <a href="https://zulip-archive.rust-lang.org/stream/219381-t-libs/topic/Add.20.23.5Bmust_use.5D.20to.20str.20methods.html#256510096">(Oct 07 2021 at 01:31)</a>:</h4>
<p>yeee, neither join handle nor spawn are marked as must_use</p>



<a name="256510105"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/219381-t-libs/topic/Add%20%23%5Bmust_use%5D%20to%20str%20methods/near/256510105" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Lokathor <a href="https://zulip-archive.rust-lang.org/stream/219381-t-libs/topic/Add.20.23.5Bmust_use.5D.20to.20str.20methods.html#256510105">(Oct 07 2021 at 01:31)</a>:</h4>
<p>well <code>thread::spawn</code> makes a thread which goes off to execute some code, so unless we can automatically detect side effect free code then we have to assume <code>spawn</code> is doing something</p>



<a name="256510109"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/219381-t-libs/topic/Add%20%23%5Bmust_use%5D%20to%20str%20methods/near/256510109" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jane Lusby <a href="https://zulip-archive.rust-lang.org/stream/219381-t-libs/topic/Add.20.23.5Bmust_use.5D.20to.20str.20methods.html#256510109">(Oct 07 2021 at 01:31)</a>:</h4>
<p><span class="user-mention silent" data-user-id="336670">Daniel Wagner-Hall</span> <a href="#narrow/stream/219381-t-libs/topic/Add.20.23.5Bmust_use.5D.20to.20str.20methods/near/256510063">said</a>:</p>
<blockquote>
<p>I wonder whether some of this can be automated in the compiler? I guess probably not without a more thorough effect system...</p>
</blockquote>
<p>probably starts running into linear types</p>



<a name="256510142"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/219381-t-libs/topic/Add%20%23%5Bmust_use%5D%20to%20str%20methods/near/256510142" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> John Kugelman <a href="https://zulip-archive.rust-lang.org/stream/219381-t-libs/topic/Add.20.23.5Bmust_use.5D.20to.20str.20methods.html#256510142">(Oct 07 2021 at 01:32)</a>:</h4>
<p>agreed jane. my gut feeling is that that's rare because most methods that take immutable args and return a result probably have no side effects</p>



<a name="256510187"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/219381-t-libs/topic/Add%20%23%5Bmust_use%5D%20to%20str%20methods/near/256510187" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> John Kugelman <a href="https://zulip-archive.rust-lang.org/stream/219381-t-libs/topic/Add.20.23.5Bmust_use.5D.20to.20str.20methods.html#256510187">(Oct 07 2021 at 01:32)</a>:</h4>
<p><code>spawn</code> has side effects on the world, but most functions with side effects only mutate their parameters</p>



<a name="256510201"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/219381-t-libs/topic/Add%20%23%5Bmust_use%5D%20to%20str%20methods/near/256510201" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Tim McNamara <a href="https://zulip-archive.rust-lang.org/stream/219381-t-libs/topic/Add.20.23.5Bmust_use.5D.20to.20str.20methods.html#256510201">(Oct 07 2021 at 01:33)</a>:</h4>
<p>Is there already a clippy lint covering these str methods?</p>



<a name="256510235"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/219381-t-libs/topic/Add%20%23%5Bmust_use%5D%20to%20str%20methods/near/256510235" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> John Kugelman <a href="https://zulip-archive.rust-lang.org/stream/219381-t-libs/topic/Add.20.23.5Bmust_use.5D.20to.20str.20methods.html#256510235">(Oct 07 2021 at 01:33)</a>:</h4>
<p>not <code>to_lowercase</code>. that's what led me down this road. clippy didn't catch the stack overflow user's mistake</p>



<a name="256510254"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/219381-t-libs/topic/Add%20%23%5Bmust_use%5D%20to%20str%20methods/near/256510254" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Tim McNamara <a href="https://zulip-archive.rust-lang.org/stream/219381-t-libs/topic/Add.20.23.5Bmust_use.5D.20to.20str.20methods.html#256510254">(Oct 07 2021 at 01:33)</a>:</h4>
<p>Okay</p>



<a name="256510377"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/219381-t-libs/topic/Add%20%23%5Bmust_use%5D%20to%20str%20methods/near/256510377" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Tim McNamara <a href="https://zulip-archive.rust-lang.org/stream/219381-t-libs/topic/Add.20.23.5Bmust_use.5D.20to.20str.20methods.html#256510377">(Oct 07 2021 at 01:35)</a>:</h4>
<p>I guess the question is whether must_use indicates an (unrecoverable?) error or "just" a mistake</p>



<a name="256510381"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/219381-t-libs/topic/Add%20%23%5Bmust_use%5D%20to%20str%20methods/near/256510381" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Gary Guo <a href="https://zulip-archive.rust-lang.org/stream/219381-t-libs/topic/Add.20.23.5Bmust_use.5D.20to.20str.20methods.html#256510381">(Oct 07 2021 at 01:35)</a>:</h4>
<p><span class="user-mention silent" data-user-id="323697">Tim McNamara</span> <a href="#narrow/stream/219381-t-libs/topic/Add.20.23.5Bmust_use.5D.20to.20str.20methods/near/256510025">said</a>:</p>
<blockquote>
<p>They're not being called to produce side effects</p>
</blockquote>
<p>Let's resurrect pure function :)<br>
jokes aside, clippy has a must_use_candidate lint that suggests adding must_use for pure functions.</p>



<a name="256510388"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/219381-t-libs/topic/Add%20%23%5Bmust_use%5D%20to%20str%20methods/near/256510388" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> John Kugelman <a href="https://zulip-archive.rust-lang.org/stream/219381-t-libs/topic/Add.20.23.5Bmust_use.5D.20to.20str.20methods.html#256510388">(Oct 07 2021 at 01:35)</a>:</h4>
<p>boy it'd be neat to run an audit on the standard library for all methods with immutable args, a non-unit return type, and no <code>#[must_use]</code>. I wish I knew how to do that, it would be a great starting point</p>



<a name="256510402"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/219381-t-libs/topic/Add%20%23%5Bmust_use%5D%20to%20str%20methods/near/256510402" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Lokathor <a href="https://zulip-archive.rust-lang.org/stream/219381-t-libs/topic/Add.20.23.5Bmust_use.5D.20to.20str.20methods.html#256510402">(Oct 07 2021 at 01:35)</a>:</h4>
<p><span class="user-mention silent" data-user-id="323697">Tim McNamara</span> <a href="#narrow/stream/219381-t-libs/topic/Add.20.23.5Bmust_use.5D.20to.20str.20methods/near/256510377">said</a>:</p>
<blockquote>
<p>I guess the question is whether must_use indicates an (unrecoverable?) error or "just" a mistake</p>
</blockquote>
<p>it just means "i think you almost surely want to use this value", but that's it.</p>



<a name="256510482"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/219381-t-libs/topic/Add%20%23%5Bmust_use%5D%20to%20str%20methods/near/256510482" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Tim McNamara <a href="https://zulip-archive.rust-lang.org/stream/219381-t-libs/topic/Add.20.23.5Bmust_use.5D.20to.20str.20methods.html#256510482">(Oct 07 2021 at 01:36)</a>:</h4>
<p>That's my understanding also</p>



<a name="256510494"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/219381-t-libs/topic/Add%20%23%5Bmust_use%5D%20to%20str%20methods/near/256510494" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Tim McNamara <a href="https://zulip-archive.rust-lang.org/stream/219381-t-libs/topic/Add.20.23.5Bmust_use.5D.20to.20str.20methods.html#256510494">(Oct 07 2021 at 01:37)</a>:</h4>
<p>(Although I am definitely not an expert)</p>



<a name="256510513"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/219381-t-libs/topic/Add%20%23%5Bmust_use%5D%20to%20str%20methods/near/256510513" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> John Kugelman <a href="https://zulip-archive.rust-lang.org/stream/219381-t-libs/topic/Add.20.23.5Bmust_use.5D.20to.20str.20methods.html#256510513">(Oct 07 2021 at 01:37)</a>:</h4>
<p>must_use_candidate: "Checks for public functions that have no <code>#[must_use]</code> attribute, but return something not already marked must-use, have no mutable arg and mutate no statics."</p>



<a name="256510526"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/219381-t-libs/topic/Add%20%23%5Bmust_use%5D%20to%20str%20methods/near/256510526" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> John Kugelman <a href="https://zulip-archive.rust-lang.org/stream/219381-t-libs/topic/Add.20.23.5Bmust_use.5D.20to.20str.20methods.html#256510526">(Oct 07 2021 at 01:37)</a>:</h4>
<p>wait that's exactly what I want. why isn't that lint triggering on everybody's code all the time?</p>



<a name="256510554"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/219381-t-libs/topic/Add%20%23%5Bmust_use%5D%20to%20str%20methods/near/256510554" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Tim McNamara <a href="https://zulip-archive.rust-lang.org/stream/219381-t-libs/topic/Add.20.23.5Bmust_use.5D.20to.20str.20methods.html#256510554">(Oct 07 2021 at 01:38)</a>:</h4>
<p>Not everyone uses clippy</p>



<a name="256510594"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/219381-t-libs/topic/Add%20%23%5Bmust_use%5D%20to%20str%20methods/near/256510594" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Tim McNamara <a href="https://zulip-archive.rust-lang.org/stream/219381-t-libs/topic/Add.20.23.5Bmust_use.5D.20to.20str.20methods.html#256510594">(Oct 07 2021 at 01:38)</a>:</h4>
<p>Especially those starting out</p>



<a name="256510621"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/219381-t-libs/topic/Add%20%23%5Bmust_use%5D%20to%20str%20methods/near/256510621" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jane Lusby <a href="https://zulip-archive.rust-lang.org/stream/219381-t-libs/topic/Add.20.23.5Bmust_use.5D.20to.20str.20methods.html#256510621">(Oct 07 2021 at 01:38)</a>:</h4>
<p>its because its a pedantic lint</p>



<a name="256510625"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/219381-t-libs/topic/Add%20%23%5Bmust_use%5D%20to%20str%20methods/near/256510625" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jane Lusby <a href="https://zulip-archive.rust-lang.org/stream/219381-t-libs/topic/Add.20.23.5Bmust_use.5D.20to.20str.20methods.html#256510625">(Oct 07 2021 at 01:38)</a>:</h4>
<p>it isn't ever enabled by default</p>



<a name="256510628"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/219381-t-libs/topic/Add%20%23%5Bmust_use%5D%20to%20str%20methods/near/256510628" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jane Lusby <a href="https://zulip-archive.rust-lang.org/stream/219381-t-libs/topic/Add.20.23.5Bmust_use.5D.20to.20str.20methods.html#256510628">(Oct 07 2021 at 01:38)</a>:</h4>
<p>even when you enable "all"</p>



<a name="256510727"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/219381-t-libs/topic/Add%20%23%5Bmust_use%5D%20to%20str%20methods/near/256510727" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> John Kugelman <a href="https://zulip-archive.rust-lang.org/stream/219381-t-libs/topic/Add.20.23.5Bmust_use.5D.20to.20str.20methods.html#256510727">(Oct 07 2021 at 01:40)</a>:</h4>
<p>so... that would be the "other camp". clearly there are people who don't want <code>#[must_use]</code> going off like an air raid siren</p>



<a name="256510782"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/219381-t-libs/topic/Add%20%23%5Bmust_use%5D%20to%20str%20methods/near/256510782" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Gary Guo <a href="https://zulip-archive.rust-lang.org/stream/219381-t-libs/topic/Add.20.23.5Bmust_use.5D.20to.20str.20methods.html#256510782">(Oct 07 2021 at 01:41)</a>:</h4>
<p>It's different. This one suggests you to add <code>#[must_use]</code>, not suggesting that return value must be used.</p>



<a name="256510802"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/219381-t-libs/topic/Add%20%23%5Bmust_use%5D%20to%20str%20methods/near/256510802" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> John Kugelman <a href="https://zulip-archive.rust-lang.org/stream/219381-t-libs/topic/Add.20.23.5Bmust_use.5D.20to.20str.20methods.html#256510802">(Oct 07 2021 at 01:42)</a>:</h4>
<p>cause I'm talking about common things like... <code>len()</code>, <code>is_empty()</code>, <code>contains()</code>, <code>get()</code>, <code>index()</code>. like 75% of all methods in existence</p>



<a name="256510844"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/219381-t-libs/topic/Add%20%23%5Bmust_use%5D%20to%20str%20methods/near/256510844" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Gary Guo <a href="https://zulip-archive.rust-lang.org/stream/219381-t-libs/topic/Add.20.23.5Bmust_use.5D.20to.20str.20methods.html#256510844">(Oct 07 2021 at 01:42)</a>:</h4>
<p>When I write a library (possibly with many stubs) I don't want the compiler to complain that a function hasn't perform any side effects yet.</p>



<a name="256510856"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/219381-t-libs/topic/Add%20%23%5Bmust_use%5D%20to%20str%20methods/near/256510856" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> John Kugelman <a href="https://zulip-archive.rust-lang.org/stream/219381-t-libs/topic/Add.20.23.5Bmust_use.5D.20to.20str.20methods.html#256510856">(Oct 07 2021 at 01:42)</a>:</h4>
<p>should those all get <code>#[must_use]</code>?</p>



<a name="256510873"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/219381-t-libs/topic/Add%20%23%5Bmust_use%5D%20to%20str%20methods/near/256510873" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> John Kugelman <a href="https://zulip-archive.rust-lang.org/stream/219381-t-libs/topic/Add.20.23.5Bmust_use.5D.20to.20str.20methods.html#256510873">(Oct 07 2021 at 01:42)</a>:</h4>
<p>they should, shouldn't they?</p>



<a name="256510906"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/219381-t-libs/topic/Add%20%23%5Bmust_use%5D%20to%20str%20methods/near/256510906" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jane Lusby <a href="https://zulip-archive.rust-lang.org/stream/219381-t-libs/topic/Add.20.23.5Bmust_use.5D.20to.20str.20methods.html#256510906">(Oct 07 2021 at 01:43)</a>:</h4>
<p>I assume so, though i'm not sure how must_use interacts with traits so I can't say for certain on index</p>



<a name="256510940"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/219381-t-libs/topic/Add%20%23%5Bmust_use%5D%20to%20str%20methods/near/256510940" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Gary Guo <a href="https://zulip-archive.rust-lang.org/stream/219381-t-libs/topic/Add.20.23.5Bmust_use.5D.20to.20str.20methods.html#256510940">(Oct 07 2021 at 01:43)</a>:</h4>
<p>They could, but I guess no one has bothered to add them since these fns are hard to misuse.</p>



<a name="256511050"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/219381-t-libs/topic/Add%20%23%5Bmust_use%5D%20to%20str%20methods/near/256511050" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Gary Guo <a href="https://zulip-archive.rust-lang.org/stream/219381-t-libs/topic/Add.20.23.5Bmust_use.5D.20to.20str.20methods.html#256511050">(Oct 07 2021 at 01:45)</a>:</h4>
<p>I wonder if we can have the compiler mark all const fns that have no mutable/interior mutable args as <code>#[must_use]</code> automatically.</p>



<a name="256511104"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/219381-t-libs/topic/Add%20%23%5Bmust_use%5D%20to%20str%20methods/near/256511104" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Gary Guo <a href="https://zulip-archive.rust-lang.org/stream/219381-t-libs/topic/Add.20.23.5Bmust_use.5D.20to.20str.20methods.html#256511104">(Oct 07 2021 at 01:46)</a>:</h4>
<p>Since they can't do sideeffects</p>



<a name="256511212"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/219381-t-libs/topic/Add%20%23%5Bmust_use%5D%20to%20str%20methods/near/256511212" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Gary Guo <a href="https://zulip-archive.rust-lang.org/stream/219381-t-libs/topic/Add.20.23.5Bmust_use.5D.20to.20str.20methods.html#256511212">(Oct 07 2021 at 01:47)</a>:</h4>
<p>You can always add static references to normal functions, but for const fns whether they do side effects or not are guaranteed by signature.</p>



<a name="256511412"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/219381-t-libs/topic/Add%20%23%5Bmust_use%5D%20to%20str%20methods/near/256511412" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Lokathor <a href="https://zulip-archive.rust-lang.org/stream/219381-t-libs/topic/Add.20.23.5Bmust_use.5D.20to.20str.20methods.html#256511412">(Oct 07 2021 at 01:50)</a>:</h4>
<p>I think no one added them because there's just a lot so if you don't do it <em>as you're developing</em> then it's a pain in the shell.</p>



<a name="256511445"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/219381-t-libs/topic/Add%20%23%5Bmust_use%5D%20to%20str%20methods/near/256511445" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Lokathor <a href="https://zulip-archive.rust-lang.org/stream/219381-t-libs/topic/Add.20.23.5Bmust_use.5D.20to.20str.20methods.html#256511445">(Oct 07 2021 at 01:50)</a>:</h4>
<p>Also i suppose it's true that must_use takes a non-zero amount of additional compilation time to track</p>



<a name="256511533"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/219381-t-libs/topic/Add%20%23%5Bmust_use%5D%20to%20str%20methods/near/256511533" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> John Kugelman <a href="https://zulip-archive.rust-lang.org/stream/219381-t-libs/topic/Add.20.23.5Bmust_use.5D.20to.20str.20methods.html#256511533">(Oct 07 2021 at 01:52)</a>:</h4>
<p>I mean I've never used it on any of my code. It doesn't ever come to mind</p>



<a name="256511756"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/219381-t-libs/topic/Add%20%23%5Bmust_use%5D%20to%20str%20methods/near/256511756" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> John Kugelman <a href="https://zulip-archive.rust-lang.org/stream/219381-t-libs/topic/Add.20.23.5Bmust_use.5D.20to.20str.20methods.html#256511756">(Oct 07 2021 at 01:55)</a>:</h4>
<p>It's pretty clear this isn't a onesie-twosie situation. I don't think I'll jump to a PR just yet.<br>
Where's a good place to discuss this further? I could make a GitHub issue... I could post on IRLO/URLO... that scares me</p>



<a name="256513051"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/219381-t-libs/topic/Add%20%23%5Bmust_use%5D%20to%20str%20methods/near/256513051" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jane Lusby <a href="https://zulip-archive.rust-lang.org/stream/219381-t-libs/topic/Add.20.23.5Bmust_use.5D.20to.20str.20methods.html#256513051">(Oct 07 2021 at 02:11)</a>:</h4>
<p>irlo is probably the next best place to zulip</p>



<a name="256513059"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/219381-t-libs/topic/Add%20%23%5Bmust_use%5D%20to%20str%20methods/near/256513059" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jane Lusby <a href="https://zulip-archive.rust-lang.org/stream/219381-t-libs/topic/Add.20.23.5Bmust_use.5D.20to.20str.20methods.html#256513059">(Oct 07 2021 at 02:11)</a>:</h4>
<p>an issue might work but it might also not be noticed by many people</p>



<hr><p>Last updated: Apr 12 2022 at 20:01 UTC</p>
</html>