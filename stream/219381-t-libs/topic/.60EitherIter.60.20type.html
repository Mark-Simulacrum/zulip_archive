<html>
<head><meta charset="utf-8"><title>`EitherIter` type · t-libs · Zulip Chat Archive</title></head>
<h2>Stream: <a href="https://zulip-archive.rust-lang.org/stream/219381-t-libs/index.html">t-libs</a></h2>
<h3>Topic: <a href="https://zulip-archive.rust-lang.org/stream/219381-t-libs/topic/.60EitherIter.60.20type.html">`EitherIter` type</a></h3>

<hr>

<base href="https://rust-lang.zulipchat.com">

<head><link href="https://zulip-archive.rust-lang.org/style.css" rel="stylesheet"></head>

<a name="261301240"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/219381-t-libs/topic/%60EitherIter%60%20type/near/261301240" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jake <a href="https://zulip-archive.rust-lang.org/stream/219381-t-libs/topic/.60EitherIter.60.20type.html#261301240">(Nov 12 2021 at 19:42)</a>:</h4>
<p>I see that the current stance on <code>Either&lt;A, B&gt;</code> is that it's a bad idea; has such a type been considered but specifically as some kind of "iterator adapter"? I was trying to write code like</p>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="n">some_iter</span><span class="p">.</span><span class="n">flat_map</span><span class="p">(</span><span class="o">|</span><span class="n">val</span><span class="o">|</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="n">some_cond</span><span class="p">()</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">        </span><span class="n">one_iter</span><span class="p">(</span><span class="n">val</span><span class="p">)</span><span class="w"></span>
<span class="w">    </span><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">        </span><span class="n">two_iter</span><span class="p">(</span><span class="n">val</span><span class="p">)</span><span class="w"></span>
<span class="w">    </span><span class="p">}</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>
</code></pre></div>
<p>where the iterators yielded by <code>one_iter</code> and <code>two_iter</code> can't be tricked into being the same type, but getting this to compile is actually a bit of a pain. The options here seem to be to fold into a <code>Vec</code>, create <code>Box&lt;dyn Iterator&gt;</code>s, or to create my own type that is basically <code>Either</code> with only an <code>Iterator</code> impl. Has an <code>EitherIter&lt;A: Iterator, B: Iterator&gt;</code> type been considered that is there specifically to address this kind of situation? Or is this a "this belongs in <code>Itertools</code>" type situation?</p>



<a name="261301506"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/219381-t-libs/topic/%60EitherIter%60%20type/near/261301506" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jake <a href="https://zulip-archive.rust-lang.org/stream/219381-t-libs/topic/.60EitherIter.60.20type.html#261301506">(Nov 12 2021 at 19:44)</a>:</h4>
<p>Slight complication here is that I can't find a way to cleanly express this as an iterator adapter, maybe someone has a better idea than me though</p>



<a name="261302139"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/219381-t-libs/topic/%60EitherIter%60%20type/near/261302139" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jane Lusby [she/her] <a href="https://zulip-archive.rust-lang.org/stream/219381-t-libs/topic/.60EitherIter.60.20type.html#261302139">(Nov 12 2021 at 19:49)</a>:</h4>
<p>For iterator additions, I would definitely assume that if it hasn't been prototyped in itertools and that's the first place to start</p>



<a name="261302622"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/219381-t-libs/topic/%60EitherIter%60%20type/near/261302622" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jake <a href="https://zulip-archive.rust-lang.org/stream/219381-t-libs/topic/.60EitherIter.60.20type.html#261302622">(Nov 12 2021 at 19:53)</a>:</h4>
<p>itertools does have an <code>Either</code> type that implements <code>Iterator</code> with these semantics, but it doesn't require its contents to be iterators and has a bunch of other implementations that make it a more or less general purpose Either type. This seems to be the version of things that rust has decided <code>std</code> should not have</p>



<a name="261303182"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/219381-t-libs/topic/%60EitherIter%60%20type/near/261303182" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> The 8472 <a href="https://zulip-archive.rust-lang.org/stream/219381-t-libs/topic/.60EitherIter.60.20type.html#261303182">(Nov 12 2021 at 19:57)</a>:</h4>
<p>Do you mean EitherIter&lt;A: Iterator, B: Iterator&gt; where A::Item == B::Item ?</p>



<a name="261303221"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/219381-t-libs/topic/%60EitherIter%60%20type/near/261303221" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jake <a href="https://zulip-archive.rust-lang.org/stream/219381-t-libs/topic/.60EitherIter.60.20type.html#261303221">(Nov 12 2021 at 19:57)</a>:</h4>
<p>Yeah, I'll edit to clarify</p>



<a name="261303427"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/219381-t-libs/topic/%60EitherIter%60%20type/near/261303427" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> The 8472 <a href="https://zulip-archive.rust-lang.org/stream/219381-t-libs/topic/.60EitherIter.60.20type.html#261303427">(Nov 12 2021 at 19:59)</a>:</h4>
<p>I mean you can kind fudge that by cobbling them together serially... <code>some_option.iter().chain(other_option)</code> and just have one of the options be <code>None</code>. That's how you can work around <code>flat_map</code>.</p>



<a name="261303705"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/219381-t-libs/topic/%60EitherIter%60%20type/near/261303705" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jake <a href="https://zulip-archive.rust-lang.org/stream/219381-t-libs/topic/.60EitherIter.60.20type.html#261303705">(Nov 12 2021 at 20:01)</a>:</h4>
<p>Yeah, I had asked on the community discord about this at first and someone suggested that, but between the readability and ergonomics of that I'd rather just write a one-time <code>Either</code> equivalent type</p>



<a name="261304137"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/219381-t-libs/topic/%60EitherIter%60%20type/near/261304137" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> The 8472 <a href="https://zulip-archive.rust-lang.org/stream/219381-t-libs/topic/.60EitherIter.60.20type.html#261304137">(Nov 12 2021 at 20:04)</a>:</h4>
<p>Yeah, but that's basically just one particular instance of the many ways where mismatched concrete types can arise. if you have more complex control flow in your closure then you might need a "any one of these 3 types, or sometimes a chain, occasionally None"</p>



<a name="261304620"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/219381-t-libs/topic/%60EitherIter%60%20type/near/261304620" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jake <a href="https://zulip-archive.rust-lang.org/stream/219381-t-libs/topic/.60EitherIter.60.20type.html#261304620">(Nov 12 2021 at 20:09)</a>:</h4>
<p>Yeah, I was thinking about that as well. Between that and the issue around a nice signature for this, I might try writing a macro that covers these cases with good ergonomics</p>



<a name="261305258"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/219381-t-libs/topic/%60EitherIter%60%20type/near/261305258" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> The 8472 <a href="https://zulip-archive.rust-lang.org/stream/219381-t-libs/topic/.60EitherIter.60.20type.html#261305258">(Nov 12 2021 at 20:15)</a>:</h4>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="n">iter</span><span class="p">.</span><span class="n">flat_map</span><span class="p">(</span><span class="o">|</span><span class="n">val</span><span class="o">|</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">   </span><span class="kd">let</span><span class="w"> </span><span class="n">cond</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">some_condition</span><span class="p">();</span><span class="w"></span>
<span class="w">   </span><span class="k">return</span><span class="w"> </span><span class="n">iter</span>::<span class="n">from_fn</span><span class="p">(</span><span class="k">move</span><span class="w"> </span><span class="o">||</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">       </span><span class="k">return</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="n">cond</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">           </span><span class="n">do_something_with_val</span><span class="p">(</span><span class="n">val</span><span class="p">)</span><span class="w"></span>
<span class="w">       </span><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">           </span><span class="n">do_other_thing</span><span class="p">(</span><span class="n">val</span><span class="p">)</span><span class="w"></span>
<span class="w">       </span><span class="p">}</span><span class="w"></span>
<span class="w">   </span><span class="p">})</span><span class="w"></span>
<span class="p">})</span><span class="w"></span>
</code></pre></div>
<p>Allows more complex control flow.</p>



<a name="261305428"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/219381-t-libs/topic/%60EitherIter%60%20type/near/261305428" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> The 8472 <a href="https://zulip-archive.rust-lang.org/stream/219381-t-libs/topic/.60EitherIter.60.20type.html#261305428">(Nov 12 2021 at 20:17)</a>:</h4>
<p>well, doesn't help when you have to give up ownership</p>



<a name="261305604"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/219381-t-libs/topic/%60EitherIter%60%20type/near/261305604" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jake <a href="https://zulip-archive.rust-lang.org/stream/219381-t-libs/topic/.60EitherIter.60.20type.html#261305604">(Nov 12 2021 at 20:18)</a>:</h4>
<p>Hm, yeah, this seems like it covers some cases but not others (and unfortunately not my original one)</p>



<a name="261305783"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/219381-t-libs/topic/%60EitherIter%60%20type/near/261305783" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jake <a href="https://zulip-archive.rust-lang.org/stream/219381-t-libs/topic/.60EitherIter.60.20type.html#261305783">(Nov 12 2021 at 20:20)</a>:</h4>
<p>Actually, I don't see how this really addresses the issue. Can you try and provide an example of a use?</p>



<a name="261308231"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/219381-t-libs/topic/%60EitherIter%60%20type/near/261308231" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> The 8472 <a href="https://zulip-archive.rust-lang.org/stream/219381-t-libs/topic/.60EitherIter.60.20type.html#261308231">(Nov 12 2021 at 20:44)</a>:</h4>
<p>I don't have a concrete use-case, most of the time I get by by stuffing things into <code>[Option::IntoIter&lt;_&gt;; N]</code> or chains and flatten those.</p>



<a name="261308584"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/219381-t-libs/topic/%60EitherIter%60%20type/near/261308584" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> cuviper <a href="https://zulip-archive.rust-lang.org/stream/219381-t-libs/topic/.60EitherIter.60.20type.html#261308584">(Nov 12 2021 at 20:48)</a>:</h4>
<p><span class="user-mention silent" data-user-id="310518">Jake</span> <a href="#narrow/stream/219381-t-libs/topic/.60EitherIter.60.20type/near/261302622">said</a>:</p>
<blockquote>
<p>itertools does have an <code>Either</code> type that implements <code>Iterator</code> with these semantics, </p>
</blockquote>
<p>FWIW, that version is just a re-export from the <code>either</code> crate.</p>



<a name="261308761"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/219381-t-libs/topic/%60EitherIter%60%20type/near/261308761" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jake <a href="https://zulip-archive.rust-lang.org/stream/219381-t-libs/topic/.60EitherIter.60.20type.html#261308761">(Nov 12 2021 at 20:49)</a>:</h4>
<p>Damn rustdoc being smart enough to make me not notice <span aria-label="rolling on the floor laughing" class="emoji emoji-1f923" role="img" title="rolling on the floor laughing">:rolling_on_the_floor_laughing:</span></p>



<a name="261309068"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/219381-t-libs/topic/%60EitherIter%60%20type/near/261309068" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> cuviper <a href="https://zulip-archive.rust-lang.org/stream/219381-t-libs/topic/.60EitherIter.60.20type.html#261309068">(Nov 12 2021 at 20:52)</a>:</h4>
<p>they also use it for <code>Itertools::partition_map</code>, which is a neat adapter</p>



<a name="261319113"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/219381-t-libs/topic/%60EitherIter%60%20type/near/261319113" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> scottmcm <a href="https://zulip-archive.rust-lang.org/stream/219381-t-libs/topic/.60EitherIter.60.20type.html#261319113">(Nov 12 2021 at 22:22)</a>:</h4>
<p><code>partition_map</code> is great!</p>
<p>Last I heard the big uncertainty with <code>Either</code> is that it can't be both <code>IntoIterator</code> when both types are <code>IntoIterator</code> <em>and</em> <code>Iterator</code> when both types are <code>Iterator</code>, because of the blanket.  Which made people sad.</p>



<a name="261324538"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/219381-t-libs/topic/%60EitherIter%60%20type/near/261324538" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jake <a href="https://zulip-archive.rust-lang.org/stream/219381-t-libs/topic/.60EitherIter.60.20type.html#261324538">(Nov 12 2021 at 23:27)</a>:</h4>
<p><span class="user-mention silent" data-user-id="125270">scottmcm</span> <a href="#narrow/stream/219381-t-libs/topic/.60EitherIter.60.20type/near/261319113">said</a>:</p>
<blockquote>
<p><code>partition_map</code> is great!</p>
<p>Last I heard the big uncertainty with <code>Either</code> is that it can't be both <code>IntoIterator</code> when both types are <code>IntoIterator</code> <em>and</em> <code>Iterator</code> when both types are <code>Iterator</code>, because of the blanket.  Which made people sad.</p>
</blockquote>
<p>Interesting, although I don't think this would be an issue with the proposed <code>EitherIter</code> as it is less general, so we can just have both types require <code>IntoIterator</code> and have <code>EitherIter: Iterator</code> (doing the <code>.into_iterator()</code> call when the type is constructed, however that ends up happening)</p>



<a name="261330308"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/219381-t-libs/topic/%60EitherIter%60%20type/near/261330308" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> cuviper <a href="https://zulip-archive.rust-lang.org/stream/219381-t-libs/topic/.60EitherIter.60.20type.html#261330308">(Nov 13 2021 at 01:05)</a>:</h4>
<p>Yes, if you have a separate <code>Iterator</code> type, it should be fine. In the <code>either</code> crate, it already did implement <code>Iterator</code> before I came along wanting <code>IntoIterator</code>: <a href="https://github.com/bluss/either/pull/12">https://github.com/bluss/either/pull/12</a></p>



<a name="261330786"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/219381-t-libs/topic/%60EitherIter%60%20type/near/261330786" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jake <a href="https://zulip-archive.rust-lang.org/stream/219381-t-libs/topic/.60EitherIter.60.20type.html#261330786">(Nov 13 2021 at 01:14)</a>:</h4>
<p>Ehhh, sorry, I misspoke earlier. What I meant was that I think there's no need for an <code>IntoIterator</code> type; we can just have an <code>IntoIterator</code> version of the constructor (again, not sure how this would actually be constructed yet) and that seems like it would be enough</p>



<hr><p>Last updated: Apr 12 2022 at 20:01 UTC</p>
</html>