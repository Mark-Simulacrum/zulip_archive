<html>
<head><meta charset="utf-8"><title>A &quot;width&quot; method on Range? · t-libs · Zulip Chat Archive</title></head>
<h2>Stream: <a href="https://zulip-archive.rust-lang.org/stream/219381-t-libs/index.html">t-libs</a></h2>
<h3>Topic: <a href="https://zulip-archive.rust-lang.org/stream/219381-t-libs/topic/A.20.22width.22.20method.20on.20Range.3F.html">A &quot;width&quot; method on Range?</a></h3>

<hr>

<base href="https://rust-lang.zulipchat.com">

<head><link href="https://zulip-archive.rust-lang.org/style.css" rel="stylesheet"></head>

<a name="276834515"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/219381-t-libs/topic/A%20%22width%22%20method%20on%20Range%3F/near/276834515" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> scottmcm <a href="https://zulip-archive.rust-lang.org/stream/219381-t-libs/topic/A.20.22width.22.20method.20on.20Range.3F.html#276834515">(Mar 28 2022 at 07:08)</a>:</h4>
<p>I tried to call <code>.len()</code> on a <code>Range&lt;u64&gt;</code> today, which of course didn't work, since it's not <code>ExactSizeIterator</code>.</p>
<p>I didn't really need a <code>usize</code>, though -- a <code>u64</code> would have been fine -- so it made me thing about adding a method for it. Specifically, it'd be <code>&amp;Range&lt;uNN&gt; -&gt; uNN</code> and <code>&amp;Range&lt;iNN&gt; -&gt; uNN</code>.</p>
<p>It certainly shouldn't be named <code>.len()</code>, since that would break <code>Range&lt;usize&gt;::len</code>, so I was thinking <code>.width()</code>.  (Other things that came up while searching were <code>.diameter()</code> and <code>.distance()</code>.)</p>
<p>Does that sound reasonable?  Or too niche?</p>



<a name="276897058"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/219381-t-libs/topic/A%20%22width%22%20method%20on%20Range%3F/near/276897058" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> cuviper <a href="https://zulip-archive.rust-lang.org/stream/219381-t-libs/topic/A.20.22width.22.20method.20on.20Range.3F.html#276897058">(Mar 28 2022 at 16:18)</a>:</h4>
<p>Rayon has something like this internally, but we just called it <code>len</code> because it's only for 64/128<br>
<a href="https://github.com/rayon-rs/rayon/blob/f57bfa5126bc07ab752e9cbda0194f3b35876ce9/src/range.rs#L221-L230">https://github.com/rayon-rs/rayon/blob/f57bfa5126bc07ab752e9cbda0194f3b35876ce9/src/range.rs#L221-L230</a></p>



<a name="276897128"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/219381-t-libs/topic/A%20%22width%22%20method%20on%20Range%3F/near/276897128" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> cuviper <a href="https://zulip-archive.rust-lang.org/stream/219381-t-libs/topic/A.20.22width.22.20method.20on.20Range.3F.html#276897128">(Mar 28 2022 at 16:18)</a>:</h4>
<p>would you also do <code>RangeInclusive</code>?</p>



<a name="276899669"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/219381-t-libs/topic/A%20%22width%22%20method%20on%20Range%3F/near/276899669" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Lokathor <a href="https://zulip-archive.rust-lang.org/stream/219381-t-libs/topic/A.20.22width.22.20method.20on.20Range.3F.html#276899669">(Mar 28 2022 at 16:36)</a>:</h4>
<p>Well you "can't" do that in the general case, since the max range on RangeInclusive exceeds the type's max value (which is the point)</p>



<a name="276900155"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/219381-t-libs/topic/A%20%22width%22%20method%20on%20Range%3F/near/276900155" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> cuviper <a href="https://zulip-archive.rust-lang.org/stream/219381-t-libs/topic/A.20.22width.22.20method.20on.20Range.3F.html#276900155">(Mar 28 2022 at 16:39)</a>:</h4>
<p>yes, that's the implied point of my question :)</p>



<a name="276901974"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/219381-t-libs/topic/A%20%22width%22%20method%20on%20Range%3F/near/276901974" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> The 8472 <a href="https://zulip-archive.rust-lang.org/stream/219381-t-libs/topic/A.20.22width.22.20method.20on.20Range.3F.html#276901974">(Mar 28 2022 at 16:52)</a>:</h4>
<p>size + overflow bool</p>



<a name="276910227"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/219381-t-libs/topic/A%20%22width%22%20method%20on%20Range%3F/near/276910227" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> scottmcm <a href="https://zulip-archive.rust-lang.org/stream/219381-t-libs/topic/A.20.22width.22.20method.20on.20Range.3F.html#276910227">(Mar 28 2022 at 18:00)</a>:</h4>
<p>I was tempted to do <code>&amp;RangeInclusive&lt;NonZeroU64&gt; -&gt; u64</code>, but that's a whole other question, so wouldn't be part of V1</p>



<a name="276910297"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/219381-t-libs/topic/A%20%22width%22%20method%20on%20Range%3F/near/276910297" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> scottmcm <a href="https://zulip-archive.rust-lang.org/stream/219381-t-libs/topic/A.20.22width.22.20method.20on.20Range.3F.html#276910297">(Mar 28 2022 at 18:01)</a>:</h4>
<p><code>Range::len</code> as a whole is kinda weird, since <code>Range&lt;u32&gt;::len</code> is actually a bug.</p>



<a name="277178660"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/219381-t-libs/topic/A%20%22width%22%20method%20on%20Range%3F/near/277178660" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Mara <a href="https://zulip-archive.rust-lang.org/stream/219381-t-libs/topic/A.20.22width.22.20method.20on.20Range.3F.html#277178660">(Mar 30 2022 at 17:21)</a>:</h4>
<p>would it be implemented for everything that implements Sub? if so, then what about 10..5? when used as an iterator that range is empty, but when doing end-start you get -5, not 0.</p>



<a name="277178911"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/219381-t-libs/topic/A%20%22width%22%20method%20on%20Range%3F/near/277178911" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Mara <a href="https://zulip-archive.rust-lang.org/stream/219381-t-libs/topic/A.20.22width.22.20method.20on.20Range.3F.html#277178911">(Mar 30 2022 at 17:23)</a>:</h4>
<p>i don't think it always makes sense to use the same type. e.g. <code>'a'..'f'</code> has a 'width' of 5, which shouldn't be represented as <code>char</code></p>



<a name="277180977"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/219381-t-libs/topic/A%20%22width%22%20method%20on%20Range%3F/near/277180977" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> scottmcm <a href="https://zulip-archive.rust-lang.org/stream/219381-t-libs/topic/A.20.22width.22.20method.20on.20Range.3F.html#277180977">(Mar 30 2022 at 17:39)</a>:</h4>
<p>No, <code>Sub</code> is definitely wrong.  For unsigned types it's just <code>saturating_sub</code>, though.  (For signed it's a bit harder.)</p>
<p>And yes, I was thinking different types, like <code>unsigned_abs</code> does</p>
<blockquote>
<p>Specifically, it'd be <code>&amp;Range&lt;uNN&gt; -&gt; uNN</code> and <code>&amp;Range&lt;iNN&gt; -&gt; uNN</code>.</p>
</blockquote>
<p>I suppose that trait question gets to the unknown-to-me question of "what should <code>Step</code> be?".  Because we could do it with macros or by updating <code>Step</code>, and I don't know which would be better for this.</p>



<a name="277429630"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/219381-t-libs/topic/A%20%22width%22%20method%20on%20Range%3F/near/277429630" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Christopher Durham <a href="https://zulip-archive.rust-lang.org/stream/219381-t-libs/topic/A.20.22width.22.20method.20on.20Range.3F.html#277429630">(Apr 01 2022 at 14:51)</a>:</h4>
<p><code>Step</code> has <a href="https://doc.rust-lang.org/nightly/std/iter/trait.Step.html#tymethod.steps_between"><code>Step::steps_between</code></a></p>



<a name="277429852"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/219381-t-libs/topic/A%20%22width%22%20method%20on%20Range%3F/near/277429852" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Christopher Durham <a href="https://zulip-archive.rust-lang.org/stream/219381-t-libs/topic/A.20.22width.22.20method.20on.20Range.3F.html#277429852">(Apr 01 2022 at 14:52)</a>:</h4>
<p>I would think <code>Range::width</code> would be defined in terms of that</p>



<a name="277430373"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/219381-t-libs/topic/A%20%22width%22%20method%20on%20Range%3F/near/277430373" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> cuviper <a href="https://zulip-archive.rust-lang.org/stream/219381-t-libs/topic/A.20.22width.22.20method.20on.20Range.3F.html#277430373">(Apr 01 2022 at 14:55)</a>:</h4>
<p>But that's <code>usize</code>, no better than <code>len()</code></p>



<a name="277430531"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/219381-t-libs/topic/A%20%22width%22%20method%20on%20Range%3F/near/277430531" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> cuviper <a href="https://zulip-archive.rust-lang.org/stream/219381-t-libs/topic/A.20.22width.22.20method.20on.20Range.3F.html#277430531">(Apr 01 2022 at 14:56)</a>:</h4>
<p>Is the suggestion to give <code>Step</code> an associated unsigned type?</p>



<a name="277431795"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/219381-t-libs/topic/A%20%22width%22%20method%20on%20Range%3F/near/277431795" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Christopher Durham <a href="https://zulip-archive.rust-lang.org/stream/219381-t-libs/topic/A.20.22width.22.20method.20on.20Range.3F.html#277431795">(Apr 01 2022 at 15:05)</a>:</h4>
<p>Hm right</p>



<a name="277431966"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/219381-t-libs/topic/A%20%22width%22%20method%20on%20Range%3F/near/277431966" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Christopher Durham <a href="https://zulip-archive.rust-lang.org/stream/219381-t-libs/topic/A.20.22width.22.20method.20on.20Range.3F.html#277431966">(Apr 01 2022 at 15:06)</a>:</h4>
<p>Though using <code>stepe_between</code> works when length happens to fit in <code>usize</code>, whereas <code>ExactSizeIterator</code> only works if all lengths fit in <code>usize</code></p>



<a name="277432183"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/219381-t-libs/topic/A%20%22width%22%20method%20on%20Range%3F/near/277432183" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Christopher Durham <a href="https://zulip-archive.rust-lang.org/stream/219381-t-libs/topic/A.20.22width.22.20method.20on.20Range.3F.html#277432183">(Apr 01 2022 at 15:07)</a>:</h4>
<p>One could imagine a (bad) <code>Range::width</code> as <code>fn width(a..b: Self) -&gt; usize { steps_between(&amp;a, &amp;b).unwrap() }</code></p>



<a name="277461512"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/219381-t-libs/topic/A%20%22width%22%20method%20on%20Range%3F/near/277461512" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> scottmcm <a href="https://zulip-archive.rust-lang.org/stream/219381-t-libs/topic/A.20.22width.22.20method.20on.20Range.3F.html#277461512">(Apr 01 2022 at 18:34)</a>:</h4>
<p>Yeah, the existing <code>Step</code> could give like a <code>saturating_len</code> or something.</p>
<p><span class="user-mention silent" data-user-id="138448">cuviper</span> <a href="#narrow/stream/219381-t-libs/topic/A.20.22width.22.20method.20on.20Range.3F/near/277430531">said</a>:</p>
<blockquote>
<p>Is the suggestion to give <code>Step</code> an associated unsigned type?</p>
</blockquote>
<p>That could certainly work.  like a <code>type WidthType;</code> or (<a href="https://en.cppreference.com/w/cpp/iterator/distance">for the C++ people</a>) <code>type DistanceType;</code>/<code>type DifferenceType;</code>.</p>
<p>But I don't know if it's worth it, given everything else in <code>Step</code> now speaks <code>usize</code>.  (As we hit the "interval vs iterator" interpretation problem again.)</p>



<a name="277462155"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/219381-t-libs/topic/A%20%22width%22%20method%20on%20Range%3F/near/277462155" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> The 8472 <a href="https://zulip-archive.rust-lang.org/stream/219381-t-libs/topic/A.20.22width.22.20method.20on.20Range.3F.html#277462155">(Apr 01 2022 at 18:39)</a>:</h4>
<p>You could always implement it manually by forwarding by usize::MAX in a loop and accumulating into a larger type</p>



<hr><p>Last updated: Apr 12 2022 at 20:01 UTC</p>
</html>