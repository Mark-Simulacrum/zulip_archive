<html>
<head><meta charset="utf-8"><title>Upstreaming Nintendo Switch Support · t-libs · Zulip Chat Archive</title></head>
<h2>Stream: <a href="https://zulip-archive.rust-lang.org/stream/219381-t-libs/index.html">t-libs</a></h2>
<h3>Topic: <a href="https://zulip-archive.rust-lang.org/stream/219381-t-libs/topic/Upstreaming.20Nintendo.20Switch.20Support.html">Upstreaming Nintendo Switch Support</a></h3>

<hr>

<base href="https://rust-lang.zulipchat.com">

<head><link href="https://zulip-archive.rust-lang.org/style.css" rel="stylesheet"></head>

<a name="253445503"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/219381-t-libs/topic/Upstreaming%20Nintendo%20Switch%20Support/near/253445503" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> jam1garner <a href="https://zulip-archive.rust-lang.org/stream/219381-t-libs/topic/Upstreaming.20Nintendo.20Switch.20Support.html#253445503">(Sep 15 2021 at 16:34)</a>:</h4>
<p>There's been some interest in the Nintendo Switch homebrew community to try and get libstd support upstream. There's a pretty vibrant community but attempting to maintain out-of-tree libstd implementations has made things quite hard and a bit brittle due to maintenance burden.</p>
<p>So me, <span class="user-mention" data-user-id="239001">@leo60228</span>, and possibly a few others would like to work on getting support for a homebrew-targeted toolchain upstreamed, while also leaving open the possibility of in the future there being a non-homebrew toolchain (e.g. one that links against the 'nnsdk' (Nintendo's sdk)) for those who want to just use Rust for officially supported Switch games, however that wouldn't be a part of what we want to upstream</p>



<a name="253445637"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/219381-t-libs/topic/Upstreaming%20Nintendo%20Switch%20Support/near/253445637" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> jam1garner <a href="https://zulip-archive.rust-lang.org/stream/219381-t-libs/topic/Upstreaming.20Nintendo.20Switch.20Support.html#253445637">(Sep 15 2021 at 16:34)</a>:</h4>
<p>There's been a bit of an attempt by leo in the past to upstream support all at once, however libstd moves quite fast and reviewer bandwidth for such an unpopular platform is small, so it fizzled out</p>



<a name="253445900"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/219381-t-libs/topic/Upstreaming%20Nintendo%20Switch%20Support/near/253445900" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> jam1garner <a href="https://zulip-archive.rust-lang.org/stream/219381-t-libs/topic/Upstreaming.20Nintendo.20Switch.20Support.html#253445900">(Sep 15 2021 at 16:36)</a>:</h4>
<p>One possibility that I think would prevent this happening again would be to start by upstreaming a very basic support first--thing something like wasm where there's no I/O or syncronization primatives aside from stubs</p>



<a name="253446108"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/219381-t-libs/topic/Upstreaming%20Nintendo%20Switch%20Support/near/253446108" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> leo60228 <a href="https://zulip-archive.rust-lang.org/stream/219381-t-libs/topic/Upstreaming.20Nintendo.20Switch.20Support.html#253446108">(Sep 15 2021 at 16:37)</a>:</h4>
<p>note that previous attempts were built on top of an existing libc, however i'd expect new attempts to be pure-rust</p>



<a name="253446159"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/219381-t-libs/topic/Upstreaming%20Nintendo%20Switch%20Support/near/253446159" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> jam1garner <a href="https://zulip-archive.rust-lang.org/stream/219381-t-libs/topic/Upstreaming.20Nintendo.20Switch.20Support.html#253446159">(Sep 15 2021 at 16:37)</a>:</h4>
<p>However I just wanted to make sure that (a) such a target would be fine to upstream (similar homebrew toolchains for C/C++ have existed for a long time across many consoles with no legal issues, so I mainly mean in a technical sense) and (b) would a stubbed target be an acceptable approach to start?</p>



<a name="253446169"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/219381-t-libs/topic/Upstreaming%20Nintendo%20Switch%20Support/near/253446169" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> leo60228 <a href="https://zulip-archive.rust-lang.org/stream/219381-t-libs/topic/Upstreaming.20Nintendo.20Switch.20Support.html#253446169">(Sep 15 2021 at 16:37)</a>:</h4>
<p>(i recently learned that the developers of that libc are explicitly against supporting compilers that are not gcc/g++)</p>



<a name="253446227"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/219381-t-libs/topic/Upstreaming%20Nintendo%20Switch%20Support/near/253446227" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> bjorn3 <a href="https://zulip-archive.rust-lang.org/stream/219381-t-libs/topic/Upstreaming.20Nintendo.20Switch.20Support.html#253446227">(Sep 15 2021 at 16:38)</a>:</h4>
<p>Does it satisfy the following requirements?</p>
<p><a href="https://rust-lang.github.io/rfcs/2803-target-tier-policy.html#tier-3-target-policy">https://rust-lang.github.io/rfcs/2803-target-tier-policy.html#tier-3-target-policy</a></p>
<ul>
<li>Tier 3 targets may have unusual requirements to build or use, but must not create legal issues or impose onerous legal terms for the Rust project or for Rust developers or users. <br>
    * The target must not introduce license incompatibilities.<br>
    * Targets should not require proprietary (non-FOSS) components to link a functional binary or library.<br>
    * "onerous" here is an intentionally subjective term. At a minimum, "onerous" legal/licensing terms include but are not limited to: non-disclosure requirements, non-compete requirements, contributor license agreements (CLAs) or equivalent, "non-commercial"/"research-only"/etc terms, requirements conditional on the employer or employment of any particular Rust developers, revocable terms, any requirements that create liability for the Rust project or its developers or users, or any requirements that adversely affect the livelihood or prospects of the Rust project or its developers or users.</li>
</ul>



<a name="253446434"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/219381-t-libs/topic/Upstreaming%20Nintendo%20Switch%20Support/near/253446434" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> bjorn3 <a href="https://zulip-archive.rust-lang.org/stream/219381-t-libs/topic/Upstreaming.20Nintendo.20Switch.20Support.html#253446434">(Sep 15 2021 at 16:39)</a>:</h4>
<p>This is the subset of all requirements for adding a tier 3 target that I am least certain about is met.</p>



<a name="253446455"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/219381-t-libs/topic/Upstreaming%20Nintendo%20Switch%20Support/near/253446455" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> leo60228 <a href="https://zulip-archive.rust-lang.org/stream/219381-t-libs/topic/Upstreaming.20Nintendo.20Switch.20Support.html#253446455">(Sep 15 2021 at 16:39)</a>:</h4>
<p>it wouldn't <em>impose</em> any legal terms</p>



<a name="253446644"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/219381-t-libs/topic/Upstreaming%20Nintendo%20Switch%20Support/near/253446644" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> bjorn3 <a href="https://zulip-archive.rust-lang.org/stream/219381-t-libs/topic/Upstreaming.20Nintendo.20Switch.20Support.html#253446644">(Sep 15 2021 at 16:40)</a>:</h4>
<p>Is there not for example proprietary blob you need to link against?</p>



<a name="253446646"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/219381-t-libs/topic/Upstreaming%20Nintendo%20Switch%20Support/near/253446646" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> leo60228 <a href="https://zulip-archive.rust-lang.org/stream/219381-t-libs/topic/Upstreaming.20Nintendo.20Switch.20Support.html#253446646">(Sep 15 2021 at 16:40)</a>:</h4>
<p>i see no reason to believe that the target would create legal issues, though it's definitely less clear-cut than linux</p>



<a name="253446706"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/219381-t-libs/topic/Upstreaming%20Nintendo%20Switch%20Support/near/253446706" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> jam1garner <a href="https://zulip-archive.rust-lang.org/stream/219381-t-libs/topic/Upstreaming.20Nintendo.20Switch.20Support.html#253446706">(Sep 15 2021 at 16:40)</a>:</h4>
<p>no towards the proprietary blobs</p>



<a name="253446805"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/219381-t-libs/topic/Upstreaming%20Nintendo%20Switch%20Support/near/253446805" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> leo60228 <a href="https://zulip-archive.rust-lang.org/stream/219381-t-libs/topic/Upstreaming.20Nintendo.20Switch.20Support.html#253446805">(Sep 15 2021 at 16:41)</a>:</h4>
<p>to be clear the target currently being discussed would work via reverse engineered syscalls/etc</p>



<a name="253446960"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/219381-t-libs/topic/Upstreaming%20Nintendo%20Switch%20Support/near/253446960" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> leo60228 <a href="https://zulip-archive.rust-lang.org/stream/219381-t-libs/topic/Upstreaming.20Nintendo.20Switch.20Support.html#253446960">(Sep 15 2021 at 16:42)</a>:</h4>
<p>i would not expect a non-reverse-engineered target to be upstreamed due to ndas</p>



<a name="253447013"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/219381-t-libs/topic/Upstreaming%20Nintendo%20Switch%20Support/near/253447013" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> jam1garner <a href="https://zulip-archive.rust-lang.org/stream/219381-t-libs/topic/Upstreaming.20Nintendo.20Switch.20Support.html#253447013">(Sep 15 2021 at 16:42)</a>:</h4>
<p>(it's building against a cleanroom understanding of an interface, none of the code present would be reverse engineered/decompiled)</p>



<a name="253447039"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/219381-t-libs/topic/Upstreaming%20Nintendo%20Switch%20Support/near/253447039" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> leo60228 <a href="https://zulip-archive.rust-lang.org/stream/219381-t-libs/topic/Upstreaming.20Nintendo.20Switch.20Support.html#253447039">(Sep 15 2021 at 16:42)</a>:</h4>
<p>yeah</p>



<a name="253447135"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/219381-t-libs/topic/Upstreaming%20Nintendo%20Switch%20Support/near/253447135" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> leo60228 <a href="https://zulip-archive.rust-lang.org/stream/219381-t-libs/topic/Upstreaming.20Nintendo.20Switch.20Support.html#253447135">(Sep 15 2021 at 16:42)</a>:</h4>
<p>also i think jam wrote a libstd port intended for game modding that uses the official sdk</p>



<a name="253447210"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/219381-t-libs/topic/Upstreaming%20Nintendo%20Switch%20Support/near/253447210" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> leo60228 <a href="https://zulip-archive.rust-lang.org/stream/219381-t-libs/topic/Upstreaming.20Nintendo.20Switch.20Support.html#253447210">(Sep 15 2021 at 16:43)</a>:</h4>
<p>(the sdk is dynamically linked, so)</p>



<a name="253447244"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/219381-t-libs/topic/Upstreaming%20Nintendo%20Switch%20Support/near/253447244" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> leo60228 <a href="https://zulip-archive.rust-lang.org/stream/219381-t-libs/topic/Upstreaming.20Nintendo.20Switch.20Support.html#253447244">(Sep 15 2021 at 16:43)</a>:</h4>
<p>but that's separate from what's being discussed here</p>



<a name="253447431"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/219381-t-libs/topic/Upstreaming%20Nintendo%20Switch%20Support/near/253447431" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Mara <a href="https://zulip-archive.rust-lang.org/stream/219381-t-libs/topic/Upstreaming.20Nintendo.20Switch.20Support.html#253447431">(Sep 15 2021 at 16:44)</a>:</h4>
<p><span class="user-mention silent" data-user-id="322737">jam1garner</span> <a href="#narrow/stream/219381-t-libs/topic/Upstreaming.20Nintendo.20Switch.20Support/near/253445900">said</a>:</p>
<blockquote>
<p>One possibility that I think would prevent this happening again would be to start by upstreaming a very basic support first--thing something like wasm where there's no I/O or syncronization primatives aside from stubs</p>
</blockquote>
<p>that seems perfectly fine to me.</p>



<a name="253447539"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/219381-t-libs/topic/Upstreaming%20Nintendo%20Switch%20Support/near/253447539" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> jam1garner <a href="https://zulip-archive.rust-lang.org/stream/219381-t-libs/topic/Upstreaming.20Nintendo.20Switch.20Support.html#253447539">(Sep 15 2021 at 16:45)</a>:</h4>
<p>thank you mara &lt;3 I think that will make things a lot easier on both ends, I frankly felt bad for the reviewer last time <span aria-label="grimacing" class="emoji emoji-1f62c" role="img" title="grimacing">:grimacing:</span></p>



<a name="253449556"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/219381-t-libs/topic/Upstreaming%20Nintendo%20Switch%20Support/near/253449556" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> simulacrum <a href="https://zulip-archive.rust-lang.org/stream/219381-t-libs/topic/Upstreaming.20Nintendo.20Switch.20Support.html#253449556">(Sep 15 2021 at 16:57)</a>:</h4>
<p><a href="https://github.com/rust-lang/rust/pull/88529#issuecomment-919938396">https://github.com/rust-lang/rust/pull/88529#issuecomment-919938396</a> should be kept in mind, I think</p>



<a name="253450460"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/219381-t-libs/topic/Upstreaming%20Nintendo%20Switch%20Support/near/253450460" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> jam1garner <a href="https://zulip-archive.rust-lang.org/stream/219381-t-libs/topic/Upstreaming.20Nintendo.20Switch.20Support.html#253450460">(Sep 15 2021 at 17:01)</a>:</h4>
<p>if we were to go that route, what would 'legal review' entail? I'm assuming the Rust project has no means of providing us with legal review, but what type of service should be sought out if the burden of legal review is on us?</p>



<a name="253450916"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/219381-t-libs/topic/Upstreaming%20Nintendo%20Switch%20Support/near/253450916" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> simulacrum <a href="https://zulip-archive.rust-lang.org/stream/219381-t-libs/topic/Upstreaming.20Nintendo.20Switch.20Support.html#253450916">(Sep 15 2021 at 17:04)</a>:</h4>
<p>I'd email <a href="mailto:core@rust-lang.org">core@rust-lang.org</a> and ask. I think it depends on the exact scope and proposal for what is being added and where.</p>



<a name="253451085"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/219381-t-libs/topic/Upstreaming%20Nintendo%20Switch%20Support/near/253451085" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jane Lusby <a href="https://zulip-archive.rust-lang.org/stream/219381-t-libs/topic/Upstreaming.20Nintendo.20Switch.20Support.html#253451085">(Sep 15 2021 at 17:05)</a>:</h4>
<p>we do have the means to provide legal review through the foundation</p>



<a name="253451090"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/219381-t-libs/topic/Upstreaming%20Nintendo%20Switch%20Support/near/253451090" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Mara <a href="https://zulip-archive.rust-lang.org/stream/219381-t-libs/topic/Upstreaming.20Nintendo.20Switch.20Support.html#253451090">(Sep 15 2021 at 17:05)</a>:</h4>
<blockquote>
<p>I'm assuming the Rust project has no means of providing us with legal review</p>
</blockquote>
<p>the foundation and/or the core team might be able to provide that. the foundation handles a bunch of legal stuff.</p>



<a name="253452156"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/219381-t-libs/topic/Upstreaming%20Nintendo%20Switch%20Support/near/253452156" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> jam1garner <a href="https://zulip-archive.rust-lang.org/stream/219381-t-libs/topic/Upstreaming.20Nintendo.20Switch.20Support.html#253452156">(Sep 15 2021 at 17:11)</a>:</h4>
<p>Alright. I assume no_std support can proceed without anything requiring review, since it wouldn't require anything special, but once we near a point in which alloc/std support is being discussed we'll make sure to contact either the core team or the foundation about legal review</p>



<a name="253454693"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/219381-t-libs/topic/Upstreaming%20Nintendo%20Switch%20Support/near/253454693" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jane Lusby <a href="https://zulip-archive.rust-lang.org/stream/219381-t-libs/topic/Upstreaming.20Nintendo.20Switch.20Support.html#253454693">(Sep 15 2021 at 17:26)</a>:</h4>
<p>I recommend cc'ing both in the email</p>



<a name="253456755"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/219381-t-libs/topic/Upstreaming%20Nintendo%20Switch%20Support/near/253456755" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> jam1garner <a href="https://zulip-archive.rust-lang.org/stream/219381-t-libs/topic/Upstreaming.20Nintendo.20Switch.20Support.html#253456755">(Sep 15 2021 at 17:40)</a>:</h4>
<p><span class="user-mention" data-user-id="220273">@Jane Lusby</span> for the foundation I should use <a href="mailto:foundation@rust-lang.org">foundation@rust-lang.org</a>, correct? (and ofc the core team email from above)</p>



<a name="253458203"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/219381-t-libs/topic/Upstreaming%20Nintendo%20Switch%20Support/near/253458203" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jane Lusby <a href="https://zulip-archive.rust-lang.org/stream/219381-t-libs/topic/Upstreaming.20Nintendo.20Switch.20Support.html#253458203">(Sep 15 2021 at 17:49)</a>:</h4>
<p>Correct</p>



<a name="253459796"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/219381-t-libs/topic/Upstreaming%20Nintendo%20Switch%20Support/near/253459796" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> jam1garner <a href="https://zulip-archive.rust-lang.org/stream/219381-t-libs/topic/Upstreaming.20Nintendo.20Switch.20Support.html#253459796">(Sep 15 2021 at 17:58)</a>:</h4>
<p>Alright, thank you all!</p>



<a name="253480082"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/219381-t-libs/topic/Upstreaming%20Nintendo%20Switch%20Support/near/253480082" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Lokathor <a href="https://zulip-archive.rust-lang.org/stream/219381-t-libs/topic/Upstreaming.20Nintendo.20Switch.20Support.html#253480082">(Sep 15 2021 at 20:13)</a>:</h4>
<p>What no_std support would be added? if you don't mind saying. For GBA support only a single division function was added to <code>compiler_builtins</code>, everything else worked out of the box.</p>



<a name="253480226"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/219381-t-libs/topic/Upstreaming%20Nintendo%20Switch%20Support/near/253480226" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> bjorn3 <a href="https://zulip-archive.rust-lang.org/stream/219381-t-libs/topic/Upstreaming.20Nintendo.20Switch.20Support.html#253480226">(Sep 15 2021 at 20:14)</a>:</h4>
<p>Adding a compiler target I guess.</p>



<a name="253490797"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/219381-t-libs/topic/Upstreaming%20Nintendo%20Switch%20Support/near/253490797" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> jam1garner <a href="https://zulip-archive.rust-lang.org/stream/219381-t-libs/topic/Upstreaming.20Nintendo.20Switch.20Support.html#253490797">(Sep 15 2021 at 21:28)</a>:</h4>
<p>Yes, the inital PR is just adding a compiler target</p>



<a name="253490890"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/219381-t-libs/topic/Upstreaming%20Nintendo%20Switch%20Support/near/253490890" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> jam1garner <a href="https://zulip-archive.rust-lang.org/stream/219381-t-libs/topic/Upstreaming.20Nintendo.20Switch.20Support.html#253490890">(Sep 15 2021 at 21:29)</a>:</h4>
<p>sorry "no_std support" was a weird phrasing choice, my bad. the switch is not weird enough a target to require anything special in core</p>



<a name="253492697"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/219381-t-libs/topic/Upstreaming%20Nintendo%20Switch%20Support/near/253492697" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> jam1garner <a href="https://zulip-archive.rust-lang.org/stream/219381-t-libs/topic/Upstreaming.20Nintendo.20Switch.20Support.html#253492697">(Sep 15 2021 at 21:43)</a>:</h4>
<p>Here's the initial tier 3 target PR if anyone here wants to tag in for review: <a href="https://github.com/rust-lang/rust/pull/88991">https://github.com/rust-lang/rust/pull/88991</a></p>



<a name="253514134"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/219381-t-libs/topic/Upstreaming%20Nintendo%20Switch%20Support/near/253514134" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Lokathor <a href="https://zulip-archive.rust-lang.org/stream/219381-t-libs/topic/Upstreaming.20Nintendo.20Switch.20Support.html#253514134">(Sep 16 2021 at 01:25)</a>:</h4>
<p>This makes me ever so slightly want to add a "gba" tier 3 target that's separate from the current <code>thumbv4t-none-eabi</code> target and specifies an os and/or env of "gba".</p>
<p>then again, i didn't even get off my butt to add a generic armv4t-none-eabi target, which would be far easier to get t-compiler to accept i think</p>



<a name="253514684"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/219381-t-libs/topic/Upstreaming%20Nintendo%20Switch%20Support/near/253514684" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> jam1garner <a href="https://zulip-archive.rust-lang.org/stream/219381-t-libs/topic/Upstreaming.20Nintendo.20Switch.20Support.html#253514684">(Sep 16 2021 at 01:32)</a>:</h4>
<p><span class="user-mention" data-user-id="224471">@Lokathor</span> imo that's actually a <em>good</em> idea, if only because then people making crates targeting it have a standardized cfg()</p>



<a name="253514745"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/219381-t-libs/topic/Upstreaming%20Nintendo%20Switch%20Support/near/253514745" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> jam1garner <a href="https://zulip-archive.rust-lang.org/stream/219381-t-libs/topic/Upstreaming.20Nintendo.20Switch.20Support.html#253514745">(Sep 16 2021 at 01:33)</a>:</h4>
<p>(I do not know if this is the general consensus--but being able to upstream that sort of thing so that more an more "normal" crates just work out of the box for these targets is something personally appealing to me)</p>



<a name="253515394"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/219381-t-libs/topic/Upstreaming%20Nintendo%20Switch%20Support/near/253515394" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Lokathor <a href="https://zulip-archive.rust-lang.org/stream/219381-t-libs/topic/Upstreaming.20Nintendo.20Switch.20Support.html#253515394">(Sep 16 2021 at 01:41)</a>:</h4>
<p>Well when I added thumbv4t-none-eabi it started as being GBA specific, and then during the review process i was very slightly prodded to move it away from being GBA specific so that it could be more generally used.</p>
<p>currently the <code>gba</code> crate is in a holding pattern, but it has a non-zero number of people other than me who comment on the issues and file PRs sometimes, so clearly it's used someone other than just myself. My own rust time has actually been spent working on a tutorial for GBA programming, which will take me probably quite some time more before it's done. Which is to say: I don't feel super rushed to decide either way.</p>



<a name="253515492"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/219381-t-libs/topic/Upstreaming%20Nintendo%20Switch%20Support/near/253515492" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Lokathor <a href="https://zulip-archive.rust-lang.org/stream/219381-t-libs/topic/Upstreaming.20Nintendo.20Switch.20Support.html#253515492">(Sep 16 2021 at 01:42)</a>:</h4>
<p>I'm actually very interested that you're adding a linker script automatically. Is it well settled enough that no one would really need to change it?</p>



<a name="253516022"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/219381-t-libs/topic/Upstreaming%20Nintendo%20Switch%20Support/near/253516022" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> jam1garner <a href="https://zulip-archive.rust-lang.org/stream/219381-t-libs/topic/Upstreaming.20Nintendo.20Switch.20Support.html#253516022">(Sep 16 2021 at 01:48)</a>:</h4>
<p>Given the primary use case of this target is homebrew where the linkage is unfortunately kinda strict--yes</p>



<a name="253516147"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/219381-t-libs/topic/Upstreaming%20Nintendo%20Switch%20Support/near/253516147" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> jam1garner <a href="https://zulip-archive.rust-lang.org/stream/219381-t-libs/topic/Upstreaming.20Nintendo.20Switch.20Support.html#253516147">(Sep 16 2021 at 01:50)</a>:</h4>
<p>The switch homebrew loader that has become the standard has kinda an unfortunate environment in general--rather than use the OS standard format for dynamic libraries (nro) it uses a custom homebrew-only variation of it that isn't great, among some other criticisms I have but not conforming to it isn't really an option</p>



<a name="253516229"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/219381-t-libs/topic/Upstreaming%20Nintendo%20Switch%20Support/near/253516229" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Lokathor <a href="https://zulip-archive.rust-lang.org/stream/219381-t-libs/topic/Upstreaming.20Nintendo.20Switch.20Support.html#253516229">(Sep 16 2021 at 01:51)</a>:</h4>
<p>ah fair. the GBA is in the baremetal subcategory of no_std, where the programmer has near-complete freedom about all memory usage, within the very light limits of the hardware itself. but no significant memory protection or anything like that.</p>



<a name="253516297"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/219381-t-libs/topic/Upstreaming%20Nintendo%20Switch%20Support/near/253516297" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> jam1garner <a href="https://zulip-archive.rust-lang.org/stream/219381-t-libs/topic/Upstreaming.20Nintendo.20Switch.20Support.html#253516297">(Sep 16 2021 at 01:52)</a>:</h4>
<p>well can't wait to see your tutorial, I've only used straight arm for GBA, Rust sounds like a fun time :)</p>



<a name="253516433"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/219381-t-libs/topic/Upstreaming%20Nintendo%20Switch%20Support/near/253516433" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Lokathor <a href="https://zulip-archive.rust-lang.org/stream/219381-t-libs/topic/Upstreaming.20Nintendo.20Switch.20Support.html#253516433">(Sep 16 2021 at 01:54)</a>:</h4>
<p><a href="https://lokathor.github.io/gba-from-scratch/">https://lokathor.github.io/gba-from-scratch/</a> (WIP and such)</p>



<a name="253516470"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/219381-t-libs/topic/Upstreaming%20Nintendo%20Switch%20Support/near/253516470" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> jam1garner <a href="https://zulip-archive.rust-lang.org/stream/219381-t-libs/topic/Upstreaming.20Nintendo.20Switch.20Support.html#253516470">(Sep 16 2021 at 01:54)</a>:</h4>
<p>awesome, will need to find my GBA and flashcart that I got for dev work then barely ever touched</p>



<a name="253599795"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/219381-t-libs/topic/Upstreaming%20Nintendo%20Switch%20Support/near/253599795" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> leo60228 <a href="https://zulip-archive.rust-lang.org/stream/219381-t-libs/topic/Upstreaming.20Nintendo.20Switch.20Support.html#253599795">(Sep 16 2021 at 15:25)</a>:</h4>
<p>i was thinking abt the actual libstd implementation</p>



<a name="253600068"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/219381-t-libs/topic/Upstreaming%20Nintendo%20Switch%20Support/near/253600068" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> leo60228 <a href="https://zulip-archive.rust-lang.org/stream/219381-t-libs/topic/Upstreaming.20Nintendo.20Switch.20Support.html#253600068">(Sep 16 2021 at 15:26)</a>:</h4>
<p>the crate for interfacing with the system (<code>nx</code>) currently depends on <code>paste</code>,  <code>logpacket</code> (implementation of what's basically the switch's equivalent to syslog), <code>linked_list_allocator</code>, and <code>arrayvec</code></p>



<a name="253600102"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/219381-t-libs/topic/Upstreaming%20Nintendo%20Switch%20Support/near/253600102" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> leo60228 <a href="https://zulip-archive.rust-lang.org/stream/219381-t-libs/topic/Upstreaming.20Nintendo.20Switch.20Support.html#253600102">(Sep 16 2021 at 15:27)</a>:</h4>
<p>(none of those themselves have any dependencies with the enabled features)</p>



<a name="253600152"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/219381-t-libs/topic/Upstreaming%20Nintendo%20Switch%20Support/near/253600152" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> leo60228 <a href="https://zulip-archive.rust-lang.org/stream/219381-t-libs/topic/Upstreaming.20Nintendo.20Switch.20Support.html#253600152">(Sep 16 2021 at 15:27)</a>:</h4>
<p>for using <code>nx</code> in libstd</p>



<a name="253600180"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/219381-t-libs/topic/Upstreaming%20Nintendo%20Switch%20Support/near/253600180" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> leo60228 <a href="https://zulip-archive.rust-lang.org/stream/219381-t-libs/topic/Upstreaming.20Nintendo.20Switch.20Support.html#253600180">(Sep 16 2021 at 15:27)</a>:</h4>
<p><code>nx</code> and <code>logpacket</code> would be easy</p>



<a name="253600257"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/219381-t-libs/topic/Upstreaming%20Nintendo%20Switch%20Support/near/253600257" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> leo60228 <a href="https://zulip-archive.rust-lang.org/stream/219381-t-libs/topic/Upstreaming.20Nintendo.20Switch.20Support.html#253600257">(Sep 16 2021 at 15:27)</a>:</h4>
<p>with a libstd port it'd probably make sense to remove the <code>linked_list_allocator</code> dep and use <code>dlmalloc</code> in libstd</p>



<a name="253600422"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/219381-t-libs/topic/Upstreaming%20Nintendo%20Switch%20Support/near/253600422" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> leo60228 <a href="https://zulip-archive.rust-lang.org/stream/219381-t-libs/topic/Upstreaming.20Nintendo.20Switch.20Support.html#253600422">(Sep 16 2021 at 15:28)</a>:</h4>
<p><code>arrayvec</code> i guess i should submit a PR adding <code>rustc-dep-of-std</code>....? i'm not sure it's really worth creating a bespoke version of <code>arrayvec</code> but i guess it'd be possible</p>



<a name="253600444"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/219381-t-libs/topic/Upstreaming%20Nintendo%20Switch%20Support/near/253600444" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> leo60228 <a href="https://zulip-archive.rust-lang.org/stream/219381-t-libs/topic/Upstreaming.20Nintendo.20Switch.20Support.html#253600444">(Sep 16 2021 at 15:29)</a>:</h4>
<p>i honestly have no idea what to do abt <code>paste</code></p>



<a name="253600666"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/219381-t-libs/topic/Upstreaming%20Nintendo%20Switch%20Support/near/253600666" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Mara <a href="https://zulip-archive.rust-lang.org/stream/219381-t-libs/topic/Upstreaming.20Nintendo.20Switch.20Support.html#253600666">(Sep 16 2021 at 15:30)</a>:</h4>
<p>now that we have const generics, it'd be cool to have something like <code>arrayvec</code> in <code>std</code>.</p>



<a name="253601413"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/219381-t-libs/topic/Upstreaming%20Nintendo%20Switch%20Support/near/253601413" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> leo60228 <a href="https://zulip-archive.rust-lang.org/stream/219381-t-libs/topic/Upstreaming.20Nintendo.20Switch.20Support.html#253601413">(Sep 16 2021 at 15:35)</a>:</h4>
<p>like, i think <code>paste</code> is probably light enough as a dependency, esp. for only one target</p>



<a name="253601456"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/219381-t-libs/topic/Upstreaming%20Nintendo%20Switch%20Support/near/253601456" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> leo60228 <a href="https://zulip-archive.rust-lang.org/stream/219381-t-libs/topic/Upstreaming.20Nintendo.20Switch.20Support.html#253601456">(Sep 16 2021 at 15:35)</a>:</h4>
<p>but i don't really understand how proc macros interact with the <code>rustc-dep-of-std</code> thing</p>



<a name="253601557"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/219381-t-libs/topic/Upstreaming%20Nintendo%20Switch%20Support/near/253601557" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> leo60228 <a href="https://zulip-archive.rust-lang.org/stream/219381-t-libs/topic/Upstreaming.20Nintendo.20Switch.20Support.html#253601557">(Sep 16 2021 at 15:36)</a>:</h4>
<p><span class="user-mention silent" data-user-id="310399">Mara</span> <a href="#narrow/stream/219381-t-libs/topic/Upstreaming.20Nintendo.20Switch.20Support/near/253600666">said</a>:</p>
<blockquote>
<p>now that we have const generics, it'd be cool to have something like <code>arrayvec</code> in <code>std</code>.</p>
</blockquote>
<p>yeah, probably</p>



<a name="253601605"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/219381-t-libs/topic/Upstreaming%20Nintendo%20Switch%20Support/near/253601605" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> leo60228 <a href="https://zulip-archive.rust-lang.org/stream/219381-t-libs/topic/Upstreaming.20Nintendo.20Switch.20Support.html#253601605">(Sep 16 2021 at 15:36)</a>:</h4>
<p>i'd be fine adding that in its own PR but it feels like smth that probably deserves an RFC</p>



<a name="253603645"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/219381-t-libs/topic/Upstreaming%20Nintendo%20Switch%20Support/near/253603645" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> bjorn3 <a href="https://zulip-archive.rust-lang.org/stream/219381-t-libs/topic/Upstreaming.20Nintendo.20Switch.20Support.html#253603645">(Sep 16 2021 at 15:50)</a>:</h4>
<p>I don't think having libstd depend on proc macros is a good idea. It may give problems with cross-compiling. They already need a hack when cross compiling rustc.</p>



<a name="253604215"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/219381-t-libs/topic/Upstreaming%20Nintendo%20Switch%20Support/near/253604215" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> leo60228 <a href="https://zulip-archive.rust-lang.org/stream/219381-t-libs/topic/Upstreaming.20Nintendo.20Switch.20Support.html#253604215">(Sep 16 2021 at 15:54)</a>:</h4>
<p><span class="user-mention silent" data-user-id="133247">bjorn3</span> <a href="#narrow/stream/219381-t-libs/topic/Upstreaming.20Nintendo.20Switch.20Support/near/253603645">said</a>:</p>
<blockquote>
<p>I don't think having libstd depend on proc macros is a good idea. It may give problems with cross-compiling. They already need a hack when cross compiling rustc.</p>
</blockquote>
<p>that's fair</p>



<a name="253604220"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/219381-t-libs/topic/Upstreaming%20Nintendo%20Switch%20Support/near/253604220" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> leo60228 <a href="https://zulip-archive.rust-lang.org/stream/219381-t-libs/topic/Upstreaming.20Nintendo.20Switch.20Support.html#253604220">(Sep 16 2021 at 15:54)</a>:</h4>
<p>i haven't actually touched the code using it myself until now</p>



<a name="253604318"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/219381-t-libs/topic/Upstreaming%20Nintendo%20Switch%20Support/near/253604318" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> leo60228 <a href="https://zulip-archive.rust-lang.org/stream/219381-t-libs/topic/Upstreaming.20Nintendo.20Switch.20Support.html#253604318">(Sep 16 2021 at 15:54)</a>:</h4>
<p>let me make a simplified version of how it's used, one sec</p>



<a name="253605209"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/219381-t-libs/topic/Upstreaming%20Nintendo%20Switch%20Support/near/253605209" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> leo60228 <a href="https://zulip-archive.rust-lang.org/stream/219381-t-libs/topic/Upstreaming.20Nintendo.20Switch.20Support.html#253605209">(Sep 16 2021 at 16:00)</a>:</h4>
<p><a href="https://play.rust-lang.org/?version=stable&amp;mode=debug&amp;edition=2018&amp;gist=d1e460ff12120c220d1cbff48b7fc34b">https://play.rust-lang.org/?version=stable&amp;mode=debug&amp;edition=2018&amp;gist=d1e460ff12120c220d1cbff48b7fc34b</a></p>



<a name="253605241"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/219381-t-libs/topic/Upstreaming%20Nintendo%20Switch%20Support/near/253605241" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> leo60228 <a href="https://zulip-archive.rust-lang.org/stream/219381-t-libs/topic/Upstreaming.20Nintendo.20Switch.20Support.html#253605241">(Sep 16 2021 at 16:00)</a>:</h4>
<p>ofc the actual use is more complex</p>



<a name="253605251"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/219381-t-libs/topic/Upstreaming%20Nintendo%20Switch%20Support/near/253605251" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> leo60228 <a href="https://zulip-archive.rust-lang.org/stream/219381-t-libs/topic/Upstreaming.20Nintendo.20Switch.20Support.html#253605251">(Sep 16 2021 at 16:00)</a>:</h4>
<p>but this is the idea</p>



<a name="253605391"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/219381-t-libs/topic/Upstreaming%20Nintendo%20Switch%20Support/near/253605391" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> leo60228 <a href="https://zulip-archive.rust-lang.org/stream/219381-t-libs/topic/Upstreaming.20Nintendo.20Switch.20Support.html#253605391">(Sep 16 2021 at 16:01)</a>:</h4>
<p>hm, i haven't looked super closely, but i think this might work</p>



<a name="253606125"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/219381-t-libs/topic/Upstreaming%20Nintendo%20Switch%20Support/near/253606125" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> jam1garner <a href="https://zulip-archive.rust-lang.org/stream/219381-t-libs/topic/Upstreaming.20Nintendo.20Switch.20Support.html#253606125">(Sep 16 2021 at 16:06)</a>:</h4>
<p>I've looked back through it (haven't played with XorTroll's stuff in a while) and all the paste usage seems like it could be replaced with either a build script or ahead-of-time codegen</p>



<a name="253606275"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/219381-t-libs/topic/Upstreaming%20Nintendo%20Switch%20Support/near/253606275" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> jam1garner <a href="https://zulip-archive.rust-lang.org/stream/219381-t-libs/topic/Upstreaming.20Nintendo.20Switch.20Support.html#253606275">(Sep 16 2021 at 16:07)</a>:</h4>
<p>it also might be worth assessing what parts of nx-rs we actually need and possibly working with XorTroll to split nx-rs into multiple crates and possibly only depend on the core of it</p>



<a name="253606535"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/219381-t-libs/topic/Upstreaming%20Nintendo%20Switch%20Support/near/253606535" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> jam1garner <a href="https://zulip-archive.rust-lang.org/stream/219381-t-libs/topic/Upstreaming.20Nintendo.20Switch.20Support.html#253606535">(Sep 16 2021 at 16:09)</a>:</h4>
<p>I think also reducing the surface area of the switch-specific code needed to be reviewed might make the legal assessment easier, nx-rs has gotten decently large for what we need of it</p>



<a name="253606843"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/219381-t-libs/topic/Upstreaming%20Nintendo%20Switch%20Support/near/253606843" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> jam1garner <a href="https://zulip-archive.rust-lang.org/stream/219381-t-libs/topic/Upstreaming.20Nintendo.20Switch.20Support.html#253606843">(Sep 16 2021 at 16:11)</a>:</h4>
<p>it's currently roughly 12k lines of Rust (and that's not even including the code generated by said macros for IPC) which imo is probably overkill for what we need (effectively a libc level of abstraction, but a very small portion of what libc's API covers)</p>



<a name="253607177"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/219381-t-libs/topic/Upstreaming%20Nintendo%20Switch%20Support/near/253607177" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> jam1garner <a href="https://zulip-archive.rust-lang.org/stream/219381-t-libs/topic/Upstreaming.20Nintendo.20Switch.20Support.html#253607177">(Sep 16 2021 at 16:13)</a>:</h4>
<p>I think another benefit of such an approach is that we'd be able to assess and improve XorTroll's code while moving the parts we need to a separate library. I think it'd be in our best interest as well to do a pass over all the code we depend on (both from a technical and legal perspective) so it'd be knocking out two birds with one stone.</p>



<a name="253607259"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/219381-t-libs/topic/Upstreaming%20Nintendo%20Switch%20Support/near/253607259" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Lokathor <a href="https://zulip-archive.rust-lang.org/stream/219381-t-libs/topic/Upstreaming.20Nintendo.20Switch.20Support.html#253607259">(Sep 16 2021 at 16:13)</a>:</h4>
<p><code>tinyvec</code>, if it can cover your use case, is already somewhere within the standard library overall</p>



<a name="253607369"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/219381-t-libs/topic/Upstreaming%20Nintendo%20Switch%20Support/near/253607369" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Lokathor <a href="https://zulip-archive.rust-lang.org/stream/219381-t-libs/topic/Upstreaming.20Nintendo.20Switch.20Support.html#253607369">(Sep 16 2021 at 16:14)</a>:</h4>
<p>it has an arrayvec style struct and also a smallvec style enum</p>



<a name="253609058"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/219381-t-libs/topic/Upstreaming%20Nintendo%20Switch%20Support/near/253609058" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> leo60228 <a href="https://zulip-archive.rust-lang.org/stream/219381-t-libs/topic/Upstreaming.20Nintendo.20Switch.20Support.html#253609058">(Sep 16 2021 at 16:25)</a>:</h4>
<p><span class="user-mention silent" data-user-id="322737">jam1garner</span> <a href="#narrow/stream/219381-t-libs/topic/Upstreaming.20Nintendo.20Switch.20Support/near/253606125">said</a>:</p>
<blockquote>
<p>I've looked back through it (haven't played with XorTroll's stuff in a while) and all the paste usage seems like it could be replaced with either a build script or ahead-of-time codegen</p>
</blockquote>
<p>fwiw</p>



<a name="253609086"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/219381-t-libs/topic/Upstreaming%20Nintendo%20Switch%20Support/near/253609086" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> leo60228 <a href="https://zulip-archive.rust-lang.org/stream/219381-t-libs/topic/Upstreaming.20Nintendo.20Switch.20Support.html#253609086">(Sep 16 2021 at 16:25)</a>:</h4>
<p>i came up with an extremely evil hack to keep using decl macros for codegen without removing any functionality</p>



<a name="253609089"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/219381-t-libs/topic/Upstreaming%20Nintendo%20Switch%20Support/near/253609089" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> leo60228 <a href="https://zulip-archive.rust-lang.org/stream/219381-t-libs/topic/Upstreaming.20Nintendo.20Switch.20Support.html#253609089">(Sep 16 2021 at 16:25)</a>:</h4>
<p><a href="https://play.rust-lang.org/?version=nightly&amp;mode=debug&amp;edition=2018&amp;gist=369d35c0d8401101a95b055c68609ef9">https://play.rust-lang.org/?version=nightly&amp;mode=debug&amp;edition=2018&amp;gist=369d35c0d8401101a95b055c68609ef9</a></p>



<a name="253622570"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/219381-t-libs/topic/Upstreaming%20Nintendo%20Switch%20Support/near/253622570" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> leo60228 <a href="https://zulip-archive.rust-lang.org/stream/219381-t-libs/topic/Upstreaming.20Nintendo.20Switch.20Support.html#253622570">(Sep 16 2021 at 17:54)</a>:</h4>
<p>oops</p>



<a name="253622649"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/219381-t-libs/topic/Upstreaming%20Nintendo%20Switch%20Support/near/253622649" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> leo60228 <a href="https://zulip-archive.rust-lang.org/stream/219381-t-libs/topic/Upstreaming.20Nintendo.20Switch.20Support.html#253622649">(Sep 16 2021 at 17:55)</a>:</h4>
<p><span class="user-mention silent" data-user-id="224471">Lokathor</span> <a href="#narrow/stream/219381-t-libs/topic/Upstreaming.20Nintendo.20Switch.20Support/near/253607259">said</a>:</p>
<blockquote>
<p><code>tinyvec</code>, if it can cover your use case, is already somewhere within the standard library overall</p>
</blockquote>
<p>is it vendored? it seems to be a dependency of rustc but not libstd</p>



<a name="253622876"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/219381-t-libs/topic/Upstreaming%20Nintendo%20Switch%20Support/near/253622876" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> bjorn3 <a href="https://zulip-archive.rust-lang.org/stream/219381-t-libs/topic/Upstreaming.20Nintendo.20Switch.20Support.html#253622876">(Sep 16 2021 at 17:56)</a>:</h4>
<p>I don't think it is vendored.</p>



<a name="253624036"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/219381-t-libs/topic/Upstreaming%20Nintendo%20Switch%20Support/near/253624036" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> leo60228 <a href="https://zulip-archive.rust-lang.org/stream/219381-t-libs/topic/Upstreaming.20Nintendo.20Switch.20Support.html#253624036">(Sep 16 2021 at 18:03)</a>:</h4>
<p><span class="user-mention silent" data-user-id="310399">Mara</span> <a href="#narrow/stream/219381-t-libs/topic/Upstreaming.20Nintendo.20Switch.20Support/near/253600666">said</a>:</p>
<blockquote>
<p>now that we have const generics, it'd be cool to have something like <code>arrayvec</code> in <code>std</code>.</p>
</blockquote>
<p>was thinking about how to implement this since it'd share a ton of code with vec</p>



<a name="253624062"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/219381-t-libs/topic/Upstreaming%20Nintendo%20Switch%20Support/near/253624062" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> leo60228 <a href="https://zulip-archive.rust-lang.org/stream/219381-t-libs/topic/Upstreaming.20Nintendo.20Switch.20Support.html#253624062">(Sep 16 2021 at 18:03)</a>:</h4>
<p>and i had a possibly-excessively-clever idea</p>



<a name="253624849"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/219381-t-libs/topic/Upstreaming%20Nintendo%20Switch%20Support/near/253624849" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> leo60228 <a href="https://zulip-archive.rust-lang.org/stream/219381-t-libs/topic/Upstreaming.20Nintendo.20Switch.20Support.html#253624849">(Sep 16 2021 at 18:08)</a>:</h4>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="k">pub</span><span class="w"> </span><span class="k">trait</span><span class="w"> </span><span class="n">RawVec</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="o">..</span><span class="p">.</span><span class="w"> </span><span class="p">}</span><span class="w"></span>

<span class="k">pub</span><span class="w"> </span><span class="k">struct</span> <span class="nc">ArrayRawVec</span><span class="o">&lt;</span><span class="n">T</span><span class="p">,</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="n">N</span>: <span class="kt">usize</span><span class="o">&gt;</span><span class="p">([</span><span class="n">MaybeUninit</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;</span><span class="p">;</span><span class="w"> </span><span class="n">N</span><span class="p">]);</span><span class="w"></span>
<span class="k">impl</span><span class="o">&lt;</span><span class="n">T</span><span class="p">,</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="n">N</span>: <span class="kt">usize</span><span class="o">&gt;</span><span class="w"> </span><span class="n">RawVec</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="n">ArrayRawVec</span><span class="o">&lt;</span><span class="n">T</span><span class="p">,</span><span class="w"> </span><span class="n">N</span><span class="o">&gt;</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="o">..</span><span class="p">.</span><span class="w"> </span><span class="p">}</span><span class="w"></span>

<span class="k">pub</span><span class="w"> </span><span class="k">struct</span> <span class="nc">HeapRawVec</span><span class="o">&lt;</span><span class="n">T</span><span class="p">,</span><span class="w"> </span><span class="n">A</span>: <span class="nc">Allocator</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Global</span><span class="o">&gt;</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="o">..</span><span class="p">.</span><span class="w"> </span><span class="p">}</span><span class="w"></span>
<span class="k">impl</span><span class="o">&lt;</span><span class="n">T</span><span class="p">,</span><span class="w"> </span><span class="n">A</span>: <span class="nc">Allocator</span><span class="o">&gt;</span><span class="w"> </span><span class="n">RawVec</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="n">HeapRawVec</span><span class="o">&lt;</span><span class="n">T</span><span class="p">,</span><span class="w"> </span><span class="n">A</span><span class="o">&gt;</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="o">..</span><span class="p">.</span><span class="w"> </span><span class="p">}</span><span class="w"></span>

<span class="k">pub</span><span class="w"> </span><span class="k">struct</span> <span class="nc">AbstractVec</span><span class="o">&lt;</span><span class="n">T</span><span class="p">,</span><span class="w"> </span><span class="n">R</span>: <span class="nc">RawVec</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;&gt;</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="o">..</span><span class="p">.</span><span class="w"> </span><span class="p">}</span><span class="w"></span>

<span class="k">pub</span><span class="w"> </span><span class="k">type</span> <span class="nc">ArrayVec</span><span class="o">&lt;</span><span class="n">T</span><span class="p">,</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="n">N</span>: <span class="kt">usize</span><span class="o">&gt;</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">AbstractVec</span><span class="o">&lt;</span><span class="n">T</span><span class="p">,</span><span class="w"> </span><span class="n">ArrayRawVec</span><span class="o">&lt;</span><span class="n">T</span><span class="p">,</span><span class="w"> </span><span class="n">N</span><span class="o">&gt;&gt;</span><span class="p">;</span><span class="w"></span>
<span class="k">pub</span><span class="w"> </span><span class="k">type</span> <span class="nb">Vec</span><span class="o">&lt;</span><span class="n">T</span><span class="p">,</span><span class="w"> </span><span class="n">A</span>: <span class="nc">Allocator</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Global</span><span class="o">&gt;</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">Vec</span><span class="o">&lt;</span><span class="n">T</span><span class="p">,</span><span class="w"> </span><span class="n">HeapRawVec</span><span class="o">&lt;</span><span class="n">T</span><span class="p">,</span><span class="w"> </span><span class="n">A</span><span class="o">&gt;&gt;</span><span class="p">;</span><span class="w"></span>
</code></pre></div>



<a name="253624988"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/219381-t-libs/topic/Upstreaming%20Nintendo%20Switch%20Support/near/253624988" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> leo60228 <a href="https://zulip-archive.rust-lang.org/stream/219381-t-libs/topic/Upstreaming.20Nintendo.20Switch.20Support.html#253624988">(Sep 16 2021 at 18:09)</a>:</h4>
<p>biggest issue i see is how to make rustdoc not be confusing</p>



<a name="253625067"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/219381-t-libs/topic/Upstreaming%20Nintendo%20Switch%20Support/near/253625067" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> leo60228 <a href="https://zulip-archive.rust-lang.org/stream/219381-t-libs/topic/Upstreaming.20Nintendo.20Switch.20Support.html#253625067">(Sep 16 2021 at 18:09)</a>:</h4>
<p>if <code>ArrayVec</code> was in <code>alloc</code> then this would be easier</p>



<a name="253625159"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/219381-t-libs/topic/Upstreaming%20Nintendo%20Switch%20Support/near/253625159" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> leo60228 <a href="https://zulip-archive.rust-lang.org/stream/219381-t-libs/topic/Upstreaming.20Nintendo.20Switch.20Support.html#253625159">(Sep 16 2021 at 18:10)</a>:</h4>
<p>since it could be <code>pub struct Vec&lt;T, R: RawVec&lt;T&gt; = HeapRawVec&lt;T&gt;&gt;</code></p>



<a name="253625203"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/219381-t-libs/topic/Upstreaming%20Nintendo%20Switch%20Support/near/253625203" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> leo60228 <a href="https://zulip-archive.rust-lang.org/stream/219381-t-libs/topic/Upstreaming.20Nintendo.20Switch.20Support.html#253625203">(Sep 16 2021 at 18:10)</a>:</h4>
<p>but i don't think <code>ArrayVec</code> <em>should</em> be in <code>alloc</code></p>



<a name="253625233"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/219381-t-libs/topic/Upstreaming%20Nintendo%20Switch%20Support/near/253625233" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> The 8472 <a href="https://zulip-archive.rust-lang.org/stream/219381-t-libs/topic/Upstreaming.20Nintendo.20Switch.20Support.html#253625233">(Sep 16 2021 at 18:10)</a>:</h4>
<p>see also <a href="https://internals.rust-lang.org/t/is-custom-allocators-the-right-abstraction/13460">https://internals.rust-lang.org/t/is-custom-allocators-the-right-abstraction/13460</a><br>
And there also is an open arrayvec RFC but it hasn't made much progress lately.</p>



<a name="253625368"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/219381-t-libs/topic/Upstreaming%20Nintendo%20Switch%20Support/near/253625368" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Lokathor <a href="https://zulip-archive.rust-lang.org/stream/219381-t-libs/topic/Upstreaming.20Nintendo.20Switch.20Support.html#253625368">(Sep 16 2021 at 18:11)</a>:</h4>
<blockquote>
<p>is it vendored? it seems to be a dependency of rustc but not libstd</p>
</blockquote>
<p>oh oops. I knew it was used by "some unicode stuff" and figured that was the standard library.</p>



<a name="253625628"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/219381-t-libs/topic/Upstreaming%20Nintendo%20Switch%20Support/near/253625628" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> leo60228 <a href="https://zulip-archive.rust-lang.org/stream/219381-t-libs/topic/Upstreaming.20Nintendo.20Switch.20Support.html#253625628">(Sep 16 2021 at 18:13)</a>:</h4>
<p>do you have a link to that rfc? i looked for one but didn't see anything</p>



<a name="253625681"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/219381-t-libs/topic/Upstreaming%20Nintendo%20Switch%20Support/near/253625681" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> leo60228 <a href="https://zulip-archive.rust-lang.org/stream/219381-t-libs/topic/Upstreaming.20Nintendo.20Switch.20Support.html#253625681">(Sep 16 2021 at 18:13)</a>:</h4>
<p>oh, not sure how i didnt see it <a href="https://github.com/rust-lang/rfcs/pull/2990">https://github.com/rust-lang/rfcs/pull/2990</a></p>



<a name="253626262"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/219381-t-libs/topic/Upstreaming%20Nintendo%20Switch%20Support/near/253626262" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> leo60228 <a href="https://zulip-archive.rust-lang.org/stream/219381-t-libs/topic/Upstreaming.20Nintendo.20Switch.20Support.html#253626262">(Sep 16 2021 at 18:17)</a>:</h4>
<p><span class="user-mention silent" data-user-id="330154">The 8472</span> <a href="#narrow/stream/219381-t-libs/topic/Upstreaming.20Nintendo.20Switch.20Support/near/253625233">said</a>:</p>
<blockquote>
<p>see also <a href="https://internals.rust-lang.org/t/is-custom-allocators-the-right-abstraction/13460">https://internals.rust-lang.org/t/is-custom-allocators-the-right-abstraction/13460</a><br>
And there also is an open arrayvec RFC but it hasn't made much progress lately.</p>
</blockquote>
<p>my main thought with the rfc is just that <code>Vec</code> and <code>ArrayVec</code> would share far more than they don't</p>



<a name="253626491"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/219381-t-libs/topic/Upstreaming%20Nintendo%20Switch%20Support/near/253626491" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> leo60228 <a href="https://zulip-archive.rust-lang.org/stream/219381-t-libs/topic/Upstreaming.20Nintendo.20Switch.20Support.html#253626491">(Sep 16 2021 at 18:18)</a>:</h4>
<p>only including stable methods</p>



<a name="253626894"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/219381-t-libs/topic/Upstreaming%20Nintendo%20Switch%20Support/near/253626894" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> leo60228 <a href="https://zulip-archive.rust-lang.org/stream/219381-t-libs/topic/Upstreaming.20Nintendo.20Switch.20Support.html#253626894">(Sep 16 2021 at 18:21)</a>:</h4>
<p>for <code>Vec</code>:</p>
<ul>
<li><code>reserve</code> and <code>reserve_exact</code> don't necessarily make sense but can just be an <code>assert!</code></li>
<li><code>shrink_to_fit</code> doesn't make sense but it being a no-op wouldn't violate the API contract</li>
<li><code>with_capacity</code>, <code>into_boxed_slice</code>,  and <code>from_raw_parts</code> don't make sense</li>
</ul>



<a name="253627402"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/219381-t-libs/topic/Upstreaming%20Nintendo%20Switch%20Support/near/253627402" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> leo60228 <a href="https://zulip-archive.rust-lang.org/stream/219381-t-libs/topic/Upstreaming.20Nintendo.20Switch.20Support.html#253627402">(Sep 16 2021 at 18:24)</a>:</h4>
<p>for <code>RawVec</code>:</p>
<ul>
<li><code>with_capacity</code>, <code>with_capacity_zeroed</code>, <code>from_raw_parts</code>, <code>new_in</code>, <code>with_capacity_in</code>, <code>with_capacity_zeroed_in</code>, <code>from_box</code>, <code>into_box</code>, <code>from_raw_parts_in</code>, and <code>allocator</code> should just be moved to <code>HeapRawVec</code></li>
<li>alternatives to <code>ptr</code> that return <code>&amp;[MaybeUninit&lt;T&gt;]</code>/<code>&amp;mut [MaybeUninit&lt;T&gt;]</code> aren't necessary, but with the added complexity might be nice to help catch bugs</li>
</ul>



<a name="253628292"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/219381-t-libs/topic/Upstreaming%20Nintendo%20Switch%20Support/near/253628292" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> The 8472 <a href="https://zulip-archive.rust-lang.org/stream/219381-t-libs/topic/Upstreaming.20Nintendo.20Switch.20Support.html#253628292">(Sep 16 2021 at 18:30)</a>:</h4>
<p>Depends on what you want to happen when the capacity is reached, errors or panics. That's similar to the fallible vec topic.</p>



<a name="253628517"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/219381-t-libs/topic/Upstreaming%20Nintendo%20Switch%20Support/near/253628517" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Mario Carneiro <a href="https://zulip-archive.rust-lang.org/stream/219381-t-libs/topic/Upstreaming.20Nintendo.20Switch.20Support.html#253628517">(Sep 16 2021 at 18:32)</a>:</h4>
<p>If <code>ArrayVec</code> was in std, it would be much better to have errors than panics. Exhaustion of the buffer is exactly the kind of edge case you want end users thinking about, and panics hide the issue</p>



<a name="253629513"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/219381-t-libs/topic/Upstreaming%20Nintendo%20Switch%20Support/near/253629513" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Mario Carneiro <a href="https://zulip-archive.rust-lang.org/stream/219381-t-libs/topic/Upstreaming.20Nintendo.20Switch.20Support.html#253629513">(Sep 16 2021 at 18:38)</a>:</h4>
<p>Well, it doesn't hurt to have both panicking and erroring versions of these methods (I think the <code>arrayvec</code> crate already does this), but in that case I would use a clippy lint to make sure I never call the wrong one, because it's a footgun</p>



<hr><p>Last updated: Apr 12 2022 at 20:01 UTC</p>
</html>