<html>
<head><meta charset="utf-8"><title>Option to write test results summary to a file · t-libs · Zulip Chat Archive</title></head>
<h2>Stream: <a href="https://zulip-archive.rust-lang.org/stream/219381-t-libs/index.html">t-libs</a></h2>
<h3>Topic: <a href="https://zulip-archive.rust-lang.org/stream/219381-t-libs/topic/Option.20to.20write.20test.20results.20summary.20to.20a.20file.html">Option to write test results summary to a file</a></h3>

<hr>

<base href="https://rust-lang.zulipchat.com">

<head><link href="https://zulip-archive.rust-lang.org/style.css" rel="stylesheet"></head>

<a name="254755740"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/219381-t-libs/topic/Option%20to%20write%20test%20results%20summary%20to%20a%20file/near/254755740" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joshua Warner <a href="https://zulip-archive.rust-lang.org/stream/219381-t-libs/topic/Option.20to.20write.20test.20results.20summary.20to.20a.20file.html#254755740">(Sep 24 2021 at 19:04)</a>:</h4>
<p>Hi! I'm not sure this is the right place to start this discussion (please point me in the right direction if not).</p>
<p>We use rust pretty heavily at my company, run tests in CI, etc. We currently use regexes to parse test results from the rust test process's stdout - using (approximately) <code>test (.*) \.\.\. (FAILED|ok|ignored)</code>.</p>
<p>The problem is that for one particular set of tests, stdout is pretty "dirty", in the sense that there's a lot of junk there that sometimes breaks this regex detection. Some of this junk we could clean up, but it's actually a pretty large challenge - because a good chunk of it comes from subprocesses / 3rd-party libraries we don't control.</p>
<p>As a sure-fire upstream fix, if it would be possible to have the test binary accept an optional argument to dump test statuses to a file, in json format (or similar) - that would make it very difficult for that to accidentally be interrupted. e.g. <code>cargo test -- --write-json-results-file=test_results.json</code>. (I'm ambivolent on exact format &amp; option naming)</p>
<p>What would the right way to push something like this forward? Should I go thru the RFC process? Open a github issue?</p>



<a name="254755834"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/219381-t-libs/topic/Option%20to%20write%20test%20results%20summary%20to%20a%20file/near/254755834" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jane Lusby <a href="https://zulip-archive.rust-lang.org/stream/219381-t-libs/topic/Option.20to.20write.20test.20results.20summary.20to.20a.20file.html#254755834">(Sep 24 2021 at 19:04)</a>:</h4>
<p>I think libtest has something similar already available on nightly</p>



<a name="254756037"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/219381-t-libs/topic/Option%20to%20write%20test%20results%20summary%20to%20a%20file/near/254756037" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jane Lusby <a href="https://zulip-archive.rust-lang.org/stream/219381-t-libs/topic/Option.20to.20write.20test.20results.20summary.20to.20a.20file.html#254756037">(Sep 24 2021 at 19:06)</a>:</h4>
<p>gimmi one sec while I lookup how to turn it on</p>



<a name="254756199"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/219381-t-libs/topic/Option%20to%20write%20test%20results%20summary%20to%20a%20file/near/254756199" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jane Lusby <a href="https://zulip-archive.rust-lang.org/stream/219381-t-libs/topic/Option.20to.20write.20test.20results.20summary.20to.20a.20file.html#254756199">(Sep 24 2021 at 19:07)</a>:</h4>
<p>junit</p>



<a name="254756206"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/219381-t-libs/topic/Option%20to%20write%20test%20results%20summary%20to%20a%20file/near/254756206" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jane Lusby <a href="https://zulip-archive.rust-lang.org/stream/219381-t-libs/topic/Option.20to.20write.20test.20results.20summary.20to.20a.20file.html#254756206">(Sep 24 2021 at 19:07)</a>:</h4>
<p>that's the name of the format</p>



<a name="254756346"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/219381-t-libs/topic/Option%20to%20write%20test%20results%20summary%20to%20a%20file/near/254756346" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jane Lusby <a href="https://zulip-archive.rust-lang.org/stream/219381-t-libs/topic/Option.20to.20write.20test.20results.20summary.20to.20a.20file.html#254756346">(Sep 24 2021 at 19:08)</a>:</h4>
<div class="codehilite"><pre><span></span><code>❯ target/debug/deps/wardrobe_db-d1e62c1d2f0d4e7f -Zunstable-options --format junit
&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;&lt;testsuites&gt;&lt;testsuite name=&quot;test&quot; package=&quot;test&quot; id=&quot;0&quot; errors=&quot;0&quot; failures=&quot;0&quot; tests=&quot;7&quot; skipped=&quot;0&quot; &gt;&lt;testcase classname=&quot;item::tests&quot; name=&quot;with_suggestion&quot; time=&quot;0&quot;/&gt;&lt;testcase classname=&quot;item::tests&quot; name=&quot;new_tags&quot; time=&quot;0&quot;/&gt;&lt;testcase classname=&quot;item::tests&quot; name=&quot;new_item&quot; time=&quot;0&quot;/&gt;&lt;testcase classname=&quot;tests&quot; name=&quot;new_item&quot; time=&quot;0&quot;/&gt;&lt;testcase classname=&quot;history::tests&quot; name=&quot;from_reader&quot; time=&quot;0&quot;/&gt;&lt;testcase classname=&quot;tests&quot; name=&quot;new_item_twice&quot; time=&quot;0&quot;/&gt;&lt;testcase classname=&quot;tests&quot; name=&quot;new_outfit&quot; time=&quot;0&quot;/&gt;&lt;system-out/&gt;&lt;system-err/&gt;&lt;/testsuite&gt;&lt;/testsuites&gt;
</code></pre></div>



<a name="254758433"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/219381-t-libs/topic/Option%20to%20write%20test%20results%20summary%20to%20a%20file/near/254758433" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joshua Warner <a href="https://zulip-archive.rust-lang.org/stream/219381-t-libs/topic/Option.20to.20write.20test.20results.20summary.20to.20a.20file.html#254758433">(Sep 24 2021 at 19:23)</a>:</h4>
<p>Oooh nice! Can I have it write that to a file rather than dumping it to stdout?</p>



<a name="254758500"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/219381-t-libs/topic/Option%20to%20write%20test%20results%20summary%20to%20a%20file/near/254758500" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jane Lusby <a href="https://zulip-archive.rust-lang.org/stream/219381-t-libs/topic/Option.20to.20write.20test.20results.20summary.20to.20a.20file.html#254758500">(Sep 24 2021 at 19:23)</a>:</h4>
<p>yes, there's a <code>--logpath</code> option</p>



<a name="254758559"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/219381-t-libs/topic/Option%20to%20write%20test%20results%20summary%20to%20a%20file/near/254758559" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jane Lusby <a href="https://zulip-archive.rust-lang.org/stream/219381-t-libs/topic/Option.20to.20write.20test.20results.20summary.20to.20a.20file.html#254758559">(Sep 24 2021 at 19:24)</a>:</h4>
<p>in general you can run any test binary with <code>--help</code> to see all the extra options available from libtest</p>



<a name="254758693"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/219381-t-libs/topic/Option%20to%20write%20test%20results%20summary%20to%20a%20file/near/254758693" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jane Lusby <a href="https://zulip-archive.rust-lang.org/stream/219381-t-libs/topic/Option.20to.20write.20test.20results.20summary.20to.20a.20file.html#254758693">(Sep 24 2021 at 19:25)</a>:</h4>
<p>actually, im not certain logpath applies here</p>



<a name="254758782"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/219381-t-libs/topic/Option%20to%20write%20test%20results%20summary%20to%20a%20file/near/254758782" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jane Lusby <a href="https://zulip-archive.rust-lang.org/stream/219381-t-libs/topic/Option.20to.20write.20test.20results.20summary.20to.20a.20file.html#254758782">(Sep 24 2021 at 19:26)</a>:</h4>
<p><code>--logfile</code>*</p>



<a name="254758840"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/219381-t-libs/topic/Option%20to%20write%20test%20results%20summary%20to%20a%20file/near/254758840" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jane Lusby <a href="https://zulip-archive.rust-lang.org/stream/219381-t-libs/topic/Option.20to.20write.20test.20results.20summary.20to.20a.20file.html#254758840">(Sep 24 2021 at 19:26)</a>:</h4>
<p>and no, it is not for the junit output</p>



<a name="254771118"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/219381-t-libs/topic/Option%20to%20write%20test%20results%20summary%20to%20a%20file/near/254771118" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joshua Warner <a href="https://zulip-archive.rust-lang.org/stream/219381-t-libs/topic/Option.20to.20write.20test.20results.20summary.20to.20a.20file.html#254771118">(Sep 24 2021 at 20:55)</a>:</h4>
<p>Just tested this myself, and it looks like the <code>--logfile</code> option gives a file of <code>&lt;status&gt; &lt;test_name&gt;</code> - which serves my purposes well enough.</p>



<a name="254771420"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/219381-t-libs/topic/Option%20to%20write%20test%20results%20summary%20to%20a%20file/near/254771420" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joshua Warner <a href="https://zulip-archive.rust-lang.org/stream/219381-t-libs/topic/Option.20to.20write.20test.20results.20summary.20to.20a.20file.html#254771420">(Sep 24 2021 at 20:58)</a>:</h4>
<p>Seems useful to actually be able to write the junit output to a file somewhere, so it doesn't need to be parsed out with regex. Thoughts on either:<br>
(1) making <code>--format junit --logfile=junit.xml</code> print the junit stuff to junit.xml (and not the current <code>&lt;status&gt; &lt;test_name&gt;</code> lines)<br>
(2) adding a new argument for that e.g. <code>--format junit --outputfile=junit.xml</code></p>



<a name="254772430"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/219381-t-libs/topic/Option%20to%20write%20test%20results%20summary%20to%20a%20file/near/254772430" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jane Lusby <a href="https://zulip-archive.rust-lang.org/stream/219381-t-libs/topic/Option.20to.20write.20test.20results.20summary.20to.20a.20file.html#254772430">(Sep 24 2021 at 21:05)</a>:</h4>
<p>I don't think (1) would work because that would potentially change the meaning of <code>--logfile</code> or make it contextual, which seems unideal</p>



<a name="254772448"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/219381-t-libs/topic/Option%20to%20write%20test%20results%20summary%20to%20a%20file/near/254772448" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jane Lusby <a href="https://zulip-archive.rust-lang.org/stream/219381-t-libs/topic/Option.20to.20write.20test.20results.20summary.20to.20a.20file.html#254772448">(Sep 24 2021 at 21:05)</a>:</h4>
<p>(2) seems reasonable</p>



<a name="254772488"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/219381-t-libs/topic/Option%20to%20write%20test%20results%20summary%20to%20a%20file/near/254772488" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jane Lusby <a href="https://zulip-archive.rust-lang.org/stream/219381-t-libs/topic/Option.20to.20write.20test.20results.20summary.20to.20a.20file.html#254772488">(Sep 24 2021 at 21:05)</a>:</h4>
<p>though when running tests you often have many test binaries</p>



<a name="254772577"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/219381-t-libs/topic/Option%20to%20write%20test%20results%20summary%20to%20a%20file/near/254772577" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jane Lusby <a href="https://zulip-archive.rust-lang.org/stream/219381-t-libs/topic/Option.20to.20write.20test.20results.20summary.20to.20a.20file.html#254772577">(Sep 24 2021 at 21:06)</a>:</h4>
<p>so I'd want to be careful to come up with a solution that doesn't default to causing different tests to overwrite each other's output</p>



<a name="254772702"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/219381-t-libs/topic/Option%20to%20write%20test%20results%20summary%20to%20a%20file/near/254772702" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jane Lusby <a href="https://zulip-archive.rust-lang.org/stream/219381-t-libs/topic/Option.20to.20write.20test.20results.20summary.20to.20a.20file.html#254772702">(Sep 24 2021 at 21:07)</a>:</h4>
<div class="codehilite"><pre><span></span><code>❯ cargo test -- -Zunstable-options --format junit
    Finished test [unoptimized + debuginfo] target(s) in 0.02s
     Running unittests (target/debug/deps/wardrobe_db-d1e62c1d2f0d4e7f)
&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;&lt;testsuites&gt;&lt;testsuite name=&quot;test&quot; package=&quot;test&quot; id=&quot;0&quot; errors=&quot;0&quot; failures=&quot;0&quot; tests=&quot;7&quot; skipped=&quot;0&quot; &gt;&lt;testcase classname=&quot;item::tests&quot; name=&quot;new_item&quot; time=&quot;0&quot;/&gt;&lt;testcase classname=&quot;item::tests&quot; name=&quot;new_tags&quot; time=&quot;0&quot;/&gt;&lt;testcase classname=&quot;item::tests&quot; name=&quot;with_suggestion&quot; time=&quot;0&quot;/&gt;&lt;testcase classname=&quot;tests&quot; name=&quot;new_item&quot; time=&quot;0&quot;/&gt;&lt;testcase classname=&quot;history::tests&quot; name=&quot;from_reader&quot; time=&quot;0&quot;/&gt;&lt;testcase classname=&quot;tests&quot; name=&quot;new_item_twice&quot; time=&quot;0&quot;/&gt;&lt;testcase classname=&quot;tests&quot; name=&quot;new_outfit&quot; time=&quot;0&quot;/&gt;&lt;system-out/&gt;&lt;system-err/&gt;&lt;/testsuite&gt;&lt;/testsuites&gt;     Running unittests (target/debug/deps/wardrobe_db-296b264a815fb112)
&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;&lt;testsuites&gt;&lt;testsuite name=&quot;test&quot; package=&quot;test&quot; id=&quot;0&quot; errors=&quot;0&quot; failures=&quot;0&quot; tests=&quot;0&quot; skipped=&quot;0&quot; &gt;&lt;system-out/&gt;&lt;system-err/&gt;&lt;/testsuite&gt;&lt;/testsuites&gt;   Doc-tests wardrobe-db
&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;&lt;testsuites&gt;&lt;testsuite name=&quot;test&quot; package=&quot;test&quot; id=&quot;0&quot; errors=&quot;0&quot; failures=&quot;0&quot; tests=&quot;0&quot; skipped=&quot;0&quot; &gt;&lt;system-out/&gt;&lt;system-err/&gt;&lt;/testsuite&gt;&lt;/testsuites&gt;
</code></pre></div>



<a name="254772792"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/219381-t-libs/topic/Option%20to%20write%20test%20results%20summary%20to%20a%20file/near/254772792" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jane Lusby <a href="https://zulip-archive.rust-lang.org/stream/219381-t-libs/topic/Option.20to.20write.20test.20results.20summary.20to.20a.20file.html#254772792">(Sep 24 2021 at 21:08)</a>:</h4>
<p>its clearly already a bit broken at the moment when run via cargo</p>



<a name="254772857"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/219381-t-libs/topic/Option%20to%20write%20test%20results%20summary%20to%20a%20file/near/254772857" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jane Lusby <a href="https://zulip-archive.rust-lang.org/stream/219381-t-libs/topic/Option.20to.20write.20test.20results.20summary.20to.20a.20file.html#254772857">(Sep 24 2021 at 21:08)</a>:</h4>
<p>we might want some sort of placeholder syntax for including the test binary name or something</p>



<a name="254772933"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/219381-t-libs/topic/Option%20to%20write%20test%20results%20summary%20to%20a%20file/near/254772933" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jane Lusby <a href="https://zulip-archive.rust-lang.org/stream/219381-t-libs/topic/Option.20to.20write.20test.20results.20summary.20to.20a.20file.html#254772933">(Sep 24 2021 at 21:09)</a>:</h4>
<p>like <code>cargo test -- -Zunstable-options --format junit --output-file=junit-{}.xml</code></p>



<a name="254772960"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/219381-t-libs/topic/Option%20to%20write%20test%20results%20summary%20to%20a%20file/near/254772960" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jane Lusby <a href="https://zulip-archive.rust-lang.org/stream/219381-t-libs/topic/Option.20to.20write.20test.20results.20summary.20to.20a.20file.html#254772960">(Sep 24 2021 at 21:10)</a>:</h4>
<p>where if you don't provide a place for it to include the disambiguator in each path it will error out</p>



<a name="254773302"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/219381-t-libs/topic/Option%20to%20write%20test%20results%20summary%20to%20a%20file/near/254773302" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nagisa <a href="https://zulip-archive.rust-lang.org/stream/219381-t-libs/topic/Option.20to.20write.20test.20results.20summary.20to.20a.20file.html#254773302">(Sep 24 2021 at 21:12)</a>:</h4>
<p>This is not the only instance where more flexibility around multiple test binaries would help. Other things that come to mind are coverage, running test suites in parallel, etc.</p>



<a name="254773354"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/219381-t-libs/topic/Option%20to%20write%20test%20results%20summary%20to%20a%20file/near/254773354" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nagisa <a href="https://zulip-archive.rust-lang.org/stream/219381-t-libs/topic/Option.20to.20write.20test.20results.20summary.20to.20a.20file.html#254773354">(Sep 24 2021 at 21:13)</a>:</h4>
<p>I've been just getting plans out of cargo and running things myself to facilitate these kinds of things, personally.</p>



<a name="254775979"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/219381-t-libs/topic/Option%20to%20write%20test%20results%20summary%20to%20a%20file/near/254775979" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jane Lusby <a href="https://zulip-archive.rust-lang.org/stream/219381-t-libs/topic/Option.20to.20write.20test.20results.20summary.20to.20a.20file.html#254775979">(Sep 24 2021 at 21:33)</a>:</h4>
<p><span class="user-mention" data-user-id="317636">@Joshua Warner</span> looks like we already have a wrapper around output location though both variant's currently go to stdout</p>



<a name="254775990"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/219381-t-libs/topic/Option%20to%20write%20test%20results%20summary%20to%20a%20file/near/254775990" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jane Lusby <a href="https://zulip-archive.rust-lang.org/stream/219381-t-libs/topic/Option.20to.20write.20test.20results.20summary.20to.20a.20file.html#254775990">(Sep 24 2021 at 21:33)</a>:</h4>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="sd">/// Generic wrapper over stdout.</span>
<span class="k">pub</span><span class="w"> </span><span class="k">enum</span> <span class="nc">OutputLocation</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="n">Pretty</span><span class="p">(</span><span class="nb">Box</span><span class="o">&lt;</span><span class="n">term</span>::<span class="n">StdoutTerminal</span><span class="o">&gt;</span><span class="p">),</span><span class="w"></span>
<span class="w">    </span><span class="n">Raw</span><span class="p">(</span><span class="n">T</span><span class="p">),</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>
</code></pre></div>



<a name="254776023"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/219381-t-libs/topic/Option%20to%20write%20test%20results%20summary%20to%20a%20file/near/254776023" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jane Lusby <a href="https://zulip-archive.rust-lang.org/stream/219381-t-libs/topic/Option.20to.20write.20test.20results.20summary.20to.20a.20file.html#254776023">(Sep 24 2021 at 21:33)</a>:</h4>
<p>but I'm guessing it wouldn't be very difficult to add a 3rd option for outputting to a logfile</p>



<a name="254776063"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/219381-t-libs/topic/Option%20to%20write%20test%20results%20summary%20to%20a%20file/near/254776063" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jane Lusby <a href="https://zulip-archive.rust-lang.org/stream/219381-t-libs/topic/Option.20to.20write.20test.20results.20summary.20to.20a.20file.html#254776063">(Sep 24 2021 at 21:33)</a>:</h4>
<p>though I haven't touched this code much before</p>



<a name="254776153"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/219381-t-libs/topic/Option%20to%20write%20test%20results%20summary%20to%20a%20file/near/254776153" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jane Lusby <a href="https://zulip-archive.rust-lang.org/stream/219381-t-libs/topic/Option.20to.20write.20test.20results.20summary.20to.20a.20file.html#254776153">(Sep 24 2021 at 21:34)</a>:</h4>
<p>either way if you end up adding a <code>--output-file</code> option lmk and add me as a reviewer on the PR</p>



<a name="254777863"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/219381-t-libs/topic/Option%20to%20write%20test%20results%20summary%20to%20a%20file/near/254777863" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jane Lusby <a href="https://zulip-archive.rust-lang.org/stream/219381-t-libs/topic/Option.20to.20write.20test.20results.20summary.20to.20a.20file.html#254777863">(Sep 24 2021 at 21:49)</a>:</h4>
<p>did a quick PR to fix the newline situation with junit <a href="https://github.com/rust-lang/rust/pull/89235">https://github.com/rust-lang/rust/pull/89235</a></p>



<a name="254777900"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/219381-t-libs/topic/Option%20to%20write%20test%20results%20summary%20to%20a%20file/near/254777900" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jane Lusby <a href="https://zulip-archive.rust-lang.org/stream/219381-t-libs/topic/Option.20to.20write.20test.20results.20summary.20to.20a.20file.html#254777900">(Sep 24 2021 at 21:49)</a>:</h4>
<p>should point you towards the files you'd need to edit in your own PR to add the <code>--output-file</code> option</p>



<a name="254781737"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/219381-t-libs/topic/Option%20to%20write%20test%20results%20summary%20to%20a%20file/near/254781737" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joshua Warner <a href="https://zulip-archive.rust-lang.org/stream/219381-t-libs/topic/Option.20to.20write.20test.20results.20summary.20to.20a.20file.html#254781737">(Sep 24 2021 at 22:24)</a>:</h4>
<blockquote>
<p>did a quick PR to fix the newline situation with junit <a href="https://github.com/rust-lang/rust/pull/89235">https://github.com/rust-lang/rust/pull/89235</a></p>
</blockquote>
<p>Nice!</p>
<blockquote>
<p>we might want some sort of placeholder syntax for including the test binary name or something</p>
</blockquote>
<p>FWIW, we actually don't use cargo in CI (we use bazel), so I don't think the "multiple test binaries might accidentally overwrite the output of the results" thing is a problem. We have our own (python) test-runner that's responsible for running all the tests - so it shouldn't be too hard to make this work without any such placeholders. Agreed it would be problematic for anyone using cargo tho. Maybe that could be a later feature?</p>



<a name="254781956"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/219381-t-libs/topic/Option%20to%20write%20test%20results%20summary%20to%20a%20file/near/254781956" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jane Lusby <a href="https://zulip-archive.rust-lang.org/stream/219381-t-libs/topic/Option.20to.20write.20test.20results.20summary.20to.20a.20file.html#254781956">(Sep 24 2021 at 22:27)</a>:</h4>
<p>as long as the flag is gated behind <code>-Zunstable-options</code> that should be fine <span class="user-mention" data-user-id="317636">@Joshua Warner</span></p>



<a name="254788538"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/219381-t-libs/topic/Option%20to%20write%20test%20results%20summary%20to%20a%20file/near/254788538" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> The 8472 <a href="https://zulip-archive.rust-lang.org/stream/219381-t-libs/topic/Option.20to.20write.20test.20results.20summary.20to.20a.20file.html#254788538">(Sep 24 2021 at 23:44)</a>:</h4>
<blockquote>
<p>its clearly already a bit broken at the moment when run via cargo</p>
</blockquote>
<p>Are you sure that's not mixing stderr and stdout?</p>



<a name="254789724"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/219381-t-libs/topic/Option%20to%20write%20test%20results%20summary%20to%20a%20file/near/254789724" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jane Lusby <a href="https://zulip-archive.rust-lang.org/stream/219381-t-libs/topic/Option.20to.20write.20test.20results.20summary.20to.20a.20file.html#254789724">(Sep 24 2021 at 23:58)</a>:</h4>
<p>It does mix stderr and stdout but it's not doing so the same way as the other formatter</p>



<a name="254789755"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/219381-t-libs/topic/Option%20to%20write%20test%20results%20summary%20to%20a%20file/near/254789755" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jane Lusby <a href="https://zulip-archive.rust-lang.org/stream/219381-t-libs/topic/Option.20to.20write.20test.20results.20summary.20to.20a.20file.html#254789755">(Sep 24 2021 at 23:59)</a>:</h4>
<p>In both cases the output from libtest goes to stdout and the output from cargo goes to stderr</p>



<a name="254789770"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/219381-t-libs/topic/Option%20to%20write%20test%20results%20summary%20to%20a%20file/near/254789770" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jane Lusby <a href="https://zulip-archive.rust-lang.org/stream/219381-t-libs/topic/Option.20to.20write.20test.20results.20summary.20to.20a.20file.html#254789770">(Sep 24 2021 at 23:59)</a>:</h4>
<p>But for the pretty formatter there are extra new lines inserted before and after every test results so when they're interleaved it looks nice</p>



<a name="254789794"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/219381-t-libs/topic/Option%20to%20write%20test%20results%20summary%20to%20a%20file/near/254789794" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jane Lusby <a href="https://zulip-archive.rust-lang.org/stream/219381-t-libs/topic/Option.20to.20write.20test.20results.20summary.20to.20a.20file.html#254789794">(Sep 24 2021 at 23:59)</a>:</h4>
<p>So in both cases you can just redirect stdout</p>



<a name="254789805"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/219381-t-libs/topic/Option%20to%20write%20test%20results%20summary%20to%20a%20file/near/254789805" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jane Lusby <a href="https://zulip-archive.rust-lang.org/stream/219381-t-libs/topic/Option.20to.20write.20test.20results.20summary.20to.20a.20file.html#254789805">(Sep 24 2021 at 23:59)</a>:</h4>
<p>And get something that looks good because it keeps them from mixing</p>



<a name="254789936"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/219381-t-libs/topic/Option%20to%20write%20test%20results%20summary%20to%20a%20file/near/254789936" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jane Lusby <a href="https://zulip-archive.rust-lang.org/stream/219381-t-libs/topic/Option.20to.20write.20test.20results.20summary.20to.20a.20file.html#254789936">(Sep 25 2021 at 00:00)</a>:</h4>
<p>But if your last line of output in stderr doesn't end in a new line the next line of output from cargo will be appended to the end of your last line</p>



<a name="254789977"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/219381-t-libs/topic/Option%20to%20write%20test%20results%20summary%20to%20a%20file/near/254789977" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jane Lusby <a href="https://zulip-archive.rust-lang.org/stream/219381-t-libs/topic/Option.20to.20write.20test.20results.20summary.20to.20a.20file.html#254789977">(Sep 25 2021 at 00:01)</a>:</h4>
<p>That seems like a good justification for putting a unconditional new line after all the formatter outputs regardless of which formatter is being used and then just removing one new line from the end of each of the outputs to make it consistent still</p>



<hr><p>Last updated: Apr 12 2022 at 20:01 UTC</p>
</html>