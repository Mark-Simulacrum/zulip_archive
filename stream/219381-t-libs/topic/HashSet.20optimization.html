<html>
<head><meta charset="utf-8"><title>HashSet optimization · t-libs · Zulip Chat Archive</title></head>
<h2>Stream: <a href="https://zulip-archive.rust-lang.org/stream/219381-t-libs/index.html">t-libs</a></h2>
<h3>Topic: <a href="https://zulip-archive.rust-lang.org/stream/219381-t-libs/topic/HashSet.20optimization.html">HashSet optimization</a></h3>

<hr>

<base href="https://rust-lang.zulipchat.com">

<head><link href="https://zulip-archive.rust-lang.org/style.css" rel="stylesheet"></head>

<a name="263066575"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/219381-t-libs/topic/HashSet%20optimization/near/263066575" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> The 8472 <a href="https://zulip-archive.rust-lang.org/stream/219381-t-libs/topic/HashSet.20optimization.html#263066575">(Nov 29 2021 at 20:55)</a>:</h4>
<p>If I want to add a specialization to <code>HashSet</code>, should that go into hashbrown or std?</p>



<a name="263066716"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/219381-t-libs/topic/HashSet%20optimization/near/263066716" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> The 8472 <a href="https://zulip-archive.rust-lang.org/stream/219381-t-libs/topic/HashSet.20optimization.html#263066716">(Nov 29 2021 at 20:56)</a>:</h4>
<p>The <code>Extend</code> implementation specifically, std has a wrapper for that and it would be possible to implement it there</p>



<a name="263174670"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/219381-t-libs/topic/HashSet%20optimization/near/263174670" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Amanieu <a href="https://zulip-archive.rust-lang.org/stream/219381-t-libs/topic/HashSet.20optimization.html#263174670">(Nov 30 2021 at 17:00)</a>:</h4>
<p>What kind of specialization do you have in mind?</p>



<a name="263174966"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/219381-t-libs/topic/HashSet%20optimization/near/263174966" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Amanieu <a href="https://zulip-archive.rust-lang.org/stream/219381-t-libs/topic/HashSet.20optimization.html#263174966">(Nov 30 2021 at 17:01)</a>:</h4>
<p>I would prefer having the specialization in hashbrown so that hashbrown users can also benefit from it.</p>



<a name="263175212"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/219381-t-libs/topic/HashSet%20optimization/near/263175212" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> The 8472 <a href="https://zulip-archive.rust-lang.org/stream/219381-t-libs/topic/HashSet.20optimization.html#263175212">(Nov 30 2021 at 17:02)</a>:</h4>
<p>Avoiding unnecessary clones when collecting a <code>std::iter::Cloned</code> iterator into a set. Hash, lookup raw entry and only clone when it's vacant.</p>



<a name="263175903"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/219381-t-libs/topic/HashSet%20optimization/near/263175903" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> The 8472 <a href="https://zulip-archive.rust-lang.org/stream/219381-t-libs/topic/HashSet.20optimization.html#263175903">(Nov 30 2021 at 17:06)</a>:</h4>
<p>But that'll need some way to get the inner iterator out of the <code>Cloned</code> struct. If I were to make the modification in std then I'd just put it under an <code>std_internals</code> feature in <code>core</code>.</p>



<a name="263177379"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/219381-t-libs/topic/HashSet%20optimization/near/263177379" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Amanieu <a href="https://zulip-archive.rust-lang.org/stream/219381-t-libs/topic/HashSet.20optimization.html#263177379">(Nov 30 2021 at 17:16)</a>:</h4>
<p>I guess it has to be in <code>std</code> then.</p>



<a name="263177453"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/219381-t-libs/topic/HashSet%20optimization/near/263177453" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Amanieu <a href="https://zulip-archive.rust-lang.org/stream/219381-t-libs/topic/HashSet.20optimization.html#263177453">(Nov 30 2021 at 17:17)</a>:</h4>
<p>Is there a particular reason you are looking to implement this optimization? Did this come up as a performance issue in some code you are working on?</p>



<a name="263177620"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/219381-t-libs/topic/HashSet%20optimization/near/263177620" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> The 8472 <a href="https://zulip-archive.rust-lang.org/stream/219381-t-libs/topic/HashSet.20optimization.html#263177620">(Nov 30 2021 at 17:18)</a>:</h4>
<p>I could have used it in rustc when optimizing something else but did it manually with hashmap&lt;T, ()&gt; and raw entries instead.</p>



<hr><p>Last updated: Apr 12 2022 at 20:01 UTC</p>
</html>