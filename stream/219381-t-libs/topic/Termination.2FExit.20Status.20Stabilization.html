<html>
<head><meta charset="utf-8"><title>Termination/Exit Status Stabilization · t-libs · Zulip Chat Archive</title></head>
<h2>Stream: <a href="https://zulip-archive.rust-lang.org/stream/219381-t-libs/index.html">t-libs</a></h2>
<h3>Topic: <a href="https://zulip-archive.rust-lang.org/stream/219381-t-libs/topic/Termination.2FExit.20Status.20Stabilization.html">Termination/Exit Status Stabilization</a></h3>

<hr>

<base href="https://rust-lang.zulipchat.com">

<head><link href="https://zulip-archive.rust-lang.org/style.css" rel="stylesheet"></head>

<a name="227660898"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/219381-t-libs/topic/Termination/Exit%20Status%20Stabilization/near/227660898" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jakub Duchniewicz <a href="https://zulip-archive.rust-lang.org/stream/219381-t-libs/topic/Termination.2FExit.20Status.20Stabilization.html#227660898">(Feb 24 2021 at 19:53)</a>:</h4>
<p>Hi, the <a class="stream" data-stream-id="257204" href="/#narrow/stream/257204-project-error-handling">#project-error-handling</a> is currently polishing the rough edges of the <code>Termination</code> trait and also looking at ways <code>ExitCode</code>s can interact with it. For now, we are waiting for <a href="https://github.com/rust-lang/rfcs/pull/2895">Generic Member Access</a> to implement reporting <code>Error</code>s at the termination (apart from the <code>ExitCode</code>). The question is, how to approach this implementation from the official way? There is an <a href="https://github.com/rust-lang/rust/issues/43301">RFC</a> for tracking the <code>Termination</code> trait stabilization - so we could just add the implementation to the GMA PR.</p>



<a name="227661104"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/219381-t-libs/topic/Termination/Exit%20Status%20Stabilization/near/227661104" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jakub Duchniewicz <a href="https://zulip-archive.rust-lang.org/stream/219381-t-libs/topic/Termination.2FExit.20Status.20Stabilization.html#227661104">(Feb 24 2021 at 19:55)</a>:</h4>
<p>For now the idea around <code>ExitCode</code>s is to return an arbitrary numeric value (which can be then used by the user to interpret it).</p>



<a name="227674196"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/219381-t-libs/topic/Termination/Exit%20Status%20Stabilization/near/227674196" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> scottmcm <a href="https://zulip-archive.rust-lang.org/stream/219381-t-libs/topic/Termination.2FExit.20Status.20Stabilization.html#227674196">(Feb 24 2021 at 21:16)</a>:</h4>
<p>Yay!  Exciting that <code>ExitCode</code> is finally getting some love.</p>



<a name="227677506"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/219381-t-libs/topic/Termination/Exit%20Status%20Stabilization/near/227677506" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jane Lusby <a href="https://zulip-archive.rust-lang.org/stream/219381-t-libs/topic/Termination.2FExit.20Status.20Stabilization.html#227677506">(Feb 24 2021 at 21:38)</a>:</h4>
<p>:D</p>



<a name="228123702"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/219381-t-libs/topic/Termination/Exit%20Status%20Stabilization/near/228123702" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jakub Duchniewicz <a href="https://zulip-archive.rust-lang.org/stream/219381-t-libs/topic/Termination.2FExit.20Status.20Stabilization.html#228123702">(Feb 28 2021 at 11:10)</a>:</h4>
<p><span class="user-mention" data-user-id="204346">@Ashley Mannix</span> could you help us come up with  a proper way of including our improvements and stabilizing it?</p>



<a name="230044828"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/219381-t-libs/topic/Termination/Exit%20Status%20Stabilization/near/230044828" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jakub Duchniewicz <a href="https://zulip-archive.rust-lang.org/stream/219381-t-libs/topic/Termination.2FExit.20Status.20Stabilization.html#230044828">(Mar 12 2021 at 15:13)</a>:</h4>
<p>I am currently working on tying the <code>Termination</code> with printing 'ExitCode's on program exit. I read various documents like <a href="https://internals.rust-lang.org/t/mini-pre-rfc-redesigning-process-exitstatus/5426/15">pre-RFC</a> or <a href="https://github.com/rust-lang/project-error-handling/issues/7">this issue</a>. <br>
I like the existing pre-RFC simplicity, but I am afraid it is not enough and it may require much maintenance to sustain the proper error codes if some changes occur in the operating systems (especially other than the holy trio Windows/Unix/MacOs). I am curious about your ideas on this topic? Generally <a href="https://github.com/rust-lang/project-error-handling/issues/22#issuecomment-738270096">this comment</a> is a good proposition of how may this look. There seemed to be more interest on the topic in the past, but now it seems to be stagnant <span aria-label="frown" class="emoji emoji-1f641" role="img" title="frown">:frown:</span></p>



<a name="230067208"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/219381-t-libs/topic/Termination/Exit%20Status%20Stabilization/near/230067208" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Triplett <a href="https://zulip-archive.rust-lang.org/stream/219381-t-libs/topic/Termination.2FExit.20Status.20Stabilization.html#230067208">(Mar 12 2021 at 17:25)</a>:</h4>
<p>I don't think we should be printing the exit code, just using it as the process exit code.</p>



<a name="230073771"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/219381-t-libs/topic/Termination/Exit%20Status%20Stabilization/near/230073771" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jakub Duchniewicz <a href="https://zulip-archive.rust-lang.org/stream/219381-t-libs/topic/Termination.2FExit.20Status.20Stabilization.html#230073771">(Mar 12 2021 at 18:09)</a>:</h4>
<p>Right, so just returning and no printing. The errors should be printed upon exiting the process though, am I right?</p>



<a name="230074229"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/219381-t-libs/topic/Termination/Exit%20Status%20Stabilization/near/230074229" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Steven Fackler <a href="https://zulip-archive.rust-lang.org/stream/219381-t-libs/topic/Termination.2FExit.20Status.20Stabilization.html#230074229">(Mar 12 2021 at 18:13)</a>:</h4>
<p>that's a decision made by the process running the program</p>



<a name="230074272"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/219381-t-libs/topic/Termination/Exit%20Status%20Stabilization/near/230074272" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Steven Fackler <a href="https://zulip-archive.rust-lang.org/stream/219381-t-libs/topic/Termination.2FExit.20Status.20Stabilization.html#230074272">(Mar 12 2021 at 18:13)</a>:</h4>
<p>if it's bash, it'll by default print if the process exited due to a signal, but a bare exit status is also available</p>



<a name="230079232"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/219381-t-libs/topic/Termination/Exit%20Status%20Stabilization/near/230079232" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Triplett <a href="https://zulip-archive.rust-lang.org/stream/219381-t-libs/topic/Termination.2FExit.20Status.20Stabilization.html#230079232">(Mar 12 2021 at 18:50)</a>:</h4>
<p><span class="user-mention" data-user-id="344196">@Jakub Duchniewicz</span> Do you mean the Error part of a Result?</p>



<a name="230079241"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/219381-t-libs/topic/Termination/Exit%20Status%20Stabilization/near/230079241" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Triplett <a href="https://zulip-archive.rust-lang.org/stream/219381-t-libs/topic/Termination.2FExit.20Status.20Stabilization.html#230079241">(Mar 12 2021 at 18:50)</a>:</h4>
<p>That should be printed, as it currently is.</p>



<a name="230079323"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/219381-t-libs/topic/Termination/Exit%20Status%20Stabilization/near/230079323" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jakub Duchniewicz <a href="https://zulip-archive.rust-lang.org/stream/219381-t-libs/topic/Termination.2FExit.20Status.20Stabilization.html#230079323">(Mar 12 2021 at 18:51)</a>:</h4>
<p>Yes</p>



<a name="230079550"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/219381-t-libs/topic/Termination/Exit%20Status%20Stabilization/near/230079550" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Triplett <a href="https://zulip-archive.rust-lang.org/stream/219381-t-libs/topic/Termination.2FExit.20Status.20Stabilization.html#230079550">(Mar 12 2021 at 18:52)</a>:</h4>
<p>It's purely ExitCode that shouldn't be printed; that should only be returned.</p>



<a name="230079665"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/219381-t-libs/topic/Termination/Exit%20Status%20Stabilization/near/230079665" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jakub Duchniewicz <a href="https://zulip-archive.rust-lang.org/stream/219381-t-libs/topic/Termination.2FExit.20Status.20Stabilization.html#230079665">(Mar 12 2021 at 18:53)</a>:</h4>
<p>This part is quite unambiguous, but I would like to gather some opinions on having more <code>ExitCode</code>s and having them mapped to OS codes</p>



<a name="230082121"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/219381-t-libs/topic/Termination/Exit%20Status%20Stabilization/near/230082121" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Triplett <a href="https://zulip-archive.rust-lang.org/stream/219381-t-libs/topic/Termination.2FExit.20Status.20Stabilization.html#230082121">(Mar 12 2021 at 19:10)</a>:</h4>
<p>If <code>ExitCode</code> is going to be useful for this purpose, I don't think we should attempt to set any semantics other than "0 is success, non-zero is failure, provide any non-zero value you like".</p>



<a name="230082173"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/219381-t-libs/topic/Termination/Exit%20Status%20Stabilization/near/230082173" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Triplett <a href="https://zulip-archive.rust-lang.org/stream/219381-t-libs/topic/Termination.2FExit.20Status.20Stabilization.html#230082173">(Mar 12 2021 at 19:10)</a>:</h4>
<p>People may need to implement an arbitrary exit-code convention.</p>



<a name="230122119"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/219381-t-libs/topic/Termination/Exit%20Status%20Stabilization/near/230122119" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> scottmcm <a href="https://zulip-archive.rust-lang.org/stream/219381-t-libs/topic/Termination.2FExit.20Status.20Stabilization.html#230122119">(Mar 13 2021 at 00:56)</a>:</h4>
<p>Things like constants for the <code>sysexits.h</code> ones seem plausible, but I agree that people will need arbitrary ones.</p>
<p>Even just being able to <code>return ExitCode(2)</code> from <code>main</code> instead of needing to call <code>exit</code> (and bypass drops) would be nice.</p>



<a name="230122198"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/219381-t-libs/topic/Termination/Exit%20Status%20Stabilization/near/230122198" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jane Lusby <a href="https://zulip-archive.rust-lang.org/stream/219381-t-libs/topic/Termination.2FExit.20Status.20Stabilization.html#230122198">(Mar 13 2021 at 00:58)</a>:</h4>
<p>I think we should separate the os mappings issue from the rest of <code>Termination</code> stabilization</p>



<a name="230122226"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/219381-t-libs/topic/Termination/Exit%20Status%20Stabilization/near/230122226" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jane Lusby <a href="https://zulip-archive.rust-lang.org/stream/219381-t-libs/topic/Termination.2FExit.20Status.20Stabilization.html#230122226">(Mar 13 2021 at 00:59)</a>:</h4>
<p>like everyone else said, just being able to provide a specific exit code for a graceful exit is probably enough for most people's use cases, and until someone makes a proposal for mappings and constants they should be able to make a 3rd party crate that provides those same mappings</p>



<a name="230122400"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/219381-t-libs/topic/Termination/Exit%20Status%20Stabilization/near/230122400" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jane Lusby <a href="https://zulip-archive.rust-lang.org/stream/219381-t-libs/topic/Termination.2FExit.20Status.20Stabilization.html#230122400">(Mar 13 2021 at 01:01)</a>:</h4>
<p>my expectation is that we will just want to add a constructor for <code>ExitStatus</code> from arbitrary integers, and then we can leave the specialization with exit code extraction as part of the generic member access rfc for errors</p>



<a name="230187118"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/219381-t-libs/topic/Termination/Exit%20Status%20Stabilization/near/230187118" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> scottmcm <a href="https://zulip-archive.rust-lang.org/stream/219381-t-libs/topic/Termination.2FExit.20Status.20Stabilization.html#230187118">(Mar 13 2021 at 20:33)</a>:</h4>
<p>IIRC one of the questions for it last time was what type(s) it should use.  Since <code>exit</code> takes <code>int</code>, but <code>WEXITSTATUS</code> only gives the bottom 8 bits of that, but <a href="https://docs.microsoft.com/en-us/windows/win32/api/processthreadsapi/nf-processthreadsapi-getexitcodeprocess">Windows preserves a whole <code>DWORD</code> (<code>u32</code>)</a>.</p>



<a name="230187649"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/219381-t-libs/topic/Termination/Exit%20Status%20Stabilization/near/230187649" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jakub Duchniewicz <a href="https://zulip-archive.rust-lang.org/stream/219381-t-libs/topic/Termination.2FExit.20Status.20Stabilization.html#230187649">(Mar 13 2021 at 20:43)</a>:</h4>
<p>Yes, this is one of the issues with choosing a proper implementation</p>



<a name="230527285"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/219381-t-libs/topic/Termination/Exit%20Status%20Stabilization/near/230527285" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jakub Duchniewicz <a href="https://zulip-archive.rust-lang.org/stream/219381-t-libs/topic/Termination.2FExit.20Status.20Stabilization.html#230527285">(Mar 16 2021 at 15:00)</a>:</h4>
<p>So the small draft of changes in scope is <a href="https://gist.github.com/JDuchniewicz/c326357c0d0a0b0e4c89b44dd1e28d19">here</a>. The remaining question is what should be the underlying value of <code>ExitCode</code> since Termination returns <code>i32</code> which is later translated to <code>isize</code> in <code>start</code> function</p>



<a name="230527582"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/219381-t-libs/topic/Termination/Exit%20Status%20Stabilization/near/230527582" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jakub Duchniewicz <a href="https://zulip-archive.rust-lang.org/stream/219381-t-libs/topic/Termination.2FExit.20Status.20Stabilization.html#230527582">(Mar 16 2021 at 15:01)</a>:</h4>
<p>Probably <span class="user-mention" data-user-id="125270">@scottmcm</span> would know more about this topic and why it is <code>not isize</code> in the first place</p>



<a name="230527698"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/219381-t-libs/topic/Termination/Exit%20Status%20Stabilization/near/230527698" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Connor Horman <a href="https://zulip-archive.rust-lang.org/stream/219381-t-libs/topic/Termination.2FExit.20Status.20Stabilization.html#230527698">(Mar 16 2021 at 15:02)</a>:</h4>
<p>Is there a reason it's translated to isize?</p>



<a name="230527869"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/219381-t-libs/topic/Termination/Exit%20Status%20Stabilization/near/230527869" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Connor Horman <a href="https://zulip-archive.rust-lang.org/stream/219381-t-libs/topic/Termination.2FExit.20Status.20Stabilization.html#230527869">(Mar 16 2021 at 15:02)</a>:</h4>
<p>Exit codes are typically <code>int</code>s which generally equates to <code>i32</code>.</p>



<a name="230528006"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/219381-t-libs/topic/Termination/Exit%20Status%20Stabilization/near/230528006" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Connor Horman <a href="https://zulip-archive.rust-lang.org/stream/219381-t-libs/topic/Termination.2FExit.20Status.20Stabilization.html#230528006">(Mar 16 2021 at 15:03)</a>:</h4>
<p>(Which, yes, are used in different ways depending on the platform)</p>



<a name="230528586"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/219381-t-libs/topic/Termination/Exit%20Status%20Stabilization/near/230528586" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jakub Duchniewicz <a href="https://zulip-archive.rust-lang.org/stream/219381-t-libs/topic/Termination.2FExit.20Status.20Stabilization.html#230528586">(Mar 16 2021 at 15:06)</a>:</h4>
<p>that why it is even more interesting why they were set to <code>u8</code> in the first place</p>



<a name="230528674"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/219381-t-libs/topic/Termination/Exit%20Status%20Stabilization/near/230528674" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jakub Duchniewicz <a href="https://zulip-archive.rust-lang.org/stream/219381-t-libs/topic/Termination.2FExit.20Status.20Stabilization.html#230528674">(Mar 16 2021 at 15:07)</a>:</h4>
<p>probably because unices use only 255  of exit codes?</p>



<a name="230528697"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/219381-t-libs/topic/Termination/Exit%20Status%20Stabilization/near/230528697" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jakub Duchniewicz <a href="https://zulip-archive.rust-lang.org/stream/219381-t-libs/topic/Termination.2FExit.20Status.20Stabilization.html#230528697">(Mar 16 2021 at 15:07)</a>:</h4>
<p>but I doubt it</p>



<a name="230538323"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/219381-t-libs/topic/Termination/Exit%20Status%20Stabilization/near/230538323" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Triplett <a href="https://zulip-archive.rust-lang.org/stream/219381-t-libs/topic/Termination.2FExit.20Status.20Stabilization.html#230538323">(Mar 16 2021 at 15:58)</a>:</h4>
<p>That seems like a likely explanation, honestly.</p>



<a name="230538416"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/219381-t-libs/topic/Termination/Exit%20Status%20Stabilization/near/230538416" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Triplett <a href="https://zulip-archive.rust-lang.org/stream/219381-t-libs/topic/Termination.2FExit.20Status.20Stabilization.html#230538416">(Mar 16 2021 at 15:59)</a>:</h4>
<p>Might also be that that's all we can portably count on.</p>



<a name="230553742"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/219381-t-libs/topic/Termination/Exit%20Status%20Stabilization/near/230553742" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> scottmcm <a href="https://zulip-archive.rust-lang.org/stream/219381-t-libs/topic/Termination.2FExit.20Status.20Stabilization.html#230553742">(Mar 16 2021 at 17:14)</a>:</h4>
<p><span class="user-mention silent" data-user-id="344196">Jakub Duchniewicz</span> <a href="#narrow/stream/219381-t-libs/topic/Termination.2FExit.20Status.20Stabilization/near/230527582">said</a>:</p>
<blockquote>
<p>Probably <span class="user-mention silent" data-user-id="125270">scottmcm</span> would know more about this topic and why it is <code>not isize</code> in the first place</p>
</blockquote>
<p><a href="#narrow/stream/219381-t-libs/topic/Termination.2FExit.20Status.20Stabilization/near/230187118">https://rust-lang.zulipchat.com/#narrow/stream/219381-t-libs/topic/Termination.2FExit.20Status.20Stabilization/near/230187118</a></p>
<p>Originally posix was 0..=255, but now it's <code>c_int</code>, and on windows it's <code>DWORD</code> (<code>u32</code>), so it's not obvious what the correct type is.  (And then there's esoteric platforms where it's a string, or something.)</p>
<p>But in general, the answer for <code>ExitCode</code> is that there wasn't really substantial design -- it was just tossing something together to get non-<code>()</code>-<code>main</code> stabilized.  Probably it's <code>i32</code> because there was an <a href="https://github.com/rust-lang/rust/pull/48497/files#diff-d28320a72819402338af92259522275ed5e735179368ca421704fbdd937cea07L1456"><code>impl Termination for i32</code></a> and <code>ExitCode</code> was created to punt on the question of whether <code>i32</code> was the right type, or whether <em>any</em> integer type as a return from <code>main</code> was desirable.</p>



<a name="230555702"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/219381-t-libs/topic/Termination/Exit%20Status%20Stabilization/near/230555702" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jakub Duchniewicz <a href="https://zulip-archive.rust-lang.org/stream/219381-t-libs/topic/Termination.2FExit.20Status.20Stabilization.html#230555702">(Mar 16 2021 at 17:24)</a>:</h4>
<p>so I guess we are ok with changing the underlying type of <code>ExitCode</code> to be <code>i32</code>?</p>



<a name="230556130"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/219381-t-libs/topic/Termination/Exit%20Status%20Stabilization/near/230556130" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> scottmcm <a href="https://zulip-archive.rust-lang.org/stream/219381-t-libs/topic/Termination.2FExit.20Status.20Stabilization.html#230556130">(Mar 16 2021 at 17:26)</a>:</h4>
<p>Do you mean of <code>start</code>?  The struct is <code>pub struct ExitCode(imp::ExitCode);</code>, which seems plausible, as it allows different types for different platforms...</p>



<a name="230558964"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/219381-t-libs/topic/Termination/Exit%20Status%20Stabilization/near/230558964" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> cuviper <a href="https://zulip-archive.rust-lang.org/stream/219381-t-libs/topic/Termination.2FExit.20Status.20Stabilization.html#230558964">(Mar 16 2021 at 17:43)</a>:</h4>
<p>Linux  <code>sys_exit</code> and <code>sys_exit_group</code> both mask <code>error_code&amp;0xff</code> in the kernel</p>



<a name="230559193"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/219381-t-libs/topic/Termination/Exit%20Status%20Stabilization/near/230559193" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Triplett <a href="https://zulip-archive.rust-lang.org/stream/219381-t-libs/topic/Termination.2FExit.20Status.20Stabilization.html#230559193">(Mar 16 2021 at 17:44)</a>:</h4>
<p>Worth noting, I <em>think</em> Fuchsia might actually use <code>u64</code> here?</p>



<a name="230559204"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/219381-t-libs/topic/Termination/Exit%20Status%20Stabilization/near/230559204" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Triplett <a href="https://zulip-archive.rust-lang.org/stream/219381-t-libs/topic/Termination.2FExit.20Status.20Stabilization.html#230559204">(Mar 16 2021 at 17:44)</a>:</h4>
<p>That was mentioned on an unrelated PR.</p>



<a name="230559233"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/219381-t-libs/topic/Termination/Exit%20Status%20Stabilization/near/230559233" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Triplett <a href="https://zulip-archive.rust-lang.org/stream/219381-t-libs/topic/Termination.2FExit.20Status.20Stabilization.html#230559233">(Mar 16 2021 at 17:45)</a>:</h4>
<p>So <code>i32</code> doesn't seem like a portable assumption.</p>



<a name="230560684"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/219381-t-libs/topic/Termination/Exit%20Status%20Stabilization/near/230560684" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> scottmcm <a href="https://zulip-archive.rust-lang.org/stream/219381-t-libs/topic/Termination.2FExit.20Status.20Stabilization.html#230560684">(Mar 16 2021 at 17:52)</a>:</h4>
<p>Maybe <code>ExitCode: From&lt;u8&gt;</code> everywhere, with platform-specific constructors from other things?  (And just never expose the underlying field as <code>pub</code>.)</p>



<a name="230563102"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/219381-t-libs/topic/Termination/Exit%20Status%20Stabilization/near/230563102" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Triplett <a href="https://zulip-archive.rust-lang.org/stream/219381-t-libs/topic/Termination.2FExit.20Status.20Stabilization.html#230563102">(Mar 16 2021 at 18:05)</a>:</h4>
<p>That sounds like the right answer, yeah.</p>



<a name="230563210"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/219381-t-libs/topic/Termination/Exit%20Status%20Stabilization/near/230563210" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Triplett <a href="https://zulip-archive.rust-lang.org/stream/219381-t-libs/topic/Termination.2FExit.20Status.20Stabilization.html#230563210">(Mar 16 2021 at 18:06)</a>:</h4>
<p>Least-common-denominator portable API that'll cover most common cases, platform-specific API to use the full extent of the platform.</p>



<a name="230563623"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/219381-t-libs/topic/Termination/Exit%20Status%20Stabilization/near/230563623" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> scottmcm <a href="https://zulip-archive.rust-lang.org/stream/219381-t-libs/topic/Termination.2FExit.20Status.20Stabilization.html#230563623">(Mar 16 2021 at 18:08)</a>:</h4>
<p>Yeah, I feel like the 90% (or more) case is just codes in 0-10.</p>



<a name="230563692"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/219381-t-libs/topic/Termination/Exit%20Status%20Stabilization/near/230563692" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Mara <a href="https://zulip-archive.rust-lang.org/stream/219381-t-libs/topic/Termination.2FExit.20Status.20Stabilization.html#230563692">(Mar 16 2021 at 18:09)</a>:</h4>
<p>i think i even saw a 13 recently <span aria-label="eyes" class="emoji emoji-1f440" role="img" title="eyes">:eyes:</span></p>



<a name="230564755"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/219381-t-libs/topic/Termination/Exit%20Status%20Stabilization/near/230564755" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> bstrie <a href="https://zulip-archive.rust-lang.org/stream/219381-t-libs/topic/Termination.2FExit.20Status.20Stabilization.html#230564755">(Mar 16 2021 at 18:15)</a>:</h4>
<p>13 is for SIGPIPE, signal(7) lists up to 31: <a href="https://man7.org/linux/man-pages/man7/signal.7.html">https://man7.org/linux/man-pages/man7/signal.7.html</a></p>



<a name="230565053"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/219381-t-libs/topic/Termination/Exit%20Status%20Stabilization/near/230565053" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Mara <a href="https://zulip-archive.rust-lang.org/stream/219381-t-libs/topic/Termination.2FExit.20Status.20Stabilization.html#230565053">(Mar 16 2021 at 18:17)</a>:</h4>
<p>signals are returned differently than just exit codes (although some shells might not display/handle them differently (?))</p>



<a name="230565200"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/219381-t-libs/topic/Termination/Exit%20Status%20Stabilization/near/230565200" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> cuviper <a href="https://zulip-archive.rust-lang.org/stream/219381-t-libs/topic/Termination.2FExit.20Status.20Stabilization.html#230565200">(Mar 16 2021 at 18:18)</a>:</h4>
<p>I just ran <code>sleep 1000</code> and then used <code>kill -13</code> on it, and the bash <code>$?</code>is 141 (i.e. 128+sig)</p>



<a name="230565259"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/219381-t-libs/topic/Termination/Exit%20Status%20Stabilization/near/230565259" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> cuviper <a href="https://zulip-archive.rust-lang.org/stream/219381-t-libs/topic/Termination.2FExit.20Status.20Stabilization.html#230565259">(Mar 16 2021 at 18:19)</a>:</h4>
<p>but I don't remember if that's just a shell-ism</p>



<a name="230565306"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/219381-t-libs/topic/Termination/Exit%20Status%20Stabilization/near/230565306" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> cuviper <a href="https://zulip-archive.rust-lang.org/stream/219381-t-libs/topic/Termination.2FExit.20Status.20Stabilization.html#230565306">(Mar 16 2021 at 18:19)</a>:</h4>
<p><code>WTERMSIG</code> uses separate bits than a normal exit code</p>



<a name="230565599"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/219381-t-libs/topic/Termination/Exit%20Status%20Stabilization/near/230565599" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Mara <a href="https://zulip-archive.rust-lang.org/stream/219381-t-libs/topic/Termination.2FExit.20Status.20Stabilization.html#230565599">(Mar 16 2021 at 18:21)</a>:</h4>
<p>yeah that's just the shell. zsh does the same +128 thing for signals, but the kernel encodes it separately.</p>



<a name="230571544"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/219381-t-libs/topic/Termination/Exit%20Status%20Stabilization/near/230571544" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Triplett <a href="https://zulip-archive.rust-lang.org/stream/219381-t-libs/topic/Termination.2FExit.20Status.20Stabilization.html#230571544">(Mar 16 2021 at 19:01)</a>:</h4>
<p><span class="user-mention silent" data-user-id="125270">scottmcm</span> <a href="#narrow/stream/219381-t-libs/topic/Termination.2FExit.20Status.20Stabilization/near/230563623">said</a>:</p>
<blockquote>
<p>Yeah, I feel like the 90% (or more) case is just codes in 0-10.</p>
</blockquote>
<p>There's also common usage of codes around 128 and codes around 255, for programs that want to pass through some other program's exit code but carve out a bit of space for their own errors.</p>



<a name="230571618"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/219381-t-libs/topic/Termination/Exit%20Status%20Stabilization/near/230571618" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Triplett <a href="https://zulip-archive.rust-lang.org/stream/219381-t-libs/topic/Termination.2FExit.20Status.20Stabilization.html#230571618">(Mar 16 2021 at 19:01)</a>:</h4>
<p>But yeah, I think most portable programs will be happy using a <code>u8</code>, and only specific programs on non-UNIX platforms will need to return specific errors above 255.</p>



<a name="230573867"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/219381-t-libs/topic/Termination/Exit%20Status%20Stabilization/near/230573867" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jakub Duchniewicz <a href="https://zulip-archive.rust-lang.org/stream/219381-t-libs/topic/Termination.2FExit.20Status.20Stabilization.html#230573867">(Mar 16 2021 at 19:16)</a>:</h4>
<p>In the <a href="https://internals.rust-lang.org/t/mini-pre-rfc-redesigning-process-exitstatus/5426/15">pre-RFC</a> the difference between signals and codes is explained quite well. But AFAIK we will not be doing this distinction and just return whatever is in the <code>ExitCode</code> (assuming the user put something there).</p>



<a name="269793887"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/219381-t-libs/topic/Termination/Exit%20Status%20Stabilization/near/269793887" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jane Lusby [she/her] <a href="https://zulip-archive.rust-lang.org/stream/219381-t-libs/topic/Termination.2FExit.20Status.20Stabilization.html#269793887">(Jan 28 2022 at 20:01)</a>:</h4>
<p>aha, here's where the discussion was hiding</p>



<a name="269794777"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/219381-t-libs/topic/Termination/Exit%20Status%20Stabilization/near/269794777" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jane Lusby [she/her] <a href="https://zulip-archive.rust-lang.org/stream/219381-t-libs/topic/Termination.2FExit.20Status.20Stabilization.html#269794777">(Jan 28 2022 at 20:08)</a>:</h4>
<p>So I'm spending today digging up everything I can on the current status of Termination so I can propose a path towards stabilization</p>



<a name="269794790"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/219381-t-libs/topic/Termination/Exit%20Status%20Stabilization/near/269794790" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jane Lusby [she/her] <a href="https://zulip-archive.rust-lang.org/stream/219381-t-libs/topic/Termination.2FExit.20Status.20Stabilization.html#269794790">(Jan 28 2022 at 20:08)</a>:</h4>
<p>I left some comments in the thread on <code>?</code>-in-main</p>



<a name="269794815"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/219381-t-libs/topic/Termination/Exit%20Status%20Stabilization/near/269794815" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jane Lusby [she/her] <a href="https://zulip-archive.rust-lang.org/stream/219381-t-libs/topic/Termination.2FExit.20Status.20Stabilization.html#269794815">(Jan 28 2022 at 20:08)</a>:</h4>
<p><a href="https://github.com/rust-lang/rust/issues/43301#issuecomment-1024587145">https://github.com/rust-lang/rust/issues/43301#issuecomment-1024587145</a></p>



<a name="269794872"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/219381-t-libs/topic/Termination/Exit%20Status%20Stabilization/near/269794872" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jane Lusby [she/her] <a href="https://zulip-archive.rust-lang.org/stream/219381-t-libs/topic/Termination.2FExit.20Status.20Stabilization.html#269794872">(Jan 28 2022 at 20:09)</a>:</h4>
<p>the main issues at the moment are the representation concerns mentioned here, and by association the return type of Termination, as well as the name of the Termination trait</p>



<a name="269794924"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/219381-t-libs/topic/Termination/Exit%20Status%20Stabilization/near/269794924" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jane Lusby [she/her] <a href="https://zulip-archive.rust-lang.org/stream/219381-t-libs/topic/Termination.2FExit.20Status.20Stabilization.html#269794924">(Jan 28 2022 at 20:09)</a>:</h4>
<p>a while back withoutboats suggested that the trait should be a Verb, and so should be renamed Terminate to be consistent with other trait names we export</p>



<a name="269794938"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/219381-t-libs/topic/Termination/Exit%20Status%20Stabilization/near/269794938" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jane Lusby [she/her] <a href="https://zulip-archive.rust-lang.org/stream/219381-t-libs/topic/Termination.2FExit.20Status.20Stabilization.html#269794938">(Jan 28 2022 at 20:09)</a>:</h4>
<p>other commenters suggested Exit</p>



<a name="269795109"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/219381-t-libs/topic/Termination/Exit%20Status%20Stabilization/near/269795109" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jane Lusby [she/her] <a href="https://zulip-archive.rust-lang.org/stream/219381-t-libs/topic/Termination.2FExit.20Status.20Stabilization.html#269795109">(Jan 28 2022 at 20:10)</a>:</h4>
<p>I was personally somewhat compelled by the argument that it should be <code>Exit</code> because exit has connotations of a graceful shutdown, where as terminate has connotations of an abrupt shutdown, and this trait is representing graceful shutdown which makes Exit the more appropriate name.</p>



<a name="269795120"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/219381-t-libs/topic/Termination/Exit%20Status%20Stabilization/near/269795120" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jane Lusby [she/her] <a href="https://zulip-archive.rust-lang.org/stream/219381-t-libs/topic/Termination.2FExit.20Status.20Stabilization.html#269795120">(Jan 28 2022 at 20:10)</a>:</h4>
<p>I also like the idea of making it a verb</p>



<a name="269795174"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/219381-t-libs/topic/Termination/Exit%20Status%20Stabilization/near/269795174" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jane Lusby [she/her] <a href="https://zulip-archive.rust-lang.org/stream/219381-t-libs/topic/Termination.2FExit.20Status.20Stabilization.html#269795174">(Jan 28 2022 at 20:11)</a>:</h4>
<p>I've nominated the issue for discussion in the next libs-api team meeting so we can quickly navigate the bikeshed on the name</p>



<a name="269795184"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/219381-t-libs/topic/Termination/Exit%20Status%20Stabilization/near/269795184" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Triplett <a href="https://zulip-archive.rust-lang.org/stream/219381-t-libs/topic/Termination.2FExit.20Status.20Stabilization.html#269795184">(Jan 28 2022 at 20:11)</a>:</h4>
<p><span class="user-mention" data-user-id="220273">@Jane Lusby [she/her]</span> So, I think it makes sense for it to be a verb if it actually performs that verb.</p>



<a name="269795219"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/219381-t-libs/topic/Termination/Exit%20Status%20Stabilization/near/269795219" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Triplett <a href="https://zulip-archive.rust-lang.org/stream/219381-t-libs/topic/Termination.2FExit.20Status.20Stabilization.html#269795219">(Jan 28 2022 at 20:11)</a>:</h4>
<p>But this trait doesn't represent a thing that exits. It represents a thing that reports a message, and then provides an exit code.</p>



<a name="269795227"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/219381-t-libs/topic/Termination/Exit%20Status%20Stabilization/near/269795227" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jane Lusby [she/her] <a href="https://zulip-archive.rust-lang.org/stream/219381-t-libs/topic/Termination.2FExit.20Status.20Stabilization.html#269795227">(Jan 28 2022 at 20:11)</a>:</h4>
<p>though I think getting some of the bikeshed out ahead of time in this thread would be a good idea</p>



<a name="269795307"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/219381-t-libs/topic/Termination/Exit%20Status%20Stabilization/near/269795307" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> scottmcm <a href="https://zulip-archive.rust-lang.org/stream/219381-t-libs/topic/Termination.2FExit.20Status.20Stabilization.html#269795307">(Jan 28 2022 at 20:12)</a>:</h4>
<p><code>std::process::exit</code> is questionably-graceful, though, since it doesn't run destructors.</p>
<p>I don't know if that's relevant for the trait name, though.</p>



<a name="269795308"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/219381-t-libs/topic/Termination/Exit%20Status%20Stabilization/near/269795308" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Triplett <a href="https://zulip-archive.rust-lang.org/stream/219381-t-libs/topic/Termination.2FExit.20Status.20Stabilization.html#269795308">(Jan 28 2022 at 20:12)</a>:</h4>
<p>I don't think it makes sense to <code>impl Exit for ThingWithAnI32</code>, for instance.</p>



<a name="269795325"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/219381-t-libs/topic/Termination/Exit%20Status%20Stabilization/near/269795325" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jane Lusby [she/her] <a href="https://zulip-archive.rust-lang.org/stream/219381-t-libs/topic/Termination.2FExit.20Status.20Stabilization.html#269795325">(Jan 28 2022 at 20:12)</a>:</h4>
<p><span class="user-mention silent" data-user-id="125270">scottmcm</span> <a href="#narrow/stream/219381-t-libs/topic/Termination.2FExit.20Status.20Stabilization/near/269795307">said</a>:</p>
<blockquote>
<p><code>std::process::exit</code> is questionably-graceful, though, since it doesn't run destructors.</p>
<p>I don't know if that's relevant for the trait name, though.</p>
</blockquote>
<p>another fair point</p>



<a name="269795424"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/219381-t-libs/topic/Termination/Exit%20Status%20Stabilization/near/269795424" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jane Lusby [she/her] <a href="https://zulip-archive.rust-lang.org/stream/219381-t-libs/topic/Termination.2FExit.20Status.20Stabilization.html#269795424">(Jan 28 2022 at 20:13)</a>:</h4>
<p>both of these concerns seem like compelling enough reasons to just leave it as Termination to me</p>



<a name="269795443"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/219381-t-libs/topic/Termination/Exit%20Status%20Stabilization/near/269795443" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jane Lusby [she/her] <a href="https://zulip-archive.rust-lang.org/stream/219381-t-libs/topic/Termination.2FExit.20Status.20Stabilization.html#269795443">(Jan 28 2022 at 20:13)</a>:</h4>
<p>also that causes less churn during stabilization for nightly users</p>



<a name="269795461"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/219381-t-libs/topic/Termination/Exit%20Status%20Stabilization/near/269795461" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jane Lusby [she/her] <a href="https://zulip-archive.rust-lang.org/stream/219381-t-libs/topic/Termination.2FExit.20Status.20Stabilization.html#269795461">(Jan 28 2022 at 20:13)</a>:</h4>
<p>(though I don't think that should be a factor in the decision making)</p>



<a name="269795554"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/219381-t-libs/topic/Termination/Exit%20Status%20Stabilization/near/269795554" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jane Lusby [she/her] <a href="https://zulip-archive.rust-lang.org/stream/219381-t-libs/topic/Termination.2FExit.20Status.20Stabilization.html#269795554">(Jan 28 2022 at 20:14)</a>:</h4>
<p>Regardless of the naming concern, I'm going to go ahead and update the return type to be <code>ExitCode</code>, since its pretty clear that this gives us the most flexibility going forward to solve platform specific concerns</p>



<a name="269795652"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/219381-t-libs/topic/Termination/Exit%20Status%20Stabilization/near/269795652" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jane Lusby [she/her] <a href="https://zulip-archive.rust-lang.org/stream/219381-t-libs/topic/Termination.2FExit.20Status.20Stabilization.html#269795652">(Jan 28 2022 at 20:14)</a>:</h4>
<p>And my feeling is we should go ahead with stabilizing Termination::report() -&gt; ExitCode, with a minimal stable API for exit code where we can only construct success and failure, then we can have a more focused design discussion about expanding the API of ExitCode</p>



<a name="269797841"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/219381-t-libs/topic/Termination/Exit%20Status%20Stabilization/near/269797841" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jane Lusby [she/her] <a href="https://zulip-archive.rust-lang.org/stream/219381-t-libs/topic/Termination.2FExit.20Status.20Stabilization.html#269797841">(Jan 28 2022 at 20:28)</a>:</h4>
<p>I do wonder if we should be interrogating the relationship between ExitCode and ExitStatus</p>



<a name="269797877"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/219381-t-libs/topic/Termination/Exit%20Status%20Stabilization/near/269797877" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jane Lusby [she/her] <a href="https://zulip-archive.rust-lang.org/stream/219381-t-libs/topic/Termination.2FExit.20Status.20Stabilization.html#269797877">(Jan 28 2022 at 20:28)</a>:</h4>
<p>or I guess, I want to have a clear story of what their relationship is and why we have both before we stabilize ExitCode</p>



<a name="269798130"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/219381-t-libs/topic/Termination/Exit%20Status%20Stabilization/near/269798130" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jane Lusby [she/her] <a href="https://zulip-archive.rust-lang.org/stream/219381-t-libs/topic/Termination.2FExit.20Status.20Stabilization.html#269798130">(Jan 28 2022 at 20:31)</a>:</h4>
<p>I know that ExitCode was introduced as a placeholder so I wouldn't be surprised if this is more about synthesizing a story rather than finding the historically planned one.</p>



<a name="269798572"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/219381-t-libs/topic/Termination/Exit%20Status%20Stabilization/near/269798572" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Triplett <a href="https://zulip-archive.rust-lang.org/stream/219381-t-libs/topic/Termination.2FExit.20Status.20Stabilization.html#269798572">(Jan 28 2022 at 20:34)</a>:</h4>
<p>If we go the <code>ExitCode</code> route, then we're going to have all the same considerations regarding how to create an <code>ExitCode</code>, and as far as I can tell <code>Termination</code> will have almost no value until we do.</p>



<a name="269798601"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/219381-t-libs/topic/Termination/Exit%20Status%20Stabilization/near/269798601" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Triplett <a href="https://zulip-archive.rust-lang.org/stream/219381-t-libs/topic/Termination.2FExit.20Status.20Stabilization.html#269798601">(Jan 28 2022 at 20:34)</a>:</h4>
<p>The point of stabilizing <code>Termination</code> is to let people define their own impls, and much of the value of that is being able to have exit codes.</p>



<a name="269798765"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/219381-t-libs/topic/Termination/Exit%20Status%20Stabilization/near/269798765" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Triplett <a href="https://zulip-archive.rust-lang.org/stream/219381-t-libs/topic/Termination.2FExit.20Status.20Stabilization.html#269798765">(Jan 28 2022 at 20:36)</a>:</h4>
<p>So if we're not prepared to add <code>impl From&lt;i32&gt; for ExitCode</code> or <code>impl From&lt;u8&gt; for ExitCode</code>, or alternatively add impls in the standard library that internally generate ExitCode values (which seems even harder right now), then I think we shouldn't try to stabilize <code>Termination</code> yet.</p>



<a name="269799746"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/219381-t-libs/topic/Termination/Exit%20Status%20Stabilization/near/269799746" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jane Lusby [she/her] <a href="https://zulip-archive.rust-lang.org/stream/219381-t-libs/topic/Termination.2FExit.20Status.20Stabilization.html#269799746">(Jan 28 2022 at 20:44)</a>:</h4>
<p><span class="user-mention silent" data-user-id="239881">Josh Triplett</span> <a href="#narrow/stream/219381-t-libs/topic/Termination.2FExit.20Status.20Stabilization/near/269798601">said</a>:</p>
<blockquote>
<p>The point of stabilizing <code>Termination</code> is to let people define their own impls, and much of the value of that is being able to have exit codes.</p>
</blockquote>
<p>related to this, if someone calls <code>std::process::exit</code> in <code>Termination::report</code>, how many destructors do we not run that would otherwise have been run?</p>



<a name="269799796"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/219381-t-libs/topic/Termination/Exit%20Status%20Stabilization/near/269799796" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jane Lusby [she/her] <a href="https://zulip-archive.rust-lang.org/stream/219381-t-libs/topic/Termination.2FExit.20Status.20Stabilization.html#269799796">(Jan 28 2022 at 20:44)</a>:</h4>
<p>would this affect things in statics?</p>



<a name="269800007"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/219381-t-libs/topic/Termination/Exit%20Status%20Stabilization/near/269800007" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jane Lusby [she/her] <a href="https://zulip-archive.rust-lang.org/stream/219381-t-libs/topic/Termination.2FExit.20Status.20Stabilization.html#269800007">(Jan 28 2022 at 20:46)</a>:</h4>
<p><span class="user-mention silent" data-user-id="239881">Josh Triplett</span> <a href="#narrow/stream/219381-t-libs/topic/Termination.2FExit.20Status.20Stabilization/near/269798601">said</a>:</p>
<blockquote>
<p>The point of stabilizing <code>Termination</code> is to let people define their own impls, and much of the value of that is being able to have exit codes.</p>
</blockquote>
<p>I do want to push back on the idea that Exit codes are the only value for Termination, it is also the point at which people would customize error reporting output for return from main</p>



<a name="269800075"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/219381-t-libs/topic/Termination/Exit%20Status%20Stabilization/near/269800075" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jane Lusby [she/her] <a href="https://zulip-archive.rust-lang.org/stream/219381-t-libs/topic/Termination.2FExit.20Status.20Stabilization.html#269800075">(Jan 28 2022 at 20:47)</a>:</h4>
<p>such as writing a custom Result that only implements Termination for E: Error instead of E: Debug, or something that colorizes the <code>Error: </code> part of the output or otherwise changes the header we put before error messages</p>



<a name="269800118"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/219381-t-libs/topic/Termination/Exit%20Status%20Stabilization/near/269800118" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Triplett <a href="https://zulip-archive.rust-lang.org/stream/219381-t-libs/topic/Termination.2FExit.20Status.20Stabilization.html#269800118">(Jan 28 2022 at 20:47)</a>:</h4>
<p>Fair. It's not the <em>only</em> value. But I do think that it's sufficient value that we should settle the question beforehand.</p>



<a name="269800142"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/219381-t-libs/topic/Termination/Exit%20Status%20Stabilization/near/269800142" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Triplett <a href="https://zulip-archive.rust-lang.org/stream/219381-t-libs/topic/Termination.2FExit.20Status.20Stabilization.html#269800142">(Jan 28 2022 at 20:47)</a>:</h4>
<p>Rather than deferring it until we handle <code>ExitCode</code>.</p>



<a name="269800250"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/219381-t-libs/topic/Termination/Exit%20Status%20Stabilization/near/269800250" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Triplett <a href="https://zulip-archive.rust-lang.org/stream/219381-t-libs/topic/Termination.2FExit.20Status.20Stabilization.html#269800250">(Jan 28 2022 at 20:48)</a>:</h4>
<p>I'm sad that in the absence of specialization people <em>can't</em> write <code>impl Termination for Result&lt;(), MyError&gt;</code> or similar.</p>



<a name="269800283"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/219381-t-libs/topic/Termination/Exit%20Status%20Stabilization/near/269800283" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jane Lusby [she/her] <a href="https://zulip-archive.rust-lang.org/stream/219381-t-libs/topic/Termination.2FExit.20Status.20Stabilization.html#269800283">(Jan 28 2022 at 20:48)</a>:</h4>
<p>yea</p>



<a name="269800336"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/219381-t-libs/topic/Termination/Exit%20Status%20Stabilization/near/269800336" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Triplett <a href="https://zulip-archive.rust-lang.org/stream/219381-t-libs/topic/Termination.2FExit.20Status.20Stabilization.html#269800336">(Jan 28 2022 at 20:49)</a>:</h4>
<p>Though if we avoid adding any new impls, we could <code>impl Termination for Result&lt;OtherUnit, MyError&gt;</code>. :)</p>



<a name="269800453"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/219381-t-libs/topic/Termination/Exit%20Status%20Stabilization/near/269800453" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jane Lusby [she/her] <a href="https://zulip-archive.rust-lang.org/stream/219381-t-libs/topic/Termination.2FExit.20Status.20Stabilization.html#269800453">(Jan 28 2022 at 20:50)</a>:</h4>
<p>I'm wondering if <code>std::error::Report</code> could be a short term answer for this</p>



<a name="269800469"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/219381-t-libs/topic/Termination/Exit%20Status%20Stabilization/near/269800469" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jane Lusby [she/her] <a href="https://zulip-archive.rust-lang.org/stream/219381-t-libs/topic/Termination.2FExit.20Status.20Stabilization.html#269800469">(Jan 28 2022 at 20:50)</a>:</h4>
<p>since we could do a specialization on that internally</p>



<a name="269800517"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/219381-t-libs/topic/Termination/Exit%20Status%20Stabilization/near/269800517" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Triplett <a href="https://zulip-archive.rust-lang.org/stream/219381-t-libs/topic/Termination.2FExit.20Status.20Stabilization.html#269800517">(Jan 28 2022 at 20:50)</a>:</h4>
<p>I'm wondering how hard it would be to do a dynamic downcast attempt.</p>



<a name="269800544"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/219381-t-libs/topic/Termination/Exit%20Status%20Stabilization/near/269800544" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jane Lusby [she/her] <a href="https://zulip-archive.rust-lang.org/stream/219381-t-libs/topic/Termination.2FExit.20Status.20Stabilization.html#269800544">(Jan 28 2022 at 20:51)</a>:</h4>
<p>lol</p>



<a name="269800571"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/219381-t-libs/topic/Termination/Exit%20Status%20Stabilization/near/269800571" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Triplett <a href="https://zulip-archive.rust-lang.org/stream/219381-t-libs/topic/Termination.2FExit.20Status.20Stabilization.html#269800571">(Jan 28 2022 at 20:51)</a>:</h4>
<p>And make <code>impl Termination for Result&lt;(), E&gt;</code> automatically handle <code>E: Error</code> iff it implements <code>Error</code>.</p>



<a name="269800574"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/219381-t-libs/topic/Termination/Exit%20Status%20Stabilization/near/269800574" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jane Lusby [she/her] <a href="https://zulip-archive.rust-lang.org/stream/219381-t-libs/topic/Termination.2FExit.20Status.20Stabilization.html#269800574">(Jan 28 2022 at 20:51)</a>:</h4>
<p>so far we're only working on adding trait upcasting right?</p>



<a name="269800578"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/219381-t-libs/topic/Termination/Exit%20Status%20Stabilization/near/269800578" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jane Lusby [she/her] <a href="https://zulip-archive.rust-lang.org/stream/219381-t-libs/topic/Termination.2FExit.20Status.20Stabilization.html#269800578">(Jan 28 2022 at 20:51)</a>:</h4>
<p>not trait downcasting</p>



<a name="269800612"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/219381-t-libs/topic/Termination/Exit%20Status%20Stabilization/near/269800612" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Triplett <a href="https://zulip-archive.rust-lang.org/stream/219381-t-libs/topic/Termination.2FExit.20Status.20Stabilization.html#269800612">(Jan 28 2022 at 20:51)</a>:</h4>
<p>That's about implicit coercion, I think.</p>



<a name="269800625"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/219381-t-libs/topic/Termination/Exit%20Status%20Stabilization/near/269800625" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Triplett <a href="https://zulip-archive.rust-lang.org/stream/219381-t-libs/topic/Termination.2FExit.20Status.20Stabilization.html#269800625">(Jan 28 2022 at 20:51)</a>:</h4>
<p>I think we support explicit downcasting today.</p>



<a name="269800642"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/219381-t-libs/topic/Termination/Exit%20Status%20Stabilization/near/269800642" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jane Lusby [she/her] <a href="https://zulip-archive.rust-lang.org/stream/219381-t-libs/topic/Termination.2FExit.20Status.20Stabilization.html#269800642">(Jan 28 2022 at 20:51)</a>:</h4>
<p>whatt</p>



<a name="269800744"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/219381-t-libs/topic/Termination/Exit%20Status%20Stabilization/near/269800744" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jane Lusby [she/her] <a href="https://zulip-archive.rust-lang.org/stream/219381-t-libs/topic/Termination.2FExit.20Status.20Stabilization.html#269800744">(Jan 28 2022 at 20:52)</a>:</h4>
<p>as in <code>&amp;dyn Debug -&gt; Option&lt;&amp;dyn Error&gt;</code>?</p>



<a name="269800753"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/219381-t-libs/topic/Termination/Exit%20Status%20Stabilization/near/269800753" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Triplett <a href="https://zulip-archive.rust-lang.org/stream/219381-t-libs/topic/Termination.2FExit.20Status.20Stabilization.html#269800753">(Jan 28 2022 at 20:52)</a>:</h4>
<p>I <em>think</em> so?</p>



<a name="269800759"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/219381-t-libs/topic/Termination/Exit%20Status%20Stabilization/near/269800759" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Triplett <a href="https://zulip-archive.rust-lang.org/stream/219381-t-libs/topic/Termination.2FExit.20Status.20Stabilization.html#269800759">(Jan 28 2022 at 20:52)</a>:</h4>
<p>Checking...</p>



<a name="269800771"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/219381-t-libs/topic/Termination/Exit%20Status%20Stabilization/near/269800771" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jane Lusby [she/her] <a href="https://zulip-archive.rust-lang.org/stream/219381-t-libs/topic/Termination.2FExit.20Status.20Stabilization.html#269800771">(Jan 28 2022 at 20:52)</a>:</h4>
<p>ty</p>



<a name="269800837"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/219381-t-libs/topic/Termination/Exit%20Status%20Stabilization/near/269800837" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Triplett <a href="https://zulip-archive.rust-lang.org/stream/219381-t-libs/topic/Termination.2FExit.20Status.20Stabilization.html#269800837">(Jan 28 2022 at 20:53)</a>:</h4>
<p>So, I'm wondering if we can do this: <a href="https://docs.rs/anyhow/latest/src/anyhow/error.rs.html#487">https://docs.rs/anyhow/latest/src/anyhow/error.rs.html#487</a></p>



<a name="269800875"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/219381-t-libs/topic/Termination/Exit%20Status%20Stabilization/near/269800875" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Triplett <a href="https://zulip-archive.rust-lang.org/stream/219381-t-libs/topic/Termination.2FExit.20Status.20Stabilization.html#269800875">(Jan 28 2022 at 20:53)</a>:</h4>
<p>The one potential issue is that, as far as I can tell, you can only do that if <code>'static</code>.</p>



<a name="269800923"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/219381-t-libs/topic/Termination/Exit%20Status%20Stabilization/near/269800923" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Triplett <a href="https://zulip-archive.rust-lang.org/stream/219381-t-libs/topic/Termination.2FExit.20Status.20Stabilization.html#269800923">(Jan 28 2022 at 20:54)</a>:</h4>
<p>But I don't see how you could usefully have a <em>return value from main</em> that has a non-static lifetime.</p>



<a name="269800990"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/219381-t-libs/topic/Termination/Exit%20Status%20Stabilization/near/269800990" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jane Lusby [she/her] <a href="https://zulip-archive.rust-lang.org/stream/219381-t-libs/topic/Termination.2FExit.20Status.20Stabilization.html#269800990">(Jan 28 2022 at 20:55)</a>:</h4>
<p>I think the anyhow one only works because when you construct an error from a Display type it makes a new type that has a custom vtable for casting it back</p>



<a name="269801130"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/219381-t-libs/topic/Termination/Exit%20Status%20Stabilization/near/269801130" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jane Lusby [she/her] <a href="https://zulip-archive.rust-lang.org/stream/219381-t-libs/topic/Termination.2FExit.20Status.20Stabilization.html#269801130">(Jan 28 2022 at 20:56)</a>:</h4>
<p>like, that's concrete downcasting still</p>



<a name="269801161"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/219381-t-libs/topic/Termination/Exit%20Status%20Stabilization/near/269801161" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jane Lusby [she/her] <a href="https://zulip-archive.rust-lang.org/stream/219381-t-libs/topic/Termination.2FExit.20Status.20Stabilization.html#269801161">(Jan 28 2022 at 20:56)</a>:</h4>
<p>not downcasting to a trait object which would require knowing the concrete type in order to grab its error vtable</p>



<a name="269801252"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/219381-t-libs/topic/Termination/Exit%20Status%20Stabilization/near/269801252" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jane Lusby [she/her] <a href="https://zulip-archive.rust-lang.org/stream/219381-t-libs/topic/Termination.2FExit.20Status.20Stabilization.html#269801252">(Jan 28 2022 at 20:57)</a>:</h4>
<p>the compiler doesn't secretly implement vtables by having some place in static memory where they're all stored that we can look up based on the type in question, does it?</p>



<a name="269801274"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/219381-t-libs/topic/Termination/Exit%20Status%20Stabilization/near/269801274" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jane Lusby [she/her] <a href="https://zulip-archive.rust-lang.org/stream/219381-t-libs/topic/Termination.2FExit.20Status.20Stabilization.html#269801274">(Jan 28 2022 at 20:57)</a>:</h4>
<p>would be cool if we could do something like <code>fn(type_id, trait_id) -&gt; Option&lt;vtable_for_trait_from_type&gt;</code></p>



<a name="269801382"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/219381-t-libs/topic/Termination/Exit%20Status%20Stabilization/near/269801382" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jane Lusby [she/her] <a href="https://zulip-archive.rust-lang.org/stream/219381-t-libs/topic/Termination.2FExit.20Status.20Stabilization.html#269801382">(Jan 28 2022 at 20:58)</a>:</h4>
<p>also, do vtables always contain the type ID or is that only Any / Error / traits that opt into this via a virtual method that do?</p>



<a name="269801760"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/219381-t-libs/topic/Termination/Exit%20Status%20Stabilization/near/269801760" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> scottmcm <a href="https://zulip-archive.rust-lang.org/stream/219381-t-libs/topic/Termination.2FExit.20Status.20Stabilization.html#269801760">(Jan 28 2022 at 21:01)</a>:</h4>
<p><span class="user-mention silent" data-user-id="220273">Jane Lusby [she/her]</span> <a href="#narrow/stream/219381-t-libs/topic/Termination.2FExit.20Status.20Stabilization/near/269797841">said</a>:</p>
<blockquote>
<p>I do wonder if we should be interrogating the relationship between ExitCode and ExitStatus</p>
</blockquote>
<p><code>ExitStatus</code> has to deal with signals, iirc, so that forced the difference.  It's not clear to me what <code>fn main() -&gt; ExitStatus</code> should mean if it returns a signal value.</p>



<a name="269801862"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/219381-t-libs/topic/Termination/Exit%20Status%20Stabilization/near/269801862" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Thom Chiovoloni <a href="https://zulip-archive.rust-lang.org/stream/219381-t-libs/topic/Termination.2FExit.20Status.20Stabilization.html#269801862">(Jan 28 2022 at 21:02)</a>:</h4>
<p><del>if it returns sigsegv we clearly must immediately dereference null</del></p>



<a name="269801988"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/219381-t-libs/topic/Termination/Exit%20Status%20Stabilization/near/269801988" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jane Lusby [she/her] <a href="https://zulip-archive.rust-lang.org/stream/219381-t-libs/topic/Termination.2FExit.20Status.20Stabilization.html#269801988">(Jan 28 2022 at 21:03)</a>:</h4>
<p><span class="user-mention silent" data-user-id="125270">scottmcm</span> <a href="#narrow/stream/219381-t-libs/topic/Termination.2FExit.20Status.20Stabilization/near/269801760">said</a>:</p>
<blockquote>
<p><span class="user-mention silent" data-user-id="220273">Jane Lusby [she/her]</span> <a href="#narrow/stream/219381-t-libs/topic/Termination.2FExit.20Status.20Stabilization/near/269797841">said</a>:</p>
<blockquote>
<p>I do wonder if we should be interrogating the relationship between ExitCode and ExitStatus</p>
</blockquote>
<p><code>ExitStatus</code> has to deal with signals, iirc, so that forced the difference.  It's not clear to me what <code>fn main() -&gt; ExitStatus</code> should mean if it returns a signal value.</p>
</blockquote>
<p>the IRLO thread made it seem like returning a signal would be somewhat nonsensical on most if not all platforms, so keeping it separate to make it clear that it has nothing to do with signals seems like a good start for justifying two separate types.</p>



<a name="269802279"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/219381-t-libs/topic/Termination/Exit%20Status%20Stabilization/near/269802279" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jane Lusby [she/her] <a href="https://zulip-archive.rust-lang.org/stream/219381-t-libs/topic/Termination.2FExit.20Status.20Stabilization.html#269802279">(Jan 28 2022 at 21:05)</a>:</h4>
<p><a href="https://github.com/rust-lang/rust/pull/93442/">https://github.com/rust-lang/rust/pull/93442/</a></p>



<a name="269802406"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/219381-t-libs/topic/Termination/Exit%20Status%20Stabilization/near/269802406" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> scottmcm <a href="https://zulip-archive.rust-lang.org/stream/219381-t-libs/topic/Termination.2FExit.20Status.20Stabilization.html#269802406">(Jan 28 2022 at 21:06)</a>:</h4>
<p>I guess we can at least do <code>impl From&lt;ExitCode&gt; for ExitStatus</code>, and <code>impl TryFrom&lt;ExitStatus, Error = ExitedBySignalError&gt; for ExitCode</code>.</p>



<a name="269802660"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/219381-t-libs/topic/Termination/Exit%20Status%20Stabilization/near/269802660" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jane Lusby [she/her] <a href="https://zulip-archive.rust-lang.org/stream/219381-t-libs/topic/Termination.2FExit.20Status.20Stabilization.html#269802660">(Jan 28 2022 at 21:08)</a>:</h4>
<p>Another question, do we want to try to provide minimal consistent cross-platform API on ExitCode?</p>



<a name="269802700"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/219381-t-libs/topic/Termination/Exit%20Status%20Stabilization/near/269802700" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jane Lusby [she/her] <a href="https://zulip-archive.rust-lang.org/stream/219381-t-libs/topic/Termination.2FExit.20Status.20Stabilization.html#269802700">(Jan 28 2022 at 21:09)</a>:</h4>
<p>I think this is probably the biggest question when it comes to defining the shape of the ExitCode API</p>



<a name="269802752"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/219381-t-libs/topic/Termination/Exit%20Status%20Stabilization/near/269802752" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jane Lusby [she/her] <a href="https://zulip-archive.rust-lang.org/stream/219381-t-libs/topic/Termination.2FExit.20Status.20Stabilization.html#269802752">(Jan 28 2022 at 21:09)</a>:</h4>
<p>like, do we want to only expose the minimal API for constructing ExitCodes that will behave consistently on all platforms?</p>



<a name="269802834"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/219381-t-libs/topic/Termination/Exit%20Status%20Stabilization/near/269802834" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jane Lusby [she/her] <a href="https://zulip-archive.rust-lang.org/stream/219381-t-libs/topic/Termination.2FExit.20Status.20Stabilization.html#269802834">(Jan 28 2022 at 21:10)</a>:</h4>
<p>or do some extra bookkeeping under the hood when converting from ExitCode -&gt; the platform specific i32/whatever</p>



<a name="269802980"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/219381-t-libs/topic/Termination/Exit%20Status%20Stabilization/near/269802980" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jane Lusby [she/her] <a href="https://zulip-archive.rust-lang.org/stream/219381-t-libs/topic/Termination.2FExit.20Status.20Stabilization.html#269802980">(Jan 28 2022 at 21:11)</a>:</h4>
<p>That seems to be a major design consideration in the IRLO thread, so I can imagine us providing just <code>u8</code> construction for cross platform exit codes, plus some platform specific extension APIs for constructing richer platform specific ExitCodes</p>



<a name="269803874"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/219381-t-libs/topic/Termination/Exit%20Status%20Stabilization/near/269803874" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> scottmcm <a href="https://zulip-archive.rust-lang.org/stream/219381-t-libs/topic/Termination.2FExit.20Status.20Stabilization.html#269803874">(Jan 28 2022 at 21:18)</a>:</h4>
<p>Could start with just <code>ExitCode::SUCCESS</code> and <code>ExitCode::FAILURE</code> (like C's <code>EXIT_SUCCESS</code> and <code>EXIT_FAILURE</code>) to get <code>Termination</code> unblocked -- that'd be enough for the basic "I just want to use <code>Display</code> or <code>Error</code> instead of <code>Debug</code>" uses of <code>Termination</code>.</p>



<a name="269804363"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/219381-t-libs/topic/Termination/Exit%20Status%20Stabilization/near/269804363" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jane Lusby [she/her] <a href="https://zulip-archive.rust-lang.org/stream/219381-t-libs/topic/Termination.2FExit.20Status.20Stabilization.html#269804363">(Jan 28 2022 at 21:22)</a>:</h4>
<p>I suggested that above but Josh pushed back above here: <a href="#narrow/stream/219381-t-libs/topic/Termination.2FExit.20Status.20Stabilization/near/269798601">https://rust-lang.zulipchat.com/#narrow/stream/219381-t-libs/topic/Termination.2FExit.20Status.20Stabilization/near/269798601</a></p>



<a name="269804401"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/219381-t-libs/topic/Termination/Exit%20Status%20Stabilization/near/269804401" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Triplett <a href="https://zulip-archive.rust-lang.org/stream/219381-t-libs/topic/Termination.2FExit.20Status.20Stabilization.html#269804401">(Jan 28 2022 at 21:22)</a>:</h4>
<p>Yeah, I feel like we need to actually decide where this is leading, rather than stabilizing part of it and deferring the hard part.</p>



<a name="269804426"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/219381-t-libs/topic/Termination/Exit%20Status%20Stabilization/near/269804426" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Triplett <a href="https://zulip-archive.rust-lang.org/stream/219381-t-libs/topic/Termination.2FExit.20Status.20Stabilization.html#269804426">(Jan 28 2022 at 21:22)</a>:</h4>
<p>We already had some issues because we stabilized part of it and now wish we could change that.</p>



<a name="269804433"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/219381-t-libs/topic/Termination/Exit%20Status%20Stabilization/near/269804433" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Triplett <a href="https://zulip-archive.rust-lang.org/stream/219381-t-libs/topic/Termination.2FExit.20Status.20Stabilization.html#269804433">(Jan 28 2022 at 21:22)</a>:</h4>
<p>I'd like to not repeat that.</p>



<a name="269804470"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/219381-t-libs/topic/Termination/Exit%20Status%20Stabilization/near/269804470" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jane Lusby [she/her] <a href="https://zulip-archive.rust-lang.org/stream/219381-t-libs/topic/Termination.2FExit.20Status.20Stabilization.html#269804470">(Jan 28 2022 at 21:23)</a>:</h4>
<p>I still think we are leaving plenty of room to figure it out later, but I think we will have plenty of time to figure out the picture a bit better before we get anywhere near stabilization</p>



<a name="269804495"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/219381-t-libs/topic/Termination/Exit%20Status%20Stabilization/near/269804495" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jane Lusby [she/her] <a href="https://zulip-archive.rust-lang.org/stream/219381-t-libs/topic/Termination.2FExit.20Status.20Stabilization.html#269804495">(Jan 28 2022 at 21:23)</a>:</h4>
<p>so hopefully we can make this a moot point quickly</p>



<a name="269804517"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/219381-t-libs/topic/Termination/Exit%20Status%20Stabilization/near/269804517" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Triplett <a href="https://zulip-archive.rust-lang.org/stream/219381-t-libs/topic/Termination.2FExit.20Status.20Stabilization.html#269804517">(Jan 28 2022 at 21:23)</a>:</h4>
<p><span class="user-mention silent" data-user-id="220273">Jane Lusby [she/her]</span> <a href="#narrow/stream/219381-t-libs/topic/Termination.2FExit.20Status.20Stabilization/near/269802752">said</a>:</p>
<blockquote>
<p>like, do we want to only expose the minimal API for constructing ExitCodes that will behave consistently on all platforms?</p>
</blockquote>
<p>For my part, at least, I'd be happy with <code>impl From&lt;u8&gt; for ExitCode</code>. That's not necessarily 100% portable, but in practice if any platform didn't support it, it could just ignore it or translate into success/failure.</p>



<a name="269804618"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/219381-t-libs/topic/Termination/Exit%20Status%20Stabilization/near/269804618" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jane Lusby [she/her] <a href="https://zulip-archive.rust-lang.org/stream/219381-t-libs/topic/Termination.2FExit.20Status.20Stabilization.html#269804618">(Jan 28 2022 at 21:24)</a>:</h4>
<p>so the biggest concern I know about already on that axis is this one from the IRLO thread</p>



<a name="269804636"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/219381-t-libs/topic/Termination/Exit%20Status%20Stabilization/near/269804636" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jane Lusby [she/her] <a href="https://zulip-archive.rust-lang.org/stream/219381-t-libs/topic/Termination.2FExit.20Status.20Stabilization.html#269804636">(Jan 28 2022 at 21:24)</a>:</h4>
<blockquote>
<p>The Bourne shell further confuses the issue by mapping “signal” statuses onto 128 + signal number (i.e. if you observe the value 139 in $?, that could mean either exit code 139 or signal 11; there’s no way to tell). For this reason, good practice on Unix is to avoid using exit statuses above 127.</p>
</blockquote>



<a name="269804700"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/219381-t-libs/topic/Termination/Exit%20Status%20Stabilization/near/269804700" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jane Lusby [she/her] <a href="https://zulip-archive.rust-lang.org/stream/219381-t-libs/topic/Termination.2FExit.20Status.20Stabilization.html#269804700">(Jan 28 2022 at 21:24)</a>:</h4>
<p>By bourne shell here I'm assuming they're referring specifically to <code>sh</code>, not <code>bash</code> or its newer decendents</p>



<a name="269804709"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/219381-t-libs/topic/Termination/Exit%20Status%20Stabilization/near/269804709" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jane Lusby [she/her] <a href="https://zulip-archive.rust-lang.org/stream/219381-t-libs/topic/Termination.2FExit.20Status.20Stabilization.html#269804709">(Jan 28 2022 at 21:25)</a>:</h4>
<p>is that correct?</p>



<a name="269804788"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/219381-t-libs/topic/Termination/Exit%20Status%20Stabilization/near/269804788" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jane Lusby [she/her] <a href="https://zulip-archive.rust-lang.org/stream/219381-t-libs/topic/Termination.2FExit.20Status.20Stabilization.html#269804788">(Jan 28 2022 at 21:25)</a>:</h4>
<p><del>brb, gotta go write a quick rfc for u7 literals</del></p>



<a name="269804805"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/219381-t-libs/topic/Termination/Exit%20Status%20Stabilization/near/269804805" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Triplett <a href="https://zulip-archive.rust-lang.org/stream/219381-t-libs/topic/Termination.2FExit.20Status.20Stabilization.html#269804805">(Jan 28 2022 at 21:25)</a>:</h4>
<p><span class="user-mention silent" data-user-id="220273">Jane Lusby [she/her]</span> <a href="#narrow/stream/219381-t-libs/topic/Termination.2FExit.20Status.20Stabilization/near/269804700">said</a>:</p>
<blockquote>
<p>By bourne shell here I'm assuming they're referring specifically to <code>sh</code>, not <code>bash</code> or its newer decendents</p>
</blockquote>
<p>No, I think that's true of bourne-compatible shells in general.</p>



<a name="269804871"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/219381-t-libs/topic/Termination/Exit%20Status%20Stabilization/near/269804871" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> scottmcm <a href="https://zulip-archive.rust-lang.org/stream/219381-t-libs/topic/Termination.2FExit.20Status.20Stabilization.html#269804871">(Jan 28 2022 at 21:26)</a>:</h4>
<p>Hmm, is this one of the places where <code>From</code> is confusing?  Should it be named <code>new</code> instead?  Or would you want platform-specific <code>new</code>s with different types?</p>



<a name="269804914"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/219381-t-libs/topic/Termination/Exit%20Status%20Stabilization/near/269804914" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Triplett <a href="https://zulip-archive.rust-lang.org/stream/219381-t-libs/topic/Termination.2FExit.20Status.20Stabilization.html#269804914">(Jan 28 2022 at 21:26)</a>:</h4>
<div class="codehilite"><pre><span></span><code>~$ sleep 1000 ; echo $?
[In another window: `killall -SEGV sleep`]
Segmentation fault
139
</code></pre></div>



<a name="269804918"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/219381-t-libs/topic/Termination/Exit%20Status%20Stabilization/near/269804918" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jane Lusby [she/her] <a href="https://zulip-archive.rust-lang.org/stream/219381-t-libs/topic/Termination.2FExit.20Status.20Stabilization.html#269804918">(Jan 28 2022 at 21:26)</a>:</h4>
<p><span class="user-mention silent" data-user-id="239881">Josh Triplett</span> <a href="#narrow/stream/219381-t-libs/topic/Termination.2FExit.20Status.20Stabilization/near/269804805">said</a>:</p>
<blockquote>
<p><span class="user-mention silent" data-user-id="220273">Jane Lusby [she/her]</span> <a href="#narrow/stream/219381-t-libs/topic/Termination.2FExit.20Status.20Stabilization/near/269804700">said</a>:</p>
<blockquote>
<p>By bourne shell here I'm assuming they're referring specifically to <code>sh</code>, not <code>bash</code> or its newer decendents</p>
</blockquote>
<p>No, I think that's true of bourne-compatible shells in general.</p>
</blockquote>
<p>Then does this mean we should try to restrict the constructor to only work for <code>0-127</code>?</p>



<a name="269804952"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/219381-t-libs/topic/Termination/Exit%20Status%20Stabilization/near/269804952" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Triplett <a href="https://zulip-archive.rust-lang.org/stream/219381-t-libs/topic/Termination.2FExit.20Status.20Stabilization.html#269804952">(Jan 28 2022 at 21:26)</a>:</h4>
<p>No, because you actually can exit with 0-255 in UNIX and it'll return that.</p>



<a name="269804983"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/219381-t-libs/topic/Termination/Exit%20Status%20Stabilization/near/269804983" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Triplett <a href="https://zulip-archive.rust-lang.org/stream/219381-t-libs/topic/Termination.2FExit.20Status.20Stabilization.html#269804983">(Jan 28 2022 at 21:27)</a>:</h4>
<div class="codehilite"><pre><span></span><code>~$ sh -c &#39;exit 180&#39; ; echo $?
180
</code></pre></div>



<a name="269804997"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/219381-t-libs/topic/Termination/Exit%20Status%20Stabilization/near/269804997" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jane Lusby [she/her] <a href="https://zulip-archive.rust-lang.org/stream/219381-t-libs/topic/Termination.2FExit.20Status.20Stabilization.html#269804997">(Jan 28 2022 at 21:27)</a>:</h4>
<p>but like, why would someone want to return with a value &gt; 127 if its ambiguous?</p>



<a name="269805009"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/219381-t-libs/topic/Termination/Exit%20Status%20Stabilization/near/269805009" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jane Lusby [she/her] <a href="https://zulip-archive.rust-lang.org/stream/219381-t-libs/topic/Termination.2FExit.20Status.20Stabilization.html#269805009">(Jan 28 2022 at 21:27)</a>:</h4>
<p>is it possible to disambiguate?</p>



<a name="269805017"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/219381-t-libs/topic/Termination/Exit%20Status%20Stabilization/near/269805017" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Triplett <a href="https://zulip-archive.rust-lang.org/stream/219381-t-libs/topic/Termination.2FExit.20Status.20Stabilization.html#269805017">(Jan 28 2022 at 21:27)</a>:</h4>
<p>Because it's not actually ambiguous in the UNIX API, only in shells.</p>



<a name="269805026"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/219381-t-libs/topic/Termination/Exit%20Status%20Stabilization/near/269805026" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Connor Horman <a href="https://zulip-archive.rust-lang.org/stream/219381-t-libs/topic/Termination.2FExit.20Status.20Stabilization.html#269805026">(Jan 28 2022 at 21:27)</a>:</h4>
<p>You can disambiguate from the wait status code.</p>



<a name="269805035"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/219381-t-libs/topic/Termination/Exit%20Status%20Stabilization/near/269805035" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Triplett <a href="https://zulip-archive.rust-lang.org/stream/219381-t-libs/topic/Termination.2FExit.20Status.20Stabilization.html#269805035">(Jan 28 2022 at 21:27)</a>:</h4>
<p>In the API, you can ask "did this exit with a signal".</p>



<a name="269805119"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/219381-t-libs/topic/Termination/Exit%20Status%20Stabilization/near/269805119" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jane Lusby [she/her] <a href="https://zulip-archive.rust-lang.org/stream/219381-t-libs/topic/Termination.2FExit.20Status.20Stabilization.html#269805119">(Jan 28 2022 at 21:28)</a>:</h4>
<p>okay, so we say shells are fine, they made their own bed and they can disambiguate still if they need to</p>



<a name="269805132"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/219381-t-libs/topic/Termination/Exit%20Status%20Stabilization/near/269805132" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Triplett <a href="https://zulip-archive.rust-lang.org/stream/219381-t-libs/topic/Termination.2FExit.20Status.20Stabilization.html#269805132">(Jan 28 2022 at 21:28)</a>:</h4>
<p>Yup.</p>



<a name="269805142"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/219381-t-libs/topic/Termination/Exit%20Status%20Stabilization/near/269805142" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jane Lusby [she/her] <a href="https://zulip-archive.rust-lang.org/stream/219381-t-libs/topic/Termination.2FExit.20Status.20Stabilization.html#269805142">(Jan 28 2022 at 21:28)</a>:</h4>
<p>and we just go with a <code>u8</code> based constructor initially on <code>ExitCode</code></p>



<a name="269805164"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/219381-t-libs/topic/Termination/Exit%20Status%20Stabilization/near/269805164" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jane Lusby [she/her] <a href="https://zulip-archive.rust-lang.org/stream/219381-t-libs/topic/Termination.2FExit.20Status.20Stabilization.html#269805164">(Jan 28 2022 at 21:28)</a>:</h4>
<p>do you think that would be enough of a minimal API for stabilization?</p>



<a name="269805202"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/219381-t-libs/topic/Termination/Exit%20Status%20Stabilization/near/269805202" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> scottmcm <a href="https://zulip-archive.rust-lang.org/stream/219381-t-libs/topic/Termination.2FExit.20Status.20Stabilization.html#269805202">(Jan 28 2022 at 21:28)</a>:</h4>
<p><span class="user-mention silent" data-user-id="220273">Jane Lusby [she/her]</span> <a href="#narrow/stream/219381-t-libs/topic/Termination.2FExit.20Status.20Stabilization/near/269804788">said</a>:</p>
<blockquote>
<p><del>brb, gotta go write a quick rfc for u7 literals</del></p>
</blockquote>
<p>I'd love to have <code>u7</code> and <code>u31</code> and <code>usizeminusone</code>, TBH.  <code>usizeminusone</code> especially is the correct type for a whole bunch of things, because of the <code>GEP</code> restrictions, and having <code>u31: Into&lt;u32&gt; + Into&lt;i32&gt;</code> would also be nice.  Not to mention the niche advantages like why OCaml (iirc) uses <code>i63</code> as its "normal" integral type.</p>
<p>But realistically that'll be best done as a smart const generic width type.</p>



<a name="269805241"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/219381-t-libs/topic/Termination/Exit%20Status%20Stabilization/near/269805241" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Triplett <a href="https://zulip-archive.rust-lang.org/stream/219381-t-libs/topic/Termination.2FExit.20Status.20Stabilization.html#269805241">(Jan 28 2022 at 21:29)</a>:</h4>
<p><span class="user-mention silent" data-user-id="220273">Jane Lusby [she/her]</span> <a href="#narrow/stream/219381-t-libs/topic/Termination.2FExit.20Status.20Stabilization/near/269805164">said</a>:</p>
<blockquote>
<p>do you think that would be enough of a minimal API for stabilization?</p>
</blockquote>
<p>I'd be happy to see that. We could potentially add a (sealed) <code>ExitCodeExt</code> on Windows that lets you exit with a wider range of values, but that doesn't have to be in the initial PR.</p>



<a name="269805248"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/219381-t-libs/topic/Termination/Exit%20Status%20Stabilization/near/269805248" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jane Lusby [she/her] <a href="https://zulip-archive.rust-lang.org/stream/219381-t-libs/topic/Termination.2FExit.20Status.20Stabilization.html#269805248">(Jan 28 2022 at 21:29)</a>:</h4>
<p>llvmification</p>



<a name="269805316"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/219381-t-libs/topic/Termination/Exit%20Status%20Stabilization/near/269805316" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Triplett <a href="https://zulip-archive.rust-lang.org/stream/219381-t-libs/topic/Termination.2FExit.20Status.20Stabilization.html#269805316">(Jan 28 2022 at 21:30)</a>:</h4>
<p>I'm genuinely sad that POSIX doesn't allow you to "exit" with an "I died from this signal" wait status.</p>



<a name="269805332"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/219381-t-libs/topic/Termination/Exit%20Status%20Stabilization/near/269805332" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Triplett <a href="https://zulip-archive.rust-lang.org/stream/219381-t-libs/topic/Termination.2FExit.20Status.20Stabilization.html#269805332">(Jan 28 2022 at 21:30)</a>:</h4>
<p>I have a real-world use case for that.</p>



<a name="269805334"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/219381-t-libs/topic/Termination/Exit%20Status%20Stabilization/near/269805334" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Connor Horman <a href="https://zulip-archive.rust-lang.org/stream/219381-t-libs/topic/Termination.2FExit.20Status.20Stabilization.html#269805334">(Jan 28 2022 at 21:30)</a>:</h4>
<p>What about wrapping a C interface that returns <code>int</code> like main. There should be a way to do that from Rust.</p>



<a name="269805418"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/219381-t-libs/topic/Termination/Exit%20Status%20Stabilization/near/269805418" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Triplett <a href="https://zulip-archive.rust-lang.org/stream/219381-t-libs/topic/Termination.2FExit.20Status.20Stabilization.html#269805418">(Jan 28 2022 at 21:31)</a>:</h4>
<p><span class="user-mention" data-user-id="257758">@Connor Horman</span> As in, you're building Rust to embed into a C interface callable via a main-like function?</p>



<a name="269805448"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/219381-t-libs/topic/Termination/Exit%20Status%20Stabilization/near/269805448" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Triplett <a href="https://zulip-archive.rust-lang.org/stream/219381-t-libs/topic/Termination.2FExit.20Status.20Stabilization.html#269805448">(Jan 28 2022 at 21:31)</a>:</h4>
<p>And the expected way to provide an exit code is to return it from that interface?</p>



<a name="269805459"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/219381-t-libs/topic/Termination/Exit%20Status%20Stabilization/near/269805459" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> scottmcm <a href="https://zulip-archive.rust-lang.org/stream/219381-t-libs/topic/Termination.2FExit.20Status.20Stabilization.html#269805459">(Jan 28 2022 at 21:31)</a>:</h4>
<p><span class="user-mention silent" data-user-id="257758">Connor Horman</span> <a href="#narrow/stream/219381-t-libs/topic/Termination.2FExit.20Status.20Stabilization/near/269805334">said</a>:</p>
<blockquote>
<p>What about wrapping a C interface that returns <code>int</code> like main. There should be a way to do that from Rust.</p>
</blockquote>
<p>Can always call <code>std::process::exit</code> if you just need to return the same thing C would.</p>



<a name="269805463"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/219381-t-libs/topic/Termination/Exit%20Status%20Stabilization/near/269805463" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Triplett <a href="https://zulip-archive.rust-lang.org/stream/219381-t-libs/topic/Termination.2FExit.20Status.20Stabilization.html#269805463">(Jan 28 2022 at 21:31)</a>:</h4>
<p>(How would <code>std::process::exit</code> be implemented in that context?)</p>



<a name="269805480"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/219381-t-libs/topic/Termination/Exit%20Status%20Stabilization/near/269805480" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Connor Horman <a href="https://zulip-archive.rust-lang.org/stream/219381-t-libs/topic/Termination.2FExit.20Status.20Stabilization.html#269805480">(Jan 28 2022 at 21:31)</a>:</h4>
<p>Yeah. And if you can get the benefits of just returning from main that would be good.</p>



<a name="269805499"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/219381-t-libs/topic/Termination/Exit%20Status%20Stabilization/near/269805499" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jane Lusby [she/her] <a href="https://zulip-archive.rust-lang.org/stream/219381-t-libs/topic/Termination.2FExit.20Status.20Stabilization.html#269805499">(Jan 28 2022 at 21:31)</a>:</h4>
<p><span class="user-mention silent" data-user-id="239881">Josh Triplett</span> <a href="#narrow/stream/219381-t-libs/topic/Termination.2FExit.20Status.20Stabilization/near/269805241">said</a>:</p>
<blockquote>
<p><span class="user-mention silent" data-user-id="220273">Jane Lusby [she/her]</span> <a href="#narrow/stream/219381-t-libs/topic/Termination.2FExit.20Status.20Stabilization/near/269805164">said</a>:</p>
<blockquote>
<p>do you think that would be enough of a minimal API for stabilization?</p>
</blockquote>
<p>I'd be happy to see that. We could potentially add a (sealed) <code>ExitCodeExt</code> on Windows that lets you exit with a wider range of values, but that doesn't have to be in the initial PR.</p>
</blockquote>
<p>sounds good, I'll add that as a separate PR, gonna start with just a <code>new</code> inherent method and we can discuss adding a <code>From</code> impl separately</p>



<a name="269805501"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/219381-t-libs/topic/Termination/Exit%20Status%20Stabilization/near/269805501" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Connor Horman <a href="https://zulip-archive.rust-lang.org/stream/219381-t-libs/topic/Termination.2FExit.20Status.20Stabilization.html#269805501">(Jan 28 2022 at 21:31)</a>:</h4>
<p>Or, no. The other way arround</p>



<a name="269805568"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/219381-t-libs/topic/Termination/Exit%20Status%20Stabilization/near/269805568" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Connor Horman <a href="https://zulip-archive.rust-lang.org/stream/219381-t-libs/topic/Termination.2FExit.20Status.20Stabilization.html#269805568">(Jan 28 2022 at 21:32)</a>:</h4>
<p>Calling a C function that looks like main (something like SDL_main).</p>



<a name="269805624"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/219381-t-libs/topic/Termination/Exit%20Status%20Stabilization/near/269805624" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Connor Horman <a href="https://zulip-archive.rust-lang.org/stream/219381-t-libs/topic/Termination.2FExit.20Status.20Stabilization.html#269805624">(Jan 28 2022 at 21:32)</a>:</h4>
<p>Having the ability to do this while also cleaning up local destructors would be nice (without having to do the trampoline thing you currently already do).</p>



<a name="269805691"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/219381-t-libs/topic/Termination/Exit%20Status%20Stabilization/near/269805691" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Connor Horman <a href="https://zulip-archive.rust-lang.org/stream/219381-t-libs/topic/Termination.2FExit.20Status.20Stabilization.html#269805691">(Jan 28 2022 at 21:33)</a>:</h4>
<p><span class="user-mention silent" data-user-id="239881">Josh Triplett</span> <a href="#narrow/stream/219381-t-libs/topic/Termination.2FExit.20Status.20Stabilization/near/269805332">said</a>:</p>
<blockquote>
<p>I have a real-world use case for that.</p>
</blockquote>
<p>Assuming no other threads, and the signal has default action of Terminate, <code>signal(signo; SIG_DFL); raise(signo);</code> works for this.</p>



<a name="269805823"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/219381-t-libs/topic/Termination/Exit%20Status%20Stabilization/near/269805823" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> scottmcm <a href="https://zulip-archive.rust-lang.org/stream/219381-t-libs/topic/Termination.2FExit.20Status.20Stabilization.html#269805823">(Jan 28 2022 at 21:34)</a>:</h4>
<p>Would it be tolerable for <code>impl Termination for ExitStatus</code> to re-raise a signal?</p>
<p>(I don't really know anything about signals)</p>



<a name="269805895"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/219381-t-libs/topic/Termination/Exit%20Status%20Stabilization/near/269805895" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Connor Horman <a href="https://zulip-archive.rust-lang.org/stream/219381-t-libs/topic/Termination.2FExit.20Status.20Stabilization.html#269805895">(Jan 28 2022 at 21:34)</a>:</h4>
<p>It would be a problem if a signal handler was installed for the signal, or the signal was ignored.</p>



<a name="269805963"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/219381-t-libs/topic/Termination/Exit%20Status%20Stabilization/near/269805963" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Triplett <a href="https://zulip-archive.rust-lang.org/stream/219381-t-libs/topic/Termination.2FExit.20Status.20Stabilization.html#269805963">(Jan 28 2022 at 21:35)</a>:</h4>
<p><span class="user-mention silent" data-user-id="257758">Connor Horman</span> <a href="#narrow/stream/219381-t-libs/topic/Termination.2FExit.20Status.20Stabilization/near/269805691">said</a>:</p>
<blockquote>
<p><span class="user-mention silent" data-user-id="239881">Josh Triplett</span> <a href="#narrow/stream/219381-t-libs/topic/Termination.2FExit.20Status.20Stabilization/near/269805332">said</a>:</p>
<blockquote>
<p>I have a real-world use case for that.</p>
</blockquote>
<p>Assuming no other threads, and the signal has default action of Terminate, <code>signal(signo; SIG_DFL); raise(signo);</code> works for this.</p>
</blockquote>
<p>Yeah, I could do that, it's just not ideal. And in particular, I don't actually want to dump core for signals whose default termination dumps core.</p>



<a name="269806279"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/219381-t-libs/topic/Termination/Exit%20Status%20Stabilization/near/269806279" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Connor Horman <a href="https://zulip-archive.rust-lang.org/stream/219381-t-libs/topic/Termination.2FExit.20Status.20Stabilization.html#269806279">(Jan 28 2022 at 21:38)</a>:</h4>
<p>Yeah, plus the free race condition in a multithreaded program.</p>



<a name="269806300"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/219381-t-libs/topic/Termination/Exit%20Status%20Stabilization/near/269806300" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jane Lusby [she/her] <a href="https://zulip-archive.rust-lang.org/stream/219381-t-libs/topic/Termination.2FExit.20Status.20Stabilization.html#269806300">(Jan 28 2022 at 21:38)</a>:</h4>
<p>Hmm, actually one argument against using <code>new</code> instead of <code>from</code> is that <code>from</code> can at least be effectively overloaded as we add more ways to construct, if we make <code>new</code> take a <code>u8</code> then any other constructors will feel decidedly second class</p>



<a name="269806312"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/219381-t-libs/topic/Termination/Exit%20Status%20Stabilization/near/269806312" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Triplett <a href="https://zulip-archive.rust-lang.org/stream/219381-t-libs/topic/Termination.2FExit.20Status.20Stabilization.html#269806312">(Jan 28 2022 at 21:38)</a>:</h4>
<p><span class="user-mention" data-user-id="257758">@Connor Horman</span> Fortunately I'm not multithreaded at the point where I'm exiting.</p>



<a name="269806355"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/219381-t-libs/topic/Termination/Exit%20Status%20Stabilization/near/269806355" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Triplett <a href="https://zulip-archive.rust-lang.org/stream/219381-t-libs/topic/Termination.2FExit.20Status.20Stabilization.html#269806355">(Jan 28 2022 at 21:38)</a>:</h4>
<p><span class="user-mention" data-user-id="220273">@Jane Lusby [she/her]</span> Yeah, agreed.</p>



<a name="269806365"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/219381-t-libs/topic/Termination/Exit%20Status%20Stabilization/near/269806365" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Triplett <a href="https://zulip-archive.rust-lang.org/stream/219381-t-libs/topic/Termination.2FExit.20Status.20Stabilization.html#269806365">(Jan 28 2022 at 21:38)</a>:</h4>
<p>That was my rationale for <code>From</code>.</p>



<a name="269806393"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/219381-t-libs/topic/Termination/Exit%20Status%20Stabilization/near/269806393" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jane Lusby [she/her] <a href="https://zulip-archive.rust-lang.org/stream/219381-t-libs/topic/Termination.2FExit.20Status.20Stabilization.html#269806393">(Jan 28 2022 at 21:39)</a>:</h4>
<p>yea, I just always feel like <code>From</code> is spooky because of overlap bullshit I've run into in error handling land</p>



<a name="269806402"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/219381-t-libs/topic/Termination/Exit%20Status%20Stabilization/near/269806402" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jane Lusby [she/her] <a href="https://zulip-archive.rust-lang.org/stream/219381-t-libs/topic/Termination.2FExit.20Status.20Stabilization.html#269806402">(Jan 28 2022 at 21:39)</a>:</h4>
<p>so I'm always a bit more cautious adding trait methods vs inherent methods</p>



<a name="269806414"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/219381-t-libs/topic/Termination/Exit%20Status%20Stabilization/near/269806414" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jane Lusby [she/her] <a href="https://zulip-archive.rust-lang.org/stream/219381-t-libs/topic/Termination.2FExit.20Status.20Stabilization.html#269806414">(Jan 28 2022 at 21:39)</a>:</h4>
<p>but I cant see how that would become an issue here</p>



<a name="269806428"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/219381-t-libs/topic/Termination/Exit%20Status%20Stabilization/near/269806428" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jane Lusby [she/her] <a href="https://zulip-archive.rust-lang.org/stream/219381-t-libs/topic/Termination.2FExit.20Status.20Stabilization.html#269806428">(Jan 28 2022 at 21:39)</a>:</h4>
<p>so fuck it, doing <code>From</code></p>



<a name="269807549"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/219381-t-libs/topic/Termination/Exit%20Status%20Stabilization/near/269807549" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> scottmcm <a href="https://zulip-archive.rust-lang.org/stream/219381-t-libs/topic/Termination.2FExit.20Status.20Stabilization.html#269807549">(Jan 28 2022 at 21:50)</a>:</h4>
<p>And my "would TryFrom the other way be reasonable" heuristic is fine, I think, so I guess <code>From</code> is fine.</p>



<a name="269807595"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/219381-t-libs/topic/Termination/Exit%20Status%20Stabilization/near/269807595" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> scottmcm <a href="https://zulip-archive.rust-lang.org/stream/219381-t-libs/topic/Termination.2FExit.20Status.20Stabilization.html#269807595">(Jan 28 2022 at 21:50)</a>:</h4>
<p>(Albeit perhaps a bit weird if the type itself collapses to bool, instead of only doing that in<code> Termination</code>.)</p>



<a name="269807695"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/219381-t-libs/topic/Termination/Exit%20Status%20Stabilization/near/269807695" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jane Lusby [she/her] <a href="https://zulip-archive.rust-lang.org/stream/219381-t-libs/topic/Termination.2FExit.20Status.20Stabilization.html#269807695">(Jan 28 2022 at 21:51)</a>:</h4>
<p><span class="user-mention silent" data-user-id="125270">scottmcm</span> <a href="#narrow/stream/219381-t-libs/topic/Termination.2FExit.20Status.20Stabilization/near/269807595">said</a>:</p>
<blockquote>
<p>(Albeit perhaps a bit weird if the type itself collapses to bool, instead of only doing that in<code> Termination</code>.)</p>
</blockquote>
<p>the <code>unsupported</code> imp module does only store a bool internally</p>



<a name="269807744"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/219381-t-libs/topic/Termination/Exit%20Status%20Stabilization/near/269807744" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jane Lusby [she/her] <a href="https://zulip-archive.rust-lang.org/stream/219381-t-libs/topic/Termination.2FExit.20Status.20Stabilization.html#269807744">(Jan 28 2022 at 21:51)</a>:</h4>
<p>not sure if that's what you meant by collapsing to a bool</p>



<a name="269807802"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/219381-t-libs/topic/Termination/Exit%20Status%20Stabilization/near/269807802" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jane Lusby [she/her] <a href="https://zulip-archive.rust-lang.org/stream/219381-t-libs/topic/Termination.2FExit.20Status.20Stabilization.html#269807802">(Jan 28 2022 at 21:52)</a>:</h4>
<p>but we wouldn't be able to round trip a u8 thru ExitCode on wasm I'm guessing?</p>



<a name="269807822"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/219381-t-libs/topic/Termination/Exit%20Status%20Stabilization/near/269807822" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jane Lusby [she/her] <a href="https://zulip-archive.rust-lang.org/stream/219381-t-libs/topic/Termination.2FExit.20Status.20Stabilization.html#269807822">(Jan 28 2022 at 21:52)</a>:</h4>
<p>not sure what other platforms fall under <code>unsupported</code></p>



<a name="269808257"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/219381-t-libs/topic/Termination/Exit%20Status%20Stabilization/near/269808257" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jane Lusby [she/her] <a href="https://zulip-archive.rust-lang.org/stream/219381-t-libs/topic/Termination.2FExit.20Status.20Stabilization.html#269808257">(Jan 28 2022 at 21:56)</a>:</h4>
<p>Related to the <code>From&lt;u8&gt;</code> impl and the test output when the code isn't 0, do we support any platforms where <code>ExitCode</code> isn't 0 / do we want to maintain the abstraction that <code>ExitCode::SUCCESS</code> isn't necessarily a 0?</p>



<a name="269808475"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/219381-t-libs/topic/Termination/Exit%20Status%20Stabilization/near/269808475" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> scottmcm <a href="https://zulip-archive.rust-lang.org/stream/219381-t-libs/topic/Termination.2FExit.20Status.20Stabilization.html#269808475">(Jan 28 2022 at 21:58)</a>:</h4>
<p><a href="https://doc.rust-lang.org/std/process/struct.ExitStatus.html#method.success">https://doc.rust-lang.org/std/process/struct.ExitStatus.html#method.success</a> defines success to be <code>0</code>, FWIW</p>



<a name="269808503"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/219381-t-libs/topic/Termination/Exit%20Status%20Stabilization/near/269808503" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> The 8472 <a href="https://zulip-archive.rust-lang.org/stream/219381-t-libs/topic/Termination.2FExit.20Status.20Stabilization.html#269808503">(Jan 28 2022 at 21:58)</a>:</h4>
<p>Which platform only supports <code>exit(u8)</code>?</p>



<a name="269808533"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/219381-t-libs/topic/Termination/Exit%20Status%20Stabilization/near/269808533" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jane Lusby [she/her] <a href="https://zulip-archive.rust-lang.org/stream/219381-t-libs/topic/Termination.2FExit.20Status.20Stabilization.html#269808533">(Jan 28 2022 at 21:59)</a>:</h4>
<p><span class="user-mention silent" data-user-id="330154">The 8472</span> <a href="#narrow/stream/219381-t-libs/topic/Termination.2FExit.20Status.20Stabilization/near/269808503">said</a>:</p>
<blockquote>
<p>Which platform only supports <code>exit(u8)</code>?</p>
</blockquote>
<p>various unix platforms I think</p>



<a name="269808551"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/219381-t-libs/topic/Termination/Exit%20Status%20Stabilization/near/269808551" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jane Lusby [she/her] <a href="https://zulip-archive.rust-lang.org/stream/219381-t-libs/topic/Termination.2FExit.20Status.20Stabilization.html#269808551">(Jan 28 2022 at 21:59)</a>:</h4>
<p><a href="https://internals.rust-lang.org/t/mini-pre-rfc-redesigning-process-exitstatus/5426">https://internals.rust-lang.org/t/mini-pre-rfc-redesigning-process-exitstatus/5426</a> has a detailed rundown</p>



<a name="269808694"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/219381-t-libs/topic/Termination/Exit%20Status%20Stabilization/near/269808694" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> cuviper <a href="https://zulip-archive.rust-lang.org/stream/219381-t-libs/topic/Termination.2FExit.20Status.20Stabilization.html#269808694">(Jan 28 2022 at 22:00)</a>:</h4>
<p>The docs on <code>exit</code> also mention that the value is masked to just the lower 8 bits on Linux</p>



<a name="269808733"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/219381-t-libs/topic/Termination/Exit%20Status%20Stabilization/near/269808733" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jane Lusby [she/her] <a href="https://zulip-archive.rust-lang.org/stream/219381-t-libs/topic/Termination.2FExit.20Status.20Stabilization.html#269808733">(Jan 28 2022 at 22:00)</a>:</h4>
<p><span class="user-mention silent" data-user-id="125270">scottmcm</span> <a href="#narrow/stream/219381-t-libs/topic/Termination.2FExit.20Status.20Stabilization/near/269808475">said</a>:</p>
<blockquote>
<p><a href="https://doc.rust-lang.org/std/process/struct.ExitStatus.html#method.success">https://doc.rust-lang.org/std/process/struct.ExitStatus.html#method.success</a> defines success to be <code>0</code>, FWIW</p>
</blockquote>
<p>hmm, then maybe it's okay to just codify that everywhere as a language level requirement for our exit codes, and if we ever run into a platform that violates that we can do the mapping in the runtime after we've returned the ExitCode</p>



<a name="269808935"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/219381-t-libs/topic/Termination/Exit%20Status%20Stabilization/near/269808935" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> The 8472 <a href="https://zulip-archive.rust-lang.org/stream/219381-t-libs/topic/Termination.2FExit.20Status.20Stabilization.html#269808935">(Jan 28 2022 at 22:01)</a>:</h4>
<p>If I understand that correctly they all take an int (i32), just some can't return it to the parent.</p>



<a name="269809015"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/219381-t-libs/topic/Termination/Exit%20Status%20Stabilization/near/269809015" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jane Lusby [she/her] <a href="https://zulip-archive.rust-lang.org/stream/219381-t-libs/topic/Termination.2FExit.20Status.20Stabilization.html#269809015">(Jan 28 2022 at 22:02)</a>:</h4>
<p>what's the practical difference?</p>



<a name="269809077"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/219381-t-libs/topic/Termination/Exit%20Status%20Stabilization/near/269809077" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> The 8472 <a href="https://zulip-archive.rust-lang.org/stream/219381-t-libs/topic/Termination.2FExit.20Status.20Stabilization.html#269809077">(Jan 28 2022 at 22:03)</a>:</h4>
<p>So I think it should be fine to call exit with i32 and then when the systems improve their posix-compliance also report that in the status of a child</p>



<a name="269809284"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/219381-t-libs/topic/Termination/Exit%20Status%20Stabilization/near/269809284" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jane Lusby [she/her] <a href="https://zulip-archive.rust-lang.org/stream/219381-t-libs/topic/Termination.2FExit.20Status.20Stabilization.html#269809284">(Jan 28 2022 at 22:05)</a>:</h4>
<p>Why should we prefer to just expose i32 directly rather than trying to push users towards the minimal subset that is mostly cross platform with platform specific extension APIs for constructing from i32 / u32 or w/e for those platforms?</p>



<a name="269809321"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/219381-t-libs/topic/Termination/Exit%20Status%20Stabilization/near/269809321" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jane Lusby [she/her] <a href="https://zulip-archive.rust-lang.org/stream/219381-t-libs/topic/Termination.2FExit.20Status.20Stabilization.html#269809321">(Jan 28 2022 at 22:05)</a>:</h4>
<p>I don't understand what you're saying we should be doing or what the justification is <span class="user-mention" data-user-id="330154">@The 8472</span></p>



<a name="269809371"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/219381-t-libs/topic/Termination/Exit%20Status%20Stabilization/near/269809371" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jane Lusby [she/her] <a href="https://zulip-archive.rust-lang.org/stream/219381-t-libs/topic/Termination.2FExit.20Status.20Stabilization.html#269809371">(Jan 28 2022 at 22:06)</a>:</h4>
<p><span class="user-mention silent" data-user-id="220273">Jane Lusby [she/her]</span> <a href="#narrow/stream/219381-t-libs/topic/Termination.2FExit.20Status.20Stabilization/near/269809284">said</a>:</p>
<blockquote>
<p>Why should we prefer to just expose i32 directly rather than trying to push users towards the minimal subset that is mostly cross platform with platform specific extension APIs for constructing from i32 / u32 or w/e for those platforms?</p>
</blockquote>
<p>In this I'm guessing you mean we should just impl <code>From&lt;i32&gt; for ExitStatus</code> rather than <code>From&lt;u8&gt;</code>, is that accurate?</p>



<a name="269809426"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/219381-t-libs/topic/Termination/Exit%20Status%20Stabilization/near/269809426" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> The 8472 <a href="https://zulip-archive.rust-lang.org/stream/219381-t-libs/topic/Termination.2FExit.20Status.20Stabilization.html#269809426">(Jan 28 2022 at 22:06)</a>:</h4>
<p>yeah</p>



<a name="269809443"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/219381-t-libs/topic/Termination/Exit%20Status%20Stabilization/near/269809443" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> The 8472 <a href="https://zulip-archive.rust-lang.org/stream/219381-t-libs/topic/Termination.2FExit.20Status.20Stabilization.html#269809443">(Jan 28 2022 at 22:06)</a>:</h4>
<p>needs fewer cfg's</p>



<a name="269809501"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/219381-t-libs/topic/Termination/Exit%20Status%20Stabilization/near/269809501" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jane Lusby [she/her] <a href="https://zulip-archive.rust-lang.org/stream/219381-t-libs/topic/Termination.2FExit.20Status.20Stabilization.html#269809501">(Jan 28 2022 at 22:07)</a>:</h4>
<p>can you give me a rough example of when you'd want to use the i32 one and what the equivalent cfg'ed version would look like?</p>



<a name="269809940"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/219381-t-libs/topic/Termination/Exit%20Status%20Stabilization/near/269809940" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jane Lusby [she/her] <a href="https://zulip-archive.rust-lang.org/stream/219381-t-libs/topic/Termination.2FExit.20Status.20Stabilization.html#269809940">(Jan 28 2022 at 22:11)</a>:</h4>
<p><a href="https://github.com/rust-lang/rust/pull/93445">https://github.com/rust-lang/rust/pull/93445</a></p>



<a name="269810124"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/219381-t-libs/topic/Termination/Exit%20Status%20Stabilization/near/269810124" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> The 8472 <a href="https://zulip-archive.rust-lang.org/stream/219381-t-libs/topic/Termination.2FExit.20Status.20Stabilization.html#269810124">(Jan 28 2022 at 22:13)</a>:</h4>
<p>Well, since it can immediately be used as Termination I don't have a concrete use, but, maybe forwarding it over IPC or something? If the From impls were platform-specific then you'd need cfgs to forward 32bit error codes on windows and 8bit ones on unix.</p>



<a name="269810131"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/219381-t-libs/topic/Termination/Exit%20Status%20Stabilization/near/269810131" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jane Lusby [she/her] <a href="https://zulip-archive.rust-lang.org/stream/219381-t-libs/topic/Termination.2FExit.20Status.20Stabilization.html#269810131">(Jan 28 2022 at 22:13)</a>:</h4>
<p>once those two PRs I've posted have landed I'll open a stabilization PR for termination which we can use for the remaining discussion leading up to stabilization rather than the <code>?</code>-in-main tracking issue</p>



<a name="269810211"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/219381-t-libs/topic/Termination/Exit%20Status%20Stabilization/near/269810211" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> The 8472 <a href="https://zulip-archive.rust-lang.org/stream/219381-t-libs/topic/Termination.2FExit.20Status.20Stabilization.html#269810211">(Jan 28 2022 at 22:14)</a>:</h4>
<p>But since exit() already takes 32bit values that doesn't seem necessary. Getting the full 32bits out on the other side is a separate problem.</p>



<a name="269810232"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/219381-t-libs/topic/Termination/Exit%20Status%20Stabilization/near/269810232" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Triplett <a href="https://zulip-archive.rust-lang.org/stream/219381-t-libs/topic/Termination.2FExit.20Status.20Stabilization.html#269810232">(Jan 28 2022 at 22:14)</a>:</h4>
<p><span class="user-mention silent" data-user-id="330154">The 8472</span> <a href="#narrow/stream/219381-t-libs/topic/Termination.2FExit.20Status.20Stabilization/near/269810124">said</a>:</p>
<blockquote>
<p>Well, since it can immediately be used as Termination I don't have a concrete use, but, maybe forwarding it over IPC or something? If the From impls were platform-specific then you'd need cfgs to forward 32bit error codes on windows and 8bit ones on unix.</p>
</blockquote>
<p>You wouldn't need <code>cfg</code>s for fowarding, if the API you're forwarding from can give you an <code>ExitCode</code>. And if it can't, you're calling a platform-specific API anyway.</p>



<a name="269810294"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/219381-t-libs/topic/Termination/Exit%20Status%20Stabilization/near/269810294" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> The 8472 <a href="https://zulip-archive.rust-lang.org/stream/219381-t-libs/topic/Termination.2FExit.20Status.20Stabilization.html#269810294">(Jan 28 2022 at 22:15)</a>:</h4>
<p>See the IPC part. Sending it over a socket for example.</p>



<a name="269810430"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/219381-t-libs/topic/Termination/Exit%20Status%20Stabilization/near/269810430" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jane Lusby [she/her] <a href="https://zulip-archive.rust-lang.org/stream/219381-t-libs/topic/Termination.2FExit.20Status.20Stabilization.html#269810430">(Jan 28 2022 at 22:15)</a>:</h4>
<p>okay but, independent of this specific question, because we're using <code>From</code> for the <code>u8</code> we can easily add <code>From&lt;i32&gt;</code> in  the future if we have motivating examples justifying it</p>



<a name="269810555"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/219381-t-libs/topic/Termination/Exit%20Status%20Stabilization/near/269810555" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jane Lusby [she/her] <a href="https://zulip-archive.rust-lang.org/stream/219381-t-libs/topic/Termination.2FExit.20Status.20Stabilization.html#269810555">(Jan 28 2022 at 22:16)</a>:</h4>
<p>so <span class="user-mention" data-user-id="330154">@The 8472</span> is it fair to assume you'd be okay with just stabilizing the <code>From&lt;u8&gt;</code> initially?</p>



<a name="269810617"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/219381-t-libs/topic/Termination/Exit%20Status%20Stabilization/near/269810617" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Lokathor <a href="https://zulip-archive.rust-lang.org/stream/219381-t-libs/topic/Termination.2FExit.20Status.20Stabilization.html#269810617">(Jan 28 2022 at 22:16)</a>:</h4>
<blockquote>
<p>related to this, if someone calls <code>std::process::exit</code> in <code>Termination::report</code>, how many destructors do we not run that would otherwise have been run?</p>
</blockquote>
<p>The entire call stack.</p>
<blockquote>
<p>would this affect things in statics?</p>
</blockquote>
<p>static things by definition "live until the end of the program". In other words, they don't drop because if they did there would be a moment in the program when they aren't alive anymore.</p>



<a name="269810888"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/219381-t-libs/topic/Termination/Exit%20Status%20Stabilization/near/269810888" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jane Lusby [she/her] <a href="https://zulip-archive.rust-lang.org/stream/219381-t-libs/topic/Termination.2FExit.20Status.20Stabilization.html#269810888">(Jan 28 2022 at 22:17)</a>:</h4>
<p><code>The entire call stack.</code> but by the time you've returned from main you've already taken down the entire callstack, right?</p>



<a name="269811008"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/219381-t-libs/topic/Termination/Exit%20Status%20Stabilization/near/269811008" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jane Lusby [she/her] <a href="https://zulip-archive.rust-lang.org/stream/219381-t-libs/topic/Termination.2FExit.20Status.20Stabilization.html#269811008">(Jan 28 2022 at 22:18)</a>:</h4>
<p>also dang, do we really _never_ call drops on statics? I know we don't in some cases because it's fucked up flushing some tracing subscriber layers I've worked on, but I couldn't remember if it was an always thing or only on certain exits</p>



<a name="269811231"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/219381-t-libs/topic/Termination/Exit%20Status%20Stabilization/near/269811231" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Lokathor <a href="https://zulip-archive.rust-lang.org/stream/219381-t-libs/topic/Termination.2FExit.20Status.20Stabilization.html#269811231">(Jan 28 2022 at 22:20)</a>:</h4>
<p>yeah if you exit from "outside of main" then the rest of the program would by definition already be dealt with.</p>
<p>however where that would be logically doesn't entirely make sense because right now rust specifically doesn't have a life before main so there's no place for main to return to. So you'd have to define that</p>



<a name="269811378"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/219381-t-libs/topic/Termination/Exit%20Status%20Stabilization/near/269811378" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> The 8472 <a href="https://zulip-archive.rust-lang.org/stream/219381-t-libs/topic/Termination.2FExit.20Status.20Stabilization.html#269811378">(Jan 28 2022 at 22:21)</a>:</h4>
<p><span class="user-mention" data-user-id="220273">@Jane Lusby [she/her]</span> I guess it's ok to avoid surprises about truncation</p>



<a name="269811540"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/219381-t-libs/topic/Termination/Exit%20Status%20Stabilization/near/269811540" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jane Lusby [she/her] <a href="https://zulip-archive.rust-lang.org/stream/219381-t-libs/topic/Termination.2FExit.20Status.20Stabilization.html#269811540">(Jan 28 2022 at 22:22)</a>:</h4>
<p><span class="user-mention silent" data-user-id="224471">Lokathor</span> <a href="#narrow/stream/219381-t-libs/topic/Termination.2FExit.20Status.20Stabilization/near/269811231">said</a>:</p>
<blockquote>
<p>yeah if you exit from "outside of main" then the rest of the program would by definition already be dealt with.</p>
<p>however where that would be logically doesn't entirely make sense because right now rust specifically doesn't have a life before main so there's no place for main to return to. So you'd have to define that</p>
</blockquote>
<p>In practice we do have life after main though through stable <code>?</code> in main: <a href="https://github.com/rust-lang/rust/pull/93442/files#diff-4c47313bf04136516af411c803a91862020d8dbc02afdc9a6653c6d7e4709f7bR145">https://github.com/rust-lang/rust/pull/93442/files#diff-4c47313bf04136516af411c803a91862020d8dbc02afdc9a6653c6d7e4709f7bR145</a></p>



<a name="269811604"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/219381-t-libs/topic/Termination/Exit%20Status%20Stabilization/near/269811604" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jane Lusby [she/her] <a href="https://zulip-archive.rust-lang.org/stream/219381-t-libs/topic/Termination.2FExit.20Status.20Stabilization.html#269811604">(Jan 28 2022 at 22:23)</a>:</h4>
<p>Like, the only time calling <code>std::process::exit</code> in <code>Termination</code> would ever potentially not happen after main is if someone calls <code>Termination::report</code> manually in their own code</p>



<a name="269811703"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/219381-t-libs/topic/Termination/Exit%20Status%20Stabilization/near/269811703" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jane Lusby [she/her] <a href="https://zulip-archive.rust-lang.org/stream/219381-t-libs/topic/Termination.2FExit.20Status.20Stabilization.html#269811703">(Jan 28 2022 at 22:24)</a>:</h4>
<p>and I'm not sure we should really be overly concerned with that potential avenue of misuse(is it even?)</p>



<a name="269811758"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/219381-t-libs/topic/Termination/Exit%20Status%20Stabilization/near/269811758" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jane Lusby [she/her] <a href="https://zulip-archive.rust-lang.org/stream/219381-t-libs/topic/Termination.2FExit.20Status.20Stabilization.html#269811758">(Jan 28 2022 at 22:24)</a>:</h4>
<p>it would be interesting if we had a method you could implement but never call</p>



<a name="269811762"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/219381-t-libs/topic/Termination/Exit%20Status%20Stabilization/near/269811762" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Lokathor <a href="https://zulip-archive.rust-lang.org/stream/219381-t-libs/topic/Termination.2FExit.20Status.20Stabilization.html#269811762">(Jan 28 2022 at 22:25)</a>:</h4>
<p>if the reporting just prints and exits that's fine  anyone can already do that</p>



<a name="269811787"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/219381-t-libs/topic/Termination/Exit%20Status%20Stabilization/near/269811787" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jane Lusby [she/her] <a href="https://zulip-archive.rust-lang.org/stream/219381-t-libs/topic/Termination.2FExit.20Status.20Stabilization.html#269811787">(Jan 28 2022 at 22:25)</a>:</h4>
<p><span class="user-mention silent" data-user-id="224471">Lokathor</span> <a href="#narrow/stream/219381-t-libs/topic/Termination.2FExit.20Status.20Stabilization/near/269811762">said</a>:</p>
<blockquote>
<p>if the reporting just prints and exits that's fine  anyone can already do that</p>
</blockquote>
<p>I think that's what's being discussed</p>



<a name="269811850"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/219381-t-libs/topic/Termination/Exit%20Status%20Stabilization/near/269811850" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jane Lusby [she/her] <a href="https://zulip-archive.rust-lang.org/stream/219381-t-libs/topic/Termination.2FExit.20Status.20Stabilization.html#269811850">(Jan 28 2022 at 22:26)</a>:</h4>
<p>I asked that question because I was trying to imply that maybe it would be okay to stabilize just SUCCESS and FAILURE and push people towards calling <code>exit</code> in <code>Termination</code> when they need more specific exit codes.</p>



<a name="269811902"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/219381-t-libs/topic/Termination/Exit%20Status%20Stabilization/near/269811902" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Lokathor <a href="https://zulip-archive.rust-lang.org/stream/219381-t-libs/topic/Termination.2FExit.20Status.20Stabilization.html#269811902">(Jan 28 2022 at 22:26)</a>:</h4>
<p>ah, right. yes that's a good plan</p>



<a name="269811916"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/219381-t-libs/topic/Termination/Exit%20Status%20Stabilization/near/269811916" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jane Lusby [she/her] <a href="https://zulip-archive.rust-lang.org/stream/219381-t-libs/topic/Termination.2FExit.20Status.20Stabilization.html#269811916">(Jan 28 2022 at 22:26)</a>:</h4>
<p>but we've since approached a consensus on adding From&lt;u8&gt; so there's even less need for exit in Termination</p>



<a name="269812150"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/219381-t-libs/topic/Termination/Exit%20Status%20Stabilization/near/269812150" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Lokathor <a href="https://zulip-archive.rust-lang.org/stream/219381-t-libs/topic/Termination.2FExit.20Status.20Stabilization.html#269812150">(Jan 28 2022 at 22:28)</a>:</h4>
<p>how would any of this work in the presence of the start attribute for a custom entry point? currently this is nightly only and largely forgotten about, but Some Day (tm) we should get back to it</p>



<a name="269812391"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/219381-t-libs/topic/Termination/Exit%20Status%20Stabilization/near/269812391" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Lokathor <a href="https://zulip-archive.rust-lang.org/stream/219381-t-libs/topic/Termination.2FExit.20Status.20Stabilization.html#269812391">(Jan 28 2022 at 22:31)</a>:</h4>
<p>it's probably best to say that the std library runtime will print and exit, but that other runtimes can just do other things</p>



<a name="269812618"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/219381-t-libs/topic/Termination/Exit%20Status%20Stabilization/near/269812618" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jane Lusby [she/her] <a href="https://zulip-archive.rust-lang.org/stream/219381-t-libs/topic/Termination.2FExit.20Status.20Stabilization.html#269812618">(Jan 28 2022 at 22:33)</a>:</h4>
<p>Sounds good, do you want to open a PR to add a note related to that to the docs on Termination?</p>



<a name="269812653"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/219381-t-libs/topic/Termination/Exit%20Status%20Stabilization/near/269812653" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jane Lusby [she/her] <a href="https://zulip-archive.rust-lang.org/stream/219381-t-libs/topic/Termination.2FExit.20Status.20Stabilization.html#269812653">(Jan 28 2022 at 22:33)</a>:</h4>
<p>or open an issue requesting the change</p>



<a name="269812763"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/219381-t-libs/topic/Termination/Exit%20Status%20Stabilization/near/269812763" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jane Lusby [she/her] <a href="https://zulip-archive.rust-lang.org/stream/219381-t-libs/topic/Termination.2FExit.20Status.20Stabilization.html#269812763">(Jan 28 2022 at 22:34)</a>:</h4>
<p>Also, do you feel like this should be a blocker for stabilization? (my guess is no)</p>



<a name="269812956"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/219381-t-libs/topic/Termination/Exit%20Status%20Stabilization/near/269812956" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Lokathor <a href="https://zulip-archive.rust-lang.org/stream/219381-t-libs/topic/Termination.2FExit.20Status.20Stabilization.html#269812956">(Jan 28 2022 at 22:36)</a>:</h4>
<p>i don't think it blocks, no. it's more like just a clarification</p>



<a name="269812966"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/219381-t-libs/topic/Termination/Exit%20Status%20Stabilization/near/269812966" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Lokathor <a href="https://zulip-archive.rust-lang.org/stream/219381-t-libs/topic/Termination.2FExit.20Status.20Stabilization.html#269812966">(Jan 28 2022 at 22:36)</a>:</h4>
<p>i could open an issue later</p>



<a name="269813188"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/219381-t-libs/topic/Termination/Exit%20Status%20Stabilization/near/269813188" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jane Lusby [she/her] <a href="https://zulip-archive.rust-lang.org/stream/219381-t-libs/topic/Termination.2FExit.20Status.20Stabilization.html#269813188">(Jan 28 2022 at 22:39)</a>:</h4>
<p><span class="user-mention silent" data-user-id="224471">Lokathor</span> <a href="#narrow/stream/219381-t-libs/topic/Termination.2FExit.20Status.20Stabilization/near/269812966">said</a>:</p>
<blockquote>
<p>i could open an issue later</p>
</blockquote>
<p>thank you!</p>



<a name="269813206"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/219381-t-libs/topic/Termination/Exit%20Status%20Stabilization/near/269813206" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jane Lusby [she/her] <a href="https://zulip-archive.rust-lang.org/stream/219381-t-libs/topic/Termination.2FExit.20Status.20Stabilization.html#269813206">(Jan 28 2022 at 22:39)</a>:</h4>
<p>can anyone tell what the hell broke here? <a href="https://github.com/rust-lang/rust/pull/93442#issuecomment-1024660532">https://github.com/rust-lang/rust/pull/93442#issuecomment-1024660532</a></p>



<a name="269813397"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/219381-t-libs/topic/Termination/Exit%20Status%20Stabilization/near/269813397" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jane Lusby [she/her] <a href="https://zulip-archive.rust-lang.org/stream/219381-t-libs/topic/Termination.2FExit.20Status.20Stabilization.html#269813397">(Jan 28 2022 at 22:41)</a>:</h4>
<p>confused why mir-opt is segfaulting</p>



<a name="269815296"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/219381-t-libs/topic/Termination/Exit%20Status%20Stabilization/near/269815296" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Urgau <a href="https://zulip-archive.rust-lang.org/stream/219381-t-libs/topic/Termination.2FExit.20Status.20Stabilization.html#269815296">(Jan 28 2022 at 23:00)</a>:</h4>
<p><span class="user-mention" data-user-id="220273">@Jane Lusby [she/her]</span> <a href="#narrow/stream/242791-t-infra/topic/Spurious.20mir-opt.20segfaults.20GHA/near/269699225">https://rust-lang.zulipchat.com/#narrow/stream/242791-t-infra/topic/Spurious.20mir-opt.20segfaults.20GHA/near/269699225</a> This is not a problem with your PR, it's a problem with every PR.</p>



<a name="269815365"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/219381-t-libs/topic/Termination/Exit%20Status%20Stabilization/near/269815365" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jane Lusby [she/her] <a href="https://zulip-archive.rust-lang.org/stream/219381-t-libs/topic/Termination.2FExit.20Status.20Stabilization.html#269815365">(Jan 28 2022 at 23:01)</a>:</h4>
<p>Aah, okay</p>



<a name="269822431"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/219381-t-libs/topic/Termination/Exit%20Status%20Stabilization/near/269822431" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> scottmcm <a href="https://zulip-archive.rust-lang.org/stream/219381-t-libs/topic/Termination.2FExit.20Status.20Stabilization.html#269822431">(Jan 29 2022 at 00:16)</a>:</h4>
<p><span class="user-mention silent" data-user-id="220273">Jane Lusby [she/her]</span> <a href="#narrow/stream/219381-t-libs/topic/Termination.2FExit.20Status.20Stabilization/near/269811008">said</a>:</p>
<blockquote>
<p>also dang, do we really _never_ call drops on statics?</p>
</blockquote>
<p>I'm sure we don't, because running them recreates all the ordering problems again -- the <code>drop</code>s could reference other <code>static</code>s.</p>



<a name="269828885"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/219381-t-libs/topic/Termination/Exit%20Status%20Stabilization/near/269828885" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Lokathor <a href="https://zulip-archive.rust-lang.org/stream/219381-t-libs/topic/Termination.2FExit.20Status.20Stabilization.html#269828885">(Jan 29 2022 at 01:48)</a>:</h4>
<p><a href="https://github.com/rust-lang/rust/issues/93448">https://github.com/rust-lang/rust/issues/93448</a></p>



<a name="270021594"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/219381-t-libs/topic/Termination/Exit%20Status%20Stabilization/near/270021594" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> bstrie <a href="https://zulip-archive.rust-lang.org/stream/219381-t-libs/topic/Termination.2FExit.20Status.20Stabilization.html#270021594">(Jan 31 2022 at 12:16)</a>:</h4>
<p>with this stabilization is there any hope of resolving the prior Debug/Display discussion, or at least not precluding the possibility of resolving it in the future (if indeed there is any hope of ever resolving it at all)?</p>



<a name="270032920"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/219381-t-libs/topic/Termination/Exit%20Status%20Stabilization/near/270032920" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jane Lusby [she/her] <a href="https://zulip-archive.rust-lang.org/stream/219381-t-libs/topic/Termination.2FExit.20Status.20Stabilization.html#270032920">(Jan 31 2022 at 13:46)</a>:</h4>
<p>I have eventual hopes of fixing it for Errors via specialization</p>



<a name="270033022"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/219381-t-libs/topic/Termination/Exit%20Status%20Stabilization/near/270033022" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jane Lusby [she/her] <a href="https://zulip-archive.rust-lang.org/stream/219381-t-libs/topic/Termination.2FExit.20Status.20Stabilization.html#270033022">(Jan 31 2022 at 13:46)</a>:</h4>
<p>Same way I want to fix unwrap and expect</p>



<a name="270037564"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/219381-t-libs/topic/Termination/Exit%20Status%20Stabilization/near/270037564" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> bjorn3 <a href="https://zulip-archive.rust-lang.org/stream/219381-t-libs/topic/Termination.2FExit.20Status.20Stabilization.html#270037564">(Jan 31 2022 at 14:17)</a>:</h4>
<p>I don't think that is possible to ever do soundly. A type may implement <code>Display</code> and <code>Debug</code> for different lifetimes. At codegen time we don't know which one was implemented for the non-lifetime-erased type, so we don't know which one to use.</p>



<a name="270037790"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/219381-t-libs/topic/Termination/Exit%20Status%20Stabilization/near/270037790" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> bjorn3 <a href="https://zulip-archive.rust-lang.org/stream/219381-t-libs/topic/Termination.2FExit.20Status.20Stabilization.html#270037790">(Jan 31 2022 at 14:18)</a>:</h4>
<p>It would be much easier to at an edition boundary swap between a <code>Debug</code> based <code>Termination</code> trait and a <code>Display</code> based <code>Termination</code> trait. This requires <code>Termination</code> to not be stabilized before the new edition though.</p>



<a name="270091650"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/219381-t-libs/topic/Termination/Exit%20Status%20Stabilization/near/270091650" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> scottmcm <a href="https://zulip-archive.rust-lang.org/stream/219381-t-libs/topic/Termination.2FExit.20Status.20Stabilization.html#270091650">(Jan 31 2022 at 19:36)</a>:</h4>
<p><span class="user-mention silent" data-user-id="256342">bstrie</span> <a href="#narrow/stream/219381-t-libs/topic/Termination.2FExit.20Status.20Stabilization/near/270021594">said</a>:</p>
<blockquote>
<p>with this stabilization is there any hope of resolving the prior Debug/Display discussion</p>
</blockquote>
<p>Well, one version we could always do is offer different types for the output.</p>
<p>Especially since a really nice version of this would do things like have a localized display and everything.</p>
<p>That'd need <code>?</code> support to be a really good replacement, though -- which goes back to the same "if you really care about the output why not just make a function?" thing that came up in the discussion last time.  Making a Termination impl isn't necessarily the best way to do this.</p>



<a name="270091854"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/219381-t-libs/topic/Termination/Exit%20Status%20Stabilization/near/270091854" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jane Lusby [she/her] <a href="https://zulip-archive.rust-lang.org/stream/219381-t-libs/topic/Termination.2FExit.20Status.20Stabilization.html#270091854">(Jan 31 2022 at 19:37)</a>:</h4>
<p><span class="user-mention silent" data-user-id="133247">bjorn3</span> <a href="#narrow/stream/219381-t-libs/topic/Termination.2FExit.20Status.20Stabilization/near/270037564">said</a>:</p>
<blockquote>
<p>I don't think that is possible to ever do soundly. A type may implement <code>Display</code> and <code>Debug</code> for different lifetimes. At codegen time we don't know which one was implemented for the non-lifetime-erased type, so we don't know which one to use.</p>
</blockquote>
<p>I think niko has some ideas around always applicable impls where we'd only be able to specialize in cases where the impls don't depend on lifetimes, but yea, its a stretch rn</p>



<a name="270092081"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/219381-t-libs/topic/Termination/Exit%20Status%20Stabilization/near/270092081" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jane Lusby [she/her] <a href="https://zulip-archive.rust-lang.org/stream/219381-t-libs/topic/Termination.2FExit.20Status.20Stabilization.html#270092081">(Jan 31 2022 at 19:39)</a>:</h4>
<p><span class="user-mention silent" data-user-id="133247">bjorn3</span> <a href="#narrow/stream/219381-t-libs/topic/Termination.2FExit.20Status.20Stabilization/near/270037790">said</a>:</p>
<blockquote>
<p>It would be much easier to at an edition boundary swap between a <code>Debug</code> based <code>Termination</code> trait and a <code>Display</code> based <code>Termination</code> trait. This requires <code>Termination</code> to not be stabilized before the new edition though.</p>
</blockquote>
<p>If we're going to do this why would we pick <code>Display</code> over <code>Error</code>?</p>



<a name="270092239"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/219381-t-libs/topic/Termination/Exit%20Status%20Stabilization/near/270092239" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jane Lusby [she/her] <a href="https://zulip-archive.rust-lang.org/stream/219381-t-libs/topic/Termination.2FExit.20Status.20Stabilization.html#270092239">(Jan 31 2022 at 19:40)</a>:</h4>
<p>also probably important to note that so long as <code>Termination</code> is stabilized its always going to be possible to circumvent the <code>Display</code> vs <code>Debug</code> issue by just using a different type than <code>std::result::Result</code></p>



<a name="270092415"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/219381-t-libs/topic/Termination/Exit%20Status%20Stabilization/near/270092415" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jane Lusby [she/her] <a href="https://zulip-archive.rust-lang.org/stream/219381-t-libs/topic/Termination.2FExit.20Status.20Stabilization.html#270092415">(Jan 31 2022 at 19:42)</a>:</h4>
<p>though its still annoying to work with diff result types, especially because the <code>Ok</code> and <code>Err</code> variants that are in scope won't apply and shadowing them is not necessarily the best idea</p>



<a name="270092687"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/219381-t-libs/topic/Termination/Exit%20Status%20Stabilization/near/270092687" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jane Lusby [she/her] <a href="https://zulip-archive.rust-lang.org/stream/219381-t-libs/topic/Termination.2FExit.20Status.20Stabilization.html#270092687">(Jan 31 2022 at 19:43)</a>:</h4>
<p>I wonder if there is any special <code>try_v2</code> syntax sugary thing we could do to fix this without needing to change a ton of existing code</p>



<a name="270092768"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/219381-t-libs/topic/Termination/Exit%20Status%20Stabilization/near/270092768" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> scottmcm <a href="https://zulip-archive.rust-lang.org/stream/219381-t-libs/topic/Termination.2FExit.20Status.20Stabilization.html#270092768">(Jan 31 2022 at 19:44)</a>:</h4>
<p><code>try{}</code>+<code>yeet</code>.  (Oh, you said without touching existing code)</p>



<a name="270092827"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/219381-t-libs/topic/Termination/Exit%20Status%20Stabilization/near/270092827" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jane Lusby [she/her] <a href="https://zulip-archive.rust-lang.org/stream/219381-t-libs/topic/Termination.2FExit.20Status.20Stabilization.html#270092827">(Jan 31 2022 at 19:44)</a>:</h4>
<p>maybe somehow changing the <code>Ok</code> item in the function namespace to be an alias for <code>Try::from_output</code> tho i can't imagine that not causing inference breakages</p>



<a name="270092849"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/219381-t-libs/topic/Termination/Exit%20Status%20Stabilization/near/270092849" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jane Lusby [she/her] <a href="https://zulip-archive.rust-lang.org/stream/219381-t-libs/topic/Termination.2FExit.20Status.20Stabilization.html#270092849">(Jan 31 2022 at 19:45)</a>:</h4>
<p><span class="user-mention silent" data-user-id="125270">scottmcm</span> <a href="#narrow/stream/219381-t-libs/topic/Termination.2FExit.20Status.20Stabilization/near/270092768">said</a>:</p>
<blockquote>
<p><code>try{}</code>+<code>yeet</code>.  (Oh, you said without touching existing code)</p>
</blockquote>
<p>yea, something that works outside of try blocks ideally</p>



<a name="270092861"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/219381-t-libs/topic/Termination/Exit%20Status%20Stabilization/near/270092861" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> scottmcm <a href="https://zulip-archive.rust-lang.org/stream/219381-t-libs/topic/Termination.2FExit.20Status.20Stabilization.html#270092861">(Jan 31 2022 at 19:45)</a>:</h4>
<p>Yeah, especially in closures it'd be horrible.</p>



<a name="270092916"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/219381-t-libs/topic/Termination/Exit%20Status%20Stabilization/near/270092916" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jane Lusby [she/her] <a href="https://zulip-archive.rust-lang.org/stream/219381-t-libs/topic/Termination.2FExit.20Status.20Stabilization.html#270092916">(Jan 31 2022 at 19:45)</a>:</h4>
<p>well, <span class="user-mention" data-user-id="125270">@scottmcm</span> if you wanted another wishlist item to think about ;D</p>



<a name="270093021"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/219381-t-libs/topic/Termination/Exit%20Status%20Stabilization/near/270093021" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> scottmcm <a href="https://zulip-archive.rust-lang.org/stream/219381-t-libs/topic/Termination.2FExit.20Status.20Stabilization.html#270093021">(Jan 31 2022 at 19:46)</a>:</h4>
<p>See how <code>core</code> uses <code>try { a }</code> instead of <code>Ok(a)</code> often: <a href="https://github.com/rust-lang/rust/blob/24b8bb13bff98bb747cd403b86596af43aceee78/library/core/src/iter/traits/iterator.rs#L2029">https://github.com/rust-lang/rust/blob/24b8bb13bff98bb747cd403b86596af43aceee78/library/core/src/iter/traits/iterator.rs#L2029</a></p>



<a name="270093025"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/219381-t-libs/topic/Termination/Exit%20Status%20Stabilization/near/270093025" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jane Lusby [she/her] <a href="https://zulip-archive.rust-lang.org/stream/219381-t-libs/topic/Termination.2FExit.20Status.20Stabilization.html#270093025">(Jan 31 2022 at 19:46)</a>:</h4>
<p>tho my guess is that the right solution is exactly what you said, try blocks and yeet</p>



<a name="270093102"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/219381-t-libs/topic/Termination/Exit%20Status%20Stabilization/near/270093102" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jane Lusby [she/her] <a href="https://zulip-archive.rust-lang.org/stream/219381-t-libs/topic/Termination.2FExit.20Status.20Stabilization.html#270093102">(Jan 31 2022 at 19:46)</a>:</h4>
<p>i just fking hate how changing code to use try blocks requires that you indent the entire function</p>



<a name="270093126"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/219381-t-libs/topic/Termination/Exit%20Status%20Stabilization/near/270093126" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jane Lusby [she/her] <a href="https://zulip-archive.rust-lang.org/stream/219381-t-libs/topic/Termination.2FExit.20Status.20Stabilization.html#270093126">(Jan 31 2022 at 19:47)</a>:</h4>
<p>i feel like we really need to figure out a function level try syntax as well</p>



<a name="270093235"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/219381-t-libs/topic/Termination/Exit%20Status%20Stabilization/near/270093235" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jane Lusby [she/her] <a href="https://zulip-archive.rust-lang.org/stream/219381-t-libs/topic/Termination.2FExit.20Status.20Stabilization.html#270093235">(Jan 31 2022 at 19:47)</a>:</h4>
<p>of course that still breaks the ppl who want to be able to do <code>try { ... }.context()</code> on the entire function body</p>



<a name="270093306"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/219381-t-libs/topic/Termination/Exit%20Status%20Stabilization/near/270093306" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jane Lusby [she/her] <a href="https://zulip-archive.rust-lang.org/stream/219381-t-libs/topic/Termination.2FExit.20Status.20Stabilization.html#270093306">(Jan 31 2022 at 19:48)</a>:</h4>
<p>feels like there's no winning sometimes</p>



<a name="270095588"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/219381-t-libs/topic/Termination/Exit%20Status%20Stabilization/near/270095588" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> The 8472 <a href="https://zulip-archive.rust-lang.org/stream/219381-t-libs/topic/Termination.2FExit.20Status.20Stabilization.html#270095588">(Jan 31 2022 at 20:01)</a>:</h4>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="k">fn</span> <span class="nf">foo</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span><span class="w"> </span>-&gt; <span class="nb">Result</span><span class="o">&lt;</span><span class="p">()</span><span class="o">&gt;</span><span class="w"></span>
<span class="kr">try</span><span class="w"> </span><span class="p">{</span><span class="w"></span>

<span class="p">}</span><span class="w"></span>
</code></pre></div>



<a name="270096024"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/219381-t-libs/topic/Termination/Exit%20Status%20Stabilization/near/270096024" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jane Lusby [she/her] <a href="https://zulip-archive.rust-lang.org/stream/219381-t-libs/topic/Termination.2FExit.20Status.20Stabilization.html#270096024">(Jan 31 2022 at 20:04)</a>:</h4>
<p>alternatively</p>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="k">fn</span> <span class="nf">foo</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="w"> </span><span class="n">path</span>: <span class="kp">&amp;</span><span class="nc">Path</span><span class="p">)</span><span class="w"> </span>-&gt; <span class="nb">Result</span><span class="o">&lt;</span><span class="p">()</span><span class="o">&gt;</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kr">try</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="c1">// ...</span>
<span class="p">}.</span><span class="n">wrap_err</span><span class="o">!</span><span class="p">(</span><span class="s">"couldnt foo {}"</span><span class="p">,</span><span class="w"> </span><span class="n">path</span><span class="p">.</span><span class="n">display</span><span class="p">());</span><span class="w"></span>
</code></pre></div>



<a name="270096238"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/219381-t-libs/topic/Termination/Exit%20Status%20Stabilization/near/270096238" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jane Lusby [she/her] <a href="https://zulip-archive.rust-lang.org/stream/219381-t-libs/topic/Termination.2FExit.20Status.20Stabilization.html#270096238">(Jan 31 2022 at 20:06)</a>:</h4>
<p>or even worse</p>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="k">fn</span> <span class="nf">foo</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="w"> </span><span class="n">path</span>: <span class="nc">T</span><span class="p">)</span><span class="w"> </span>-&gt; <span class="nb">Result</span><span class="o">&lt;</span><span class="p">()</span><span class="o">&gt;</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kr">try</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="c1">// ...</span>
<span class="p">}.</span><span class="n">wrap_err</span><span class="o">!</span><span class="p">(</span><span class="s">"couldnt foo {}"</span><span class="p">,</span><span class="w"> </span><span class="n">path</span><span class="p">.</span><span class="n">display</span><span class="p">())</span><span class="w"></span>
<span class="k">where</span><span class="w"></span>
<span class="w">    </span><span class="n">T</span>: <span class="nb">AsRef</span><span class="o">&lt;</span><span class="n">Path</span><span class="o">&gt;</span><span class="p">;</span><span class="w"></span>
</code></pre></div>



<a name="270096343"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/219381-t-libs/topic/Termination/Exit%20Status%20Stabilization/near/270096343" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jane Lusby [she/her] <a href="https://zulip-archive.rust-lang.org/stream/219381-t-libs/topic/Termination.2FExit.20Status.20Stabilization.html#270096343">(Jan 31 2022 at 20:06)</a>:</h4>
<p>tried picking the worst possible place to put a where bound :D</p>



<a name="270096484"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/219381-t-libs/topic/Termination/Exit%20Status%20Stabilization/near/270096484" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> The 8472 <a href="https://zulip-archive.rust-lang.org/stream/219381-t-libs/topic/Termination.2FExit.20Status.20Stabilization.html#270096484">(Jan 31 2022 at 20:07)</a>:</h4>
<p>maybe that can be fixed with another postfix macro :D</p>



<a name="270103298"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/219381-t-libs/topic/Termination/Exit%20Status%20Stabilization/near/270103298" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> scottmcm <a href="https://zulip-archive.rust-lang.org/stream/219381-t-libs/topic/Termination.2FExit.20Status.20Stabilization.html#270103298">(Jan 31 2022 at 20:56)</a>:</h4>
<p><span class="user-mention silent" data-user-id="220273">Jane Lusby [she/her]</span> <a href="#narrow/stream/219381-t-libs/topic/Termination.2FExit.20Status.20Stabilization/near/270093126">said</a>:</p>
<blockquote>
<p>i feel like we really need to figure out a function level try syntax as well</p>
</blockquote>
<p>Yes, I've always wanted one of those that -- like <code>async fn</code> -- affects <code>return</code> expressions as well.  (And thus is different from just having a <code>try</code> block in the body.)</p>
<p>But that's what leads to arguments on how to write the definition, so I've been avoiding it.</p>



<a name="270104834"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/219381-t-libs/topic/Termination/Exit%20Status%20Stabilization/near/270104834" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Nick Cameron <a href="https://zulip-archive.rust-lang.org/stream/219381-t-libs/topic/Termination.2FExit.20Status.20Stabilization.html#270104834">(Jan 31 2022 at 21:07)</a>:</h4>
<p>Yeah, it’ll be the bike shed from hell, but I think we should do it</p>



<a name="270104879"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/219381-t-libs/topic/Termination/Exit%20Status%20Stabilization/near/270104879" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Nick Cameron <a href="https://zulip-archive.rust-lang.org/stream/219381-t-libs/topic/Termination.2FExit.20Status.20Stabilization.html#270104879">(Jan 31 2022 at 21:07)</a>:</h4>
<p>Ok(()) kills me</p>



<a name="270105222"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/219381-t-libs/topic/Termination/Exit%20Status%20Stabilization/near/270105222" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jane Lusby [she/her] <a href="https://zulip-archive.rust-lang.org/stream/219381-t-libs/topic/Termination.2FExit.20Status.20Stabilization.html#270105222">(Jan 31 2022 at 21:09)</a>:</h4>
<p>Agreed, I think it's worth the bike shed, but I also think that if we're careful in how we structure the discussions, we can make it productive and constructive without much bikeshedding</p>



<a name="270105360"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/219381-t-libs/topic/Termination/Exit%20Status%20Stabilization/near/270105360" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jane Lusby [she/her] <a href="https://zulip-archive.rust-lang.org/stream/219381-t-libs/topic/Termination.2FExit.20Status.20Stabilization.html#270105360">(Jan 31 2022 at 21:10)</a>:</h4>
<p>Though at this point I do think we're getting pretty far off topic for the termination stabilization thread</p>



<a name="270109612"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/219381-t-libs/topic/Termination/Exit%20Status%20Stabilization/near/270109612" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> bstrie <a href="https://zulip-archive.rust-lang.org/stream/219381-t-libs/topic/Termination.2FExit.20Status.20Stabilization.html#270109612">(Jan 31 2022 at 21:40)</a>:</h4>
<p><em>"wait, #t-libs is just #project-error-handling?" "always has been"</em></p>



<a name="270110489"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/219381-t-libs/topic/Termination/Exit%20Status%20Stabilization/near/270110489" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jane Lusby [she/her] <a href="https://zulip-archive.rust-lang.org/stream/219381-t-libs/topic/Termination.2FExit.20Status.20Stabilization.html#270110489">(Jan 31 2022 at 21:47)</a>:</h4>
<p>Teleports being you</p>



<a name="271366698"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/219381-t-libs/topic/Termination/Exit%20Status%20Stabilization/near/271366698" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> simulacrum <a href="https://zulip-archive.rust-lang.org/stream/219381-t-libs/topic/Termination.2FExit.20Status.20Stabilization.html#271366698">(Feb 10 2022 at 00:02)</a>:</h4>
<p><span class="user-mention" data-user-id="220273">@Jane Lusby [she/her]</span> did we discuss the consts vs constructors and is_ methods?</p>



<a name="271366752"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/219381-t-libs/topic/Termination/Exit%20Status%20Stabilization/near/271366752" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> simulacrum <a href="https://zulip-archive.rust-lang.org/stream/219381-t-libs/topic/Termination.2FExit.20Status.20Stabilization.html#271366752">(Feb 10 2022 at 00:03)</a>:</h4>
<p>I'm particularly worried that if some target has a bool or enum with two variants, I suspect that might mean that the consts permit exhaustive matching?</p>



<a name="271366770"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/219381-t-libs/topic/Termination/Exit%20Status%20Stabilization/near/271366770" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> simulacrum <a href="https://zulip-archive.rust-lang.org/stream/219381-t-libs/topic/Termination.2FExit.20Status.20Stabilization.html#271366770">(Feb 10 2022 at 00:03)</a>:</h4>
<p>(I think tracing recently ran into trouble here)</p>



<a name="271367594"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/219381-t-libs/topic/Termination/Exit%20Status%20Stabilization/near/271367594" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jane Lusby [she/her] <a href="https://zulip-archive.rust-lang.org/stream/219381-t-libs/topic/Termination.2FExit.20Status.20Stabilization.html#271367594">(Feb 10 2022 at 00:11)</a>:</h4>
<p>not that I know of</p>



<a name="271367650"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/219381-t-libs/topic/Termination/Exit%20Status%20Stabilization/near/271367650" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jane Lusby [she/her] <a href="https://zulip-archive.rust-lang.org/stream/219381-t-libs/topic/Termination.2FExit.20Status.20Stabilization.html#271367650">(Feb 10 2022 at 00:12)</a>:</h4>
<p><span class="user-mention silent" data-user-id="116122">simulacrum</span> <a href="#narrow/stream/219381-t-libs/topic/Termination.2FExit.20Status.20Stabilization/near/271366752">said</a>:</p>
<blockquote>
<p>I'm particularly worried that if some target has a bool or enum with two variants, I suspect that might mean that the consts permit exhaustive matching?</p>
</blockquote>
<p>what do you mean "some target has a bool or enum with two variants"?</p>



<a name="271367694"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/219381-t-libs/topic/Termination/Exit%20Status%20Stabilization/near/271367694" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jane Lusby [she/her] <a href="https://zulip-archive.rust-lang.org/stream/219381-t-libs/topic/Termination.2FExit.20Status.20Stabilization.html#271367694">(Feb 10 2022 at 00:12)</a>:</h4>
<p>is this referring to exitcode's internal representation?</p>



<a name="271367727"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/219381-t-libs/topic/Termination/Exit%20Status%20Stabilization/near/271367727" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jane Lusby [she/her] <a href="https://zulip-archive.rust-lang.org/stream/219381-t-libs/topic/Termination.2FExit.20Status.20Stabilization.html#271367727">(Feb 10 2022 at 00:13)</a>:</h4>
<p>I know the unsupported platform (wasm I believe?) has a bool</p>



<a name="271367757"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/219381-t-libs/topic/Termination/Exit%20Status%20Stabilization/near/271367757" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jane Lusby [she/her] <a href="https://zulip-archive.rust-lang.org/stream/219381-t-libs/topic/Termination.2FExit.20Status.20Stabilization.html#271367757">(Feb 10 2022 at 00:13)</a>:</h4>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="cp">#[derive(PartialEq, Eq, Clone, Copy, Debug)]</span><span class="w"></span>
<span class="k">pub</span><span class="w"> </span><span class="k">struct</span> <span class="nc">ExitCode</span><span class="p">(</span><span class="kt">bool</span><span class="p">);</span><span class="w"></span>

<span class="k">impl</span><span class="w"> </span><span class="n">ExitCode</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="k">pub</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="n">SUCCESS</span>: <span class="nc">ExitCode</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">ExitCode</span><span class="p">(</span><span class="kc">false</span><span class="p">);</span><span class="w"></span>
<span class="w">    </span><span class="k">pub</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="n">FAILURE</span>: <span class="nc">ExitCode</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">ExitCode</span><span class="p">(</span><span class="kc">true</span><span class="p">);</span><span class="w"></span>

<span class="w">    </span><span class="k">pub</span><span class="w"> </span><span class="k">fn</span> <span class="nf">as_i32</span><span class="p">(</span><span class="o">&amp;</span><span class="bp">self</span><span class="p">)</span><span class="w"> </span>-&gt; <span class="kt">i32</span> <span class="p">{</span><span class="w"></span>
<span class="w">        </span><span class="bp">self</span><span class="p">.</span><span class="mi">0</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="kt">i32</span><span class="w"></span>
<span class="w">    </span><span class="p">}</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>

<span class="k">impl</span><span class="w"> </span><span class="nb">From</span><span class="o">&lt;</span><span class="kt">u8</span><span class="o">&gt;</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="n">ExitCode</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="k">fn</span> <span class="nf">from</span><span class="p">(</span><span class="n">code</span>: <span class="kt">u8</span><span class="p">)</span><span class="w"> </span>-&gt; <span class="nc">Self</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">        </span><span class="k">match</span><span class="w"> </span><span class="n">code</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">            </span><span class="mi">0</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="bp">Self</span>::<span class="n">SUCCESS</span><span class="p">,</span><span class="w"></span>
<span class="w">            </span><span class="mi">1</span><span class="o">..=</span><span class="mi">255</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="bp">Self</span>::<span class="n">FAILURE</span><span class="p">,</span><span class="w"></span>
<span class="w">        </span><span class="p">}</span><span class="w"></span>
<span class="w">    </span><span class="p">}</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>
</code></pre></div>



<a name="271367841"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/219381-t-libs/topic/Termination/Exit%20Status%20Stabilization/near/271367841" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jane Lusby [she/her] <a href="https://zulip-archive.rust-lang.org/stream/219381-t-libs/topic/Termination.2FExit.20Status.20Stabilization.html#271367841">(Feb 10 2022 at 00:14)</a>:</h4>
<p>so is the idea ppl might be able to match against this even tho the bool is private?</p>



<a name="271370247"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/219381-t-libs/topic/Termination/Exit%20Status%20Stabilization/near/271370247" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> simulacrum <a href="https://zulip-archive.rust-lang.org/stream/219381-t-libs/topic/Termination.2FExit.20Status.20Stabilization.html#271370247">(Feb 10 2022 at 00:34)</a>:</h4>
<p>Right - let me see if I can make an example</p>



<a name="271371044"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/219381-t-libs/topic/Termination/Exit%20Status%20Stabilization/near/271371044" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> matt rice <a href="https://zulip-archive.rust-lang.org/stream/219381-t-libs/topic/Termination.2FExit.20Status.20Stabilization.html#271371044">(Feb 10 2022 at 00:43)</a>:</h4>
<p>I know I posted a similarish example here comparing quality of MaybeUninit <a href="https://internals.rust-lang.org/t/constifying-the-std-core-library/12962/4">https://internals.rust-lang.org/t/constifying-the-std-core-library/12962/4</a> If that is the kind of thing you mean</p>



<a name="271371533"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/219381-t-libs/topic/Termination/Exit%20Status%20Stabilization/near/271371533" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> simulacrum <a href="https://zulip-archive.rust-lang.org/stream/219381-t-libs/topic/Termination.2FExit.20Status.20Stabilization.html#271371533">(Feb 10 2022 at 00:49)</a>:</h4>
<p>Oh, well, without PartialEq it looks like you can't match or check at all - <a href="https://play.rust-lang.org/?version=nightly&amp;mode=debug&amp;edition=2021&amp;gist=70f54f4bb1124fdc0f106271d7155911">https://play.rust-lang.org/?version=nightly&amp;mode=debug&amp;edition=2021&amp;gist=70f54f4bb1124fdc0f106271d7155911</a></p>



<a name="271382880"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/219381-t-libs/topic/Termination/Exit%20Status%20Stabilization/near/271382880" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jane Lusby [she/her] <a href="https://zulip-archive.rust-lang.org/stream/219381-t-libs/topic/Termination.2FExit.20Status.20Stabilization.html#271382880">(Feb 10 2022 at 03:46)</a>:</h4>
<p><span class="user-mention silent" data-user-id="116122">simulacrum</span> <a href="#narrow/stream/219381-t-libs/topic/Termination.2FExit.20Status.20Stabilization/near/271371533">said</a>:</p>
<blockquote>
<p>Oh, well, without PartialEq it looks like you can't match or check at all - <a href="https://play.rust-lang.org/?version=nightly&amp;mode=debug&amp;edition=2021&amp;gist=70f54f4bb1124fdc0f106271d7155911">https://play.rust-lang.org/?version=nightly&amp;mode=debug&amp;edition=2021&amp;gist=70f54f4bb1124fdc0f106271d7155911</a></p>
</blockquote>
<p>I think we could get away with never adding PartialEq to <code>ExitCode</code> because we don't really have to make it ever usable for user code outside of as a return value for <code>report</code>, but it doesn't seem like something nobody will ever ask for in the future</p>



<a name="271382920"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/219381-t-libs/topic/Termination/Exit%20Status%20Stabilization/near/271382920" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jane Lusby [she/her] <a href="https://zulip-archive.rust-lang.org/stream/219381-t-libs/topic/Termination.2FExit.20Status.20Stabilization.html#271382920">(Feb 10 2022 at 03:46)</a>:</h4>
<p>I wonder if we should maybe consider adding an explicit negative impl as a stability guarantee</p>



<a name="271382931"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/219381-t-libs/topic/Termination/Exit%20Status%20Stabilization/near/271382931" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jane Lusby [she/her] <a href="https://zulip-archive.rust-lang.org/stream/219381-t-libs/topic/Termination.2FExit.20Status.20Stabilization.html#271382931">(Feb 10 2022 at 03:46)</a>:</h4>
<p>or at least come up with a plan still for how to deal with the const constructors if we were to ever stabilize partialeq on exitcode</p>



<a name="271383944"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/219381-t-libs/topic/Termination/Exit%20Status%20Stabilization/near/271383944" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> simulacrum <a href="https://zulip-archive.rust-lang.org/stream/219381-t-libs/topic/Termination.2FExit.20Status.20Stabilization.html#271383944">(Feb 10 2022 at 04:06)</a>:</h4>
<p>The easiest thing is to just make them const fn rather than const associated items; I'm not sure why they were added as consts in the first place.</p>



<a name="271391344"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/219381-t-libs/topic/Termination/Exit%20Status%20Stabilization/near/271391344" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Triplett <a href="https://zulip-archive.rust-lang.org/stream/219381-t-libs/topic/Termination.2FExit.20Status.20Stabilization.html#271391344">(Feb 10 2022 at 06:36)</a>:</h4>
<p>Probably because they <em>are</em> simple constants rather than computations, and it seems reasonable to express them that way. <code>ExitCode::SUCCESS</code> seems appealing and evocative of what it actually means; <code>ExitCode::success()</code> raises eyebrows.</p>



<a name="271391437"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/219381-t-libs/topic/Termination/Exit%20Status%20Stabilization/near/271391437" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Triplett <a href="https://zulip-archive.rust-lang.org/stream/219381-t-libs/topic/Termination.2FExit.20Status.20Stabilization.html#271391437">(Feb 10 2022 at 06:38)</a>:</h4>
<p>I don't think it'd be the end of the world if we did allow PartialEq on ExitCode. The only guarantees we have to give are <code>ExitCode::SUCCESS == ExitCode::SUCCESS</code>, <code>ExitCode::FAILURE == ExitCode::FAILURE</code>, <code>ExitCode::SUCCESS != ExitCode::FAILURE</code>.</p>



<a name="271391472"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/219381-t-libs/topic/Termination/Exit%20Status%20Stabilization/near/271391472" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Triplett <a href="https://zulip-archive.rust-lang.org/stream/219381-t-libs/topic/Termination.2FExit.20Status.20Stabilization.html#271391472">(Feb 10 2022 at 06:38)</a>:</h4>
<p>We can be explicit that there <em>may</em> exist <code>ExitCode</code> values that aren't equal to either.</p>



<a name="271391496"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/219381-t-libs/topic/Termination/Exit%20Status%20Stabilization/near/271391496" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Triplett <a href="https://zulip-archive.rust-lang.org/stream/219381-t-libs/topic/Termination.2FExit.20Status.20Stabilization.html#271391496">(Feb 10 2022 at 06:39)</a>:</h4>
<p>And we could mark <code>ExitCode</code> as <code>#[non_exhaustive]</code> if need be.</p>



<a name="271419736"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/219381-t-libs/topic/Termination/Exit%20Status%20Stabilization/near/271419736" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> simulacrum <a href="https://zulip-archive.rust-lang.org/stream/219381-t-libs/topic/Termination.2FExit.20Status.20Stabilization.html#271419736">(Feb 10 2022 at 11:45)</a>:</h4>
<p>I think the main downside to PartialEq is that it's probably a little odd to have ExitCode(4) == FAILURE; the other side of that is that if it isn't then there's exit codes which aren't really detectable in some sense</p>



<a name="271461281"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/219381-t-libs/topic/Termination/Exit%20Status%20Stabilization/near/271461281" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> scottmcm <a href="https://zulip-archive.rust-lang.org/stream/219381-t-libs/topic/Termination.2FExit.20Status.20Stabilization.html#271461281">(Feb 10 2022 at 17:02)</a>:</h4>
<p>I think simulacrum's point is a good one here.  I wonder if it makes sense to change that impl for unsupported to hold a u8, rather than a bool, to avoid the <code>ExitCode(3) == ExitCode(4)</code> problem for it.</p>



<a name="271461350"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/219381-t-libs/topic/Termination/Exit%20Status%20Stabilization/near/271461350" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> simulacrum <a href="https://zulip-archive.rust-lang.org/stream/219381-t-libs/topic/Termination.2FExit.20Status.20Stabilization.html#271461350">(Feb 10 2022 at 17:03)</a>:</h4>
<p>fwiw, I also left a comment on the PR</p>



<a name="271466107"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/219381-t-libs/topic/Termination/Exit%20Status%20Stabilization/near/271466107" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Triplett <a href="https://zulip-archive.rust-lang.org/stream/219381-t-libs/topic/Termination.2FExit.20Status.20Stabilization.html#271466107">(Feb 10 2022 at 17:37)</a>:</h4>
<p>It wouldn't be <code>ExitCode(3) == FAILURE</code> though; it would be <code>ExitCode::from(3) == FAILURE</code>, which seems much more reasonable.</p>



<a name="271466136"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/219381-t-libs/topic/Termination/Exit%20Status%20Stabilization/near/271466136" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Triplett <a href="https://zulip-archive.rust-lang.org/stream/219381-t-libs/topic/Termination.2FExit.20Status.20Stabilization.html#271466136">(Feb 10 2022 at 17:37)</a>:</h4>
<p>(and that's only on a platform with a bool exit code)</p>



<a name="271466373"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/219381-t-libs/topic/Termination/Exit%20Status%20Stabilization/near/271466373" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Triplett <a href="https://zulip-archive.rust-lang.org/stream/219381-t-libs/topic/Termination.2FExit.20Status.20Stabilization.html#271466373">(Feb 10 2022 at 17:39)</a>:</h4>
<p><span class="user-mention" data-user-id="125270">@scottmcm</span> I thought the impl for unsupported was a u8, and that bool impl was for wasm?</p>



<a name="271475959"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/219381-t-libs/topic/Termination/Exit%20Status%20Stabilization/near/271475959" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> scottmcm <a href="https://zulip-archive.rust-lang.org/stream/219381-t-libs/topic/Termination.2FExit.20Status.20Stabilization.html#271475959">(Feb 10 2022 at 18:46)</a>:</h4>
<p><span class="user-mention silent" data-user-id="239881">Josh Triplett</span> <a href="#narrow/stream/219381-t-libs/topic/Termination.2FExit.20Status.20Stabilization/near/271466373">said</a>:</p>
<blockquote>
<p>I thought the impl for unsupported was a u8, and that bool impl was for wasm?</p>
</blockquote>
<p>Looks like the <code>sys/unsupported</code> one folds the <code>u8</code> down to a <code>bool</code>: <a href="https://github.com/rust-lang/rust/pull/93445/files#diff-2395a2386cebf75c04bc95a1ad184ca1c7309a99bd6009ea127e07fa2394967eR165">https://github.com/rust-lang/rust/pull/93445/files#diff-2395a2386cebf75c04bc95a1ad184ca1c7309a99bd6009ea127e07fa2394967eR165</a></p>



<hr><p>Last updated: Apr 12 2022 at 20:01 UTC</p>
</html>