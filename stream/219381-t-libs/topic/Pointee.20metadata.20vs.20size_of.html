<html>
<head><meta charset="utf-8"><title>Pointee metadata vs size_of · t-libs · Zulip Chat Archive</title></head>
<h2>Stream: <a href="https://zulip-archive.rust-lang.org/stream/219381-t-libs/index.html">t-libs</a></h2>
<h3>Topic: <a href="https://zulip-archive.rust-lang.org/stream/219381-t-libs/topic/Pointee.20metadata.20vs.20size_of.html">Pointee metadata vs size_of</a></h3>

<hr>

<base href="https://rust-lang.zulipchat.com">

<head><link href="https://zulip-archive.rust-lang.org/style.css" rel="stylesheet"></head>

<a name="278373178"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/219381-t-libs/topic/Pointee%20metadata%20vs%20size_of/near/278373178" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Christopher Durham <a href="https://zulip-archive.rust-lang.org/stream/219381-t-libs/topic/Pointee.20metadata.20vs.20size_of.html#278373178">(Apr 08 2022 at 23:14)</a>:</h4>
<p>I'm just kind of sad that <code>ptr::slice_from_raw_parts</code> is safe, and doesn't have a safety restriction for <code>[T]</code> to have size &lt;= <code>isize::MAX</code> (it doesn't even have one for size &lt;= <code>usize::MAX</code>!) It would've been nice if we could have had it be a validity requirement for a slice pointer's length to keep size &lt;= <code>isize::MAX</code>, and have <code>SliceMetadata&lt;T&gt;</code> to enforce that (rather than having a pointer metadata of just <code>usize</code>).<br>
It would be so nice to be able to, in addition to forcing <code>Layout</code> to respect <code>isize::MAX</code>, to also have split out pointer metadata respect it, so <code>Layout::from_metadata</code> could be safe. As is, <em>even ignoring the decision for vtables,</em> the method has to either:</p>
<ul>
<li>Change <code>intrinsics::size_of_val</code> to return an <code>Option&lt;#[rustc_valid_scalar_start(0)] isize&gt;</code>, or</li>
<li>Be unsafe, and require that the metadata describes a valid layout with size &lt;= <code>isize::MAX</code></li>
</ul>



<a name="278373248"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/219381-t-libs/topic/Pointee%20metadata%20vs%20size_of/near/278373248" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Christopher Durham <a href="https://zulip-archive.rust-lang.org/stream/219381-t-libs/topic/Pointee.20metadata.20vs.20size_of.html#278373248">(Apr 08 2022 at 23:16)</a>:</h4>
<p>And given that we maybe want to enforce that restraint to <code>Layout</code> as well as nebulously for "rust objects" (<a href="https://github.com/rust-lang/rust/pull/95295">https://github.com/rust-lang/rust/pull/95295</a>), it's sad that we just <em>can't</em> for pointer metadata</p>



<a name="278373317"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/219381-t-libs/topic/Pointee%20metadata%20vs%20size_of/near/278373317" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Christopher Durham <a href="https://zulip-archive.rust-lang.org/stream/219381-t-libs/topic/Pointee.20metadata.20vs.20size_of.html#278373317">(Apr 08 2022 at 23:16)</a>:</h4>
<p>Yeah, pointers don't need to be valid... but metadata maybe being invalid makes working with them much more dangerous than it needs to be</p>



<a name="278373994"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/219381-t-libs/topic/Pointee%20metadata%20vs%20size_of/near/278373994" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> scottmcm <a href="https://zulip-archive.rust-lang.org/stream/219381-t-libs/topic/Pointee.20metadata.20vs.20size_of.html#278373994">(Apr 08 2022 at 23:28)</a>:</h4>
<p>oof, yeah.  it's not valid to actually use the pointer if the metadata is over isize::MAX, but it can still be made :(</p>



<a name="278375573"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/219381-t-libs/topic/Pointee%20metadata%20vs%20size_of/near/278375573" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> cuviper <a href="https://zulip-archive.rust-lang.org/stream/219381-t-libs/topic/Pointee.20metadata.20vs.20size_of.html#278375573">(Apr 08 2022 at 23:57)</a>:</h4>
<p>it's genuinely safe for a ZST</p>



<a name="278375608"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/219381-t-libs/topic/Pointee%20metadata%20vs%20size_of/near/278375608" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> cuviper <a href="https://zulip-archive.rust-lang.org/stream/219381-t-libs/topic/Pointee.20metadata.20vs.20size_of.html#278375608">(Apr 08 2022 at 23:58)</a>:</h4>
<p>otherwise I take it that the point is not really whether the metadata len is over <code>isize::MAX</code>, but the object size, <code>size_of::&lt;T&gt;()*len</code>, right?</p>



<a name="278375703"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/219381-t-libs/topic/Pointee%20metadata%20vs%20size_of/near/278375703" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Christopher Durham <a href="https://zulip-archive.rust-lang.org/stream/219381-t-libs/topic/Pointee.20metadata.20vs.20size_of.html#278375703">(Apr 08 2022 at 23:59)</a>:</h4>
<p>Yes</p>



<a name="278375859"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/219381-t-libs/topic/Pointee%20metadata%20vs%20size_of/near/278375859" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> scottmcm <a href="https://zulip-archive.rust-lang.org/stream/219381-t-libs/topic/Pointee.20metadata.20vs.20size_of.html#278375859">(Apr 09 2022 at 00:00)</a>:</h4>
<p>yeah, I guess that since it's <em>len</em>, it's more reasonable.  It's not obvious to me that it'd be good for slices of different types to have different <em>validity</em> invariants on the length</p>



<a name="278375903"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/219381-t-libs/topic/Pointee%20metadata%20vs%20size_of/near/278375903" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Christopher Durham <a href="https://zulip-archive.rust-lang.org/stream/219381-t-libs/topic/Pointee.20metadata.20vs.20size_of.html#278375903">(Apr 09 2022 at 00:01)</a>:</h4>
<p>It wouldn't have to be <em>validity</em>, it could just be safety enforced by the API, though, at the "I am the language" level that doesn't make too much of a difference?</p>



<a name="278375955"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/219381-t-libs/topic/Pointee%20metadata%20vs%20size_of/near/278375955" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> cuviper <a href="https://zulip-archive.rust-lang.org/stream/219381-t-libs/topic/Pointee.20metadata.20vs.20size_of.html#278375955">(Apr 09 2022 at 00:02)</a>:</h4>
<p>go for <code>*const [[u8; isize::MAX]]</code>, now your valid slice length is a <code>bool</code></p>



<a name="278375997"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/219381-t-libs/topic/Pointee%20metadata%20vs%20size_of/near/278375997" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Christopher Durham <a href="https://zulip-archive.rust-lang.org/stream/219381-t-libs/topic/Pointee.20metadata.20vs.20size_of.html#278375997">(Apr 09 2022 at 00:03)</a>:</h4>
<p>Like what I care about isn't invalid values, I just wish it were a possibility for <code>metadata(ptr).size()</code> to be safe</p>



<a name="278376012"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/219381-t-libs/topic/Pointee%20metadata%20vs%20size_of/near/278376012" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Christopher Durham <a href="https://zulip-archive.rust-lang.org/stream/219381-t-libs/topic/Pointee.20metadata.20vs.20size_of.html#278376012">(Apr 09 2022 at 00:03)</a>:</h4>
<p>Pointers-to-overlong-slice being safe to create make that an impossibility for the current intrinsic though</p>



<a name="278376117"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/219381-t-libs/topic/Pointee%20metadata%20vs%20size_of/near/278376117" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> The 8472 <a href="https://zulip-archive.rust-lang.org/stream/219381-t-libs/topic/Pointee.20metadata.20vs.20size_of.html#278376117">(Apr 09 2022 at 00:05)</a>:</h4>
<p>The <code>*const [T]</code> len being <code>&lt; isize::MAX</code> bytes is less useful than one would think because it still does not enable using <code>ptr::add</code> since that requires operations to be in-bounds. So in practice you need len not just be small enough, you need it to be correct.</p>



<a name="278376192"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/219381-t-libs/topic/Pointee%20metadata%20vs%20size_of/near/278376192" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Christopher Durham <a href="https://zulip-archive.rust-lang.org/stream/219381-t-libs/topic/Pointee.20metadata.20vs.20size_of.html#278376192">(Apr 09 2022 at 00:06)</a>:</h4>
<p>Again, I'm not personally concerned about len right now, I'm looking at the size of the described object's layout</p>



<a name="278376207"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/219381-t-libs/topic/Pointee%20metadata%20vs%20size_of/near/278376207" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Christopher Durham <a href="https://zulip-archive.rust-lang.org/stream/219381-t-libs/topic/Pointee.20metadata.20vs.20size_of.html#278376207">(Apr 09 2022 at 00:06)</a>:</h4>
<p>byte size, not element length</p>



<a name="278376220"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/219381-t-libs/topic/Pointee%20metadata%20vs%20size_of/near/278376220" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> cuviper <a href="https://zulip-archive.rust-lang.org/stream/219381-t-libs/topic/Pointee.20metadata.20vs.20size_of.html#278376220">(Apr 09 2022 at 00:07)</a>:</h4>
<p><span class="user-mention silent" data-user-id="132829">Christopher Durham</span> <a href="#narrow/stream/219381-t-libs/topic/Pointee.20metadata.20vs.20size_of/near/278375997">said</a>:</p>
<blockquote>
<p>Like what I care about isn't invalid values, I just wish it were a possibility for <code>metadata(ptr).size()</code> to be safe</p>
</blockquote>
<p>where is this <code>fn size()</code>? something new?</p>



<a name="278376247"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/219381-t-libs/topic/Pointee%20metadata%20vs%20size_of/near/278376247" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Christopher Durham <a href="https://zulip-archive.rust-lang.org/stream/219381-t-libs/topic/Pointee.20metadata.20vs.20size_of.html#278376247">(Apr 09 2022 at 00:07)</a>:</h4>
<p><code>DynMetadata</code> has a <code>size_of</code>, I was playing off of that accidentally</p>



<a name="278376295"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/219381-t-libs/topic/Pointee%20metadata%20vs%20size_of/near/278376295" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Christopher Durham <a href="https://zulip-archive.rust-lang.org/stream/219381-t-libs/topic/Pointee.20metadata.20vs.20size_of.html#278376295">(Apr 09 2022 at 00:08)</a>:</h4>
<p>The proper spelling is in fact <code>mem::size_of_val_raw</code> or <code>intrinsics::size_of_val</code></p>



<a name="278376307"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/219381-t-libs/topic/Pointee%20metadata%20vs%20size_of/near/278376307" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> cuviper <a href="https://zulip-archive.rust-lang.org/stream/219381-t-libs/topic/Pointee.20metadata.20vs.20size_of.html#278376307">(Apr 09 2022 at 00:08)</a>:</h4>
<p>ah</p>



<a name="278376322"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/219381-t-libs/topic/Pointee%20metadata%20vs%20size_of/near/278376322" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> cuviper <a href="https://zulip-archive.rust-lang.org/stream/219381-t-libs/topic/Pointee.20metadata.20vs.20size_of.html#278376322">(Apr 09 2022 at 00:09)</a>:</h4>
<p>that could safely return an <code>Option&lt;usize&gt;</code></p>



<a name="278376335"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/219381-t-libs/topic/Pointee%20metadata%20vs%20size_of/near/278376335" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Christopher Durham <a href="https://zulip-archive.rust-lang.org/stream/219381-t-libs/topic/Pointee.20metadata.20vs.20size_of.html#278376335">(Apr 09 2022 at 00:09)</a>:</h4>
<p>The current implementation (I'm looking at it) is codegenning <code>size_of::&lt;T&gt;() * len</code> directly for the intrinsic</p>



<a name="278376394"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/219381-t-libs/topic/Pointee%20metadata%20vs%20size_of/near/278376394" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Christopher Durham <a href="https://zulip-archive.rust-lang.org/stream/219381-t-libs/topic/Pointee.20metadata.20vs.20size_of.html#278376394">(Apr 09 2022 at 00:10)</a>:</h4>
<p>All it'd need to do really is do a checked mul, then the wrapper can cordon it off to <code>isize::MAX</code></p>



<a name="278376416"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/219381-t-libs/topic/Pointee%20metadata%20vs%20size_of/near/278376416" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Christopher Durham <a href="https://zulip-archive.rust-lang.org/stream/219381-t-libs/topic/Pointee.20metadata.20vs.20size_of.html#278376416">(Apr 09 2022 at 00:10)</a>:</h4>
<p>However, doing so is not trivial because <code>bx</code> doesn't have a <code>checked_mul</code></p>



<a name="278376442"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/219381-t-libs/topic/Pointee%20metadata%20vs%20size_of/near/278376442" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Christopher Durham <a href="https://zulip-archive.rust-lang.org/stream/219381-t-libs/topic/Pointee.20metadata.20vs.20size_of.html#278376442">(Apr 09 2022 at 00:11)</a>:</h4>
<p>So it could be done for slice pointers <em>specifically</em>, but pointers generally is still problematic</p>



<a name="278376501"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/219381-t-libs/topic/Pointee%20metadata%20vs%20size_of/near/278376501" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> cuviper <a href="https://zulip-archive.rust-lang.org/stream/219381-t-libs/topic/Pointee.20metadata.20vs.20size_of.html#278376501">(Apr 09 2022 at 00:12)</a>:</h4>
<p>where else is it problematic? concrete types should already have limited size, and trait objects should have a concrete vtable with a valid size</p>



<a name="278376577"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/219381-t-libs/topic/Pointee%20metadata%20vs%20size_of/near/278376577" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Christopher Durham <a href="https://zulip-archive.rust-lang.org/stream/219381-t-libs/topic/Pointee.20metadata.20vs.20size_of.html#278376577">(Apr 09 2022 at 00:14)</a>:</h4>
<p>In that codegen has to emit the checked mul and a) making intrinsic size_of slower is scary and b) I have no idea how to do so anyway<br>
Also, technically it's not decided that raw pointers to trait objects have a <em>valid</em> vtable as an invariant, just that it's nonnull</p>



<a name="278376859"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/219381-t-libs/topic/Pointee%20metadata%20vs%20size_of/near/278376859" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Christopher Durham <a href="https://zulip-archive.rust-lang.org/stream/219381-t-libs/topic/Pointee.20metadata.20vs.20size_of.html#278376859">(Apr 09 2022 at 00:20)</a>:</h4>
<p>The TL;DR of what I'm banging my head against is that the <code>isize::MAX</code> limit on size is too difficult to maintain by hand, so we want to do so automatically through <code>Layout</code>... but I want to prove out the storages API, which deals exclusively in pointer metadata, not in <code>Layout</code>, so we've lost that protection layer. The solution is to catch that as part of the storages API and return an alloc error. And that basically means safe versions of <code>intrinsic::size_of_val</code> and <code>intrinsic::align_of_val</code>.</p>



<a name="278376966"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/219381-t-libs/topic/Pointee%20metadata%20vs%20size_of/near/278376966" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Christopher Durham <a href="https://zulip-archive.rust-lang.org/stream/219381-t-libs/topic/Pointee.20metadata.20vs.20size_of.html#278376966">(Apr 09 2022 at 00:22)</a>:</h4>
<blockquote>
<p>checked mul</p>
</blockquote>
<p>s/checked/saturating</p>



<a name="278377359"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/219381-t-libs/topic/Pointee%20metadata%20vs%20size_of/near/278377359" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> scottmcm <a href="https://zulip-archive.rust-lang.org/stream/219381-t-libs/topic/Pointee.20metadata.20vs.20size_of.html#278377359">(Apr 09 2022 at 00:30)</a>:</h4>
<p>Oh, right, LLVM only has fixed-point saturating multiplication intrinsics and saturating addition intrinsics.  So probably no <code>bx</code> for umul_sat</p>



<a name="278377703"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/219381-t-libs/topic/Pointee%20metadata%20vs%20size_of/near/278377703" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Christopher Durham <a href="https://zulip-archive.rust-lang.org/stream/219381-t-libs/topic/Pointee.20metadata.20vs.20size_of.html#278377703">(Apr 09 2022 at 00:37)</a>:</h4>
<p>saturating_mul is implemented as checked_mul, via bx.checked_binop, so I'm almost to making it use a saturating mul, except, I need to get a Ty for usize and since this is my first time touching compiler things this deep I have no idea how to do so and it doesn't help that in <code>size_and_align_of_dst</code> I only have <code>bx</code> and <code>t: Ty</code></p>



<a name="278377773"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/219381-t-libs/topic/Pointee%20metadata%20vs%20size_of/near/278377773" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Christopher Durham <a href="https://zulip-archive.rust-lang.org/stream/219381-t-libs/topic/Pointee.20metadata.20vs.20size_of.html#278377773">(Apr 09 2022 at 00:39)</a>:</h4>
<p>aka no TyCtxt</p>



<a name="278378392"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/219381-t-libs/topic/Pointee%20metadata%20vs%20size_of/near/278378392" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Christopher Durham <a href="https://zulip-archive.rust-lang.org/stream/219381-t-libs/topic/Pointee.20metadata.20vs.20size_of.html#278378392">(Apr 09 2022 at 00:52)</a>:</h4>
<p>Also there's the case of a composite type with unsized tail that I haven't even really considered</p>



<a name="278378489"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/219381-t-libs/topic/Pointee%20metadata%20vs%20size_of/near/278378489" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Christopher Durham <a href="https://zulip-archive.rust-lang.org/stream/219381-t-libs/topic/Pointee.20metadata.20vs.20size_of.html#278378489">(Apr 09 2022 at 00:55)</a>:</h4>
<p>Aha: <code>bx.cx().tcx()</code> is the path to get to the tcx</p>



<a name="278380606"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/219381-t-libs/topic/Pointee%20metadata%20vs%20size_of/near/278380606" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Christopher Durham <a href="https://zulip-archive.rust-lang.org/stream/219381-t-libs/topic/Pointee.20metadata.20vs.20size_of.html#278380606">(Apr 09 2022 at 01:42)</a>:</h4>
<p>Well I got the saturating mul, but a saturating add is what stops me from making it saturate for compound types as well...</p>



<a name="278380620"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/219381-t-libs/topic/Pointee%20metadata%20vs%20size_of/near/278380620" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Christopher Durham <a href="https://zulip-archive.rust-lang.org/stream/219381-t-libs/topic/Pointee.20metadata.20vs.20size_of.html#278380620">(Apr 09 2022 at 01:43)</a>:</h4>
<p>Well, I filled <a href="https://github.com/rust-lang/rust/pull/95832">https://github.com/rust-lang/rust/pull/95832</a> to try and see if this is a performance impact oh of <em>course</em> test 11600/12907 or so failed just after I hit send</p>



<hr><p>Last updated: Apr 12 2022 at 20:01 UTC</p>
</html>