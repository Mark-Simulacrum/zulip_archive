<html>
<head><meta charset="utf-8"><title>Why does `BTreeMap::new` require `K: Ord` · t-libs · Zulip Chat Archive</title></head>
<h2>Stream: <a href="https://zulip-archive.rust-lang.org/stream/219381-t-libs/index.html">t-libs</a></h2>
<h3>Topic: <a href="https://zulip-archive.rust-lang.org/stream/219381-t-libs/topic/Why.20does.20.60BTreeMap.3A.3Anew.60.20require.20.60K.3A.20Ord.60.html">Why does `BTreeMap::new` require `K: Ord`</a></h3>

<hr>

<base href="https://rust-lang.zulipchat.com">

<head><link href="https://zulip-archive.rust-lang.org/style.css" rel="stylesheet"></head>

<a name="249320180"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/219381-t-libs/topic/Why%20does%20%60BTreeMap%3A%3Anew%60%20require%20%60K%3A%20Ord%60/near/249320180" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Gary Guo <a href="https://zulip-archive.rust-lang.org/stream/219381-t-libs/topic/Why.20does.20.60BTreeMap.3A.3Anew.60.20require.20.60K.3A.20Ord.60.html#249320180">(Aug 13 2021 at 04:03)</a>:</h4>
<p>It seems to me that the <code>K: Ord</code> bound is unnecessary here and would interact with const_fn_trait_bound  in an undesirable way (see <a href="https://github.com/rust-lang/rust/issues/87375">#87375</a>)</p>



<a name="249348173"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/219381-t-libs/topic/Why%20does%20%60BTreeMap%3A%3Anew%60%20require%20%60K%3A%20Ord%60/near/249348173" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Triplett <a href="https://zulip-archive.rust-lang.org/stream/219381-t-libs/topic/Why.20does.20.60BTreeMap.3A.3Anew.60.20require.20.60K.3A.20Ord.60.html#249348173">(Aug 13 2021 at 11:20)</a>:</h4>
<p>Are you just proposing that new doesn't need to be able to keep elements ordered because it doesn't insert any elements?</p>



<a name="249349930"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/219381-t-libs/topic/Why%20does%20%60BTreeMap%3A%3Anew%60%20require%20%60K%3A%20Ord%60/near/249349930" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Frank Steffahn <a href="https://zulip-archive.rust-lang.org/stream/219381-t-libs/topic/Why.20does.20.60BTreeMap.3A.3Anew.60.20require.20.60K.3A.20Ord.60.html#249349930">(Aug 13 2021 at 11:45)</a>:</h4>
<p>The situation is analogous to <a href="https://doc.rust-lang.org/std/collections/struct.HashMap.html#method.new"><code>HashMap::new</code></a> not having a <code>K:</code><a href="https://doc.rust-lang.org/std/cmp/trait.Eq.html"><code>Eq</code></a><code>+</code><a href="https://doc.rust-lang.org/std/hash/trait.Hash.html"><code>Hash</code></a> bound. IMO, the <code>K: Ord</code> bound should be removed.</p>



<a name="249351491"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/219381-t-libs/topic/Why%20does%20%60BTreeMap%3A%3Anew%60%20require%20%60K%3A%20Ord%60/near/249351491" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Frank Steffahn <a href="https://zulip-archive.rust-lang.org/stream/219381-t-libs/topic/Why.20does.20.60BTreeMap.3A.3Anew.60.20require.20.60K.3A.20Ord.60.html#249351491">(Aug 13 2021 at 12:02)</a>:</h4>
<p>There seems to be a lot of discussion on this in <a href="https://github.com/rust-lang/rust/issues/79245">#79245</a></p>



<a name="249364341"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/219381-t-libs/topic/Why%20does%20%60BTreeMap%3A%3Anew%60%20require%20%60K%3A%20Ord%60/near/249364341" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Gary Guo <a href="https://zulip-archive.rust-lang.org/stream/219381-t-libs/topic/Why.20does.20.60BTreeMap.3A.3Anew.60.20require.20.60K.3A.20Ord.60.html#249364341">(Aug 13 2021 at 14:06)</a>:</h4>
<p>Seems that in that discussion the only reason for not removing bound on "BTreeMap::new" is "hashbrown has some issue before"</p>



<a name="249364379"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/219381-t-libs/topic/Why%20does%20%60BTreeMap%3A%3Anew%60%20require%20%60K%3A%20Ord%60/near/249364379" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Gary Guo <a href="https://zulip-archive.rust-lang.org/stream/219381-t-libs/topic/Why.20does.20.60BTreeMap.3A.3Anew.60.20require.20.60K.3A.20Ord.60.html#249364379">(Aug 13 2021 at 14:06)</a>:</h4>
<p>But I fail to see why it'd be problematic for BTreeMap.</p>



<a name="249375362"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/219381-t-libs/topic/Why%20does%20%60BTreeMap%3A%3Anew%60%20require%20%60K%3A%20Ord%60/near/249375362" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Frank Steffahn <a href="https://zulip-archive.rust-lang.org/stream/219381-t-libs/topic/Why.20does.20.60BTreeMap.3A.3Anew.60.20require.20.60K.3A.20Ord.60.html#249375362">(Aug 13 2021 at 15:32)</a>:</h4>
<p>To give another point of context / comparison: <code>Haskell</code>’s <a href="https://hackage.haskell.org/package/containers-0.6.5.1/docs/Data-Map-Lazy.html#g:1"><code>Map</code></a> and <a href="https://hackage.haskell.org/package/containers-0.6.5.1/docs/Data-Set.html#g:1"><code>Set</code></a> datatypes (which are <a href="https://hackage.haskell.org/package/base-4.15.0.0/docs/Data-Ord.html"><code>Ord</code></a> based data structures using search trees, similar to <code>BTree(Map|Set)</code> in Rust) <a href="https://hackage.haskell.org/package/containers-0.6.5.1/docs/Data-Map-Lazy.html#g:2">do offer constructors for empty and even single-element maps/sets without an <code>Ord</code> bound on the key type</a>.</p>



<a name="249375953"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/219381-t-libs/topic/Why%20does%20%60BTreeMap%3A%3Anew%60%20require%20%60K%3A%20Ord%60/near/249375953" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Frank Steffahn <a href="https://zulip-archive.rust-lang.org/stream/219381-t-libs/topic/Why.20does.20.60BTreeMap.3A.3Anew.60.20require.20.60K.3A.20Ord.60.html#249375953">(Aug 13 2021 at 15:36)</a>:</h4>
<p>I’m also having a hard time figuring out the exact reason why the PR <a href="https://github.com/rust-lang/rust/issues/79245">#79245</a> removed so many of its changes, including the one that would’ve eliminated the <code>K: Ord</code> bound for <code>::new</code>. Admitted, I only skimmed some of the comments. But maybe there was additional off-thread discussion? Anyways, it probably wouldn’t hurt to just open a new PR and get the relevant feedback there if there <em>really are</em> any good reasons against the change.</p>
<p>Notably, the argument that removing the bound helps with <code>const</code> usage is one that I couldn’t find at all in <a href="https://github.com/rust-lang/rust/issues/79245">#79245</a>. In particular, as <code>const</code> is particularly common as a requirement for initializing static variables, this seems like a very relevant/strong argument in favor of the removal of the bound.</p>



<a name="249515523"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/219381-t-libs/topic/Why%20does%20%60BTreeMap%3A%3Anew%60%20require%20%60K%3A%20Ord%60/near/249515523" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Frank Steffahn <a href="https://zulip-archive.rust-lang.org/stream/219381-t-libs/topic/Why.20does.20.60BTreeMap.3A.3Anew.60.20require.20.60K.3A.20Ord.60.html#249515523">(Aug 15 2021 at 14:28)</a>:</h4>
<p>For anyone else reading this topic, note that there’s now a <a href="https://github.com/rust-lang/rust/issues/88040">#88040</a> opened by <span class="user-mention silent" data-user-id="303710">Gary Guo</span> that removes the <code>Ord</code> bound from <code>BTree(Map|Set)::(new|default)</code></p>



<hr><p>Last updated: Apr 12 2022 at 20:01 UTC</p>
</html>