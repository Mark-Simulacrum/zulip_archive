<html>
<head><meta charset="utf-8"><title>proc macro diagnostics Â· t-libs Â· Zulip Chat Archive</title></head>
<h2>Stream: <a href="https://zulip-archive.rust-lang.org/stream/219381-t-libs/index.html">t-libs</a></h2>
<h3>Topic: <a href="https://zulip-archive.rust-lang.org/stream/219381-t-libs/topic/proc.20macro.20diagnostics.html">proc macro diagnostics</a></h3>

<hr>

<base href="https://rust-lang.zulipchat.com">

<head><link href="https://zulip-archive.rust-lang.org/style.css" rel="stylesheet"></head>

<a name="274288923"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/219381-t-libs/topic/proc%20macro%20diagnostics/near/274288923" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jacob Pratt ðŸ‡ºðŸ‡¦ <a href="https://zulip-archive.rust-lang.org/stream/219381-t-libs/topic/proc.20macro.20diagnostics.html#274288923">(Mar 06 2022 at 06:30)</a>:</h4>
<p>Not a big priority of mine, but I just remembered that <a href="https://github.com/rust-lang/rust/issues/83363">#83363</a> has been open for just shy of a year. <a href="https://github.com/rust-lang/rust/issues/54140#issuecomment-944798181">Jane had a concern</a> about the proposed design for proc macro diagnostics, namely the ability to emit diagnostics without a primary span. This was raised back in October and hasn't had any activity since. How do people feel about this? I think proc macro diagnostics is one of the more influential things we could lang.</p>



<a name="274295648"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/219381-t-libs/topic/proc%20macro%20diagnostics/near/274295648" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> oli <a href="https://zulip-archive.rust-lang.org/stream/219381-t-libs/topic/proc.20macro.20diagnostics.html#274295648">(Mar 06 2022 at 09:26)</a>:</h4>
<p>I think as long as it's trivial to get the span of the macro call site, we don't need a spanless diagnostics API, as for those few cases, the extra effort of getting the call site span explicitly is not an issue</p>



<a name="274295966"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/219381-t-libs/topic/proc%20macro%20diagnostics/near/274295966" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> oli <a href="https://zulip-archive.rust-lang.org/stream/219381-t-libs/topic/proc.20macro.20diagnostics.html#274295966">(Mar 06 2022 at 09:34)</a>:</h4>
<p>That said, I am still in favour of starting with a much simpler API similar to how we started with a proc macro API that only supported a <code>to_string</code> operation. We could have a diagnostic builder similar to the one in rustc, but only expose a <code>from_json_str_with_placeholders</code> API that wants a diagnostic json string (with span placeholders instead of file/line info). Then user space can write APIs in crates and we can figure out whether to stabilize a better API from there</p>



<a name="274319586"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/219381-t-libs/topic/proc%20macro%20diagnostics/near/274319586" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jacob Pratt ðŸ‡ºðŸ‡¦ <a href="https://zulip-archive.rust-lang.org/stream/219381-t-libs/topic/proc.20macro.20diagnostics.html#274319586">(Mar 06 2022 at 18:01)</a>:</h4>
<p>cc <span class="user-mention" data-user-id="119235">@David Tolnay</span>, who seconded the proposed API. It doesn't look like Sergio is active on Zulip nowadays. What use case might there be for diagnostics <em>without</em> a primary span? Is it used in the compiler/stdlib anywhere?</p>



<hr><p>Last updated: Apr 12 2022 at 20:01 UTC</p>
</html>