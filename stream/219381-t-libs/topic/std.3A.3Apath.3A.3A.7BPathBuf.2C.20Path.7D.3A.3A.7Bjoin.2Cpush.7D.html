<html>
<head><meta charset="utf-8"><title>std::path::{PathBuf, Path}::{join,push} · t-libs · Zulip Chat Archive</title></head>
<h2>Stream: <a href="https://zulip-archive.rust-lang.org/stream/219381-t-libs/index.html">t-libs</a></h2>
<h3>Topic: <a href="https://zulip-archive.rust-lang.org/stream/219381-t-libs/topic/std.3A.3Apath.3A.3A.7BPathBuf.2C.20Path.7D.3A.3A.7Bjoin.2Cpush.7D.html">std::path::{PathBuf, Path}::{join,push}</a></h3>

<hr>

<base href="https://rust-lang.zulipchat.com">

<head><link href="https://zulip-archive.rust-lang.org/style.css" rel="stylesheet"></head>

<a name="256919819"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/219381-t-libs/topic/std%3A%3Apath%3A%3A%7BPathBuf%2C%20Path%7D%3A%3A%7Bjoin%2Cpush%7D/near/256919819" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ahmed Masud <a href="https://zulip-archive.rust-lang.org/stream/219381-t-libs/topic/std.3A.3Apath.3A.3A.7BPathBuf.2C.20Path.7D.3A.3A.7Bjoin.2Cpush.7D.html#256919819">(Oct 10 2021 at 03:16)</a>:</h4>
<p>Hi everyone :) not sure who I should address this to so here we are :-) </p>
<p>The <code>std::path::{PathBuf, Path}::{push, join}</code> have a weird (albeit documented) behavior.  In particular,</p>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="kd">let</span><span class="w"> </span><span class="n">root</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">PathBuf</span>::<span class="n">from</span><span class="p">(</span><span class="s">"/some/root"</span><span class="p">);</span><span class="w"></span>
<span class="kd">let</span><span class="w"> </span><span class="n">foo</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">PathBuf</span>::<span class="n">from</span><span class="p">(</span><span class="s">"/foo"</span><span class="p">);</span><span class="w"></span>
<span class="kd">let</span><span class="w"> </span><span class="n">real_foo_path</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">root</span><span class="p">.</span><span class="n">join</span><span class="p">(</span><span class="n">foo</span><span class="p">)</span><span class="w"></span>
</code></pre></div>
<p>Documentation not withstanding, one would expect a join (or a push) to append foo to root, and for <code>real_foo_path</code> to contain <code>/some/root/foo</code>.  However the current (admittedly documented) behavior is that real_foo_path becomes <code>"/foo"</code>  ... Given that semantically one should expect a <code>join</code> to do a <code>join</code> (and a push to perform an append) instead of a replace. If misunderstood by programmers (which I feel this has a better than 50% chance of being misunderstood) can lead to weird and subtle bugs that would be hard to trace if someone made  (a reasonably) assumptive mistake that join and push work identically to the behaviors in:</p>
<table>
<thead>
<tr>
<th>Call</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>std::collections::BinaryHeap::push</code></td>
<td>Pushes an item onto the binary heap.</td>
</tr>
<tr>
<td><code>std::ffi::OsString::push</code></td>
<td>Extends the string with the given &amp;OsStr slice.</td>
</tr>
<tr>
<td><code>std::path::PathBuf::push</code></td>
<td>Extends self with path.</td>
</tr>
<tr>
<td><code>std::string::String::push</code></td>
<td>Appends the given char to the end of this String.</td>
</tr>
<tr>
<td><code>std::vec::Vec::push</code></td>
<td>Appends an element to the back of a collection.</td>
</tr>
<tr>
<td><code>std::string::String::push_str</code></td>
<td>Appends a given string slice onto the end of this String.</td>
</tr>
<tr>
<td><code>std::collections::LinkedList::push_back</code></td>
<td>Appends an element to the back of a list.</td>
</tr>
<tr>
<td><code>std::collections::VecDeque::push_back</code></td>
<td>Appends an element to the back of the VecDeque.</td>
</tr>
<tr>
<td><code>std::collections::linked_list::CursorMut::push_back</code></td>
<td>Appends an element to the back of the cursor's parent</td>
</tr>
<tr>
<td><code>std::collections::LinkedList::push_front</code></td>
<td>Adds an element first in the list.</td>
</tr>
<tr>
<td><code>std::collections::VecDeque::push_front</code></td>
<td>Prepends an element to the VecDeque.</td>
</tr>
<tr>
<td><code>std::collections::linked_list::CursorMut::push_front</code></td>
<td>Appends an element to the front of the cursor’s parent.</td>
</tr>
</tbody>
</table>
<p>similarly for <code>slice::join</code> the behavior is to join two thing together.</p>
<p>From the summary above, PathBuf reads as if it would behave the way I was expecting and not in the way that it does.</p>
<p>My question is, is this something that should be changed? Or what would be the procedure to extend help with this? </p>
<p>Cheers,</p>



<a name="256920522"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/219381-t-libs/topic/std%3A%3Apath%3A%3A%7BPathBuf%2C%20Path%7D%3A%3A%7Bjoin%2Cpush%7D/near/256920522" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Gary Guo <a href="https://zulip-archive.rust-lang.org/stream/219381-t-libs/topic/std.3A.3Apath.3A.3A.7BPathBuf.2C.20Path.7D.3A.3A.7Bjoin.2Cpush.7D.html#256920522">(Oct 10 2021 at 03:30)</a>:</h4>
<p>PathBuf::push's doc reads:</p>
<blockquote>
<p>Extends self with path.</p>
<p>If path is absolute, it replaces the current path.</p>
</blockquote>



<a name="256920540"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/219381-t-libs/topic/std%3A%3Apath%3A%3A%7BPathBuf%2C%20Path%7D%3A%3A%7Bjoin%2Cpush%7D/near/256920540" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Gary Guo <a href="https://zulip-archive.rust-lang.org/stream/219381-t-libs/topic/std.3A.3Apath.3A.3A.7BPathBuf.2C.20Path.7D.3A.3A.7Bjoin.2Cpush.7D.html#256920540">(Oct 10 2021 at 03:30)</a>:</h4>
<p>This behaviour is documented and being relied on, so no, it couldn't changed.</p>



<a name="256932179"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/219381-t-libs/topic/std%3A%3Apath%3A%3A%7BPathBuf%2C%20Path%7D%3A%3A%7Bjoin%2Cpush%7D/near/256932179" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ahmed Masud <a href="https://zulip-archive.rust-lang.org/stream/219381-t-libs/topic/std.3A.3Apath.3A.3A.7BPathBuf.2C.20Path.7D.3A.3A.7Bjoin.2Cpush.7D.html#256932179">(Oct 10 2021 at 07:05)</a>:</h4>
<p><span class="user-mention" data-user-id="303710">@Gary Guo</span> yes. and TY</p>



<a name="256935877"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/219381-t-libs/topic/std%3A%3Apath%3A%3A%7BPathBuf%2C%20Path%7D%3A%3A%7Bjoin%2Cpush%7D/near/256935877" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> The 8472 <a href="https://zulip-archive.rust-lang.org/stream/219381-t-libs/topic/std.3A.3Apath.3A.3A.7BPathBuf.2C.20Path.7D.3A.3A.7Bjoin.2Cpush.7D.html#256935877">(Oct 10 2021 at 08:08)</a>:</h4>
<p>this is consistent with filesystem behavior (openat) and path resolution of various other programming languages. Even URL parsers. absolute resolved on another path just returns the absolute one</p>



<a name="256935920"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/219381-t-libs/topic/std%3A%3Apath%3A%3A%7BPathBuf%2C%20Path%7D%3A%3A%7Bjoin%2Cpush%7D/near/256935920" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> The 8472 <a href="https://zulip-archive.rust-lang.org/stream/219381-t-libs/topic/std.3A.3Apath.3A.3A.7BPathBuf.2C.20Path.7D.3A.3A.7Bjoin.2Cpush.7D.html#256935920">(Oct 10 2021 at 08:09)</a>:</h4>
<p>perhaps it should have been named better. some other langs call it <code>resolve</code></p>



<a name="256936522"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/219381-t-libs/topic/std%3A%3Apath%3A%3A%7BPathBuf%2C%20Path%7D%3A%3A%7Bjoin%2Cpush%7D/near/256936522" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Chris Denton <a href="https://zulip-archive.rust-lang.org/stream/219381-t-libs/topic/std.3A.3Apath.3A.3A.7BPathBuf.2C.20Path.7D.3A.3A.7Bjoin.2Cpush.7D.html#256936522">(Oct 10 2021 at 08:19)</a>:</h4>
<p>I do think there should be a <code>push_relative</code> (or similar) for when you don't want this behaviour.</p>



<a name="256936659"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/219381-t-libs/topic/std%3A%3Apath%3A%3A%7BPathBuf%2C%20Path%7D%3A%3A%7Bjoin%2Cpush%7D/near/256936659" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> The 8472 <a href="https://zulip-archive.rust-lang.org/stream/219381-t-libs/topic/std.3A.3Apath.3A.3A.7BPathBuf.2C.20Path.7D.3A.3A.7Bjoin.2Cpush.7D.html#256936659">(Oct 10 2021 at 08:21)</a>:</h4>
<p>why is your path starting with a / though if you want it to be relative?</p>



<a name="256936843"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/219381-t-libs/topic/std%3A%3Apath%3A%3A%7BPathBuf%2C%20Path%7D%3A%3A%7Bjoin%2Cpush%7D/near/256936843" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> The 8472 <a href="https://zulip-archive.rust-lang.org/stream/219381-t-libs/topic/std.3A.3Apath.3A.3A.7BPathBuf.2C.20Path.7D.3A.3A.7Bjoin.2Cpush.7D.html#256936843">(Oct 10 2021 at 08:24)</a>:</h4>
<p>and how would it work on windows if you push <code>C:\</code> ?</p>



<hr><p>Last updated: Apr 12 2022 at 20:01 UTC</p>
</html>