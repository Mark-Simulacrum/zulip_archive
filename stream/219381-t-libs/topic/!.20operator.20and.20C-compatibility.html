<html>
<head><meta charset="utf-8"><title>! operator and C-compatibility · t-libs · Zulip Chat Archive</title></head>
<h2>Stream: <a href="https://zulip-archive.rust-lang.org/stream/219381-t-libs/index.html">t-libs</a></h2>
<h3>Topic: <a href="https://zulip-archive.rust-lang.org/stream/219381-t-libs/topic/!.20operator.20and.20C-compatibility.html">! operator and C-compatibility</a></h3>

<hr>

<base href="https://rust-lang.zulipchat.com">

<head><link href="https://zulip-archive.rust-lang.org/style.css" rel="stylesheet"></head>

<a name="251102062"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/219381-t-libs/topic/%21%20operator%20and%20C-compatibility/near/251102062" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Triplett <a href="https://zulip-archive.rust-lang.org/stream/219381-t-libs/topic/!.20operator.20and.20C-compatibility.html#251102062">(Aug 29 2021 at 03:35)</a>:</h4>
<p>(Speaking of C-compatible, I wish we hadn't made <code>!</code> mean bitwise negation on integers, and I wonder if <em>that's</em> too late to change, but that's for another thread...)</p>



<a name="251102109"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/219381-t-libs/topic/%21%20operator%20and%20C-compatibility/near/251102109" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Mario Carneiro <a href="https://zulip-archive.rust-lang.org/stream/219381-t-libs/topic/!.20operator.20and.20C-compatibility.html#251102109">(Aug 29 2021 at 03:36)</a>:</h4>
<p>that's not even C-compatible though?</p>



<a name="251102114"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/219381-t-libs/topic/%21%20operator%20and%20C-compatibility/near/251102114" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Mario Carneiro <a href="https://zulip-archive.rust-lang.org/stream/219381-t-libs/topic/!.20operator.20and.20C-compatibility.html#251102114">(Aug 29 2021 at 03:36)</a>:</h4>
<p>or is that your point</p>



<a name="251102120"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/219381-t-libs/topic/%21%20operator%20and%20C-compatibility/near/251102120" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Triplett <a href="https://zulip-archive.rust-lang.org/stream/219381-t-libs/topic/!.20operator.20and.20C-compatibility.html#251102120">(Aug 29 2021 at 03:36)</a>:</h4>
<p>That's what I mean; it's <em>not</em> C-compatible, and I think we should have made it an error instead of defining it.</p>



<a name="251102129"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/219381-t-libs/topic/%21%20operator%20and%20C-compatibility/near/251102129" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Mario Carneiro <a href="https://zulip-archive.rust-lang.org/stream/219381-t-libs/topic/!.20operator.20and.20C-compatibility.html#251102129">(Aug 29 2021 at 03:37)</a>:</h4>
<p>it saves us an operator, dunno how important it is</p>



<a name="251102131"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/219381-t-libs/topic/%21%20operator%20and%20C-compatibility/near/251102131" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Triplett <a href="https://zulip-archive.rust-lang.org/stream/219381-t-libs/topic/!.20operator.20and.20C-compatibility.html#251102131">(Aug 29 2021 at 03:37)</a>:</h4>
<p>I just came across, today, another person who tried to translate C code to Rust and tripped over that silently compiling into the wrong code.</p>



<a name="251102153"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/219381-t-libs/topic/%21%20operator%20and%20C-compatibility/near/251102153" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Mario Carneiro <a href="https://zulip-archive.rust-lang.org/stream/219381-t-libs/topic/!.20operator.20and.20C-compatibility.html#251102153">(Aug 29 2021 at 03:37)</a>:</h4>
<p>I see, that makes sense</p>



<a name="251102202"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/219381-t-libs/topic/%21%20operator%20and%20C-compatibility/near/251102202" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Mario Carneiro <a href="https://zulip-archive.rust-lang.org/stream/219381-t-libs/topic/!.20operator.20and.20C-compatibility.html#251102202">(Aug 29 2021 at 03:38)</a>:</h4>
<p>I would prefer that C not have such terrible type discipline though <span aria-label="shrug" class="emoji emoji-1f937" role="img" title="shrug">:shrug:</span></p>



<a name="251102214"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/219381-t-libs/topic/%21%20operator%20and%20C-compatibility/near/251102214" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Triplett <a href="https://zulip-archive.rust-lang.org/stream/219381-t-libs/topic/!.20operator.20and.20C-compatibility.html#251102214">(Aug 29 2021 at 03:38)</a>:</h4>
<p>I'm not going to argue that it should coerce to bool; that'd be inconsistent with Rust being strict about the <code>bool</code> type. I just think it should be a compiler error (with a suggestion for "did you mean (whatever the spelling of ~ is)" and maybe another for "did you mean == 0").</p>



<a name="251102304"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/219381-t-libs/topic/%21%20operator%20and%20C-compatibility/near/251102304" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Mario Carneiro <a href="https://zulip-archive.rust-lang.org/stream/219381-t-libs/topic/!.20operator.20and.20C-compatibility.html#251102304">(Aug 29 2021 at 03:40)</a>:</h4>
<p>I guess the only way you would get something different in C from rust here is if you used <code>!</code> as an operator to turn an <code>int</code> into an <code>int</code>, because if either one is a <code>bool</code> then you get the right answer</p>



<a name="251102348"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/219381-t-libs/topic/%21%20operator%20and%20C-compatibility/near/251102348" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Triplett <a href="https://zulip-archive.rust-lang.org/stream/219381-t-libs/topic/!.20operator.20and.20C-compatibility.html#251102348">(Aug 29 2021 at 03:41)</a>:</h4>
<p>Or if you used it in an expression.</p>



<a name="251102382"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/219381-t-libs/topic/%21%20operator%20and%20C-compatibility/near/251102382" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Triplett <a href="https://zulip-archive.rust-lang.org/stream/219381-t-libs/topic/!.20operator.20and.20C-compatibility.html#251102382">(Aug 29 2021 at 03:42)</a>:</h4>
<p><code>expr + !thing</code> and <code>expr + !!thing</code> are not that rare.</p>



<a name="251102493"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/219381-t-libs/topic/%21%20operator%20and%20C-compatibility/near/251102493" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Mario Carneiro <a href="https://zulip-archive.rust-lang.org/stream/219381-t-libs/topic/!.20operator.20and.20C-compatibility.html#251102493">(Aug 29 2021 at 03:44)</a>:</h4>
<p>I wonder what c2rust does on examples like that</p>



<a name="251102778"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/219381-t-libs/topic/%21%20operator%20and%20C-compatibility/near/251102778" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Thom Chiovoloni <a href="https://zulip-archive.rust-lang.org/stream/219381-t-libs/topic/!.20operator.20and.20C-compatibility.html#251102778">(Aug 29 2021 at 03:50)</a>:</h4>
<blockquote>
<p>I wonder if that's too late to change, but that's for another thread...</p>
</blockquote>
<p>oh it's <em>way</em> too late for this one. i agree it can be a footgun when porting C code but it's also the only way to bit-negate.</p>



<a name="251102811"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/219381-t-libs/topic/%21%20operator%20and%20C-compatibility/near/251102811" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Triplett <a href="https://zulip-archive.rust-lang.org/stream/219381-t-libs/topic/!.20operator.20and.20C-compatibility.html#251102811">(Aug 29 2021 at 03:51)</a>:</h4>
<p><span class="user-mention" data-user-id="209168">@Thom Chiovoloni</span> I mean, given a rustfix-applicable suggestion, it wouldn't be <em>impossible</em>...</p>



<a name="251102822"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/219381-t-libs/topic/%21%20operator%20and%20C-compatibility/near/251102822" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Triplett <a href="https://zulip-archive.rust-lang.org/stream/219381-t-libs/topic/!.20operator.20and.20C-compatibility.html#251102822">(Aug 29 2021 at 03:51)</a>:</h4>
<p>I'm not arguing it'd be <em>worth it</em>.</p>



<a name="251102825"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/219381-t-libs/topic/%21%20operator%20and%20C-compatibility/near/251102825" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Thom Chiovoloni <a href="https://zulip-archive.rust-lang.org/stream/219381-t-libs/topic/!.20operator.20and.20C-compatibility.html#251102825">(Aug 29 2021 at 03:51)</a>:</h4>
<p>would that catch use in macros?</p>



<a name="251102833"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/219381-t-libs/topic/%21%20operator%20and%20C-compatibility/near/251102833" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Triplett <a href="https://zulip-archive.rust-lang.org/stream/219381-t-libs/topic/!.20operator.20and.20C-compatibility.html#251102833">(Aug 29 2021 at 03:51)</a>:</h4>
<p><span class="user-mention" data-user-id="209168">@Thom Chiovoloni</span> Yes, if we used an edition.</p>



<a name="251102885"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/219381-t-libs/topic/%21%20operator%20and%20C-compatibility/near/251102885" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Thom Chiovoloni <a href="https://zulip-archive.rust-lang.org/stream/219381-t-libs/topic/!.20operator.20and.20C-compatibility.html#251102885">(Aug 29 2021 at 03:52)</a>:</h4>
<p>hm, okay. i'm unsure how it could, but i'll take your word for it</p>



<a name="251102904"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/219381-t-libs/topic/%21%20operator%20and%20C-compatibility/near/251102904" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Triplett <a href="https://zulip-archive.rust-lang.org/stream/219381-t-libs/topic/!.20operator.20and.20C-compatibility.html#251102904">(Aug 29 2021 at 03:53)</a>:</h4>
<p>Macros know what edition they come from, and parse code accordingly. We would only make the change in a future edition, leaving code from the current edition working exactly as it does.</p>



<a name="251102919"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/219381-t-libs/topic/%21%20operator%20and%20C-compatibility/near/251102919" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Triplett <a href="https://zulip-archive.rust-lang.org/stream/219381-t-libs/topic/!.20operator.20and.20C-compatibility.html#251102919">(Aug 29 2021 at 03:53)</a>:</h4>
<p>I think it'd be disruptive enough we would have to do it over two editions, if we did it at all: edition N we add the new bitwise negation operator and deprecate (but not remove) the behavior of <code>!</code> on integers, and edition N+1 we make <code>!</code> on integers an error.</p>



<a name="251102984"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/219381-t-libs/topic/%21%20operator%20and%20C-compatibility/near/251102984" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Triplett <a href="https://zulip-archive.rust-lang.org/stream/219381-t-libs/topic/!.20operator.20and.20C-compatibility.html#251102984">(Aug 29 2021 at 03:54)</a>:</h4>
<p>That way, the move to edition N eliminates 99% of cases but all existing code still continues to compile (thanks to cap-lints).</p>



<a name="251103008"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/219381-t-libs/topic/%21%20operator%20and%20C-compatibility/near/251103008" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Thom Chiovoloni <a href="https://zulip-archive.rust-lang.org/stream/219381-t-libs/topic/!.20operator.20and.20C-compatibility.html#251103008">(Aug 29 2021 at 03:55)</a>:</h4>
<p>ah, yeah, i see</p>



<a name="251103021"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/219381-t-libs/topic/%21%20operator%20and%20C-compatibility/near/251103021" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Triplett <a href="https://zulip-archive.rust-lang.org/stream/219381-t-libs/topic/!.20operator.20and.20C-compatibility.html#251103021">(Aug 29 2021 at 03:55)</a>:</h4>
<p>I think it'd be <em>possible</em>, but it'd still be disruptive enough that it'd be questionable whether it was worthwhile.</p>



<a name="251103037"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/219381-t-libs/topic/%21%20operator%20and%20C-compatibility/near/251103037" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Triplett <a href="https://zulip-archive.rust-lang.org/stream/219381-t-libs/topic/!.20operator.20and.20C-compatibility.html#251103037">(Aug 29 2021 at 03:55)</a>:</h4>
<p>A gentler approach would be to just introduce a new bitwise negation operation, and then add an allow-by-default lint people could enable.</p>



<a name="251103042"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/219381-t-libs/topic/%21%20operator%20and%20C-compatibility/near/251103042" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Thom Chiovoloni <a href="https://zulip-archive.rust-lang.org/stream/219381-t-libs/topic/!.20operator.20and.20C-compatibility.html#251103042">(Aug 29 2021 at 03:55)</a>:</h4>
<p>i do feel like the departure here was deliberate (although the intention may have just been to be different than c)</p>



<a name="251103093"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/219381-t-libs/topic/%21%20operator%20and%20C-compatibility/near/251103093" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Triplett <a href="https://zulip-archive.rust-lang.org/stream/219381-t-libs/topic/!.20operator.20and.20C-compatibility.html#251103093">(Aug 29 2021 at 03:56)</a>:</h4>
<p>I know it was deliberate. I think it was done specifically to reclaim <code>~</code>, which was then used as one of the pointer sigils.</p>



<a name="251103098"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/219381-t-libs/topic/%21%20operator%20and%20C-compatibility/near/251103098" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Triplett <a href="https://zulip-archive.rust-lang.org/stream/219381-t-libs/topic/!.20operator.20and.20C-compatibility.html#251103098">(Aug 29 2021 at 03:56)</a>:</h4>
<p>We don't have those pointer sigils anymore, though.</p>



<a name="251103369"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/219381-t-libs/topic/%21%20operator%20and%20C-compatibility/near/251103369" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Thom Chiovoloni <a href="https://zulip-archive.rust-lang.org/stream/219381-t-libs/topic/!.20operator.20and.20C-compatibility.html#251103369">(Aug 29 2021 at 04:00)</a>:</h4>
<p>huh, good point, its been so long that i forgot about ~ as a ptr sigil</p>



<a name="251103612"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/219381-t-libs/topic/%21%20operator%20and%20C-compatibility/near/251103612" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Mario Carneiro <a href="https://zulip-archive.rust-lang.org/stream/219381-t-libs/topic/!.20operator.20and.20C-compatibility.html#251103612">(Aug 29 2021 at 04:05)</a>:</h4>
<p>I was thinking about that, but isn't the <code>~</code> pointer sigil used only on types, not expressions?</p>



<a name="251103622"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/219381-t-libs/topic/%21%20operator%20and%20C-compatibility/near/251103622" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Mario Carneiro <a href="https://zulip-archive.rust-lang.org/stream/219381-t-libs/topic/!.20operator.20and.20C-compatibility.html#251103622">(Aug 29 2021 at 04:05)</a>:</h4>
<p>or was it also used as a deref operator</p>



<a name="251104038"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/219381-t-libs/topic/%21%20operator%20and%20C-compatibility/near/251104038" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Thom Chiovoloni <a href="https://zulip-archive.rust-lang.org/stream/219381-t-libs/topic/!.20operator.20and.20C-compatibility.html#251104038">(Aug 29 2021 at 04:14)</a>:</h4>
<p>It was like the <code>box</code> operator too.</p>



<a name="251116022"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/219381-t-libs/topic/%21%20operator%20and%20C-compatibility/near/251116022" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Giacomo Stevanato <a href="https://zulip-archive.rust-lang.org/stream/219381-t-libs/topic/!.20operator.20and.20C-compatibility.html#251116022">(Aug 29 2021 at 08:16)</a>:</h4>
<p>I would try to avoid using <code>~</code> though, it isn't easy to type in many keyboard layouts</p>



<a name="251117028"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/219381-t-libs/topic/%21%20operator%20and%20C-compatibility/near/251117028" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> bjorn3 <a href="https://zulip-archive.rust-lang.org/stream/219381-t-libs/topic/!.20operator.20and.20C-compatibility.html#251117028">(Aug 29 2021 at 08:34)</a>:</h4>
<p>Just introduce digraphs and trigraphs. <span aria-label="lol" class="emoji emoji-1f606" role="img" title="lol">:lol:</span> They existed for this exact reason. <a href="https://en.m.wikipedia.org/wiki/Digraphs_and_trigraphs">https://en.m.wikipedia.org/wiki/Digraphs_and_trigraphs</a></p>



<a name="251117930"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/219381-t-libs/topic/%21%20operator%20and%20C-compatibility/near/251117930" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Lokathor <a href="https://zulip-archive.rust-lang.org/stream/219381-t-libs/topic/!.20operator.20and.20C-compatibility.html#251117930">(Aug 29 2021 at 08:51)</a>:</h4>
<p>I think in a world without C, using <code>!</code> as the "bit invert" operator for any bit width value is consistent and easy to understand. And making rust less good so that we can better fit with the language that we would rather people not be writing new code with in the first place is just a step in the wrong direction.</p>



<a name="251167749"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/219381-t-libs/topic/%21%20operator%20and%20C-compatibility/near/251167749" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Triplett <a href="https://zulip-archive.rust-lang.org/stream/219381-t-libs/topic/!.20operator.20and.20C-compatibility.html#251167749">(Aug 29 2021 at 23:57)</a>:</h4>
<p>It's a trade-off. We want to be different when being different makes us better. I don't think this is better, though. But in any case I don't see us making this change, given compatibility.</p>



<a name="251171308"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/219381-t-libs/topic/%21%20operator%20and%20C-compatibility/near/251171308" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Thom Chiovoloni <a href="https://zulip-archive.rust-lang.org/stream/219381-t-libs/topic/!.20operator.20and.20C-compatibility.html#251171308">(Aug 30 2021 at 00:58)</a>:</h4>
<p>i think it's nicely consistent, but i dont know that that outweighs the bug risk. that said, changing it this late seems unthinkable to me</p>



<a name="251196404"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/219381-t-libs/topic/%21%20operator%20and%20C-compatibility/near/251196404" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Lokathor <a href="https://zulip-archive.rust-lang.org/stream/219381-t-libs/topic/!.20operator.20and.20C-compatibility.html#251196404">(Aug 30 2021 at 08:05)</a>:</h4>
<p>Well, I think precisely how you spell it isn't that important. It could be <code>~</code> or <code>!</code>, but it should be the same for all bags of bits, including bools.</p>
<p>The only reason to keep "truth negation" separate from "bit negation" is if you have non-bool truths you want to be able to negate. We don't do that in Rust, so there's no reason for two operators.</p>



<a name="251196695"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/219381-t-libs/topic/%21%20operator%20and%20C-compatibility/near/251196695" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Lokathor <a href="https://zulip-archive.rust-lang.org/stream/219381-t-libs/topic/!.20operator.20and.20C-compatibility.html#251196695">(Aug 30 2021 at 08:09)</a>:</h4>
<p>Now, if people were allowed to write <em>custom operators</em> then you could have <code>~</code> for bit negation and write C-looking code just fine, and I could have the ever wonderful <code>&lt;$&gt;</code></p>



<a name="251196764"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/219381-t-libs/topic/%21%20operator%20and%20C-compatibility/near/251196764" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Lokathor <a href="https://zulip-archive.rust-lang.org/stream/219381-t-libs/topic/!.20operator.20and.20C-compatibility.html#251196764">(Aug 30 2021 at 08:09)</a>:</h4>
<p>but some people just aren't ready for that conversation, maybe for the 2183 edition.</p>



<a name="251208465"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/219381-t-libs/topic/%21%20operator%20and%20C-compatibility/near/251208465" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Daniel Henry-Mantilla <a href="https://zulip-archive.rust-lang.org/stream/219381-t-libs/topic/!.20operator.20and.20C-compatibility.html#251208465">(Aug 30 2021 at 10:13)</a>:</h4>
<p>The way I see it, the usual solution to "this is a pitfall in this <em>very specific</em> situation", such as porting C code to Rust, is not to disable the feature altogether, since it's elegantly consistent, as <span class="user-mention" data-user-id="224471">@Lokathor</span> put it, but <strong>to offer an allow-by-default lint</strong> which people can use to track this problem. And, in this instance, it does look like a good candidate for a clippy lint, I'd say <span aria-label="smile" class="emoji emoji-1f642" role="img" title="smile">:smile:</span></p>



<a name="251209299"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/219381-t-libs/topic/%21%20operator%20and%20C-compatibility/near/251209299" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Mario Carneiro <a href="https://zulip-archive.rust-lang.org/stream/219381-t-libs/topic/!.20operator.20and.20C-compatibility.html#251209299">(Aug 30 2021 at 10:22)</a>:</h4>
<p>shouldn't it be an allow by default lint on the C code though? Once it's in rust I don't see how you can tell the difference between intentional and unintentional use of <code>!</code></p>



<a name="251211213"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/219381-t-libs/topic/%21%20operator%20and%20C-compatibility/near/251211213" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Daniel Henry-Mantilla <a href="https://zulip-archive.rust-lang.org/stream/219381-t-libs/topic/!.20operator.20and.20C-compatibility.html#251211213">(Aug 30 2021 at 10:45)</a>:</h4>
<p>An intentional use would be to write <code>.not()</code> or something like that, I guess (which is, yet <em>again</em>, another instance for having <code>Not</code> in the prelude). Whatever it may be, what I'm suggesting is a softened version of the OP: rather than disabling something altogether (hard error), to use a lint (and, imho, that lint ought to default to <code>allow</code>).</p>



<a name="251227798"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/219381-t-libs/topic/%21%20operator%20and%20C-compatibility/near/251227798" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nagisa <a href="https://zulip-archive.rust-lang.org/stream/219381-t-libs/topic/!.20operator.20and.20C-compatibility.html#251227798">(Aug 30 2021 at 13:20)</a>:</h4>
<p>An intentional use could also just annotate the correct places with <code>#[allow(...)]</code> of the lint, giving opportunity to also annotate in the code why it is correct.</p>



<hr><p>Last updated: Apr 12 2022 at 20:01 UTC</p>
</html>