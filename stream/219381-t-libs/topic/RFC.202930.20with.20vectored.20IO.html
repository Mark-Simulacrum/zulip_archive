<html>
<head><meta charset="utf-8"><title>RFC 2930 with vectored IO · t-libs · Zulip Chat Archive</title></head>
<h2>Stream: <a href="https://zulip-archive.rust-lang.org/stream/219381-t-libs/index.html">t-libs</a></h2>
<h3>Topic: <a href="https://zulip-archive.rust-lang.org/stream/219381-t-libs/topic/RFC.202930.20with.20vectored.20IO.html">RFC 2930 with vectored IO</a></h3>

<hr>

<base href="https://rust-lang.zulipchat.com">

<head><link href="https://zulip-archive.rust-lang.org/style.css" rel="stylesheet"></head>

<a name="268424170"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/219381-t-libs/topic/RFC%202930%20with%20vectored%20IO/near/268424170" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Nick Cameron <a href="https://zulip-archive.rust-lang.org/stream/219381-t-libs/topic/RFC.202930.20with.20vectored.20IO.html#268424170">(Jan 18 2022 at 17:09)</a>:</h4>
<p>I'm taking a stab at implementing Read::read_buf_vectored. Has anyone thought about the design much?</p>



<a name="268432159"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/219381-t-libs/topic/RFC%202930%20with%20vectored%20IO/near/268432159" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Amanieu <a href="https://zulip-archive.rust-lang.org/stream/219381-t-libs/topic/RFC.202930.20with.20vectored.20IO.html#268432159">(Jan 18 2022 at 18:03)</a>:</h4>
<p>cc <span class="user-mention" data-user-id="243558">@Steven Fackler</span></p>



<a name="268468738"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/219381-t-libs/topic/RFC%202930%20with%20vectored%20IO/near/268468738" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Steven Fackler <a href="https://zulip-archive.rust-lang.org/stream/219381-t-libs/topic/RFC.202930.20with.20vectored.20IO.html#268468738">(Jan 18 2022 at 23:01)</a>:</h4>
<p>I had a partial API or implementation somewhere, let me see if I can track it down</p>



<a name="268468925"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/219381-t-libs/topic/RFC%202930%20with%20vectored%20IO/near/268468925" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Steven Fackler <a href="https://zulip-archive.rust-lang.org/stream/219381-t-libs/topic/RFC.202930.20with.20vectored.20IO.html#268468925">(Jan 18 2022 at 23:03)</a>:</h4>
<p>Here we go: <a href="https://github.com/sfackler/read-buf/blob/master/src/read_bufs.rs">https://github.com/sfackler/read-buf/blob/master/src/read_bufs.rs</a></p>



<a name="268718296"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/219381-t-libs/topic/RFC%202930%20with%20vectored%20IO/near/268718296" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Nick Cameron <a href="https://zulip-archive.rust-lang.org/stream/219381-t-libs/topic/RFC.202930.20with.20vectored.20IO.html#268718296">(Jan 20 2022 at 16:24)</a>:</h4>
<p><span class="user-mention" data-user-id="243558">@Steven Fackler</span> why does it track only which data is initialised (and implicitly the capacity) whereas ReadBuf tracks how much of the buffer is filled too?</p>



<a name="268719174"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/219381-t-libs/topic/RFC%202930%20with%20vectored%20IO/near/268719174" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Steven Fackler <a href="https://zulip-archive.rust-lang.org/stream/219381-t-libs/topic/RFC.202930.20with.20vectored.20IO.html#268719174">(Jan 20 2022 at 16:30)</a>:</h4>
<p>Oh yeah I think that repo is from an older iteration of the RFC before we started tracking the read pointer in ReadBuf</p>



<a name="268719204"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/219381-t-libs/topic/RFC%202930%20with%20vectored%20IO/near/268719204" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Steven Fackler <a href="https://zulip-archive.rust-lang.org/stream/219381-t-libs/topic/RFC.202930.20with.20vectored.20IO.html#268719204">(Jan 20 2022 at 16:30)</a>:</h4>
<p>looks like the ReadBuf in there does the same thing</p>



<a name="268721844"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/219381-t-libs/topic/RFC%202930%20with%20vectored%20IO/near/268721844" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Nick Cameron <a href="https://zulip-archive.rust-lang.org/stream/219381-t-libs/topic/RFC.202930.20with.20vectored.20IO.html#268721844">(Jan 20 2022 at 16:49)</a>:</h4>
<p>Thanks!</p>



<a name="271264736"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/219381-t-libs/topic/RFC%202930%20with%20vectored%20IO/near/271264736" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Nick Cameron <a href="https://zulip-archive.rust-lang.org/stream/219381-t-libs/topic/RFC.202930.20with.20vectored.20IO.html#271264736">(Feb 09 2022 at 11:45)</a>:</h4>
<p>Why do we have read_buf_exact but not read_vectored_exact?</p>



<a name="271264899"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/219381-t-libs/topic/RFC%202930%20with%20vectored%20IO/near/271264899" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Nick Cameron <a href="https://zulip-archive.rust-lang.org/stream/219381-t-libs/topic/RFC.202930.20with.20vectored.20IO.html#271264899">(Feb 09 2022 at 11:47)</a>:</h4>
<p>And neither buf nor vectored versions of read_to_end?</p>



<a name="271264975"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/219381-t-libs/topic/RFC%202930%20with%20vectored%20IO/near/271264975" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> The 8472 <a href="https://zulip-archive.rust-lang.org/stream/219381-t-libs/topic/RFC.202930.20with.20vectored.20IO.html#271264975">(Feb 09 2022 at 11:48)</a>:</h4>
<p>Different abstraction/convenience levels I think.</p>



<a name="271820478"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/219381-t-libs/topic/RFC%202930%20with%20vectored%20IO/near/271820478" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Steven Fackler <a href="https://zulip-archive.rust-lang.org/stream/219381-t-libs/topic/RFC.202930.20with.20vectored.20IO.html#271820478">(Feb 14 2022 at 12:42)</a>:</h4>
<p>vectored read_to_end doesn't really make sense - if you're doing a read_to_end you by definition just have one buffer to write to (the vec).</p>



<a name="271820724"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/219381-t-libs/topic/RFC%202930%20with%20vectored%20IO/near/271820724" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Steven Fackler <a href="https://zulip-archive.rust-lang.org/stream/219381-t-libs/topic/RFC.202930.20with.20vectored.20IO.html#271820724">(Feb 14 2022 at 12:44)</a>:</h4>
<p>On the buf side, read_to_end takes advantage of the buf-based API internally to avoid re-initializing regions of the buffer, but it still interacts with a raw Vec. You could add a new version of that that works with a wrapper type around Vec that persistently tracks the initialization state so repeated read_to_end calls could avoid re-initializing but I don't know how common that is.</p>



<a name="271820800"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/219381-t-libs/topic/RFC%202930%20with%20vectored%20IO/near/271820800" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Steven Fackler <a href="https://zulip-archive.rust-lang.org/stream/219381-t-libs/topic/RFC.202930.20with.20vectored.20IO.html#271820800">(Feb 14 2022 at 12:45)</a>:</h4>
<p>read_vectored_exact could definitely exist though - I think there was a PR adding it, but it ends up being a bit tricky to implement since it may require modifying the input slice in place as you go</p>



<a name="271823094"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/219381-t-libs/topic/RFC%202930%20with%20vectored%20IO/near/271823094" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Nick Cameron <a href="https://zulip-archive.rust-lang.org/stream/219381-t-libs/topic/RFC.202930.20with.20vectored.20IO.html#271823094">(Feb 14 2022 at 13:07)</a>:</h4>
<p>Thanls!</p>



<hr><p>Last updated: Apr 12 2022 at 20:01 UTC</p>
</html>