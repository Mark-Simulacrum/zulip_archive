<html>
<head><meta charset="utf-8"><title>Why can&#x27;t I impl FromResidual&lt;MyType&lt;T&gt;&gt; for Option&lt;T&gt;? · t-libs · Zulip Chat Archive</title></head>
<h2>Stream: <a href="https://zulip-archive.rust-lang.org/stream/219381-t-libs/index.html">t-libs</a></h2>
<h3>Topic: <a href="https://zulip-archive.rust-lang.org/stream/219381-t-libs/topic/Why.20can&#x27;t.20I.20impl.20FromResidual.3CMyType.3CT.3E.3E.20for.20Option.3CT.3E.3F.html">Why can&#x27;t I impl FromResidual&lt;MyType&lt;T&gt;&gt; for Option&lt;T&gt;?</a></h3>

<hr>

<base href="https://rust-lang.zulipchat.com">

<head><link href="https://zulip-archive.rust-lang.org/style.css" rel="stylesheet"></head>

<a name="277614821"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/219381-t-libs/topic/Why%20can%27t%20I%20impl%20FromResidual%3CMyType%3CT%3E%3E%20for%20Option%3CT%3E%3F/near/277614821" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Waffle Lapkin <a href="https://zulip-archive.rust-lang.org/stream/219381-t-libs/topic/Why.20can&#x27;t.20I.20impl.20FromResidual.3CMyType.3CT.3E.3E.20for.20Option.3CT.3E.3F.html#277614821">(Apr 03 2022 at 11:21)</a>:</h4>
<p>I was playing with the try_trait_v2 feature and found a weird error:</p>
<div class="codehilite" data-code-language="Text only"><pre><span></span><code>error[E0119]: conflicting implementations of trait `std::ops::FromResidual&lt;BreakSome&lt;_&gt;&gt;` for type `std::option::Option&lt;_&gt;`
  --&gt; src/lib.rs:46:1
   |
46 | impl&lt;T&gt; FromResidual&lt;BreakSome&lt;T&gt;&gt; for Option&lt;T&gt; {
   | ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
   |
   = note: conflicting implementation in crate `core`:
           - impl&lt;T&gt; FromResidual for Option&lt;T&gt;;
</code></pre></div>
<p><a href="https://play.rust-lang.org/?version=nightly&amp;mode=debug&amp;edition=2021&amp;gist=5dba69eddab9d88196bcdf9989debcd7">(play)</a><br>
How do these impls conflict? <code>&lt;Option&lt;T&gt; as Try&gt;::Residual = Option&lt;!&gt;</code>, so the conflicting impls are</p>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="k">impl</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;</span><span class="w"> </span><span class="n">FromResidual</span><span class="o">&lt;</span><span class="n">BreakSome</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;&gt;</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="nb">Option</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;</span><span class="p">;</span><span class="w"></span>
<span class="k">impl</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;</span><span class="w"> </span><span class="n">FromResidual</span><span class="o">&lt;</span><span class="nb">Option</span><span class="o">&lt;!&gt;&gt;</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="nb">Option</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;</span><span class="p">;</span><span class="w"></span>
</code></pre></div>
<p><code>BreakSome&lt;T&gt;</code> and <code>Option&lt;!&gt;</code> do not overlap, so I'm confused.</p>



<a name="277615014"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/219381-t-libs/topic/Why%20can%27t%20I%20impl%20FromResidual%3CMyType%3CT%3E%3E%20for%20Option%3CT%3E%3F/near/277615014" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Waffle Lapkin <a href="https://zulip-archive.rust-lang.org/stream/219381-t-libs/topic/Why.20can&#x27;t.20I.20impl.20FromResidual.3CMyType.3CT.3E.3E.20for.20Option.3CT.3E.3F.html#277615014">(Apr 03 2022 at 11:23)</a>:</h4>
<p>(btw the naming (output/residual) is extremely confusing, I had to check how they map to <code>ControlFlow</code> from <code>branch</code> to figure out what they do...)</p>



<a name="277654725"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/219381-t-libs/topic/Why%20can%27t%20I%20impl%20FromResidual%3CMyType%3CT%3E%3E%20for%20Option%3CT%3E%3F/near/277654725" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> scottmcm <a href="https://zulip-archive.rust-lang.org/stream/219381-t-libs/topic/Why.20can&#x27;t.20I.20impl.20FromResidual.3CMyType.3CT.3E.3E.20for.20Option.3CT.3E.3F.html#277654725">(Apr 03 2022 at 18:49)</a>:</h4>
<p><span class="user-mention silent" data-user-id="273349">Waffle Lapkin</span> <a href="#narrow/stream/219381-t-libs/topic/Why.20can't.20I.20impl.20FromResidual.3CMyType.3CT.3E.3E.20for.20Option.3CT.3E.3F/near/277615014">said</a>:</p>
<blockquote>
<p>(btw the naming (output/residual) is extremely confusing, I had to check how they map to <code>ControlFlow</code> from <code>branch</code> to figure out what they do...)</p>
</blockquote>
<p>I think we're on track to change it to the Break/Continue naming from the Residual/Output naming, actually: <a href="https://github.com/rust-lang/rust/issues/84277#issuecomment-1066120333">https://github.com/rust-lang/rust/issues/84277#issuecomment-1066120333</a></p>



<a name="277655071"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/219381-t-libs/topic/Why%20can%27t%20I%20impl%20FromResidual%3CMyType%3CT%3E%3E%20for%20Option%3CT%3E%3F/near/277655071" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> scottmcm <a href="https://zulip-archive.rust-lang.org/stream/219381-t-libs/topic/Why.20can&#x27;t.20I.20impl.20FromResidual.3CMyType.3CT.3E.3E.20for.20Option.3CT.3E.3F.html#277655071">(Apr 03 2022 at 18:56)</a>:</h4>
<p>But I'm surprised by that error too.  If it was an <em>orphan</em> rule complaint I could understand it, but not <em>overlap</em>.</p>



<a name="277658140"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/219381-t-libs/topic/Why%20can%27t%20I%20impl%20FromResidual%3CMyType%3CT%3E%3E%20for%20Option%3CT%3E%3F/near/277658140" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jane Lusby [she/her] <a href="https://zulip-archive.rust-lang.org/stream/219381-t-libs/topic/Why.20can&#x27;t.20I.20impl.20FromResidual.3CMyType.3CT.3E.3E.20for.20Option.3CT.3E.3F.html#277658140">(Apr 03 2022 at 20:00)</a>:</h4>
<p>I think I ran into the same issue when I was fiddling with the inverted ? Stuff in the error handling project group a couple weeks back</p>



<a name="277658175"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/219381-t-libs/topic/Why%20can%27t%20I%20impl%20FromResidual%3CMyType%3CT%3E%3E%20for%20Option%3CT%3E%3F/near/277658175" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jane Lusby [she/her] <a href="https://zulip-archive.rust-lang.org/stream/219381-t-libs/topic/Why.20can&#x27;t.20I.20impl.20FromResidual.3CMyType.3CT.3E.3E.20for.20Option.3CT.3E.3F.html#277658175">(Apr 03 2022 at 20:01)</a>:</h4>
<p><a href="#narrow/stream/257204-project-error-handling/topic/Question.20mark.20operator.20inversion">https://rust-lang.zulipchat.com/#narrow/stream/257204-project-error-handling/topic/Question.20mark.20operator.20inversion</a></p>



<a name="277658185"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/219381-t-libs/topic/Why%20can%27t%20I%20impl%20FromResidual%3CMyType%3CT%3E%3E%20for%20Option%3CT%3E%3F/near/277658185" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jane Lusby [she/her] <a href="https://zulip-archive.rust-lang.org/stream/219381-t-libs/topic/Why.20can&#x27;t.20I.20impl.20FromResidual.3CMyType.3CT.3E.3E.20for.20Option.3CT.3E.3F.html#277658185">(Apr 03 2022 at 20:01)</a>:</h4>
<p>Specifically here</p>



<a name="277658186"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/219381-t-libs/topic/Why%20can%27t%20I%20impl%20FromResidual%3CMyType%3CT%3E%3E%20for%20Option%3CT%3E%3F/near/277658186" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jane Lusby [she/her] <a href="https://zulip-archive.rust-lang.org/stream/219381-t-libs/topic/Why.20can&#x27;t.20I.20impl.20FromResidual.3CMyType.3CT.3E.3E.20for.20Option.3CT.3E.3F.html#277658186">(Apr 03 2022 at 20:01)</a>:</h4>
<p><a href="https://play.rust-lang.org/?version=nightly&amp;mode=debug&amp;edition=2021&amp;gist=859242c4bf70a8c960808c8a9bfcc01c">https://play.rust-lang.org/?version=nightly&amp;mode=debug&amp;edition=2021&amp;gist=859242c4bf70a8c960808c8a9bfcc01c</a></p>



<a name="277658244"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/219381-t-libs/topic/Why%20can%27t%20I%20impl%20FromResidual%3CMyType%3CT%3E%3E%20for%20Option%3CT%3E%3F/near/277658244" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jane Lusby [she/her] <a href="https://zulip-archive.rust-lang.org/stream/219381-t-libs/topic/Why.20can&#x27;t.20I.20impl.20FromResidual.3CMyType.3CT.3E.3E.20for.20Option.3CT.3E.3F.html#277658244">(Apr 03 2022 at 20:02)</a>:</h4>
<p>And I never dug into how the alternative version that was done a while back succeeded in working while mine didnt</p>



<a name="277667308"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/219381-t-libs/topic/Why%20can%27t%20I%20impl%20FromResidual%3CMyType%3CT%3E%3E%20for%20Option%3CT%3E%3F/near/277667308" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Waffle Lapkin <a href="https://zulip-archive.rust-lang.org/stream/219381-t-libs/topic/Why.20can&#x27;t.20I.20impl.20FromResidual.3CMyType.3CT.3E.3E.20for.20Option.3CT.3E.3F.html#277667308">(Apr 03 2022 at 23:28)</a>:</h4>
<p>Moreover, I can't reproduce the same error with 2 common crates, the following works fine:</p>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="c1">// crate "libcore"</span>
<span class="k">pub</span><span class="w"> </span><span class="k">use</span><span class="w"> </span><span class="n">Option2</span>::<span class="o">*</span><span class="p">;</span><span class="w"></span>

<span class="k">pub</span><span class="w"> </span><span class="k">enum</span> <span class="nc">Option2</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="n">Some2</span><span class="p">(</span><span class="n">T</span><span class="p">),</span><span class="w"></span>
<span class="w">    </span><span class="n">None2</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>

<span class="k">pub</span><span class="w"> </span><span class="k">enum</span> <span class="nc">Never</span><span class="w"> </span><span class="p">{}</span><span class="w"></span>

<span class="k">pub</span><span class="w"> </span><span class="k">trait</span><span class="w"> </span><span class="n">Try</span>: <span class="nc">FromResidual</span><span class="o">&lt;</span><span class="bp">Self</span>::<span class="n">Residual</span><span class="o">&gt;</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="k">type</span> <span class="nc">Residual</span><span class="p">;</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>

<span class="k">pub</span><span class="w"> </span><span class="k">trait</span><span class="w"> </span><span class="n">FromResidual</span><span class="o">&lt;</span><span class="n">R</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">&lt;</span><span class="bp">Self</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="n">Try</span><span class="o">&gt;</span>::<span class="n">Residual</span><span class="o">&gt;</span><span class="w"> </span><span class="p">{}</span><span class="w"></span>

<span class="k">impl</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;</span><span class="w"> </span><span class="n">Try</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="nb">Option</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="k">type</span> <span class="nc">Residual</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">Option</span><span class="o">&lt;</span><span class="n">Never</span><span class="o">&gt;</span><span class="p">;</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>

<span class="k">impl</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;</span><span class="w"> </span><span class="n">FromResidual</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="nb">Option</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;</span><span class="w"> </span><span class="p">{}</span><span class="w"></span>
</code></pre></div>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="c1">// crate "libuncore"</span>
<span class="k">use</span><span class="w"> </span><span class="n">libcore</span>::<span class="o">*</span><span class="p">;</span><span class="w"></span>

<span class="k">pub</span><span class="w"> </span><span class="k">struct</span> <span class="nc">MyResidual</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;</span><span class="p">(</span><span class="n">T</span><span class="p">);</span><span class="w"></span>

<span class="k">impl</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;</span><span class="w"> </span><span class="n">FromResidual</span><span class="o">&lt;</span><span class="n">MyResidual</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;&gt;</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="n">Option2</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;</span><span class="w"> </span><span class="p">{}</span><span class="w"></span>
</code></pre></div>



<a name="277667329"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/219381-t-libs/topic/Why%20can%27t%20I%20impl%20FromResidual%3CMyType%3CT%3E%3E%20for%20Option%3CT%3E%3F/near/277667329" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Waffle Lapkin <a href="https://zulip-archive.rust-lang.org/stream/219381-t-libs/topic/Why.20can&#x27;t.20I.20impl.20FromResidual.3CMyType.3CT.3E.3E.20for.20Option.3CT.3E.3F.html#277667329">(Apr 03 2022 at 23:29)</a>:</h4>
<p>But this doesn't work</p>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="cp">#![feature(try_trait_v2)]</span><span class="w"></span>

<span class="k">pub</span><span class="w"> </span><span class="k">struct</span> <span class="nc">MyResidual</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;</span><span class="p">(</span><span class="n">T</span><span class="p">);</span><span class="w"></span>

<span class="k">impl</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;</span><span class="w"> </span><span class="n">std</span>::<span class="n">ops</span>::<span class="n">FromResidual</span><span class="o">&lt;</span><span class="n">MyResidual</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;&gt;</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="nb">Option</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;</span><span class="w"> </span><span class="p">{}</span><span class="w"></span>
</code></pre></div>
<div class="codehilite" data-code-language="Text only"><pre><span></span><code>error[E0119]: conflicting implementations of trait `std::ops::FromResidual&lt;MyResidual&lt;_&gt;&gt;` for type `std::option::Option&lt;_&gt;`
 --&gt; src/lib.rs:5:1
  |
5 | impl&lt;T&gt; std::ops::FromResidual&lt;MyResidual&lt;T&gt;&gt; for Option&lt;T&gt; {
  | ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  |
  = note: conflicting implementation in crate `core`:
          - impl&lt;T&gt; FromResidual for Option&lt;T&gt;;
</code></pre></div>
<p>I'm even more confused now...</p>



<hr><p>Last updated: Apr 12 2022 at 20:01 UTC</p>
</html>