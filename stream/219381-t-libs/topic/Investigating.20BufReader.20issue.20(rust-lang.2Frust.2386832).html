<html>
<head><meta charset="utf-8"><title>Investigating BufReader issue (rust-lang/rust#86832) · t-libs · Zulip Chat Archive</title></head>
<h2>Stream: <a href="https://zulip-archive.rust-lang.org/stream/219381-t-libs/index.html">t-libs</a></h2>
<h3>Topic: <a href="https://zulip-archive.rust-lang.org/stream/219381-t-libs/topic/Investigating.20BufReader.20issue.20(rust-lang.2Frust.2386832).html">Investigating BufReader issue (rust-lang/rust#86832)</a></h3>

<hr>

<base href="https://rust-lang.zulipchat.com">

<head><link href="https://zulip-archive.rust-lang.org/style.css" rel="stylesheet"></head>

<a name="252646329"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/219381-t-libs/topic/Investigating%20BufReader%20issue%20%28rust-lang/rust%2386832%29/near/252646329" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ryan Lee <a href="https://zulip-archive.rust-lang.org/stream/219381-t-libs/topic/Investigating.20BufReader.20issue.20(rust-lang.2Frust.2386832).html#252646329">(Sep 09 2021 at 15:34)</a>:</h4>
<p>A while ago I filed the linked issue about <code>BufReader</code> seeming to wipe its internal buffer when <code>stream_position</code> was called, but the documentation and source code for <code>BufReader.stream_position</code> both do not seem to clear the buffer. However, the tracing results that I posted at <a href="https://github.com/rust-lang/rust/issues/86832#issuecomment-913786239">https://github.com/rust-lang/rust/issues/86832#issuecomment-913786239</a> show that the invocation of <code>stream_position</code>leads to <code>BufReader</code> not reducing the number of reads that it performs on the inner I/O object. Does anyone have pointers on how <code>BufReader</code> works and where I can look to continue investigating this issue?</p>



<a name="252648571"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/219381-t-libs/topic/Investigating%20BufReader%20issue%20%28rust-lang/rust%2386832%29/near/252648571" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Amanieu <a href="https://zulip-archive.rust-lang.org/stream/219381-t-libs/topic/Investigating.20BufReader.20issue.20(rust-lang.2Frust.2386832).html#252648571">(Sep 09 2021 at 15:50)</a>:</h4>
<p><code>IOStatWrapper</code> doesn't implement <code>stream_position</code> in <code>Seek</code> so it is always using the default implementation which calls <code>seek</code> and ends up discarding the buffer.</p>



<hr><p>Last updated: Apr 12 2022 at 20:01 UTC</p>
</html>