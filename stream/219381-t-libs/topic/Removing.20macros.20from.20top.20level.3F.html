<html>
<head><meta charset="utf-8"><title>Removing macros from top level? · t-libs · Zulip Chat Archive</title></head>
<h2>Stream: <a href="https://zulip-archive.rust-lang.org/stream/219381-t-libs/index.html">t-libs</a></h2>
<h3>Topic: <a href="https://zulip-archive.rust-lang.org/stream/219381-t-libs/topic/Removing.20macros.20from.20top.20level.3F.html">Removing macros from top level?</a></h3>

<hr>

<base href="https://rust-lang.zulipchat.com">

<head><link href="https://zulip-archive.rust-lang.org/style.css" rel="stylesheet"></head>

<a name="203827733"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/219381-t-libs/topic/Removing%20macros%20from%20top%20level%3F/near/203827733" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> boats <a href="https://zulip-archive.rust-lang.org/stream/219381-t-libs/topic/Removing.20macros.20from.20top.20level.3F.html#203827733">(Jul 14 2020 at 12:39)</a>:</h4>
<p>An exciting development in the last month or so that we haven't really discussed is that we are now merging macros at paths (first <code>core::ptr::raw!/raw_mut!</code>, now also <code>core::task::ready!</code>). Several of the macros which are auto-imported from std are actually rarely used and would not have been added to the prelude except that macros originally had to be exported that way. Should we consider exposing some of these macros at paths and removing them from the prelude in the next edition?</p>



<a name="203827923"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/219381-t-libs/topic/Removing%20macros%20from%20top%20level%3F/near/203827923" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> boats <a href="https://zulip-archive.rust-lang.org/stream/219381-t-libs/topic/Removing.20macros.20from.20top.20level.3F.html#203827923">(Jul 14 2020 at 12:41)</a>:</h4>
<p>I'm thinking of things like <code>is_x86_feature_detected</code>, the include macros, maybe line/column/module_path, maybe thread_local. The macros that are mainly used for debugging purposes, the panics, formatting macros, vec, all should stay in the prelude IMO.</p>



<a name="203837136"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/219381-t-libs/topic/Removing%20macros%20from%20top%20level%3F/near/203837136" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Amanieu <a href="https://zulip-archive.rust-lang.org/stream/219381-t-libs/topic/Removing.20macros.20from.20top.20level.3F.html#203837136">(Jul 14 2020 at 14:06)</a>:</h4>
<p>There was some discussion about moving asm! to core::arch::$ARCH::asm! in the RFC.</p>



<a name="203852086"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/219381-t-libs/topic/Removing%20macros%20from%20top%20level%3F/near/203852086" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Lokathor <a href="https://zulip-archive.rust-lang.org/stream/219381-t-libs/topic/Removing.20macros.20from.20top.20level.3F.html#203852086">(Jul 14 2020 at 16:05)</a>:</h4>
<p>line/column/module_path are "used for debugging purposes"</p>



<a name="203853212"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/219381-t-libs/topic/Removing%20macros%20from%20top%20level%3F/near/203853212" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Steven Fackler <a href="https://zulip-archive.rust-lang.org/stream/219381-t-libs/topic/Removing.20macros.20from.20top.20level.3F.html#203853212">(Jul 14 2020 at 16:15)</a>:</h4>
<p>I would love to be able to move macros out of the std crate root. Even without an edition, I think could make sense to move the macros to better locations and then reexport them in the root for back compat.</p>



<a name="203854644"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/219381-t-libs/topic/Removing%20macros%20from%20top%20level%3F/near/203854644" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Triplett <a href="https://zulip-archive.rust-lang.org/stream/219381-t-libs/topic/Removing.20macros.20from.20top.20level.3F.html#203854644">(Jul 14 2020 at 16:27)</a>:</h4>
<p>I'm not sure if it's possible to remove macros in an edition boundary, or in general to change the standard library in an edition boundary.</p>



<a name="203855132"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/219381-t-libs/topic/Removing%20macros%20from%20top%20level%3F/near/203855132" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Steven Fackler <a href="https://zulip-archive.rust-lang.org/stream/219381-t-libs/topic/Removing.20macros.20from.20top.20level.3F.html#203855132">(Jul 14 2020 at 16:31)</a>:</h4>
<p>I don't think that functionality exists now, but it definitely seems plausible to teach the compiler to ignore certain reexports when certain editions are selected</p>



<a name="203855249"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/219381-t-libs/topic/Removing%20macros%20from%20top%20level%3F/near/203855249" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Lokathor <a href="https://zulip-archive.rust-lang.org/stream/219381-t-libs/topic/Removing.20macros.20from.20top.20level.3F.html#203855249">(Jul 14 2020 at 16:32)</a>:</h4>
<p>Yeah it seems <em>technically</em> possible, though politically possible maybe not.</p>



<a name="203856158"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/219381-t-libs/topic/Removing%20macros%20from%20top%20level%3F/near/203856158" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> cuviper <a href="https://zulip-archive.rust-lang.org/stream/219381-t-libs/topic/Removing.20macros.20from.20top.20level.3F.html#203856158">(Jul 14 2020 at 16:40)</a>:</h4>
<p>It has been suggested that a new edition could use a different implicit prelude path though</p>



<a name="203870423"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/219381-t-libs/topic/Removing%20macros%20from%20top%20level%3F/near/203870423" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Peter Rabbit <a href="https://zulip-archive.rust-lang.org/stream/219381-t-libs/topic/Removing.20macros.20from.20top.20level.3F.html#203870423">(Jul 14 2020 at 18:36)</a>:</h4>
<p>I'm on board with moving macros to non-root locations and phasing out some of those re-exports in a future edition.</p>



<a name="203871537"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/219381-t-libs/topic/Removing%20macros%20from%20top%20level%3F/near/203871537" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Lokathor <a href="https://zulip-archive.rust-lang.org/stream/219381-t-libs/topic/Removing.20macros.20from.20top.20level.3F.html#203871537">(Jul 14 2020 at 18:46)</a>:</h4>
<p><span class="user-mention" data-user-id="256759">@boats</span> will "macros have their own path" be stabilized during a particular release or is it just generally in the pipeline?</p>



<a name="203882213"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/219381-t-libs/topic/Removing%20macros%20from%20top%20level%3F/near/203882213" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> boats <a href="https://zulip-archive.rust-lang.org/stream/219381-t-libs/topic/Removing.20macros.20from.20top.20level.3F.html#203882213">(Jul 14 2020 at 20:18)</a>:</h4>
<p>@Lokathor we just have 2 macros going into nightly that are at paths. The feature has existed since around 2018 but we haven't used it in std before. I'm not sure if it presents any problems for 2015 edition crates</p>



<a name="203882280"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/219381-t-libs/topic/Removing%20macros%20from%20top%20level%3F/near/203882280" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> boats <a href="https://zulip-archive.rust-lang.org/stream/219381-t-libs/topic/Removing.20macros.20from.20top.20level.3F.html#203882280">(Jul 14 2020 at 20:19)</a>:</h4>
<p>We've never implemented support, but editions can remove paths without any issue. They just can't redefine paths (once a path is used in one edition, it can never be used to mean  something with a different definition in a future edition.)</p>



<a name="203882529"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/219381-t-libs/topic/Removing%20macros%20from%20top%20level%3F/near/203882529" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> boats <a href="https://zulip-archive.rust-lang.org/stream/219381-t-libs/topic/Removing.20macros.20from.20top.20level.3F.html#203882529">(Jul 14 2020 at 20:21)</a>:</h4>
<p>Editions can't remove impls, or can't without a lot of extra machinery to make sure cross-edition crates stay coherent</p>



<a name="203891798"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/219381-t-libs/topic/Removing%20macros%20from%20top%20level%3F/near/203891798" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Lokathor <a href="https://zulip-archive.rust-lang.org/stream/219381-t-libs/topic/Removing.20macros.20from.20top.20level.3F.html#203891798">(Jul 14 2020 at 21:38)</a>:</h4>
<p>Oh my. Can user crates make macros at paths? I've still been using <code>#[macro_export]</code> and having my macros be at the top level of the crate.</p>



<a name="203906782"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/219381-t-libs/topic/Removing%20macros%20from%20top%20level%3F/near/203906782" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Triplett <a href="https://zulip-archive.rust-lang.org/stream/219381-t-libs/topic/Removing.20macros.20from.20top.20level.3F.html#203906782">(Jul 15 2020 at 01:00)</a>:</h4>
<p><span class="user-mention silent" data-user-id="224471">Lokathor</span> <a href="#narrow/stream/219381-t-libs/topic/Removing.20macros.20from.20top.20level.3F/near/203891798">said</a>:</p>
<blockquote>
<p>Oh my. Can user crates make macros at paths? I've still been using <code>#[macro_export]</code> and having my macros be at the top level of the crate.</p>
</blockquote>
<p>Yes, they can, as of roughly around the 2018 edition.</p>



<a name="203906796"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/219381-t-libs/topic/Removing%20macros%20from%20top%20level%3F/near/203906796" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Triplett <a href="https://zulip-archive.rust-lang.org/stream/219381-t-libs/topic/Removing.20macros.20from.20top.20level.3F.html#203906796">(Jul 15 2020 at 01:00)</a>:</h4>
<p><span class="user-mention" data-user-id="138448">@cuviper</span> That does seem like the cleanest way to do it.</p>



<a name="203906839"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/219381-t-libs/topic/Removing%20macros%20from%20top%20level%3F/near/203906839" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Triplett <a href="https://zulip-archive.rust-lang.org/stream/219381-t-libs/topic/Removing.20macros.20from.20top.20level.3F.html#203906839">(Jul 15 2020 at 01:01)</a>:</h4>
<p>Personally, I would be very hesitant to cause the churn that removing a common macro would cause. We could certainly implement the technical means to do so. But would it be worth pushing people to change their code like that, or should we just soft-deprecate the old names and tell people to use the new ones?</p>



<a name="203906930"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/219381-t-libs/topic/Removing%20macros%20from%20top%20level%3F/near/203906930" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Lokathor <a href="https://zulip-archive.rust-lang.org/stream/219381-t-libs/topic/Removing.20macros.20from.20top.20level.3F.html#203906930">(Jul 15 2020 at 01:03)</a>:</h4>
<p>(how do you do that? because when i type <code>pub macro_rules!</code> the compiler says i can't put visibility on macros)</p>



<a name="203913953"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/219381-t-libs/topic/Removing%20macros%20from%20top%20level%3F/near/203913953" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Triplett <a href="https://zulip-archive.rust-lang.org/stream/219381-t-libs/topic/Removing.20macros.20from.20top.20level.3F.html#203913953">(Jul 15 2020 at 03:44)</a>:</h4>
<p><span class="user-mention" data-user-id="224471">@Lokathor</span> You still have to write <code>#[macro_export]</code>, but you can now import using <code>use</code> with a path.</p>



<a name="203913956"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/219381-t-libs/topic/Removing%20macros%20from%20top%20level%3F/near/203913956" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Triplett <a href="https://zulip-archive.rust-lang.org/stream/219381-t-libs/topic/Removing.20macros.20from.20top.20level.3F.html#203913956">(Jul 15 2020 at 03:44)</a>:</h4>
<p><a href="https://doc.rust-lang.org/nightly/edition-guide/rust-2018/macros/macro-changes.html">https://doc.rust-lang.org/nightly/edition-guide/rust-2018/macros/macro-changes.html</a></p>



<a name="203915144"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/219381-t-libs/topic/Removing%20macros%20from%20top%20level%3F/near/203915144" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Lokathor <a href="https://zulip-archive.rust-lang.org/stream/219381-t-libs/topic/Removing.20macros.20from.20top.20level.3F.html#203915144">(Jul 15 2020 at 04:12)</a>:</h4>
<p>Ah, okay. I follow now. I've actually had to import alloc::vec::vec before so i should have realized.</p>



<a name="203921400"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/219381-t-libs/topic/Removing%20macros%20from%20top%20level%3F/near/203921400" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> RalfJ <a href="https://zulip-archive.rust-lang.org/stream/219381-t-libs/topic/Removing.20macros.20from.20top.20level.3F.html#203921400">(Jul 15 2020 at 06:48)</a>:</h4>
<p>rustdoc is still having some issues with <code>pub macro</code> though it seems: <a href="https://github.com/rust-lang/rust/issues/74355">https://github.com/rust-lang/rust/issues/74355</a></p>



<a name="272677263"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/219381-t-libs/topic/Removing%20macros%20from%20top%20level%3F/near/272677263" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Yoshua Wuyts [he/they] <a href="https://zulip-archive.rust-lang.org/stream/219381-t-libs/topic/Removing.20macros.20from.20top.20level.3F.html#272677263">(Feb 21 2022 at 11:45)</a>:</h4>
<p>As far as I can tell in-line macros are now generally available. How would folks feel about if we added re-exports from submodules for the macros currently in root?</p>
<p>I'm hesitant to combine deprecation / removal + re-exporting from submodules in a single pass, since that seems like a very large topic. So instead I'm wondering if we could perhaps try re-exporting first. That would enable for example <code>std::panic</code> to also include <code>{panic!, unreachable!, unimplemented!, todo!}</code>, which is great for discoverability and documentation.</p>



<a name="272677687"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/219381-t-libs/topic/Removing%20macros%20from%20top%20level%3F/near/272677687" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Yoshua Wuyts [he/they] <a href="https://zulip-archive.rust-lang.org/stream/219381-t-libs/topic/Removing.20macros.20from.20top.20level.3F.html#272677687">(Feb 21 2022 at 11:49)</a>:</h4>
<p>(Additional motivation from me personally is that this seems like a relatively small and uncontroversial change, but big enough that it warrants an RFC. I've never written an RFC before, and this seems like just the right size of topic to try writing one for.)</p>



<a name="272682072"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/219381-t-libs/topic/Removing%20macros%20from%20top%20level%3F/near/272682072" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Nick Cameron <a href="https://zulip-archive.rust-lang.org/stream/219381-t-libs/topic/Removing.20macros.20from.20top.20level.3F.html#272682072">(Feb 21 2022 at 12:32)</a>:</h4>
<blockquote>
<p>I'm hesitant to combine deprecation / removal + re-exporting from submodules in a single pass, since that seems like a very large topic. So instead I'm wondering if we could perhaps try re-exporting first.</p>
</blockquote>
<p>Are you proposing re-exporting from the modules? I.e., leaving the definitions in their macros module and re-exporting from e.g. panic? Would there be any observable difference to the user to move the macros to e.g. panic and re-export from the top-level? What do you think is the long-term plan? (I'm a bit confused by the talk of deprecation, I'd think we could be backwards compatible by re-exporting, but I do seem to remember some tricky edge cases around old vs new macro naming)</p>



<a name="272694413"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/219381-t-libs/topic/Removing%20macros%20from%20top%20level%3F/near/272694413" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Yoshua Wuyts [he/they] <a href="https://zulip-archive.rust-lang.org/stream/219381-t-libs/topic/Removing.20macros.20from.20top.20level.3F.html#272694413">(Feb 21 2022 at 14:22)</a>:</h4>
<p><span class="user-mention silent" data-user-id="256841">Nick Cameron</span> <a href="#narrow/stream/219381-t-libs/topic/Removing.20macros.20from.20top.20level.3F/near/272682072">said</a>:</p>
<blockquote>
<p>Are you proposing re-exporting from the modules? I.e., leaving the definitions in their macros module and re-exporting from e.g. panic? Would there be any observable difference to the user to move the macros to e.g. panic and re-export from the top-level?</p>
</blockquote>
<p>Good question! I haven't looked at it closely enough that I have a preference which way we flip it. Do you have a preference? I figured I'd check in with the WG first to see what folks thought about the general idea before hashing out further details.</p>



<a name="272694684"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/219381-t-libs/topic/Removing%20macros%20from%20top%20level%3F/near/272694684" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Yoshua Wuyts [he/they] <a href="https://zulip-archive.rust-lang.org/stream/219381-t-libs/topic/Removing.20macros.20from.20top.20level.3F.html#272694684">(Feb 21 2022 at 14:24)</a>:</h4>
<p><span class="user-mention silent" data-user-id="256841">Nick Cameron</span> <a href="#narrow/stream/219381-t-libs/topic/Removing.20macros.20from.20top.20level.3F/near/272682072">said</a>:</p>
<blockquote>
<p>What do you think is the long-term plan? (I'm a bit confused by the talk of deprecation, I'd think we could be backwards compatible by re-exporting, but I do seem to remember some tricky edge cases around old vs new macro naming)</p>
</blockquote>
<p>I mean, ultimately it does seem the most neat if we didn't have a big catch-all pile of macros live in std's root. Reading this thread it seems most everyone agrees with that. But there are some details which need to be worked out on how to move away from that, so that's why I'm intentionally trying to break this up into two steps. Which hopefully will be more manageable than attempting to do it all in one go.</p>



<a name="272698157"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/219381-t-libs/topic/Removing%20macros%20from%20top%20level%3F/near/272698157" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> bstrie <a href="https://zulip-archive.rust-lang.org/stream/219381-t-libs/topic/Removing.20macros.20from.20top.20level.3F.html#272698157">(Feb 21 2022 at 14:54)</a>:</h4>
<p>I've thought about this before, and I think you'll want to start with only the macros that have extremely obvious places where they should live, e.g. <code>std::io::println!</code>. Many other macros are probably going to require making new modules, which is going to take forever to bikeshed and shouldn't block the obvious ones.</p>



<a name="272698551"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/219381-t-libs/topic/Removing%20macros%20from%20top%20level%3F/near/272698551" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> bstrie <a href="https://zulip-archive.rust-lang.org/stream/219381-t-libs/topic/Removing.20macros.20from.20top.20level.3F.html#272698551">(Feb 21 2022 at 14:57)</a>:</h4>
<p>for example, I could imagine a <code>std::meta</code> module for "things to do with Rust source code itself", which could contain <code>column!</code>, <code>stringify!</code>, <code>cfg!</code>, etc (and if we ever move the <code>proc_macro</code> crate into std (perhaps behind an off-by-default Cargo feature in the glorious build-std future??) then <code>TokenStream</code> could live in here too, and so on)</p>



<a name="272698798"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/219381-t-libs/topic/Removing%20macros%20from%20top%20level%3F/near/272698798" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> bstrie <a href="https://zulip-archive.rust-lang.org/stream/219381-t-libs/topic/Removing.20macros.20from.20top.20level.3F.html#272698798">(Feb 21 2022 at 14:59)</a>:</h4>
<p>likewise there were plans years ago for a <code>std::test</code> for things to do with the test runner, which is the natural place for <code>assert!</code> et al, and maybe even <code>dbg!</code></p>



<a name="272701353"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/219381-t-libs/topic/Removing%20macros%20from%20top%20level%3F/near/272701353" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jake Goulding <a href="https://zulip-archive.rust-lang.org/stream/219381-t-libs/topic/Removing.20macros.20from.20top.20level.3F.html#272701353">(Feb 21 2022 at 15:19)</a>:</h4>
<p><span class="user-mention silent" data-user-id="256342">bstrie</span> <a href="#narrow/stream/219381-t-libs/topic/Removing.20macros.20from.20top.20level.3F/near/272698798">said</a>:</p>
<blockquote>
<p><code>std::test</code> [...] is the natural place for <code>assert!</code></p>
</blockquote>
<p>Agree with the bikeshedding concern: I would disagree with that location <span aria-label="wink" class="emoji emoji-1f609" role="img" title="wink">:wink:</span></p>



<a name="272701600"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/219381-t-libs/topic/Removing%20macros%20from%20top%20level%3F/near/272701600" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Mara <a href="https://zulip-archive.rust-lang.org/stream/219381-t-libs/topic/Removing.20macros.20from.20top.20level.3F.html#272701600">(Feb 21 2022 at 15:20)</a>:</h4>
<p><span class="user-mention" data-user-id="211722">@Yoshua Wuyts [he/they]</span> moving macros to relevant modules and adding re-exports in the root sounds great. (better than the other way around.) it's a relatively small change, but an RFC could be useful.</p>
<blockquote>
<p>I've never written an RFC before, and this seems like just the right size of topic to try writing one for.</p>
</blockquote>
<p>yeah. it's a relatively small change, but it'd be nice to have the motivation and an overview of the changes in one place. if the standard RFC template doesn't work, feel free to structure it differently. the document just needs to have all the information/answers/motivation so an informed decision can be made, in whatever way is most useful. (I'm saying this because the standard 'guide level explanation' and 'reference level explanation' sections in the rfc template are more focussed at <em>new</em> (language) features, and might not work well for proposals like this.)</p>



<a name="272702002"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/219381-t-libs/topic/Removing%20macros%20from%20top%20level%3F/near/272702002" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Lokathor <a href="https://zulip-archive.rust-lang.org/stream/219381-t-libs/topic/Removing.20macros.20from.20top.20level.3F.html#272702002">(Feb 21 2022 at 15:24)</a>:</h4>
<p>One question I'm sure that will come up is "what's the point of moving everything if you have to re-export from the crate root anyway?"</p>



<a name="272702341"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/219381-t-libs/topic/Removing%20macros%20from%20top%20level%3F/near/272702341" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Mara <a href="https://zulip-archive.rust-lang.org/stream/219381-t-libs/topic/Removing.20macros.20from.20top.20level.3F.html#272702341">(Feb 21 2022 at 15:27)</a>:</h4>
<p>the root re-export is only for backwards compatibility. but it might be interesting to discuss the differences between a macro in std's or core's root and a macro in the prelude.</p>



<a name="272703370"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/219381-t-libs/topic/Removing%20macros%20from%20top%20level%3F/near/272703370" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Yoshua Wuyts [he/they] <a href="https://zulip-archive.rust-lang.org/stream/219381-t-libs/topic/Removing.20macros.20from.20top.20level.3F.html#272703370">(Feb 21 2022 at 15:35)</a>:</h4>
<p><span class="user-mention silent" data-user-id="310399">Mara</span> <a href="#narrow/stream/219381-t-libs/topic/Removing.20macros.20from.20top.20level.3F/near/272701600">said</a>:</p>
<blockquote>
<p><span class="user-mention silent" data-user-id="211722">Yoshua Wuyts [he/they]</span> moving macros to relevant modules and adding re-exports in the root sounds great. (better than the other way around.) it's a relatively small change, but an RFC could be useful.</p>
</blockquote>
<p>Yay, amazing! - An RFC it is then! <span aria-label="smiley" class="emoji emoji-1f603" role="img" title="smiley">:smiley:</span></p>



<a name="272707117"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/219381-t-libs/topic/Removing%20macros%20from%20top%20level%3F/near/272707117" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Lokathor <a href="https://zulip-archive.rust-lang.org/stream/219381-t-libs/topic/Removing.20macros.20from.20top.20level.3F.html#272707117">(Feb 21 2022 at 16:05)</a>:</h4>
<p>Right Mara, the backwards compatibility concern is the reason for the std root re-exports. However, given that the re-exports are a hard requirement, what's the value in doing any of the other re-organizing. What benefit will users see from having all these macros suddenly be "in two places".</p>
<p>And I don't mean "convince me in this zulip thread", I mean the RFC text should have a convincing answer.</p>



<a name="272708914"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/219381-t-libs/topic/Removing%20macros%20from%20top%20level%3F/near/272708914" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Yoshua Wuyts [he/they] <a href="https://zulip-archive.rust-lang.org/stream/219381-t-libs/topic/Removing.20macros.20from.20top.20level.3F.html#272708914">(Feb 21 2022 at 16:21)</a>:</h4>
<p><span class="user-mention" data-user-id="224471">@Lokathor</span> I'll make sure to address that (:</p>



<a name="272715891"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/219381-t-libs/topic/Removing%20macros%20from%20top%20level%3F/near/272715891" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> scottmcm <a href="https://zulip-archive.rust-lang.org/stream/219381-t-libs/topic/Removing.20macros.20from.20top.20level.3F.html#272715891">(Feb 21 2022 at 17:22)</a>:</h4>
<p>Oh, <code>std::panic!()</code> works.  That's a shame.</p>
<p>It would have been nice if this could have just been "put in a reasonable module + prelude reexport".</p>



<a name="272715915"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/219381-t-libs/topic/Removing%20macros%20from%20top%20level%3F/near/272715915" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> bstrie <a href="https://zulip-archive.rust-lang.org/stream/219381-t-libs/topic/Removing.20macros.20from.20top.20level.3F.html#272715915">(Feb 21 2022 at 17:22)</a>:</h4>
<p>note that old-style macros are already reachable from two places, both <code>println</code> and <code>std::println</code> work (the latter isn't the case for things that are <em>actually</em> in the prelude). it's fair to emphasize that this change is mostly for better documentation (giving these macros homes in places other than the crate root is both what new users expect (striving for consistency is one of the things people like about Rust) and theoretically lets us clean up the chaotic grab bag of <a href="https://doc.rust-lang.org/std/index.html#macros">https://doc.rust-lang.org/std/index.html#macros</a> (via <code>#[doc(hidden)]</code> on wrapper macros))</p>



<a name="272716133"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/219381-t-libs/topic/Removing%20macros%20from%20top%20level%3F/near/272716133" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> bstrie <a href="https://zulip-archive.rust-lang.org/stream/219381-t-libs/topic/Removing.20macros.20from.20top.20level.3F.html#272716133">(Feb 21 2022 at 17:25)</a>:</h4>
<p>on the T-libs side it also helps to emphasize that "namespace where possible" appears to have won out over "put macros in the crate root" when it comes to stabilizing new macros, as has been done for <code>ptr::raw!</code> and <code>arch::asm!</code> and <code>arch::is_foo_feature_detected!</code></p>



<a name="272716252"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/219381-t-libs/topic/Removing%20macros%20from%20top%20level%3F/near/272716252" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> bstrie <a href="https://zulip-archive.rust-lang.org/stream/219381-t-libs/topic/Removing.20macros.20from.20top.20level.3F.html#272716252">(Feb 21 2022 at 17:26)</a>:</h4>
<p>and don't get me started on the fact that I'd like to namespace all the builtin attributes as well, and make their documentation live in std rather than the reference :P imagine <code>std::hint::inline</code>...</p>



<a name="274245696"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/219381-t-libs/topic/Removing%20macros%20from%20top%20level%3F/near/274245696" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Yoshua Wuyts [he/they] <a href="https://zulip-archive.rust-lang.org/stream/219381-t-libs/topic/Removing.20macros.20from.20top.20level.3F.html#274245696">(Mar 05 2022 at 14:16)</a>:</h4>
<p>Hey all, I've written out a preliminary mapping of all macros in <code>std</code> to their new homes. So far everyone seems mostly on board with the idea of re-exporting macros, so I now expect the main point of discussion will be to figure out which submodules to actually move the macros to. I figured I'd front-load that and get people's input on that as soon as possible.</p>
<p>Let me know what y'alls thoughts are on this!: <a href="https://hackmd.io/@yoshuawuyts/rJg8AyWbq">https://hackmd.io/@yoshuawuyts/rJg8AyWbq</a></p>



<a name="274245793"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/219381-t-libs/topic/Removing%20macros%20from%20top%20level%3F/near/274245793" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Yoshua Wuyts [he/they] <a href="https://zulip-archive.rust-lang.org/stream/219381-t-libs/topic/Removing.20macros.20from.20top.20level.3F.html#274245793">(Mar 05 2022 at 14:19)</a>:</h4>
<p>I guess as an aside: I just realized <code>core::arch</code> exists, but <code>std::arch</code> does not? I think I failed to include the <code>core::arch::arch!</code> macros for that reason.</p>



<a name="274246031"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/219381-t-libs/topic/Removing%20macros%20from%20top%20level%3F/near/274246031" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> simulacrum <a href="https://zulip-archive.rust-lang.org/stream/219381-t-libs/topic/Removing.20macros.20from.20top.20level.3F.html#274246031">(Mar 05 2022 at 14:24)</a>:</h4>
<p>it should exist - <a href="https://doc.rust-lang.org/nightly/std/arch/index.html">https://doc.rust-lang.org/nightly/std/arch/index.html</a></p>



<a name="274246036"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/219381-t-libs/topic/Removing%20macros%20from%20top%20level%3F/near/274246036" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> simulacrum <a href="https://zulip-archive.rust-lang.org/stream/219381-t-libs/topic/Removing.20macros.20from.20top.20level.3F.html#274246036">(Mar 05 2022 at 14:24)</a>:</h4>
<p>the macros iirc don't get rendered for some awkward reason</p>



<a name="274246048"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/219381-t-libs/topic/Removing%20macros%20from%20top%20level%3F/near/274246048" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> simulacrum <a href="https://zulip-archive.rust-lang.org/stream/219381-t-libs/topic/Removing.20macros.20from.20top.20level.3F.html#274246048">(Mar 05 2022 at 14:25)</a>:</h4>
<p><a class="stream-topic" data-stream-id="219381" href="/#narrow/stream/219381-t-libs/topic/asm.2Fglobal_asm.20only.20in.20core.3F">#t-libs &gt; asm/global_asm only in core?</a> maybe?</p>



<a name="274246050"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/219381-t-libs/topic/Removing%20macros%20from%20top%20level%3F/near/274246050" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> bjorn3 <a href="https://zulip-archive.rust-lang.org/stream/219381-t-libs/topic/Removing.20macros.20from.20top.20level.3F.html#274246050">(Mar 05 2022 at 14:25)</a>:</h4>
<p>Left a few comments on the hackmd.</p>



<a name="274246074"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/219381-t-libs/topic/Removing%20macros%20from%20top%20level%3F/near/274246074" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> bjorn3 <a href="https://zulip-archive.rust-lang.org/stream/219381-t-libs/topic/Removing.20macros.20from.20top.20level.3F.html#274246074">(Mar 05 2022 at 14:25)</a>:</h4>
<p><span class="user-mention silent" data-user-id="211722">Yoshua Wuyts [he/they]</span> <a href="#narrow/stream/219381-t-libs/topic/Removing.20macros.20from.20top.20level.3F/near/274245793">said</a>:</p>
<blockquote>
<p>I guess as an aside: I just realized <code>core::arch</code> exists, but <code>std::arch</code> does not? I think I failed to include the <code>core::arch::arch!</code> macros for that reason.</p>
</blockquote>
<p><a href="/user_uploads/4715/9_USEkCtk0o1XCRiCXg9XM5t/image.png">image.png</a></p>
<div class="message_inline_image"><a href="/user_uploads/4715/9_USEkCtk0o1XCRiCXg9XM5t/image.png" title="image.png"><img src="/user_uploads/4715/9_USEkCtk0o1XCRiCXg9XM5t/image.png"></a></div>



<a name="274246122"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/219381-t-libs/topic/Removing%20macros%20from%20top%20level%3F/near/274246122" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> bjorn3 <a href="https://zulip-archive.rust-lang.org/stream/219381-t-libs/topic/Removing.20macros.20from.20top.20level.3F.html#274246122">(Mar 05 2022 at 14:26)</a>:</h4>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="c1">// The `no_inline`-attribute is required to make the documentation of all</span>
<span class="c1">// targets available.</span>
<span class="c1">// See https://github.com/rust-lang/rust/pull/57808#issuecomment-457390549 for</span>
<span class="c1">// more information.</span>
<span class="cp">#[doc(no_inline)]</span><span class="w"> </span><span class="c1">// Note (#82861): required for correct documentation</span>
<span class="k">pub</span><span class="w"> </span><span class="k">use</span><span class="w"> </span><span class="n">core</span>::<span class="n">arch</span><span class="p">;</span><span class="w"></span>
</code></pre></div>



<a name="274363086"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/219381-t-libs/topic/Removing%20macros%20from%20top%20level%3F/near/274363086" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Nick Cameron <a href="https://zulip-archive.rust-lang.org/stream/219381-t-libs/topic/Removing.20macros.20from.20top.20level.3F.html#274363086">(Mar 07 2022 at 08:51)</a>:</h4>
<p>It's a bit unclear for macros which you've named by path, e.g., future::join, and you've put std as the proposed new location, are you proposing std::future as the location (good, IMO) or moving to std (bad, IMO)</p>



<a name="274364021"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/219381-t-libs/topic/Removing%20macros%20from%20top%20level%3F/near/274364021" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Nick Cameron <a href="https://zulip-archive.rust-lang.org/stream/219381-t-libs/topic/Removing.20macros.20from.20top.20level.3F.html#274364021">(Mar 07 2022 at 09:01)</a>:</h4>
<p>Urgh, it is annoying that HackMD sometimes just dumps comments at the end of the doc (I think when the comment is on a code block)</p>



<a name="274387823"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/219381-t-libs/topic/Removing%20macros%20from%20top%20level%3F/near/274387823" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Yoshua Wuyts [he/they] <a href="https://zulip-archive.rust-lang.org/stream/219381-t-libs/topic/Removing.20macros.20from.20top.20level.3F.html#274387823">(Mar 07 2022 at 13:03)</a>:</h4>
<p><span class="user-mention silent" data-user-id="256841">Nick Cameron</span> <a href="#narrow/stream/219381-t-libs/topic/Removing.20macros.20from.20top.20level.3F/near/274363086">said</a>:</p>
<blockquote>
<p>It's a bit unclear for macros which you've named by path, e.g., future::join, and you've put std as the proposed new location, are you proposing std::future as the location (good, IMO) or moving to std (bad, IMO)</p>
</blockquote>
<p>Oh, that's a good point. Yeah I didn't mean to change its location. I'll work on clarifying that!</p>



<a name="275569063"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/219381-t-libs/topic/Removing%20macros%20from%20top%20level%3F/near/275569063" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Johannes Dahlström <a href="https://zulip-archive.rust-lang.org/stream/219381-t-libs/topic/Removing.20macros.20from.20top.20level.3F.html#275569063">(Mar 16 2022 at 19:59)</a>:</h4>
<p>Re: where to put line! etc, I think <code>std::source::line/column/file/include_bytes!</code> etc read quite nicely</p>



<a name="275584867"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/219381-t-libs/topic/Removing%20macros%20from%20top%20level%3F/near/275584867" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Lokathor <a href="https://zulip-archive.rust-lang.org/stream/219381-t-libs/topic/Removing.20macros.20from.20top.20level.3F.html#275584867">(Mar 16 2022 at 22:20)</a>:</h4>
<p>I'm not sure that a new module just to hold macros that will be at the crate root anyway is the best route.</p>



<hr><p>Last updated: Apr 12 2022 at 20:01 UTC</p>
</html>