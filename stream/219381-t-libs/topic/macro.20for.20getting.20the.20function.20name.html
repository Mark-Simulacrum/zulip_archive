<html>
<head><meta charset="utf-8"><title>macro for getting the function name · t-libs · Zulip Chat Archive</title></head>
<h2>Stream: <a href="https://zulip-archive.rust-lang.org/stream/219381-t-libs/index.html">t-libs</a></h2>
<h3>Topic: <a href="https://zulip-archive.rust-lang.org/stream/219381-t-libs/topic/macro.20for.20getting.20the.20function.20name.html">macro for getting the function name</a></h3>

<hr>

<base href="https://rust-lang.zulipchat.com">

<head><link href="https://zulip-archive.rust-lang.org/style.css" rel="stylesheet"></head>

<a name="269583366"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/219381-t-libs/topic/macro%20for%20getting%20the%20function%20name/near/269583366" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> bstrie <a href="https://zulip-archive.rust-lang.org/stream/219381-t-libs/topic/macro.20for.20getting.20the.20function.20name.html#269583366">(Jan 27 2022 at 14:52)</a>:</h4>
<p>C++ has a standard <code>__func__</code> builtin that returns the name of the function that it's within. It occurs to me that it's a bit odd that Rust doesn't have something analogous, since we already have <code>file!</code> and <code>module_path!</code> and <code>line!</code> and <code>column!</code> for similar things. Is this something that people would be interested in having?</p>



<a name="269589855"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/219381-t-libs/topic/macro%20for%20getting%20the%20function%20name/near/269589855" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> CraftSpider <a href="https://zulip-archive.rust-lang.org/stream/219381-t-libs/topic/macro.20for.20getting.20the.20function.20name.html#269589855">(Jan 27 2022 at 15:35)</a>:</h4>
<p>I've wished for it once or twice, especially for logging macros or such. It feels like a bit of an odd hole. My one thought is that maybe it has more design choices, so was skipped. For example, should <code>impl Struct { fn foo() { function!() } }</code> be <code>foo</code> or <code>Struct::foo</code>, as the second might be nicer for logging (<code>module_path!() + function!()</code> is the whole resolution, not possible to mix up with a top-level <code>foo</code>), but the first is the more intuitive 'current function name'</p>



<a name="269593946"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/219381-t-libs/topic/macro%20for%20getting%20the%20function%20name/near/269593946" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> bjorn3 <a href="https://zulip-archive.rust-lang.org/stream/219381-t-libs/topic/macro.20for.20getting.20the.20function.20name.html#269593946">(Jan 27 2022 at 16:01)</a>:</h4>
<p><code>module_path!()</code> doesn't include the function name if a <code>mod{}</code> is nested inside a function.</p>



<a name="269596152"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/219381-t-libs/topic/macro%20for%20getting%20the%20function%20name/near/269596152" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Waffle Lapkin <a href="https://zulip-archive.rust-lang.org/stream/219381-t-libs/topic/macro.20for.20getting.20the.20function.20name.html#269596152">(Jan 27 2022 at 16:14)</a>:</h4>
<p>IIRC there was a hack that went something like this:</p>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="kd">let</span><span class="w"> </span><span class="n">path</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">type_name_of</span><span class="p">(</span><span class="o">&amp;||</span><span class="w"> </span><span class="p">());</span><span class="w"></span>
<span class="n">path</span><span class="p">[</span><span class="o">..</span><span class="n">path</span><span class="p">.</span><span class="n">len</span><span class="p">()</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="s">"::{{closure}}"</span><span class="p">.</span><span class="n">len</span><span class="p">()].</span><span class="n">rsplit</span><span class="p">(</span><span class="s">"::"</span><span class="p">).</span><span class="n">next</span><span class="p">().</span><span class="n">unwrap</span><span class="p">()</span><span class="w"></span>
</code></pre></div>
<p>But I can't find where I found it originally <span aria-label="thinking" class="emoji emoji-1f914" role="img" title="thinking">:thinking:</span></p>



<a name="269596449"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/219381-t-libs/topic/macro%20for%20getting%20the%20function%20name/near/269596449" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> lqd <a href="https://zulip-archive.rust-lang.org/stream/219381-t-libs/topic/macro.20for.20getting.20the.20function.20name.html#269596449">(Jan 27 2022 at 16:16)</a>:</h4>
<p>like here <a href="https://twitter.com/mitsuhiko/status/1486126762346045442">https://twitter.com/mitsuhiko/status/1486126762346045442</a></p>
<div class="inline-preview-twitter"><div class="twitter-tweet"><a href="https://twitter.com/mitsuhiko/status/1486126762346045442"><img class="twitter-avatar" src="https://uploads.zulipusercontent.net/9f6ba0d6a01ff0690885fdcc3b67b259a3eba105/68747470733a2f2f7062732e7477696d672e636f6d2f70726f66696c655f696d616765732f313433333938323032382f70726f66696c655f6e6f726d616c2e706e67"></a><p>I finally found a somewhat reliable name to determine the test function name. This should make insta pick more reliable snapshot names but the hack is … interesting. <a href="https://t.co/2r10pJpF4A">https://twitter.com/mitsuhiko/status/1486126762346045442/photo/1</a></p><span>- Armin “vax ffs” Ronacher (@mitsuhiko)</span><div class="twitter-image"><a href="https://t.co/2r10pJpF4A"><img src="https://uploads.zulipusercontent.net/9bef4ba2ce6ecb1cac4836d360ea069ed8a0e09c/68747470733a2f2f7062732e7477696d672e636f6d2f6d656469612f464a5f495a6530586f414d422d4a4e2e6a70673a736d616c6c"></a></div></div></div>



<a name="269597395"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/219381-t-libs/topic/macro%20for%20getting%20the%20function%20name/near/269597395" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> CraftSpider <a href="https://zulip-archive.rust-lang.org/stream/219381-t-libs/topic/macro.20for.20getting.20the.20function.20name.html#269597395">(Jan 27 2022 at 16:23)</a>:</h4>
<p>Personally, I'd be fine with a <code>function!()</code> that returns the simple function name, but I'd also really like a <code>full_path!()</code> or something that gives a 'proper' current path.</p>



<a name="269600423"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/219381-t-libs/topic/macro%20for%20getting%20the%20function%20name/near/269600423" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> bstrie <a href="https://zulip-archive.rust-lang.org/stream/219381-t-libs/topic/macro.20for.20getting.20the.20function.20name.html#269600423">(Jan 27 2022 at 16:44)</a>:</h4>
<p>ah, found the prior wishlist issue: <a href="https://github.com/rust-lang/rfcs/issues/1743">https://github.com/rust-lang/rfcs/issues/1743</a></p>



<a name="269603928"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/219381-t-libs/topic/macro%20for%20getting%20the%20function%20name/near/269603928" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> bstrie <a href="https://zulip-archive.rust-lang.org/stream/219381-t-libs/topic/macro.20for.20getting.20the.20function.20name.html#269603928">(Jan 27 2022 at 17:06)</a>:</h4>
<p><span class="user-mention" data-user-id="213696">@Armin Ronacher</span>'s RFC from 2014: <a href="https://github.com/rust-lang/rfcs/pull/466">https://github.com/rust-lang/rfcs/pull/466</a><br>
<span class="user-mention" data-user-id="301846">@Sebastian Dröge</span>'s RFC from 2016: <a href="https://github.com/rust-lang/rfcs/pull/1719">https://github.com/rust-lang/rfcs/pull/1719</a><br>
<span class="user-mention" data-user-id="224471">@Lokathor</span>'s RFC from 2019: <a href="https://github.com/rust-lang/rfcs/pull/2818">https://github.com/rust-lang/rfcs/pull/2818</a></p>



<a name="269603974"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/219381-t-libs/topic/macro%20for%20getting%20the%20function%20name/near/269603974" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> bstrie <a href="https://zulip-archive.rust-lang.org/stream/219381-t-libs/topic/macro.20for.20getting.20the.20function.20name.html#269603974">(Jan 27 2022 at 17:06)</a>:</h4>
<p>in all of these cases it looks like people were enthusiastic about it, but nobody had the time to really push it forward</p>



<a name="269611598"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/219381-t-libs/topic/macro%20for%20getting%20the%20function%20name/near/269611598" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> bstrie <a href="https://zulip-archive.rust-lang.org/stream/219381-t-libs/topic/macro.20for.20getting.20the.20function.20name.html#269611598">(Jan 27 2022 at 17:56)</a>:</h4>
<p>since the primary use case for this appears to be diagnostic/error reporting and has some overlap with backtraces, maybe <span class="user-mention" data-user-id="220273">@Jane Lusby [she/her]</span> has thoughts?</p>



<a name="269612548"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/219381-t-libs/topic/macro%20for%20getting%20the%20function%20name/near/269612548" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> bstrie <a href="https://zulip-archive.rust-lang.org/stream/219381-t-libs/topic/macro.20for.20getting.20the.20function.20name.html#269612548">(Jan 27 2022 at 18:01)</a>:</h4>
<p>it looks like <code>__func__</code> in C++ has implementation-defined output <a href="https://eel.is/c++draft/dcl.fct.def#general-8">https://eel.is/c++draft/dcl.fct.def#general-8</a> , although <a href="https://docs.microsoft.com/en-us/cpp/cpp/func?view=msvc-170">https://docs.microsoft.com/en-us/cpp/cpp/func?view=msvc-170</a> says it's "the unqualified and unadorned name of the enclosing function"</p>



<a name="269613217"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/219381-t-libs/topic/macro%20for%20getting%20the%20function%20name/near/269613217" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> bstrie <a href="https://zulip-archive.rust-lang.org/stream/219381-t-libs/topic/macro.20for.20getting.20the.20function.20name.html#269613217">(Jan 27 2022 at 18:04)</a>:</h4>
<p>if people are just going to be gluing the output of this macro onto <code>module_path!</code> then we might as well just provide <code>function_path!</code> for the fully-qualified name. but if people have use cases for both the qualified and unqualified function names, rather than forcing them to glue/split strings we could have both <code>function!</code> and <code>function_path!</code></p>



<a name="269613383"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/219381-t-libs/topic/macro%20for%20getting%20the%20function%20name/near/269613383" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Armin Ronacher <a href="https://zulip-archive.rust-lang.org/stream/219381-t-libs/topic/macro.20for.20getting.20the.20function.20name.html#269613383">(Jan 27 2022 at 18:05)</a>:</h4>
<p>The perfect topic to have a lot of bikeshedding about :)</p>



<a name="269613521"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/219381-t-libs/topic/macro%20for%20getting%20the%20function%20name/near/269613521" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> bstrie <a href="https://zulip-archive.rust-lang.org/stream/219381-t-libs/topic/macro.20for.20getting.20the.20function.20name.html#269613521">(Jan 27 2022 at 18:06)</a>:</h4>
<p>what's your specific use case? you've been requesting this since 2014, I'm curious if your use cases have changed since then</p>



<a name="269613728"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/219381-t-libs/topic/macro%20for%20getting%20the%20function%20name/near/269613728" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Armin Ronacher <a href="https://zulip-archive.rust-lang.org/stream/219381-t-libs/topic/macro.20for.20getting.20the.20function.20name.html#269613728">(Jan 27 2022 at 18:07)</a>:</h4>
<p>So the most recent use case where I am using it for is to discover the name of the test function that contains an assertion. For that I'm now using the type_name hack that was linked above as a replacement for using the thread name which is unreliable. A lot of the use cases for accessing function name are error reporting and utiltiies for tests</p>



<a name="269613806"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/219381-t-libs/topic/macro%20for%20getting%20the%20function%20name/near/269613806" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Armin Ronacher <a href="https://zulip-archive.rust-lang.org/stream/219381-t-libs/topic/macro.20for.20getting.20the.20function.20name.html#269613806">(Jan 27 2022 at 18:08)</a>:</h4>
<p>I will say that I have since learned that closures make this slightly more complex but not excessively so.</p>



<a name="269615822"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/219381-t-libs/topic/macro%20for%20getting%20the%20function%20name/near/269615822" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Daniel Henry-Mantilla <a href="https://zulip-archive.rust-lang.org/stream/219381-t-libs/topic/macro.20for.20getting.20the.20function.20name.html#269615822">(Jan 27 2022 at 18:22)</a>:</h4>
<p>There is also <a href="https://docs.rs/function_name/latest/function_name">https://docs.rs/function_name/latest/function_name</a>, although it needs that companion attribute, severely hindering its usefulness</p>



<a name="269616418"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/219381-t-libs/topic/macro%20for%20getting%20the%20function%20name/near/269616418" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Daniel Henry-Mantilla <a href="https://zulip-archive.rust-lang.org/stream/219381-t-libs/topic/macro.20for.20getting.20the.20function.20name.html#269616418">(Jan 27 2022 at 18:26)</a>:</h4>
<p>Also, <em>w.r.t</em> <code>module_path!</code>, I've found it to be more disappointing than useful, given the lack of eager expansion. I'd love to see CPS-style macros for these things, so that other macros can work off that:</p>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="n">with_module_path</span><span class="o">!</span><span class="w"> </span><span class="p">{(</span><span class="w"> </span><span class="cp">$($module_path</span>:<span class="nc">tt</span><span class="p">)</span><span class="o">*</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="p">(</span><span class="w"></span>
<span class="w">    </span><span class="cm">/* other macros can inspect the $module_path */</span><span class="w"></span>
<span class="w">    </span><span class="cp">$($module_path</span><span class="p">)</span><span class="o">*</span>::<span class="n">SomeThing</span><span class="w"></span>
<span class="p">)}</span><span class="w"></span>
</code></pre></div>
<p><code>function_name!</code> also seems relevant in that regard:</p>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="fm">macro_rules!</span><span class="w"> </span><span class="n">recurse</span><span class="w"> </span><span class="p">{(</span><span class="w"> </span><span class="cp">$($args</span>:<span class="nc">tt</span><span class="p">)</span><span class="o">*</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="p">(</span><span class="w"></span>
<span class="w">    </span><span class="n">with_function_name</span><span class="o">!</span><span class="w"> </span><span class="p">{(</span><span class="w"> </span><span class="cp">$function_name</span>:<span class="nc">ident</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="p">(</span><span class="w"></span>
<span class="w">        </span><span class="bp">self</span>::<span class="cp">$function_name</span><span class="p">(</span><span class="cp">$($args</span><span class="p">)</span><span class="o">*</span><span class="p">)</span><span class="w"></span>
<span class="w">    </span><span class="p">)}</span><span class="w"></span>
<span class="p">)}</span><span class="w"></span>
</code></pre></div>



<a name="269618884"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/219381-t-libs/topic/macro%20for%20getting%20the%20function%20name/near/269618884" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> bstrie <a href="https://zulip-archive.rust-lang.org/stream/219381-t-libs/topic/macro.20for.20getting.20the.20function.20name.html#269618884">(Jan 27 2022 at 18:45)</a>:</h4>
<p>here's a contrived example using Armin 's macro <a href="https://play.rust-lang.org/?version=stable&amp;mode=debug&amp;edition=2021&amp;gist=bab3ba760b83eecbec326018dd0eb243">https://play.rust-lang.org/?version=stable&amp;mode=debug&amp;edition=2021&amp;gist=bab3ba760b83eecbec326018dd0eb243</a> , demonstrating that it gets the fully-qualified path (including mods, traits, generics, and mods-inside-fns), but omitting <code>::{{closure}}</code> if it's the very last component of the path. I think that an implementation in std wouldn't want to omit the <code>::{{closure}}</code> part, but several of the previous proposals suggest making it more useful, such as <code>::{{closure#N}}</code> where <code>N</code> represents some sort of disambiguator. <span class="user-mention" data-user-id="213696">@Armin Ronacher</span> , does that sound like something you would use?</p>



<a name="269619601"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/219381-t-libs/topic/macro%20for%20getting%20the%20function%20name/near/269619601" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Armin Ronacher <a href="https://zulip-archive.rust-lang.org/stream/219381-t-libs/topic/macro.20for.20getting.20the.20function.20name.html#269619601">(Jan 27 2022 at 18:50)</a>:</h4>
<p>I think it’s better for {{closure}} to be left in. Users can always easily remove it</p>



<a name="269619625"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/219381-t-libs/topic/macro%20for%20getting%20the%20function%20name/near/269619625" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Armin Ronacher <a href="https://zulip-archive.rust-lang.org/stream/219381-t-libs/topic/macro.20for.20getting.20the.20function.20name.html#269619625">(Jan 27 2022 at 18:50)</a>:</h4>
<p>The N part would likely make this more complex though</p>



<a name="269619668"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/219381-t-libs/topic/macro%20for%20getting%20the%20function%20name/near/269619668" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> bstrie <a href="https://zulip-archive.rust-lang.org/stream/219381-t-libs/topic/macro.20for.20getting.20the.20function.20name.html#269619668">(Jan 27 2022 at 18:50)</a>:</h4>
<p>one of the RFCs mentions as an alternative that generalizing this to <code>item_path!</code> might be useful:</p>



<a name="269619689"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/219381-t-libs/topic/macro%20for%20getting%20the%20function%20name/near/269619689" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> bstrie <a href="https://zulip-archive.rust-lang.org/stream/219381-t-libs/topic/macro.20for.20getting.20the.20function.20name.html#269619689">(Jan 27 2022 at 18:51)</a>:</h4>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="k">mod</span> <span class="nn">foo</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="c1">// item_path!() ==&gt; foo</span>
<span class="w">    </span><span class="k">const</span><span class="w"> </span><span class="n">X</span>: <span class="kp">&amp;</span><span class="kt">str</span> <span class="o">=</span><span class="w"> </span><span class="n">item_path</span><span class="o">!</span><span class="p">();</span><span class="w"> </span><span class="c1">// foo::X</span>
<span class="w">    </span><span class="k">struct</span> <span class="nc">A</span><span class="p">;</span><span class="w"></span>
<span class="w">    </span><span class="k">impl</span><span class="w"> </span><span class="n">A</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">        </span><span class="k">const</span><span class="w"> </span><span class="n">Y</span>: <span class="kp">&amp;</span><span class="kt">str</span> <span class="o">=</span><span class="w"> </span><span class="n">item_path</span><span class="o">!</span><span class="p">();</span><span class="w"> </span><span class="c1">// foo::A::Y</span>
<span class="w">        </span><span class="k">fn</span> <span class="nf">fun</span><span class="p">()</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">            </span><span class="c1">// item_path!() ==&gt; foo::A::fun</span>
<span class="w">        </span><span class="p">}</span><span class="w"></span>
<span class="w">    </span><span class="p">}</span><span class="w"></span>
<span class="w">     </span><span class="k">type</span> <span class="nc">T</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Stuff</span><span class="o">&lt;</span><span class="p">{</span><span class="n">item_path</span><span class="o">!</span><span class="p">()}</span><span class="o">&gt;</span><span class="w"> </span><span class="c1">// Stuff&lt;"foo::T"&gt;</span>
<span class="p">}</span><span class="w"></span>
</code></pre></div>



<a name="269620228"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/219381-t-libs/topic/macro%20for%20getting%20the%20function%20name/near/269620228" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jane Lusby [she/her] <a href="https://zulip-archive.rust-lang.org/stream/219381-t-libs/topic/macro.20for.20getting.20the.20function.20name.html#269620228">(Jan 27 2022 at 18:55)</a>:</h4>
<p><span class="user-mention silent" data-user-id="256342">bstrie</span> <a href="#narrow/stream/219381-t-libs/topic/macro.20for.20getting.20the.20function.20name/near/269611598">said</a>:</p>
<blockquote>
<p>since the primary use case for this appears to be diagnostic/error reporting and has some overlap with backtraces, maybe <span class="user-mention silent" data-user-id="220273">Jane Lusby [she/her]</span> has thoughts?</p>
</blockquote>
<p>I don't have strong thoughts other than that i've wanted this for tracing as well</p>



<a name="269620416"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/219381-t-libs/topic/macro%20for%20getting%20the%20function%20name/near/269620416" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jane Lusby [she/her] <a href="https://zulip-archive.rust-lang.org/stream/219381-t-libs/topic/macro.20for.20getting.20the.20function.20name.html#269620416">(Jan 27 2022 at 18:56)</a>:</h4>
<p>where the spans don't get to include the function name and so the module path is sometimes misleading iirc</p>



<a name="269620455"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/219381-t-libs/topic/macro%20for%20getting%20the%20function%20name/near/269620455" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jane Lusby [she/her] <a href="https://zulip-archive.rust-lang.org/stream/219381-t-libs/topic/macro.20for.20getting.20the.20function.20name.html#269620455">(Jan 27 2022 at 18:56)</a>:</h4>
<p><span class="user-mention" data-user-id="216718">@Hoverbear (飘飘熊)</span>  brought this up recently and might have better details than I do</p>



<a name="269626115"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/219381-t-libs/topic/macro%20for%20getting%20the%20function%20name/near/269626115" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Hoverbear (飘飘熊) <a href="https://zulip-archive.rust-lang.org/stream/219381-t-libs/topic/macro.20for.20getting.20the.20function.20name.html#269626115">(Jan 27 2022 at 19:38)</a>:</h4>
<p><span class="user-mention silent" data-user-id="220273">Jane Lusby [she/her]</span> <a href="#narrow/stream/219381-t-libs/topic/macro.20for.20getting.20the.20function.20name/near/269620455">said</a>:</p>
<blockquote>
<p><span class="user-mention silent" data-user-id="216718">Hoverbear (飘飘熊)</span>  brought this up recently and might have better details than I do</p>
</blockquote>
<p>In my case it was the struct associated with a function (eg the <code>fn foo()</code> of an impl block.</p>



<a name="269626597"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/219381-t-libs/topic/macro%20for%20getting%20the%20function%20name/near/269626597" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> oli <a href="https://zulip-archive.rust-lang.org/stream/219381-t-libs/topic/macro.20for.20getting.20the.20function.20name.html#269626597">(Jan 27 2022 at 19:41)</a>:</h4>
<p>Is this needed as a macro (so it can be used as input to other macros), or would it suffice to have it like <code>Location::caller()</code>, essentially being a function that you call and that returns a <code>&amp;'static str</code>?</p>



<a name="269626796"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/219381-t-libs/topic/macro%20for%20getting%20the%20function%20name/near/269626796" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> oli <a href="https://zulip-archive.rust-lang.org/stream/219381-t-libs/topic/macro.20for.20getting.20the.20function.20name.html#269626796">(Jan 27 2022 at 19:42)</a>:</h4>
<p>The latter is straight forward to implement. For the former I have various questions. Not about the impl, but the expected behaviour in general</p>



<a name="269626835"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/219381-t-libs/topic/macro%20for%20getting%20the%20function%20name/near/269626835" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> bstrie <a href="https://zulip-archive.rust-lang.org/stream/219381-t-libs/topic/macro.20for.20getting.20the.20function.20name.html#269626835">(Jan 27 2022 at 19:43)</a>:</h4>
<p>good question, lots of these are macros by dint of being "too weird to be a normal function", but that doesn't mean that they couldn't be a wrapper over an intrinsic or something</p>



<a name="269627006"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/219381-t-libs/topic/macro%20for%20getting%20the%20function%20name/near/269627006" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> oli <a href="https://zulip-archive.rust-lang.org/stream/219381-t-libs/topic/macro.20for.20getting.20the.20function.20name.html#269627006">(Jan 27 2022 at 19:44)</a>:</h4>
<p>It would be a breaking change to make <code>file!</code> be backed by an intrinsic</p>



<a name="269627065"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/219381-t-libs/topic/macro%20for%20getting%20the%20function%20name/near/269627065" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> oli <a href="https://zulip-archive.rust-lang.org/stream/219381-t-libs/topic/macro.20for.20getting.20the.20function.20name.html#269627065">(Jan 27 2022 at 19:44)</a>:</h4>
<p>Because then you can't do <code>concat!(file!(), "foo")</code></p>



<a name="269627597"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/219381-t-libs/topic/macro%20for%20getting%20the%20function%20name/near/269627597" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> bstrie <a href="https://zulip-archive.rust-lang.org/stream/219381-t-libs/topic/macro.20for.20getting.20the.20function.20name.html#269627597">(Jan 27 2022 at 19:48)</a>:</h4>
<p>sure, but with improved const machinery maybe we could have a <code>concat</code> function that outputs a static str? <code>let x: &amp;'static str = const { "foo".concat("bar") };</code></p>



<a name="269628024"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/219381-t-libs/topic/macro%20for%20getting%20the%20function%20name/near/269628024" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Lokathor <a href="https://zulip-archive.rust-lang.org/stream/219381-t-libs/topic/macro.20for.20getting.20the.20function.20name.html#269628024">(Jan 27 2022 at 19:51)</a>:</h4>
<p>people really, <em>really</em> would love that</p>



<a name="269628111"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/219381-t-libs/topic/macro%20for%20getting%20the%20function%20name/near/269628111" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Lokathor <a href="https://zulip-archive.rust-lang.org/stream/219381-t-libs/topic/macro.20for.20getting.20the.20function.20name.html#269628111">(Jan 27 2022 at 19:51)</a>:</h4>
<p>i can't tell you how much people want that, English lacks the words, etc</p>



<a name="269633081"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/219381-t-libs/topic/macro%20for%20getting%20the%20function%20name/near/269633081" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> oli <a href="https://zulip-archive.rust-lang.org/stream/219381-t-libs/topic/macro.20for.20getting.20the.20function.20name.html#269633081">(Jan 27 2022 at 20:29)</a>:</h4>
<p>That's not the issue. The issue is that you can use the concatenated result as input to format strings or even <code>include!</code>. I can make concat in CTFE right now, possibly even on stable</p>



<a name="269633278"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/219381-t-libs/topic/macro%20for%20getting%20the%20function%20name/near/269633278" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> oli <a href="https://zulip-archive.rust-lang.org/stream/219381-t-libs/topic/macro.20for.20getting.20the.20function.20name.html#269633278">(Jan 27 2022 at 20:31)</a>:</h4>
<p>Lol what if we made the concat macro use CTFE where it currently errors due to non-literal arguments? EDIT: off topic, moving this specific thread to the const eval stream</p>



<a name="269636617"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/219381-t-libs/topic/macro%20for%20getting%20the%20function%20name/near/269636617" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Armin Ronacher <a href="https://zulip-archive.rust-lang.org/stream/219381-t-libs/topic/macro.20for.20getting.20the.20function.20name.html#269636617">(Jan 27 2022 at 20:57)</a>:</h4>
<p>My hunch is that it does not matter if this is a macro vs the <code>Location::caller</code> but it has to be a static string slice to be useful</p>



<a name="269638704"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/219381-t-libs/topic/macro%20for%20getting%20the%20function%20name/near/269638704" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Mara <a href="https://zulip-archive.rust-lang.org/stream/219381-t-libs/topic/macro.20for.20getting.20the.20function.20name.html#269638704">(Jan 27 2022 at 21:12)</a>:</h4>
<p><code>__func__</code> in C++ is also not a macro that expands to a string literal.  it's an implicit <code>static const char[]</code> variable.</p>



<a name="269650732"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/219381-t-libs/topic/macro%20for%20getting%20the%20function%20name/near/269650732" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Armin Ronacher <a href="https://zulip-archive.rust-lang.org/stream/219381-t-libs/topic/macro.20for.20getting.20the.20function.20name.html#269650732">(Jan 27 2022 at 22:36)</a>:</h4>
<p>Which somewhat makes sense because it's easier to implement for most compilers probably</p>



<a name="269650788"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/219381-t-libs/topic/macro%20for%20getting%20the%20function%20name/near/269650788" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Armin Ronacher <a href="https://zulip-archive.rust-lang.org/stream/219381-t-libs/topic/macro.20for.20getting.20the.20function.20name.html#269650788">(Jan 27 2022 at 22:36)</a>:</h4>
<p>knowhing in which function you are form the preprocessor sounds insane</p>



<a name="269650814"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/219381-t-libs/topic/macro%20for%20getting%20the%20function%20name/near/269650814" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Triplett <a href="https://zulip-archive.rust-lang.org/stream/219381-t-libs/topic/macro.20for.20getting.20the.20function.20name.html#269650814">(Jan 27 2022 at 22:37)</a>:</h4>
<p>I would love to have <code>item_path!</code> as well, giving the full path to the containing function or item.</p>



<a name="269650989"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/219381-t-libs/topic/macro%20for%20getting%20the%20function%20name/near/269650989" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Triplett <a href="https://zulip-archive.rust-lang.org/stream/219381-t-libs/topic/macro.20for.20getting.20the.20function.20name.html#269650989">(Jan 27 2022 at 22:38)</a>:</h4>
<p>Though I can imagine an ambiguity there.</p>



<a name="269651103"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/219381-t-libs/topic/macro%20for%20getting%20the%20function%20name/near/269651103" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Triplett <a href="https://zulip-archive.rust-lang.org/stream/219381-t-libs/topic/macro.20for.20getting.20the.20function.20name.html#269651103">(Jan 27 2022 at 22:39)</a>:</h4>
<p>If you write a struct definition inside a function, and use <code>item_path!</code>, would you want the struct included in the item path?</p>



<a name="269651149"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/219381-t-libs/topic/macro%20for%20getting%20the%20function%20name/near/269651149" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Triplett <a href="https://zulip-archive.rust-lang.org/stream/219381-t-libs/topic/macro.20for.20getting.20the.20function.20name.html#269651149">(Jan 27 2022 at 22:39)</a>:</h4>
<p>In any case, I'm curious: if both <code>module_path!</code> and <code>item_path!</code> existed, would folks still want a <code>function!</code> that returns <em>just</em> the containing function name and no context for where that function is?</p>



<a name="269651861"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/219381-t-libs/topic/macro%20for%20getting%20the%20function%20name/near/269651861" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Armin Ronacher <a href="https://zulip-archive.rust-lang.org/stream/219381-t-libs/topic/macro.20for.20getting.20the.20function.20name.html#269651861">(Jan 27 2022 at 22:45)</a>:</h4>
<p>my hunch is no, because of closures. a <code>function!</code> that might return <code>{{closure}}</code> exclusively does not seem useful without always having to combine it with <code>item_path!</code></p>



<a name="269652231"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/219381-t-libs/topic/macro%20for%20getting%20the%20function%20name/near/269652231" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> cuviper <a href="https://zulip-archive.rust-lang.org/stream/219381-t-libs/topic/macro.20for.20getting.20the.20function.20name.html#269652231">(Jan 27 2022 at 22:48)</a>:</h4>
<p><span class="user-mention silent" data-user-id="239881">Josh Triplett</span> <a href="#narrow/stream/219381-t-libs/topic/macro.20for.20getting.20the.20function.20name/near/269651103">said</a>:</p>
<blockquote>
<p>If you write a struct definition inside a function, and use <code>item_path!</code>, would you want the struct included in the item path?</p>
</blockquote>
<p>I guess it should report the path the same way as we encode it before mangling. That can be misleading though, because something like <code>fn foo() { fn bar() {} }</code> becomes <code>::foo::bar</code>, even though you can't actually call it that way.</p>



<a name="269652793"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/219381-t-libs/topic/macro%20for%20getting%20the%20function%20name/near/269652793" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> cuviper <a href="https://zulip-archive.rust-lang.org/stream/219381-t-libs/topic/macro.20for.20getting.20the.20function.20name.html#269652793">(Jan 27 2022 at 22:53)</a>:</h4>
<p>you can even shadow that in nested blocks</p>



<a name="270427032"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/219381-t-libs/topic/macro%20for%20getting%20the%20function%20name/near/270427032" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Armin Ronacher <a href="https://zulip-archive.rust-lang.org/stream/219381-t-libs/topic/macro.20for.20getting.20the.20function.20name.html#270427032">(Feb 02 2022 at 17:42)</a>:</h4>
<p>I’m starting to think that Location::caller is the right place for this</p>



<a name="270427130"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/219381-t-libs/topic/macro%20for%20getting%20the%20function%20name/near/270427130" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Armin Ronacher <a href="https://zulip-archive.rust-lang.org/stream/219381-t-libs/topic/macro.20for.20getting.20the.20function.20name.html#270427130">(Feb 02 2022 at 17:43)</a>:</h4>
<p>But it’s kinda odd that Location is placed in std::panic</p>



<a name="270447076"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/219381-t-libs/topic/macro%20for%20getting%20the%20function%20name/near/270447076" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Mara <a href="https://zulip-archive.rust-lang.org/stream/219381-t-libs/topic/macro.20for.20getting.20the.20function.20name.html#270447076">(Feb 02 2022 at 19:51)</a>:</h4>
<p>it's possible for a type to move, as long as the old location exports it too</p>



<a name="270447248"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/219381-t-libs/topic/macro%20for%20getting%20the%20function%20name/near/270447248" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Lokathor <a href="https://zulip-archive.rust-lang.org/stream/219381-t-libs/topic/macro.20for.20getting.20the.20function.20name.html#270447248">(Feb 02 2022 at 19:53)</a>:</h4>
<p>I've needed the Location outside of a panic, but it has never bothered me that the module path mentions panic stuff. It's fine either way</p>



<a name="274836364"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/219381-t-libs/topic/macro%20for%20getting%20the%20function%20name/near/274836364" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Armin Ronacher <a href="https://zulip-archive.rust-lang.org/stream/219381-t-libs/topic/macro.20for.20getting.20the.20function.20name.html#274836364">(Mar 10 2022 at 13:46)</a>:</h4>
<p>Does anyone know if there is some movement here in making this work?</p>



<a name="274859540"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/219381-t-libs/topic/macro%20for%20getting%20the%20function%20name/near/274859540" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Mara <a href="https://zulip-archive.rust-lang.org/stream/219381-t-libs/topic/macro.20for.20getting.20the.20function.20name.html#274859540">(Mar 10 2022 at 16:28)</a>:</h4>
<p>i'm not aware of anyone working on this</p>



<a name="277395831"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/219381-t-libs/topic/macro%20for%20getting%20the%20function%20name/near/277395831" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ivan Schréter <a href="https://zulip-archive.rust-lang.org/stream/219381-t-libs/topic/macro.20for.20getting.20the.20function.20name.html#277395831">(Apr 01 2022 at 10:17)</a>:</h4>
<p>FYI, just yesterday I opened an issue in GitHub regarding adding the function name to Location: <a href="https://github.com/rust-lang/rust/issues/95529">https://github.com/rust-lang/rust/issues/95529</a> (since we'd like to use Location for a kind of fast error call trace for productive purposes with async code, where neither backtrace nor other options are good enough). I added some reasoning why there. <span class="user-mention" data-user-id="273349">@Waffle Lapkin</span> pointed me to this thread from there.</p>
<p>(note: until today, I was not aware of the existence of Zulip at all and of this thread in particular, so bear with me)</p>



<hr><p>Last updated: Apr 12 2022 at 20:01 UTC</p>
</html>