<html>
<head><meta charset="utf-8"><title>RangeBounds for scalar integers? · t-libs · Zulip Chat Archive</title></head>
<h2>Stream: <a href="https://zulip-archive.rust-lang.org/stream/219381-t-libs/index.html">t-libs</a></h2>
<h3>Topic: <a href="https://zulip-archive.rust-lang.org/stream/219381-t-libs/topic/RangeBounds.20for.20scalar.20integers.3F.html">RangeBounds for scalar integers?</a></h3>

<hr>

<base href="https://rust-lang.zulipchat.com">

<head><link href="https://zulip-archive.rust-lang.org/style.css" rel="stylesheet"></head>

<a name="254076667"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/219381-t-libs/topic/RangeBounds%20for%20scalar%20integers%3F/near/254076667" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ed Page <a href="https://zulip-archive.rust-lang.org/stream/219381-t-libs/topic/RangeBounds.20for.20scalar.20integers.3F.html#254076667">(Sep 20 2021 at 16:20)</a>:</h4>
<p>In both nom and clap, we are looking at allowing APIs to take ranges (<code>10..</code>) and individual integers (<code>10</code>).</p>
<p>For more details, I've written a <a href="https://github.com/epage/range_bounds_example/blob/main/scalar-range-bounds.md">draft RFC</a> and  <a href="https://github.com/epage/range_bounds_example/tree/main/examples">different strawman implementations</a></p>
<p>Is this something the libs team thinks is worth moving forward?  Would the next step be finishing my RFC and creating a PR for it?</p>



<a name="254078066"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/219381-t-libs/topic/RangeBounds%20for%20scalar%20integers%3F/near/254078066" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Thom Chiovoloni <a href="https://zulip-archive.rust-lang.org/stream/219381-t-libs/topic/RangeBounds.20for.20scalar.20integers.3F.html#254078066">(Sep 20 2021 at 16:30)</a>:</h4>
<p>I think this could be clearer about what it's proposing (I think having the summary describe the goals rather than the change is not ideal in this case).</p>
<p>It took a while for me to realize that it's proposing adding impl RangeBounds&lt;T&gt; for T: Ord, as in <a href="https://github.com/epage/range_bounds_example/blob/main/scalar-range-bounds.md#reference-level-explanation">https://github.com/epage/range_bounds_example/blob/main/scalar-range-bounds.md#reference-level-explanation</a>.</p>



<a name="254078372"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/219381-t-libs/topic/RangeBounds%20for%20scalar%20integers%3F/near/254078372" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Thom Chiovoloni <a href="https://zulip-archive.rust-lang.org/stream/219381-t-libs/topic/RangeBounds.20for.20scalar.20integers.3F.html#254078372">(Sep 20 2021 at 16:32)</a>:</h4>
<p>I think this means you won't be able to impl RangeBounds for Ord types though? Would that introduce coherence problems?</p>



<a name="254078753"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/219381-t-libs/topic/RangeBounds%20for%20scalar%20integers%3F/near/254078753" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> The 8472 <a href="https://zulip-archive.rust-lang.org/stream/219381-t-libs/topic/RangeBounds.20for.20scalar.20integers.3F.html#254078753">(Sep 20 2021 at 16:34)</a>:</h4>
<p>Wouldn't a  bunch of <code>From</code> impls be sufficient? Then APIs that need RangeBounds can do a <code>where U: Into&lt;RangeBounds&lt;T&gt;&gt;</code>.</p>



<a name="254084546"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/219381-t-libs/topic/RangeBounds%20for%20scalar%20integers%3F/near/254084546" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ed Page <a href="https://zulip-archive.rust-lang.org/stream/219381-t-libs/topic/RangeBounds.20for.20scalar.20integers.3F.html#254084546">(Sep 20 2021 at 17:13)</a>:</h4>
<p><span class="user-mention" data-user-id="209168">@Thom Chiovoloni</span> thanks for that feedback, I've updated the summary and an added an additional drawback.  I'm not too tied to what we <code>impl</code> for (<code>T: Ord</code>, concrete types, etc).  They have different trade offs but all meet the goal.  The question is if the goal is worth the trade offs.</p>



<a name="254085201"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/219381-t-libs/topic/RangeBounds%20for%20scalar%20integers%3F/near/254085201" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ed Page <a href="https://zulip-archive.rust-lang.org/stream/219381-t-libs/topic/RangeBounds.20for.20scalar.20integers.3F.html#254085201">(Sep 20 2021 at 17:18)</a>:</h4>
<p><span class="user-mention" data-user-id="330154">@The 8472</span> as we explored options for <code>nom</code>, we realized that <code>trait RangeBounds</code> is effectively a <code>trait IntoBounds</code> with <code>(Bound&lt;T&gt;, Bound&lt;T&gt;)</code> being the universal concrete type for ranges.  It seems like it might be overkill to also add <code>impl&lt;'r, T&gt; From&lt;&amp;'r Range&gt; for (Bound&lt;&amp;'r T&gt;, Bound&lt;&amp;'r T&gt;)</code> for each range type (<code>&amp;'r</code> so it follows the rest of <code>Range</code> types and not assume <code>Copy</code> or <code>Clone</code>).</p>
<p>I'll add this as an alternative though.</p>



<a name="254115770"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/219381-t-libs/topic/RangeBounds%20for%20scalar%20integers%3F/near/254115770" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> cuviper <a href="https://zulip-archive.rust-lang.org/stream/219381-t-libs/topic/RangeBounds.20for.20scalar.20integers.3F.html#254115770">(Sep 20 2021 at 20:50)</a>:</h4>
<p>A new blanket impl is a major breaking change.</p>



<a name="254117532"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/219381-t-libs/topic/RangeBounds%20for%20scalar%20integers%3F/near/254117532" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ed Page <a href="https://zulip-archive.rust-lang.org/stream/219381-t-libs/topic/RangeBounds.20for.20scalar.20integers.3F.html#254117532">(Sep 20 2021 at 21:01)</a>:</h4>
<p><span class="user-mention silent" data-user-id="138448">cuviper</span> <a href="#narrow/stream/219381-t-libs/topic/RangeBounds.20for.20scalar.20integers.3F/near/254115770">said</a>:</p>
<blockquote>
<p>A new blanket impl is a major breaking change.</p>
</blockquote>
<p>Did not know that; thanks!  Could you expand on why so I have a better grasp of this?</p>
<p>Any thoughts an alternative, like implementing for specific types, say the same set as <code>std::iter::Step</code>?</p>



<a name="254118418"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/219381-t-libs/topic/RangeBounds%20for%20scalar%20integers%3F/near/254118418" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Thom Chiovoloni <a href="https://zulip-archive.rust-lang.org/stream/219381-t-libs/topic/RangeBounds.20for.20scalar.20integers.3F.html#254118418">(Sep 20 2021 at 21:08)</a>:</h4>
<p>because people may have their own implementations, which are now incompatible. i think you kind of allude to this here:</p>
<blockquote>
<p>If nom is the first to do this and merges their approach, we'll break them if we do this later</p>
</blockquote>
<p>E.g. the fact that this change can break user code is why.</p>
<hr>
<p>I suspect there are no issues with implementing this for concrete types like the set used for Step (although I haven't checked which types implement step)</p>



<a name="254121038"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/219381-t-libs/topic/RangeBounds%20for%20scalar%20integers%3F/near/254121038" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ed Page <a href="https://zulip-archive.rust-lang.org/stream/219381-t-libs/topic/RangeBounds.20for.20scalar.20integers.3F.html#254121038">(Sep 20 2021 at 21:26)</a>:</h4>
<p>Thanks, I've updated the recommendation</p>
<blockquote>
<p>i think you kind of allude to this here:</p>
</blockquote>
<blockquote>
<p>I suspect there are no issues with implementing this for concrete types like the set used for Step (although I haven't checked which types implement step)</p>
</blockquote>
<p>I think there might be a misunderstanding with the breakage with the nom PR.  From my limited understanding of integer literal coercion, it looks like by adding a <code>RangeBounds</code> impl for concrete types, when the compiler sees <code>many(10)</code>, it is no longer choosing <code>usize</code> and picking <code>impl IntoRangeBounds&lt;RangeInclusive&lt;usize&gt;&gt; for usize</code> but instead it first sees  <code>impl RangeBounds&lt;i32&gt; for i32</code> and fails since we need the <code>usize</code> coercion.</p>
<p>Feel free to play with this, I've updated the <a href="https://github.com/epage/range_bounds_example/tree/main/examples/combined">broken case</a>.</p>



<a name="254123487"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/219381-t-libs/topic/RangeBounds%20for%20scalar%20integers%3F/near/254123487" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Thom Chiovoloni <a href="https://zulip-archive.rust-lang.org/stream/219381-t-libs/topic/RangeBounds.20for.20scalar.20integers.3F.html#254123487">(Sep 20 2021 at 21:45)</a>:</h4>
<p>yeah, in that case I'm mistaken, and the breakage is unrelated to your change. One example of breakage would be</p>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="cp">#[derive(Copy, Clone, PartialEq, Eq, PartialOrd, Ord)]</span><span class="w"></span>
<span class="k">struct</span> <span class="nc">MyOrdRange</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="cm">/* stuff here */</span><span class="w"> </span><span class="p">}</span><span class="w"></span>

<span class="k">impl</span><span class="w"> </span><span class="n">RangeBounds</span><span class="o">&lt;</span><span class="n">MyOrdRange</span><span class="o">&gt;</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="n">MyOrdRange</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="o">..</span><span class="p">.</span><span class="w"> </span><span class="p">}</span><span class="w"></span>
</code></pre></div>
<p>If we add a blanket, this will break, as <code>MyOrdRange</code> now has two <code>RangeBound&lt;Self&gt;</code> impls. This is a bit contrived, but there are plausibly more realistic breakages too.</p>



<a name="254126277"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/219381-t-libs/topic/RangeBounds%20for%20scalar%20integers%3F/near/254126277" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> cuviper <a href="https://zulip-archive.rust-lang.org/stream/219381-t-libs/topic/RangeBounds.20for.20scalar.20integers.3F.html#254126277">(Sep 20 2021 at 22:10)</a>:</h4>
<p>RFC 1023 discusses this: <a href="https://rust-lang.github.io/rfcs/1023-rebalancing-coherence.html#practical-effect">https://rust-lang.github.io/rfcs/1023-rebalancing-coherence.html#practical-effect</a></p>



<hr><p>Last updated: Apr 12 2022 at 20:01 UTC</p>
</html>