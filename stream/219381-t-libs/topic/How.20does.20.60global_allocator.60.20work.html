<html>
<head><meta charset="utf-8"><title>How does `global_allocator` work · t-libs · Zulip Chat Archive</title></head>
<h2>Stream: <a href="https://zulip-archive.rust-lang.org/stream/219381-t-libs/index.html">t-libs</a></h2>
<h3>Topic: <a href="https://zulip-archive.rust-lang.org/stream/219381-t-libs/topic/How.20does.20.60global_allocator.60.20work.html">How does `global_allocator` work</a></h3>

<hr>

<base href="https://rust-lang.zulipchat.com">

<head><link href="https://zulip-archive.rust-lang.org/style.css" rel="stylesheet"></head>

<a name="265522100"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/219381-t-libs/topic/How%20does%20%60global_allocator%60%20work/near/265522100" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nnethercote <a href="https://zulip-archive.rust-lang.org/stream/219381-t-libs/topic/How.20does.20.60global_allocator.60.20work.html#265522100">(Dec 20 2021 at 05:18)</a>:</h4>
<p>Calls to <code>alloc::alloc::alloc</code> or <code>Global::alloc</code> end up <a href="https://github.com/rust-lang/rust/blob/58899c4d9c63a6d27ac395ee9597ae797df7f026/library/alloc/src/alloc.rs#L30">here</a>. How those are magic symbols implemented? I looked for them (and related ones mentioned in comments like <code>__rg_alloc</code> and <code>__rdl_alloc</code>) but I haven't found much.</p>



<a name="265522188"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/219381-t-libs/topic/How%20does%20%60global_allocator%60%20work/near/265522188" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nnethercote <a href="https://zulip-archive.rust-lang.org/stream/219381-t-libs/topic/How.20does.20.60global_allocator.60.20work.html#265522188">(Dec 20 2021 at 05:20)</a>:</h4>
<p>The comment says "The rustc fork of LLVM also special-cases these function names". Is that correct -- is there such a fork?</p>



<a name="265522396"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/219381-t-libs/topic/How%20does%20%60global_allocator%60%20work/near/265522396" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nnethercote <a href="https://zulip-archive.rust-lang.org/stream/219381-t-libs/topic/How.20does.20.60global_allocator.60.20work.html#265522396">(Dec 20 2021 at 05:25)</a>:</h4>
<p>Hmm, <a href="https://github.com/rust-lang/rust/blob/5ab0f37087b61b2ea51f364498cddc20ecff74fa/compiler/rustc_ast/src/expand/allocator.rs#L12-L13">this</a> is relevant</p>



<a name="265522861"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/219381-t-libs/topic/How%20does%20%60global_allocator%60%20work/near/265522861" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nnethercote <a href="https://zulip-archive.rust-lang.org/stream/219381-t-libs/topic/How.20does.20.60global_allocator.60.20work.html#265522861">(Dec 20 2021 at 05:36)</a>:</h4>
<p><a href="https://github.com/rust-lang/rust/blob/5ab0f37087b61b2ea51f364498cddc20ecff74fa/compiler/rustc_codegen_llvm/src/allocator.rs#L57">This</a> too.</p>



<a name="265522870"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/219381-t-libs/topic/How%20does%20%60global_allocator%60%20work/near/265522870" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nnethercote <a href="https://zulip-archive.rust-lang.org/stream/219381-t-libs/topic/How.20does.20.60global_allocator.60.20work.html#265522870">(Dec 20 2021 at 05:37)</a>:</h4>
<p>Now I see why grepping didn't work, because format strings are being used to create the names like <code>__rg_alloc</code></p>



<a name="265523464"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/219381-t-libs/topic/How%20does%20%60global_allocator%60%20work/near/265523464" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nnethercote <a href="https://zulip-archive.rust-lang.org/stream/219381-t-libs/topic/How.20does.20.60global_allocator.60.20work.html#265523464">(Dec 20 2021 at 05:50)</a>:</h4>
<p>Ok, I think I can see the outlines of how this works now.</p>



<a name="265524338"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/219381-t-libs/topic/How%20does%20%60global_allocator%60%20work/near/265524338" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nnethercote <a href="https://zulip-archive.rust-lang.org/stream/219381-t-libs/topic/How.20does.20.60global_allocator.60.20work.html#265524338">(Dec 20 2021 at 06:07)</a>:</h4>
<p>I want to add this line:</p>
<div class="codehilite"><pre><span></span><code>    tikv_jemalloc_sys::malloc_usable_size(memory.as_ptr());
</code></pre></div>
<p>to <a href="https://github.com/rust-lang/rust/blob/207c80f105282245d93024c95ac408c622f70114/library/alloc/src/raw_vec.rs#L447-L472">RawVec::finish_grow</a>, but I'm having trouble getting it to build</p>



<a name="265524347"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/219381-t-libs/topic/How%20does%20%60global_allocator%60%20work/near/265524347" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nnethercote <a href="https://zulip-archive.rust-lang.org/stream/219381-t-libs/topic/How.20does.20.60global_allocator.60.20work.html#265524347">(Dec 20 2021 at 06:07)</a>:</h4>
<p>With this diff:</p>



<a name="265524351"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/219381-t-libs/topic/How%20does%20%60global_allocator%60%20work/near/265524351" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nnethercote <a href="https://zulip-archive.rust-lang.org/stream/219381-t-libs/topic/How.20does.20.60global_allocator.60.20work.html#265524351">(Dec 20 2021 at 06:07)</a>:</h4>
<div class="codehilite"><pre><span></span><code>diff --git a/library/alloc/Cargo.toml b/library/alloc/Cargo.toml
index b3ff0fd0a31..fad1d5e12f1 100644
--- a/library/alloc/Cargo.toml
+++ b/library/alloc/Cargo.toml
@@ -11,6 +11,7 @@ edition = &quot;2018&quot;
 [dependencies]
 core = { path = &quot;../core&quot; }
 compiler_builtins = { version = &quot;0.1.40&quot;, features = [&#39;rustc-dep-of-std&#39;] }
+tikv-jemalloc-sys = &quot;0.4.0&quot;

 [dev-dependencies]
 rand = &quot;0.7&quot;
diff --git a/library/alloc/src/raw_vec.rs b/library/alloc/src/raw_vec.rs
index 3d38e73305a..6aee2a5450a 100644
--- a/library/alloc/src/raw_vec.rs
+++ b/library/alloc/src/raw_vec.rs
@@ -468,6 +468,8 @@ fn finish_grow&lt;A&gt;(
         alloc.allocate(new_layout)
     };

+    tikv_jemalloc_sys::malloc_usable_size(memory.as_ptr());
+
     memory.map_err(|_| AllocError { layout: new_layout, non_exhaustive: () }.into())
 }
</code></pre></div>



<a name="265524357"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/219381-t-libs/topic/How%20does%20%60global_allocator%60%20work/near/265524357" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nnethercote <a href="https://zulip-archive.rust-lang.org/stream/219381-t-libs/topic/How.20does.20.60global_allocator.60.20work.html#265524357">(Dec 20 2021 at 06:07)</a>:</h4>
<p>I get this compile error:</p>
<div class="codehilite"><pre><span></span><code>Building stage0 std artifacts (x86_64-unknown-linux-gnu -&gt; x86_64-unknown-linux-gnu)
   Compiling core v0.0.0 (/home/njn/dev/rust3/library/core)
   Compiling rustc-std-workspace-core v1.99.0 (/home/njn/dev/rust3/library/rustc-std-workspace-core)
   Compiling compiler_builtins v0.1.66
   Compiling libc v0.2.108
   Compiling cfg-if v0.1.10
   Compiling memchr v2.4.1
   Compiling adler v0.2.3
   Compiling rustc-demangle v0.1.21
   Compiling tikv-jemalloc-sys v0.4.1+5.2.1-patched
error[E0463]: can&#39;t find crate for `core`
</code></pre></div>



<a name="265534806"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/219381-t-libs/topic/How%20does%20%60global_allocator%60%20work/near/265534806" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> bjorn3 <a href="https://zulip-archive.rust-lang.org/stream/219381-t-libs/topic/How.20does.20.60global_allocator.60.20work.html#265534806">(Dec 20 2021 at 08:42)</a>:</h4>
<p>You did have to add rustc-dep-of-std support to tikv-jemalloc-sys and then enable this feature when specifying the dependency. See for example <a href="https://github.com/gimli-rs/object/blob/e45a3d12d75b3eed99e7183d3035803bfdd15b0d/Cargo.toml#L93">https://github.com/gimli-rs/object/blob/e45a3d12d75b3eed99e7183d3035803bfdd15b0d/Cargo.toml#L93</a></p>



<a name="265618729"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/219381-t-libs/topic/How%20does%20%60global_allocator%60%20work/near/265618729" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nnethercote <a href="https://zulip-archive.rust-lang.org/stream/219381-t-libs/topic/How.20does.20.60global_allocator.60.20work.html#265618729">(Dec 20 2021 at 21:39)</a>:</h4>
<p>Thanks for the info! Right now I can't even get <code>tikv-jemallocator</code> and <code>tikv-jemalloc-sys</code> to work in a tiny test crate. Well, if I use the versions from <code>crates.io</code> it's ok, but if I try to use a local copy of the crates I get problems with the <code>build.rs</code>, it's failing to get the jemalloc source code somehow</p>



<a name="265618989"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/219381-t-libs/topic/How%20does%20%60global_allocator%60%20work/near/265618989" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nnethercote <a href="https://zulip-archive.rust-lang.org/stream/219381-t-libs/topic/How.20does.20.60global_allocator.60.20work.html#265618989">(Dec 20 2021 at 21:42)</a>:</h4>
<p>Even doing <code>cargo build</code> in a local clone of <code>tikv-jemallocator</code> fails in the same way, hmm</p>



<a name="265619022"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/219381-t-libs/topic/How%20does%20%60global_allocator%60%20work/near/265619022" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Eric Huss <a href="https://zulip-archive.rust-lang.org/stream/219381-t-libs/topic/How.20does.20.60global_allocator.60.20work.html#265619022">(Dec 20 2021 at 21:43)</a>:</h4>
<p><span class="user-mention" data-user-id="120989">@nnethercote</span> Have you initialized the git submodule?</p>



<a name="265619026"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/219381-t-libs/topic/How%20does%20%60global_allocator%60%20work/near/265619026" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nnethercote <a href="https://zulip-archive.rust-lang.org/stream/219381-t-libs/topic/How.20does.20.60global_allocator.60.20work.html#265619026">(Dec 20 2021 at 21:43)</a>:</h4>
<p>nope</p>



<a name="265619090"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/219381-t-libs/topic/How%20does%20%60global_allocator%60%20work/near/265619090" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nnethercote <a href="https://zulip-archive.rust-lang.org/stream/219381-t-libs/topic/How.20does.20.60global_allocator.60.20work.html#265619090">(Dec 20 2021 at 21:44)</a>:</h4>
<p>How/where do I do that? I haven't seen anything in the docs about it</p>



<a name="265619102"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/219381-t-libs/topic/How%20does%20%60global_allocator%60%20work/near/265619102" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Eric Huss <a href="https://zulip-archive.rust-lang.org/stream/219381-t-libs/topic/How.20does.20.60global_allocator.60.20work.html#265619102">(Dec 20 2021 at 21:44)</a>:</h4>
<p><code>git submodule init</code></p>



<a name="265619112"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/219381-t-libs/topic/How%20does%20%60global_allocator%60%20work/near/265619112" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Eric Huss <a href="https://zulip-archive.rust-lang.org/stream/219381-t-libs/topic/How.20does.20.60global_allocator.60.20work.html#265619112">(Dec 20 2021 at 21:44)</a>:</h4>
<p>submodules can be a pain</p>



<a name="265619172"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/219381-t-libs/topic/How%20does%20%60global_allocator%60%20work/near/265619172" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Eric Huss <a href="https://zulip-archive.rust-lang.org/stream/219381-t-libs/topic/How.20does.20.60global_allocator.60.20work.html#265619172">(Dec 20 2021 at 21:45)</a>:</h4>
<p>or <code>git submodule update --init</code> is probably better</p>



<a name="265619241"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/219381-t-libs/topic/How%20does%20%60global_allocator%60%20work/near/265619241" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nnethercote <a href="https://zulip-archive.rust-lang.org/stream/219381-t-libs/topic/How.20does.20.60global_allocator.60.20work.html#265619241">(Dec 20 2021 at 21:46)</a>:</h4>
<p>Aha, the latter does it, thank you!</p>



<a name="265619259"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/219381-t-libs/topic/How%20does%20%60global_allocator%60%20work/near/265619259" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nnethercote <a href="https://zulip-archive.rust-lang.org/stream/219381-t-libs/topic/How.20does.20.60global_allocator.60.20work.html#265619259">(Dec 20 2021 at 21:46)</a>:</h4>
<p>Curious, I've never come across that particular incantation before</p>



<a name="265619318"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/219381-t-libs/topic/How%20does%20%60global_allocator%60%20work/near/265619318" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nnethercote <a href="https://zulip-archive.rust-lang.org/stream/219381-t-libs/topic/How.20does.20.60global_allocator.60.20work.html#265619318">(Dec 20 2021 at 21:47)</a>:</h4>
<p>Seems surprising that the <a href="http://build.rs">build.rs</a> doesn't do that for me, or something</p>



<a name="265620984"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/219381-t-libs/topic/How%20does%20%60global_allocator%60%20work/near/265620984" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nnethercote <a href="https://zulip-archive.rust-lang.org/stream/219381-t-libs/topic/How.20does.20.60global_allocator.60.20work.html#265620984">(Dec 20 2021 at 22:05)</a>:</h4>
<p>The suggestion from @bjorn3 has got me pretty far, but now I'm getting a link error at the end of compiler compilation:</p>



<a name="265621011"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/219381-t-libs/topic/How%20does%20%60global_allocator%60%20work/near/265621011" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nnethercote <a href="https://zulip-archive.rust-lang.org/stream/219381-t-libs/topic/How.20does.20.60global_allocator.60.20work.html#265621011">(Dec 20 2021 at 22:05)</a>:</h4>
<div class="codehilite"><pre><span></span><code>ld.lld: error: /home/njn/dev/rust3/build/x86_64-unknown-linux-gnu/stage0-rustc/x86_64-unknown-linux-gnu/release/deps/librustc_driver-e375244a403fe1f2.so: undefined reference to _rjem_malloc_usable_size [--no-allow-shlib-undefined]
</code></pre></div>



<a name="265621328"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/219381-t-libs/topic/How%20does%20%60global_allocator%60%20work/near/265621328" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nnethercote <a href="https://zulip-archive.rust-lang.org/stream/219381-t-libs/topic/How.20does.20.60global_allocator.60.20work.html#265621328">(Dec 20 2021 at 22:08)</a>:</h4>
<p>/me fiddles with <code>compiler/rustc/src/main.rs</code></p>



<a name="265623621"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/219381-t-libs/topic/How%20does%20%60global_allocator%60%20work/near/265623621" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nnethercote <a href="https://zulip-archive.rust-lang.org/stream/219381-t-libs/topic/How.20does.20.60global_allocator.60.20work.html#265623621">(Dec 20 2021 at 22:31)</a>:</h4>
<p>Hmm, I can call <code>tikv_jemalloc_sys::malloc_usable_size</code> successfully in <code>compiler/rustc/src/main.rs</code>, but I get a link error if I put the same call into <code>library/alloc/src/raw_vec.rs</code></p>



<a name="265624267"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/219381-t-libs/topic/How%20does%20%60global_allocator%60%20work/near/265624267" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Triplett <a href="https://zulip-archive.rust-lang.org/stream/219381-t-libs/topic/How.20does.20.60global_allocator.60.20work.html#265624267">(Dec 20 2021 at 22:39)</a>:</h4>
<p><span class="user-mention silent" data-user-id="120989">nnethercote</span> <a href="#narrow/stream/219381-t-libs/topic/How.20does.20.60global_allocator.60.20work/near/265619318">said</a>:</p>
<blockquote>
<p>Seems surprising that the <a href="http://build.rs">build.rs</a> doesn't do that for me, or something</p>
</blockquote>
<p>I'm honestly thrilled when <code>build.rs</code> files <em>don't</em> do weird poking at git or submodules.</p>



<a name="265625003"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/219381-t-libs/topic/How%20does%20%60global_allocator%60%20work/near/265625003" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nnethercote <a href="https://zulip-archive.rust-lang.org/stream/219381-t-libs/topic/How.20does.20.60global_allocator.60.20work.html#265625003">(Dec 20 2021 at 22:48)</a>:</h4>
<p>Well, in this case it just means that <code>cargo build</code> fails unless you do <code>git submodule update --init</code> first, and this isn't documented. Doesn't seem good?</p>



<a name="265627571"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/219381-t-libs/topic/How%20does%20%60global_allocator%60%20work/near/265627571" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Triplett <a href="https://zulip-archive.rust-lang.org/stream/219381-t-libs/topic/How.20does.20.60global_allocator.60.20work.html#265627571">(Dec 20 2021 at 23:17)</a>:</h4>
<p>"and this isn't documented" is definitely not good.</p>



<a name="265627617"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/219381-t-libs/topic/How%20does%20%60global_allocator%60%20work/near/265627617" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Triplett <a href="https://zulip-archive.rust-lang.org/stream/219381-t-libs/topic/How.20does.20.60global_allocator.60.20work.html#265627617">(Dec 20 2021 at 23:18)</a>:</h4>
<p><code>cargo build</code> failing rather than touching the network seems very good. :)</p>



<a name="265627648"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/219381-t-libs/topic/How%20does%20%60global_allocator%60%20work/near/265627648" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Triplett <a href="https://zulip-archive.rust-lang.org/stream/219381-t-libs/topic/How.20does.20.60global_allocator.60.20work.html#265627648">(Dec 20 2021 at 23:18)</a>:</h4>
<p>I do, FWIW, think it's perfectly reasonable for <code>build.rs</code> to <em>check</em> if an expected file in the submodule exists and print a useful error message if not.</p>



<a name="265627671"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/219381-t-libs/topic/How%20does%20%60global_allocator%60%20work/near/265627671" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Triplett <a href="https://zulip-archive.rust-lang.org/stream/219381-t-libs/topic/How.20does.20.60global_allocator.60.20work.html#265627671">(Dec 20 2021 at 23:19)</a>:</h4>
<p>We could also make that declarative, with something in <code>Cargo.toml</code> saying "if this file doesn't exist, assume the crate has a problem and can't build".</p>



<hr><p>Last updated: Apr 12 2022 at 20:01 UTC</p>
</html>