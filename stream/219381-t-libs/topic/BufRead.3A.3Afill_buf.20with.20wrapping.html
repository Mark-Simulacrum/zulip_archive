<html>
<head><meta charset="utf-8"><title>BufRead::fill_buf with wrapping · t-libs · Zulip Chat Archive</title></head>
<h2>Stream: <a href="https://zulip-archive.rust-lang.org/stream/219381-t-libs/index.html">t-libs</a></h2>
<h3>Topic: <a href="https://zulip-archive.rust-lang.org/stream/219381-t-libs/topic/BufRead.3A.3Afill_buf.20with.20wrapping.html">BufRead::fill_buf with wrapping</a></h3>

<hr>

<base href="https://rust-lang.zulipchat.com">

<head><link href="https://zulip-archive.rust-lang.org/style.css" rel="stylesheet"></head>

<a name="264923928"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/219381-t-libs/topic/BufRead%3A%3Afill_buf%20with%20wrapping/near/264923928" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Kamil Becmer <a href="https://zulip-archive.rust-lang.org/stream/219381-t-libs/topic/BufRead.3A.3Afill_buf.20with.20wrapping.html#264923928">(Dec 14 2021 at 20:54)</a>:</h4>
<p>Hi, Rust Team.<br>
I'm new here, trying to figure out the right way to implement a std lib feature I've developed.<br>
The Guide leads me here. Perhaps I could move further, but still not sure about some details.</p>
<p>So, the feature is a variation on the <code>BufRead::fill_buf</code> method. I would like to implement a new<br>
method:</p>
<p><code>BufRead::fill_buf_wrapping(&amp;mut self, at_least: usize) -&gt; Result&lt;&amp;[u8]&gt;</code></p>
<p>If there's less than <code>at_least</code> bytes left then it moves remaining bytes to the beginning of the<br>
buffer and fills buffer further. When <code>at_least == 0</code> it behaves exactly the same as <code>fill_buf</code>.</p>
<p>This is a simple fix which allows to take advantage of existing buffer to process/parse input data<br>
with push-back-like functionality if decided to not consume any bytes. End-user solution based on<br>
read_exact method (and friends) doesn't has push-back functionality or has to handle intermediate<br>
buffer.</p>
<p>Does that sound good?<br>
Any suggestions for better method name?<br>
Should I proceed by creating a new RFC?</p>



<a name="264925369"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/219381-t-libs/topic/BufRead%3A%3Afill_buf%20with%20wrapping/near/264925369" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Kamil Becmer <a href="https://zulip-archive.rust-lang.org/stream/219381-t-libs/topic/BufRead.3A.3Afill_buf.20with.20wrapping.html#264925369">(Dec 14 2021 at 21:06)</a>:</h4>
<p>Does <code>BufRead</code> can be extended like that in terms of non-std libraries compatibility?  There's no good default implementation without access to internals.</p>



<a name="264927871"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/219381-t-libs/topic/BufRead%3A%3Afill_buf%20with%20wrapping/near/264927871" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> The 8472 <a href="https://zulip-archive.rust-lang.org/stream/219381-t-libs/topic/BufRead.3A.3Afill_buf.20with.20wrapping.html#264927871">(Dec 14 2021 at 21:27)</a>:</h4>
<p><code>BufRead</code> is a stable, non-sealed trait so anyone can implement it. So if there's no good default implementation it probably shouldn't be added.<br>
<code>BufReader</code> could be extended that way.</p>



<a name="264929201"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/219381-t-libs/topic/BufRead%3A%3Afill_buf%20with%20wrapping/near/264929201" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Kamil Becmer <a href="https://zulip-archive.rust-lang.org/stream/219381-t-libs/topic/BufRead.3A.3Afill_buf.20with.20wrapping.html#264929201">(Dec 14 2021 at 21:37)</a>:</h4>
<p>That's a good hint, thanks!</p>



<hr><p>Last updated: Apr 12 2022 at 20:01 UTC</p>
</html>