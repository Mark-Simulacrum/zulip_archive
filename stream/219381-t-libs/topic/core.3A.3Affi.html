<html>
<head><meta charset="utf-8"><title>core::ffi · t-libs · Zulip Chat Archive</title></head>
<h2>Stream: <a href="https://zulip-archive.rust-lang.org/stream/219381-t-libs/index.html">t-libs</a></h2>
<h3>Topic: <a href="https://zulip-archive.rust-lang.org/stream/219381-t-libs/topic/core.3A.3Affi.html">core::ffi</a></h3>

<hr>

<base href="https://rust-lang.zulipchat.com">

<head><link href="https://zulip-archive.rust-lang.org/style.css" rel="stylesheet"></head>

<a name="273728350"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/219381-t-libs/topic/core%3A%3Affi/near/273728350" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Triplett <a href="https://zulip-archive.rust-lang.org/stream/219381-t-libs/topic/core.3A.3Affi.html#273728350">(Mar 01 2022 at 23:32)</a>:</h4>
<p><span class="user-mention" data-user-id="143274">@Amanieu</span> Moving to a separate thread to discuss <a href="https://github.com/rust-lang/rust/pull/94503">https://github.com/rust-lang/rust/pull/94503</a> .</p>



<a name="273728839"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/219381-t-libs/topic/core%3A%3Affi/near/273728839" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Triplett <a href="https://zulip-archive.rust-lang.org/stream/219381-t-libs/topic/core.3A.3Affi.html#273728839">(Mar 01 2022 at 23:37)</a>:</h4>
<p>Considering possible solutions to the <code>cfg_if</code> issue.</p>



<a name="273728932"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/219381-t-libs/topic/core%3A%3Affi/near/273728932" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Triplett <a href="https://zulip-archive.rust-lang.org/stream/219381-t-libs/topic/core.3A.3Affi.html#273728932">(Mar 01 2022 at 23:38)</a>:</h4>
<p><span class="user-mention" data-user-id="143274">@Amanieu</span> Does it seem reasonable to you to just have a private <code>cfg_if</code> in <code>core</code>, for the moment? (We could, in the future, consider exporting that, but I'm trying to do only one thing here.)</p>



<a name="273728999"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/219381-t-libs/topic/core%3A%3Affi/near/273728999" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Amanieu <a href="https://zulip-archive.rust-lang.org/stream/219381-t-libs/topic/core.3A.3Affi.html#273728999">(Mar 01 2022 at 23:38)</a>:</h4>
<p>Yes, that sounds like a good idea.</p>



<a name="273729425"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/219381-t-libs/topic/core%3A%3Affi/near/273729425" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Triplett <a href="https://zulip-archive.rust-lang.org/stream/219381-t-libs/topic/core.3A.3Affi.html#273729425">(Mar 01 2022 at 23:42)</a>:</h4>
<p>Do you have any ideas for handling the docs? I have no <em>objections</em> to including the same docs in both places, but I really don't want to write an include for a path like <code>../../../../core/src/ffi/xyz.md</code>.</p>



<a name="273729443"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/219381-t-libs/topic/core%3A%3Affi/near/273729443" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Triplett <a href="https://zulip-archive.rust-lang.org/stream/219381-t-libs/topic/core.3A.3Affi.html#273729443">(Mar 01 2022 at 23:42)</a>:</h4>
<p>A re-export would have the same docs, but then this would have to be insta-stable AFAICT.</p>



<a name="273730722"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/219381-t-libs/topic/core%3A%3Affi/near/273730722" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Amanieu <a href="https://zulip-archive.rust-lang.org/stream/219381-t-libs/topic/core.3A.3Affi.html#273730722">(Mar 01 2022 at 23:54)</a>:</h4>
<p>I think you can use <code>concat!</code> and <code>stringify!</code> in the macro so you only have to write the full path once.</p>



<a name="273730791"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/219381-t-libs/topic/core%3A%3Affi/near/273730791" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Triplett <a href="https://zulip-archive.rust-lang.org/stream/219381-t-libs/topic/core.3A.3Affi.html#273730791">(Mar 01 2022 at 23:55)</a>:</h4>
<p>That's once more than I'd like to write it. :)</p>



<a name="273730812"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/219381-t-libs/topic/core%3A%3Affi/near/273730812" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Triplett <a href="https://zulip-archive.rust-lang.org/stream/219381-t-libs/topic/core.3A.3Affi.html#273730812">(Mar 01 2022 at 23:55)</a>:</h4>
<p>A long relative path like that that feels fragile.</p>



<a name="273730938"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/219381-t-libs/topic/core%3A%3Affi/near/273730938" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Amanieu <a href="https://zulip-archive.rust-lang.org/stream/219381-t-libs/topic/core.3A.3Affi.html#273730938">(Mar 01 2022 at 23:57)</a>:</h4>
<p>Not really? You'd just get a compile-time error if the path is no longer valid.</p>



<a name="273730964"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/219381-t-libs/topic/core%3A%3Affi/near/273730964" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Amanieu <a href="https://zulip-archive.rust-lang.org/stream/219381-t-libs/topic/core.3A.3Affi.html#273730964">(Mar 01 2022 at 23:57)</a>:</h4>
<p>Relative paths are used all the time in the library docs to refer to things in std/core.</p>



<a name="273730985"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/219381-t-libs/topic/core%3A%3Affi/near/273730985" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Triplett <a href="https://zulip-archive.rust-lang.org/stream/219381-t-libs/topic/core.3A.3Affi.html#273730985">(Mar 01 2022 at 23:58)</a>:</h4>
<p>Yeah, I didn't realize how often they were used.</p>



<a name="273731069"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/219381-t-libs/topic/core%3A%3Affi/near/273731069" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Amanieu <a href="https://zulip-archive.rust-lang.org/stream/219381-t-libs/topic/core.3A.3Affi.html#273731069">(Mar 01 2022 at 23:58)</a>:</h4>
<p>In any case, I think making the user-visible docs clearer is worth a bit of ugliness on the code side.</p>



<a name="273731074"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/219381-t-libs/topic/core%3A%3Affi/near/273731074" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Triplett <a href="https://zulip-archive.rust-lang.org/stream/219381-t-libs/topic/core.3A.3Affi.html#273731074">(Mar 01 2022 at 23:58)</a>:</h4>
<p>I was kinda hoping that a link to the docs (which rustdoc can do automatically by writing <code>[`core::ffi::c_xyz`]</code> would suffice. But if you'd very much prefer the docs to be inlined rather than linked, I can do that...</p>



<a name="273732288"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/219381-t-libs/topic/core%3A%3Affi/near/273732288" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Triplett <a href="https://zulip-archive.rust-lang.org/stream/219381-t-libs/topic/core.3A.3Affi.html#273732288">(Mar 02 2022 at 00:09)</a>:</h4>
<p>Done; let's see if this passes CI.</p>



<a name="273733360"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/219381-t-libs/topic/core%3A%3Affi/near/273733360" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Thom Chiovoloni <a href="https://zulip-archive.rust-lang.org/stream/219381-t-libs/topic/core.3A.3Affi.html#273733360">(Mar 02 2022 at 00:21)</a>:</h4>
<p>(off topic, but oh this PR is great, thanks so much)</p>



<a name="273734350"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/219381-t-libs/topic/core%3A%3Affi/near/273734350" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Amanieu <a href="https://zulip-archive.rust-lang.org/stream/219381-t-libs/topic/core.3A.3Affi.html#273734350">(Mar 02 2022 at 00:31)</a>:</h4>
<p><span class="user-mention" data-user-id="239881">@Josh Triplett</span> I presume it's intentional that the unstable <code>size_t</code> and <code>NonZero</code> type aliases are no longer available in std::os::raw?</p>



<a name="273734412"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/219381-t-libs/topic/core%3A%3Affi/near/273734412" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Amanieu <a href="https://zulip-archive.rust-lang.org/stream/219381-t-libs/topic/core.3A.3Affi.html#273734412">(Mar 02 2022 at 00:32)</a>:</h4>
<p>(Not that I object, just checking in case you missed them by accident)</p>



<a name="273734832"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/219381-t-libs/topic/core%3A%3Affi/near/273734832" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Triplett <a href="https://zulip-archive.rust-lang.org/stream/219381-t-libs/topic/core.3A.3Affi.html#273734832">(Mar 02 2022 at 00:36)</a>:</h4>
<p><span class="user-mention silent" data-user-id="143274">Amanieu</span> <a href="#narrow/stream/219381-t-libs/topic/core.3A.3Affi/near/273734350">said</a>:</p>
<blockquote>
<p><span class="user-mention silent" data-user-id="239881">Josh Triplett</span> I presume it's intentional that the unstable <code>size_t</code> and <code>NonZero</code> type aliases are no longer available in std::os::raw?</p>
</blockquote>
<p>Quite intentional. They were unstable, so we don't need a compatibility alias.</p>



<a name="273741184"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/219381-t-libs/topic/core%3A%3Affi/near/273741184" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> bstrie <a href="https://zulip-archive.rust-lang.org/stream/219381-t-libs/topic/core.3A.3Affi.html#273741184">(Mar 02 2022 at 01:52)</a>:</h4>
<p>is the goal here to eventually do the same as was done for c_void and make libc re-export all of these?</p>



<a name="273741764"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/219381-t-libs/topic/core%3A%3Affi/near/273741764" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Triplett <a href="https://zulip-archive.rust-lang.org/stream/219381-t-libs/topic/core.3A.3Affi.html#273741764">(Mar 02 2022 at 02:00)</a>:</h4>
<p><span class="user-mention" data-user-id="256342">@bstrie</span> I don't think that's at all urgent, since unlike <code>c_void</code>, these are type aliases and any user of one of them is compatible with any user of another of them.</p>



<a name="273741942"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/219381-t-libs/topic/core%3A%3Affi/near/273741942" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Triplett <a href="https://zulip-archive.rust-lang.org/stream/219381-t-libs/topic/core.3A.3Affi.html#273741942">(Mar 02 2022 at 02:00)</a>:</h4>
<p>I think it'd be perfectly reasonable for libc to use these, in the future if libc moves to a newer MSRV.</p>



<a name="273745627"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/219381-t-libs/topic/core%3A%3Affi/near/273745627" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> bstrie <a href="https://zulip-archive.rust-lang.org/stream/219381-t-libs/topic/core.3A.3Affi.html#273745627">(Mar 02 2022 at 02:40)</a>:</h4>
<p>Ah, good point. And yes, I'm not saying that needs to be done any time soon, I'm just continuing to wonder whether or not we'll reach a state where a libc crate <em>without</em> platform-specific items even needs to exist</p>



<a name="273745771"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/219381-t-libs/topic/core%3A%3Affi/near/273745771" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> bstrie <a href="https://zulip-archive.rust-lang.org/stream/219381-t-libs/topic/core.3A.3Affi.html#273745771">(Mar 02 2022 at 02:42)</a>:</h4>
<p>IOW, if we could reach a state where users make use of core::ffi and a hypothetical libc-fooplatform crate, and the original libc crate itself can be deprecated</p>



<a name="273746132"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/219381-t-libs/topic/core%3A%3Affi/near/273746132" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Connor Horman <a href="https://zulip-archive.rust-lang.org/stream/219381-t-libs/topic/core.3A.3Affi.html#273746132">(Mar 02 2022 at 02:48)</a>:</h4>
<p><span class="user-mention silent" data-user-id="256342">bstrie</span> <a href="#narrow/stream/219381-t-libs/topic/core.3A.3Affi/near/273745627">said</a>:</p>
<blockquote>
<p>Ah, good point. And yes, I'm not saying that needs to be done any time soon, I'm just continuing to wonder whether or not we'll reach a state where a libc crate <em>without</em> platform-specific items even needs to exist</p>
</blockquote>
<p>I'd love to see this as well, if only to prevent the platforms supported by libc from being hardcoded.</p>



<a name="273767091"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/219381-t-libs/topic/core%3A%3Affi/near/273767091" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> bjorn3 <a href="https://zulip-archive.rust-lang.org/stream/219381-t-libs/topic/core.3A.3Affi.html#273767091">(Mar 02 2022 at 07:43)</a>:</h4>
<p>There should at least be a crate with all common functions on unix. Otherwise all users of libc would have to hard code every unix system instead of using cfg(unix).</p>



<a name="273856189"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/219381-t-libs/topic/core%3A%3Affi/near/273856189" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> bstrie <a href="https://zulip-archive.rust-lang.org/stream/219381-t-libs/topic/core.3A.3Affi.html#273856189">(Mar 02 2022 at 18:40)</a>:</h4>
<p><span class="user-mention" data-user-id="239881">@Josh Triplett</span> was it deliberate that you didn't re-export these from std::ffi? I can whip up a quick patch to fix that if you like</p>



<a name="273856676"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/219381-t-libs/topic/core%3A%3Affi/near/273856676" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Triplett <a href="https://zulip-archive.rust-lang.org/stream/219381-t-libs/topic/core.3A.3Affi.html#273856676">(Mar 02 2022 at 18:43)</a>:</h4>
<p>I hadn't thought about re-exporting, since I was assuming people would just use them via <code>core::ffi</code>, but I suppose in practice we re-export everything in core from std...</p>



<a name="273856774"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/219381-t-libs/topic/core%3A%3Affi/near/273856774" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> bstrie <a href="https://zulip-archive.rust-lang.org/stream/219381-t-libs/topic/core.3A.3Affi.html#273856774">(Mar 02 2022 at 18:44)</a>:</h4>
<p>right, it just seems asymmetric :P</p>



<a name="273856792"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/219381-t-libs/topic/core%3A%3Affi/near/273856792" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Triplett <a href="https://zulip-archive.rust-lang.org/stream/219381-t-libs/topic/core.3A.3Affi.html#273856792">(Mar 02 2022 at 18:44)</a>:</h4>
<p>So I guess we should re-export these. Feel free to add a patch re-exporting them; it can just do the obvious trivial re-export (<code>pub use</code>) since they should be unstable.</p>



<a name="273870254"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/219381-t-libs/topic/core%3A%3Affi/near/273870254" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> bstrie <a href="https://zulip-archive.rust-lang.org/stream/219381-t-libs/topic/core.3A.3Affi.html#273870254">(Mar 02 2022 at 20:17)</a>:</h4>
<p><a href="https://github.com/rust-lang/rust/pull/94534">https://github.com/rust-lang/rust/pull/94534</a></p>



<hr><p>Last updated: Apr 12 2022 at 20:01 UTC</p>
</html>