<html>
<head><meta charset="utf-8"><title>&amp;self for Self: Copy · t-libs · Zulip Chat Archive</title></head>
<h2>Stream: <a href="https://zulip-archive.rust-lang.org/stream/219381-t-libs/index.html">t-libs</a></h2>
<h3>Topic: <a href="https://zulip-archive.rust-lang.org/stream/219381-t-libs/topic/.26self.20for.20Self.3A.20Copy.html">&amp;self for Self: Copy</a></h3>

<hr>

<base href="https://rust-lang.zulipchat.com">

<head><link href="https://zulip-archive.rust-lang.org/style.css" rel="stylesheet"></head>

<a name="271652301"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/219381-t-libs/topic/%26self%20for%20Self%3A%20Copy/near/271652301" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> simulacrum <a href="https://zulip-archive.rust-lang.org/stream/219381-t-libs/topic/.26self.20for.20Self.3A.20Copy.html#271652301">(Feb 11 2022 at 23:24)</a>:</h4>
<p>Reviewing <a href="https://github.com/rust-lang/rust/issues/93886">#93886</a>, I noted that it is stabilizing a method which has <code>&amp;self</code> where <code>Self</code> is <code>u8</code>, which seems unnecessary. Do we have any general sense/policy on avoiding this kind of thing in method signatures?</p>



<a name="271670383"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/219381-t-libs/topic/%26self%20for%20Self%3A%20Copy/near/271670383" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jacob Pratt <a href="https://zulip-archive.rust-lang.org/stream/219381-t-libs/topic/.26self.20for.20Self.3A.20Copy.html#271670383">(Feb 12 2022 at 05:11)</a>:</h4>
<p>Imo there's no reason <em>not</em> to take it by value</p>



<a name="271685888"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/219381-t-libs/topic/%26self%20for%20Self%3A%20Copy/near/271685888" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Mara <a href="https://zulip-archive.rust-lang.org/stream/219381-t-libs/topic/.26self.20for.20Self.3A.20Copy.html#271685888">(Feb 12 2022 at 12:08)</a>:</h4>
<p>The tracking issue has <code>self</code> not <code>&amp;self</code>as the signature: <a href="https://github.com/rust-lang/rust/issues/77174">#77174</a></p>



<a name="271685891"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/219381-t-libs/topic/%26self%20for%20Self%3A%20Copy/near/271685891" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Mara <a href="https://zulip-archive.rust-lang.org/stream/219381-t-libs/topic/.26self.20for.20Self.3A.20Copy.html#271685891">(Feb 12 2022 at 12:08)</a>:</h4>
<p><span class="user-mention" data-user-id="116122">@simulacrum</span>  The was some discussion about it here: <a href="https://github.com/rust-lang/rust/pull/73111#discussion_r475587995">https://github.com/rust-lang/rust/pull/73111#discussion_r475587995</a></p>



<a name="271686334"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/219381-t-libs/topic/%26self%20for%20Self%3A%20Copy/near/271686334" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> simulacrum <a href="https://zulip-archive.rust-lang.org/stream/219381-t-libs/topic/.26self.20for.20Self.3A.20Copy.html#271686334">(Feb 12 2022 at 12:21)</a>:</h4>
<p>Hm</p>



<a name="271686399"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/219381-t-libs/topic/%26self%20for%20Self%3A%20Copy/near/271686399" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> simulacrum <a href="https://zulip-archive.rust-lang.org/stream/219381-t-libs/topic/.26self.20for.20Self.3A.20Copy.html#271686399">(Feb 12 2022 at 12:22)</a>:</h4>
<p>I guess your comment there was missed before merging?</p>



<a name="271686499"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/219381-t-libs/topic/%26self%20for%20Self%3A%20Copy/near/271686499" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> simulacrum <a href="https://zulip-archive.rust-lang.org/stream/219381-t-libs/topic/.26self.20for.20Self.3A.20Copy.html#271686499">(Feb 12 2022 at 12:25)</a>:</h4>
<p>I'll comment later about dropping the reference, I don't think consistency is worth it.</p>



<a name="272110003"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/219381-t-libs/topic/%26self%20for%20Self%3A%20Copy/near/272110003" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Simon Sapin <a href="https://zulip-archive.rust-lang.org/stream/219381-t-libs/topic/.26self.20for.20Self.3A.20Copy.html#272110003">(Feb 16 2022 at 12:39)</a>:</h4>
<p>Some <code>u8</code> methods take <code>&amp;self</code> because they used to be on a trait: <a href="https://doc.rust-lang.org/std/ascii/trait.AsciiExt.html">https://doc.rust-lang.org/std/ascii/trait.AsciiExt.html</a></p>



<a name="272110052"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/219381-t-libs/topic/%26self%20for%20Self%3A%20Copy/near/272110052" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Simon Sapin <a href="https://zulip-archive.rust-lang.org/stream/219381-t-libs/topic/.26self.20for.20Self.3A.20Copy.html#272110052">(Feb 16 2022 at 12:39)</a>:</h4>
<p>(Which is also implemented for <code>str</code> and <code>[u8]</code>)</p>



<a name="272110126"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/219381-t-libs/topic/%26self%20for%20Self%3A%20Copy/near/272110126" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Simon Sapin <a href="https://zulip-archive.rust-lang.org/stream/219381-t-libs/topic/.26self.20for.20Self.3A.20Copy.html#272110126">(Feb 16 2022 at 12:40)</a>:</h4>
<p>For new inherent methods I don’t think there’s any point in doing the same</p>



<a name="272111449"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/219381-t-libs/topic/%26self%20for%20Self%3A%20Copy/near/272111449" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Connor Horman <a href="https://zulip-archive.rust-lang.org/stream/219381-t-libs/topic/.26self.20for.20Self.3A.20Copy.html#272111449">(Feb 16 2022 at 12:53)</a>:</h4>
<p>There's also a clippy lint for this, though it's dubious, since its suggestion is non-portable in usefulness (it lints up to pointer size for Copy types, but the pointer size isn't fixed). u8 is probably safe, though.</p>



<a name="272118870"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/219381-t-libs/topic/%26self%20for%20Self%3A%20Copy/near/272118870" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Lokathor <a href="https://zulip-archive.rust-lang.org/stream/219381-t-libs/topic/.26self.20for.20Self.3A.20Copy.html#272118870">(Feb 16 2022 at 14:00)</a>:</h4>
<p>just using pointer size is probably the wrong metric. the "good" calculation would have to be based on the ABI and what other registers are already used and stuff, right?</p>



<a name="272119007"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/219381-t-libs/topic/%26self%20for%20Self%3A%20Copy/near/272119007" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Connor Horman <a href="https://zulip-archive.rust-lang.org/stream/219381-t-libs/topic/.26self.20for.20Self.3A.20Copy.html#272119007">(Feb 16 2022 at 14:01)</a>:</h4>
<p>That's even worse for portability, though.</p>



<a name="272126322"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/219381-t-libs/topic/%26self%20for%20Self%3A%20Copy/near/272126322" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Johannes Dahlström <a href="https://zulip-archive.rust-lang.org/stream/219381-t-libs/topic/.26self.20for.20Self.3A.20Copy.html#272126322">(Feb 16 2022 at 14:56)</a>:</h4>
<p>One reason why consistency is quite important here even though it doesn't matter at the call site: function ptr coercion. It's an annoying papercut if I can pass <code>T::method1</code> to eg <code>Iterator::map</code>, but <code>T::method2</code> instead requires eta expansion to <code>|x| x.method2()</code> due to different <code>self</code> types.</p>



<a name="272126733"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/219381-t-libs/topic/%26self%20for%20Self%3A%20Copy/near/272126733" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> simulacrum <a href="https://zulip-archive.rust-lang.org/stream/219381-t-libs/topic/.26self.20for.20Self.3A.20Copy.html#272126733">(Feb 16 2022 at 14:59)</a>:</h4>
<p>I think in either direction that problem feels pretty similar to some of the copy ergonomics issues discussed in <a href="https://lang-team.rust-lang.org/design_notes/copy_ergonomics.html#references-to-copy-types">https://lang-team.rust-lang.org/design_notes/copy_ergonomics.html#references-to-copy-types</a></p>
<p>Would you maybe want to add a paragraph to that design note about this case? It seems plausible the compiler could permit coercing either way, generating a small shim if necessary</p>



<a name="272127873"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/219381-t-libs/topic/%26self%20for%20Self%3A%20Copy/near/272127873" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Simon Sapin <a href="https://zulip-archive.rust-lang.org/stream/219381-t-libs/topic/.26self.20for.20Self.3A.20Copy.html#272127873">(Feb 16 2022 at 15:08)</a>:</h4>
<p>Re passing a function rather than a closure to <code>Iterator::map</code>: there is no single right answer here, depending on whether the iterator has <code>Item=T</code> or <code>Item=&amp;T</code></p>



<a name="272133696"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/219381-t-libs/topic/%26self%20for%20Self%3A%20Copy/near/272133696" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Johannes Dahlström <a href="https://zulip-archive.rust-lang.org/stream/219381-t-libs/topic/.26self.20for.20Self.3A.20Copy.html#272133696">(Feb 16 2022 at 15:50)</a>:</h4>
<p><span class="user-mention" data-user-id="219747">@Simon Sapin</span> Yeah, but I mean that consistently requiring a closure wrapper (or <code>.copied()</code>etc if applicable) is still better than one method needing a wrapper and another of the same type not needing one.</p>



<a name="272141468"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/219381-t-libs/topic/%26self%20for%20Self%3A%20Copy/near/272141468" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Lokathor <a href="https://zulip-archive.rust-lang.org/stream/219381-t-libs/topic/.26self.20for.20Self.3A.20Copy.html#272141468">(Feb 16 2022 at 16:41)</a>:</h4>
<blockquote>
<p>That's even worse for portability, though.</p>
</blockquote>
<p>Yeah. It is.</p>



<a name="272154957"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/219381-t-libs/topic/%26self%20for%20Self%3A%20Copy/near/272154957" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> scottmcm <a href="https://zulip-archive.rust-lang.org/stream/219381-t-libs/topic/.26self.20for.20Self.3A.20Copy.html#272154957">(Feb 16 2022 at 18:07)</a>:</h4>
<p><span class="user-mention silent" data-user-id="219747">Simon Sapin</span> <a href="#narrow/stream/219381-t-libs/topic/.26self.20for.20Self.3A.20Copy/near/272127873">said</a>:</p>
<blockquote>
<p>Re passing a function rather than a closure to <code>Iterator::map</code>: there is no single right answer here, depending on whether the iterator has <code>Item=T</code> or <code>Item=&amp;T</code></p>
</blockquote>
<p>Hmm, I think that suggests that having it on <code>u8</code> is minutely better, since there's <code>.copied()</code> but not <code>.make_a_reference_somehow()</code>.</p>



<hr><p>Last updated: Apr 12 2022 at 20:01 UTC</p>
</html>