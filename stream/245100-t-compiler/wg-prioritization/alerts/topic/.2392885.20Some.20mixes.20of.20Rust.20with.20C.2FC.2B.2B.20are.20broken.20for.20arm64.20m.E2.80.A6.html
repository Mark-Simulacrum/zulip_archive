<html>
<head><meta charset="utf-8"><title>#92885 Some mixes of Rust with C/C++ are broken for arm64 m… · t-compiler/wg-prioritization/alerts · Zulip Chat Archive</title></head>
<h2>Stream: <a href="https://zulip-archive.rust-lang.org/stream/245100-t-compiler/wg-prioritization/alerts/index.html">t-compiler/wg-prioritization/alerts</a></h2>
<h3>Topic: <a href="https://zulip-archive.rust-lang.org/stream/245100-t-compiler/wg-prioritization/alerts/topic/.2392885.20Some.20mixes.20of.20Rust.20with.20C.2FC.2B.2B.20are.20broken.20for.20arm64.20m.E2.80.A6.html">#92885 Some mixes of Rust with C/C++ are broken for arm64 m…</a></h3>

<hr>

<base href="https://rust-lang.zulipchat.com">

<head><link href="https://zulip-archive.rust-lang.org/style.css" rel="stylesheet"></head>

<a name="267979599"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/245100-t-compiler/wg-prioritization/alerts/topic/%2392885%20Some%20mixes%20of%20Rust%20with%20C/C%2B%2B%20are%20broken%20for%20arm64%20m%E2%80%A6/near/267979599" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> triagebot <a href="https://zulip-archive.rust-lang.org/stream/245100-t-compiler/wg-prioritization/alerts/topic/.2392885.20Some.20mixes.20of.20Rust.20with.20C.2FC.2B.2B.20are.20broken.20for.20arm64.20m.E2.80.A6.html#267979599">(Jan 14 2022 at 07:28)</a>:</h4>
<p><span class="user-group-mention" data-user-group-id="3111">@WG-prioritization/alerts</span> issue <a href="https://github.com/rust-lang/rust/issues/92885">#92885</a> has been requested for prioritization.</p>
<h1><a href="https://forge.rust-lang.org/compiler/prioritization/procedure.html#assign-priority-to-unprioritized-issues-with-i-prioritize-label">Procedure</a></h1>
<ul>
<li>Priority?</li>
<li>Regression?</li>
<li>Notify people/groups?</li>
<li>Needs <code>I-nominated</code>?</li>
</ul>



<a name="268808811"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/245100-t-compiler/wg-prioritization/alerts/topic/%2392885%20Some%20mixes%20of%20Rust%20with%20C/C%2B%2B%20are%20broken%20for%20arm64%20m%E2%80%A6/near/268808811" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> inquisitivecrystal <a href="https://zulip-archive.rust-lang.org/stream/245100-t-compiler/wg-prioritization/alerts/topic/.2392885.20Some.20mixes.20of.20Rust.20with.20C.2FC.2B.2B.20are.20broken.20for.20arm64.20m.E2.80.A6.html#268808811">(Jan 21 2022 at 08:30)</a>:</h4>
<p>Significant failure, tier-2 target.</p>



<a name="268936856"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/245100-t-compiler/wg-prioritization/alerts/topic/%2392885%20Some%20mixes%20of%20Rust%20with%20C/C%2B%2B%20are%20broken%20for%20arm64%20m%E2%80%A6/near/268936856" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Gary Guo <a href="https://zulip-archive.rust-lang.org/stream/245100-t-compiler/wg-prioritization/alerts/topic/.2392885.20Some.20mixes.20of.20Rust.20with.20C.2FC.2B.2B.20are.20broken.20for.20arm64.20m.E2.80.A6.html#268936856">(Jan 22 2022 at 04:45)</a>:</h4>
<p>P-high?</p>



<a name="268940219"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/245100-t-compiler/wg-prioritization/alerts/topic/%2392885%20Some%20mixes%20of%20Rust%20with%20C/C%2B%2B%20are%20broken%20for%20arm64%20m%E2%80%A6/near/268940219" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> inquisitivecrystal <a href="https://zulip-archive.rust-lang.org/stream/245100-t-compiler/wg-prioritization/alerts/topic/.2392885.20Some.20mixes.20of.20Rust.20with.20C.2FC.2B.2B.20are.20broken.20for.20arm64.20m.E2.80.A6.html#268940219">(Jan 22 2022 at 06:09)</a>:</h4>
<p>That sounds right!</p>



<a name="268954267"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/245100-t-compiler/wg-prioritization/alerts/topic/%2392885%20Some%20mixes%20of%20Rust%20with%20C/C%2B%2B%20are%20broken%20for%20arm64%20m%E2%80%A6/near/268954267" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> triagebot <a href="https://zulip-archive.rust-lang.org/stream/245100-t-compiler/wg-prioritization/alerts/topic/.2392885.20Some.20mixes.20of.20Rust.20with.20C.2FC.2B.2B.20are.20broken.20for.20arm64.20m.E2.80.A6.html#268954267">(Jan 22 2022 at 12:00)</a>:</h4>
<p>Issue <a href="https://github.com/rust-lang/rust/issues/92885">#92885</a>'s prioritization request has been removed.</p>



<a name="269078205"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/245100-t-compiler/wg-prioritization/alerts/topic/%2392885%20Some%20mixes%20of%20Rust%20with%20C/C%2B%2B%20are%20broken%20for%20arm64%20m%E2%80%A6/near/269078205" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jacob Bramley <a href="https://zulip-archive.rust-lang.org/stream/245100-t-compiler/wg-prioritization/alerts/topic/.2392885.20Some.20mixes.20of.20Rust.20with.20C.2FC.2B.2B.20are.20broken.20for.20arm64.20m.E2.80.A6.html#269078205">(Jan 24 2022 at 09:24)</a>:</h4>
<p>This actually affects Linux too (tier-1) but only with LTO. Does that change anything?</p>



<a name="269852319"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/245100-t-compiler/wg-prioritization/alerts/topic/%2392885%20Some%20mixes%20of%20Rust%20with%20C/C%2B%2B%20are%20broken%20for%20arm64%20m%E2%80%A6/near/269852319" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> inquisitivecrystal <a href="https://zulip-archive.rust-lang.org/stream/245100-t-compiler/wg-prioritization/alerts/topic/.2392885.20Some.20mixes.20of.20Rust.20with.20C.2FC.2B.2B.20are.20broken.20for.20arm64.20m.E2.80.A6.html#269852319">(Jan 29 2022 at 09:34)</a>:</h4>
<p>I'm not sure. Y'all, should we be increasing this to <code>P-critical</code> or leaving it at <code>P-high</code>?</p>



<a name="270228026"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/245100-t-compiler/wg-prioritization/alerts/topic/%2392885%20Some%20mixes%20of%20Rust%20with%20C/C%2B%2B%20are%20broken%20for%20arm64%20m%E2%80%A6/near/270228026" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> apiraino <a href="https://zulip-archive.rust-lang.org/stream/245100-t-compiler/wg-prioritization/alerts/topic/.2392885.20Some.20mixes.20of.20Rust.20with.20C.2FC.2B.2B.20are.20broken.20for.20arm64.20m.E2.80.A6.html#270228026">(Feb 01 2022 at 15:20)</a>:</h4>
<p>uhm ... so the "fix" is now in <a href="https://github.com/rust-lang/rust/issues/93523">#93523</a> that will land directly on beta and revert the regression and allow more time to investigate the issue.<br>
So in practice, if we increase the priority it's just for "historical" purposes.</p>



<a name="270228097"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/245100-t-compiler/wg-prioritization/alerts/topic/%2392885%20Some%20mixes%20of%20Rust%20with%20C/C%2B%2B%20are%20broken%20for%20arm64%20m%E2%80%A6/near/270228097" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> apiraino <a href="https://zulip-archive.rust-lang.org/stream/245100-t-compiler/wg-prioritization/alerts/topic/.2392885.20Some.20mixes.20of.20Rust.20with.20C.2FC.2B.2B.20are.20broken.20for.20arm64.20m.E2.80.A6.html#270228097">(Feb 01 2022 at 15:21)</a>:</h4>
<p>At the time I must have missed the real context here (i.e. also affecting tier 1),  is <a href="https://github.com/rust-lang/rust/issues/92885#issuecomment-1013003171">this comment</a> about crosscompiling perhaps?</p>
<p>Anyway, probably I would have bumped up the flag.</p>



<a name="270230937"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/245100-t-compiler/wg-prioritization/alerts/topic/%2392885%20Some%20mixes%20of%20Rust%20with%20C/C%2B%2B%20are%20broken%20for%20arm64%20m%E2%80%A6/near/270230937" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jacob Bramley <a href="https://zulip-archive.rust-lang.org/stream/245100-t-compiler/wg-prioritization/alerts/topic/.2392885.20Some.20mixes.20of.20Rust.20with.20C.2FC.2B.2B.20are.20broken.20for.20arm64.20m.E2.80.A6.html#270230937">(Feb 01 2022 at 15:37)</a>:</h4>
<p>I don't think it was about cross compiling, no (but I'm sure it applies there too). The problem is that Rust and Clang disagree on what flag override settings to use. Even with PAuth (etc) turned off, both would generate conflicting override flags (since <a href="https://github.com/rust-lang/rust/issues/88354">#88354</a>, until reverted in <a href="https://github.com/rust-lang/rust/issues/93523">#93523</a>). I reproduced everything natively on AArch64. It only matters with LTO, because as far as I know that's the only situation where LLVM IR modules are merged.</p>
<p>Reverting for beta is quite reasonable, anyway.</p>



<a name="270236720"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/245100-t-compiler/wg-prioritization/alerts/topic/%2392885%20Some%20mixes%20of%20Rust%20with%20C/C%2B%2B%20are%20broken%20for%20arm64%20m%E2%80%A6/near/270236720" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> apiraino <a href="https://zulip-archive.rust-lang.org/stream/245100-t-compiler/wg-prioritization/alerts/topic/.2392885.20Some.20mixes.20of.20Rust.20with.20C.2FC.2B.2B.20are.20broken.20for.20arm64.20m.E2.80.A6.html#270236720">(Feb 01 2022 at 16:08)</a>:</h4>
<p>understood, thanks for the explaining :)</p>



<hr><p>Last updated: Apr 12 2022 at 20:01 UTC</p>
</html>