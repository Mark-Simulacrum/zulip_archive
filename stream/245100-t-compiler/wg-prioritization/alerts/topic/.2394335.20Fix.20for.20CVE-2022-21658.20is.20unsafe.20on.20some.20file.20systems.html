<html>
<head><meta charset="utf-8"><title>#94335 Fix for CVE-2022-21658 is unsafe on some file systems · t-compiler/wg-prioritization/alerts · Zulip Chat Archive</title></head>
<h2>Stream: <a href="https://zulip-archive.rust-lang.org/stream/245100-t-compiler/wg-prioritization/alerts/index.html">t-compiler/wg-prioritization/alerts</a></h2>
<h3>Topic: <a href="https://zulip-archive.rust-lang.org/stream/245100-t-compiler/wg-prioritization/alerts/topic/.2394335.20Fix.20for.20CVE-2022-21658.20is.20unsafe.20on.20some.20file.20systems.html">#94335 Fix for CVE-2022-21658 is unsafe on some file systems</a></h3>

<hr>

<base href="https://rust-lang.zulipchat.com">

<head><link href="https://zulip-archive.rust-lang.org/style.css" rel="stylesheet"></head>

<a name="273153937"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/245100-t-compiler/wg-prioritization/alerts/topic/%2394335%20Fix%20for%20CVE-2022-21658%20is%20unsafe%20on%20some%20file%20systems/near/273153937" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> triagebot <a href="https://zulip-archive.rust-lang.org/stream/245100-t-compiler/wg-prioritization/alerts/topic/.2394335.20Fix.20for.20CVE-2022-21658.20is.20unsafe.20on.20some.20file.20systems.html#273153937">(Feb 24 2022 at 21:48)</a>:</h4>
<p><span class="user-group-mention" data-user-group-id="3111">@WG-prioritization/alerts</span> issue <a href="https://github.com/rust-lang/rust/issues/94335">#94335</a> has been requested for prioritization.</p>
<h1><a href="https://forge.rust-lang.org/compiler/prioritization/procedure.html#assign-priority-to-unprioritized-issues-with-i-prioritize-label">Procedure</a></h1>
<ul>
<li>Priority?</li>
<li>Regression?</li>
<li>Notify people/groups?</li>
<li>Needs <code>I-nominated</code>?</li>
</ul>



<a name="273168681"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/245100-t-compiler/wg-prioritization/alerts/topic/%2394335%20Fix%20for%20CVE-2022-21658%20is%20unsafe%20on%20some%20file%20systems/near/273168681" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> inquisitivecrystal <a href="https://zulip-archive.rust-lang.org/stream/245100-t-compiler/wg-prioritization/alerts/topic/.2394335.20Fix.20for.20CVE-2022-21658.20is.20unsafe.20on.20some.20file.20systems.html#273168681">(Feb 25 2022 at 00:16)</a>:</h4>
<p>Rust causing file system corruption? Ouch.</p>



<a name="273168715"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/245100-t-compiler/wg-prioritization/alerts/topic/%2394335%20Fix%20for%20CVE-2022-21658%20is%20unsafe%20on%20some%20file%20systems/near/273168715" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> inquisitivecrystal <a href="https://zulip-archive.rust-lang.org/stream/245100-t-compiler/wg-prioritization/alerts/topic/.2394335.20Fix.20for.20CVE-2022-21658.20is.20unsafe.20on.20some.20file.20systems.html#273168715">(Feb 25 2022 at 00:16)</a>:</h4>
<p>This seems unambiguously <code>P-critical</code> to me.</p>



<a name="273168840"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/245100-t-compiler/wg-prioritization/alerts/topic/%2394335%20Fix%20for%20CVE-2022-21658%20is%20unsafe%20on%20some%20file%20systems/near/273168840" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> inquisitivecrystal <a href="https://zulip-archive.rust-lang.org/stream/245100-t-compiler/wg-prioritization/alerts/topic/.2394335.20Fix.20for.20CVE-2022-21658.20is.20unsafe.20on.20some.20file.20systems.html#273168840">(Feb 25 2022 at 00:18)</a>:</h4>
<p>Even if this only affects non-tier 1 systems, people should be able to expect that rust won't mess up their computers.</p>



<a name="273186446"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/245100-t-compiler/wg-prioritization/alerts/topic/%2394335%20Fix%20for%20CVE-2022-21658%20is%20unsafe%20on%20some%20file%20systems/near/273186446" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Gary Guo <a href="https://zulip-archive.rust-lang.org/stream/245100-t-compiler/wg-prioritization/alerts/topic/.2394335.20Fix.20for.20CVE-2022-21658.20is.20unsafe.20on.20some.20file.20systems.html#273186446">(Feb 25 2022 at 03:59)</a>:</h4>
<p>If calling <code>unlink</code> can cause corruption then the file system design is broken.</p>



<a name="273186726"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/245100-t-compiler/wg-prioritization/alerts/topic/%2394335%20Fix%20for%20CVE-2022-21658%20is%20unsafe%20on%20some%20file%20systems/near/273186726" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Gary Guo <a href="https://zulip-archive.rust-lang.org/stream/245100-t-compiler/wg-prioritization/alerts/topic/.2394335.20Fix.20for.20CVE-2022-21658.20is.20unsafe.20on.20some.20file.20systems.html#273186726">(Feb 25 2022 at 04:03)</a>:</h4>
<p>But we do need a fix ASAP. P-critical sounds reasonable.</p>



<a name="273201897"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/245100-t-compiler/wg-prioritization/alerts/topic/%2394335%20Fix%20for%20CVE-2022-21658%20is%20unsafe%20on%20some%20file%20systems/near/273201897" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Hans Kratz <a href="https://zulip-archive.rust-lang.org/stream/245100-t-compiler/wg-prioritization/alerts/topic/.2394335.20Fix.20for.20CVE-2022-21658.20is.20unsafe.20on.20some.20file.20systems.html#273201897">(Feb 25 2022 at 08:45)</a>:</h4>
<p>I will have a patch ready soon.</p>
<p>Impact:</p>
<ul>
<li>The only report in the wild is for Illumos, but it likely happens for Solaris with UFS too. Not sure if Illumos/Solaris with ZFS is impacted (unlikely I think).</li>
<li>For Linux and FreeBSD it is documented that <code>unlinkat(..., 0)</code> on a directory fails with EISDIR/EPERM, no exceptions. </li>
<li>For MacOS, NetBSD and OpenBSD the code path is rarely triggered, because <code>dirent</code> has the <code>d_type</code> hint, it is usually not <code>DT_UNKNOWN</code> and even if it is, the underlying filesystem  is unlikely to support unlinking a directory.</li>
</ul>
<p>I agree with <span class="user-mention" data-user-id="303710">@Gary Guo</span>.  If a filesystem supports unlink()ing a directory, then that should never result in any kind of filesystem corruption. Here I don't think it is really "filesystem corruption", just that the inodes of the contained files and directories are not freed, so they end up in <code>/lost+found</code>.</p>



<a name="273202224"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/245100-t-compiler/wg-prioritization/alerts/topic/%2394335%20Fix%20for%20CVE-2022-21658%20is%20unsafe%20on%20some%20file%20systems/near/273202224" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> apiraino <a href="https://zulip-archive.rust-lang.org/stream/245100-t-compiler/wg-prioritization/alerts/topic/.2394335.20Fix.20for.20CVE-2022-21658.20is.20unsafe.20on.20some.20file.20systems.html#273202224">(Feb 25 2022 at 08:47)</a>:</h4>
<p>I agree.</p>
<p>By the way, really interesting analysis provided by the issue reporter. I wans't aware of these details</p>



<a name="273202280"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/245100-t-compiler/wg-prioritization/alerts/topic/%2394335%20Fix%20for%20CVE-2022-21658%20is%20unsafe%20on%20some%20file%20systems/near/273202280" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> apiraino <a href="https://zulip-archive.rust-lang.org/stream/245100-t-compiler/wg-prioritization/alerts/topic/.2394335.20Fix.20for.20CVE-2022-21658.20is.20unsafe.20on.20some.20file.20systems.html#273202280">(Feb 25 2022 at 08:48)</a>:</h4>
<p>thanks <span class="user-mention" data-user-id="407656">@Hans Kratz</span> !</p>



<a name="273202375"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/245100-t-compiler/wg-prioritization/alerts/topic/%2394335%20Fix%20for%20CVE-2022-21658%20is%20unsafe%20on%20some%20file%20systems/near/273202375" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> triagebot <a href="https://zulip-archive.rust-lang.org/stream/245100-t-compiler/wg-prioritization/alerts/topic/.2394335.20Fix.20for.20CVE-2022-21658.20is.20unsafe.20on.20some.20file.20systems.html#273202375">(Feb 25 2022 at 08:49)</a>:</h4>
<p>Issue <a href="https://github.com/rust-lang/rust/issues/94335">#94335</a>'s prioritization request has been removed.</p>



<a name="273209060"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/245100-t-compiler/wg-prioritization/alerts/topic/%2394335%20Fix%20for%20CVE-2022-21658%20is%20unsafe%20on%20some%20file%20systems/near/273209060" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Frank Steffahn <a href="https://zulip-archive.rust-lang.org/stream/245100-t-compiler/wg-prioritization/alerts/topic/.2394335.20Fix.20for.20CVE-2022-21658.20is.20unsafe.20on.20some.20file.20systems.html#273209060">(Feb 25 2022 at 09:59)</a>:</h4>
<p>Is it intentional, there’s no <code>T-*</code> label on the issue?</p>



<a name="273233462"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/245100-t-compiler/wg-prioritization/alerts/topic/%2394335%20Fix%20for%20CVE-2022-21658%20is%20unsafe%20on%20some%20file%20systems/near/273233462" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> apiraino <a href="https://zulip-archive.rust-lang.org/stream/245100-t-compiler/wg-prioritization/alerts/topic/.2394335.20Fix.20for.20CVE-2022-21658.20is.20unsafe.20on.20some.20file.20systems.html#273233462">(Feb 25 2022 at 14:14)</a>:</h4>
<p>ops no, I just forgot :) <br>
(thanks <span class="user-mention silent" data-user-id="330154">The 8472</span> btw)</p>



<hr><p>Last updated: Apr 12 2022 at 20:01 UTC</p>
</html>