<html>
<head><meta charset="utf-8"><title>#82533 No Panic Safety in `extend_from_within` · t-compiler/wg-prioritization/alerts · Zulip Chat Archive</title></head>
<h2>Stream: <a href="https://zulip-archive.rust-lang.org/stream/245100-t-compiler/wg-prioritization/alerts/index.html">t-compiler/wg-prioritization/alerts</a></h2>
<h3>Topic: <a href="https://zulip-archive.rust-lang.org/stream/245100-t-compiler/wg-prioritization/alerts/topic/.2382533.20No.20Panic.20Safety.20in.20.60extend_from_within.60.html">#82533 No Panic Safety in `extend_from_within`</a></h3>

<hr>

<base href="https://rust-lang.zulipchat.com">

<head><link href="https://zulip-archive.rust-lang.org/style.css" rel="stylesheet"></head>

<a name="227881017"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/245100-t-compiler/wg-prioritization/alerts/topic/%2382533%20No%20Panic%20Safety%20in%20%60extend_from_within%60/near/227881017" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> triagebot <a href="https://zulip-archive.rust-lang.org/stream/245100-t-compiler/wg-prioritization/alerts/topic/.2382533.20No.20Panic.20Safety.20in.20.60extend_from_within.60.html#227881017">(Feb 26 2021 at 04:29)</a>:</h4>
<p><span class="user-group-mention" data-user-group-id="3111">@WG-prioritization/alerts</span> issue <a href="https://github.com/rust-lang/rust/issues/82533">#82533</a> has been requested for prioritization.</p>
<h1><a href="https://forge.rust-lang.org/compiler/prioritization/procedure.html#assign-priority-to-unprioritized-issues-with-i-prioritize-label">Procedure</a></h1>
<ul>
<li>Priority?</li>
<li>Regression?</li>
<li>Notify people/groups?</li>
<li>Needs <code>I-nominated</code>?</li>
</ul>



<a name="227895116"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/245100-t-compiler/wg-prioritization/alerts/topic/%2382533%20No%20Panic%20Safety%20in%20%60extend_from_within%60/near/227895116" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> apiraino <a href="https://zulip-archive.rust-lang.org/stream/245100-t-compiler/wg-prioritization/alerts/topic/.2382533.20No.20Panic.20Safety.20in.20.60extend_from_within.60.html#227895116">(Feb 26 2021 at 08:16)</a>:</h4>
<p>hm ... what's the context of this issue? What's the actionable if (to my understanding by reading Joshua's comment) there's no memory leak?</p>



<a name="227907570"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/245100-t-compiler/wg-prioritization/alerts/topic/%2382533%20No%20Panic%20Safety%20in%20%60extend_from_within%60/near/227907570" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> hyd-dev <a href="https://zulip-archive.rust-lang.org/stream/245100-t-compiler/wg-prioritization/alerts/topic/.2382533.20No.20Panic.20Safety.20in.20.60extend_from_within.60.html#227907570">(Feb 26 2021 at 10:19)</a>:</h4>
<p>I guess <span class="user-mention silent" data-user-id="232545">Joshua Nelson</span> meant this <em>is</em> "just" a memory leak, it's fully safe.</p>



<a name="227907938"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/245100-t-compiler/wg-prioritization/alerts/topic/%2382533%20No%20Panic%20Safety%20in%20%60extend_from_within%60/near/227907938" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> hyd-dev <a href="https://zulip-archive.rust-lang.org/stream/245100-t-compiler/wg-prioritization/alerts/topic/.2382533.20No.20Panic.20Safety.20in.20.60extend_from_within.60.html#227907938">(Feb 26 2021 at 10:23)</a>:</h4>
<p>Also IMO it's still called "panic safety" (or at least "unwind safety") even it's fully safe: <a href="https://doc.rust-lang.org/nightly/std/panic/trait.UnwindSafe.html#what-is-unwind-safety">https://doc.rust-lang.org/nightly/std/panic/trait.UnwindSafe.html#what-is-unwind-safety</a></p>



<a name="227909343"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/245100-t-compiler/wg-prioritization/alerts/topic/%2382533%20No%20Panic%20Safety%20in%20%60extend_from_within%60/near/227909343" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> apiraino <a href="https://zulip-archive.rust-lang.org/stream/245100-t-compiler/wg-prioritization/alerts/topic/.2382533.20No.20Panic.20Safety.20in.20.60extend_from_within.60.html#227909343">(Feb 26 2021 at 10:36)</a>:</h4>
<p>oh now I see, thank you!</p>



<a name="227936660"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/245100-t-compiler/wg-prioritization/alerts/topic/%2382533%20No%20Panic%20Safety%20in%20%60extend_from_within%60/near/227936660" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joshua Nelson <a href="https://zulip-archive.rust-lang.org/stream/245100-t-compiler/wg-prioritization/alerts/topic/.2382533.20No.20Panic.20Safety.20in.20.60extend_from_within.60.html#227936660">(Feb 26 2021 at 14:39)</a>:</h4>
<p><span class="user-mention silent" data-user-id="374396">hyd-dev</span> <a href="#narrow/stream/245100-t-compiler.2Fwg-prioritization.2Falerts/topic/.2382533.20No.20Panic.20Safety.20in.20.60extend_from_within.60/near/227907938">said</a>:</p>
<blockquote>
<p>Also IMO it's still called "panic safety" (or at least "unwind safety") even it's fully safe: <a href="https://doc.rust-lang.org/nightly/std/panic/trait.UnwindSafe.html#what-is-unwind-safety">https://doc.rust-lang.org/nightly/std/panic/trait.UnwindSafe.html#what-is-unwind-safety</a></p>
</blockquote>
<p>Hmm, I don't think I'd call leaking memory a "broken logic invariant" - from what I can tell it's fine to catch the unwind and use the Vec after a panic</p>



<a name="227940579"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/245100-t-compiler/wg-prioritization/alerts/topic/%2382533%20No%20Panic%20Safety%20in%20%60extend_from_within%60/near/227940579" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> hyd-dev <a href="https://zulip-archive.rust-lang.org/stream/245100-t-compiler/wg-prioritization/alerts/topic/.2382533.20No.20Panic.20Safety.20in.20.60extend_from_within.60.html#227940579">(Feb 26 2021 at 15:08)</a>:</h4>
<p><span class="user-mention silent" data-user-id="232545">Joshua Nelson</span> <a href="#narrow/stream/245100-t-compiler.2Fwg-prioritization.2Falerts/topic/.2382533.20No.20Panic.20Safety.20in.20.60extend_from_within.60/near/227936660">said</a>:</p>
<blockquote>
<p>Hmm, I don't think I'd call leaking memory a "broken logic invariant" - from what I can tell it's fine to catch the unwind and use the Vec after a panic</p>
</blockquote>
<p>Indeed... OTOH "resource leaks" are not considered exception safe in C++: <a href="https://en.cppreference.com/w/cpp/language/exceptions#Exception_safety">https://en.cppreference.com/w/cpp/language/exceptions#Exception_safety</a></p>
<p>But yes, although "panics in Rust are currently implemented essentially as a C++ exception under the hood", memory leak is mentioned in neither the documentation nor the RFC.</p>
<p>Maybe I just hate memory leaks too much. <span aria-label="losing money" class="emoji emoji-1f4b8" role="img" title="losing money">:losing_money:</span></p>



<a name="227940820"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/245100-t-compiler/wg-prioritization/alerts/topic/%2382533%20No%20Panic%20Safety%20in%20%60extend_from_within%60/near/227940820" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joshua Nelson <a href="https://zulip-archive.rust-lang.org/stream/245100-t-compiler/wg-prioritization/alerts/topic/.2382533.20No.20Panic.20Safety.20in.20.60extend_from_within.60.html#227940820">(Feb 26 2021 at 15:09)</a>:</h4>
<p>yeah, I don't think C++ is super relevant to Rust's idea of unwind safety</p>



<a name="227946960"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/245100-t-compiler/wg-prioritization/alerts/topic/%2382533%20No%20Panic%20Safety%20in%20%60extend_from_within%60/near/227946960" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Hameer Abbasi <a href="https://zulip-archive.rust-lang.org/stream/245100-t-compiler/wg-prioritization/alerts/topic/.2382533.20No.20Panic.20Safety.20in.20.60extend_from_within.60.html#227946960">(Feb 26 2021 at 15:53)</a>:</h4>
<p>I'd still label this <code>P-high</code>. It may be safe, but we don't want to blow up memory in contexts where panics are common.</p>



<a name="227948477"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/245100-t-compiler/wg-prioritization/alerts/topic/%2382533%20No%20Panic%20Safety%20in%20%60extend_from_within%60/near/227948477" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joshua Nelson <a href="https://zulip-archive.rust-lang.org/stream/245100-t-compiler/wg-prioritization/alerts/topic/.2382533.20No.20Panic.20Safety.20in.20.60extend_from_within.60.html#227948477">(Feb 26 2021 at 16:03)</a>:</h4>
<p>I don't think panics should be common <span aria-label="shrug" class="emoji emoji-1f937" role="img" title="shrug">:shrug:</span> and if they are I'd expect a lot more things to break than just leaked memory</p>



<a name="227952507"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/245100-t-compiler/wg-prioritization/alerts/topic/%2382533%20No%20Panic%20Safety%20in%20%60extend_from_within%60/near/227952507" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Hameer Abbasi <a href="https://zulip-archive.rust-lang.org/stream/245100-t-compiler/wg-prioritization/alerts/topic/.2382533.20No.20Panic.20Safety.20in.20.60extend_from_within.60.html#227952507">(Feb 26 2021 at 16:28)</a>:</h4>
<p>Then maybe we should document this, at least, in very big bold letters, that using panics for anything other than exit situations breaks things. Use <code>std::Result</code> instead.</p>



<a name="227953951"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/245100-t-compiler/wg-prioritization/alerts/topic/%2382533%20No%20Panic%20Safety%20in%20%60extend_from_within%60/near/227953951" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joshua Nelson <a href="https://zulip-archive.rust-lang.org/stream/245100-t-compiler/wg-prioritization/alerts/topic/.2382533.20No.20Panic.20Safety.20in.20.60extend_from_within.60.html#227953951">(Feb 26 2021 at 16:36)</a>:</h4>
<p>Sorry, I'm not explaining myself very well. I think catch_unwind is ok to use and won't inherently break things, just that in practice people don't consider it when writing libraries and so it doesn't get tested very well. I do think we should fix this if possible, I just don't think it's high priority.</p>



<a name="227954287"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/245100-t-compiler/wg-prioritization/alerts/topic/%2382533%20No%20Panic%20Safety%20in%20%60extend_from_within%60/near/227954287" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Hameer Abbasi <a href="https://zulip-archive.rust-lang.org/stream/245100-t-compiler/wg-prioritization/alerts/topic/.2382533.20No.20Panic.20Safety.20in.20.60extend_from_within.60.html#227954287">(Feb 26 2021 at 16:39)</a>:</h4>
<p><code>P-medium</code>, then? <code>P-low</code> is for things unlikely to get fixed, historically.</p>



<a name="227982572"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/245100-t-compiler/wg-prioritization/alerts/topic/%2382533%20No%20Panic%20Safety%20in%20%60extend_from_within%60/near/227982572" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Noah Lev <a href="https://zulip-archive.rust-lang.org/stream/245100-t-compiler/wg-prioritization/alerts/topic/.2382533.20No.20Panic.20Safety.20in.20.60extend_from_within.60.html#227982572">(Feb 26 2021 at 19:51)</a>:</h4>
<p><code>P-medium</code> seems fine to me.</p>



<a name="228004628"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/245100-t-compiler/wg-prioritization/alerts/topic/%2382533%20No%20Panic%20Safety%20in%20%60extend_from_within%60/near/228004628" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Hameer Abbasi <a href="https://zulip-archive.rust-lang.org/stream/245100-t-compiler/wg-prioritization/alerts/topic/.2382533.20No.20Panic.20Safety.20in.20.60extend_from_within.60.html#228004628">(Feb 26 2021 at 22:20)</a>:</h4>
<p>I assigned a Prio, it went to <a href="#narrow/stream/245100-t-compiler.2Fwg-prioritization.2Falerts/topic/.2382533.20.60extend_from_within.60.20leaks.20elements.20on.20panic">this thread</a> due to the issue title modification.</p>



<hr><p>Last updated: Apr 12 2022 at 20:01 UTC</p>
</html>