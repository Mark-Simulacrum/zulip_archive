<html>
<head><meta charset="utf-8"><title>#95132 Higher-ranked `fn` pointers can be cast but no longe… · t-compiler/wg-prioritization/alerts · Zulip Chat Archive</title></head>
<h2>Stream: <a href="https://zulip-archive.rust-lang.org/stream/245100-t-compiler/wg-prioritization/alerts/index.html">t-compiler/wg-prioritization/alerts</a></h2>
<h3>Topic: <a href="https://zulip-archive.rust-lang.org/stream/245100-t-compiler/wg-prioritization/alerts/topic/.2395132.20Higher-ranked.20.60fn.60.20pointers.20can.20be.20cast.20but.20no.20longe.E2.80.A6.html">#95132 Higher-ranked `fn` pointers can be cast but no longe…</a></h3>

<hr>

<base href="https://rust-lang.zulipchat.com">

<head><link href="https://zulip-archive.rust-lang.org/style.css" rel="stylesheet"></head>

<a name="275946615"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/245100-t-compiler/wg-prioritization/alerts/topic/%2395132%20Higher-ranked%20%60fn%60%20pointers%20can%20be%20cast%20but%20no%20longe%E2%80%A6/near/275946615" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> triagebot <a href="https://zulip-archive.rust-lang.org/stream/245100-t-compiler/wg-prioritization/alerts/topic/.2395132.20Higher-ranked.20.60fn.60.20pointers.20can.20be.20cast.20but.20no.20longe.E2.80.A6.html#275946615">(Mar 20 2022 at 04:18)</a>:</h4>
<p><span class="user-group-mention" data-user-group-id="3111">@WG-prioritization/alerts</span> issue <a href="https://github.com/rust-lang/rust/issues/95132">#95132</a> has been requested for prioritization.</p>
<h1><a href="https://forge.rust-lang.org/compiler/prioritization/procedure.html#assign-priority-to-unprioritized-issues-with-i-prioritize-label">Procedure</a></h1>
<ul>
<li>Priority?</li>
<li>Regression?</li>
<li>Notify people/groups?</li>
<li>Needs <code>I-nominated</code>?</li>
</ul>



<a name="275963613"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/245100-t-compiler/wg-prioritization/alerts/topic/%2395132%20Higher-ranked%20%60fn%60%20pointers%20can%20be%20cast%20but%20no%20longe%E2%80%A6/near/275963613" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> apiraino <a href="https://zulip-archive.rust-lang.org/stream/245100-t-compiler/wg-prioritization/alerts/topic/.2395132.20Higher-ranked.20.60fn.60.20pointers.20can.20be.20cast.20but.20no.20longe.E2.80.A6.html#275963613">(Mar 20 2022 at 12:06)</a>:</h4>
<p>I've quickly skimmed through the mentioned  <a href="https://github.com/rust-lang/rust/issues/57374">#57374</a> and I wonder if this qualifies as a regression in diagnostics (a class of errors pointed by <span class="user-mention silent" data-user-id="125294">Aaron Hill</span> <a href="https://github.com/rust-lang/rust/issues/57374#issuecomment-931731343">in this comment</a>) or since it's reproducible since long time it is something <code>T-lang</code> should have a say on. There is a mention of a workaround that is not supposed to be needed as per RFC 401.</p>
<p>I'd lean more on the former but I don't have a great context (so I'm happy for a second opinion here). In any case I'd say a <code>P-medium</code> (as it doesn't seem to be blocking).</p>



<a name="275963614"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/245100-t-compiler/wg-prioritization/alerts/topic/%2395132%20Higher-ranked%20%60fn%60%20pointers%20can%20be%20cast%20but%20no%20longe%E2%80%A6/near/275963614" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> apiraino <a href="https://zulip-archive.rust-lang.org/stream/245100-t-compiler/wg-prioritization/alerts/topic/.2395132.20Higher-ranked.20.60fn.60.20pointers.20can.20be.20cast.20but.20no.20longe.E2.80.A6.html#275963614">(Mar 20 2022 at 12:06)</a>:</h4>
<p>In case we might slap a <code>I-compiler-nominated</code> on this issue and ask T-compiler folks what's the framing context here.</p>



<a name="275974711"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/245100-t-compiler/wg-prioritization/alerts/topic/%2395132%20Higher-ranked%20%60fn%60%20pointers%20can%20be%20cast%20but%20no%20longe%E2%80%A6/near/275974711" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://zulip-archive.rust-lang.org/stream/245100-t-compiler/wg-prioritization/alerts/topic/.2395132.20Higher-ranked.20.60fn.60.20pointers.20can.20be.20cast.20but.20no.20longe.E2.80.A6.html#275974711">(Mar 20 2022 at 16:23)</a>:</h4>
<p>I'm curious which PR "broke" this. I'd imagine it would be Niko's work around universes or leak check.</p>



<a name="275974779"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/245100-t-compiler/wg-prioritization/alerts/topic/%2395132%20Higher-ranked%20%60fn%60%20pointers%20can%20be%20cast%20but%20no%20longe%E2%80%A6/near/275974779" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://zulip-archive.rust-lang.org/stream/245100-t-compiler/wg-prioritization/alerts/topic/.2395132.20Higher-ranked.20.60fn.60.20pointers.20can.20be.20cast.20but.20no.20longe.E2.80.A6.html#275974779">(Mar 20 2022 at 16:24)</a>:</h4>
<p>It's interesting that casting works but straight assignment doesn't.</p>



<a name="275975477"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/245100-t-compiler/wg-prioritization/alerts/topic/%2395132%20Higher-ranked%20%60fn%60%20pointers%20can%20be%20cast%20but%20no%20longe%E2%80%A6/near/275975477" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Boxy [she/her] <a href="https://zulip-archive.rust-lang.org/stream/245100-t-compiler/wg-prioritization/alerts/topic/.2395132.20Higher-ranked.20.60fn.60.20pointers.20can.20be.20cast.20but.20no.20longe.E2.80.A6.html#275975477">(Mar 20 2022 at 16:41)</a>:</h4>
<p><a href="https://github.com/rust-lang/rust/issues/93856">#93856</a> looks somewaht related maybe?</p>



<a name="276011400"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/245100-t-compiler/wg-prioritization/alerts/topic/%2395132%20Higher-ranked%20%60fn%60%20pointers%20can%20be%20cast%20but%20no%20longe%E2%80%A6/near/276011400" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> lcnr <a href="https://zulip-archive.rust-lang.org/stream/245100-t-compiler/wg-prioritization/alerts/topic/.2395132.20Higher-ranked.20.60fn.60.20pointers.20can.20be.20cast.20but.20no.20longe.E2.80.A6.html#276011400">(Mar 21 2022 at 06:42)</a>:</h4>
<p><span class="user-mention silent" data-user-id="232957">Jack Huey</span> <a href="#narrow/stream/245100-t-compiler.2Fwg-prioritization.2Falerts/topic/.2395132.20Higher-ranked.20.60fn.60.20pointers.20can.20be.20cast.20but.20no.20longe.E2.80.A6/near/275974711">said</a>:</p>
<blockquote>
<p>I'm curious which PR "broke" this. I'd imagine it would be Niko's work around universes or leak check.</p>
</blockquote>
<p>the introduction of nll</p>



<a name="276011508"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/245100-t-compiler/wg-prioritization/alerts/topic/%2395132%20Higher-ranked%20%60fn%60%20pointers%20can%20be%20cast%20but%20no%20longe%E2%80%A6/near/276011508" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> lcnr <a href="https://zulip-archive.rust-lang.org/stream/245100-t-compiler/wg-prioritization/alerts/topic/.2395132.20Higher-ranked.20.60fn.60.20pointers.20can.20be.20cast.20but.20no.20longe.E2.80.A6.html#276011508">(Mar 21 2022 at 06:44)</a>:</h4>
<p>the issue here is that pretty much all type annotations in mir do not deal with variance correctly</p>



<a name="276011542"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/245100-t-compiler/wg-prioritization/alerts/topic/%2395132%20Higher-ranked%20%60fn%60%20pointers%20can%20be%20cast%20but%20no%20longe%E2%80%A6/near/276011542" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> lcnr <a href="https://zulip-archive.rust-lang.org/stream/245100-t-compiler/wg-prioritization/alerts/topic/.2395132.20Higher-ranked.20.60fn.60.20pointers.20can.20be.20cast.20but.20no.20longe.E2.80.A6.html#276011542">(Mar 21 2022 at 06:45)</a>:</h4>
<p><code>P-medium</code> seems fine to em</p>



<a name="276011596"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/245100-t-compiler/wg-prioritization/alerts/topic/%2395132%20Higher-ranked%20%60fn%60%20pointers%20can%20be%20cast%20but%20no%20longe%E2%80%A6/near/276011596" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> lcnr <a href="https://zulip-archive.rust-lang.org/stream/245100-t-compiler/wg-prioritization/alerts/topic/.2395132.20Higher-ranked.20.60fn.60.20pointers.20can.20be.20cast.20but.20no.20longe.E2.80.A6.html#276011596">(Mar 21 2022 at 06:46)</a>:</h4>
<p>don't believe we need to nominate this, I am already looking into this and feel confident in my ability to analyse this issue myself</p>



<a name="276011626"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/245100-t-compiler/wg-prioritization/alerts/topic/%2395132%20Higher-ranked%20%60fn%60%20pointers%20can%20be%20cast%20but%20no%20longe%E2%80%A6/near/276011626" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> lcnr <a href="https://zulip-archive.rust-lang.org/stream/245100-t-compiler/wg-prioritization/alerts/topic/.2395132.20Higher-ranked.20.60fn.60.20pointers.20can.20be.20cast.20but.20no.20longe.E2.80.A6.html#276011626">(Mar 21 2022 at 06:47)</a>:</h4>
<p><span class="user-mention silent" data-user-id="216206">lcnr</span> <a href="#narrow/stream/245100-t-compiler.2Fwg-prioritization.2Falerts/topic/.2395132.20Higher-ranked.20.60fn.60.20pointers.20can.20be.20cast.20but.20no.20longe.E2.80.A6/near/276011508">said</a>:</p>
<blockquote>
<p>the issue here is that pretty much all type annotations in mir do not deal with variance correctly</p>
</blockquote>
<p>both <code>UserTypeAnnotations</code>, which I've fixed in <a href="https://github.com/rust-lang/rust/issues/93856">#93856</a>, though not in the way I want to do it now, and <code>ProjectionElem::Field</code> where the "expected" field type is actually only related to the actual field type via subtyping</p>



<a name="276014516"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/245100-t-compiler/wg-prioritization/alerts/topic/%2395132%20Higher-ranked%20%60fn%60%20pointers%20can%20be%20cast%20but%20no%20longe%E2%80%A6/near/276014516" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> apiraino <a href="https://zulip-archive.rust-lang.org/stream/245100-t-compiler/wg-prioritization/alerts/topic/.2395132.20Higher-ranked.20.60fn.60.20pointers.20can.20be.20cast.20but.20no.20longe.E2.80.A6.html#276014516">(Mar 21 2022 at 07:38)</a>:</h4>
<p>great, thanks to everyone for the insights, it's always helpful!</p>



<a name="276014529"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/245100-t-compiler/wg-prioritization/alerts/topic/%2395132%20Higher-ranked%20%60fn%60%20pointers%20can%20be%20cast%20but%20no%20longe%E2%80%A6/near/276014529" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> triagebot <a href="https://zulip-archive.rust-lang.org/stream/245100-t-compiler/wg-prioritization/alerts/topic/.2395132.20Higher-ranked.20.60fn.60.20pointers.20can.20be.20cast.20but.20no.20longe.E2.80.A6.html#276014529">(Mar 21 2022 at 07:38)</a>:</h4>
<p>Issue <a href="https://github.com/rust-lang/rust/issues/95132">#95132</a>'s prioritization request has been removed.</p>



<hr><p>Last updated: Apr 12 2022 at 20:01 UTC</p>
</html>