<html>
<head><meta charset="utf-8"><title>#82758 WASI: path_open regression in Rust 1.51 · t-compiler/wg-prioritization/alerts · Zulip Chat Archive</title></head>
<h2>Stream: <a href="https://zulip-archive.rust-lang.org/stream/245100-t-compiler/wg-prioritization/alerts/index.html">t-compiler/wg-prioritization/alerts</a></h2>
<h3>Topic: <a href="https://zulip-archive.rust-lang.org/stream/245100-t-compiler/wg-prioritization/alerts/topic/.2382758.20WASI.3A.20path_open.20regression.20in.20Rust.201.2E51.html">#82758 WASI: path_open regression in Rust 1.51</a></h3>

<hr>

<base href="https://rust-lang.zulipchat.com">

<head><link href="https://zulip-archive.rust-lang.org/style.css" rel="stylesheet"></head>

<a name="228755825"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/245100-t-compiler/wg-prioritization/alerts/topic/%2382758%20WASI%3A%20path_open%20regression%20in%20Rust%201.51/near/228755825" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> triagebot <a href="https://zulip-archive.rust-lang.org/stream/245100-t-compiler/wg-prioritization/alerts/topic/.2382758.20WASI.3A.20path_open.20regression.20in.20Rust.201.2E51.html#228755825">(Mar 04 2021 at 11:32)</a>:</h4>
<p><span class="user-group-mention" data-user-group-id="3111">@WG-prioritization/alerts</span> issue <a href="https://github.com/rust-lang/rust/issues/82758">#82758</a> has been requested for prioritization.</p>
<h1><a href="https://forge.rust-lang.org/compiler/prioritization/procedure.html#assign-priority-to-unprioritized-issues-with-i-prioritize-label">Procedure</a></h1>
<ul>
<li>Priority?</li>
<li>Regression?</li>
<li>Notify people/groups?</li>
<li>Needs <code>I-nominated</code>?</li>
</ul>



<a name="228927694"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/245100-t-compiler/wg-prioritization/alerts/topic/%2382758%20WASI%3A%20path_open%20regression%20in%20Rust%201.51/near/228927694" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Yuki Okushi <a href="https://zulip-archive.rust-lang.org/stream/245100-t-compiler/wg-prioritization/alerts/topic/.2382758.20WASI.3A.20path_open.20regression.20in.20Rust.201.2E51.html#228927694">(Mar 05 2021 at 10:02)</a>:</h4>
<p>looks like it's painful for WASI users but it happens with <code>--release</code></p>



<a name="228927822"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/245100-t-compiler/wg-prioritization/alerts/topic/%2382758%20WASI%3A%20path_open%20regression%20in%20Rust%201.51/near/228927822" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Yuki Okushi <a href="https://zulip-archive.rust-lang.org/stream/245100-t-compiler/wg-prioritization/alerts/topic/.2382758.20WASI.3A.20path_open.20regression.20in.20Rust.201.2E51.html#228927822">(Mar 05 2021 at 10:03)</a>:</h4>
<p>I'd go for P-medium but I'm fine with P-high if someone has concerns</p>



<a name="228933345"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/245100-t-compiler/wg-prioritization/alerts/topic/%2382758%20WASI%3A%20path_open%20regression%20in%20Rust%201.51/near/228933345" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> apiraino <a href="https://zulip-archive.rust-lang.org/stream/245100-t-compiler/wg-prioritization/alerts/topic/.2382758.20WASI.3A.20path_open.20regression.20in.20Rust.201.2E51.html#228933345">(Mar 05 2021 at 10:50)</a>:</h4>
<p>right,  my understanding here is that compiling for <code>--release</code> with optimizations enabled breaks loading files from the filesystem, which looks a bad enough regression on beta waiting to land on stable in ~3 weeks, mitigated only by the fact that <code>wasm32-wasi</code> is a Tier 2 target.</p>
<p>Given this (perhaps limited context) I'd like to assign a <code>P-high</code> and hopefully someone investigate this, but if <code>P-medium</code> is more appropriate, ok for that.</p>



<a name="228933838"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/245100-t-compiler/wg-prioritization/alerts/topic/%2382758%20WASI%3A%20path_open%20regression%20in%20Rust%201.51/near/228933838" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Yuki Okushi <a href="https://zulip-archive.rust-lang.org/stream/245100-t-compiler/wg-prioritization/alerts/topic/.2382758.20WASI.3A.20path_open.20regression.20in.20Rust.201.2E51.html#228933838">(Mar 05 2021 at 10:55)</a>:</h4>
<p>makes sense, then P-high seems better <span aria-label="+1" class="emoji emoji-1f44d" role="img" title="+1">:+1:</span></p>



<a name="228944696"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/245100-t-compiler/wg-prioritization/alerts/topic/%2382758%20WASI%3A%20path_open%20regression%20in%20Rust%201.51/near/228944696" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Léo Lanteri Thauvin <a href="https://zulip-archive.rust-lang.org/stream/245100-t-compiler/wg-prioritization/alerts/topic/.2382758.20WASI.3A.20path_open.20regression.20in.20Rust.201.2E51.html#228944696">(Mar 05 2021 at 12:29)</a>:</h4>
<p>This requires LTO too</p>



<a name="228944701"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/245100-t-compiler/wg-prioritization/alerts/topic/%2382758%20WASI%3A%20path_open%20regression%20in%20Rust%201.51/near/228944701" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Léo Lanteri Thauvin <a href="https://zulip-archive.rust-lang.org/stream/245100-t-compiler/wg-prioritization/alerts/topic/.2382758.20WASI.3A.20path_open.20regression.20in.20Rust.201.2E51.html#228944701">(Mar 05 2021 at 12:29)</a>:</h4>
<blockquote>
<p>This happens only in the release builds with LTO enabled</p>
</blockquote>



<a name="228945682"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/245100-t-compiler/wg-prioritization/alerts/topic/%2382758%20WASI%3A%20path_open%20regression%20in%20Rust%201.51/near/228945682" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> apiraino <a href="https://zulip-archive.rust-lang.org/stream/245100-t-compiler/wg-prioritization/alerts/topic/.2382758.20WASI.3A.20path_open.20regression.20in.20Rust.201.2E51.html#228945682">(Mar 05 2021 at 12:37)</a>:</h4>
<p><span class="user-mention silent" data-user-id="255061">Léo Lanteri Thauvin</span> <a href="#narrow/stream/245100-t-compiler.2Fwg-prioritization.2Falerts/topic/.2382758.20WASI.3A.20path_open.20regression.20in.20Rust.201.2E51/near/228944696">said</a>:</p>
<blockquote>
<p>This requires LTO too</p>
</blockquote>
<p>sorry, I'm missing the implication of this. Are you just stating a fact or do you imply that's a factor that makes the error worse or (on the contrary) less important?</p>



<a name="228947202"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/245100-t-compiler/wg-prioritization/alerts/topic/%2382758%20WASI%3A%20path_open%20regression%20in%20Rust%201.51/near/228947202" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Léo Lanteri Thauvin <a href="https://zulip-archive.rust-lang.org/stream/245100-t-compiler/wg-prioritization/alerts/topic/.2382758.20WASI.3A.20path_open.20regression.20in.20Rust.201.2E51.html#228947202">(Mar 05 2021 at 12:50)</a>:</h4>
<p>The author said in <a href="https://github.com/rust-lang/rust/issues/82758#issuecomment-790583395">https://github.com/rust-lang/rust/issues/82758#issuecomment-790583395</a>:</p>
<blockquote>
<p>This happens only in the release builds with LTO enabled</p>
</blockquote>
<p>This is also visible in <a href="https://github.com/rust-lang/rust/issues/82758#issuecomment-790881952">their <code>Cargo.toml</code></a>:</p>
<div class="codehilite" data-code-language="TOML"><pre><span></span><code><span class="k">[profile.release]</span>
<span class="n">lto</span> <span class="o">=</span> <span class="kc">true</span>
</code></pre></div>
<p>And, as LTO is disabled by default, the bug relying on it could be somewhat less important.</p>



<a name="228947232"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/245100-t-compiler/wg-prioritization/alerts/topic/%2382758%20WASI%3A%20path_open%20regression%20in%20Rust%201.51/near/228947232" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Léo Lanteri Thauvin <a href="https://zulip-archive.rust-lang.org/stream/245100-t-compiler/wg-prioritization/alerts/topic/.2382758.20WASI.3A.20path_open.20regression.20in.20Rust.201.2E51.html#228947232">(Mar 05 2021 at 12:51)</a>:</h4>
<p>Posted <a href="https://github.com/rust-lang/rust/issues/82758#issuecomment-791398875">https://github.com/rust-lang/rust/issues/82758#issuecomment-791398875</a> to ask if this does indeed require LTO</p>



<a name="228951798"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/245100-t-compiler/wg-prioritization/alerts/topic/%2382758%20WASI%3A%20path_open%20regression%20in%20Rust%201.51/near/228951798" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> apiraino <a href="https://zulip-archive.rust-lang.org/stream/245100-t-compiler/wg-prioritization/alerts/topic/.2382758.20WASI.3A.20path_open.20regression.20in.20Rust.201.2E51.html#228951798">(Mar 05 2021 at 13:24)</a>:</h4>
<p>ok, understood - thanks!</p>



<a name="228999479"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/245100-t-compiler/wg-prioritization/alerts/topic/%2382758%20WASI%3A%20path_open%20regression%20in%20Rust%201.51/near/228999479" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Yuki Okushi <a href="https://zulip-archive.rust-lang.org/stream/245100-t-compiler/wg-prioritization/alerts/topic/.2382758.20WASI.3A.20path_open.20regression.20in.20Rust.201.2E51.html#228999479">(Mar 05 2021 at 18:16)</a>:</h4>
<p>FYI: Alex submitted a fix, <a href="https://github.com/rust-lang/rust/pull/82804">https://github.com/rust-lang/rust/pull/82804</a></p>



<a name="228999537"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/245100-t-compiler/wg-prioritization/alerts/topic/%2382758%20WASI%3A%20path_open%20regression%20in%20Rust%201.51/near/228999537" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Yuki Okushi <a href="https://zulip-archive.rust-lang.org/stream/245100-t-compiler/wg-prioritization/alerts/topic/.2382758.20WASI.3A.20path_open.20regression.20in.20Rust.201.2E51.html#228999537">(Mar 05 2021 at 18:17)</a>:</h4>
<p>given they consider backporting it, I think P-high is better (assuming it's still the <code>T-libs-impl</code> issue)</p>



<a name="228999635"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/245100-t-compiler/wg-prioritization/alerts/topic/%2382758%20WASI%3A%20path_open%20regression%20in%20Rust%201.51/near/228999635" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Yuki Okushi <a href="https://zulip-archive.rust-lang.org/stream/245100-t-compiler/wg-prioritization/alerts/topic/.2382758.20WASI.3A.20path_open.20regression.20in.20Rust.201.2E51.html#228999635">(Mar 05 2021 at 18:17)</a>:</h4>
<p>(either way, P-high or P-medium is not that big a deal here, I feel)</p>



<a name="229000584"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/245100-t-compiler/wg-prioritization/alerts/topic/%2382758%20WASI%3A%20path_open%20regression%20in%20Rust%201.51/near/229000584" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Léo Lanteri Thauvin <a href="https://zulip-archive.rust-lang.org/stream/245100-t-compiler/wg-prioritization/alerts/topic/.2382758.20WASI.3A.20path_open.20regression.20in.20Rust.201.2E51.html#229000584">(Mar 05 2021 at 18:23)</a>:</h4>
<p>Nominated the fix</p>



<a name="229672977"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/245100-t-compiler/wg-prioritization/alerts/topic/%2382758%20WASI%3A%20path_open%20regression%20in%20Rust%201.51/near/229672977" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> apiraino <a href="https://zulip-archive.rust-lang.org/stream/245100-t-compiler/wg-prioritization/alerts/topic/.2382758.20WASI.3A.20path_open.20regression.20in.20Rust.201.2E51.html#229672977">(Mar 10 2021 at 14:50)</a>:</h4>
<p>there's a patch on the way for this, but assigning a P-high, it's <a href="https://github.com/rust-lang/rust/pull/82804#issuecomment-791542194">also nominated for a beta backport</a></p>



<hr><p>Last updated: Apr 12 2022 at 20:01 UTC</p>
</html>