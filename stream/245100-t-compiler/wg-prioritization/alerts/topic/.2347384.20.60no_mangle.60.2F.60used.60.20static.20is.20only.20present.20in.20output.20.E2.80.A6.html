<html>
<head><meta charset="utf-8"><title>#47384 `no_mangle`/`used` static is only present in output … · t-compiler/wg-prioritization/alerts · Zulip Chat Archive</title></head>
<h2>Stream: <a href="https://zulip-archive.rust-lang.org/stream/245100-t-compiler/wg-prioritization/alerts/index.html">t-compiler/wg-prioritization/alerts</a></h2>
<h3>Topic: <a href="https://zulip-archive.rust-lang.org/stream/245100-t-compiler/wg-prioritization/alerts/topic/.2347384.20.60no_mangle.60.2F.60used.60.20static.20is.20only.20present.20in.20output.20.E2.80.A6.html">#47384 `no_mangle`/`used` static is only present in output …</a></h3>

<hr>

<base href="https://rust-lang.zulipchat.com">

<head><link href="https://zulip-archive.rust-lang.org/style.css" rel="stylesheet"></head>

<a name="268792764"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/245100-t-compiler/wg-prioritization/alerts/topic/%2347384%20%60no_mangle%60/%60used%60%20static%20is%20only%20present%20in%20output%20%E2%80%A6/near/268792764" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> triagebot <a href="https://zulip-archive.rust-lang.org/stream/245100-t-compiler/wg-prioritization/alerts/topic/.2347384.20.60no_mangle.60.2F.60used.60.20static.20is.20only.20present.20in.20output.20.E2.80.A6.html#268792764">(Jan 21 2022 at 03:53)</a>:</h4>
<p><span class="user-group-mention" data-user-group-id="3111">@WG-prioritization/alerts</span> issue <a href="https://github.com/rust-lang/rust/issues/47384">#47384</a> has been requested for prioritization.</p>
<h1><a href="https://forge.rust-lang.org/compiler/prioritization/procedure.html#assign-priority-to-unprioritized-issues-with-i-prioritize-label">Procedure</a></h1>
<ul>
<li>Priority?</li>
<li>Regression?</li>
<li>Notify people/groups?</li>
<li>Needs <code>I-nominated</code>?</li>
</ul>



<a name="268801937"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/245100-t-compiler/wg-prioritization/alerts/topic/%2347384%20%60no_mangle%60/%60used%60%20static%20is%20only%20present%20in%20output%20%E2%80%A6/near/268801937" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Gary Guo <a href="https://zulip-archive.rust-lang.org/stream/245100-t-compiler/wg-prioritization/alerts/topic/.2347384.20.60no_mangle.60.2F.60used.60.20static.20is.20only.20present.20in.20output.20.E2.80.A6.html#268801937">(Jan 21 2022 at 06:42)</a>:</h4>
<p>Not sure why is this prioritized.</p>



<a name="268807971"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/245100-t-compiler/wg-prioritization/alerts/topic/%2347384%20%60no_mangle%60/%60used%60%20static%20is%20only%20present%20in%20output%20%E2%80%A6/near/268807971" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> inquisitivecrystal <a href="https://zulip-archive.rust-lang.org/stream/245100-t-compiler/wg-prioritization/alerts/topic/.2347384.20.60no_mangle.60.2F.60used.60.20static.20is.20only.20present.20in.20output.20.E2.80.A6.html#268807971">(Jan 21 2022 at 08:19)</a>:</h4>
<p>Well, it is a bug, and someone asked us to give it a priority.</p>



<a name="268808379"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/245100-t-compiler/wg-prioritization/alerts/topic/%2347384%20%60no_mangle%60/%60used%60%20static%20is%20only%20present%20in%20output%20%E2%80%A6/near/268808379" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> inquisitivecrystal <a href="https://zulip-archive.rust-lang.org/stream/245100-t-compiler/wg-prioritization/alerts/topic/.2347384.20.60no_mangle.60.2F.60used.60.20static.20is.20only.20present.20in.20output.20.E2.80.A6.html#268808379">(Jan 21 2022 at 08:24)</a>:</h4>
<p><code>P-medium</code>? The behavior is somewhat counterintuitive, as shown by the number of people who've had the problem over the years. On the other hand... well, it's been around forever, and I can't see us giving it a <code>P-high</code>. There's no rush to fix this, though it will certainly be nice when it gets fixed.</p>



<a name="268937959"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/245100-t-compiler/wg-prioritization/alerts/topic/%2347384%20%60no_mangle%60/%60used%60%20static%20is%20only%20present%20in%20output%20%E2%80%A6/near/268937959" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Gary Guo <a href="https://zulip-archive.rust-lang.org/stream/245100-t-compiler/wg-prioritization/alerts/topic/.2347384.20.60no_mangle.60.2F.60used.60.20static.20is.20only.20present.20in.20output.20.E2.80.A6.html#268937959">(Jan 22 2022 at 05:10)</a>:</h4>
<p>I tested the code and it seems like:</p>
<ul>
<li>Regardless whether the lines are commented out, <code>STATIC</code> won't be present in the final binary (different from what the issue says)</li>
<li>Regardless whether the lines are commented out, <code>STATIC</code> will be present in the object file.</li>
</ul>



<a name="268937964"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/245100-t-compiler/wg-prioritization/alerts/topic/%2347384%20%60no_mangle%60/%60used%60%20static%20is%20only%20present%20in%20output%20%E2%80%A6/near/268937964" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Gary Guo <a href="https://zulip-archive.rust-lang.org/stream/245100-t-compiler/wg-prioritization/alerts/topic/.2347384.20.60no_mangle.60.2F.60used.60.20static.20is.20only.20present.20in.20output.20.E2.80.A6.html#268937964">(Jan 22 2022 at 05:10)</a>:</h4>
<p>The RFC of <code>#[used]</code> says:</p>
<blockquote>
<p>The #[used] attribute can be applied to static variables to keep them in the object files produced by rustc, even in the presence of LTO. Note that this does not mean that the static variable will make its way into the binary file emitted by the linker as the linker is free to drop symbols that it deems unused. In other words, the #[used] attribute does not affect the behavior of the linker.</p>
</blockquote>



<a name="268937970"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/245100-t-compiler/wg-prioritization/alerts/topic/%2347384%20%60no_mangle%60/%60used%60%20static%20is%20only%20present%20in%20output%20%E2%80%A6/near/268937970" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Gary Guo <a href="https://zulip-archive.rust-lang.org/stream/245100-t-compiler/wg-prioritization/alerts/topic/.2347384.20.60no_mangle.60.2F.60used.60.20static.20is.20only.20present.20in.20output.20.E2.80.A6.html#268937970">(Jan 22 2022 at 05:10)</a>:</h4>
<p>Therefore I think this is working as intended.</p>



<a name="268938325"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/245100-t-compiler/wg-prioritization/alerts/topic/%2347384%20%60no_mangle%60/%60used%60%20static%20is%20only%20present%20in%20output%20%E2%80%A6/near/268938325" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> inquisitivecrystal <a href="https://zulip-archive.rust-lang.org/stream/245100-t-compiler/wg-prioritization/alerts/topic/.2347384.20.60no_mangle.60.2F.60used.60.20static.20is.20only.20present.20in.20output.20.E2.80.A6.html#268938325">(Jan 22 2022 at 05:20)</a>:</h4>
<p>Well, the important thing is that rustc was dropping it (or that's my reading, anyway).</p>



<a name="268938328"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/245100-t-compiler/wg-prioritization/alerts/topic/%2347384%20%60no_mangle%60/%60used%60%20static%20is%20only%20present%20in%20output%20%E2%80%A6/near/268938328" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> inquisitivecrystal <a href="https://zulip-archive.rust-lang.org/stream/245100-t-compiler/wg-prioritization/alerts/topic/.2347384.20.60no_mangle.60.2F.60used.60.20static.20is.20only.20present.20in.20output.20.E2.80.A6.html#268938328">(Jan 22 2022 at 05:20)</a>:</h4>
<p>But if it isn't anymore, than we're good.</p>



<a name="268938339"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/245100-t-compiler/wg-prioritization/alerts/topic/%2347384%20%60no_mangle%60/%60used%60%20static%20is%20only%20present%20in%20output%20%E2%80%A6/near/268938339" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> inquisitivecrystal <a href="https://zulip-archive.rust-lang.org/stream/245100-t-compiler/wg-prioritization/alerts/topic/.2347384.20.60no_mangle.60.2F.60used.60.20static.20is.20only.20present.20in.20output.20.E2.80.A6.html#268938339">(Jan 22 2022 at 05:21)</a>:</h4>
<p><code>E-needs-test</code>? How doable is it write a test for this?</p>



<a name="268938585"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/245100-t-compiler/wg-prioritization/alerts/topic/%2347384%20%60no_mangle%60/%60used%60%20static%20is%20only%20present%20in%20output%20%E2%80%A6/near/268938585" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Gary Guo <a href="https://zulip-archive.rust-lang.org/stream/245100-t-compiler/wg-prioritization/alerts/topic/.2347384.20.60no_mangle.60.2F.60used.60.20static.20is.20only.20present.20in.20output.20.E2.80.A6.html#268938585">(Jan 22 2022 at 05:28)</a>:</h4>
<p>There is already a test that confirms that a <code>used</code> variable is present in object file. The behaviour changes probably are all linking related.</p>



<a name="268940349"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/245100-t-compiler/wg-prioritization/alerts/topic/%2347384%20%60no_mangle%60/%60used%60%20static%20is%20only%20present%20in%20output%20%E2%80%A6/near/268940349" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> inquisitivecrystal <a href="https://zulip-archive.rust-lang.org/stream/245100-t-compiler/wg-prioritization/alerts/topic/.2347384.20.60no_mangle.60.2F.60used.60.20static.20is.20only.20present.20in.20output.20.E2.80.A6.html#268940349">(Jan 22 2022 at 06:13)</a>:</h4>
<p>Alright. Reading your latest comment in the issue, how about we <code>I-lang-nominated</code> this and let them decide what, if anything, to do with it?</p>



<a name="268940497"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/245100-t-compiler/wg-prioritization/alerts/topic/%2347384%20%60no_mangle%60/%60used%60%20static%20is%20only%20present%20in%20output%20%E2%80%A6/near/268940497" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> inquisitivecrystal <a href="https://zulip-archive.rust-lang.org/stream/245100-t-compiler/wg-prioritization/alerts/topic/.2347384.20.60no_mangle.60.2F.60used.60.20static.20is.20only.20present.20in.20output.20.E2.80.A6.html#268940497">(Jan 22 2022 at 06:17)</a>:</h4>
<p>I agree that the current behavior does seem to match the RFC. The question is whether the RFC text matches what the lang team thinks the behavior should be.</p>



<a name="268941891"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/245100-t-compiler/wg-prioritization/alerts/topic/%2347384%20%60no_mangle%60/%60used%60%20static%20is%20only%20present%20in%20output%20%E2%80%A6/near/268941891" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> inquisitivecrystal <a href="https://zulip-archive.rust-lang.org/stream/245100-t-compiler/wg-prioritization/alerts/topic/.2347384.20.60no_mangle.60.2F.60used.60.20static.20is.20only.20present.20in.20output.20.E2.80.A6.html#268941891">(Jan 22 2022 at 06:54)</a>:</h4>
<p>I'm just going to do it.</p>



<a name="268942183"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/245100-t-compiler/wg-prioritization/alerts/topic/%2347384%20%60no_mangle%60/%60used%60%20static%20is%20only%20present%20in%20output%20%E2%80%A6/near/268942183" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> triagebot <a href="https://zulip-archive.rust-lang.org/stream/245100-t-compiler/wg-prioritization/alerts/topic/.2347384.20.60no_mangle.60.2F.60used.60.20static.20is.20only.20present.20in.20output.20.E2.80.A6.html#268942183">(Jan 22 2022 at 06:59)</a>:</h4>
<p>Issue <a href="https://github.com/rust-lang/rust/issues/47384">#47384</a>'s prioritization request has been removed.</p>



<a name="268943065"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/245100-t-compiler/wg-prioritization/alerts/topic/%2347384%20%60no_mangle%60/%60used%60%20static%20is%20only%20present%20in%20output%20%E2%80%A6/near/268943065" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> inquisitivecrystal <a href="https://zulip-archive.rust-lang.org/stream/245100-t-compiler/wg-prioritization/alerts/topic/.2347384.20.60no_mangle.60.2F.60used.60.20static.20is.20only.20present.20in.20output.20.E2.80.A6.html#268943065">(Jan 22 2022 at 07:19)</a>:</h4>
<p><em>sighs</em></p>



<a name="268943073"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/245100-t-compiler/wg-prioritization/alerts/topic/%2347384%20%60no_mangle%60/%60used%60%20static%20is%20only%20present%20in%20output%20%E2%80%A6/near/268943073" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> inquisitivecrystal <a href="https://zulip-archive.rust-lang.org/stream/245100-t-compiler/wg-prioritization/alerts/topic/.2347384.20.60no_mangle.60.2F.60used.60.20static.20is.20only.20present.20in.20output.20.E2.80.A6.html#268943073">(Jan 22 2022 at 07:19)</a>:</h4>
<p>Well, that latest comment just made things a fair bit more complicated.</p>



<a name="268943271"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/245100-t-compiler/wg-prioritization/alerts/topic/%2347384%20%60no_mangle%60/%60used%60%20static%20is%20only%20present%20in%20output%20%E2%80%A6/near/268943271" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> inquisitivecrystal <a href="https://zulip-archive.rust-lang.org/stream/245100-t-compiler/wg-prioritization/alerts/topic/.2347384.20.60no_mangle.60.2F.60used.60.20static.20is.20only.20present.20in.20output.20.E2.80.A6.html#268943271">(Jan 22 2022 at 07:24)</a>:</h4>
<p>I don't know whether to suggest opening a new issue or ask them to post more details on the existing issue. I also don't know whether this needs to be <code>I-compiler-nominated</code> as well.</p>



<a name="268943294"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/245100-t-compiler/wg-prioritization/alerts/topic/%2347384%20%60no_mangle%60/%60used%60%20static%20is%20only%20present%20in%20output%20%E2%80%A6/near/268943294" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> inquisitivecrystal <a href="https://zulip-archive.rust-lang.org/stream/245100-t-compiler/wg-prioritization/alerts/topic/.2347384.20.60no_mangle.60.2F.60used.60.20static.20is.20only.20present.20in.20output.20.E2.80.A6.html#268943294">(Jan 22 2022 at 07:25)</a>:</h4>
<p>I'll leave it for now and see what others have to say.</p>



<a name="268943353"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/245100-t-compiler/wg-prioritization/alerts/topic/%2347384%20%60no_mangle%60/%60used%60%20static%20is%20only%20present%20in%20output%20%E2%80%A6/near/268943353" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Gary Guo <a href="https://zulip-archive.rust-lang.org/stream/245100-t-compiler/wg-prioritization/alerts/topic/.2347384.20.60no_mangle.60.2F.60used.60.20static.20is.20only.20present.20in.20output.20.E2.80.A6.html#268943353">(Jan 22 2022 at 07:26)</a>:</h4>
<p>/me wonder how useful is "used" compared to "retain" semantics (disregarding the lack of support of latter in old toolchains)</p>



<a name="268943368"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/245100-t-compiler/wg-prioritization/alerts/topic/%2347384%20%60no_mangle%60/%60used%60%20static%20is%20only%20present%20in%20output%20%E2%80%A6/near/268943368" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Gary Guo <a href="https://zulip-archive.rust-lang.org/stream/245100-t-compiler/wg-prioritization/alerts/topic/.2347384.20.60no_mangle.60.2F.60used.60.20static.20is.20only.20present.20in.20output.20.E2.80.A6.html#268943368">(Jan 22 2022 at 07:27)</a>:</h4>
<p>Retain semantics are added in binutils 2.36 and LLD 13, which is pretty bleeding edge.</p>



<a name="268943371"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/245100-t-compiler/wg-prioritization/alerts/topic/%2347384%20%60no_mangle%60/%60used%60%20static%20is%20only%20present%20in%20output%20%E2%80%A6/near/268943371" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Gary Guo <a href="https://zulip-archive.rust-lang.org/stream/245100-t-compiler/wg-prioritization/alerts/topic/.2347384.20.60no_mangle.60.2F.60used.60.20static.20is.20only.20present.20in.20output.20.E2.80.A6.html#268943371">(Jan 22 2022 at 07:27)</a>:</h4>
<p>Anyway, that's the topic for lang/compiler teams.</p>



<a name="268943416"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/245100-t-compiler/wg-prioritization/alerts/topic/%2347384%20%60no_mangle%60/%60used%60%20static%20is%20only%20present%20in%20output%20%E2%80%A6/near/268943416" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> inquisitivecrystal <a href="https://zulip-archive.rust-lang.org/stream/245100-t-compiler/wg-prioritization/alerts/topic/.2347384.20.60no_mangle.60.2F.60used.60.20static.20is.20only.20present.20in.20output.20.E2.80.A6.html#268943416">(Jan 22 2022 at 07:28)</a>:</h4>
<p>Would you suggest nominating for compiler as well?</p>



<a name="268943420"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/245100-t-compiler/wg-prioritization/alerts/topic/%2347384%20%60no_mangle%60/%60used%60%20static%20is%20only%20present%20in%20output%20%E2%80%A6/near/268943420" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> inquisitivecrystal <a href="https://zulip-archive.rust-lang.org/stream/245100-t-compiler/wg-prioritization/alerts/topic/.2347384.20.60no_mangle.60.2F.60used.60.20static.20is.20only.20present.20in.20output.20.E2.80.A6.html#268943420">(Jan 22 2022 at 07:28)</a>:</h4>
<p>Also, yes, that is definitely pretty bleeding edge.</p>



<a name="268943489"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/245100-t-compiler/wg-prioritization/alerts/topic/%2347384%20%60no_mangle%60/%60used%60%20static%20is%20only%20present%20in%20output%20%E2%80%A6/near/268943489" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Gary Guo <a href="https://zulip-archive.rust-lang.org/stream/245100-t-compiler/wg-prioritization/alerts/topic/.2347384.20.60no_mangle.60.2F.60used.60.20static.20is.20only.20present.20in.20output.20.E2.80.A6.html#268943489">(Jan 22 2022 at 07:30)</a>:</h4>
<p>I think it's important that the lang team is aware of implementation limitations for this case, because it interacts with other toolchains.</p>



<a name="268943506"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/245100-t-compiler/wg-prioritization/alerts/topic/%2347384%20%60no_mangle%60/%60used%60%20static%20is%20only%20present%20in%20output%20%E2%80%A6/near/268943506" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> inquisitivecrystal <a href="https://zulip-archive.rust-lang.org/stream/245100-t-compiler/wg-prioritization/alerts/topic/.2347384.20.60no_mangle.60.2F.60used.60.20static.20is.20only.20present.20in.20output.20.E2.80.A6.html#268943506">(Jan 22 2022 at 07:31)</a>:</h4>
<p>And it seems like the compiler team is probably best positioned to explore that with them.</p>



<a name="268943837"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/245100-t-compiler/wg-prioritization/alerts/topic/%2347384%20%60no_mangle%60/%60used%60%20static%20is%20only%20present%20in%20output%20%E2%80%A6/near/268943837" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> inquisitivecrystal <a href="https://zulip-archive.rust-lang.org/stream/245100-t-compiler/wg-prioritization/alerts/topic/.2347384.20.60no_mangle.60.2F.60used.60.20static.20is.20only.20present.20in.20output.20.E2.80.A6.html#268943837">(Jan 22 2022 at 07:40)</a>:</h4>
<p>Okay, done. Now at least if I made a mistake it will be one of consulting too many people, which is probably better than the converse.</p>



<a name="268953492"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/245100-t-compiler/wg-prioritization/alerts/topic/%2347384%20%60no_mangle%60/%60used%60%20static%20is%20only%20present%20in%20output%20%E2%80%A6/near/268953492" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> apiraino <a href="https://zulip-archive.rust-lang.org/stream/245100-t-compiler/wg-prioritization/alerts/topic/.2347384.20.60no_mangle.60.2F.60used.60.20static.20is.20only.20present.20in.20output.20.E2.80.A6.html#268953492">(Jan 22 2022 at 11:42)</a>:</h4>
<p>thanks <span class="user-mention" data-user-id="417924">@inquisitivecrystal</span> and <span class="user-mention" data-user-id="303710">@Gary Guo</span> for the analysis. The <code>I-prioritize</code> was assigned by <span class="user-mention" data-user-id="116458">@Charles Lew</span>, I think because the stream of issues pointing to it, it seems people keep on tripping on this. <br>
Discussing during <code>T-compiler</code> meeting will help us frame this issue and find an actionable</p>



<a name="274092228"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/245100-t-compiler/wg-prioritization/alerts/topic/%2347384%20%60no_mangle%60/%60used%60%20static%20is%20only%20present%20in%20output%20%E2%80%A6/near/274092228" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> inquisitivecrystal <a href="https://zulip-archive.rust-lang.org/stream/245100-t-compiler/wg-prioritization/alerts/topic/.2347384.20.60no_mangle.60.2F.60used.60.20static.20is.20only.20present.20in.20output.20.E2.80.A6.html#274092228">(Mar 04 2022 at 07:54)</a>:</h4>
<p><span class="user-mention" data-user-id="250987">@apiraino</span> Can you make sure this gets on the compiler team's agenda for next week? In particular,  <a href="https://github.com/rust-lang/rust/issues/47384#issuecomment-1032974536">this comment</a> seems to suggest that there is a regression fix that needs assignment by T-compiler. Unless it's already happened, and I'm missing it somehow.</p>



<a name="274092421"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/245100-t-compiler/wg-prioritization/alerts/topic/%2347384%20%60no_mangle%60/%60used%60%20static%20is%20only%20present%20in%20output%20%E2%80%A6/near/274092421" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> inquisitivecrystal <a href="https://zulip-archive.rust-lang.org/stream/245100-t-compiler/wg-prioritization/alerts/topic/.2347384.20.60no_mangle.60.2F.60used.60.20static.20is.20only.20present.20in.20output.20.E2.80.A6.html#274092421">(Mar 04 2022 at 07:56)</a>:</h4>
<p><a href="https://github.com/rust-lang/rust/issues/93791">#93791</a> has been claimed to be a fix, but it doesn't seem to target the LLVM related regression, and it is also unlikely to be merged in its current state.</p>



<a name="274200486"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/245100-t-compiler/wg-prioritization/alerts/topic/%2347384%20%60no_mangle%60/%60used%60%20static%20is%20only%20present%20in%20output%20%E2%80%A6/near/274200486" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> apiraino <a href="https://zulip-archive.rust-lang.org/stream/245100-t-compiler/wg-prioritization/alerts/topic/.2347384.20.60no_mangle.60.2F.60used.60.20static.20is.20only.20present.20in.20output.20.E2.80.A6.html#274200486">(Mar 04 2022 at 23:01)</a>:</h4>
<p><span class="user-mention" data-user-id="417924">@inquisitivecrystal</span> thanks for the ping! ok, I will readd the <code>I-compiler-nomination</code> (that issue was discussed about <a href="#narrow/stream/238009-t-compiler.2Fmeetings/topic/.5Bweekly.5D.202022-02-03.20.2354818/near/270571674">a month ago</a>.</p>
<p>Self-note: <a href="https://github.com/rust-lang/rust/issues/47384">#47384</a> is also mentioned in <a href="https://github.com/rust-lang/rust/issues/94419">#94419</a></p>



<a name="275564666"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/245100-t-compiler/wg-prioritization/alerts/topic/%2347384%20%60no_mangle%60/%60used%60%20static%20is%20only%20present%20in%20output%20%E2%80%A6/near/275564666" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> apiraino <a href="https://zulip-archive.rust-lang.org/stream/245100-t-compiler/wg-prioritization/alerts/topic/.2347384.20.60no_mangle.60.2F.60used.60.20static.20is.20only.20present.20in.20output.20.E2.80.A6.html#275564666">(Mar 16 2022 at 19:21)</a>:</h4>
<p><span class="user-mention" data-user-id="417924">@inquisitivecrystal</span> last week t-compiler had a quick look at this issue. The meeting was quite packed so tbh we were at the last seconds<br>
<a href="#narrow/stream/238009-t-compiler.2Fmeetings/topic/.5Bweekly.5D.202022-03-10.20.2354818/near/274855448">https://rust-lang.zulipchat.com/#narrow/stream/238009-t-compiler.2Fmeetings/topic/.5Bweekly.5D.202022-03-10.20.2354818/near/274855448</a></p>
<p>I am not 100% sure the nomination was discussed with all the elements on the table, in the rush we may have missed the context that you tried to suggest in this zulip topic (which - alas - I just linked without putting it more prominent).</p>
<p>What do you think?</p>
<p>(btw, sorry for this late comment , wanted to mention this earlier)</p>



<a name="275599167"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/245100-t-compiler/wg-prioritization/alerts/topic/%2347384%20%60no_mangle%60/%60used%60%20static%20is%20only%20present%20in%20output%20%E2%80%A6/near/275599167" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> inquisitivecrystal <a href="https://zulip-archive.rust-lang.org/stream/245100-t-compiler/wg-prioritization/alerts/topic/.2347384.20.60no_mangle.60.2F.60used.60.20static.20is.20only.20present.20in.20output.20.E2.80.A6.html#275599167">(Mar 17 2022 at 01:51)</a>:</h4>
<p><em>sighs in frustration</em></p>



<a name="275599227"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/245100-t-compiler/wg-prioritization/alerts/topic/%2347384%20%60no_mangle%60/%60used%60%20static%20is%20only%20present%20in%20output%20%E2%80%A6/near/275599227" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> inquisitivecrystal <a href="https://zulip-archive.rust-lang.org/stream/245100-t-compiler/wg-prioritization/alerts/topic/.2347384.20.60no_mangle.60.2F.60used.60.20static.20is.20only.20present.20in.20output.20.E2.80.A6.html#275599227">(Mar 17 2022 at 01:52)</a>:</h4>
<p>I can't believe that this very important regression has gotten, basically, lost in the paperwork for over a month.</p>



<a name="275599247"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/245100-t-compiler/wg-prioritization/alerts/topic/%2347384%20%60no_mangle%60/%60used%60%20static%20is%20only%20present%20in%20output%20%E2%80%A6/near/275599247" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> inquisitivecrystal <a href="https://zulip-archive.rust-lang.org/stream/245100-t-compiler/wg-prioritization/alerts/topic/.2347384.20.60no_mangle.60.2F.60used.60.20static.20is.20only.20present.20in.20output.20.E2.80.A6.html#275599247">(Mar 17 2022 at 01:53)</a>:</h4>
<p>I'm not blaming you or anyone else, but it's intensely frustrating.</p>



<a name="275599296"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/245100-t-compiler/wg-prioritization/alerts/topic/%2347384%20%60no_mangle%60/%60used%60%20static%20is%20only%20present%20in%20output%20%E2%80%A6/near/275599296" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> inquisitivecrystal <a href="https://zulip-archive.rust-lang.org/stream/245100-t-compiler/wg-prioritization/alerts/topic/.2347384.20.60no_mangle.60.2F.60used.60.20static.20is.20only.20present.20in.20output.20.E2.80.A6.html#275599296">(Mar 17 2022 at 01:54)</a>:</h4>
<p>The problem is that the issue is so darn tangled at this point. But I thought the lang team's "yep, this is definitely a regression" comment would be enough,</p>



<a name="275599416"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/245100-t-compiler/wg-prioritization/alerts/topic/%2347384%20%60no_mangle%60/%60used%60%20static%20is%20only%20present%20in%20output%20%E2%80%A6/near/275599416" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> inquisitivecrystal <a href="https://zulip-archive.rust-lang.org/stream/245100-t-compiler/wg-prioritization/alerts/topic/.2347384.20.60no_mangle.60.2F.60used.60.20static.20is.20only.20present.20in.20output.20.E2.80.A6.html#275599416">(Mar 17 2022 at 01:56)</a>:</h4>
<p>Okay, the T-compiler meeting for this week hasn't happened yet. That makes me a bit calmer. I'd forgotten which day it was on.</p>



<a name="275599696"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/245100-t-compiler/wg-prioritization/alerts/topic/%2347384%20%60no_mangle%60/%60used%60%20static%20is%20only%20present%20in%20output%20%E2%80%A6/near/275599696" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> inquisitivecrystal <a href="https://zulip-archive.rust-lang.org/stream/245100-t-compiler/wg-prioritization/alerts/topic/.2347384.20.60no_mangle.60.2F.60used.60.20static.20is.20only.20present.20in.20output.20.E2.80.A6.html#275599696">(Mar 17 2022 at 02:01)</a>:</h4>
<p>Okay, basically, there's a <a href="https://github.com/rust-lang/rust/issues/47384#issuecomment-1032974536">regression here that was introduced that may have something to do with LLVM</a>.</p>



<a name="275599972"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/245100-t-compiler/wg-prioritization/alerts/topic/%2347384%20%60no_mangle%60/%60used%60%20static%20is%20only%20present%20in%20output%20%E2%80%A6/near/275599972" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> inquisitivecrystal <a href="https://zulip-archive.rust-lang.org/stream/245100-t-compiler/wg-prioritization/alerts/topic/.2347384.20.60no_mangle.60.2F.60used.60.20static.20is.20only.20present.20in.20output.20.E2.80.A6.html#275599972">(Mar 17 2022 at 02:07)</a>:</h4>
<p>No one seems to be entirely sure of what actually happened. The most compelling explanation I've heard is that we've switched from emitting llvm.used to llvm.compiler.used on all platforms, and the fix would be to only do that on ELF and still emit llvm.used everywhere else.</p>



<a name="275600043"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/245100-t-compiler/wg-prioritization/alerts/topic/%2347384%20%60no_mangle%60/%60used%60%20static%20is%20only%20present%20in%20output%20%E2%80%A6/near/275600043" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> inquisitivecrystal <a href="https://zulip-archive.rust-lang.org/stream/245100-t-compiler/wg-prioritization/alerts/topic/.2347384.20.60no_mangle.60.2F.60used.60.20static.20is.20only.20present.20in.20output.20.E2.80.A6.html#275600043">(Mar 17 2022 at 02:09)</a>:</h4>
<p>The reason there isn't a clean, separate issue is that I at least don't have enough clue what's going on to file one. I don't know precisely what broke and I don't know what the precise failure cases are. If anyone does, they haven't filed a new issue either. We could certainly ask them to if need be.</p>



<a name="275600146"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/245100-t-compiler/wg-prioritization/alerts/topic/%2347384%20%60no_mangle%60/%60used%60%20static%20is%20only%20present%20in%20output%20%E2%80%A6/near/275600146" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> inquisitivecrystal <a href="https://zulip-archive.rust-lang.org/stream/245100-t-compiler/wg-prioritization/alerts/topic/.2347384.20.60no_mangle.60.2F.60used.60.20static.20is.20only.20present.20in.20output.20.E2.80.A6.html#275600146">(Mar 17 2022 at 02:10)</a>:</h4>
<p>But it sounds like the actual regression that the lang team has identified broke a lot of things, and thus should probably be considered at least P-high and probably P-critical. We didn't guarantee the only behavior, but a decent portion of the ecosystem was relying on it to do things that are hard to do any other way.</p>



<a name="275600190"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/245100-t-compiler/wg-prioritization/alerts/topic/%2347384%20%60no_mangle%60/%60used%60%20static%20is%20only%20present%20in%20output%20%E2%80%A6/near/275600190" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> inquisitivecrystal <a href="https://zulip-archive.rust-lang.org/stream/245100-t-compiler/wg-prioritization/alerts/topic/.2347384.20.60no_mangle.60.2F.60used.60.20static.20is.20only.20present.20in.20output.20.E2.80.A6.html#275600190">(Mar 17 2022 at 02:11)</a>:</h4>
<p>I don't know how to be helpful beyond "this needs investigating", given that I don't have enough visibility of the problem.</p>



<a name="275620431"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/245100-t-compiler/wg-prioritization/alerts/topic/%2347384%20%60no_mangle%60/%60used%60%20static%20is%20only%20present%20in%20output%20%E2%80%A6/near/275620431" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> apiraino <a href="https://zulip-archive.rust-lang.org/stream/245100-t-compiler/wg-prioritization/alerts/topic/.2347384.20.60no_mangle.60.2F.60used.60.20static.20is.20only.20present.20in.20output.20.E2.80.A6.html#275620431">(Mar 17 2022 at 08:37)</a>:</h4>
<p>thank you so much <span class="user-mention" data-user-id="417924">@inquisitivecrystal</span> for your help (I feel so sorry about these bumps getting in the way, I could have helped more). Today I will keep a "lighter" agenda to besure this gets discussed with the proper context.</p>
<p>side note: last week the US <a href="https://www.timeanddate.com/time/change/usa">switched to DST</a> so the t-compiler meeting will be at <time datetime="2022-03-17T14:00:00Z">2022-03-17T10:00:00-04:00</time></p>



<a name="275648630"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/245100-t-compiler/wg-prioritization/alerts/topic/%2347384%20%60no_mangle%60/%60used%60%20static%20is%20only%20present%20in%20output%20%E2%80%A6/near/275648630" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> inquisitivecrystal <a href="https://zulip-archive.rust-lang.org/stream/245100-t-compiler/wg-prioritization/alerts/topic/.2347384.20.60no_mangle.60.2F.60used.60.20static.20is.20only.20present.20in.20output.20.E2.80.A6.html#275648630">(Mar 17 2022 at 13:04)</a>:</h4>
<p>I apologize for my earlier irritation. I've calmed down now.</p>



<a name="275648757"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/245100-t-compiler/wg-prioritization/alerts/topic/%2347384%20%60no_mangle%60/%60used%60%20static%20is%20only%20present%20in%20output%20%E2%80%A6/near/275648757" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> apiraino <a href="https://zulip-archive.rust-lang.org/stream/245100-t-compiler/wg-prioritization/alerts/topic/.2347384.20.60no_mangle.60.2F.60used.60.20static.20is.20only.20present.20in.20output.20.E2.80.A6.html#275648757">(Mar 17 2022 at 13:05)</a>:</h4>
<p>no need to :) it's totally understable</p>



<hr><p>Last updated: Apr 12 2022 at 20:01 UTC</p>
</html>