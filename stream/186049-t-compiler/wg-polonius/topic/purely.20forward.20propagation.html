<html>
<head><meta charset="utf-8"><title>purely forward propagation · t-compiler/wg-polonius · Zulip Chat Archive</title></head>
<h2>Stream: <a href="https://zulip-archive.rust-lang.org/stream/186049-t-compiler/wg-polonius/index.html">t-compiler/wg-polonius</a></h2>
<h3>Topic: <a href="https://zulip-archive.rust-lang.org/stream/186049-t-compiler/wg-polonius/topic/purely.20forward.20propagation.html">purely forward propagation</a></h3>

<hr>

<base href="https://rust-lang.zulipchat.com">

<head><link href="https://zulip-archive.rust-lang.org/style.css" rel="stylesheet"></head>

<a name="250938488"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/186049-t-compiler/wg-polonius/topic/purely%20forward%20propagation/near/250938488" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/186049-t-compiler/wg-polonius/topic/purely.20forward.20propagation.html#250938488">(Aug 27 2021 at 14:20)</a>:</h4>
<p>Starting a topic</p>



<a name="250939001"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/186049-t-compiler/wg-polonius/topic/purely%20forward%20propagation/near/250939001" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/186049-t-compiler/wg-polonius/topic/purely.20forward.20propagation.html#250939001">(Aug 27 2021 at 14:24)</a>:</h4>
<p>I suppose I could prototype in souffle format :)</p>



<a name="250939011"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/186049-t-compiler/wg-polonius/topic/purely%20forward%20propagation/near/250939011" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/186049-t-compiler/wg-polonius/topic/purely.20forward.20propagation.html#250939011">(Aug 27 2021 at 14:24)</a>:</h4>
<p>just to be contrary I'm using racket ;)</p>



<a name="250939037"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/186049-t-compiler/wg-polonius/topic/purely%20forward%20propagation/near/250939037" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/186049-t-compiler/wg-polonius/topic/purely.20forward.20propagation.html#250939037">(Aug 27 2021 at 14:24)</a>:</h4>
<p>(I love racket now)</p>



<a name="250939121"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/186049-t-compiler/wg-polonius/topic/purely%20forward%20propagation/near/250939121" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/186049-t-compiler/wg-polonius/topic/purely.20forward.20propagation.html#250939121">(Aug 27 2021 at 14:25)</a>:</h4>
<p>in all seriousness, <span class="user-mention" data-user-id="116113">@lqd</span>, did we land the current rules in the polonius book?</p>



<a name="250939143"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/186049-t-compiler/wg-polonius/topic/purely%20forward%20propagation/near/250939143" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/186049-t-compiler/wg-polonius/topic/purely.20forward.20propagation.html#250939143">(Aug 27 2021 at 14:25)</a>:</h4>
<p>I feel like I asked you this last sprint</p>



<a name="250939180"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/186049-t-compiler/wg-polonius/topic/purely%20forward%20propagation/near/250939180" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/186049-t-compiler/wg-polonius/topic/purely.20forward.20propagation.html#250939180">(Aug 27 2021 at 14:25)</a>:</h4>
<p><a href="https://rust-lang.github.io/polonius/rules/loans.html">https://rust-lang.github.io/polonius/rules/loans.html</a></p>



<a name="250939282"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/186049-t-compiler/wg-polonius/topic/purely%20forward%20propagation/near/250939282" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> lqd <a href="https://zulip-archive.rust-lang.org/stream/186049-t-compiler/wg-polonius/topic/purely.20forward.20propagation.html#250939282">(Aug 27 2021 at 14:26)</a>:</h4>
<p>yes, apart from the disjunctive rules about placeholder liveness, for which there are two WIP PRs, and a 3rd one will probably needed to replace one of these 2 once we have what we need in datafrog</p>



<a name="250939357"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/186049-t-compiler/wg-polonius/topic/purely%20forward%20propagation/near/250939357" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/186049-t-compiler/wg-polonius/topic/purely.20forward.20propagation.html#250939357">(Aug 27 2021 at 14:26)</a>:</h4>
<p>I guess <a href="https://hackmd.io/CGMNjt1hR_qYtsR9hgdGmw">https://hackmd.io/CGMNjt1hR_qYtsR9hgdGmw</a> is still up to date</p>



<a name="250939361"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/186049-t-compiler/wg-polonius/topic/purely%20forward%20propagation/near/250939361" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> lqd <a href="https://zulip-archive.rust-lang.org/stream/186049-t-compiler/wg-polonius/topic/purely.20forward.20propagation.html#250939361">(Aug 27 2021 at 14:26)</a>:</h4>
<p>(there maybe some slight difference in nomenclature on some internal relations; or the absence of the illegal subset relations rules in the book)</p>



<a name="250939367"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/186049-t-compiler/wg-polonius/topic/purely%20forward%20propagation/near/250939367" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/186049-t-compiler/wg-polonius/topic/purely.20forward.20propagation.html#250939367">(Aug 27 2021 at 14:26)</a>:</h4>
<p>(as well)</p>



<a name="250939697"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/186049-t-compiler/wg-polonius/topic/purely%20forward%20propagation/near/250939697" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> lqd <a href="https://zulip-archive.rust-lang.org/stream/186049-t-compiler/wg-polonius/topic/purely.20forward.20propagation.html#250939697">(Aug 27 2021 at 14:29)</a>:</h4>
<p>some questions I had just thinking about the idea (so they may become moot once we have more details):</p>
<ul>
<li>we remember that propagating subsets is important, and that's currently done using liveness (i.e. liveness is not only used to detect errors in the 3-point formulation). what, if anything, is replacing that</li>
<li>(I'm imagining loan invalidations to be propagated in the CFG, and potential additional loan invalidations of a loan that was invalidated ealier, would be a no-op rather than an error ?)</li>
</ul>



<a name="250939924"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/186049-t-compiler/wg-polonius/topic/purely%20forward%20propagation/near/250939924" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/186049-t-compiler/wg-polonius/topic/purely.20forward.20propagation.html#250939924">(Aug 27 2021 at 14:30)</a>:</h4>
<p>re: subsets, a good question, I imagine that the "placeholder loan" concept might replace that</p>



<a name="250939933"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/186049-t-compiler/wg-polonius/topic/purely%20forward%20propagation/near/250939933" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> lqd <a href="https://zulip-archive.rust-lang.org/stream/186049-t-compiler/wg-polonius/topic/purely.20forward.20propagation.html#250939933">(Aug 27 2021 at 14:30)</a>:</h4>
<p><span class="user-mention silent" data-user-id="116009">nikomatsakis</span> <a href="#narrow/stream/186049-t-compiler.2Fwg-polonius/topic/purely.20forward.20propagation/near/250939357">said</a>:</p>
<blockquote>
<p>I guess <a href="https://hackmd.io/CGMNjt1hR_qYtsR9hgdGmw">https://hackmd.io/CGMNjt1hR_qYtsR9hgdGmw</a> is still up to date</p>
</blockquote>
<p>this one is the most up to date, as I have added the actual subset errors rules we use</p>



<a name="250939966"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/186049-t-compiler/wg-polonius/topic/purely%20forward%20propagation/near/250939966" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/186049-t-compiler/wg-polonius/topic/purely.20forward.20propagation.html#250939966">(Aug 27 2021 at 14:30)</a>:</h4>
<p>I should also refresh my memory about the eq limitation</p>



<a name="250939983"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/186049-t-compiler/wg-polonius/topic/purely%20forward%20propagation/near/250939983" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/186049-t-compiler/wg-polonius/topic/purely.20forward.20propagation.html#250939983">(Aug 27 2021 at 14:30)</a>:</h4>
<p>I'll go read the privmsgs where you sent me all the context ;)</p>



<a name="250940006"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/186049-t-compiler/wg-polonius/topic/purely%20forward%20propagation/near/250940006" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> lqd <a href="https://zulip-archive.rust-lang.org/stream/186049-t-compiler/wg-polonius/topic/purely.20forward.20propagation.html#250940006">(Aug 27 2021 at 14:31)</a>:</h4>
<p>:)</p>



<a name="250940036"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/186049-t-compiler/wg-polonius/topic/purely%20forward%20propagation/near/250940036" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> lqd <a href="https://zulip-archive.rust-lang.org/stream/186049-t-compiler/wg-polonius/topic/purely.20forward.20propagation.html#250940036">(Aug 27 2021 at 14:31)</a>:</h4>
<p>(the book still references only the placeholder loans approach, but it's still used in the location-insensitive variant so it's not unusual)</p>



<a name="250940069"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/186049-t-compiler/wg-polonius/topic/purely%20forward%20propagation/near/250940069" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/186049-t-compiler/wg-polonius/topic/purely.20forward.20propagation.html#250940069">(Aug 27 2021 at 14:31)</a>:</h4>
<p>the example:</p>



<a name="250940076"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/186049-t-compiler/wg-polonius/topic/purely%20forward%20propagation/near/250940076" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/186049-t-compiler/wg-polonius/topic/purely.20forward.20propagation.html#250940076">(Aug 27 2021 at 14:31)</a>:</h4>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="cp">#![feature(nll)]</span><span class="w"></span>
<span class="cp">#![allow(unused_variables, unused_assignments)]</span><span class="w"></span>

<span class="k">fn</span> <span class="nf">random_bool</span><span class="p">()</span><span class="w"> </span>-&gt; <span class="kt">bool</span> <span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="fm">unimplemented!</span><span class="p">()</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>

<span class="k">fn</span> <span class="nf">main</span><span class="p">()</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="k">mut</span><span class="w"> </span><span class="n">x</span>: <span class="p">(</span><span class="o">&amp;</span><span class="kt">u32</span><span class="p">,)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="o">&amp;</span><span class="mi">0</span><span class="p">,);</span><span class="w"></span>
<span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="k">mut</span><span class="w"> </span><span class="n">y</span>: <span class="p">(</span><span class="o">&amp;</span><span class="kt">u32</span><span class="p">,)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="o">&amp;</span><span class="mi">1</span><span class="p">,);</span><span class="w"></span>
<span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="k">mut</span><span class="w"> </span><span class="n">z</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">2</span><span class="p">;</span><span class="w"></span>

<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="n">random_bool</span><span class="p">()</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">        </span><span class="n">y</span><span class="p">.</span><span class="mi">0</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">x</span><span class="p">.</span><span class="mi">0</span><span class="p">;</span><span class="w"> </span><span class="c1">// creates `'x: 'y` subset relation</span>
<span class="w">    </span><span class="p">}</span><span class="w"></span>

<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="n">random_bool</span><span class="p">()</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">        </span><span class="n">x</span><span class="p">.</span><span class="mi">0</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">&amp;</span><span class="n">z</span><span class="p">;</span><span class="w"> </span><span class="c1">// creates {L0} in 'x constraint</span>
<span class="w">        </span><span class="c1">// this point, we have `'x: 'y` and `{L0} in `'x`, so we also have `{L0} in 'y`</span>
<span class="w">        </span><span class="nb">drop</span><span class="p">(</span><span class="n">x</span><span class="p">.</span><span class="mi">0</span><span class="p">);</span><span class="w"></span>
<span class="w">    </span><span class="p">}</span><span class="w"></span>

<span class="w">    </span><span class="n">z</span><span class="w"> </span><span class="o">+=</span><span class="w"> </span><span class="mi">1</span><span class="p">;</span><span class="w"> </span><span class="c1">// polonius flags an (unnecessary) error</span>

<span class="w">    </span><span class="nb">drop</span><span class="p">(</span><span class="n">y</span><span class="p">.</span><span class="mi">0</span><span class="p">);</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>
</code></pre></div>



<a name="250940320"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/186049-t-compiler/wg-polonius/topic/purely%20forward%20propagation/near/250940320" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/186049-t-compiler/wg-polonius/topic/purely.20forward.20propagation.html#250940320">(Aug 27 2021 at 14:33)</a>:</h4>
<p>I think indeed that the approach I have in mind does not flag an error here</p>



<a name="250940340"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/186049-t-compiler/wg-polonius/topic/purely%20forward%20propagation/near/250940340" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/186049-t-compiler/wg-polonius/topic/purely.20forward.20propagation.html#250940340">(Aug 27 2021 at 14:33)</a>:</h4>
<p>but let me try to sketch it first :P</p>



<a name="250940346"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/186049-t-compiler/wg-polonius/topic/purely%20forward%20propagation/near/250940346" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/186049-t-compiler/wg-polonius/topic/purely.20forward.20propagation.html#250940346">(Aug 27 2021 at 14:33)</a>:</h4>
<p>hackmd: <a href="https://hackmd.io/KpK0ICQOQLSPxIcNIlhkJQ">https://hackmd.io/KpK0ICQOQLSPxIcNIlhkJQ</a></p>



<a name="250940349"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/186049-t-compiler/wg-polonius/topic/purely%20forward%20propagation/near/250940349" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> lqd <a href="https://zulip-archive.rust-lang.org/stream/186049-t-compiler/wg-polonius/topic/purely.20forward.20propagation.html#250940349">(Aug 27 2021 at 14:33)</a>:</h4>
<p>:)</p>



<a name="250940724"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/186049-t-compiler/wg-polonius/topic/purely%20forward%20propagation/near/250940724" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/186049-t-compiler/wg-polonius/topic/purely.20forward.20propagation.html#250940724">(Aug 27 2021 at 14:36)</a>:</h4>
<p>On a (potentially?) related note, I was reading this paper: <a href="https://dl.acm.org/doi/abs/10.1145/3409006">https://dl.acm.org/doi/abs/10.1145/3409006</a></p>



<a name="250940728"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/186049-t-compiler/wg-polonius/topic/purely%20forward%20propagation/near/250940728" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/186049-t-compiler/wg-polonius/topic/purely.20forward.20propagation.html#250940728">(Aug 27 2021 at 14:36)</a>:</h4>
<p>it's very good</p>



<a name="250940803"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/186049-t-compiler/wg-polonius/topic/purely%20forward%20propagation/near/250940803" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/186049-t-compiler/wg-polonius/topic/purely.20forward.20propagation.html#250940803">(Aug 27 2021 at 14:36)</a>:</h4>
<p>big props to Lionel Parreaux :)</p>



<a name="250940895"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/186049-t-compiler/wg-polonius/topic/purely%20forward%20propagation/near/250940895" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Dylan MacKenzie (ecstatic-morse) <a href="https://zulip-archive.rust-lang.org/stream/186049-t-compiler/wg-polonius/topic/purely.20forward.20propagation.html#250940895">(Aug 27 2021 at 14:36)</a>:</h4>
<blockquote>
<p>no abstract algebra is inflicted on readers.</p>
</blockquote>



<a name="250941119"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/186049-t-compiler/wg-polonius/topic/purely%20forward%20propagation/near/250941119" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> lqd <a href="https://zulip-archive.rust-lang.org/stream/186049-t-compiler/wg-polonius/topic/purely.20forward.20propagation.html#250941119">(Aug 27 2021 at 14:38)</a>:</h4>
<p>I sent you this paper a while back</p>



<a name="250941147"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/186049-t-compiler/wg-polonius/topic/purely%20forward%20propagation/near/250941147" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/186049-t-compiler/wg-polonius/topic/purely.20forward.20propagation.html#250941147">(Aug 27 2021 at 14:38)</a>:</h4>
<p>ha! well, I independently rediscovered it then</p>



<a name="250941167"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/186049-t-compiler/wg-polonius/topic/purely%20forward%20propagation/near/250941167" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> lqd <a href="https://zulip-archive.rust-lang.org/stream/186049-t-compiler/wg-polonius/topic/purely.20forward.20propagation.html#250941167">(Aug 27 2021 at 14:38)</a>:</h4>
<p>and the other more comprehensive one</p>



<a name="250941172"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/186049-t-compiler/wg-polonius/topic/purely%20forward%20propagation/near/250941172" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/186049-t-compiler/wg-polonius/topic/purely.20forward.20propagation.html#250941172">(Aug 27 2021 at 14:38)</a>:</h4>
<p>I had read the thesis in the past and ... kind of ... grocked it</p>



<a name="250941174"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/186049-t-compiler/wg-polonius/topic/purely%20forward%20propagation/near/250941174" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> lqd <a href="https://zulip-archive.rust-lang.org/stream/186049-t-compiler/wg-polonius/topic/purely.20forward.20propagation.html#250941174">(Aug 27 2021 at 14:38)</a>:</h4>
<p>as well as the scala impl</p>



<a name="250941182"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/186049-t-compiler/wg-polonius/topic/purely%20forward%20propagation/near/250941182" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> lqd <a href="https://zulip-archive.rust-lang.org/stream/186049-t-compiler/wg-polonius/topic/purely.20forward.20propagation.html#250941182">(Aug 27 2021 at 14:38)</a>:</h4>
<p>right</p>



<a name="250941205"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/186049-t-compiler/wg-polonius/topic/purely%20forward%20propagation/near/250941205" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/186049-t-compiler/wg-polonius/topic/purely.20forward.20propagation.html#250941205">(Aug 27 2021 at 14:38)</a>:</h4>
<p>but I like Lionel's formulation better indeed :)</p>



<a name="250941239"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/186049-t-compiler/wg-polonius/topic/purely%20forward%20propagation/near/250941239" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> lqd <a href="https://zulip-archive.rust-lang.org/stream/186049-t-compiler/wg-polonius/topic/purely.20forward.20propagation.html#250941239">(Aug 27 2021 at 14:39)</a>:</h4>
<p>there was also another cute impl (cubiml) which does some things better than this one (and others, worse)</p>



<a name="250941242"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/186049-t-compiler/wg-polonius/topic/purely%20forward%20propagation/near/250941242" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/186049-t-compiler/wg-polonius/topic/purely.20forward.20propagation.html#250941242">(Aug 27 2021 at 14:39)</a>:</h4>
<p>I haven't decided yet whether I think it makes sense to apply to Rust, but one thing that he covers which I thought was interesting</p>



<a name="250941260"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/186049-t-compiler/wg-polonius/topic/purely%20forward%20propagation/near/250941260" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/186049-t-compiler/wg-polonius/topic/purely.20forward.20propagation.html#250941260">(Aug 27 2021 at 14:39)</a>:</h4>
<p>was the idea of using universes (he calls them 'levels') to do let generalization</p>



<a name="250941296"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/186049-t-compiler/wg-polonius/topic/purely%20forward%20propagation/near/250941296" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/186049-t-compiler/wg-polonius/topic/purely.20forward.20propagation.html#250941296">(Aug 27 2021 at 14:39)</a>:</h4>
<p>I think that could be very useful for us with closures</p>



<a name="250941322"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/186049-t-compiler/wg-polonius/topic/purely%20forward%20propagation/near/250941322" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> lqd <a href="https://zulip-archive.rust-lang.org/stream/186049-t-compiler/wg-polonius/topic/purely.20forward.20propagation.html#250941322">(Aug 27 2021 at 14:39)</a>:</h4>
<p>nice :)</p>



<a name="250941325"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/186049-t-compiler/wg-polonius/topic/purely%20forward%20propagation/near/250941325" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/186049-t-compiler/wg-polonius/topic/purely.20forward.20propagation.html#250941325">(Aug 27 2021 at 14:39)</a>:</h4>
<p>(apparently an Oleg innovation?)</p>



<a name="250941399"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/186049-t-compiler/wg-polonius/topic/purely%20forward%20propagation/near/250941399" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/186049-t-compiler/wg-polonius/topic/purely.20forward.20propagation.html#250941399">(Aug 27 2021 at 14:40)</a>:</h4>
<p>I had idly mused about the connection at some point but never thought too much about it. It makes total sense.</p>



<a name="250941472"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/186049-t-compiler/wg-polonius/topic/purely%20forward%20propagation/near/250941472" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/186049-t-compiler/wg-polonius/topic/purely.20forward.20propagation.html#250941472">(Aug 27 2021 at 14:40)</a>:</h4>
<p>the Lionel formulation kind of reminds me of the subtype checker we had <em>before</em> we adopted our current approach</p>



<a name="250941487"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/186049-t-compiler/wg-polonius/topic/purely%20forward%20propagation/near/250941487" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> lqd <a href="https://zulip-archive.rust-lang.org/stream/186049-t-compiler/wg-polonius/topic/purely.20forward.20propagation.html#250941487">(Aug 27 2021 at 14:40)</a>:</h4>
<p>15-part series on cubiml, with some analysis and simplifications of Lionel's work, <a href="https://blog.polybdenum.com/2020/10/17/subtype-inference-by-example-part-15-type-annotations.html">https://blog.polybdenum.com/2020/10/17/subtype-inference-by-example-part-15-type-annotations.html</a></p>



<a name="250941500"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/186049-t-compiler/wg-polonius/topic/purely%20forward%20propagation/near/250941500" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/186049-t-compiler/wg-polonius/topic/purely.20forward.20propagation.html#250941500">(Aug 27 2021 at 14:40)</a>:</h4>
<p>which also computed upper- and lower- bunds on each type variable, but wasn't as smart in other ways</p>



<a name="250941531"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/186049-t-compiler/wg-polonius/topic/purely%20forward%20propagation/near/250941531" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/186049-t-compiler/wg-polonius/topic/purely.20forward.20propagation.html#250941531">(Aug 27 2021 at 14:41)</a>:</h4>
<p>ok thanks :)</p>



<a name="250941543"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/186049-t-compiler/wg-polonius/topic/purely%20forward%20propagation/near/250941543" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/186049-t-compiler/wg-polonius/topic/purely.20forward.20propagation.html#250941543">(Aug 27 2021 at 14:41)</a>:</h4>
<p>sorry I'm so slow to catch up to your citations! :)</p>



<a name="250941632"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/186049-t-compiler/wg-polonius/topic/purely%20forward%20propagation/near/250941632" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/186049-t-compiler/wg-polonius/topic/purely.20forward.20propagation.html#250941632">(Aug 27 2021 at 14:42)</a>:</h4>
<p>I wish those blog posts were in PDF form</p>



<a name="250941645"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/186049-t-compiler/wg-polonius/topic/purely%20forward%20propagation/near/250941645" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> lqd <a href="https://zulip-archive.rust-lang.org/stream/186049-t-compiler/wg-polonius/topic/purely.20forward.20propagation.html#250941645">(Aug 27 2021 at 14:42)</a>:</h4>
<p><span aria-label="joy" class="emoji emoji-1f602" role="img" title="joy">:joy:</span></p>



<a name="250941654"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/186049-t-compiler/wg-polonius/topic/purely%20forward%20propagation/near/250941654" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/186049-t-compiler/wg-polonius/topic/purely.20forward.20propagation.html#250941654">(Aug 27 2021 at 14:42)</a>:</h4>
<p>I guess I can print them out</p>



<a name="250941705"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/186049-t-compiler/wg-polonius/topic/purely%20forward%20propagation/near/250941705" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> lqd <a href="https://zulip-archive.rust-lang.org/stream/186049-t-compiler/wg-polonius/topic/purely.20forward.20propagation.html#250941705">(Aug 27 2021 at 14:42)</a>:</h4>
<p>levels here are debruijn levels, right ?</p>



<a name="250941741"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/186049-t-compiler/wg-polonius/topic/purely%20forward%20propagation/near/250941741" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/186049-t-compiler/wg-polonius/topic/purely.20forward.20propagation.html#250941741">(Aug 27 2021 at 14:42)</a>:</h4>
<p>what they call levels are equivalent to universes from what I can tell</p>



<a name="250941763"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/186049-t-compiler/wg-polonius/topic/purely%20forward%20propagation/near/250941763" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/186049-t-compiler/wg-polonius/topic/purely.20forward.20propagation.html#250941763">(Aug 27 2021 at 14:42)</a>:</h4>
<p>I guess they are also debruijn levels</p>



<a name="250941780"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/186049-t-compiler/wg-polonius/topic/purely%20forward%20propagation/near/250941780" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/186049-t-compiler/wg-polonius/topic/purely.20forward.20propagation.html#250941780">(Aug 27 2021 at 14:42)</a>:</h4>
<p>i.e., as you pass a "forall" you increment it :)</p>



<a name="250941809"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/186049-t-compiler/wg-polonius/topic/purely%20forward%20propagation/near/250941809" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/186049-t-compiler/wg-polonius/topic/purely.20forward.20propagation.html#250941809">(Aug 27 2021 at 14:43)</a>:</h4>
<p>I've never heard the term "debruijn level"</p>



<a name="250941813"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/186049-t-compiler/wg-polonius/topic/purely%20forward%20propagation/near/250941813" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> lqd <a href="https://zulip-archive.rust-lang.org/stream/186049-t-compiler/wg-polonius/topic/purely.20forward.20propagation.html#250941813">(Aug 27 2021 at 14:43)</a>:</h4>
<p>yeah :)</p>



<a name="250941818"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/186049-t-compiler/wg-polonius/topic/purely%20forward%20propagation/near/250941818" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/186049-t-compiler/wg-polonius/topic/purely.20forward.20propagation.html#250941818">(Aug 27 2021 at 14:43)</a>:</h4>
<p>so I am sort of guessing :)</p>



<a name="250941952"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/186049-t-compiler/wg-polonius/topic/purely%20forward%20propagation/near/250941952" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Dylan MacKenzie (ecstatic-morse) <a href="https://zulip-archive.rust-lang.org/stream/186049-t-compiler/wg-polonius/topic/purely.20forward.20propagation.html#250941952">(Aug 27 2021 at 14:44)</a>:</h4>
<p>Lionel's paper references <a href="http://okmij.org/ftp/ML/generalization.html#levels">this blog post</a> for a more in-depth description of levels</p>



<a name="250941966"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/186049-t-compiler/wg-polonius/topic/purely%20forward%20propagation/near/250941966" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> lqd <a href="https://zulip-archive.rust-lang.org/stream/186049-t-compiler/wg-polonius/topic/purely.20forward.20propagation.html#250941966">(Aug 27 2021 at 14:44)</a>:</h4>
<p>I need to go back to find my bookmarks of kmett's and kovacs literature</p>



<a name="250942096"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/186049-t-compiler/wg-polonius/topic/purely%20forward%20propagation/near/250942096" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/186049-t-compiler/wg-polonius/topic/purely.20forward.20propagation.html#250942096">(Aug 27 2021 at 14:45)</a>:</h4>
<p>On another unrelated note, this library is cool:</p>



<a name="250942113"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/186049-t-compiler/wg-polonius/topic/purely%20forward%20propagation/near/250942113" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/186049-t-compiler/wg-polonius/topic/purely.20forward.20propagation.html#250942113">(Aug 27 2021 at 14:45)</a>:</h4>
<p><a href="https://docs.rs/egg/0.6.0/egg/">https://docs.rs/egg/0.6.0/egg/</a></p>



<a name="250942168"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/186049-t-compiler/wg-polonius/topic/purely%20forward%20propagation/near/250942168" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/186049-t-compiler/wg-polonius/topic/purely.20forward.20propagation.html#250942168">(Aug 27 2021 at 14:45)</a>:</h4>
<p>I am pondering if we can use it for associated types -- although it seems very similar to an approach I consdiered and rejected in the past</p>



<a name="250942195"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/186049-t-compiler/wg-polonius/topic/purely%20forward%20propagation/near/250942195" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/186049-t-compiler/wg-polonius/topic/purely.20forward.20propagation.html#250942195">(Aug 27 2021 at 14:45)</a>:</h4>
<p>but maybe I was wrong</p>



<a name="250942361"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/186049-t-compiler/wg-polonius/topic/purely%20forward%20propagation/near/250942361" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> lqd <a href="https://zulip-archive.rust-lang.org/stream/186049-t-compiler/wg-polonius/topic/purely.20forward.20propagation.html#250942361">(Aug 27 2021 at 14:46)</a>:</h4>
<p>yeah eqsat is dope, mention them to eddy and eternaleye if you want to have fun convos :)</p>



<a name="250942493"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/186049-t-compiler/wg-polonius/topic/purely%20forward%20propagation/near/250942493" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/186049-t-compiler/wg-polonius/topic/purely.20forward.20propagation.html#250942493">(Aug 27 2021 at 14:47)</a>:</h4>
<p>at some point I was trying to work with this algorithm, congruence closure</p>



<a name="250942520"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/186049-t-compiler/wg-polonius/topic/purely%20forward%20propagation/near/250942520" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/186049-t-compiler/wg-polonius/topic/purely.20forward.20propagation.html#250942520">(Aug 27 2021 at 14:47)</a>:</h4>
<p>which is sort of like a building block for eqsat from what I can tell</p>



<a name="250942601"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/186049-t-compiler/wg-polonius/topic/purely%20forward%20propagation/near/250942601" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/186049-t-compiler/wg-polonius/topic/purely.20forward.20propagation.html#250942601">(Aug 27 2021 at 14:48)</a>:</h4>
<p>but it does <em>seem</em> like we could absolutely use eqsat, combined with a chalk-like approach</p>



<a name="250942620"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/186049-t-compiler/wg-polonius/topic/purely%20forward%20propagation/near/250942620" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/186049-t-compiler/wg-polonius/topic/purely.20forward.20propagation.html#250942620">(Aug 27 2021 at 14:48)</a>:</h4>
<p>to run through and keep adding in "normalizations"</p>



<a name="250942629"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/186049-t-compiler/wg-polonius/topic/purely%20forward%20propagation/near/250942629" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/186049-t-compiler/wg-polonius/topic/purely.20forward.20propagation.html#250942629">(Aug 27 2021 at 14:48)</a>:</h4>
<p>until a fixed point is reached</p>



<a name="250942659"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/186049-t-compiler/wg-polonius/topic/purely%20forward%20propagation/near/250942659" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/186049-t-compiler/wg-polonius/topic/purely.20forward.20propagation.html#250942659">(Aug 27 2021 at 14:48)</a>:</h4>
<p>I'm not sure if that will potentially run infinitely</p>



<a name="250942661"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/186049-t-compiler/wg-polonius/topic/purely%20forward%20propagation/near/250942661" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> lqd <a href="https://zulip-archive.rust-lang.org/stream/186049-t-compiler/wg-polonius/topic/purely.20forward.20propagation.html#250942661">(Aug 27 2021 at 14:48)</a>:</h4>
<p>(IIRC kixiron is trying to use egg in vmware's compiler which I thought was differential-datalog, but maybe it's a different one)</p>



<a name="250942679"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/186049-t-compiler/wg-polonius/topic/purely%20forward%20propagation/near/250942679" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/186049-t-compiler/wg-polonius/topic/purely.20forward.20propagation.html#250942679">(Aug 27 2021 at 14:48)</a>:</h4>
<p>I think that the eqsat graph's hash-consing <em>may</em> help here</p>



<a name="250942681"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/186049-t-compiler/wg-polonius/topic/purely%20forward%20propagation/near/250942681" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Domenic Quirl <a href="https://zulip-archive.rust-lang.org/stream/186049-t-compiler/wg-polonius/topic/purely.20forward.20propagation.html#250942681">(Aug 27 2021 at 14:48)</a>:</h4>
<p>I know someone who uses <code>egg</code> for some optimization work, and his conclusion was</p>
<blockquote>
<p>egg allows for propagating data upwards with incredible ease, something that’s traditionally rather boilerplate-full, but propagating data downwards is tricky because you aren’t looking at a single instance of something, the same eclass used as a function parameter somewhere could also be used in a completely different context, so assumptions can’t be universally made about things below you based on what’s above</p>
</blockquote>



<a name="250942713"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/186049-t-compiler/wg-polonius/topic/purely%20forward%20propagation/near/250942713" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Domenic Quirl <a href="https://zulip-archive.rust-lang.org/stream/186049-t-compiler/wg-polonius/topic/purely.20forward.20propagation.html#250942713">(Aug 27 2021 at 14:48)</a>:</h4>
<p>this is the same kix btw</p>



<a name="250942775"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/186049-t-compiler/wg-polonius/topic/purely%20forward%20propagation/near/250942775" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/186049-t-compiler/wg-polonius/topic/purely.20forward.20propagation.html#250942775">(Aug 27 2021 at 14:49)</a>:</h4>
<p>that makes sense</p>



<a name="250942802"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/186049-t-compiler/wg-polonius/topic/purely%20forward%20propagation/near/250942802" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/186049-t-compiler/wg-polonius/topic/purely.20forward.20propagation.html#250942802">(Aug 27 2021 at 14:49)</a>:</h4>
<p>for the purposes I need, I don't know that this is a problem</p>



<a name="250942820"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/186049-t-compiler/wg-polonius/topic/purely%20forward%20propagation/near/250942820" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Domenic Quirl <a href="https://zulip-archive.rust-lang.org/stream/186049-t-compiler/wg-polonius/topic/purely.20forward.20propagation.html#250942820">(Aug 27 2021 at 14:49)</a>:</h4>
<p>afaik it's related to optimization of the dataflow code they generate from ddlog</p>



<a name="250942834"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/186049-t-compiler/wg-polonius/topic/purely%20forward%20propagation/near/250942834" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> lqd <a href="https://zulip-archive.rust-lang.org/stream/186049-t-compiler/wg-polonius/topic/purely.20forward.20propagation.html#250942834">(Aug 27 2021 at 14:49)</a>:</h4>
<p>IIRC cycles are currently problematic with it</p>



<a name="250943029"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/186049-t-compiler/wg-polonius/topic/purely%20forward%20propagation/near/250943029" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Domenic Quirl <a href="https://zulip-archive.rust-lang.org/stream/186049-t-compiler/wg-polonius/topic/purely.20forward.20propagation.html#250943029">(Aug 27 2021 at 14:50)</a>:</h4>
<p>they suggested for downwards to</p>
<blockquote>
<p>duplicate the graph underneath the invocation site, rewrite it and union it with the invocation site</p>
</blockquote>



<a name="250944601"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/186049-t-compiler/wg-polonius/topic/purely%20forward%20propagation/near/250944601" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/186049-t-compiler/wg-polonius/topic/purely.20forward.20propagation.html#250944601">(Aug 27 2021 at 15:00)</a>:</h4>
<p>I'm trying to bring back into cache now</p>



<a name="250944661"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/186049-t-compiler/wg-polonius/topic/purely%20forward%20propagation/near/250944661" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/186049-t-compiler/wg-polonius/topic/purely.20forward.20propagation.html#250944661">(Aug 27 2021 at 15:00)</a>:</h4>
<p>some of the canonical Polonius examples :)</p>



<a name="250944821"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/186049-t-compiler/wg-polonius/topic/purely%20forward%20propagation/near/250944821" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> lqd <a href="https://zulip-archive.rust-lang.org/stream/186049-t-compiler/wg-polonius/topic/purely.20forward.20propagation.html#250944821">(Aug 27 2021 at 15:01)</a>:</h4>
<p><a href="https://github.com/rust-lang/polonius/blob/master/inputs/issue-47680/issue-47680.rs">https://github.com/rust-lang/polonius/blob/master/inputs/issue-47680/issue-47680.rs</a> and <a href="https://github.com/rust-lang/polonius/blob/master/inputs/vec-push-ref/vec-push-ref.rs">https://github.com/rust-lang/polonius/blob/master/inputs/vec-push-ref/vec-push-ref.rs</a> at the very least</p>



<a name="250944871"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/186049-t-compiler/wg-polonius/topic/purely%20forward%20propagation/near/250944871" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/186049-t-compiler/wg-polonius/topic/purely.20forward.20propagation.html#250944871">(Aug 27 2021 at 15:01)</a>:</h4>
<p>yeah</p>



<a name="250944887"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/186049-t-compiler/wg-polonius/topic/purely%20forward%20propagation/near/250944887" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/186049-t-compiler/wg-polonius/topic/purely.20forward.20propagation.html#250944887">(Aug 27 2021 at 15:02)</a>:</h4>
<p>those are a good two to start with</p>



<a name="250944941"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/186049-t-compiler/wg-polonius/topic/purely%20forward%20propagation/near/250944941" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/186049-t-compiler/wg-polonius/topic/purely.20forward.20propagation.html#250944941">(Aug 27 2021 at 15:02)</a>:</h4>
<p>I was just re-reading the early blog posts</p>



<a name="250944969"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/186049-t-compiler/wg-polonius/topic/purely%20forward%20propagation/near/250944969" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/186049-t-compiler/wg-polonius/topic/purely.20forward.20propagation.html#250944969">(Aug 27 2021 at 15:02)</a>:</h4>
<p>and getting lost in this <a href="https://github.com/rust-lang/rust/commit/50a3dd40ae8ae6494e55d5cfc29eafdb4172af52">grody syntax</a></p>



<a name="250944990"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/186049-t-compiler/wg-polonius/topic/purely%20forward%20propagation/near/250944990" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/186049-t-compiler/wg-polonius/topic/purely.20forward.20propagation.html#250944990">(Aug 27 2021 at 15:02)</a>:</h4>
<div class="codehilite"><pre><span></span><code>        #debug[&quot;parent of node %d is node %d&quot;, child_id, parent_id];
</code></pre></div>



<a name="250945032"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/186049-t-compiler/wg-polonius/topic/purely%20forward%20propagation/near/250945032" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/186049-t-compiler/wg-polonius/topic/purely.20forward.20propagation.html#250945032">(Aug 27 2021 at 15:02)</a>:</h4>
<div class="codehilite"><pre><span></span><code>    let fn_cx = alt fk {
      visit::fk_item_fn(*) | visit::fk_method(*) | visit::fk_res(*) |
      visit::fk_ctor(*) {
        // Top-level functions are a root scope.
        {parent: some(id), closure_parent: some(id) with cx}
      }

      visit::fk_anon(*) | visit::fk_fn_block(*) {
        // Closures use the closure_parent.
        {parent: cx.closure_parent with cx}
      }
    };
</code></pre></div>



<a name="250945035"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/186049-t-compiler/wg-polonius/topic/purely%20forward%20propagation/near/250945035" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/186049-t-compiler/wg-polonius/topic/purely.20forward.20propagation.html#250945035">(Aug 27 2021 at 15:02)</a>:</h4>
<p>heh</p>



<a name="250945091"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/186049-t-compiler/wg-polonius/topic/purely%20forward%20propagation/near/250945091" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> lqd <a href="https://zulip-archive.rust-lang.org/stream/186049-t-compiler/wg-polonius/topic/purely.20forward.20propagation.html#250945091">(Aug 27 2021 at 15:03)</a>:</h4>
<p>:D</p>



<a name="250945103"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/186049-t-compiler/wg-polonius/topic/purely%20forward%20propagation/near/250945103" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> lqd <a href="https://zulip-archive.rust-lang.org/stream/186049-t-compiler/wg-polonius/topic/purely.20forward.20propagation.html#250945103">(Aug 27 2021 at 15:03)</a>:</h4>
<p>so good</p>



<a name="250945284"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/186049-t-compiler/wg-polonius/topic/purely%20forward%20propagation/near/250945284" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> lqd <a href="https://zulip-archive.rust-lang.org/stream/186049-t-compiler/wg-polonius/topic/purely.20forward.20propagation.html#250945284">(Aug 27 2021 at 15:04)</a>:</h4>
<p>(<a href="https://github.com/lqd/borrow-check/blob/variant_prototype3/inputs/polonius-imprecision/polonius-imprecision.rs">https://github.com/lqd/borrow-check/blob/variant_prototype3/inputs/polonius-imprecision/polonius-imprecision.rs</a> is also interesting for the link to the eq adjacent examples, including the "unnecessary error" example posted above, and the <code>cfg_propagation_required</code>requiring subset propagation)</p>



<a name="250945452"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/186049-t-compiler/wg-polonius/topic/purely%20forward%20propagation/near/250945452" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/186049-t-compiler/wg-polonius/topic/purely.20forward.20propagation.html#250945452">(Aug 27 2021 at 15:06)</a>:</h4>
<p>Yeah, I had kind of forgotten all the polonius interesting-ness around subset propagation</p>



<a name="250945521"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/186049-t-compiler/wg-polonius/topic/purely%20forward%20propagation/near/250945521" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/186049-t-compiler/wg-polonius/topic/purely.20forward.20propagation.html#250945521">(Aug 27 2021 at 15:06)</a>:</h4>
<p>I'm trying to think why this is just ... not a thing in the other code I was writing</p>



<a name="250945591"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/186049-t-compiler/wg-polonius/topic/purely%20forward%20propagation/near/250945591" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/186049-t-compiler/wg-polonius/topic/purely.20forward.20propagation.html#250945591">(Aug 27 2021 at 15:06)</a>:</h4>
<p>probably because, like oxide, I was not doing inference, and it falls out from invariance otherwise</p>



<a name="250945963"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/186049-t-compiler/wg-polonius/topic/purely%20forward%20propagation/near/250945963" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> lqd <a href="https://zulip-archive.rust-lang.org/stream/186049-t-compiler/wg-polonius/topic/purely.20forward.20propagation.html#250945963">(Aug 27 2021 at 15:09)</a>:</h4>
<p>interesting</p>



<a name="250946147"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/186049-t-compiler/wg-polonius/topic/purely%20forward%20propagation/near/250946147" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> lqd <a href="https://zulip-archive.rust-lang.org/stream/186049-t-compiler/wg-polonius/topic/purely.20forward.20propagation.html#250946147">(Aug 27 2021 at 15:10)</a>:</h4>
<p>I probably should familiarize myself better with all their work and implementation, at the very least to see such differences. I do remember we talked about <em>some</em> with aatxe on a call years ago</p>



<a name="250946168"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/186049-t-compiler/wg-polonius/topic/purely%20forward%20propagation/near/250946168" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/186049-t-compiler/wg-polonius/topic/purely.20forward.20propagation.html#250946168">(Aug 27 2021 at 15:10)</a>:</h4>
<p>yes</p>



<a name="250946179"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/186049-t-compiler/wg-polonius/topic/purely%20forward%20propagation/near/250946179" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/186049-t-compiler/wg-polonius/topic/purely.20forward.20propagation.html#250946179">(Aug 27 2021 at 15:10)</a>:</h4>
<p>I remember puzzling over exactly this question</p>



<a name="250946214"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/186049-t-compiler/wg-polonius/topic/purely%20forward%20propagation/near/250946214" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/186049-t-compiler/wg-polonius/topic/purely.20forward.20propagation.html#250946214">(Aug 27 2021 at 15:11)</a>:</h4>
<p>which is what led us to the "unnecessary error" example in the first  place</p>



<a name="250946255"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/186049-t-compiler/wg-polonius/topic/purely%20forward%20propagation/near/250946255" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/186049-t-compiler/wg-polonius/topic/purely.20forward.20propagation.html#250946255">(Aug 27 2021 at 15:11)</a>:</h4>
<p>I am still wondering, as an aside</p>



<a name="250946288"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/186049-t-compiler/wg-polonius/topic/purely%20forward%20propagation/near/250946288" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/186049-t-compiler/wg-polonius/topic/purely.20forward.20propagation.html#250946288">(Aug 27 2021 at 15:11)</a>:</h4>
<p>my happiest result would be if this line of inquiry ultimately makes polonius unnecessary</p>



<a name="250946309"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/186049-t-compiler/wg-polonius/topic/purely%20forward%20propagation/near/250946309" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/186049-t-compiler/wg-polonius/topic/purely.20forward.20propagation.html#250946309">(Aug 27 2021 at 15:11)</a>:</h4>
<p>because the rules for subtyping and all the rest move into chalk and the type checker in general</p>



<a name="250946356"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/186049-t-compiler/wg-polonius/topic/purely%20forward%20propagation/near/250946356" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/186049-t-compiler/wg-polonius/topic/purely.20forward.20propagation.html#250946356">(Aug 27 2021 at 15:12)</a>:</h4>
<p>this is how Dada works and it's really kind of nice</p>



<a name="250946384"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/186049-t-compiler/wg-polonius/topic/purely%20forward%20propagation/near/250946384" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> lqd <a href="https://zulip-archive.rust-lang.org/stream/186049-t-compiler/wg-polonius/topic/purely.20forward.20propagation.html#250946384">(Aug 27 2021 at 15:12)</a>:</h4>
<p>yeah</p>



<a name="250946431"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/186049-t-compiler/wg-polonius/topic/purely%20forward%20propagation/near/250946431" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> lqd <a href="https://zulip-archive.rust-lang.org/stream/186049-t-compiler/wg-polonius/topic/purely.20forward.20propagation.html#250946431">(Aug 27 2021 at 15:12)</a>:</h4>
<p>at least for illegal accesses errors, and still TBD for illegal subset relationship errors I assume</p>



<a name="250946469"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/186049-t-compiler/wg-polonius/topic/purely%20forward%20propagation/near/250946469" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/186049-t-compiler/wg-polonius/topic/purely.20forward.20propagation.html#250946469">(Aug 27 2021 at 15:13)</a>:</h4>
<p>yeah :)</p>



<a name="250946491"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/186049-t-compiler/wg-polonius/topic/purely%20forward%20propagation/near/250946491" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/186049-t-compiler/wg-polonius/topic/purely.20forward.20propagation.html#250946491">(Aug 27 2021 at 15:13)</a>:</h4>
<p>I think it can all fit though</p>



<a name="250946503"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/186049-t-compiler/wg-polonius/topic/purely%20forward%20propagation/near/250946503" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/186049-t-compiler/wg-polonius/topic/purely.20forward.20propagation.html#250946503">(Aug 27 2021 at 15:13)</a>:</h4>
<p>this is partly why I was reading on that Lionel paper</p>



<a name="250946509"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/186049-t-compiler/wg-polonius/topic/purely%20forward%20propagation/near/250946509" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/186049-t-compiler/wg-polonius/topic/purely.20forward.20propagation.html#250946509">(Aug 27 2021 at 15:13)</a>:</h4>
<p>(and will read your other cites)</p>



<a name="250946580"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/186049-t-compiler/wg-polonius/topic/purely%20forward%20propagation/near/250946580" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/186049-t-compiler/wg-polonius/topic/purely.20forward.20propagation.html#250946580">(Aug 27 2021 at 15:14)</a>:</h4>
<p>oh shit</p>



<a name="250946605"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/186049-t-compiler/wg-polonius/topic/purely%20forward%20propagation/near/250946605" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/186049-t-compiler/wg-polonius/topic/purely.20forward.20propagation.html#250946605">(Aug 27 2021 at 15:14)</a>:</h4>
<p>I gotta go look up our new names lol</p>



<a name="250946650"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/186049-t-compiler/wg-polonius/topic/purely%20forward%20propagation/near/250946650" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/186049-t-compiler/wg-polonius/topic/purely.20forward.20propagation.html#250946650">(Aug 27 2021 at 15:14)</a>:</h4>
<p>not region...origin?</p>



<a name="250946686"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/186049-t-compiler/wg-polonius/topic/purely%20forward%20propagation/near/250946686" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> lqd <a href="https://zulip-archive.rust-lang.org/stream/186049-t-compiler/wg-polonius/topic/purely.20forward.20propagation.html#250946686">(Aug 27 2021 at 15:14)</a>:</h4>
<p>(the Parreaux work is more formal, but the other was interesting, not necessarily as ground-breaking say. most of the work of condensing Dolan's ideas are, IIRC, in Parreaux') (but cubiml is implemented in ......... rust :)</p>



<a name="250946687"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/186049-t-compiler/wg-polonius/topic/purely%20forward%20propagation/near/250946687" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Dylan MacKenzie (ecstatic-morse) <a href="https://zulip-archive.rust-lang.org/stream/186049-t-compiler/wg-polonius/topic/purely.20forward.20propagation.html#250946687">(Aug 27 2021 at 15:14)</a>:</h4>
<p>"o-region"</p>



<a name="250946736"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/186049-t-compiler/wg-polonius/topic/purely%20forward%20propagation/near/250946736" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/186049-t-compiler/wg-polonius/topic/purely.20forward.20propagation.html#250946736">(Aug 27 2021 at 15:15)</a>:</h4>
<p>I like Dada's <em>lease</em> :P</p>



<a name="250946751"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/186049-t-compiler/wg-polonius/topic/purely%20forward%20propagation/near/250946751" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> lqd <a href="https://zulip-archive.rust-lang.org/stream/186049-t-compiler/wg-polonius/topic/purely.20forward.20propagation.html#250946751">(Aug 27 2021 at 15:15)</a>:</h4>
<p>I feel you've confused yourself with dada's lease and al</p>



<a name="250946775"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/186049-t-compiler/wg-polonius/topic/purely%20forward%20propagation/near/250946775" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> lqd <a href="https://zulip-archive.rust-lang.org/stream/186049-t-compiler/wg-polonius/topic/purely.20forward.20propagation.html#250946775">(Aug 27 2021 at 15:15)</a>:</h4>
<p>dang it, the joke's been snatched up already <span aria-label="upside down" class="emoji emoji-1f643" role="img" title="upside down">:upside_down:</span></p>



<a name="250947297"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/186049-t-compiler/wg-polonius/topic/purely%20forward%20propagation/near/250947297" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/186049-t-compiler/wg-polonius/topic/purely.20forward.20propagation.html#250947297">(Aug 27 2021 at 15:18)</a>:</h4>
<p>from our polonius doc:</p>



<a name="250947302"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/186049-t-compiler/wg-polonius/topic/purely%20forward%20propagation/near/250947302" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/186049-t-compiler/wg-polonius/topic/purely.20forward.20propagation.html#250947302">(Aug 27 2021 at 15:18)</a>:</h4>
<div class="codehilite" data-code-language="Prolog"><pre><span></span><code><span class="nf">origin_contains_loan_on_entry</span><span class="p">(</span><span class="nv">Origin</span><span class="p">,</span> <span class="nv">Loan</span><span class="p">,</span> <span class="nv">Node</span><span class="p">)</span> <span class="p">:-</span>
  <span class="nf">loan_issued_at</span><span class="p">(</span><span class="nv">Origin</span><span class="p">,</span> <span class="nv">Loan</span><span class="p">,</span> <span class="nv">Node</span><span class="p">).</span>
</code></pre></div>



<a name="250947320"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/186049-t-compiler/wg-polonius/topic/purely%20forward%20propagation/near/250947320" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/186049-t-compiler/wg-polonius/topic/purely.20forward.20propagation.html#250947320">(Aug 27 2021 at 15:19)</a>:</h4>
<p>isn't that a bit bogus?</p>



<a name="250947350"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/186049-t-compiler/wg-polonius/topic/purely%20forward%20propagation/near/250947350" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/186049-t-compiler/wg-polonius/topic/purely.20forward.20propagation.html#250947350">(Aug 27 2021 at 15:19)</a>:</h4>
<p>like, if the loan is issued at a particular point</p>



<a name="250947359"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/186049-t-compiler/wg-polonius/topic/purely%20forward%20propagation/near/250947359" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/186049-t-compiler/wg-polonius/topic/purely.20forward.20propagation.html#250947359">(Aug 27 2021 at 15:19)</a>:</h4>
<p>I would think it is contained <em>on exit</em></p>



<a name="250947361"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/186049-t-compiler/wg-polonius/topic/purely%20forward%20propagation/near/250947361" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/186049-t-compiler/wg-polonius/topic/purely.20forward.20propagation.html#250947361">(Aug 27 2021 at 15:19)</a>:</h4>
<p>curious</p>



<a name="250947388"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/186049-t-compiler/wg-polonius/topic/purely%20forward%20propagation/near/250947388" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/186049-t-compiler/wg-polonius/topic/purely.20forward.20propagation.html#250947388">(Aug 27 2021 at 15:19)</a>:</h4>
<p>I've never been very happy with the way polonius splits points into start and mid</p>



<a name="250947395"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/186049-t-compiler/wg-polonius/topic/purely%20forward%20propagation/near/250947395" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/186049-t-compiler/wg-polonius/topic/purely.20forward.20propagation.html#250947395">(Aug 27 2021 at 15:19)</a>:</h4>
<p>mostly because it's twice as many points</p>



<a name="250947407"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/186049-t-compiler/wg-polonius/topic/purely%20forward%20propagation/near/250947407" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/186049-t-compiler/wg-polonius/topic/purely.20forward.20propagation.html#250947407">(Aug 27 2021 at 15:19)</a>:</h4>
<p>and because I somehow can't remember why it's necessary</p>



<a name="250947459"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/186049-t-compiler/wg-polonius/topic/purely%20forward%20propagation/near/250947459" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/186049-t-compiler/wg-polonius/topic/purely.20forward.20propagation.html#250947459">(Aug 27 2021 at 15:20)</a>:</h4>
<p>but I know that when I take it away things stop working :P</p>



<a name="250947469"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/186049-t-compiler/wg-polonius/topic/purely%20forward%20propagation/near/250947469" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/186049-t-compiler/wg-polonius/topic/purely.20forward.20propagation.html#250947469">(Aug 27 2021 at 15:20)</a>:</h4>
<p>I wonder if it's because of being sloppy like that</p>



<a name="250947491"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/186049-t-compiler/wg-polonius/topic/purely%20forward%20propagation/near/250947491" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/186049-t-compiler/wg-polonius/topic/purely.20forward.20propagation.html#250947491">(Aug 27 2021 at 15:20)</a>:</h4>
<p><span class="user-mention silent" data-user-id="116009">nikomatsakis</span> <a href="#narrow/stream/186049-t-compiler.2Fwg-polonius/topic/purely.20forward.20propagation/near/250947459">said</a>:</p>
<blockquote>
<p>but I know that when I take it away things stop working :P</p>
</blockquote>
<p>it's <em>something</em> like this, I recall</p>



<a name="250947512"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/186049-t-compiler/wg-polonius/topic/purely%20forward%20propagation/near/250947512" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/186049-t-compiler/wg-polonius/topic/purely.20forward.20propagation.html#250947512">(Aug 27 2021 at 15:20)</a>:</h4>
<p>that there is some edge case for things like <code>x = x.next</code></p>



<a name="250947609"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/186049-t-compiler/wg-polonius/topic/purely%20forward%20propagation/near/250947609" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> lqd <a href="https://zulip-archive.rust-lang.org/stream/186049-t-compiler/wg-polonius/topic/purely.20forward.20propagation.html#250947609">(Aug 27 2021 at 15:21)</a>:</h4>
<p>this one may just be a slight nomenclature error while we've changed the rules. there were no differentiation between exit and entry states in the naming before. it was just "requires"</p>



<a name="250947639"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/186049-t-compiler/wg-polonius/topic/purely%20forward%20propagation/near/250947639" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/186049-t-compiler/wg-polonius/topic/purely.20forward.20propagation.html#250947639">(Aug 27 2021 at 15:21)</a>:</h4>
<p>right</p>



<a name="250947646"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/186049-t-compiler/wg-polonius/topic/purely%20forward%20propagation/near/250947646" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/186049-t-compiler/wg-polonius/topic/purely.20forward.20propagation.html#250947646">(Aug 27 2021 at 15:21)</a>:</h4>
<p>but that's what I'm wondering</p>



<a name="250947665"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/186049-t-compiler/wg-polonius/topic/purely%20forward%20propagation/near/250947665" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/186049-t-compiler/wg-polonius/topic/purely.20forward.20propagation.html#250947665">(Aug 27 2021 at 15:21)</a>:</h4>
<p>in particular, maybe instead of start/mid points</p>



<a name="250947679"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/186049-t-compiler/wg-polonius/topic/purely%20forward%20propagation/near/250947679" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/186049-t-compiler/wg-polonius/topic/purely.20forward.20propagation.html#250947679">(Aug 27 2021 at 15:21)</a>:</h4>
<p>we could have two relations</p>



<a name="250947684"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/186049-t-compiler/wg-polonius/topic/purely%20forward%20propagation/near/250947684" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/186049-t-compiler/wg-polonius/topic/purely.20forward.20propagation.html#250947684">(Aug 27 2021 at 15:22)</a>:</h4>
<p>like <code>requires_on_entry</code></p>



<a name="250947725"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/186049-t-compiler/wg-polonius/topic/purely%20forward%20propagation/near/250947725" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/186049-t-compiler/wg-polonius/topic/purely.20forward.20propagation.html#250947725">(Aug 27 2021 at 15:22)</a>:</h4>
<p>and <code>requires_on_exit</code></p>



<a name="250947736"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/186049-t-compiler/wg-polonius/topic/purely%20forward%20propagation/near/250947736" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/186049-t-compiler/wg-polonius/topic/purely.20forward.20propagation.html#250947736">(Aug 27 2021 at 15:22)</a>:</h4>
<p>well, <code>origin_contains_loan_on_entry</code></p>



<a name="250947754"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/186049-t-compiler/wg-polonius/topic/purely%20forward%20propagation/near/250947754" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/186049-t-compiler/wg-polonius/topic/purely.20forward.20propagation.html#250947754">(Aug 27 2021 at 15:22)</a>:</h4>
<p>you get the idea :)</p>



<a name="250947803"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/186049-t-compiler/wg-polonius/topic/purely%20forward%20propagation/near/250947803" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/186049-t-compiler/wg-polonius/topic/purely.20forward.20propagation.html#250947803">(Aug 27 2021 at 15:22)</a>:</h4>
<p>I'm going to try it</p>



<a name="250947838"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/186049-t-compiler/wg-polonius/topic/purely%20forward%20propagation/near/250947838" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> lqd <a href="https://zulip-archive.rust-lang.org/stream/186049-t-compiler/wg-polonius/topic/purely.20forward.20propagation.html#250947838">(Aug 27 2021 at 15:22)</a>:</h4>
<p>(the move/init fact generation also had a couple of similar subtle things about those points)</p>



<a name="250947864"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/186049-t-compiler/wg-polonius/topic/purely%20forward%20propagation/near/250947864" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/186049-t-compiler/wg-polonius/topic/purely.20forward.20propagation.html#250947864">(Aug 27 2021 at 15:23)</a>:</h4>
<p>yes, I vaguely recall that</p>



<a name="250947898"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/186049-t-compiler/wg-polonius/topic/purely%20forward%20propagation/near/250947898" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/186049-t-compiler/wg-polonius/topic/purely.20forward.20propagation.html#250947898">(Aug 27 2021 at 15:23)</a>:</h4>
<p>maybe <span class="user-mention" data-user-id="204115">@Amanda Stjerna</span> remembers better</p>



<a name="250947907"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/186049-t-compiler/wg-polonius/topic/purely%20forward%20propagation/near/250947907" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/186049-t-compiler/wg-polonius/topic/purely.20forward.20propagation.html#250947907">(Aug 27 2021 at 15:23)</a>:</h4>
<p>or her thesis :)</p>



<a name="250948146"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/186049-t-compiler/wg-polonius/topic/purely%20forward%20propagation/near/250948146" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> lqd <a href="https://zulip-archive.rust-lang.org/stream/186049-t-compiler/wg-polonius/topic/purely.20forward.20propagation.html#250948146">(Aug 27 2021 at 15:25)</a>:</h4>
<p>(there's another thread here where I had talked about this init false positive in more detail (and which is probably still not fixed correctly) while investigating it)</p>



<a name="250949911"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/186049-t-compiler/wg-polonius/topic/purely%20forward%20propagation/near/250949911" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Domenic Quirl <a href="https://zulip-archive.rust-lang.org/stream/186049-t-compiler/wg-polonius/topic/purely.20forward.20propagation.html#250949911">(Aug 27 2021 at 15:36)</a>:</h4>
<p>(just now realizing that the CFG diagrams hat text in them all this time, but my browser rendered that in white <span aria-label="rolling eyes" class="emoji emoji-1f644" role="img" title="rolling eyes">:rolling_eyes:</span> )</p>



<a name="250950043"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/186049-t-compiler/wg-polonius/topic/purely%20forward%20propagation/near/250950043" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> lqd <a href="https://zulip-archive.rust-lang.org/stream/186049-t-compiler/wg-polonius/topic/purely.20forward.20propagation.html#250950043">(Aug 27 2021 at 15:37)</a>:</h4>
<p>the graphviz outputs you mean ?</p>



<a name="250950054"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/186049-t-compiler/wg-polonius/topic/purely%20forward%20propagation/near/250950054" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Domenic Quirl <a href="https://zulip-archive.rust-lang.org/stream/186049-t-compiler/wg-polonius/topic/purely.20forward.20propagation.html#250950054">(Aug 27 2021 at 15:38)</a>:</h4>
<p>yeah</p>



<a name="250950123"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/186049-t-compiler/wg-polonius/topic/purely%20forward%20propagation/near/250950123" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> lqd <a href="https://zulip-archive.rust-lang.org/stream/186049-t-compiler/wg-polonius/topic/purely.20forward.20propagation.html#250950123">(Aug 27 2021 at 15:38)</a>:</h4>
<p>rather unfortunate</p>



<a name="250950170"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/186049-t-compiler/wg-polonius/topic/purely%20forward%20propagation/near/250950170" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Domenic Quirl <a href="https://zulip-archive.rust-lang.org/stream/186049-t-compiler/wg-polonius/topic/purely.20forward.20propagation.html#250950170">(Aug 27 2021 at 15:38)</a>:</h4>
<p>fixed that now, but before I though niko just hadn't gotten to them yet...</p>



<a name="250950440"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/186049-t-compiler/wg-polonius/topic/purely%20forward%20propagation/near/250950440" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> lqd <a href="https://zulip-archive.rust-lang.org/stream/186049-t-compiler/wg-polonius/topic/purely.20forward.20propagation.html#250950440">(Aug 27 2021 at 15:40)</a>:</h4>
<p>(credit where credit is due IIRC it was <span class="user-mention silent" data-user-id="116852">Andrea Lattuada</span>'s work, which was later improved)</p>



<a name="250950468"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/186049-t-compiler/wg-polonius/topic/purely%20forward%20propagation/near/250950468" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/186049-t-compiler/wg-polonius/topic/purely.20forward.20propagation.html#250950468">(Aug 27 2021 at 15:40)</a>:</h4>
<p>(what was?)</p>



<a name="250950574"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/186049-t-compiler/wg-polonius/topic/purely%20forward%20propagation/near/250950574" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> lqd <a href="https://zulip-archive.rust-lang.org/stream/186049-t-compiler/wg-polonius/topic/purely.20forward.20propagation.html#250950574">(Aug 27 2021 at 15:41)</a>:</h4>
<p>the graphviz outputs</p>



<a name="250952023"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/186049-t-compiler/wg-polonius/topic/purely%20forward%20propagation/near/250952023" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Domenic Quirl <a href="https://zulip-archive.rust-lang.org/stream/186049-t-compiler/wg-polonius/topic/purely.20forward.20propagation.html#250952023">(Aug 27 2021 at 15:52)</a>:</h4>
<p>In the <code>Example A</code> CFG, in <code>C</code> we'd infer <code>invalidate_loan(L0) -&gt; (+ origin_contains_loan_on_entry(L0, 'b)) origin_invalidated('b) -&gt; (+ subset('b, 'a)) origin_invalidated('a)</code>, right?</p>



<a name="250952131"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/186049-t-compiler/wg-polonius/topic/purely%20forward%20propagation/near/250952131" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Dylan MacKenzie (ecstatic-morse) <a href="https://zulip-archive.rust-lang.org/stream/186049-t-compiler/wg-polonius/topic/purely.20forward.20propagation.html#250952131">(Aug 27 2021 at 15:53)</a>:</h4>
<p>Re: the entry/exit question, I suspected that we could remove that distinction from the current borrow-checker when I was refactoring the dataflow framework. Currently, we allow dataflow analyses to make changes both <em>before</em> and <em>after</em> a statement, and you can inspect the state at any point in between those changes. However,  <code>borrowck</code> only inspects the state in-between the before- and after-effects except for some special terminators (<code>Return</code> and some generator-related ones), which could be handled specially.</p>
<p>That suggests we could move the "before" effect (which is called "kill_loans_out_of_scope") into the  "after" effect for the previous statement (which sets bits for borrows that occur at that location, among some other things).</p>
<p>I'm not sure what the equivalent formulation is in Polonius, but I think you're right that we don't need to do the split.</p>



<a name="250952578"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/186049-t-compiler/wg-polonius/topic/purely%20forward%20propagation/near/250952578" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/186049-t-compiler/wg-polonius/topic/purely.20forward.20propagation.html#250952578">(Aug 27 2021 at 15:57)</a>:</h4>
<p><span class="user-mention silent" data-user-id="337115">Domenic Quirl</span> <a href="#narrow/stream/186049-t-compiler.2Fwg-polonius/topic/purely.20forward.20propagation/near/250952023">said</a>:</p>
<blockquote>
<p>In the <code>Example A</code> CFG, in <code>C</code> we'd infer <code>invalidate_loan(L0) -&gt; (+ origin_contains_loan_on_entry(L0, 'b)) origin_invalidated('b) -&gt; (+ subset('b, 'a)) origin_invalidated('a)</code>, right?</p>
</blockquote>
<p>I don't understand the question, <span class="user-mention" data-user-id="337115">@Domenic Quirl</span></p>



<a name="250952623"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/186049-t-compiler/wg-polonius/topic/purely%20forward%20propagation/near/250952623" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/186049-t-compiler/wg-polonius/topic/purely.20forward.20propagation.html#250952623">(Aug 27 2021 at 15:57)</a>:</h4>
<p>are you asking why is the <code>'a</code> origin invalidated?</p>



<a name="250952755"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/186049-t-compiler/wg-polonius/topic/purely%20forward%20propagation/near/250952755" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Domenic Quirl <a href="https://zulip-archive.rust-lang.org/stream/186049-t-compiler/wg-polonius/topic/purely.20forward.20propagation.html#250952755">(Aug 27 2021 at 15:58)</a>:</h4>
<p>I'm trying to follow your notes, and got confused that the facts in that block list <code>origin_invalidated('a)</code> first</p>



<a name="250952869"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/186049-t-compiler/wg-polonius/topic/purely%20forward%20propagation/near/250952869" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Domenic Quirl <a href="https://zulip-archive.rust-lang.org/stream/186049-t-compiler/wg-polonius/topic/purely.20forward.20propagation.html#250952869">(Aug 27 2021 at 15:59)</a>:</h4>
<p>cause in my mind the first thing that is invalidated is <code>'b</code>, because it is contained in <code>L0</code></p>



<a name="250952905"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/186049-t-compiler/wg-polonius/topic/purely%20forward%20propagation/near/250952905" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Domenic Quirl <a href="https://zulip-archive.rust-lang.org/stream/186049-t-compiler/wg-polonius/topic/purely.20forward.20propagation.html#250952905">(Aug 27 2021 at 15:59)</a>:</h4>
<p>and then because of <code>subset</code> this also affects <code>'a</code></p>



<a name="250952947"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/186049-t-compiler/wg-polonius/topic/purely%20forward%20propagation/near/250952947" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/186049-t-compiler/wg-polonius/topic/purely.20forward.20propagation.html#250952947">(Aug 27 2021 at 15:59)</a>:</h4>
<p>I see</p>



<a name="250952958"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/186049-t-compiler/wg-polonius/topic/purely%20forward%20propagation/near/250952958" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Domenic Quirl <a href="https://zulip-archive.rust-lang.org/stream/186049-t-compiler/wg-polonius/topic/purely.20forward.20propagation.html#250952958">(Aug 27 2021 at 15:59)</a>:</h4>
<p>is that correct?</p>



<a name="250952970"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/186049-t-compiler/wg-polonius/topic/purely%20forward%20propagation/near/250952970" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/186049-t-compiler/wg-polonius/topic/purely.20forward.20propagation.html#250952970">(Aug 27 2021 at 15:59)</a>:</h4>
<p>yes</p>



<a name="250952992"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/186049-t-compiler/wg-polonius/topic/purely%20forward%20propagation/near/250952992" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/186049-t-compiler/wg-polonius/topic/purely.20forward.20propagation.html#250952992">(Aug 27 2021 at 16:00)</a>:</h4>
<p>the ordering isn't really significant</p>



<a name="250953043"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/186049-t-compiler/wg-polonius/topic/purely%20forward%20propagation/near/250953043" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> lqd <a href="https://zulip-archive.rust-lang.org/stream/186049-t-compiler/wg-polonius/topic/purely.20forward.20propagation.html#250953043">(Aug 27 2021 at 16:00)</a>:</h4>
<p>(what there has been a hackmd all along <span aria-label="face palm" class="emoji emoji-1f926" role="img" title="face palm">:face_palm:</span>)</p>



<a name="250953098"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/186049-t-compiler/wg-polonius/topic/purely%20forward%20propagation/near/250953098" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Domenic Quirl <a href="https://zulip-archive.rust-lang.org/stream/186049-t-compiler/wg-polonius/topic/purely.20forward.20propagation.html#250953098">(Aug 27 2021 at 16:00)</a>:</h4>
<p><a href="https://hackmd.io/KpK0ICQOQLSPxIcNIlhkJQ?view">https://hackmd.io/KpK0ICQOQLSPxIcNIlhkJQ?view</a></p>



<a name="250953125"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/186049-t-compiler/wg-polonius/topic/purely%20forward%20propagation/near/250953125" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/186049-t-compiler/wg-polonius/topic/purely.20forward.20propagation.html#250953125">(Aug 27 2021 at 16:00)</a>:</h4>
<p>but you are correct that <code>'a</code> contains <code>L0</code> from <code>'b</code></p>



<a name="250953172"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/186049-t-compiler/wg-polonius/topic/purely%20forward%20propagation/near/250953172" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> lqd <a href="https://zulip-archive.rust-lang.org/stream/186049-t-compiler/wg-polonius/topic/purely.20forward.20propagation.html#250953172">(Aug 27 2021 at 16:00)</a>:</h4>
<p>(yeah, I re-read the backscroll to notice the link :)</p>



<a name="250953261"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/186049-t-compiler/wg-polonius/topic/purely%20forward%20propagation/near/250953261" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> lqd <a href="https://zulip-archive.rust-lang.org/stream/186049-t-compiler/wg-polonius/topic/purely.20forward.20propagation.html#250953261">(Aug 27 2021 at 16:01)</a>:</h4>
<p>(so ignore the graphviz BS I was saying, since you were mentioning this hackmd)</p>



<a name="250953358"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/186049-t-compiler/wg-polonius/topic/purely%20forward%20propagation/near/250953358" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/186049-t-compiler/wg-polonius/topic/purely.20forward.20propagation.html#250953358">(Aug 27 2021 at 16:01)</a>:</h4>
<p>I love how we managed to use like <em>all the HTML escaped characters</em> in Rust syntax</p>



<a name="250953365"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/186049-t-compiler/wg-polonius/topic/purely%20forward%20propagation/near/250953365" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Domenic Quirl <a href="https://zulip-archive.rust-lang.org/stream/186049-t-compiler/wg-polonius/topic/purely.20forward.20propagation.html#250953365">(Aug 27 2021 at 16:01)</a>:</h4>
<p><span class="user-mention silent" data-user-id="116009">nikomatsakis</span> <a href="#narrow/stream/186049-t-compiler.2Fwg-polonius/topic/purely.20forward.20propagation/near/250952992">said</a>:</p>
<blockquote>
<p>the ordering isn't really significant</p>
</blockquote>
<p>alright that's what I thought <span aria-label="thumbs up" class="emoji emoji-1f44d" role="img" title="thumbs up">:thumbs_up:</span> <br>
Since I haven't really worked with these rules yet I'm trying to make sure I don't just feel like the conclusion facts make sense to me from knowing the Rust program, but also what rules / other facts they are derived from</p>



<a name="250953370"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/186049-t-compiler/wg-polonius/topic/purely%20forward%20propagation/near/250953370" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/186049-t-compiler/wg-polonius/topic/purely.20forward.20propagation.html#250953370">(Aug 27 2021 at 16:01)</a>:</h4>
<p>it's kind of maximally inconvenient</p>



<a name="250953501"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/186049-t-compiler/wg-polonius/topic/purely%20forward%20propagation/near/250953501" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Domenic Quirl <a href="https://zulip-archive.rust-lang.org/stream/186049-t-compiler/wg-polonius/topic/purely.20forward.20propagation.html#250953501">(Aug 27 2021 at 16:02)</a>:</h4>
<p>not maximally minimal <span aria-label="sad" class="emoji emoji-2639" role="img" title="sad">:sad:</span></p>



<a name="250954245"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/186049-t-compiler/wg-polonius/topic/purely%20forward%20propagation/near/250954245" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> lqd <a href="https://zulip-archive.rust-lang.org/stream/186049-t-compiler/wg-polonius/topic/purely.20forward.20propagation.html#250954245">(Aug 27 2021 at 16:08)</a>:</h4>
<p>do we need origin invalidation to be flow-sensitive ?</p>



<a name="250954502"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/186049-t-compiler/wg-polonius/topic/purely%20forward%20propagation/near/250954502" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/186049-t-compiler/wg-polonius/topic/purely.20forward.20propagation.html#250954502">(Aug 27 2021 at 16:10)</a>:</h4>
<p>yes</p>



<a name="250954542"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/186049-t-compiler/wg-polonius/topic/purely%20forward%20propagation/near/250954542" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/186049-t-compiler/wg-polonius/topic/purely.20forward.20propagation.html#250954542">(Aug 27 2021 at 16:10)</a>:</h4>
<p>so I think <a href="https://hackmd.io/KpK0ICQOQLSPxIcNIlhkJQ#Example-vec-temp">example vec temp</a> is the reason that we propagate subset relations</p>



<a name="250954583"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/186049-t-compiler/wg-polonius/topic/purely%20forward%20propagation/near/250954583" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/186049-t-compiler/wg-polonius/topic/purely.20forward.20propagation.html#250954583">(Aug 27 2021 at 16:10)</a>:</h4>
<p>and also perhaps a key difference between the "type system" formulation and polonius, in a sense</p>



<a name="250954785"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/186049-t-compiler/wg-polonius/topic/purely%20forward%20propagation/near/250954785" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/186049-t-compiler/wg-polonius/topic/purely.20forward.20propagation.html#250954785">(Aug 27 2021 at 16:12)</a>:</h4>
<p>it's actually a pretty interesting example</p>



<a name="250954827"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/186049-t-compiler/wg-polonius/topic/purely%20forward%20propagation/near/250954827" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/186049-t-compiler/wg-polonius/topic/purely.20forward.20propagation.html#250954827">(Aug 27 2021 at 16:12)</a>:</h4>
<p>there are two, I think, key parts</p>



<a name="250954884"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/186049-t-compiler/wg-polonius/topic/purely%20forward%20propagation/near/250954884" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/186049-t-compiler/wg-polonius/topic/purely.20forward.20propagation.html#250954884">(Aug 27 2021 at 16:13)</a>:</h4>
<ul>
<li>until we call <code>Vec::push</code>, the type of the vector <em>isn't</em> dependent on the loan of <code>x</code></li>
</ul>



<a name="250954933"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/186049-t-compiler/wg-polonius/topic/purely%20forward%20propagation/near/250954933" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/186049-t-compiler/wg-polonius/topic/purely.20forward.20propagation.html#250954933">(Aug 27 2021 at 16:13)</a>:</h4>
<ul>
<li>when we call <code>Vec::push</code> on <code>tmp</code>, it 'propagates' that dependency into the type of <code>v</code></li>
</ul>



<a name="250955802"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/186049-t-compiler/wg-polonius/topic/purely%20forward%20propagation/near/250955802" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/186049-t-compiler/wg-polonius/topic/purely.20forward.20propagation.html#250955802">(Aug 27 2021 at 16:19)</a>:</h4>
<p>(why does that &lt;td&gt;&lt;td&gt; keep happening??)</p>



<a name="250955809"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/186049-t-compiler/wg-polonius/topic/purely%20forward%20propagation/near/250955809" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/186049-t-compiler/wg-polonius/topic/purely.20forward.20propagation.html#250955809">(Aug 27 2021 at 16:19)</a>:</h4>
<p>am I typing it?</p>



<a name="250955830"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/186049-t-compiler/wg-polonius/topic/purely%20forward%20propagation/near/250955830" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/186049-t-compiler/wg-polonius/topic/purely.20forward.20propagation.html#250955830">(Aug 27 2021 at 16:19)</a>:</h4>
<p>I feel like I'm only copy and pasting</p>



<a name="250955835"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/186049-t-compiler/wg-polonius/topic/purely%20forward%20propagation/near/250955835" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/186049-t-compiler/wg-polonius/topic/purely.20forward.20propagation.html#250955835">(Aug 27 2021 at 16:19)</a>:</h4>
<p>maybe not :)</p>



<a name="250955910"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/186049-t-compiler/wg-polonius/topic/purely%20forward%20propagation/near/250955910" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> lqd <a href="https://zulip-archive.rust-lang.org/stream/186049-t-compiler/wg-polonius/topic/purely.20forward.20propagation.html#250955910">(Aug 27 2021 at 16:19)</a>:</h4>
<p>maybe they're "helpful"ly added by hackmd</p>



<a name="250955971"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/186049-t-compiler/wg-polonius/topic/purely%20forward%20propagation/near/250955971" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/186049-t-compiler/wg-polonius/topic/purely.20forward.20propagation.html#250955971">(Aug 27 2021 at 16:20)</a>:</h4>
<p>I feel like it's a hackmd bug</p>



<a name="250956154"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/186049-t-compiler/wg-polonius/topic/purely%20forward%20propagation/near/250956154" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/186049-t-compiler/wg-polonius/topic/purely.20forward.20propagation.html#250956154">(Aug 27 2021 at 16:21)</a>:</h4>
<p><code>origin_contains_loan_on_entry</code> this annoys me</p>



<a name="250956173"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/186049-t-compiler/wg-polonius/topic/purely%20forward%20propagation/near/250956173" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/186049-t-compiler/wg-polonius/topic/purely.20forward.20propagation.html#250956173">(Aug 27 2021 at 16:21)</a>:</h4>
<p>it should be <code>loan_in_origin</code> I think. :)</p>



<a name="250956202"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/186049-t-compiler/wg-polonius/topic/purely%20forward%20propagation/near/250956202" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/186049-t-compiler/wg-polonius/topic/purely.20forward.20propagation.html#250956202">(Aug 27 2021 at 16:21)</a>:</h4>
<p>so that it matches <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>x</mi><mo>∈</mo><mi>y</mi></mrow><annotation encoding="application/x-tex">x \in y</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.5782em;vertical-align:-0.0391em;"></span><span class="mord mathnormal">x</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">∈</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:0.625em;vertical-align:-0.19444em;"></span><span class="mord mathnormal" style="margin-right:0.03588em;">y</span></span></span></span></p>



<a name="250956249"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/186049-t-compiler/wg-polonius/topic/purely%20forward%20propagation/near/250956249" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/186049-t-compiler/wg-polonius/topic/purely.20forward.20propagation.html#250956249">(Aug 27 2021 at 16:22)</a>:</h4>
<p>and <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>x</mi><mo>⊆</mo><mi>y</mi></mrow><annotation encoding="application/x-tex">x \subseteq y</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.7719400000000001em;vertical-align:-0.13597em;"></span><span class="mord mathnormal">x</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">⊆</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:0.625em;vertical-align:-0.19444em;"></span><span class="mord mathnormal" style="margin-right:0.03588em;">y</span></span></span></span></p>



<a name="250956262"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/186049-t-compiler/wg-polonius/topic/purely%20forward%20propagation/near/250956262" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/186049-t-compiler/wg-polonius/topic/purely.20forward.20propagation.html#250956262">(Aug 27 2021 at 16:22)</a>:</h4>
<p>(i.e., little thing on the left)</p>



<a name="250956553"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/186049-t-compiler/wg-polonius/topic/purely%20forward%20propagation/near/250956553" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> lqd <a href="https://zulip-archive.rust-lang.org/stream/186049-t-compiler/wg-polonius/topic/purely.20forward.20propagation.html#250956553">(Aug 27 2021 at 16:24)</a>:</h4>
<p>you can just change its name in the document so that it distracts you less :)</p>



<a name="250956723"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/186049-t-compiler/wg-polonius/topic/purely%20forward%20propagation/near/250956723" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/186049-t-compiler/wg-polonius/topic/purely.20forward.20propagation.html#250956723">(Aug 27 2021 at 16:25)</a>:</h4>
<p>done</p>



<a name="250957109"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/186049-t-compiler/wg-polonius/topic/purely%20forward%20propagation/near/250957109" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Domenic Quirl <a href="https://zulip-archive.rust-lang.org/stream/186049-t-compiler/wg-polonius/topic/purely.20forward.20propagation.html#250957109">(Aug 27 2021 at 16:28)</a>:</h4>
<p>Hm, some of the facts in the example are known earlier than written, right?</p>



<a name="250957137"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/186049-t-compiler/wg-polonius/topic/purely%20forward%20propagation/near/250957137" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Domenic Quirl <a href="https://zulip-archive.rust-lang.org/stream/186049-t-compiler/wg-polonius/topic/purely.20forward.20propagation.html#250957137">(Aug 27 2021 at 16:28)</a>:</h4>
<p>E.g. the <code>x = 23</code> assignment would already invalidate the origins</p>



<a name="250957197"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/186049-t-compiler/wg-polonius/topic/purely%20forward%20propagation/near/250957197" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Domenic Quirl <a href="https://zulip-archive.rust-lang.org/stream/186049-t-compiler/wg-polonius/topic/purely.20forward.20propagation.html#250957197">(Aug 27 2021 at 16:28)</a>:</h4>
<p>but then only the second call to <code>len</code> is an invalid access</p>



<a name="250957236"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/186049-t-compiler/wg-polonius/topic/purely%20forward%20propagation/near/250957236" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/186049-t-compiler/wg-polonius/topic/purely.20forward.20propagation.html#250957236">(Aug 27 2021 at 16:29)</a>:</h4>
<p>I think it's written correctly</p>



<a name="250957264"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/186049-t-compiler/wg-polonius/topic/purely%20forward%20propagation/near/250957264" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/186049-t-compiler/wg-polonius/topic/purely.20forward.20propagation.html#250957264">(Aug 27 2021 at 16:29)</a>:</h4>
<p>the point is that the origin is not invalidated <em>on entry</em> yet</p>



<a name="250957268"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/186049-t-compiler/wg-polonius/topic/purely%20forward%20propagation/near/250957268" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/186049-t-compiler/wg-polonius/topic/purely.20forward.20propagation.html#250957268">(Aug 27 2021 at 16:29)</a>:</h4>
<p>but only as we enter the next node</p>



<a name="250957311"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/186049-t-compiler/wg-polonius/topic/purely%20forward%20propagation/near/250957311" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/186049-t-compiler/wg-polonius/topic/purely.20forward.20propagation.html#250957311">(Aug 27 2021 at 16:29)</a>:</h4>
<p>the effects of node N only show up in its successors</p>



<a name="250957365"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/186049-t-compiler/wg-polonius/topic/purely%20forward%20propagation/near/250957365" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Domenic Quirl <a href="https://zulip-archive.rust-lang.org/stream/186049-t-compiler/wg-polonius/topic/purely.20forward.20propagation.html#250957365">(Aug 27 2021 at 16:30)</a>:</h4>
<p>oh, it's on entry</p>



<a name="250957564"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/186049-t-compiler/wg-polonius/topic/purely%20forward%20propagation/near/250957564" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/186049-t-compiler/wg-polonius/topic/purely.20forward.20propagation.html#250957564">(Aug 27 2021 at 16:31)</a>:</h4>
<p>ok so I thnk i'm starting to see how this will work :)</p>



<a name="250957592"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/186049-t-compiler/wg-polonius/topic/purely%20forward%20propagation/near/250957592" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/186049-t-compiler/wg-polonius/topic/purely.20forward.20propagation.html#250957592">(Aug 27 2021 at 16:31)</a>:</h4>
<p>I'm still feeling a bit "bah" about the details of what happens when you overwrite a pointer</p>



<a name="250957733"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/186049-t-compiler/wg-polonius/topic/purely%20forward%20propagation/near/250957733" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/186049-t-compiler/wg-polonius/topic/purely.20forward.20propagation.html#250957733">(Aug 27 2021 at 16:32)</a>:</h4>
<p>I feel like there needs to be some sort of "reset" operation for when a value is overwritten</p>



<a name="250958087"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/186049-t-compiler/wg-polonius/topic/purely%20forward%20propagation/near/250958087" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> lqd <a href="https://zulip-archive.rust-lang.org/stream/186049-t-compiler/wg-polonius/topic/purely.20forward.20propagation.html#250958087">(Aug 27 2021 at 16:35)</a>:</h4>
<p>like our existing "loan killed at" maybe ?</p>



<a name="250958209"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/186049-t-compiler/wg-polonius/topic/purely%20forward%20propagation/near/250958209" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Dylan MacKenzie (ecstatic-morse) <a href="https://zulip-archive.rust-lang.org/stream/186049-t-compiler/wg-polonius/topic/purely.20forward.20propagation.html#250958209">(Aug 27 2021 at 16:36)</a>:</h4>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="kd">let</span><span class="w"> </span><span class="n">p</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">22</span><span class="p">;</span><span class="w"></span>
<span class="kd">let</span><span class="w"> </span><span class="n">q</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">44</span><span class="p">;</span><span class="w"></span>
<span class="kd">let</span><span class="w"> </span><span class="n">x</span>: <span class="kp">&amp;</span><span class="nc">mut</span><span class="w"> </span><span class="kt">i32</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">&amp;</span><span class="k">mut</span><span class="w"> </span><span class="n">p</span><span class="p">;</span><span class="w"> </span><span class="c1">// `x` points at `p`</span>
<span class="kd">let</span><span class="w"> </span><span class="n">y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">&amp;</span><span class="k">mut</span><span class="w"> </span><span class="o">*</span><span class="n">x</span><span class="p">;</span><span class="w"> </span><span class="c1">// Loan L0, `y` points at `p` too</span>
<span class="c1">// ...</span>
<span class="n">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">&amp;</span><span class="k">mut</span><span class="w"> </span><span class="n">q</span><span class="p">;</span><span class="w"> </span><span class="c1">// `x` points at `q`; kills L0</span>
</code></pre></div>



<a name="250958327"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/186049-t-compiler/wg-polonius/topic/purely%20forward%20propagation/near/250958327" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/186049-t-compiler/wg-polonius/topic/purely.20forward.20propagation.html#250958327">(Aug 27 2021 at 16:36)</a>:</h4>
<p>right, that's the sort of example I was thinking about</p>



<a name="250958332"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/186049-t-compiler/wg-polonius/topic/purely%20forward%20propagation/near/250958332" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/186049-t-compiler/wg-polonius/topic/purely.20forward.20propagation.html#250958332">(Aug 27 2021 at 16:36)</a>:</h4>
<p>I think it's not <em>loan killed</em></p>



<a name="250958344"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/186049-t-compiler/wg-polonius/topic/purely%20forward%20propagation/near/250958344" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/186049-t-compiler/wg-polonius/topic/purely.20forward.20propagation.html#250958344">(Aug 27 2021 at 16:36)</a>:</h4>
<p>it's <em>origin killed</em></p>



<a name="250958352"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/186049-t-compiler/wg-polonius/topic/purely%20forward%20propagation/near/250958352" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/186049-t-compiler/wg-polonius/topic/purely.20forward.20propagation.html#250958352">(Aug 27 2021 at 16:36)</a>:</h4>
<p>i.e., "every reference with this origin was overwritten"</p>



<a name="250958371"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/186049-t-compiler/wg-polonius/topic/purely%20forward%20propagation/near/250958371" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/186049-t-compiler/wg-polonius/topic/purely.20forward.20propagation.html#250958371">(Aug 27 2021 at 16:37)</a>:</h4>
<p>since we only use origins once, that's easy to ascertain ;)</p>



<a name="250958392"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/186049-t-compiler/wg-polonius/topic/purely%20forward%20propagation/near/250958392" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/186049-t-compiler/wg-polonius/topic/purely.20forward.20propagation.html#250958392">(Aug 27 2021 at 16:37)</a>:</h4>
<p>that allows us to remove it from the subset relation, remove it from <code>origin_invalidated</code>, and so forth</p>



<a name="250958401"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/186049-t-compiler/wg-polonius/topic/purely%20forward%20propagation/near/250958401" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/186049-t-compiler/wg-polonius/topic/purely.20forward.20propagation.html#250958401">(Aug 27 2021 at 16:37)</a>:</h4>
<p>those things are no longer true</p>



<a name="250958458"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/186049-t-compiler/wg-polonius/topic/purely%20forward%20propagation/near/250958458" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/186049-t-compiler/wg-polonius/topic/purely.20forward.20propagation.html#250958458">(Aug 27 2021 at 16:37)</a>:</h4>
<p>it still has that "transtive-closure-at-every-node" character :)</p>



<a name="250958568"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/186049-t-compiler/wg-polonius/topic/purely%20forward%20propagation/near/250958568" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/186049-t-compiler/wg-polonius/topic/purely.20forward.20propagation.html#250958568">(Aug 27 2021 at 16:38)</a>:</h4>
<p>I .. forget what we use loan-killed-at for, is that for the <code>temp = temp.next</code> pattern ?</p>



<a name="250958597"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/186049-t-compiler/wg-polonius/topic/purely%20forward%20propagation/near/250958597" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> lqd <a href="https://zulip-archive.rust-lang.org/stream/186049-t-compiler/wg-polonius/topic/purely.20forward.20propagation.html#250958597">(Aug 27 2021 at 16:38)</a>:</h4>
<p>yeah</p>



<a name="250958655"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/186049-t-compiler/wg-polonius/topic/purely%20forward%20propagation/near/250958655" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> lqd <a href="https://zulip-archive.rust-lang.org/stream/186049-t-compiler/wg-polonius/topic/purely.20forward.20propagation.html#250958655">(Aug 27 2021 at 16:39)</a>:</h4>
<p>and killing borrows of a.b.c if a is overwritten</p>



<a name="250958679"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/186049-t-compiler/wg-polonius/topic/purely%20forward%20propagation/near/250958679" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> lqd <a href="https://zulip-archive.rust-lang.org/stream/186049-t-compiler/wg-polonius/topic/purely.20forward.20propagation.html#250958679">(Aug 27 2021 at 16:39)</a>:</h4>
<p>but that's the same thing</p>



<a name="250958859"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/186049-t-compiler/wg-polonius/topic/purely%20forward%20propagation/near/250958859" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/186049-t-compiler/wg-polonius/topic/purely.20forward.20propagation.html#250958859">(Aug 27 2021 at 16:40)</a>:</h4>
<p>ah, yes, I think we want that too</p>



<a name="250958877"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/186049-t-compiler/wg-polonius/topic/purely%20forward%20propagation/near/250958877" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/186049-t-compiler/wg-polonius/topic/purely.20forward.20propagation.html#250958877">(Aug 27 2021 at 16:40)</a>:</h4>
<p>this indicates that:</p>



<a name="250959011"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/186049-t-compiler/wg-polonius/topic/purely%20forward%20propagation/near/250959011" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/186049-t-compiler/wg-polonius/topic/purely.20forward.20propagation.html#250959011">(Aug 27 2021 at 16:41)</a>:</h4>
<p>the path in the loan is no longer applicable, such that modifications to the path will no longer invalidate any data</p>



<a name="250959095"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/186049-t-compiler/wg-polonius/topic/purely%20forward%20propagation/near/250959095" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/186049-t-compiler/wg-polonius/topic/purely.20forward.20propagation.html#250959095">(Aug 27 2021 at 16:42)</a>:</h4>
<p>that's a different thing though</p>



<a name="250959727"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/186049-t-compiler/wg-polonius/topic/purely%20forward%20propagation/near/250959727" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Domenic Quirl <a href="https://zulip-archive.rust-lang.org/stream/186049-t-compiler/wg-polonius/topic/purely.20forward.20propagation.html#250959727">(Aug 27 2021 at 16:47)</a>:</h4>
<p>Can you maybe explain some more how these are different than, on assignment to <code>a</code>, invalidating any loan <code>L: kind(path)</code> where <code>path</code> has <code>a</code>? If I rephrase my current understanding, with <code>invalidate_loan</code> the data behind the loan is invalid to access, while with <code>loan_killed</code> it is still valid, but no longer behind the loan?</p>



<a name="250959760"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/186049-t-compiler/wg-polonius/topic/purely%20forward%20propagation/near/250959760" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Domenic Quirl <a href="https://zulip-archive.rust-lang.org/stream/186049-t-compiler/wg-polonius/topic/purely.20forward.20propagation.html#250959760">(Aug 27 2021 at 16:47)</a>:</h4>
<p>I don't yet understand where <code>origin_killed</code> fits into this picture</p>



<a name="250960807"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/186049-t-compiler/wg-polonius/topic/purely%20forward%20propagation/near/250960807" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Domenic Quirl <a href="https://zulip-archive.rust-lang.org/stream/186049-t-compiler/wg-polonius/topic/purely.20forward.20propagation.html#250960807">(Aug 27 2021 at 16:55)</a>:</h4>
<p>Oh, is it that if I <code>kill</code> a loan for <code>a.b.c</code>, I can later invalidate it by accessing <code>a.b.c</code> again, but that doesn't matter because <code>a.b.c</code> is now something different?</p>



<a name="250961290"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/186049-t-compiler/wg-polonius/topic/purely%20forward%20propagation/near/250961290" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/186049-t-compiler/wg-polonius/topic/purely.20forward.20propagation.html#250961290">(Aug 27 2021 at 16:58)</a>:</h4>
<p><span class="user-mention silent" data-user-id="337115">Domenic Quirl</span> <a href="#narrow/stream/186049-t-compiler.2Fwg-polonius/topic/purely.20forward.20propagation/near/250959727">said</a>:</p>
<blockquote>
<p>Can you maybe explain some more how these are different than, on assignment to <code>a</code>, invalidating any loan <code>L: kind(path)</code> where <code>path</code> has <code>a</code>? If I rephrase my current understanding, with <code>invalidate_loan</code> the data behind the loan is invalid to access, while with <code>loan_killed</code> it is still valid, but no longer behind the loan?</p>
</blockquote>
<p>yes, we probably need a better name than "killed" for this</p>



<a name="250961296"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/186049-t-compiler/wg-polonius/topic/purely%20forward%20propagation/near/250961296" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/186049-t-compiler/wg-polonius/topic/purely.20forward.20propagation.html#250961296">(Aug 27 2021 at 16:58)</a>:</h4>
<p>but as an example:</p>



<a name="250961341"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/186049-t-compiler/wg-polonius/topic/purely%20forward%20propagation/near/250961341" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/186049-t-compiler/wg-polonius/topic/purely.20forward.20propagation.html#250961341">(Aug 27 2021 at 16:59)</a>:</h4>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="kd">let</span><span class="w"> </span><span class="k">mut</span><span class="w"> </span><span class="n">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">22</span><span class="p">;</span><span class="w"></span>
<span class="kd">let</span><span class="w"> </span><span class="n">p</span>: <span class="kp">&amp;</span><span class="nc">mut</span><span class="w"> </span><span class="kt">u32</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">&amp;</span><span class="k">mut</span><span class="w"> </span><span class="n">x</span><span class="p">;</span><span class="w"></span>
</code></pre></div>



<a name="250961343"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/186049-t-compiler/wg-polonius/topic/purely%20forward%20propagation/near/250961343" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/186049-t-compiler/wg-polonius/topic/purely.20forward.20propagation.html#250961343">(Aug 27 2021 at 16:59)</a>:</h4>
<p>given that setup</p>



<a name="250961358"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/186049-t-compiler/wg-polonius/topic/purely%20forward%20propagation/near/250961358" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/186049-t-compiler/wg-polonius/topic/purely.20forward.20propagation.html#250961358">(Aug 27 2021 at 16:59)</a>:</h4>
<p>if I do <code>x = 23</code>, I <em>invalidate</em> the loan <code>&amp;mut x</code></p>



<a name="250961365"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/186049-t-compiler/wg-polonius/topic/purely%20forward%20propagation/near/250961365" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/186049-t-compiler/wg-polonius/topic/purely.20forward.20propagation.html#250961365">(Aug 27 2021 at 16:59)</a>:</h4>
<p><code>p</code> can no longer be used because the memory it references has changed</p>



<a name="250961411"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/186049-t-compiler/wg-polonius/topic/purely%20forward%20propagation/near/250961411" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/186049-t-compiler/wg-polonius/topic/purely.20forward.20propagation.html#250961411">(Aug 27 2021 at 16:59)</a>:</h4>
<p>(and not through it)</p>



<a name="250961428"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/186049-t-compiler/wg-polonius/topic/purely%20forward%20propagation/near/250961428" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/186049-t-compiler/wg-polonius/topic/purely.20forward.20propagation.html#250961428">(Aug 27 2021 at 16:59)</a>:</h4>
<p>but if I do:</p>



<a name="250961541"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/186049-t-compiler/wg-polonius/topic/purely%20forward%20propagation/near/250961541" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/186049-t-compiler/wg-polonius/topic/purely.20forward.20propagation.html#250961541">(Aug 27 2021 at 17:00)</a>:</h4>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="kd">let</span><span class="w"> </span><span class="k">mut</span><span class="w"> </span><span class="n">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">22</span><span class="p">;</span><span class="w"></span>
<span class="kd">let</span><span class="w"> </span><span class="k">mut</span><span class="w"> </span><span class="n">y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">44</span><span class="p">;</span><span class="w"></span>
<span class="kd">let</span><span class="w"> </span><span class="k">mut</span><span class="w"> </span><span class="n">p</span>: <span class="kp">&amp;</span><span class="nc">mut</span><span class="w"> </span><span class="kt">u32</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">&amp;</span><span class="k">mut</span><span class="w"> </span><span class="n">x</span><span class="p">;</span><span class="w"></span>
<span class="kd">let</span><span class="w"> </span><span class="k">mut</span><span class="w"> </span><span class="n">q</span>: <span class="kp">&amp;</span><span class="nc">mut</span><span class="w"> </span><span class="kt">u32</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">&amp;</span><span class="k">mut</span><span class="w"> </span><span class="o">*</span><span class="n">p</span><span class="p">;</span><span class="w"></span>
<span class="n">p</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">&amp;</span><span class="k">mut</span><span class="w"> </span><span class="n">y</span><span class="p">;</span><span class="w"></span>
</code></pre></div>



<a name="250961566"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/186049-t-compiler/wg-polonius/topic/purely%20forward%20propagation/near/250961566" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/186049-t-compiler/wg-polonius/topic/purely.20forward.20propagation.html#250961566">(Aug 27 2021 at 17:00)</a>:</h4>
<p><code>q</code> borrowed <code>*p</code></p>



<a name="250961600"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/186049-t-compiler/wg-polonius/topic/purely%20forward%20propagation/near/250961600" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/186049-t-compiler/wg-polonius/topic/purely.20forward.20propagation.html#250961600">(Aug 27 2021 at 17:00)</a>:</h4>
<p>and yet changing <code>p</code> to point at something else doesn't <em>invalidate</em> <code>q</code></p>



<a name="250961627"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/186049-t-compiler/wg-polonius/topic/purely%20forward%20propagation/near/250961627" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/186049-t-compiler/wg-polonius/topic/purely.20forward.20propagation.html#250961627">(Aug 27 2021 at 17:00)</a>:</h4>
<p>the memory <code>q</code> references (<code>x</code>) is still unchanged</p>



<a name="250961674"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/186049-t-compiler/wg-polonius/topic/purely%20forward%20propagation/near/250961674" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/186049-t-compiler/wg-polonius/topic/purely.20forward.20propagation.html#250961674">(Aug 27 2021 at 17:01)</a>:</h4>
<p>and, indeed, if we now to <code>*p = 23;</code></p>



<a name="250961699"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/186049-t-compiler/wg-polonius/topic/purely%20forward%20propagation/near/250961699" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/186049-t-compiler/wg-polonius/topic/purely.20forward.20propagation.html#250961699">(Aug 27 2021 at 17:01)</a>:</h4>
<p>that doesn't invalidate <code>q</code> either, even though <code>q</code> borrowed <code>*p</code></p>



<a name="250961856"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/186049-t-compiler/wg-polonius/topic/purely%20forward%20propagation/near/250961856" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Domenic Quirl <a href="https://zulip-archive.rust-lang.org/stream/186049-t-compiler/wg-polonius/topic/purely.20forward.20propagation.html#250961856">(Aug 27 2021 at 17:02)</a>:</h4>
<p>that makes sense I think</p>



<a name="250961922"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/186049-t-compiler/wg-polonius/topic/purely%20forward%20propagation/near/250961922" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Domenic Quirl <a href="https://zulip-archive.rust-lang.org/stream/186049-t-compiler/wg-polonius/topic/purely.20forward.20propagation.html#250961922">(Aug 27 2021 at 17:03)</a>:</h4>
<p>assigning to <code>p</code> would invalidate anything that has a loan <code>&amp;mut p</code>, but not <code>&amp;mut *p</code></p>



<a name="250962009"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/186049-t-compiler/wg-polonius/topic/purely%20forward%20propagation/near/250962009" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/186049-t-compiler/wg-polonius/topic/purely.20forward.20propagation.html#250962009">(Aug 27 2021 at 17:03)</a>:</h4>
<p>correct</p>



<a name="250962059"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/186049-t-compiler/wg-polonius/topic/purely%20forward%20propagation/near/250962059" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/186049-t-compiler/wg-polonius/topic/purely.20forward.20propagation.html#250962059">(Aug 27 2021 at 17:04)</a>:</h4>
<p>it's kind of "loan_inapplicable"</p>



<a name="250962066"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/186049-t-compiler/wg-polonius/topic/purely%20forward%20propagation/near/250962066" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/186049-t-compiler/wg-polonius/topic/purely.20forward.20propagation.html#250962066">(Aug 27 2021 at 17:04)</a>:</h4>
<p>"outdated"</p>



<a name="250962068"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/186049-t-compiler/wg-polonius/topic/purely%20forward%20propagation/near/250962068" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/186049-t-compiler/wg-polonius/topic/purely.20forward.20propagation.html#250962068">(Aug 27 2021 at 17:04)</a>:</h4>
<p>something :)</p>



<a name="250962078"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/186049-t-compiler/wg-polonius/topic/purely%20forward%20propagation/near/250962078" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Domenic Quirl <a href="https://zulip-archive.rust-lang.org/stream/186049-t-compiler/wg-polonius/topic/purely.20forward.20propagation.html#250962078">(Aug 27 2021 at 17:04)</a>:</h4>
<p>and assigning to <code>*p</code> invalidates anything that has a loan <code>&amp;mut *p</code>, but only _after_ that was last "killed"</p>



<a name="250962089"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/186049-t-compiler/wg-polonius/topic/purely%20forward%20propagation/near/250962089" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Dylan MacKenzie (ecstatic-morse) <a href="https://zulip-archive.rust-lang.org/stream/186049-t-compiler/wg-polonius/topic/purely.20forward.20propagation.html#250962089">(Aug 27 2021 at 17:04)</a>:</h4>
<p><span class="user-mention" data-user-id="337115">@Domenic Quirl</span> FYI this is discussed in the first Polonius blog post <a href="https://smallcultfollowing.com/babysteps/blog/2018/04/27/an-alias-based-formulation-of-the-borrow-checker/#the-requires-relation">https://smallcultfollowing.com/babysteps/blog/2018/04/27/an-alias-based-formulation-of-the-borrow-checker/#the-requires-relation</a> a few paragraphs down</p>



<a name="250962254"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/186049-t-compiler/wg-polonius/topic/purely%20forward%20propagation/near/250962254" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Domenic Quirl <a href="https://zulip-archive.rust-lang.org/stream/186049-t-compiler/wg-polonius/topic/purely.20forward.20propagation.html#250962254">(Aug 27 2021 at 17:05)</a>:</h4>
<p>so the old loan in <code>q</code> is no longer bound by this, but if I had <code>let mut r = &amp;mut *p;</code> between the two re-assignments, it would</p>



<a name="250962372"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/186049-t-compiler/wg-polonius/topic/purely%20forward%20propagation/near/250962372" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Domenic Quirl <a href="https://zulip-archive.rust-lang.org/stream/186049-t-compiler/wg-polonius/topic/purely.20forward.20propagation.html#250962372">(Aug 27 2021 at 17:06)</a>:</h4>
<p><span class="user-mention silent" data-user-id="118594">Dylan MacKenzie (ecstatic-morse)</span> <a href="#narrow/stream/186049-t-compiler.2Fwg-polonius/topic/purely.20forward.20propagation/near/250962089">said</a>:</p>
<blockquote>
<p><span class="user-mention silent" data-user-id="337115">Domenic Quirl</span> FYI this is discussed in the first Polonius blog post <a href="https://smallcultfollowing.com/babysteps/blog/2018/04/27/an-alias-based-formulation-of-the-borrow-checker/#the-requires-relation">https://smallcultfollowing.com/babysteps/blog/2018/04/27/an-alias-based-formulation-of-the-borrow-checker/#the-requires-relation</a> a few paragraphs down</p>
</blockquote>
<p>I have read most of this before, but it's different in here when y'all are moving so fast <span aria-label="sweat smile" class="emoji emoji-1f605" role="img" title="sweat smile">:sweat_smile:</span></p>



<a name="250962412"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/186049-t-compiler/wg-polonius/topic/purely%20forward%20propagation/near/250962412" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/186049-t-compiler/wg-polonius/topic/purely.20forward.20propagation.html#250962412">(Aug 27 2021 at 17:06)</a>:</h4>
<p>the terminology is also quite dated</p>



<a name="250962676"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/186049-t-compiler/wg-polonius/topic/purely%20forward%20propagation/near/250962676" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Domenic Quirl <a href="https://zulip-archive.rust-lang.org/stream/186049-t-compiler/wg-polonius/topic/purely.20forward.20propagation.html#250962676">(Aug 27 2021 at 17:08)</a>:</h4>
<p>So then <code>origin_killed</code> is mostly to filter out origins from other relations that are no longer useful?</p>



<a name="250962699"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/186049-t-compiler/wg-polonius/topic/purely%20forward%20propagation/near/250962699" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Domenic Quirl <a href="https://zulip-archive.rust-lang.org/stream/186049-t-compiler/wg-polonius/topic/purely.20forward.20propagation.html#250962699">(Aug 27 2021 at 17:08)</a>:</h4>
<p>(the origins, not the relations)</p>



<a name="250962933"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/186049-t-compiler/wg-polonius/topic/purely%20forward%20propagation/near/250962933" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/186049-t-compiler/wg-polonius/topic/purely.20forward.20propagation.html#250962933">(Aug 27 2021 at 17:10)</a>:</h4>
<p>yes</p>



<a name="250962967"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/186049-t-compiler/wg-polonius/topic/purely%20forward%20propagation/near/250962967" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/186049-t-compiler/wg-polonius/topic/purely.20forward.20propagation.html#250962967">(Aug 27 2021 at 17:10)</a>:</h4>
<p>I should play out <span class="user-mention" data-user-id="118594">@Dylan MacKenzie (ecstatic-morse)</span>'s example, but the idea of "kill origin"</p>



<a name="250962976"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/186049-t-compiler/wg-polonius/topic/purely%20forward%20propagation/near/250962976" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/186049-t-compiler/wg-polonius/topic/purely.20forward.20propagation.html#250962976">(Aug 27 2021 at 17:10)</a>:</h4>
<p>(note that I changed all input facts to the <em>imperative</em>)</p>



<a name="250962988"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/186049-t-compiler/wg-polonius/topic/purely%20forward%20propagation/near/250962988" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/186049-t-compiler/wg-polonius/topic/purely.20forward.20propagation.html#250962988">(Aug 27 2021 at 17:11)</a>:</h4>
<p>anyway, the idea of "kill origin" is similar</p>



<a name="250962992"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/186049-t-compiler/wg-polonius/topic/purely%20forward%20propagation/near/250962992" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/186049-t-compiler/wg-polonius/topic/purely.20forward.20propagation.html#250962992">(Aug 27 2021 at 17:11)</a>:</h4>
<p>if you had</p>



<a name="250963032"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/186049-t-compiler/wg-polonius/topic/purely%20forward%20propagation/near/250963032" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/186049-t-compiler/wg-polonius/topic/purely.20forward.20propagation.html#250963032">(Aug 27 2021 at 17:11)</a>:</h4>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="kd">let</span><span class="w"> </span><span class="k">mut</span><span class="w"> </span><span class="n">p</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">&amp;</span><span class="n">x</span><span class="p">;</span><span class="w"></span>
<span class="o">....</span><span class="w"></span>
<span class="n">p</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">&amp;</span><span class="n">y</span><span class="p">;</span><span class="w"></span>
<span class="n">x</span><span class="w"> </span><span class="o">+=</span><span class="w"> </span><span class="mi">10</span><span class="p">;</span><span class="w"></span>
</code></pre></div>



<a name="250963043"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/186049-t-compiler/wg-polonius/topic/purely%20forward%20propagation/near/250963043" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/186049-t-compiler/wg-polonius/topic/purely.20forward.20propagation.html#250963043">(Aug 27 2021 at 17:11)</a>:</h4>
<p>"clearly" <code>p</code> is not affected by this change to <code>x</code></p>



<a name="250963054"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/186049-t-compiler/wg-polonius/topic/purely%20forward%20propagation/near/250963054" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/186049-t-compiler/wg-polonius/topic/purely.20forward.20propagation.html#250963054">(Aug 27 2021 at 17:11)</a>:</h4>
<p>because it has a new value now</p>



<a name="250963070"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/186049-t-compiler/wg-polonius/topic/purely%20forward%20propagation/near/250963070" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/186049-t-compiler/wg-polonius/topic/purely.20forward.20propagation.html#250963070">(Aug 27 2021 at 17:11)</a>:</h4>
<p>we used to manage this through liveness -- p was "dead" on entry</p>



<a name="250963100"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/186049-t-compiler/wg-polonius/topic/purely%20forward%20propagation/near/250963100" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/186049-t-compiler/wg-polonius/topic/purely.20forward.20propagation.html#250963100">(Aug 27 2021 at 17:11)</a>:</h4>
<p>but I think that using this concept of "killing" is better</p>



<a name="250963152"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/186049-t-compiler/wg-polonius/topic/purely%20forward%20propagation/near/250963152" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/186049-t-compiler/wg-polonius/topic/purely.20forward.20propagation.html#250963152">(Aug 27 2021 at 17:12)</a>:</h4>
<p>if we are trying to propagate everything forward</p>



<a name="250963164"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/186049-t-compiler/wg-polonius/topic/purely%20forward%20propagation/near/250963164" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Dylan MacKenzie (ecstatic-morse) <a href="https://zulip-archive.rust-lang.org/stream/186049-t-compiler/wg-polonius/topic/purely.20forward.20propagation.html#250963164">(Aug 27 2021 at 17:12)</a>:</h4>
<p>So right now we have this rule for propagating <code>loan_in_origin</code> across the CFG</p>
<div class="codehilite" data-code-language="Prolog"><pre><span></span><code><span class="nf">loan_in_origin</span><span class="p">(</span><span class="nv">L</span><span class="p">,</span> <span class="nv">O</span><span class="p">,</span> <span class="nv">N2</span><span class="p">)</span> <span class="p">:-</span> <span class="o">//</span> <span class="nv">Carried</span> <span class="s s-Atom">over</span> <span class="s s-Atom">from</span> <span class="s s-Atom">predecessor</span>
  <span class="nf">cfg_edge</span><span class="p">(</span><span class="nv">N1</span><span class="p">,</span> <span class="nv">N2</span><span class="p">),</span>
  <span class="nf">loan_in_origin</span><span class="p">(</span><span class="nv">L</span><span class="p">,</span> <span class="nv">O</span><span class="p">,</span> <span class="nv">N1</span><span class="p">),</span>
  <span class="p">!</span><span class="nf">loan_killed</span><span class="p">(</span><span class="nv">L</span><span class="p">,</span> <span class="nv">N1</span><span class="p">),</span>
  <span class="p">!</span><span class="nf">loan_invalidated</span><span class="p">(</span><span class="nv">L</span><span class="p">,</span> <span class="nv">N1</span><span class="p">).</span>
</code></pre></div>
<p>and this one for <code>origin_invalidated</code></p>
<div class="codehilite" data-code-language="Prolog"><pre><span></span><code><span class="nf">origin_invalidated</span><span class="p">(</span><span class="nv">O</span><span class="p">,</span> <span class="nv">N2</span><span class="p">)</span> <span class="p">:-</span> <span class="o">//</span> <span class="nv">Introduced</span> <span class="s s-Atom">by</span> <span class="s s-Atom">predecessor</span>
  <span class="nf">cfg_edge</span><span class="p">(</span><span class="nv">N1</span><span class="p">,</span> <span class="nv">N2</span><span class="p">),</span>
  <span class="nf">loan_in_origin</span><span class="p">(</span><span class="nv">L</span><span class="p">,</span> <span class="nv">O</span><span class="p">,</span> <span class="nv">N1</span><span class="p">),</span>
  <span class="nf">loan_invalidated</span><span class="p">(</span><span class="nv">L</span><span class="p">,</span> <span class="nv">N1</span><span class="p">).</span>
</code></pre></div>
<p>It looks a bit funny to remove invalidated loans from origins, but then to use <code>loan_in_origin</code> to compute <code>origin_invalidated</code>. I think what makes this work is the fact that the loan will no longer be in the origin at N2 (the successor) but it <em>will</em> be at N1, which is when we record the error. Is this the right intuition?</p>



<a name="250963182"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/186049-t-compiler/wg-polonius/topic/purely%20forward%20propagation/near/250963182" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/186049-t-compiler/wg-polonius/topic/purely.20forward.20propagation.html#250963182">(Aug 27 2021 at 17:12)</a>:</h4>
<p>(actually liveness uses the same terminology; <code>p</code> is considered killed on that node, so it is not live in prior nodes...)</p>



<a name="250963219"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/186049-t-compiler/wg-polonius/topic/purely%20forward%20propagation/near/250963219" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Domenic Quirl <a href="https://zulip-archive.rust-lang.org/stream/186049-t-compiler/wg-polonius/topic/purely.20forward.20propagation.html#250963219">(Aug 27 2021 at 17:12)</a>:</h4>
<p>Also couldn't <code>p</code> be live still since I could use it still after the <code>x += 10</code>?</p>



<a name="250963324"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/186049-t-compiler/wg-polonius/topic/purely%20forward%20propagation/near/250963324" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Dylan MacKenzie (ecstatic-morse) <a href="https://zulip-archive.rust-lang.org/stream/186049-t-compiler/wg-polonius/topic/purely.20forward.20propagation.html#250963324">(Aug 27 2021 at 17:13)</a>:</h4>
<p><span class="user-mention silent" data-user-id="116009">nikomatsakis</span> <a href="#narrow/stream/186049-t-compiler.2Fwg-polonius/topic/purely.20forward.20propagation/near/250963100">said</a>:</p>
<blockquote>
<p>but I think that using this concept of "killing" is better</p>
</blockquote>
<p>This is "killing" as in <code>loan_killed_at</code> right? This clicks for me, since liveness and <code>loan_killed_at</code> seemed to be fulfilling a very similar role.</p>



<a name="250963331"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/186049-t-compiler/wg-polonius/topic/purely%20forward%20propagation/near/250963331" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/186049-t-compiler/wg-polonius/topic/purely.20forward.20propagation.html#250963331">(Aug 27 2021 at 17:13)</a>:</h4>
<p><span class="user-mention" data-user-id="118594">@Dylan MacKenzie (ecstatic-morse)</span> yes. I'm not sure if I have that right, now that you mention it, in that I think it would be best if an origin <em>either</em> contains loans <em>or</em> is invalidated</p>



<a name="250963372"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/186049-t-compiler/wg-polonius/topic/purely%20forward%20propagation/near/250963372" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/186049-t-compiler/wg-polonius/topic/purely.20forward.20propagation.html#250963372">(Aug 27 2021 at 17:13)</a>:</h4>
<p><span class="user-mention silent" data-user-id="118594">Dylan MacKenzie (ecstatic-morse)</span> <a href="#narrow/stream/186049-t-compiler.2Fwg-polonius/topic/purely.20forward.20propagation/near/250963324">said</a>:</p>
<blockquote>
<p><span class="user-mention silent" data-user-id="116009">nikomatsakis</span> <a href="#narrow/stream/186049-t-compiler.2Fwg-polonius/topic/purely.20forward.20propagation/near/250963100">said</a>:</p>
<blockquote>
<p>but I think that using this concept of "killing" is better</p>
</blockquote>
<p>This is "killing" as in <code>loan_killed_at</code> right? This clicks for me, since liveness and <code>loan_killed_at</code> seemed to be fulfilling a very similar role.</p>
</blockquote>
<p>correct</p>



<a name="250963453"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/186049-t-compiler/wg-polonius/topic/purely%20forward%20propagation/near/250963453" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/186049-t-compiler/wg-polonius/topic/purely.20forward.20propagation.html#250963453">(Aug 27 2021 at 17:14)</a>:</h4>
<p><span class="user-mention silent" data-user-id="337115">Domenic Quirl</span> <a href="#narrow/stream/186049-t-compiler.2Fwg-polonius/topic/purely.20forward.20propagation/near/250963219">said</a>:</p>
<blockquote>
<p>Also couldn't <code>p</code> be live still since I could use it still after the <code>x += 10</code>?</p>
</blockquote>
<p><code>p</code> is dead on entry to <code>p = &amp;y</code> but (potentially) live on exit</p>



<a name="250963468"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/186049-t-compiler/wg-polonius/topic/purely%20forward%20propagation/near/250963468" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/186049-t-compiler/wg-polonius/topic/purely.20forward.20propagation.html#250963468">(Aug 27 2021 at 17:14)</a>:</h4>
<p>i.e., it would be live if it is used again later</p>



<a name="250963610"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/186049-t-compiler/wg-polonius/topic/purely%20forward%20propagation/near/250963610" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/186049-t-compiler/wg-polonius/topic/purely.20forward.20propagation.html#250963610">(Aug 27 2021 at 17:15)</a>:</h4>
<p><span class="user-mention silent" data-user-id="116009">nikomatsakis</span> <a href="#narrow/stream/186049-t-compiler.2Fwg-polonius/topic/purely.20forward.20propagation/near/250963331">said</a>:</p>
<blockquote>
<p><span class="user-mention silent" data-user-id="118594">Dylan MacKenzie (ecstatic-morse)</span> yes. I'm not sure if I have that right, now that you mention it, in that I think it would be best if an origin <em>either</em> contains loans <em>or</em> is invalidated</p>
</blockquote>
<p>but I don't think it's <em>harmful</em> as is</p>



<a name="250963615"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/186049-t-compiler/wg-polonius/topic/purely%20forward%20propagation/near/250963615" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/186049-t-compiler/wg-polonius/topic/purely.20forward.20propagation.html#250963615">(Aug 27 2021 at 17:15)</a>:</h4>
<p>just...noisy</p>



<a name="250963638"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/186049-t-compiler/wg-polonius/topic/purely%20forward%20propagation/near/250963638" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/186049-t-compiler/wg-polonius/topic/purely.20forward.20propagation.html#250963638">(Aug 27 2021 at 17:15)</a>:</h4>
<p>it might be nicer to compute "invalidated loans on exit"</p>



<a name="250963711"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/186049-t-compiler/wg-polonius/topic/purely%20forward%20propagation/near/250963711" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/186049-t-compiler/wg-polonius/topic/purely.20forward.20propagation.html#250963711">(Aug 27 2021 at 17:16)</a>:</h4>
<p>but that I guess requires negative rules</p>



<a name="250963723"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/186049-t-compiler/wg-polonius/topic/purely%20forward%20propagation/near/250963723" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/186049-t-compiler/wg-polonius/topic/purely.20forward.20propagation.html#250963723">(Aug 27 2021 at 17:16)</a>:</h4>
<p>yeah... I don't want to go there</p>



<a name="250964059"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/186049-t-compiler/wg-polonius/topic/purely%20forward%20propagation/near/250964059" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/186049-t-compiler/wg-polonius/topic/purely.20forward.20propagation.html#250964059">(Aug 27 2021 at 17:18)</a>:</h4>
<p><span class="user-mention silent" data-user-id="118594">Dylan MacKenzie (ecstatic-morse)</span> <a href="#narrow/stream/186049-t-compiler.2Fwg-polonius/topic/purely.20forward.20propagation/near/250958209">said</a>:</p>
<blockquote>
<p><div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="kd">let</span><span class="w"> </span><span class="n">p</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">22</span><span class="p">;</span><span class="w"></span>
<span class="kd">let</span><span class="w"> </span><span class="n">q</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">44</span><span class="p">;</span><span class="w"></span>
<span class="kd">let</span><span class="w"> </span><span class="n">x</span>: <span class="kp">&amp;</span><span class="nc">mut</span><span class="w"> </span><span class="kt">i32</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">&amp;</span><span class="k">mut</span><span class="w"> </span><span class="n">p</span><span class="p">;</span><span class="w"> </span><span class="c1">// `x` points at `p`</span>
<span class="kd">let</span><span class="w"> </span><span class="n">y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">&amp;</span><span class="k">mut</span><span class="w"> </span><span class="o">*</span><span class="n">x</span><span class="p">;</span><span class="w"> </span><span class="c1">// Loan L0, `y` points at `p` too</span>
<span class="c1">// ...</span>
<span class="n">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">&amp;</span><span class="k">mut</span><span class="w"> </span><span class="n">q</span><span class="p">;</span><span class="w"> </span><span class="c1">// `x` points at `q`; kills L0</span>
</code></pre></div><br>
</p>
</blockquote>
<p>let me work this example</p>



<a name="250964304"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/186049-t-compiler/wg-polonius/topic/purely%20forward%20propagation/near/250964304" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Domenic Quirl <a href="https://zulip-archive.rust-lang.org/stream/186049-t-compiler/wg-polonius/topic/purely.20forward.20propagation.html#250964304">(Aug 27 2021 at 17:20)</a>:</h4>
<p>(mind if I match the remaining relation names in the graphs?)</p>



<a name="250964319"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/186049-t-compiler/wg-polonius/topic/purely%20forward%20propagation/near/250964319" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/186049-t-compiler/wg-polonius/topic/purely.20forward.20propagation.html#250964319">(Aug 27 2021 at 17:20)</a>:</h4>
<p>nope</p>



<a name="250964350"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/186049-t-compiler/wg-polonius/topic/purely%20forward%20propagation/near/250964350" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/186049-t-compiler/wg-polonius/topic/purely.20forward.20propagation.html#250964350">(Aug 27 2021 at 17:20)</a>:</h4>
<p>I put a &lt;hr&gt; in at a certain point where I wanted to go back over them</p>



<a name="250964361"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/186049-t-compiler/wg-polonius/topic/purely%20forward%20propagation/near/250964361" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/186049-t-compiler/wg-polonius/topic/purely.20forward.20propagation.html#250964361">(Aug 27 2021 at 17:20)</a>:</h4>
<p>because I'm not sure they're consistent. :)</p>



<a name="250964609"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/186049-t-compiler/wg-polonius/topic/purely%20forward%20propagation/near/250964609" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Dylan MacKenzie (ecstatic-morse) <a href="https://zulip-archive.rust-lang.org/stream/186049-t-compiler/wg-polonius/topic/purely.20forward.20propagation.html#250964609">(Aug 27 2021 at 17:22)</a>:</h4>
<p>Is "overwritten" or "redirected" a better name than "killed"? The fact that liveness uses "kill" for variables that are no longer live is unfortunate. "overwrite" is a bit less visceral though.</p>



<a name="250964658"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/186049-t-compiler/wg-polonius/topic/purely%20forward%20propagation/near/250964658" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/186049-t-compiler/wg-polonius/topic/purely.20forward.20propagation.html#250964658">(Aug 27 2021 at 17:22)</a>:</h4>
<p>heh</p>



<a name="250964674"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/186049-t-compiler/wg-polonius/topic/purely%20forward%20propagation/near/250964674" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/186049-t-compiler/wg-polonius/topic/purely.20forward.20propagation.html#250964674">(Aug 27 2021 at 17:22)</a>:</h4>
<p>I considered "overwrite" but it doesn't <em>obviously</em> say kill to me</p>



<a name="250964686"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/186049-t-compiler/wg-polonius/topic/purely%20forward%20propagation/near/250964686" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/186049-t-compiler/wg-polonius/topic/purely.20forward.20propagation.html#250964686">(Aug 27 2021 at 17:22)</a>:</h4>
<p>in fact it kind of sounds like invalidate?</p>



<a name="250964701"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/186049-t-compiler/wg-polonius/topic/purely%20forward%20propagation/near/250964701" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/186049-t-compiler/wg-polonius/topic/purely.20forward.20propagation.html#250964701">(Aug 27 2021 at 17:23)</a>:</h4>
<p>redirect is not bad</p>



<a name="250964720"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/186049-t-compiler/wg-polonius/topic/purely%20forward%20propagation/near/250964720" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/186049-t-compiler/wg-polonius/topic/purely.20forward.20propagation.html#250964720">(Aug 27 2021 at 17:23)</a>:</h4>
<p>inapplicable is not a verb</p>



<a name="250964740"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/186049-t-compiler/wg-polonius/topic/purely%20forward%20propagation/near/250964740" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/186049-t-compiler/wg-polonius/topic/purely.20forward.20propagation.html#250964740">(Aug 27 2021 at 17:23)</a>:</h4>
<p><code>inapplicate_loan</code> :)</p>



<a name="250964775"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/186049-t-compiler/wg-polonius/topic/purely%20forward%20propagation/near/250964775" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/186049-t-compiler/wg-polonius/topic/purely.20forward.20propagation.html#250964775">(Aug 27 2021 at 17:23)</a>:</h4>
<p>I like <code>redirect_</code>, shall we try that?</p>



<a name="250964800"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/186049-t-compiler/wg-polonius/topic/purely%20forward%20propagation/near/250964800" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/186049-t-compiler/wg-polonius/topic/purely.20forward.20propagation.html#250964800">(Aug 27 2021 at 17:23)</a>:</h4>
<p>it sounds like we're going to <em>redirect the loan from X to Y</em></p>



<a name="250964813"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/186049-t-compiler/wg-polonius/topic/purely%20forward%20propagation/near/250964813" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/186049-t-compiler/wg-polonius/topic/purely.20forward.20propagation.html#250964813">(Aug 27 2021 at 17:23)</a>:</h4>
<p>where we really mean "the path of this loan has been redirected" or something</p>



<a name="250964964"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/186049-t-compiler/wg-polonius/topic/purely%20forward%20propagation/near/250964964" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Dylan MacKenzie (ecstatic-morse) <a href="https://zulip-archive.rust-lang.org/stream/186049-t-compiler/wg-polonius/topic/purely.20forward.20propagation.html#250964964">(Aug 27 2021 at 17:24)</a>:</h4>
<p>There's "obviate" I guess but that's pretty unfriendly to non-native speakers</p>



<a name="250964969"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/186049-t-compiler/wg-polonius/topic/purely%20forward%20propagation/near/250964969" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/186049-t-compiler/wg-polonius/topic/purely.20forward.20propagation.html#250964969">(Aug 27 2021 at 17:25)</a>:</h4>
<p>oooh</p>



<a name="250964971"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/186049-t-compiler/wg-polonius/topic/purely%20forward%20propagation/near/250964971" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Domenic Quirl <a href="https://zulip-archive.rust-lang.org/stream/186049-t-compiler/wg-polonius/topic/purely.20forward.20propagation.html#250964971">(Aug 27 2021 at 17:25)</a>:</h4>
<p>it's more like the target of the loan no longer matches its path</p>



<a name="250964986"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/186049-t-compiler/wg-polonius/topic/purely%20forward%20propagation/near/250964986" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/186049-t-compiler/wg-polonius/topic/purely.20forward.20propagation.html#250964986">(Aug 27 2021 at 17:25)</a>:</h4>
<p>I like obviate</p>



<a name="250964990"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/186049-t-compiler/wg-polonius/topic/purely%20forward%20propagation/near/250964990" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Dylan MacKenzie (ecstatic-morse) <a href="https://zulip-archive.rust-lang.org/stream/186049-t-compiler/wg-polonius/topic/purely.20forward.20propagation.html#250964990">(Aug 27 2021 at 17:25)</a>:</h4>
<p>Whatever helps you think about stuff.</p>



<a name="250965006"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/186049-t-compiler/wg-polonius/topic/purely%20forward%20propagation/near/250965006" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/186049-t-compiler/wg-polonius/topic/purely.20forward.20propagation.html#250965006">(Aug 27 2021 at 17:25)</a>:</h4>
<p>it's just a word I am fond of :)</p>



<a name="250965141"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/186049-t-compiler/wg-polonius/topic/purely%20forward%20propagation/near/250965141" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/186049-t-compiler/wg-polonius/topic/purely.20forward.20propagation.html#250965141">(Aug 27 2021 at 17:26)</a>:</h4>
<p>well</p>



<a name="250965153"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/186049-t-compiler/wg-polonius/topic/purely%20forward%20propagation/near/250965153" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/186049-t-compiler/wg-polonius/topic/purely.20forward.20propagation.html#250965153">(Aug 27 2021 at 17:26)</a>:</h4>
<p>it's more pedestrian but</p>



<a name="250965159"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/186049-t-compiler/wg-polonius/topic/purely%20forward%20propagation/near/250965159" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/186049-t-compiler/wg-polonius/topic/purely.20forward.20propagation.html#250965159">(Aug 27 2021 at 17:26)</a>:</h4>
<p><code>remove_</code> ?</p>



<a name="250965184"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/186049-t-compiler/wg-polonius/topic/purely%20forward%20propagation/near/250965184" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/186049-t-compiler/wg-polonius/topic/purely.20forward.20propagation.html#250965184">(Aug 27 2021 at 17:26)</a>:</h4>
<p>it's ... like literally what we do :)</p>



<a name="250965195"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/186049-t-compiler/wg-polonius/topic/purely%20forward%20propagation/near/250965195" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/186049-t-compiler/wg-polonius/topic/purely.20forward.20propagation.html#250965195">(Aug 27 2021 at 17:26)</a>:</h4>
<p>"we remove this loan from all origins"</p>



<a name="250965296"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/186049-t-compiler/wg-polonius/topic/purely%20forward%20propagation/near/250965296" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/186049-t-compiler/wg-polonius/topic/purely.20forward.20propagation.html#250965296">(Aug 27 2021 at 17:27)</a>:</h4>
<p>/vote What should we call the kill relations?</p>



<a name="250965303"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/186049-t-compiler/wg-polonius/topic/purely%20forward%20propagation/near/250965303" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Dylan MacKenzie (ecstatic-morse) <a href="https://zulip-archive.rust-lang.org/stream/186049-t-compiler/wg-polonius/topic/purely.20forward.20propagation.html#250965303">(Aug 27 2021 at 17:27)</a>:</h4>
<p>Is the difference between "remove" and "invalidate" clear?</p>



<a name="250965323"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/186049-t-compiler/wg-polonius/topic/purely%20forward%20propagation/near/250965323" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/186049-t-compiler/wg-polonius/topic/purely.20forward.20propagation.html#250965323">(Aug 27 2021 at 17:27)</a>:</h4>
<p>/poll What should we call the kill relations?</p>



<a name="250965383"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/186049-t-compiler/wg-polonius/topic/purely%20forward%20propagation/near/250965383" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/186049-t-compiler/wg-polonius/topic/purely.20forward.20propagation.html#250965383">(Aug 27 2021 at 17:27)</a>:</h4>
<p><span class="user-mention silent" data-user-id="118594">Dylan MacKenzie (ecstatic-morse)</span> <a href="#narrow/stream/186049-t-compiler.2Fwg-polonius/topic/purely.20forward.20propagation/near/250965303">said</a>:</p>
<blockquote>
<p>Is the difference between "remove" and "invalidate" clear?</p>
</blockquote>
<p>I don't know...</p>



<a name="250965437"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/186049-t-compiler/wg-polonius/topic/purely%20forward%20propagation/near/250965437" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Dylan MacKenzie (ecstatic-morse) <a href="https://zulip-archive.rust-lang.org/stream/186049-t-compiler/wg-polonius/topic/purely.20forward.20propagation.html#250965437">(Aug 27 2021 at 17:28)</a>:</h4>
<p>That would be my only concern.</p>



<a name="250965442"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/186049-t-compiler/wg-polonius/topic/purely%20forward%20propagation/near/250965442" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/186049-t-compiler/wg-polonius/topic/purely.20forward.20propagation.html#250965442">(Aug 27 2021 at 17:28)</a>:</h4>
<p>it at least sounds different</p>



<a name="250965487"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/186049-t-compiler/wg-polonius/topic/purely%20forward%20propagation/near/250965487" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/186049-t-compiler/wg-polonius/topic/purely.20forward.20propagation.html#250965487">(Aug 27 2021 at 17:28)</a>:</h4>
<p>another option:</p>



<a name="250965499"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/186049-t-compiler/wg-polonius/topic/purely%20forward%20propagation/near/250965499" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/186049-t-compiler/wg-polonius/topic/purely.20forward.20propagation.html#250965499">(Aug 27 2021 at 17:28)</a>:</h4>
<p><code>ignore_</code></p>



<a name="250965528"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/186049-t-compiler/wg-polonius/topic/purely%20forward%20propagation/near/250965528" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/186049-t-compiler/wg-polonius/topic/purely.20forward.20propagation.html#250965528">(Aug 27 2021 at 17:28)</a>:</h4>
<p>added a few more options to my poll :)</p>



<a name="250965533"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/186049-t-compiler/wg-polonius/topic/purely%20forward%20propagation/near/250965533" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/186049-t-compiler/wg-polonius/topic/purely.20forward.20propagation.html#250965533">(Aug 27 2021 at 17:28)</a>:</h4>
<p><code>forget_</code></p>



<a name="250965548"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/186049-t-compiler/wg-polonius/topic/purely%20forward%20propagation/near/250965548" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/186049-t-compiler/wg-polonius/topic/purely.20forward.20propagation.html#250965548">(Aug 27 2021 at 17:28)</a>:</h4>
<p>forget is unterrible</p>



<a name="250965581"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/186049-t-compiler/wg-polonius/topic/purely%20forward%20propagation/near/250965581" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Dylan MacKenzie (ecstatic-morse) <a href="https://zulip-archive.rust-lang.org/stream/186049-t-compiler/wg-polonius/topic/purely.20forward.20propagation.html#250965581">(Aug 27 2021 at 17:29)</a>:</h4>
<p>I like forget actually</p>



<a name="250965583"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/186049-t-compiler/wg-polonius/topic/purely%20forward%20propagation/near/250965583" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/186049-t-compiler/wg-polonius/topic/purely.20forward.20propagation.html#250965583">(Aug 27 2021 at 17:29)</a>:</h4>
<p>maybe people think of <code>std::mem::forget</code> :)</p>



<a name="250965588"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/186049-t-compiler/wg-polonius/topic/purely%20forward%20propagation/near/250965588" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/186049-t-compiler/wg-polonius/topic/purely.20forward.20propagation.html#250965588">(Aug 27 2021 at 17:29)</a>:</h4>
<p>but hopefully not</p>



<a name="250965617"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/186049-t-compiler/wg-polonius/topic/purely%20forward%20propagation/near/250965617" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Domenic Quirl <a href="https://zulip-archive.rust-lang.org/stream/186049-t-compiler/wg-polonius/topic/purely.20forward.20propagation.html#250965617">(Aug 27 2021 at 17:29)</a>:</h4>
<p>This is confusing me again</p>



<a name="250965726"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/186049-t-compiler/wg-polonius/topic/purely%20forward%20propagation/near/250965726" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Domenic Quirl <a href="https://zulip-archive.rust-lang.org/stream/186049-t-compiler/wg-polonius/topic/purely.20forward.20propagation.html#250965726">(Aug 27 2021 at 17:30)</a>:</h4>
<p>I get that "killed" loans are in a way independent of their path</p>



<a name="250965735"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/186049-t-compiler/wg-polonius/topic/purely%20forward%20propagation/near/250965735" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Domenic Quirl <a href="https://zulip-archive.rust-lang.org/stream/186049-t-compiler/wg-polonius/topic/purely.20forward.20propagation.html#250965735">(Aug 27 2021 at 17:30)</a>:</h4>
<p>but surely they still have implications</p>



<a name="250965739"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/186049-t-compiler/wg-polonius/topic/purely%20forward%20propagation/near/250965739" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/186049-t-compiler/wg-polonius/topic/purely.20forward.20propagation.html#250965739">(Aug 27 2021 at 17:30)</a>:</h4>
<p><span class="user-mention silent" data-user-id="118594">Dylan MacKenzie (ecstatic-morse)</span> <a href="#narrow/stream/186049-t-compiler.2Fwg-polonius/topic/purely.20forward.20propagation/near/250965581">said</a>:</p>
<blockquote>
<p>I like forget actually</p>
</blockquote>
<p>(me too)</p>



<a name="250965783"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/186049-t-compiler/wg-polonius/topic/purely%20forward%20propagation/near/250965783" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/186049-t-compiler/wg-polonius/topic/purely.20forward.20propagation.html#250965783">(Aug 27 2021 at 17:30)</a>:</h4>
<p><span class="user-mention silent" data-user-id="337115">Domenic Quirl</span> <a href="#narrow/stream/186049-t-compiler.2Fwg-polonius/topic/purely.20forward.20propagation/near/250965735">said</a>:</p>
<blockquote>
<p>but surely they still have implications</p>
</blockquote>
<p>at present, not really</p>



<a name="250965793"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/186049-t-compiler/wg-polonius/topic/purely%20forward%20propagation/near/250965793" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/186049-t-compiler/wg-polonius/topic/purely.20forward.20propagation.html#250965793">(Aug 27 2021 at 17:30)</a>:</h4>
<p>that said</p>



<a name="250965813"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/186049-t-compiler/wg-polonius/topic/purely%20forward%20propagation/near/250965813" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/186049-t-compiler/wg-polonius/topic/purely.20forward.20propagation.html#250965813">(Aug 27 2021 at 17:31)</a>:</h4>
<p>depending on how we wind up handling placeholder errors</p>



<a name="250965832"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/186049-t-compiler/wg-polonius/topic/purely%20forward%20propagation/near/250965832" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/186049-t-compiler/wg-polonius/topic/purely.20forward.20propagation.html#250965832">(Aug 27 2021 at 17:31)</a>:</h4>
<p>I could see "empty set" being misinterpreted as <code>'static</code> at some point</p>



<a name="250965878"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/186049-t-compiler/wg-polonius/topic/purely%20forward%20propagation/near/250965878" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/186049-t-compiler/wg-polonius/topic/purely.20forward.20propagation.html#250965878">(Aug 27 2021 at 17:31)</a>:</h4>
<p>but I would manage that by changing how "forget" works somehow</p>



<a name="250965904"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/186049-t-compiler/wg-polonius/topic/purely%20forward%20propagation/near/250965904" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/186049-t-compiler/wg-polonius/topic/purely.20forward.20propagation.html#250965904">(Aug 27 2021 at 17:31)</a>:</h4>
<p>e.g., introducing a loan for the scope</p>



<a name="250965918"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/186049-t-compiler/wg-polonius/topic/purely%20forward%20propagation/near/250965918" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/186049-t-compiler/wg-polonius/topic/purely.20forward.20propagation.html#250965918">(Aug 27 2021 at 17:31)</a>:</h4>
<p>actually forget would probably stay unchanged</p>



<a name="250965942"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/186049-t-compiler/wg-polonius/topic/purely%20forward%20propagation/near/250965942" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/186049-t-compiler/wg-polonius/topic/purely.20forward.20propagation.html#250965942">(Aug 27 2021 at 17:31)</a>:</h4>
<p>but we would have a loan representing the underlying stack slow or something</p>



<a name="250965952"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/186049-t-compiler/wg-polonius/topic/purely%20forward%20propagation/near/250965952" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/186049-t-compiler/wg-polonius/topic/purely.20forward.20propagation.html#250965952">(Aug 27 2021 at 17:31)</a>:</h4>
<p>that is invalidated when it is popped</p>



<a name="250966059"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/186049-t-compiler/wg-polonius/topic/purely%20forward%20propagation/near/250966059" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Domenic Quirl <a href="https://zulip-archive.rust-lang.org/stream/186049-t-compiler/wg-polonius/topic/purely.20forward.20propagation.html#250966059">(Aug 27 2021 at 17:32)</a>:</h4>
<p>what if I have</p>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="kd">let</span><span class="w"> </span><span class="k">mut</span><span class="w"> </span><span class="n">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">22</span><span class="p">;</span><span class="w"></span>
<span class="kd">let</span><span class="w"> </span><span class="k">mut</span><span class="w"> </span><span class="n">y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">44</span><span class="p">;</span><span class="w"></span>
<span class="kd">let</span><span class="w"> </span><span class="k">mut</span><span class="w"> </span><span class="n">p</span>: <span class="kp">&amp;</span><span class="kt">u32</span> <span class="o">=</span><span class="w"> </span><span class="o">&amp;</span><span class="n">x</span><span class="p">;</span><span class="w"></span>
<span class="kd">let</span><span class="w"> </span><span class="k">mut</span><span class="w"> </span><span class="n">q</span>: <span class="kp">&amp;</span><span class="kt">u32</span> <span class="o">=</span><span class="w"> </span><span class="o">&amp;*</span><span class="n">p</span><span class="p">;</span><span class="w"></span>
<span class="n">p</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">&amp;</span><span class="n">y</span><span class="p">;</span><span class="w"></span>
<span class="n">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">23</span><span class="p">;</span><span class="w"></span>
<span class="fm">dbg!</span><span class="p">(</span><span class="n">q</span><span class="p">);</span><span class="w"></span>
</code></pre></div>



<a name="250966149"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/186049-t-compiler/wg-polonius/topic/purely%20forward%20propagation/near/250966149" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/186049-t-compiler/wg-polonius/topic/purely.20forward.20propagation.html#250966149">(Aug 27 2021 at 17:33)</a>:</h4>
<p>the trick here is that the origin for <code>q</code> contains (initially) two loans</p>



<a name="250966157"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/186049-t-compiler/wg-polonius/topic/purely%20forward%20propagation/near/250966157" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/186049-t-compiler/wg-polonius/topic/purely.20forward.20propagation.html#250966157">(Aug 27 2021 at 17:33)</a>:</h4>
<p>one for <code>*p</code> and one for <code>x</code></p>



<a name="250966171"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/186049-t-compiler/wg-polonius/topic/purely%20forward%20propagation/near/250966171" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/186049-t-compiler/wg-polonius/topic/purely.20forward.20propagation.html#250966171">(Aug 27 2021 at 17:33)</a>:</h4>
<p>so we forget the one for <code>*p</code> but not the other</p>



<a name="250966312"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/186049-t-compiler/wg-polonius/topic/purely%20forward%20propagation/near/250966312" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Domenic Quirl <a href="https://zulip-archive.rust-lang.org/stream/186049-t-compiler/wg-polonius/topic/purely.20forward.20propagation.html#250966312">(Aug 27 2021 at 17:34)</a>:</h4>
<p>well, _that_ cleared up a lot of my confusion <span aria-label="sweat smile" class="emoji emoji-1f605" role="img" title="sweat smile">:sweat_smile:</span></p>



<a name="250966449"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/186049-t-compiler/wg-polonius/topic/purely%20forward%20propagation/near/250966449" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Domenic Quirl <a href="https://zulip-archive.rust-lang.org/stream/186049-t-compiler/wg-polonius/topic/purely.20forward.20propagation.html#250966449">(Aug 27 2021 at 17:35)</a>:</h4>
<p>in that case that loan is just no longer necessary <span aria-label="thinking" class="emoji emoji-1f914" role="img" title="thinking">:thinking:</span></p>



<a name="250966596"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/186049-t-compiler/wg-polonius/topic/purely%20forward%20propagation/near/250966596" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/186049-t-compiler/wg-polonius/topic/purely.20forward.20propagation.html#250966596">(Aug 27 2021 at 17:36)</a>:</h4>
<p>interesting</p>



<a name="250966610"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/186049-t-compiler/wg-polonius/topic/purely%20forward%20propagation/near/250966610" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/186049-t-compiler/wg-polonius/topic/purely.20forward.20propagation.html#250966610">(Aug 27 2021 at 17:36)</a>:</h4>
<p>in some sense the loan refers <em>only to</em></p>



<a name="250966620"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/186049-t-compiler/wg-polonius/topic/purely%20forward%20propagation/near/250966620" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/186049-t-compiler/wg-polonius/topic/purely.20forward.20propagation.html#250966620">(Aug 27 2021 at 17:36)</a>:</h4>
<p>the memory owned by that location</p>



<a name="250966700"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/186049-t-compiler/wg-polonius/topic/purely%20forward%20propagation/near/250966700" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Domenic Quirl <a href="https://zulip-archive.rust-lang.org/stream/186049-t-compiler/wg-polonius/topic/purely.20forward.20propagation.html#250966700">(Aug 27 2021 at 17:37)</a>:</h4>
<p><code>resolve</code></p>



<a name="250966706"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/186049-t-compiler/wg-polonius/topic/purely%20forward%20propagation/near/250966706" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Domenic Quirl <a href="https://zulip-archive.rust-lang.org/stream/186049-t-compiler/wg-polonius/topic/purely.20forward.20propagation.html#250966706">(Aug 27 2021 at 17:37)</a>:</h4>
<p><code>filter_out</code></p>



<a name="250966725"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/186049-t-compiler/wg-polonius/topic/purely%20forward%20propagation/near/250966725" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Domenic Quirl <a href="https://zulip-archive.rust-lang.org/stream/186049-t-compiler/wg-polonius/topic/purely.20forward.20propagation.html#250966725">(Aug 27 2021 at 17:37)</a>:</h4>
<p><code>clear</code></p>



<a name="250966834"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/186049-t-compiler/wg-polonius/topic/purely%20forward%20propagation/near/250966834" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Dylan MacKenzie (ecstatic-morse) <a href="https://zulip-archive.rust-lang.org/stream/186049-t-compiler/wg-polonius/topic/purely.20forward.20propagation.html#250966834">(Aug 27 2021 at 17:38)</a>:</h4>
<p><span class="user-mention" data-user-id="116009">@nikomatsakis</span> How does this formulation handle when a variable gets overwritten?</p>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="kd">let</span><span class="w"> </span><span class="n">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">22</span><span class="p">;</span><span class="w"></span>
<span class="kd">let</span><span class="w"> </span><span class="n">y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">44</span><span class="p">;</span><span class="w"></span>
<span class="kd">let</span><span class="w"> </span><span class="k">mut</span><span class="w"> </span><span class="n">p</span>: <span class="kp">&amp;</span><span class="o">'</span><span class="mi">0</span><span class="w"> </span><span class="kt">i32</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">&amp;'</span><span class="mi">1</span><span class="w"> </span><span class="n">x</span><span class="p">;</span><span class="w"> </span><span class="c1">// Loan L0</span>
<span class="n">p</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">&amp;'</span><span class="mi">3</span><span class="w"> </span><span class="n">y</span><span class="p">;</span><span class="w"> </span><span class="c1">// Loan L1</span>
<span class="n">x</span><span class="w"> </span><span class="o">+=</span><span class="w"> </span><span class="mi">1</span><span class="p">;</span><span class="w">   </span><span class="c1">// invalidates(L0)</span>
<span class="n">print</span><span class="p">(</span><span class="o">*</span><span class="n">p</span><span class="p">);</span><span class="w"></span>
</code></pre></div>
<p>This is the canonical liveness example.</p>



<a name="250967277"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/186049-t-compiler/wg-polonius/topic/purely%20forward%20propagation/near/250967277" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/186049-t-compiler/wg-polonius/topic/purely.20forward.20propagation.html#250967277">(Aug 27 2021 at 17:41)</a>:</h4>
<p>(one sec)</p>



<a name="250967490"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/186049-t-compiler/wg-polonius/topic/purely%20forward%20propagation/near/250967490" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Dylan MacKenzie (ecstatic-morse) <a href="https://zulip-archive.rust-lang.org/stream/186049-t-compiler/wg-polonius/topic/purely.20forward.20propagation.html#250967490">(Aug 27 2021 at 17:43)</a>:</h4>
<p>Also, are you interested in me using the souffle branch to prototype this? The thought of serializing data to and from a Lisp makes me nervous.</p>



<a name="250967523"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/186049-t-compiler/wg-polonius/topic/purely%20forward%20propagation/near/250967523" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/186049-t-compiler/wg-polonius/topic/purely.20forward.20propagation.html#250967523">(Aug 27 2021 at 17:43)</a>:</h4>
<p>lol</p>



<a name="250967550"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/186049-t-compiler/wg-polonius/topic/purely%20forward%20propagation/near/250967550" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/186049-t-compiler/wg-polonius/topic/purely.20forward.20propagation.html#250967550">(Aug 27 2021 at 17:43)</a>:</h4>
<p>I was joking about racket, although they do have a datalog mode that (gasp!) doesn't use s-expressions</p>



<a name="250967554"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/186049-t-compiler/wg-polonius/topic/purely%20forward%20propagation/near/250967554" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/186049-t-compiler/wg-polonius/topic/purely.20forward.20propagation.html#250967554">(Aug 27 2021 at 17:43)</a>:</h4>
<p>soufle is fine</p>



<a name="250967563"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/186049-t-compiler/wg-polonius/topic/purely%20forward%20propagation/near/250967563" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Dylan MacKenzie (ecstatic-morse) <a href="https://zulip-archive.rust-lang.org/stream/186049-t-compiler/wg-polonius/topic/purely.20forward.20propagation.html#250967563">(Aug 27 2021 at 17:43)</a>:</h4>
<p>racket datalog is super cool</p>



<a name="250967694"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/186049-t-compiler/wg-polonius/topic/purely%20forward%20propagation/near/250967694" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Dylan MacKenzie (ecstatic-morse) <a href="https://zulip-archive.rust-lang.org/stream/186049-t-compiler/wg-polonius/topic/purely.20forward.20propagation.html#250967694">(Aug 27 2021 at 17:44)</a>:</h4>
<p>/me whispers <span class="user-mention silent" data-user-id="116113">lqd</span> is gone so we don't have to spell Soufflé right anymore</p>



<a name="250967828"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/186049-t-compiler/wg-polonius/topic/purely%20forward%20propagation/near/250967828" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> bjorn3 <a href="https://zulip-archive.rust-lang.org/stream/186049-t-compiler/wg-polonius/topic/purely.20forward.20propagation.html#250967828">(Aug 27 2021 at 17:45)</a>:</h4>
<p><span class="user-mention silent" data-user-id="116113">lqd</span> is active on zulip though.</p>



<a name="250967971"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/186049-t-compiler/wg-polonius/topic/purely%20forward%20propagation/near/250967971" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Dylan MacKenzie (ecstatic-morse) <a href="https://zulip-archive.rust-lang.org/stream/186049-t-compiler/wg-polonius/topic/purely.20forward.20propagation.html#250967971">(Aug 27 2021 at 17:46)</a>:</h4>
<p><span class="user-mention silent" data-user-id="116009">nikomatsakis</span> <a href="#narrow/stream/186049-t-compiler.2Fwg-polonius/topic/purely.20forward.20propagation/near/250967554">said</a>:</p>
<blockquote>
<p>soufle is fine</p>
</blockquote>
<p>Okay. I'll keep working on that.</p>



<a name="250968030"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/186049-t-compiler/wg-polonius/topic/purely%20forward%20propagation/near/250968030" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Dylan MacKenzie (ecstatic-morse) <a href="https://zulip-archive.rust-lang.org/stream/186049-t-compiler/wg-polonius/topic/purely.20forward.20propagation.html#250968030">(Aug 27 2021 at 17:46)</a>:</h4>
<p><span class="user-mention silent" data-user-id="133247">bjorn3</span> <a href="#narrow/stream/186049-t-compiler.2Fwg-polonius/topic/purely.20forward.20propagation/near/250967828">said</a>:</p>
<blockquote>
<p><span class="user-mention silent" data-user-id="116113">lqd</span> is active on zulip though.</p>
</blockquote>
<p>(They mentioned they were going AFK for the moment)</p>



<a name="250968060"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/186049-t-compiler/wg-polonius/topic/purely%20forward%20propagation/near/250968060" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/186049-t-compiler/wg-polonius/topic/purely.20forward.20propagation.html#250968060">(Aug 27 2021 at 17:46)</a>:</h4>
<p>ok, sorry, back</p>



<a name="250968083"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/186049-t-compiler/wg-polonius/topic/purely%20forward%20propagation/near/250968083" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/186049-t-compiler/wg-polonius/topic/purely.20forward.20propagation.html#250968083">(Aug 27 2021 at 17:47)</a>:</h4>
<p>uh <span class="user-mention" data-user-id="118594">@Dylan MacKenzie (ecstatic-morse)</span> I was working out a different example, but I can switch to that one :)</p>



<a name="250968140"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/186049-t-compiler/wg-polonius/topic/purely%20forward%20propagation/near/250968140" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/186049-t-compiler/wg-polonius/topic/purely.20forward.20propagation.html#250968140">(Aug 27 2021 at 17:47)</a>:</h4>
<p>quickly though:</p>



<a name="250968257"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/186049-t-compiler/wg-polonius/topic/purely%20forward%20propagation/near/250968257" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/186049-t-compiler/wg-polonius/topic/purely.20forward.20propagation.html#250968257">(Aug 27 2021 at 17:48)</a>:</h4>
<p>what I expect to happen here is</p>



<a name="250968308"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/186049-t-compiler/wg-polonius/topic/purely%20forward%20propagation/near/250968308" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/186049-t-compiler/wg-polonius/topic/purely.20forward.20propagation.html#250968308">(Aug 27 2021 at 17:48)</a>:</h4>
<p>with <code>p = &amp;y</code>, we will have a <code>forget_origin('0)</code> fact</p>



<a name="250968336"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/186049-t-compiler/wg-polonius/topic/purely%20forward%20propagation/near/250968336" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/186049-t-compiler/wg-polonius/topic/purely.20forward.20propagation.html#250968336">(Aug 27 2021 at 17:48)</a>:</h4>
<p>ps:</p>



<a name="250968340"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/186049-t-compiler/wg-polonius/topic/purely%20forward%20propagation/near/250968340" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/186049-t-compiler/wg-polonius/topic/purely.20forward.20propagation.html#250968340">(Aug 27 2021 at 17:48)</a>:</h4>
<p><a href="https://hackmd.io/KpK0ICQOQLSPxIcNIlhkJQ#Assumptions-about-ordering">https://hackmd.io/KpK0ICQOQLSPxIcNIlhkJQ#Assumptions-about-ordering</a></p>



<a name="250968432"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/186049-t-compiler/wg-polonius/topic/purely%20forward%20propagation/near/250968432" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/186049-t-compiler/wg-polonius/topic/purely.20forward.20propagation.html#250968432">(Aug 27 2021 at 17:49)</a>:</h4>
<p><span class="user-mention silent" data-user-id="337115">Domenic Quirl</span> <a href="#narrow/stream/186049-t-compiler.2Fwg-polonius/topic/purely.20forward.20propagation/near/250966706">said</a>:</p>
<blockquote>
<p><code>filter_out</code></p>
</blockquote>
<p>I kind of like this btw</p>



<a name="250968444"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/186049-t-compiler/wg-polonius/topic/purely%20forward%20propagation/near/250968444" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/186049-t-compiler/wg-polonius/topic/purely.20forward.20propagation.html#250968444">(Aug 27 2021 at 17:49)</a>:</h4>
<p>though it's two words</p>



<a name="250968453"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/186049-t-compiler/wg-polonius/topic/purely%20forward%20propagation/near/250968453" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/186049-t-compiler/wg-polonius/topic/purely.20forward.20propagation.html#250968453">(Aug 27 2021 at 17:49)</a>:</h4>
<p>but I guess I can live with that</p>



<a name="250968487"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/186049-t-compiler/wg-polonius/topic/purely%20forward%20propagation/near/250968487" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/186049-t-compiler/wg-polonius/topic/purely.20forward.20propagation.html#250968487">(Aug 27 2021 at 17:50)</a>:</h4>
<p>either forget or "filter out" seems best</p>



<a name="250968596"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/186049-t-compiler/wg-polonius/topic/purely%20forward%20propagation/near/250968596" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/186049-t-compiler/wg-polonius/topic/purely.20forward.20propagation.html#250968596">(Aug 27 2021 at 17:50)</a>:</h4>
<p><span class="user-mention silent" data-user-id="116009">nikomatsakis</span> <a href="#narrow/stream/186049-t-compiler.2Fwg-polonius/topic/purely.20forward.20propagation/near/250968308">said</a>:</p>
<blockquote>
<p>with <code>p = &amp;y</code>, we will have a <code>forget_origin('0)</code> fact</p>
</blockquote>
<p>anyway, this means that we will still have "origin_contains_loan" facts for <code>'1</code> but not for <code>'0</code>, there will no relations around that</p>



<a name="250968616"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/186049-t-compiler/wg-polonius/topic/purely%20forward%20propagation/near/250968616" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/186049-t-compiler/wg-polonius/topic/purely.20forward.20propagation.html#250968616">(Aug 27 2021 at 17:50)</a>:</h4>
<p>we'll then introduce <code>'3 &lt;= '0</code></p>



<a name="250968661"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/186049-t-compiler/wg-polonius/topic/purely%20forward%20propagation/near/250968661" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/186049-t-compiler/wg-polonius/topic/purely.20forward.20propagation.html#250968661">(Aug 27 2021 at 17:51)</a>:</h4>
<p>so when you get <code>x += 1</code>, the <code>'1</code> would be "invalidated"</p>



<a name="250968666"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/186049-t-compiler/wg-polonius/topic/purely%20forward%20propagation/near/250968666" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/186049-t-compiler/wg-polonius/topic/purely.20forward.20propagation.html#250968666">(Aug 27 2021 at 17:51)</a>:</h4>
<p>but who cares</p>



<a name="250968679"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/186049-t-compiler/wg-polonius/topic/purely%20forward%20propagation/near/250968679" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/186049-t-compiler/wg-polonius/topic/purely.20forward.20propagation.html#250968679">(Aug 27 2021 at 17:51)</a>:</h4>
<p>we could probably add some "forget" facts for <code>'1</code> too</p>



<a name="250968688"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/186049-t-compiler/wg-polonius/topic/purely%20forward%20propagation/near/250968688" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Dylan MacKenzie (ecstatic-morse) <a href="https://zulip-archive.rust-lang.org/stream/186049-t-compiler/wg-polonius/topic/purely.20forward.20propagation.html#250968688">(Aug 27 2021 at 17:51)</a>:</h4>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="kd">let</span><span class="w"> </span><span class="n">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">22</span><span class="p">;</span><span class="w"></span>
<span class="kd">let</span><span class="w"> </span><span class="n">y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">44</span><span class="p">;</span><span class="w"></span>
<span class="kd">let</span><span class="w"> </span><span class="k">mut</span><span class="w"> </span><span class="n">p</span>: <span class="kp">&amp;</span><span class="o">'</span><span class="mi">0</span><span class="w"> </span><span class="kt">i32</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">&amp;'</span><span class="mi">1</span><span class="w"> </span><span class="n">x</span><span class="p">;</span><span class="w"> </span><span class="c1">// Loan L0</span>

<span class="kd">let</span><span class="w"> </span><span class="n">p_copy</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">p</span><span class="p">;</span><span class="w"></span>

<span class="n">p</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">&amp;'</span><span class="mi">3</span><span class="w"> </span><span class="n">y</span><span class="p">;</span><span class="w"> </span><span class="c1">// Loan L1</span>
<span class="n">x</span><span class="w"> </span><span class="o">+=</span><span class="w"> </span><span class="mi">1</span><span class="p">;</span><span class="w">   </span><span class="c1">// invalidates(L0)</span>
<span class="n">print</span><span class="p">(</span><span class="o">*</span><span class="n">p</span><span class="p">);</span><span class="w"></span>

<span class="n">print</span><span class="p">(</span><span class="o">*</span><span class="n">p_copy</span><span class="p">);</span><span class="w"></span>
</code></pre></div>
<p>And that still works if we take a copy of <code>p</code> in between?</p>



<a name="250968692"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/186049-t-compiler/wg-polonius/topic/purely%20forward%20propagation/near/250968692" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/186049-t-compiler/wg-polonius/topic/purely.20forward.20propagation.html#250968692">(Aug 27 2021 at 17:51)</a>:</h4>
<p>just to clean up the things that propagate</p>



<a name="250968853"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/186049-t-compiler/wg-polonius/topic/purely%20forward%20propagation/near/250968853" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Dylan MacKenzie (ecstatic-morse) <a href="https://zulip-archive.rust-lang.org/stream/186049-t-compiler/wg-polonius/topic/purely.20forward.20propagation.html#250968853">(Aug 27 2021 at 17:52)</a>:</h4>
<p><code>p_copy</code> would contain L0 here, but <code>p = &amp;y</code> forgets L0</p>



<a name="250968856"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/186049-t-compiler/wg-polonius/topic/purely%20forward%20propagation/near/250968856" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/186049-t-compiler/wg-polonius/topic/purely.20forward.20propagation.html#250968856">(Aug 27 2021 at 17:52)</a>:</h4>
<p><span class="user-mention silent" data-user-id="118594">Dylan MacKenzie (ecstatic-morse)</span> <a href="#narrow/stream/186049-t-compiler.2Fwg-polonius/topic/purely.20forward.20propagation/near/250968688">said</a>:</p>
<blockquote>
<p>And that still works if we take a copy of <code>p</code> in between?</p>
</blockquote>
<p>in this case, the type of <code>p_copy</code> will have distinct origins from the type of <code>p</code></p>



<a name="250968871"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/186049-t-compiler/wg-polonius/topic/purely%20forward%20propagation/near/250968871" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/186049-t-compiler/wg-polonius/topic/purely.20forward.20propagation.html#250968871">(Aug 27 2021 at 17:52)</a>:</h4>
<p>those origins are not forgotten</p>



<a name="250968928"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/186049-t-compiler/wg-polonius/topic/purely%20forward%20propagation/near/250968928" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/186049-t-compiler/wg-polonius/topic/purely.20forward.20propagation.html#250968928">(Aug 27 2021 at 17:52)</a>:</h4>
<p>it's only valid to <em>forget</em> an origin if you overwrite <em>all things that reference it</em></p>



<a name="250968956"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/186049-t-compiler/wg-polonius/topic/purely%20forward%20propagation/near/250968956" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/186049-t-compiler/wg-polonius/topic/purely.20forward.20propagation.html#250968956">(Aug 27 2021 at 17:52)</a>:</h4>
<p>so either <code>p_copy</code> has to have different origins (which is what rustc would do) or we ought not to forget it here (which loses precision)</p>



<a name="250969012"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/186049-t-compiler/wg-polonius/topic/purely%20forward%20propagation/near/250969012" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/186049-t-compiler/wg-polonius/topic/purely.20forward.20propagation.html#250969012">(Aug 27 2021 at 17:53)</a>:</h4>
<p>I think I like forget. one word ftw.</p>



<a name="250969287"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/186049-t-compiler/wg-polonius/topic/purely%20forward%20propagation/near/250969287" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Domenic Quirl <a href="https://zulip-archive.rust-lang.org/stream/186049-t-compiler/wg-polonius/topic/purely.20forward.20propagation.html#250969287">(Aug 27 2021 at 17:55)</a>:</h4>
<p><code>forget_origin('0)</code> into <code>'3 &lt;= '0</code> feels confusing to me</p>



<a name="250969452"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/186049-t-compiler/wg-polonius/topic/purely%20forward%20propagation/near/250969452" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/186049-t-compiler/wg-polonius/topic/purely.20forward.20propagation.html#250969452">(Aug 27 2021 at 17:56)</a>:</h4>
<p>what do you mean by "into '3 &lt;= '0"?</p>



<a name="250969511"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/186049-t-compiler/wg-polonius/topic/purely%20forward%20propagation/near/250969511" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Domenic Quirl <a href="https://zulip-archive.rust-lang.org/stream/186049-t-compiler/wg-polonius/topic/purely.20forward.20propagation.html#250969511">(Aug 27 2021 at 17:56)</a>:</h4>
<p><span class="user-mention silent" data-user-id="116009">nikomatsakis</span> <a href="#narrow/stream/186049-t-compiler.2Fwg-polonius/topic/purely.20forward.20propagation/near/250968616">said</a>:</p>
<blockquote>
<p>we'll then introduce <code>'3 &lt;= '0</code></p>
</blockquote>
<p>this was what I was referring to with "into"</p>



<a name="250969583"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/186049-t-compiler/wg-polonius/topic/purely%20forward%20propagation/near/250969583" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Domenic Quirl <a href="https://zulip-archive.rust-lang.org/stream/186049-t-compiler/wg-polonius/topic/purely.20forward.20propagation.html#250969583">(Aug 27 2021 at 17:57)</a>:</h4>
<p>where first you "forget" the origin, but then we continue to use it</p>



<a name="250969595"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/186049-t-compiler/wg-polonius/topic/purely%20forward%20propagation/near/250969595" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/186049-t-compiler/wg-polonius/topic/purely.20forward.20propagation.html#250969595">(Aug 27 2021 at 17:57)</a>:</h4>
<p>I see</p>



<a name="250969599"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/186049-t-compiler/wg-polonius/topic/purely%20forward%20propagation/near/250969599" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/186049-t-compiler/wg-polonius/topic/purely.20forward.20propagation.html#250969599">(Aug 27 2021 at 17:57)</a>:</h4>
<p>like, terminology wise it's confusing?</p>



<a name="250969617"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/186049-t-compiler/wg-polonius/topic/purely%20forward%20propagation/near/250969617" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Domenic Quirl <a href="https://zulip-archive.rust-lang.org/stream/186049-t-compiler/wg-polonius/topic/purely.20forward.20propagation.html#250969617">(Aug 27 2021 at 17:57)</a>:</h4>
<p>yeah</p>



<a name="250969627"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/186049-t-compiler/wg-polonius/topic/purely%20forward%20propagation/near/250969627" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/186049-t-compiler/wg-polonius/topic/purely.20forward.20propagation.html#250969627">(Aug 27 2021 at 17:57)</a>:</h4>
<p>it's really like "forget all previous associations with '0"</p>



<a name="250969642"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/186049-t-compiler/wg-polonius/topic/purely%20forward%20propagation/near/250969642" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/186049-t-compiler/wg-polonius/topic/purely.20forward.20propagation.html#250969642">(Aug 27 2021 at 17:57)</a>:</h4>
<p>maybe <code>freshen</code> ?</p>



<a name="250969653"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/186049-t-compiler/wg-polonius/topic/purely%20forward%20propagation/near/250969653" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Domenic Quirl <a href="https://zulip-archive.rust-lang.org/stream/186049-t-compiler/wg-polonius/topic/purely.20forward.20propagation.html#250969653">(Aug 27 2021 at 17:57)</a>:</h4>
<p>I would expect "forget" to imply that the origin is gone/irrelevant</p>



<a name="250969769"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/186049-t-compiler/wg-polonius/topic/purely%20forward%20propagation/near/250969769" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Domenic Quirl <a href="https://zulip-archive.rust-lang.org/stream/186049-t-compiler/wg-polonius/topic/purely.20forward.20propagation.html#250969769">(Aug 27 2021 at 17:58)</a>:</h4>
<p>(I liked <code>clear</code>, but I've already voted that)</p>



<a name="250969787"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/186049-t-compiler/wg-polonius/topic/purely%20forward%20propagation/near/250969787" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/186049-t-compiler/wg-polonius/topic/purely.20forward.20propagation.html#250969787">(Aug 27 2021 at 17:58)</a>:</h4>
<p>I see your point</p>



<a name="250969797"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/186049-t-compiler/wg-polonius/topic/purely%20forward%20propagation/near/250969797" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/186049-t-compiler/wg-polonius/topic/purely.20forward.20propagation.html#250969797">(Aug 27 2021 at 17:58)</a>:</h4>
<p>clear is good too</p>



<a name="250969906"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/186049-t-compiler/wg-polonius/topic/purely%20forward%20propagation/near/250969906" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Domenic Quirl <a href="https://zulip-archive.rust-lang.org/stream/186049-t-compiler/wg-polonius/topic/purely.20forward.20propagation.html#250969906">(Aug 27 2021 at 17:59)</a>:</h4>
<p>it's familiar from places like <code>vec.clear()</code>, after which the vec still exists, but is empty</p>



<a name="250969964"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/186049-t-compiler/wg-polonius/topic/purely%20forward%20propagation/near/250969964" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/186049-t-compiler/wg-polonius/topic/purely.20forward.20propagation.html#250969964">(Aug 27 2021 at 17:59)</a>:</h4>
<p>ok, let's do "clear"</p>



<a name="250970094"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/186049-t-compiler/wg-polonius/topic/purely%20forward%20propagation/near/250970094" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Domenic Quirl <a href="https://zulip-archive.rust-lang.org/stream/186049-t-compiler/wg-polonius/topic/purely.20forward.20propagation.html#250970094">(Aug 27 2021 at 18:00)</a>:</h4>
<p>whereas you've previously mentioned <code>mem::forget</code> associations with "forget"</p>



<a name="250970146"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/186049-t-compiler/wg-polonius/topic/purely%20forward%20propagation/near/250970146" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Domenic Quirl <a href="https://zulip-archive.rust-lang.org/stream/186049-t-compiler/wg-polonius/topic/purely.20forward.20propagation.html#250970146">(Aug 27 2021 at 18:00)</a>:</h4>
<p><span class="user-mention silent" data-user-id="116009">nikomatsakis</span> <a href="#narrow/stream/186049-t-compiler.2Fwg-polonius/topic/purely.20forward.20propagation/near/250969964">said</a>:</p>
<blockquote>
<p>ok, let's do "clear"</p>
</blockquote>
<p><em>happy noises</em></p>



<a name="250970193"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/186049-t-compiler/wg-polonius/topic/purely%20forward%20propagation/near/250970193" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/186049-t-compiler/wg-polonius/topic/purely.20forward.20propagation.html#250970193">(Aug 27 2021 at 18:01)</a>:</h4>
<p>I have to join a call now</p>



<a name="250970230"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/186049-t-compiler/wg-polonius/topic/purely%20forward%20propagation/near/250970230" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/186049-t-compiler/wg-polonius/topic/purely.20forward.20propagation.html#250970230">(Aug 27 2021 at 18:01)</a>:</h4>
<p>if others want to try and bring the doc into sync, that's fine with me, else I'll poke at it later</p>



<a name="250970242"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/186049-t-compiler/wg-polonius/topic/purely%20forward%20propagation/near/250970242" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/186049-t-compiler/wg-polonius/topic/purely.20forward.20propagation.html#250970242">(Aug 27 2021 at 18:01)</a>:</h4>
<p>but I feel like it's...starting to make sense</p>



<a name="250970321"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/186049-t-compiler/wg-polonius/topic/purely%20forward%20propagation/near/250970321" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/186049-t-compiler/wg-polonius/topic/purely.20forward.20propagation.html#250970321">(Aug 27 2021 at 18:01)</a>:</h4>
<p>I'm not totally happy with the little "temporary origin" we do for a borrow expression</p>



<a name="250970327"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/186049-t-compiler/wg-polonius/topic/purely%20forward%20propagation/near/250970327" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/186049-t-compiler/wg-polonius/topic/purely.20forward.20propagation.html#250970327">(Aug 27 2021 at 18:01)</a>:</h4>
<p>it's just kind of annoying</p>



<a name="250970381"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/186049-t-compiler/wg-polonius/topic/purely%20forward%20propagation/near/250970381" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/186049-t-compiler/wg-polonius/topic/purely.20forward.20propagation.html#250970381">(Aug 27 2021 at 18:02)</a>:</h4>
<p>but it's a minor thing</p>



<a name="250970539"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/186049-t-compiler/wg-polonius/topic/purely%20forward%20propagation/near/250970539" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Dylan MacKenzie (ecstatic-morse) <a href="https://zulip-archive.rust-lang.org/stream/186049-t-compiler/wg-polonius/topic/purely.20forward.20propagation.html#250970539">(Aug 27 2021 at 18:03)</a>:</h4>
<p>Okay, yeah we're at four hours, so I have to go.</p>



<a name="250970580"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/186049-t-compiler/wg-polonius/topic/purely%20forward%20propagation/near/250970580" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Domenic Quirl <a href="https://zulip-archive.rust-lang.org/stream/186049-t-compiler/wg-polonius/topic/purely.20forward.20propagation.html#250970580">(Aug 27 2021 at 18:04)</a>:</h4>
<p>I'll do the remaining <code>kill_</code>s in the doc before I leave</p>



<a name="250970718"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/186049-t-compiler/wg-polonius/topic/purely%20forward%20propagation/near/250970718" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Domenic Quirl <a href="https://zulip-archive.rust-lang.org/stream/186049-t-compiler/wg-polonius/topic/purely.20forward.20propagation.html#250970718">(Aug 27 2021 at 18:05)</a>:</h4>
<p>An interesting question is if any / which of the inputs is "new" or needs to be computed additionally to the main analysis</p>



<a name="250970914"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/186049-t-compiler/wg-polonius/topic/purely%20forward%20propagation/near/250970914" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Dylan MacKenzie (ecstatic-morse) <a href="https://zulip-archive.rust-lang.org/stream/186049-t-compiler/wg-polonius/topic/purely.20forward.20propagation.html#250970914">(Aug 27 2021 at 18:06)</a>:</h4>
<p>I think <code>clear_origin</code> for sure right?</p>



<a name="250970953"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/186049-t-compiler/wg-polonius/topic/purely%20forward%20propagation/near/250970953" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Domenic Quirl <a href="https://zulip-archive.rust-lang.org/stream/186049-t-compiler/wg-polonius/topic/purely.20forward.20propagation.html#250970953">(Aug 27 2021 at 18:06)</a>:</h4>
<p>Sure seems like it to me</p>



<a name="250971003"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/186049-t-compiler/wg-polonius/topic/purely%20forward%20propagation/near/250971003" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Domenic Quirl <a href="https://zulip-archive.rust-lang.org/stream/186049-t-compiler/wg-polonius/topic/purely.20forward.20propagation.html#250971003">(Aug 27 2021 at 18:07)</a>:</h4>
<p>Though I'm guessing it's something that could be computed from other info we do have?</p>



<a name="250971227"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/186049-t-compiler/wg-polonius/topic/purely%20forward%20propagation/near/250971227" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Domenic Quirl <a href="https://zulip-archive.rust-lang.org/stream/186049-t-compiler/wg-polonius/topic/purely.20forward.20propagation.html#250971227">(Aug 27 2021 at 18:09)</a>:</h4>
<p>Or maybe not if it happens on assignments <span aria-label="thinking" class="emoji emoji-1f914" role="img" title="thinking">:thinking:</span></p>



<a name="250971340"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/186049-t-compiler/wg-polonius/topic/purely%20forward%20propagation/near/250971340" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Dylan MacKenzie (ecstatic-morse) <a href="https://zulip-archive.rust-lang.org/stream/186049-t-compiler/wg-polonius/topic/purely.20forward.20propagation.html#250971340">(Aug 27 2021 at 18:10)</a>:</h4>
<p>I don't think so. We don't have the "all" part anywhere. </p>
<p><span class="user-mention" data-user-id="116009">@nikomatsakis</span> when you have a minute we need some clarity on how to generate <code>clear_origin</code>.</p>



<a name="250972737"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/186049-t-compiler/wg-polonius/topic/purely%20forward%20propagation/near/250972737" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Domenic Quirl <a href="https://zulip-archive.rust-lang.org/stream/186049-t-compiler/wg-polonius/topic/purely.20forward.20propagation.html#250972737">(Aug 27 2021 at 18:19)</a>:</h4>
<p><code>access</code> would use  the info that liveness has, I guess?</p>



<a name="250984141"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/186049-t-compiler/wg-polonius/topic/purely%20forward%20propagation/near/250984141" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/186049-t-compiler/wg-polonius/topic/purely.20forward.20propagation.html#250984141">(Aug 27 2021 at 19:37)</a>:</h4>
<p>I'll write up some notes on generating the facts, but I want to work through the examples a bit more first</p>



<a name="250989008"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/186049-t-compiler/wg-polonius/topic/purely%20forward%20propagation/near/250989008" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> lqd <a href="https://zulip-archive.rust-lang.org/stream/186049-t-compiler/wg-polonius/topic/purely.20forward.20propagation.html#250989008">(Aug 27 2021 at 20:13)</a>:</h4>
<p><span class="user-mention" data-user-id="118594">@Dylan MacKenzie (ecstatic-morse)</span> the soufflé joke was <em>chef’s kiss</em></p>



<a name="250989546"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/186049-t-compiler/wg-polonius/topic/purely%20forward%20propagation/near/250989546" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> lqd <a href="https://zulip-archive.rust-lang.org/stream/186049-t-compiler/wg-polonius/topic/purely.20forward.20propagation.html#250989546">(Aug 27 2021 at 20:18)</a>:</h4>
<p>(reading the backscroll and the hackmd, this all sounds super cool, great work y’all. I’ll need to study this in depth to help out)</p>



<a name="251006453"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/186049-t-compiler/wg-polonius/topic/purely%20forward%20propagation/near/251006453" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> lqd <a href="https://zulip-archive.rust-lang.org/stream/186049-t-compiler/wg-polonius/topic/purely.20forward.20propagation.html#251006453">(Aug 27 2021 at 22:52)</a>:</h4>
<p>overall it still looks pretty similar to our current setup, which I guess is expected. </p>
<p>additionally propagating invalidated origins may be a bit heavier than what we do now (though I guess maybe we could only check the accessed origins’ parents for invalidated ones?) but this would also benefit if done on blocks/SCCs. </p>
<p>hopefully removing the dependency on liveness is a big enough win by allowing the rules to be integrated elsewhere (say, in chalk). </p>
<p>I’d need to study this more but maybe it would also allow to more easily remove our uses of loans altogether (and a TC + a propagation or two). (this may be a foolish idea/endeavor)</p>



<a name="251006905"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/186049-t-compiler/wg-polonius/topic/purely%20forward%20propagation/near/251006905" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Dylan MacKenzie (ecstatic-morse) <a href="https://zulip-archive.rust-lang.org/stream/186049-t-compiler/wg-polonius/topic/purely.20forward.20propagation.html#251006905">(Aug 27 2021 at 22:57)</a>:</h4>
<blockquote>
<p>I’d need to study this more but maybe it would also allow to more easily remove our uses of loans altogether (and a TC + a propagation or two). (this may be a foolish idea/endeavor)</p>
</blockquote>
<p>I was thinking this as well, which suggests that it may indeed be foolish <span aria-label="blush" class="emoji emoji-1f60a" role="img" title="blush">:blush:</span></p>



<a name="251007525"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/186049-t-compiler/wg-polonius/topic/purely%20forward%20propagation/near/251007525" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> lqd <a href="https://zulip-archive.rust-lang.org/stream/186049-t-compiler/wg-polonius/topic/purely.20forward.20propagation.html#251007525">(Aug 27 2021 at 23:04)</a>:</h4>
<p>I think I slightly mentioned this in passing in the list of topics from last time, but it’s been on my mind since niko’s old "subset relation considered harmful" thread, and it seems intuitive it could be "origin_contains_loan relation considered harmful" by hand waving the (possibly flawed) idea that everything you can currently do with a loan you can do with that loan’s introducing origin</p>



<a name="251007780"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/186049-t-compiler/wg-polonius/topic/purely%20forward%20propagation/near/251007780" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> lqd <a href="https://zulip-archive.rust-lang.org/stream/186049-t-compiler/wg-polonius/topic/purely.20forward.20propagation.html#251007780">(Aug 27 2021 at 23:07)</a>:</h4>
<blockquote>
<p>I was thinking this as well, which suggests that it may indeed be foolish <span aria-label="blush" class="emoji emoji-1f60a" role="img" title="blush">:blush:</span></p>
</blockquote>
<p>I’ll answer this with this great american saying: "au contraire, mon frère"</p>



<a name="251008552"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/186049-t-compiler/wg-polonius/topic/purely%20forward%20propagation/near/251008552" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/186049-t-compiler/wg-polonius/topic/purely.20forward.20propagation.html#251008552">(Aug 27 2021 at 23:17)</a>:</h4>
<p>I'm not sure if I understand what you all mean by "removing our use of loans altogether"</p>



<a name="251008556"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/186049-t-compiler/wg-polonius/topic/purely%20forward%20propagation/near/251008556" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/186049-t-compiler/wg-polonius/topic/purely.20forward.20propagation.html#251008556">(Aug 27 2021 at 23:17)</a>:</h4>
<p>but removing a TC is always good :)</p>



<a name="251008563"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/186049-t-compiler/wg-polonius/topic/purely%20forward%20propagation/near/251008563" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/186049-t-compiler/wg-polonius/topic/purely.20forward.20propagation.html#251008563">(Aug 27 2021 at 23:17)</a>:</h4>
<p>I'm going to go over the doc now</p>



<a name="251008570"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/186049-t-compiler/wg-polonius/topic/purely%20forward%20propagation/near/251008570" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/186049-t-compiler/wg-polonius/topic/purely.20forward.20propagation.html#251008570">(Aug 27 2021 at 23:17)</a>:</h4>
<p>and try to bring it in a consistent state</p>



<a name="251008692"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/186049-t-compiler/wg-polonius/topic/purely%20forward%20propagation/near/251008692" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Dylan MacKenzie (ecstatic-morse) <a href="https://zulip-archive.rust-lang.org/stream/186049-t-compiler/wg-polonius/topic/purely.20forward.20propagation.html#251008692">(Aug 27 2021 at 23:19)</a>:</h4>
<p>Unifying loans and origins came up while I was looking into the SSA thing. When subset relations for a given origin are frozen, checking for loan invalidation is just reachability in the subset graph. You don't need to have a separate class of lifetimes (loans) whose membership in origins are tracked across the CFG</p>



<a name="251008808"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/186049-t-compiler/wg-polonius/topic/purely%20forward%20propagation/near/251008808" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Dylan MacKenzie (ecstatic-morse) <a href="https://zulip-archive.rust-lang.org/stream/186049-t-compiler/wg-polonius/topic/purely.20forward.20propagation.html#251008808">(Aug 27 2021 at 23:20)</a>:</h4>
<p>Obviously that involves creating many more origins, so it's not obviously more efficient, and there were other problems around killed loans</p>



<a name="251008910"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/186049-t-compiler/wg-polonius/topic/purely%20forward%20propagation/near/251008910" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> lqd <a href="https://zulip-archive.rust-lang.org/stream/186049-t-compiler/wg-polonius/topic/purely.20forward.20propagation.html#251008910">(Aug 27 2021 at 23:21)</a>:</h4>
<p>loans and their containment are in my mind just materialization of a path through the subset graph from the introducing origin to a containing origin at a given point</p>



<a name="251009141"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/186049-t-compiler/wg-polonius/topic/purely%20forward%20propagation/near/251009141" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> lqd <a href="https://zulip-archive.rust-lang.org/stream/186049-t-compiler/wg-polonius/topic/purely.20forward.20propagation.html#251009141">(Aug 27 2021 at 23:24)</a>:</h4>
<p>(in the narrow context of "loan analysis" of course, not the path/place + mode concept in general)</p>



<a name="251010096"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/186049-t-compiler/wg-polonius/topic/purely%20forward%20propagation/near/251010096" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/186049-t-compiler/wg-polonius/topic/purely.20forward.20propagation.html#251010096">(Aug 27 2021 at 23:37)</a>:</h4>
<p>hmmm so</p>



<a name="251010105"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/186049-t-compiler/wg-polonius/topic/purely%20forward%20propagation/near/251010105" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/186049-t-compiler/wg-polonius/topic/purely.20forward.20propagation.html#251010105">(Aug 27 2021 at 23:37)</a>:</h4>
<p>I have no idea what you all just wrote</p>



<a name="251010109"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/186049-t-compiler/wg-polonius/topic/purely%20forward%20propagation/near/251010109" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/186049-t-compiler/wg-polonius/topic/purely.20forward.20propagation.html#251010109">(Aug 27 2021 at 23:37)</a>:</h4>
<p><em>however</em></p>



<a name="251010126"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/186049-t-compiler/wg-polonius/topic/purely%20forward%20propagation/near/251010126" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/186049-t-compiler/wg-polonius/topic/purely.20forward.20propagation.html#251010126">(Aug 27 2021 at 23:37)</a>:</h4>
<p>I think what <span class="user-mention" data-user-id="116113">@lqd</span> wrote is what I was just thinking :)</p>



<a name="251010175"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/186049-t-compiler/wg-polonius/topic/purely%20forward%20propagation/near/251010175" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> lqd <a href="https://zulip-archive.rust-lang.org/stream/186049-t-compiler/wg-polonius/topic/purely.20forward.20propagation.html#251010175">(Aug 27 2021 at 23:38)</a>:</h4>
<p><span aria-label="crystal ball" class="emoji emoji-1f52e" role="img" title="crystal ball">:crystal_ball:</span></p>



<a name="251010180"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/186049-t-compiler/wg-polonius/topic/purely%20forward%20propagation/near/251010180" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/186049-t-compiler/wg-polonius/topic/purely.20forward.20propagation.html#251010180">(Aug 27 2021 at 23:38)</a>:</h4>
<p>which is that, right now, we have <code>&amp;'a &lt;place&gt;</code> and that creates a loan that is associated with <code>'a</code></p>



<a name="251010186"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/186049-t-compiler/wg-polonius/topic/purely%20forward%20propagation/near/251010186" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/186049-t-compiler/wg-polonius/topic/purely.20forward.20propagation.html#251010186">(Aug 27 2021 at 23:38)</a>:</h4>
<p>but maybe we just need the <code>'a</code>?</p>



<a name="251010205"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/186049-t-compiler/wg-polonius/topic/purely%20forward%20propagation/near/251010205" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/186049-t-compiler/wg-polonius/topic/purely.20forward.20propagation.html#251010205">(Aug 27 2021 at 23:38)</a>:</h4>
<p>i.e., it's a kind of "special origin" that we know to be associated with the borrow so to speak?</p>



<a name="251010217"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/186049-t-compiler/wg-polonius/topic/purely%20forward%20propagation/near/251010217" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/186049-t-compiler/wg-polonius/topic/purely.20forward.20propagation.html#251010217">(Aug 27 2021 at 23:38)</a>:</h4>
<p>and we can invalidate said origins, and anything that is a subset of them?</p>



<a name="251010251"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/186049-t-compiler/wg-polonius/topic/purely%20forward%20propagation/near/251010251" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> lqd <a href="https://zulip-archive.rust-lang.org/stream/186049-t-compiler/wg-polonius/topic/purely.20forward.20propagation.html#251010251">(Aug 27 2021 at 23:39)</a>:</h4>
<p>it seems at least possible that it could work :)</p>



<a name="251010342"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/186049-t-compiler/wg-polonius/topic/purely%20forward%20propagation/near/251010342" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> lqd <a href="https://zulip-archive.rust-lang.org/stream/186049-t-compiler/wg-polonius/topic/purely.20forward.20propagation.html#251010342">(Aug 27 2021 at 23:40)</a>:</h4>
<p>that’s what we seem to be all thinking indeed !</p>



<a name="251010371"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/186049-t-compiler/wg-polonius/topic/purely%20forward%20propagation/near/251010371" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/186049-t-compiler/wg-polonius/topic/purely.20forward.20propagation.html#251010371">(Aug 27 2021 at 23:40)</a>:</h4>
<p>....hmmm....</p>



<a name="251010375"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/186049-t-compiler/wg-polonius/topic/purely%20forward%20propagation/near/251010375" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/186049-t-compiler/wg-polonius/topic/purely.20forward.20propagation.html#251010375">(Aug 27 2021 at 23:40)</a>:</h4>
<p>yeah it seems like it should work :)</p>



<a name="251010397"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/186049-t-compiler/wg-polonius/topic/purely%20forward%20propagation/near/251010397" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/186049-t-compiler/wg-polonius/topic/purely.20forward.20propagation.html#251010397">(Aug 27 2021 at 23:41)</a>:</h4>
<p>also omg working these examples through by hand is sort of painful</p>



<a name="251010413"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/186049-t-compiler/wg-polonius/topic/purely%20forward%20propagation/near/251010413" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/186049-t-compiler/wg-polonius/topic/purely.20forward.20propagation.html#251010413">(Aug 27 2021 at 23:41)</a>:</h4>
<p>I am wondering about Dr Racket :)</p>



<a name="251010421"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/186049-t-compiler/wg-polonius/topic/purely%20forward%20propagation/near/251010421" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/186049-t-compiler/wg-polonius/topic/purely.20forward.20propagation.html#251010421">(Aug 27 2021 at 23:41)</a>:</h4>
<p>or perhaps soufflé</p>



<a name="251010496"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/186049-t-compiler/wg-polonius/topic/purely%20forward%20propagation/near/251010496" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Dylan MacKenzie (ecstatic-morse) <a href="https://zulip-archive.rust-lang.org/stream/186049-t-compiler/wg-polonius/topic/purely.20forward.20propagation.html#251010496">(Aug 27 2021 at 23:42)</a>:</h4>
<p>Yes. I think it depends on what exactly you have in mind for <code>clear_origin</code>. Propagating "loans" is necessary when there's a path from an invalidated borrow to a live region, but the components of that path aren't all "live" at a single point in the CFG</p>



<a name="251010537"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/186049-t-compiler/wg-polonius/topic/purely%20forward%20propagation/near/251010537" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/186049-t-compiler/wg-polonius/topic/purely.20forward.20propagation.html#251010537">(Aug 27 2021 at 23:43)</a>:</h4>
<p>well</p>



<a name="251010541"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/186049-t-compiler/wg-polonius/topic/purely%20forward%20propagation/near/251010541" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/186049-t-compiler/wg-polonius/topic/purely.20forward.20propagation.html#251010541">(Aug 27 2021 at 23:43)</a>:</h4>
<p>is it?</p>



<a name="251010550"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/186049-t-compiler/wg-polonius/topic/purely%20forward%20propagation/near/251010550" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Dylan MacKenzie (ecstatic-morse) <a href="https://zulip-archive.rust-lang.org/stream/186049-t-compiler/wg-polonius/topic/purely.20forward.20propagation.html#251010550">(Aug 27 2021 at 23:43)</a>:</h4>
<p>Using our existing definitions of loans and liveness</p>



<a name="251010562"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/186049-t-compiler/wg-polonius/topic/purely%20forward%20propagation/near/251010562" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/186049-t-compiler/wg-polonius/topic/purely.20forward.20propagation.html#251010562">(Aug 27 2021 at 23:43)</a>:</h4>
<p>what I had in mind for <code>clear_origin</code> was simple: when you write to a place, you take the type of that place, and you "clear origin" for every origin appearing in that type</p>



<a name="251010565"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/186049-t-compiler/wg-polonius/topic/purely%20forward%20propagation/near/251010565" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/186049-t-compiler/wg-polonius/topic/purely.20forward.20propagation.html#251010565">(Aug 27 2021 at 23:43)</a>:</h4>
<p>(presuming they only appear there)</p>



<a name="251010609"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/186049-t-compiler/wg-polonius/topic/purely%20forward%20propagation/near/251010609" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/186049-t-compiler/wg-polonius/topic/purely.20forward.20propagation.html#251010609">(Aug 27 2021 at 23:44)</a>:</h4>
<p>I imagine though that the "loan region" associated with the borrow will take the place of the loan just fine</p>



<a name="251010626"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/186049-t-compiler/wg-polonius/topic/purely%20forward%20propagation/near/251010626" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/186049-t-compiler/wg-polonius/topic/purely.20forward.20propagation.html#251010626">(Aug 27 2021 at 23:44)</a>:</h4>
<p>it would never be <del>killed</del> cleared</p>



<a name="251010634"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/186049-t-compiler/wg-polonius/topic/purely%20forward%20propagation/near/251010634" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/186049-t-compiler/wg-polonius/topic/purely.20forward.20propagation.html#251010634">(Aug 27 2021 at 23:44)</a>:</h4>
<p>because it doesn't appear in the type of any place that can be assigned to</p>



<a name="251010793"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/186049-t-compiler/wg-polonius/topic/purely%20forward%20propagation/near/251010793" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Dylan MacKenzie (ecstatic-morse) <a href="https://zulip-archive.rust-lang.org/stream/186049-t-compiler/wg-polonius/topic/purely.20forward.20propagation.html#251010793">(Aug 27 2021 at 23:47)</a>:</h4>
<p>/me tries to think of an interesting example</p>



<a name="251010868"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/186049-t-compiler/wg-polonius/topic/purely%20forward%20propagation/near/251010868" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> lqd <a href="https://zulip-archive.rust-lang.org/stream/186049-t-compiler/wg-polonius/topic/purely.20forward.20propagation.html#251010868">(Aug 27 2021 at 23:48)</a>:</h4>
<p>(yeah, the old borrow_region now "issuing origin" (AKA "introducing origin" in my location-insensitive reachability formulation, and now also this hackmd’s since it mentions loans being introduced in origins))</p>



<a name="251010903"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/186049-t-compiler/wg-polonius/topic/purely%20forward%20propagation/near/251010903" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/186049-t-compiler/wg-polonius/topic/purely.20forward.20propagation.html#251010903">(Aug 27 2021 at 23:48)</a>:</h4>
<p>I guess I better brush off my soufflé</p>



<a name="251010909"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/186049-t-compiler/wg-polonius/topic/purely%20forward%20propagation/near/251010909" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/186049-t-compiler/wg-polonius/topic/purely.20forward.20propagation.html#251010909">(Aug 27 2021 at 23:49)</a>:</h4>
<p>it appears that racket's datalog doesn't have negative clauses?</p>



<a name="251010910"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/186049-t-compiler/wg-polonius/topic/purely%20forward%20propagation/near/251010910" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/186049-t-compiler/wg-polonius/topic/purely.20forward.20propagation.html#251010910">(Aug 27 2021 at 23:49)</a>:</h4>
<p><a href="https://docs.racket-lang.org/datalog/datalog.html">https://docs.racket-lang.org/datalog/datalog.html</a></p>



<a name="251010923"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/186049-t-compiler/wg-polonius/topic/purely%20forward%20propagation/near/251010923" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/186049-t-compiler/wg-polonius/topic/purely.20forward.20propagation.html#251010923">(Aug 27 2021 at 23:49)</a>:</h4>
<div class="codehilite"><pre><span></span><code>N1 :- -(N, 1),
</code></pre></div>



<a name="251010941"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/186049-t-compiler/wg-polonius/topic/purely%20forward%20propagation/near/251010941" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/186049-t-compiler/wg-polonius/topic/purely.20forward.20propagation.html#251010941">(Aug 27 2021 at 23:49)</a>:</h4>
<p>maybe that's what this is?</p>



<a name="251010953"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/186049-t-compiler/wg-polonius/topic/purely%20forward%20propagation/near/251010953" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> lqd <a href="https://zulip-archive.rust-lang.org/stream/186049-t-compiler/wg-polonius/topic/purely.20forward.20propagation.html#251010953">(Aug 27 2021 at 23:49)</a>:</h4>
<p>maybe with the tilde</p>



<a name="251011003"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/186049-t-compiler/wg-polonius/topic/purely%20forward%20propagation/near/251011003" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/186049-t-compiler/wg-polonius/topic/purely.20forward.20propagation.html#251011003">(Aug 27 2021 at 23:50)</a>:</h4>
<p>doesn't seem to like it</p>



<a name="251011009"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/186049-t-compiler/wg-polonius/topic/purely%20forward%20propagation/near/251011009" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/186049-t-compiler/wg-polonius/topic/purely.20forward.20propagation.html#251011009">(Aug 27 2021 at 23:50)</a>:</h4>
<p>I should really install souffle</p>



<a name="251011084"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/186049-t-compiler/wg-polonius/topic/purely%20forward%20propagation/near/251011084" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Dylan MacKenzie (ecstatic-morse) <a href="https://zulip-archive.rust-lang.org/stream/186049-t-compiler/wg-polonius/topic/purely.20forward.20propagation.html#251011084">(Aug 27 2021 at 23:51)</a>:</h4>
<p>Hmm that's unfortunate</p>



<a name="251011088"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/186049-t-compiler/wg-polonius/topic/purely%20forward%20propagation/near/251011088" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> lqd <a href="https://zulip-archive.rust-lang.org/stream/186049-t-compiler/wg-polonius/topic/purely.20forward.20propagation.html#251011088">(Aug 27 2021 at 23:51)</a>:</h4>
<p>we should debug Dylan’s prototype and use that</p>



<a name="251011118"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/186049-t-compiler/wg-polonius/topic/purely%20forward%20propagation/near/251011118" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/186049-t-compiler/wg-polonius/topic/purely.20forward.20propagation.html#251011118">(Aug 27 2021 at 23:51)</a>:</h4>
<p>unfortunately <a href="https://souffle-lang.github.io/install">https://souffle-lang.github.io/install</a> doesn't work for me on debian</p>



<a name="251011183"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/186049-t-compiler/wg-polonius/topic/purely%20forward%20propagation/near/251011183" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/186049-t-compiler/wg-polonius/topic/purely.20forward.20propagation.html#251011183">(Aug 27 2021 at 23:52)</a>:</h4>
<p>maybe I'm running some old debian or something</p>



<a name="251011199"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/186049-t-compiler/wg-polonius/topic/purely%20forward%20propagation/near/251011199" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/186049-t-compiler/wg-polonius/topic/purely.20forward.20propagation.html#251011199">(Aug 27 2021 at 23:52)</a>:</h4>
<p><span class="user-mention silent" data-user-id="116113">lqd</span> <a href="#narrow/stream/186049-t-compiler.2Fwg-polonius/topic/purely.20forward.20propagation/near/251011088">said</a>:</p>
<blockquote>
<p>we should debug Dylan’s prototype and use that</p>
</blockquote>
<p>you mean the prototype souffle integration?</p>



<a name="251011212"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/186049-t-compiler/wg-polonius/topic/purely%20forward%20propagation/near/251011212" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Dylan MacKenzie (ecstatic-morse) <a href="https://zulip-archive.rust-lang.org/stream/186049-t-compiler/wg-polonius/topic/purely.20forward.20propagation.html#251011212">(Aug 27 2021 at 23:52)</a>:</h4>
<p>Well you can prototype with just the <code>souffle</code> binary. Running the test suite will be easier with integration, however.</p>



<a name="251011257"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/186049-t-compiler/wg-polonius/topic/purely%20forward%20propagation/near/251011257" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> lqd <a href="https://zulip-archive.rust-lang.org/stream/186049-t-compiler/wg-polonius/topic/purely.20forward.20propagation.html#251011257">(Aug 27 2021 at 23:53)</a>:</h4>
<p>yeah, but that prototype integration will surely require installing soufflé as well, and if that doesn’t work :/</p>



<a name="251011262"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/186049-t-compiler/wg-polonius/topic/purely%20forward%20propagation/near/251011262" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Dylan MacKenzie (ecstatic-morse) <a href="https://zulip-archive.rust-lang.org/stream/186049-t-compiler/wg-polonius/topic/purely.20forward.20propagation.html#251011262">(Aug 27 2021 at 23:53)</a>:</h4>
<p>I'm on fedora and built from source FWIW</p>



<a name="251011342"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/186049-t-compiler/wg-polonius/topic/purely%20forward%20propagation/near/251011342" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/186049-t-compiler/wg-polonius/topic/purely.20forward.20propagation.html#251011342">(Aug 27 2021 at 23:54)</a>:</h4>
<p>I'm building from source</p>



<a name="251011552"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/186049-t-compiler/wg-polonius/topic/purely%20forward%20propagation/near/251011552" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> lqd <a href="https://zulip-archive.rust-lang.org/stream/186049-t-compiler/wg-polonius/topic/purely.20forward.20propagation.html#251011552">(Aug 27 2021 at 23:57)</a>:</h4>
<p>it’s going to be apparent when you try the hackmd’s rules but a couple of initializations of the static inputs are likely missing, e.g. loan_in_origin(L, O, N1) :- introduce_loan(L, O, N1).</p>



<a name="251011675"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/186049-t-compiler/wg-polonius/topic/purely%20forward%20propagation/near/251011675" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/186049-t-compiler/wg-polonius/topic/purely.20forward.20propagation.html#251011675">(Aug 27 2021 at 23:59)</a>:</h4>
<p>heh, ok, I can't build from source either</p>



<a name="251011691"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/186049-t-compiler/wg-polonius/topic/purely%20forward%20propagation/near/251011691" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/186049-t-compiler/wg-polonius/topic/purely.20forward.20propagation.html#251011691">(Aug 27 2021 at 23:59)</a>:</h4>
<p>I have to upgrade whatever ancient debian I am running I think</p>



<a name="251011698"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/186049-t-compiler/wg-polonius/topic/purely%20forward%20propagation/near/251011698" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/186049-t-compiler/wg-polonius/topic/purely.20forward.20propagation.html#251011698">(Aug 27 2021 at 23:59)</a>:</h4>
<p>I'm going to pack it in for the night and poke at this tomorrow :)</p>



<a name="251011730"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/186049-t-compiler/wg-polonius/topic/purely%20forward%20propagation/near/251011730" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Dylan MacKenzie (ecstatic-morse) <a href="https://zulip-archive.rust-lang.org/stream/186049-t-compiler/wg-polonius/topic/purely.20forward.20propagation.html#251011730">(Aug 27 2021 at 23:59)</a>:</h4>
<p>They have a container as well, if worst comes to worst</p>



<a name="251011835"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/186049-t-compiler/wg-polonius/topic/purely%20forward%20propagation/near/251011835" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> lqd <a href="https://zulip-archive.rust-lang.org/stream/186049-t-compiler/wg-polonius/topic/purely.20forward.20propagation.html#251011835">(Aug 28 2021 at 00:00)</a>:</h4>
<p>they need a web playground</p>



<a name="251012044"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/186049-t-compiler/wg-polonius/topic/purely%20forward%20propagation/near/251012044" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Dylan MacKenzie (ecstatic-morse) <a href="https://zulip-archive.rust-lang.org/stream/186049-t-compiler/wg-polonius/topic/purely.20forward.20propagation.html#251012044">(Aug 28 2021 at 00:03)</a>:</h4>
<p>Here's my belated example, where I think you need something like loans, for posterity</p>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="kd">let</span><span class="w"> </span><span class="k">mut</span><span class="w"> </span><span class="n">foo</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="p">;</span><span class="w"></span>
<span class="kd">let</span><span class="w"> </span><span class="k">mut</span><span class="w"> </span><span class="n">x</span>: <span class="kp">&amp;</span><span class="o">'</span><span class="na">x</span> <span class="kt">u32</span> <span class="o">=</span><span class="w"> </span><span class="o">&amp;</span><span class="n">foo</span><span class="p">;</span><span class="w"></span>
<span class="kd">let</span><span class="w"> </span><span class="n">y</span>: <span class="kp">&amp;</span><span class="o">'</span><span class="na">y</span> <span class="kt">u32</span> <span class="o">=</span><span class="w"> </span><span class="n">x</span><span class="p">;</span><span class="w"> </span><span class="c1">// 'y &lt;: 'x</span>

<span class="n">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">&amp;</span><span class="mi">42</span><span class="p">;</span><span class="w"> </span><span class="c1">// clears 'x</span>
<span class="n">foo</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">142</span><span class="p">;</span><span class="w"> </span><span class="c1">// invalidates foo, which is still present in `y`</span>

<span class="fm">println!</span><span class="p">(</span><span class="s">"{}"</span><span class="p">,</span><span class="w"> </span><span class="n">y</span><span class="p">);</span><span class="w"></span>
</code></pre></div>



<a name="251012126"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/186049-t-compiler/wg-polonius/topic/purely%20forward%20propagation/near/251012126" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> lqd <a href="https://zulip-archive.rust-lang.org/stream/186049-t-compiler/wg-polonius/topic/purely.20forward.20propagation.html#251012126">(Aug 28 2021 at 00:04)</a>:</h4>
<p>I’ll go sleep as well, thanks for the great conversations today y’all, it’s been a pleasure as always!</p>



<a name="251012271"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/186049-t-compiler/wg-polonius/topic/purely%20forward%20propagation/near/251012271" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Dylan MacKenzie (ecstatic-morse) <a href="https://zulip-archive.rust-lang.org/stream/186049-t-compiler/wg-polonius/topic/purely.20forward.20propagation.html#251012271">(Aug 28 2021 at 00:06)</a>:</h4>
<p><code>x</code> is cleared and/or becomes dead, so there's no chain from the borrow of <code>foo</code> to <code>y</code> where all the components are "live" or "not cleared" at a single point in the CFG.</p>
<p>So I'm interested to see how the new formulation handles that, but also not interested in making Niko compute it by hand.</p>
<p><strong>edit</strong> Actually maybe you need an extra intermediary between <code>x</code> and <code>y</code> for the above to be true.</p>



<a name="251066053"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/186049-t-compiler/wg-polonius/topic/purely%20forward%20propagation/near/251066053" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/186049-t-compiler/wg-polonius/topic/purely.20forward.20propagation.html#251066053">(Aug 28 2021 at 16:19)</a>:</h4>
<p>I did manage to install souffle :)</p>



<a name="251070013"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/186049-t-compiler/wg-polonius/topic/purely%20forward%20propagation/near/251070013" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> lqd <a href="https://zulip-archive.rust-lang.org/stream/186049-t-compiler/wg-polonius/topic/purely.20forward.20propagation.html#251070013">(Aug 28 2021 at 17:27)</a>:</h4>
<p>I take it the exploration is going to take place here <a href="https://github.com/nikomatsakis/polonius.next">https://github.com/nikomatsakis/polonius.next</a></p>



<a name="251070690"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/186049-t-compiler/wg-polonius/topic/purely%20forward%20propagation/near/251070690" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> lqd <a href="https://zulip-archive.rust-lang.org/stream/186049-t-compiler/wg-polonius/topic/purely.20forward.20propagation.html#251070690">(Aug 28 2021 at 17:38)</a>:</h4>
<p>let us know how we can help !</p>



<a name="251070691"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/186049-t-compiler/wg-polonius/topic/purely%20forward%20propagation/near/251070691" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/186049-t-compiler/wg-polonius/topic/purely.20forward.20propagation.html#251070691">(Aug 28 2021 at 17:38)</a>:</h4>
<p><a href="https://github.com/nikomatsakis/polonius.next">https://github.com/nikomatsakis/polonius.next</a></p>



<a name="251070694"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/186049-t-compiler/wg-polonius/topic/purely%20forward%20propagation/near/251070694" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/186049-t-compiler/wg-polonius/topic/purely.20forward.20propagation.html#251070694">(Aug 28 2021 at 17:38)</a>:</h4>
<p>well, I just transcribed the rules</p>



<a name="251070699"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/186049-t-compiler/wg-polonius/topic/purely%20forward%20propagation/near/251070699" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/186049-t-compiler/wg-polonius/topic/purely.20forward.20propagation.html#251070699">(Aug 28 2021 at 17:39)</a>:</h4>
<p>have to take a break now, I was going to try and create a test input and see if ... it actually works</p>



<a name="251070707"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/186049-t-compiler/wg-polonius/topic/purely%20forward%20propagation/near/251070707" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/186049-t-compiler/wg-polonius/topic/purely.20forward.20propagation.html#251070707">(Aug 28 2021 at 17:39)</a>:</h4>
<p>I'm now feeling like 99.9% sure we could just get rid of loans and have "special" origins instead</p>



<a name="251070711"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/186049-t-compiler/wg-polonius/topic/purely%20forward%20propagation/near/251070711" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/186049-t-compiler/wg-polonius/topic/purely.20forward.20propagation.html#251070711">(Aug 28 2021 at 17:39)</a>:</h4>
<p>but I figured I'd transcribe it as described first</p>



<a name="251070719"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/186049-t-compiler/wg-polonius/topic/purely%20forward%20propagation/near/251070719" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/186049-t-compiler/wg-polonius/topic/purely.20forward.20propagation.html#251070719">(Aug 28 2021 at 17:39)</a>:</h4>
<p>maybe I forgot a rule in there? not sure :)</p>



<a name="251070724"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/186049-t-compiler/wg-polonius/topic/purely%20forward%20propagation/near/251070724" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/186049-t-compiler/wg-polonius/topic/purely.20forward.20propagation.html#251070724">(Aug 28 2021 at 17:39)</a>:</h4>
<p>feel free to clone and play around with it</p>



<a name="251070797"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/186049-t-compiler/wg-polonius/topic/purely%20forward%20propagation/near/251070797" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> lqd <a href="https://zulip-archive.rust-lang.org/stream/186049-t-compiler/wg-polonius/topic/purely.20forward.20propagation.html#251070797">(Aug 28 2021 at 17:40)</a>:</h4>
<p>(I fixed one in the hackmd after you transcribed them; I'll open a PR)</p>



<a name="251070962"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/186049-t-compiler/wg-polonius/topic/purely%20forward%20propagation/near/251070962" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> lqd <a href="https://zulip-archive.rust-lang.org/stream/186049-t-compiler/wg-polonius/topic/purely.20forward.20propagation.html#251070962">(Aug 28 2021 at 17:43)</a>:</h4>
<p>when you say "special" origin, do you mean it would be different from the one where the loan is introduced ? (I was expecting the introducing origin to be it)</p>



<a name="251071185"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/186049-t-compiler/wg-polonius/topic/purely%20forward%20propagation/near/251071185" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/186049-t-compiler/wg-polonius/topic/purely.20forward.20propagation.html#251071185">(Aug 28 2021 at 17:47)</a>:</h4>
<p>that's the one I had in mind</p>



<a name="251071188"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/186049-t-compiler/wg-polonius/topic/purely%20forward%20propagation/near/251071188" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/186049-t-compiler/wg-polonius/topic/purely.20forward.20propagation.html#251071188">(Aug 28 2021 at 17:47)</a>:</h4>
<p>I just mean that this origin plays a special roel</p>



<a name="251071385"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/186049-t-compiler/wg-polonius/topic/purely%20forward%20propagation/near/251071385" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> lqd <a href="https://zulip-archive.rust-lang.org/stream/186049-t-compiler/wg-polonius/topic/purely.20forward.20propagation.html#251071385">(Aug 28 2021 at 17:50)</a>:</h4>
<p>cool, I just wanted to make sure we had the same idea</p>



<a name="251071424"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/186049-t-compiler/wg-polonius/topic/purely%20forward%20propagation/near/251071424" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> lqd <a href="https://zulip-archive.rust-lang.org/stream/186049-t-compiler/wg-polonius/topic/purely.20forward.20propagation.html#251071424">(Aug 28 2021 at 17:50)</a>:</h4>
<p>tonight I'll try to create a test input from one of the hackmd examples</p>



<a name="251071537"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/186049-t-compiler/wg-polonius/topic/purely%20forward%20propagation/near/251071537" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/186049-t-compiler/wg-polonius/topic/purely.20forward.20propagation.html#251071537">(Aug 28 2021 at 17:52)</a>:</h4>
<p>I have a few more minutes</p>



<a name="251071541"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/186049-t-compiler/wg-polonius/topic/purely%20forward%20propagation/near/251071541" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> lqd <a href="https://zulip-archive.rust-lang.org/stream/186049-t-compiler/wg-polonius/topic/purely.20forward.20propagation.html#251071541">(Aug 28 2021 at 17:52)</a>:</h4>
<p>(and just so you don't look for it <a href="https://github.com/nikomatsakis/polonius.next/blob/3ee1427d24176109188ee3db2b8683f5362617c2/src/polonius.dl#L69-L71">https://github.com/nikomatsakis/polonius.next/blob/3ee1427d24176109188ee3db2b8683f5362617c2/src/polonius.dl#L69-L71</a> -&gt; the subset should be <code>subset(O1, O2, N),</code></p>



<a name="251071547"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/186049-t-compiler/wg-polonius/topic/purely%20forward%20propagation/near/251071547" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/186049-t-compiler/wg-polonius/topic/purely.20forward.20propagation.html#251071547">(Aug 28 2021 at 17:52)</a>:</h4>
<p>I can't find like... any docs in souffle</p>



<a name="251071553"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/186049-t-compiler/wg-polonius/topic/purely%20forward%20propagation/near/251071553" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/186049-t-compiler/wg-polonius/topic/purely.20forward.20propagation.html#251071553">(Aug 28 2021 at 17:52)</a>:</h4>
<p>about what format it expects :)</p>



<a name="251071561"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/186049-t-compiler/wg-polonius/topic/purely%20forward%20propagation/near/251071561" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/186049-t-compiler/wg-polonius/topic/purely.20forward.20propagation.html#251071561">(Aug 28 2021 at 17:52)</a>:</h4>
<p>I guess it's a file per input relation?</p>



<a name="251071564"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/186049-t-compiler/wg-polonius/topic/purely%20forward%20propagation/near/251071564" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> lqd <a href="https://zulip-archive.rust-lang.org/stream/186049-t-compiler/wg-polonius/topic/purely.20forward.20propagation.html#251071564">(Aug 28 2021 at 17:53)</a>:</h4>
<p>yeah</p>



<a name="251071574"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/186049-t-compiler/wg-polonius/topic/purely%20forward%20propagation/near/251071574" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> lqd <a href="https://zulip-archive.rust-lang.org/stream/186049-t-compiler/wg-polonius/topic/purely.20forward.20propagation.html#251071574">(Aug 28 2021 at 17:53)</a>:</h4>
<p>much like our existing inputs IIRC</p>



<a name="251071591"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/186049-t-compiler/wg-polonius/topic/purely%20forward%20propagation/near/251071591" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> lqd <a href="https://zulip-archive.rust-lang.org/stream/186049-t-compiler/wg-polonius/topic/purely.20forward.20propagation.html#251071591">(Aug 28 2021 at 17:53)</a>:</h4>
<p>they worked directly if memory serves</p>



<a name="251071596"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/186049-t-compiler/wg-polonius/topic/purely%20forward%20propagation/near/251071596" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/186049-t-compiler/wg-polonius/topic/purely.20forward.20propagation.html#251071596">(Aug 28 2021 at 17:53)</a>:</h4>
<p><span class="user-mention silent" data-user-id="116113">lqd</span> <a href="#narrow/stream/186049-t-compiler.2Fwg-polonius/topic/purely.20forward.20propagation/near/251071541">said</a>:</p>
<blockquote>
<p>(and just so you don't look for it <a href="https://github.com/nikomatsakis/polonius.next/blob/3ee1427d24176109188ee3db2b8683f5362617c2/src/polonius.dl#L69-L71">https://github.com/nikomatsakis/polonius.next/blob/3ee1427d24176109188ee3db2b8683f5362617c2/src/polonius.dl#L69-L71</a> -&gt; the subset should be <code>subset(O1, O2, N),</code></p>
</blockquote>
<p>weird, i'm surprised that type-checked with soufflé</p>



<a name="251071604"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/186049-t-compiler/wg-polonius/topic/purely%20forward%20propagation/near/251071604" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/186049-t-compiler/wg-polonius/topic/purely.20forward.20propagation.html#251071604">(Aug 28 2021 at 17:53)</a>:</h4>
<p><span class="user-mention silent" data-user-id="116113">lqd</span> <a href="#narrow/stream/186049-t-compiler.2Fwg-polonius/topic/purely.20forward.20propagation/near/251071574">said</a>:</p>
<blockquote>
<p>much like our existing inputs IIRC</p>
</blockquote>
<p>not, I think, a coincidence</p>



<a name="251071616"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/186049-t-compiler/wg-polonius/topic/purely%20forward%20propagation/near/251071616" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> lqd <a href="https://zulip-archive.rust-lang.org/stream/186049-t-compiler/wg-polonius/topic/purely.20forward.20propagation.html#251071616">(Aug 28 2021 at 17:53)</a>:</h4>
<p>:D</p>



<a name="251071715"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/186049-t-compiler/wg-polonius/topic/purely%20forward%20propagation/near/251071715" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> lqd <a href="https://zulip-archive.rust-lang.org/stream/186049-t-compiler/wg-polonius/topic/purely.20forward.20propagation.html#251071715">(Aug 28 2021 at 17:55)</a>:</h4>
<p>we're probably missing a couple things here and there like <code>loan_in_origin(L, O, N) :- introduce_loan(L, O, N).</code></p>



<a name="251071736"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/186049-t-compiler/wg-polonius/topic/purely%20forward%20propagation/near/251071736" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> lqd <a href="https://zulip-archive.rust-lang.org/stream/186049-t-compiler/wg-polonius/topic/purely.20forward.20propagation.html#251071736">(Aug 28 2021 at 17:55)</a>:</h4>
<p>no big deal</p>



<a name="251071824"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/186049-t-compiler/wg-polonius/topic/purely%20forward%20propagation/near/251071824" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> lqd <a href="https://zulip-archive.rust-lang.org/stream/186049-t-compiler/wg-polonius/topic/purely.20forward.20propagation.html#251071824">(Aug 28 2021 at 17:57)</a>:</h4>
<p>(btw I've been assured soufflé doesn't have requirements about case, so we could technically have our lower case names as before, and be closer to our rust/datafrog formulation; which I thought could be cute)</p>



<a name="251071828"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/186049-t-compiler/wg-polonius/topic/purely%20forward%20propagation/near/251071828" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/186049-t-compiler/wg-polonius/topic/purely.20forward.20propagation.html#251071828">(Aug 28 2021 at 17:57)</a>:</h4>
<p>hmm</p>



<a name="251071874"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/186049-t-compiler/wg-polonius/topic/purely%20forward%20propagation/near/251071874" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/186049-t-compiler/wg-polonius/topic/purely.20forward.20propagation.html#251071874">(Aug 28 2021 at 17:58)</a>:</h4>
<p>my first attempt to run it isn't working :)</p>



<a name="251071908"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/186049-t-compiler/wg-polonius/topic/purely%20forward%20propagation/near/251071908" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/186049-t-compiler/wg-polonius/topic/purely.20forward.20propagation.html#251071908">(Aug 28 2021 at 17:59)</a>:</h4>
<p>there must be some example somewhere</p>



<a name="251071910"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/186049-t-compiler/wg-polonius/topic/purely%20forward%20propagation/near/251071910" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> lqd <a href="https://zulip-archive.rust-lang.org/stream/186049-t-compiler/wg-polonius/topic/purely.20forward.20propagation.html#251071910">(Aug 28 2021 at 17:59)</a>:</h4>
<p>are there soufflé errors or just no output ?</p>



<a name="251071946"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/186049-t-compiler/wg-polonius/topic/purely%20forward%20propagation/near/251071946" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/186049-t-compiler/wg-polonius/topic/purely.20forward.20propagation.html#251071946">(Aug 28 2021 at 18:00)</a>:</h4>
<p>oh, I see, it doesn't want strings</p>



<a name="251071988"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/186049-t-compiler/wg-polonius/topic/purely%20forward%20propagation/near/251071988" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> lqd <a href="https://zulip-archive.rust-lang.org/stream/186049-t-compiler/wg-polonius/topic/purely.20forward.20propagation.html#251071988">(Aug 28 2021 at 18:00)</a>:</h4>
<p>oh really</p>



<a name="251072023"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/186049-t-compiler/wg-polonius/topic/purely%20forward%20propagation/near/251072023" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> lqd <a href="https://zulip-archive.rust-lang.org/stream/186049-t-compiler/wg-polonius/topic/purely.20forward.20propagation.html#251072023">(Aug 28 2021 at 18:00)</a>:</h4>
<p><a href="https://souffle-lang.github.io/simple">https://souffle-lang.github.io/simple</a> has indeed only integers in its csv</p>



<a name="251072043"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/186049-t-compiler/wg-polonius/topic/purely%20forward%20propagation/near/251072043" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> lqd <a href="https://zulip-archive.rust-lang.org/stream/186049-t-compiler/wg-polonius/topic/purely.20forward.20propagation.html#251072043">(Aug 28 2021 at 18:01)</a>:</h4>
<p>but maybe it's just because of the relation types</p>



<a name="251072052"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/186049-t-compiler/wg-polonius/topic/purely%20forward%20propagation/near/251072052" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/186049-t-compiler/wg-polonius/topic/purely.20forward.20propagation.html#251072052">(Aug 28 2021 at 18:01)</a>:</h4>
<p>hmm</p>



<a name="251072055"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/186049-t-compiler/wg-polonius/topic/purely%20forward%20propagation/near/251072055" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/186049-t-compiler/wg-polonius/topic/purely.20forward.20propagation.html#251072055">(Aug 28 2021 at 18:01)</a>:</h4>
<p>I pushed what I had but it doesn't work</p>



<a name="251072064"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/186049-t-compiler/wg-polonius/topic/purely%20forward%20propagation/near/251072064" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/186049-t-compiler/wg-polonius/topic/purely.20forward.20propagation.html#251072064">(Aug 28 2021 at 18:01)</a>:</h4>
<div class="codehilite"><pre><span></span><code>athena. souffle src/polonius.dl -F test/example-a/
Error loading data: Values missing in line 1; cannot parse fact file access.facts!

Error loading data: Values missing in line 1; cannot parse fact file invalidate_loan.facts!

Error loading data: Values missing in line 1; cannot parse fact file introduce_loan.facts!

Error loading data: Values missing in line 1; cannot parse fact file introduce_subset.facts!

Error loading data: Values missing in line 1; cannot parse fact file cfg_edge.facts!
</code></pre></div>



<a name="251072073"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/186049-t-compiler/wg-polonius/topic/purely%20forward%20propagation/near/251072073" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> lqd <a href="https://zulip-archive.rust-lang.org/stream/186049-t-compiler/wg-polonius/topic/purely.20forward.20propagation.html#251072073">(Aug 28 2021 at 18:02)</a>:</h4>
<p>I'll also look at it</p>



<a name="251072114"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/186049-t-compiler/wg-polonius/topic/purely%20forward%20propagation/near/251072114" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/186049-t-compiler/wg-polonius/topic/purely.20forward.20propagation.html#251072114">(Aug 28 2021 at 18:02)</a>:</h4>
<p><a href="https://github.com/souffle-lang/souffle/tree/master/tests/example/access-policy/facts">https://github.com/souffle-lang/souffle/tree/master/tests/example/access-policy/facts</a></p>



<a name="251072117"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/186049-t-compiler/wg-polonius/topic/purely%20forward%20propagation/near/251072117" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/186049-t-compiler/wg-polonius/topic/purely.20forward.20propagation.html#251072117">(Aug 28 2021 at 18:02)</a>:</h4>
<p><a href="https://github.com/souffle-lang/souffle/blob/master/tests/example/access-policy/facts/employee.facts">https://github.com/souffle-lang/souffle/blob/master/tests/example/access-policy/facts/employee.facts</a></p>



<a name="251072119"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/186049-t-compiler/wg-polonius/topic/purely%20forward%20propagation/near/251072119" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/186049-t-compiler/wg-polonius/topic/purely.20forward.20propagation.html#251072119">(Aug 28 2021 at 18:02)</a>:</h4>
<p>it's weird</p>



<a name="251072123"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/186049-t-compiler/wg-polonius/topic/purely%20forward%20propagation/near/251072123" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/186049-t-compiler/wg-polonius/topic/purely.20forward.20propagation.html#251072123">(Aug 28 2021 at 18:02)</a>:</h4>
<p>maybe those aren't real tabs</p>



<a name="251072124"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/186049-t-compiler/wg-polonius/topic/purely%20forward%20propagation/near/251072124" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> lqd <a href="https://zulip-archive.rust-lang.org/stream/186049-t-compiler/wg-polonius/topic/purely.20forward.20propagation.html#251072124">(Aug 28 2021 at 18:02)</a>:</h4>
<p>maybe it's the atom types, "Symbol"</p>



<a name="251072127"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/186049-t-compiler/wg-polonius/topic/purely%20forward%20propagation/near/251072127" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/186049-t-compiler/wg-polonius/topic/purely.20forward.20propagation.html#251072127">(Aug 28 2021 at 18:02)</a>:</h4>
<p>(that vscode is inserting)</p>



<a name="251072132"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/186049-t-compiler/wg-polonius/topic/purely%20forward%20propagation/near/251072132" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/186049-t-compiler/wg-polonius/topic/purely.20forward.20propagation.html#251072132">(Aug 28 2021 at 18:02)</a>:</h4>
<p><span class="user-mention silent" data-user-id="116113">lqd</span> <a href="#narrow/stream/186049-t-compiler.2Fwg-polonius/topic/purely.20forward.20propagation/near/251072124">said</a>:</p>
<blockquote>
<p>maybe it's the atom types, "Symbol"</p>
</blockquote>
<p>I don't think so</p>



<a name="251072134"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/186049-t-compiler/wg-polonius/topic/purely%20forward%20propagation/near/251072134" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/186049-t-compiler/wg-polonius/topic/purely.20forward.20propagation.html#251072134">(Aug 28 2021 at 18:02)</a>:</h4>
<p>there are like 4 choices</p>



<a name="251072137"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/186049-t-compiler/wg-polonius/topic/purely%20forward%20propagation/near/251072137" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/186049-t-compiler/wg-polonius/topic/purely.20forward.20propagation.html#251072137">(Aug 28 2021 at 18:02)</a>:</h4>
<p>symbol and various numbers</p>



<a name="251072138"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/186049-t-compiler/wg-polonius/topic/purely%20forward%20propagation/near/251072138" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> lqd <a href="https://zulip-archive.rust-lang.org/stream/186049-t-compiler/wg-polonius/topic/purely.20forward.20propagation.html#251072138">(Aug 28 2021 at 18:02)</a>:</h4>
<p>interesting</p>



<a name="251072146"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/186049-t-compiler/wg-polonius/topic/purely%20forward%20propagation/near/251072146" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/186049-t-compiler/wg-polonius/topic/purely.20forward.20propagation.html#251072146">(Aug 28 2021 at 18:02)</a>:</h4>
<p><a href="https://github.com/souffle-lang/souffle/blob/master/tests/example/access-policy/access-policy.dl#L3">https://github.com/souffle-lang/souffle/blob/master/tests/example/access-policy/access-policy.dl#L3</a></p>



<a name="251072150"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/186049-t-compiler/wg-polonius/topic/purely%20forward%20propagation/near/251072150" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> lqd <a href="https://zulip-archive.rust-lang.org/stream/186049-t-compiler/wg-polonius/topic/purely.20forward.20propagation.html#251072150">(Aug 28 2021 at 18:02)</a>:</h4>
<p>we used to just declare them as .type X IIRC <a href="https://gist.github.com/lqd/88f6eb5dd75e3850d2abc1242dbcea4a">https://gist.github.com/lqd/88f6eb5dd75e3850d2abc1242dbcea4a</a></p>



<a name="251072151"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/186049-t-compiler/wg-polonius/topic/purely%20forward%20propagation/near/251072151" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/186049-t-compiler/wg-polonius/topic/purely.20forward.20propagation.html#251072151">(Aug 28 2021 at 18:02)</a>:</h4>
<p>(see above)</p>



<a name="251072161"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/186049-t-compiler/wg-polonius/topic/purely%20forward%20propagation/near/251072161" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> lqd <a href="https://zulip-archive.rust-lang.org/stream/186049-t-compiler/wg-polonius/topic/purely.20forward.20propagation.html#251072161">(Aug 28 2021 at 18:03)</a>:</h4>
<p>true</p>



<a name="251072169"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/186049-t-compiler/wg-polonius/topic/purely%20forward%20propagation/near/251072169" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/186049-t-compiler/wg-polonius/topic/purely.20forward.20propagation.html#251072169">(Aug 28 2021 at 18:03)</a>:</h4>
<p>yeah</p>



<a name="251072172"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/186049-t-compiler/wg-polonius/topic/purely%20forward%20propagation/near/251072172" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/186049-t-compiler/wg-polonius/topic/purely.20forward.20propagation.html#251072172">(Aug 28 2021 at 18:03)</a>:</h4>
<p>I have to use vi so I can insert real tabs</p>



<a name="251072181"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/186049-t-compiler/wg-polonius/topic/purely%20forward%20propagation/near/251072181" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> lqd <a href="https://zulip-archive.rust-lang.org/stream/186049-t-compiler/wg-polonius/topic/purely.20forward.20propagation.html#251072181">(Aug 28 2021 at 18:03)</a>:</h4>
<p>haha</p>



<a name="251072365"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/186049-t-compiler/wg-polonius/topic/purely%20forward%20propagation/near/251072365" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> lqd <a href="https://zulip-archive.rust-lang.org/stream/186049-t-compiler/wg-polonius/topic/purely.20forward.20propagation.html#251072365">(Aug 28 2021 at 18:06)</a>:</h4>
<p>there's a space vs tab selector at the bottom of vscode, and some commands, so that you can use real tabs</p>



<a name="251072386"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/186049-t-compiler/wg-polonius/topic/purely%20forward%20propagation/near/251072386" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/186049-t-compiler/wg-polonius/topic/purely.20forward.20propagation.html#251072386">(Aug 28 2021 at 18:07)</a>:</h4>
<p>ok, I pushed something that works</p>



<a name="251072393"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/186049-t-compiler/wg-polonius/topic/purely%20forward%20propagation/near/251072393" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/186049-t-compiler/wg-polonius/topic/purely.20forward.20propagation.html#251072393">(Aug 28 2021 at 18:07)</a>:</h4>
<p>at least for "example A" :)</p>



<a name="251072404"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/186049-t-compiler/wg-polonius/topic/purely%20forward%20propagation/near/251072404" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/186049-t-compiler/wg-polonius/topic/purely.20forward.20propagation.html#251072404">(Aug 28 2021 at 18:07)</a>:</h4>
<p>lol now we need the tool to convert that stuff into graphviz</p>



<a name="251072461"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/186049-t-compiler/wg-polonius/topic/purely%20forward%20propagation/near/251072461" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/186049-t-compiler/wg-polonius/topic/purely.20forward.20propagation.html#251072461">(Aug 28 2021 at 18:08)</a>:</h4>
<p>I guess that <em>writing</em> the facts isn't so bad -- at least this can compute the transitive closures etc</p>



<a name="251072510"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/186049-t-compiler/wg-polonius/topic/purely%20forward%20propagation/near/251072510" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> lqd <a href="https://zulip-archive.rust-lang.org/stream/186049-t-compiler/wg-polonius/topic/purely.20forward.20propagation.html#251072510">(Aug 28 2021 at 18:09)</a>:</h4>
<p>we can probably update the polonius graphviz to reference these new relations</p>



<a name="251072600"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/186049-t-compiler/wg-polonius/topic/purely%20forward%20propagation/near/251072600" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> lqd <a href="https://zulip-archive.rust-lang.org/stream/186049-t-compiler/wg-polonius/topic/purely.20forward.20propagation.html#251072600">(Aug 28 2021 at 18:10)</a>:</h4>
<p>(if our existing outputs are good enough) otherwise I'll whip something up looking like the hackmd graphs</p>



<a name="251072602"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/186049-t-compiler/wg-polonius/topic/purely%20forward%20propagation/near/251072602" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/186049-t-compiler/wg-polonius/topic/purely.20forward.20propagation.html#251072602">(Aug 28 2021 at 18:10)</a>:</h4>
<p>it wouldn't be hard to write a quick python script or something</p>



<a name="251072606"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/186049-t-compiler/wg-polonius/topic/purely%20forward%20propagation/near/251072606" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/186049-t-compiler/wg-polonius/topic/purely.20forward.20propagation.html#251072606">(Aug 28 2021 at 18:10)</a>:</h4>
<p>that generates the graphviz from the fact / csv files</p>



<a name="251072611"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/186049-t-compiler/wg-polonius/topic/purely%20forward%20propagation/near/251072611" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> lqd <a href="https://zulip-archive.rust-lang.org/stream/186049-t-compiler/wg-polonius/topic/purely.20forward.20propagation.html#251072611">(Aug 28 2021 at 18:10)</a>:</h4>
<p>for sure</p>



<a name="251072615"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/186049-t-compiler/wg-polonius/topic/purely%20forward%20propagation/near/251072615" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/186049-t-compiler/wg-polonius/topic/purely.20forward.20propagation.html#251072615">(Aug 28 2021 at 18:10)</a>:</h4>
<p>we could add one more input relation that is like node_text</p>



<a name="251072626"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/186049-t-compiler/wg-polonius/topic/purely%20forward%20propagation/near/251072626" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/186049-t-compiler/wg-polonius/topic/purely.20forward.20propagation.html#251072626">(Aug 28 2021 at 18:11)</a>:</h4>
<p>so that we can have <code>a.     x = 22</code></p>



<a name="251072627"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/186049-t-compiler/wg-polonius/topic/purely%20forward%20propagation/near/251072627" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/186049-t-compiler/wg-polonius/topic/purely.20forward.20propagation.html#251072627">(Aug 28 2021 at 18:11)</a>:</h4>
<p>stuff like that</p>



<a name="251072633"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/186049-t-compiler/wg-polonius/topic/purely%20forward%20propagation/near/251072633" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/186049-t-compiler/wg-polonius/topic/purely.20forward.20propagation.html#251072633">(Aug 28 2021 at 18:11)</a>:</h4>
<p>and then we can generate exactly the graphviz that is in the hackmd, which I thought looked decent</p>



<a name="251072636"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/186049-t-compiler/wg-polonius/topic/purely%20forward%20propagation/near/251072636" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> lqd <a href="https://zulip-archive.rust-lang.org/stream/186049-t-compiler/wg-polonius/topic/purely.20forward.20propagation.html#251072636">(Aug 28 2021 at 18:11)</a>:</h4>
<p>that would be helpful</p>



<a name="251072637"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/186049-t-compiler/wg-polonius/topic/purely%20forward%20propagation/near/251072637" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/186049-t-compiler/wg-polonius/topic/purely.20forward.20propagation.html#251072637">(Aug 28 2021 at 18:11)</a>:</h4>
<p>(or something even better...)</p>



<a name="251072643"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/186049-t-compiler/wg-polonius/topic/purely%20forward%20propagation/near/251072643" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/186049-t-compiler/wg-polonius/topic/purely.20forward.20propagation.html#251072643">(Aug 28 2021 at 18:11)</a>:</h4>
<p>yeah, it's worth the trouble</p>



<a name="251072645"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/186049-t-compiler/wg-polonius/topic/purely%20forward%20propagation/near/251072645" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> lqd <a href="https://zulip-archive.rust-lang.org/stream/186049-t-compiler/wg-polonius/topic/purely.20forward.20propagation.html#251072645">(Aug 28 2021 at 18:11)</a>:</h4>
<p>yeah they were indeed clear</p>



<a name="251072658"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/186049-t-compiler/wg-polonius/topic/purely%20forward%20propagation/near/251072658" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> lqd <a href="https://zulip-archive.rust-lang.org/stream/186049-t-compiler/wg-polonius/topic/purely.20forward.20propagation.html#251072658">(Aug 28 2021 at 18:11)</a>:</h4>
<p>I'll work on this as well</p>



<a name="251072701"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/186049-t-compiler/wg-polonius/topic/purely%20forward%20propagation/near/251072701" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/186049-t-compiler/wg-polonius/topic/purely.20forward.20propagation.html#251072701">(Aug 28 2021 at 18:12)</a>:</h4>
<p>that would be excellent :)</p>



<a name="251072706"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/186049-t-compiler/wg-polonius/topic/purely%20forward%20propagation/near/251072706" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/186049-t-compiler/wg-polonius/topic/purely.20forward.20propagation.html#251072706">(Aug 28 2021 at 18:12)</a>:</h4>
<p>I am going to stop for now!</p>



<a name="251072708"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/186049-t-compiler/wg-polonius/topic/purely%20forward%20propagation/near/251072708" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/186049-t-compiler/wg-polonius/topic/purely.20forward.20propagation.html#251072708">(Aug 28 2021 at 18:12)</a>:</h4>
<p>I'll add you to the repo</p>



<a name="251095212"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/186049-t-compiler/wg-polonius/topic/purely%20forward%20propagation/near/251095212" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> lqd <a href="https://zulip-archive.rust-lang.org/stream/186049-t-compiler/wg-polonius/topic/purely.20forward.20propagation.html#251095212">(Aug 29 2021 at 01:15)</a>:</h4>
<p><span class="user-mention silent" data-user-id="116009">nikomatsakis</span> <a href="#narrow/stream/186049-t-compiler.2Fwg-polonius/topic/purely.20forward.20propagation/near/251072701">said</a>:</p>
<blockquote>
<p>that would be excellent :)</p>
</blockquote>
<p>done :)</p>
<p>I've pushed a first take of some hacky python code to the graphviz branch <a href="https://github.com/nikomatsakis/polonius.next/tree/graphviz">https://github.com/nikomatsakis/polonius.next/tree/graphviz</a></p>
<ul>
<li>I've added the <code>node_text</code> relation to show a summary/line of code at the beginning of the node (soufflé doesn't read it but I've kept the same format as the other fact files)</li>
<li>it's described in the readme, but you pass it both the input, and output facts generated by soufflé (I've made all computed intermediary relations <code>.output</code> for this purpose) so that it can show both in the graph</li>
<li>I've only tested on the <code>example-a</code> facts (with python 3.7, and on an old version of soufflé, apparently I can't build it from source anymore...), and it seems to produce the same graph. Since it uses the same html format, it's probably best seen embedded in a hackmd for now.</li>
</ul>



<a name="251095705"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/186049-t-compiler/wg-polonius/topic/purely%20forward%20propagation/near/251095705" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> lqd <a href="https://zulip-archive.rust-lang.org/stream/186049-t-compiler/wg-polonius/topic/purely.20forward.20propagation.html#251095705">(Aug 29 2021 at 01:25)</a>:</h4>
<p><span class="user-mention silent" data-user-id="116009">nikomatsakis</span> <a href="#narrow/stream/186049-t-compiler.2Fwg-polonius/topic/purely.20forward.20propagation/near/251070707">said</a>:</p>
<blockquote>
<p>I'm now feeling like 99.9% sure we could just get rid of loans and have "special" origins instead</p>
</blockquote>
<p>(if you remember, doing this is what I was (succintly) describing under the name <code>odisseus</code> way back when :)</p>



<a name="251119773"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/186049-t-compiler/wg-polonius/topic/purely%20forward%20propagation/near/251119773" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/186049-t-compiler/wg-polonius/topic/purely.20forward.20propagation.html#251119773">(Aug 29 2021 at 09:25)</a>:</h4>
<p>sorry I didn't grok it then :)</p>



<a name="251119790"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/186049-t-compiler/wg-polonius/topic/purely%20forward%20propagation/near/251119790" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/186049-t-compiler/wg-polonius/topic/purely.20forward.20propagation.html#251119790">(Aug 29 2021 at 09:26)</a>:</h4>
<p>I also do remember pondering "why do we need loans' many times</p>



<a name="251119831"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/186049-t-compiler/wg-polonius/topic/purely%20forward%20propagation/near/251119831" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/186049-t-compiler/wg-polonius/topic/purely.20forward.20propagation.html#251119831">(Aug 29 2021 at 09:26)</a>:</h4>
<p>so maybe we'll rediscover it?</p>



<a name="251119840"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/186049-t-compiler/wg-polonius/topic/purely%20forward%20propagation/near/251119840" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/186049-t-compiler/wg-polonius/topic/purely.20forward.20propagation.html#251119840">(Aug 29 2021 at 09:26)</a>:</h4>
<p>or maybe the forward prop makes a difference</p>



<a name="251119982"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/186049-t-compiler/wg-polonius/topic/purely%20forward%20propagation/near/251119982" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/186049-t-compiler/wg-polonius/topic/purely.20forward.20propagation.html#251119982">(Aug 29 2021 at 09:29)</a>:</h4>
<p>nice, looks great!</p>



<a name="251120168"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/186049-t-compiler/wg-polonius/topic/purely%20forward%20propagation/near/251120168" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/186049-t-compiler/wg-polonius/topic/purely.20forward.20propagation.html#251120168">(Aug 29 2021 at 09:32)</a>:</h4>
<p>merged into main</p>



<a name="251121209"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/186049-t-compiler/wg-polonius/topic/purely%20forward%20propagation/near/251121209" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> lqd <a href="https://zulip-archive.rust-lang.org/stream/186049-t-compiler/wg-polonius/topic/purely.20forward.20propagation.html#251121209">(Aug 29 2021 at 09:52)</a>:</h4>
<p>no need to be sorry, it was poorly explained surely, and half baked thoughts; now is its time to shine or be invalidated (after analyzing more examples like Dylan’s above, that may currently still require loans, for the time being.)</p>



<a name="251123683"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/186049-t-compiler/wg-polonius/topic/purely%20forward%20propagation/near/251123683" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/186049-t-compiler/wg-polonius/topic/purely.20forward.20propagation.html#251123683">(Aug 29 2021 at 10:38)</a>:</h4>
<p>I'm creating a quick-and-dirty fact parser to make writing future examples easier</p>



<a name="251123684"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/186049-t-compiler/wg-polonius/topic/purely%20forward%20propagation/near/251123684" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/186049-t-compiler/wg-polonius/topic/purely.20forward.20propagation.html#251123684">(Aug 29 2021 at 10:38)</a>:</h4>
<p>and to have a little test harness</p>



<a name="251123686"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/186049-t-compiler/wg-polonius/topic/purely%20forward%20propagation/near/251123686" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/186049-t-compiler/wg-polonius/topic/purely.20forward.20propagation.html#251123686">(Aug 29 2021 at 10:38)</a>:</h4>
<p>almost done :)</p>



<a name="251123701"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/186049-t-compiler/wg-polonius/topic/purely%20forward%20propagation/near/251123701" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/186049-t-compiler/wg-polonius/topic/purely.20forward.20propagation.html#251123701">(Aug 29 2021 at 10:39)</a>:</h4>
<p>I have to look at Dylan's example, indeed, I've been putting it off until we have a more useful tool to iterate faster :)</p>



<a name="251123710"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/186049-t-compiler/wg-polonius/topic/purely%20forward%20propagation/near/251123710" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/186049-t-compiler/wg-polonius/topic/purely.20forward.20propagation.html#251123710">(Aug 29 2021 at 10:39)</a>:</h4>
<p>I realize of course that writing the graphviz thing in python was silly, we should port it to Rust, but anyway</p>



<a name="251124868"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/186049-t-compiler/wg-polonius/topic/purely%20forward%20propagation/near/251124868" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/186049-t-compiler/wg-polonius/topic/purely.20forward.20propagation.html#251124868">(Aug 29 2021 at 11:00)</a>:</h4>
<p>(done, pushed)</p>



<a name="251126460"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/186049-t-compiler/wg-polonius/topic/purely%20forward%20propagation/near/251126460" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/186049-t-compiler/wg-polonius/topic/purely.20forward.20propagation.html#251126460">(Aug 29 2021 at 11:31)</a>:</h4>
<p>ok, we have a simple test harness now. you can run <code>cargo test --all</code> to use it</p>



<a name="251126463"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/186049-t-compiler/wg-polonius/topic/purely%20forward%20propagation/near/251126463" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/186049-t-compiler/wg-polonius/topic/purely.20forward.20propagation.html#251126463">(Aug 29 2021 at 11:31)</a>:</h4>
<p>now let me transcribe another test or two :P</p>



<a name="251127337"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/186049-t-compiler/wg-polonius/topic/purely%20forward%20propagation/near/251127337" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/186049-t-compiler/wg-polonius/topic/purely.20forward.20propagation.html#251127337">(Aug 29 2021 at 11:48)</a>:</h4>
<p>ok, going to stop for now...</p>



<a name="251127380"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/186049-t-compiler/wg-polonius/topic/purely%20forward%20propagation/near/251127380" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/186049-t-compiler/wg-polonius/topic/purely.20forward.20propagation.html#251127380">(Aug 29 2021 at 11:49)</a>:</h4>
<p><span class="user-mention silent" data-user-id="118594">Dylan MacKenzie (ecstatic-morse)</span> <a href="#narrow/stream/186049-t-compiler.2Fwg-polonius/topic/purely.20forward.20propagation/near/251012044">said</a>:</p>
<blockquote>
<p>Here's my belated example, where I think you need something like loans, for posterity</p>
<p><div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="kd">let</span><span class="w"> </span><span class="k">mut</span><span class="w"> </span><span class="n">foo</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="p">;</span><span class="w"></span>
<span class="kd">let</span><span class="w"> </span><span class="k">mut</span><span class="w"> </span><span class="n">x</span>: <span class="kp">&amp;</span><span class="o">'</span><span class="na">x</span> <span class="kt">u32</span> <span class="o">=</span><span class="w"> </span><span class="o">&amp;</span><span class="n">foo</span><span class="p">;</span><span class="w"></span>
<span class="kd">let</span><span class="w"> </span><span class="n">y</span>: <span class="kp">&amp;</span><span class="o">'</span><span class="na">y</span> <span class="kt">u32</span> <span class="o">=</span><span class="w"> </span><span class="n">x</span><span class="p">;</span><span class="w"> </span><span class="c1">// 'y &lt;: 'x</span>

<span class="n">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">&amp;</span><span class="mi">42</span><span class="p">;</span><span class="w"> </span><span class="c1">// clears 'x</span>
<span class="n">foo</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">142</span><span class="p">;</span><span class="w"> </span><span class="c1">// invalidates foo, which is still present in `y`</span>

<span class="fm">println!</span><span class="p">(</span><span class="s">"{}"</span><span class="p">,</span><span class="w"> </span><span class="n">y</span><span class="p">);</span><span class="w"></span>
</code></pre></div><br>
</p>
</blockquote>
<p>ftr, though, I think this example would work just fine</p>



<a name="251127385"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/186049-t-compiler/wg-polonius/topic/purely%20forward%20propagation/near/251127385" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/186049-t-compiler/wg-polonius/topic/purely.20forward.20propagation.html#251127385">(Aug 29 2021 at 11:49)</a>:</h4>
<p>how I imagine it working is that <code>&amp;foo</code> is kind of <code>&amp;'0 foo</code>, so we would also have <code>'0 &lt;: 'x</code></p>



<a name="251127388"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/186049-t-compiler/wg-polonius/topic/purely%20forward%20propagation/near/251127388" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/186049-t-compiler/wg-polonius/topic/purely.20forward.20propagation.html#251127388">(Aug 29 2021 at 11:49)</a>:</h4>
<p>and hence <code>'0 &lt;: 'y</code></p>



<a name="251127399"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/186049-t-compiler/wg-polonius/topic/purely%20forward%20propagation/near/251127399" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/186049-t-compiler/wg-polonius/topic/purely.20forward.20propagation.html#251127399">(Aug 29 2021 at 11:49)</a>:</h4>
<p>and <code>foo = 142</code> would be "invalidate_origin('0)", which would also invalidate <code>'y</code> because <code>'0 &lt;: 'y</code></p>



<a name="251127482"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/186049-t-compiler/wg-polonius/topic/purely%20forward%20propagation/near/251127482" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/186049-t-compiler/wg-polonius/topic/purely.20forward.20propagation.html#251127482">(Aug 29 2021 at 11:50)</a>:</h4>
<p>this new perspective seems to make issue-47680 kind of .. trivial, which is interesting</p>



<a name="251139716"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/186049-t-compiler/wg-polonius/topic/purely%20forward%20propagation/near/251139716" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/186049-t-compiler/wg-polonius/topic/purely.20forward.20propagation.html#251139716">(Aug 29 2021 at 15:34)</a>:</h4>
<p>Did a bit more poking, wrote up some comments on the rules I was (trying) to "faithfully" apply</p>



<a name="251139814"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/186049-t-compiler/wg-polonius/topic/purely%20forward%20propagation/near/251139814" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> lqd <a href="https://zulip-archive.rust-lang.org/stream/186049-t-compiler/wg-polonius/topic/purely.20forward.20propagation.html#251139814">(Aug 29 2021 at 15:36)</a>:</h4>
<p>so much great work, but you should enjoy your sunday !</p>



<a name="251139962"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/186049-t-compiler/wg-polonius/topic/purely%20forward%20propagation/near/251139962" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> lqd <a href="https://zulip-archive.rust-lang.org/stream/186049-t-compiler/wg-polonius/topic/purely.20forward.20propagation.html#251139962">(Aug 29 2021 at 15:39)</a>:</h4>
<p>you also sneakily added a cheeky "just use origins, no loans" commit <span aria-label="heart eyes" class="emoji emoji-1f60d" role="img" title="heart eyes">:heart_eyes:</span></p>



<a name="251140280"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/186049-t-compiler/wg-polonius/topic/purely%20forward%20propagation/near/251140280" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/186049-t-compiler/wg-polonius/topic/purely.20forward.20propagation.html#251140280">(Aug 29 2021 at 15:44)</a>:</h4>
<p>heh, true. I'm going to stop now, just been a bit curious. I'm still feeling a bit confused about the right behavior of an <code>&amp;mut x</code> and how much "invalidation" of a loan should propagate.</p>



<a name="251140288"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/186049-t-compiler/wg-polonius/topic/purely%20forward%20propagation/near/251140288" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/186049-t-compiler/wg-polonius/topic/purely.20forward.20propagation.html#251140288">(Aug 29 2021 at 15:45)</a>:</h4>
<p>Something feels funny about propagating invalid loans</p>



<a name="251140296"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/186049-t-compiler/wg-polonius/topic/purely%20forward%20propagation/near/251140296" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/186049-t-compiler/wg-polonius/topic/purely.20forward.20propagation.html#251140296">(Aug 29 2021 at 15:45)</a>:</h4>
<p>instead of propagating (and removing) <em>valid</em> loans</p>



<a name="251140312"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/186049-t-compiler/wg-polonius/topic/purely%20forward%20propagation/near/251140312" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/186049-t-compiler/wg-polonius/topic/purely.20forward.20propagation.html#251140312">(Aug 29 2021 at 15:45)</a>:</h4>
<p>feels a bit backward? but maybe it fits better with datalog actually</p>



<a name="251140320"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/186049-t-compiler/wg-polonius/topic/purely%20forward%20propagation/near/251140320" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/186049-t-compiler/wg-polonius/topic/purely.20forward.20propagation.html#251140320">(Aug 29 2021 at 15:45)</a>:</h4>
<p>since valid would intersect on control flow, but invalid is union</p>



<a name="251140434"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/186049-t-compiler/wg-polonius/topic/purely%20forward%20propagation/near/251140434" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/186049-t-compiler/wg-polonius/topic/purely.20forward.20propagation.html#251140434">(Aug 29 2021 at 15:47)</a>:</h4>
<p>one thought: it would be good to make a <em>broken</em> version of the <code>issue-47680</code>. Like what is the version that <em>should not</em> type check?</p>



<a name="251140665"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/186049-t-compiler/wg-polonius/topic/purely%20forward%20propagation/near/251140665" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> lqd <a href="https://zulip-archive.rust-lang.org/stream/186049-t-compiler/wg-polonius/topic/purely.20forward.20propagation.html#251140665">(Aug 29 2021 at 15:51)</a>:</h4>
<p>(great comments for the rules to generate inputs)</p>



<a name="251140789"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/186049-t-compiler/wg-polonius/topic/purely%20forward%20propagation/near/251140789" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> lqd <a href="https://zulip-archive.rust-lang.org/stream/186049-t-compiler/wg-polonius/topic/purely.20forward.20propagation.html#251140789">(Aug 29 2021 at 15:53)</a>:</h4>
<p>maybe doing the mutation in a different function, to borrow for the whole duration of the loop. I think such examples were the ones which made us notice the flaws in the eq variant</p>



<a name="251140862"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/186049-t-compiler/wg-polonius/topic/purely%20forward%20propagation/near/251140862" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> lqd <a href="https://zulip-archive.rust-lang.org/stream/186049-t-compiler/wg-polonius/topic/purely.20forward.20propagation.html#251140862">(Aug 29 2021 at 15:54)</a>:</h4>
<p>(On my phone now but I’ll also try to look for such examples, at the very least so you don’t do all the work yourself…)</p>



<a name="253493960"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/186049-t-compiler/wg-polonius/topic/purely%20forward%20propagation/near/253493960" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> lqd <a href="https://zulip-archive.rust-lang.org/stream/186049-t-compiler/wg-polonius/topic/purely.20forward.20propagation.html#253493960">(Sep 15 2021 at 21:54)</a>:</h4>
<p>fuuu, come on soufflé, <a href="https://github.com/nikomatsakis/polonius.next/blob/97ee59a36d9e765f81dc68d5fd1a327090ecd97e/src/polonius.dl#L105">https://github.com/nikomatsakis/polonius.next/blob/97ee59a36d9e765f81dc68d5fd1a327090ecd97e/src/polonius.dl#L105</a></p>



<a name="253494447"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/186049-t-compiler/wg-polonius/topic/purely%20forward%20propagation/near/253494447" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> lqd <a href="https://zulip-archive.rust-lang.org/stream/186049-t-compiler/wg-polonius/topic/purely.20forward.20propagation.html#253494447">(Sep 15 2021 at 21:59)</a>:</h4>
<p>maybe there's no type checking at all in the interpreter ...</p>



<a name="253593026"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/186049-t-compiler/wg-polonius/topic/purely%20forward%20propagation/near/253593026" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/186049-t-compiler/wg-polonius/topic/purely.20forward.20propagation.html#253593026">(Sep 16 2021 at 14:41)</a>:</h4>
<p>yeah, that's annoying</p>



<a name="253619247"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/186049-t-compiler/wg-polonius/topic/purely%20forward%20propagation/near/253619247" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> lqd <a href="https://zulip-archive.rust-lang.org/stream/186049-t-compiler/wg-polonius/topic/purely.20forward.20propagation.html#253619247">(Sep 16 2021 at 17:32)</a>:</h4>
<p>(good to know: more recent versions do complain about the file)</p>



<a name="253654565"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/186049-t-compiler/wg-polonius/topic/purely%20forward%20propagation/near/253654565" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> lqd <a href="https://zulip-archive.rust-lang.org/stream/186049-t-compiler/wg-polonius/topic/purely.20forward.20propagation.html#253654565">(Sep 16 2021 at 21:32)</a>:</h4>
<p>(maybe we should do our prototyping <em>with the loans</em>, and then try to remove them. that could help temporarily avoid subtleties related to propagating origin invalidations through the cfg and subsets, and ordering. An example of subtlely could be in the issue-47680 loop, where clearing + accessing + invalidating could happen at the same point after propagation from the back edge, depending on which points clearing stops the propagation, etc)</p>



<a name="253946868"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/186049-t-compiler/wg-polonius/topic/purely%20forward%20propagation/near/253946868" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Domenic Quirl <a href="https://zulip-archive.rust-lang.org/stream/186049-t-compiler/wg-polonius/topic/purely.20forward.20propagation.html#253946868">(Sep 19 2021 at 13:55)</a>:</h4>
<p>I finally managed to get the repository running</p>



<a name="253946898"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/186049-t-compiler/wg-polonius/topic/purely%20forward%20propagation/near/253946898" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Domenic Quirl <a href="https://zulip-archive.rust-lang.org/stream/186049-t-compiler/wg-polonius/topic/purely.20forward.20propagation.html#253946898">(Sep 19 2021 at 13:55)</a>:</h4>
<p>Last week I tried to get it up on my Windows machine and in WSL, but both were uncooperative</p>



<a name="253946948"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/186049-t-compiler/wg-polonius/topic/purely%20forward%20propagation/near/253946948" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Domenic Quirl <a href="https://zulip-archive.rust-lang.org/stream/186049-t-compiler/wg-polonius/topic/purely.20forward.20propagation.html#253946948">(Sep 19 2021 at 13:56)</a>:</h4>
<p>but now I have everything running on an actual linux machine</p>



<a name="253947063"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/186049-t-compiler/wg-polonius/topic/purely%20forward%20propagation/near/253947063" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Domenic Quirl <a href="https://zulip-archive.rust-lang.org/stream/186049-t-compiler/wg-polonius/topic/purely.20forward.20propagation.html#253947063">(Sep 19 2021 at 13:58)</a>:</h4>
<p><span class="user-mention silent" data-user-id="116113">lqd</span> <a href="#narrow/stream/186049-t-compiler.2Fwg-polonius/topic/purely.20forward.20propagation/near/251095212">said</a>:</p>
<blockquote>
<p>I've pushed a first take of some hacky python code to the graphviz branch <a href="https://github.com/nikomatsakis/polonius.next/tree/graphviz">https://github.com/nikomatsakis/polonius.next/tree/graphviz</a><br>
[...] Since it uses the same html format, it's probably best seen embedded in a hackmd for now.</p>
</blockquote>
<p>made a small PR to also generate a PDF if <code>dot</code> is available, so we can look at the output without the need for this</p>



<a name="254708739"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/186049-t-compiler/wg-polonius/topic/purely%20forward%20propagation/near/254708739" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> lqd <a href="https://zulip-archive.rust-lang.org/stream/186049-t-compiler/wg-polonius/topic/purely.20forward.20propagation.html#254708739">(Sep 24 2021 at 14:01)</a>:</h4>
<p>here, that is</p>



<a name="254708873"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/186049-t-compiler/wg-polonius/topic/purely%20forward%20propagation/near/254708873" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Domenic Quirl <a href="https://zulip-archive.rust-lang.org/stream/186049-t-compiler/wg-polonius/topic/purely.20forward.20propagation.html#254708873">(Sep 24 2021 at 14:02)</a>:</h4>
<p><span class="user-mention" data-user-id="116009">@nikomatsakis</span> you mean moving the graphviz script to Rust?</p>



<a name="254708904"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/186049-t-compiler/wg-polonius/topic/purely%20forward%20propagation/near/254708904" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> lqd <a href="https://zulip-archive.rust-lang.org/stream/186049-t-compiler/wg-polonius/topic/purely.20forward.20propagation.html#254708904">(Sep 24 2021 at 14:02)</a>:</h4>
<p>ah that's true I can rewrite the python graphviz export to rust</p>



<a name="254709032"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/186049-t-compiler/wg-polonius/topic/purely%20forward%20propagation/near/254709032" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Domenic Quirl <a href="https://zulip-archive.rust-lang.org/stream/186049-t-compiler/wg-polonius/topic/purely.20forward.20propagation.html#254709032">(Sep 24 2021 at 14:03)</a>:</h4>
<p>did you guys see I added PDF generation there if <code>dot</code> is installed? (if we want that. Can ofc also be moved to Rust directly w/o the PR)</p>



<a name="254709078"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/186049-t-compiler/wg-polonius/topic/purely%20forward%20propagation/near/254709078" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> lqd <a href="https://zulip-archive.rust-lang.org/stream/186049-t-compiler/wg-polonius/topic/purely.20forward.20propagation.html#254709078">(Sep 24 2021 at 14:04)</a>:</h4>
<p>I saw that sorry I didn't respond</p>



<a name="254709131"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/186049-t-compiler/wg-polonius/topic/purely%20forward%20propagation/near/254709131" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> lqd <a href="https://zulip-archive.rust-lang.org/stream/186049-t-compiler/wg-polonius/topic/purely.20forward.20propagation.html#254709131">(Sep 24 2021 at 14:04)</a>:</h4>
<p>I haven't seen how the pdfs look</p>



<a name="254709134"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/186049-t-compiler/wg-polonius/topic/purely%20forward%20propagation/near/254709134" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/186049-t-compiler/wg-polonius/topic/purely.20forward.20propagation.html#254709134">(Sep 24 2021 at 14:04)</a>:</h4>
<p>Yes, I meant rewriting the graphviz script to Rust</p>



<a name="254709167"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/186049-t-compiler/wg-polonius/topic/purely%20forward%20propagation/near/254709167" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/186049-t-compiler/wg-polonius/topic/purely.20forward.20propagation.html#254709167">(Sep 24 2021 at 14:04)</a>:</h4>
<p>I'd probably stick to souffle for now</p>



<a name="254709199"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/186049-t-compiler/wg-polonius/topic/purely%20forward%20propagation/near/254709199" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/186049-t-compiler/wg-polonius/topic/purely.20forward.20propagation.html#254709199">(Sep 24 2021 at 14:04)</a>:</h4>
<p>though I still don't want to use it in the fullness of time</p>



<a name="254709218"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/186049-t-compiler/wg-polonius/topic/purely%20forward%20propagation/near/254709218" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Domenic Quirl <a href="https://zulip-archive.rust-lang.org/stream/186049-t-compiler/wg-polonius/topic/purely.20forward.20propagation.html#254709218">(Sep 24 2021 at 14:04)</a>:</h4>
<p><span class="user-mention silent" data-user-id="116113">lqd</span> <a href="#narrow/stream/186049-t-compiler.2Fwg-polonius/topic/purely.20forward.20propagation/near/254709078">said</a>:</p>
<blockquote>
<p>I saw that sorry I didn't respond</p>
</blockquote>
<p>Dw, I didn't expect anything to happen before today. It's also not that important</p>



<a name="254709251"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/186049-t-compiler/wg-polonius/topic/purely%20forward%20propagation/near/254709251" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Domenic Quirl <a href="https://zulip-archive.rust-lang.org/stream/186049-t-compiler/wg-polonius/topic/purely.20forward.20propagation.html#254709251">(Sep 24 2021 at 14:05)</a>:</h4>
<p>the graphs should look identical though</p>



<a name="254709273"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/186049-t-compiler/wg-polonius/topic/purely%20forward%20propagation/near/254709273" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> lqd <a href="https://zulip-archive.rust-lang.org/stream/186049-t-compiler/wg-polonius/topic/purely.20forward.20propagation.html#254709273">(Sep 24 2021 at 14:05)</a>:</h4>
<p>great :)</p>



<a name="254709294"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/186049-t-compiler/wg-polonius/topic/purely%20forward%20propagation/near/254709294" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/186049-t-compiler/wg-polonius/topic/purely.20forward.20propagation.html#254709294">(Sep 24 2021 at 14:05)</a>:</h4>
<p>let me sketch the input format I was thinking of</p>



<a name="254709342"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/186049-t-compiler/wg-polonius/topic/purely%20forward%20propagation/near/254709342" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/186049-t-compiler/wg-polonius/topic/purely.20forward.20propagation.html#254709342">(Sep 24 2021 at 14:05)</a>:</h4>
<p>side note that it's always so fun to use rust on a project that's not rustc :P</p>



<a name="254709374"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/186049-t-compiler/wg-polonius/topic/purely%20forward%20propagation/near/254709374" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> lqd <a href="https://zulip-archive.rust-lang.org/stream/186049-t-compiler/wg-polonius/topic/purely.20forward.20propagation.html#254709374">(Sep 24 2021 at 14:05)</a>:</h4>
<p>so if you've all had the time to read what I wrote here last time (soufflé errors, loan-less variation)</p>



<a name="254709380"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/186049-t-compiler/wg-polonius/topic/purely%20forward%20propagation/near/254709380" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Domenic Quirl <a href="https://zulip-archive.rust-lang.org/stream/186049-t-compiler/wg-polonius/topic/purely.20forward.20propagation.html#254709380">(Sep 24 2021 at 14:05)</a>:</h4>
<p><span class="user-mention silent" data-user-id="116009">nikomatsakis</span> <a href="#narrow/stream/186049-t-compiler.2Fwg-polonius/topic/purely.20forward.20propagation/near/254709199">said</a>:</p>
<blockquote>
<p>though I still don't want to use it in the fullness of time</p>
</blockquote>
<p>(it seems to also not work very well on Windows or WSL, from my experience just recently)</p>



<a name="254709467"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/186049-t-compiler/wg-polonius/topic/purely%20forward%20propagation/near/254709467" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/186049-t-compiler/wg-polonius/topic/purely.20forward.20propagation.html#254709467">(Sep 24 2021 at 14:06)</a>:</h4>
<p><span class="user-mention silent" data-user-id="116113">lqd</span> <a href="#narrow/stream/186049-t-compiler.2Fwg-polonius/topic/purely.20forward.20propagation/near/254709374">said</a>:</p>
<blockquote>
<p>so if you've all had the time to read what I wrote here last time (soufflé errors, loan-less variation)</p>
</blockquote>
<p>uh...</p>



<a name="254709483"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/186049-t-compiler/wg-polonius/topic/purely%20forward%20propagation/near/254709483" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/186049-t-compiler/wg-polonius/topic/purely.20forward.20propagation.html#254709483">(Sep 24 2021 at 14:06)</a>:</h4>
<p>I think I did the loan-less variation, right?</p>



<a name="254709491"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/186049-t-compiler/wg-polonius/topic/purely%20forward%20propagation/near/254709491" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> lqd <a href="https://zulip-archive.rust-lang.org/stream/186049-t-compiler/wg-polonius/topic/purely.20forward.20propagation.html#254709491">(Sep 24 2021 at 14:06)</a>:</h4>
<p>thing is, you need a recent ubuntu dom</p>



<a name="254709509"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/186049-t-compiler/wg-polonius/topic/purely%20forward%20propagation/near/254709509" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> lqd <a href="https://zulip-archive.rust-lang.org/stream/186049-t-compiler/wg-polonius/topic/purely.20forward.20propagation.html#254709509">(Sep 24 2021 at 14:06)</a>:</h4>
<p>yes niko</p>



<a name="254709511"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/186049-t-compiler/wg-polonius/topic/purely%20forward%20propagation/near/254709511" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/186049-t-compiler/wg-polonius/topic/purely.20forward.20propagation.html#254709511">(Sep 24 2021 at 14:06)</a>:</h4>
<p>oh, right</p>



<a name="254709516"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/186049-t-compiler/wg-polonius/topic/purely%20forward%20propagation/near/254709516" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/186049-t-compiler/wg-polonius/topic/purely.20forward.20propagation.html#254709516">(Sep 24 2021 at 14:06)</a>:</h4>
<p>I remember</p>



<a name="254709532"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/186049-t-compiler/wg-polonius/topic/purely%20forward%20propagation/near/254709532" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/186049-t-compiler/wg-polonius/topic/purely.20forward.20propagation.html#254709532">(Sep 24 2021 at 14:06)</a>:</h4>
<p>you're saying that there were typos and bugs</p>



<a name="254709540"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/186049-t-compiler/wg-polonius/topic/purely%20forward%20propagation/near/254709540" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> lqd <a href="https://zulip-archive.rust-lang.org/stream/186049-t-compiler/wg-polonius/topic/purely.20forward.20propagation.html#254709540">(Sep 24 2021 at 14:06)</a>:</h4>
<p>yup</p>



<a name="254709607"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/186049-t-compiler/wg-polonius/topic/purely%20forward%20propagation/near/254709607" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/186049-t-compiler/wg-polonius/topic/purely.20forward.20propagation.html#254709607">(Sep 24 2021 at 14:06)</a>:</h4>
<p>let me rebuild souffle</p>



<a name="254709617"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/186049-t-compiler/wg-polonius/topic/purely%20forward%20propagation/near/254709617" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> lqd <a href="https://zulip-archive.rust-lang.org/stream/186049-t-compiler/wg-polonius/topic/purely.20forward.20propagation.html#254709617">(Sep 24 2021 at 14:06)</a>:</h4>
<p><span class="user-mention" data-user-id="337115">@Domenic Quirl</span> if you use the 20.04 on WSL you'll be able to build the latest soufflé version and it does work</p>



<a name="254709645"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/186049-t-compiler/wg-polonius/topic/purely%20forward%20propagation/near/254709645" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> lqd <a href="https://zulip-archive.rust-lang.org/stream/186049-t-compiler/wg-polonius/topic/purely.20forward.20propagation.html#254709645">(Sep 24 2021 at 14:07)</a>:</h4>
<p>(I believe)</p>



<a name="254709660"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/186049-t-compiler/wg-polonius/topic/purely%20forward%20propagation/near/254709660" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/186049-t-compiler/wg-polonius/topic/purely.20forward.20propagation.html#254709660">(Sep 24 2021 at 14:07)</a>:</h4>
<p>trying to remember how to do that</p>



<a name="254709673"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/186049-t-compiler/wg-polonius/topic/purely%20forward%20propagation/near/254709673" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> lqd <a href="https://zulip-archive.rust-lang.org/stream/186049-t-compiler/wg-polonius/topic/purely.20forward.20propagation.html#254709673">(Sep 24 2021 at 14:07)</a>:</h4>
<p>otherwise you only get an old one</p>



<a name="254709679"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/186049-t-compiler/wg-polonius/topic/purely%20forward%20propagation/near/254709679" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/186049-t-compiler/wg-polonius/topic/purely.20forward.20propagation.html#254709679">(Sep 24 2021 at 14:07)</a>:</h4>
<p>cmake build=build or something lke that</p>



<a name="254709681"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/186049-t-compiler/wg-polonius/topic/purely%20forward%20propagation/near/254709681" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Domenic Quirl <a href="https://zulip-archive.rust-lang.org/stream/186049-t-compiler/wg-polonius/topic/purely.20forward.20propagation.html#254709681">(Sep 24 2021 at 14:07)</a>:</h4>
<p>IIRC there were 2 small changes I had to make for everything to run, which you (<span class="user-mention" data-user-id="116113">@lqd</span> ) pointed out here</p>



<a name="254709729"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/186049-t-compiler/wg-polonius/topic/purely%20forward%20propagation/near/254709729" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> lqd <a href="https://zulip-archive.rust-lang.org/stream/186049-t-compiler/wg-polonius/topic/purely.20forward.20propagation.html#254709729">(Sep 24 2021 at 14:07)</a>:</h4>
<p><a href="https://souffle-lang.github.io/build">https://souffle-lang.github.io/build</a></p>



<a name="254709875"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/186049-t-compiler/wg-polonius/topic/purely%20forward%20propagation/near/254709875" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Domenic Quirl <a href="https://zulip-archive.rust-lang.org/stream/186049-t-compiler/wg-polonius/topic/purely.20forward.20propagation.html#254709875">(Sep 24 2021 at 14:08)</a>:</h4>
<p><span class="user-mention silent" data-user-id="116113">lqd</span> <a href="#narrow/stream/186049-t-compiler.2Fwg-polonius/topic/purely.20forward.20propagation/near/254709617">said</a>:</p>
<blockquote>
<p><span class="user-mention silent" data-user-id="337115">Domenic Quirl</span> if you use the 20.04 on WSL you'll be able to build the latest soufflé version and it does work</p>
</blockquote>
<p>unfortunately it didn't for me - I upgraded both WSL and the installed Ubuntu, but I could only get it to work on another machine with proper linux (non Ubuntu)</p>



<a name="254709896"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/186049-t-compiler/wg-polonius/topic/purely%20forward%20propagation/near/254709896" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Domenic Quirl <a href="https://zulip-archive.rust-lang.org/stream/186049-t-compiler/wg-polonius/topic/purely.20forward.20propagation.html#254709896">(Sep 24 2021 at 14:08)</a>:</h4>
<p>that works for me for now</p>



<a name="254709949"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/186049-t-compiler/wg-polonius/topic/purely%20forward%20propagation/near/254709949" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> lqd <a href="https://zulip-archive.rust-lang.org/stream/186049-t-compiler/wg-polonius/topic/purely.20forward.20propagation.html#254709949">(Sep 24 2021 at 14:08)</a>:</h4>
<p>so:</p>
<ul>
<li>the current soufflé version of the rules "don't compile" depending on the soufflé version you have. I have "fixed" this, but if you do it simply, then invalidation propagation will be incorrect</li>
</ul>



<a name="254709959"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/186049-t-compiler/wg-polonius/topic/purely%20forward%20propagation/near/254709959" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Domenic Quirl <a href="https://zulip-archive.rust-lang.org/stream/186049-t-compiler/wg-polonius/topic/purely.20forward.20propagation.html#254709959">(Sep 24 2021 at 14:08)</a>:</h4>
<p>just wanted to point out that for people joining they may go though similar troubles</p>



<a name="254710201"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/186049-t-compiler/wg-polonius/topic/purely%20forward%20propagation/near/254710201" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Domenic Quirl <a href="https://zulip-archive.rust-lang.org/stream/186049-t-compiler/wg-polonius/topic/purely.20forward.20propagation.html#254710201">(Sep 24 2021 at 14:10)</a>:</h4>
<div class="codehilite" data-code-language="Diff"><pre><span></span><code><span class="gh">diff --git a/src/polonius.dl b/src/polonius.dl</span>
<span class="gh">index 7905b84..c5297fb 100644</span>
<span class="gd">--- a/src/polonius.dl</span>
<span class="gi">+++ b/src/polonius.dl</span>
<span class="gu">@@ -97,12 +97,12 @@ origin_invalidated(O2, N2) :- // Introduced by predecessor</span>
   cfg_edge(N1, N2),
   !clear_origin(O2, N1),
   subset(O1, O2, N1),
<span class="gd">-  invalidate_origin(L, O1).</span>
<span class="gi">+  invalidate_origin(O1, N1).</span>

 origin_invalidated(O, N2) :- // Introduced by predecessor
   cfg_edge(N1, N2),
   !clear_origin(O, N1),
<span class="gd">-  invalidate_origin(L, O, N1).</span>
<span class="gi">+  invalidate_origin(O, N1).</span>
</code></pre></div>



<a name="254710238"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/186049-t-compiler/wg-polonius/topic/purely%20forward%20propagation/near/254710238" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Domenic Quirl <a href="https://zulip-archive.rust-lang.org/stream/186049-t-compiler/wg-polonius/topic/purely.20forward.20propagation.html#254710238">(Sep 24 2021 at 14:10)</a>:</h4>
<p><span class="user-mention" data-user-id="116113">@lqd</span> is this what you mean by "simply"?</p>



<a name="254710251"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/186049-t-compiler/wg-polonius/topic/purely%20forward%20propagation/near/254710251" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> lqd <a href="https://zulip-archive.rust-lang.org/stream/186049-t-compiler/wg-polonius/topic/purely.20forward.20propagation.html#254710251">(Sep 24 2021 at 14:10)</a>:</h4>
<p>yes</p>



<a name="254710324"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/186049-t-compiler/wg-polonius/topic/purely%20forward%20propagation/near/254710324" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> lqd <a href="https://zulip-archive.rust-lang.org/stream/186049-t-compiler/wg-polonius/topic/purely.20forward.20propagation.html#254710324">(Sep 24 2021 at 14:10)</a>:</h4>
<p>this makes it compile and pass tests</p>



<a name="254710339"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/186049-t-compiler/wg-polonius/topic/purely%20forward%20propagation/near/254710339" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> lqd <a href="https://zulip-archive.rust-lang.org/stream/186049-t-compiler/wg-polonius/topic/purely.20forward.20propagation.html#254710339">(Sep 24 2021 at 14:11)</a>:</h4>
<p>but will not propagate invalidations</p>



<a name="254710386"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/186049-t-compiler/wg-polonius/topic/purely%20forward%20propagation/near/254710386" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> lqd <a href="https://zulip-archive.rust-lang.org/stream/186049-t-compiler/wg-polonius/topic/purely.20forward.20propagation.html#254710386">(Sep 24 2021 at 14:11)</a>:</h4>
<p>so if you had some dummy cfg points between invalidations it won't detect the errors</p>



<a name="254710421"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/186049-t-compiler/wg-polonius/topic/purely%20forward%20propagation/near/254710421" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/186049-t-compiler/wg-polonius/topic/purely.20forward.20propagation.html#254710421">(Sep 24 2021 at 14:11)</a>:</h4>
<p><span class="user-mention" data-user-id="116113">@lqd</span> did you push those changes?</p>



<a name="254710442"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/186049-t-compiler/wg-polonius/topic/purely%20forward%20propagation/near/254710442" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/186049-t-compiler/wg-polonius/topic/purely.20forward.20propagation.html#254710442">(Sep 24 2021 at 14:11)</a>:</h4>
<p>I see those errors</p>



<a name="254710448"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/186049-t-compiler/wg-polonius/topic/purely%20forward%20propagation/near/254710448" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/186049-t-compiler/wg-polonius/topic/purely.20forward.20propagation.html#254710448">(Sep 24 2021 at 14:11)</a>:</h4>
<p>(now)</p>



<a name="254710460"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/186049-t-compiler/wg-polonius/topic/purely%20forward%20propagation/near/254710460" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/186049-t-compiler/wg-polonius/topic/purely.20forward.20propagation.html#254710460">(Sep 24 2021 at 14:12)</a>:</h4>
<p>strangely, cargo test still works?!</p>



<a name="254710518"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/186049-t-compiler/wg-polonius/topic/purely%20forward%20propagation/near/254710518" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> lqd <a href="https://zulip-archive.rust-lang.org/stream/186049-t-compiler/wg-polonius/topic/purely.20forward.20propagation.html#254710518">(Sep 24 2021 at 14:12)</a>:</h4>
<p>I didn't push, let me get the version I have</p>



<a name="254710542"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/186049-t-compiler/wg-polonius/topic/purely%20forward%20propagation/near/254710542" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Domenic Quirl <a href="https://zulip-archive.rust-lang.org/stream/186049-t-compiler/wg-polonius/topic/purely.20forward.20propagation.html#254710542">(Sep 24 2021 at 14:12)</a>:</h4>
<p>Yeah, one thing I noticed also was that right now invalidation only triggers if the access is right after the <code>invalidate_origin</code></p>



<a name="254710561"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/186049-t-compiler/wg-polonius/topic/purely%20forward%20propagation/near/254710561" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> lqd <a href="https://zulip-archive.rust-lang.org/stream/186049-t-compiler/wg-polonius/topic/purely.20forward.20propagation.html#254710561">(Sep 24 2021 at 14:12)</a>:</h4>
<p>but then we go into the subtlety I mentioned above</p>



<a name="254710619"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/186049-t-compiler/wg-polonius/topic/purely%20forward%20propagation/near/254710619" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Domenic Quirl <a href="https://zulip-archive.rust-lang.org/stream/186049-t-compiler/wg-polonius/topic/purely.20forward.20propagation.html#254710619">(Sep 24 2021 at 14:12)</a>:</h4>
<p>which is the case in all of the current tests</p>



<a name="254710653"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/186049-t-compiler/wg-polonius/topic/purely%20forward%20propagation/near/254710653" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Domenic Quirl <a href="https://zulip-archive.rust-lang.org/stream/186049-t-compiler/wg-polonius/topic/purely.20forward.20propagation.html#254710653">(Sep 24 2021 at 14:13)</a>:</h4>
<p>but obviously not generally</p>



<a name="254710673"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/186049-t-compiler/wg-polonius/topic/purely%20forward%20propagation/near/254710673" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/186049-t-compiler/wg-polonius/topic/purely.20forward.20propagation.html#254710673">(Sep 24 2021 at 14:13)</a>:</h4>
<p><span class="user-mention silent" data-user-id="116113">lqd</span> <a href="#narrow/stream/186049-t-compiler.2Fwg-polonius/topic/purely.20forward.20propagation/near/254710339">said</a>:</p>
<blockquote>
<p>but will not propagate invalidations</p>
</blockquote>
<p>ok ok</p>



<a name="254710677"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/186049-t-compiler/wg-polonius/topic/purely%20forward%20propagation/near/254710677" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/186049-t-compiler/wg-polonius/topic/purely.20forward.20propagation.html#254710677">(Sep 24 2021 at 14:13)</a>:</h4>
<p>I missed this</p>



<a name="254710701"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/186049-t-compiler/wg-polonius/topic/purely%20forward%20propagation/near/254710701" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> lqd <a href="https://zulip-archive.rust-lang.org/stream/186049-t-compiler/wg-polonius/topic/purely.20forward.20propagation.html#254710701">(Sep 24 2021 at 14:13)</a>:</h4>
<p>that's what I'm here for</p>



<a name="254710717"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/186049-t-compiler/wg-polonius/topic/purely%20forward%20propagation/near/254710717" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/186049-t-compiler/wg-polonius/topic/purely.20forward.20propagation.html#254710717">(Sep 24 2021 at 14:13)</a>:</h4>
<p>would be great to have a test that fails, then</p>



<a name="254710794"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/186049-t-compiler/wg-polonius/topic/purely%20forward%20propagation/near/254710794" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> lqd <a href="https://zulip-archive.rust-lang.org/stream/186049-t-compiler/wg-polonius/topic/purely.20forward.20propagation.html#254710794">(Sep 24 2021 at 14:14)</a>:</h4>
<p>yeah, we'll craft one :)</p>



<a name="254710857"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/186049-t-compiler/wg-polonius/topic/purely%20forward%20propagation/near/254710857" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> lqd <a href="https://zulip-archive.rust-lang.org/stream/186049-t-compiler/wg-polonius/topic/purely.20forward.20propagation.html#254710857">(Sep 24 2021 at 14:14)</a>:</h4>
<p>so I was playing with <a href="https://gist.github.com/lqd/ec35dfd13a2fbfecbe9eae0240fe90f9">https://gist.github.com/lqd/ec35dfd13a2fbfecbe9eae0240fe90f9</a></p>



<a name="254711167"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/186049-t-compiler/wg-polonius/topic/purely%20forward%20propagation/near/254711167" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> lqd <a href="https://zulip-archive.rust-lang.org/stream/186049-t-compiler/wg-polonius/topic/purely.20forward.20propagation.html#254711167">(Sep 24 2021 at 14:16)</a>:</h4>
<p>in particular, this tries to propagate invalidations</p>



<a name="254711202"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/186049-t-compiler/wg-polonius/topic/purely%20forward%20propagation/near/254711202" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/186049-t-compiler/wg-polonius/topic/purely.20forward.20propagation.html#254711202">(Sep 24 2021 at 14:16)</a>:</h4>
<p>pshed your changes</p>



<a name="254711237"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/186049-t-compiler/wg-polonius/topic/purely%20forward%20propagation/near/254711237" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/186049-t-compiler/wg-polonius/topic/purely.20forward.20propagation.html#254711237">(Sep 24 2021 at 14:16)</a>:</h4>
<p>now let me try to understand what it is you are saying is the problem</p>



<a name="254711259"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/186049-t-compiler/wg-polonius/topic/purely%20forward%20propagation/near/254711259" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> lqd <a href="https://zulip-archive.rust-lang.org/stream/186049-t-compiler/wg-polonius/topic/purely.20forward.20propagation.html#254711259">(Sep 24 2021 at 14:16)</a>:</h4>
<p>I didn't push them because I wanted to talk about them with y'all :)</p>



<a name="254711378"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/186049-t-compiler/wg-polonius/topic/purely%20forward%20propagation/near/254711378" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> lqd <a href="https://zulip-archive.rust-lang.org/stream/186049-t-compiler/wg-polonius/topic/purely.20forward.20propagation.html#254711378">(Sep 24 2021 at 14:17)</a>:</h4>
<p>so I've tried to do the propagations with</p>
<div class="codehilite" data-code-language="Prolog"><pre><span></span><code><span class="nf">origin_invalidated</span><span class="p">(</span><span class="nv">O</span><span class="p">,</span> <span class="nv">N2</span><span class="p">)</span> <span class="p">:-</span> <span class="o">//</span> <span class="nv">Introduced</span> <span class="s s-Atom">by</span> <span class="s s-Atom">predecessor</span>
  <span class="nf">cfg_edge</span><span class="p">(</span><span class="nv">N1</span><span class="p">,</span> <span class="nv">N2</span><span class="p">),</span>
  <span class="p">!</span><span class="nf">clear_origin</span><span class="p">(</span><span class="nv">O</span><span class="p">,</span> <span class="nv">N1</span><span class="p">),</span>
  <span class="p">(</span><span class="nf">invalidate_origin</span><span class="p">(</span><span class="nv">O</span><span class="p">,</span> <span class="nv">N1</span><span class="p">)</span> <span class="p">;</span> <span class="nf">origin_invalidated</span><span class="p">(</span><span class="nv">O</span><span class="p">,</span> <span class="nv">N1</span><span class="p">)).</span> <span class="o">//</span> <span class="s s-Atom">this</span>
</code></pre></div>



<a name="254711577"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/186049-t-compiler/wg-polonius/topic/purely%20forward%20propagation/near/254711577" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/186049-t-compiler/wg-polonius/topic/purely.20forward.20propagation.html#254711577">(Sep 24 2021 at 14:18)</a>:</h4>
<p>oh, I see</p>



<a name="254711586"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/186049-t-compiler/wg-polonius/topic/purely%20forward%20propagation/near/254711586" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/186049-t-compiler/wg-polonius/topic/purely.20forward.20propagation.html#254711586">(Sep 24 2021 at 14:18)</a>:</h4>
<p>duh</p>



<a name="254711601"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/186049-t-compiler/wg-polonius/topic/purely%20forward%20propagation/near/254711601" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/186049-t-compiler/wg-polonius/topic/purely.20forward.20propagation.html#254711601">(Sep 24 2021 at 14:18)</a>:</h4>
<p>/me thinks</p>



<a name="254711639"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/186049-t-compiler/wg-polonius/topic/purely%20forward%20propagation/near/254711639" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> lqd <a href="https://zulip-archive.rust-lang.org/stream/186049-t-compiler/wg-polonius/topic/purely.20forward.20propagation.html#254711639">(Sep 24 2021 at 14:18)</a>:</h4>
<p>now the question is when do we stop them, because in the <code>issue-47680</code> test, the back edge in the loop will reach this point <a href="https://github.com/nikomatsakis/polonius.next/blob/cf4c87ca5a107942fa25867e525cf5c0447c6599/tests/issue-47680/program.txt#L29-L48">https://github.com/nikomatsakis/polonius.next/blob/cf4c87ca5a107942fa25867e525cf5c0447c6599/tests/issue-47680/program.txt#L29-L48</a> and generate an error</p>



<a name="254711750"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/186049-t-compiler/wg-polonius/topic/purely%20forward%20propagation/near/254711750" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> lqd <a href="https://zulip-archive.rust-lang.org/stream/186049-t-compiler/wg-polonius/topic/purely.20forward.20propagation.html#254711750">(Sep 24 2021 at 14:19)</a>:</h4>
<p>and this is why I was playing with stopping them here <a href="https://gist.github.com/lqd/ec35dfd13a2fbfecbe9eae0240fe90f9#file-polonius-dl-L98-L99">https://gist.github.com/lqd/ec35dfd13a2fbfecbe9eae0240fe90f9#file-polonius-dl-L98-L99</a></p>



<a name="254711941"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/186049-t-compiler/wg-polonius/topic/purely%20forward%20propagation/near/254711941" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Domenic Quirl <a href="https://zulip-archive.rust-lang.org/stream/186049-t-compiler/wg-polonius/topic/purely.20forward.20propagation.html#254711941">(Sep 24 2021 at 14:20)</a>:</h4>
<p>Hm, I wonder if that is sufficient</p>



<a name="254711961"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/186049-t-compiler/wg-polonius/topic/purely%20forward%20propagation/near/254711961" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/186049-t-compiler/wg-polonius/topic/purely.20forward.20propagation.html#254711961">(Sep 24 2021 at 14:20)</a>:</h4>
<p>so, step 1</p>



<a name="254711971"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/186049-t-compiler/wg-polonius/topic/purely%20forward%20propagation/near/254711971" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/186049-t-compiler/wg-polonius/topic/purely.20forward.20propagation.html#254711971">(Sep 24 2021 at 14:20)</a>:</h4>
<p>I think the right rules are</p>



<a name="254711975"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/186049-t-compiler/wg-polonius/topic/purely%20forward%20propagation/near/254711975" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/186049-t-compiler/wg-polonius/topic/purely.20forward.20propagation.html#254711975">(Sep 24 2021 at 14:20)</a>:</h4>
<div class="codehilite" data-code-language="Prolog"><pre><span></span><code><span class="s s-Atom">////////////////////////////////////////////</span>
<span class="p">.</span><span class="s s-Atom">decl</span> <span class="nf">origin_invalidated</span><span class="p">(</span><span class="nn">o</span><span class="p">:</span> <span class="nv">Origin</span><span class="p">,</span> <span class="nn">n</span><span class="p">:</span> <span class="nv">Node</span><span class="p">)</span>
<span class="p">.</span><span class="s s-Atom">output</span> <span class="s s-Atom">origin_invalidated</span>

<span class="nf">origin_invalidated</span><span class="p">(</span><span class="nv">O2</span><span class="p">,</span> <span class="nv">N</span><span class="p">)</span> <span class="p">:-</span> <span class="o">//</span> <span class="nv">Introduced</span> <span class="s s-Atom">by</span> <span class="s s-Atom">predecessor</span>
  <span class="nf">subset</span><span class="p">(</span><span class="nv">O1</span><span class="p">,</span> <span class="nv">O2</span><span class="p">,</span> <span class="nv">N</span><span class="p">),</span>
  <span class="nf">origin_invalidated</span><span class="p">(</span><span class="nv">O1</span><span class="p">,</span> <span class="nv">N1</span><span class="p">).</span>

<span class="nf">origin_invalidated</span><span class="p">(</span><span class="nv">O</span><span class="p">,</span> <span class="nv">N2</span><span class="p">)</span> <span class="p">:-</span> <span class="o">//</span> <span class="nv">Introduced</span> <span class="s s-Atom">by</span> <span class="s s-Atom">predecessor</span>
  <span class="nf">cfg_edge</span><span class="p">(</span><span class="nv">N1</span><span class="p">,</span> <span class="nv">N2</span><span class="p">),</span>
  <span class="p">!</span><span class="nf">clear_origin</span><span class="p">(</span><span class="nv">O</span><span class="p">,</span> <span class="nv">N1</span><span class="p">),</span>
  <span class="nf">invalidate_origin</span><span class="p">(</span><span class="nv">O</span><span class="p">,</span> <span class="nv">N1</span><span class="p">).</span>

<span class="nf">origin_invalidated</span><span class="p">(</span><span class="nv">O</span><span class="p">,</span> <span class="nv">N2</span><span class="p">)</span> <span class="p">:-</span> <span class="o">//</span> <span class="nv">Introduced</span> <span class="s s-Atom">by</span> <span class="s s-Atom">predecessor</span>
  <span class="nf">cfg_edge</span><span class="p">(</span><span class="nv">N1</span><span class="p">,</span> <span class="nv">N2</span><span class="p">),</span>
  <span class="p">!</span><span class="nf">clear_origin</span><span class="p">(</span><span class="nv">O</span><span class="p">,</span> <span class="nv">N1</span><span class="p">),</span>
  <span class="nf">origin_invalidated</span><span class="p">(</span><span class="nv">O</span><span class="p">,</span> <span class="nv">N1</span><span class="p">).</span>
</code></pre></div>



<a name="254711997"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/186049-t-compiler/wg-polonius/topic/purely%20forward%20propagation/near/254711997" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/186049-t-compiler/wg-polonius/topic/purely.20forward.20propagation.html#254711997">(Sep 24 2021 at 14:20)</a>:</h4>
<p>oops, bad comments</p>



<a name="254712012"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/186049-t-compiler/wg-polonius/topic/purely%20forward%20propagation/near/254712012" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Domenic Quirl <a href="https://zulip-archive.rust-lang.org/stream/186049-t-compiler/wg-polonius/topic/purely.20forward.20propagation.html#254712012">(Sep 24 2021 at 14:21)</a>:</h4>
<p>Or, more precisely, what happens if an origin gets invalidated at <code>N1</code>, but both cleared and accessed at <code>N2</code></p>



<a name="254712086"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/186049-t-compiler/wg-polonius/topic/purely%20forward%20propagation/near/254712086" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/186049-t-compiler/wg-polonius/topic/purely.20forward.20propagation.html#254712086">(Sep 24 2021 at 14:21)</a>:</h4>
<div class="codehilite" data-code-language="Prolog"><pre><span></span><code><span class="s s-Atom">////////////////////////////////////////////</span>
<span class="p">.</span><span class="s s-Atom">decl</span> <span class="nf">origin_invalidated</span><span class="p">(</span><span class="nn">o</span><span class="p">:</span> <span class="nv">Origin</span><span class="p">,</span> <span class="nn">n</span><span class="p">:</span> <span class="nv">Node</span><span class="p">)</span>
<span class="p">.</span><span class="s s-Atom">output</span> <span class="s s-Atom">origin_invalidated</span>

<span class="o">//</span> <span class="nv">If</span> <span class="s s-Atom">origin</span> <span class="nv">O1</span> <span class="o">is</span> <span class="s s-Atom">invalidated</span> <span class="s s-Atom">on</span> <span class="s s-Atom">entry</span> <span class="s s-Atom">to</span> <span class="s s-Atom">node</span> <span class="nv">N</span><span class="p">,</span>
<span class="o">//</span> <span class="s s-Atom">and</span> <span class="nv">O1</span> <span class="s s-Atom">&lt;=</span> <span class="nv">O2</span> <span class="s s-Atom">in</span> <span class="s s-Atom">node</span> <span class="nv">N</span><span class="p">,</span>
<span class="o">//</span> <span class="s s-Atom">then</span> <span class="nv">O2</span> <span class="o">is</span> <span class="s s-Atom">invalidated</span> <span class="s s-Atom">on</span> <span class="s s-Atom">entry</span><span class="p">.</span>
<span class="nf">origin_invalidated</span><span class="p">(</span><span class="nv">O2</span><span class="p">,</span> <span class="nv">N</span><span class="p">)</span> <span class="p">:-</span>
  <span class="nf">subset</span><span class="p">(</span><span class="nv">O1</span><span class="p">,</span> <span class="nv">O2</span><span class="p">,</span> <span class="nv">N</span><span class="p">),</span>
  <span class="nf">origin_invalidated</span><span class="p">(</span><span class="nv">O1</span><span class="p">,</span> <span class="nv">N</span><span class="p">).</span>

<span class="nf">origin_invalidated</span><span class="p">(</span><span class="nv">O</span><span class="p">,</span> <span class="nv">N2</span><span class="p">)</span> <span class="p">:-</span> <span class="o">//</span> <span class="nv">Introduced</span> <span class="s s-Atom">by</span> <span class="s s-Atom">predecessor</span>
  <span class="nf">cfg_edge</span><span class="p">(</span><span class="nv">N1</span><span class="p">,</span> <span class="nv">N2</span><span class="p">),</span>
  <span class="p">!</span><span class="nf">clear_origin</span><span class="p">(</span><span class="nv">O</span><span class="p">,</span> <span class="nv">N1</span><span class="p">),</span>
  <span class="p">(</span><span class="nf">invalidate_origin</span><span class="p">(</span><span class="nv">O</span><span class="p">,</span> <span class="nv">N1</span><span class="p">);</span> <span class="nf">origin_invalidated</span><span class="p">(</span><span class="nv">O</span><span class="p">,</span> <span class="nv">N1</span><span class="p">)).</span>
</code></pre></div>



<a name="254712095"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/186049-t-compiler/wg-polonius/topic/purely%20forward%20propagation/near/254712095" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/186049-t-compiler/wg-polonius/topic/purely.20forward.20propagation.html#254712095">(Sep 24 2021 at 14:21)</a>:</h4>
<p>corrected</p>



<a name="254712251"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/186049-t-compiler/wg-polonius/topic/purely%20forward%20propagation/near/254712251" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/186049-t-compiler/wg-polonius/topic/purely.20forward.20propagation.html#254712251">(Sep 24 2021 at 14:22)</a>:</h4>
<p>that said, <code>vec_temp</code> does still fail, and I think this is good -- I remember I was thinking about this question of "when to stop"</p>



<a name="254712257"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/186049-t-compiler/wg-polonius/topic/purely%20forward%20propagation/near/254712257" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/186049-t-compiler/wg-polonius/topic/purely.20forward.20propagation.html#254712257">(Sep 24 2021 at 14:22)</a>:</h4>
<p>let me see what you did next :</p>



<a name="254712300"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/186049-t-compiler/wg-polonius/topic/purely%20forward%20propagation/near/254712300" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/186049-t-compiler/wg-polonius/topic/purely.20forward.20propagation.html#254712300">(Sep 24 2021 at 14:23)</a>:</h4>
<p>I see</p>



<a name="254712366"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/186049-t-compiler/wg-polonius/topic/purely%20forward%20propagation/near/254712366" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> lqd <a href="https://zulip-archive.rust-lang.org/stream/186049-t-compiler/wg-polonius/topic/purely.20forward.20propagation.html#254712366">(Sep 24 2021 at 14:23)</a>:</h4>
<p>this is where I went, this is kinda subtle and maybe we should talk about it :)</p>



<a name="254712537"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/186049-t-compiler/wg-polonius/topic/purely%20forward%20propagation/near/254712537" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/186049-t-compiler/wg-polonius/topic/purely.20forward.20propagation.html#254712537">(Sep 24 2021 at 14:24)</a>:</h4>
<p>yeah, gimme a sec :)</p>



<a name="254712556"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/186049-t-compiler/wg-polonius/topic/purely%20forward%20propagation/near/254712556" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/186049-t-compiler/wg-polonius/topic/purely.20forward.20propagation.html#254712556">(Sep 24 2021 at 14:24)</a>:</h4>
<p>well, first, do you see what my changes are about?</p>



<a name="254712570"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/186049-t-compiler/wg-polonius/topic/purely%20forward%20propagation/near/254712570" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/186049-t-compiler/wg-polonius/topic/purely.20forward.20propagation.html#254712570">(Sep 24 2021 at 14:24)</a>:</h4>
<p>I'm going to push them so we're on a common page</p>



<a name="254712635"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/186049-t-compiler/wg-polonius/topic/purely%20forward%20propagation/near/254712635" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/186049-t-compiler/wg-polonius/topic/purely.20forward.20propagation.html#254712635">(Sep 24 2021 at 14:25)</a>:</h4>
<p>btw, in the graphviz output, I think it'd be nice to have the names of the basic blocks</p>



<a name="254712679"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/186049-t-compiler/wg-polonius/topic/purely%20forward%20propagation/near/254712679" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> lqd <a href="https://zulip-archive.rust-lang.org/stream/186049-t-compiler/wg-polonius/topic/purely.20forward.20propagation.html#254712679">(Sep 24 2021 at 14:25)</a>:</h4>
<p>I think I see what the changes are about</p>



<a name="254712989"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/186049-t-compiler/wg-polonius/topic/purely%20forward%20propagation/near/254712989" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/186049-t-compiler/wg-polonius/topic/purely.20forward.20propagation.html#254712989">(Sep 24 2021 at 14:27)</a>:</h4>
<p>I think the problem with vec-temp is actually incorrect input facts</p>



<a name="254713092"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/186049-t-compiler/wg-polonius/topic/purely%20forward%20propagation/near/254713092" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/186049-t-compiler/wg-polonius/topic/purely.20forward.20propagation.html#254713092">(Sep 24 2021 at 14:28)</a>:</h4>
<p>but I'm not sure :)</p>



<a name="254713104"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/186049-t-compiler/wg-polonius/topic/purely%20forward%20propagation/near/254713104" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> lqd <a href="https://zulip-archive.rust-lang.org/stream/186049-t-compiler/wg-polonius/topic/purely.20forward.20propagation.html#254713104">(Sep 24 2021 at 14:28)</a>:</h4>
<p>I do wonder if the subsets which are cleared at the same point would need to be invalidated or not <span aria-label="thinking" class="emoji emoji-1f914" role="img" title="thinking">:thinking:</span></p>



<a name="254713107"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/186049-t-compiler/wg-polonius/topic/purely%20forward%20propagation/near/254713107" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/186049-t-compiler/wg-polonius/topic/purely.20forward.20propagation.html#254713107">(Sep 24 2021 at 14:28)</a>:</h4>
<p>here is what goes wrong</p>



<a name="254713161"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/186049-t-compiler/wg-polonius/topic/purely%20forward%20propagation/near/254713161" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/186049-t-compiler/wg-polonius/topic/purely.20forward.20propagation.html#254713161">(Sep 24 2021 at 14:28)</a>:</h4>
<p>yeah, so the question here is exactly when to clear, and getting precise about that question was partly what I hopd to do by forcing us to have an IR :)</p>



<a name="254713219"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/186049-t-compiler/wg-polonius/topic/purely%20forward%20propagation/near/254713219" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> lqd <a href="https://zulip-archive.rust-lang.org/stream/186049-t-compiler/wg-polonius/topic/purely.20forward.20propagation.html#254713219">(Sep 24 2021 at 14:29)</a>:</h4>
<p>:)</p>



<a name="254713241"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/186049-t-compiler/wg-polonius/topic/purely%20forward%20propagation/near/254713241" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/186049-t-compiler/wg-polonius/topic/purely.20forward.20propagation.html#254713241">(Sep 24 2021 at 14:29)</a>:</h4>
<p>here is the vec-temp example:</p>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="kd">let</span><span class="w"> </span><span class="k">mut</span><span class="w"> </span><span class="n">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">22</span><span class="p">;</span><span class="w"> </span><span class="cm">/* a */</span><span class="w"></span>
<span class="kd">let</span><span class="w"> </span><span class="k">mut</span><span class="w"> </span><span class="n">v</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="fm">vec!</span><span class="p">[];</span><span class="w"> </span><span class="cm">/* b */</span><span class="w"></span>
<span class="kd">let</span><span class="w"> </span><span class="n">p</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">&amp;</span><span class="n">x</span><span class="p">;</span><span class="w"> </span><span class="cm">/* c */</span><span class="w"></span>
<span class="kd">let</span><span class="w"> </span><span class="k">mut</span><span class="w"> </span><span class="n">tmp</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">&amp;</span><span class="k">mut</span><span class="w"> </span><span class="n">v</span><span class="p">;</span><span class="w"> </span><span class="cm">/* d */</span><span class="w"></span>
<span class="nb">Vec</span>::<span class="n">push</span><span class="p">(</span><span class="n">tmp</span><span class="p">,</span><span class="w"> </span><span class="n">p</span><span class="p">);</span><span class="w"> </span><span class="cm">/* e */</span><span class="w"></span>
</code></pre></div>



<a name="254713256"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/186049-t-compiler/wg-polonius/topic/purely%20forward%20propagation/near/254713256" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/186049-t-compiler/wg-polonius/topic/purely.20forward.20propagation.html#254713256">(Sep 24 2021 at 14:29)</a>:</h4>
<p>or at least the relevant part</p>



<a name="254713293"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/186049-t-compiler/wg-polonius/topic/purely%20forward%20propagation/near/254713293" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/186049-t-compiler/wg-polonius/topic/purely.20forward.20propagation.html#254713293">(Sep 24 2021 at 14:29)</a>:</h4>
<p>what happens is that we have an origin which I am calling <code>'L_x</code></p>



<a name="254713318"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/186049-t-compiler/wg-polonius/topic/purely%20forward%20propagation/near/254713318" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/186049-t-compiler/wg-polonius/topic/purely.20forward.20propagation.html#254713318">(Sep 24 2021 at 14:29)</a>:</h4>
<p>it corresponds to the <code>let p = &amp;x</code> &lt;-- the <code>&amp;x</code> here</p>



<a name="254713319"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/186049-t-compiler/wg-polonius/topic/purely%20forward%20propagation/near/254713319" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> lqd <a href="https://zulip-archive.rust-lang.org/stream/186049-t-compiler/wg-polonius/topic/purely.20forward.20propagation.html#254713319">(Sep 24 2021 at 14:29)</a>:</h4>
<p>(that's also when I did wonder if the loan-<em>full</em> had the exact same precision requirements so that we could punt that for later)</p>



<a name="254713497"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/186049-t-compiler/wg-polonius/topic/purely%20forward%20propagation/near/254713497" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/186049-t-compiler/wg-polonius/topic/purely.20forward.20propagation.html#254713497">(Sep 24 2021 at 14:30)</a>:</h4>
<p>The idea of "clearing" seems to be: when existing values with that origin no longer refer to the same value</p>



<a name="254713550"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/186049-t-compiler/wg-polonius/topic/purely%20forward%20propagation/near/254713550" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/186049-t-compiler/wg-polonius/topic/purely.20forward.20propagation.html#254713550">(Sep 24 2021 at 14:30)</a>:</h4>
<p>so I believe it is correct to clear <code>'L_x</code> when executing <code>&amp;x</code></p>



<a name="254713570"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/186049-t-compiler/wg-polonius/topic/purely%20forward%20propagation/near/254713570" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/186049-t-compiler/wg-polonius/topic/purely.20forward.20propagation.html#254713570">(Sep 24 2021 at 14:31)</a>:</h4>
<p>but something feels funny and I'm trying to tease it out</p>



<a name="254713588"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/186049-t-compiler/wg-polonius/topic/purely%20forward%20propagation/near/254713588" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/186049-t-compiler/wg-polonius/topic/purely.20forward.20propagation.html#254713588">(Sep 24 2021 at 14:31)</a>:</h4>
<p>it's not as "obvious" to me as clearing the lifetimes in <code>p</code> when we overwrite it</p>



<a name="254713618"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/186049-t-compiler/wg-polonius/topic/purely%20forward%20propagation/near/254713618" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/186049-t-compiler/wg-polonius/topic/purely.20forward.20propagation.html#254713618">(Sep 24 2021 at 14:31)</a>:</h4>
<p>the reason we get an error right now, to spell it out, is that:</p>



<a name="254713643"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/186049-t-compiler/wg-polonius/topic/purely%20forward%20propagation/near/254713643" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/186049-t-compiler/wg-polonius/topic/purely.20forward.20propagation.html#254713643">(Sep 24 2021 at 14:31)</a>:</h4>
<p><code>let mut x = 22</code> -- that assigns to <code>x</code>, so we generate an "invalidate L_x fact"</p>



<a name="254713664"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/186049-t-compiler/wg-polonius/topic/purely%20forward%20propagation/near/254713664" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/186049-t-compiler/wg-polonius/topic/purely.20forward.20propagation.html#254713664">(Sep 24 2021 at 14:31)</a>:</h4>
<p>this propagates forward and causes an error on line <code>e</code></p>



<a name="254713724"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/186049-t-compiler/wg-polonius/topic/purely%20forward%20propagation/near/254713724" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/186049-t-compiler/wg-polonius/topic/purely.20forward.20propagation.html#254713724">(Sep 24 2021 at 14:32)</a>:</h4>
<p>you could imagine a loop</p>



<a name="254713755"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/186049-t-compiler/wg-polonius/topic/purely%20forward%20propagation/near/254713755" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/186049-t-compiler/wg-polonius/topic/purely.20forward.20propagation.html#254713755">(Sep 24 2021 at 14:32)</a>:</h4>
<p>where an old borrow of <code>x</code> was carried around the loop in some variable</p>



<a name="254713845"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/186049-t-compiler/wg-polonius/topic/purely%20forward%20propagation/near/254713845" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/186049-t-compiler/wg-polonius/topic/purely.20forward.20propagation.html#254713845">(Sep 24 2021 at 14:32)</a>:</h4>
<p>but I think that will work fine (we can concoct the example) -- </p>
<p>what will happen is that we will clear the <code>L-x</code> origin, but whatever origin is in that loop-carried variable will still be invalidated and inaccessible</p>



<a name="254713884"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/186049-t-compiler/wg-polonius/topic/purely%20forward%20propagation/near/254713884" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/186049-t-compiler/wg-polonius/topic/purely.20forward.20propagation.html#254713884">(Sep 24 2021 at 14:33)</a>:</h4>
<p>is that making sense?</p>



<a name="254713936"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/186049-t-compiler/wg-polonius/topic/purely%20forward%20propagation/near/254713936" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> lqd <a href="https://zulip-archive.rust-lang.org/stream/186049-t-compiler/wg-polonius/topic/purely.20forward.20propagation.html#254713936">(Sep 24 2021 at 14:33)</a>:</h4>
<p>some of the clearing is still a bit unintuitive to me personally</p>



<a name="254714051"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/186049-t-compiler/wg-polonius/topic/purely%20forward%20propagation/near/254714051" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/186049-t-compiler/wg-polonius/topic/purely.20forward.20propagation.html#254714051">(Sep 24 2021 at 14:34)</a>:</h4>
<p>I'm updating the text comment with the rules</p>



<a name="254714061"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/186049-t-compiler/wg-polonius/topic/purely%20forward%20propagation/near/254714061" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/186049-t-compiler/wg-polonius/topic/purely.20forward.20propagation.html#254714061">(Sep 24 2021 at 14:34)</a>:</h4>
<p>it would be good to talk it out more :)</p>



<a name="254714092"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/186049-t-compiler/wg-polonius/topic/purely%20forward%20propagation/near/254714092" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/186049-t-compiler/wg-polonius/topic/purely.20forward.20propagation.html#254714092">(Sep 24 2021 at 14:34)</a>:</h4>
<p>the comment is a bit confusing</p>



<a name="254714105"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/186049-t-compiler/wg-polonius/topic/purely%20forward%20propagation/near/254714105" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/186049-t-compiler/wg-polonius/topic/purely.20forward.20propagation.html#254714105">(Sep 24 2021 at 14:34)</a>:</h4>
<p>even to me, and I wrote it :P</p>



<a name="254714124"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/186049-t-compiler/wg-polonius/topic/purely%20forward%20propagation/near/254714124" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/186049-t-compiler/wg-polonius/topic/purely.20forward.20propagation.html#254714124">(Sep 24 2021 at 14:34)</a>:</h4>
<p>I thnk it'd be good to try and express the "fact generation" rules more mathematically</p>



<a name="254714145"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/186049-t-compiler/wg-polonius/topic/purely%20forward%20propagation/near/254714145" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> lqd <a href="https://zulip-archive.rust-lang.org/stream/186049-t-compiler/wg-polonius/topic/purely.20forward.20propagation.html#254714145">(Sep 24 2021 at 14:34)</a>:</h4>
<p>yeah</p>



<a name="254714174"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/186049-t-compiler/wg-polonius/topic/purely%20forward%20propagation/near/254714174" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> lqd <a href="https://zulip-archive.rust-lang.org/stream/186049-t-compiler/wg-polonius/topic/purely.20forward.20propagation.html#254714174">(Sep 24 2021 at 14:35)</a>:</h4>
<p>that will help with the tests as well</p>



<a name="254714293"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/186049-t-compiler/wg-polonius/topic/purely%20forward%20propagation/near/254714293" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/186049-t-compiler/wg-polonius/topic/purely.20forward.20propagation.html#254714293">(Sep 24 2021 at 14:35)</a>:</h4>
<p><a href="https://hackmd.io/a3WYlvxdSnSgMcc8tHOwZA">hackmd for notes</a></p>



<a name="254714853"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/186049-t-compiler/wg-polonius/topic/purely%20forward%20propagation/near/254714853" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Domenic Quirl <a href="https://zulip-archive.rust-lang.org/stream/186049-t-compiler/wg-polonius/topic/purely.20forward.20propagation.html#254714853">(Sep 24 2021 at 14:39)</a>:</h4>
<p><a href="/user_uploads/4715/oQ8p8O0tpMWqkKOP7Fw8mvCL/graph.dot.pdf">graph.dot.pdf</a>  (<code>vec-temp</code> graph with the current rules)</p>



<a name="254715088"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/186049-t-compiler/wg-polonius/topic/purely%20forward%20propagation/near/254715088" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/186049-t-compiler/wg-polonius/topic/purely.20forward.20propagation.html#254715088">(Sep 24 2021 at 14:40)</a>:</h4>
<p>lol am I just reproducing MIR</p>



<a name="254715096"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/186049-t-compiler/wg-polonius/topic/purely%20forward%20propagation/near/254715096" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/186049-t-compiler/wg-polonius/topic/purely.20forward.20propagation.html#254715096">(Sep 24 2021 at 14:40)</a>:</h4>
<p>I guess mildly simplified :)</p>



<a name="254715164"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/186049-t-compiler/wg-polonius/topic/purely%20forward%20propagation/near/254715164" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> lqd <a href="https://zulip-archive.rust-lang.org/stream/186049-t-compiler/wg-polonius/topic/purely.20forward.20propagation.html#254715164">(Sep 24 2021 at 14:41)</a>:</h4>
<p>smolmir</p>



<a name="254715172"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/186049-t-compiler/wg-polonius/topic/purely%20forward%20propagation/near/254715172" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Dylan MacKenzie (ecstatic-morse) <a href="https://zulip-archive.rust-lang.org/stream/186049-t-compiler/wg-polonius/topic/purely.20forward.20propagation.html#254715172">(Sep 24 2021 at 14:41)</a>:</h4>
<p>/me is caught up with this thread now.</p>



<a name="254715204"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/186049-t-compiler/wg-polonius/topic/purely%20forward%20propagation/near/254715204" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/186049-t-compiler/wg-polonius/topic/purely.20forward.20propagation.html#254715204">(Sep 24 2021 at 14:41)</a>:</h4>
<p>I'm looking over the examples</p>



<a name="254715219"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/186049-t-compiler/wg-polonius/topic/purely%20forward%20propagation/near/254715219" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/186049-t-compiler/wg-polonius/topic/purely.20forward.20propagation.html#254715219">(Sep 24 2021 at 14:41)</a>:</h4>
<p>I think the AST I've got so far can basically express them</p>



<a name="254715228"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/186049-t-compiler/wg-polonius/topic/purely%20forward%20propagation/near/254715228" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/186049-t-compiler/wg-polonius/topic/purely.20forward.20propagation.html#254715228">(Sep 24 2021 at 14:41)</a>:</h4>
<p>except we need struct declarations</p>



<a name="254715453"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/186049-t-compiler/wg-polonius/topic/purely%20forward%20propagation/near/254715453" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> lqd <a href="https://zulip-archive.rust-lang.org/stream/186049-t-compiler/wg-polonius/topic/purely.20forward.20propagation.html#254715453">(Sep 24 2021 at 14:43)</a>:</h4>
<p>(highlighting important relations in the graphviz output would be nice: <code>invalidated_origin_accessed</code> comes to mind)</p>



<a name="254715638"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/186049-t-compiler/wg-polonius/topic/purely%20forward%20propagation/near/254715638" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/186049-t-compiler/wg-polonius/topic/purely.20forward.20propagation.html#254715638">(Sep 24 2021 at 14:44)</a>:</h4>
<p>so</p>



<a name="254715646"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/186049-t-compiler/wg-polonius/topic/purely%20forward%20propagation/near/254715646" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/186049-t-compiler/wg-polonius/topic/purely.20forward.20propagation.html#254715646">(Sep 24 2021 at 14:44)</a>:</h4>
<p>I'm looking at Vec_temp</p>



<a name="254715665"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/186049-t-compiler/wg-polonius/topic/purely%20forward%20propagation/near/254715665" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/186049-t-compiler/wg-polonius/topic/purely.20forward.20propagation.html#254715665">(Sep 24 2021 at 14:44)</a>:</h4>
<p>let me sketch out some of my thinking in terms of this ast</p>



<a name="254715675"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/186049-t-compiler/wg-polonius/topic/purely%20forward%20propagation/near/254715675" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> lqd <a href="https://zulip-archive.rust-lang.org/stream/186049-t-compiler/wg-polonius/topic/purely.20forward.20propagation.html#254715675">(Sep 24 2021 at 14:44)</a>:</h4>
<p>there's something I'm unsure about in this example niko</p>



<a name="254715686"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/186049-t-compiler/wg-polonius/topic/purely%20forward%20propagation/near/254715686" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> lqd <a href="https://zulip-archive.rust-lang.org/stream/186049-t-compiler/wg-polonius/topic/purely.20forward.20propagation.html#254715686">(Sep 24 2021 at 14:45)</a>:</h4>
<p>it still fails, as expected</p>



<a name="254715708"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/186049-t-compiler/wg-polonius/topic/purely%20forward%20propagation/near/254715708" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/186049-t-compiler/wg-polonius/topic/purely.20forward.20propagation.html#254715708">(Sep 24 2021 at 14:45)</a>:</h4>
<p>it passes for me, now</p>



<a name="254715714"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/186049-t-compiler/wg-polonius/topic/purely%20forward%20propagation/near/254715714" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/186049-t-compiler/wg-polonius/topic/purely.20forward.20propagation.html#254715714">(Sep 24 2021 at 14:45)</a>:</h4>
<p>but carry on</p>



<a name="254715720"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/186049-t-compiler/wg-polonius/topic/purely%20forward%20propagation/near/254715720" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> lqd <a href="https://zulip-archive.rust-lang.org/stream/186049-t-compiler/wg-polonius/topic/purely.20forward.20propagation.html#254715720">(Sep 24 2021 at 14:45)</a>:</h4>
<p>what is the problem you were looking for ?</p>



<a name="254715727"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/186049-t-compiler/wg-polonius/topic/purely%20forward%20propagation/near/254715727" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/186049-t-compiler/wg-polonius/topic/purely.20forward.20propagation.html#254715727">(Sep 24 2021 at 14:45)</a>:</h4>
<p>(because I updated the facts)</p>



<a name="254715750"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/186049-t-compiler/wg-polonius/topic/purely%20forward%20propagation/near/254715750" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> lqd <a href="https://zulip-archive.rust-lang.org/stream/186049-t-compiler/wg-polonius/topic/purely.20forward.20propagation.html#254715750">(Sep 24 2021 at 14:45)</a>:</h4>
<p>oh ok I hadn't caught that, thank you</p>



<a name="254715755"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/186049-t-compiler/wg-polonius/topic/purely%20forward%20propagation/near/254715755" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/186049-t-compiler/wg-polonius/topic/purely.20forward.20propagation.html#254715755">(Sep 24 2021 at 14:45)</a>:</h4>
<p>well, I only gave a prefix of the example :)</p>



<a name="254715769"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/186049-t-compiler/wg-polonius/topic/purely%20forward%20propagation/near/254715769" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/186049-t-compiler/wg-polonius/topic/purely.20forward.20propagation.html#254715769">(Sep 24 2021 at 14:45)</a>:</h4>
<p>full example</p>



<a name="254715777"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/186049-t-compiler/wg-polonius/topic/purely%20forward%20propagation/near/254715777" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/186049-t-compiler/wg-polonius/topic/purely.20forward.20propagation.html#254715777">(Sep 24 2021 at 14:45)</a>:</h4>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="c1">// let mut x = 22;</span>
<span class="c1">// let mut v = vec![];</span>
<span class="c1">// let p = &amp;x;</span>
<span class="c1">// let mut tmp = &amp;mut v;</span>
<span class="c1">// Vec::push(tmp, p);</span>
<span class="c1">// x = 23;</span>
<span class="c1">// Vec::len(v); // ERROR</span>
</code></pre></div>



<a name="254715799"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/186049-t-compiler/wg-polonius/topic/purely%20forward%20propagation/near/254715799" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/186049-t-compiler/wg-polonius/topic/purely.20forward.20propagation.html#254715799">(Sep 24 2021 at 14:45)</a>:</h4>
<p>so there is still an error, but not on line <code>e</code></p>



<a name="254715803"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/186049-t-compiler/wg-polonius/topic/purely%20forward%20propagation/near/254715803" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/186049-t-compiler/wg-polonius/topic/purely.20forward.20propagation.html#254715803">(Sep 24 2021 at 14:45)</a>:</h4>
<p>rather on the final line</p>



<a name="254715897"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/186049-t-compiler/wg-polonius/topic/purely%20forward%20propagation/near/254715897" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/186049-t-compiler/wg-polonius/topic/purely.20forward.20propagation.html#254715897">(Sep 24 2021 at 14:46)</a>:</h4>
<p>the key idea here is that we have a borrow of <code>x</code> (p = &amp;x)</p>



<a name="254715914"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/186049-t-compiler/wg-polonius/topic/purely%20forward%20propagation/near/254715914" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/186049-t-compiler/wg-polonius/topic/purely.20forward.20propagation.html#254715914">(Sep 24 2021 at 14:46)</a>:</h4>
<p>and a borow of <code>v</code> (&amp;mut v)</p>



<a name="254715921"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/186049-t-compiler/wg-polonius/topic/purely%20forward%20propagation/near/254715921" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/186049-t-compiler/wg-polonius/topic/purely.20forward.20propagation.html#254715921">(Sep 24 2021 at 14:46)</a>:</h4>
<p>and the two are independent</p>



<a name="254715931"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/186049-t-compiler/wg-polonius/topic/purely%20forward%20propagation/near/254715931" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/186049-t-compiler/wg-polonius/topic/purely.20forward.20propagation.html#254715931">(Sep 24 2021 at 14:46)</a>:</h4>
<p>they come together when <code>Vec::push</code> is called</p>



<a name="254715952"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/186049-t-compiler/wg-polonius/topic/purely%20forward%20propagation/near/254715952" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/186049-t-compiler/wg-polonius/topic/purely.20forward.20propagation.html#254715952">(Sep 24 2021 at 14:46)</a>:</h4>
<p>but also, not that the call occurs through <code>tmp</code></p>



<a name="254715991"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/186049-t-compiler/wg-polonius/topic/purely%20forward%20propagation/near/254715991" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/186049-t-compiler/wg-polonius/topic/purely.20forward.20propagation.html#254715991">(Sep 24 2021 at 14:46)</a>:</h4>
<p>and yet the connection from <code>v</code> to <code>x</code> is remembered in <code>v</code></p>



<a name="254716009"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/186049-t-compiler/wg-polonius/topic/purely%20forward%20propagation/near/254716009" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/186049-t-compiler/wg-polonius/topic/purely.20forward.20propagation.html#254716009">(Sep 24 2021 at 14:47)</a>:</h4>
<p>(some variants of polonius didn't capture this)</p>



<a name="254716101"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/186049-t-compiler/wg-polonius/topic/purely%20forward%20propagation/near/254716101" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> lqd <a href="https://zulip-archive.rust-lang.org/stream/186049-t-compiler/wg-polonius/topic/purely.20forward.20propagation.html#254716101">(Sep 24 2021 at 14:47)</a>:</h4>
<p>(random note don't mind me, I thought maybe there was a clear missing because <code>Vec::len(v);</code> would read <code>Vec::len(&amp;v);</code> in regular rust)</p>



<a name="254716200"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/186049-t-compiler/wg-polonius/topic/purely%20forward%20propagation/near/254716200" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/186049-t-compiler/wg-polonius/topic/purely.20forward.20propagation.html#254716200">(Sep 24 2021 at 14:48)</a>:</h4>
<p>ah, that's true</p>



<a name="254716217"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/186049-t-compiler/wg-polonius/topic/purely%20forward%20propagation/near/254716217" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/186049-t-compiler/wg-polonius/topic/purely.20forward.20propagation.html#254716217">(Sep 24 2021 at 14:48)</a>:</h4>
<p>you could model this more precisely</p>



<a name="254716699"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/186049-t-compiler/wg-polonius/topic/purely%20forward%20propagation/near/254716699" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/186049-t-compiler/wg-polonius/topic/purely.20forward.20propagation.html#254716699">(Sep 24 2021 at 14:51)</a>:</h4>
<p>I think I'm going to give up and just add generis</p>



<a name="254716705"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/186049-t-compiler/wg-polonius/topic/purely%20forward%20propagation/near/254716705" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/186049-t-compiler/wg-polonius/topic/purely.20forward.20propagation.html#254716705">(Sep 24 2021 at 14:51)</a>:</h4>
<p>I'm going to toy with implementing this a bit</p>



<a name="254716743"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/186049-t-compiler/wg-polonius/topic/purely%20forward%20propagation/near/254716743" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/186049-t-compiler/wg-polonius/topic/purely.20forward.20propagation.html#254716743">(Sep 24 2021 at 14:51)</a>:</h4>
<p><span class="user-mention silent" data-user-id="116009">nikomatsakis</span> <a href="#narrow/stream/186049-t-compiler.2Fwg-polonius/topic/purely.20forward.20propagation/near/254716217">said</a>:</p>
<blockquote>
<p>you could model this more precisely</p>
</blockquote>
<p>I don't thik it matters though, you'd get a similar error</p>



<a name="254716753"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/186049-t-compiler/wg-polonius/topic/purely%20forward%20propagation/near/254716753" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> lqd <a href="https://zulip-archive.rust-lang.org/stream/186049-t-compiler/wg-polonius/topic/purely.20forward.20propagation.html#254716753">(Sep 24 2021 at 14:52)</a>:</h4>
<p>having the error on line e rather than g was the difference we mentioned, on the 3-point errors</p>



<a name="254716857"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/186049-t-compiler/wg-polonius/topic/purely%20forward%20propagation/near/254716857" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/186049-t-compiler/wg-polonius/topic/purely.20forward.20propagation.html#254716857">(Sep 24 2021 at 14:52)</a>:</h4>
<p>well</p>



<a name="254716876"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/186049-t-compiler/wg-polonius/topic/purely%20forward%20propagation/near/254716876" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/186049-t-compiler/wg-polonius/topic/purely.20forward.20propagation.html#254716876">(Sep 24 2021 at 14:52)</a>:</h4>
<p>I think old-style polonius would give the error at the line <code>x = ...</code></p>



<a name="254716896"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/186049-t-compiler/wg-polonius/topic/purely%20forward%20propagation/near/254716896" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/186049-t-compiler/wg-polonius/topic/purely.20forward.20propagation.html#254716896">(Sep 24 2021 at 14:52)</a>:</h4>
<p>line <code>f</code> I think it is</p>



<a name="254716922"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/186049-t-compiler/wg-polonius/topic/purely%20forward%20propagation/near/254716922" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Domenic Quirl <a href="https://zulip-archive.rust-lang.org/stream/186049-t-compiler/wg-polonius/topic/purely.20forward.20propagation.html#254716922">(Sep 24 2021 at 14:52)</a>:</h4>
<p>the thing is that both lines are necessary for the error - both not modifying the variable and not using the vec after should cause the error to go away, right?</p>



<a name="254716955"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/186049-t-compiler/wg-polonius/topic/purely%20forward%20propagation/near/254716955" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/186049-t-compiler/wg-polonius/topic/purely.20forward.20propagation.html#254716955">(Sep 24 2021 at 14:53)</a>:</h4>
<p>correct</p>



<a name="254717038"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/186049-t-compiler/wg-polonius/topic/purely%20forward%20propagation/near/254717038" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Domenic Quirl <a href="https://zulip-archive.rust-lang.org/stream/186049-t-compiler/wg-polonius/topic/purely.20forward.20propagation.html#254717038">(Sep 24 2021 at 14:53)</a>:</h4>
<p>so basically the error is "the assignment to <code>x</code> (f) is invalid, because <code>x</code> is borrowed (c) <em>and</em> that borrow is used later (through (g))"</p>



<a name="254717128"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/186049-t-compiler/wg-polonius/topic/purely%20forward%20propagation/near/254717128" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> lqd <a href="https://zulip-archive.rust-lang.org/stream/186049-t-compiler/wg-polonius/topic/purely.20forward.20propagation.html#254717128">(Sep 24 2021 at 14:54)</a>:</h4>
<p>ah right on <code>f</code> like NLLs</p>



<a name="254717177"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/186049-t-compiler/wg-polonius/topic/purely%20forward%20propagation/near/254717177" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Domenic Quirl <a href="https://zulip-archive.rust-lang.org/stream/186049-t-compiler/wg-polonius/topic/purely.20forward.20propagation.html#254717177">(Sep 24 2021 at 14:54)</a>:</h4>
<p>which means for error reporting we probably need all of this info</p>



<a name="254717885"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/186049-t-compiler/wg-polonius/topic/purely%20forward%20propagation/near/254717885" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> lqd <a href="https://zulip-archive.rust-lang.org/stream/186049-t-compiler/wg-polonius/topic/purely.20forward.20propagation.html#254717885">(Sep 24 2021 at 14:59)</a>:</h4>
<p>yeah the errors are like (using regular old-style vocabulary):</p>
<ul>
<li>where the loan is created</li>
<li>where it's invalidated</li>
<li>where it's later used</li>
</ul>



<a name="254718135"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/186049-t-compiler/wg-polonius/topic/purely%20forward%20propagation/near/254718135" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> lqd <a href="https://zulip-archive.rust-lang.org/stream/186049-t-compiler/wg-polonius/topic/purely.20forward.20propagation.html#254718135">(Sep 24 2021 at 15:00)</a>:</h4>
<p>those "landmarks" don't change, but the error point will switch from the 2nd to the 3rd</p>



<a name="254718464"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/186049-t-compiler/wg-polonius/topic/purely%20forward%20propagation/near/254718464" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Dylan MacKenzie (ecstatic-morse) <a href="https://zulip-archive.rust-lang.org/stream/186049-t-compiler/wg-polonius/topic/purely.20forward.20propagation.html#254718464">(Sep 24 2021 at 15:02)</a>:</h4>
<p>Hmm, it took me a while to wrap my head around clearing the "invalidates" relation for a variable when it's borrowed. It's clear that you have to do it, and it seems to work for loops and conditionals, but I don't have a great intuition for it.</p>



<a name="254718499"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/186049-t-compiler/wg-polonius/topic/purely%20forward%20propagation/near/254718499" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Domenic Quirl <a href="https://zulip-archive.rust-lang.org/stream/186049-t-compiler/wg-polonius/topic/purely.20forward.20propagation.html#254718499">(Sep 24 2021 at 15:02)</a>:</h4>
<p>How does error reporting work currently with non-next polonius? It doesn't seem like the algorithms collect the 3-point info from a quick look, so is that handled by <code>rustc</code>?</p>



<a name="254718580"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/186049-t-compiler/wg-polonius/topic/purely%20forward%20propagation/near/254718580" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/186049-t-compiler/wg-polonius/topic/purely.20forward.20propagation.html#254718580">(Sep 24 2021 at 15:03)</a>:</h4>
<p><span class="user-mention silent" data-user-id="118594">Dylan MacKenzie (ecstatic-morse)</span> <a href="#narrow/stream/186049-t-compiler.2Fwg-polonius/topic/purely.20forward.20propagation/near/254718464">said</a>:</p>
<blockquote>
<p>Hmm, it took me a while to wrap my head around clearing the "invalidates" relation for a variable when it's borrowed. It's clear that you have to do it, and it seems to work for loops and conditionals, but I don't have a great intuition for it.</p>
</blockquote>
<p>what do you mean by variable here? an origin?</p>



<a name="254718637"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/186049-t-compiler/wg-polonius/topic/purely%20forward%20propagation/near/254718637" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Dylan MacKenzie (ecstatic-morse) <a href="https://zulip-archive.rust-lang.org/stream/186049-t-compiler/wg-polonius/topic/purely.20forward.20propagation.html#254718637">(Sep 24 2021 at 15:03)</a>:</h4>
<p>Err, yes origin.</p>



<a name="254718674"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/186049-t-compiler/wg-polonius/topic/purely%20forward%20propagation/near/254718674" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> lqd <a href="https://zulip-archive.rust-lang.org/stream/186049-t-compiler/wg-polonius/topic/purely.20forward.20propagation.html#254718674">(Sep 24 2021 at 15:03)</a>:</h4>
<p><span class="user-mention" data-user-id="337115">@Domenic Quirl</span>  I think it's because we currently run "one and a half borrowck", and the piece of code which looks at NLL constraints to look for diagnostics takes care of that</p>



<a name="254718803"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/186049-t-compiler/wg-polonius/topic/purely%20forward%20propagation/near/254718803" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/186049-t-compiler/wg-polonius/topic/purely.20forward.20propagation.html#254718803">(Sep 24 2021 at 15:04)</a>:</h4>
<p>I think the thing is that a <code>&amp;'x foo</code> expression is kind of "short-hand" for</p>
<div class="codehilite"><pre><span></span><code>{ let tmp: &amp;&#39;x T = &amp;foo; tmp }
</code></pre></div>



<a name="254718883"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/186049-t-compiler/wg-polonius/topic/purely%20forward%20propagation/near/254718883" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/186049-t-compiler/wg-polonius/topic/purely.20forward.20propagation.html#254718883">(Sep 24 2021 at 15:04)</a>:</h4>
<p>so for the same reason it makes sense to clear origins in <code>x</code> when you do <code>x = ...</code>, you can clear origins that appear in <code>tmp</code> (and remember that we assume that no origin appears in two places)</p>



<a name="254718914"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/186049-t-compiler/wg-polonius/topic/purely%20forward%20propagation/near/254718914" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/186049-t-compiler/wg-polonius/topic/purely.20forward.20propagation.html#254718914">(Sep 24 2021 at 15:04)</a>:</h4>
<p>that is, that every variable has unique origins in its type</p>



<a name="254718953"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/186049-t-compiler/wg-polonius/topic/purely%20forward%20propagation/near/254718953" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/186049-t-compiler/wg-polonius/topic/purely.20forward.20propagation.html#254718953">(Sep 24 2021 at 15:05)</a>:</h4>
<p>the clear would be wrong otherwise</p>



<a name="254719013"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/186049-t-compiler/wg-polonius/topic/purely%20forward%20propagation/near/254719013" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Domenic Quirl <a href="https://zulip-archive.rust-lang.org/stream/186049-t-compiler/wg-polonius/topic/purely.20forward.20propagation.html#254719013">(Sep 24 2021 at 15:05)</a>:</h4>
<p><span class="user-mention silent" data-user-id="116113">lqd</span> <a href="#narrow/stream/186049-t-compiler.2Fwg-polonius/topic/purely.20forward.20propagation/near/254718674">said</a>:</p>
<blockquote>
<p><span class="user-mention silent" data-user-id="337115">Domenic Quirl</span>  I think it's because we currently run "one and a half borrowck", and the piece of code which looks at NLL constraints to look for diagnostics takes care of that</p>
</blockquote>
<p>so for the future this is something that needs to be added to Polonius or is the plan that this integration remains?</p>



<a name="254719033"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/186049-t-compiler/wg-polonius/topic/purely%20forward%20propagation/near/254719033" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Dylan MacKenzie (ecstatic-morse) <a href="https://zulip-archive.rust-lang.org/stream/186049-t-compiler/wg-polonius/topic/purely.20forward.20propagation.html#254719033">(Sep 24 2021 at 15:05)</a>:</h4>
<p>And the origin that we're clearing is in <code>tmp</code>. Yes, that makes sense.</p>



<a name="254719259"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/186049-t-compiler/wg-polonius/topic/purely%20forward%20propagation/near/254719259" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> lqd <a href="https://zulip-archive.rust-lang.org/stream/186049-t-compiler/wg-polonius/topic/purely.20forward.20propagation.html#254719259">(Sep 24 2021 at 15:06)</a>:</h4>
<p><span class="user-mention" data-user-id="337115">@Domenic Quirl</span> probably still TBD. However the facts + datalog model worked quite nicely to gather that information: it's computed as part of just executing the rules.</p>



<a name="254719366"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/186049-t-compiler/wg-polonius/topic/purely%20forward%20propagation/near/254719366" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> lqd <a href="https://zulip-archive.rust-lang.org/stream/186049-t-compiler/wg-polonius/topic/purely.20forward.20propagation.html#254719366">(Sep 24 2021 at 15:07)</a>:</h4>
<p>(à la "why is there an error here", "oh because this origin is invalidated, and used here" "why is this origin invalidated", and so on)</p>



<a name="254719401"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/186049-t-compiler/wg-polonius/topic/purely%20forward%20propagation/near/254719401" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> lqd <a href="https://zulip-archive.rust-lang.org/stream/186049-t-compiler/wg-polonius/topic/purely.20forward.20propagation.html#254719401">(Sep 24 2021 at 15:07)</a>:</h4>
<p>(this looks more like top-down execution though)</p>



<a name="254719493"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/186049-t-compiler/wg-polonius/topic/purely%20forward%20propagation/near/254719493" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Domenic Quirl <a href="https://zulip-archive.rust-lang.org/stream/186049-t-compiler/wg-polonius/topic/purely.20forward.20propagation.html#254719493">(Sep 24 2021 at 15:08)</a>:</h4>
<p>Alright</p>



<a name="254719604"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/186049-t-compiler/wg-polonius/topic/purely%20forward%20propagation/near/254719604" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Domenic Quirl <a href="https://zulip-archive.rust-lang.org/stream/186049-t-compiler/wg-polonius/topic/purely.20forward.20propagation.html#254719604">(Sep 24 2021 at 15:09)</a>:</h4>
<p>Then for the remaining time I think the most immediate I can do is the Python -&gt; Rust point as long as the test format is under construction</p>



<a name="254719775"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/186049-t-compiler/wg-polonius/topic/purely%20forward%20propagation/near/254719775" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Domenic Quirl <a href="https://zulip-archive.rust-lang.org/stream/186049-t-compiler/wg-polonius/topic/purely.20forward.20propagation.html#254719775">(Sep 24 2021 at 15:10)</a>:</h4>
<p>You mind merging my previous PR on that first?</p>



<a name="254719795"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/186049-t-compiler/wg-polonius/topic/purely%20forward%20propagation/near/254719795" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> lqd <a href="https://zulip-archive.rust-lang.org/stream/186049-t-compiler/wg-polonius/topic/purely.20forward.20propagation.html#254719795">(Sep 24 2021 at 15:10)</a>:</h4>
<p>sure</p>



<a name="254719801"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/186049-t-compiler/wg-polonius/topic/purely%20forward%20propagation/near/254719801" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Domenic Quirl <a href="https://zulip-archive.rust-lang.org/stream/186049-t-compiler/wg-polonius/topic/purely.20forward.20propagation.html#254719801">(Sep 24 2021 at 15:10)</a>:</h4>
<p>(I've kept that in sync while niko updated the rules just now, so should match)</p>



<a name="254719937"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/186049-t-compiler/wg-polonius/topic/purely%20forward%20propagation/near/254719937" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Domenic Quirl <a href="https://zulip-archive.rust-lang.org/stream/186049-t-compiler/wg-polonius/topic/purely.20forward.20propagation.html#254719937">(Sep 24 2021 at 15:11)</a>:</h4>
<p>Thanks <span aria-label="thumbs up" class="emoji emoji-1f44d" role="img" title="thumbs up">:thumbs_up:</span></p>



<a name="254719959"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/186049-t-compiler/wg-polonius/topic/purely%20forward%20propagation/near/254719959" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> lqd <a href="https://zulip-archive.rust-lang.org/stream/186049-t-compiler/wg-polonius/topic/purely.20forward.20propagation.html#254719959">(Sep 24 2021 at 15:11)</a>:</h4>
<p>np :)</p>



<a name="254728004"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/186049-t-compiler/wg-polonius/topic/purely%20forward%20propagation/near/254728004" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> lqd <a href="https://zulip-archive.rust-lang.org/stream/186049-t-compiler/wg-polonius/topic/purely.20forward.20propagation.html#254728004">(Sep 24 2021 at 16:02)</a>:</h4>
<p>it's still not super clear to me why we're expecting an error on line <code>e</code> on <code>vec-temp</code>, compared to <code>f</code> and <code>g</code></p>



<a name="254730163"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/186049-t-compiler/wg-polonius/topic/purely%20forward%20propagation/near/254730163" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/186049-t-compiler/wg-polonius/topic/purely.20forward.20propagation.html#254730163">(Sep 24 2021 at 16:15)</a>:</h4>
<p>back now</p>



<a name="254730184"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/186049-t-compiler/wg-polonius/topic/purely%20forward%20propagation/near/254730184" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/186049-t-compiler/wg-polonius/topic/purely.20forward.20propagation.html#254730184">(Sep 24 2021 at 16:15)</a>:</h4>
<p><span class="user-mention" data-user-id="116113">@lqd</span> we <em>don't</em> expect an error on line e</p>



<a name="254730205"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/186049-t-compiler/wg-polonius/topic/purely%20forward%20propagation/near/254730205" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/186049-t-compiler/wg-polonius/topic/purely.20forward.20propagation.html#254730205">(Sep 24 2021 at 16:15)</a>:</h4>
<p>the problem was that we were <em>getting</em> an error before</p>



<a name="254730483"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/186049-t-compiler/wg-polonius/topic/purely%20forward%20propagation/near/254730483" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> lqd <a href="https://zulip-archive.rust-lang.org/stream/186049-t-compiler/wg-polonius/topic/purely.20forward.20propagation.html#254730483">(Sep 24 2021 at 16:17)</a>:</h4>
<p><span aria-label="sweat smile" class="emoji emoji-1f605" role="img" title="sweat smile">:sweat_smile:</span></p>



<a name="254730693"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/186049-t-compiler/wg-polonius/topic/purely%20forward%20propagation/near/254730693" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> lqd <a href="https://zulip-archive.rust-lang.org/stream/186049-t-compiler/wg-polonius/topic/purely.20forward.20propagation.html#254730693">(Sep 24 2021 at 16:19)</a>:</h4>
<p>that was unfortunate</p>



<a name="254730788"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/186049-t-compiler/wg-polonius/topic/purely%20forward%20propagation/near/254730788" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> lqd <a href="https://zulip-archive.rust-lang.org/stream/186049-t-compiler/wg-polonius/topic/purely.20forward.20propagation.html#254730788">(Sep 24 2021 at 16:19)</a>:</h4>
<p>but it makes sense now</p>



<a name="254731375"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/186049-t-compiler/wg-polonius/topic/purely%20forward%20propagation/near/254731375" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/186049-t-compiler/wg-polonius/topic/purely.20forward.20propagation.html#254731375">(Sep 24 2021 at 16:23)</a>:</h4>
<p>sorry for the confusion</p>



<a name="254731717"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/186049-t-compiler/wg-polonius/topic/purely%20forward%20propagation/near/254731717" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> lqd <a href="https://zulip-archive.rust-lang.org/stream/186049-t-compiler/wg-polonius/topic/purely.20forward.20propagation.html#254731717">(Sep 24 2021 at 16:25)</a>:</h4>
<p>oh no worries, it also helped in trying to validate my understanding</p>



<a name="255979553"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/186049-t-compiler/wg-polonius/topic/purely%20forward%20propagation/near/255979553" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Dylan MacKenzie (ecstatic-morse) <a href="https://zulip-archive.rust-lang.org/stream/186049-t-compiler/wg-polonius/topic/purely.20forward.20propagation.html#255979553">(Oct 03 2021 at 21:02)</a>:</h4>
<p>I've been waiting until we have a functional prototype to really explore .next, but I'm curious how it would handle diamond-shaped CFGs where a loan/origin is invalidated in one branch but associated with a variable in another, and then those two branches merge back together. Something like:</p>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="kd">let</span><span class="w"> </span><span class="k">mut</span><span class="w"> </span><span class="n">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">4</span><span class="p">;</span><span class="w"></span>
<span class="kd">let</span><span class="w"> </span><span class="k">mut</span><span class="w"> </span><span class="n">p</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">&amp;</span><span class="mi">22</span><span class="p">;</span><span class="w"></span>

<span class="k">if</span><span class="w"> </span><span class="n">maybe</span><span class="p">()</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="n">p</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">&amp;</span><span class="n">x</span><span class="p">;</span><span class="w"></span>
<span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="n">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"> </span><span class="c1">// invalidate x</span>
<span class="p">}</span><span class="w"></span>

<span class="fm">dbg!</span><span class="p">(</span><span class="n">p</span><span class="p">);</span><span class="w"> </span><span class="c1">// access p (or *p?)</span>
</code></pre></div>
<p>Mostly I'm just writing this down so I don't forget.</p>



<a name="256115339"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/186049-t-compiler/wg-polonius/topic/purely%20forward%20propagation/near/256115339" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> lqd <a href="https://zulip-archive.rust-lang.org/stream/186049-t-compiler/wg-polonius/topic/purely.20forward.20propagation.html#256115339">(Oct 04 2021 at 19:12)</a>:</h4>
<p>I don't think the <code>x = 0</code> will invalidate anything here since nothing is borrowing from x ?</p>



<a name="256116121"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/186049-t-compiler/wg-polonius/topic/purely%20forward%20propagation/near/256116121" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> lqd <a href="https://zulip-archive.rust-lang.org/stream/186049-t-compiler/wg-polonius/topic/purely.20forward.20propagation.html#256116121">(Oct 04 2021 at 19:17)</a>:</h4>
<p>but that makes <a href="https://github.com/nikomatsakis/polonius.next/blob/835e060c92a52598b49add8dac130ce8608490c4/tests/vec-temp/program.txt#L19-L21">this</a> confusing vs <a href="https://github.com/nikomatsakis/polonius.next/blob/835e060c92a52598b49add8dac130ce8608490c4/src/polonius.dl#L34-L36">this</a> (but the latter was surely written prior to "loan origins")</p>



<a name="256117843"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/186049-t-compiler/wg-polonius/topic/purely%20forward%20propagation/near/256117843" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Dylan MacKenzie (ecstatic-morse) <a href="https://zulip-archive.rust-lang.org/stream/186049-t-compiler/wg-polonius/topic/purely.20forward.20propagation.html#256117843">(Oct 04 2021 at 19:29)</a>:</h4>
<p>Hmm, so you would only invalidate loans that may reach (in the CFG) the point where the invalidation occurs?</p>



<a name="256118804"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/186049-t-compiler/wg-polonius/topic/purely%20forward%20propagation/near/256118804" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> lqd <a href="https://zulip-archive.rust-lang.org/stream/186049-t-compiler/wg-polonius/topic/purely.20forward.20propagation.html#256118804">(Oct 04 2021 at 19:35)</a>:</h4>
<p>I thought so</p>



<a name="256121076"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/186049-t-compiler/wg-polonius/topic/purely%20forward%20propagation/near/256121076" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Dylan MacKenzie (ecstatic-morse) <a href="https://zulip-archive.rust-lang.org/stream/186049-t-compiler/wg-polonius/topic/purely.20forward.20propagation.html#256121076">(Oct 04 2021 at 19:50)</a>:</h4>
<p>Okay. I think that works. Could we encode that in datalog instead of making fact generation responsible? When we move things into fact generation we lose some of the clarity of thought that datalog provides.</p>



<a name="256121776"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/186049-t-compiler/wg-polonius/topic/purely%20forward%20propagation/near/256121776" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Domenic Quirl <a href="https://zulip-archive.rust-lang.org/stream/186049-t-compiler/wg-polonius/topic/purely.20forward.20propagation.html#256121776">(Oct 04 2021 at 19:54)</a>:</h4>
<p>Probably hard to do if <code>invalidate_origin</code>is part of fact generation generally?</p>



<a name="256121912"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/186049-t-compiler/wg-polonius/topic/purely%20forward%20propagation/near/256121912" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> lqd <a href="https://zulip-archive.rust-lang.org/stream/186049-t-compiler/wg-polonius/topic/purely.20forward.20propagation.html#256121912">(Oct 04 2021 at 19:55)</a>:</h4>
<p>that's a lack of clarity that I feel we have today: the thought of having a complete description of the borrowcking rules is nice and all, but in actuality it's like 50% of the problem, the other 50% are in fact generation, and the final 50% are in the surface syntax to MIR lowering pipeline (incl. desugarings, temporaries, etc) ^^</p>



<a name="256123339"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/186049-t-compiler/wg-polonius/topic/purely%20forward%20propagation/near/256123339" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Dylan MacKenzie (ecstatic-morse) <a href="https://zulip-archive.rust-lang.org/stream/186049-t-compiler/wg-polonius/topic/purely.20forward.20propagation.html#256123339">(Oct 04 2021 at 20:04)</a>:</h4>
<p><span class="user-mention silent" data-user-id="337115">Domenic Quirl</span> <a href="#narrow/stream/186049-t-compiler.2Fwg-polonius/topic/purely.20forward.20propagation/near/256121776">said</a>:</p>
<blockquote>
<p>Probably hard to do if <code>invalidate_origin</code>is part of fact generation generally?</p>
</blockquote>
<p>I don't think so, you just need to track the point at which loans originate and create a filtered version of <code>origin_invalidated</code> that only includes facts where that loan reaches the point of invalidation</p>



<a name="256126966"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/186049-t-compiler/wg-polonius/topic/purely%20forward%20propagation/near/256126966" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Domenic Quirl <a href="https://zulip-archive.rust-lang.org/stream/186049-t-compiler/wg-polonius/topic/purely.20forward.20propagation.html#256126966">(Oct 04 2021 at 20:25)</a>:</h4>
<p><span class="user-mention silent" data-user-id="118594">Dylan MacKenzie (ecstatic-morse)</span> <a href="#narrow/stream/186049-t-compiler.2Fwg-polonius/topic/purely.20forward.20propagation/near/256123339">said</a>:</p>
<blockquote>
<p><span class="user-mention silent" data-user-id="337115">Domenic Quirl</span> <a href="#narrow/stream/186049-t-compiler.2Fwg-polonius/topic/purely.20forward.20propagation/near/256121776">said</a>:</p>
<blockquote>
<p>Probably hard to do if <code>invalidate_origin</code>is part of fact generation generally?</p>
</blockquote>
<p>I don't think so, you just need to track the point at which loans originate and create a filtered version of <code>origin_invalidated</code> that only includes facts where that loan reaches the point of invalidation</p>
</blockquote>
<p>right, I meant using the "original" <code>invalidate_origin</code>. I got the mental model that CFG-based rule computations are (relatively) expensive, which this would be since it includes reachability. That's partly because I recall reading some discussion on the topic of splitting CFG nodes in on-entry and on-exit, though I'd need to find that again to remember the details. So, is this actually something we need to keep in mind or not (and does it matter if the alternative is checking the same thing during fact generation)?</p>



<a name="256128841"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/186049-t-compiler/wg-polonius/topic/purely%20forward%20propagation/near/256128841" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Domenic Quirl <a href="https://zulip-archive.rust-lang.org/stream/186049-t-compiler/wg-polonius/topic/purely.20forward.20propagation.html#256128841">(Oct 04 2021 at 20:37)</a>:</h4>
<p><span class="user-mention silent" data-user-id="116113">lqd</span> <a href="#narrow/stream/186049-t-compiler.2Fwg-polonius/topic/purely.20forward.20propagation/near/256121912">said</a>:</p>
<blockquote>
<p>that's a lack of clarity that I feel we have today: the thought of having a complete description of the borrowcking rules is nice and all, but in actuality it's like 50% of the problem, the other 50% are in fact generation, and the final 50% are in the surface syntax to MIR lowering pipeline (incl. desugarings, temporaries, etc) ^^</p>
</blockquote>
<p>I feel like the lowering is less of an issue conceptually, because it __should__ (with a lot of asterisks concerning that it doesn't actually in all cases) reflect the program that the user originally wrote. Or at least the semantics that Rust programmers are taught/learn about</p>



<a name="256129821"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/186049-t-compiler/wg-polonius/topic/purely%20forward%20propagation/near/256129821" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Dylan MacKenzie (ecstatic-morse) <a href="https://zulip-archive.rust-lang.org/stream/186049-t-compiler/wg-polonius/topic/purely.20forward.20propagation.html#256129821">(Oct 04 2021 at 20:44)</a>:</h4>
<p>CFG-based rules are currently more expensive in datalog since a) we ignore basic blocks and b) we use sparse data structures (where <code>rustc</code> uses bitsets). Neither of those are fundamental restrictions.</p>
<p>Ultimately, I hope we will end up with a "naive" version of the borrow-checker expressed as much as possible in datalog, with the fact generation layer kept very simple. Then an equivalent optimized version (likely hand-written, but possibly also in datalog if we are clever enough). I don't think moving things out of the "naive" version and into fact generation is the right approach while we're still worried about correctness. Unless the performance is so bad that running test suites becomes too onerous, but that's a high burden of proof.</p>



<a name="256130165"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/186049-t-compiler/wg-polonius/topic/purely%20forward%20propagation/near/256130165" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Dylan MacKenzie (ecstatic-morse) <a href="https://zulip-archive.rust-lang.org/stream/186049-t-compiler/wg-polonius/topic/purely.20forward.20propagation.html#256130165">(Oct 04 2021 at 20:46)</a>:</h4>
<p>Like the fact that we need to consider reachability when deciding whether a loan is invalidated or not is part of the "essence" of .next, and shouldn't be hidden away in fact generation.</p>



<a name="256130659"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/186049-t-compiler/wg-polonius/topic/purely%20forward%20propagation/near/256130659" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> lqd <a href="https://zulip-archive.rust-lang.org/stream/186049-t-compiler/wg-polonius/topic/purely.20forward.20propagation.html#256130659">(Oct 04 2021 at 20:50)</a>:</h4>
<p>the invalidations and kill rules today have the same flavour of being encoded in fact generation</p>



<a name="256131133"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/186049-t-compiler/wg-polonius/topic/purely%20forward%20propagation/near/256131133" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Domenic Quirl <a href="https://zulip-archive.rust-lang.org/stream/186049-t-compiler/wg-polonius/topic/purely.20forward.20propagation.html#256131133">(Oct 04 2021 at 20:54)</a>:</h4>
<p>I see, thanks a lot for the explanations <span class="user-mention" data-user-id="118594">@Dylan MacKenzie (ecstatic-morse)</span> <span aria-label="pray" class="emoji emoji-1f64f" role="img" title="pray">:pray:</span></p>



<a name="256131307"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/186049-t-compiler/wg-polonius/topic/purely%20forward%20propagation/near/256131307" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Domenic Quirl <a href="https://zulip-archive.rust-lang.org/stream/186049-t-compiler/wg-polonius/topic/purely.20forward.20propagation.html#256131307">(Oct 04 2021 at 20:56)</a>:</h4>
<p><span class="user-mention silent" data-user-id="118594">Dylan MacKenzie (ecstatic-morse)</span> <a href="#narrow/stream/186049-t-compiler.2Fwg-polonius/topic/purely.20forward.20propagation/near/256130165">said</a>:</p>
<blockquote>
<p>Like the fact that we need to consider reachability when deciding whether a loan is invalidated or not is part of the "essence" of .next, and shouldn't be hidden away in fact generation.</p>
</blockquote>
<p>And I definitely agree with this sentiment</p>



<a name="256131382"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/186049-t-compiler/wg-polonius/topic/purely%20forward%20propagation/near/256131382" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Dylan MacKenzie (ecstatic-morse) <a href="https://zulip-archive.rust-lang.org/stream/186049-t-compiler/wg-polonius/topic/purely.20forward.20propagation.html#256131382">(Oct 04 2021 at 20:56)</a>:</h4>
<p>I guess today's invalidation seems pretty straightforward to me (assuming I'm not missing anything). killed is more subtle, but I think it's because the underlying idea is subtle. I'm not sure how to express it better in datalog.</p>



<a name="256131779"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/186049-t-compiler/wg-polonius/topic/purely%20forward%20propagation/near/256131779" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Dylan MacKenzie (ecstatic-morse) <a href="https://zulip-archive.rust-lang.org/stream/186049-t-compiler/wg-polonius/topic/purely.20forward.20propagation.html#256131779">(Oct 04 2021 at 21:00)</a>:</h4>
<p>Okay, two phase borrows makes it not so straightforward <span aria-label="smile" class="emoji emoji-1f642" role="img" title="smile">:smile:</span></p>



<a name="256140595"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/186049-t-compiler/wg-polonius/topic/purely%20forward%20propagation/near/256140595" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> lqd <a href="https://zulip-archive.rust-lang.org/stream/186049-t-compiler/wg-polonius/topic/purely.20forward.20propagation.html#256140595">(Oct 04 2021 at 22:03)</a>:</h4>
<p>(<em>ooor</em> if we <em>do</em> generate an invalidation of <code>'L_x</code> on assignments (except when we don't want to, for optimization purposes when nothing has borrowed <code>x</code> yet), then that would mean that instead the accesses of <code>p</code> do not access <code>'L_x</code>: it's not in the type of <code>p</code>, and only the <code>'L_x &lt;: 'p</code>relation exists — and that would look pretty much like the <code>vec-temp</code> example)</p>



<a name="256393101"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/186049-t-compiler/wg-polonius/topic/purely%20forward%20propagation/near/256393101" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Domenic Quirl <a href="https://zulip-archive.rust-lang.org/stream/186049-t-compiler/wg-polonius/topic/purely.20forward.20propagation.html#256393101">(Oct 06 2021 at 11:09)</a>:</h4>
<p><span class="user-mention silent" data-user-id="116113">lqd</span> <a href="#narrow/stream/186049-t-compiler.2Fwg-polonius/topic/purely.20forward.20propagation/near/256116121">said</a>:</p>
<blockquote>
<p>but that makes <a href="https://github.com/nikomatsakis/polonius.next/blob/835e060c92a52598b49add8dac130ce8608490c4/tests/vec-temp/program.txt#L19-L21">this</a> confusing vs <a href="https://github.com/nikomatsakis/polonius.next/blob/835e060c92a52598b49add8dac130ce8608490c4/src/polonius.dl#L34-L36">this</a> (but the latter was surely written prior to "loan origins" -- edit: actually maybe not, as it mentions them explicitly, then I'm not understanding them in the same way, evidently)</p>
</blockquote>
<p>I think we could use some clarification in general on what actions constitute invalidations of which origins (regarding the comments in the <code>.dl</code> file).</p>



<a name="256393245"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/186049-t-compiler/wg-polonius/topic/purely%20forward%20propagation/near/256393245" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Domenic Quirl <a href="https://zulip-archive.rust-lang.org/stream/186049-t-compiler/wg-polonius/topic/purely.20forward.20propagation.html#256393245">(Oct 06 2021 at 11:10)</a>:</h4>
<p>I'm adding some tests, namely for the "killing and murder" example from <a href="https://hackmd.io/KpK0ICQOQLSPxIcNIlhkJQ?view#Example-killing-and-murder">this HackMD</a></p>



<a name="256393337"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/186049-t-compiler/wg-polonius/topic/purely%20forward%20propagation/near/256393337" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Domenic Quirl <a href="https://zulip-archive.rust-lang.org/stream/186049-t-compiler/wg-polonius/topic/purely.20forward.20propagation.html#256393337">(Oct 06 2021 at 11:11)</a>:</h4>
<p>to have that, I'm adding uses for both <code>x</code> and <code>y</code> after all of the pointer assignments, and randomly looked at <code>*y = 11</code> as a use of <code>y</code>.</p>



<a name="256393672"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/186049-t-compiler/wg-polonius/topic/purely%20forward%20propagation/near/256393672" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Domenic Quirl <a href="https://zulip-archive.rust-lang.org/stream/186049-t-compiler/wg-polonius/topic/purely.20forward.20propagation.html#256393672">(Oct 06 2021 at 11:15)</a>:</h4>
<p>If this is translated to facts as only a use of the associated lifetime <code>'y</code> of <code>y</code>, then the version that __shouldn't__ work, because I removed the re-assignment of <code>x</code> so <code>x</code> and <code>y</code> alias, works, because the only relation between the two is in the origin <code>'L_*x</code> from <code>y</code> borrowing <code>*x</code> (which is a subset of both <code>'x</code> and <code>'y</code> because of the "unrolling" of <code>*x</code> from <a href="https://github.com/nikomatsakis/polonius.next/blob/835e060c92a52598b49add8dac130ce8608490c4/src/polonius.dl#L52">here</a>)</p>



<a name="256393836"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/186049-t-compiler/wg-polonius/topic/purely%20forward%20propagation/near/256393836" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Domenic Quirl <a href="https://zulip-archive.rust-lang.org/stream/186049-t-compiler/wg-polonius/topic/purely.20forward.20propagation.html#256393836">(Oct 06 2021 at 11:16)</a>:</h4>
<p>The rules work out, however, if the assignment also invalidates <code>'L_*x</code>, i.e. the origin associated with the target <code>*x</code> of <code>y</code>, which gets overwritten by the assignment</p>



<a name="256394168"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/186049-t-compiler/wg-polonius/topic/purely%20forward%20propagation/near/256394168" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Domenic Quirl <a href="https://zulip-archive.rust-lang.org/stream/186049-t-compiler/wg-polonius/topic/purely.20forward.20propagation.html#256394168">(Oct 06 2021 at 11:20)</a>:</h4>
<p>Akin to our above discussion, I would file that under "fact generation magic" from the perspective of the logical rules</p>



<a name="256394300"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/186049-t-compiler/wg-polonius/topic/purely%20forward%20propagation/near/256394300" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Domenic Quirl <a href="https://zulip-archive.rust-lang.org/stream/186049-t-compiler/wg-polonius/topic/purely.20forward.20propagation.html#256394300">(Oct 06 2021 at 11:21)</a>:</h4>
<p>But maybe a part of this is that there is no notion of mutability currently in the facts, just origins, and all of the mutability distinctions are inside the fact generation comment.</p>



<a name="256394480"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/186049-t-compiler/wg-polonius/topic/purely%20forward%20propagation/near/256394480" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Domenic Quirl <a href="https://zulip-archive.rust-lang.org/stream/186049-t-compiler/wg-polonius/topic/purely.20forward.20propagation.html#256394480">(Oct 06 2021 at 11:23)</a>:</h4>
<p>Same with paths: currently everything is encoded into <code>'L_path</code></p>



<a name="256396633"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/186049-t-compiler/wg-polonius/topic/purely%20forward%20propagation/near/256396633" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Domenic Quirl <a href="https://zulip-archive.rust-lang.org/stream/186049-t-compiler/wg-polonius/topic/purely.20forward.20propagation.html#256396633">(Oct 06 2021 at 11:42)</a>:</h4>
<p><a href="https://github.com/nikomatsakis/polonius.next/pull/3">https://github.com/nikomatsakis/polonius.next/pull/3</a></p>



<a name="256396888"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/186049-t-compiler/wg-polonius/topic/purely%20forward%20propagation/near/256396888" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Domenic Quirl <a href="https://zulip-archive.rust-lang.org/stream/186049-t-compiler/wg-polonius/topic/purely.20forward.20propagation.html#256396888">(Oct 06 2021 at 11:45)</a>:</h4>
<p>Side note: this was definitely interesting and necessary to get my brain to think about a few things again <span aria-label="sweat smile" class="emoji emoji-1f605" role="img" title="sweat smile">:sweat_smile:</span></p>



<a name="256764060"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/186049-t-compiler/wg-polonius/topic/purely%20forward%20propagation/near/256764060" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Dylan MacKenzie (ecstatic-morse) <a href="https://zulip-archive.rust-lang.org/stream/186049-t-compiler/wg-polonius/topic/purely.20forward.20propagation.html#256764060">(Oct 08 2021 at 16:15)</a>:</h4>
<p>Okay, I've got one more example that I think is problematic with PFP.</p>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="k">fn</span> <span class="nf">nondet</span><span class="p">()</span><span class="w"> </span>-&gt; <span class="kt">bool</span> <span class="p">{</span><span class="w"> </span><span class="fm">todo!</span><span class="p">()</span><span class="w"> </span><span class="p">}</span><span class="w"></span>
<span class="k">fn</span> <span class="nf">main</span><span class="p">()</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="k">mut</span><span class="w"> </span><span class="n">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">42</span><span class="p">;</span><span class="w"></span>
<span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="k">mut</span><span class="w"> </span><span class="n">v</span>: <span class="nb">Vec</span><span class="o">&lt;&amp;</span><span class="k">mut</span><span class="w"> </span><span class="kt">i32</span><span class="o">&gt;</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="fm">vec!</span><span class="p">[];</span><span class="w"></span>

<span class="w">    </span><span class="k">while</span><span class="w"> </span><span class="n">nondet</span><span class="p">()</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">        </span><span class="kd">let</span><span class="w"> </span><span class="n">tmp</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">&amp;</span><span class="k">mut</span><span class="w"> </span><span class="n">x</span><span class="p">;</span><span class="w"> </span><span class="c1">// L0</span>
<span class="w">        </span><span class="n">v</span><span class="p">.</span><span class="n">push</span><span class="p">(</span><span class="n">tmp</span><span class="p">);</span><span class="w"></span>
<span class="w">    </span><span class="p">}</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>
</code></pre></div>
<p>We need to <code>clear</code> L0 immediately before it is created, otherwise loops with mutable borrows would always fail due to loans invalidating themselves. However, in the above example we <em>need</em> a loan to invalidate itself, since multiple copies may be stored in <code>v</code>.</p>



<a name="256764560"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/186049-t-compiler/wg-polonius/topic/purely%20forward%20propagation/near/256764560" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Dylan MacKenzie (ecstatic-morse) <a href="https://zulip-archive.rust-lang.org/stream/186049-t-compiler/wg-polonius/topic/purely.20forward.20propagation.html#256764560">(Oct 08 2021 at 16:18)</a>:</h4>
<p>Said another way, there's only a single CFG point in which <code>L0</code> is invalid. With liveness that was fine, because invalidation of a loan at a single point while it was part of a live origin was enough to cause a borrow error. But now we rely on propagating loan invalidation until it reaches an access of a region containing that loan, and I don't think that can happen here.</p>



<a name="256767528"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/186049-t-compiler/wg-polonius/topic/purely%20forward%20propagation/near/256767528" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> lqd <a href="https://zulip-archive.rust-lang.org/stream/186049-t-compiler/wg-polonius/topic/purely.20forward.20propagation.html#256767528">(Oct 08 2021 at 16:37)</a>:</h4>
<p><span aria-label="scream" class="emoji emoji-1f631" role="img" title="scream">:scream:</span></p>



<a name="256768612"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/186049-t-compiler/wg-polonius/topic/purely%20forward%20propagation/near/256768612" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> lqd <a href="https://zulip-archive.rust-lang.org/stream/186049-t-compiler/wg-polonius/topic/purely.20forward.20propagation.html#256768612">(Oct 08 2021 at 16:44)</a>:</h4>
<p>/me shakes fist at loops</p>



<a name="256769991"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/186049-t-compiler/wg-polonius/topic/purely%20forward%20propagation/near/256769991" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Dylan MacKenzie (ecstatic-morse) <a href="https://zulip-archive.rust-lang.org/stream/186049-t-compiler/wg-polonius/topic/purely.20forward.20propagation.html#256769991">(Oct 08 2021 at 16:55)</a>:</h4>
<p><span class="user-mention" data-user-id="116009">@nikomatsakis</span> should have a look</p>



<a name="256770112"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/186049-t-compiler/wg-polonius/topic/purely%20forward%20propagation/near/256770112" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> lqd <a href="https://zulip-archive.rust-lang.org/stream/186049-t-compiler/wg-polonius/topic/purely.20forward.20propagation.html#256770112">(Oct 08 2021 at 16:56)</a>:</h4>
<p>yes, at everything we said this week in this thread</p>



<a name="256770333"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/186049-t-compiler/wg-polonius/topic/purely%20forward%20propagation/near/256770333" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/186049-t-compiler/wg-polonius/topic/purely.20forward.20propagation.html#256770333">(Oct 08 2021 at 16:57)</a>:</h4>
<p>yeah, this is a good example. I think it's solveable, but I'll have to think about it.</p>



<a name="256770416"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/186049-t-compiler/wg-polonius/topic/purely%20forward%20propagation/near/256770416" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Domenic Quirl <a href="https://zulip-archive.rust-lang.org/stream/186049-t-compiler/wg-polonius/topic/purely.20forward.20propagation.html#256770416">(Oct 08 2021 at 16:58)</a>:</h4>
<p>We should make invalidation a topic for the sprint</p>



<a name="256770441"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/186049-t-compiler/wg-polonius/topic/purely%20forward%20propagation/near/256770441" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/186049-t-compiler/wg-polonius/topic/purely.20forward.20propagation.html#256770441">(Oct 08 2021 at 16:58)</a>:</h4>
<p>there's something missing from the model as we have it</p>



<a name="256770461"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/186049-t-compiler/wg-polonius/topic/purely%20forward%20propagation/near/256770461" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/186049-t-compiler/wg-polonius/topic/purely.20forward.20propagation.html#256770461">(Oct 08 2021 at 16:58)</a>:</h4>
<p>I haven't read the other backscroll but I'll try to look a bit alter</p>



<a name="256770484"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/186049-t-compiler/wg-polonius/topic/purely%20forward%20propagation/near/256770484" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/186049-t-compiler/wg-polonius/topic/purely.20forward.20propagation.html#256770484">(Oct 08 2021 at 16:58)</a>:</h4>
<p><span class="user-mention" data-user-id="116113">@lqd</span> btw I've been wondering if you had a wip--?</p>



<a name="256770514"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/186049-t-compiler/wg-polonius/topic/purely%20forward%20propagation/near/256770514" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/186049-t-compiler/wg-polonius/topic/purely.20forward.20propagation.html#256770514">(Oct 08 2021 at 16:58)</a>:</h4>
<p>if so, I'd say open a PR, even if it doesn't work at all</p>



<a name="256770551"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/186049-t-compiler/wg-polonius/topic/purely%20forward%20propagation/near/256770551" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Domenic Quirl <a href="https://zulip-archive.rust-lang.org/stream/186049-t-compiler/wg-polonius/topic/purely.20forward.20propagation.html#256770551">(Oct 08 2021 at 16:59)</a>:</h4>
<p>Mutability, the path/loan targets from the test PR and <span class="user-mention" data-user-id="118594">@Dylan MacKenzie (ecstatic-morse)</span>'s examples all touch invalidation</p>



<a name="256770768"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/186049-t-compiler/wg-polonius/topic/purely%20forward%20propagation/near/256770768" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> lqd <a href="https://zulip-archive.rust-lang.org/stream/186049-t-compiler/wg-polonius/topic/purely.20forward.20propagation.html#256770768">(Oct 08 2021 at 17:00)</a>:</h4>
<p>I have very little indeed, and wanted to ask more detail because it's a tad confusing, as we said in this thread</p>



<a name="256770777"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/186049-t-compiler/wg-polonius/topic/purely%20forward%20propagation/near/256770777" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> lqd <a href="https://zulip-archive.rust-lang.org/stream/186049-t-compiler/wg-polonius/topic/purely.20forward.20propagation.html#256770777">(Oct 08 2021 at 17:00)</a>:</h4>
<p>but ok</p>



<a name="256771230"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/186049-t-compiler/wg-polonius/topic/purely%20forward%20propagation/near/256771230" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> lqd <a href="https://zulip-archive.rust-lang.org/stream/186049-t-compiler/wg-polonius/topic/purely.20forward.20propagation.html#256771230">(Oct 08 2021 at 17:02)</a>:</h4>
<p>it's not gonna help much <span class="user-mention" data-user-id="116009">@nikomatsakis</span> <a href="https://github.com/nikomatsakis/polonius.next/pull/4">https://github.com/nikomatsakis/polonius.next/pull/4</a></p>



<a name="256771716"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/186049-t-compiler/wg-polonius/topic/purely%20forward%20propagation/near/256771716" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/186049-t-compiler/wg-polonius/topic/purely.20forward.20propagation.html#256771716">(Oct 08 2021 at 17:06)</a>:</h4>
<p>thanks :)</p>



<a name="256771819"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/186049-t-compiler/wg-polonius/topic/purely%20forward%20propagation/near/256771819" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> lqd <a href="https://zulip-archive.rust-lang.org/stream/186049-t-compiler/wg-polonius/topic/purely.20forward.20propagation.html#256771819">(Oct 08 2021 at 17:06)</a>:</h4>
<p>I'll keep working on it, cause it's useless rn</p>



<a name="256780575"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/186049-t-compiler/wg-polonius/topic/purely%20forward%20propagation/near/256780575" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> lqd <a href="https://zulip-archive.rust-lang.org/stream/186049-t-compiler/wg-polonius/topic/purely.20forward.20propagation.html#256780575">(Oct 08 2021 at 18:03)</a>:</h4>
<p>I was blaming loops but they're not the culprit here, right ? it's the clearing of the loan origin, which stops propagating the invalidation. and if it stops propagation, then an access immediately after that will not be an error ? e.g.</p>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="kd">let</span><span class="w"> </span><span class="k">mut</span><span class="w"> </span><span class="n">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">42</span><span class="p">;</span><span class="w"></span>
<span class="kd">let</span><span class="w"> </span><span class="n">tmp1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">&amp;</span><span class="k">mut</span><span class="w"> </span><span class="n">x</span><span class="p">;</span><span class="w"> </span><span class="c1">// invalidates and clears 'L_x</span>
<span class="kd">let</span><span class="w"> </span><span class="n">tmp2</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">&amp;</span><span class="n">x</span><span class="p">;</span><span class="w"> </span><span class="c1">// accesses non-invalidated 'L_x ???</span>
</code></pre></div>



<a name="256781238"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/186049-t-compiler/wg-polonius/topic/purely%20forward%20propagation/near/256781238" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Dylan MacKenzie (ecstatic-morse) <a href="https://zulip-archive.rust-lang.org/stream/186049-t-compiler/wg-polonius/topic/purely.20forward.20propagation.html#256781238">(Oct 08 2021 at 18:08)</a>:</h4>
<p>Those are two different loans, not the same loan</p>



<a name="256781324"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/186049-t-compiler/wg-polonius/topic/purely%20forward%20propagation/near/256781324" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Dylan MacKenzie (ecstatic-morse) <a href="https://zulip-archive.rust-lang.org/stream/186049-t-compiler/wg-polonius/topic/purely.20forward.20propagation.html#256781324">(Oct 08 2021 at 18:08)</a>:</h4>
<p>They are connected by the fact that they invalidate one another, but they're not literally the same</p>



<a name="256781394"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/186049-t-compiler/wg-polonius/topic/purely%20forward%20propagation/near/256781394" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Dylan MacKenzie (ecstatic-morse) <a href="https://zulip-archive.rust-lang.org/stream/186049-t-compiler/wg-polonius/topic/purely.20forward.20propagation.html#256781394">(Oct 08 2021 at 18:09)</a>:</h4>
<p>Does that make sense?</p>



<a name="256781788"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/186049-t-compiler/wg-polonius/topic/purely%20forward%20propagation/near/256781788" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Domenic Quirl <a href="https://zulip-archive.rust-lang.org/stream/186049-t-compiler/wg-polonius/topic/purely.20forward.20propagation.html#256781788">(Oct 08 2021 at 18:12)</a>:</h4>
<p>This would need uses for both <code>tmp</code>s to fail</p>



<a name="256781834"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/186049-t-compiler/wg-polonius/topic/purely%20forward%20propagation/near/256781834" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Domenic Quirl <a href="https://zulip-archive.rust-lang.org/stream/186049-t-compiler/wg-polonius/topic/purely.20forward.20propagation.html#256781834">(Oct 08 2021 at 18:12)</a>:</h4>
<p>also <code>'L_x</code> is not a part of <code>x</code>, so shouldn't be accessed in the <code>tmp2</code> assignment</p>



<a name="256781899"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/186049-t-compiler/wg-polonius/topic/purely%20forward%20propagation/near/256781899" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Domenic Quirl <a href="https://zulip-archive.rust-lang.org/stream/186049-t-compiler/wg-polonius/topic/purely.20forward.20propagation.html#256781899">(Oct 08 2021 at 18:13)</a>:</h4>
<p>Also, I just tried to put the original example (of today) into facts, and it _does_ error</p>



<a name="256781972"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/186049-t-compiler/wg-polonius/topic/purely%20forward%20propagation/near/256781972" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Domenic Quirl <a href="https://zulip-archive.rust-lang.org/stream/186049-t-compiler/wg-polonius/topic/purely.20forward.20propagation.html#256781972">(Oct 08 2021 at 18:13)</a>:</h4>
<p>... but it only errors because the original assignment to <code>x</code> invalidates <code>L_x</code> and that erroneously propagates <span aria-label="sweat smile" class="emoji emoji-1f605" role="img" title="sweat smile">:sweat_smile:</span></p>



<a name="256782120"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/186049-t-compiler/wg-polonius/topic/purely%20forward%20propagation/near/256782120" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Domenic Quirl <a href="https://zulip-archive.rust-lang.org/stream/186049-t-compiler/wg-polonius/topic/purely.20forward.20propagation.html#256782120">(Oct 08 2021 at 18:14)</a>:</h4>
<p>(which may be related to the "invalidating things that don't exist yet" issue)</p>



<a name="256782213"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/186049-t-compiler/wg-polonius/topic/purely%20forward%20propagation/near/256782213" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Domenic Quirl <a href="https://zulip-archive.rust-lang.org/stream/186049-t-compiler/wg-polonius/topic/purely.20forward.20propagation.html#256782213">(Oct 08 2021 at 18:15)</a>:</h4>
<p>there is a mismatch with the loop in that we have a notion of connectedness (reachability), but not one of time</p>



<a name="256782217"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/186049-t-compiler/wg-polonius/topic/purely%20forward%20propagation/near/256782217" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> lqd <a href="https://zulip-archive.rust-lang.org/stream/186049-t-compiler/wg-polonius/topic/purely.20forward.20propagation.html#256782217">(Oct 08 2021 at 18:15)</a>:</h4>
<p>fact generation is evidently not clear to me</p>



<a name="256782347"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/186049-t-compiler/wg-polonius/topic/purely%20forward%20propagation/near/256782347" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Domenic Quirl <a href="https://zulip-archive.rust-lang.org/stream/186049-t-compiler/wg-polonius/topic/purely.20forward.20propagation.html#256782347">(Oct 08 2021 at 18:16)</a>:</h4>
<p>essentially, the issue is that the lifetime of the inner reference is extended by putting it into <code>v</code>, which makes it survive until the next iteration of the loop</p>



<a name="256782439"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/186049-t-compiler/wg-polonius/topic/purely%20forward%20propagation/near/256782439" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Domenic Quirl <a href="https://zulip-archive.rust-lang.org/stream/186049-t-compiler/wg-polonius/topic/purely.20forward.20propagation.html#256782439">(Oct 08 2021 at 18:16)</a>:</h4>
<p>or, to phrase this differently, storing the reference in <code>v</code> prevents it from going out of scope at the end of its original iteration</p>



<a name="256782540"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/186049-t-compiler/wg-polonius/topic/purely%20forward%20propagation/near/256782540" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Dylan MacKenzie (ecstatic-morse) <a href="https://zulip-archive.rust-lang.org/stream/186049-t-compiler/wg-polonius/topic/purely.20forward.20propagation.html#256782540">(Oct 08 2021 at 18:17)</a>:</h4>
<p>Fixing "invalidating things that don't yet exist" solves the example I posted earlier in the week as well, right Domenic?</p>



<a name="256782690"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/186049-t-compiler/wg-polonius/topic/purely%20forward%20propagation/near/256782690" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Domenic Quirl <a href="https://zulip-archive.rust-lang.org/stream/186049-t-compiler/wg-polonius/topic/purely.20forward.20propagation.html#256782690">(Oct 08 2021 at 18:18)</a>:</h4>
<p>I think that was our hypothesis with the "diamond shape" example, yeah. I didn't look at that in fact-detail yet</p>



<a name="256782841"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/186049-t-compiler/wg-polonius/topic/purely%20forward%20propagation/near/256782841" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Domenic Quirl <a href="https://zulip-archive.rust-lang.org/stream/186049-t-compiler/wg-polonius/topic/purely.20forward.20propagation.html#256782841">(Oct 08 2021 at 18:19)</a>:</h4>
<p>But the thing is that we _want_ today's example (I've dubbed it <code>single-invalidation-loop</code>) to still error, even without invalidating unrelated loans</p>



<a name="256783165"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/186049-t-compiler/wg-polonius/topic/purely%20forward%20propagation/near/256783165" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Dylan MacKenzie (ecstatic-morse) <a href="https://zulip-archive.rust-lang.org/stream/186049-t-compiler/wg-polonius/topic/purely.20forward.20propagation.html#256783165">(Oct 08 2021 at 18:21)</a>:</h4>
<p>Yes. I think the underlying issues are separate. Filtering by reachability doesn't help with loops.</p>



<a name="256783375"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/186049-t-compiler/wg-polonius/topic/purely%20forward%20propagation/near/256783375" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Domenic Quirl <a href="https://zulip-archive.rust-lang.org/stream/186049-t-compiler/wg-polonius/topic/purely.20forward.20propagation.html#256783375">(Oct 08 2021 at 18:23)</a>:</h4>
<p><a href="/user_uploads/4715/sXYsQffv-lBZUJVrFGdJLiac/graph.dot.pdf">graph.dot.pdf</a> <br>
this is the graph without the erroneous propagation</p>



<a name="256783444"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/186049-t-compiler/wg-polonius/topic/purely%20forward%20propagation/near/256783444" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Dylan MacKenzie (ecstatic-morse) <a href="https://zulip-archive.rust-lang.org/stream/186049-t-compiler/wg-polonius/topic/purely.20forward.20propagation.html#256783444">(Oct 08 2021 at 18:23)</a>:</h4>
<p>I just want to note that our loop problem is exclusively with the <em>same</em> borrow within a cycle. Not different borrows of the same variable like in lqds example.</p>



<a name="256783589"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/186049-t-compiler/wg-polonius/topic/purely%20forward%20propagation/near/256783589" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> lqd <a href="https://zulip-archive.rust-lang.org/stream/186049-t-compiler/wg-polonius/topic/purely.20forward.20propagation.html#256783589">(Oct 08 2021 at 18:24)</a>:</h4>
<p>sure, I'll delete it to stop further confusion</p>



<a name="256783765"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/186049-t-compiler/wg-polonius/topic/purely%20forward%20propagation/near/256783765" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Dylan MacKenzie (ecstatic-morse) <a href="https://zulip-archive.rust-lang.org/stream/186049-t-compiler/wg-polonius/topic/purely.20forward.20propagation.html#256783765">(Oct 08 2021 at 18:25)</a>:</h4>
<p>No no!</p>



<a name="256783858"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/186049-t-compiler/wg-polonius/topic/purely%20forward%20propagation/near/256783858" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Dylan MacKenzie (ecstatic-morse) <a href="https://zulip-archive.rust-lang.org/stream/186049-t-compiler/wg-polonius/topic/purely.20forward.20propagation.html#256783858">(Oct 08 2021 at 18:26)</a>:</h4>
<p>It took me a while to remember that those weren't the same loan</p>



<a name="256783867"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/186049-t-compiler/wg-polonius/topic/purely%20forward%20propagation/near/256783867" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Domenic Quirl <a href="https://zulip-archive.rust-lang.org/stream/186049-t-compiler/wg-polonius/topic/purely.20forward.20propagation.html#256783867">(Oct 08 2021 at 18:26)</a>:</h4>
<p>there's two things: neither the invalidation nor <code>subset('L_x, 'v)</code> (which is derived transitively <code>'L_x -&gt;(assignment) 'p -&gt;(push) 'tmp1 -&gt;(assignment) 'v</code>) get propagated from the repeated borrow</p>



<a name="256783935"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/186049-t-compiler/wg-polonius/topic/purely%20forward%20propagation/near/256783935" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> lqd <a href="https://zulip-archive.rust-lang.org/stream/186049-t-compiler/wg-polonius/topic/purely.20forward.20propagation.html#256783935">(Oct 08 2021 at 18:27)</a>:</h4>
<p>it also took me a while</p>



<a name="256783963"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/186049-t-compiler/wg-polonius/topic/purely%20forward%20propagation/near/256783963" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> lqd <a href="https://zulip-archive.rust-lang.org/stream/186049-t-compiler/wg-polonius/topic/purely.20forward.20propagation.html#256783963">(Oct 08 2021 at 18:27)</a>:</h4>
<p>and I remembered that exact same point an hour ago</p>



<a name="256783981"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/186049-t-compiler/wg-polonius/topic/purely%20forward%20propagation/near/256783981" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Dylan MacKenzie (ecstatic-morse) <a href="https://zulip-archive.rust-lang.org/stream/186049-t-compiler/wg-polonius/topic/purely.20forward.20propagation.html#256783981">(Oct 08 2021 at 18:27)</a>:</h4>
<p>Because they're filtered by <code>clear_origin</code></p>



<a name="256783988"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/186049-t-compiler/wg-polonius/topic/purely%20forward%20propagation/near/256783988" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> lqd <a href="https://zulip-archive.rust-lang.org/stream/186049-t-compiler/wg-polonius/topic/purely.20forward.20propagation.html#256783988">(Oct 08 2021 at 18:27)</a>:</h4>
<p>and have forgotten it in the same hour</p>



<a name="256784015"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/186049-t-compiler/wg-polonius/topic/purely%20forward%20propagation/near/256784015" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Domenic Quirl <a href="https://zulip-archive.rust-lang.org/stream/186049-t-compiler/wg-polonius/topic/purely.20forward.20propagation.html#256784015">(Oct 08 2021 at 18:27)</a>:</h4>
<p><span class="user-mention silent" data-user-id="118594">Dylan MacKenzie (ecstatic-morse)</span> <a href="#narrow/stream/186049-t-compiler.2Fwg-polonius/topic/purely.20forward.20propagation/near/256783981">said</a>:</p>
<blockquote>
<p>Because they're filtered by <code>clear_origin</code></p>
</blockquote>
<p>yeah</p>



<a name="256784128"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/186049-t-compiler/wg-polonius/topic/purely%20forward%20propagation/near/256784128" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Domenic Quirl <a href="https://zulip-archive.rust-lang.org/stream/186049-t-compiler/wg-polonius/topic/purely.20forward.20propagation.html#256784128">(Oct 08 2021 at 18:28)</a>:</h4>
<p>just even if the invalidation <em>was</em> propagated, it wouldn't reach <code>v</code> and it's accesses due to subsets also being cleared</p>



<a name="256784206"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/186049-t-compiler/wg-polonius/topic/purely%20forward%20propagation/near/256784206" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Dylan MacKenzie (ecstatic-morse) <a href="https://zulip-archive.rust-lang.org/stream/186049-t-compiler/wg-polonius/topic/purely.20forward.20propagation.html#256784206">(Oct 08 2021 at 18:28)</a>:</h4>
<p>This leads me to think that we'll need two kinds of clears, one for subset and one for invalidation</p>



<a name="256784253"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/186049-t-compiler/wg-polonius/topic/purely%20forward%20propagation/near/256784253" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Domenic Quirl <a href="https://zulip-archive.rust-lang.org/stream/186049-t-compiler/wg-polonius/topic/purely.20forward.20propagation.html#256784253">(Oct 08 2021 at 18:29)</a>:</h4>
<p>grrrr... today on: will I ever learn how italics work in Zulip?: Probably no.</p>



<a name="256784278"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/186049-t-compiler/wg-polonius/topic/purely%20forward%20propagation/near/256784278" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Dylan MacKenzie (ecstatic-morse) <a href="https://zulip-archive.rust-lang.org/stream/186049-t-compiler/wg-polonius/topic/purely.20forward.20propagation.html#256784278">(Oct 08 2021 at 18:29)</a>:</h4>
<p>Assuming that the self-invalidation problem is solvable</p>



<a name="256784360"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/186049-t-compiler/wg-polonius/topic/purely%20forward%20propagation/near/256784360" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Domenic Quirl <a href="https://zulip-archive.rust-lang.org/stream/186049-t-compiler/wg-polonius/topic/purely.20forward.20propagation.html#256784360">(Oct 08 2021 at 18:29)</a>:</h4>
<p>Possible. Though only having the subsets doesn't help either ^^</p>



<a name="256784419"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/186049-t-compiler/wg-polonius/topic/purely%20forward%20propagation/near/256784419" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Domenic Quirl <a href="https://zulip-archive.rust-lang.org/stream/186049-t-compiler/wg-polonius/topic/purely.20forward.20propagation.html#256784419">(Oct 08 2021 at 18:30)</a>:</h4>
<p>I keep coming back to liveness</p>



<a name="256784519"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/186049-t-compiler/wg-polonius/topic/purely%20forward%20propagation/near/256784519" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Domenic Quirl <a href="https://zulip-archive.rust-lang.org/stream/186049-t-compiler/wg-polonius/topic/purely.20forward.20propagation.html#256784519">(Oct 08 2021 at 18:30)</a>:</h4>
<p>because the issue is that we can reach the same CFG point again while the original borrow is still live</p>



<a name="256784570"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/186049-t-compiler/wg-polonius/topic/purely%20forward%20propagation/near/256784570" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Domenic Quirl <a href="https://zulip-archive.rust-lang.org/stream/186049-t-compiler/wg-polonius/topic/purely.20forward.20propagation.html#256784570">(Oct 08 2021 at 18:31)</a>:</h4>
<p>and in a way that doesn't match lexical scopes</p>



<a name="256784579"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/186049-t-compiler/wg-polonius/topic/purely%20forward%20propagation/near/256784579" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Dylan MacKenzie (ecstatic-morse) <a href="https://zulip-archive.rust-lang.org/stream/186049-t-compiler/wg-polonius/topic/purely.20forward.20propagation.html#256784579">(Oct 08 2021 at 18:31)</a>:</h4>
<p>Yes. I'm also worried we'll end up reinventing the liveness version, but in a more convoluted way.</p>



<a name="256784709"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/186049-t-compiler/wg-polonius/topic/purely%20forward%20propagation/near/256784709" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Dylan MacKenzie (ecstatic-morse) <a href="https://zulip-archive.rust-lang.org/stream/186049-t-compiler/wg-polonius/topic/purely.20forward.20propagation.html#256784709">(Oct 08 2021 at 18:31)</a>:</h4>
<p>But still, it's good to fully explore the solution space. Maybe there's some deeper insight to be gained. And a negative result is still a result.</p>



<a name="256785041"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/186049-t-compiler/wg-polonius/topic/purely%20forward%20propagation/near/256785041" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Domenic Quirl <a href="https://zulip-archive.rust-lang.org/stream/186049-t-compiler/wg-polonius/topic/purely.20forward.20propagation.html#256785041">(Oct 08 2021 at 18:33)</a>:</h4>
<p>Gtg now, but we should definitely talk about this more next week</p>



<a name="256785163"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/186049-t-compiler/wg-polonius/topic/purely%20forward%20propagation/near/256785163" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> lqd <a href="https://zulip-archive.rust-lang.org/stream/186049-t-compiler/wg-polonius/topic/purely.20forward.20propagation.html#256785163">(Oct 08 2021 at 18:34)</a>:</h4>
<p>yeah</p>



<a name="256785191"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/186049-t-compiler/wg-polonius/topic/purely%20forward%20propagation/near/256785191" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> lqd <a href="https://zulip-archive.rust-lang.org/stream/186049-t-compiler/wg-polonius/topic/purely.20forward.20propagation.html#256785191">(Oct 08 2021 at 18:34)</a>:</h4>
<p>what should we do in the meantime though</p>



<a name="256785362"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/186049-t-compiler/wg-polonius/topic/purely%20forward%20propagation/near/256785362" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Domenic Quirl <a href="https://zulip-archive.rust-lang.org/stream/186049-t-compiler/wg-polonius/topic/purely.20forward.20propagation.html#256785362">(Oct 08 2021 at 18:35)</a>:</h4>
<p>Still do fact generation with the current rules?</p>



<a name="256785384"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/186049-t-compiler/wg-polonius/topic/purely%20forward%20propagation/near/256785384" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Domenic Quirl <a href="https://zulip-archive.rust-lang.org/stream/186049-t-compiler/wg-polonius/topic/purely.20forward.20propagation.html#256785384">(Oct 08 2021 at 18:36)</a>:</h4>
<p>(as far as we understand them)</p>



<a name="256785492"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/186049-t-compiler/wg-polonius/topic/purely%20forward%20propagation/near/256785492" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Domenic Quirl <a href="https://zulip-archive.rust-lang.org/stream/186049-t-compiler/wg-polonius/topic/purely.20forward.20propagation.html#256785492">(Oct 08 2021 at 18:36)</a>:</h4>
<p>The manual tests are really tedious and error-prone, so I think even if we just want to try some more variations fact gen would be very useful</p>



<a name="256785508"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/186049-t-compiler/wg-polonius/topic/purely%20forward%20propagation/near/256785508" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> lqd <a href="https://zulip-archive.rust-lang.org/stream/186049-t-compiler/wg-polonius/topic/purely.20forward.20propagation.html#256785508">(Oct 08 2021 at 18:36)</a>:</h4>
<p>it'll at least be easier to test these examples with some fact generation</p>



<a name="256785585"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/186049-t-compiler/wg-polonius/topic/purely%20forward%20propagation/near/256785585" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> lqd <a href="https://zulip-archive.rust-lang.org/stream/186049-t-compiler/wg-polonius/topic/purely.20forward.20propagation.html#256785585">(Oct 08 2021 at 18:37)</a>:</h4>
<p>and variations indeed, agreed</p>



<hr><p>Last updated: Apr 12 2022 at 20:01 UTC</p>
</html>