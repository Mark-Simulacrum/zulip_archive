<html>
<head><meta charset="utf-8"><title>Sprint 2021-10-15 prep · t-compiler/wg-polonius · Zulip Chat Archive</title></head>
<h2>Stream: <a href="https://zulip-archive.rust-lang.org/stream/186049-t-compiler/wg-polonius/index.html">t-compiler/wg-polonius</a></h2>
<h3>Topic: <a href="https://zulip-archive.rust-lang.org/stream/186049-t-compiler/wg-polonius/topic/Sprint.202021-10-15.20prep.html">Sprint 2021-10-15 prep</a></h3>

<hr>

<base href="https://rust-lang.zulipchat.com">

<head><link href="https://zulip-archive.rust-lang.org/style.css" rel="stylesheet"></head>

<a name="256785719"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/186049-t-compiler/wg-polonius/topic/Sprint%202021-10-15%20prep/near/256785719" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Dylan MacKenzie (ecstatic-morse) <a href="https://zulip-archive.rust-lang.org/stream/186049-t-compiler/wg-polonius/topic/Sprint.202021-10-15.20prep.html#256785719">(Oct 08 2021 at 18:38)</a>:</h4>
<p><span class="user-mention" data-user-id="116113">@lqd</span> maybe let's talk about what we can do prior to the next sprint here?</p>



<a name="256785761"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/186049-t-compiler/wg-polonius/topic/Sprint%202021-10-15%20prep/near/256785761" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> lqd <a href="https://zulip-archive.rust-lang.org/stream/186049-t-compiler/wg-polonius/topic/Sprint.202021-10-15.20prep.html#256785761">(Oct 08 2021 at 18:38)</a>:</h4>
<p>sure</p>



<a name="256785891"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/186049-t-compiler/wg-polonius/topic/Sprint%202021-10-15%20prep/near/256785891" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> lqd <a href="https://zulip-archive.rust-lang.org/stream/186049-t-compiler/wg-polonius/topic/Sprint.202021-10-15.20prep.html#256785891">(Oct 08 2021 at 18:39)</a>:</h4>
<p>emitting some useful facts would be worthwhile to have by then so I'll try my best &amp; focus on that</p>



<a name="256786153"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/186049-t-compiler/wg-polonius/topic/Sprint%202021-10-15%20prep/near/256786153" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Dylan MacKenzie (ecstatic-morse) <a href="https://zulip-archive.rust-lang.org/stream/186049-t-compiler/wg-polonius/topic/Sprint.202021-10-15.20prep.html#256786153">(Oct 08 2021 at 18:41)</a>:</h4>
<p>Also <span class="user-mention" data-user-id="337115">@Domenic Quirl</span>, what do you want to do for the next sprint (besides figuring out .next)</p>



<a name="256786223"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/186049-t-compiler/wg-polonius/topic/Sprint%202021-10-15%20prep/near/256786223" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Dylan MacKenzie (ecstatic-morse) <a href="https://zulip-archive.rust-lang.org/stream/186049-t-compiler/wg-polonius/topic/Sprint.202021-10-15.20prep.html#256786223">(Oct 08 2021 at 18:41)</a>:</h4>
<p><span class="user-mention silent" data-user-id="116113">lqd</span> <a href="#narrow/stream/186049-t-compiler.2Fwg-polonius/topic/Sprint.202021-10-15.20prep/near/256785891">said</a>:</p>
<blockquote>
<p>emitting some useful facts would be worthwhile to have by then so I'll try my best &amp; focus on that</p>
</blockquote>
<p>Okay, so fact-gen for .next. That's using Niko's frontend right?</p>



<a name="256786244"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/186049-t-compiler/wg-polonius/topic/Sprint%202021-10-15%20prep/near/256786244" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> lqd <a href="https://zulip-archive.rust-lang.org/stream/186049-t-compiler/wg-polonius/topic/Sprint.202021-10-15.20prep.html#256786244">(Oct 08 2021 at 18:42)</a>:</h4>
<p>yeah</p>



<a name="256786384"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/186049-t-compiler/wg-polonius/topic/Sprint%202021-10-15%20prep/near/256786384" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> lqd <a href="https://zulip-archive.rust-lang.org/stream/186049-t-compiler/wg-polonius/topic/Sprint.202021-10-15.20prep.html#256786384">(Oct 08 2021 at 18:43)</a>:</h4>
<p>while testing I think I saw some cases that didn't parse yet, maybe was it function call arguments</p>



<a name="256786601"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/186049-t-compiler/wg-polonius/topic/Sprint%202021-10-15%20prep/near/256786601" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Dylan MacKenzie (ecstatic-morse) <a href="https://zulip-archive.rust-lang.org/stream/186049-t-compiler/wg-polonius/topic/Sprint.202021-10-15.20prep.html#256786601">(Oct 08 2021 at 18:44)</a>:</h4>
<p>Okay, yeah that would be good. I'm kind of bummed out that we're not just using MIR for this, but there's things like two-phase borrows that make prototyping a lot harder.</p>



<a name="256786647"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/186049-t-compiler/wg-polonius/topic/Sprint%202021-10-15%20prep/near/256786647" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Dylan MacKenzie (ecstatic-morse) <a href="https://zulip-archive.rust-lang.org/stream/186049-t-compiler/wg-polonius/topic/Sprint.202021-10-15.20prep.html#256786647">(Oct 08 2021 at 18:44)</a>:</h4>
<p>In the existing <code>rustc</code> fact-generation framework I mean.</p>



<a name="256786664"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/186049-t-compiler/wg-polonius/topic/Sprint%202021-10-15%20prep/near/256786664" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> lqd <a href="https://zulip-archive.rust-lang.org/stream/186049-t-compiler/wg-polonius/topic/Sprint.202021-10-15.20prep.html#256786664">(Oct 08 2021 at 18:44)</a>:</h4>
<p>yeah</p>



<a name="256786752"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/186049-t-compiler/wg-polonius/topic/Sprint%202021-10-15%20prep/near/256786752" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Dylan MacKenzie (ecstatic-morse) <a href="https://zulip-archive.rust-lang.org/stream/186049-t-compiler/wg-polonius/topic/Sprint.202021-10-15.20prep.html#256786752">(Oct 08 2021 at 18:45)</a>:</h4>
<p>But yeah, I think that will help a lot to iterate on <code>.next</code>.</p>



<a name="256786913"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/186049-t-compiler/wg-polonius/topic/Sprint%202021-10-15%20prep/near/256786913" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> lqd <a href="https://zulip-archive.rust-lang.org/stream/186049-t-compiler/wg-polonius/topic/Sprint.202021-10-15.20prep.html#256786913">(Oct 08 2021 at 18:46)</a>:</h4>
<p>it would have been good to have fact gen in rustc, so that we're able to validate more easily, and likely find the cases you found</p>



<a name="256786969"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/186049-t-compiler/wg-polonius/topic/Sprint%202021-10-15%20prep/near/256786969" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Dylan MacKenzie (ecstatic-morse) <a href="https://zulip-archive.rust-lang.org/stream/186049-t-compiler/wg-polonius/topic/Sprint.202021-10-15.20prep.html#256786969">(Oct 08 2021 at 18:46)</a>:</h4>
<p>Souffle integration is done. I'm trying to find a package for <code>Souffle</code> that I can throw up on the web somewhere for CI.</p>



<a name="256787045"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/186049-t-compiler/wg-polonius/topic/Sprint%202021-10-15%20prep/near/256787045" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> lqd <a href="https://zulip-archive.rust-lang.org/stream/186049-t-compiler/wg-polonius/topic/Sprint.202021-10-15.20prep.html#256787045">(Oct 08 2021 at 18:47)</a>:</h4>
<p>at the same time it'd be more "annoying" to do, and you obviously didn't need the existing breadth of rustc tests to find annoying cases</p>



<a name="256787122"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/186049-t-compiler/wg-polonius/topic/Sprint%202021-10-15%20prep/near/256787122" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> lqd <a href="https://zulip-archive.rust-lang.org/stream/186049-t-compiler/wg-polonius/topic/Sprint.202021-10-15.20prep.html#256787122">(Oct 08 2021 at 18:47)</a>:</h4>
<p>do you think we want to wait for soufflé's next release so that fix their bandwidth issue ?</p>



<a name="256787200"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/186049-t-compiler/wg-polonius/topic/Sprint%202021-10-15%20prep/near/256787200" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Domenic Quirl <a href="https://zulip-archive.rust-lang.org/stream/186049-t-compiler/wg-polonius/topic/Sprint.202021-10-15.20prep.html#256787200">(Oct 08 2021 at 18:48)</a>:</h4>
<p><span class="user-mention silent" data-user-id="118594">Dylan MacKenzie (ecstatic-morse)</span> <a href="#narrow/stream/186049-t-compiler.2Fwg-polonius/topic/Sprint.202021-10-15.20prep/near/256786153">said</a>:</p>
<blockquote>
<p>Also <span class="user-mention silent" data-user-id="337115">Domenic Quirl</span>, what do you want to do for the next sprint (besides figuring out .next)</p>
</blockquote>
<p>Hm, I'm not sure <span aria-label="thinking" class="emoji emoji-1f914" role="img" title="thinking">:thinking:</span> <br>
There isn't that much more actionable <code>.next</code> stuff that I think makes sense at the moment. But it's probably also not useful to go back to normal Polonius already (which I also don't know if I could).</p>



<a name="256787242"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/186049-t-compiler/wg-polonius/topic/Sprint%202021-10-15%20prep/near/256787242" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> lqd <a href="https://zulip-archive.rust-lang.org/stream/186049-t-compiler/wg-polonius/topic/Sprint.202021-10-15.20prep.html#256787242">(Oct 08 2021 at 18:48)</a>:</h4>
<p>(I have no idea if that's expected to be soon or not, but I'd expect so, since no one can download it atm ...)</p>



<a name="256787313"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/186049-t-compiler/wg-polonius/topic/Sprint%202021-10-15%20prep/near/256787313" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Domenic Quirl <a href="https://zulip-archive.rust-lang.org/stream/186049-t-compiler/wg-polonius/topic/Sprint.202021-10-15.20prep.html#256787313">(Oct 08 2021 at 18:49)</a>:</h4>
<p>Primarily, I wanted to talk about mutability and invalidation in <code>.next</code> (before we started discussing part of that today already ^^)</p>



<a name="256787381"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/186049-t-compiler/wg-polonius/topic/Sprint%202021-10-15%20prep/near/256787381" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Dylan MacKenzie (ecstatic-morse) <a href="https://zulip-archive.rust-lang.org/stream/186049-t-compiler/wg-polonius/topic/Sprint.202021-10-15.20prep.html#256787381">(Oct 08 2021 at 18:49)</a>:</h4>
<p>Yeah, but it's nice to have a big corpus. Like, I had to think very carefully to construct that example and the diamond CFG one. It would have been much easier to just run it and see what broke, but that just shifts the work onto the person doing the prototyping (since they have to do fact generation in <code>rustc</code>), when really we should be optimizing for their efficiency.</p>



<a name="256787444"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/186049-t-compiler/wg-polonius/topic/Sprint%202021-10-15%20prep/near/256787444" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Domenic Quirl <a href="https://zulip-archive.rust-lang.org/stream/186049-t-compiler/wg-polonius/topic/Sprint.202021-10-15.20prep.html#256787444">(Oct 08 2021 at 18:50)</a>:</h4>
<p>You had a particular idea in mind?</p>



<a name="256787530"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/186049-t-compiler/wg-polonius/topic/Sprint%202021-10-15%20prep/near/256787530" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Dylan MacKenzie (ecstatic-morse) <a href="https://zulip-archive.rust-lang.org/stream/186049-t-compiler/wg-polonius/topic/Sprint.202021-10-15.20prep.html#256787530">(Oct 08 2021 at 18:50)</a>:</h4>
<p><span class="user-mention" data-user-id="337115">@Domenic Quirl</span> re: fact gen? No. I think we're doing the right thing.</p>



<a name="256787574"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/186049-t-compiler/wg-polonius/topic/Sprint%202021-10-15%20prep/near/256787574" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Domenic Quirl <a href="https://zulip-archive.rust-lang.org/stream/186049-t-compiler/wg-polonius/topic/Sprint.202021-10-15.20prep.html#256787574">(Oct 08 2021 at 18:51)</a>:</h4>
<p>Re: items for the upcoming sprint</p>



<a name="256787618"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/186049-t-compiler/wg-polonius/topic/Sprint%202021-10-15%20prep/near/256787618" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> lqd <a href="https://zulip-archive.rust-lang.org/stream/186049-t-compiler/wg-polonius/topic/Sprint.202021-10-15.20prep.html#256787618">(Oct 08 2021 at 18:51)</a>:</h4>
<p>what could be interesting domenic, since you've also worked out some manual fact generation (and I didn't have the time to review it sorry, but niko merged it already, I think I saw something I wnated to talk about, it was in some subset IIRC, no big deal) was if you wanted to write up your understanding, it could be interesting to compare our understanding</p>



<a name="256787636"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/186049-t-compiler/wg-polonius/topic/Sprint%202021-10-15%20prep/near/256787636" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Dylan MacKenzie (ecstatic-morse) <a href="https://zulip-archive.rust-lang.org/stream/186049-t-compiler/wg-polonius/topic/Sprint.202021-10-15.20prep.html#256787636">(Oct 08 2021 at 18:51)</a>:</h4>
<p><span class="user-mention" data-user-id="337115">@Domenic Quirl</span> lemme know if you wanna talk more about that stuff pre-sprint. I'm sure we'll have time during it as well.</p>



<a name="256787847"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/186049-t-compiler/wg-polonius/topic/Sprint%202021-10-15%20prep/near/256787847" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> lqd <a href="https://zulip-archive.rust-lang.org/stream/186049-t-compiler/wg-polonius/topic/Sprint.202021-10-15.20prep.html#256787847">(Oct 08 2021 at 18:53)</a>:</h4>
<p>(hopefully I'm being clear enough, I'm a bit tired :)</p>



<a name="256788066"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/186049-t-compiler/wg-polonius/topic/Sprint%202021-10-15%20prep/near/256788066" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Dylan MacKenzie (ecstatic-morse) <a href="https://zulip-archive.rust-lang.org/stream/186049-t-compiler/wg-polonius/topic/Sprint.202021-10-15.20prep.html#256788066">(Oct 08 2021 at 18:54)</a>:</h4>
<p>/me cannot be trusted to manage Zulip topics</p>



<a name="256788424"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/186049-t-compiler/wg-polonius/topic/Sprint%202021-10-15%20prep/near/256788424" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Domenic Quirl <a href="https://zulip-archive.rust-lang.org/stream/186049-t-compiler/wg-polonius/topic/Sprint.202021-10-15.20prep.html#256788424">(Oct 08 2021 at 18:56)</a>:</h4>
<p><span class="user-mention silent" data-user-id="116113">lqd</span> <a href="#narrow/stream/186049-t-compiler.2Fwg-polonius/topic/Sprint.202021-10-15.20prep/near/256787618">said</a>:</p>
<blockquote>
<p>what could be interesting domenic, since you've also worked out some manual fact generation (and I didn't have the time to review it sorry, but niko merged it already, I think I saw something I wnated to talk about, it was in some subset IIRC, no big deal) was if you wanted to write up your understanding, it could be interesting to compare our understanding</p>
</blockquote>
<p>I can try to collect something like an extended version of the explainer comment from the rules file, with my thoughts about the issues we've had so far</p>



<a name="256788550"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/186049-t-compiler/wg-polonius/topic/Sprint%202021-10-15%20prep/near/256788550" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Domenic Quirl <a href="https://zulip-archive.rust-lang.org/stream/186049-t-compiler/wg-polonius/topic/Sprint.202021-10-15.20prep.html#256788550">(Oct 08 2021 at 18:57)</a>:</h4>
<p>Was your thing, per chance, related to variance <span class="user-mention" data-user-id="116113">@lqd</span>? Cause I had to briefly stop to consider that when working on the tests</p>



<a name="256788707"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/186049-t-compiler/wg-polonius/topic/Sprint%202021-10-15%20prep/near/256788707" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> lqd <a href="https://zulip-archive.rust-lang.org/stream/186049-t-compiler/wg-polonius/topic/Sprint.202021-10-15.20prep.html#256788707">(Oct 08 2021 at 18:58)</a>:</h4>
<p>somewhat</p>



<a name="256788817"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/186049-t-compiler/wg-polonius/topic/Sprint%202021-10-15%20prep/near/256788817" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Domenic Quirl <a href="https://zulip-archive.rust-lang.org/stream/186049-t-compiler/wg-polonius/topic/Sprint.202021-10-15.20prep.html#256788817">(Oct 08 2021 at 18:59)</a>:</h4>
<p><span class="user-mention silent" data-user-id="118594">Dylan MacKenzie (ecstatic-morse)</span> <a href="#narrow/stream/186049-t-compiler.2Fwg-polonius/topic/Sprint.202021-10-15.20prep/near/256787636">said</a>:</p>
<blockquote>
<p><span class="user-mention silent" data-user-id="337115">Domenic Quirl</span> lemme know if you wanna talk more about that stuff pre-sprint. I'm sure we'll have time during it as well.</p>
</blockquote>
<p>and I should have some more time over the next week. I just need to also think about this some more myself first <span aria-label="sweat smile" class="emoji emoji-1f605" role="img" title="sweat smile">:sweat_smile:</span></p>



<a name="256788823"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/186049-t-compiler/wg-polonius/topic/Sprint%202021-10-15%20prep/near/256788823" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> lqd <a href="https://zulip-archive.rust-lang.org/stream/186049-t-compiler/wg-polonius/topic/Sprint.202021-10-15.20prep.html#256788823">(Oct 08 2021 at 18:59)</a>:</h4>
<p>but it was more of a "this fact is interesting and I'm not sure I have the same understanding about it" rather than a fully formed argument about something being wrong</p>



<a name="256789232"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/186049-t-compiler/wg-polonius/topic/Sprint%202021-10-15%20prep/near/256789232" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Domenic Quirl <a href="https://zulip-archive.rust-lang.org/stream/186049-t-compiler/wg-polonius/topic/Sprint.202021-10-15.20prep.html#256789232">(Oct 08 2021 at 19:01)</a>:</h4>
<p>There is also some amount of inconsistency in how consequently facts are applied in the manual ones at the moment, particularly for "simple" assignments. Maybe also which version of fact generation we're thinking about while writing them (i.e., how smart it is)</p>



<a name="256789316"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/186049-t-compiler/wg-polonius/topic/Sprint%202021-10-15%20prep/near/256789316" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> lqd <a href="https://zulip-archive.rust-lang.org/stream/186049-t-compiler/wg-polonius/topic/Sprint.202021-10-15.20prep.html#256789316">(Oct 08 2021 at 19:02)</a>:</h4>
<p>very true</p>



<a name="256789477"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/186049-t-compiler/wg-polonius/topic/Sprint%202021-10-15%20prep/near/256789477" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> lqd <a href="https://zulip-archive.rust-lang.org/stream/186049-t-compiler/wg-polonius/topic/Sprint.202021-10-15.20prep.html#256789477">(Oct 08 2021 at 19:03)</a>:</h4>
<p>that makes reverse engineering that (including adapting them over the AST shape) into rules slightly more confusing to me ^^</p>



<a name="257044338"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/186049-t-compiler/wg-polonius/topic/Sprint%202021-10-15%20prep/near/257044338" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Domenic Quirl <a href="https://zulip-archive.rust-lang.org/stream/186049-t-compiler/wg-polonius/topic/Sprint.202021-10-15.20prep.html#257044338">(Oct 11 2021 at 10:37)</a>:</h4>
<p>Following our discussions, I've added a section about fact generation to the PFP HackMD <a href="https://hackmd.io/KpK0ICQOQLSPxIcNIlhkJQ?view#Fact-Generation">here</a>. It turned out as less of a definitive declaration of my personal version of the fact generator from hand-writing the tests, and more of an extended summary of the status quo with additional examples, to which I then added sections for open questions and the as-of-yet problematic examples we (Dylan) has discovered plus what we've found out and discussed about them. I think this fits better, since while I made some assumptions while writing the manual facts, I'm not confident they are <em>correct</em>. Or, maybe, rather that there even is something objectively correct right now for all of them, since which facts we need will depend on how we solve the open problems and where we land with fact generation vs. derivation directly in the rules.</p>



<a name="257044677"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/186049-t-compiler/wg-polonius/topic/Sprint%202021-10-15%20prep/near/257044677" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Domenic Quirl <a href="https://zulip-archive.rust-lang.org/stream/186049-t-compiler/wg-polonius/topic/Sprint.202021-10-15.20prep.html#257044677">(Oct 11 2021 at 10:40)</a>:</h4>
<p>One thing I had some trouble with was understanding what exactly is the thought process behind <a href="https://github.com/nikomatsakis/polonius.next/blob/d91f1608b4f0b5c63183c9aa5c34a0d89bf4d2b1/src/polonius.dl#L37-L40">these additional clears</a> in Niko's comment. I've made up some annotated code samples which hopefully explain my confusion under "Clearing Origins"</p>



<a name="257053663"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/186049-t-compiler/wg-polonius/topic/Sprint%202021-10-15%20prep/near/257053663" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> lqd <a href="https://zulip-archive.rust-lang.org/stream/186049-t-compiler/wg-polonius/topic/Sprint.202021-10-15.20prep.html#257053663">(Oct 11 2021 at 12:01)</a>:</h4>
<p>(in the meantime I also made quite a bit of progress on it)</p>



<a name="257212439"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/186049-t-compiler/wg-polonius/topic/Sprint%202021-10-15%20prep/near/257212439" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Domenic Quirl <a href="https://zulip-archive.rust-lang.org/stream/186049-t-compiler/wg-polonius/topic/Sprint.202021-10-15.20prep.html#257212439">(Oct 12 2021 at 14:31)</a>:</h4>
<p><span class="user-mention" data-user-id="116113">@lqd</span> we can also discuss the unrolling rules here if you want. Maybe you can explain some more <em>why</em> the resulting facts look off to you?</p>



<a name="257214495"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/186049-t-compiler/wg-polonius/topic/Sprint%202021-10-15%20prep/near/257214495" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> lqd <a href="https://zulip-archive.rust-lang.org/stream/186049-t-compiler/wg-polonius/topic/Sprint.202021-10-15.20prep.html#257214495">(Oct 12 2021 at 14:43)</a>:</h4>
<p>On my phone rn but the gist was: if you’re borrowing from x then x must outlive the reference, and these facts say the opposite IIRC ?</p>



<a name="257223908"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/186049-t-compiler/wg-polonius/topic/Sprint%202021-10-15%20prep/near/257223908" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Domenic Quirl <a href="https://zulip-archive.rust-lang.org/stream/186049-t-compiler/wg-polonius/topic/Sprint.202021-10-15.20prep.html#257223908">(Oct 12 2021 at 15:41)</a>:</h4>
<p>Hm, maybe we should think about this less from a liveness angle and more from that of invalidation. If I modify <code>*x</code> through <code>y</code>, then that invalidates <code>x</code>. Admittedly, this seems related to when/how we clear origins, which as you can tell from my notes has caused some confusion on my side</p>



<a name="257228009"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/186049-t-compiler/wg-polonius/topic/Sprint%202021-10-15%20prep/near/257228009" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> lqd <a href="https://zulip-archive.rust-lang.org/stream/186049-t-compiler/wg-polonius/topic/Sprint.202021-10-15.20prep.html#257228009">(Oct 12 2021 at 16:06)</a>:</h4>
<p>I have not read those yet unfortunately but clearing and invalidations are indeed confusing :) (but my point wasn't related to liveness per se)</p>



<a name="257230123"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/186049-t-compiler/wg-polonius/topic/Sprint%202021-10-15%20prep/near/257230123" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> lqd <a href="https://zulip-archive.rust-lang.org/stream/186049-t-compiler/wg-polonius/topic/Sprint.202021-10-15.20prep.html#257230123">(Oct 12 2021 at 16:19)</a>:</h4>
<p>I think the thought process behind these clears is that some writes differ in how they impact each loan</p>



<a name="257230362"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/186049-t-compiler/wg-polonius/topic/Sprint%202021-10-15%20prep/near/257230362" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> lqd <a href="https://zulip-archive.rust-lang.org/stream/186049-t-compiler/wg-polonius/topic/Sprint.202021-10-15.20prep.html#257230362">(Oct 12 2021 at 16:20)</a>:</h4>
<p>in particular changing what something points is equivalent to borrowing the new memory, and not invalidating the old memory</p>



<a name="257230472"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/186049-t-compiler/wg-polonius/topic/Sprint%202021-10-15%20prep/near/257230472" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> lqd <a href="https://zulip-archive.rust-lang.org/stream/186049-t-compiler/wg-polonius/topic/Sprint.202021-10-15.20prep.html#257230472">(Oct 12 2021 at 16:21)</a>:</h4>
<p>recreating the loan via the clear, rather than invalidating the loan as that would cause errors if accessed</p>



<a name="257230951"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/186049-t-compiler/wg-polonius/topic/Sprint%202021-10-15%20prep/near/257230951" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Domenic Quirl <a href="https://zulip-archive.rust-lang.org/stream/186049-t-compiler/wg-polonius/topic/Sprint.202021-10-15.20prep.html#257230951">(Oct 12 2021 at 16:24)</a>:</h4>
<p>I understand the underlying motivation. What confuses me is how this is currently reflected in the fact generation "instructions"</p>



<a name="257231000"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/186049-t-compiler/wg-polonius/topic/Sprint%202021-10-15%20prep/near/257231000" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> lqd <a href="https://zulip-archive.rust-lang.org/stream/186049-t-compiler/wg-polonius/topic/Sprint.202021-10-15.20prep.html#257231000">(Oct 12 2021 at 16:25)</a>:</h4>
<p>btw, I don't know about you, but I think the subjects are complex enough, and confusions easy to happen here -- with multiple people and topics in flight at the same time, that I'd offer we do some call (voice,  no need for camera, unrecorded) during the sprint so that we have a higher bandwidth communication channel for at least a little while</p>



<a name="257231274"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/186049-t-compiler/wg-polonius/topic/Sprint%202021-10-15%20prep/near/257231274" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> lqd <a href="https://zulip-archive.rust-lang.org/stream/186049-t-compiler/wg-polonius/topic/Sprint.202021-10-15.20prep.html#257231274">(Oct 12 2021 at 16:26)</a>:</h4>
<p>something like "if there's a loan on *temp and a write to temp, then we clear the origin of the first loan" ?</p>



<a name="257231342"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/186049-t-compiler/wg-polonius/topic/Sprint%202021-10-15%20prep/near/257231342" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Domenic Quirl <a href="https://zulip-archive.rust-lang.org/stream/186049-t-compiler/wg-polonius/topic/Sprint.202021-10-15.20prep.html#257231342">(Oct 12 2021 at 16:27)</a>:</h4>
<p>In particular, if a different write invalidates a loan (e.g., a write to the original variable, as in the first "Question" example), then this is still an error, even if a potentially overlapping borrow is re-assigned in-between</p>



<a name="257231426"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/186049-t-compiler/wg-polonius/topic/Sprint%202021-10-15%20prep/near/257231426" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Domenic Quirl <a href="https://zulip-archive.rust-lang.org/stream/186049-t-compiler/wg-polonius/topic/Sprint.202021-10-15.20prep.html#257231426">(Oct 12 2021 at 16:27)</a>:</h4>
<p>That should not be an invalidation, but a clear could mask other potential errors that do not arise from the re-assigned borrow</p>



<a name="257231696"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/186049-t-compiler/wg-polonius/topic/Sprint%202021-10-15%20prep/near/257231696" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> lqd <a href="https://zulip-archive.rust-lang.org/stream/186049-t-compiler/wg-polonius/topic/Sprint.202021-10-15.20prep.html#257231696">(Oct 12 2021 at 16:29)</a>:</h4>
<p>I think it'll be good to read through your examples on friday, all of us together, walk through them and explain how we'd generate the facts for them</p>



<a name="257231721"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/186049-t-compiler/wg-polonius/topic/Sprint%202021-10-15%20prep/near/257231721" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Domenic Quirl <a href="https://zulip-archive.rust-lang.org/stream/186049-t-compiler/wg-polonius/topic/Sprint.202021-10-15.20prep.html#257231721">(Oct 12 2021 at 16:29)</a>:</h4>
<p>Also, using a re-assigned overlapping borrow does not reference the original origin, so should not invalidate it</p>



<a name="257231770"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/186049-t-compiler/wg-polonius/topic/Sprint%202021-10-15%20prep/near/257231770" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Domenic Quirl <a href="https://zulip-archive.rust-lang.org/stream/186049-t-compiler/wg-polonius/topic/Sprint.202021-10-15.20prep.html#257231770">(Oct 12 2021 at 16:29)</a>:</h4>
<p>and any invalidation that happens <em>later</em> is not impacted by the clear</p>



<a name="257231925"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/186049-t-compiler/wg-polonius/topic/Sprint%202021-10-15%20prep/near/257231925" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Domenic Quirl <a href="https://zulip-archive.rust-lang.org/stream/186049-t-compiler/wg-polonius/topic/Sprint.202021-10-15.20prep.html#257231925">(Oct 12 2021 at 16:30)</a>:</h4>
<p><span class="user-mention silent" data-user-id="116113">lqd</span> <a href="#narrow/stream/186049-t-compiler.2Fwg-polonius/topic/Sprint.202021-10-15.20prep/near/257231000">said</a>:</p>
<blockquote>
<p>btw, I don't know about you, but I think the subjects are complex enough, and confusions easy to happen here -- with multiple people and topics in flight at the same time, that I'd offer we do some call (voice,  no need for camera, unrecorded) during the sprint so that we have a higher bandwidth communication channel for at least a little while</p>
</blockquote>
<p>I agree that this would be beneficial, and I'd be happy to attend such a call</p>



<a name="257232227"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/186049-t-compiler/wg-polonius/topic/Sprint%202021-10-15%20prep/near/257232227" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> lqd <a href="https://zulip-archive.rust-lang.org/stream/186049-t-compiler/wg-polonius/topic/Sprint.202021-10-15.20prep.html#257232227">(Oct 12 2021 at 16:32)</a>:</h4>
<p>which example are you referring to when you mention overlapping borrows ?</p>



<a name="257232305"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/186049-t-compiler/wg-polonius/topic/Sprint%202021-10-15%20prep/near/257232305" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> lqd <a href="https://zulip-archive.rust-lang.org/stream/186049-t-compiler/wg-polonius/topic/Sprint.202021-10-15.20prep.html#257232305">(Oct 12 2021 at 16:32)</a>:</h4>
<p>the "Is it correct?" one ?</p>



<a name="257232334"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/186049-t-compiler/wg-polonius/topic/Sprint%202021-10-15%20prep/near/257232334" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> lqd <a href="https://zulip-archive.rust-lang.org/stream/186049-t-compiler/wg-polonius/topic/Sprint.202021-10-15.20prep.html#257232334">(Oct 12 2021 at 16:33)</a>:</h4>
<p>from <a href="https://hackmd.io/KpK0ICQOQLSPxIcNIlhkJQ?view#Questions1">https://hackmd.io/KpK0ICQOQLSPxIcNIlhkJQ?view#Questions1</a> ?</p>



<a name="257232396"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/186049-t-compiler/wg-polonius/topic/Sprint%202021-10-15%20prep/near/257232396" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Domenic Quirl <a href="https://zulip-archive.rust-lang.org/stream/186049-t-compiler/wg-polonius/topic/Sprint.202021-10-15.20prep.html#257232396">(Oct 12 2021 at 16:33)</a>:</h4>
<p>Either (of the "clearing origins" ones). They all have a <code>temp</code> borrow which is later re-assigned, and a second borrow which goes through <code>*temp</code></p>



<a name="257232459"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/186049-t-compiler/wg-polonius/topic/Sprint%202021-10-15%20prep/near/257232459" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Domenic Quirl <a href="https://zulip-archive.rust-lang.org/stream/186049-t-compiler/wg-polonius/topic/Sprint.202021-10-15.20prep.html#257232459">(Oct 12 2021 at 16:34)</a>:</h4>
<p><span class="user-mention silent" data-user-id="116113">lqd</span> <a href="#narrow/stream/186049-t-compiler.2Fwg-polonius/topic/Sprint.202021-10-15.20prep/near/257232334">said</a>:</p>
<blockquote>
<p>from <a href="https://hackmd.io/KpK0ICQOQLSPxIcNIlhkJQ?view#Questions1">https://hackmd.io/KpK0ICQOQLSPxIcNIlhkJQ?view#Questions1</a> ?</p>
</blockquote>
<p>it is this section, yes</p>



<a name="257232753"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/186049-t-compiler/wg-polonius/topic/Sprint%202021-10-15%20prep/near/257232753" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> lqd <a href="https://zulip-archive.rust-lang.org/stream/186049-t-compiler/wg-polonius/topic/Sprint.202021-10-15.20prep.html#257232753">(Oct 12 2021 at 16:35)</a>:</h4>
<p>I did wonder if there were parts of fact gen (or prior) that would emit errors (in addition to the ones computed by the datalog rules) in some of these cases heh</p>



<a name="257233241"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/186049-t-compiler/wg-polonius/topic/Sprint%202021-10-15%20prep/near/257233241" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Domenic Quirl <a href="https://zulip-archive.rust-lang.org/stream/186049-t-compiler/wg-polonius/topic/Sprint.202021-10-15.20prep.html#257233241">(Oct 12 2021 at 16:38)</a>:</h4>
<p>seems like in addition to rules vs. fact gen vs. lowerings we now also have analyses in rustc <span aria-label="sweat smile" class="emoji emoji-1f605" role="img" title="sweat smile">:sweat_smile:</span></p>



<a name="257233394"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/186049-t-compiler/wg-polonius/topic/Sprint%202021-10-15%20prep/near/257233394" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Domenic Quirl <a href="https://zulip-archive.rust-lang.org/stream/186049-t-compiler/wg-polonius/topic/Sprint.202021-10-15.20prep.html#257233394">(Oct 12 2021 at 16:39)</a>:</h4>
<p>Though my point is that the case that should error would probably error without the extra clear</p>



<a name="257252919"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/186049-t-compiler/wg-polonius/topic/Sprint%202021-10-15%20prep/near/257252919" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Dylan MacKenzie (ecstatic-morse) <a href="https://zulip-archive.rust-lang.org/stream/186049-t-compiler/wg-polonius/topic/Sprint.202021-10-15.20prep.html#257252919">(Oct 12 2021 at 18:49)</a>:</h4>
<p><span class="user-mention" data-user-id="337115">@Domenic Quirl</span> I had time to look at some of your examples. I think you're right that the rules are currently incomplete. I'm wondering if the correct place to handle derefs is not in <code>loan_invalidated</code>, but in <code>origin_accessed</code>? Specifically, a deref of a reference is not only an access of the origin associated  with that reference but also of all origins reachable from it in the <code>subset</code> graph?</p>



<a name="257254088"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/186049-t-compiler/wg-polonius/topic/Sprint%202021-10-15%20prep/near/257254088" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Dylan MacKenzie (ecstatic-morse) <a href="https://zulip-archive.rust-lang.org/stream/186049-t-compiler/wg-polonius/topic/Sprint.202021-10-15.20prep.html#257254088">(Oct 12 2021 at 18:57)</a>:</h4>
<p>That doesn't fix one of your latter examples, though, the one about clearing origins, since when <code>L_*temp</code> is cleared, it breaks the connection in the <code>subset</code> graph. Hm.</p>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="kd">let</span><span class="w"> </span><span class="k">mut</span><span class="w"> </span><span class="n">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">42</span><span class="p">;</span><span class="w"></span>
<span class="kd">let</span><span class="w"> </span><span class="k">mut</span><span class="w"> </span><span class="n">y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">22</span><span class="p">;</span><span class="w"></span>
<span class="kd">let</span><span class="w"> </span><span class="k">mut</span><span class="w"> </span><span class="n">temp</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">&amp;</span><span class="k">mut</span><span class="w"> </span><span class="n">x</span><span class="p">;</span><span class="w"> </span><span class="c1">// &amp;'L_x mut x</span>
<span class="kd">let</span><span class="w"> </span><span class="n">p</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">&amp;</span><span class="k">mut</span><span class="w"> </span><span class="o">*</span><span class="n">temp</span><span class="p">;</span><span class="w"> </span><span class="c1">// &amp;'L_*temp mut *temp == &amp;mut x: double mut borrow of `x`</span>
<span class="n">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">11</span><span class="p">;</span><span class="w"> </span><span class="c1">// Invalidates both borrows</span>
<span class="n">temp</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">&amp;</span><span class="k">mut</span><span class="w"> </span><span class="n">y</span><span class="p">;</span><span class="w"> </span><span class="c1">// No use of `*temp` while referencing `x` (good).</span>
<span class="w">               </span><span class="c1">// But clears 'L_*temp???</span>
<span class="o">*</span><span class="n">p</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">33</span><span class="p">;</span><span class="w"> </span><span class="c1">// Should be ERROR, but invalidation of 'L_*temp is not propagated</span>
<span class="w">         </span><span class="c1">// to here because it is cleared above.</span>
</code></pre></div>



<a name="257254340"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/186049-t-compiler/wg-polonius/topic/Sprint%202021-10-15%20prep/near/257254340" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Domenic Quirl <a href="https://zulip-archive.rust-lang.org/stream/186049-t-compiler/wg-polonius/topic/Sprint.202021-10-15.20prep.html#257254340">(Oct 12 2021 at 18:59)</a>:</h4>
<p>One of my primary problems with how things are at the moment is that I think it actually <em>is</em> important to have some of the invalidations, but in a way that requires a lot of info of both</p>
<ul>
<li>what the original path of a borrow is (i.e., the <code>*(*x).0</code> in a <code>&amp;'L *(*x).0</code>), and</li>
<li>what the underlying memory/original data is (i.e., whatever is borrowed in <code>*x.0</code>.<br>
possibly across time.</li>
</ul>
<p>The former is because if something in that path changes, then future operations on it don't affect the borrow that went through it. The latter is because modifications to the underlying memory <em>will</em> do that, even if e.g. a source variable that currently owns the memory is not lexically mentioned in the path.</p>



<a name="257254418"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/186049-t-compiler/wg-polonius/topic/Sprint%202021-10-15%20prep/near/257254418" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Domenic Quirl <a href="https://zulip-archive.rust-lang.org/stream/186049-t-compiler/wg-polonius/topic/Sprint.202021-10-15.20prep.html#257254418">(Oct 12 2021 at 18:59)</a>:</h4>
<p>(I'm explicitly not talking about whether this info comes from fact generation or rules for now)</p>



<a name="257254704"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/186049-t-compiler/wg-polonius/topic/Sprint%202021-10-15%20prep/near/257254704" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Dylan MacKenzie (ecstatic-morse) <a href="https://zulip-archive.rust-lang.org/stream/186049-t-compiler/wg-polonius/topic/Sprint.202021-10-15.20prep.html#257254704">(Oct 12 2021 at 19:01)</a>:</h4>
<p>This is problematic:</p>
<blockquote>
<p>what the underlying memory/original data is (i.e., whatever is borrowed in *x.0.<br>
possibly across time.</p>
</blockquote>



<a name="257254747"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/186049-t-compiler/wg-polonius/topic/Sprint%202021-10-15%20prep/near/257254747" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Dylan MacKenzie (ecstatic-morse) <a href="https://zulip-archive.rust-lang.org/stream/186049-t-compiler/wg-polonius/topic/Sprint.202021-10-15.20prep.html#257254747">(Oct 12 2021 at 19:01)</a>:</h4>
<p>at least if it comes from fact generation</p>



<a name="257255009"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/186049-t-compiler/wg-polonius/topic/Sprint%202021-10-15%20prep/near/257255009" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Dylan MacKenzie (ecstatic-morse) <a href="https://zulip-archive.rust-lang.org/stream/186049-t-compiler/wg-polonius/topic/Sprint.202021-10-15.20prep.html#257255009">(Oct 12 2021 at 19:03)</a>:</h4>
<p>The point of Polonius is basically to compute that, so if we need it as an input, we've already lost.</p>



<a name="257255099"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/186049-t-compiler/wg-polonius/topic/Sprint%202021-10-15%20prep/near/257255099" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Domenic Quirl <a href="https://zulip-archive.rust-lang.org/stream/186049-t-compiler/wg-polonius/topic/Sprint.202021-10-15.20prep.html#257255099">(Oct 12 2021 at 19:03)</a>:</h4>
<p>The thing is the situation that the (currently confusing) clear rules are for does exist, so you can't simply emit invalidation facts for all origins <code>'L_path</code> wherever <code>path</code> is used, as it may have been re-assigned in between.</p>



<a name="257255326"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/186049-t-compiler/wg-polonius/topic/Sprint%202021-10-15%20prep/near/257255326" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Domenic Quirl <a href="https://zulip-archive.rust-lang.org/stream/186049-t-compiler/wg-polonius/topic/Sprint.202021-10-15.20prep.html#257255326">(Oct 12 2021 at 19:05)</a>:</h4>
<p>Let me look at your example variation</p>



<a name="257255459"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/186049-t-compiler/wg-polonius/topic/Sprint%202021-10-15%20prep/near/257255459" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Dylan MacKenzie (ecstatic-morse) <a href="https://zulip-archive.rust-lang.org/stream/186049-t-compiler/wg-polonius/topic/Sprint.202021-10-15.20prep.html#257255459">(Oct 12 2021 at 19:06)</a>:</h4>
<p>By "emit invalidation facts", you mean you have to stop propagating them at some point? Or you literally cannot emit the initial <code>loan_invalidated_at</code> input fact? (Sorry, I'm a bit confused)</p>



<a name="257255499"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/186049-t-compiler/wg-polonius/topic/Sprint%202021-10-15%20prep/near/257255499" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Domenic Quirl <a href="https://zulip-archive.rust-lang.org/stream/186049-t-compiler/wg-polonius/topic/Sprint.202021-10-15.20prep.html#257255499">(Oct 12 2021 at 19:06)</a>:</h4>
<p>Sorry <span aria-label="sweat smile" class="emoji emoji-1f605" role="img" title="sweat smile">:sweat_smile:</span></p>



<a name="257255613"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/186049-t-compiler/wg-polonius/topic/Sprint%202021-10-15%20prep/near/257255613" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> lqd <a href="https://zulip-archive.rust-lang.org/stream/186049-t-compiler/wg-polonius/topic/Sprint.202021-10-15.20prep.html#257255613">(Oct 12 2021 at 19:07)</a>:</h4>
<p>I understood it as "we can't emit invalidate_origin for each loan present somewhere in the program"</p>



<a name="257255761"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/186049-t-compiler/wg-polonius/topic/Sprint%202021-10-15%20prep/near/257255761" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Domenic Quirl <a href="https://zulip-archive.rust-lang.org/stream/186049-t-compiler/wg-polonius/topic/Sprint.202021-10-15.20prep.html#257255761">(Oct 12 2021 at 19:08)</a>:</h4>
<p><span class="user-mention silent" data-user-id="118594">Dylan MacKenzie (ecstatic-morse)</span> <a href="#narrow/stream/186049-t-compiler.2Fwg-polonius/topic/Sprint.202021-10-15.20prep/near/257255459">said</a>:</p>
<blockquote>
<p>By "emit invalidation facts", you mean you have to stop propagating them at some point? Or you literally cannot emit the initial <code>loan_invalidated_at</code> input fact? (Sorry, I'm a bit confused)</p>
</blockquote>
<p>I meant emitting them, with the caveat that this is under the assumption that the fact generation is responsible here. That is to say you could theoretically also try to emit them and then filter them in the logical rules. Let's just say it would be incorrect for it to result in an observable invalidation effect</p>



<a name="257256374"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/186049-t-compiler/wg-polonius/topic/Sprint%202021-10-15%20prep/near/257256374" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Domenic Quirl <a href="https://zulip-archive.rust-lang.org/stream/186049-t-compiler/wg-polonius/topic/Sprint.202021-10-15.20prep.html#257256374">(Oct 12 2021 at 19:12)</a>:</h4>
<p><span class="user-mention silent" data-user-id="118594">Dylan MacKenzie (ecstatic-morse)</span> <a href="#narrow/stream/186049-t-compiler.2Fwg-polonius/topic/Sprint.202021-10-15.20prep/near/257252919">said</a>:</p>
<blockquote>
<p><span class="user-mention silent" data-user-id="337115">Domenic Quirl</span> I had time to look at some of your examples. I think you're right that the rules are currently incomplete. I'm wondering if the correct place to handle derefs is not in <code>loan_invalidated</code>, but in <code>origin_accessed</code>? Specifically, a deref of a reference is not only an access of the origin associated  with that reference but also of all origins reachable from it in the <code>subset</code> graph?</p>
</blockquote>
<p>So here, removing the connection is <em>correct</em> in the sense that, after the re-assignment, the two borrows are unrelated.</p>
<p>In theory, the propagation through the subset graph should be the same as currently I think - either you propagate invalidation and then it doesn't matter which of the related origins you access, or you propagate accesses, and then it doesn't matter which origin you invalidate :D</p>



<a name="257258860"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/186049-t-compiler/wg-polonius/topic/Sprint%202021-10-15%20prep/near/257258860" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Dylan MacKenzie (ecstatic-morse) <a href="https://zulip-archive.rust-lang.org/stream/186049-t-compiler/wg-polonius/topic/Sprint.202021-10-15.20prep.html#257258860">(Oct 12 2021 at 19:29)</a>:</h4>
<p>Hmm, I guess part of my idea is that it would become easier to separate one kind of "clear", the one that happen when a variable with that origin is overwritten, with the other kind, one that happens when the target of a deref in a reborrow is overwritten. Thinking about it more, I don't see how that division actually solves the problems we're having.</p>



<a name="257259096"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/186049-t-compiler/wg-polonius/topic/Sprint%202021-10-15%20prep/near/257259096" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Dylan MacKenzie (ecstatic-morse) <a href="https://zulip-archive.rust-lang.org/stream/186049-t-compiler/wg-polonius/topic/Sprint.202021-10-15.20prep.html#257259096">(Oct 12 2021 at 19:31)</a>:</h4>
<p>Maybe Niko can provide some clarity this Friday. This is becoming a lot more complex than the liveness-based formulation.</p>



<a name="257259253"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/186049-t-compiler/wg-polonius/topic/Sprint%202021-10-15%20prep/near/257259253" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> lqd <a href="https://zulip-archive.rust-lang.org/stream/186049-t-compiler/wg-polonius/topic/Sprint.202021-10-15.20prep.html#257259253">(Oct 12 2021 at 19:32)</a>:</h4>
<p>I was literally thinking "all this to avoid liveness" as you wrote it</p>



<a name="257259494"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/186049-t-compiler/wg-polonius/topic/Sprint%202021-10-15%20prep/near/257259494" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> lqd <a href="https://zulip-archive.rust-lang.org/stream/186049-t-compiler/wg-polonius/topic/Sprint.202021-10-15.20prep.html#257259494">(Oct 12 2021 at 19:34)</a>:</h4>
<p>at least we have all the interesting examples in the document, to talk about then</p>



<a name="257259714"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/186049-t-compiler/wg-polonius/topic/Sprint%202021-10-15%20prep/near/257259714" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Dylan MacKenzie (ecstatic-morse) <a href="https://zulip-archive.rust-lang.org/stream/186049-t-compiler/wg-polonius/topic/Sprint.202021-10-15.20prep.html#257259714">(Oct 12 2021 at 19:36)</a>:</h4>
<p>Yeah. I mean I would be quite happy to figure out whether the general pattern of <code>backward analysis /\ forward analysis</code> is fundamentally necessary get sound and reasonably precise results on pointer analysis problems.</p>



<a name="257259780"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/186049-t-compiler/wg-polonius/topic/Sprint%202021-10-15%20prep/near/257259780" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Dylan MacKenzie (ecstatic-morse) <a href="https://zulip-archive.rust-lang.org/stream/186049-t-compiler/wg-polonius/topic/Sprint.202021-10-15.20prep.html#257259780">(Oct 12 2021 at 19:36)</a>:</h4>
<p>Since that would, I think, help me get a deeper understanding of those problems.</p>



<a name="257260066"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/186049-t-compiler/wg-polonius/topic/Sprint%202021-10-15%20prep/near/257260066" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Dylan MacKenzie (ecstatic-morse) <a href="https://zulip-archive.rust-lang.org/stream/186049-t-compiler/wg-polonius/topic/Sprint.202021-10-15.20prep.html#257260066">(Oct 12 2021 at 19:39)</a>:</h4>
<p>At this point, I can't tell if our problems are fundamental or if we're just not being clever enough. <span class="user-mention silent" data-user-id="337115">Domenic Quirl</span>'s examples are more problematic than my self-invalidation one I think, which seemed like more of an edge-case</p>



<a name="257260303"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/186049-t-compiler/wg-polonius/topic/Sprint%202021-10-15%20prep/near/257260303" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> lqd <a href="https://zulip-archive.rust-lang.org/stream/186049-t-compiler/wg-polonius/topic/Sprint.202021-10-15.20prep.html#257260303">(Oct 12 2021 at 19:40)</a>:</h4>
<p>it's more like a trivial pattern than I can't help to be confused about whether it's some simple misunderstanding of fact generation</p>



<a name="257260387"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/186049-t-compiler/wg-polonius/topic/Sprint%202021-10-15%20prep/near/257260387" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Dylan MacKenzie (ecstatic-morse) <a href="https://zulip-archive.rust-lang.org/stream/186049-t-compiler/wg-polonius/topic/Sprint.202021-10-15.20prep.html#257260387">(Oct 12 2021 at 19:41)</a>:</h4>
<p>Anyways, I think we need to talk about some "big picture" stuff on Friday, and I prefer a call for that as well.</p>



<a name="257260491"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/186049-t-compiler/wg-polonius/topic/Sprint%202021-10-15%20prep/near/257260491" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> lqd <a href="https://zulip-archive.rust-lang.org/stream/186049-t-compiler/wg-polonius/topic/Sprint.202021-10-15.20prep.html#257260491">(Oct 12 2021 at 19:42)</a>:</h4>
<p>and needing the results of the pointer analysis to know how to emit the facts needed for the pointer analysis is an interesting conundrum as you said earlier</p>



<a name="257260932"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/186049-t-compiler/wg-polonius/topic/Sprint%202021-10-15%20prep/near/257260932" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> lqd <a href="https://zulip-archive.rust-lang.org/stream/186049-t-compiler/wg-polonius/topic/Sprint.202021-10-15.20prep.html#257260932">(Oct 12 2021 at 19:45)</a>:</h4>
<p>in any case there's no need for me to continue on fact generation until our friday talk</p>



<a name="257263557"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/186049-t-compiler/wg-polonius/topic/Sprint%202021-10-15%20prep/near/257263557" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> lqd <a href="https://zulip-archive.rust-lang.org/stream/186049-t-compiler/wg-polonius/topic/Sprint.202021-10-15.20prep.html#257263557">(Oct 12 2021 at 20:03)</a>:</h4>
<p><span class="user-mention silent" data-user-id="337115">Domenic Quirl</span> <a href="#narrow/stream/186049-t-compiler.2Fwg-polonius/topic/Sprint.202021-10-15.20prep/near/257212439">said</a>:</p>
<blockquote>
<p>Maybe you can explain some more <em>why</em> the resulting facts look off to you?</p>
</blockquote>
<p>ah I <em>think</em> I understand the source of the confusion about the <code>introduce_subset</code> facts we talked about earlier, and it may just be about notation. </p>
<p>You wrote:</p>
<blockquote>
<p><strong>Immutably</strong> borrowing <code>P = *Q</code> as <code>&amp;'L_*Q *Q</code> where <code>Q</code> is a <strong>shared</strong> reference <code>Q: &amp;'Q T</code> introduces <code>'L_*Q &lt;= 'Q</code>, because the outer reference <code>'L_*Q</code> cannot outlive the inner reference <code>'Q</code>.</p>
</blockquote>
<p>here <code>'L_*Q &lt;= 'Q</code> means <code>'Q: 'L_*Q</code> but <a href="https://github.com/nikomatsakis/polonius.next/blob/d91f1608b4f0b5c63183c9aa5c34a0d89bf4d2b1/tests/killing-and-murder/program.txt#L55"><code>introduce_subset('L_*x, 'x) here</code></a> is the inverse and means <code>'L_*x: 'x</code>. (a smaller set of loans (an origin) is a larger set of points in the cfg (a lifetime))</p>
<p>edit: I've noticed you can see an example of that in the existing tests, <a href="https://github.com/nikomatsakis/polonius.next/blob/d91f1608b4f0b5c63183c9aa5c34a0d89bf4d2b1/tests/issue-47680/program.txt#L42-L43">here</a></p>



<a name="257271641"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/186049-t-compiler/wg-polonius/topic/Sprint%202021-10-15%20prep/near/257271641" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Domenic Quirl <a href="https://zulip-archive.rust-lang.org/stream/186049-t-compiler/wg-polonius/topic/Sprint.202021-10-15.20prep.html#257271641">(Oct 12 2021 at 21:02)</a>:</h4>
<p><span class="user-mention silent" data-user-id="116113">lqd</span> <a href="#narrow/stream/186049-t-compiler.2Fwg-polonius/topic/Sprint.202021-10-15.20prep/near/257263557">said</a>:</p>
<blockquote>
<p>here <code>'L_*Q &lt;= 'Q</code> means <code>'Q: 'L_*Q</code> but <a href="https://github.com/nikomatsakis/polonius.next/blob/d91f1608b4f0b5c63183c9aa5c34a0d89bf4d2b1/tests/killing-and-murder/program.txt#L55"><code>introduce_subset('L_*x, 'x) here</code></a> is the inverse and means <code>'L_*x: 'x</code>. (a smaller set of loans (an origin) is a larger set of points in the cfg (a lifetime))<br>
</p>
</blockquote>
<p>This may also just be me misunderstanding Niko's comments, as the notation is from there.</p>



<a name="257271882"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/186049-t-compiler/wg-polonius/topic/Sprint%202021-10-15%20prep/near/257271882" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Domenic Quirl <a href="https://zulip-archive.rust-lang.org/stream/186049-t-compiler/wg-polonius/topic/Sprint.202021-10-15.20prep.html#257271882">(Oct 12 2021 at 21:04)</a>:</h4>
<p><span class="user-mention silent" data-user-id="116113">lqd</span> <a href="#narrow/stream/186049-t-compiler.2Fwg-polonius/topic/Sprint.202021-10-15.20prep/near/257263557">said</a>:</p>
<blockquote>
<p>edit: I've noticed you can see an example of that in the existing tests, <a href="https://github.com/nikomatsakis/polonius.next/blob/d91f1608b4f0b5c63183c9aa5c34a0d89bf4d2b1/tests/issue-47680/program.txt#L42-L43">here</a></p>
</blockquote>
<p>Because this fact is indeed the other way round. But in the <code>killing-and-murder-err</code>, the error is derived from invalidating <code>'L_*x</code>, that propagating to <code>'x</code>, and that being accessed. So I don't think it would work if it were the other way around</p>



<a name="257272060"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/186049-t-compiler/wg-polonius/topic/Sprint%202021-10-15%20prep/near/257272060" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Domenic Quirl <a href="https://zulip-archive.rust-lang.org/stream/186049-t-compiler/wg-polonius/topic/Sprint.202021-10-15.20prep.html#257272060">(Oct 12 2021 at 21:05)</a>:</h4>
<p>(this is related to how we handle invalidation - see the questions on it in the HackMD. If the write invalidated <code>'L_p</code> (because <code>p</code> is the actual memory target), then <em>that</em>  would invalidate <code>'x</code>)</p>



<a name="257272302"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/186049-t-compiler/wg-polonius/topic/Sprint%202021-10-15%20prep/near/257272302" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Domenic Quirl <a href="https://zulip-archive.rust-lang.org/stream/186049-t-compiler/wg-polonius/topic/Sprint.202021-10-15.20prep.html#257272302">(Oct 12 2021 at 21:07)</a>:</h4>
<p>But thinking about it again now it makes sense to me to say "invalidating <code>'Q</code> will invalidate <code>'L_*Q</code>", which is the original translation and your understanding as well if I see this correctly</p>



<a name="257272347"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/186049-t-compiler/wg-polonius/topic/Sprint%202021-10-15%20prep/near/257272347" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Domenic Quirl <a href="https://zulip-archive.rust-lang.org/stream/186049-t-compiler/wg-polonius/topic/Sprint.202021-10-15.20prep.html#257272347">(Oct 12 2021 at 21:07)</a>:</h4>
<p>Just then we are currently missing something to actually infer the error in that example I think</p>



<a name="257272588"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/186049-t-compiler/wg-polonius/topic/Sprint%202021-10-15%20prep/near/257272588" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> lqd <a href="https://zulip-archive.rust-lang.org/stream/186049-t-compiler/wg-polonius/topic/Sprint.202021-10-15.20prep.html#257272588">(Oct 12 2021 at 21:09)</a>:</h4>
<p>yeah</p>



<a name="257272771"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/186049-t-compiler/wg-polonius/topic/Sprint%202021-10-15%20prep/near/257272771" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> lqd <a href="https://zulip-archive.rust-lang.org/stream/186049-t-compiler/wg-polonius/topic/Sprint.202021-10-15.20prep.html#257272771">(Oct 12 2021 at 21:10)</a>:</h4>
<p>I'll go read this example more carefully now</p>



<a name="257277016"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/186049-t-compiler/wg-polonius/topic/Sprint%202021-10-15%20prep/near/257277016" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> lqd <a href="https://zulip-archive.rust-lang.org/stream/186049-t-compiler/wg-polonius/topic/Sprint.202021-10-15.20prep.html#257277016">(Oct 12 2021 at 21:47)</a>:</h4>
<p><del>(hmm I'll just note that as-is, and I'm not sure what this example is trying to convey, I don't think it would emit an error today)</del> (clarification: this was about the killing-and-murder example that I linked and which does not emit an error, that's the point of the other killing-and-murder-err example)</p>



<a name="257287448"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/186049-t-compiler/wg-polonius/topic/Sprint%202021-10-15%20prep/near/257287448" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> lqd <a href="https://zulip-archive.rust-lang.org/stream/186049-t-compiler/wg-polonius/topic/Sprint.202021-10-15.20prep.html#257287448">(Oct 12 2021 at 23:28)</a>:</h4>
<p>we really need to clarify these rules about invalidations and unrolling</p>



<a name="257287470"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/186049-t-compiler/wg-polonius/topic/Sprint%202021-10-15%20prep/near/257287470" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> lqd <a href="https://zulip-archive.rust-lang.org/stream/186049-t-compiler/wg-polonius/topic/Sprint.202021-10-15.20prep.html#257287470">(Oct 12 2021 at 23:29)</a>:</h4>
<p>looking forward to friday</p>



<a name="257331286"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/186049-t-compiler/wg-polonius/topic/Sprint%202021-10-15%20prep/near/257331286" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Domenic Quirl <a href="https://zulip-archive.rust-lang.org/stream/186049-t-compiler/wg-polonius/topic/Sprint.202021-10-15.20prep.html#257331286">(Oct 13 2021 at 08:46)</a>:</h4>
<p>Btw, what program do you usually use for such calls? Just so that I can set that up before we meet</p>



<a name="257346905"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/186049-t-compiler/wg-polonius/topic/Sprint%202021-10-15%20prep/near/257346905" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> lqd <a href="https://zulip-archive.rust-lang.org/stream/186049-t-compiler/wg-polonius/topic/Sprint.202021-10-15.20prep.html#257346905">(Oct 13 2021 at 11:08)</a>:</h4>
<p>often Zoom, or <a href="https://meet.jit.si/">https://meet.jit.si/</a> (this one doesn't require installing software IIRC)</p>



<hr><p>Last updated: Apr 12 2022 at 20:01 UTC</p>
</html>