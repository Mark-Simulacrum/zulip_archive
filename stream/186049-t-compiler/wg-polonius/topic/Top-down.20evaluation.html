<html>
<head><meta charset="utf-8"><title>Top-down evaluation · t-compiler/wg-polonius · Zulip Chat Archive</title></head>
<h2>Stream: <a href="https://zulip-archive.rust-lang.org/stream/186049-t-compiler/wg-polonius/index.html">t-compiler/wg-polonius</a></h2>
<h3>Topic: <a href="https://zulip-archive.rust-lang.org/stream/186049-t-compiler/wg-polonius/topic/Top-down.20evaluation.html">Top-down evaluation</a></h3>

<hr>

<base href="https://rust-lang.zulipchat.com">

<head><link href="https://zulip-archive.rust-lang.org/style.css" rel="stylesheet"></head>

<a name="250394497"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/186049-t-compiler/wg-polonius/topic/Top-down%20evaluation/near/250394497" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/186049-t-compiler/wg-polonius/topic/Top-down.20evaluation.html#250394497">(Aug 23 2021 at 18:47)</a>:</h4>
<p>Something I noticed:</p>
<p>Racket has a <a href="https://docs.racket-lang.org/datalog/datalog.html">datalog implementation</a>. What's kind of interesting is their evaluation model:</p>
<blockquote>
<p>The package uses the tabled logic programming algorithm described in Efficient Top-Down Computation of Queries under the Well-Founded Semantics by W. Chen, T. Swift, and D. S. Warren. Another important reference is Tabled Evaluation with Delaying for General Logic Programs by W. Chen and D. S. Warren. Datalog is described in What You Always Wanted to Know About Datalog (And Never Dared to Ask) by Stefano Ceri, Georg Gottlob, and Letizia Tanca.</p>
</blockquote>
<p>This is the same strategy that the SLG solver in chalk uses!</p>



<a name="250394547"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/186049-t-compiler/wg-polonius/topic/Top-down%20evaluation/near/250394547" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/186049-t-compiler/wg-polonius/topic/Top-down.20evaluation.html#250394547">(Aug 23 2021 at 18:47)</a>:</h4>
<p>I wonder if a top-down evaluation strategy would be a better fit. It'd be fun to port over the SLG solver to this simpler case (some of the annoying complexity would go away...)</p>



<a name="250394596"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/186049-t-compiler/wg-polonius/topic/Top-down%20evaluation/near/250394596" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/186049-t-compiler/wg-polonius/topic/Top-down.20evaluation.html#250394596">(Aug 23 2021 at 18:47)</a>:</h4>
<p>Might be interesting to experiment with the performance first though</p>



<a name="250394670"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/186049-t-compiler/wg-polonius/topic/Top-down%20evaluation/near/250394670" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/186049-t-compiler/wg-polonius/topic/Top-down.20evaluation.html#250394670">(Aug 23 2021 at 18:48)</a>:</h4>
<p>would be nicer than worry about magic sets</p>



<a name="250396364"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/186049-t-compiler/wg-polonius/topic/Top-down%20evaluation/near/250396364" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> lqd <a href="https://zulip-archive.rust-lang.org/stream/186049-t-compiler/wg-polonius/topic/Top-down.20evaluation.html#250396364">(Aug 23 2021 at 19:01)</a>:</h4>
<p>/me is having flashbacks of asking to use the SLG solver years ago :p</p>



<a name="250397081"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/186049-t-compiler/wg-polonius/topic/Top-down%20evaluation/near/250397081" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> lqd <a href="https://zulip-archive.rust-lang.org/stream/186049-t-compiler/wg-polonius/topic/Top-down.20evaluation.html#250397081">(Aug 23 2021 at 19:06)</a>:</h4>
<p>I also remember subsumptive tabling being of interest for top-down eval (and there were analogue transforms to magic sets for bottom-up evaluation, the Demand Transform we've talked about before)</p>



<a name="250398051"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/186049-t-compiler/wg-polonius/topic/Top-down%20evaluation/near/250398051" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> lqd <a href="https://zulip-archive.rust-lang.org/stream/186049-t-compiler/wg-polonius/topic/Top-down.20evaluation.html#250398051">(Aug 23 2021 at 19:13)</a>:</h4>
<p>(IIRC XSB and YAP support datalog w/ top-down eval as well)</p>



<a name="250398552"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/186049-t-compiler/wg-polonius/topic/Top-down%20evaluation/near/250398552" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Dylan MacKenzie (ecstatic-morse) <a href="https://zulip-archive.rust-lang.org/stream/186049-t-compiler/wg-polonius/topic/Top-down.20evaluation.html#250398552">(Aug 23 2021 at 19:17)</a>:</h4>
<p>Howdy! My memory was that "transitive closure"-heavy programs don't benefit much from the magic set optimization (and thus from top-down pruning), since it's hard to tell which link in the chain is important for the final result. CFG reachability and <code>subset</code> are both TCs. That said, there's some potential pruning, e.g. for CFG locations where no loans are invalidated.</p>
<p>While the nomenclature around magic sets confuses me, the basic idea is simple. <code>placeholder_subset</code> uses it when we only use edges starting from placeholder origins, for example.</p>



<a name="250399077"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/186049-t-compiler/wg-polonius/topic/Top-down%20evaluation/near/250399077" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/186049-t-compiler/wg-polonius/topic/Top-down.20evaluation.html#250399077">(Aug 23 2021 at 19:21)</a>:</h4>
<p>The idea is simple, but coding it by hand is annoying</p>



<a name="250399163"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/186049-t-compiler/wg-polonius/topic/Top-down%20evaluation/near/250399163" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/186049-t-compiler/wg-polonius/topic/Top-down.20evaluation.html#250399163">(Aug 23 2021 at 19:22)</a>:</h4>
<p><span class="user-mention silent" data-user-id="116113">lqd</span> <a href="#narrow/stream/186049-t-compiler.2Fwg-polonius/topic/Top-down.20evaluation/near/250396364">said</a>:</p>
<blockquote>
<p>/me is having flashbacks of asking to use the SLG solver years ago :p</p>
</blockquote>
<p>Yeah :)</p>



<a name="250399862"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/186049-t-compiler/wg-polonius/topic/Top-down%20evaluation/near/250399862" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> lqd <a href="https://zulip-archive.rust-lang.org/stream/186049-t-compiler/wg-polonius/topic/Top-down.20evaluation.html#250399862">(Aug 23 2021 at 19:28)</a>:</h4>
<p><span class="user-mention silent" data-user-id="118594">Dylan MacKenzie (ecstatic-morse)</span> <a href="#narrow/stream/186049-t-compiler.2Fwg-polonius/topic/Top-down.20evaluation/near/250398552">said</a>:</p>
<blockquote>
<p>While the nomenclature around magic sets confuses me (adorned predicates, SIPS, etc), the basic idea is simple. <code>placeholder_subset</code> uses it when we only use edges starting from placeholder origins, for example.</p>
</blockquote>
<p>yeah, and similarly for the other sharing / filtering in-between location-insensitive and location-sensitive analyses (only track loans which are invalidated, only track subsets downstream from the issuing origin of these invalidated loans, etc)</p>



<a name="250400254"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/186049-t-compiler/wg-polonius/topic/Top-down%20evaluation/near/250400254" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Dylan MacKenzie (ecstatic-morse) <a href="https://zulip-archive.rust-lang.org/stream/186049-t-compiler/wg-polonius/topic/Top-down.20evaluation.html#250400254">(Aug 23 2021 at 19:31)</a>:</h4>
<p><span class="user-mention silent" data-user-id="116009">nikomatsakis</span> <a href="#narrow/stream/186049-t-compiler.2Fwg-polonius/topic/Top-down.20evaluation/near/250399077">said</a>:</p>
<blockquote>
<p>The idea is simple, but coding it by hand is annoying</p>
</blockquote>
<p>Fair.</p>



<a name="250400368"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/186049-t-compiler/wg-polonius/topic/Top-down%20evaluation/near/250400368" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Dylan MacKenzie (ecstatic-morse) <a href="https://zulip-archive.rust-lang.org/stream/186049-t-compiler/wg-polonius/topic/Top-down.20evaluation.html#250400368">(Aug 23 2021 at 19:32)</a>:</h4>
<p><span class="user-mention silent" data-user-id="116113">lqd</span> <a href="#narrow/stream/186049-t-compiler.2Fwg-polonius/topic/Top-down.20evaluation/near/250399862">said</a>:</p>
<blockquote>
<p><span class="user-mention silent" data-user-id="118594">Dylan MacKenzie (ecstatic-morse)</span> <a href="#narrow/stream/186049-t-compiler.2Fwg-polonius/topic/Top-down.20evaluation/near/250398552">said</a>:</p>
<blockquote>
<p>While the nomenclature around magic sets confuses me (adorned predicates, SIPS, etc), the basic idea is simple. <code>placeholder_subset</code> uses it when we only use edges starting from placeholder origins, for example.</p>
</blockquote>
<p>yeah, and similarly for the other sharing / filtering in-between location-insensitive and location-sensitive analyses (only track loans which are invalidated, only track subsets downstream from the issuing origin of these invalidated loans, etc)</p>
</blockquote>
<p>That's a good point. Top-down would probably work quite well for this.</p>



<hr><p>Last updated: Apr 12 2022 at 20:01 UTC</p>
</html>