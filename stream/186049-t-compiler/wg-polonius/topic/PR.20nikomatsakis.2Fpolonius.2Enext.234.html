<html>
<head><meta charset="utf-8"><title>PR nikomatsakis/polonius.next#4 · t-compiler/wg-polonius · Zulip Chat Archive</title></head>
<h2>Stream: <a href="https://zulip-archive.rust-lang.org/stream/186049-t-compiler/wg-polonius/index.html">t-compiler/wg-polonius</a></h2>
<h3>Topic: <a href="https://zulip-archive.rust-lang.org/stream/186049-t-compiler/wg-polonius/topic/PR.20nikomatsakis.2Fpolonius.2Enext.234.html">PR nikomatsakis/polonius.next#4</a></h3>

<hr>

<base href="https://rust-lang.zulipchat.com">

<head><link href="https://zulip-archive.rust-lang.org/style.css" rel="stylesheet"></head>

<a name="259534252"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/186049-t-compiler/wg-polonius/topic/PR%20nikomatsakis/polonius.next%234/near/259534252" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/186049-t-compiler/wg-polonius/topic/PR.20nikomatsakis.2Fpolonius.2Enext.234.html#259534252">(Oct 29 2021 at 14:43)</a>:</h4>
<p>Is there a reason <em>not</em> to merge nikomatsakis/polonius.next#4 ?</p>



<a name="259534383"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/186049-t-compiler/wg-polonius/topic/PR%20nikomatsakis/polonius.next%234/near/259534383" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Dylan MacKenzie (ecstatic-morse) <a href="https://zulip-archive.rust-lang.org/stream/186049-t-compiler/wg-polonius/topic/PR.20nikomatsakis.2Fpolonius.2Enext.234.html#259534383">(Oct 29 2021 at 14:44)</a>:</h4>
<p>The <code>invalidate_origin</code> facts it produces aren't correct, and it will need to be updated to use the <code>Deref</code> PR you just merged.</p>



<a name="259535043"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/186049-t-compiler/wg-polonius/topic/PR%20nikomatsakis/polonius.next%234/near/259535043" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/186049-t-compiler/wg-polonius/topic/PR.20nikomatsakis.2Fpolonius.2Enext.234.html#259535043">(Oct 29 2021 at 14:49)</a>:</h4>
<p>the fact that it does something wrong doesn't seem like a reason not to merge</p>



<a name="259535049"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/186049-t-compiler/wg-polonius/topic/PR%20nikomatsakis/polonius.next%234/near/259535049" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/186049-t-compiler/wg-polonius/topic/PR.20nikomatsakis.2Fpolonius.2Enext.234.html#259535049">(Oct 29 2021 at 14:49)</a>:</h4>
<p>but needing a rebase does :)</p>



<a name="259535067"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/186049-t-compiler/wg-polonius/topic/PR%20nikomatsakis/polonius.next%234/near/259535067" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/186049-t-compiler/wg-polonius/topic/PR.20nikomatsakis.2Fpolonius.2Enext.234.html#259535067">(Oct 29 2021 at 14:49)</a>:</h4>
<p>I'd be inclined to handle the former by filing an issue and a follow-up PR</p>



<a name="259535530"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/186049-t-compiler/wg-polonius/topic/PR%20nikomatsakis/polonius.next%234/near/259535530" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> lqd <a href="https://zulip-archive.rust-lang.org/stream/186049-t-compiler/wg-polonius/topic/PR.20nikomatsakis.2Fpolonius.2Enext.234.html#259535530">(Oct 29 2021 at 14:52)</a>:</h4>
<p>yup it'll need to be rebased since the deref PR changes all the commits w/ snapshots</p>



<a name="259535968"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/186049-t-compiler/wg-polonius/topic/PR%20nikomatsakis/polonius.next%234/near/259535968" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Dylan MacKenzie (ecstatic-morse) <a href="https://zulip-archive.rust-lang.org/stream/186049-t-compiler/wg-polonius/topic/PR.20nikomatsakis.2Fpolonius.2Enext.234.html#259535968">(Oct 29 2021 at 14:55)</a>:</h4>
<p>Do we wanna just revert the Deref PR, merge lqd's and then I can update mine on top of <code>main</code>?</p>



<a name="259536108"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/186049-t-compiler/wg-polonius/topic/PR%20nikomatsakis/polonius.next%234/near/259536108" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> lqd <a href="https://zulip-archive.rust-lang.org/stream/186049-t-compiler/wg-polonius/topic/PR.20nikomatsakis.2Fpolonius.2Enext.234.html#259536108">(Oct 29 2021 at 14:56)</a>:</h4>
<p>I'll update and rebase it when I get off of work</p>



<a name="259536170"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/186049-t-compiler/wg-polonius/topic/PR%20nikomatsakis/polonius.next%234/near/259536170" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> lqd <a href="https://zulip-archive.rust-lang.org/stream/186049-t-compiler/wg-polonius/topic/PR.20nikomatsakis.2Fpolonius.2Enext.234.html#259536170">(Oct 29 2021 at 14:57)</a>:</h4>
<p>(in a couple hours at most)</p>



<a name="259536210"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/186049-t-compiler/wg-polonius/topic/PR%20nikomatsakis/polonius.next%234/near/259536210" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/186049-t-compiler/wg-polonius/topic/PR.20nikomatsakis.2Fpolonius.2Enext.234.html#259536210">(Oct 29 2021 at 14:57)</a>:</h4>
<p>it seems like we can squash-and-rebase <span class="user-mention" data-user-id="116113">@lqd</span>'s PR probably</p>



<a name="259536218"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/186049-t-compiler/wg-polonius/topic/PR%20nikomatsakis/polonius.next%234/near/259536218" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/186049-t-compiler/wg-polonius/topic/PR.20nikomatsakis.2Fpolonius.2Enext.234.html#259536218">(Oct 29 2021 at 14:57)</a>:</h4>
<p>without great difficulty?</p>



<a name="259536390"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/186049-t-compiler/wg-polonius/topic/PR%20nikomatsakis/polonius.next%234/near/259536390" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> lqd <a href="https://zulip-archive.rust-lang.org/stream/186049-t-compiler/wg-polonius/topic/PR.20nikomatsakis.2Fpolonius.2Enext.234.html#259536390">(Oct 29 2021 at 14:58)</a>:</h4>
<p>I didn't do that when I rebased before so that it's easier to review commit by commit</p>



<a name="259536481"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/186049-t-compiler/wg-polonius/topic/PR%20nikomatsakis/polonius.next%234/near/259536481" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> lqd <a href="https://zulip-archive.rust-lang.org/stream/186049-t-compiler/wg-polonius/topic/PR.20nikomatsakis.2Fpolonius.2Enext.234.html#259536481">(Oct 29 2021 at 14:59)</a>:</h4>
<p>it's not like it's so complicated that this has great value ^^</p>



<a name="259536821"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/186049-t-compiler/wg-polonius/topic/PR%20nikomatsakis/polonius.next%234/near/259536821" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/186049-t-compiler/wg-polonius/topic/PR.20nikomatsakis.2Fpolonius.2Enext.234.html#259536821">(Oct 29 2021 at 15:01)</a>:</h4>
<p>it certainly makes for an easier review</p>



<a name="259536847"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/186049-t-compiler/wg-polonius/topic/PR%20nikomatsakis/polonius.next%234/near/259536847" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/186049-t-compiler/wg-polonius/topic/PR.20nikomatsakis.2Fpolonius.2Enext.234.html#259536847">(Oct 29 2021 at 15:01)</a>:</h4>
<p>seems less important to me when it's a huge block of new code but yes :)</p>



<a name="259537051"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/186049-t-compiler/wg-polonius/topic/PR%20nikomatsakis/polonius.next%234/near/259537051" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> lqd <a href="https://zulip-archive.rust-lang.org/stream/186049-t-compiler/wg-polonius/topic/PR.20nikomatsakis.2Fpolonius.2Enext.234.html#259537051">(Oct 29 2021 at 15:03)</a>:</h4>
<p>ok, then I'll rebase it properly asap :)</p>



<a name="259539325"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/186049-t-compiler/wg-polonius/topic/PR%20nikomatsakis/polonius.next%234/near/259539325" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/186049-t-compiler/wg-polonius/topic/PR.20nikomatsakis.2Fpolonius.2Enext.234.html#259539325">(Oct 29 2021 at 15:18)</a>:</h4>
<p>I left a bunch of comments</p>



<a name="259539374"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/186049-t-compiler/wg-polonius/topic/PR%20nikomatsakis/polonius.next%234/near/259539374" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/186049-t-compiler/wg-polonius/topic/PR.20nikomatsakis.2Fpolonius.2Enext.234.html#259539374">(Oct 29 2021 at 15:19)</a>:</h4>
<p>overall looks good!</p>



<a name="259550129"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/186049-t-compiler/wg-polonius/topic/PR%20nikomatsakis/polonius.next%234/near/259550129" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> lqd <a href="https://zulip-archive.rust-lang.org/stream/186049-t-compiler/wg-polonius/topic/PR.20nikomatsakis.2Fpolonius.2Enext.234.html#259550129">(Oct 29 2021 at 16:31)</a>:</h4>
<p>sorry I think I'll squash and rebase actually, it's not that easy over 80 commits and since it's a bunch of new code having many commits won't be that useful</p>



<a name="259704958"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/186049-t-compiler/wg-polonius/topic/PR%20nikomatsakis/polonius.next%234/near/259704958" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> lqd <a href="https://zulip-archive.rust-lang.org/stream/186049-t-compiler/wg-polonius/topic/PR.20nikomatsakis.2Fpolonius.2Enext.234.html#259704958">(Oct 30 2021 at 02:29)</a>:</h4>
<p>Ok: </p>
<ul>
<li>I've merged the revert</li>
<li>I've rebased and kept the easier-to-review 85 commits</li>
<li>I've addressed some of the review comments by refactoring subset emission to handle generic types, refactored variance slighty to support contravariance (but we can't parse or test it yet)</li>
<li>I've replied to the other comments: the simplistic invalidations will be fixed by dylan's PR <a href="https://github.com/rust-lang/rust/issues/10">#10</a>; the "relate_ty" structure we kinda already have as you've noticed later, but it's more cluttered (like the rest of the code ... needs some cleanup once it's more stable) because there's more things to support than just types (borrow expressions, calls, etc)</li>
<li>we didn't have CI, mostly because our tests require soufflé and they had issues with their packaging quotas, so I've added a GHA workflow using dylan's soufflé .deb</li>
</ul>



<a name="259705121"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/186049-t-compiler/wg-polonius/topic/PR%20nikomatsakis/polonius.next%234/near/259705121" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> lqd <a href="https://zulip-archive.rust-lang.org/stream/186049-t-compiler/wg-polonius/topic/PR.20nikomatsakis.2Fpolonius.2Enext.234.html#259705121">(Oct 30 2021 at 02:33)</a>:</h4>
<p>so if anyone wants to do another quick pass, that'd be cool. we could maybe integrate some of the discussions about the TODO comments, in the TODO comments themselves (apart from the one(s) needing an answer from niko).</p>
<p>otherwise, it feels like an acceptable first step, so that we can add the other pieces from dylan's PRs, to support projections and therefore unrolling, subsets from calls depending on the fn signature, correct invalidations, etc (and what you cooked up today :)</p>



<a name="259911181"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/186049-t-compiler/wg-polonius/topic/PR%20nikomatsakis/polonius.next%234/near/259911181" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/186049-t-compiler/wg-polonius/topic/PR.20nikomatsakis.2Fpolonius.2Enext.234.html#259911181">(Nov 01 2021 at 19:48)</a>:</h4>
<p>Reading now</p>



<a name="259911356"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/186049-t-compiler/wg-polonius/topic/PR%20nikomatsakis/polonius.next%234/near/259911356" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/186049-t-compiler/wg-polonius/topic/PR.20nikomatsakis.2Fpolonius.2Enext.234.html#259911356">(Nov 01 2021 at 19:50)</a>:</h4>
<p>we should add bors</p>



<a name="259911362"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/186049-t-compiler/wg-polonius/topic/PR%20nikomatsakis/polonius.next%234/near/259911362" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/186049-t-compiler/wg-polonius/topic/PR.20nikomatsakis.2Fpolonius.2Enext.234.html#259911362">(Nov 01 2021 at 19:50)</a>:</h4>
<p>but merged!</p>



<a name="259911401"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/186049-t-compiler/wg-polonius/topic/PR%20nikomatsakis/polonius.next%234/near/259911401" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/186049-t-compiler/wg-polonius/topic/PR.20nikomatsakis.2Fpolonius.2Enext.234.html#259911401">(Nov 01 2021 at 19:50)</a>:</h4>
<p>Guess I have to rebase <a href="https://github.com/nikomatsakis/polonius.next/pull/15">https://github.com/nikomatsakis/polonius.next/pull/15</a> :)</p>



<a name="259923917"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/186049-t-compiler/wg-polonius/topic/PR%20nikomatsakis/polonius.next%234/near/259923917" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/186049-t-compiler/wg-polonius/topic/PR.20nikomatsakis.2Fpolonius.2Enext.234.html#259923917">(Nov 01 2021 at 21:28)</a>:</h4>
<p>done!</p>



<hr><p>Last updated: Apr 12 2022 at 20:01 UTC</p>
</html>