<html>
<head><meta charset="utf-8"><title>Placeholder liveness aside · t-compiler/wg-polonius · Zulip Chat Archive</title></head>
<h2>Stream: <a href="https://zulip-archive.rust-lang.org/stream/186049-t-compiler/wg-polonius/index.html">t-compiler/wg-polonius</a></h2>
<h3>Topic: <a href="https://zulip-archive.rust-lang.org/stream/186049-t-compiler/wg-polonius/topic/Placeholder.20liveness.20aside.html">Placeholder liveness aside</a></h3>

<hr>

<base href="https://rust-lang.zulipchat.com">

<head><link href="https://zulip-archive.rust-lang.org/style.css" rel="stylesheet"></head>

<a name="250955819"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/186049-t-compiler/wg-polonius/topic/Placeholder%20liveness%20aside/near/250955819" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> lqd <a href="https://zulip-archive.rust-lang.org/stream/186049-t-compiler/wg-polonius/topic/Placeholder.20liveness.20aside.html#250955819">(Aug 27 2021 at 16:19)</a>:</h4>
<p><span class="user-mention" data-user-id="118594">@Dylan MacKenzie (ecstatic-morse)</span> btw did you have specific questions in mind about either placeholder liveness or <code>Location::All</code> ?</p>



<a name="250956099"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/186049-t-compiler/wg-polonius/topic/Placeholder%20liveness%20aside/near/250956099" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Dylan MacKenzie (ecstatic-morse) <a href="https://zulip-archive.rust-lang.org/stream/186049-t-compiler/wg-polonius/topic/Placeholder.20liveness.20aside.html#250956099">(Aug 27 2021 at 16:21)</a>:</h4>
<p>You placeholder liveness PR seems like something we should obviously do. Is that right? We just need to add the API to datafrog to make it less verbose?</p>



<a name="250956150"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/186049-t-compiler/wg-polonius/topic/Placeholder%20liveness%20aside/near/250956150" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> lqd <a href="https://zulip-archive.rust-lang.org/stream/186049-t-compiler/wg-polonius/topic/Placeholder.20liveness.20aside.html#250956150">(Aug 27 2021 at 16:21)</a>:</h4>
<p>that's my impression as well</p>



<a name="250956260"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/186049-t-compiler/wg-polonius/topic/Placeholder%20liveness%20aside/near/250956260" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> lqd <a href="https://zulip-archive.rust-lang.org/stream/186049-t-compiler/wg-polonius/topic/Placeholder.20liveness.20aside.html#250956260">(Aug 27 2021 at 16:22)</a>:</h4>
<p>we make do by materializing the tuples directly, and that does simplify the rules in a sense</p>



<a name="250956292"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/186049-t-compiler/wg-polonius/topic/Placeholder%20liveness%20aside/near/250956292" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> lqd <a href="https://zulip-archive.rust-lang.org/stream/186049-t-compiler/wg-polonius/topic/Placeholder.20liveness.20aside.html#250956292">(Aug 27 2021 at 16:22)</a>:</h4>
<p>but it's not super clean/satisfying</p>



<a name="250956298"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/186049-t-compiler/wg-polonius/topic/Placeholder%20liveness%20aside/near/250956298" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Dylan MacKenzie (ecstatic-morse) <a href="https://zulip-archive.rust-lang.org/stream/186049-t-compiler/wg-polonius/topic/Placeholder.20liveness.20aside.html#250956298">(Aug 27 2021 at 16:22)</a>:</h4>
<p>Okay, the changes aren't very difficult. I was just waiting to see if someone wanted to pick them up or if I should do it myself.</p>



<a name="250956335"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/186049-t-compiler/wg-polonius/topic/Placeholder%20liveness%20aside/near/250956335" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Dylan MacKenzie (ecstatic-morse) <a href="https://zulip-archive.rust-lang.org/stream/186049-t-compiler/wg-polonius/topic/Placeholder.20liveness.20aside.html#250956335">(Aug 27 2021 at 16:22)</a>:</h4>
<p>At least the datafrog changes will give us the option.</p>



<a name="250956346"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/186049-t-compiler/wg-polonius/topic/Placeholder%20liveness%20aside/near/250956346" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> lqd <a href="https://zulip-archive.rust-lang.org/stream/186049-t-compiler/wg-polonius/topic/Placeholder.20liveness.20aside.html#250956346">(Aug 27 2021 at 16:22)</a>:</h4>
<p>right</p>



<a name="250956355"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/186049-t-compiler/wg-polonius/topic/Placeholder%20liveness%20aside/near/250956355" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> lqd <a href="https://zulip-archive.rust-lang.org/stream/186049-t-compiler/wg-polonius/topic/Placeholder.20liveness.20aside.html#250956355">(Aug 27 2021 at 16:22)</a>:</h4>
<p>but there's no rush for this of course</p>



<a name="250956378"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/186049-t-compiler/wg-polonius/topic/Placeholder%20liveness%20aside/near/250956378" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Dylan MacKenzie (ecstatic-morse) <a href="https://zulip-archive.rust-lang.org/stream/186049-t-compiler/wg-polonius/topic/Placeholder.20liveness.20aside.html#250956378">(Aug 27 2021 at 16:23)</a>:</h4>
<p>Okay, I'll ping regexident again.</p>



<a name="250956395"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/186049-t-compiler/wg-polonius/topic/Placeholder%20liveness%20aside/near/250956395" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> lqd <a href="https://zulip-archive.rust-lang.org/stream/186049-t-compiler/wg-polonius/topic/Placeholder.20liveness.20aside.html#250956395">(Aug 27 2021 at 16:23)</a>:</h4>
<p>so we could still wait to see if regexident wants to do them</p>



<a name="250956400"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/186049-t-compiler/wg-polonius/topic/Placeholder%20liveness%20aside/near/250956400" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Dylan MacKenzie (ecstatic-morse) <a href="https://zulip-archive.rust-lang.org/stream/186049-t-compiler/wg-polonius/topic/Placeholder.20liveness.20aside.html#250956400">(Aug 27 2021 at 16:23)</a>:</h4>
<p>So the more interesting thing is <a href="https://github.com/rust-lang/rust/issues/50938">#50938</a></p>



<a name="250956592"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/186049-t-compiler/wg-polonius/topic/Placeholder%20liveness%20aside/near/250956592" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> lqd <a href="https://zulip-archive.rust-lang.org/stream/186049-t-compiler/wg-polonius/topic/Placeholder.20liveness.20aside.html#250956592">(Aug 27 2021 at 16:24)</a>:</h4>
<p>yeah</p>



<a name="250956646"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/186049-t-compiler/wg-polonius/topic/Placeholder%20liveness%20aside/near/250956646" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> lqd <a href="https://zulip-archive.rust-lang.org/stream/186049-t-compiler/wg-polonius/topic/Placeholder.20liveness.20aside.html#250956646">(Aug 27 2021 at 16:24)</a>:</h4>
<p>so this one Niko has more of the backstory and a couple WIP branches to fix it</p>



<a name="250956721"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/186049-t-compiler/wg-polonius/topic/Placeholder%20liveness%20aside/near/250956721" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> lqd <a href="https://zulip-archive.rust-lang.org/stream/186049-t-compiler/wg-polonius/topic/Placeholder.20liveness.20aside.html#250956721">(Aug 27 2021 at 16:25)</a>:</h4>
<p>but the gist is (and maybe you know this already) there are a few cases (maybe all) related to type ascription that are materialized at all points of the CFG</p>



<a name="250956792"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/186049-t-compiler/wg-polonius/topic/Placeholder%20liveness%20aside/near/250956792" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Dylan MacKenzie (ecstatic-morse) <a href="https://zulip-archive.rust-lang.org/stream/186049-t-compiler/wg-polonius/topic/Placeholder.20liveness.20aside.html#250956792">(Aug 27 2021 at 16:26)</a>:</h4>
<p>Niko brought this up during the last sprint, but there's two ways to generate an error when e.g.  a local variable gets returned from a function.</p>



<a name="250956937"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/186049-t-compiler/wg-polonius/topic/Placeholder%20liveness%20aside/near/250956937" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Dylan MacKenzie (ecstatic-morse) <a href="https://zulip-archive.rust-lang.org/stream/186049-t-compiler/wg-polonius/topic/Placeholder.20liveness.20aside.html#250956937">(Aug 27 2021 at 16:26)</a>:</h4>
<p>The way we do it now is to invalidate all loans corresponding to locals at the return place, but that cause an error in the weird case Niko gives in <a href="https://github.com/rust-lang/rust/issues/50938">#50938</a></p>



<a name="250957057"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/186049-t-compiler/wg-polonius/topic/Placeholder%20liveness%20aside/near/250957057" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Dylan MacKenzie (ecstatic-morse) <a href="https://zulip-archive.rust-lang.org/stream/186049-t-compiler/wg-polonius/topic/Placeholder.20liveness.20aside.html#250957057">(Aug 27 2021 at 16:27)</a>:</h4>
<p>But another way is to check for <code>subset</code> relations between non-placeholder <em>origin</em>s and placeholder ones</p>



<a name="250957249"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/186049-t-compiler/wg-polonius/topic/Placeholder%20liveness%20aside/near/250957249" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> lqd <a href="https://zulip-archive.rust-lang.org/stream/186049-t-compiler/wg-polonius/topic/Placeholder.20liveness.20aside.html#250957249">(Aug 27 2021 at 16:29)</a>:</h4>
<p>it also manifests as a different way that is not related to semantics</p>



<a name="250957461"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/186049-t-compiler/wg-polonius/topic/Placeholder%20liveness%20aside/near/250957461" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> lqd <a href="https://zulip-archive.rust-lang.org/stream/186049-t-compiler/wg-polonius/topic/Placeholder.20liveness.20aside.html#250957461">(Aug 27 2021 at 16:30)</a>:</h4>
<p>for functions with many subsets/such cases of ascription and big CFGs, it OOMs in fact generation</p>



<a name="250957567"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/186049-t-compiler/wg-polonius/topic/Placeholder%20liveness%20aside/near/250957567" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> lqd <a href="https://zulip-archive.rust-lang.org/stream/186049-t-compiler/wg-polonius/topic/Placeholder.20liveness.20aside.html#250957567">(Aug 27 2021 at 16:31)</a>:</h4>
<p><a href="https://github.com/rust-lang/rust/issues/50938">#50938</a> and the similar PRs are what seems the correct but harder way to fix these issues</p>



<a name="250957693"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/186049-t-compiler/wg-polonius/topic/Placeholder%20liveness%20aside/near/250957693" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> lqd <a href="https://zulip-archive.rust-lang.org/stream/186049-t-compiler/wg-polonius/topic/Placeholder.20liveness.20aside.html#250957693">(Aug 27 2021 at 16:32)</a>:</h4>
<p>since it has no known impact on our rules</p>



<a name="250957722"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/186049-t-compiler/wg-polonius/topic/Placeholder%20liveness%20aside/near/250957722" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> lqd <a href="https://zulip-archive.rust-lang.org/stream/186049-t-compiler/wg-polonius/topic/Placeholder.20liveness.20aside.html#250957722">(Aug 27 2021 at 16:32)</a>:</h4>
<p>whereas I went the <a href="https://github.com/lqd/rust/commit/ec3712202e5204f6547fbf9a7c3bb8c8cf5215ee">https://github.com/lqd/rust/commit/ec3712202e5204f6547fbf9a7c3bb8c8cf5215ee</a> relation splitting route</p>



<a name="250957767"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/186049-t-compiler/wg-polonius/topic/Placeholder%20liveness%20aside/near/250957767" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> lqd <a href="https://zulip-archive.rust-lang.org/stream/186049-t-compiler/wg-polonius/topic/Placeholder.20liveness.20aside.html#250957767">(Aug 27 2021 at 16:32)</a>:</h4>
<p>which does change the rules a lot</p>



<a name="250957862"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/186049-t-compiler/wg-polonius/topic/Placeholder%20liveness%20aside/near/250957862" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> lqd <a href="https://zulip-archive.rust-lang.org/stream/186049-t-compiler/wg-polonius/topic/Placeholder.20liveness.20aside.html#250957862">(Aug 27 2021 at 16:33)</a>:</h4>
<p>in last years's sprint I remember <span class="user-mention" data-user-id="116009">@nikomatsakis</span> had another branch for this, which was more advanced/complete than <a href="https://github.com/rust-lang/rust/issues/50938">#50938</a> but there were still a few things to do</p>



<a name="250958064"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/186049-t-compiler/wg-polonius/topic/Placeholder%20liveness%20aside/near/250958064" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Dylan MacKenzie (ecstatic-morse) <a href="https://zulip-archive.rust-lang.org/stream/186049-t-compiler/wg-polonius/topic/Placeholder.20liveness.20aside.html#250958064">(Aug 27 2021 at 16:34)</a>:</h4>
<p>Ah, okay. Your change is similar to your placeholder liveness one in a sense, since we have a separate fact for some relation that holds at all CFG points, and presumably we could do a similar disjunction whenever <code>subset</code> appears in a rule?</p>



<a name="250958157"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/186049-t-compiler/wg-polonius/topic/Placeholder%20liveness%20aside/near/250958157" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> lqd <a href="https://zulip-archive.rust-lang.org/stream/186049-t-compiler/wg-polonius/topic/Placeholder.20liveness.20aside.html#250958157">(Aug 27 2021 at 16:35)</a>:</h4>
<p>it's possible yeah</p>



<a name="250958190"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/186049-t-compiler/wg-polonius/topic/Placeholder%20liveness%20aside/near/250958190" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> lqd <a href="https://zulip-archive.rust-lang.org/stream/186049-t-compiler/wg-polonius/topic/Placeholder.20liveness.20aside.html#250958190">(Aug 27 2021 at 16:35)</a>:</h4>
<p>the key thing was to not only move the OOM from rustc to polonius</p>



<a name="250958272"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/186049-t-compiler/wg-polonius/topic/Placeholder%20liveness%20aside/near/250958272" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> lqd <a href="https://zulip-archive.rust-lang.org/stream/186049-t-compiler/wg-polonius/topic/Placeholder.20liveness.20aside.html#250958272">(Aug 27 2021 at 16:36)</a>:</h4>
<p>which could happen if we just evaluated a similar rule materializing the same facts</p>



<a name="250958377"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/186049-t-compiler/wg-polonius/topic/Placeholder%20liveness%20aside/near/250958377" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Dylan MacKenzie (ecstatic-morse) <a href="https://zulip-archive.rust-lang.org/stream/186049-t-compiler/wg-polonius/topic/Placeholder.20liveness.20aside.html#250958377">(Aug 27 2021 at 16:37)</a>:</h4>
<p>True. The optimized variant would handle it elegantly though. Not so much the naive one.</p>



<a name="250958420"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/186049-t-compiler/wg-polonius/topic/Placeholder%20liveness%20aside/near/250958420" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> lqd <a href="https://zulip-archive.rust-lang.org/stream/186049-t-compiler/wg-polonius/topic/Placeholder.20liveness.20aside.html#250958420">(Aug 27 2021 at 16:37)</a>:</h4>
<p>yeah</p>



<a name="250958531"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/186049-t-compiler/wg-polonius/topic/Placeholder%20liveness%20aside/near/250958531" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> lqd <a href="https://zulip-archive.rust-lang.org/stream/186049-t-compiler/wg-polonius/topic/Placeholder.20liveness.20aside.html#250958531">(Aug 27 2021 at 16:38)</a>:</h4>
<p>and the impact of the relation splitting is harder to quantify on the optimized variant, making sure it .. still works</p>



<a name="250958819"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/186049-t-compiler/wg-polonius/topic/Placeholder%20liveness%20aside/near/250958819" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> lqd <a href="https://zulip-archive.rust-lang.org/stream/186049-t-compiler/wg-polonius/topic/Placeholder.20liveness.20aside.html#250958819">(Aug 27 2021 at 16:40)</a>:</h4>
<p>(which would have been easier to do with your soufflé-prototype)</p>



<a name="250958839"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/186049-t-compiler/wg-polonius/topic/Placeholder%20liveness%20aside/near/250958839" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Dylan MacKenzie (ecstatic-morse) <a href="https://zulip-archive.rust-lang.org/stream/186049-t-compiler/wg-polonius/topic/Placeholder.20liveness.20aside.html#250958839">(Aug 27 2021 at 16:40)</a>:</h4>
<p>Hmm. I'll think about that. It should work since the optimized variant is concerned primarily with origins that become dead, which obviously never happens for placeholder regions, but actually writing that down might be hard.</p>



<a name="250958908"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/186049-t-compiler/wg-polonius/topic/Placeholder%20liveness%20aside/near/250958908" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> lqd <a href="https://zulip-archive.rust-lang.org/stream/186049-t-compiler/wg-polonius/topic/Placeholder.20liveness.20aside.html#250958908">(Aug 27 2021 at 16:41)</a>:</h4>
<p>I don't think it only happens for placeholders</p>



<a name="250958924"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/186049-t-compiler/wg-polonius/topic/Placeholder%20liveness%20aside/near/250958924" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Dylan MacKenzie (ecstatic-morse) <a href="https://zulip-archive.rust-lang.org/stream/186049-t-compiler/wg-polonius/topic/Placeholder.20liveness.20aside.html#250958924">(Aug 27 2021 at 16:41)</a>:</h4>
<p>I'm still interested in the principled fix, though. I'll ask Niko about his other branch once he finishes his train of thought.</p>



<a name="250959022"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/186049-t-compiler/wg-polonius/topic/Placeholder%20liveness%20aside/near/250959022" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Dylan MacKenzie (ecstatic-morse) <a href="https://zulip-archive.rust-lang.org/stream/186049-t-compiler/wg-polonius/topic/Placeholder.20liveness.20aside.html#250959022">(Aug 27 2021 at 16:42)</a>:</h4>
<p><a href="https://github.com/rust-lang/rust/issues/50938">#50938</a> says it only happens for parameters and the return place. Can non-placeholder lifetimes appear in those positions?</p>



<a name="250959317"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/186049-t-compiler/wg-polonius/topic/Placeholder%20liveness%20aside/near/250959317" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> lqd <a href="https://zulip-archive.rust-lang.org/stream/186049-t-compiler/wg-polonius/topic/Placeholder.20liveness.20aside.html#250959317">(Aug 27 2021 at 16:44)</a>:</h4>
<p>maybe in the return place for erroneous code</p>



<a name="250959400"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/186049-t-compiler/wg-polonius/topic/Placeholder%20liveness%20aside/near/250959400" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> lqd <a href="https://zulip-archive.rust-lang.org/stream/186049-t-compiler/wg-polonius/topic/Placeholder.20liveness.20aside.html#250959400">(Aug 27 2021 at 16:44)</a>:</h4>
<p>my recollection is that this is also related to type ascription so maybe <a href="https://github.com/rust-lang/rust/issues/50938">#50938</a> doesn't describe all uses, or I'm wrong, or maybe both</p>



<a name="250959509"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/186049-t-compiler/wg-polonius/topic/Placeholder%20liveness%20aside/near/250959509" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> lqd <a href="https://zulip-archive.rust-lang.org/stream/186049-t-compiler/wg-polonius/topic/Placeholder.20liveness.20aside.html#250959509">(Aug 27 2021 at 16:45)</a>:</h4>
<p>(I'll find the examples I know where this happens so maybe it'll be illuminating)</p>



<a name="250959690"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/186049-t-compiler/wg-polonius/topic/Placeholder%20liveness%20aside/near/250959690" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/186049-t-compiler/wg-polonius/topic/Placeholder.20liveness.20aside.html#250959690">(Aug 27 2021 at 16:47)</a>:</h4>
<p>I'm trying to page some of that back in</p>



<a name="250959704"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/186049-t-compiler/wg-polonius/topic/Placeholder%20liveness%20aside/near/250959704" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/186049-t-compiler/wg-polonius/topic/Placeholder.20liveness.20aside.html#250959704">(Aug 27 2021 at 16:47)</a>:</h4>
<p>I was basically removing <code>Liveness::All</code></p>



<a name="250959719"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/186049-t-compiler/wg-polonius/topic/Placeholder%20liveness%20aside/near/250959719" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/186049-t-compiler/wg-polonius/topic/Placeholder.20liveness.20aside.html#250959719">(Aug 27 2021 at 16:47)</a>:</h4>
<p>many of the uses can be done at a specific place (e.g., on entry, or on a return node)</p>



<a name="250959759"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/186049-t-compiler/wg-polonius/topic/Placeholder%20liveness%20aside/near/250959759" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/186049-t-compiler/wg-polonius/topic/Placeholder.20liveness.20aside.html#250959759">(Aug 27 2021 at 16:47)</a>:</h4>
<p>but I don't remember the difficulties I encountered</p>



<a name="250960012"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/186049-t-compiler/wg-polonius/topic/Placeholder%20liveness%20aside/near/250960012" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> lqd <a href="https://zulip-archive.rust-lang.org/stream/186049-t-compiler/wg-polonius/topic/Placeholder.20liveness.20aside.html#250960012">(Aug 27 2021 at 16:49)</a>:</h4>
<p>e.g it happens in <a href="https://github.com/rust-lang/rust/blob/master/src/test/ui/numbers-arithmetic/saturating-float-casts-impl.rs">https://github.com/rust-lang/rust/blob/master/src/test/ui/numbers-arithmetic/saturating-float-casts-impl.rs</a> but that's hard to see here, it's somewhat hidden in the implementation of assert_eq vs assert</p>



<a name="250960123"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/186049-t-compiler/wg-polonius/topic/Placeholder%20liveness%20aside/near/250960123" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/186049-t-compiler/wg-polonius/topic/Placeholder.20liveness.20aside.html#250960123">(Aug 27 2021 at 16:50)</a>:</h4>
<p>I do "have it in for" Locations::All</p>



<a name="250960127"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/186049-t-compiler/wg-polonius/topic/Placeholder%20liveness%20aside/near/250960127" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/186049-t-compiler/wg-polonius/topic/Placeholder.20liveness.20aside.html#250960127">(Aug 27 2021 at 16:50)</a>:</h4>
<p>it annoys me</p>



<a name="250960141"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/186049-t-compiler/wg-polonius/topic/Placeholder%20liveness%20aside/near/250960141" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> lqd <a href="https://zulip-archive.rust-lang.org/stream/186049-t-compiler/wg-polonius/topic/Placeholder.20liveness.20aside.html#250960141">(Aug 27 2021 at 16:50)</a>:</h4>
<p>(so, likely here that's about either params or the return place in this example)</p>



<a name="250960261"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/186049-t-compiler/wg-polonius/topic/Placeholder%20liveness%20aside/near/250960261" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> lqd <a href="https://zulip-archive.rust-lang.org/stream/186049-t-compiler/wg-polonius/topic/Placeholder.20liveness.20aside.html#250960261">(Aug 27 2021 at 16:51)</a>:</h4>
<p>(the materialization was here <a href="https://github.com/rust-lang/rust/blob/8301de16dafc81a3b5d94aa0707ad83bdb56a599/src/librustc_mir/borrow_check/nll/type_check/mod.rs#L229-L233">https://github.com/rust-lang/rust/blob/8301de16dafc81a3b5d94aa0707ad83bdb56a599/src/librustc_mir/borrow_check/nll/type_check/mod.rs#L229-L233</a> -- this has since be moved to a different file but I had that link handy)</p>



<a name="250960376"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/186049-t-compiler/wg-polonius/topic/Placeholder%20liveness%20aside/near/250960376" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> lqd <a href="https://zulip-archive.rust-lang.org/stream/186049-t-compiler/wg-polonius/topic/Placeholder.20liveness.20aside.html#250960376">(Aug 27 2021 at 16:52)</a>:</h4>
<p>(for this example, my notes at the time: 130752 outlives constraints at all points x 170646 points in the CFG)</p>



<a name="250961160"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/186049-t-compiler/wg-polonius/topic/Placeholder%20liveness%20aside/near/250961160" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Dylan MacKenzie (ecstatic-morse) <a href="https://zulip-archive.rust-lang.org/stream/186049-t-compiler/wg-polonius/topic/Placeholder.20liveness.20aside.html#250961160">(Aug 27 2021 at 16:57)</a>:</h4>
<p>Okay, well I can look for where we generate <code>Locations::All</code> outlives constraints and categorize them</p>



<hr><p>Last updated: Apr 12 2022 at 20:01 UTC</p>
</html>