<html>
<head><meta charset="utf-8"><title>DDLog · t-compiler/wg-polonius · Zulip Chat Archive</title></head>
<h2>Stream: <a href="https://zulip-archive.rust-lang.org/stream/186049-t-compiler/wg-polonius/index.html">t-compiler/wg-polonius</a></h2>
<h3>Topic: <a href="https://zulip-archive.rust-lang.org/stream/186049-t-compiler/wg-polonius/topic/DDLog.html">DDLog</a></h3>

<hr>

<base href="https://rust-lang.zulipchat.com">

<head><link href="https://zulip-archive.rust-lang.org/style.css" rel="stylesheet"></head>

<a name="260032040"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/186049-t-compiler/wg-polonius/topic/DDLog/near/260032040" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Dylan MacKenzie (ecstatic-morse) <a href="https://zulip-archive.rust-lang.org/stream/186049-t-compiler/wg-polonius/topic/DDLog.html#260032040">(Nov 02 2021 at 17:43)</a>:</h4>
<p>So <span class="user-mention silent" data-user-id="337115">Domenic Quirl</span> I'm reading through your differential datalog (DDLog) version now.</p>
<p>The original Polonius prototype was implemented in differential data<em>flow</em>, Frank's library that now forms the backend of DDLog. Incremental computation doesn't help our use-case, and that library has the same usability issues as <code>datafrog</code> (there's no frontend), which is why I was dismissive of DDLog  when you brought it up originally; I wasn't aware that a frontend existed that was competitive with Souffle in terms of features.</p>



<a name="260032448"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/186049-t-compiler/wg-polonius/topic/DDLog/near/260032448" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Dylan MacKenzie (ecstatic-morse) <a href="https://zulip-archive.rust-lang.org/stream/186049-t-compiler/wg-polonius/topic/DDLog.html#260032448">(Nov 02 2021 at 17:46)</a>:</h4>
<p>DDLog also generates libraries with a Rust interface instead of  Souffle's messy C++ one, which is nice.</p>



<a name="260032770"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/186049-t-compiler/wg-polonius/topic/DDLog/near/260032770" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Dylan MacKenzie (ecstatic-morse) <a href="https://zulip-archive.rust-lang.org/stream/186049-t-compiler/wg-polonius/topic/DDLog.html#260032770">(Nov 02 2021 at 17:48)</a>:</h4>
<p>I bring this up because if we end up wanting to port more of fact generation to datalog, we might want to switch to DDLog because it has first-class data structures.</p>



<a name="260032879"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/186049-t-compiler/wg-polonius/topic/DDLog/near/260032879" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> lqd <a href="https://zulip-archive.rust-lang.org/stream/186049-t-compiler/wg-polonius/topic/DDLog.html#260032879">(Nov 02 2021 at 17:49)</a>:</h4>
<p>it generates some rust code that uses DD, right ?</p>



<a name="260033050"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/186049-t-compiler/wg-polonius/topic/DDLog/near/260033050" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Dylan MacKenzie (ecstatic-morse) <a href="https://zulip-archive.rust-lang.org/stream/186049-t-compiler/wg-polonius/topic/DDLog.html#260033050">(Nov 02 2021 at 17:50)</a>:</h4>
<p>(I'm not sure if we actually want to do this. I implemented a derived <code>invalidate_xxxx</code> as a datalog program during the sprint and it felt a bit silly TBH)</p>



<a name="260033068"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/186049-t-compiler/wg-polonius/topic/DDLog/near/260033068" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Dylan MacKenzie (ecstatic-morse) <a href="https://zulip-archive.rust-lang.org/stream/186049-t-compiler/wg-polonius/topic/DDLog.html#260033068">(Nov 02 2021 at 17:50)</a>:</h4>
<div class="codehilite" data-code-language="Prolog"><pre><span></span><code><span class="o">//</span> <span class="nv">Shared</span> <span class="s s-Atom">types</span>
<span class="p">.</span><span class="s s-Atom">type</span> <span class="nv">Origin</span> <span class="s s-Atom">&lt;:</span> <span class="s s-Atom">symbol</span>
<span class="p">.</span><span class="s s-Atom">type</span> <span class="nv">Node</span> <span class="s s-Atom">&lt;:</span> <span class="s s-Atom">symbol</span>

<span class="p">.</span><span class="s s-Atom">type</span> <span class="nv">Ident</span> <span class="s s-Atom">&lt;:</span> <span class="s s-Atom">symbol</span>

<span class="o">//</span> <span class="nv">A</span> <span class="s s-Atom">field</span> <span class="s s-Atom">or</span> <span class="s s-Atom">deref</span> <span class="s s-Atom">projection</span><span class="p">.</span> <span class="nv">A</span> <span class="s s-Atom">deref</span> <span class="s s-Atom">projection</span> <span class="o">is</span> <span class="s s-Atom">the</span> <span class="s s-Atom">literal</span> <span class="s2">"*"</span><span class="p">.</span> <span class="nv">Every</span>
<span class="o">//</span> <span class="s s-Atom">other</span> <span class="s s-Atom">symbol</span> <span class="o">is</span> <span class="s s-Atom">treated</span> <span class="s s-Atom">as</span> <span class="s s-Atom">the</span> <span class="s s-Atom">name</span> <span class="s s-Atom">of</span> <span class="s s-Atom">a</span> <span class="s s-Atom">field</span><span class="p">.</span>
<span class="p">.</span><span class="s s-Atom">type</span> <span class="nv">Projection</span> <span class="s s-Atom">&lt;:</span> <span class="s s-Atom">symbol</span>

<span class="o">//</span> <span class="nv">A</span> <span class="s s-Atom">base</span> <span class="s s-Atom">variable</span> <span class="s s-Atom">with</span> <span class="s s-Atom">any</span> <span class="s s-Atom">number</span> <span class="s s-Atom">of</span> <span class="s s-Atom">field</span><span class="o">/</span><span class="s s-Atom">deref</span> <span class="s s-Atom">projections</span><span class="p">.</span>
<span class="o">//</span>
<span class="o">//</span> <span class="nv">For</span> <span class="s s-Atom">example</span><span class="p">,</span> <span class="err">`</span><span class="s s-Atom">base</span><span class="p">.</span><span class="s s-Atom">f1</span><span class="p">.</span><span class="s s-Atom">f2</span><span class="err">`</span> <span class="s s-Atom">would</span> <span class="s s-Atom">be</span> <span class="s s-Atom">represented</span> <span class="s s-Atom">as</span> <span class="err">`</span><span class="p">[</span><span class="s2">"base"</span><span class="p">,</span> <span class="p">[[</span><span class="s s-Atom">nil</span><span class="p">,</span> <span class="s2">"f1"</span><span class="p">],</span> <span class="s2">"f2"</span><span class="p">]]</span><span class="err">`</span><span class="p">.</span>
<span class="p">.</span><span class="s s-Atom">type</span> <span class="nv">MovePath</span> <span class="o">=</span> <span class="p">[</span> <span class="nn">base</span><span class="p">:</span> <span class="nv">Ident</span><span class="p">,</span> <span class="nn">projections</span><span class="p">:</span> <span class="nv">ProjectionList</span> <span class="p">]</span>

<span class="p">.</span><span class="s s-Atom">type</span> <span class="nv">AccessKind</span> <span class="o">=</span> <span class="nv">Read</span> <span class="p">{}</span> <span class="p">|</span> <span class="nv">Write</span> <span class="p">{}</span>
<span class="p">.</span><span class="s s-Atom">type</span> <span class="nv">AccessDepth</span> <span class="o">=</span> <span class="nv">Shallow</span> <span class="p">{}</span> <span class="p">|</span> <span class="nv">Deep</span> <span class="p">{}</span>
<span class="p">.</span><span class="s s-Atom">type</span> <span class="nv">Access</span> <span class="o">=</span> <span class="p">[</span> <span class="nn">kind</span><span class="p">:</span> <span class="nv">AccessKind</span><span class="p">,</span> <span class="nn">depth</span><span class="p">:</span> <span class="nv">AccessDepth</span> <span class="p">]</span>
<span class="p">.</span><span class="s s-Atom">type</span> <span class="nv">BorrowKind</span> <span class="o">=</span> <span class="nv">Shared</span> <span class="p">{}</span> <span class="p">|</span> <span class="nv">Unique</span> <span class="p">{}</span>

<span class="p">.</span><span class="s s-Atom">type</span> <span class="nv">ProjectionList</span> <span class="o">=</span> <span class="p">[</span>
    <span class="nn">head</span><span class="p">:</span> <span class="nv">ProjectionList</span><span class="p">,</span>
    <span class="nn">tail</span><span class="p">:</span> <span class="nv">Projection</span>
<span class="p">]</span>

<span class="o">//</span> <span class="nv">The</span> <span class="s s-Atom">loan</span> <span class="s s-Atom">with</span> <span class="s s-Atom">the</span> <span class="s s-Atom">given</span> <span class="s s-Atom">origin</span> <span class="o">is</span> <span class="s s-Atom">a</span> <span class="s s-Atom">borrow</span> <span class="s s-Atom">of</span> <span class="s s-Atom">the</span> <span class="s s-Atom">given</span> <span class="s s-Atom">path</span><span class="p">.</span>
<span class="p">.</span><span class="s s-Atom">decl</span> <span class="nf">loan_path</span><span class="p">(</span><span class="nn">loan</span><span class="p">:</span> <span class="nv">Origin</span><span class="p">,</span> <span class="nn">b</span><span class="p">:</span> <span class="nv">BorrowKind</span><span class="p">,</span> <span class="nn">p</span><span class="p">:</span> <span class="nv">MovePath</span><span class="p">)</span>
<span class="p">.</span><span class="s s-Atom">input</span> <span class="s s-Atom">loan_path</span>


<span class="o">//</span> <span class="nv">The</span> <span class="s s-Atom">given</span> <span class="s s-Atom">path</span> <span class="o">is</span> <span class="s s-Atom">accessed</span> <span class="s s-Atom">at</span> <span class="s s-Atom">this</span> <span class="s s-Atom">point</span> <span class="s s-Atom">in</span> <span class="s s-Atom">the</span> <span class="nv">CFG</span><span class="p">.</span>
<span class="p">.</span><span class="s s-Atom">decl</span> <span class="nf">access_path</span><span class="p">(</span><span class="nn">p</span><span class="p">:</span> <span class="nv">MovePath</span><span class="p">,</span> <span class="nn">a</span><span class="p">:</span> <span class="nv">Access</span><span class="p">,</span> <span class="nn">n</span><span class="p">:</span> <span class="nv">Node</span><span class="p">)</span>
<span class="p">.</span><span class="s s-Atom">input</span> <span class="s s-Atom">access_path</span>

<span class="o">//</span> <span class="nv">All</span> <span class="err">`</span><span class="nv">MovePath</span><span class="err">`</span><span class="s s-Atom">s</span> <span class="s s-Atom">that</span> <span class="s s-Atom">appear</span> <span class="s s-Atom">in</span> <span class="s s-Atom">the</span> <span class="s s-Atom">input</span> <span class="s s-Atom">program</span><span class="p">.</span>
<span class="p">.</span><span class="s s-Atom">decl</span> <span class="nf">is_path</span><span class="p">(</span><span class="nn">p</span><span class="p">:</span> <span class="nv">MovePath</span><span class="p">)</span>

<span class="nf">is_path</span><span class="p">(</span><span class="s s-Atom">p</span><span class="p">)</span> <span class="p">:-</span> <span class="nf">loan_path</span><span class="p">(</span><span class="k">_</span><span class="p">,</span> <span class="k">_</span><span class="p">,</span> <span class="s s-Atom">p</span><span class="p">).</span>
<span class="nf">is_path</span><span class="p">(</span><span class="s s-Atom">p</span><span class="p">)</span> <span class="p">:-</span> <span class="nf">access_path</span><span class="p">(</span><span class="s s-Atom">p</span><span class="p">,</span> <span class="k">_</span><span class="p">,</span> <span class="k">_</span><span class="p">).</span>


<span class="o">//</span> <span class="nv">Encodes</span> <span class="nv">Rust</span><span class="err">'</span><span class="s s-Atom">s</span> <span class="s s-Atom">shared</span> <span class="nv">XOR</span> <span class="s s-Atom">mutable</span> <span class="s s-Atom">rules</span><span class="p">.</span>
<span class="o">//</span>
<span class="o">//</span> <span class="o">-</span> <span class="nv">Reads</span> <span class="s s-Atom">invalidate</span> <span class="s s-Atom">writes</span> <span class="s s-Atom">but</span> <span class="o">not</span> <span class="s s-Atom">other</span> <span class="s s-Atom">reads</span><span class="p">.</span>
<span class="o">//</span> <span class="o">-</span> <span class="nv">Writes</span> <span class="s s-Atom">invalidate</span> <span class="s s-Atom">both</span> <span class="s s-Atom">reads</span> <span class="s s-Atom">and</span> <span class="s s-Atom">writes</span><span class="p">.</span>
<span class="p">.</span><span class="s s-Atom">decl</span> <span class="nf">access_invalidates_borrow</span><span class="p">(</span><span class="nn">a</span><span class="p">:</span> <span class="nv">AccessKind</span><span class="p">,</span> <span class="nn">b</span><span class="p">:</span> <span class="nv">BorrowKind</span><span class="p">)</span>

<span class="nf">access_invalidates_borrow</span><span class="p">(</span><span class="err">$</span><span class="nv">Read</span><span class="p">,</span> <span class="err">$</span><span class="nv">Unique</span><span class="p">).</span>
<span class="nf">access_invalidates_borrow</span><span class="p">(</span><span class="err">$</span><span class="nv">Write</span><span class="p">,</span> <span class="err">$</span><span class="nv">Unique</span><span class="p">).</span>
<span class="nf">access_invalidates_borrow</span><span class="p">(</span><span class="err">$</span><span class="nv">Write</span><span class="p">,</span> <span class="err">$</span><span class="nv">Shared</span><span class="p">).</span>


<span class="o">//</span> <span class="nv">Contains</span> <span class="s s-Atom">all</span> <span class="s s-Atom">prefixes</span> <span class="s s-Atom">of</span> <span class="s s-Atom">the</span> <span class="s s-Atom">list</span> <span class="s s-Atom">on</span> <span class="s s-Atom">the</span> <span class="s s-Atom">left</span><span class="o">-</span><span class="s s-Atom">hand</span> <span class="s s-Atom">side</span><span class="p">.</span>
<span class="p">.</span><span class="s s-Atom">decl</span> <span class="nf">prefix</span><span class="p">(</span><span class="nn">list</span><span class="p">:</span> <span class="nv">ProjectionList</span><span class="p">,</span> <span class="nn">prefix</span><span class="p">:</span> <span class="nv">ProjectionList</span><span class="p">)</span>

<span class="nf">prefix</span><span class="p">(</span><span class="s s-Atom">p</span><span class="p">,</span> <span class="s s-Atom">p</span><span class="p">)</span> <span class="p">:-</span> <span class="nf">is_path</span><span class="p">([</span><span class="k">_</span><span class="p">,</span> <span class="s s-Atom">p</span><span class="p">]).</span>
<span class="nf">prefix</span><span class="p">(</span><span class="s s-Atom">list</span><span class="p">,</span> <span class="s s-Atom">prefix</span><span class="p">)</span> <span class="p">:-</span>
    <span class="nf">prefix</span><span class="p">(</span><span class="s s-Atom">list</span><span class="p">,</span> <span class="p">[</span><span class="s s-Atom">prefix</span><span class="p">,</span> <span class="k">_</span><span class="p">]).</span>


<span class="o">//</span> <span class="nv">Contains</span> <span class="s s-Atom">all</span> <span class="s s-Atom">prefixes</span> <span class="s s-Atom">of</span> <span class="s s-Atom">the</span> <span class="s s-Atom">list</span> <span class="s s-Atom">on</span> <span class="s s-Atom">the</span> <span class="s s-Atom">left</span><span class="o">-</span><span class="s s-Atom">hand</span> <span class="s s-Atom">side</span><span class="p">,</span> <span class="s s-Atom">but</span> <span class="s s-Atom">stops</span> <span class="s s-Atom">at</span>
<span class="o">//</span> <span class="err">`</span><span class="nv">Deref</span><span class="err">`</span> <span class="s s-Atom">projections</span><span class="p">.</span>
<span class="p">.</span><span class="s s-Atom">decl</span> <span class="nf">shallow_prefix</span><span class="p">(</span><span class="nn">list</span><span class="p">:</span> <span class="nv">ProjectionList</span><span class="p">,</span> <span class="nn">prefix</span><span class="p">:</span> <span class="nv">ProjectionList</span><span class="p">)</span>

<span class="nf">shallow_prefix</span><span class="p">(</span><span class="s s-Atom">p</span><span class="p">,</span> <span class="s s-Atom">p</span><span class="p">)</span> <span class="p">:-</span> <span class="nf">is_path</span><span class="p">([</span><span class="k">_</span><span class="p">,</span> <span class="s s-Atom">p</span><span class="p">]).</span>
<span class="nf">shallow_prefix</span><span class="p">(</span><span class="s s-Atom">list</span><span class="p">,</span> <span class="s s-Atom">prefix</span><span class="p">)</span> <span class="p">:-</span>
    <span class="nf">shallow_prefix</span><span class="p">(</span><span class="s s-Atom">list</span><span class="p">,</span> <span class="p">[</span><span class="s s-Atom">prefix</span><span class="p">,</span> <span class="s s-Atom">proj</span><span class="p">]),</span>
    <span class="s s-Atom">proj</span> <span class="p">!</span><span class="o">=</span> <span class="s2">"*"</span><span class="p">.</span>


<span class="p">.</span><span class="s s-Atom">decl</span> <span class="nf">invalidate_origin</span><span class="p">(</span><span class="nn">o</span><span class="p">:</span> <span class="nv">Origin</span><span class="p">,</span> <span class="nn">n</span><span class="p">:</span> <span class="nv">Node</span><span class="p">)</span>

<span class="nf">invalidate_origin</span><span class="p">(</span><span class="s s-Atom">o</span><span class="p">,</span> <span class="s s-Atom">n</span><span class="p">)</span> <span class="p">:-</span>
   <span class="nf">loan_path</span><span class="p">(</span><span class="s s-Atom">o</span><span class="p">,</span> <span class="s s-Atom">borrow_kind</span><span class="p">,</span> <span class="p">[</span><span class="s s-Atom">loan_base</span><span class="p">,</span> <span class="s s-Atom">loan_proj</span><span class="p">]),</span>
   <span class="nf">access_path</span><span class="p">([</span><span class="s s-Atom">access_base</span><span class="p">,</span> <span class="s s-Atom">access_proj</span><span class="p">],</span> <span class="p">[</span><span class="s s-Atom">access_kind</span><span class="p">,</span> <span class="s s-Atom">access_depth</span><span class="p">],</span> <span class="s s-Atom">n</span><span class="p">),</span>
   <span class="nf">access_invalidates_borrow</span><span class="p">(</span><span class="s s-Atom">access_kind</span><span class="p">,</span> <span class="s s-Atom">borrow_kind</span><span class="p">),</span>
   <span class="s s-Atom">loan_base</span> <span class="o">=</span> <span class="s s-Atom">access_base</span><span class="p">,</span>
   <span class="nf">projection_conflicts_with</span><span class="p">(</span><span class="s s-Atom">access_proj</span><span class="p">,</span> <span class="s s-Atom">loan_proj</span><span class="p">,</span> <span class="s s-Atom">access_depth</span><span class="p">).</span>


<span class="p">.</span><span class="s s-Atom">decl</span> <span class="nf">projection_conflicts_with</span><span class="p">(</span><span class="nn">a</span><span class="p">:</span> <span class="nv">ProjectionList</span><span class="p">,</span> <span class="nn">b</span><span class="p">:</span> <span class="nv">ProjectionList</span><span class="p">,</span> <span class="nn">depth</span><span class="p">:</span> <span class="nv">AccessDepth</span><span class="p">)</span> <span class="s s-Atom">inline</span>

<span class="nf">projection_conflicts_with</span><span class="p">(</span><span class="s s-Atom">a</span><span class="p">,</span> <span class="s s-Atom">b</span><span class="p">,</span> <span class="err">$</span><span class="nv">Deep</span><span class="p">)</span> <span class="p">:-</span>
    <span class="nf">prefix</span><span class="p">(</span><span class="s s-Atom">a</span><span class="p">,</span> <span class="s s-Atom">b</span><span class="p">);</span> <span class="nf">prefix</span><span class="p">(</span><span class="s s-Atom">b</span><span class="p">,</span> <span class="s s-Atom">a</span><span class="p">).</span>

<span class="nf">projection_conflicts_with</span><span class="p">(</span><span class="s s-Atom">a</span><span class="p">,</span> <span class="s s-Atom">b</span><span class="p">,</span> <span class="err">$</span><span class="nv">Shallow</span><span class="p">)</span> <span class="p">:-</span>
    <span class="nf">shallow_prefix</span><span class="p">(</span><span class="s s-Atom">a</span><span class="p">,</span> <span class="s s-Atom">b</span><span class="p">);</span> <span class="nf">shallow_prefix</span><span class="p">(</span><span class="s s-Atom">b</span><span class="p">,</span> <span class="s s-Atom">a</span><span class="p">).</span>
</code></pre></div>



<a name="260033763"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/186049-t-compiler/wg-polonius/topic/DDLog/near/260033763" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> lqd <a href="https://zulip-archive.rust-lang.org/stream/186049-t-compiler/wg-polonius/topic/DDLog.html#260033763">(Nov 02 2021 at 17:55)</a>:</h4>
<p>cute :)</p>



<a name="260034017"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/186049-t-compiler/wg-polonius/topic/DDLog/near/260034017" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> lqd <a href="https://zulip-archive.rust-lang.org/stream/186049-t-compiler/wg-polonius/topic/DDLog.html#260034017">(Nov 02 2021 at 17:57)</a>:</h4>
<p>(we can do whatever we want in polonius, but not in polonius-engine or rustc -- and back then, and probably still today, making rustc use DD was a tough sell)</p>



<a name="260109975"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/186049-t-compiler/wg-polonius/topic/DDLog/near/260109975" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Domenic Quirl <a href="https://zulip-archive.rust-lang.org/stream/186049-t-compiler/wg-polonius/topic/DDLog.html#260109975">(Nov 03 2021 at 09:52)</a>:</h4>
<p>So, let me say a few things. </p>
<ol>
<li>
<p>The reason I did this in DDLog was purely because I needed a way to track which origins need to be live for a subset constraint to hold, and which of these are seen to be accessed, so that at some point you can know that all origins for some entry are indeed live and this can become an actual constraint. I tried to do this in Soufflé with their ADTs, but it was super painful, especially while I was still figuring out what the rules even need to look like (partly because with ADTs you then need to duplicate any rule for all of the relevant ADT input -&gt; output combinations, since there are no operations on them). Having sets and set operations available in DDLog made this tremendously easier.</p>
</li>
<li>
<p>This was not an attempt to specifically "push" DDLog for the rest of the project. In particular, I fully expected this to either not work out at all, or at least be worse than what we already have currently (it looks like at least the latter is true ^^).</p>
</li>
<li>
<p>We indeed don't need a fully incremental computation. There is a bit of a distinction to make here, since I believe DDLog/the underlying differential dataflow the mechanism for incremental inputs is basically the same as the mechanism to iteratively update facts for relations that form a cycle, which is something we <em>definitely</em> have. So it's not like all of this exists to no use whatsoever. However, the fact that DDLog does not know that our input facts are static <em>can</em> be annoying, since it makes you have to be a bit careful about using negative assertions in cycles. As a concrete example, I ran into this when trying to express that the possible subsets are filtered by whether their requried origins are _not_ cleared at a certain node (I ended up expressing that as set interactions as well in order to avoid the problem).</p>
</li>
<li>
<p>The DDLog generates multiple Rust crates. In theory, you can even have <code>extern</code> rules, which you declare in the <code>.dl</code> and then implement in a corresponding Rust file. The usability of that is... improvable, though, to say the least, and at the moment such rules are not allowed as part of a cycle. A downside of using the DDLog executor is that you need to compile all of timely and ddflow, and even if you have them cached it takes a while to compile the specific, generated crates because of them interfacing with these 2 big crates. The comparison against our Soufflé rules is slightly unfair here, since Soufflé is pre-built and called as an external command, so maybe it would be more apt to compare that with your Rust -&gt; Soufflé back-end, but I don't have any idea about that. Point being that development iteration times on changing the rules are significantly higher than currently, because you need to run the DDLog compiler (which is fairly fast, but an extra step) and then re-compile for a good while even in Debug, whereas currently as long as only the <code>.dl</code> file is edited there is no re-compilation at all.</p>
</li>
</ol>



<a name="260127152"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/186049-t-compiler/wg-polonius/topic/DDLog/near/260127152" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/186049-t-compiler/wg-polonius/topic/DDLog.html#260127152">(Nov 03 2021 at 12:36)</a>:</h4>
<p>I would say that while we don't have need of incremental updates now, we might at some point</p>



<a name="260205136"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/186049-t-compiler/wg-polonius/topic/DDLog/near/260205136" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Dylan MacKenzie (ecstatic-morse) <a href="https://zulip-archive.rust-lang.org/stream/186049-t-compiler/wg-polonius/topic/DDLog.html#260205136">(Nov 03 2021 at 22:16)</a>:</h4>
<blockquote>
<p>I tried to do this in Soufflé with their ADTs, but it was super painful, especially while I was still figuring out what the rules even need to look like (partly because with ADTs you then need to duplicate any rule for all of the relevant ADT input -&gt; output combinations, since there are no operations on them).</p>
</blockquote>
<p>I feel your pain. Dealing with move paths, which are inherently sequential, is unpleasant in Souffle since there is no first-class list type and thus simple operations like <code>prefix</code> need to be encoded manually.</p>
<blockquote>
<p>This was not an attempt to specifically "push" DDLog for the rest of the project. In particular, I fully expected this to either not work out at all, or at least be worse than what we already have currently (it looks like at least the latter is true ^^).</p>
</blockquote>
<p>I wasn't trying to imply this BTW. Just saying that I better understand the shortcomings of Souffle around ADTs (and the advantages of DDLog) now than I did when I picked Souffle for the backend for my datalog PR. I should have given DDLog a closer look, although we may have ended up in the same place. </p>
<blockquote>
<p>it makes you have to be a bit careful about using negative assertions in cycles.</p>
</blockquote>
<p>Out of curiosity, is DDLog different than Souffle in that regard? They both do stratified negation AFAICT.</p>



<a name="260262733"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/186049-t-compiler/wg-polonius/topic/DDLog/near/260262733" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Domenic Quirl <a href="https://zulip-archive.rust-lang.org/stream/186049-t-compiler/wg-polonius/topic/DDLog.html#260262733">(Nov 04 2021 at 12:33)</a>:</h4>
<p><span class="user-mention silent" data-user-id="118594">Dylan MacKenzie (ecstatic-morse)</span> <a href="#narrow/stream/186049-t-compiler.2Fwg-polonius/topic/DDLog/near/260205136">said</a>:</p>
<blockquote>
<p>Out of curiosity, is DDLog different than Souffle in that regard? They both do stratified negation AFAICT.</p>
</blockquote>
<p>This is correct, with some additional restrictions regarding things like <code>extern transformer</code>s</p>



<a name="260321443"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/186049-t-compiler/wg-polonius/topic/DDLog/near/260321443" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/186049-t-compiler/wg-polonius/topic/DDLog.html#260321443">(Nov 04 2021 at 19:24)</a>:</h4>
<p>DDLog does look kind of neat</p>



<a name="260321452"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/186049-t-compiler/wg-polonius/topic/DDLog/near/260321452" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/186049-t-compiler/wg-polonius/topic/DDLog.html#260321452">(Nov 04 2021 at 19:24)</a>:</h4>
<p>I didn't realize what it was</p>



<a name="260321467"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/186049-t-compiler/wg-polonius/topic/DDLog/near/260321467" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/186049-t-compiler/wg-polonius/topic/DDLog.html#260321467">(Nov 04 2021 at 19:24)</a>:</h4>
<p>however, I will say that datafrog was significantly faster than differential dataflow</p>



<a name="260321471"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/186049-t-compiler/wg-polonius/topic/DDLog/near/260321471" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/186049-t-compiler/wg-polonius/topic/DDLog.html#260321471">(Nov 04 2021 at 19:24)</a>:</h4>
<p>iirc</p>



<a name="260322977"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/186049-t-compiler/wg-polonius/topic/DDLog/near/260322977" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Dylan MacKenzie (ecstatic-morse) <a href="https://zulip-archive.rust-lang.org/stream/186049-t-compiler/wg-polonius/topic/DDLog.html#260322977">(Nov 04 2021 at 19:35)</a>:</h4>
<p>I found <a href="https://github.com/vmware/differential-datalog/issues/174#issuecomment-489867074">this comment</a> with a decent summary of features that Souffle has that are missing from DDLog.</p>



<a name="260323352"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/186049-t-compiler/wg-polonius/topic/DDLog/near/260323352" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Dylan MacKenzie (ecstatic-morse) <a href="https://zulip-archive.rust-lang.org/stream/186049-t-compiler/wg-polonius/topic/DDLog.html#260323352">(Nov 04 2021 at 19:39)</a>:</h4>
<p>Non-normalized disjunction is probably the big one.</p>



<a name="260323600"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/186049-t-compiler/wg-polonius/topic/DDLog/near/260323600" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> lqd <a href="https://zulip-archive.rust-lang.org/stream/186049-t-compiler/wg-polonius/topic/DDLog.html#260323600">(Nov 04 2021 at 19:41)</a>:</h4>
<p>did things maybe change since this comment was written ?</p>



<a name="260323663"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/186049-t-compiler/wg-polonius/topic/DDLog/near/260323663" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> lqd <a href="https://zulip-archive.rust-lang.org/stream/186049-t-compiler/wg-polonius/topic/DDLog.html#260323663">(Nov 04 2021 at 19:42)</a>:</h4>
<p>(the linked issues seem to be open still, so maybe not)</p>



<a name="260323710"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/186049-t-compiler/wg-polonius/topic/DDLog/near/260323710" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Dylan MacKenzie (ecstatic-morse) <a href="https://zulip-archive.rust-lang.org/stream/186049-t-compiler/wg-polonius/topic/DDLog.html#260323710">(Nov 04 2021 at 19:42)</a>:</h4>
<p>You can see which of the linked issues is still open.</p>



<a name="260323841"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/186049-t-compiler/wg-polonius/topic/DDLog/near/260323841" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Domenic Quirl <a href="https://zulip-archive.rust-lang.org/stream/186049-t-compiler/wg-polonius/topic/DDLog.html#260323841">(Nov 04 2021 at 19:43)</a>:</h4>
<p>This issue is specifically for the Soufflé converter, right?</p>



<a name="260323891"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/186049-t-compiler/wg-polonius/topic/DDLog/near/260323891" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Domenic Quirl <a href="https://zulip-archive.rust-lang.org/stream/186049-t-compiler/wg-polonius/topic/DDLog.html#260323891">(Nov 04 2021 at 19:43)</a>:</h4>
<p>Cause not having disjunctions on the DDLog side is also annoying (because you have to duplicate the rules into combinations yourself)</p>



<a name="260324096"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/186049-t-compiler/wg-polonius/topic/DDLog/near/260324096" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Dylan MacKenzie (ecstatic-morse) <a href="https://zulip-archive.rust-lang.org/stream/186049-t-compiler/wg-polonius/topic/DDLog.html#260324096">(Nov 04 2021 at 19:45)</a>:</h4>
<p><span class="user-mention silent" data-user-id="337115">Domenic Quirl</span> <a href="#narrow/stream/186049-t-compiler.2Fwg-polonius/topic/DDLog/near/260323841">said</a>:</p>
<blockquote>
<p>This issue is specifically for the Soufflé converter, right?</p>
</blockquote>
<p>Yes, but all the linked issues are shortcomings in DDLog itself AFAICT.</p>



<a name="260324199"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/186049-t-compiler/wg-polonius/topic/DDLog/near/260324199" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Dylan MacKenzie (ecstatic-morse) <a href="https://zulip-archive.rust-lang.org/stream/186049-t-compiler/wg-polonius/topic/DDLog.html#260324199">(Nov 04 2021 at 19:46)</a>:</h4>
<p><span class="user-mention silent" data-user-id="337115">Domenic Quirl</span> <a href="#narrow/stream/186049-t-compiler.2Fwg-polonius/topic/DDLog/near/260323891">said</a>:</p>
<blockquote>
<p>Cause not having disjunctions on the DDLog side is also annoying (because you have to duplicate the rules into combinations yourself)</p>
</blockquote>
<p>Yes. I saw you had a few 4x versions in your ruleset.</p>



<a name="260324255"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/186049-t-compiler/wg-polonius/topic/DDLog/near/260324255" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Domenic Quirl <a href="https://zulip-archive.rust-lang.org/stream/186049-t-compiler/wg-polonius/topic/DDLog.html#260324255">(Nov 04 2021 at 19:46)</a>:</h4>
<p>Breaking: combinatorial explosion bad</p>



<a name="260324376"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/186049-t-compiler/wg-polonius/topic/DDLog/near/260324376" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Domenic Quirl <a href="https://zulip-archive.rust-lang.org/stream/186049-t-compiler/wg-polonius/topic/DDLog.html#260324376">(Nov 04 2021 at 19:47)</a>:</h4>
<p>it does get annoying</p>



<a name="260324449"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/186049-t-compiler/wg-polonius/topic/DDLog/near/260324449" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Domenic Quirl <a href="https://zulip-archive.rust-lang.org/stream/186049-t-compiler/wg-polonius/topic/DDLog.html#260324449">(Nov 04 2021 at 19:48)</a>:</h4>
<p>but it's also a rather straightforward translation, so maybe can be added without too much effort?</p>



<a name="260324478"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/186049-t-compiler/wg-polonius/topic/DDLog/near/260324478" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Domenic Quirl <a href="https://zulip-archive.rust-lang.org/stream/186049-t-compiler/wg-polonius/topic/DDLog.html#260324478">(Nov 04 2021 at 19:48)</a>:</h4>
<p>I'll ask Kix about that</p>



<a name="260324512"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/186049-t-compiler/wg-polonius/topic/DDLog/near/260324512" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Dylan MacKenzie (ecstatic-morse) <a href="https://zulip-archive.rust-lang.org/stream/186049-t-compiler/wg-polonius/topic/DDLog.html#260324512">(Nov 04 2021 at 19:48)</a>:</h4>
<p>Yeah, I was kind of surprised as well.</p>



<a name="260474062"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/186049-t-compiler/wg-polonius/topic/DDLog/near/260474062" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> lqd <a href="https://zulip-archive.rust-lang.org/stream/186049-t-compiler/wg-polonius/topic/DDLog.html#260474062">(Nov 05 2021 at 22:52)</a>:</h4>
<p>heh the people from Soufflé have also been looking at DDLog <a href="https://souffle-lang.github.io/pdf/ppdp21incremental.pdf">https://souffle-lang.github.io/pdf/ppdp21incremental.pdf</a></p>



<hr><p>Last updated: Apr 12 2022 at 20:01 UTC</p>
</html>