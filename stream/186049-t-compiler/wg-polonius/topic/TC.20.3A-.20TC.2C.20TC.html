<html>
<head><meta charset="utf-8"><title>TC :- TC, TC · t-compiler/wg-polonius · Zulip Chat Archive</title></head>
<h2>Stream: <a href="https://zulip-archive.rust-lang.org/stream/186049-t-compiler/wg-polonius/index.html">t-compiler/wg-polonius</a></h2>
<h3>Topic: <a href="https://zulip-archive.rust-lang.org/stream/186049-t-compiler/wg-polonius/topic/TC.20.3A-.20TC.2C.20TC.html">TC :- TC, TC</a></h3>

<hr>

<base href="https://rust-lang.zulipchat.com">

<head><link href="https://zulip-archive.rust-lang.org/style.css" rel="stylesheet"></head>

<a name="248923588"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/186049-t-compiler/wg-polonius/topic/TC%20%3A-%20TC%2C%20TC/near/248923588" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> lqd <a href="https://zulip-archive.rust-lang.org/stream/186049-t-compiler/wg-polonius/topic/TC.20.3A-.20TC.2C.20TC.html#248923588">(Aug 09 2021 at 23:47)</a>:</h4>
<p>I think I remember one of the subtleties of doing it this way:  if you have </p>
<div class="codehilite" data-code-language="Prolog"><pre><span></span><code><span class="nf">subset</span><span class="p">(</span><span class="nv">Origin1</span><span class="p">,</span> <span class="nv">Origin3</span><span class="p">,</span> <span class="nv">Point</span><span class="p">)</span> <span class="p">:-</span>
  <span class="nf">subset</span><span class="p">(</span><span class="nv">Origin1</span><span class="p">,</span> <span class="nv">Origin2</span><span class="p">,</span> <span class="nv">Point</span><span class="p">),</span>
  <span class="nf">subset_base_cfg</span><span class="p">(</span><span class="nv">Origin2</span><span class="p">,</span> <span class="nv">Origin3</span><span class="p">,</span> <span class="nv">Point</span><span class="p">).</span>
</code></pre></div>
<p>you may also need</p>
<div class="codehilite" data-code-language="Prolog"><pre><span></span><code> <span class="nf">subset</span><span class="p">(</span><span class="nv">Origin1</span><span class="p">,</span> <span class="nv">Origin3</span><span class="p">,</span> <span class="nv">Point</span><span class="p">)</span> <span class="p">:-</span>
    <span class="nf">subset_base_cfg</span><span class="p">(</span><span class="nv">Origin1</span><span class="p">,</span> <span class="nv">Origin2</span><span class="p">,</span> <span class="nv">Point</span><span class="p">),</span>
    <span class="nf">subset</span><span class="p">(</span><span class="nv">Origin2</span><span class="p">,</span> <span class="nv">Origin3</span><span class="p">,</span> <span class="nv">Point</span><span class="p">).</span>
</code></pre></div>



<a name="248923781"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/186049-t-compiler/wg-polonius/topic/TC%20%3A-%20TC%2C%20TC/near/248923781" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> lqd <a href="https://zulip-archive.rust-lang.org/stream/186049-t-compiler/wg-polonius/topic/TC.20.3A-.20TC.2C.20TC.html#248923781">(Aug 09 2021 at 23:50)</a>:</h4>
<p>and IIRC even with that, there was another missing subtlety (or another mistake) to produce the exact same subsets</p>



<a name="248925671"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/186049-t-compiler/wg-polonius/topic/TC%20%3A-%20TC%2C%20TC/near/248925671" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Dylan MacKenzie (ecstatic-morse) <a href="https://zulip-archive.rust-lang.org/stream/186049-t-compiler/wg-polonius/topic/TC.20.3A-.20TC.2C.20TC.html#248925671">(Aug 10 2021 at 00:15)</a>:</h4>
<p><span class="user-mention silent" data-user-id="116113">lqd</span> <a href="#narrow/stream/186049-t-compiler.2Fwg-polonius/topic/TC.20.3A-.20TC.2C.20TC/near/248923588">said</a>:</p>
<blockquote>
<p>I think I remember one of the subtleties of doing it this way:  if you have </p>
<div class="codehilite" data-code-language="Prolog"><pre><span></span><code><span class="nf">subset</span><span class="p">(</span><span class="nv">Origin1</span><span class="p">,</span> <span class="nv">Origin3</span><span class="p">,</span> <span class="nv">Point</span><span class="p">)</span> <span class="p">:-</span>
  <span class="nf">subset</span><span class="p">(</span><span class="nv">Origin1</span><span class="p">,</span> <span class="nv">Origin2</span><span class="p">,</span> <span class="nv">Point</span><span class="p">),</span>
  <span class="nf">subset_base_cfg</span><span class="p">(</span><span class="nv">Origin2</span><span class="p">,</span> <span class="nv">Origin3</span><span class="p">,</span> <span class="nv">Point</span><span class="p">).</span>
</code></pre></div>
<p>you may also need</p>
<p><div class="codehilite" data-code-language="Prolog"><pre><span></span><code> <span class="nf">subset</span><span class="p">(</span><span class="nv">Origin1</span><span class="p">,</span> <span class="nv">Origin3</span><span class="p">,</span> <span class="nv">Point</span><span class="p">)</span> <span class="p">:-</span>
    <span class="nf">subset_base_cfg</span><span class="p">(</span><span class="nv">Origin1</span><span class="p">,</span> <span class="nv">Origin2</span><span class="p">,</span> <span class="nv">Point</span><span class="p">),</span>
    <span class="nf">subset</span><span class="p">(</span><span class="nv">Origin2</span><span class="p">,</span> <span class="nv">Origin3</span><span class="p">,</span> <span class="nv">Point</span><span class="p">).</span>
</code></pre></div><br>
</p>
</blockquote>
<p>I don't think that's right. One or the other will suffice. Not sure how to prove this without an appeal to authority, but if <code>subset(A, B)</code> means that you have a chain of <code>subset_base_cfg</code> relations that starts with <code>A</code> and ends with <code>B</code> (with any number of intermediaries), rule 1 can produce any facts that rule 2 can and vice versa.</p>



<a name="248925791"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/186049-t-compiler/wg-polonius/topic/TC%20%3A-%20TC%2C%20TC/near/248925791" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Dylan MacKenzie (ecstatic-morse) <a href="https://zulip-archive.rust-lang.org/stream/186049-t-compiler/wg-polonius/topic/TC.20.3A-.20TC.2C.20TC.html#248925791">(Aug 10 2021 at 00:17)</a>:</h4>
<p>Rule 1 just starts from <code>A</code> and works forward, while rule 2 starts from <code>B</code> and works backward</p>



<a name="248927567"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/186049-t-compiler/wg-polonius/topic/TC%20%3A-%20TC%2C%20TC/near/248927567" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> lqd <a href="https://zulip-archive.rust-lang.org/stream/186049-t-compiler/wg-polonius/topic/TC.20.3A-.20TC.2C.20TC.html#248927567">(Aug 10 2021 at 00:45)</a>:</h4>
<p>Then I’d like to make sure I understand the context of the rules in the issue: they are intended to replace the Naive rule 2, right ?</p>



<a name="248927648"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/186049-t-compiler/wg-polonius/topic/TC%20%3A-%20TC%2C%20TC/near/248927648" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Dylan MacKenzie (ecstatic-morse) <a href="https://zulip-archive.rust-lang.org/stream/186049-t-compiler/wg-polonius/topic/TC.20.3A-.20TC.2C.20TC.html#248927648">(Aug 10 2021 at 00:46)</a>:</h4>
<p>Correct.</p>



<a name="248927832"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/186049-t-compiler/wg-polonius/topic/TC%20%3A-%20TC%2C%20TC/near/248927832" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Dylan MacKenzie (ecstatic-morse) <a href="https://zulip-archive.rust-lang.org/stream/186049-t-compiler/wg-polonius/topic/TC.20.3A-.20TC.2C.20TC.html#248927832">(Aug 10 2021 at 00:49)</a>:</h4>
<p>(You'd also have to modify Rule 3 to work on <code>subset_base_cfg</code>)</p>



<a name="248928829"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/186049-t-compiler/wg-polonius/topic/TC%20%3A-%20TC%2C%20TC/near/248928829" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> lqd <a href="https://zulip-archive.rust-lang.org/stream/186049-t-compiler/wg-polonius/topic/TC.20.3A-.20TC.2C.20TC.html#248928829">(Aug 10 2021 at 01:02)</a>:</h4>
<p>ok now I can't sleep and have to try it</p>



<a name="248931035"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/186049-t-compiler/wg-polonius/topic/TC%20%3A-%20TC%2C%20TC/near/248931035" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> lqd <a href="https://zulip-archive.rust-lang.org/stream/186049-t-compiler/wg-polonius/topic/TC.20.3A-.20TC.2C.20TC.html#248931035">(Aug 10 2021 at 01:39)</a>:</h4>
<p><span class="user-mention" data-user-id="118594">@Dylan MacKenzie (ecstatic-morse)</span> something like this ? <a href="https://gist.github.com/lqd/5d7e3960714197790b22b9c294e65b29">https://gist.github.com/lqd/5d7e3960714197790b22b9c294e65b29</a></p>



<a name="248931759"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/186049-t-compiler/wg-polonius/topic/TC%20%3A-%20TC%2C%20TC/near/248931759" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Dylan MacKenzie (ecstatic-morse) <a href="https://zulip-archive.rust-lang.org/stream/186049-t-compiler/wg-polonius/topic/TC.20.3A-.20TC.2C.20TC.html#248931759">(Aug 10 2021 at 01:52)</a>:</h4>
<p>I think some of the rules you have there are unnecessary. I believe you need exactly two rules (besides the initializers).</p>
<div class="codehilite" data-code-language="Prolog"><pre><span></span><code><span class="nf">subset_base_cfg</span><span class="p">(</span><span class="nv">O1</span><span class="p">,</span> <span class="nv">O2</span><span class="p">,</span> <span class="nv">P</span><span class="p">)</span> <span class="p">:-</span> <span class="nf">subset_base</span><span class="p">(</span><span class="nv">O1</span><span class="p">,</span> <span class="nv">O2</span><span class="p">,</span> <span class="nv">P</span><span class="p">).</span>

<span class="o">//</span> <span class="nv">Propagate</span> <span class="err">`</span><span class="s s-Atom">subset_base</span><span class="err">`</span> <span class="s s-Atom">across</span> <span class="s s-Atom">the</span> <span class="nv">CFG</span><span class="p">.</span>
<span class="nf">subset_base_cfg</span><span class="p">(</span><span class="nv">O1</span><span class="p">,</span> <span class="nv">O2</span><span class="p">,</span> <span class="nv">P2</span><span class="p">)</span> <span class="p">:-</span>
   <span class="nf">subset_base_cfg</span><span class="p">(</span><span class="nv">O1</span><span class="p">,</span> <span class="nv">O2</span><span class="p">,</span> <span class="nv">P1</span><span class="p">),</span>
   <span class="nf">cfg_edge</span><span class="p">(</span><span class="nv">P1</span><span class="p">,</span> <span class="nv">P2</span><span class="p">),</span>
   <span class="nf">origin_live_at</span><span class="p">(</span><span class="nv">O1</span><span class="p">,</span> <span class="nv">P2</span><span class="p">),</span>
   <span class="nf">origin_live_at</span><span class="p">(</span><span class="nv">O2</span><span class="p">,</span> <span class="nv">P2</span><span class="p">).</span>

<span class="nf">subset</span><span class="p">(</span><span class="nv">O1</span><span class="p">,</span> <span class="nv">O2</span><span class="p">,</span> <span class="nv">P</span><span class="p">)</span> <span class="p">:-</span> <span class="nf">subset_base_cfg</span><span class="p">(</span><span class="nv">O1</span><span class="p">,</span> <span class="nv">O2</span><span class="p">,</span> <span class="nv">P</span><span class="p">).</span>

<span class="o">//</span> <span class="nv">Compute</span> <span class="s s-Atom">the</span> <span class="s s-Atom">transitive</span> <span class="s s-Atom">closure</span> <span class="s s-Atom">of</span> <span class="err">`</span><span class="s s-Atom">subset_base_cfg</span><span class="err">`</span> <span class="s s-Atom">at</span> <span class="s s-Atom">each</span> <span class="s s-Atom">point</span>
<span class="nf">subset</span><span class="p">(</span><span class="nv">Origin1</span><span class="p">,</span> <span class="nv">Origin3</span><span class="p">,</span> <span class="nv">Point</span><span class="p">)</span> <span class="p">:-</span>
  <span class="nf">subset</span><span class="p">(</span><span class="nv">Origin1</span><span class="p">,</span> <span class="nv">Origin2</span><span class="p">,</span> <span class="nv">Point</span><span class="p">),</span>
  <span class="nf">subset_base_cfg</span><span class="p">(</span><span class="nv">Origin2</span><span class="p">,</span> <span class="nv">Origin3</span><span class="p">,</span> <span class="nv">Point</span><span class="p">).</span>
</code></pre></div>



<a name="248931843"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/186049-t-compiler/wg-polonius/topic/TC%20%3A-%20TC%2C%20TC/near/248931843" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Dylan MacKenzie (ecstatic-morse) <a href="https://zulip-archive.rust-lang.org/stream/186049-t-compiler/wg-polonius/topic/TC.20.3A-.20TC.2C.20TC.html#248931843">(Aug 10 2021 at 01:54)</a>:</h4>
<p>You're doing an extra propagation of <code>subset</code> across the CFG right?</p>



<a name="248931852"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/186049-t-compiler/wg-polonius/topic/TC%20%3A-%20TC%2C%20TC/near/248931852" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> lqd <a href="https://zulip-archive.rust-lang.org/stream/186049-t-compiler/wg-polonius/topic/TC.20.3A-.20TC.2C.20TC.html#248931852">(Aug 10 2021 at 01:54)</a>:</h4>
<p>that's why I asked whether you intended to replace rule 2</p>



<a name="248931896"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/186049-t-compiler/wg-polonius/topic/TC%20%3A-%20TC%2C%20TC/near/248931896" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> lqd <a href="https://zulip-archive.rust-lang.org/stream/186049-t-compiler/wg-polonius/topic/TC.20.3A-.20TC.2C.20TC.html#248931896">(Aug 10 2021 at 01:56)</a>:</h4>
<p>but I don't think only these 2 rules above will work</p>



<a name="248932030"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/186049-t-compiler/wg-polonius/topic/TC%20%3A-%20TC%2C%20TC/near/248932030" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> lqd <a href="https://zulip-archive.rust-lang.org/stream/186049-t-compiler/wg-polonius/topic/TC.20.3A-.20TC.2C.20TC.html#248932030">(Aug 10 2021 at 01:58)</a>:</h4>
<p>e.g. it seems to me they will only propagate subsets connecting 2 live origins, and not if there's a dead origin in between</p>



<a name="248932203"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/186049-t-compiler/wg-polonius/topic/TC%20%3A-%20TC%2C%20TC/near/248932203" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Dylan MacKenzie (ecstatic-morse) <a href="https://zulip-archive.rust-lang.org/stream/186049-t-compiler/wg-polonius/topic/TC.20.3A-.20TC.2C.20TC.html#248932203">(Aug 10 2021 at 02:00)</a>:</h4>
<p>Ah, of course, if we have <code>O1 -&gt; O2 -&gt; O3</code> and <code>O2</code> goes dead, we would remove the <code>subset_base_cfg</code> for <code>O2</code> and thus fail to compute its subsets.</p>



<a name="248932224"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/186049-t-compiler/wg-polonius/topic/TC%20%3A-%20TC%2C%20TC/near/248932224" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> lqd <a href="https://zulip-archive.rust-lang.org/stream/186049-t-compiler/wg-polonius/topic/TC.20.3A-.20TC.2C.20TC.html#248932224">(Aug 10 2021 at 02:00)</a>:</h4>
<p>(and yeah you can surely avoid checking liveness a million times like I did in the linked example) but with my 4AM brain, I wasn't getting the correct number of subsets without the extra propagations of subsets so I may be missing something</p>



<a name="248932281"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/186049-t-compiler/wg-polonius/topic/TC%20%3A-%20TC%2C%20TC/near/248932281" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Dylan MacKenzie (ecstatic-morse) <a href="https://zulip-archive.rust-lang.org/stream/186049-t-compiler/wg-polonius/topic/TC.20.3A-.20TC.2C.20TC.html#248932281">(Aug 10 2021 at 02:01)</a>:</h4>
<p>And that may not matter for <code>loan_live_at</code> because we do a separate propagation across the CFG for loans, but it does for placeholder subsets.</p>



<a name="248932286"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/186049-t-compiler/wg-polonius/topic/TC%20%3A-%20TC%2C%20TC/near/248932286" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> lqd <a href="https://zulip-archive.rust-lang.org/stream/186049-t-compiler/wg-polonius/topic/TC.20.3A-.20TC.2C.20TC.html#248932286">(Aug 10 2021 at 02:02)</a>:</h4>
<p>right exactly</p>



<a name="248932391"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/186049-t-compiler/wg-polonius/topic/TC%20%3A-%20TC%2C%20TC/near/248932391" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> lqd <a href="https://zulip-archive.rust-lang.org/stream/186049-t-compiler/wg-polonius/topic/TC.20.3A-.20TC.2C.20TC.html#248932391">(Aug 10 2021 at 02:03)</a>:</h4>
<p>but if we computed them like Opt does, it may Just Work TM</p>



<a name="248932485"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/186049-t-compiler/wg-polonius/topic/TC%20%3A-%20TC%2C%20TC/near/248932485" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Dylan MacKenzie (ecstatic-morse) <a href="https://zulip-archive.rust-lang.org/stream/186049-t-compiler/wg-polonius/topic/TC.20.3A-.20TC.2C.20TC.html#248932485">(Aug 10 2021 at 02:04)</a>:</h4>
<p>Well, wait does it matter for placeholder subsets? Since a placeholder subset error occurs if an invalid relationship happens at any point in the CFG, so I don't think we need the full <code>subset</code> for it either.</p>



<a name="248932499"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/186049-t-compiler/wg-polonius/topic/TC%20%3A-%20TC%2C%20TC/near/248932499" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> lqd <a href="https://zulip-archive.rust-lang.org/stream/186049-t-compiler/wg-polonius/topic/TC.20.3A-.20TC.2C.20TC.html#248932499">(Aug 10 2021 at 02:04)</a>:</h4>
<p>we only need the subsets downstream from placeholders</p>



<a name="248932504"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/186049-t-compiler/wg-polonius/topic/TC%20%3A-%20TC%2C%20TC/near/248932504" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Dylan MacKenzie (ecstatic-morse) <a href="https://zulip-archive.rust-lang.org/stream/186049-t-compiler/wg-polonius/topic/TC.20.3A-.20TC.2C.20TC.html#248932504">(Aug 10 2021 at 02:05)</a>:</h4>
<p>Yeah, it feels like we've reinvented <code>datafrog-opt</code></p>



<a name="248932525"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/186049-t-compiler/wg-polonius/topic/TC%20%3A-%20TC%2C%20TC/near/248932525" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> lqd <a href="https://zulip-archive.rust-lang.org/stream/186049-t-compiler/wg-polonius/topic/TC.20.3A-.20TC.2C.20TC.html#248932525">(Aug 10 2021 at 02:05)</a>:</h4>
<p>but simpler !</p>



<a name="248932611"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/186049-t-compiler/wg-polonius/topic/TC%20%3A-%20TC%2C%20TC/near/248932611" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> lqd <a href="https://zulip-archive.rust-lang.org/stream/186049-t-compiler/wg-polonius/topic/TC.20.3A-.20TC.2C.20TC.html#248932611">(Aug 10 2021 at 02:06)</a>:</h4>
<p>(this is what I was alluding to in my initial memories of this: "That difference likely doesn't matter to produce the facts about live loans we're interested in, e.g. the subset relation is also different between naive and opt and it doesn't matter there either")</p>



<a name="248932631"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/186049-t-compiler/wg-polonius/topic/TC%20%3A-%20TC%2C%20TC/near/248932631" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Dylan MacKenzie (ecstatic-morse) <a href="https://zulip-archive.rust-lang.org/stream/186049-t-compiler/wg-polonius/topic/TC.20.3A-.20TC.2C.20TC.html#248932631">(Aug 10 2021 at 02:07)</a>:</h4>
<p>I'll try to write this down this evening, probably in the context of documenting <code>datafrog-opt</code>.</p>



<a name="248932660"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/186049-t-compiler/wg-polonius/topic/TC%20%3A-%20TC%2C%20TC/near/248932660" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Dylan MacKenzie (ecstatic-morse) <a href="https://zulip-archive.rust-lang.org/stream/186049-t-compiler/wg-polonius/topic/TC.20.3A-.20TC.2C.20TC.html#248932660">(Aug 10 2021 at 02:07)</a>:</h4>
<p>But yeah, I do think this is equally as simple as the naive variant, and probably a bit faster to compute.</p>



<a name="248932716"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/186049-t-compiler/wg-polonius/topic/TC%20%3A-%20TC%2C%20TC/near/248932716" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> lqd <a href="https://zulip-archive.rust-lang.org/stream/186049-t-compiler/wg-polonius/topic/TC.20.3A-.20TC.2C.20TC.html#248932716">(Aug 10 2021 at 02:08)</a>:</h4>
<p>the quadratic number of tuples this join produces must make it pretty slower than not doing it that way</p>



<a name="248932745"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/186049-t-compiler/wg-polonius/topic/TC%20%3A-%20TC%2C%20TC/near/248932745" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> lqd <a href="https://zulip-archive.rust-lang.org/stream/186049-t-compiler/wg-polonius/topic/TC.20.3A-.20TC.2C.20TC.html#248932745">(Aug 10 2021 at 02:09)</a>:</h4>
<p>as-is opt must limit the number of subsets much more and so it could still be more efficient</p>



<a name="248932760"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/186049-t-compiler/wg-polonius/topic/TC%20%3A-%20TC%2C%20TC/near/248932760" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> lqd <a href="https://zulip-archive.rust-lang.org/stream/186049-t-compiler/wg-polonius/topic/TC.20.3A-.20TC.2C.20TC.html#248932760">(Aug 10 2021 at 02:10)</a>:</h4>
<p>s/could/should/</p>



<a name="248932822"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/186049-t-compiler/wg-polonius/topic/TC%20%3A-%20TC%2C%20TC/near/248932822" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> lqd <a href="https://zulip-archive.rust-lang.org/stream/186049-t-compiler/wg-polonius/topic/TC.20.3A-.20TC.2C.20TC.html#248932822">(Aug 10 2021 at 02:10)</a>:</h4>
<p>but after we filter everything not involved in the location insensitive pre-pass, it should be pretty close :)</p>



<a name="248932848"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/186049-t-compiler/wg-polonius/topic/TC%20%3A-%20TC%2C%20TC/near/248932848" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Dylan MacKenzie (ecstatic-morse) <a href="https://zulip-archive.rust-lang.org/stream/186049-t-compiler/wg-polonius/topic/TC.20.3A-.20TC.2C.20TC.html#248932848">(Aug 10 2021 at 02:11)</a>:</h4>
<p>Yeah, since it waits to propagate loans until the origin becomes dead, whereas naive propagates loans between live origins.</p>



<a name="248932924"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/186049-t-compiler/wg-polonius/topic/TC%20%3A-%20TC%2C%20TC/near/248932924" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> lqd <a href="https://zulip-archive.rust-lang.org/stream/186049-t-compiler/wg-polonius/topic/TC.20.3A-.20TC.2C.20TC.html#248932924">(Aug 10 2021 at 02:13)</a>:</h4>
<p>probably would be nice to try out the old cfg compression just to have an idea</p>



<a name="248933002"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/186049-t-compiler/wg-polonius/topic/TC%20%3A-%20TC%2C%20TC/near/248933002" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> lqd <a href="https://zulip-archive.rust-lang.org/stream/186049-t-compiler/wg-polonius/topic/TC.20.3A-.20TC.2C.20TC.html#248933002">(Aug 10 2021 at 02:15)</a>:</h4>
<p>(and w/ your leapers PR :)</p>



<a name="248933019"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/186049-t-compiler/wg-polonius/topic/TC%20%3A-%20TC%2C%20TC/near/248933019" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> lqd <a href="https://zulip-archive.rust-lang.org/stream/186049-t-compiler/wg-polonius/topic/TC.20.3A-.20TC.2C.20TC.html#248933019">(Aug 10 2021 at 02:15)</a>:</h4>
<p>in any case, there are a lot of opportunities to improve things</p>



<a name="248933079"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/186049-t-compiler/wg-polonius/topic/TC%20%3A-%20TC%2C%20TC/near/248933079" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Dylan MacKenzie (ecstatic-morse) <a href="https://zulip-archive.rust-lang.org/stream/186049-t-compiler/wg-polonius/topic/TC.20.3A-.20TC.2C.20TC.html#248933079">(Aug 10 2021 at 02:16)</a>:</h4>
<p><span class="user-mention silent" data-user-id="116113">lqd</span> <a href="#narrow/stream/186049-t-compiler.2Fwg-polonius/topic/TC.20.3A-.20TC.2C.20TC/near/248933019">said</a>:</p>
<blockquote>
<p>in any case, there are a lot of opportunities to improve things</p>
</blockquote>
<p>And I've been using that as an excuse not to do a higher-ranked  lifetimes deep-dive XD</p>



<a name="248933177"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/186049-t-compiler/wg-polonius/topic/TC%20%3A-%20TC%2C%20TC/near/248933177" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> lqd <a href="https://zulip-archive.rust-lang.org/stream/186049-t-compiler/wg-polonius/topic/TC.20.3A-.20TC.2C.20TC.html#248933177">(Aug 10 2021 at 02:18)</a>:</h4>
<p>same <span aria-label="upside down" class="emoji emoji-1f643" role="img" title="upside down">:upside_down:</span> (I've had the tabs of the couple HRTB test cases I need to try -- to see their universes -- open since we last spoke about it) (but also: vacation + moving house)</p>



<a name="248933212"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/186049-t-compiler/wg-polonius/topic/TC%20%3A-%20TC%2C%20TC/near/248933212" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Dylan MacKenzie (ecstatic-morse) <a href="https://zulip-archive.rust-lang.org/stream/186049-t-compiler/wg-polonius/topic/TC.20.3A-.20TC.2C.20TC.html#248933212">(Aug 10 2021 at 02:19)</a>:</h4>
<p>And 4AM datafrogging</p>



<a name="248933227"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/186049-t-compiler/wg-polonius/topic/TC%20%3A-%20TC%2C%20TC/near/248933227" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> lqd <a href="https://zulip-archive.rust-lang.org/stream/186049-t-compiler/wg-polonius/topic/TC.20.3A-.20TC.2C.20TC.html#248933227">(Aug 10 2021 at 02:19)</a>:</h4>
<p>it's always a good time to do some datafrogging</p>



<a name="248933307"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/186049-t-compiler/wg-polonius/topic/TC%20%3A-%20TC%2C%20TC/near/248933307" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Dylan MacKenzie (ecstatic-morse) <a href="https://zulip-archive.rust-lang.org/stream/186049-t-compiler/wg-polonius/topic/TC.20.3A-.20TC.2C.20TC.html#248933307">(Aug 10 2021 at 02:21)</a>:</h4>
<p>Thanks for chatting <span class="user-mention silent" data-user-id="116113">lqd</span>, it's quite nice to have someone to bounce ideas off of</p>



<a name="248933310"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/186049-t-compiler/wg-polonius/topic/TC%20%3A-%20TC%2C%20TC/near/248933310" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> lqd <a href="https://zulip-archive.rust-lang.org/stream/186049-t-compiler/wg-polonius/topic/TC.20.3A-.20TC.2C.20TC.html#248933310">(Aug 10 2021 at 02:21)</a>:</h4>
<p>but yeah I need to go to bed. I'll try to check if it's actually that easy to fix the non-quadratic TC impact on subset errors as soon as I can and keep you posted</p>



<a name="248933324"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/186049-t-compiler/wg-polonius/topic/TC%20%3A-%20TC%2C%20TC/near/248933324" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> lqd <a href="https://zulip-archive.rust-lang.org/stream/186049-t-compiler/wg-polonius/topic/TC.20.3A-.20TC.2C.20TC.html#248933324">(Aug 10 2021 at 02:21)</a>:</h4>
<p>absolutely ! I love it.</p>



<a name="248933331"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/186049-t-compiler/wg-polonius/topic/TC%20%3A-%20TC%2C%20TC/near/248933331" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> lqd <a href="https://zulip-archive.rust-lang.org/stream/186049-t-compiler/wg-polonius/topic/TC.20.3A-.20TC.2C.20TC.html#248933331">(Aug 10 2021 at 02:21)</a>:</h4>
<p>thank you too for chatting, always a pleasure !</p>



<hr><p>Last updated: Apr 12 2022 at 20:01 UTC</p>
</html>