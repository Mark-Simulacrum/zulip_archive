<html>
<head><meta charset="utf-8"><title>Algebraic Subtyping · t-compiler/wg-polonius · Zulip Chat Archive</title></head>
<h2>Stream: <a href="https://zulip-archive.rust-lang.org/stream/186049-t-compiler/wg-polonius/index.html">t-compiler/wg-polonius</a></h2>
<h3>Topic: <a href="https://zulip-archive.rust-lang.org/stream/186049-t-compiler/wg-polonius/topic/Algebraic.20Subtyping.html">Algebraic Subtyping</a></h3>

<hr>

<base href="https://rust-lang.zulipchat.com">

<head><link href="https://zulip-archive.rust-lang.org/style.css" rel="stylesheet"></head>

<a name="265255756"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/186049-t-compiler/wg-polonius/topic/Algebraic%20Subtyping/near/265255756" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Dylan MacKenzie (ecstatic-morse) <a href="https://zulip-archive.rust-lang.org/stream/186049-t-compiler/wg-polonius/topic/Algebraic.20Subtyping.html#265255756">(Dec 17 2021 at 05:26)</a>:</h4>
<p>I've been reading through Stephen Dolan's thesis as well as the "Simple Essence of Algebraic Subtyping", Lionel Parreaux's distilled version (which briefly discusses how one might handle invariance).</p>
<p>While skimming the references (and their references (and their references)), I also enjoyed <a href="https://users.cs.fiu.edu/~smithg/papers/scp94.pdf">Principal Type Schemes for Functional Programs with Overloading and Subtyping</a>, which seemed like a very straightforward approach to extending Hindley/Milner inference with bounded quantification. There's no notion of polar types and recursive subset constraints are forbidden (e.g.<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi mathvariant="normal">∀</mi><mi>t</mi><mi mathvariant="normal">.</mi><mi>t</mi><mo>⊆</mo><mi>t</mi><mo>→</mo><mi>b</mi><mi>o</mi><mi>o</mi><mi>l</mi></mrow><annotation encoding="application/x-tex">\forall t. t \subseteq t \rightarrow bool</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8304em;vertical-align:-0.136em;"></span><span class="mord">∀</span><span class="mord mathnormal">t</span><span class="mord">.</span><span class="mord mathnormal">t</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">⊆</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.6151em;"></span><span class="mord mathnormal">t</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">→</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.6944em;"></span><span class="mord mathnormal">b</span><span class="mord mathnormal">oo</span><span class="mord mathnormal" style="margin-right:0.01968em;">l</span></span></span></span>), which seems to make things simpler. It basically punts on entailment/subsumption (search for "satisfiability"), mentioning only that is exponentially complex. That's where the QE stuff would fit, although I think the point of Dolan (and Poittier's) work is that things can be made more efficient with polar types (?).</p>
<p>Anyways, is there anything else I should read? I was laser-focused on QE, since it seemed to solve the problems posed by Niko's blog posts. Clearly it's going to take a bit more than that <span aria-label="smile" class="emoji emoji-1f642" role="img" title="smile">:smile:</span>.</p>



<a name="265256702"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/186049-t-compiler/wg-polonius/topic/Algebraic%20Subtyping/near/265256702" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Dylan MacKenzie (ecstatic-morse) <a href="https://zulip-archive.rust-lang.org/stream/186049-t-compiler/wg-polonius/topic/Algebraic.20Subtyping.html#265256702">(Dec 17 2021 at 05:48)</a>:</h4>
<p>Specifically, was their prior art for the current rules around subtyping during inference? I didn't see anything in the dev guide, but maybe I missed it</p>



<a name="265259160"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/186049-t-compiler/wg-polonius/topic/Algebraic%20Subtyping/near/265259160" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Dylan MacKenzie (ecstatic-morse) <a href="https://zulip-archive.rust-lang.org/stream/186049-t-compiler/wg-polonius/topic/Algebraic.20Subtyping.html#265259160">(Dec 17 2021 at 06:38)</a>:</h4>
<p>I'm guessing "Type inference with simple subtypes" (Mitchell) and/or "Type inference with subtypes" (Fuh and Mishra), but maybe there's something more recent?</p>



<a name="265324167"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/186049-t-compiler/wg-polonius/topic/Algebraic%20Subtyping/near/265324167" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Dylan MacKenzie (ecstatic-morse) <a href="https://zulip-archive.rust-lang.org/stream/186049-t-compiler/wg-polonius/topic/Algebraic.20Subtyping.html#265324167">(Dec 17 2021 at 16:41)</a>:</h4>
<p><span class="user-mention silent" data-user-id="118594">Dylan MacKenzie (ecstatic-morse)</span> <a href="#narrow/stream/186049-t-compiler.2Fwg-polonius/topic/Algebraic.20Subtyping/near/265256702">said</a>:</p>
<blockquote>
<p>Specifically, was there prior art for the current rules around subtyping during inference? I didn't see anything in the dev guide, but maybe I missed it</p>
</blockquote>
<p>Ah, I think it comes from <a href="https://www.microsoft.com/en-us/research/publication/practical-type-inference-for-arbitrary-rank-types/?from=http%3A%2F%2Fresearch.microsoft.com%2Fen-us%2Fum%2Fpeople%2Fsimonpj%2Fpapers%2Fhigher-rank%2F">https://www.microsoft.com/en-us/research/publication/practical-type-inference-for-arbitrary-rank-types/?from=http%3A%2F%2Fresearch.microsoft.com%2Fen-us%2Fum%2Fpeople%2Fsimonpj%2Fpapers%2Fhigher-rank%2F</a></p>



<a name="265354978"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/186049-t-compiler/wg-polonius/topic/Algebraic%20Subtyping/near/265354978" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> lqd <a href="https://zulip-archive.rust-lang.org/stream/186049-t-compiler/wg-polonius/topic/Algebraic.20Subtyping.html#265354978">(Dec 17 2021 at 20:15)</a>:</h4>
<p>I should have been keeping notes about what we were saying, I don't remember why we started talking about Algebraic Subtyping, if it was during a tangent or key to the QE discussion :/ (I thought it wasn't key to the discussion, and seemed more like interesting ideas for a future where we have the polonius analyses done with the One True Solver in chalk ? -- I could be misremembering or have misunderstood)</p>
<p>(On the same topic I also remember this alternative to Parreaux's simplified version <a href="https://github.com/Storyyeller/cubiml-demo/">https://github.com/Storyyeller/cubiml-demo/</a> -- and Parreaux has also continued simplifying their work from Simple-sub to <a href="https://github.com/LPTK/simpler-sub">Simpler-sub</a>) </p>
<p>Sorry I hadn't seen this question, but I remember the SPJ paper used to be referenced in rustc docs, but maybe it now only remains <a href="https://rustc-dev-guide.rust-lang.org/traits/hrtb.html">in the rustc dev guide</a> to document HRTBs in the trait solver prior to introducing universes</p>



<a name="265355666"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/186049-t-compiler/wg-polonius/topic/Algebraic%20Subtyping/near/265355666" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Dylan MacKenzie (ecstatic-morse) <a href="https://zulip-archive.rust-lang.org/stream/186049-t-compiler/wg-polonius/topic/Algebraic.20Subtyping.html#265355666">(Dec 17 2021 at 20:22)</a>:</h4>
<p>I think <span class="user-mention silent" data-user-id="116009">nikomatsakis</span> just mentioned it as an aside as something you were reading.</p>



<a name="265356133"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/186049-t-compiler/wg-polonius/topic/Algebraic%20Subtyping/near/265356133" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Dylan MacKenzie (ecstatic-morse) <a href="https://zulip-archive.rust-lang.org/stream/186049-t-compiler/wg-polonius/topic/Algebraic.20Subtyping.html#265356133">(Dec 17 2021 at 20:26)</a>:</h4>
<p>To be realistic, it will be a very long time before I can tell you anything you don't already know about inference for higher-ranked types. I can read papers until I'm closer to your level, but it seems like we would really benefit from an expert who could point us in the right direction.</p>



<a name="265356569"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/186049-t-compiler/wg-polonius/topic/Algebraic%20Subtyping/near/265356569" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Dylan MacKenzie (ecstatic-morse) <a href="https://zulip-archive.rust-lang.org/stream/186049-t-compiler/wg-polonius/topic/Algebraic.20Subtyping.html#265356569">(Dec 17 2021 at 20:31)</a>:</h4>
<p>Like the <a href="http://Principal%20Type%20Schemes%20for%20Functional%20Programs%20with%20Overloading%20and%20Subtyping">paper I cited above</a> was the simplest treatment of how to relate bounded, quantified types, but I don't know how to evaluate whether it's compatible with Rust, or even where to start really.</p>



<a name="265356603"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/186049-t-compiler/wg-polonius/topic/Algebraic%20Subtyping/near/265356603" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Dylan MacKenzie (ecstatic-morse) <a href="https://zulip-archive.rust-lang.org/stream/186049-t-compiler/wg-polonius/topic/Algebraic.20Subtyping.html#265356603">(Dec 17 2021 at 20:31)</a>:</h4>
<p>I do enjoy listening to Simon Peyton Jones talk though.</p>



<a name="265356730"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/186049-t-compiler/wg-polonius/topic/Algebraic%20Subtyping/near/265356730" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Dylan MacKenzie (ecstatic-morse) <a href="https://zulip-archive.rust-lang.org/stream/186049-t-compiler/wg-polonius/topic/Algebraic.20Subtyping.html#265356730">(Dec 17 2021 at 20:32)</a>:</h4>
<p><a href="https://www.youtube.com/watch?v=x3evzO8O9e8">This one on inference</a> was really enlightening.</p>
<div class="youtube-video message_inline_image"><a data-id="x3evzO8O9e8" href="https://www.youtube.com/watch?v=x3evzO8O9e8"><img src="https://uploads.zulipusercontent.net/7d9d5706bd3a5992cc306a9f7a9a80b2bc5b7f89/68747470733a2f2f692e7974696d672e636f6d2f76692f783365767a4f384f3965382f64656661756c742e6a7067"></a></div>



<a name="265357133"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/186049-t-compiler/wg-polonius/topic/Algebraic%20Subtyping/near/265357133" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> lqd <a href="https://zulip-archive.rust-lang.org/stream/186049-t-compiler/wg-polonius/topic/Algebraic.20Subtyping.html#265357133">(Dec 17 2021 at 20:36)</a>:</h4>
<p>(you're way overestimating my level I assure you! But I would say exactly the same thing about <em>you</em>, it would take me a long time to match your level) </p>
<blockquote>
<p>it seems like we would really benefit from an expert who could point us in the right direction</p>
</blockquote>
<p>yes! I think Niko mentioned that Lionel Parreaux explained one of their older papers to him one day. So maybe we could <em>actually talk to them</em>. And to many other similarly great people.</p>
<blockquote>
<p>I do enjoy listening to Simon Peyton Jones talk though.</p>
</blockquote>
<p>same! (the comic sans, though, come on (j/k))</p>



<a name="265358697"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/186049-t-compiler/wg-polonius/topic/Algebraic%20Subtyping/near/265358697" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Dylan MacKenzie (ecstatic-morse) <a href="https://zulip-archive.rust-lang.org/stream/186049-t-compiler/wg-polonius/topic/Algebraic.20Subtyping.html#265358697">(Dec 17 2021 at 20:51)</a>:</h4>
<p><span class="user-mention silent" data-user-id="116113">lqd</span> <a href="#narrow/stream/186049-t-compiler.2Fwg-polonius/topic/Algebraic.20Subtyping/near/265357133">said</a>:</p>
<blockquote>
<p>(you're way overestimating my level I assure you! But I would say exactly the same thing about <em>you</em>, it would take me a long time to match your level) </p>
</blockquote>
<p>Well, okay. I guess what I'm saying is I feel bad for <span class="user-mention silent" data-user-id="116009">nikomatsakis</span>, since I know what it's like to be on a team where you don't really have peers. Things are a lot more fun in a truly collaborative environment, but I can't really provide that. I don't know enough PLT. On the other hand, it's kind of Nikos fault for getting to a level where it's hard to find peers <span aria-label="laughing" class="emoji emoji-1f606" role="img" title="laughing">:laughing:</span>. Like, I think you could fit them all in a conference room.</p>



<a name="265359161"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/186049-t-compiler/wg-polonius/topic/Algebraic%20Subtyping/near/265359161" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Dylan MacKenzie (ecstatic-morse) <a href="https://zulip-archive.rust-lang.org/stream/186049-t-compiler/wg-polonius/topic/Algebraic.20Subtyping.html#265359161">(Dec 17 2021 at 20:56)</a>:</h4>
<p>Anyways, I am curious if the first two sections of <a href="https://users.cs.fiu.edu/~smithg/papers/scp94.pdf">Principal Type Schemes for Functional Programs with Overloading and Subtyping</a> seems at all promising to you and <span class="user-mention" data-user-id="116009">@nikomatsakis</span>. Though, like I said, I'm not at the level where I can even evaluate potential lines of research. For now I'll work on understanding the SPJ paper, since that will always be helpful.</p>



<a name="265359871"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/186049-t-compiler/wg-polonius/topic/Algebraic%20Subtyping/near/265359871" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Dylan MacKenzie (ecstatic-morse) <a href="https://zulip-archive.rust-lang.org/stream/186049-t-compiler/wg-polonius/topic/Algebraic.20Subtyping.html#265359871">(Dec 17 2021 at 21:02)</a>:</h4>
<p>Also, bounded quantification is not really related to Polonius itself. I think it's very important for <code>rustc</code> in the long term, but maybe I should focus on getting Polonius into a more usable state in the short term? Presumably there's a minimal implementation of <code>subset_errors</code> based on universes (or on constraint solving without implication), though I would still need a lot of help to implement it. Do we really want to expose universes directly to Polonius?</p>



<a name="265360181"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/186049-t-compiler/wg-polonius/topic/Algebraic%20Subtyping/near/265360181" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Dylan MacKenzie (ecstatic-morse) <a href="https://zulip-archive.rust-lang.org/stream/186049-t-compiler/wg-polonius/topic/Algebraic.20Subtyping.html#265360181">(Dec 17 2021 at 21:04)</a>:</h4>
<p>There's also a bunch of small stuff to explore still. Removing midpoints using what we learned from <code>.next</code>, making use of location insensitive info to make pathological cases run faster, etc.</p>



<a name="265360291"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/186049-t-compiler/wg-polonius/topic/Algebraic%20Subtyping/near/265360291" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> lqd <a href="https://zulip-archive.rust-lang.org/stream/186049-t-compiler/wg-polonius/topic/Algebraic.20Subtyping.html#265360291">(Dec 17 2021 at 21:05)</a>:</h4>
<p>I'll read it but for sure we'll need Niko's opinion <span aria-label="sweat smile" class="emoji emoji-1f605" role="img" title="sweat smile">:sweat_smile:</span></p>



<a name="265360323"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/186049-t-compiler/wg-polonius/topic/Algebraic%20Subtyping/near/265360323" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Dylan MacKenzie (ecstatic-morse) <a href="https://zulip-archive.rust-lang.org/stream/186049-t-compiler/wg-polonius/topic/Algebraic.20Subtyping.html#265360323">(Dec 17 2021 at 21:05)</a>:</h4>
<p>(by the way, I'm still plugging away on the refactor I discussed in the other thread. It's pretty invasive, unfortunately, but I still think it's worth it)</p>



<a name="265360561"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/186049-t-compiler/wg-polonius/topic/Algebraic%20Subtyping/near/265360561" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> lqd <a href="https://zulip-archive.rust-lang.org/stream/186049-t-compiler/wg-polonius/topic/Algebraic.20Subtyping.html#265360561">(Dec 17 2021 at 21:07)</a>:</h4>
<p>What seemed interesting to me about explosing universes to polonius was that it would (IIUC) remove the need to wait on chalk to be complete, and implement the interactions between it and polonius that were described (again if I remember correctly and understand correctly) in Niko's MCP</p>



<a name="265360835"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/186049-t-compiler/wg-polonius/topic/Algebraic%20Subtyping/near/265360835" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Dylan MacKenzie (ecstatic-morse) <a href="https://zulip-archive.rust-lang.org/stream/186049-t-compiler/wg-polonius/topic/Algebraic.20Subtyping.html#265360835">(Dec 17 2021 at 21:10)</a>:</h4>
<p><span class="user-mention silent" data-user-id="116113">lqd</span> <a href="#narrow/stream/186049-t-compiler.2Fwg-polonius/topic/Algebraic.20Subtyping/near/265360561">said</a>:</p>
<blockquote>
<p>What seemed interesting to me about explosing universes to polonius was that it would (IIUC) remove the need to wait on chalk to be complete, and implement the interactions between it and polonius that were described (again if I remember correctly and understand correctly) in Niko's MCP</p>
</blockquote>
<p>I think it would help to see an example or two where we actually need universes to emit the correct <code>subset_errors</code>. Most of the <code>rustc</code> test cases are specific to trait solving. There's no function body.</p>



<a name="265360904"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/186049-t-compiler/wg-polonius/topic/Algebraic%20Subtyping/near/265360904" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Dylan MacKenzie (ecstatic-morse) <a href="https://zulip-archive.rust-lang.org/stream/186049-t-compiler/wg-polonius/topic/Algebraic.20Subtyping.html#265360904">(Dec 17 2021 at 21:10)</a>:</h4>
<p>Let me read the scrollback for that meeting. One sec.</p>



<a name="265361473"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/186049-t-compiler/wg-polonius/topic/Algebraic%20Subtyping/near/265361473" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> lqd <a href="https://zulip-archive.rust-lang.org/stream/186049-t-compiler/wg-polonius/topic/Algebraic.20Subtyping.html#265361473">(Dec 17 2021 at 21:15)</a>:</h4>
<p>I also think it'd be good for us to focus for a bit on it being more usable in the short term as you mentioned, and we discussed friday. They have the advantage of being concrete tasks, that we know how to do and "just" need to execute — compared to these other more abstract concerns that are super interesting but we probably can't complete as easily. (and probably need more work and involve other people)</p>



<a name="265361512"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/186049-t-compiler/wg-polonius/topic/Algebraic%20Subtyping/near/265361512" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Dylan MacKenzie (ecstatic-morse) <a href="https://zulip-archive.rust-lang.org/stream/186049-t-compiler/wg-polonius/topic/Algebraic.20Subtyping.html#265361512">(Dec 17 2021 at 21:15)</a>:</h4>
<p>Okay, so Niko gave some concrete examples and a sketch of the datalog rules in the beginning, but I think changed his mind around <a href="#narrow/stream/186049-t-compiler.2Fwg-polonius/topic/Higher-ranked.20errors/near/247737512">here</a></p>



<a name="265361688"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/186049-t-compiler/wg-polonius/topic/Algebraic%20Subtyping/near/265361688" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Dylan MacKenzie (ecstatic-morse) <a href="https://zulip-archive.rust-lang.org/stream/186049-t-compiler/wg-polonius/topic/Algebraic.20Subtyping.html#265361688">(Dec 17 2021 at 21:17)</a>:</h4>
<p>And the examples he used at the end were pure trait solving AFAICT.</p>



<a name="265361940"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/186049-t-compiler/wg-polonius/topic/Algebraic%20Subtyping/near/265361940" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Dylan MacKenzie (ecstatic-morse) <a href="https://zulip-archive.rust-lang.org/stream/186049-t-compiler/wg-polonius/topic/Algebraic.20Subtyping.html#265361940">(Dec 17 2021 at 21:19)</a>:</h4>
<p>Well, okay not quite. His last example was this:</p>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="k">trait</span><span class="w"> </span><span class="n">TheTrait</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="p">}</span><span class="w"></span>
<span class="k">impl</span><span class="o">&lt;'</span><span class="na">a</span><span class="o">&gt;</span><span class="w"> </span><span class="n">TheTrait</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="k">fn</span><span class="p">(</span><span class="o">&amp;'</span><span class="na">a</span><span class="w"> </span><span class="kt">u32</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="p">}</span><span class="w"></span>

<span class="k">fn</span> <span class="nf">take</span><span class="o">&lt;</span><span class="n">X</span>: <span class="nc">TheTrait</span><span class="o">&gt;</span><span class="p">()</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="p">}</span><span class="w"></span>

<span class="k">fn</span> <span class="nf">main</span><span class="p">()</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="n">take</span>::<span class="o">&lt;</span><span class="k">fn</span><span class="p">(</span><span class="o">&amp;</span><span class="kt">u32</span><span class="p">)</span><span class="o">&gt;</span><span class="p">();</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>
</code></pre></div>



<a name="265364398"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/186049-t-compiler/wg-polonius/topic/Algebraic%20Subtyping/near/265364398" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Dylan MacKenzie (ecstatic-morse) <a href="https://zulip-archive.rust-lang.org/stream/186049-t-compiler/wg-polonius/topic/Algebraic.20Subtyping.html#265364398">(Dec 17 2021 at 21:42)</a>:</h4>
<p>Simpler-Sub looks quite promising as well, btw</p>



<a name="265364468"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/186049-t-compiler/wg-polonius/topic/Algebraic%20Subtyping/near/265364468" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Dylan MacKenzie (ecstatic-morse) <a href="https://zulip-archive.rust-lang.org/stream/186049-t-compiler/wg-polonius/topic/Algebraic.20Subtyping.html#265364468">(Dec 17 2021 at 21:43)</a>:</h4>
<p>I hadn't seen it before, and like the paper I cited it forbids recursive constraints (which I think we don't need).</p>



<a name="265364577"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/186049-t-compiler/wg-polonius/topic/Algebraic%20Subtyping/near/265364577" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Dylan MacKenzie (ecstatic-morse) <a href="https://zulip-archive.rust-lang.org/stream/186049-t-compiler/wg-polonius/topic/Algebraic.20Subtyping.html#265364577">(Dec 17 2021 at 21:44)</a>:</h4>
<p>To ask a possibly stupid question, I've never been clear to what extent we rely on HM-style let-polymorphism in Polonius. It seems like maybe we use subtyping for this instead?</p>



<a name="265364881"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/186049-t-compiler/wg-polonius/topic/Algebraic%20Subtyping/near/265364881" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Dylan MacKenzie (ecstatic-morse) <a href="https://zulip-archive.rust-lang.org/stream/186049-t-compiler/wg-polonius/topic/Algebraic.20Subtyping.html#265364881">(Dec 17 2021 at 21:46)</a>:</h4>
<p>Like if we have the following:</p>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="k">fn</span> <span class="nf">foo</span><span class="p">(</span><span class="n">a</span>: <span class="kp">&amp;</span><span class="o">'</span><span class="na">a</span> <span class="kt">u32</span><span class="p">,</span><span class="w"> </span><span class="n">b</span>: <span class="kp">&amp;</span><span class="o">'</span><span class="na">b</span> <span class="kt">u32</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">   </span><span class="kd">let</span><span class="w"> </span><span class="n">x</span>: <span class="nc">fn</span><span class="p">(</span><span class="o">&amp;</span><span class="kt">u32</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="cm">/* ... */</span><span class="p">;</span><span class="w"></span>
<span class="w">    </span><span class="n">x</span><span class="p">(</span><span class="n">a</span><span class="p">);</span><span class="w"></span>
<span class="w">    </span><span class="n">x</span><span class="p">(</span><span class="n">b</span><span class="p">);</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>
</code></pre></div>
<p>Are we keeping <code>x</code> general? Or do we construct a concrete lifetime variable that is the least upper bound of <code>'a</code> and <code>'b</code>?</p>



<a name="265365468"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/186049-t-compiler/wg-polonius/topic/Algebraic%20Subtyping/near/265365468" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Dylan MacKenzie (ecstatic-morse) <a href="https://zulip-archive.rust-lang.org/stream/186049-t-compiler/wg-polonius/topic/Algebraic.20Subtyping.html#265365468">(Dec 17 2021 at 21:51)</a>:</h4>
<p>My understanding is that we are relying on this, and that this is why the distinction between late-bound and early bound regions exists.</p>



<a name="265366381"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/186049-t-compiler/wg-polonius/topic/Algebraic%20Subtyping/near/265366381" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> lqd <a href="https://zulip-archive.rust-lang.org/stream/186049-t-compiler/wg-polonius/topic/Algebraic.20Subtyping.html#265366381">(Dec 17 2021 at 22:00)</a>:</h4>
<p>I don't know the answer to this and would need to check <span aria-label="sweat" class="emoji emoji-1f613" role="img" title="sweat">:sweat:</span> (see this is what I meant earlier, I told you)</p>



<a name="265444072"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/186049-t-compiler/wg-polonius/topic/Algebraic%20Subtyping/near/265444072" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Dylan MacKenzie (ecstatic-morse) <a href="https://zulip-archive.rust-lang.org/stream/186049-t-compiler/wg-polonius/topic/Algebraic.20Subtyping.html#265444072">(Dec 18 2021 at 21:17)</a>:</h4>
<p>BTW, The literature makes a distinction between bounded quantification (quantified variables bound by fixed types) not <em>constrained</em> quantification (quantified variables bound by other quantified variables). I've been using those two terms interchangably.</p>
<p>"Type Inference with Constrained Types" (Odersky et al.) is a good discussion of constrained quantification. Haven't finished it yet though.</p>



<hr><p>Last updated: Apr 12 2022 at 20:01 UTC</p>
</html>