<html>
<head><meta charset="utf-8"><title>Reintroducing loans · t-compiler/wg-polonius · Zulip Chat Archive</title></head>
<h2>Stream: <a href="https://zulip-archive.rust-lang.org/stream/186049-t-compiler/wg-polonius/index.html">t-compiler/wg-polonius</a></h2>
<h3>Topic: <a href="https://zulip-archive.rust-lang.org/stream/186049-t-compiler/wg-polonius/topic/Reintroducing.20loans.html">Reintroducing loans</a></h3>

<hr>

<base href="https://rust-lang.zulipchat.com">

<head><link href="https://zulip-archive.rust-lang.org/style.css" rel="stylesheet"></head>

<a name="259579895"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/186049-t-compiler/wg-polonius/topic/Reintroducing%20loans/near/259579895" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/186049-t-compiler/wg-polonius/topic/Reintroducing.20loans.html#259579895">(Oct 29 2021 at 20:33)</a>:</h4>
<p>Take a look at this branch (all tests pass, but I had to edit the facts so...)</p>
<p><a href="https://github.com/nikomatsakis/polonius.next/pull/15">https://github.com/nikomatsakis/polonius.next/pull/15</a></p>
<p>The idea is reintroduce loans, but I called them <em>leases</em>.</p>



<a name="259579914"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/186049-t-compiler/wg-polonius/topic/Reintroducing%20loans/near/259579914" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/186049-t-compiler/wg-polonius/topic/Reintroducing.20loans.html#259579914">(Oct 29 2021 at 20:33)</a>:</h4>
<p>Cause I think that name works better :)</p>



<a name="259579999"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/186049-t-compiler/wg-polonius/topic/Reintroducing%20loans/near/259579999" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/186049-t-compiler/wg-polonius/topic/Reintroducing.20loans.html#259579999">(Oct 29 2021 at 20:34)</a>:</h4>
<p>I personally found it easier to think about</p>



<a name="259580062"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/186049-t-compiler/wg-polonius/topic/Reintroducing%20loans/near/259580062" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/186049-t-compiler/wg-polonius/topic/Reintroducing.20loans.html#259580062">(Oct 29 2021 at 20:34)</a>:</h4>
<ul>
<li>Overwriting a place: generate <code>clear_origin</code> for all regions that are (uniquely) in that place (which is all of them)</li>
</ul>



<a name="259580082"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/186049-t-compiler/wg-polonius/topic/Reintroducing%20loans/near/259580082" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/186049-t-compiler/wg-polonius/topic/Reintroducing.20loans.html#259580082">(Oct 29 2021 at 20:35)</a>:</h4>
<ul>
<li>Also, invalidate any leases <em>of</em> that place</li>
</ul>



<a name="259580098"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/186049-t-compiler/wg-polonius/topic/Reintroducing%20loans/near/259580098" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/186049-t-compiler/wg-polonius/topic/Reintroducing.20loans.html#259580098">(Oct 29 2021 at 20:35)</a>:</h4>
<ul>
<li>There is the interesting case of clearing a lease of <code>*x</code> when you write to <code>x</code></li>
</ul>



<a name="259580183"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/186049-t-compiler/wg-polonius/topic/Reintroducing%20loans/near/259580183" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/186049-t-compiler/wg-polonius/topic/Reintroducing.20loans.html#259580183">(Oct 29 2021 at 20:36)</a>:</h4>
<p>I didn't try to be smart, so I introduced</p>
<ul>
<li><code>member_on_entry</code></li>
<li><code>member_on_exit</code></li>
</ul>
<p>though I suspect we could coallesce the relations.</p>



<a name="259580245"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/186049-t-compiler/wg-polonius/topic/Reintroducing%20loans/near/259580245" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> lqd <a href="https://zulip-archive.rust-lang.org/stream/186049-t-compiler/wg-polonius/topic/Reintroducing.20loans.html#259580245">(Oct 29 2021 at 20:36)</a>:</h4>
<p><span class="user-mention silent" data-user-id="116009">nikomatsakis</span> <a href="#narrow/stream/186049-t-compiler.2Fwg-polonius/topic/Reintroducing.20loans/near/259579895">said</a>:</p>
<blockquote>
<p>The idea is reintroduce loans, but I called them <em>leases</em>.</p>
</blockquote>
<p>dada !</p>



<a name="259580258"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/186049-t-compiler/wg-polonius/topic/Reintroducing%20loans/near/259580258" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/186049-t-compiler/wg-polonius/topic/Reintroducing.20loans.html#259580258">(Oct 29 2021 at 20:36)</a>:</h4>
<p>:whistle:</p>



<a name="259581481"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/186049-t-compiler/wg-polonius/topic/Reintroducing%20loans/near/259581481" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> lqd <a href="https://zulip-archive.rust-lang.org/stream/186049-t-compiler/wg-polonius/topic/Reintroducing.20loans.html#259581481">(Oct 29 2021 at 20:49)</a>:</h4>
<p>thanks for fixing the unroll rules there as well</p>



<a name="259581609"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/186049-t-compiler/wg-polonius/topic/Reintroducing%20loans/near/259581609" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Domenic Quirl <a href="https://zulip-archive.rust-lang.org/stream/186049-t-compiler/wg-polonius/topic/Reintroducing.20loans.html#259581609">(Oct 29 2021 at 20:50)</a>:</h4>
<p>actually, I have a question about those</p>



<a name="259581624"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/186049-t-compiler/wg-polonius/topic/Reintroducing%20loans/near/259581624" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Domenic Quirl <a href="https://zulip-archive.rust-lang.org/stream/186049-t-compiler/wg-polonius/topic/Reintroducing.20loans.html#259581624">(Oct 29 2021 at 20:50)</a>:</h4>
<p>but let me finish reading the changes first</p>



<a name="259581885"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/186049-t-compiler/wg-polonius/topic/Reintroducing%20loans/near/259581885" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Domenic Quirl <a href="https://zulip-archive.rust-lang.org/stream/186049-t-compiler/wg-polonius/topic/Reintroducing.20loans.html#259581885">(Oct 29 2021 at 20:53)</a>:</h4>
<div class="codehilite"><pre><span></span><code>// * Generate `clear_origin` for each loan origin that is cleared by reads/writes
//     * e.g., if there is a lease `&#39;L_*temp` where `temp: &amp;T` and this expression writes to `temp`, then `&#39;L_*temp` is cleared,
//       not invalidated. This is because memory at `*temp` is not owned, so it is not freed by writing to `temp`,
//       but `*temp` no longer names the same memory anymore.
</code></pre></div>



<a name="259581933"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/186049-t-compiler/wg-polonius/topic/Reintroducing%20loans/near/259581933" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> lqd <a href="https://zulip-archive.rust-lang.org/stream/186049-t-compiler/wg-polonius/topic/Reintroducing.20loans.html#259581933">(Oct 29 2021 at 20:53)</a>:</h4>
<p>/me not being a native english speaker doesn't see much of the semantic differences between lease, loan, and borrow</p>



<a name="259582069"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/186049-t-compiler/wg-polonius/topic/Reintroducing%20loans/near/259582069" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Domenic Quirl <a href="https://zulip-archive.rust-lang.org/stream/186049-t-compiler/wg-polonius/topic/Reintroducing.20loans.html#259582069">(Oct 29 2021 at 20:54)</a>:</h4>
<p>this seems... wrong now? It's the same logic as before (which is also present in a different formulation for <code>clear_lease</code> below), but loan origins are not a thing anymore in this model. And in particular, there is no <em>origin</em> <code>'L_*temp</code></p>



<a name="259582115"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/186049-t-compiler/wg-polonius/topic/Reintroducing%20loans/near/259582115" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Domenic Quirl <a href="https://zulip-archive.rust-lang.org/stream/186049-t-compiler/wg-polonius/topic/Reintroducing.20loans.html#259582115">(Oct 29 2021 at 20:55)</a>:</h4>
<p>the only actual origins that get cleared should be those that are overwritten by assignments</p>



<a name="259582121"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/186049-t-compiler/wg-polonius/topic/Reintroducing%20loans/near/259582121" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Domenic Quirl <a href="https://zulip-archive.rust-lang.org/stream/186049-t-compiler/wg-polonius/topic/Reintroducing.20loans.html#259582121">(Oct 29 2021 at 20:55)</a>:</h4>
<p>right?</p>



<a name="259582369"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/186049-t-compiler/wg-polonius/topic/Reintroducing%20loans/near/259582369" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> lqd <a href="https://zulip-archive.rust-lang.org/stream/186049-t-compiler/wg-polonius/topic/Reintroducing.20loans.html#259582369">(Oct 29 2021 at 20:57)</a>:</h4>
<p>seems like should be <code>clear_lease</code> right ?</p>



<a name="259582504"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/186049-t-compiler/wg-polonius/topic/Reintroducing%20loans/near/259582504" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Domenic Quirl <a href="https://zulip-archive.rust-lang.org/stream/186049-t-compiler/wg-polonius/topic/Reintroducing.20loans.html#259582504">(Oct 29 2021 at 20:58)</a>:</h4>
<p><span class="user-mention silent" data-user-id="116113">lqd</span> <a href="#narrow/stream/186049-t-compiler.2Fwg-polonius/topic/Reintroducing.20loans/near/259581481">said</a>:</p>
<blockquote>
<p>thanks for fixing the unroll rules there as well</p>
</blockquote>
<p>re: unrolling, the new comment says</p>
<div class="codehilite"><pre><span></span><code>// * For every `&amp;&#39;L_P P` expression assigned to a place of type `&amp;&#39;O T`:
//          * If `P = *Q` where `Q: &amp;&#39;Q mut T`, then `&#39;Q &lt;= &#39;O`
</code></pre></div>
<p>but then in the test case that has unrolling there is</p>
<div class="codehilite"><pre><span></span><code>d: &quot;y = &amp;&#39;L_*x mut *x&quot; {
    // Unroll `*x` where `x: &amp;&#39;x mut u32`
    introduce_subset(&#39;x, &#39;y)
</code></pre></div>



<a name="259582559"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/186049-t-compiler/wg-polonius/topic/Reintroducing%20loans/near/259582559" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Domenic Quirl <a href="https://zulip-archive.rust-lang.org/stream/186049-t-compiler/wg-polonius/topic/Reintroducing.20loans.html#259582559">(Oct 29 2021 at 20:59)</a>:</h4>
<p>I think we noticed before that while these look the same, they actually mean the reverse thing, so only one of these can be right</p>



<a name="259582738"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/186049-t-compiler/wg-polonius/topic/Reintroducing%20loans/near/259582738" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Domenic Quirl <a href="https://zulip-archive.rust-lang.org/stream/186049-t-compiler/wg-polonius/topic/Reintroducing.20loans.html#259582738">(Oct 29 2021 at 21:00)</a>:</h4>
<p>To me, it makes sense the way it is in the facts. That is, instead of <code>'x -&gt; 'L_*x</code> and then <code>'L_*x -&gt; 'y</code> (which was the result before), we now have <code>'x -&gt; 'y</code> directly</p>



<a name="259582778"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/186049-t-compiler/wg-polonius/topic/Reintroducing%20loans/near/259582778" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Domenic Quirl <a href="https://zulip-archive.rust-lang.org/stream/186049-t-compiler/wg-polonius/topic/Reintroducing.20loans.html#259582778">(Oct 29 2021 at 21:01)</a>:</h4>
<p>That's still a somewhat subtle change, but it has the same effect logially</p>



<a name="259582870"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/186049-t-compiler/wg-polonius/topic/Reintroducing%20loans/near/259582870" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Domenic Quirl <a href="https://zulip-archive.rust-lang.org/stream/186049-t-compiler/wg-polonius/topic/Reintroducing.20loans.html#259582870">(Oct 29 2021 at 21:01)</a>:</h4>
<p>so I think the written rules would need to be <code>'O &lt;= 'Q</code>?</p>



<a name="259582944"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/186049-t-compiler/wg-polonius/topic/Reintroducing%20loans/near/259582944" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> lqd <a href="https://zulip-archive.rust-lang.org/stream/186049-t-compiler/wg-polonius/topic/Reintroducing.20loans.html#259582944">(Oct 29 2021 at 21:02)</a>:</h4>
<p>I think with the new precision "assigned to a place of type <code>&amp;'O T</code>" it looks good ?</p>



<a name="259582969"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/186049-t-compiler/wg-polonius/topic/Reintroducing%20loans/near/259582969" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Domenic Quirl <a href="https://zulip-archive.rust-lang.org/stream/186049-t-compiler/wg-polonius/topic/Reintroducing.20loans.html#259582969">(Oct 29 2021 at 21:02)</a>:</h4>
<p>(or maybe we want to get rid of this notation completely for these docs, since this is at least the second time we get hung up on this)</p>



<a name="259583001"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/186049-t-compiler/wg-polonius/topic/Reintroducing%20loans/near/259583001" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> lqd <a href="https://zulip-archive.rust-lang.org/stream/186049-t-compiler/wg-polonius/topic/Reintroducing.20loans.html#259583001">(Oct 29 2021 at 21:03)</a>:</h4>
<p>let me re-read this more carefully</p>



<a name="259583315"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/186049-t-compiler/wg-polonius/topic/Reintroducing%20loans/near/259583315" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> lqd <a href="https://zulip-archive.rust-lang.org/stream/186049-t-compiler/wg-polonius/topic/Reintroducing.20loans.html#259583315">(Oct 29 2021 at 21:06)</a>:</h4>
<p>(right after I finish this call :)</p>



<a name="259583355"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/186049-t-compiler/wg-polonius/topic/Reintroducing%20loans/near/259583355" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Domenic Quirl <a href="https://zulip-archive.rust-lang.org/stream/186049-t-compiler/wg-polonius/topic/Reintroducing.20loans.html#259583355">(Oct 29 2021 at 21:07)</a>:</h4>
<p>I'm looking for the last time we talked about this</p>



<a name="259583581"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/186049-t-compiler/wg-polonius/topic/Reintroducing%20loans/near/259583581" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Domenic Quirl <a href="https://zulip-archive.rust-lang.org/stream/186049-t-compiler/wg-polonius/topic/Reintroducing.20loans.html#259583581">(Oct 29 2021 at 21:09)</a>:</h4>
<p><a href="#narrow/stream/186049-t-compiler.2Fwg-polonius/topic/Sprint.202021-10-15.20prep/near/257263557">https://rust-lang.zulipchat.com/#narrow/stream/186049-t-compiler.2Fwg-polonius/topic/Sprint.202021-10-15.20prep/near/257263557</a> <span class="user-mention" data-user-id="116113">@lqd</span> this is what you previously mentioned</p>



<a name="259583602"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/186049-t-compiler/wg-polonius/topic/Reintroducing%20loans/near/259583602" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Domenic Quirl <a href="https://zulip-archive.rust-lang.org/stream/186049-t-compiler/wg-polonius/topic/Reintroducing.20loans.html#259583602">(Oct 29 2021 at 21:09)</a>:</h4>
<p>and I think  the same issue exists here</p>



<a name="259583713"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/186049-t-compiler/wg-polonius/topic/Reintroducing%20loans/near/259583713" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Domenic Quirl <a href="https://zulip-archive.rust-lang.org/stream/186049-t-compiler/wg-polonius/topic/Reintroducing.20loans.html#259583713">(Oct 29 2021 at 21:10)</a>:</h4>
<p><span class="user-mention silent" data-user-id="116113">lqd</span> <a href="#narrow/stream/186049-t-compiler.2Fwg-polonius/topic/Reintroducing.20loans/near/259582369">said</a>:</p>
<blockquote>
<p>seems like should be <code>clear_lease</code> right ?</p>
</blockquote>
<p>also yes on this, but there is a paragraph for leases right below that has the same example again, and nothing about the actual clear rules for origins. So that's why I assumed that to be the thing to change</p>



<a name="259583770"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/186049-t-compiler/wg-polonius/topic/Reintroducing%20loans/near/259583770" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Domenic Quirl <a href="https://zulip-archive.rust-lang.org/stream/186049-t-compiler/wg-polonius/topic/Reintroducing.20loans.html#259583770">(Oct 29 2021 at 21:11)</a>:</h4>
<p><span class="user-mention silent" data-user-id="116009">nikomatsakis</span> <a href="#narrow/stream/186049-t-compiler.2Fwg-polonius/topic/Reintroducing.20loans/near/259579895">said</a>:</p>
<blockquote>
<p>The idea is reintroduce loans, but I called them <em>leases</em>.</p>
</blockquote>
<p>(completely unrelated, this sounds like it could be coming straight from marketing ^^)</p>



<a name="259584342"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/186049-t-compiler/wg-polonius/topic/Reintroducing%20loans/near/259584342" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> lqd <a href="https://zulip-archive.rust-lang.org/stream/186049-t-compiler/wg-polonius/topic/Reintroducing.20loans.html#259584342">(Oct 29 2021 at 21:16)</a>:</h4>
<p>Still in the call so could be that I'm missing things and misunderstanding the difference you're seeing (esp if it's related to the fat that Q is a &amp;mut),  but here's how I quickly read that before:</p>
<p>from &amp;'O T = &amp;'L_P P<br>
we have 'L_P &lt;: 'O</p>
<p>if P = *Q, where Q: &amp;'Q T, 'Q &lt;: 'L_P</p>
<p>and transitively, 'Q &lt;: 'O ?</p>



<a name="259584534"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/186049-t-compiler/wg-polonius/topic/Reintroducing%20loans/near/259584534" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Domenic Quirl <a href="https://zulip-archive.rust-lang.org/stream/186049-t-compiler/wg-polonius/topic/Reintroducing.20loans.html#259584534">(Oct 29 2021 at 21:17)</a>:</h4>
<p>what is <code>&lt;:</code> now?</p>



<a name="259584544"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/186049-t-compiler/wg-polonius/topic/Reintroducing%20loans/near/259584544" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> lqd <a href="https://zulip-archive.rust-lang.org/stream/186049-t-compiler/wg-polonius/topic/Reintroducing.20loans.html#259584544">(Oct 29 2021 at 21:17)</a>:</h4>
<p>subset, outlives</p>



<a name="259584553"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/186049-t-compiler/wg-polonius/topic/Reintroducing%20loans/near/259584553" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> lqd <a href="https://zulip-archive.rust-lang.org/stream/186049-t-compiler/wg-polonius/topic/Reintroducing.20loans.html#259584553">(Oct 29 2021 at 21:17)</a>:</h4>
<p>flows into</p>



<a name="259584558"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/186049-t-compiler/wg-polonius/topic/Reintroducing%20loans/near/259584558" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Domenic Quirl <a href="https://zulip-archive.rust-lang.org/stream/186049-t-compiler/wg-polonius/topic/Reintroducing.20loans.html#259584558">(Oct 29 2021 at 21:17)</a>:</h4>
<p>is it <code>&lt;=</code> as in the comment, or <code>:</code> outlives</p>



<a name="259584591"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/186049-t-compiler/wg-polonius/topic/Reintroducing%20loans/near/259584591" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Domenic Quirl <a href="https://zulip-archive.rust-lang.org/stream/186049-t-compiler/wg-polonius/topic/Reintroducing.20loans.html#259584591">(Oct 29 2021 at 21:18)</a>:</h4>
<p>or something else</p>



<a name="259584661"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/186049-t-compiler/wg-polonius/topic/Reintroducing%20loans/near/259584661" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Domenic Quirl <a href="https://zulip-archive.rust-lang.org/stream/186049-t-compiler/wg-polonius/topic/Reintroducing.20loans.html#259584661">(Oct 29 2021 at 21:19)</a>:</h4>
<p>(I'm asking because this is precisely the issue - I think we agree on what the actual lifetimes look like, but from your previous comment I was under the impression that <code>&lt;=</code> is <em>reversed</em>  from <code>:</code>)</p>



<a name="259584663"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/186049-t-compiler/wg-polonius/topic/Reintroducing%20loans/near/259584663" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> lqd <a href="https://zulip-archive.rust-lang.org/stream/186049-t-compiler/wg-polonius/topic/Reintroducing.20loans.html#259584663">(Oct 29 2021 at 21:19)</a>:</h4>
<p>I don't remember if Niko meant &lt;= shorter in this document ^^ but I thought they said last time that it was the regular subset/outlives</p>



<a name="259584691"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/186049-t-compiler/wg-polonius/topic/Reintroducing%20loans/near/259584691" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Domenic Quirl <a href="https://zulip-archive.rust-lang.org/stream/186049-t-compiler/wg-polonius/topic/Reintroducing.20loans.html#259584691">(Oct 29 2021 at 21:19)</a>:</h4>
<p>and in the comments so far <code>&lt;:</code> was the subtyping relationship, so that kinda didn't help my confusion <span aria-label="sweat smile" class="emoji emoji-1f605" role="img" title="sweat smile">:sweat_smile:</span></p>



<a name="259584890"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/186049-t-compiler/wg-polonius/topic/Reintroducing%20loans/near/259584890" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Domenic Quirl <a href="https://zulip-archive.rust-lang.org/stream/186049-t-compiler/wg-polonius/topic/Reintroducing.20loans.html#259584890">(Oct 29 2021 at 21:22)</a>:</h4>
<p>so before the PR we had a borrow of <code>P = *Q</code> where <code>Q: &amp;'O mut T</code>, then <code>'L_P &lt;= O</code></p>



<a name="259584984"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/186049-t-compiler/wg-polonius/topic/Reintroducing%20loans/near/259584984" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Domenic Quirl <a href="https://zulip-archive.rust-lang.org/stream/186049-t-compiler/wg-polonius/topic/Reintroducing.20loans.html#259584984">(Oct 29 2021 at 21:22)</a>:</h4>
<p>(<code>'O</code> is now something else)</p>



<a name="259584985"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/186049-t-compiler/wg-polonius/topic/Reintroducing%20loans/near/259584985" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> lqd <a href="https://zulip-archive.rust-lang.org/stream/186049-t-compiler/wg-polonius/topic/Reintroducing.20loans.html#259584985">(Oct 29 2021 at 21:22)</a>:</h4>
<p>either it was correct before, and &lt;= meant shorter, or it is now correct and &lt;= means longer (and subset) :)</p>



<a name="259584993"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/186049-t-compiler/wg-polonius/topic/Reintroducing%20loans/near/259584993" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> lqd <a href="https://zulip-archive.rust-lang.org/stream/186049-t-compiler/wg-polonius/topic/Reintroducing.20loans.html#259584993">(Oct 29 2021 at 21:22)</a>:</h4>
<p>I think it's the second case</p>



<a name="259585011"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/186049-t-compiler/wg-polonius/topic/Reintroducing%20loans/near/259585011" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Domenic Quirl <a href="https://zulip-archive.rust-lang.org/stream/186049-t-compiler/wg-polonius/topic/Reintroducing.20loans.html#259585011">(Oct 29 2021 at 21:22)</a>:</h4>
<p>which translated to <code>introduce_subset('O, 'L_P)</code> in the tests</p>



<a name="259585089"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/186049-t-compiler/wg-polonius/topic/Reintroducing%20loans/near/259585089" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Domenic Quirl <a href="https://zulip-archive.rust-lang.org/stream/186049-t-compiler/wg-polonius/topic/Reintroducing.20loans.html#259585089">(Oct 29 2021 at 21:23)</a>:</h4>
<p>so whichever of the two it is, the meaning of <code>&lt;=</code> seems to have flipped with this PR</p>



<a name="259585141"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/186049-t-compiler/wg-polonius/topic/Reintroducing%20loans/near/259585141" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Domenic Quirl <a href="https://zulip-archive.rust-lang.org/stream/186049-t-compiler/wg-polonius/topic/Reintroducing.20loans.html#259585141">(Oct 29 2021 at 21:24)</a>:</h4>
<p>and we can decide what to do with that</p>



<a name="259585380"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/186049-t-compiler/wg-polonius/topic/Reintroducing%20loans/near/259585380" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Domenic Quirl <a href="https://zulip-archive.rust-lang.org/stream/186049-t-compiler/wg-polonius/topic/Reintroducing.20loans.html#259585380">(Oct 29 2021 at 21:26)</a>:</h4>
<p>I think my preference would be to just replace the comments to contain the actual facts to avoid this confusion</p>



<a name="259589874"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/186049-t-compiler/wg-polonius/topic/Reintroducing%20loans/near/259589874" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> lqd <a href="https://zulip-archive.rust-lang.org/stream/186049-t-compiler/wg-polonius/topic/Reintroducing.20loans.html#259589874">(Oct 29 2021 at 22:19)</a>:</h4>
<p>the imprecision somewhere makes it hard indeed to say whether the operator was wrong or the operands were, but as we agree on the lifetimes, the actual facts should be <code>introduce_subset('x, 'y)</code> for a <code>'x &lt;: 'y</code> (which is also <code>'x: 'y</code>)</p>



<a name="259589929"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/186049-t-compiler/wg-polonius/topic/Reintroducing%20loans/near/259589929" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> lqd <a href="https://zulip-archive.rust-lang.org/stream/186049-t-compiler/wg-polonius/topic/Reintroducing.20loans.html#259589929">(Oct 29 2021 at 22:20)</a>:</h4>
<p>(like <a href="https://github.com/nikomatsakis/polonius.next/blob/3f27a7cc363e217e533f994850214d269eeaf606/tests/killing-and-murder/program.txt#L42-L43">https://github.com/nikomatsakis/polonius.next/blob/3f27a7cc363e217e533f994850214d269eeaf606/tests/killing-and-murder/program.txt#L42-L43</a>)</p>



<a name="259590596"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/186049-t-compiler/wg-polonius/topic/Reintroducing%20loans/near/259590596" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> lqd <a href="https://zulip-archive.rust-lang.org/stream/186049-t-compiler/wg-polonius/topic/Reintroducing.20loans.html#259590596">(Oct 29 2021 at 22:27)</a>:</h4>
<p>(or sometimes <code>introduce_lease</code> with this PR, yeah having the actual facts would now be interesting <span aria-label="joy" class="emoji emoji-1f602" role="img" title="joy">:joy:</span> )</p>



<a name="259695426"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/186049-t-compiler/wg-polonius/topic/Reintroducing%20loans/near/259695426" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Domenic Quirl <a href="https://zulip-archive.rust-lang.org/stream/186049-t-compiler/wg-polonius/topic/Reintroducing.20loans.html#259695426">(Oct 29 2021 at 23:12)</a>:</h4>
<p>I just read the naive rules of regular Polonius again and it was striking how similar the auxiliary rules have become now (subsets and liveness).</p>



<a name="259695523"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/186049-t-compiler/wg-polonius/topic/Reintroducing%20loans/near/259695523" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Domenic Quirl <a href="https://zulip-archive.rust-lang.org/stream/186049-t-compiler/wg-polonius/topic/Reintroducing.20loans.html#259695523">(Oct 29 2021 at 23:14)</a>:</h4>
<p>The formulation of errors is different conceptually (invalidate live loans vs access invalid loans), but other than that it feels like we have mostly ended up with more distinct and precise notions of clearing things</p>



<a name="259695596"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/186049-t-compiler/wg-polonius/topic/Reintroducing%20loans/near/259695596" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Domenic Quirl <a href="https://zulip-archive.rust-lang.org/stream/186049-t-compiler/wg-polonius/topic/Reintroducing.20loans.html#259695596">(Oct 29 2021 at 23:15)</a>:</h4>
<p>Despite that, there is no doubt in my mind that the <code>.next</code> rules are more intuitive for some reason. They just "feel" better</p>



<a name="259695735"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/186049-t-compiler/wg-polonius/topic/Reintroducing%20loans/near/259695735" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Domenic Quirl <a href="https://zulip-archive.rust-lang.org/stream/186049-t-compiler/wg-polonius/topic/Reintroducing.20loans.html#259695735">(Oct 29 2021 at 23:17)</a>:</h4>
<p>At the same time, it seems like computationally we are computing a similar liveness, subset and lease membership information, while additionally propagating invalidation across the CFG</p>



<a name="259696140"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/186049-t-compiler/wg-polonius/topic/Reintroducing%20loans/near/259696140" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Domenic Quirl <a href="https://zulip-archive.rust-lang.org/stream/186049-t-compiler/wg-polonius/topic/Reintroducing.20loans.html#259696140">(Oct 29 2021 at 23:23)</a>:</h4>
<p>That is, I'm pretty sure that it's possible to remove the <code>origin_invalidated</code>relation(s) and error just based on <code>invalidate_origin</code>for member leases (which includes liveness as a propagation constraint) to emulate the original angle on errors</p>



<a name="259696241"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/186049-t-compiler/wg-polonius/topic/Reintroducing%20loans/near/259696241" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Domenic Quirl <a href="https://zulip-archive.rust-lang.org/stream/186049-t-compiler/wg-polonius/topic/Reintroducing.20loans.html#259696241">(Oct 29 2021 at 23:24)</a>:</h4>
<p>And that might actually do less work then if all of this is indeed the case</p>



<a name="259696573"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/186049-t-compiler/wg-polonius/topic/Reintroducing%20loans/near/259696573" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Domenic Quirl <a href="https://zulip-archive.rust-lang.org/stream/186049-t-compiler/wg-polonius/topic/Reintroducing.20loans.html#259696573">(Oct 29 2021 at 23:30)</a>:</h4>
<p>At least there should be a mapping, because invalidating a lease inside a live origin means that origin will later be accessed without being cleared in between, so be accessed while invalidated</p>



<a name="259698223"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/186049-t-compiler/wg-polonius/topic/Reintroducing%20loans/near/259698223" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> lqd <a href="https://zulip-archive.rust-lang.org/stream/186049-t-compiler/wg-polonius/topic/Reintroducing.20loans.html#259698223">(Oct 29 2021 at 23:57)</a>:</h4>
<p>that's what I was trying to convey last time, adding liveness makes .next a lot closer to the current rules (and the intuitiveness could just be familiarity) and makes it less appealing to me personally</p>



<a name="259873851"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/186049-t-compiler/wg-polonius/topic/Reintroducing%20loans/near/259873851" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/186049-t-compiler/wg-polonius/topic/Reintroducing.20loans.html#259873851">(Nov 01 2021 at 14:56)</a>:</h4>
<p><span class="user-mention" data-user-id="337115">@Domenic Quirl</span> <code>'a: 'b</code> is outlives; it is also <code>'a &lt;= 'b</code> in polonius (subset)</p>



<a name="259873890"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/186049-t-compiler/wg-polonius/topic/Reintroducing%20loans/near/259873890" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/186049-t-compiler/wg-polonius/topic/Reintroducing.20loans.html#259873890">(Nov 01 2021 at 14:57)</a>:</h4>
<p>for <em>lifetimes</em> (sets of points), it is <code>&gt;=</code></p>



<a name="259873904"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/186049-t-compiler/wg-polonius/topic/Reintroducing%20loans/near/259873904" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/186049-t-compiler/wg-polonius/topic/Reintroducing.20loans.html#259873904">(Nov 01 2021 at 14:57)</a>:</h4>
<p>but for sets of leases, it is <code>&lt;=</code></p>



<a name="259873919"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/186049-t-compiler/wg-polonius/topic/Reintroducing%20loans/near/259873919" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/186049-t-compiler/wg-polonius/topic/Reintroducing.20loans.html#259873919">(Nov 01 2021 at 14:57)</a>:</h4>
<p>think about this:</p>



<a name="259873948"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/186049-t-compiler/wg-polonius/topic/Reintroducing%20loans/near/259873948" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/186049-t-compiler/wg-polonius/topic/Reintroducing.20loans.html#259873948">(Nov 01 2021 at 14:57)</a>:</h4>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="kd">let</span><span class="w"> </span><span class="k">mut</span><span class="w"> </span><span class="n">p</span>: <span class="kp">&amp;</span><span class="o">'</span><span class="na">p</span> <span class="kt">u32</span>
<span class="nc">let</span><span class="w"> </span><span class="k">mut</span><span class="w"> </span><span class="n">q</span>: <span class="kp">&amp;</span><span class="o">'</span><span class="na">q</span> <span class="kt">u32</span>

<span class="nc">p</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">q</span><span class="w"></span>
</code></pre></div>



<a name="259873965"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/186049-t-compiler/wg-polonius/topic/Reintroducing%20loans/near/259873965" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/186049-t-compiler/wg-polonius/topic/Reintroducing.20loans.html#259873965">(Nov 01 2021 at 14:57)</a>:</h4>
<p>this is legal if <code>&amp;'q u32 &lt;: &amp;'p u32</code> and hence <code>'q: 'p</code></p>



<a name="259873973"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/186049-t-compiler/wg-polonius/topic/Reintroducing%20loans/near/259873973" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/186049-t-compiler/wg-polonius/topic/Reintroducing.20loans.html#259873973">(Nov 01 2021 at 14:57)</a>:</h4>
<p>i.e., <code>'q</code> is flowing into <code>'p</code></p>



<a name="259874058"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/186049-t-compiler/wg-polonius/topic/Reintroducing%20loans/near/259874058" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/186049-t-compiler/wg-polonius/topic/Reintroducing.20loans.html#259874058">(Nov 01 2021 at 14:58)</a>:</h4>
<p>for origins, this means that <code>'p</code>'s origin is a <em>superset</em> of <code>q</code> -- it comes from <code>q</code>, but maybe other places too</p>



<a name="259874061"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/186049-t-compiler/wg-polonius/topic/Reintroducing%20loans/near/259874061" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/186049-t-compiler/wg-polonius/topic/Reintroducing.20loans.html#259874061">(Nov 01 2021 at 14:58)</a>:</h4>
<p>hence <code>'q &lt;= 'p</code></p>



<a name="259874136"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/186049-t-compiler/wg-polonius/topic/Reintroducing%20loans/near/259874136" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/186049-t-compiler/wg-polonius/topic/Reintroducing.20loans.html#259874136">(Nov 01 2021 at 14:59)</a>:</h4>
<p>for lifetimes, <code>'q</code> has more points in time than <code>'p</code>, because otherwise <code>'p</code> could be used somewhere that <code>'q</code> is not valid, and <code>'p</code> may contain data from <code>'q</code>...</p>



<a name="259874176"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/186049-t-compiler/wg-polonius/topic/Reintroducing%20loans/near/259874176" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/186049-t-compiler/wg-polonius/topic/Reintroducing.20loans.html#259874176">(Nov 01 2021 at 14:59)</a>:</h4>
<p>I can't quite tell if that answers your question :)</p>



<a name="259874185"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/186049-t-compiler/wg-polonius/topic/Reintroducing%20loans/near/259874185" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/186049-t-compiler/wg-polonius/topic/Reintroducing.20loans.html#259874185">(Nov 01 2021 at 14:59)</a>:</h4>
<p>I'll have to double check the text I wrote to see that it is consistent</p>



<a name="259874195"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/186049-t-compiler/wg-polonius/topic/Reintroducing%20loans/near/259874195" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/186049-t-compiler/wg-polonius/topic/Reintroducing.20loans.html#259874195">(Nov 01 2021 at 14:59)</a>:</h4>
<p>it's easy to get turned out around here</p>



<a name="259874219"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/186049-t-compiler/wg-polonius/topic/Reintroducing%20loans/near/259874219" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Boxy [she/her] <a href="https://zulip-archive.rust-lang.org/stream/186049-t-compiler/wg-polonius/topic/Reintroducing.20loans.html#259874219">(Nov 01 2021 at 14:59)</a>:</h4>
<p><code>'p</code> and <code>'q</code> are visually quite similar making this for a confusing read <span aria-label="sweat smile" class="emoji emoji-1f605" role="img" title="sweat smile">:sweat_smile:</span></p>



<a name="259875574"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/186049-t-compiler/wg-polonius/topic/Reintroducing%20loans/near/259875574" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/186049-t-compiler/wg-polonius/topic/Reintroducing.20loans.html#259875574">(Nov 01 2021 at 15:10)</a>:</h4>
<p>doh</p>



<a name="259875585"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/186049-t-compiler/wg-polonius/topic/Reintroducing%20loans/near/259875585" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/186049-t-compiler/wg-polonius/topic/Reintroducing.20loans.html#259875585">(Nov 01 2021 at 15:10)</a>:</h4>
<p><code>a = b</code></p>



<a name="259875599"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/186049-t-compiler/wg-polonius/topic/Reintroducing%20loans/near/259875599" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/186049-t-compiler/wg-polonius/topic/Reintroducing.20loans.html#259875599">(Nov 01 2021 at 15:10)</a>:</h4>
<p>data from <code>b</code> flows into <code>a</code>, so <code>&amp;'b u32 &lt;: &amp;'a u32</code></p>



<a name="259875629"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/186049-t-compiler/wg-polonius/topic/Reintroducing%20loans/near/259875629" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/186049-t-compiler/wg-polonius/topic/Reintroducing.20loans.html#259875629">(Nov 01 2021 at 15:10)</a>:</h4>
<p>either way, we write this as <code>'b: 'a</code></p>



<a name="259875659"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/186049-t-compiler/wg-polonius/topic/Reintroducing%20loans/near/259875659" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/186049-t-compiler/wg-polonius/topic/Reintroducing.20loans.html#259875659">(Nov 01 2021 at 15:10)</a>:</h4>
<p>in lease model, this means that <code>'b &lt;= 'a</code> (covariant) -- i.e., the set of leases in <code>'b</code> are a subset of those in <code>'a</code>, as it may come from add'l places</p>



<a name="259875717"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/186049-t-compiler/wg-polonius/topic/Reintroducing%20loans/near/259875717" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/186049-t-compiler/wg-polonius/topic/Reintroducing.20loans.html#259875717">(Nov 01 2021 at 15:11)</a>:</h4>
<p>in "points in time" model, this means that <code>'a &lt;= 'b</code> (contravariant!), because the source must outlive the target</p>



<a name="259923970"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/186049-t-compiler/wg-polonius/topic/Reintroducing%20loans/near/259923970" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/186049-t-compiler/wg-polonius/topic/Reintroducing.20loans.html#259923970">(Nov 01 2021 at 21:28)</a>:</h4>
<p>I'm curious <span class="user-mention" data-user-id="118594">@Dylan MacKenzie (ecstatic-morse)</span> whether you had a chance to review <a href="https://github.com/nikomatsakis/polonius.next/pull/15">https://github.com/nikomatsakis/polonius.next/pull/15</a></p>



<a name="259924048"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/186049-t-compiler/wg-polonius/topic/Reintroducing%20loans/near/259924048" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/186049-t-compiler/wg-polonius/topic/Reintroducing.20loans.html#259924048">(Nov 01 2021 at 21:29)</a>:</h4>
<p><span class="user-mention silent" data-user-id="116009">nikomatsakis</span> <a href="#narrow/stream/186049-t-compiler.2Fwg-polonius/topic/Reintroducing.20loans/near/259874185">said</a>:</p>
<blockquote>
<p>I'll have to double check the text I wrote to see that it is consistent</p>
</blockquote>
<p>I believe what I wrote is consistent, but I think I will rewrite it to use the <code>:</code> notation instead of <code>&lt;=</code></p>



<a name="259924259"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/186049-t-compiler/wg-polonius/topic/Reintroducing%20loans/near/259924259" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/186049-t-compiler/wg-polonius/topic/Reintroducing.20loans.html#259924259">(Nov 01 2021 at 21:30)</a>:</h4>
<p>(fixed)</p>



<a name="259933991"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/186049-t-compiler/wg-polonius/topic/Reintroducing%20loans/near/259933991" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Domenic Quirl <a href="https://zulip-archive.rust-lang.org/stream/186049-t-compiler/wg-polonius/topic/Reintroducing.20loans.html#259933991">(Nov 01 2021 at 23:21)</a>:</h4>
<p><span class="user-mention silent" data-user-id="116009">nikomatsakis</span> <a href="#narrow/stream/186049-t-compiler.2Fwg-polonius/topic/Reintroducing.20loans/near/259874176">said</a>:</p>
<blockquote>
<p>I can't quite tell if that answers your question :)</p>
</blockquote>
<p>It was certainly helpful... but I think </p>
<p><span class="user-mention silent" data-user-id="116009">nikomatsakis</span> <a href="#narrow/stream/186049-t-compiler.2Fwg-polonius/topic/Reintroducing.20loans/near/259924048">said</a>:</p>
<blockquote>
<p>I will rewrite it to use the <code>:</code> notation instead of <code>&lt;=</code></p>
</blockquote>
<p>this is the best possible outcome regardless ^^</p>



<a name="259935400"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/186049-t-compiler/wg-polonius/topic/Reintroducing%20loans/near/259935400" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Domenic Quirl <a href="https://zulip-archive.rust-lang.org/stream/186049-t-compiler/wg-polonius/topic/Reintroducing.20loans.html#259935400">(Nov 01 2021 at 23:30)</a>:</h4>
<p><span class="user-mention silent" data-user-id="116113">lqd</span> <a href="#narrow/stream/186049-t-compiler.2Fwg-polonius/topic/Reintroducing.20loans/near/259698223">said</a>:</p>
<blockquote>
<p>adding liveness makes .next a lot closer to the current rules and makes it less appealing to me personally</p>
</blockquote>
<p>This got me thinking again about other ways to do liveness <em>within purely forward propagation</em>. After tinkering with it over the week-end I can now confidently say that that is pain - at least for me, it got to the point where I as a mere human just became increasingly confused about what effects are supposed to happen when rather quickly. <em>But</em> I think it's possible to track enough info going forward to know what subset relations to activate after seeing the relevant variables as live.</p>
<p>I made <a href="https://github.com/domenicquirl/polonius.next/blob/purely-forward-liveness/dl/polonius_dl.dl">https://github.com/domenicquirl/polonius.next/blob/purely-forward-liveness/dl/polonius_dl.dl</a> after I got fed up trying to encode this in Soufflé and moved to DDLog, because that has built-in collection types (sets, in particular). It matches the tests that we have so far, which might not mean I got everything completely right, but should be sufficient as a POC.</p>



<a name="259935435"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/186049-t-compiler/wg-polonius/topic/Reintroducing%20loans/near/259935435" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Domenic Quirl <a href="https://zulip-archive.rust-lang.org/stream/186049-t-compiler/wg-polonius/topic/Reintroducing.20loans.html#259935435">(Nov 01 2021 at 23:30)</a>:</h4>
<p>I'll say that I have no idea what that means, or if that even means anything</p>



<a name="259935619"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/186049-t-compiler/wg-polonius/topic/Reintroducing%20loans/near/259935619" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Domenic Quirl <a href="https://zulip-archive.rust-lang.org/stream/186049-t-compiler/wg-polonius/topic/Reintroducing.20loans.html#259935619">(Nov 01 2021 at 23:33)</a>:</h4>
<p>The number of tuples is surprisingly low given that it does set accumulation, but at the very least conceptually it's very much a "could" where I haven't let myself be stopped by the "should". I'd certainly rather have some backwards-ness than having to think about and maintain this all day ^^</p>



<a name="259935732"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/186049-t-compiler/wg-polonius/topic/Reintroducing%20loans/near/259935732" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Domenic Quirl <a href="https://zulip-archive.rust-lang.org/stream/186049-t-compiler/wg-polonius/topic/Reintroducing.20loans.html#259935732">(Nov 01 2021 at 23:34)</a>:</h4>
<p>(it also doesn't actually help with your/our gripe of needing liveness, since it's just represented in a different, perhaps more convoluted way, so, yeah.)</p>



<a name="259935859"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/186049-t-compiler/wg-polonius/topic/Reintroducing%20loans/near/259935859" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Domenic Quirl <a href="https://zulip-archive.rust-lang.org/stream/186049-t-compiler/wg-polonius/topic/Reintroducing.20loans.html#259935859">(Nov 01 2021 at 23:35)</a>:</h4>
<p>but it's interesting</p>



<a name="259949603"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/186049-t-compiler/wg-polonius/topic/Reintroducing%20loans/near/259949603" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Dylan MacKenzie (ecstatic-morse) <a href="https://zulip-archive.rust-lang.org/stream/186049-t-compiler/wg-polonius/topic/Reintroducing.20loans.html#259949603">(Nov 02 2021 at 03:25)</a>:</h4>
<p><span class="user-mention silent" data-user-id="116009">nikomatsakis</span> <a href="#narrow/stream/186049-t-compiler.2Fwg-polonius/topic/Reintroducing.20loans/near/259923970">said</a>:</p>
<blockquote>
<p>I'm curious <span class="user-mention silent" data-user-id="118594">Dylan MacKenzie (ecstatic-morse)</span> whether you had a chance to review <a href="https://github.com/nikomatsakis/polonius.next/pull/15">https://github.com/nikomatsakis/polonius.next/pull/15</a></p>
</blockquote>
<p>I looked over the handwritten facts pretty closely this evening and left a few comments. I don't think I have as good of an intuition for the rules themselves yet.</p>
<p>One of the things I liked about the old formulation was that <code>origin_live_at</code> was self-contained, whereas in this one <code>clear_origin</code> is doing double duty, making origins go dead when they are assigned to and also participating in <code>origin_invalidated</code> and <code>member</code>. This would be fine if <code>clear_origin</code> had a more straightforward meaning in Rust like <code>access_origin</code> does. Maybe it does, but I just don't know what it is. Overwriting a variable/path is obvious, but I don't see the connection between that and the write to <code>x</code> clearing <code>*x</code>.</p>
<p>Am I right that this version gives us the "field-sensitive" liveness that NIko mentioned elsewhere, since <code>access_origin</code> and <code>clear_origin</code> are able to handle projections.</p>



<a name="259949657"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/186049-t-compiler/wg-polonius/topic/Reintroducing%20loans/near/259949657" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Dylan MacKenzie (ecstatic-morse) <a href="https://zulip-archive.rust-lang.org/stream/186049-t-compiler/wg-polonius/topic/Reintroducing.20loans.html#259949657">(Nov 02 2021 at 03:26)</a>:</h4>
<p>Ah, I think Domenic already addressed my review comment at the top of this thread.</p>



<a name="259982231"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/186049-t-compiler/wg-polonius/topic/Reintroducing%20loans/near/259982231" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> lqd <a href="https://zulip-archive.rust-lang.org/stream/186049-t-compiler/wg-polonius/topic/Reintroducing.20loans.html#259982231">(Nov 02 2021 at 11:27)</a>:</h4>
<p>is there an explanation/summary about why the concept of "loan origins" was introduced ? I missed most of the sprint and would expect you discussed it then, maybe it's in the hackmd ?</p>



<a name="259982670"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/186049-t-compiler/wg-polonius/topic/Reintroducing%20loans/near/259982670" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> lqd <a href="https://zulip-archive.rust-lang.org/stream/186049-t-compiler/wg-polonius/topic/Reintroducing.20loans.html#259982670">(Nov 02 2021 at 11:32)</a>:</h4>
<p><span class="user-mention silent" data-user-id="337115">Domenic Quirl</span> <a href="#narrow/stream/186049-t-compiler.2Fwg-polonius/topic/Reintroducing.20loans/near/259935619">said</a>:</p>
<blockquote>
<p>I'd certainly rather have some backwards-ness than having to think about and maintain this all day ^^</p>
</blockquote>
<p>agreed, if we need liveness we need liveness, might as well use it. it's unfortunate, but then that begs the question of the fundamental differences with the current version.</p>



<a name="259982905"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/186049-t-compiler/wg-polonius/topic/Reintroducing%20loans/near/259982905" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> lqd <a href="https://zulip-archive.rust-lang.org/stream/186049-t-compiler/wg-polonius/topic/Reintroducing.20loans.html#259982905">(Nov 02 2021 at 11:35)</a>:</h4>
<p><span class="user-mention silent" data-user-id="337115">Domenic Quirl</span> <a href="#narrow/stream/186049-t-compiler.2Fwg-polonius/topic/Reintroducing.20loans/near/259935732">said</a>:</p>
<blockquote>
<p>(it also doesn't actually help with your/our gripe of needing liveness, since it's just represented in a different, perhaps more convoluted way, so, yeah.)</p>
</blockquote>
<p>it's not a gripe per se, it's the stated goal of .next. if it doesn't work out, it doesn't work out, it's ok ^^</p>



<a name="259984474"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/186049-t-compiler/wg-polonius/topic/Reintroducing%20loans/near/259984474" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> lqd <a href="https://zulip-archive.rust-lang.org/stream/186049-t-compiler/wg-polonius/topic/Reintroducing.20loans.html#259984474">(Nov 02 2021 at 11:51)</a>:</h4>
<p>the more precise control of effects over time rather than space allows to have our usual cfgs (and not double the points) compared to today, so that's a big yes from me; but at the same time, it is untested. So I'm not sure we're in a position to compare both approaches just yet (at first glance, the differences are small enough to wonder whether it just moves the error locations). That being said, the formulation with loans does look clearer than the one with "loan origins" (but I assumed that was more because I wasn't sure what they were modeling, hence the question about them above) apart from the same questions dylan and domenic pointed out above about clearing origins/loans</p>



<a name="259986524"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/186049-t-compiler/wg-polonius/topic/Reintroducing%20loans/near/259986524" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Domenic Quirl <a href="https://zulip-archive.rust-lang.org/stream/186049-t-compiler/wg-polonius/topic/Reintroducing.20loans.html#259986524">(Nov 02 2021 at 12:11)</a>:</h4>
<p><span class="user-mention silent" data-user-id="116113">lqd</span> <a href="#narrow/stream/186049-t-compiler.2Fwg-polonius/topic/Reintroducing.20loans/near/259982231">said</a>:</p>
<blockquote>
<p>is there an explanation/summary about why the concept of "loan origins" was introduced ? I missed most of the sprint and would expect you discussed it then, maybe it's in the hackmd ?</p>
</blockquote>
<p>the short version is that it was necessary to move from the (MIR-translation based) <code>kill_origin</code> input facts to actual computed liveness</p>



<a name="259986732"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/186049-t-compiler/wg-polonius/topic/Reintroducing%20loans/near/259986732" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Domenic Quirl <a href="https://zulip-archive.rust-lang.org/stream/186049-t-compiler/wg-polonius/topic/Reintroducing.20loans.html#259986732">(Nov 02 2021 at 12:13)</a>:</h4>
<p>the <code>kill</code> facts were only "generated" (hand-written) for origins in the types of variables. Doing a liveness computation generally for all origins means it affects type origins and loan origins (those of borrows) equally.</p>



<a name="259986893"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/186049-t-compiler/wg-polonius/topic/Reintroducing%20loans/near/259986893" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Domenic Quirl <a href="https://zulip-archive.rust-lang.org/stream/186049-t-compiler/wg-polonius/topic/Reintroducing.20loans.html#259986893">(Nov 02 2021 at 12:15)</a>:</h4>
<p>And the logic will always kill something like an <code>'L_x</code>, because these origins are never accessed directly (because there is no way to reference them)</p>



<a name="259987166"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/186049-t-compiler/wg-polonius/topic/Reintroducing%20loans/near/259987166" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Domenic Quirl <a href="https://zulip-archive.rust-lang.org/stream/186049-t-compiler/wg-polonius/topic/Reintroducing.20loans.html#259987166">(Nov 02 2021 at 12:18)</a>:</h4>
<p><span class="user-mention silent" data-user-id="116113">lqd</span> <a href="#narrow/stream/186049-t-compiler.2Fwg-polonius/topic/Reintroducing.20loans/near/259984474">said</a>:</p>
<blockquote>
<p>the more precise control of effects over time rather than space allows to have our usual cfgs (and not double the points)</p>
</blockquote>
<p>I would argue that to some extent this is still reflected in having <code>relation_on_entry</code> and <code>relation_on_entry</code> facts, though perhaps in a nicer manner than actually splitting the CFG nodes</p>



<a name="259988699"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/186049-t-compiler/wg-polonius/topic/Reintroducing%20loans/near/259988699" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> lqd <a href="https://zulip-archive.rust-lang.org/stream/186049-t-compiler/wg-polonius/topic/Reintroducing.20loans.html#259988699">(Nov 02 2021 at 12:33)</a>:</h4>
<p>yes but some of these on_entry + on_exit relations' existence doesn't seem fundamental to this PR ? while splitting the cfg also required duplicating the liveness data to these new points.</p>
<p>maybe it looks like it helps more than it actually does</p>



<a name="259989246"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/186049-t-compiler/wg-polonius/topic/Reintroducing%20loans/near/259989246" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Domenic Quirl <a href="https://zulip-archive.rust-lang.org/stream/186049-t-compiler/wg-polonius/topic/Reintroducing.20loans.html#259989246">(Nov 02 2021 at 12:38)</a>:</h4>
<p>It's not specifically the PR, the current <code>main</code> rules from last sprint already have this split for their version of liveness and, notably, for the subset relation</p>



<a name="259989456"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/186049-t-compiler/wg-polonius/topic/Reintroducing%20loans/near/259989456" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Domenic Quirl <a href="https://zulip-archive.rust-lang.org/stream/186049-t-compiler/wg-polonius/topic/Reintroducing.20loans.html#259989456">(Nov 02 2021 at 12:40)</a>:</h4>
<p>Having that might be better than double nodes (idk, but I do find it to be reasonably understandable logically at least). My intention was more to point out that these relations are a different representation of the same underlying thing, namely that at the start of a node and at the end of a node different properties hold</p>



<a name="259998814"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/186049-t-compiler/wg-polonius/topic/Reintroducing%20loans/near/259998814" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/186049-t-compiler/wg-polonius/topic/Reintroducing.20loans.html#259998814">(Nov 02 2021 at 14:00)</a>:</h4>
<p><span class="user-mention silent" data-user-id="118594">Dylan MacKenzie (ecstatic-morse)</span> <a href="#narrow/stream/186049-t-compiler.2Fwg-polonius/topic/Reintroducing.20loans/near/259949603">said</a>:</p>
<blockquote>
<p>This would be fine if <code>clear_origin</code> had a more straightforward meaning in Rust like <code>access_origin</code> does. Maybe it does, but I just don't know what it is.</p>
</blockquote>
<p>I think it does -- I believe (in this formulation) that it corresponds specifically to "all values with this origin in their type were overwritten (and hence now refer to something different".</p>
<blockquote>
<p>Overwriting a variable/path is obvious, but I don't see the connection between that and the write to x clearing *x.</p>
</blockquote>
<p>Well, if <code>x</code> is has changed then <code>*x</code> has too, no?</p>
<p>Ah, I guess you are referring to the use of <code>clear_origin</code> for when we write to <code>temp</code> and we wish to clear loans of <code>*temp</code>? But that is <code>clear_lease</code>, right? So presumably not.</p>



<a name="260026806"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/186049-t-compiler/wg-polonius/topic/Reintroducing%20loans/near/260026806" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Dylan MacKenzie (ecstatic-morse) <a href="https://zulip-archive.rust-lang.org/stream/186049-t-compiler/wg-polonius/topic/Reintroducing.20loans.html#260026806">(Nov 02 2021 at 17:06)</a>:</h4>
<p><span class="user-mention silent" data-user-id="337115">Domenic Quirl</span> <a href="#narrow/stream/186049-t-compiler.2Fwg-polonius/topic/Reintroducing.20loans/near/259583713">said</a>:</p>
<blockquote>
<p><span class="user-mention silent" data-user-id="116113">lqd</span> <a href="#narrow/stream/186049-t-compiler.2Fwg-polonius/topic/Reintroducing.20loans/near/259582369">said</a>:</p>
<blockquote>
<p>seems like should be <code>clear_lease</code> right ?</p>
</blockquote>
<p>also yes on this, but there is a paragraph for leases right below that has the same example again, and nothing about the actual clear rules for origins. So that's why I assumed that to be the thing to change</p>
</blockquote>
<p>Looks like Domenic and Remy already discussed this above. Perhaps the fact generation section I was looking at is outdated and can be removed?</p>



<a name="260026926"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/186049-t-compiler/wg-polonius/topic/Reintroducing%20loans/near/260026926" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Dylan MacKenzie (ecstatic-morse) <a href="https://zulip-archive.rust-lang.org/stream/186049-t-compiler/wg-polonius/topic/Reintroducing.20loans.html#260026926">(Nov 02 2021 at 17:07)</a>:</h4>
<p>So, yes <code>clear_origin</code> is whenever a variable (with an origin in its type) is written to</p>



<a name="260027575"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/186049-t-compiler/wg-polonius/topic/Reintroducing%20loans/near/260027575" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Dylan MacKenzie (ecstatic-morse) <a href="https://zulip-archive.rust-lang.org/stream/186049-t-compiler/wg-polonius/topic/Reintroducing.20loans.html#260027575">(Nov 02 2021 at 17:12)</a>:</h4>
<p>In traditional pointer analyses, <code>*x</code> and <code>x</code> are treated as totally different places, which I think is contributing to my confusion.</p>



<a name="260027762"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/186049-t-compiler/wg-polonius/topic/Reintroducing%20loans/near/260027762" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Dylan MacKenzie (ecstatic-morse) <a href="https://zulip-archive.rust-lang.org/stream/186049-t-compiler/wg-polonius/topic/Reintroducing.20loans.html#260027762">(Nov 02 2021 at 17:14)</a>:</h4>
<p>Here, when you overwrite <code>x</code>, you can no longer access the set of loans in <code>*x</code> via that name, so we clear <code>*x</code>. In our framework, clearing does not preclude accesses through some other path (e.g. <code>*y</code> if <code>y == x</code>).</p>



<a name="260027925"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/186049-t-compiler/wg-polonius/topic/Reintroducing%20loans/near/260027925" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Dylan MacKenzie (ecstatic-morse) <a href="https://zulip-archive.rust-lang.org/stream/186049-t-compiler/wg-polonius/topic/Reintroducing.20loans.html#260027925">(Nov 02 2021 at 17:15)</a>:</h4>
<p>So maybe we should just remove the term "lease origin" from that section? Is the distinction from a regular origin meaningful in this context?</p>



<a name="260057128"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/186049-t-compiler/wg-polonius/topic/Reintroducing%20loans/near/260057128" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> lqd <a href="https://zulip-archive.rust-lang.org/stream/186049-t-compiler/wg-polonius/topic/Reintroducing.20loans.html#260057128">(Nov 02 2021 at 20:59)</a>:</h4>
<p>I've also added a few comments</p>



<a name="260130791"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/186049-t-compiler/wg-polonius/topic/Reintroducing%20loans/near/260130791" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/186049-t-compiler/wg-polonius/topic/Reintroducing.20loans.html#260130791">(Nov 03 2021 at 13:06)</a>:</h4>
<p><span class="user-mention" data-user-id="118594">@Dylan MacKenzie (ecstatic-morse)</span> I pushed some comments that tried to give a clearer explanation for <em>what</em> each input fact means</p>



<a name="260131657"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/186049-t-compiler/wg-polonius/topic/Reintroducing%20loans/near/260131657" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/186049-t-compiler/wg-polonius/topic/Reintroducing.20loans.html#260131657">(Nov 03 2021 at 13:13)</a>:</h4>
<p>I'm thinking that if we start to incorporate the "initialization" analysis, things might wind up being nicer</p>



<a name="260131672"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/186049-t-compiler/wg-polonius/topic/Reintroducing%20loans/near/260131672" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/186049-t-compiler/wg-polonius/topic/Reintroducing.20loans.html#260131672">(Nov 03 2021 at 13:13)</a>:</h4>
<p>e.g. the base fact for <code>x = y</code> would be <code>assigned(x)</code> instead</p>



<a name="260133407"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/186049-t-compiler/wg-polonius/topic/Reintroducing%20loans/near/260133407" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/186049-t-compiler/wg-polonius/topic/Reintroducing.20loans.html#260133407">(Nov 03 2021 at 13:27)</a>:</h4>
<p><span class="user-mention" data-user-id="116113">@lqd</span> regarding the re-introduction of leases: it's not an open and shut case, but what we found in discussing was that there were several cases where we wanted to treat "loan origins" differently from "normal origins", and that some of the complexity in the rules was deriving from trying to conflate them.</p>



<a name="260133448"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/186049-t-compiler/wg-polonius/topic/Reintroducing%20loans/near/260133448" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/186049-t-compiler/wg-polonius/topic/Reintroducing.20loans.html#260133448">(Nov 03 2021 at 13:27)</a>:</h4>
<p>One prime example was the rule that said: given an <code>&amp;'Lx x</code> expression, you want to "clear" <code>'Lx</code></p>



<a name="260133509"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/186049-t-compiler/wg-polonius/topic/Reintroducing%20loans/near/260133509" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/186049-t-compiler/wg-polonius/topic/Reintroducing.20loans.html#260133509">(Nov 03 2021 at 13:28)</a>:</h4>
<p>that rule was clearly <em>needed</em> but it was hard to square it intuitively</p>



<a name="260133518"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/186049-t-compiler/wg-polonius/topic/Reintroducing%20loans/near/260133518" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/186049-t-compiler/wg-polonius/topic/Reintroducing.20loans.html#260133518">(Nov 03 2021 at 13:28)</a>:</h4>
<p>it just goes away with leases</p>



<a name="260133547"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/186049-t-compiler/wg-polonius/topic/Reintroducing%20loans/near/260133547" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/186049-t-compiler/wg-polonius/topic/Reintroducing.20loans.html#260133547">(Nov 03 2021 at 13:28)</a>:</h4>
<p>the reason for that rule was that, when you initialize <code>x</code> to begin with, you have <code>x = 5</code>, that was introducing an "invalidate origin" rule</p>



<a name="260133560"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/186049-t-compiler/wg-polonius/topic/Reintroducing%20loans/near/260133560" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/186049-t-compiler/wg-polonius/topic/Reintroducing.20loans.html#260133560">(Nov 03 2021 at 13:28)</a>:</h4>
<p>and we needed to clear that invalidation</p>



<a name="260133605"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/186049-t-compiler/wg-polonius/topic/Reintroducing%20loans/near/260133605" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/186049-t-compiler/wg-polonius/topic/Reintroducing.20loans.html#260133605">(Nov 03 2021 at 13:29)</a>:</h4>
<p>but in fact invalidating a <em>lease</em> is instantaneous, and it just causes any origins that <em>contain</em> the lease to be invalidated</p>



<a name="260133627"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/186049-t-compiler/wg-polonius/topic/Reintroducing%20loans/near/260133627" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/186049-t-compiler/wg-polonius/topic/Reintroducing.20loans.html#260133627">(Nov 03 2021 at 13:29)</a>:</h4>
<p>in a case like this:</p>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="n">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">5</span><span class="w"></span>
<span class="n">y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">&amp;</span><span class="n">x</span><span class="w"></span>
</code></pre></div>



<a name="260133635"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/186049-t-compiler/wg-polonius/topic/Reintroducing%20loans/near/260133635" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/186049-t-compiler/wg-polonius/topic/Reintroducing.20loans.html#260133635">(Nov 03 2021 at 13:29)</a>:</h4>
<p>there are no origins containing the lease yet (it hasn't started)</p>



<a name="260133640"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/186049-t-compiler/wg-polonius/topic/Reintroducing%20loans/near/260133640" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/186049-t-compiler/wg-polonius/topic/Reintroducing.20loans.html#260133640">(Nov 03 2021 at 13:29)</a>:</h4>
<p>so it's a no-op</p>



<a name="260133666"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/186049-t-compiler/wg-polonius/topic/Reintroducing%20loans/near/260133666" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/186049-t-compiler/wg-polonius/topic/Reintroducing.20loans.html#260133666">(Nov 03 2021 at 13:29)</a>:</h4>
<p>we furthermore reasoned that the <em>actual number of tuples</em> was no different, we're just giving them different <em>names</em></p>



<a name="260133788"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/186049-t-compiler/wg-polonius/topic/Reintroducing%20loans/near/260133788" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/186049-t-compiler/wg-polonius/topic/Reintroducing.20loans.html#260133788">(Nov 03 2021 at 13:30)</a>:</h4>
<p>that said, <span class="user-mention" data-user-id="337115">@Domenic Quirl</span> remained unconvinced :)</p>



<a name="260134688"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/186049-t-compiler/wg-polonius/topic/Reintroducing%20loans/near/260134688" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Domenic Quirl <a href="https://zulip-archive.rust-lang.org/stream/186049-t-compiler/wg-polonius/topic/Reintroducing.20loans.html#260134688">(Nov 03 2021 at 13:37)</a>:</h4>
<p>To clarify, unconvinced only in the sense that I saw an opportunity to relatively closely align the rules with current "things" in Rust in that</p>
<ul>
<li>regular "type" origins ^= lifetimes the user writes (or elides),</li>
<li>"loan" origins ^= lifetimes of borrows, and then</li>
<li>"placeholder" origins ^= "generic"/named lifetimes (the new rules don't have placeholders yet, but there was some discussion during the call that modelling them as loans <em>could be</em> less intuitive than origins)</li>
</ul>
<p>all potentially modulo some details, but I feel drawn to such an alignment because imo it increases understandability of the rules by people that are not us</p>



<a name="260134933"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/186049-t-compiler/wg-polonius/topic/Reintroducing%20loans/near/260134933" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Domenic Quirl <a href="https://zulip-archive.rust-lang.org/stream/186049-t-compiler/wg-polonius/topic/Reintroducing.20loans.html#260134933">(Nov 03 2021 at 13:39)</a>:</h4>
<p>With the proposed rules with loans, some things definitely become nicer. A good example of this I think is exactly the "marking of loan origins" in the liveness rules - with loans, "a loan has been propagated and is now invalidated for a live origin" is better/more intuitive too me than "for technical reasons we consider loan origins to always be live (but only because there is no real way to ever access them, so what are we to do)"</p>



<a name="260135202"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/186049-t-compiler/wg-polonius/topic/Reintroducing%20loans/near/260135202" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Domenic Quirl <a href="https://zulip-archive.rust-lang.org/stream/186049-t-compiler/wg-polonius/topic/Reintroducing.20loans.html#260135202">(Nov 03 2021 at 13:41)</a>:</h4>
<p>But I wanted to point out that there are <em>also</em> arguments for the "loan origin" version, and that I felt like at least part of why this <code>mark_as_loan_origin</code> stuff seems confusing may be that the naming is unclear/could better reflect what this models</p>



<a name="260173854"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/186049-t-compiler/wg-polonius/topic/Reintroducing%20loans/near/260173854" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> lqd <a href="https://zulip-archive.rust-lang.org/stream/186049-t-compiler/wg-polonius/topic/Reintroducing.20loans.html#260173854">(Nov 03 2021 at 18:07)</a>:</h4>
<p>thanks a bunch for the explanations ! current polonius also had at some point a vocabulary of "loan origins" (but just in relations, they had no semantic differences): "borrow regions"</p>



<a name="260176361"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/186049-t-compiler/wg-polonius/topic/Reintroducing%20loans/near/260176361" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> lqd <a href="https://zulip-archive.rust-lang.org/stream/186049-t-compiler/wg-polonius/topic/Reintroducing.20loans.html#260176361">(Nov 03 2021 at 18:24)</a>:</h4>
<p>at least I'm still hopeful that loans are not fundamental to the model</p>



<a name="260177448"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/186049-t-compiler/wg-polonius/topic/Reintroducing%20loans/near/260177448" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> lqd <a href="https://zulip-archive.rust-lang.org/stream/186049-t-compiler/wg-polonius/topic/Reintroducing.20loans.html#260177448">(Nov 03 2021 at 18:32)</a>:</h4>
<p>(and hope we don't forget the people who <em>currently</em> understand the rules and are not us, and not cause them too many unneeded changes, like terminology for example :)</p>



<a name="260213442"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/186049-t-compiler/wg-polonius/topic/Reintroducing%20loans/near/260213442" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> lqd <a href="https://zulip-archive.rust-lang.org/stream/186049-t-compiler/wg-polonius/topic/Reintroducing.20loans.html#260213442">(Nov 03 2021 at 23:54)</a>:</h4>
<p>btw I've checked this PR's <code>on_entry</code>/<code>on_exit</code> relations that we've discussed recently, and they all seem trivially inlinable. we could probably mark the <code>on_entry</code> relations <code>inline</code> now if we wanted to (but I don't think it's supported in older versions of soufflé)</p>



<a name="260320995"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/186049-t-compiler/wg-polonius/topic/Reintroducing%20loans/near/260320995" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/186049-t-compiler/wg-polonius/topic/Reintroducing.20loans.html#260320995">(Nov 04 2021 at 19:20)</a>:</h4>
<p>I've been pondering terminology</p>



<a name="260321006"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/186049-t-compiler/wg-polonius/topic/Reintroducing%20loans/near/260321006" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/186049-t-compiler/wg-polonius/topic/Reintroducing.20loans.html#260321006">(Nov 04 2021 at 19:20)</a>:</h4>
<p>I wonder if an <em>origin</em> would, actually, be better called a <em>lease</em> ?</p>



<a name="260321035"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/186049-t-compiler/wg-polonius/topic/Reintroducing%20loans/near/260321035" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/186049-t-compiler/wg-polonius/topic/Reintroducing.20loans.html#260321035">(Nov 04 2021 at 19:20)</a>:</h4>
<p>and then a <em>lease</em> would be something like... well, to continue the metaphor it'd probably be a "property"</p>



<a name="260321037"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/186049-t-compiler/wg-polonius/topic/Reintroducing%20loans/near/260321037" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/186049-t-compiler/wg-polonius/topic/Reintroducing.20loans.html#260321037">(Nov 04 2021 at 19:20)</a>:</h4>
<p>lol</p>



<a name="260321042"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/186049-t-compiler/wg-polonius/topic/Reintroducing%20loans/near/260321042" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/186049-t-compiler/wg-polonius/topic/Reintroducing.20loans.html#260321042">(Nov 04 2021 at 19:20)</a>:</h4>
<p>but we could <em>almost</em> just call it a place</p>



<a name="260321059"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/186049-t-compiler/wg-polonius/topic/Reintroducing%20loans/near/260321059" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/186049-t-compiler/wg-polonius/topic/Reintroducing.20loans.html#260321059">(Nov 04 2021 at 19:21)</a>:</h4>
<p>i.e., "a lease is a set of places that may be references (and the way in which they may be referenced)"</p>



<a name="260321091"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/186049-t-compiler/wg-polonius/topic/Reintroducing%20loans/near/260321091" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/186049-t-compiler/wg-polonius/topic/Reintroducing.20loans.html#260321091">(Nov 04 2021 at 19:21)</a>:</h4>
<p>one interesting thing about this:</p>



<a name="260321108"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/186049-t-compiler/wg-polonius/topic/Reintroducing%20loans/near/260321108" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/186049-t-compiler/wg-polonius/topic/Reintroducing.20loans.html#260321108">(Nov 04 2021 at 19:21)</a>:</h4>
<p>it is totally reasonable to say "a lease l1 outlives the lease l2"</p>



<a name="260321123"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/186049-t-compiler/wg-polonius/topic/Reintroducing%20loans/near/260321123" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/186049-t-compiler/wg-polonius/topic/Reintroducing.20loans.html#260321123">(Nov 04 2021 at 19:21)</a>:</h4>
<p>and it has the right intution</p>



<a name="260321150"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/186049-t-compiler/wg-polonius/topic/Reintroducing%20loans/near/260321150" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/186049-t-compiler/wg-polonius/topic/Reintroducing.20loans.html#260321150">(Nov 04 2021 at 19:21)</a>:</h4>
<p>"a lease l1 outlives a lease l2 iff places(l1) subset of places(l2)"</p>



<a name="260321209"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/186049-t-compiler/wg-polonius/topic/Reintroducing%20loans/near/260321209" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/186049-t-compiler/wg-polonius/topic/Reintroducing.20loans.html#260321209">(Nov 04 2021 at 19:22)</a>:</h4>
<p>this makes sense because a lease <em>ends</em> when the places it may be borrowed from are accessed in an incompatible way</p>



<a name="260321237"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/186049-t-compiler/wg-polonius/topic/Reintroducing%20loans/near/260321237" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/186049-t-compiler/wg-polonius/topic/Reintroducing.20loans.html#260321237">(Nov 04 2021 at 19:22)</a>:</h4>
<p>it feels like convincing the world to rename from lifetime =&gt; lease would be easier</p>



<a name="260321240"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/186049-t-compiler/wg-polonius/topic/Reintroducing%20loans/near/260321240" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/186049-t-compiler/wg-polonius/topic/Reintroducing.20loans.html#260321240">(Nov 04 2021 at 19:22)</a>:</h4>
<p>than lifetime =&gt; origin</p>



<a name="260324458"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/186049-t-compiler/wg-polonius/topic/Reintroducing%20loans/near/260324458" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Dylan MacKenzie (ecstatic-morse) <a href="https://zulip-archive.rust-lang.org/stream/186049-t-compiler/wg-polonius/topic/Reintroducing.20loans.html#260324458">(Nov 04 2021 at 19:48)</a>:</h4>
<p><span class="user-mention silent" data-user-id="116009">nikomatsakis</span> <a href="#narrow/stream/186049-t-compiler.2Fwg-polonius/topic/Reintroducing.20loans/near/260321006">said</a>:</p>
<blockquote>
<p>I wonder if an <em>origin</em> would, actually, be better called a <em>lease</em> ?</p>
</blockquote>
<p>"tranche"</p>



<a name="260324598"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/186049-t-compiler/wg-polonius/topic/Reintroducing%20loans/near/260324598" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Dylan MacKenzie (ecstatic-morse) <a href="https://zulip-archive.rust-lang.org/stream/186049-t-compiler/wg-polonius/topic/Reintroducing.20loans.html#260324598">(Nov 04 2021 at 19:49)</a>:</h4>
<p>(although I think it literally means "portion", which is kind of the opposite of "set")</p>



<a name="260324772"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/186049-t-compiler/wg-polonius/topic/Reintroducing%20loans/near/260324772" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Dylan MacKenzie (ecstatic-morse) <a href="https://zulip-archive.rust-lang.org/stream/186049-t-compiler/wg-polonius/topic/Reintroducing.20loans.html#260324772">(Nov 04 2021 at 19:51)</a>:</h4>
<p><span class="user-mention silent" data-user-id="116009">nikomatsakis</span> <a href="#narrow/stream/186049-t-compiler.2Fwg-polonius/topic/Reintroducing.20loans/near/260130791">said</a>:</p>
<blockquote>
<p><span class="user-mention silent" data-user-id="118594">Dylan MacKenzie (ecstatic-morse)</span> I pushed some comments that tried to give a clearer explanation for <em>what</em> each input fact means</p>
</blockquote>
<p>I did look at this, btw. Would it be useful to compare and contrast the new formulation with the old now that it has converged somewhat?</p>



<a name="260324999"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/186049-t-compiler/wg-polonius/topic/Reintroducing%20loans/near/260324999" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Dylan MacKenzie (ecstatic-morse) <a href="https://zulip-archive.rust-lang.org/stream/186049-t-compiler/wg-polonius/topic/Reintroducing.20loans.html#260324999">(Nov 04 2021 at 19:52)</a>:</h4>
<p>I think <code>clear_origin</code> and <code>access_origin</code> are now analagous to <code>var_accessed_at</code> and <code>var_defined_at</code> from the liveness rules, but they are now field-sensitive (accessing a projection of a variable no longer accesses all origins in that variable).</p>



<a name="260325107"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/186049-t-compiler/wg-polonius/topic/Reintroducing%20loans/near/260325107" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Dylan MacKenzie (ecstatic-morse) <a href="https://zulip-archive.rust-lang.org/stream/186049-t-compiler/wg-polonius/topic/Reintroducing.20loans.html#260325107">(Nov 04 2021 at 19:53)</a>:</h4>
<p><code>clear_lease</code> is now exactly <code>kill_loan</code> (unless I've missed something, I was trying to clarify that above)</p>



<a name="260325343"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/186049-t-compiler/wg-polonius/topic/Reintroducing%20loans/near/260325343" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Dylan MacKenzie (ecstatic-morse) <a href="https://zulip-archive.rust-lang.org/stream/186049-t-compiler/wg-polonius/topic/Reintroducing.20loans.html#260325343">(Nov 04 2021 at 19:55)</a>:</h4>
<p><code>member</code> is <code>origin_contains_loan_at</code>/<code>requires</code></p>



<a name="260325840"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/186049-t-compiler/wg-polonius/topic/Reintroducing%20loans/near/260325840" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Dylan MacKenzie (ecstatic-morse) <a href="https://zulip-archive.rust-lang.org/stream/186049-t-compiler/wg-polonius/topic/Reintroducing.20loans.html#260325840">(Nov 04 2021 at 19:59)</a>:</h4>
<p>We've also introduced a division between "entry" and "exit" that doesn't exist in the original rules, which added an extra CFG node to differentiate between the two. I like encoding the division explicitly in the rules, since splitting CFG nodes moves the complexity to fact generation.</p>
<p>Is this transformation separable? I think it arose because we needed to be more precise about how <code>invalidated</code> gets cleared/propagates, but the old formulation might have benefited as well.</p>



<a name="260326252"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/186049-t-compiler/wg-polonius/topic/Reintroducing%20loans/near/260326252" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Dylan MacKenzie (ecstatic-morse) <a href="https://zulip-archive.rust-lang.org/stream/186049-t-compiler/wg-polonius/topic/Reintroducing.20loans.html#260326252">(Nov 04 2021 at 20:02)</a>:</h4>
<p>Finally, in the old formulation, <code>invalidated</code> existed at a single point. Now, we propagate it forward and defer the borrow error until an access actually occurs. I still don't understand why this is necessary now that we have included a notion of liveness: the fact that an origin is live means we know that it will be accessed later.</p>



<a name="260326858"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/186049-t-compiler/wg-polonius/topic/Reintroducing%20loans/near/260326858" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Dylan MacKenzie (ecstatic-morse) <a href="https://zulip-archive.rust-lang.org/stream/186049-t-compiler/wg-polonius/topic/Reintroducing.20loans.html#260326858">(Nov 04 2021 at 20:06)</a>:</h4>
<p>Obviously it's still correct, and it maps more closely to the way we think about error messages, which involve an invalidation followed by an access. But the old formulation had a pretty simple translation: "an error occurs when a loan is invalidated while still accessible via a live origin".  I feel like propagating <code>invalidated</code> muddies this somewhat, and I'm not sure what the benefit is.</p>



<a name="260327444"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/186049-t-compiler/wg-polonius/topic/Reintroducing%20loans/near/260327444" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Domenic Quirl <a href="https://zulip-archive.rust-lang.org/stream/186049-t-compiler/wg-polonius/topic/Reintroducing.20loans.html#260327444">(Nov 04 2021 at 20:10)</a>:</h4>
<p><span class="user-mention silent" data-user-id="118594">Dylan MacKenzie (ecstatic-morse)</span> <a href="#narrow/stream/186049-t-compiler.2Fwg-polonius/topic/Reintroducing.20loans/near/260324458">said</a>:</p>
<blockquote>
<p>"tranche"</p>
</blockquote>
<p>based on me not getting this, might not be the best choice for non-native speakers? <span aria-label="sweat smile" class="emoji emoji-1f605" role="img" title="sweat smile">:sweat_smile:</span></p>



<a name="260327461"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/186049-t-compiler/wg-polonius/topic/Reintroducing%20loans/near/260327461" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Dylan MacKenzie (ecstatic-morse) <a href="https://zulip-archive.rust-lang.org/stream/186049-t-compiler/wg-polonius/topic/Reintroducing.20loans.html#260327461">(Nov 04 2021 at 20:10)</a>:</h4>
<p><span class="user-mention silent" data-user-id="116113">lqd</span> <a href="#narrow/stream/186049-t-compiler.2Fwg-polonius/topic/Reintroducing.20loans/near/259698223">said</a>:</p>
<blockquote>
<p>that's what I was trying to convey last time, adding liveness makes .next a lot closer to the current rules (and the intuitiveness could just be familiarity) and makes it less appealing to me personally (it's possible it will need a less complicated optimized variant so I'm still hopeful)</p>
</blockquote>
<p>I think what I'm trying to say is that I feel the same as <span class="user-mention silent" data-user-id="116113">lqd</span> does.  The latest (sound) version of .next seems like more of a small change to the old ruleset than something new.</p>



<a name="260327790"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/186049-t-compiler/wg-polonius/topic/Reintroducing%20loans/near/260327790" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Dylan MacKenzie (ecstatic-morse) <a href="https://zulip-archive.rust-lang.org/stream/186049-t-compiler/wg-polonius/topic/Reintroducing.20loans.html#260327790">(Nov 04 2021 at 20:13)</a>:</h4>
<p><span class="user-mention silent" data-user-id="337115">Domenic Quirl</span> <a href="#narrow/stream/186049-t-compiler.2Fwg-polonius/topic/Reintroducing.20loans/near/260327444">said</a>:</p>
<blockquote>
<p><span class="user-mention silent" data-user-id="118594">Dylan MacKenzie (ecstatic-morse)</span> <a href="#narrow/stream/186049-t-compiler.2Fwg-polonius/topic/Reintroducing.20loans/near/260324458">said</a>:</p>
<blockquote>
<p>"tranche"</p>
</blockquote>
<p>based on me not getting this, might not be the best choice for non-native speakers? <span aria-label="sweat smile" class="emoji emoji-1f605" role="img" title="sweat smile">:sweat_smile:</span></p>
</blockquote>
<p>Parlez-vous Francais?</p>



<a name="260328092"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/186049-t-compiler/wg-polonius/topic/Reintroducing%20loans/near/260328092" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> lqd <a href="https://zulip-archive.rust-lang.org/stream/186049-t-compiler/wg-polonius/topic/Reintroducing.20loans.html#260328092">(Nov 04 2021 at 20:15)</a>:</h4>
<p><span class="user-mention silent" data-user-id="118594">Dylan MacKenzie (ecstatic-morse)</span> <a href="#narrow/stream/186049-t-compiler.2Fwg-polonius/topic/Reintroducing.20loans/near/260325840">said</a>:</p>
<blockquote>
<p>Is this transformation separable? I think it arose because we needed to be more precise about how <code>invalidated</code> gets cleared/propagates, but the old formulation might have benefited as well.</p>
</blockquote>
<p>I think we could apply the same thinking to the current formulation to get rid of mid-points</p>



<a name="260328334"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/186049-t-compiler/wg-polonius/topic/Reintroducing%20loans/near/260328334" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> lqd <a href="https://zulip-archive.rust-lang.org/stream/186049-t-compiler/wg-polonius/topic/Reintroducing.20loans.html#260328334">(Nov 04 2021 at 20:17)</a>:</h4>
<p><span class="user-mention" data-user-id="118594">@Dylan MacKenzie (ecstatic-morse)</span>  the french community already has the perfect use of "tranche" for a kind of slice <span aria-label="joy" class="emoji emoji-1f602" role="img" title="joy">:joy:</span>  <a href="https://github.com/nox/tranche">https://github.com/nox/tranche</a></p>



<a name="260328564"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/186049-t-compiler/wg-polonius/topic/Reintroducing%20loans/near/260328564" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Dylan MacKenzie (ecstatic-morse) <a href="https://zulip-archive.rust-lang.org/stream/186049-t-compiler/wg-polonius/topic/Reintroducing.20loans.html#260328564">(Nov 04 2021 at 20:18)</a>:</h4>
<p><span class="user-mention silent" data-user-id="116113">lqd</span> I think at least part of the CFG splitting was to handle assignments arising from a function return  (which doesn't take effect along the unwind path) I assume "entry" and "exit" could solve this, but I wonder how complex the ordering would get.</p>



<a name="260328611"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/186049-t-compiler/wg-polonius/topic/Reintroducing%20loans/near/260328611" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Dylan MacKenzie (ecstatic-morse) <a href="https://zulip-archive.rust-lang.org/stream/186049-t-compiler/wg-polonius/topic/Reintroducing.20loans.html#260328611">(Nov 04 2021 at 20:19)</a>:</h4>
<p><span class="user-mention silent" data-user-id="118594">Dylan MacKenzie (ecstatic-morse)</span> <a href="#narrow/stream/186049-t-compiler.2Fwg-polonius/topic/Reintroducing.20loans/near/260327790">said</a>:</p>
<blockquote>
<p><span class="user-mention silent" data-user-id="337115">Domenic Quirl</span> <a href="#narrow/stream/186049-t-compiler.2Fwg-polonius/topic/Reintroducing.20loans/near/260327444">said</a>:</p>
<blockquote>
<p><span class="user-mention silent" data-user-id="118594">Dylan MacKenzie (ecstatic-morse)</span> <a href="#narrow/stream/186049-t-compiler.2Fwg-polonius/topic/Reintroducing.20loans/near/260324458">said</a>:</p>
<blockquote>
<p>"tranche"</p>
</blockquote>
<p>based on me not getting this, might not be the best choice for non-native speakers? <span aria-label="sweat smile" class="emoji emoji-1f605" role="img" title="sweat smile">:sweat_smile:</span></p>
</blockquote>
<p>Parlez-vous Francais?</p>
</blockquote>
<p>(I don't by the way)</p>



<a name="260328863"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/186049-t-compiler/wg-polonius/topic/Reintroducing%20loans/near/260328863" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Dylan MacKenzie (ecstatic-morse) <a href="https://zulip-archive.rust-lang.org/stream/186049-t-compiler/wg-polonius/topic/Reintroducing.20loans.html#260328863">(Nov 04 2021 at 20:21)</a>:</h4>
<p>Aber wir können ein bisschen auf Deutsch reden</p>



<a name="260329061"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/186049-t-compiler/wg-polonius/topic/Reintroducing%20loans/near/260329061" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Domenic Quirl <a href="https://zulip-archive.rust-lang.org/stream/186049-t-compiler/wg-polonius/topic/Reintroducing.20loans.html#260329061">(Nov 04 2021 at 20:22)</a>:</h4>
<p><span class="user-mention silent" data-user-id="118594">Dylan MacKenzie (ecstatic-morse)</span> <a href="#narrow/stream/186049-t-compiler.2Fwg-polonius/topic/Reintroducing.20loans/near/260326252">said</a>:</p>
<blockquote>
<p>Finally, in the old formulation, <code>invalidated</code> existed at a single point. Now, we propagate it forward and defer the borrow error until an access actually occurs. I still don't understand why this is necessary now that we have included a notion of liveness: the fact that an origin is live means we know that it will be accessed later.</p>
</blockquote>
<p>I don't think it is. See <a href="#narrow/stream/186049-t-compiler.2Fwg-polonius/topic/Reintroducing.20loans/near/259695735">https://rust-lang.zulipchat.com/#narrow/stream/186049-t-compiler.2Fwg-polonius/topic/Reintroducing.20loans/near/259695735</a> and following</p>



<a name="260329165"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/186049-t-compiler/wg-polonius/topic/Reintroducing%20loans/near/260329165" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Domenic Quirl <a href="https://zulip-archive.rust-lang.org/stream/186049-t-compiler/wg-polonius/topic/Reintroducing.20loans.html#260329165">(Nov 04 2021 at 20:23)</a>:</h4>
<p><span class="user-mention silent" data-user-id="118594">Dylan MacKenzie (ecstatic-morse)</span> <a href="#narrow/stream/186049-t-compiler.2Fwg-polonius/topic/Reintroducing.20loans/near/260328863">said</a>:</p>
<blockquote>
<p>Aber wir können ein bisschen auf Deutsch reden</p>
</blockquote>
<p>Wer würde denn sowas tun? :D</p>



<a name="260329338"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/186049-t-compiler/wg-polonius/topic/Reintroducing%20loans/near/260329338" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Dylan MacKenzie (ecstatic-morse) <a href="https://zulip-archive.rust-lang.org/stream/186049-t-compiler/wg-polonius/topic/Reintroducing.20loans.html#260329338">(Nov 04 2021 at 20:25)</a>:</h4>
<p>Ich nicht.</p>



<a name="260329436"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/186049-t-compiler/wg-polonius/topic/Reintroducing%20loans/near/260329436" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> lqd <a href="https://zulip-archive.rust-lang.org/stream/186049-t-compiler/wg-polonius/topic/Reintroducing.20loans.html#260329436">(Nov 04 2021 at 20:25)</a>:</h4>
<p>noch ich</p>



<a name="260329559"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/186049-t-compiler/wg-polonius/topic/Reintroducing%20loans/near/260329559" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Dylan MacKenzie (ecstatic-morse) <a href="https://zulip-archive.rust-lang.org/stream/186049-t-compiler/wg-polonius/topic/Reintroducing.20loans.html#260329559">(Nov 04 2021 at 20:26)</a>:</h4>
<p><span class="user-mention silent" data-user-id="337115">Domenic Quirl</span> <a href="#narrow/stream/186049-t-compiler.2Fwg-polonius/topic/Reintroducing.20loans/near/260329061">said</a>:</p>
<blockquote>
<p><span class="user-mention silent" data-user-id="118594">Dylan MacKenzie (ecstatic-morse)</span> <a href="#narrow/stream/186049-t-compiler.2Fwg-polonius/topic/Reintroducing.20loans/near/260326252">said</a>:</p>
<blockquote>
<p>Finally, in the old formulation, <code>invalidated</code> existed at a single point. Now, we propagate it forward and defer the borrow error until an access actually occurs. I still don't understand why this is necessary now that we have included a notion of liveness: the fact that an origin is live means we know that it will be accessed later.</p>
</blockquote>
<p>I don't think it is. See <a href="#narrow/stream/186049-t-compiler.2Fwg-polonius/topic/Reintroducing.20loans/near/259695735">https://rust-lang.zulipchat.com/#narrow/stream/186049-t-compiler.2Fwg-polonius/topic/Reintroducing.20loans/near/259695735</a> and following</p>
</blockquote>
<p>Yeah, I'm in full agreement. I've had a horrible run of restating your ideas, btw. Sorry about that.</p>



<a name="260330889"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/186049-t-compiler/wg-polonius/topic/Reintroducing%20loans/near/260330889" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Domenic Quirl <a href="https://zulip-archive.rust-lang.org/stream/186049-t-compiler/wg-polonius/topic/Reintroducing.20loans.html#260330889">(Nov 04 2021 at 20:36)</a>:</h4>
<p>I wouldn't worry too much about that if I were you ^^</p>



<a name="260330920"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/186049-t-compiler/wg-polonius/topic/Reintroducing%20loans/near/260330920" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Domenic Quirl <a href="https://zulip-archive.rust-lang.org/stream/186049-t-compiler/wg-polonius/topic/Reintroducing.20loans.html#260330920">(Nov 04 2021 at 20:37)</a>:</h4>
<p>You're also selling yourself too short here</p>



<a name="260332497"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/186049-t-compiler/wg-polonius/topic/Reintroducing%20loans/near/260332497" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> lqd <a href="https://zulip-archive.rust-lang.org/stream/186049-t-compiler/wg-polonius/topic/Reintroducing.20loans.html#260332497">(Nov 04 2021 at 20:49)</a>:</h4>
<p>and if we removed the invalidation propagation then we'd land even closer to the current formulation</p>



<a name="260671944"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/186049-t-compiler/wg-polonius/topic/Reintroducing%20loans/near/260671944" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/186049-t-compiler/wg-polonius/topic/Reintroducing.20loans.html#260671944">(Nov 08 2021 at 15:27)</a>:</h4>
<p>I see the point that reintroducing liveness made the propagation of invalid less useful</p>



<a name="260671976"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/186049-t-compiler/wg-polonius/topic/Reintroducing%20loans/near/260671976" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/186049-t-compiler/wg-polonius/topic/Reintroducing.20loans.html#260671976">(Nov 08 2021 at 15:27)</a>:</h4>
<p>it also seems strictly less efficient?</p>



<a name="260672057"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/186049-t-compiler/wg-polonius/topic/Reintroducing%20loans/near/260672057" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/186049-t-compiler/wg-polonius/topic/Reintroducing.20loans.html#260672057">(Nov 08 2021 at 15:28)</a>:</h4>
<p>That's very interesting and I have to ponder it :)</p>



<a name="260672117"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/186049-t-compiler/wg-polonius/topic/Reintroducing%20loans/near/260672117" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/186049-t-compiler/wg-polonius/topic/Reintroducing.20loans.html#260672117">(Nov 08 2021 at 15:28)</a>:</h4>
<p>but whilst I ponder, I think removing it would be good =)</p>



<a name="260672173"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/186049-t-compiler/wg-polonius/topic/Reintroducing%20loans/near/260672173" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/186049-t-compiler/wg-polonius/topic/Reintroducing.20loans.html#260672173">(Nov 08 2021 at 15:28)</a>:</h4>
<p>in that case, <a href="http://polonius.next">polonius.next</a> is inching closer indeed. I do think I like this <em>codebase</em> a bit more, in particular i'm excited about the front-end approach, though I've yet to poke on that code at all</p>



<a name="260683863"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/186049-t-compiler/wg-polonius/topic/Reintroducing%20loans/near/260683863" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/186049-t-compiler/wg-polonius/topic/Reintroducing.20loans.html#260683863">(Nov 08 2021 at 16:44)</a>:</h4>
<p>I think I will land the PR, we can explore removing the forward-compatibility</p>



<a name="260719023"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/186049-t-compiler/wg-polonius/topic/Reintroducing%20loans/near/260719023" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> lqd <a href="https://zulip-archive.rust-lang.org/stream/186049-t-compiler/wg-polonius/topic/Reintroducing.20loans.html#260719023">(Nov 08 2021 at 21:06)</a>:</h4>
<p>the current and .next frontends are not that different in spirit :) having some fact gen over a richer syntax (rather than a low level fact based one) is going to be way more useful however, a nicer approach indeed</p>



<a name="260729462"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/186049-t-compiler/wg-polonius/topic/Reintroducing%20loans/near/260729462" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/186049-t-compiler/wg-polonius/topic/Reintroducing.20loans.html#260729462">(Nov 08 2021 at 22:40)</a>:</h4>
<p>yes</p>



<hr><p>Last updated: Apr 12 2022 at 20:01 UTC</p>
</html>