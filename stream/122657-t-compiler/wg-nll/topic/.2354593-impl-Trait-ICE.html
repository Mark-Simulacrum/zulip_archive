<html>
<head><meta charset="utf-8"><title>#54593-impl-Trait-ICE · t-compiler/wg-nll · Zulip Chat Archive</title></head>
<h2>Stream: <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/index.html">t-compiler/wg-nll</a></h2>
<h3>Topic: <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2354593-impl-Trait-ICE.html">#54593-impl-Trait-ICE</a></h3>

<hr>

<base href="https://rust-lang.zulipchat.com">

<head><link href="https://zulip-archive.rust-lang.org/style.css" rel="stylesheet"></head>

<a name="134663678"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2354593-impl-Trait-ICE/near/134663678" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> eddyb <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2354593-impl-Trait-ICE.html#134663678">(Sep 26 2018 at 10:43)</a>:</h4>
<p>what landed in the last nightly? it broke at least one thing <a href="https://travis-ci.com/lykenware/gll/builds/85984866" target="_blank" title="https://travis-ci.com/lykenware/gll/builds/85984866">https://travis-ci.com/lykenware/gll/builds/85984866</a></p>
<p>could it be this? <a href="https://github.com/rust-lang/rust/pull/53438" target="_blank" title="https://github.com/rust-lang/rust/pull/53438">https://github.com/rust-lang/rust/pull/53438</a></p>



<a name="134663931"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2354593-impl-Trait-ICE/near/134663931" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> eddyb <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2354593-impl-Trait-ICE.html#134663931">(Sep 26 2018 at 10:48)</a>:</h4>
<p>cc <span class="user-mention" data-user-id="116009">@nikomatsakis</span>  <span class="user-mention" data-user-id="116118">@Matthew Jasper</span></p>



<a name="134663938"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2354593-impl-Trait-ICE/near/134663938" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> eddyb <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2354593-impl-Trait-ICE.html#134663938">(Sep 26 2018 at 10:48)</a>:</h4>
<p>(I also asked in #compiler on Discord)</p>



<a name="134665441"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2354593-impl-Trait-ICE/near/134665441" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Matthew Jasper <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2354593-impl-Trait-ICE.html#134665441">(Sep 26 2018 at 11:14)</a>:</h4>
<p><a href="https://github.com/rust-lang/rust/pull/53542" target="_blank" title="https://github.com/rust-lang/rust/pull/53542">https://github.com/rust-lang/rust/pull/53542</a> looks more likely, if it's in this nightly. Although I wrote some of the code in that PR, so I guess it's on me either way.</p>



<a name="134666156"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2354593-impl-Trait-ICE/near/134666156" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> eddyb <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2354593-impl-Trait-ICE.html#134666156">(Sep 26 2018 at 11:26)</a>:</h4>
<p>yeah I was came here to paste <a href="https://github.com/rust-lang/rust/pull/53542" target="_blank" title="https://github.com/rust-lang/rust/pull/53542">https://github.com/rust-lang/rust/pull/53542</a> heh</p>



<a name="134686533"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2354593-impl-Trait-ICE/near/134686533" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2354593-impl-Trait-ICE.html#134686533">(Sep 26 2018 at 16:17)</a>:</h4>
<p><span class="user-mention" data-user-id="119009">@eddyb</span> any change you can file an issue (even better if you can reproduce some other way...)</p>



<a name="134686544"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2354593-impl-Trait-ICE/near/134686544" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> eddyb <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2354593-impl-Trait-ICE.html#134686544">(Sep 26 2018 at 16:17)</a>:</h4>
<p>I can uhh try to reduce it?</p>



<a name="134686938"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2354593-impl-Trait-ICE/near/134686938" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2354593-impl-Trait-ICE.html#134686938">(Sep 26 2018 at 16:24)</a>:</h4>
<p>well that always helps but I'd like to have an issue just to help me stay organized</p>



<a name="134686972"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2354593-impl-Trait-ICE/near/134686972" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> eddyb <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2354593-impl-Trait-ICE.html#134686972">(Sep 26 2018 at 16:25)</a>:</h4>
<p>yes, but, all I have to point to is that travis build failure, I wanted something more substantive</p>



<a name="134688320"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2354593-impl-Trait-ICE/near/134688320" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> eddyb <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2354593-impl-Trait-ICE.html#134688320">(Sep 26 2018 at 16:50)</a>:</h4>
<p>reduced to one-liner! <code>#![feature(nll)] fn foo() -&gt; impl FnOnce() { || (|| foo())()() }</code></p>



<a name="134688460"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2354593-impl-Trait-ICE/near/134688460" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> eddyb <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2354593-impl-Trait-ICE.html#134688460">(Sep 26 2018 at 16:52)</a>:</h4>
<p>oh wooow</p>



<a name="134688999"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2354593-impl-Trait-ICE/near/134688999" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> eddyb <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2354593-impl-Trait-ICE.html#134688999">(Sep 26 2018 at 17:01)</a>:</h4>
<p><span class="user-mention" data-user-id="116009">@nikomatsakis</span> <a href="https://github.com/rust-lang/rust/issues/54593" target="_blank" title="https://github.com/rust-lang/rust/issues/54593">https://github.com/rust-lang/rust/issues/54593</a></p>



<a name="134689257"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2354593-impl-Trait-ICE/near/134689257" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Tyler Laing <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2354593-impl-Trait-ICE.html#134689257">(Sep 26 2018 at 17:05)</a>:</h4>
<p>0.0 whyyyyyyyy</p>



<a name="134689391"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2354593-impl-Trait-ICE/near/134689391" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> eddyb <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2354593-impl-Trait-ICE.html#134689391">(Sep 26 2018 at 17:08)</a>:</h4>
<p>I just edited it a bit - you don't need <code>impl FnOnce()</code>, any <code>impl Trait</code> will do</p>



<a name="134689465"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2354593-impl-Trait-ICE/near/134689465" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2354593-impl-Trait-ICE.html#134689465">(Sep 26 2018 at 17:09)</a>:</h4>
<p><span class="user-mention" data-user-id="119009">@eddyb</span> thanks!</p>



<a name="134689467"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2354593-impl-Trait-ICE/near/134689467" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2354593-impl-Trait-ICE.html#134689467">(Sep 26 2018 at 17:09)</a>:</h4>
<p>that's awesome</p>



<a name="134689568"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2354593-impl-Trait-ICE/near/134689568" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> eddyb <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2354593-impl-Trait-ICE.html#134689568">(Sep 26 2018 at 17:11)</a>:</h4>
<p>breaking GLL is <em>not</em> awesome :P</p>



<a name="134689577"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2354593-impl-Trait-ICE/near/134689577" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> eddyb <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2354593-impl-Trait-ICE.html#134689577">(Sep 26 2018 at 17:11)</a>:</h4>
<p>(IMO the PR was a bit rushed)</p>



<a name="134689648"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2354593-impl-Trait-ICE/near/134689648" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> eddyb <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2354593-impl-Trait-ICE.html#134689648">(Sep 26 2018 at 17:12)</a>:</h4>
<p>at least we have older nightlies, but we won't be able to land PRs without messing with <code>.travis.yml</code> ... somehow</p>



<a name="134689661"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2354593-impl-Trait-ICE/near/134689661" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2354593-impl-Trait-ICE.html#134689661">(Sep 26 2018 at 17:12)</a>:</h4>
<p>let me see if I can see what the problem is...</p>



<a name="134689664"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2354593-impl-Trait-ICE/near/134689664" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2354593-impl-Trait-ICE.html#134689664">(Sep 26 2018 at 17:12)</a>:</h4>
<p>having a test case is mucho helpful</p>



<a name="134689670"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2354593-impl-Trait-ICE/near/134689670" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> eddyb <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2354593-impl-Trait-ICE.html#134689670">(Sep 26 2018 at 17:13)</a>:</h4>
<p>yeah I'm surprised it reduced!</p>



<a name="134689680"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2354593-impl-Trait-ICE/near/134689680" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> eddyb <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2354593-impl-Trait-ICE.html#134689680">(Sep 26 2018 at 17:13)</a>:</h4>
<p>this is... right smack in the middle of a system for composing "thunks" acting on continuations</p>



<a name="134689759"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2354593-impl-Trait-ICE/near/134689759" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> eddyb <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2354593-impl-Trait-ICE.html#134689759">(Sep 26 2018 at 17:14)</a>:</h4>
<p>but it's more about closures somehow inheriting some ability regarding <code>-&gt; impl Trait</code> of their parents</p>



<a name="134689777"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2354593-impl-Trait-ICE/near/134689777" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2354593-impl-Trait-ICE.html#134689777">(Sep 26 2018 at 17:15)</a>:</h4>
<p>yes</p>



<a name="134689884"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2354593-impl-Trait-ICE/near/134689884" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2354593-impl-Trait-ICE.html#134689884">(Sep 26 2018 at 17:17)</a>:</h4>
<p>hmm. I just tested your example with my build from <a href="https://github.com/rust-lang/rust/pull/54453" target="_blank" title="https://github.com/rust-lang/rust/pull/54453">https://github.com/rust-lang/rust/pull/54453</a> and it passes.</p>



<a name="134689885"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2354593-impl-Trait-ICE/near/134689885" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2354593-impl-Trait-ICE.html#134689885">(Sep 26 2018 at 17:17)</a>:</h4>
<p>this build is fully rebased...</p>



<a name="134689887"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2354593-impl-Trait-ICE/near/134689887" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2354593-impl-Trait-ICE.html#134689887">(Sep 26 2018 at 17:17)</a>:</h4>
<p>though maybe I need to rebuild since rebasing</p>



<a name="134689898"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2354593-impl-Trait-ICE/near/134689898" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2354593-impl-Trait-ICE.html#134689898">(Sep 26 2018 at 17:17)</a>:</h4>
<p>I think I only ran <code>x.py check</code></p>



<a name="134689900"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2354593-impl-Trait-ICE/near/134689900" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2354593-impl-Trait-ICE.html#134689900">(Sep 26 2018 at 17:17)</a>:</h4>
<p>so maybe the executable itself is from before that PR landed</p>



<a name="134689943"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2354593-impl-Trait-ICE/near/134689943" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2354593-impl-Trait-ICE.html#134689943">(Sep 26 2018 at 17:18)</a>:</h4>
<p>/me rebuilds</p>



<a name="134690502"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2354593-impl-Trait-ICE/near/134690502" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2354593-impl-Trait-ICE.html#134690502">(Sep 26 2018 at 17:29)</a>:</h4>
<p>(yep, I get the ICE now)</p>



<a name="134691583"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2354593-impl-Trait-ICE/near/134691583" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> eddyb <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2354593-impl-Trait-ICE.html#134691583">(Sep 26 2018 at 17:46)</a>:</h4>
<p><span class="user-mention" data-user-id="116009">@nikomatsakis</span> you might be able to just revert the NLL changes in the PR. it would break some tests but I suspect it will fix my testcase</p>



<a name="134691838"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2354593-impl-Trait-ICE/near/134691838" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2354593-impl-Trait-ICE.html#134691838">(Sep 26 2018 at 17:50)</a>:</h4>
<p>well</p>



<a name="134691839"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2354593-impl-Trait-ICE/near/134691839" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2354593-impl-Trait-ICE.html#134691839">(Sep 26 2018 at 17:50)</a>:</h4>
<p>I see why it's failing</p>



<a name="134691841"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2354593-impl-Trait-ICE/near/134691841" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2354593-impl-Trait-ICE.html#134691841">(Sep 26 2018 at 17:50)</a>:</h4>
<p>but I don't quite know how the code went wrong yet</p>



<a name="134691955"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2354593-impl-Trait-ICE/near/134691955" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2354593-impl-Trait-ICE.html#134691955">(Sep 26 2018 at 17:52)</a>:</h4>
<p>woah, I just read this code</p>



<a name="134691963"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2354593-impl-Trait-ICE/near/134691963" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2354593-impl-Trait-ICE.html#134691963">(Sep 26 2018 at 17:53)</a>:</h4>
<div class="codehilite"><pre><span></span><span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="kd">let</span><span class="w"> </span><span class="nb">Err</span><span class="p">(</span><span class="n">terr</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="bp">self</span><span class="p">.</span><span class="n">sub_types</span><span class="p">(</span><span class="n">sub</span><span class="p">,</span><span class="w"> </span><span class="n">sup</span><span class="p">,</span><span class="w"> </span><span class="n">locations</span><span class="p">,</span><span class="w"> </span><span class="n">category</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">            </span><span class="k">if</span><span class="w"> </span><span class="kd">let</span><span class="w"> </span><span class="n">TyKind</span>::<span class="n">Opaque</span><span class="p">(..)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">sup</span><span class="p">.</span><span class="n">sty</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">                </span><span class="k">return</span><span class="w"> </span><span class="bp">self</span><span class="p">.</span><span class="n">eq_opaque_type_and_type</span><span class="p">(</span><span class="n">sub</span><span class="p">,</span><span class="w"> </span><span class="n">sup</span><span class="p">,</span><span class="w"> </span><span class="n">locations</span><span class="p">,</span><span class="w"> </span><span class="n">category</span><span class="p">);</span><span class="w"></span>
<span class="w">            </span><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">                </span><span class="k">return</span><span class="w"> </span><span class="nb">Err</span><span class="p">(</span><span class="n">terr</span><span class="p">);</span><span class="w"></span>
<span class="w">            </span><span class="p">}</span><span class="w"></span>
<span class="w">        </span><span class="p">}</span><span class="w"></span>
<span class="w">        </span><span class="nb">Ok</span><span class="p">(())</span><span class="w"></span>
</pre></div>



<a name="134691971"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2354593-impl-Trait-ICE/near/134691971" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2354593-impl-Trait-ICE.html#134691971">(Sep 26 2018 at 17:53)</a>:</h4>
<p>that doesn't seem quite right</p>



<a name="134691981"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2354593-impl-Trait-ICE/near/134691981" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2354593-impl-Trait-ICE.html#134691981">(Sep 26 2018 at 17:53)</a>:</h4>
<p>(as in, I don't like the idea of "try to do subtyping and if it fails do something else")</p>



<a name="134691988"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2354593-impl-Trait-ICE/near/134691988" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2354593-impl-Trait-ICE.html#134691988">(Sep 26 2018 at 17:53)</a>:</h4>
<p>hmm</p>



<a name="134692040"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2354593-impl-Trait-ICE/near/134692040" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2354593-impl-Trait-ICE.html#134692040">(Sep 26 2018 at 17:54)</a>:</h4>
<p>it probably also doesn't make sense to do type equality in the fallback case</p>



<a name="134692057"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2354593-impl-Trait-ICE/near/134692057" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2354593-impl-Trait-ICE.html#134692057">(Sep 26 2018 at 17:54)</a>:</h4>
<p>well, let me see if I can figure out the problem at hand, then we can revisit these points...</p>



<a name="134693358"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2354593-impl-Trait-ICE/near/134693358" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2354593-impl-Trait-ICE.html#134693358">(Sep 26 2018 at 18:18)</a>:</h4>
<p>ok, I see the bug I think. We are instantiating the opaque types defined on the "parent def-id" (so, the enclosing function). We used to instantiate the opaque types defined on the closure itself (none)</p>



<a name="134693364"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2354593-impl-Trait-ICE/near/134693364" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2354593-impl-Trait-ICE.html#134693364">(Sep 26 2018 at 18:19)</a>:</h4>
<p>I'm not really clear on why we are doing <em>that</em> though</p>



<a name="134693478"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2354593-impl-Trait-ICE/near/134693478" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2354593-impl-Trait-ICE.html#134693478">(Sep 26 2018 at 18:21)</a>:</h4>
<p><span class="user-mention" data-user-id="123893">@alercah</span> you around? I'm trying to fix the problem that <span class="user-mention" data-user-id="119009">@eddyb</span> hit in <a href="https://github.com/rust-lang/rust/pull/53542/" target="_blank" title="https://github.com/rust-lang/rust/pull/53542/">https://github.com/rust-lang/rust/pull/53542/</a> ... I am wondering why in <code>eq_opaque_type_and_type</code> you are using the <code>parent_def_id</code> when invoking <code>instantiate_opaque_types</code> (instead of <code>self.mir_def_id</code>)...</p>



<a name="134693482"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2354593-impl-Trait-ICE/near/134693482" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2354593-impl-Trait-ICE.html#134693482">(Sep 26 2018 at 18:21)</a>:</h4>
<p>well, I guess i'll try changing it and see what happens :)</p>



<a name="134693541"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2354593-impl-Trait-ICE/near/134693541" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> eddyb <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2354593-impl-Trait-ICE.html#134693541">(Sep 26 2018 at 18:22)</a>:</h4>
<p><span class="user-mention" data-user-id="116009">@nikomatsakis</span> did you meant to ping <span class="user-mention" data-user-id="124069">@Alexander Regueiro</span> ?</p>



<a name="134693548"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2354593-impl-Trait-ICE/near/134693548" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2354593-impl-Trait-ICE.html#134693548">(Sep 26 2018 at 18:22)</a>:</h4>
<p>maybe?</p>



<a name="134693550"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2354593-impl-Trait-ICE/near/134693550" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2354593-impl-Trait-ICE.html#134693550">(Sep 26 2018 at 18:22)</a>:</h4>
<p>did I misread the author of the PR? :)</p>



<a name="134693558"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2354593-impl-Trait-ICE/near/134693558" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> eddyb <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2354593-impl-Trait-ICE.html#134693558">(Sep 26 2018 at 18:22)</a>:</h4>
<p>(who is easier to find on Discord)</p>



<a name="134693562"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2354593-impl-Trait-ICE/near/134693562" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2354593-impl-Trait-ICE.html#134693562">(Sep 26 2018 at 18:22)</a>:</h4>
<p>it appears I did</p>



<a name="134693568"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2354593-impl-Trait-ICE/near/134693568" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2354593-impl-Trait-ICE.html#134693568">(Sep 26 2018 at 18:22)</a>:</h4>
<p>sorry <span class="user-mention" data-user-id="123893">@alercah</span></p>



<a name="134693583"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2354593-impl-Trait-ICE/near/134693583" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2354593-impl-Trait-ICE.html#134693583">(Sep 26 2018 at 18:23)</a>:</h4>
<p>ok well I can confirm it fixes this example</p>



<a name="134693586"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2354593-impl-Trait-ICE/near/134693586" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2354593-impl-Trait-ICE.html#134693586">(Sep 26 2018 at 18:23)</a>:</h4>
<p>let me see if anything..else breaks...</p>



<a name="134694388"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2354593-impl-Trait-ICE/near/134694388" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2354593-impl-Trait-ICE.html#134694388">(Sep 26 2018 at 18:37)</a>:</h4>
<p>hmm, still seems to pass all tests...</p>



<a name="134694541"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2354593-impl-Trait-ICE/near/134694541" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Tyler Laing <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2354593-impl-Trait-ICE.html#134694541">(Sep 26 2018 at 18:39)</a>:</h4>
<p>Add a new test(s)?</p>



<a name="134694613"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2354593-impl-Trait-ICE/near/134694613" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2354593-impl-Trait-ICE.html#134694613">(Sep 26 2018 at 18:40)</a>:</h4>
<p>no, ok, I found some tests that break, which is good (tests added by the PR in question)</p>



<a name="134694615"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2354593-impl-Trait-ICE/near/134694615" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2354593-impl-Trait-ICE.html#134694615">(Sep 26 2018 at 18:40)</a>:</h4>
<p>they were just under run-pass</p>



<a name="134694623"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2354593-impl-Trait-ICE/near/134694623" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2354593-impl-Trait-ICE.html#134694623">(Sep 26 2018 at 18:40)</a>:</h4>
<p>can't wait to get rid of those directories</p>



<a name="134694650"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2354593-impl-Trait-ICE/near/134694650" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2354593-impl-Trait-ICE.html#134694650">(Sep 26 2018 at 18:41)</a>:</h4>
<p>I wonder how this is being desugared</p>



<a name="134694652"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2354593-impl-Trait-ICE/near/134694652" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2354593-impl-Trait-ICE.html#134694652">(Sep 26 2018 at 18:41)</a>:</h4>
<p>I guess I have to read a bit more closely</p>



<hr><p>Last updated: Apr 12 2022 at 20:01 UTC</p>
</html>