<html>
<head><meta charset="utf-8"><title>#53178 optimize SCC computation · t-compiler/wg-nll · Zulip Chat Archive</title></head>
<h2>Stream: <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/index.html">t-compiler/wg-nll</a></h2>
<h3>Topic: <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353178.20optimize.20SCC.20computation.html">#53178 optimize SCC computation</a></h3>

<hr>

<base href="https://rust-lang.zulipchat.com">

<head><link href="https://zulip-archive.rust-lang.org/style.css" rel="stylesheet"></head>

<a name="131120006"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353178%20optimize%20SCC%20computation/near/131120006" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353178.20optimize.20SCC.20computation.html#131120006">(Aug 08 2018 at 16:58)</a>:</h4>
<p><span class="user-mention" data-user-id="125250">@Wesley Wiser</span> is going to check this out</p>



<a name="131187086"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353178%20optimize%20SCC%20computation/near/131187086" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wesley Wiser <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353178.20optimize.20SCC.20computation.html#131187086">(Aug 09 2018 at 17:44)</a>:</h4>
<p><span class="user-mention" data-user-id="116009">@nikomatsakis</span> I think I understand the task now. So <code>outgoing_edges()</code> takes a region and returns an iterator over all of the regions it outlives. If the region is <code>'static</code> then of course it must outlive all regions by definition. So in this case, the iterator should loop over every region and return all of them. (Of course this only applies when <code>D=Normal</code>, <code>D=Reverse</code> is different.) I <em>think</em> the way to do this is something like (pseudocode)</p>
<div class="codehilite"><pre><span></span>for region in self.first_constraints {
  let mut next = self.next_constraints[region];
  while let Some(outlived) = next {
    next = self.next_constraints(outlived);
    yield outlived;
  }
}
</pre></div>


<p>Does that seem right?</p>



<a name="131187108"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353178%20optimize%20SCC%20computation/near/131187108" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wesley Wiser <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353178.20optimize.20SCC.20computation.html#131187108">(Aug 09 2018 at 17:44)</a>:</h4>
<p><a href="https://github.com/rust-lang/rust/blob/31fe3df6543566f5671da4d78b381b9d59f2d096/src/librustc_mir/borrow_check/nll/constraints/graph.rs" target="_blank" title="https://github.com/rust-lang/rust/blob/31fe3df6543566f5671da4d78b381b9d59f2d096/src/librustc_mir/borrow_check/nll/constraints/graph.rs">Easy link to <code>graph.rs</code> as of your PR</a></p>



<a name="131187173"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353178%20optimize%20SCC%20computation/near/131187173" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353178.20optimize.20SCC.20computation.html#131187173">(Aug 09 2018 at 17:45)</a>:</h4>
<p>the first part is right, but I don't understand the code example</p>



<a name="131187182"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353178%20optimize%20SCC%20computation/near/131187182" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353178.20optimize.20SCC.20computation.html#131187182">(Aug 09 2018 at 17:46)</a>:</h4>
<p>it seems to be iterating over the constraint linked list?</p>



<a name="131187197"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353178%20optimize%20SCC%20computation/near/131187197" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353178.20optimize.20SCC.20computation.html#131187197">(Aug 09 2018 at 17:46)</a>:</h4>
<p>there are various ways you could do this of course</p>



<a name="131187210"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353178%20optimize%20SCC%20computation/near/131187210" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353178.20optimize.20SCC.20computation.html#131187210">(Aug 09 2018 at 17:47)</a>:</h4>
<p>but I suppose </p>
<div class="codehilite"><pre><span></span>for region in self.first_constraints.indices() {
  yield region;
}
</pre></div>



<a name="131187212"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353178%20optimize%20SCC%20computation/near/131187212" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353178.20optimize.20SCC.20computation.html#131187212">(Aug 09 2018 at 17:47)</a>:</h4>
<p>might do it</p>



<a name="131187278"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353178%20optimize%20SCC%20computation/near/131187278" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wesley Wiser <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353178.20optimize.20SCC.20computation.html#131187278">(Aug 09 2018 at 17:48)</a>:</h4>
<p>Hmm. Perhaps I've misunderstood the <code>Edges</code> iterator</p>



<a name="131187339"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353178%20optimize%20SCC%20computation/near/131187339" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wesley Wiser <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353178.20optimize.20SCC.20computation.html#131187339">(Aug 09 2018 at 17:49)</a>:</h4>
<p>I thought it was necessary to iterator over the the <code>next_constraints</code> because for a constraint like <code>R1: R2 + R3</code>, that's where the <code>R2</code> and <code>R3</code> regions will come from</p>



<a name="131187341"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353178%20optimize%20SCC%20computation/near/131187341" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353178.20optimize.20SCC.20computation.html#131187341">(Aug 09 2018 at 17:49)</a>:</h4>
<p>no I mean</p>



<a name="131187348"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353178%20optimize%20SCC%20computation/near/131187348" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353178.20optimize.20SCC.20computation.html#131187348">(Aug 09 2018 at 17:49)</a>:</h4>
<p>that is how the edges iterator works</p>



<a name="131187399"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353178%20optimize%20SCC%20computation/near/131187399" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353178.20optimize.20SCC.20computation.html#131187399">(Aug 09 2018 at 17:50)</a>:</h4>
<p>I'm not really sure what pseudocode you are showing me :)</p>



<a name="131187404"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353178%20optimize%20SCC%20computation/near/131187404" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353178.20optimize.20SCC.20computation.html#131187404">(Aug 09 2018 at 17:50)</a>:</h4>
<p>I thought you were talking about the additional iteration that would be needed</p>



<a name="131187443"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353178%20optimize%20SCC%20computation/near/131187443" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wesley Wiser <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353178.20optimize.20SCC.20computation.html#131187443">(Aug 09 2018 at 17:51)</a>:</h4>
<p>Oh sorry</p>
<p>I mean that the complete output of the iterator when given a <code>'static</code> region should be <code>next_constraints</code> + <code>first_constraints</code>.</p>



<a name="131187454"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353178%20optimize%20SCC%20computation/near/131187454" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wesley Wiser <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353178.20optimize.20SCC.20computation.html#131187454">(Aug 09 2018 at 17:51)</a>:</h4>
<p>It basically needs to return all of the constraints right?</p>



<a name="131187458"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353178%20optimize%20SCC%20computation/near/131187458" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353178.20optimize.20SCC.20computation.html#131187458">(Aug 09 2018 at 17:51)</a>:</h4>
<p>well</p>



<a name="131187470"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353178%20optimize%20SCC%20computation/near/131187470" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353178.20optimize.20SCC.20computation.html#131187470">(Aug 09 2018 at 17:51)</a>:</h4>
<p>we are talking about augmenting the thing that iterates over regions, right?</p>



<a name="131187514"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353178%20optimize%20SCC%20computation/near/131187514" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wesley Wiser <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353178.20optimize.20SCC.20computation.html#131187514">(Aug 09 2018 at 17:52)</a>:</h4>
<p><code>Edges</code> yes</p>



<a name="131187515"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353178%20optimize%20SCC%20computation/near/131187515" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353178.20optimize.20SCC.20computation.html#131187515">(Aug 09 2018 at 17:52)</a>:</h4>
<p>in that case, it's enough for <code>'static</code> to yield all the regions just once</p>



<a name="131187532"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353178%20optimize%20SCC%20computation/near/131187532" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353178.20optimize.20SCC.20computation.html#131187532">(Aug 09 2018 at 17:52)</a>:</h4>
<p>but for every <em>other</em> region, it would want to walk over the constraints and map to the <code>sub</code> endpoint</p>



<a name="131187533"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353178%20optimize%20SCC%20computation/near/131187533" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353178.20optimize.20SCC.20computation.html#131187533">(Aug 09 2018 at 17:52)</a>:</h4>
<p>otherwise, you'll just wind up with duplicate edges I guess</p>



<a name="131187535"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353178%20optimize%20SCC%20computation/near/131187535" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353178.20optimize.20SCC.20computation.html#131187535">(Aug 09 2018 at 17:52)</a>:</h4>
<p>doesn't hurt</p>



<a name="131187540"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353178%20optimize%20SCC%20computation/near/131187540" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353178.20optimize.20SCC.20computation.html#131187540">(Aug 09 2018 at 17:52)</a>:</h4>
<p>also not needed</p>



<a name="131187545"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353178%20optimize%20SCC%20computation/near/131187545" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353178.20optimize.20SCC.20computation.html#131187545">(Aug 09 2018 at 17:53)</a>:</h4>
<p>so I guess I would say</p>



<a name="131187561"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353178%20optimize%20SCC%20computation/near/131187561" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353178.20optimize.20SCC.20computation.html#131187561">(Aug 09 2018 at 17:53)</a>:</h4>
<p>er, sorry</p>



<a name="131187563"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353178%20optimize%20SCC%20computation/near/131187563" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353178.20optimize.20SCC.20computation.html#131187563">(Aug 09 2018 at 17:53)</a>:</h4>
<p>not <code>Edges</code></p>



<a name="131187569"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353178%20optimize%20SCC%20computation/near/131187569" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353178.20optimize.20SCC.20computation.html#131187569">(Aug 09 2018 at 17:53)</a>:</h4>
<p>note that the SCC is not built from <code>Edges</code>, that's just a building block</p>



<a name="131187580"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353178%20optimize%20SCC%20computation/near/131187580" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353178.20optimize.20SCC.20computation.html#131187580">(Aug 09 2018 at 17:54)</a>:</h4>
<p><a href="https://github.com/rust-lang/rust/blob/31fe3df6543566f5671da4d78b381b9d59f2d096/src/librustc_mir/borrow_check/nll/constraints/graph.rs#L163-L166" target="_blank" title="https://github.com/rust-lang/rust/blob/31fe3df6543566f5671da4d78b381b9d59f2d096/src/librustc_mir/borrow_check/nll/constraints/graph.rs#L163-L166"><code>Successors</code></a> is the one we use for the SCC</p>



<a name="131187621"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353178%20optimize%20SCC%20computation/near/131187621" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353178.20optimize.20SCC.20computation.html#131187621">(Aug 09 2018 at 17:54)</a>:</h4>
<p>and it yields up not <em>constraints</em> but <em>regions</em></p>



<a name="131187641"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353178%20optimize%20SCC%20computation/near/131187641" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353178.20optimize.20SCC.20computation.html#131187641">(Aug 09 2018 at 17:54)</a>:</h4>
<p>well really the point is <code>RegionGraph</code></p>



<a name="131187681"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353178%20optimize%20SCC%20computation/near/131187681" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wesley Wiser <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353178.20optimize.20SCC.20computation.html#131187681">(Aug 09 2018 at 17:55)</a>:</h4>
<p>Ok got it.</p>
<p>My brain skipped right past <code>Successors</code> and I was just looking at <code>Edges</code></p>



<a name="131187705"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353178%20optimize%20SCC%20computation/near/131187705" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wesley Wiser <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353178.20optimize.20SCC.20computation.html#131187705">(Aug 09 2018 at 17:56)</a>:</h4>
<p><span class="emoji emoji-1f926" title="face palm">:face_palm:</span></p>



<a name="131187723"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353178%20optimize%20SCC%20computation/near/131187723" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353178.20optimize.20SCC.20computation.html#131187723">(Aug 09 2018 at 17:56)</a>:</h4>
<p>honestly I think the <em>easiest</em> thing to do might be to make Yet Another Layer :P</p>



<a name="131187725"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353178%20optimize%20SCC%20computation/near/131187725" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353178.20optimize.20SCC.20computation.html#131187725">(Aug 09 2018 at 17:56)</a>:</h4>
<p>in particular, there are these "wrapper traits" here:</p>



<a name="131187726"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353178%20optimize%20SCC%20computation/near/131187726" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353178.20optimize.20SCC.20computation.html#131187726">(Aug 09 2018 at 17:56)</a>:</h4>
<p><a href="https://github.com/rust-lang/rust/blob/31fe3df6543566f5671da4d78b381b9d59f2d096/src/librustc_mir/borrow_check/nll/constraints/graph.rs#L176-L198" target="_blank" title="https://github.com/rust-lang/rust/blob/31fe3df6543566f5671da4d78b381b9d59f2d096/src/librustc_mir/borrow_check/nll/constraints/graph.rs#L176-L198">https://github.com/rust-lang/rust/blob/31fe3df6543566f5671da4d78b381b9d59f2d096/src/librustc_mir/borrow_check/nll/constraints/graph.rs#L176-L198</a></p>



<a name="131187731"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353178%20optimize%20SCC%20computation/near/131187731" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353178.20optimize.20SCC.20computation.html#131187731">(Aug 09 2018 at 17:56)</a>:</h4>
<p>those are the things that define the graph the SCC computation is based on</p>



<a name="131187750"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353178%20optimize%20SCC%20computation/near/131187750" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353178.20optimize.20SCC.20computation.html#131187750">(Aug 09 2018 at 17:57)</a>:</h4>
<p>I wonder if we want another struct, let's call it <code>AugmentedRegionGraph</code>, sort of like</p>
<div class="codehilite"><pre><span></span><span class="k">struct</span> <span class="nc">AugmentedRegionGraph</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="n">graph</span>: <span class="nc">NormalRegionGraph</span><span class="p">,</span><span class="w"> </span><span class="c1">// no need to support other directions</span>
<span class="p">}</span><span class="w"></span>
</pre></div>



<a name="131187751"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353178%20optimize%20SCC%20computation/near/131187751" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353178.20optimize.20SCC.20computation.html#131187751">(Aug 09 2018 at 17:57)</a>:</h4>
<p>and then implement the graph traits for <em>that</em></p>



<a name="131187758"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353178%20optimize%20SCC%20computation/near/131187758" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353178.20optimize.20SCC.20computation.html#131187758">(Aug 09 2018 at 17:57)</a>:</h4>
<p>the <a href="https://github.com/rust-lang/rust/blob/31fe3df6543566f5671da4d78b381b9d59f2d096/src/librustc_mir/borrow_check/nll/constraints/graph.rs#L186" target="_blank" title="https://github.com/rust-lang/rust/blob/31fe3df6543566f5671da4d78b381b9d59f2d096/src/librustc_mir/borrow_check/nll/constraints/graph.rs#L186">"successors" relation</a> would then return something like</p>



<a name="131187827"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353178%20optimize%20SCC%20computation/near/131187827" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353178.20optimize.20SCC.20computation.html#131187827">(Aug 09 2018 at 17:58)</a>:</h4>
<div class="codehilite"><pre><span></span><span class="kd">let</span><span class="w"> </span><span class="n">static_successors</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="n">node</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">STATIC</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="nb">Some</span><span class="p">(</span><span class="n">STATIC</span><span class="w"> </span><span class="p">..</span><span class="w"> </span><span class="n">NUM_REGIONS</span><span class="p">)</span><span class="w"></span>
<span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="nb">None</span><span class="w"></span>
<span class="p">};</span><span class="w"></span>

<span class="kd">let</span><span class="w"> </span><span class="n">normal_successors</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="bp">self</span><span class="p">.</span><span class="n">graph</span><span class="p">.</span><span class="n">outgoing_regions</span><span class="p">(</span><span class="n">node</span><span class="p">);</span><span class="w"></span>

<span class="n">static_successors</span><span class="w"></span>
<span class="w">  </span><span class="p">.</span><span class="n">into_iter</span><span class="p">()</span><span class="w"></span>
<span class="w">  </span><span class="p">.</span><span class="n">flat_map</span><span class="p">(</span><span class="o">|</span><span class="n">range</span><span class="o">|</span><span class="w"> </span><span class="n">range</span><span class="p">)</span><span class="w"></span>
<span class="w">  </span><span class="p">.</span><span class="n">chain</span><span class="p">(</span><span class="n">normal_successors</span><span class="p">)</span><span class="w"></span>
</pre></div>



<a name="131187843"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353178%20optimize%20SCC%20computation/near/131187843" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353178.20optimize.20SCC.20computation.html#131187843">(Aug 09 2018 at 17:59)</a>:</h4>
<blockquote>
<p>Ok got it.</p>
<p>My brain skipped right past <code>Successors</code> and I was just looking at <code>Edges</code></p>
</blockquote>
<p>Successors is really just a "mapped" version of <code>Edges</code> anyhow</p>



<a name="131187847"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353178%20optimize%20SCC%20computation/near/131187847" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wesley Wiser <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353178.20optimize.20SCC.20computation.html#131187847">(Aug 09 2018 at 17:59)</a>:</h4>
<p>And <code>NormalRegionGraph</code> is just a <code>RegionGraph&lt;'s, Normal&gt;</code>?</p>



<a name="131187849"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353178%20optimize%20SCC%20computation/near/131187849" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353178.20optimize.20SCC.20computation.html#131187849">(Aug 09 2018 at 17:59)</a>:</h4>
<p>yeah</p>



<a name="131187850"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353178%20optimize%20SCC%20computation/near/131187850" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353178.20optimize.20SCC.20computation.html#131187850">(Aug 09 2018 at 17:59)</a>:</h4>
<p>that's an existing alias I think</p>



<a name="131187852"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353178%20optimize%20SCC%20computation/near/131187852" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353178.20optimize.20SCC.20computation.html#131187852">(Aug 09 2018 at 17:59)</a>:</h4>
<p>er, I guess it's not</p>



<a name="131187854"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353178%20optimize%20SCC%20computation/near/131187854" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353178.20optimize.20SCC.20computation.html#131187854">(Aug 09 2018 at 17:59)</a>:</h4>
<p>well I meant that :)</p>



<a name="131187898"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353178%20optimize%20SCC%20computation/near/131187898" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wesley Wiser <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353178.20optimize.20SCC.20computation.html#131187898">(Aug 09 2018 at 18:00)</a>:</h4>
<p>I think there's just <code>{Normal|Reverse}ConstraintGraph</code></p>



<a name="131187909"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353178%20optimize%20SCC%20computation/near/131187909" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353178.20optimize.20SCC.20computation.html#131187909">(Aug 09 2018 at 18:00)</a>:</h4>
<p>yes, you are correct</p>



<a name="131187912"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353178%20optimize%20SCC%20computation/near/131187912" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wesley Wiser <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353178.20optimize.20SCC.20computation.html#131187912">(Aug 09 2018 at 18:00)</a>:</h4>
<p>Gotcha</p>



<a name="131187967"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353178%20optimize%20SCC%20computation/near/131187967" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wesley Wiser <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353178.20optimize.20SCC.20computation.html#131187967">(Aug 09 2018 at 18:01)</a>:</h4>
<p>Is <code>STATIC</code> defined somewhere? <code>RegionVid</code> doesn't seem to define it <a href="https://doc.rust-lang.org/nightly/nightly-rustc/rustc/ty/struct.RegionVid.html" target="_blank" title="https://doc.rust-lang.org/nightly/nightly-rustc/rustc/ty/struct.RegionVid.html">https://doc.rust-lang.org/nightly/nightly-rustc/rustc/ty/struct.RegionVid.html</a></p>



<a name="131188016"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353178%20optimize%20SCC%20computation/near/131188016" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353178.20optimize.20SCC.20computation.html#131188016">(Aug 09 2018 at 18:02)</a>:</h4>
<p>no, it's <code>universal_regions.fr_static</code> I think</p>



<a name="131188020"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353178%20optimize%20SCC%20computation/near/131188020" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353178.20optimize.20SCC.20computation.html#131188020">(Aug 09 2018 at 18:02)</a>:</h4>
<p>it is -- in practice -- always zero</p>



<a name="131188030"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353178%20optimize%20SCC%20computation/near/131188030" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353178.20optimize.20SCC.20computation.html#131188030">(Aug 09 2018 at 18:02)</a>:</h4>
<p>really the range I defined is actually <code>self.first_contraints.indices()</code> or whatever</p>



<a name="131188034"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353178%20optimize%20SCC%20computation/near/131188034" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wesley Wiser <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353178.20optimize.20SCC.20computation.html#131188034">(Aug 09 2018 at 18:02)</a>:</h4>
<p>That looks correct</p>



<a name="131188046"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353178%20optimize%20SCC%20computation/near/131188046" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353178.20optimize.20SCC.20computation.html#131188046">(Aug 09 2018 at 18:02)</a>:</h4>
<p>we have a <code>universal_regions</code> in this code? I forget</p>



<a name="131188049"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353178%20optimize%20SCC%20computation/near/131188049" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353178.20optimize.20SCC.20computation.html#131188049">(Aug 09 2018 at 18:02)</a>:</h4>
<p>we could make it a true constant</p>



<a name="131188069"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353178%20optimize%20SCC%20computation/near/131188069" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353178.20optimize.20SCC.20computation.html#131188069">(Aug 09 2018 at 18:03)</a>:</h4>
<p>seems like we don't have it <em>here</em></p>



<a name="131188071"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353178%20optimize%20SCC%20computation/near/131188071" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353178.20optimize.20SCC.20computation.html#131188071">(Aug 09 2018 at 18:03)</a>:</h4>
<p>we could pass it down though when constructing the graph</p>



<a name="131188089"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353178%20optimize%20SCC%20computation/near/131188089" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353178.20optimize.20SCC.20computation.html#131188089">(Aug 09 2018 at 18:03)</a>:</h4>
<p>i.e., we could add an argument to <a href="https://github.com/rust-lang/rust/blob/31fe3df6543566f5671da4d78b381b9d59f2d096/src/librustc_mir/borrow_check/nll/constraints/mod.rs#L58-L61" target="_blank" title="https://github.com/rust-lang/rust/blob/31fe3df6543566f5671da4d78b381b9d59f2d096/src/librustc_mir/borrow_check/nll/constraints/mod.rs#L58-L61"><code>compute_sccs</code></a></p>



<a name="131188090"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353178%20optimize%20SCC%20computation/near/131188090" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wesley Wiser <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353178.20optimize.20SCC.20computation.html#131188090">(Aug 09 2018 at 18:03)</a>:</h4>
<p>Ok. That should be easy enough</p>



<a name="131188129"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353178%20optimize%20SCC%20computation/near/131188129" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353178.20optimize.20SCC.20computation.html#131188129">(Aug 09 2018 at 18:04)</a>:</h4>
<p>I'd probably just pass down <code>static_vid: RegionVid</code></p>



<a name="131188137"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353178%20optimize%20SCC%20computation/near/131188137" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353178.20optimize.20SCC.20computation.html#131188137">(Aug 09 2018 at 18:04)</a>:</h4>
<p>and not the whole struct thing</p>



<a name="131188138"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353178%20optimize%20SCC%20computation/near/131188138" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wesley Wiser <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353178.20optimize.20SCC.20computation.html#131188138">(Aug 09 2018 at 18:04)</a>:</h4>
<p>right</p>



<a name="131188175"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353178%20optimize%20SCC%20computation/near/131188175" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wesley Wiser <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353178.20optimize.20SCC.20computation.html#131188175">(Aug 09 2018 at 18:05)</a>:</h4>
<p>Ok. Thanks for your time!! I'm going to work on this tonight and see how far I get.</p>



<a name="131188192"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353178%20optimize%20SCC%20computation/near/131188192" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353178.20optimize.20SCC.20computation.html#131188192">(Aug 09 2018 at 18:05)</a>:</h4>
<p><span class="emoji emoji-1f3b8" title="guitar">:guitar:</span></p>



<a name="131188199"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353178%20optimize%20SCC%20computation/near/131188199" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353178.20optimize.20SCC.20computation.html#131188199">(Aug 09 2018 at 18:05)</a>:</h4>
<p>let me know if you hit any roadblocks :)</p>



<a name="131188207"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353178%20optimize%20SCC%20computation/near/131188207" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wesley Wiser <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353178.20optimize.20SCC.20computation.html#131188207">(Aug 09 2018 at 18:06)</a>:</h4>
<p>Will do! :)</p>



<a name="131190927"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353178%20optimize%20SCC%20computation/near/131190927" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jake Goulding <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353178.20optimize.20SCC.20computation.html#131190927">(Aug 09 2018 at 18:54)</a>:</h4>
<blockquote>
<div class="codehilite"><pre><span></span><span class="k">for</span><span class="w"> </span><span class="n">region</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="bp">self</span><span class="p">.</span><span class="n">first_constraints</span><span class="p">.</span><span class="n">indices</span><span class="p">()</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">  </span><span class="kr">yield</span><span class="w"> </span><span class="n">region</span><span class="p">;</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>
</pre></div>


</blockquote>
<p><span class="user-mention" data-user-id="116009">@nikomatsakis</span> I assume you were using pseudocode, but does the compiler yet use generators for things?</p>



<a name="131190933"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353178%20optimize%20SCC%20computation/near/131190933" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353178.20optimize.20SCC.20computation.html#131190933">(Aug 09 2018 at 18:54)</a>:</h4>
<p>we do not</p>



<a name="131190948"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353178%20optimize%20SCC%20computation/near/131190948" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353178.20optimize.20SCC.20computation.html#131190948">(Aug 09 2018 at 18:55)</a>:</h4>
<p>I've thought about it...</p>



<a name="131191022"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353178%20optimize%20SCC%20computation/near/131191022" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jake Goulding <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353178.20optimize.20SCC.20computation.html#131191022">(Aug 09 2018 at 18:56)</a>:</h4>
<p>Any particular reason to avoid it? Since async/await uses it so much, seems like getting more usages would be a good thing.</p>



<a name="131191027"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353178%20optimize%20SCC%20computation/near/131191027" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353178.20optimize.20SCC.20computation.html#131191027">(Aug 09 2018 at 18:56)</a>:</h4>
<p>not really</p>



<a name="131191038"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353178%20optimize%20SCC%20computation/near/131191038" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353178.20optimize.20SCC.20computation.html#131191038">(Aug 09 2018 at 18:57)</a>:</h4>
<p>I don't think there is a convenient way to make an iterator yet</p>



<a name="131191041"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353178%20optimize%20SCC%20computation/near/131191041" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353178.20optimize.20SCC.20computation.html#131191041">(Aug 09 2018 at 18:57)</a>:</h4>
<p>but we could add one</p>



<a name="131191054"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353178%20optimize%20SCC%20computation/near/131191054" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353178.20optimize.20SCC.20computation.html#131191054">(Aug 09 2018 at 18:57)</a>:</h4>
<p>I think when I was last going to try it, though, the "borrowck-enabled" variant didn't yet exist</p>



<a name="131191056"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353178%20optimize%20SCC%20computation/near/131191056" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353178.20optimize.20SCC.20computation.html#131191056">(Aug 09 2018 at 18:57)</a>:</h4>
<p>now it would be more ergonomic</p>



<a name="131191129"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353178%20optimize%20SCC%20computation/near/131191129" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jake Goulding <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353178.20optimize.20SCC.20computation.html#131191129">(Aug 09 2018 at 18:58)</a>:</h4>
<p>Heh, I wrote the generator-&gt;iterator adapter months (years?) ago for a SO question, I've always been surprised that wasn't in the stdlib</p>



<a name="131228681"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353178%20optimize%20SCC%20computation/near/131228681" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353178.20optimize.20SCC.20computation.html#131228681">(Aug 10 2018 at 10:10)</a>:</h4>
<p><span class="user-mention" data-user-id="125250">@Wesley Wiser</span> how'd it go?</p>



<a name="131237376"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353178%20optimize%20SCC%20computation/near/131237376" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wesley Wiser <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353178.20optimize.20SCC.20computation.html#131237376">(Aug 10 2018 at 13:33)</a>:</h4>
<p><span class="user-mention" data-user-id="116009">@nikomatsakis</span> Ok, I guess. I've added the code we talked about yesterday and wired it up to <code>compute_sccs()</code>. The code builds and the compiler bootstraps but there's some NLL ui-tests that are failing. I didn't have time to investigate them very much.</p>



<a name="131237469"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353178%20optimize%20SCC%20computation/near/131237469" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353178.20optimize.20SCC.20computation.html#131237469">(Aug 10 2018 at 13:35)</a>:</h4>
<p>ok</p>



<a name="131237472"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353178%20optimize%20SCC%20computation/near/131237472" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353178.20optimize.20SCC.20computation.html#131237472">(Aug 10 2018 at 13:35)</a>:</h4>
<p>feel free to open a WIP PR</p>



<a name="131237556"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353178%20optimize%20SCC%20computation/near/131237556" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wesley Wiser <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353178.20optimize.20SCC.20computation.html#131237556">(Aug 10 2018 at 13:37)</a>:</h4>
<p>I'll probably do that this evening. The tests finished running right as I was about to go to bed so I didn't have time to investigate further.</p>



<a name="131237636"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353178%20optimize%20SCC%20computation/near/131237636" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wesley Wiser <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353178.20optimize.20SCC.20computation.html#131237636">(Aug 10 2018 at 13:38)</a>:</h4>
<p>A quick glance at the errors looked like there were changes in some of the errors referencing the <code>'static</code> lifetime. It didn't look correct to me at first glance but I find the test output hard to read anyway.</p>



<a name="131237639"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353178%20optimize%20SCC%20computation/near/131237639" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wesley Wiser <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353178.20optimize.20SCC.20computation.html#131237639">(Aug 10 2018 at 13:38)</a>:</h4>
<p>I'll dig in more tonight</p>



<a name="131237830"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353178%20optimize%20SCC%20computation/near/131237830" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353178.20optimize.20SCC.20computation.html#131237830">(Aug 10 2018 at 13:42)</a>:</h4>
<blockquote>
<p>A quick glance at the errors looked like there were changes in some of the errors referencing the <code>'static</code> lifetime. It didn't look correct to me at first glance but I find the test output hard to read anyway.</p>
</blockquote>
<p>ah, well, it might be that this change legitimately changes the heuristics for printing region errors</p>



<a name="131237865"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353178%20optimize%20SCC%20computation/near/131237865" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wesley Wiser <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353178.20optimize.20SCC.20computation.html#131237865">(Aug 10 2018 at 13:43)</a>:</h4>
<p>Gotcha. I'll run the failing tests manually tonight so I can compare the complete output side-by-side and see if it's actually an issue or not.</p>



<a name="131237909"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353178%20optimize%20SCC%20computation/near/131237909" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wesley Wiser <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353178.20optimize.20SCC.20computation.html#131237909">(Aug 10 2018 at 13:44)</a>:</h4>
<p>Since this is a perf optimization, I guess the best test that it's "working" is to compile html5ever and look at the compile times right?</p>



<a name="131238026"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353178%20optimize%20SCC%20computation/near/131238026" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353178.20optimize.20SCC.20computation.html#131238026">(Aug 10 2018 at 13:46)</a>:</h4>
<p>locally? yeah, that would be possible</p>



<a name="131238028"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353178%20optimize%20SCC%20computation/near/131238028" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353178.20optimize.20SCC.20computation.html#131238028">(Aug 10 2018 at 13:46)</a>:</h4>
<p>we can also have the official perf server test it</p>



<a name="131238031"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353178%20optimize%20SCC%20computation/near/131238031" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353178.20optimize.20SCC.20computation.html#131238031">(Aug 10 2018 at 13:47)</a>:</h4>
<p>once we are satisfied it's correct :)</p>



<a name="131238043"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353178%20optimize%20SCC%20computation/near/131238043" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353178.20optimize.20SCC.20computation.html#131238043">(Aug 10 2018 at 13:47)</a>:</h4>
<p>you probably want to build on <a href="https://github.com/rust-lang/rust/pull/53177" target="_blank" title="https://github.com/rust-lang/rust/pull/53177">https://github.com/rust-lang/rust/pull/53177</a> in terms of testing perf</p>



<a name="131238044"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353178%20optimize%20SCC%20computation/near/131238044" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353178.20optimize.20SCC.20computation.html#131238044">(Aug 10 2018 at 13:47)</a>:</h4>
<p>which will..hopefully...land soon?</p>



<a name="131238112"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353178%20optimize%20SCC%20computation/near/131238112" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wesley Wiser <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353178.20optimize.20SCC.20computation.html#131238112">(Aug 10 2018 at 13:48)</a>:</h4>
<p>Yeah, I'm working on top of your branch :)</p>



<a name="131238136"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353178%20optimize%20SCC%20computation/near/131238136" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353178.20optimize.20SCC.20computation.html#131238136">(Aug 10 2018 at 13:49)</a>:</h4>
<p>k</p>



<a name="132242245"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353178%20optimize%20SCC%20computation/near/132242245" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wesley Wiser <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353178.20optimize.20SCC.20computation.html#132242245">(Aug 16 2018 at 14:18)</a>:</h4>
<p>I think you're right about the heuristics in error reporting changing. It looks to me like the error is still being reported correctly, but it's using the wrong wording. I tried tracking it down last night and couldn't quite get it but I have a lead so maybe I can fix it tonight.</p>



<a name="132242267"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353178%20optimize%20SCC%20computation/near/132242267" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wesley Wiser <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353178.20optimize.20SCC.20computation.html#132242267">(Aug 16 2018 at 14:18)</a>:</h4>
<p>Would it be possible to go ahead and get a perf run for the changes? I'm interested in seeing if the speedup you were expecting to see happens.</p>



<a name="132242282"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353178%20optimize%20SCC%20computation/near/132242282" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wesley Wiser <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353178.20optimize.20SCC.20computation.html#132242282">(Aug 16 2018 at 14:19)</a>:</h4>
<p>I also left a question on the PR for you.</p>



<a name="132242304"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353178%20optimize%20SCC%20computation/near/132242304" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wesley Wiser <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353178.20optimize.20SCC.20computation.html#132242304">(Aug 16 2018 at 14:19)</a>:</h4>
<p><span class="user-mention" data-user-id="116009">@nikomatsakis</span> ^^</p>



<a name="132242623"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353178%20optimize%20SCC%20computation/near/132242623" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353178.20optimize.20SCC.20computation.html#132242623">(Aug 16 2018 at 14:25)</a>:</h4>
<p>yes, we can do a perf run</p>



<a name="132242628"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353178%20optimize%20SCC%20computation/near/132242628" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353178.20optimize.20SCC.20computation.html#132242628">(Aug 16 2018 at 14:25)</a>:</h4>
<p>sorry, this week has been crazy busy</p>



<a name="132242638"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353178%20optimize%20SCC%20computation/near/132242638" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wesley Wiser <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353178.20optimize.20SCC.20computation.html#132242638">(Aug 16 2018 at 14:25)</a>:</h4>
<p>No problem! :)</p>



<a name="132242707"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353178%20optimize%20SCC%20computation/near/132242707" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wesley Wiser <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353178.20optimize.20SCC.20computation.html#132242707">(Aug 16 2018 at 14:26)</a>:</h4>
<p>Do the tests need to pass to get a try build out? They're currently failing because of the changed error messages.</p>



<a name="132242716"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353178%20optimize%20SCC%20computation/near/132242716" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353178.20optimize.20SCC.20computation.html#132242716">(Aug 16 2018 at 14:26)</a>:</h4>
<p>yeah, I'm not sure</p>



<a name="132242720"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353178%20optimize%20SCC%20computation/near/132242720" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353178.20optimize.20SCC.20computation.html#132242720">(Aug 16 2018 at 14:26)</a>:</h4>
<p>I always forget</p>



<a name="132242737"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353178%20optimize%20SCC%20computation/near/132242737" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353178.20optimize.20SCC.20computation.html#132242737">(Aug 16 2018 at 14:27)</a>:</h4>
<p>probably best to just fix the tests</p>



<a name="132242739"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353178%20optimize%20SCC%20computation/near/132242739" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wesley Wiser <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353178.20optimize.20SCC.20computation.html#132242739">(Aug 16 2018 at 14:27)</a>:</h4>
<p>Ah, ok.</p>



<a name="132242748"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353178%20optimize%20SCC%20computation/near/132242748" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353178.20optimize.20SCC.20computation.html#132242748">(Aug 16 2018 at 14:27)</a>:</h4>
<p>if it's just UI changes, you can run <code>./x.py test src/test/ui --bless</code></p>



<a name="132242756"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353178%20optimize%20SCC%20computation/near/132242756" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353178.20optimize.20SCC.20computation.html#132242756">(Aug 16 2018 at 14:27)</a>:</h4>
<p>sorry, by "fix the tests" I mean "modify them to reflect the changes"</p>



<a name="132242770"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353178%20optimize%20SCC%20computation/near/132242770" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wesley Wiser <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353178.20optimize.20SCC.20computation.html#132242770">(Aug 16 2018 at 14:27)</a>:</h4>
<p>Gotcha</p>



<a name="132242820"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353178%20optimize%20SCC%20computation/near/132242820" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wesley Wiser <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353178.20optimize.20SCC.20computation.html#132242820">(Aug 16 2018 at 14:28)</a>:</h4>
<p>I'll do that tonight so maybe we can get a perf run in tomorrow.</p>



<a name="132242830"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353178%20optimize%20SCC%20computation/near/132242830" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353178.20optimize.20SCC.20computation.html#132242830">(Aug 16 2018 at 14:28)</a>:</h4>
<p><span class="user-mention" data-user-id="116122">@simulacrum</span> does <code>bors try</code> require tests to pass?</p>



<a name="132242833"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353178%20optimize%20SCC%20computation/near/132242833" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353178.20optimize.20SCC.20computation.html#132242833">(Aug 16 2018 at 14:28)</a>:</h4>
<p>in particular, in order to produce an artifact usable by perf...?</p>



<a name="132242844"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353178%20optimize%20SCC%20computation/near/132242844" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353178.20optimize.20SCC.20computation.html#132242844">(Aug 16 2018 at 14:28)</a>:</h4>
<p>now that I think about it, I think maybe it doesn't</p>



<a name="132242872"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353178%20optimize%20SCC%20computation/near/132242872" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wesley Wiser <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353178.20optimize.20SCC.20computation.html#132242872">(Aug 16 2018 at 14:29)</a>:</h4>
<p>I don't know what kind of speedup you were hoping to see from that change. On my pc, there is a speed up to <code>html5ever</code> but it doesn't seem that big.</p>



<a name="132242906"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353178%20optimize%20SCC%20computation/near/132242906" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wesley Wiser <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353178.20optimize.20SCC.20computation.html#132242906">(Aug 16 2018 at 14:29)</a>:</h4>
<p>I couldn't figure out how to build just <code>html5ever</code> without its dependencies so the total build time is definitely skewed by them.</p>



<a name="132243133"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353178%20optimize%20SCC%20computation/near/132243133" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> lqd <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353178.20optimize.20SCC.20computation.html#132243133">(Aug 16 2018 at 14:32)</a>:</h4>
<p>after a non-incremental check, something like <code>touch src/lib.rs &amp;&amp; CARGO_INCREMENTAL=0 cargo rustc --profile check --lib -- -Zborrowck=mir -Ztwo-phase-borrows</code> should do the trick</p>



<a name="132243207"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353178%20optimize%20SCC%20computation/near/132243207" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wesley Wiser <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353178.20optimize.20SCC.20computation.html#132243207">(Aug 16 2018 at 14:33)</a>:</h4>
<p><span class="user-mention" data-user-id="116113">@lqd</span> Ah, perfect. Thanks!</p>



<a name="132246989"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353178%20optimize%20SCC%20computation/near/132246989" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> lqd <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353178.20optimize.20SCC.20computation.html#132246989">(Aug 16 2018 at 15:30)</a>:</h4>
<blockquote>
<p>does <code>bors try</code> require tests to pass?</p>
</blockquote>
<p>since I had the same question minutes earlier and mine just succeeded, it appears that try builds don't need to have all the tests pass indeed :) I think perf could be ran on <a href="https://github.com/rust-lang/rust/issues/53327" target="_blank" title="https://github.com/rust-lang/rust/issues/53327">#53327</a> as-is</p>



<a name="132276984"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353178%20optimize%20SCC%20computation/near/132276984" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wesley Wiser <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353178.20optimize.20SCC.20computation.html#132276984">(Aug 17 2018 at 02:07)</a>:</h4>
<p>Ok. With  <a href="https://github.com/rust-lang/rust/issues/53327" target="_blank" title="https://github.com/rust-lang/rust/issues/53327">#53327</a> <code>html5ever</code> drops from 4.2 seconds to compile on my pc to <code>4.0</code> seconds in <code>-Zborrowck=mir -Ztwo-phase-borrows</code> mode.</p>



<a name="132286666"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353178%20optimize%20SCC%20computation/near/132286666" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> lqd <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353178.20optimize.20SCC.20computation.html#132286666">(Aug 17 2018 at 07:07)</a>:</h4>
<p>so it only needs a <code>rust-timer</code> command :) cc <span class="user-mention" data-user-id="116122">@simulacrum</span> <span class="user-mention" data-user-id="125254">@kennytm</span></p>



<a name="132287899"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353178%20optimize%20SCC%20computation/near/132287899" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> kennytm <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353178.20optimize.20SCC.20computation.html#132287899">(Aug 17 2018 at 07:45)</a>:</h4>
<p>done <span class="user-mention" data-user-id="116113">@lqd</span></p>



<a name="132288656"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353178%20optimize%20SCC%20computation/near/132288656" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> lqd <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353178.20optimize.20SCC.20computation.html#132288656">(Aug 17 2018 at 08:08)</a>:</h4>
<p><span class="user-mention" data-user-id="125254">@kennytm</span> thanks a lot :)</p>



<a name="132592619"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353178%20optimize%20SCC%20computation/near/132592619" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353178.20optimize.20SCC.20computation.html#132592619">(Aug 22 2018 at 17:59)</a>:</h4>
<p><span class="user-mention" data-user-id="125250">@Wesley Wiser</span> so I made a few edits to your PR...</p>



<a name="132592628"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353178%20optimize%20SCC%20computation/near/132592628" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353178.20optimize.20SCC.20computation.html#132592628">(Aug 22 2018 at 17:59)</a>:</h4>
<p>converting it to avoid <code>Box</code> and fix the lifetime issues</p>



<a name="132592630"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353178%20optimize%20SCC%20computation/near/132592630" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353178.20optimize.20SCC.20computation.html#132592630">(Aug 22 2018 at 17:59)</a>:</h4>
<p>I guess I'll just push them</p>



<a name="132592674"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353178%20optimize%20SCC%20computation/near/132592674" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353178.20optimize.20SCC.20computation.html#132592674">(Aug 22 2018 at 18:00)</a>:</h4>
<p>I was getting "nerd swiped" by improvements to <code>IndexVec</code> to make it read nicer but I think I will stop here ;)</p>



<a name="132593827"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353178%20optimize%20SCC%20computation/near/132593827" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wesley Wiser <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353178.20optimize.20SCC.20computation.html#132593827">(Aug 22 2018 at 18:23)</a>:</h4>
<p><span class="user-mention" data-user-id="116009">@nikomatsakis</span> Thanks! I'll take a look. I've been trying to track down the error reporting regressions that are failing the ui tests.</p>



<a name="132594027"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353178%20optimize%20SCC%20computation/near/132594027" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353178.20optimize.20SCC.20computation.html#132594027">(Aug 22 2018 at 18:27)</a>:</h4>
<p><span class="user-mention" data-user-id="125250">@Wesley Wiser</span> ok -- can you push the updated UI tests to the PR? I'd like to see the full diffs, and that's the easiest way.</p>



<a name="132594037"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353178%20optimize%20SCC%20computation/near/132594037" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353178.20optimize.20SCC.20computation.html#132594037">(Aug 22 2018 at 18:27)</a>:</h4>
<p>I guess I can build and run locally too...</p>



<a name="132594249"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353178%20optimize%20SCC%20computation/near/132594249" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wesley Wiser <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353178.20optimize.20SCC.20computation.html#132594249">(Aug 22 2018 at 18:30)</a>:</h4>
<p>The issue is <a href="https://github.com/rust-lang/rust/blob/c24f27c0452a9aaecfb70d225d846df2e517385f/src/librustc_mir/borrow_check/nll/region_infer/error_reporting/mod.rs#L123" target="_blank" title="https://github.com/rust-lang/rust/blob/c24f27c0452a9aaecfb70d225d846df2e517385f/src/librustc_mir/borrow_check/nll/region_infer/error_reporting/mod.rs#L123">here</a>. Before my change, <code>best_choice</code> would be <code>Some(_)</code> but now it's <code>None</code> because <a href="https://github.com/rust-lang/rust/blob/c24f27c0452a9aaecfb70d225d846df2e517385f/src/librustc_mir/borrow_check/nll/region_infer/error_reporting/mod.rs#L133" target="_blank" title="https://github.com/rust-lang/rust/blob/c24f27c0452a9aaecfb70d225d846df2e517385f/src/librustc_mir/borrow_check/nll/region_infer/error_reporting/mod.rs#L133">this</a> removes constraints in the same SCC. With my changes, they're in the same SCC and so <a href="https://github.com/rust-lang/rust/blob/c24f27c0452a9aaecfb70d225d846df2e517385f/src/librustc_mir/borrow_check/nll/region_infer/error_reporting/mod.rs#L143" target="_blank" title="https://github.com/rust-lang/rust/blob/c24f27c0452a9aaecfb70d225d846df2e517385f/src/librustc_mir/borrow_check/nll/region_infer/error_reporting/mod.rs#L143">this code</a> runs when it normally wouldn't.</p>



<a name="132594260"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353178%20optimize%20SCC%20computation/near/132594260" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wesley Wiser <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353178.20optimize.20SCC.20computation.html#132594260">(Aug 22 2018 at 18:31)</a>:</h4>
<p><span class="user-mention" data-user-id="116009">@nikomatsakis</span> I'll do that first thing tonight when I get back to my pc</p>



<a name="132594374"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353178%20optimize%20SCC%20computation/near/132594374" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353178.20optimize.20SCC.20computation.html#132594374">(Aug 22 2018 at 18:32)</a>:</h4>
<p>ok</p>



<a name="132594382"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353178%20optimize%20SCC%20computation/near/132594382" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353178.20optimize.20SCC.20computation.html#132594382">(Aug 22 2018 at 18:32)</a>:</h4>
<p>I can certainly imagine that this would influence those results</p>



<a name="132654243"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353178%20optimize%20SCC%20computation/near/132654243" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353178.20optimize.20SCC.20computation.html#132654243">(Aug 23 2018 at 18:42)</a>:</h4>
<p>ok <span class="user-mention" data-user-id="125250">@Wesley Wiser</span> so I see the delta now. It makes sense to me how this is arising: it's fundamentally just kind of tricky to figure out which points are "user visible"  conversions and which are not. The SCC is clearly an imperfect heuristic here... but I'm not sure whether to hold up the PR on that basis or not.</p>



<a name="132654325"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353178%20optimize%20SCC%20computation/near/132654325" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353178.20optimize.20SCC.20computation.html#132654325">(Aug 23 2018 at 18:44)</a>:</h4>
<p>do you want to rebase, in any case?</p>



<a name="132654606"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353178%20optimize%20SCC%20computation/near/132654606" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wesley Wiser <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353178.20optimize.20SCC.20computation.html#132654606">(Aug 23 2018 at 18:50)</a>:</h4>
<p>I certainly can yeah. Do you want me to keep your commits separate or squash it all together?</p>



<a name="132654634"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353178%20optimize%20SCC%20computation/near/132654634" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wesley Wiser <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353178.20optimize.20SCC.20computation.html#132654634">(Aug 23 2018 at 18:51)</a>:</h4>
<p>I'm personally pretty bummed by the regression in error messages. I think they used to be really good and now they're pretty meh. It's certainly your call though if you want to merge as-is or not. :)</p>



<a name="132654688"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353178%20optimize%20SCC%20computation/near/132654688" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wesley Wiser <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353178.20optimize.20SCC.20computation.html#132654688">(Aug 23 2018 at 18:52)</a>:</h4>
<p>I spent last night trying to come up with a better heuristic but I haven't thought of anything yet.</p>



<a name="132654877"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353178%20optimize%20SCC%20computation/near/132654877" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353178.20optimize.20SCC.20computation.html#132654877">(Aug 23 2018 at 18:57)</a>:</h4>
<blockquote>
<p>I certainly can yeah. Do you want me to keep your commits separate or squash it all together?</p>
</blockquote>
<p>squash is fine</p>



<a name="132654884"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353178%20optimize%20SCC%20computation/near/132654884" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353178.20optimize.20SCC.20computation.html#132654884">(Aug 23 2018 at 18:57)</a>:</h4>
<blockquote>
<p>I spent last night trying to come up with a better heuristic but I haven't thought of anything yet.</p>
</blockquote>
<p>well, certainly we could compute the SCC <em>without</em> the augmentation and use that</p>



<a name="132654885"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353178%20optimize%20SCC%20computation/near/132654885" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353178.20optimize.20SCC.20computation.html#132654885">(Aug 23 2018 at 18:57)</a>:</h4>
<p>it doesn't .. feel "theoretically" better</p>



<a name="132654889"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353178%20optimize%20SCC%20computation/near/132654889" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353178.20optimize.20SCC.20computation.html#132654889">(Aug 23 2018 at 18:57)</a>:</h4>
<p>it just sort of "happens to be"</p>



<a name="132654893"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353178%20optimize%20SCC%20computation/near/132654893" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353178.20optimize.20SCC.20computation.html#132654893">(Aug 23 2018 at 18:58)</a>:</h4>
<p>but this is all a heuristic, so...</p>



<a name="132654935"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353178%20optimize%20SCC%20computation/near/132654935" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353178.20optimize.20SCC.20computation.html#132654935">(Aug 23 2018 at 18:58)</a>:</h4>
<p>(that is, we could compute this lazilly when we have to report errors, I mean)</p>



<a name="132654939"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353178%20optimize%20SCC%20computation/near/132654939" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353178.20optimize.20SCC.20computation.html#132654939">(Aug 23 2018 at 18:58)</a>:</h4>
<p>the other option I can see -- well, I have to review the code -- but it would basically be that we don't just consider whether the sub/sup are in the same SCC, but we also look at the <em>kind</em> of edge</p>



<a name="132654943"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353178%20optimize%20SCC%20computation/near/132654943" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353178.20optimize.20SCC.20computation.html#132654943">(Aug 23 2018 at 18:58)</a>:</h4>
<p>do you have plots of the region graphs in those examples?</p>



<a name="132655358"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353178%20optimize%20SCC%20computation/near/132655358" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wesley Wiser <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353178.20optimize.20SCC.20computation.html#132655358">(Aug 23 2018 at 19:08)</a>:</h4>
<p><span class="user-mention" data-user-id="116009">@nikomatsakis</span> Is there a tool to dump that info?</p>



<a name="132657728"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353178%20optimize%20SCC%20computation/near/132657728" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353178.20optimize.20SCC.20computation.html#132657728">(Aug 23 2018 at 20:05)</a>:</h4>
<p><code>-Zdump-mir=nll</code> I think gives <code>dot</code> files</p>



<a name="132657729"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353178%20optimize%20SCC%20computation/near/132657729" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353178.20optimize.20SCC.20computation.html#132657729">(Aug 23 2018 at 20:05)</a>:</h4>
<p>in the <code>mir_dump</code> directory</p>



<a name="132657738"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353178%20optimize%20SCC%20computation/near/132657738" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353178.20optimize.20SCC.20computation.html#132657738">(Aug 23 2018 at 20:05)</a>:</h4>
<p>IIRC</p>



<a name="132709275"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353178%20optimize%20SCC%20computation/near/132709275" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353178.20optimize.20SCC.20computation.html#132709275">(Aug 24 2018 at 17:53)</a>:</h4>
<p>ok <span class="user-mention" data-user-id="125250">@Wesley Wiser</span> consensus seems to be merging the PR as is — I hadn't realized there were ICEs etc though</p>



<a name="132709320"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353178%20optimize%20SCC%20computation/near/132709320" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353178.20optimize.20SCC.20computation.html#132709320">(Aug 24 2018 at 17:54)</a>:</h4>
<p>I guess you rebased, though?</p>



<a name="132710552"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353178%20optimize%20SCC%20computation/near/132710552" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wesley Wiser <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353178.20optimize.20SCC.20computation.html#132710552">(Aug 24 2018 at 18:12)</a>:</h4>
<p>Yeah, I rebased on <code>master</code> last night</p>



<a name="132710559"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353178%20optimize%20SCC%20computation/near/132710559" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wesley Wiser <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353178.20optimize.20SCC.20computation.html#132710559">(Aug 24 2018 at 18:12)</a>:</h4>
<p>I didn't realize either since they were mixed into the other failing tests</p>



<a name="132710614"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353178%20optimize%20SCC%20computation/near/132710614" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wesley Wiser <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353178.20optimize.20SCC.20computation.html#132710614">(Aug 24 2018 at 18:13)</a>:</h4>
<p>I spent about an hour last night looking into the ICEs but it's slow going. I'm completely unfamiliar with this code.</p>



<a name="132710621"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353178%20optimize%20SCC%20computation/near/132710621" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353178.20optimize.20SCC.20computation.html#132710621">(Aug 24 2018 at 18:13)</a>:</h4>
<p>ok, I can take a look in a bit</p>



<a name="132710623"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353178%20optimize%20SCC%20computation/near/132710623" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wesley Wiser <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353178.20optimize.20SCC.20computation.html#132710623">(Aug 24 2018 at 18:13)</a>:</h4>
<p>Much appreciated! :)</p>



<a name="132710872"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353178%20optimize%20SCC%20computation/near/132710872" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wesley Wiser <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353178.20optimize.20SCC.20computation.html#132710872">(Aug 24 2018 at 18:17)</a>:</h4>
<p>The stack trace showed that <code>find_constraint_paths_between_regions()</code> (<a href="https://github.com/rust-lang/rust/blob/61b00727076ce251b54bdefa18779a13819d2209/src/librustc_mir/borrow_check/nll/region_infer/error_reporting/mod.rs#L163" target="_blank" title="https://github.com/rust-lang/rust/blob/61b00727076ce251b54bdefa18779a13819d2209/src/librustc_mir/borrow_check/nll/region_infer/error_reporting/mod.rs#L163">here</a>) was failing to find the path and thus returning <code>None</code> which was getting unwrapped in <code>best_blame_constraint()</code> (<a href="https://github.com/rust-lang/rust/blob/61b00727076ce251b54bdefa18779a13819d2209/src/librustc_mir/borrow_check/nll/region_infer/error_reporting/mod.rs#L79" target="_blank" title="https://github.com/rust-lang/rust/blob/61b00727076ce251b54bdefa18779a13819d2209/src/librustc_mir/borrow_check/nll/region_infer/error_reporting/mod.rs#L79">here</a>) when called from <code>find_outlives_blame_span()</code> (<a href="https://github.com/rust-lang/rust/blob/61b00727076ce251b54bdefa18779a13819d2209/src/librustc_mir/borrow_check/nll/region_infer/error_reporting/mod.rs#L489" target="_blank" title="https://github.com/rust-lang/rust/blob/61b00727076ce251b54bdefa18779a13819d2209/src/librustc_mir/borrow_check/nll/region_infer/error_reporting/mod.rs#L489">here</a>)</p>



<a name="132713560"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353178%20optimize%20SCC%20computation/near/132713560" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353178.20optimize.20SCC.20computation.html#132713560">(Aug 24 2018 at 19:07)</a>:</h4>
<p>ok, I see how that could happen.</p>



<a name="132713570"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353178%20optimize%20SCC%20computation/near/132713570" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353178.20optimize.20SCC.20computation.html#132713570">(Aug 24 2018 at 19:07)</a>:</h4>
<p>the problem here is that we are walking the "unaugmented" graph, essentially</p>



<a name="132713590"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353178%20optimize%20SCC%20computation/near/132713590" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353178.20optimize.20SCC.20computation.html#132713590">(Aug 24 2018 at 19:07)</a>:</h4>
<p>let me look at the code just a <em>bit</em> more closely</p>



<a name="132713689"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353178%20optimize%20SCC%20computation/near/132713689" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353178.20optimize.20SCC.20computation.html#132713689">(Aug 24 2018 at 19:09)</a>:</h4>
<p>I guess if you have <code>R1: R2: 'static</code> then we would have a "synthetic" edge like <code>'static: R3</code></p>



<a name="132713742"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353178%20optimize%20SCC%20computation/near/132713742" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353178.20optimize.20SCC.20computation.html#132713742">(Aug 24 2018 at 19:10)</a>:</h4>
<p>so if we are then searching for a path from <code>R1</code> to <code>R3</code>, we won't find it</p>



<a name="132713753"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353178%20optimize%20SCC%20computation/near/132713753" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353178.20optimize.20SCC.20computation.html#132713753">(Aug 24 2018 at 19:10)</a>:</h4>
<p>one option is just to search the augmented graph</p>



<a name="132713795"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353178%20optimize%20SCC%20computation/near/132713795" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353178.20optimize.20SCC.20computation.html#132713795">(Aug 24 2018 at 19:11)</a>:</h4>
<p>that may have other effects on error msgs</p>



<a name="132713808"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353178%20optimize%20SCC%20computation/near/132713808" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353178.20optimize.20SCC.20computation.html#132713808">(Aug 24 2018 at 19:11)</a>:</h4>
<p>another option would be to look for "r3 or 'static"</p>



<a name="132713857"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353178%20optimize%20SCC%20computation/near/132713857" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353178.20optimize.20SCC.20computation.html#132713857">(Aug 24 2018 at 19:12)</a>:</h4>
<p>that would fix the ICE but it feels...like the concern is "leaking" a bit more than I might like</p>



<a name="132713866"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353178%20optimize%20SCC%20computation/near/132713866" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353178.20optimize.20SCC.20computation.html#132713866">(Aug 24 2018 at 19:12)</a>:</h4>
<p>I am wondering</p>



<a name="132713872"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353178%20optimize%20SCC%20computation/near/132713872" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353178.20optimize.20SCC.20computation.html#132713872">(Aug 24 2018 at 19:12)</a>:</h4>
<p><em>another</em> option might be to tweak our approach</p>



<a name="132713892"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353178%20optimize%20SCC%20computation/near/132713892" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353178.20optimize.20SCC.20computation.html#132713892">(Aug 24 2018 at 19:13)</a>:</h4>
<p>and just add the extra constraints</p>



<a name="132713901"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353178%20optimize%20SCC%20computation/near/132713901" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353178.20optimize.20SCC.20computation.html#132713901">(Aug 24 2018 at 19:13)</a>:</h4>
<p>into the list of constraints</p>



<a name="132713908"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353178%20optimize%20SCC%20computation/near/132713908" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353178.20optimize.20SCC.20computation.html#132713908">(Aug 24 2018 at 19:13)</a>:</h4>
<p>but that also feels meh</p>



<a name="132714759"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353178%20optimize%20SCC%20computation/near/132714759" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353178.20optimize.20SCC.20computation.html#132714759">(Aug 24 2018 at 19:30)</a>:</h4>
<p>(e.g., there are a lot of variables, seem silly to materialize all those constraints)</p>



<a name="132714775"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353178%20optimize%20SCC%20computation/near/132714775" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353178.20optimize.20SCC.20computation.html#132714775">(Aug 24 2018 at 19:31)</a>:</h4>
<p>hmm maybe this setup is a bit silly altogether</p>



<a name="132714854"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353178%20optimize%20SCC%20computation/near/132714854" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jake Goulding <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353178.20optimize.20SCC.20computation.html#132714854">(Aug 24 2018 at 19:32)</a>:</h4>
<div class="message_inline_image"><a href="http://www.tshirtvortex.net/wp-content/uploads/Tis-A-Silly-Place-1.jpg" target="_blank" title="http://www.tshirtvortex.net/wp-content/uploads/Tis-A-Silly-Place-1.jpg"><img src="https://uploads.zulipusercontent.net/7249cebe20b3eca712cab02e652bd040dabaaadc/687474703a2f2f7777772e747368697274766f727465782e6e65742f77702d636f6e74656e742f75706c6f6164732f5469732d412d53696c6c792d506c6163652d312e6a7067"></a></div>



<a name="132715019"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353178%20optimize%20SCC%20computation/near/132715019" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353178.20optimize.20SCC.20computation.html#132715019">(Aug 24 2018 at 19:35)</a>:</h4>
<p>ok <span class="user-mention" data-user-id="125250">@Wesley Wiser</span> so... right now we have these various layers. There is the "constraint graph", which yields up constraint indices. Then you can combine that with the constraint <em>set</em> to get the region graph. </p>
<p>One annoying thing here is that, because we yield up constraint <strong>indices</strong>, if we want to make fake constraints, say, that connect <code>'static</code> to other lifetimes, then we have to add them into the vector.</p>
<p>Maybe instead the constraint graph iterator should take a <code>&amp;'iter ConstraintSet</code>. Then the iterator can yield up <code>OutlivesConstraint</code> structs <strong>by value</strong>.  This way, we can generate <code>OutlivesConstraint { sup: static, sub: other_region, locations: Locations::All }</code> for those implied <code>'static</code> constraints.</p>
<p>We can then do that <strong>always</strong>, in the base layer of the graph. </p>
<p>Then we can remove the "augmented-region-graph" concept.</p>
<p>Moreover, this might help with the other regressions we were seeing, since <em>maybe</em> we can tweak the <code>locations</code> value and help our "graph walker" to identify interesting points again (maybe -- I might rather take a different approach).</p>



<a name="132715069"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353178%20optimize%20SCC%20computation/near/132715069" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353178.20optimize.20SCC.20computation.html#132715069">(Aug 24 2018 at 19:36)</a>:</h4>
<p>I think I'll copy this into the PR so you don't have to read all my chatter</p>



<a name="132715335"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353178%20optimize%20SCC%20computation/near/132715335" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wesley Wiser <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353178.20optimize.20SCC.20computation.html#132715335">(Aug 24 2018 at 19:40)</a>:</h4>
<p>(reading through it now)</p>



<a name="132717180"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353178%20optimize%20SCC%20computation/near/132717180" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wesley Wiser <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353178.20optimize.20SCC.20computation.html#132717180">(Aug 24 2018 at 20:15)</a>:</h4>
<p><span class="user-mention" data-user-id="116009">@nikomatsakis</span> So, I think I get the general idea. A few questions:</p>
<p>You said "constraint graph iterator" is that the <code>Edges</code> struct which impls <code>Iterator&lt;Type = ConstraintIndex&gt;</code>? Are you saying I should change it to impl <code>Iterator&lt;Type = OutlivesConstraint&gt;</code>? Or is this a new iterator that should be created?</p>
<blockquote>
<p>We can do that always, in the base layer of the graph</p>
</blockquote>
<p>Are you saying we'd add the outlives constraints in <code>ConstraintGraph</code>? Or that the constraint graph iterator is responsible for creating them when iterated?</p>



<a name="132717268"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353178%20optimize%20SCC%20computation/near/132717268" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353178.20optimize.20SCC.20computation.html#132717268">(Aug 24 2018 at 20:17)</a>:</h4>
<p><span class="user-mention" data-user-id="125250">@Wesley Wiser</span> </p>
<blockquote>
<p>Are you saying I should change it to <code>impl Iterator&lt;Type = OutlivesConstraint&gt;</code>? </p>
</blockquote>
<p>Yes</p>
<blockquote>
<p>Or that the constraint graph iterator is responsible for creating them when iterated?</p>
</blockquote>
<p>This, I think</p>



<a name="132717361"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353178%20optimize%20SCC%20computation/near/132717361" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wesley Wiser <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353178.20optimize.20SCC.20computation.html#132717361">(Aug 24 2018 at 20:19)</a>:</h4>
<p>Ok <span class="emoji emoji-1f44d" title="thumbs up">:thumbs_up:</span></p>



<a name="132717551"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353178%20optimize%20SCC%20computation/near/132717551" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wesley Wiser <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353178.20optimize.20SCC.20computation.html#132717551">(Aug 24 2018 at 20:22)</a>:</h4>
<p>I think that's enough for me to get started working on that tonight. I'm sure I'll probably have questions for you on Monday <span class="emoji emoji-1f606" title="laughing">:laughing:</span></p>



<a name="132717640"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353178%20optimize%20SCC%20computation/near/132717640" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353178.20optimize.20SCC.20computation.html#132717640">(Aug 24 2018 at 20:24)</a>:</h4>
<p>sounds good! =)</p>



<a name="132717643"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353178%20optimize%20SCC%20computation/near/132717643" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wesley Wiser <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353178.20optimize.20SCC.20computation.html#132717643">(Aug 24 2018 at 20:24)</a>:</h4>
<p>Thanks for all your help!</p>



<a name="132812343"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353178%20optimize%20SCC%20computation/near/132812343" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wesley Wiser <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353178.20optimize.20SCC.20computation.html#132812343">(Aug 27 2018 at 03:40)</a>:</h4>
<p><span class="user-mention" data-user-id="116009">@nikomatsakis</span> That was a really good idea! I tried the other strategy as you said and it works much better. After the changes, there were only two failing ui tests and they don't seem like significant regressions either. I'm unsure of the perf so we'll definitely need to rerun that.</p>



<a name="132850927"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353178%20optimize%20SCC%20computation/near/132850927" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353178.20optimize.20SCC.20computation.html#132850927">(Aug 27 2018 at 11:12)</a>:</h4>
<p><span class="user-mention" data-user-id="125250">@Wesley Wiser</span> left some comments; there may be a bug lurking there too though, given that the perf results are "different" than before</p>



<a name="132922555"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353178%20optimize%20SCC%20computation/near/132922555" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wesley Wiser <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353178.20optimize.20SCC.20computation.html#132922555">(Aug 28 2018 at 14:57)</a>:</h4>
<p><span class="user-mention" data-user-id="116009">@nikomatsakis</span> I implemented your feedback. The perf results look much better now.</p>



<a name="132922911"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353178%20optimize%20SCC%20computation/near/132922911" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353178.20optimize.20SCC.20computation.html#132922911">(Aug 28 2018 at 15:03)</a>:</h4>
<p>great!</p>



<a name="132922971"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353178%20optimize%20SCC%20computation/near/132922971" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353178.20optimize.20SCC.20computation.html#132922971">(Aug 28 2018 at 15:04)</a>:</h4>
<p>of course now the question is what's up with <em>ucd-check</em> :P</p>



<a name="132923085"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353178%20optimize%20SCC%20computation/near/132923085" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353178.20optimize.20SCC.20computation.html#132923085">(Aug 28 2018 at 15:06)</a>:</h4>
<p>I guess I was wrong about the "extra errors"</p>



<a name="132923174"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353178%20optimize%20SCC%20computation/near/132923174" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353178.20optimize.20SCC.20computation.html#132923174">(Aug 28 2018 at 15:08)</a>:</h4>
<p>oh the max-rss wins are <em>huge</em> though</p>



<a name="132923267"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353178%20optimize%20SCC%20computation/near/132923267" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wesley Wiser <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353178.20optimize.20SCC.20computation.html#132923267">(Aug 28 2018 at 15:09)</a>:</h4>
<p>Yeah, I can try profiling it tonight and see if anything jumps out to me.</p>



<a name="132923317"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353178%20optimize%20SCC%20computation/near/132923317" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wesley Wiser <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353178.20optimize.20SCC.20computation.html#132923317">(Aug 28 2018 at 15:10)</a>:</h4>
<p><code>ucd-check</code> that is</p>



<a name="132923332"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353178%20optimize%20SCC%20computation/near/132923332" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353178.20optimize.20SCC.20computation.html#132923332">(Aug 28 2018 at 15:10)</a>:</h4>
<p>it's curious but probably not that big a deal</p>



<a name="132923335"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353178%20optimize%20SCC%20computation/near/132923335" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353178.20optimize.20SCC.20computation.html#132923335">(Aug 28 2018 at 15:10)</a>:</h4>
<p>I left a few comments</p>



<a name="132923336"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353178%20optimize%20SCC%20computation/near/132923336" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353178.20optimize.20SCC.20computation.html#132923336">(Aug 28 2018 at 15:10)</a>:</h4>
<p>to that effect:)</p>



<a name="132923353"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353178%20optimize%20SCC%20computation/near/132923353" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353178.20optimize.20SCC.20computation.html#132923353">(Aug 28 2018 at 15:11)</a>:</h4>
<p>nice that, after this, html5ever gets to 115% or so</p>



<a name="132923451"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353178%20optimize%20SCC%20computation/near/132923451" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wesley Wiser <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353178.20optimize.20SCC.20computation.html#132923451">(Aug 28 2018 at 15:13)</a>:</h4>
<p>Yeah, the html5ever results are exciting</p>



<a name="132923525"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353178%20optimize%20SCC%20computation/near/132923525" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wesley Wiser <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353178.20optimize.20SCC.20computation.html#132923525">(Aug 28 2018 at 15:14)</a>:</h4>
<p>I don't know if you noticed but the "extra errors" issue seems to have gotten worse <span class="emoji emoji-1f926" title="face palm">:face_palm:</span></p>



<a name="132923634"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353178%20optimize%20SCC%20computation/near/132923634" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353178.20optimize.20SCC.20computation.html#132923634">(Aug 28 2018 at 15:16)</a>:</h4>
<p>hmm curious</p>



<a name="132923898"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353178%20optimize%20SCC%20computation/near/132923898" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jake Goulding <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353178.20optimize.20SCC.20computation.html#132923898">(Aug 28 2018 at 15:22)</a>:</h4>
<p>perf wins link please?</p>



<a name="132924144"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353178%20optimize%20SCC%20computation/near/132924144" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jake Goulding <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353178.20optimize.20SCC.20computation.html#132924144">(Aug 28 2018 at 15:27)</a>:</h4>
<p>Ah - <a href="https://perf.rust-lang.org/compare.html?start=f33921ba58754d1bfbaf483ddc6dc9dffdcd4de7&amp;end=3bf463eacebe287b54bbfa28fd64168e41c4446c" target="_blank" title="https://perf.rust-lang.org/compare.html?start=f33921ba58754d1bfbaf483ddc6dc9dffdcd4de7&amp;end=3bf463eacebe287b54bbfa28fd64168e41c4446c">https://perf.rust-lang.org/compare.html?start=f33921ba58754d1bfbaf483ddc6dc9dffdcd4de7&amp;end=3bf463eacebe287b54bbfa28fd64168e41c4446c</a></p>



<a name="132924242"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353178%20optimize%20SCC%20computation/near/132924242" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353178.20optimize.20SCC.20computation.html#132924242">(Aug 28 2018 at 15:29)</a>:</h4>
<p>Er, sorry, . Yes <a href="https://perf.rust-lang.org/compare.html?start=f33921ba58754d1bfbaf483ddc6dc9dffdcd4de7&amp;end=3bf463eacebe287b54bbfa28fd64168e41c4446c" target="_blank" title="https://perf.rust-lang.org/compare.html?start=f33921ba58754d1bfbaf483ddc6dc9dffdcd4de7&amp;end=3bf463eacebe287b54bbfa28fd64168e41c4446c">comparison URL</a></p>



<a name="132926082"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353178%20optimize%20SCC%20computation/near/132926082" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> lqd <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353178.20optimize.20SCC.20computation.html#132926082">(Aug 28 2018 at 16:02)</a>:</h4>
<p><code>ucd-check</code> is only 1 run, so more sensitive to weirdness imo :)</p>



<a name="132926764"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353178%20optimize%20SCC%20computation/near/132926764" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353178.20optimize.20SCC.20computation.html#132926764">(Aug 28 2018 at 16:15)</a>:</h4>
<p>ah makes sense</p>



<a name="132927541"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353178%20optimize%20SCC%20computation/near/132927541" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wesley Wiser <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353178.20optimize.20SCC.20computation.html#132927541">(Aug 28 2018 at 16:33)</a>:</h4>
<p>Oh interesting</p>



<a name="132927587"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353178%20optimize%20SCC%20computation/near/132927587" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wesley Wiser <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353178.20optimize.20SCC.20computation.html#132927587">(Aug 28 2018 at 16:34)</a>:</h4>
<p>I'll still take a look tonight and see if there's any low hanging fruit but that makes me feel better</p>



<a name="132968710"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353178%20optimize%20SCC%20computation/near/132968710" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wesley Wiser <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353178.20optimize.20SCC.20computation.html#132968710">(Aug 29 2018 at 00:51)</a>:</h4>
<p>I'm not seeing anything pop out to me in <code>perf</code>.</p>



<a name="132968766"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353178%20optimize%20SCC%20computation/near/132968766" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353178.20optimize.20SCC.20computation.html#132968766">(Aug 29 2018 at 00:53)</a>:</h4>
<p>the real question is if we can suppress the  duplicate errors somehow</p>



<a name="132968767"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353178%20optimize%20SCC%20computation/near/132968767" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353178.20optimize.20SCC.20computation.html#132968767">(Aug 29 2018 at 00:53)</a>:</h4>
<p>seems like it should be true</p>



<a name="133101838"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353178%20optimize%20SCC%20computation/near/133101838" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wesley Wiser <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353178.20optimize.20SCC.20computation.html#133101838">(Aug 31 2018 at 04:00)</a>:</h4>
<p>So I've tried comparing a log of <code>rustc</code> with and without my changes. One thing that stands out to me is this:</p>
<p>Before:</p>
<div class="codehilite"><pre><span></span>rustc_mir::borrow_check::nll::region_infer::error_reporting: report_error: fr_is_local=true outlived_fr_is_local=false category=Assignment
rustc_mir::borrow_check::nll::region_infer::error_reporting::var_name: get_var_name_and_span_for_region(fr=&#39;_#1r)
rustc_mir::borrow_check::nll::region_infer::error_reporting::var_name: get_var_name_and_span_for_region: attempting upvar
rustc_mir::borrow_check::nll::region_infer::error_reporting::var_name: get_var_name_and_span_for_region: attempting argument
rustc_mir::borrow_check::nll::region_infer::error_reporting::var_name: get_argument_index_for_region: arg_ty = std::boxed::Box&lt;&lt;&amp;T as A&gt;::X&gt;
rustc_mir::borrow_check::nll::region_infer::error_reporting::var_name: get_argument_index_for_region: found &#39;_#1r in argument 0 which has type std::boxed::Box&lt;&lt;&amp;T as A&gt;::X&gt;
rustc_mir::borrow_check::nll::region_infer::error_reporting::var_name: get_argument_name_and_span_for_region: argument_local=_1
rustc_mir::borrow_check::nll::region_infer::error_reporting::var_name: get_argument_name_and_span_for_region: argument_name=Some(s) argument_span=issue-50716.rs:20:24: 20:25
rustc_mir::borrow_check::nll::region_infer::error_reporting::var_name: get_var_name_and_span_for_region(fr=&#39;_#0r)
rustc_mir::borrow_check::nll::region_infer::error_reporting::var_name: get_var_name_and_span_for_region: attempting upvar
rustc_mir::borrow_check::nll::region_infer::error_reporting::var_name: get_var_name_and_span_for_region: attempting argument
rustc_mir::borrow_check::nll::region_infer::error_reporting::var_name: get_argument_index_for_region: arg_ty = std::boxed::Box&lt;&lt;&amp;T as A&gt;::X&gt;
rustc_mir::borrow_check::nll::region_infer: check_universal_region(fr=&#39;_#2r)
rustc_mir::borrow_check::nll::region_infer: check_universal_region(fr=&#39;_#3r)
</pre></div>


<p>After:</p>
<div class="codehilite"><pre><span></span>rustc_mir::borrow_check::nll::region_infer::error_reporting: report_error: fr_is_local=true outlived_fr_is_local=false category=Assignment
rustc_mir::borrow_check::nll::region_infer::error_reporting::var_name: get_var_name_and_span_for_region(fr=&#39;_#1r)
rustc_mir::borrow_check::nll::region_infer::error_reporting::var_name: get_var_name_and_span_for_region: attempting upvar
rustc_mir::borrow_check::nll::region_infer::error_reporting::var_name: get_var_name_and_span_for_region: attempting argument
rustc_mir::borrow_check::nll::region_infer::error_reporting::var_name: get_argument_index_for_region: arg_ty = std::boxed::Box&lt;&lt;&amp;T as A&gt;::X&gt;
rustc_mir::borrow_check::nll::region_infer::error_reporting::var_name: get_argument_index_for_region: found &#39;_#1r in argument 0 which has type std::boxed::Box&lt;&lt;&amp;T as A&gt;::X&gt;
rustc_mir::borrow_check::nll::region_infer::error_reporting::var_name: get_argument_name_and_span_for_region: argument_local=_1
rustc_mir::borrow_check::nll::region_infer::error_reporting::var_name: get_argument_name_and_span_for_region: argument_name=Some(s) argument_span=issue-50716.rs:20:24: 20:25
rustc_mir::borrow_check::nll::region_infer::error_reporting::var_name: get_var_name_and_span_for_region(fr=&#39;_#0r)
rustc_mir::borrow_check::nll::region_infer::error_reporting::var_name: get_var_name_and_span_for_region: attempting upvar
rustc_mir::borrow_check::nll::region_infer::error_reporting::var_name: get_var_name_and_span_for_region: attempting argument
rustc_mir::borrow_check::nll::region_infer::error_reporting::var_name: get_argument_index_for_region: arg_ty = std::boxed::Box&lt;&lt;&amp;T as A&gt;::X&gt;
rustc_mir::borrow_check::nll::region_infer: check_universal_region: fr=&#39;_#1r does not outlive shorter_fr=&#39;_#2r
</pre></div>


<p>The last message comes from <a href="https://github.com/rust-lang/rust/blob/8adc69a5a873dd7e840b7d002ae48a4c638ef7ee/src/librustc_mir/borrow_check/nll/region_infer/mod.rs#L1039" target="_blank" title="https://github.com/rust-lang/rust/blob/8adc69a5a873dd7e840b7d002ae48a4c638ef7ee/src/librustc_mir/borrow_check/nll/region_infer/mod.rs#L1039">here</a>. </p>
<p>I'm not sure what to investigate next.</p>



<a name="133126776"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353178%20optimize%20SCC%20computation/near/133126776" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wesley Wiser <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353178.20optimize.20SCC.20computation.html#133126776">(Aug 31 2018 at 14:16)</a>:</h4>
<p><span class="user-mention" data-user-id="116009">@nikomatsakis</span> Does the above info mean anything to you? I'm still working on figuring it out but I thought I'd ask in case it was obvious to you</p>



<a name="133126816"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353178%20optimize%20SCC%20computation/near/133126816" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353178.20optimize.20SCC.20computation.html#133126816">(Aug 31 2018 at 14:17)</a>:</h4>
<p>it's not obvious to me, no</p>



<a name="133126822"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353178%20optimize%20SCC%20computation/near/133126822" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353178.20optimize.20SCC.20computation.html#133126822">(Aug 31 2018 at 14:18)</a>:</h4>
<p>I was hoping to look at it today, presuming you don't find it first :)</p>



<a name="133126972"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353178%20optimize%20SCC%20computation/near/133126972" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wesley Wiser <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353178.20optimize.20SCC.20computation.html#133126972">(Aug 31 2018 at 14:20)</a>:</h4>
<p>I'm at work right now so I won't be able to look at it until tonight :)</p>



<a name="133126980"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353178%20optimize%20SCC%20computation/near/133126980" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wesley Wiser <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353178.20optimize.20SCC.20computation.html#133126980">(Aug 31 2018 at 14:20)</a>:</h4>
<p>That was just how far I got last night</p>



<a name="133127036"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353178%20optimize%20SCC%20computation/near/133127036" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wesley Wiser <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353178.20optimize.20SCC.20computation.html#133127036">(Aug 31 2018 at 14:21)</a>:</h4>
<p>I'm kind of wondering if <a href="https://github.com/rust-lang/rust/pull/53327#discussion_r212932575" target="_blank" title="https://github.com/rust-lang/rust/pull/53327#discussion_r212932575">this comment</a> you made is more significant than we thought:</p>
<blockquote>
<p>I mean, to be strictly consistent, we would basically add an "extra" static constraint to every region in a reverse graph, but it wouldn't actually matter to any of the consumers.</p>
</blockquote>
<p>Maybe it does matter and we need to be doing that?</p>



<a name="133127044"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353178%20optimize%20SCC%20computation/near/133127044" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wesley Wiser <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353178.20optimize.20SCC.20computation.html#133127044">(Aug 31 2018 at 14:21)</a>:</h4>
<p>That's just a guess though</p>



<a name="133127085"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353178%20optimize%20SCC%20computation/near/133127085" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353178.20optimize.20SCC.20computation.html#133127085">(Aug 31 2018 at 14:22)</a>:</h4>
<p>I can't see how</p>



<a name="133127089"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353178%20optimize%20SCC%20computation/near/133127089" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353178.20optimize.20SCC.20computation.html#133127089">(Aug 31 2018 at 14:22)</a>:</h4>
<p>the reverse graph is used in just one place</p>



<a name="133127091"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353178%20optimize%20SCC%20computation/near/133127091" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353178.20optimize.20SCC.20computation.html#133127091">(Aug 31 2018 at 14:22)</a>:</h4>
<p>which is to avoid computing liveness</p>



<a name="133127106"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353178%20optimize%20SCC%20computation/near/133127106" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353178.20optimize.20SCC.20computation.html#133127106">(Aug 31 2018 at 14:22)</a>:</h4>
<p>I don't think it is used in the error reporting code at all</p>



<a name="133127112"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353178%20optimize%20SCC%20computation/near/133127112" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353178.20optimize.20SCC.20computation.html#133127112">(Aug 31 2018 at 14:22)</a>:</h4>
<p>but .. I may be overlooking something :)</p>



<a name="133127134"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353178%20optimize%20SCC%20computation/near/133127134" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wesley Wiser <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353178.20optimize.20SCC.20computation.html#133127134">(Aug 31 2018 at 14:23)</a>:</h4>
<p>It's not used by <code>universal_regions_outlived_by()</code> or <code>universal_region_relations .outlives()</code>?</p>



<a name="133127140"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353178%20optimize%20SCC%20computation/near/133127140" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wesley Wiser <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353178.20optimize.20SCC.20computation.html#133127140">(Aug 31 2018 at 14:24)</a>:</h4>
<p>(I don't know, just wondering)</p>



<a name="133127208"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353178%20optimize%20SCC%20computation/near/133127208" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353178.20optimize.20SCC.20computation.html#133127208">(Aug 31 2018 at 14:25)</a>:</h4>
<p>it is not</p>



<a name="133127211"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353178%20optimize%20SCC%20computation/near/133127211" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wesley Wiser <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353178.20optimize.20SCC.20computation.html#133127211">(Aug 31 2018 at 14:25)</a>:</h4>
<p>On a side note, is there documentation for the NLL borrow checker somewhere? I tried looking in the rustc-guide when I started working on this but I didn't see anything there.</p>



<a name="133127214"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353178%20optimize%20SCC%20computation/near/133127214" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wesley Wiser <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353178.20optimize.20SCC.20computation.html#133127214">(Aug 31 2018 at 14:25)</a>:</h4>
<p>gotcha</p>



<a name="133127219"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353178%20optimize%20SCC%20computation/near/133127219" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353178.20optimize.20SCC.20computation.html#133127219">(Aug 31 2018 at 14:25)</a>:</h4>
<p>not really. I'm working actually literally this second on writing more docs...</p>



<a name="133127220"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353178%20optimize%20SCC%20computation/near/133127220" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wesley Wiser <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353178.20optimize.20SCC.20computation.html#133127220">(Aug 31 2018 at 14:25)</a>:</h4>
<p>I can read the code and see what it's doing but I have no idea why...</p>



<a name="133127221"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353178%20optimize%20SCC%20computation/near/133127221" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353178.20optimize.20SCC.20computation.html#133127221">(Aug 31 2018 at 14:25)</a>:</h4>
<p>...but there is a lot to document :)</p>



<a name="133127223"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353178%20optimize%20SCC%20computation/near/133127223" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wesley Wiser <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353178.20optimize.20SCC.20computation.html#133127223">(Aug 31 2018 at 14:25)</a>:</h4>
<p>Ah <span class="emoji emoji-1f44d" title="thumbs up">:thumbs_up:</span> <span class="emoji emoji-1f44d" title="thumbs up">:thumbs_up:</span></p>



<a name="133127224"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353178%20optimize%20SCC%20computation/near/133127224" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353178.20optimize.20SCC.20computation.html#133127224">(Aug 31 2018 at 14:25)</a>:</h4>
<p>there are docs scattered throughout the code</p>



<a name="133127299"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353178%20optimize%20SCC%20computation/near/133127299" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353178.20optimize.20SCC.20computation.html#133127299">(Aug 31 2018 at 14:27)</a>:</h4>
<p>of course writing docs just makes me want to refactor everything :P</p>



<a name="133127366"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353178%20optimize%20SCC%20computation/near/133127366" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wesley Wiser <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353178.20optimize.20SCC.20computation.html#133127366">(Aug 31 2018 at 14:28)</a>:</h4>
<p>The eternal struggle</p>



<a name="133127502"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353178%20optimize%20SCC%20computation/near/133127502" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wesley Wiser <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353178.20optimize.20SCC.20computation.html#133127502">(Aug 31 2018 at 14:30)</a>:</h4>
<p>If you jot down what you want refactored, I'd be happy to work on that after we get this issue resolved :)<br>
I love refactoring :ferris:</p>



<a name="133129419"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353178%20optimize%20SCC%20computation/near/133129419" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353178.20optimize.20SCC.20computation.html#133129419">(Aug 31 2018 at 15:06)</a>:</h4>
<p>woohoo :)</p>



<a name="133129422"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353178%20optimize%20SCC%20computation/near/133129422" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353178.20optimize.20SCC.20computation.html#133129422">(Aug 31 2018 at 15:06)</a>:</h4>
<p>the challenge here is not knowing <em>precisely</em> what I want</p>



<a name="133129424"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353178%20optimize%20SCC%20computation/near/133129424" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353178.20optimize.20SCC.20computation.html#133129424">(Aug 31 2018 at 15:06)</a>:</h4>
<p>just knowing we ain't got it ;)</p>



<a name="133129429"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353178%20optimize%20SCC%20computation/near/133129429" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353178.20optimize.20SCC.20computation.html#133129429">(Aug 31 2018 at 15:06)</a>:</h4>
<p>but I am starting to get some ideas</p>



<a name="133129767"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353178%20optimize%20SCC%20computation/near/133129767" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wesley Wiser <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353178.20optimize.20SCC.20computation.html#133129767">(Aug 31 2018 at 15:12)</a>:</h4>
<p>Sounds good!</p>



<a name="133330726"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353178%20optimize%20SCC%20computation/near/133330726" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wesley Wiser <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353178.20optimize.20SCC.20computation.html#133330726">(Sep 04 2018 at 19:19)</a>:</h4>
<p>Hey <span class="user-mention" data-user-id="116009">@nikomatsakis</span> did you happen to get a chance to look at this? I'm stuck and could use a nudge in the right direction :)</p>



<a name="133332663"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353178%20optimize%20SCC%20computation/near/133332663" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353178.20optimize.20SCC.20computation.html#133332663">(Sep 04 2018 at 19:55)</a>:</h4>
<p>not yet sorry</p>



<a name="133332711"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353178%20optimize%20SCC%20computation/near/133332711" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353178.20optimize.20SCC.20computation.html#133332711">(Sep 04 2018 at 19:56)</a>:</h4>
<p>will do</p>



<a name="133332740"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353178%20optimize%20SCC%20computation/near/133332740" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wesley Wiser <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353178.20optimize.20SCC.20computation.html#133332740">(Sep 04 2018 at 19:56)</a>:</h4>
<p>No worries :)</p>



<a name="133442184"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353178%20optimize%20SCC%20computation/near/133442184" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wesley Wiser <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353178.20optimize.20SCC.20computation.html#133442184">(Sep 06 2018 at 13:35)</a>:</h4>
<p><span class="user-mention" data-user-id="116009">@nikomatsakis</span> I left a comment on the pr <a href="https://github.com/rust-lang/rust/pull/53327/commits/fea4b44b26321a86dc3d2337f50c941577f1ef1d#r215626513" target="_blank" title="https://github.com/rust-lang/rust/pull/53327/commits/fea4b44b26321a86dc3d2337f50c941577f1ef1d#r215626513">here</a> with a thought I had about the failing tests.</p>



<a name="133446493"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353178%20optimize%20SCC%20computation/near/133446493" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353178.20optimize.20SCC.20computation.html#133446493">(Sep 06 2018 at 14:39)</a>:</h4>
<p>replied</p>



<a name="133450296"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353178%20optimize%20SCC%20computation/near/133450296" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wesley Wiser <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353178.20optimize.20SCC.20computation.html#133450296">(Sep 06 2018 at 15:34)</a>:</h4>
<p><span class="user-mention" data-user-id="116009">@nikomatsakis</span> Did you reply on GH? I'm not seeing it <span class="emoji emoji-1f62c" title="grimacing">:grimacing:</span></p>



<a name="133450834"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353178%20optimize%20SCC%20computation/near/133450834" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353178.20optimize.20SCC.20computation.html#133450834">(Sep 06 2018 at 15:44)</a>:</h4>
<p>I thought I did</p>



<a name="133450844"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353178%20optimize%20SCC%20computation/near/133450844" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353178.20optimize.20SCC.20computation.html#133450844">(Sep 06 2018 at 15:44)</a>:</h4>
<p>tl;dr I thought that code is correct</p>



<a name="133450851"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353178%20optimize%20SCC%20computation/near/133450851" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353178.20optimize.20SCC.20computation.html#133450851">(Sep 06 2018 at 15:44)</a>:</h4>
<p>let me investigate a bit the problem...</p>



<a name="133454117"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353178%20optimize%20SCC%20computation/near/133454117" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353178.20optimize.20SCC.20computation.html#133454117">(Sep 06 2018 at 16:40)</a>:</h4>
<p><span class="user-mention" data-user-id="125250">@Wesley Wiser</span> ok I found the problem. It was indeed obscure. =)</p>



<a name="133454121"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353178%20optimize%20SCC%20computation/near/133454121" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353178.20optimize.20SCC.20computation.html#133454121">(Sep 06 2018 at 16:40)</a>:</h4>
<p>will push a fix shortly</p>



<a name="133454127"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353178%20optimize%20SCC%20computation/near/133454127" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353178.20optimize.20SCC.20computation.html#133454127">(Sep 06 2018 at 16:40)</a>:</h4>
<p>running <code>--bless</code> right now</p>



<a name="133454131"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353178%20optimize%20SCC%20computation/near/133454131" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wesley Wiser <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353178.20optimize.20SCC.20computation.html#133454131">(Sep 06 2018 at 16:40)</a>:</h4>
<p>Woohoo!</p>



<a name="133454133"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353178%20optimize%20SCC%20computation/near/133454133" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wesley Wiser <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353178.20optimize.20SCC.20computation.html#133454133">(Sep 06 2018 at 16:40)</a>:</h4>
<p>I'm reading through your comments now</p>



<a name="133454147"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353178%20optimize%20SCC%20computation/near/133454147" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wesley Wiser <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353178.20optimize.20SCC.20computation.html#133454147">(Sep 06 2018 at 16:41)</a>:</h4>
<p>Very interested to see how this plays out...</p>



<a name="133454301"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353178%20optimize%20SCC%20computation/near/133454301" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353178.20optimize.20SCC.20computation.html#133454301">(Sep 06 2018 at 16:45)</a>:</h4>
<p>it's one of those bugs that is at once exciting and yet dull as can be :P</p>



<a name="133454504"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353178%20optimize%20SCC%20computation/near/133454504" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353178.20optimize.20SCC.20computation.html#133454504">(Sep 06 2018 at 16:49)</a>:</h4>
<p>pushed</p>



<a name="133454508"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353178%20optimize%20SCC%20computation/near/133454508" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353178.20optimize.20SCC.20computation.html#133454508">(Sep 06 2018 at 16:49)</a>:</h4>
<p>final commit is the actual fix</p>



<a name="133454585"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353178%20optimize%20SCC%20computation/near/133454585" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wesley Wiser <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353178.20optimize.20SCC.20computation.html#133454585">(Sep 06 2018 at 16:50)</a>:</h4>
<p>/me reads</p>



<a name="133454801"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353178%20optimize%20SCC%20computation/near/133454801" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wesley Wiser <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353178.20optimize.20SCC.20computation.html#133454801">(Sep 06 2018 at 16:54)</a>:</h4>
<p>I think that makes sense...<br>
"Late bound regions" is unfamiliar terminology to me.<br>
I guess I need to spend more time meditating on the <code>rustc-doc</code> texts.</p>



<a name="133454952"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353178%20optimize%20SCC%20computation/near/133454952" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wesley Wiser <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353178.20optimize.20SCC.20computation.html#133454952">(Sep 06 2018 at 16:57)</a>:</h4>
<p>Well that certainly fixes those bad error messages!</p>



<a name="133455049"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353178%20optimize%20SCC%20computation/near/133455049" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wesley Wiser <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353178.20optimize.20SCC.20computation.html#133455049">(Sep 06 2018 at 16:58)</a>:</h4>
<p>And there's a few new error messages that are actually really helpful like <a href="https://github.com/rust-lang/rust/pull/53327/files#diff-1758ea7405a14c722e3daea84599bb16R55" target="_blank" title="https://github.com/rust-lang/rust/pull/53327/files#diff-1758ea7405a14c722e3daea84599bb16R55">this one</a></p>



<a name="133455952"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353178%20optimize%20SCC%20computation/near/133455952" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353178.20optimize.20SCC.20computation.html#133455952">(Sep 06 2018 at 17:14)</a>:</h4>
<p>late-bound regions are one of the more obscure concepts in rustc</p>



<a name="133455954"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353178%20optimize%20SCC%20computation/near/133455954" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353178.20optimize.20SCC.20computation.html#133455954">(Sep 06 2018 at 17:14)</a>:</h4>
<p>I should write a rustc-guide chapter about them</p>



<a name="133455960"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353178%20optimize%20SCC%20computation/near/133455960" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353178.20optimize.20SCC.20computation.html#133455960">(Sep 06 2018 at 17:14)</a>:</h4>
<p>I hope someday to make them go away</p>



<a name="133456272"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353178%20optimize%20SCC%20computation/near/133456272" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wesley Wiser <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353178.20optimize.20SCC.20computation.html#133456272">(Sep 06 2018 at 17:20)</a>:</h4>
<p>Thanks for your help on this!</p>



<a name="133456294"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353178%20optimize%20SCC%20computation/near/133456294" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wesley Wiser <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353178.20optimize.20SCC.20computation.html#133456294">(Sep 06 2018 at 17:20)</a>:</h4>
<p>Out of curiosity, how did you go about debugging this? I tried a bunch of different things but nothing felt very effective to me.</p>



<a name="133456411"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353178%20optimize%20SCC%20computation/near/133456411" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353178.20optimize.20SCC.20computation.html#133456411">(Sep 06 2018 at 17:22)</a>:</h4>
<blockquote>
<p>Out of curiosity, how did you go about debugging this? I tried a bunch of different things but nothing felt very effective to me.</p>
</blockquote>
<p>well, first I tracked back why <code>give_region_a_name</code> was returning the value it did</p>



<a name="133456434"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353178%20optimize%20SCC%20computation/near/133456434" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353178.20optimize.20SCC.20computation.html#133456434">(Sep 06 2018 at 17:22)</a>:</h4>
<p>then I added various <code>debug!</code> statements (some of which I committed) to possible places that the <code>BrNamed</code> might have been generated</p>



<a name="133456443"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353178%20optimize%20SCC%20computation/near/133456443" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353178.20optimize.20SCC.20computation.html#133456443">(Sep 06 2018 at 17:23)</a>:</h4>
<p>and ran <code>RUST_LOG=rustc_typeck,rustc_mir rustc foo.rs &gt;&amp; killme</code> basically</p>



<a name="133456462"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353178%20optimize%20SCC%20computation/near/133456462" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353178.20optimize.20SCC.20computation.html#133456462">(Sep 06 2018 at 17:23)</a>:</h4>
<p>then I did a <code>grep</code> through that log for the troublesome <code>BrNamed</code> (actually <code>M-x occur</code> in emacs, but same diff)</p>



<a name="133456483"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353178%20optimize%20SCC%20computation/near/133456483" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353178.20optimize.20SCC.20computation.html#133456483">(Sep 06 2018 at 17:23)</a>:</h4>
<p>once I found where it started to appear, I could add more targeted debugging around that fn</p>



<a name="133456491"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353178%20optimize%20SCC%20computation/near/133456491" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353178.20optimize.20SCC.20computation.html#133456491">(Sep 06 2018 at 17:23)</a>:</h4>
<p>this technique -- dumping tons of data then grepping through the logs -- is something I do a lot</p>



<a name="133456539"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353178%20optimize%20SCC%20computation/near/133456539" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353178.20optimize.20SCC.20computation.html#133456539">(Sep 06 2018 at 17:24)</a>:</h4>
<p>works best if you have a small test case though :)</p>



<a name="133510667"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353178%20optimize%20SCC%20computation/near/133510667" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wesley Wiser <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353178.20optimize.20SCC.20computation.html#133510667">(Sep 07 2018 at 13:27)</a>:</h4>
<p>FYI, I rebased and fixed the tests</p>



<a name="133519526"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353178%20optimize%20SCC%20computation/near/133519526" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353178.20optimize.20SCC.20computation.html#133519526">(Sep 07 2018 at 15:43)</a>:</h4>
<p>ok, r+'d — we should think about how to fix the error messages maybe?</p>



<a name="133519529"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353178%20optimize%20SCC%20computation/near/133519529" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353178.20optimize.20SCC.20computation.html#133519529">(Sep 07 2018 at 15:43)</a>:</h4>
<p>(in separate PR)</p>



<a name="133519843"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353178%20optimize%20SCC%20computation/near/133519843" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wesley Wiser <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353178.20optimize.20SCC.20computation.html#133519843">(Sep 07 2018 at 15:49)</a>:</h4>
<p>You mean the extra errors? </p>
<p>Yeah, that's a good idea.</p>



<a name="133535279"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353178%20optimize%20SCC%20computation/near/133535279" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> lqd <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353178.20optimize.20SCC.20computation.html#133535279">(Sep 07 2018 at 20:30)</a>:</h4>
<p><span class="user-mention" data-user-id="125250">@Wesley Wiser</span> yay it landed, awesome job :)</p>



<a name="133536212"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353178%20optimize%20SCC%20computation/near/133536212" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wesley Wiser <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353178.20optimize.20SCC.20computation.html#133536212">(Sep 07 2018 at 20:46)</a>:</h4>
<p><span class="user-mention" data-user-id="116113">@lqd</span>  Thanks!</p>



<hr><p>Last updated: Apr 12 2022 at 20:01 UTC</p>
</html>