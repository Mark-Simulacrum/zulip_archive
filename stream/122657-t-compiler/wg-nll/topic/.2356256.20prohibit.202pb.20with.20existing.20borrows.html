<html>
<head><meta charset="utf-8"><title>#56256 prohibit 2pb with existing borrows · t-compiler/wg-nll · Zulip Chat Archive</title></head>
<h2>Stream: <a href="https://rust-lang.github.io/zulip_archive/stream/122657-t-compiler/wg-nll/index.html">t-compiler/wg-nll</a></h2>
<h3>Topic: <a href="https://rust-lang.github.io/zulip_archive/stream/122657-t-compiler/wg-nll/topic/.2356256.20prohibit.202pb.20with.20existing.20borrows.html">#56256 prohibit 2pb with existing borrows</a></h3>

<hr>

<base href="https://rust-lang.zulipchat.com">

<head><link href="https://rust-lang.github.io/zulip_archive/style.css" rel="stylesheet"></head>

<a name="154257991"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2356256%20prohibit%202pb%20with%20existing%20borrows/near/154257991" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://rust-lang.github.io/zulip_archive/stream/122657-t-compiler/wg-nll/topic/.2356256.20prohibit.202pb.20with.20existing.20borrows.html#154257991">(Jan 03 2019 at 18:46)</a>:</h4>
<p>So if I recall from the last time we discussed this, a first step that we could take was to remove the use of 2PB from within the match desugaring code, and replace it with some sort of special cast. (i.e., for a <code>ref mut</code> binding used in a guard, we create a value of <code>&amp;&amp;Foo</code> type and then cast that to <code>&amp;&amp;mut Foo</code>)</p>
<p><span class="user-mention" data-user-id="116118">@Matthew Jasper</span>, I recall you did some of the initial work pursuing these changes, do you have any interest in trying to do that refactoring?</p>
<p>If I understand correctly, it should be a "no-op" in terms of its effect on end-users -- i.e., the same set of code should be accepted, it would just be being accepted by relying on a "cast" instead of 2PB.</p>



<a name="154258032"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2356256%20prohibit%202pb%20with%20existing%20borrows/near/154258032" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://rust-lang.github.io/zulip_archive/stream/122657-t-compiler/wg-nll/topic/.2356256.20prohibit.202pb.20with.20existing.20borrows.html#154258032">(Jan 03 2019 at 18:47)</a>:</h4>
<p>I guess an important question is whether we plan to actually prohibit 2PB-with-pre-existing-borrows or not. But this seems like a first step we can take in either case. OTOH, if we don't plan to prohibit pre-existing borrows...</p>



<a name="154258037"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2356256%20prohibit%202pb%20with%20existing%20borrows/near/154258037" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://rust-lang.github.io/zulip_archive/stream/122657-t-compiler/wg-nll/topic/.2356256.20prohibit.202pb.20with.20existing.20borrows.html#154258037">(Jan 03 2019 at 18:47)</a>:</h4>
<p>ah I remember there were some comments I hadn't read yet</p>



<a name="154258852"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2356256%20prohibit%202pb%20with%20existing%20borrows/near/154258852" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://rust-lang.github.io/zulip_archive/stream/122657-t-compiler/wg-nll/topic/.2356256.20prohibit.202pb.20with.20existing.20borrows.html#154258852">(Jan 03 2019 at 18:59)</a>:</h4>
<p>(I guess one point is that I think that the idea of using a cast is not a bad idea regardless; it feels like sort of a "later" move in terms of code cleanliness. This case always a weird 2PB case since it was <em>never</em> activated.)</p>



<a name="154259100"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2356256%20prohibit%202pb%20with%20existing%20borrows/near/154259100" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Matthew Jasper <a href="https://rust-lang.github.io/zulip_archive/stream/122657-t-compiler/wg-nll/topic/.2356256.20prohibit.202pb.20with.20existing.20borrows.html#154259100">(Jan 03 2019 at 19:03)</a>:</h4>
<p>Yes, I was going to create a PR to change to a cast for matches, but then I realized that the "variable" in the match guard could have a subtype of the type of the variable in the arm and decided it would need more work or more thought.</p>



<a name="154259174"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2356256%20prohibit%202pb%20with%20existing%20borrows/near/154259174" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://rust-lang.github.io/zulip_archive/stream/122657-t-compiler/wg-nll/topic/.2356256.20prohibit.202pb.20with.20existing.20borrows.html#154259174">(Jan 03 2019 at 19:05)</a>:</h4>
<p>hmm, say more?</p>



<a name="154259184"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2356256%20prohibit%202pb%20with%20existing%20borrows/near/154259184" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://rust-lang.github.io/zulip_archive/stream/122657-t-compiler/wg-nll/topic/.2356256.20prohibit.202pb.20with.20existing.20borrows.html#154259184">(Jan 03 2019 at 19:05)</a>:</h4>
<p>do you have a specific example in mind?</p>



<a name="154259402"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2356256%20prohibit%202pb%20with%20existing%20borrows/near/154259402" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Matthew Jasper <a href="https://rust-lang.github.io/zulip_archive/stream/122657-t-compiler/wg-nll/topic/.2356256.20prohibit.202pb.20with.20existing.20borrows.html#154259402">(Jan 03 2019 at 19:08)</a>:</h4>
<div class="codehilite"><pre><span></span><span class="k">fn</span> <span class="nf">eq_types</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;</span><span class="p">(</span><span class="n">_</span>: <span class="kp">&amp;&amp;</span><span class="nc">mut</span><span class="w"> </span><span class="n">T</span><span class="p">,</span><span class="w"> </span><span class="n">_</span>: <span class="kp">&amp;</span><span class="nc">mut</span><span class="w"> </span><span class="n">T</span><span class="p">)</span><span class="w"></span>

<span class="kd">let</span><span class="w"> </span><span class="k">mut</span><span class="w"> </span><span class="n">x</span>: <span class="kp">&amp;</span><span class="nb">&#39;static</span><span class="w"> </span><span class="kt">i32</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">&amp;</span><span class="mi">0</span><span class="p">;</span><span class="w"></span>
<span class="k">match</span><span class="w"> </span><span class="n">x</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="k">ref</span><span class="w"> </span><span class="k">mut</span><span class="w"> </span><span class="n">z</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="n">eq_types</span><span class="p">(</span><span class="o">&amp;</span><span class="n">z</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="k">mut</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="p">(),</span><span class="w"> </span><span class="c1">// z: &amp;mut &amp;&#39;local i32 !?</span>
<span class="w">    </span><span class="n">_</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="p">(),</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>
</pre></div>


<p>It's not <em>unsafe</em>, just (somewhat) unexpected.</p>



<a name="154259892"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2356256%20prohibit%202pb%20with%20existing%20borrows/near/154259892" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://rust-lang.github.io/zulip_archive/stream/122657-t-compiler/wg-nll/topic/.2356256.20prohibit.202pb.20with.20existing.20borrows.html#154259892">(Jan 03 2019 at 19:15)</a>:</h4>
<p>so, let me see if I can say this explicitly:</p>
<ul>
<li>when desugaring the <code>ref mut z</code> for use in the guard, we would first create a <code>&amp;&amp;x</code>, so something of type <code>&amp;'a &amp;'b &amp;'static i32</code>, and assign that to some temporary. This temporary might have type <code>&amp;'c &amp;'d &amp;'e i32</code>, and the concern then is that <code>'e</code> is never forced to be equal to <code>'static</code>?</li>
</ul>



<a name="154259954"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2356256%20prohibit%202pb%20with%20existing%20borrows/near/154259954" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://rust-lang.github.io/zulip_archive/stream/122657-t-compiler/wg-nll/topic/.2356256.20prohibit.202pb.20with.20existing.20borrows.html#154259954">(Jan 03 2019 at 19:16)</a>:</h4>
<p>seems true. we could force the issue but it'd be a bit awkward</p>



<a name="154259974"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2356256%20prohibit%202pb%20with%20existing%20borrows/near/154259974" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://rust-lang.github.io/zulip_archive/stream/122657-t-compiler/wg-nll/topic/.2356256.20prohibit.202pb.20with.20existing.20borrows.html#154259974">(Jan 03 2019 at 19:16)</a>:</h4>
<p>e.g., that cast that converts the <code>&amp;&amp;&amp;i32</code> to a <code>&amp;&amp;mut &amp;i32</code> could conceivably take also the "place" that was originally borrowed, to equate the types</p>



<a name="154260538"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2356256%20prohibit%202pb%20with%20existing%20borrows/near/154260538" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://rust-lang.github.io/zulip_archive/stream/122657-t-compiler/wg-nll/topic/.2356256.20prohibit.202pb.20with.20existing.20borrows.html#154260538">(Jan 03 2019 at 19:24)</a>:</h4>
<p>seems true, though I'm not sure if I am worried about it</p>



<a name="154260672"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2356256%20prohibit%202pb%20with%20existing%20borrows/near/154260672" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Matthew Jasper <a href="https://rust-lang.github.io/zulip_archive/stream/122657-t-compiler/wg-nll/topic/.2356256.20prohibit.202pb.20with.20existing.20borrows.html#154260672">(Jan 03 2019 at 19:26)</a>:</h4>
<p>I would be surprised if it's noticed very often, but it is a difference compared to the current behaviour.</p>



<a name="154260720"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2356256%20prohibit%202pb%20with%20existing%20borrows/near/154260720" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Matthew Jasper <a href="https://rust-lang.github.io/zulip_archive/stream/122657-t-compiler/wg-nll/topic/.2356256.20prohibit.202pb.20with.20existing.20borrows.html#154260720">(Jan 03 2019 at 19:27)</a>:</h4>
<p>Anyway, I think I could get this implemented soon.</p>



<a name="154260813"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2356256%20prohibit%202pb%20with%20existing%20borrows/near/154260813" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://rust-lang.github.io/zulip_archive/stream/122657-t-compiler/wg-nll/topic/.2356256.20prohibit.202pb.20with.20existing.20borrows.html#154260813">(Jan 03 2019 at 19:28)</a>:</h4>
<p>that'd be great. Seems like we can decide whether/how to address the other problem once we have the outlines of the impl</p>



<a name="154430013"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2356256%20prohibit%202pb%20with%20existing%20borrows/near/154430013" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Matthew Jasper <a href="https://rust-lang.github.io/zulip_archive/stream/122657-t-compiler/wg-nll/topic/.2356256.20prohibit.202pb.20with.20existing.20borrows.html#154430013">(Jan 04 2019 at 19:17)</a>:</h4>
<p>OK, but this one which currently compiles on my branch is too far...</p>
<div class="codehilite"><pre><span></span><span class="k">fn</span> <span class="nf">main</span><span class="p">()</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="k">fn</span> <span class="nf">ref_to_static</span><span class="o">&lt;</span><span class="n">T</span>: <span class="nb">&#39;static</span><span class="o">&gt;</span><span class="p">(</span><span class="n">t</span>: <span class="kp">&amp;</span><span class="nc">T</span><span class="p">)</span><span class="w"> </span><span class="p">{}</span><span class="w"></span>
<span class="w">    </span><span class="k">match</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">        </span><span class="k">ref</span><span class="w"> </span><span class="k">mut</span><span class="w"> </span><span class="n">z</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="c1">// Apparently we try to promote per use</span>
<span class="w">            </span><span class="n">ref_to_static</span><span class="p">(</span><span class="o">&amp;</span><span class="n">z</span><span class="p">);</span><span class="w"></span>
<span class="w">            </span><span class="kc">false</span><span class="w"></span>
<span class="w">        </span><span class="p">}</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="p">(),</span><span class="w"></span>
<span class="w">        </span><span class="n">_</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="p">(),</span><span class="w"></span>
<span class="w">    </span><span class="p">}</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>
</pre></div>



<a name="154437682"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2356256%20prohibit%202pb%20with%20existing%20borrows/near/154437682" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Matthew Jasper <a href="https://rust-lang.github.io/zulip_archive/stream/122657-t-compiler/wg-nll/topic/.2356256.20prohibit.202pb.20with.20existing.20borrows.html#154437682">(Jan 04 2019 at 21:15)</a>:</h4>
<p>and this...</p>
<div class="codehilite"><pre><span></span><span class="k">fn</span> <span class="nf">bar</span><span class="p">()</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="k">match</span><span class="w"> </span><span class="o">&amp;</span><span class="mi">0</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">        </span><span class="o">&amp;</span><span class="k">ref</span><span class="w"> </span><span class="k">mut</span><span class="w"> </span><span class="n">z</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="k">return</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="p">(),</span><span class="w"></span>
<span class="w">        </span><span class="n">_</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="p">(),</span><span class="w"></span>
<span class="w">    </span><span class="p">}</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>
</pre></div>



<a name="154441084"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2356256%20prohibit%202pb%20with%20existing%20borrows/near/154441084" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://rust-lang.github.io/zulip_archive/stream/122657-t-compiler/wg-nll/topic/.2356256.20prohibit.202pb.20with.20existing.20borrows.html#154441084">(Jan 04 2019 at 22:06)</a>:</h4>
<p>so, <code>&amp;0</code> <em>has</em> static lifetime..</p>



<a name="154441105"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2356256%20prohibit%202pb%20with%20existing%20borrows/near/154441105" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://rust-lang.github.io/zulip_archive/stream/122657-t-compiler/wg-nll/topic/.2356256.20prohibit.202pb.20with.20existing.20borrows.html#154441105">(Jan 04 2019 at 22:06)</a>:</h4>
<p>ah, ok, I see</p>



<a name="154441108"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2356256%20prohibit%202pb%20with%20existing%20borrows/near/154441108" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://rust-lang.github.io/zulip_archive/stream/122657-t-compiler/wg-nll/topic/.2356256.20prohibit.202pb.20with.20existing.20borrows.html#154441108">(Jan 04 2019 at 22:06)</a>:</h4>
<p><code>ref mut z</code>, right :)</p>



<a name="154441148"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2356256%20prohibit%202pb%20with%20existing%20borrows/near/154441148" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://rust-lang.github.io/zulip_archive/stream/122657-t-compiler/wg-nll/topic/.2356256.20prohibit.202pb.20with.20existing.20borrows.html#154441148">(Jan 04 2019 at 22:07)</a>:</h4>
<p>hmm, so, one thing I was thinking about last night is whether we want this to be a distinct kind of borrow (ugh...)</p>



<a name="154441226"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2356256%20prohibit%202pb%20with%20existing%20borrows/near/154441226" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://rust-lang.github.io/zulip_archive/stream/122657-t-compiler/wg-nll/topic/.2356256.20prohibit.202pb.20with.20existing.20borrows.html#154441226">(Jan 04 2019 at 22:08)</a>:</h4>
<p>(though so long as the resulting type is <code>&amp;T</code>, I don't think it would solve the covariance issues)</p>



<a name="154441274"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2356256%20prohibit%202pb%20with%20existing%20borrows/near/154441274" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://rust-lang.github.io/zulip_archive/stream/122657-t-compiler/wg-nll/topic/.2356256.20prohibit.202pb.20with.20existing.20borrows.html#154441274">(Jan 04 2019 at 22:09)</a>:</h4>
<p>(I guess the point with the latter example is that the actual mutable borrow winds up being dead code?)</p>



<a name="154445036"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2356256%20prohibit%202pb%20with%20existing%20borrows/near/154445036" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Matthew Jasper <a href="https://rust-lang.github.io/zulip_archive/stream/122657-t-compiler/wg-nll/topic/.2356256.20prohibit.202pb.20with.20existing.20borrows.html#154445036">(Jan 04 2019 at 23:15)</a>:</h4>
<p>Indeed.</p>



<a name="154445179"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2356256%20prohibit%202pb%20with%20existing%20borrows/near/154445179" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Matthew Jasper <a href="https://rust-lang.github.io/zulip_archive/stream/122657-t-compiler/wg-nll/topic/.2356256.20prohibit.202pb.20with.20existing.20borrows.html#154445179">(Jan 04 2019 at 23:17)</a>:</h4>
<blockquote>
<p>hmm, so, one thing I was thinking about last night is whether we want this to be a distinct kind of borrow (ugh...)</p>
</blockquote>
<p>This is the best thing I've thought of for now, but it's definitely not great.</p>



<a name="154577864"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2356256%20prohibit%202pb%20with%20existing%20borrows/near/154577864" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://rust-lang.github.io/zulip_archive/stream/122657-t-compiler/wg-nll/topic/.2356256.20prohibit.202pb.20with.20existing.20borrows.html#154577864">(Jan 07 2019 at 15:43)</a>:</h4>
<p><span class="user-mention" data-user-id="116118">@Matthew Jasper</span> I'm trying to decide what I think about those examples being accepted. I feel like it's not <em>horrible</em> if they are -- I recall us talking about how much to expose the "desugaring" of bindings in guards before, and I continue to think that it's reasonable to expose to people (in extreme cases...) that bindings in a guard are actually shared borrows "at heart". But I'm wondering, do you remember when this came up before exactly and what we did then?</p>



<a name="154586222"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2356256%20prohibit%202pb%20with%20existing%20borrows/near/154586222" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Matthew Jasper <a href="https://rust-lang.github.io/zulip_archive/stream/122657-t-compiler/wg-nll/topic/.2356256.20prohibit.202pb.20with.20existing.20borrows.html#154586222">(Jan 07 2019 at 17:44)</a>:</h4>
<p>This has come up previously in this thread, and the decision that the strangeness was ok.</p>



<a name="154586317"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2356256%20prohibit%202pb%20with%20existing%20borrows/near/154586317" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Matthew Jasper <a href="https://rust-lang.github.io/zulip_archive/stream/122657-t-compiler/wg-nll/topic/.2356256.20prohibit.202pb.20with.20existing.20borrows.html#154586317">(Jan 07 2019 at 17:46)</a>:</h4>
<p>The issue was that the reference in the guard would alias the reference in being matched on and both could be used.</p>



<a name="154601991"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2356256%20prohibit%202pb%20with%20existing%20borrows/near/154601991" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Matthew Jasper <a href="https://rust-lang.github.io/zulip_archive/stream/122657-t-compiler/wg-nll/topic/.2356256.20prohibit.202pb.20with.20existing.20borrows.html#154601991">(Jan 07 2019 at 21:19)</a>:</h4>
<p>Specifically, this</p>
<div class="codehilite"><pre><span></span><span class="k">use</span><span class="w"> </span><span class="n">std</span>::<span class="n">ptr</span><span class="p">;</span><span class="w"></span>

<span class="k">fn</span> <span class="nf">main</span><span class="p">()</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="n">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">&amp;</span><span class="k">mut</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"></span>
<span class="w">    </span><span class="k">match</span><span class="w"> </span><span class="n">x</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">        </span><span class="o">&amp;</span><span class="k">mut</span><span class="w"> </span><span class="k">ref</span><span class="w"> </span><span class="k">mut</span><span class="w"> </span><span class="n">z</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="o">!</span><span class="n">ptr</span>::<span class="n">eq</span><span class="p">(</span><span class="o">&amp;</span><span class="n">z</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">x</span><span class="p">)</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="n">ptr</span>::<span class="n">eq</span><span class="p">(</span><span class="n">z</span><span class="p">,</span><span class="w"> </span><span class="n">x</span><span class="p">)</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="n">println</span><span class="o">!</span><span class="p">(</span><span class="s">&quot;aliasing mutable references?&quot;</span><span class="p">),</span><span class="w"></span>
<span class="w">        </span><span class="n">_</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="p">(),</span><span class="w"></span>
<span class="w">    </span><span class="p">}</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>
</pre></div>



<a name="154602237"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2356256%20prohibit%202pb%20with%20existing%20borrows/near/154602237" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Matthew Jasper <a href="https://rust-lang.github.io/zulip_archive/stream/122657-t-compiler/wg-nll/topic/.2356256.20prohibit.202pb.20with.20existing.20borrows.html#154602237">(Jan 07 2019 at 21:22)</a>:</h4>
<p>The only really bad issue we would have with a naive lowering is the promotion issue, but this seems like it's a bug in the promotion code</p>
<div class="codehilite"><pre><span></span><span class="k">fn</span> <span class="nf">main</span><span class="p">()</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="n">y</span>: <span class="o">*</span><span class="k">const</span><span class="w"> </span><span class="kt">i32</span><span class="p">;</span><span class="w"></span>
<span class="w">    </span><span class="k">match</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">        </span><span class="k">ref</span><span class="w"> </span><span class="k">mut</span><span class="w"> </span><span class="n">z</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">z</span><span class="p">;</span><span class="w"> </span><span class="kc">true</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="n">assert_eq</span><span class="o">!</span><span class="p">(</span><span class="n">y</span><span class="p">,</span><span class="w"> </span><span class="n">z</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="o">*</span><span class="k">const</span><span class="w"> </span><span class="n">_</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;???&quot;</span><span class="p">),</span><span class="w"></span>
<span class="w">        </span><span class="n">_</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="p">(),</span><span class="w"></span>
<span class="w">    </span><span class="p">}</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>
</pre></div>



<a name="154602387"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2356256%20prohibit%202pb%20with%20existing%20borrows/near/154602387" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Matthew Jasper <a href="https://rust-lang.github.io/zulip_archive/stream/122657-t-compiler/wg-nll/topic/.2356256.20prohibit.202pb.20with.20existing.20borrows.html#154602387">(Jan 07 2019 at 21:25)</a>:</h4>
<p>Notably the assert doesn't fire here (because the <code>Context</code> is a mutating projection, not a mutable borrow)</p>
<div class="codehilite"><pre><span></span><span class="k">fn</span> <span class="nf">main</span><span class="p">()</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="n">y</span>: <span class="o">*</span><span class="k">const</span><span class="w"> </span><span class="kt">i32</span><span class="p">;</span><span class="w"></span>
<span class="w">    </span><span class="k">match</span><span class="w"> </span><span class="p">(</span><span class="mi">0</span><span class="p">,)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">        </span><span class="p">(</span><span class="k">ref</span><span class="w"> </span><span class="k">mut</span><span class="w"> </span><span class="n">z</span><span class="p">,)</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">z</span><span class="p">;</span><span class="w"> </span><span class="kc">true</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="n">assert_eq</span><span class="o">!</span><span class="p">(</span><span class="n">y</span><span class="p">,</span><span class="w"> </span><span class="n">z</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="o">*</span><span class="k">const</span><span class="w"> </span><span class="n">_</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;???&quot;</span><span class="p">),</span><span class="w"></span>
<span class="w">        </span><span class="n">_</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="p">(),</span><span class="w"></span>
<span class="w">    </span><span class="p">}</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>
</pre></div>



<a name="154603149"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2356256%20prohibit%202pb%20with%20existing%20borrows/near/154603149" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://rust-lang.github.io/zulip_archive/stream/122657-t-compiler/wg-nll/topic/.2356256.20prohibit.202pb.20with.20existing.20borrows.html#154603149">(Jan 07 2019 at 21:35)</a>:</h4>
<p>(I think, on a related note, that you can observe that <code>&amp;z</code> changes in the guard, but that is also true today)</p>



<a name="155122206"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2356256%20prohibit%202pb%20with%20existing%20borrows/near/155122206" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Matthew Jasper <a href="https://rust-lang.github.io/zulip_archive/stream/122657-t-compiler/wg-nll/topic/.2356256.20prohibit.202pb.20with.20existing.20borrows.html#155122206">(Jan 14 2019 at 21:47)</a>:</h4>
<p>So, I've tried a different approach that takes the naive match lowering and works around it to add the required fake borrows. I'm hoping that the rarity of <code>ref mut x if ...</code> means that no one has written code that it would break (neither the compiler, nor any of its tests, contain such code).</p>



<a name="155122211"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2356256%20prohibit%202pb%20with%20existing%20borrows/near/155122211" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Matthew Jasper <a href="https://rust-lang.github.io/zulip_archive/stream/122657-t-compiler/wg-nll/topic/.2356256.20prohibit.202pb.20with.20existing.20borrows.html#155122211">(Jan 14 2019 at 21:47)</a>:</h4>
<p>If someone has then it can be changed to use (either kind of) two-phase borrows, using the same migration warnings as for other two-phase borrows.</p>



<a name="155206474"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2356256%20prohibit%202pb%20with%20existing%20borrows/near/155206474" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://rust-lang.github.io/zulip_archive/stream/122657-t-compiler/wg-nll/topic/.2356256.20prohibit.202pb.20with.20existing.20borrows.html#155206474">(Jan 15 2019 at 21:34)</a>:</h4>
<p><span class="user-mention" data-user-id="116118">@Matthew Jasper</span> this is part of your recent PR?</p>



<a name="155206652"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2356256%20prohibit%202pb%20with%20existing%20borrows/near/155206652" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Matthew Jasper <a href="https://rust-lang.github.io/zulip_archive/stream/122657-t-compiler/wg-nll/topic/.2356256.20prohibit.202pb.20with.20existing.20borrows.html#155206652">(Jan 15 2019 at 21:36)</a>:</h4>
<p>This is what the recent PR is for, it's waiting on crater to see if the "real mutable borrows" approach is possible.</p>



<a name="155206663"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2356256%20prohibit%202pb%20with%20existing%20borrows/near/155206663" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://rust-lang.github.io/zulip_archive/stream/122657-t-compiler/wg-nll/topic/.2356256.20prohibit.202pb.20with.20existing.20borrows.html#155206663">(Jan 15 2019 at 21:37)</a>:</h4>
<p>I haven't had a chance to read it yet</p>



<a name="155206678"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2356256%20prohibit%202pb%20with%20existing%20borrows/near/155206678" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://rust-lang.github.io/zulip_archive/stream/122657-t-compiler/wg-nll/topic/.2356256.20prohibit.202pb.20with.20existing.20borrows.html#155206678">(Jan 15 2019 at 21:37)</a>:</h4>
<p>so I'm not quite sure what "real mutable borrows" means exactly :)</p>



<a name="155206690"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2356256%20prohibit%202pb%20with%20existing%20borrows/near/155206690" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://rust-lang.github.io/zulip_archive/stream/122657-t-compiler/wg-nll/topic/.2356256.20prohibit.202pb.20with.20existing.20borrows.html#155206690">(Jan 15 2019 at 21:37)</a>:</h4>
<p>I think the reason we didn't do that before was because it would have conflicted with the borrows of the thing we are matching <em>against</em></p>



<a name="155206701"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2356256%20prohibit%202pb%20with%20existing%20borrows/near/155206701" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://rust-lang.github.io/zulip_archive/stream/122657-t-compiler/wg-nll/topic/.2356256.20prohibit.202pb.20with.20existing.20borrows.html#155206701">(Jan 15 2019 at 21:37)</a>:</h4>
<p>but I guess that is what you changed, something in how we do <em>those</em> borrows?</p>



<a name="155206792"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2356256%20prohibit%202pb%20with%20existing%20borrows/near/155206792" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Matthew Jasper <a href="https://rust-lang.github.io/zulip_archive/stream/122657-t-compiler/wg-nll/topic/.2356256.20prohibit.202pb.20with.20existing.20borrows.html#155206792">(Jan 15 2019 at 21:38)</a>:</h4>
<p>Yes, the idea (in either version) is that we can assign the fake borrows again at the start of any match guard to avoid conflicting with the borrow access from the <code>ref mut</code>.</p>



<a name="155206838"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2356256%20prohibit%202pb%20with%20existing%20borrows/near/155206838" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Matthew Jasper <a href="https://rust-lang.github.io/zulip_archive/stream/122657-t-compiler/wg-nll/topic/.2356256.20prohibit.202pb.20with.20existing.20borrows.html#155206838">(Jan 15 2019 at 21:39)</a>:</h4>
<p>Then either some changes to fake borrows, or (minimal) two-phase borrows ensure that there's no conflict with the borrow from <code>ref mut</code>.</p>



<a name="155257395"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2356256%20prohibit%202pb%20with%20existing%20borrows/near/155257395" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://rust-lang.github.io/zulip_archive/stream/122657-t-compiler/wg-nll/topic/.2356256.20prohibit.202pb.20with.20existing.20borrows.html#155257395">(Jan 16 2019 at 14:30)</a>:</h4>
<p><span class="user-mention" data-user-id="116118">@Matthew Jasper</span> are you around now by any chance? I'm skimming over your PR now</p>



<a name="155257429"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2356256%20prohibit%202pb%20with%20existing%20borrows/near/155257429" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://rust-lang.github.io/zulip_archive/stream/122657-t-compiler/wg-nll/topic/.2356256.20prohibit.202pb.20with.20existing.20borrows.html#155257429">(Jan 16 2019 at 14:31)</a>:</h4>
<p>(and I had a question or two)</p>



<a name="155258743"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2356256%20prohibit%202pb%20with%20existing%20borrows/near/155258743" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://rust-lang.github.io/zulip_archive/stream/122657-t-compiler/wg-nll/topic/.2356256.20prohibit.202pb.20with.20existing.20borrows.html#155258743">(Jan 16 2019 at 14:47)</a>:</h4>
<p>I think it would be helpful to show the desugared form for some simple example</p>



<a name="155273154"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2356256%20prohibit%202pb%20with%20existing%20borrows/near/155273154" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Matthew Jasper <a href="https://rust-lang.github.io/zulip_archive/stream/122657-t-compiler/wg-nll/topic/.2356256.20prohibit.202pb.20with.20existing.20borrows.html#155273154">(Jan 16 2019 at 17:52)</a>:</h4>
<p>I'll try to writeup some notes on this soon</p>



<a name="155273533"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2356256%20prohibit%202pb%20with%20existing%20borrows/near/155273533" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://rust-lang.github.io/zulip_archive/stream/122657-t-compiler/wg-nll/topic/.2356256.20prohibit.202pb.20with.20existing.20borrows.html#155273533">(Jan 16 2019 at 17:58)</a>:</h4>
<p>thanks -- I read the diff but I'm not sure I "got it" yet</p>



<a name="155273535"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2356256%20prohibit%202pb%20with%20existing%20borrows/near/155273535" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://rust-lang.github.io/zulip_archive/stream/122657-t-compiler/wg-nll/topic/.2356256.20prohibit.202pb.20with.20existing.20borrows.html#155273535">(Jan 16 2019 at 17:58)</a>:</h4>
<p>I might have to re-read :)</p>



<a name="155287777"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2356256%20prohibit%202pb%20with%20existing%20borrows/near/155287777" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://rust-lang.github.io/zulip_archive/stream/122657-t-compiler/wg-nll/topic/.2356256.20prohibit.202pb.20with.20existing.20borrows.html#155287777">(Jan 16 2019 at 20:59)</a>:</h4>
<p>Link to <a href="https://github.com/rust-lang/rust/pull/57609#issuecomment-454922025" target="_blank" title="https://github.com/rust-lang/rust/pull/57609#issuecomment-454922025">summary comment</a>, for convenience =)</p>



<a name="157055023"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2356256%20prohibit%202pb%20with%20existing%20borrows/near/157055023" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://rust-lang.github.io/zulip_archive/stream/122657-t-compiler/wg-nll/topic/.2356256.20prohibit.202pb.20with.20existing.20borrows.html#157055023">(Jan 28 2019 at 20:30)</a>:</h4>
<p><span class="user-mention" data-user-id="116118">@Matthew Jasper</span> ok does <a href="https://github.com/rust-lang/rust/pull/57609#issuecomment-458288480" target="_blank" title="https://github.com/rust-lang/rust/pull/57609#issuecomment-458288480">this description</a> sound accurate?</p>



<a name="157418773"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2356256%20prohibit%202pb%20with%20existing%20borrows/near/157418773" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Matthew Jasper <a href="https://rust-lang.github.io/zulip_archive/stream/122657-t-compiler/wg-nll/topic/.2356256.20prohibit.202pb.20with.20existing.20borrows.html#157418773">(Feb 02 2019 at 10:59)</a>:</h4>
<p>Branch with the new match lowering for anyone interested: <a href="https://github.com/matthewjasper/rust/tree/cleanup-match-lowering" target="_blank" title="https://github.com/matthewjasper/rust/tree/cleanup-match-lowering">https://github.com/matthewjasper/rust/tree/cleanup-match-lowering</a></p>



<hr><p>Last updated: Aug 07 2021 at 22:04 UTC</p>
</html>