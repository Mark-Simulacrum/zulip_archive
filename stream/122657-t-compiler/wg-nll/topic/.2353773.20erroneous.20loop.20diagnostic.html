<html>
<head><meta charset="utf-8"><title>#53773 erroneous loop diagnostic · t-compiler/wg-nll · Zulip Chat Archive</title></head>
<h2>Stream: <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/index.html">t-compiler/wg-nll</a></h2>
<h3>Topic: <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353773.20erroneous.20loop.20diagnostic.html">#53773 erroneous loop diagnostic</a></h3>

<hr>

<base href="https://rust-lang.zulipchat.com">

<head><link href="https://zulip-archive.rust-lang.org/style.css" rel="stylesheet"></head>

<a name="147624706"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353773%20erroneous%20loop%20diagnostic/near/147624706" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353773.20erroneous.20loop.20diagnostic.html#147624706">(Nov 13 2018 at 20:56)</a>:</h4>
<p>Hi <span class="user-mention" data-user-id="116266">@Santiago Pastorino</span></p>



<a name="147624719"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353773%20erroneous%20loop%20diagnostic/near/147624719" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353773.20erroneous.20loop.20diagnostic.html#147624719">(Nov 13 2018 at 20:56)</a>:</h4>
<p>hi</p>



<a name="147624851"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353773%20erroneous%20loop%20diagnostic/near/147624851" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353773.20erroneous.20loop.20diagnostic.html#147624851">(Nov 13 2018 at 20:58)</a>:</h4>
<p>you may want to read <a href="https://github.com/rust-lang/rust/issues/54015#issuecomment-420427995" target="_blank" title="https://github.com/rust-lang/rust/issues/54015#issuecomment-420427995">this comment</a> that I wrote on <a href="https://github.com/rust-lang/rust/issues/54015" target="_blank" title="https://github.com/rust-lang/rust/issues/54015">#54015</a></p>



<a name="147624857"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353773%20erroneous%20loop%20diagnostic/near/147624857" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353773.20erroneous.20loop.20diagnostic.html#147624857">(Nov 13 2018 at 20:58)</a>:</h4>
<p>it explains how that code is working now</p>



<a name="147624872"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353773%20erroneous%20loop%20diagnostic/near/147624872" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353773.20erroneous.20loop.20diagnostic.html#147624872">(Nov 13 2018 at 20:58)</a>:</h4>
<p>I'm not sure why that did not fix <a href="https://github.com/rust-lang/rust/issues/53773" target="_blank" title="https://github.com/rust-lang/rust/issues/53773">#53773</a></p>



<a name="147624901"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353773%20erroneous%20loop%20diagnostic/near/147624901" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353773.20erroneous.20loop.20diagnostic.html#147624901">(Nov 13 2018 at 20:59)</a>:</h4>
<p><span class="emoji emoji-1f44d" title="+1">:+1:</span></p>



<a name="147624910"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353773%20erroneous%20loop%20diagnostic/near/147624910" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353773.20erroneous.20loop.20diagnostic.html#147624910">(Nov 13 2018 at 20:59)</a>:</h4>
<p>I will start with this probably tomorrow</p>



<a name="147677180"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353773%20erroneous%20loop%20diagnostic/near/147677180" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353773.20erroneous.20loop.20diagnostic.html#147677180">(Nov 14 2018 at 15:31)</a>:</h4>
<p>hey <span class="user-mention" data-user-id="116009">@nikomatsakis</span></p>



<a name="147677184"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353773%20erroneous%20loop%20diagnostic/near/147677184" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353773.20erroneous.20loop.20diagnostic.html#147677184">(Nov 14 2018 at 15:31)</a>:</h4>
<p>checking this out</p>



<a name="147677204"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353773%20erroneous%20loop%20diagnostic/near/147677204" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353773.20erroneous.20loop.20diagnostic.html#147677204">(Nov 14 2018 at 15:31)</a>:</h4>
<p>I see that the code compile without nll and doesn't compile with nll</p>



<a name="147677210"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353773%20erroneous%20loop%20diagnostic/near/147677210" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353773.20erroneous.20loop.20diagnostic.html#147677210">(Nov 14 2018 at 15:32)</a>:</h4>
<p>to start with, is that correct?</p>



<a name="147677532"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353773%20erroneous%20loop%20diagnostic/near/147677532" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353773.20erroneous.20loop.20diagnostic.html#147677532">(Nov 14 2018 at 15:36)</a>:</h4>
<p>I didn't notice that</p>



<a name="147677535"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353773%20erroneous%20loop%20diagnostic/near/147677535" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353773.20erroneous.20loop.20diagnostic.html#147677535">(Nov 14 2018 at 15:36)</a>:</h4>
<p>good question :)</p>



<a name="147677573"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353773%20erroneous%20loop%20diagnostic/near/147677573" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353773.20erroneous.20loop.20diagnostic.html#147677573">(Nov 14 2018 at 15:37)</a>:</h4>
<p>ah, yes, I think that's a case of NLL-fixed-by-NLL</p>



<a name="147677612"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353773%20erroneous%20loop%20diagnostic/near/147677612" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353773.20erroneous.20loop.20diagnostic.html#147677612">(Nov 14 2018 at 15:37)</a>:</h4>
<p>so, it shouldn't compile?</p>



<a name="147677658"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353773%20erroneous%20loop%20diagnostic/near/147677658" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353773.20erroneous.20loop.20diagnostic.html#147677658">(Nov 14 2018 at 15:38)</a>:</h4>
<p>I don't remember what's NLL-fixed-by-NLL :)</p>



<a name="147677677"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353773%20erroneous%20loop%20diagnostic/near/147677677" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353773.20erroneous.20loop.20diagnostic.html#147677677">(Nov 14 2018 at 15:38)</a>:</h4>
<p>thinking about the example :)</p>



<a name="147677827"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353773%20erroneous%20loop%20diagnostic/near/147677827" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353773.20erroneous.20loop.20diagnostic.html#147677827">(Nov 14 2018 at 15:40)</a>:</h4>
<p>point is, this is supposed to error</p>



<a name="147677879"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353773%20erroneous%20loop%20diagnostic/near/147677879" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353773.20erroneous.20loop.20diagnostic.html#147677879">(Nov 14 2018 at 15:40)</a>:</h4>
<p>yeah, I'm checking to figure out why</p>



<a name="147677934"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353773%20erroneous%20loop%20diagnostic/near/147677934" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353773.20erroneous.20loop.20diagnostic.html#147677934">(Nov 14 2018 at 15:41)</a>:</h4>
<p>I see this <code>impl&lt;'a&gt; Drop for C&lt;'a&gt; { fn drop(&amp;mut self) { } }</code> and I guess that's why the stuff is dropped</p>



<a name="147677947"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353773%20erroneous%20loop%20diagnostic/near/147677947" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353773.20erroneous.20loop.20diagnostic.html#147677947">(Nov 14 2018 at 15:41)</a>:</h4>
<p>but doesn't at that point you have references?</p>



<a name="147677958"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353773%20erroneous%20loop%20diagnostic/near/147677958" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353773.20erroneous.20loop.20diagnostic.html#147677958">(Nov 14 2018 at 15:41)</a>:</h4>
<p>and C is created before that function</p>



<a name="147677967"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353773%20erroneous%20loop%20diagnostic/near/147677967" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353773.20erroneous.20loop.20diagnostic.html#147677967">(Nov 14 2018 at 15:41)</a>:</h4>
<p>trying to see why a <code>C</code> is created inside <code>fn error</code></p>



<a name="147678026"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353773%20erroneous%20loop%20diagnostic/near/147678026" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353773.20erroneous.20loop.20diagnostic.html#147678026">(Nov 14 2018 at 15:42)</a>:</h4>
<blockquote>
<p>I see this <code>impl&lt;'a&gt; Drop for C&lt;'a&gt; { fn drop(&amp;mut self) { } }</code> and I guess that's why the stuff is dropped</p>
</blockquote>
<p>point is that we assume <code>Drop</code> might touch the stuff in <code>C</code></p>



<a name="147678027"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353773%20erroneous%20loop%20diagnostic/near/147678027" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353773.20erroneous.20loop.20diagnostic.html#147678027">(Nov 14 2018 at 15:42)</a>:</h4>
<p>ahhh</p>



<a name="147678029"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353773%20erroneous%20loop%20diagnostic/near/147678029" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353773.20erroneous.20loop.20diagnostic.html#147678029">(Nov 14 2018 at 15:42)</a>:</h4>
<p><code>    fn next(&amp;mut self) -&gt; Option&lt;C&lt;'a&gt;&gt; { panic!() }</code></p>



<a name="147678037"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353773%20erroneous%20loop%20diagnostic/near/147678037" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353773.20erroneous.20loop.20diagnostic.html#147678037">(Nov 14 2018 at 15:42)</a>:</h4>
<p>it's <code>C</code> there not <code>&amp;C</code></p>



<a name="147678062"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353773%20erroneous%20loop%20diagnostic/near/147678062" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353773.20erroneous.20loop.20diagnostic.html#147678062">(Nov 14 2018 at 15:43)</a>:</h4>
<p>the iterator returns an owned thing</p>



<a name="147678774"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353773%20erroneous%20loop%20diagnostic/near/147678774" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353773.20erroneous.20loop.20diagnostic.html#147678774">(Nov 14 2018 at 15:52)</a>:</h4>
<p>from the error ...</p>



<a name="147678777"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353773%20erroneous%20loop%20diagnostic/near/147678777" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353773.20erroneous.20loop.20diagnostic.html#147678777">(Nov 14 2018 at 15:52)</a>:</h4>
<div class="codehilite"><pre><span></span>   Compiling playground v0.0.1 (/playground)
error[E0713]: borrow may still be in use when destructor runs
  --&gt; src/main.rs:24:22
   |
24 |         members.push(child.raw);
   |                      ^^^^^^^^^
25 |     }
   |     - here, drop of `child` needs exclusive access to `*child.raw`, because the type `C&lt;&#39;_&gt;` implements the `Drop` trait
26 |     members.len();
   |     ------- borrow used here, in later iteration of loop

error: aborting due to previous error

For more information about this error, try `rustc --explain E0713`.
error: Could not compile `playground`.

To learn more, run the command again with --verbose.
</pre></div>



<a name="147678790"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353773%20erroneous%20loop%20diagnostic/near/147678790" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353773.20erroneous.20loop.20diagnostic.html#147678790">(Nov 14 2018 at 15:52)</a>:</h4>
<p>all we want is to remove <code>, in later iteration of loop</code>, right?</p>



<a name="147678862"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353773%20erroneous%20loop%20diagnostic/near/147678862" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353773.20erroneous.20loop.20diagnostic.html#147678862">(Nov 14 2018 at 15:53)</a>:</h4>
<p>and I also wonder if the error when you remove <code>member.len()</code> is right, which is ...</p>



<a name="147678866"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353773%20erroneous%20loop%20diagnostic/near/147678866" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353773.20erroneous.20loop.20diagnostic.html#147678866">(Nov 14 2018 at 15:54)</a>:</h4>
<div class="codehilite"><pre><span></span>   Compiling playground v0.0.1 (/playground)
error[E0713]: borrow may still be in use when destructor runs
  --&gt; src/main.rs:24:22
   |
24 |         members.push(child.raw);
   |         -------      ^^^^^^^^^
   |         |
   |         borrow used here, in later iteration of loop
25 |     }
   |     - here, drop of `child` needs exclusive access to `*child.raw`, because the type `C&lt;&#39;_&gt;` implements the `Drop` trait

error: aborting due to previous error

For more information about this error, try `rustc --explain E0713`.
error: Could not compile `playground`.

To learn more, run the command again with --verbose.
</pre></div>



<a name="147678916"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353773%20erroneous%20loop%20diagnostic/near/147678916" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353773.20erroneous.20loop.20diagnostic.html#147678916">(Nov 14 2018 at 15:54)</a>:</h4>
<p>I'm unsure what "in later iteration of the loop" means</p>



<a name="147682797"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353773%20erroneous%20loop%20diagnostic/near/147682797" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353773.20erroneous.20loop.20diagnostic.html#147682797">(Nov 14 2018 at 16:49)</a>:</h4>
<p>ah, so, I think I see the problem</p>



<a name="147682850"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353773%20erroneous%20loop%20diagnostic/near/147682850" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353773.20erroneous.20loop.20diagnostic.html#147682850">(Nov 14 2018 at 16:50)</a>:</h4>
<p>the existing code prints that message if the given point was reached via a loop backedge</p>



<a name="147682852"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353773%20erroneous%20loop%20diagnostic/near/147682852" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353773.20erroneous.20loop.20diagnostic.html#147682852">(Nov 14 2018 at 16:50)</a>:</h4>
<p>however</p>



<a name="147682859"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353773%20erroneous%20loop%20diagnostic/near/147682859" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353773.20erroneous.20loop.20diagnostic.html#147682859">(Nov 14 2018 at 16:50)</a>:</h4>
<p>what we want is to print the message if the given point is ONLY reachable via a loop backedge</p>



<a name="147682888"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353773%20erroneous%20loop%20diagnostic/near/147682888" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353773.20erroneous.20loop.20diagnostic.html#147682888">(Nov 14 2018 at 16:50)</a>:</h4>
<p>i.e., here, you could reach the <code>    members.len();</code> call after traversing the for loop</p>



<a name="147682891"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353773%20erroneous%20loop%20diagnostic/near/147682891" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353773.20erroneous.20loop.20diagnostic.html#147682891">(Nov 14 2018 at 16:50)</a>:</h4>
<p>but you might also ... not</p>



<a name="147682897"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353773%20erroneous%20loop%20diagnostic/near/147682897" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353773.20erroneous.20loop.20diagnostic.html#147682897">(Nov 14 2018 at 16:50)</a>:</h4>
<p>actually I wonder if.. hmm</p>



<a name="147682958"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353773%20erroneous%20loop%20diagnostic/near/147682958" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353773.20erroneous.20loop.20diagnostic.html#147682958">(Nov 14 2018 at 16:51)</a>:</h4>
<p>so ok maybe my formulation wasn't right</p>



<a name="147682959"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353773%20erroneous%20loop%20diagnostic/near/147682959" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353773.20erroneous.20loop.20diagnostic.html#147682959">(Nov 14 2018 at 16:51)</a>:</h4>
<p>but regardless the point is:</p>



<a name="147683028"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353773%20erroneous%20loop%20diagnostic/near/147683028" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353773.20erroneous.20loop.20diagnostic.html#147683028">(Nov 14 2018 at 16:52)</a>:</h4>
<p>the code is working "correctly" in some sense -- in order to reach the <code>members.len()</code> call, you have to pass through the loop backedge; the problem here is that the code in question is not "in the loop"</p>



<a name="147683045"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353773%20erroneous%20loop%20diagnostic/near/147683045" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353773.20erroneous.20loop.20diagnostic.html#147683045">(Nov 14 2018 at 16:52)</a>:</h4>
<p>this is actually a bit tricky to tell</p>



<a name="147683051"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353773%20erroneous%20loop%20diagnostic/near/147683051" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353773.20erroneous.20loop.20diagnostic.html#147683051">(Nov 14 2018 at 16:52)</a>:</h4>
<p>in a simple way</p>



<a name="147683057"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353773%20erroneous%20loop%20diagnostic/near/147683057" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353773.20erroneous.20loop.20diagnostic.html#147683057">(Nov 14 2018 at 16:52)</a>:</h4>
<p><span class="user-mention" data-user-id="116266">@Santiago Pastorino</span> are you following me at all?</p>



<a name="147684439"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353773%20erroneous%20loop%20diagnostic/near/147684439" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353773.20erroneous.20loop.20diagnostic.html#147684439">(Nov 14 2018 at 17:14)</a>:</h4>
<p>hey</p>



<a name="147684443"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353773%20erroneous%20loop%20diagnostic/near/147684443" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353773.20erroneous.20loop.20diagnostic.html#147684443">(Nov 14 2018 at 17:14)</a>:</h4>
<p>back</p>



<a name="147684482"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353773%20erroneous%20loop%20diagnostic/near/147684482" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353773.20erroneous.20loop.20diagnostic.html#147684482">(Nov 14 2018 at 17:15)</a>:</h4>
<p>more or less yeah</p>



<a name="147684564"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353773%20erroneous%20loop%20diagnostic/near/147684564" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353773.20erroneous.20loop.20diagnostic.html#147684564">(Nov 14 2018 at 17:16)</a>:</h4>
<p>what is "that message", the "in later iteration of the loop" part or all the message?</p>



<a name="147684591"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353773%20erroneous%20loop%20diagnostic/near/147684591" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353773.20erroneous.20loop.20diagnostic.html#147684591">(Nov 14 2018 at 17:17)</a>:</h4>
<p>what do you mean by loop backedge? backedge unsure what's the meaning of that in english but I have a guess :)</p>



<a name="147684667"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353773%20erroneous%20loop%20diagnostic/near/147684667" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353773.20erroneous.20loop.20diagnostic.html#147684667">(Nov 14 2018 at 17:18)</a>:</h4>
<blockquote>
<p>what is "that message", the "in later iteration of the loop" part or all the message?</p>
</blockquote>
<p>the "later iteration of loop" part specifically</p>



<a name="147684686"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353773%20erroneous%20loop%20diagnostic/near/147684686" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353773.20erroneous.20loop.20diagnostic.html#147684686">(Nov 14 2018 at 17:19)</a>:</h4>
<p>a backedge is a control-flow graph is an edge A -&gt; B where B dominates A (i.e., you can't reach A without going through B)</p>



<a name="147684714"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353773%20erroneous%20loop%20diagnostic/near/147684714" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353773.20erroneous.20loop.20diagnostic.html#147684714">(Nov 14 2018 at 17:19)</a>:</h4>
<p>so in this case the final thing in the loop (A) branches back to the head of the loop (B)</p>



<a name="147684880"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353773%20erroneous%20loop%20diagnostic/near/147684880" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353773.20erroneous.20loop.20diagnostic.html#147684880">(Nov 14 2018 at 17:22)</a>:</h4>
<p>what you meant is that you may skip the end of the loop and reach the <code>len()</code> call</p>



<a name="147684883"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353773%20erroneous%20loop%20diagnostic/near/147684883" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353773.20erroneous.20loop.20diagnostic.html#147684883">(Nov 14 2018 at 17:22)</a>:</h4>
<p>in case for instance the iterator has no elements</p>



<a name="147685796"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353773%20erroneous%20loop%20diagnostic/near/147685796" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353773.20erroneous.20loop.20diagnostic.html#147685796">(Nov 14 2018 at 17:38)</a>:</h4>
<p>yeah</p>



<a name="147685801"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353773%20erroneous%20loop%20diagnostic/near/147685801" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353773.20erroneous.20loop.20diagnostic.html#147685801">(Nov 14 2018 at 17:38)</a>:</h4>
<p>but I think that was the wrong analysis</p>



<a name="147685805"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353773%20erroneous%20loop%20diagnostic/near/147685805" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353773.20erroneous.20loop.20diagnostic.html#147685805">(Nov 14 2018 at 17:38)</a>:</h4>
<p>that is, in this example, the borrow occurs in the loop</p>



<a name="147685813"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353773%20erroneous%20loop%20diagnostic/near/147685813" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353773.20erroneous.20loop.20diagnostic.html#147685813">(Nov 14 2018 at 17:39)</a>:</h4>
<p>it IS TRUE that we will always "go back around the loop" to reach the error</p>



<a name="147685822"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353773%20erroneous%20loop%20diagnostic/near/147685822" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353773.20erroneous.20loop.20diagnostic.html#147685822">(Nov 14 2018 at 17:39)</a>:</h4>
<p>but the error was in the assumption that this meant we should say "in a later iteration of the loop"</p>



<a name="147685840"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353773%20erroneous%20loop%20diagnostic/near/147685840" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353773.20erroneous.20loop.20diagnostic.html#147685840">(Nov 14 2018 at 17:39)</a>:</h4>
<p>I'm not 100% sure when we should print that :)</p>



<a name="147686194"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353773%20erroneous%20loop%20diagnostic/near/147686194" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353773.20erroneous.20loop.20diagnostic.html#147686194">(Nov 14 2018 at 17:45)</a>:</h4>
<p>yeah, I don't understand either</p>



<a name="147686248"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353773%20erroneous%20loop%20diagnostic/near/147686248" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353773.20erroneous.20loop.20diagnostic.html#147686248">(Nov 14 2018 at 17:46)</a>:</h4>
<p>but besides from that, the text in this particular case shouldn't have that part?</p>



<a name="147686252"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353773%20erroneous%20loop%20diagnostic/near/147686252" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353773.20erroneous.20loop.20diagnostic.html#147686252">(Nov 14 2018 at 17:46)</a>:</h4>
<p>is that all I need to do?</p>



<a name="147686262"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353773%20erroneous%20loop%20diagnostic/near/147686262" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353773.20erroneous.20loop.20diagnostic.html#147686262">(Nov 14 2018 at 17:46)</a>:</h4>
<p>I was kind of still trying to understand what needs to be done</p>



<a name="147692232"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353773%20erroneous%20loop%20diagnostic/near/147692232" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353773.20erroneous.20loop.20diagnostic.html#147692232">(Nov 14 2018 at 19:18)</a>:</h4>
<p>well we need to decide when to print that text:)</p>



<a name="147692245"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353773%20erroneous%20loop%20diagnostic/near/147692245" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353773.20erroneous.20loop.20diagnostic.html#147692245">(Nov 14 2018 at 19:18)</a>:</h4>
<p>I'd like to come up with a relatively simple rule</p>



<a name="147692251"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353773%20erroneous%20loop%20diagnostic/near/147692251" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353773.20erroneous.20loop.20diagnostic.html#147692251">(Nov 14 2018 at 19:18)</a>:</h4>
<p>one rule that would work but is perhaps a bit <em>too</em> conservative</p>



<a name="147692265"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353773%20erroneous%20loop%20diagnostic/near/147692265" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353773.20erroneous.20loop.20diagnostic.html#147692265">(Nov 14 2018 at 19:19)</a>:</h4>
<p>ah well</p>



<a name="147692266"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353773%20erroneous%20loop%20diagnostic/near/147692266" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353773.20erroneous.20loop.20diagnostic.html#147692266">(Nov 14 2018 at 19:19)</a>:</h4>
<p>ok so one thing you could do:</p>



<a name="147692279"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353773%20erroneous%20loop%20diagnostic/near/147692279" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353773.20erroneous.20loop.20diagnostic.html#147692279">(Nov 14 2018 at 19:19)</a>:</h4>
<p>if the "use" dominates the "borrow" -- that means it <em>must</em> come "before" the borrow</p>



<a name="147692283"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353773%20erroneous%20loop%20diagnostic/near/147692283" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353773.20erroneous.20loop.20diagnostic.html#147692283">(Nov 14 2018 at 19:19)</a>:</h4>
<p>in that case, printing the label is fine</p>



<a name="147692294"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353773%20erroneous%20loop%20diagnostic/near/147692294" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353773.20erroneous.20loop.20diagnostic.html#147692294">(Nov 14 2018 at 19:19)</a>:</h4>
<p>and indeed I think we could even .. get rid of the backedge search altogether?</p>



<a name="147692417"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353773%20erroneous%20loop%20diagnostic/near/147692417" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353773.20erroneous.20loop.20diagnostic.html#147692417">(Nov 14 2018 at 19:21)</a>:</h4>
<p><span class="user-mention" data-user-id="116009">@nikomatsakis</span> ok, can try to get rid of that</p>



<a name="147692443"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353773%20erroneous%20loop%20diagnostic/near/147692443" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353773.20erroneous.20loop.20diagnostic.html#147692443">(Nov 14 2018 at 19:21)</a>:</h4>
<blockquote>
<p>if the "use" dominates the "borrow" -- that means it <em>must</em> come "before" the borrow</p>
</blockquote>
<p>what do you mean by this?</p>



<a name="147693085"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353773%20erroneous%20loop%20diagnostic/near/147693085" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353773.20erroneous.20loop.20diagnostic.html#147693085">(Nov 14 2018 at 19:30)</a>:</h4>
<p>example:</p>
<div class="codehilite"><pre><span></span>let mut x = 1;
let mut y = &amp;22;
loop {
    *x += 1; // use
    y = &amp;x; // borrow
}
</pre></div>



<a name="147693098"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353773%20erroneous%20loop%20diagnostic/near/147693098" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353773.20erroneous.20loop.20diagnostic.html#147693098">(Nov 14 2018 at 19:30)</a>:</h4>
<p>however, that analysis is limited</p>



<a name="147693101"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353773%20erroneous%20loop%20diagnostic/near/147693101" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353773.20erroneous.20loop.20diagnostic.html#147693101">(Nov 14 2018 at 19:30)</a>:</h4>
<p>I got distracted before completing</p>



<a name="147693129"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353773%20erroneous%20loop%20diagnostic/near/147693129" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353773.20erroneous.20loop.20diagnostic.html#147693129">(Nov 14 2018 at 19:30)</a>:</h4>
<p>e.g., this would not trigger the "next iteration of loop" message, but arguably should</p>
<div class="codehilite"><pre><span></span><span class="kd">let</span><span class="w"> </span><span class="k">mut</span><span class="w"> </span><span class="n">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="p">;</span><span class="w"></span>
<span class="kd">let</span><span class="w"> </span><span class="k">mut</span><span class="w"> </span><span class="n">y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">&amp;</span><span class="mi">22</span><span class="p">;</span><span class="w"></span>
<span class="k">loop</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="kc">true</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">       </span><span class="o">*</span><span class="n">x</span><span class="w"> </span><span class="o">+=</span><span class="w"> </span><span class="mi">1</span><span class="p">;</span><span class="w"> </span><span class="c1">// use</span>
<span class="w">     </span><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="p">}</span><span class="w"></span>
<span class="w">    </span><span class="n">y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">&amp;</span><span class="n">x</span><span class="p">;</span><span class="w"> </span><span class="c1">// borrow</span>
<span class="p">}</span><span class="w"></span>
</pre></div>



<a name="147693145"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353773%20erroneous%20loop%20diagnostic/near/147693145" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353773.20erroneous.20loop.20diagnostic.html#147693145">(Nov 14 2018 at 19:31)</a>:</h4>
<p>nor would this</p>
<div class="codehilite"><pre><span></span><span class="kd">let</span><span class="w"> </span><span class="k">mut</span><span class="w"> </span><span class="n">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="p">;</span><span class="w"></span>
<span class="kd">let</span><span class="w"> </span><span class="k">mut</span><span class="w"> </span><span class="n">y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">&amp;</span><span class="mi">22</span><span class="p">;</span><span class="w"></span>
<span class="k">loop</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="kc">true</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">       </span><span class="o">*</span><span class="n">x</span><span class="w"> </span><span class="o">+=</span><span class="w"> </span><span class="mi">1</span><span class="p">;</span><span class="w"> </span><span class="c1">// use</span>
<span class="w">     </span><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">        </span><span class="n">y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">&amp;</span><span class="n">x</span><span class="p">;</span><span class="w"> </span><span class="c1">// borrow</span>
<span class="w">    </span><span class="p">}</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>
</pre></div>



<a name="147693166"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353773%20erroneous%20loop%20diagnostic/near/147693166" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353773.20erroneous.20loop.20diagnostic.html#147693166">(Nov 14 2018 at 19:31)</a>:</h4>
<p>I think the <em>real</em> test we want is something like this:</p>
<ul>
<li>Did every path from the borrow to the use pass through a backedge? (As today)</li>
<li>And is there a path from the use to the borrow? (Not something we currently check)</li>
</ul>



<a name="147693167"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353773%20erroneous%20loop%20diagnostic/near/147693167" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353773.20erroneous.20loop.20diagnostic.html#147693167">(Nov 14 2018 at 19:31)</a>:</h4>
<p>if so, they are part of the same loop</p>



<a name="147700619"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353773%20erroneous%20loop%20diagnostic/near/147700619" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353773.20erroneous.20loop.20diagnostic.html#147700619">(Nov 14 2018 at 21:27)</a>:</h4>
<p>back</p>



<a name="147700625"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353773%20erroneous%20loop%20diagnostic/near/147700625" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353773.20erroneous.20loop.20diagnostic.html#147700625">(Nov 14 2018 at 21:27)</a>:</h4>
<p>let me check again all this stuff</p>



<a name="147700812"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353773%20erroneous%20loop%20diagnostic/near/147700812" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353773.20erroneous.20loop.20diagnostic.html#147700812">(Nov 14 2018 at 21:30)</a>:</h4>
<p>I still don't see some stuff</p>



<a name="147700841"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353773%20erroneous%20loop%20diagnostic/near/147700841" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353773.20erroneous.20loop.20diagnostic.html#147700841">(Nov 14 2018 at 21:30)</a>:</h4>
<p>I'm more thinking as a user perspective</p>



<a name="147700860"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353773%20erroneous%20loop%20diagnostic/near/147700860" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353773.20erroneous.20loop.20diagnostic.html#147700860">(Nov 14 2018 at 21:30)</a>:</h4>
<p>haven't yet thought from rustc perspective</p>



<a name="147701028"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353773%20erroneous%20loop%20diagnostic/near/147701028" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353773.20erroneous.20loop.20diagnostic.html#147701028">(Nov 14 2018 at 21:32)</a>:</h4>
<p>I guess, we want "borrow used here in later iteration of loop" when a value was dropped and used later in the loop</p>



<a name="147701043"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353773%20erroneous%20loop%20diagnostic/near/147701043" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353773.20erroneous.20loop.20diagnostic.html#147701043">(Nov 14 2018 at 21:32)</a>:</h4>
<p><span class="user-mention" data-user-id="116009">@nikomatsakis</span> is that right?</p>



<a name="147701107"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353773%20erroneous%20loop%20diagnostic/near/147701107" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353773.20erroneous.20loop.20diagnostic.html#147701107">(Nov 14 2018 at 21:33)</a>:</h4>
<p>I wasn't sure I was understanding the phrase "later iteration of loop"</p>



<a name="147701208"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353773%20erroneous%20loop%20diagnostic/near/147701208" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353773.20erroneous.20loop.20diagnostic.html#147701208">(Nov 14 2018 at 21:34)</a>:</h4>
<p>I guess it means that when you start iterating you have a value, you drop it and when you loop again you try to use that dropped thing</p>



<a name="147701210"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353773%20erroneous%20loop%20diagnostic/near/147701210" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353773.20erroneous.20loop.20diagnostic.html#147701210">(Nov 14 2018 at 21:34)</a>:</h4>
<p>?</p>



<a name="147701467"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353773%20erroneous%20loop%20diagnostic/near/147701467" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353773.20erroneous.20loop.20diagnostic.html#147701467">(Nov 14 2018 at 21:37)</a>:</h4>
<p><span class="user-mention" data-user-id="116266">@Santiago Pastorino</span> yeah it's basically meant to capture cases where</p>



<a name="147701478"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353773%20erroneous%20loop%20diagnostic/near/147701478" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353773.20erroneous.20loop.20diagnostic.html#147701478">(Nov 14 2018 at 21:37)</a>:</h4>
<p>the execution order is not "obvious"</p>



<a name="147701489"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353773%20erroneous%20loop%20diagnostic/near/147701489" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353773.20erroneous.20loop.20diagnostic.html#147701489">(Nov 14 2018 at 21:38)</a>:</h4>
<p>particularly since the snippet doesn't show the loop</p>



<a name="147701531"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353773%20erroneous%20loop%20diagnostic/near/147701531" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353773.20erroneous.20loop.20diagnostic.html#147701531">(Nov 14 2018 at 21:38)</a>:</h4>
<p>actually, it might be nice to highlight the loop but anyway</p>



<a name="147701590"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353773%20erroneous%20loop%20diagnostic/near/147701590" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353773.20erroneous.20loop.20diagnostic.html#147701590">(Nov 14 2018 at 21:39)</a>:</h4>
<p>so e.g. something like this (not the actual labels, but same idea) would be kind of confusing</p>
<div class="codehilite"><pre><span></span>2  | do_foo();
   | ------ then `foo` is called
3  | do_bar();
   | ^^^^^^ first `bar` is called
</pre></div>


<p>but maybe this is clearer:</p>
<div class="codehilite"><pre><span></span>2  | do_foo();
   | ------ then `foo` is called, in a later iteration of the loop
3  | do_bar();
   | ^^^^^^ first `bar` is called
</pre></div>



<a name="147701831"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353773%20erroneous%20loop%20diagnostic/near/147701831" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353773.20erroneous.20loop.20diagnostic.html#147701831">(Nov 14 2018 at 21:42)</a>:</h4>
<p>ok</p>



<a name="147701844"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353773%20erroneous%20loop%20diagnostic/near/147701844" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353773.20erroneous.20loop.20diagnostic.html#147701844">(Nov 14 2018 at 21:42)</a>:</h4>
<p>now let me switch to rustc mode and read what you've said :')</p>



<a name="147774164"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353773%20erroneous%20loop%20diagnostic/near/147774164" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353773.20erroneous.20loop.20diagnostic.html#147774164">(Nov 15 2018 at 21:17)</a>:</h4>
<p>hey <span class="user-mention" data-user-id="116009">@nikomatsakis</span> back</p>



<a name="147774173"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353773%20erroneous%20loop%20diagnostic/near/147774173" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353773.20erroneous.20loop.20diagnostic.html#147774173">(Nov 15 2018 at 21:17)</a>:</h4>
<p>sorry that I ended not having time yesterday after our conversation</p>



<a name="147774182"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353773%20erroneous%20loop%20diagnostic/near/147774182" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353773.20erroneous.20loop.20diagnostic.html#147774182">(Nov 15 2018 at 21:17)</a>:</h4>
<p>I've just read everything and makes sense</p>



<a name="147774188"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353773%20erroneous%20loop%20diagnostic/near/147774188" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353773.20erroneous.20loop.20diagnostic.html#147774188">(Nov 15 2018 at 21:17)</a>:</h4>
<p>what I wonder is ...</p>



<a name="147774293"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353773%20erroneous%20loop%20diagnostic/near/147774293" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353773.20erroneous.20loop.20diagnostic.html#147774293">(Nov 15 2018 at 21:19)</a>:</h4>
<blockquote>
<p>I think the <em>real</em> test we want is something like this:</p>
<ul>
<li>Did every path from the borrow to the use pass through a backedge? (As today)</li>
<li>And is there a path from the use to the borrow? (Not something we currently check)</li>
</ul>
</blockquote>
<p>I wonder you're describing here the way to figure out if we are in a loop or not</p>



<a name="147774299"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353773%20erroneous%20loop%20diagnostic/near/147774299" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353773.20erroneous.20loop.20diagnostic.html#147774299">(Nov 15 2018 at 21:19)</a>:</h4>
<p>don't we want something like ...</p>



<a name="147774519"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353773%20erroneous%20loop%20diagnostic/near/147774519" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353773.20erroneous.20loop.20diagnostic.html#147774519">(Nov 15 2018 at 21:22)</a>:</h4>
<p>all the paths from borrow to the use pass through a backedge that is later than the use in the cfg and that back edge goes to a position that is before the use in the cfg</p>



<a name="147774522"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353773%20erroneous%20loop%20diagnostic/near/147774522" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353773.20erroneous.20loop.20diagnostic.html#147774522">(Nov 15 2018 at 21:22)</a>:</h4>
<p>isn't that what we want?</p>



<a name="147777520"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353773%20erroneous%20loop%20diagnostic/near/147777520" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353773.20erroneous.20loop.20diagnostic.html#147777520">(Nov 15 2018 at 22:09)</a>:</h4>
<p>I think that sounds roughly equivalent, <span class="user-mention" data-user-id="116266">@Santiago Pastorino</span></p>



<a name="147777532"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353773%20erroneous%20loop%20diagnostic/near/147777532" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353773.20erroneous.20loop.20diagnostic.html#147777532">(Nov 15 2018 at 22:09)</a>:</h4>
<p>maybe even entirely equivalent :)</p>



<a name="147777542"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353773%20erroneous%20loop%20diagnostic/near/147777542" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353773.20erroneous.20loop.20diagnostic.html#147777542">(Nov 15 2018 at 22:09)</a>:</h4>
<p>so in other words, "yes"</p>



<a name="147780081"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353773%20erroneous%20loop%20diagnostic/near/147780081" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353773.20erroneous.20loop.20diagnostic.html#147780081">(Nov 15 2018 at 22:47)</a>:</h4>
<p>hehe, that's what I wanted to hear :)</p>



<a name="147780097"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353773%20erroneous%20loop%20diagnostic/near/147780097" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353773.20erroneous.20loop.20diagnostic.html#147780097">(Nov 15 2018 at 22:47)</a>:</h4>
<p>now I see</p>



<a name="147780102"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353773%20erroneous%20loop%20diagnostic/near/147780102" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353773.20erroneous.20loop.20diagnostic.html#147780102">(Nov 15 2018 at 22:47)</a>:</h4>
<p>makes sense</p>



<a name="147780121"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353773%20erroneous%20loop%20diagnostic/near/147780121" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353773.20erroneous.20loop.20diagnostic.html#147780121">(Nov 15 2018 at 22:47)</a>:</h4>
<p>path from the use to the borrow is equivalent and more oriented to the code that I need to write than what I've said</p>



<a name="147780123"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353773%20erroneous%20loop%20diagnostic/near/147780123" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353773.20erroneous.20loop.20diagnostic.html#147780123">(Nov 15 2018 at 22:48)</a>:</h4>
<p>cool</p>



<a name="147780171"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353773%20erroneous%20loop%20diagnostic/near/147780171" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353773.20erroneous.20loop.20diagnostic.html#147780171">(Nov 15 2018 at 22:48)</a>:</h4>
<p>tomorrow I may implement this otherwise on monday</p>



<a name="147780178"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353773%20erroneous%20loop%20diagnostic/near/147780178" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353773.20erroneous.20loop.20diagnostic.html#147780178">(Nov 15 2018 at 22:48)</a>:</h4>
<p>but seems easy :)</p>



<a name="147829275"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353773%20erroneous%20loop%20diagnostic/near/147829275" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353773.20erroneous.20loop.20diagnostic.html#147829275">(Nov 16 2018 at 16:50)</a>:</h4>
<p><span class="user-mention" data-user-id="116009">@nikomatsakis</span> why does this <a href="https://github.com/rust-lang/rust/blob/6b9b97bd9b704f85f0184f7a213cc4d62bd9654c/src/librustc_mir/borrow_check/error_reporting.rs#L161" target="_blank" title="https://github.com/rust-lang/rust/blob/6b9b97bd9b704f85f0184f7a213cc4d62bd9654c/src/librustc_mir/borrow_check/error_reporting.rs#L161">https://github.com/rust-lang/rust/blob/6b9b97bd9b704f85f0184f7a213cc4d62bd9654c/src/librustc_mir/borrow_check/error_reporting.rs#L161</a> if branch fill is_loop_move and the next one doesn't?</p>



<a name="147829285"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353773%20erroneous%20loop%20diagnostic/near/147829285" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353773.20erroneous.20loop.20diagnostic.html#147829285">(Nov 16 2018 at 16:50)</a>:</h4>
<p>by next one I meant, <a href="https://github.com/rust-lang/rust/blob/6b9b97bd9b704f85f0184f7a213cc4d62bd9654c/src/librustc_mir/borrow_check/error_reporting.rs#L162" target="_blank" title="https://github.com/rust-lang/rust/blob/6b9b97bd9b704f85f0184f7a213cc4d62bd9654c/src/librustc_mir/borrow_check/error_reporting.rs#L162">https://github.com/rust-lang/rust/blob/6b9b97bd9b704f85f0184f7a213cc4d62bd9654c/src/librustc_mir/borrow_check/error_reporting.rs#L162</a></p>



<a name="147987975"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353773%20erroneous%20loop%20diagnostic/near/147987975" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353773.20erroneous.20loop.20diagnostic.html#147987975">(Nov 19 2018 at 19:29)</a>:</h4>
<p><span class="user-mention" data-user-id="116009">@nikomatsakis</span> hey</p>



<a name="147987993"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353773%20erroneous%20loop%20diagnostic/near/147987993" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353773.20erroneous.20loop.20diagnostic.html#147987993">(Nov 19 2018 at 19:29)</a>:</h4>
<p>first check the questions I've left you</p>



<a name="147987996"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353773%20erroneous%20loop%20diagnostic/near/147987996" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353773.20erroneous.20loop.20diagnostic.html#147987996">(Nov 19 2018 at 19:29)</a>:</h4>
<p>but then</p>



<a name="147988008"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353773%20erroneous%20loop%20diagnostic/near/147988008" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353773.20erroneous.20loop.20diagnostic.html#147988008">(Nov 19 2018 at 19:29)</a>:</h4>
<p>I saw the traversed_back_edge thing you did</p>



<a name="147988021"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353773%20erroneous%20loop%20diagnostic/near/147988021" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353773.20erroneous.20loop.20diagnostic.html#147988021">(Nov 19 2018 at 19:29)</a>:</h4>
<p>well unsure if it was you :)</p>



<a name="147988122"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353773%20erroneous%20loop%20diagnostic/near/147988122" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353773.20erroneous.20loop.20diagnostic.html#147988122">(Nov 19 2018 at 19:30)</a>:</h4>
<p>I have a couple of questions about what do I have around</p>



<a name="147988193"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353773%20erroneous%20loop%20diagnostic/near/147988193" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353773.20erroneous.20loop.20diagnostic.html#147988193">(Nov 19 2018 at 19:31)</a>:</h4>
<p>first, I guess from the <code>MoveData</code> structure I can get the borrow</p>



<a name="147988294"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353773%20erroneous%20loop%20diagnostic/near/147988294" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353773.20erroneous.20loop.20diagnostic.html#147988294">(Nov 19 2018 at 19:32)</a>:</h4>
<blockquote>
<p>I think the <em>real</em> test we want is something like this:</p>
<ul>
<li>Did every path from the borrow to the use pass through a backedge? (As today)</li>
<li>And is there a path from the use to the borrow? (Not something we currently check)</li>
</ul>
</blockquote>
<p>and then I was wondering, I guess I need to do something similar to what was done for the backedge, I mean, go to the get_moved_indexes fn and search the use</p>



<a name="147988319"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353773%20erroneous%20loop%20diagnostic/near/147988319" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353773.20erroneous.20loop.20diagnostic.html#147988319">(Nov 19 2018 at 19:33)</a>:</h4>
<p>or is it the use already around?</p>



<a name="147988327"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353773%20erroneous%20loop%20diagnostic/near/147988327" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353773.20erroneous.20loop.20diagnostic.html#147988327">(Nov 19 2018 at 19:33)</a>:</h4>
<p>I'm searching for that info in the code</p>



<a name="147988669"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353773%20erroneous%20loop%20diagnostic/near/147988669" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353773.20erroneous.20loop.20diagnostic.html#147988669">(Nov 19 2018 at 19:37)</a>:</h4>
<p>I see, I have the used_place</p>



<a name="147989507"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353773%20erroneous%20loop%20diagnostic/near/147989507" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353773.20erroneous.20loop.20diagnostic.html#147989507">(Nov 19 2018 at 19:47)</a>:</h4>
<p>anyway, I'm not sure where the information related to the borrow comes from</p>



<a name="147990716"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353773%20erroneous%20loop%20diagnostic/near/147990716" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353773.20erroneous.20loop.20diagnostic.html#147990716">(Nov 19 2018 at 20:00)</a>:</h4>
<blockquote>
<p>first check the questions I've left you</p>
</blockquote>
<p>er, <span class="user-mention" data-user-id="116266">@Santiago Pastorino</span> sorry, I missed those I guess :)</p>



<a name="147990758"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353773%20erroneous%20loop%20diagnostic/near/147990758" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353773.20erroneous.20loop.20diagnostic.html#147990758">(Nov 19 2018 at 20:01)</a>:</h4>
<blockquote>
<p>I saw the traversed_back_edge thing you did</p>
</blockquote>
<p>well, it was <span class="user-mention" data-user-id="128294">@blitzerr</span>, but I was mentoring</p>



<a name="147993082"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353773%20erroneous%20loop%20diagnostic/near/147993082" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353773.20erroneous.20loop.20diagnostic.html#147993082">(Nov 19 2018 at 20:35)</a>:</h4>
<p><span class="emoji emoji-1f44d" title="+1">:+1:</span></p>



<a name="147993168"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353773%20erroneous%20loop%20diagnostic/near/147993168" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353773.20erroneous.20loop.20diagnostic.html#147993168">(Nov 19 2018 at 20:36)</a>:</h4>
<p><span class="user-mention" data-user-id="116009">@nikomatsakis</span> when you have some time and can answer the rest would be appreciated :)</p>



<a name="147993182"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353773%20erroneous%20loop%20diagnostic/near/147993182" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353773.20erroneous.20loop.20diagnostic.html#147993182">(Nov 19 2018 at 20:36)</a>:</h4>
<p>don't want to bother but I guess you may have missed some questions</p>



<a name="147993235"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353773%20erroneous%20loop%20diagnostic/near/147993235" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353773.20erroneous.20loop.20diagnostic.html#147993235">(Nov 19 2018 at 20:37)</a>:</h4>
<p>but the main sure is where do I get the borrow from</p>



<a name="147993365"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353773%20erroneous%20loop%20diagnostic/near/147993365" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353773.20erroneous.20loop.20diagnostic.html#147993365">(Nov 19 2018 at 20:39)</a>:</h4>
<blockquote>
<p>why does this <a href="https://github.com/rust-lang/rust/blob/6b9b97bd9b704f85f0184f7a213cc4d62bd9654c/src/librustc_mir/borrow_check/error_reporting.rs#L161" target="_blank" title="https://github.com/rust-lang/rust/blob/6b9b97bd9b704f85f0184f7a213cc4d62bd9654c/src/librustc_mir/borrow_check/error_reporting.rs#L161">https://github.com/rust-lang/rust/blob/6b9b97bd9b704f85f0184f7a213cc4d62bd9654c/src/librustc_mir/borrow_check/error_reporting.rs#L161</a> if branch fill is_loop_move and the next one doesn't?</p>
</blockquote>
<p>I think what <code>is_loop_move</code> is really asking is "did we already put a label on <code>span</code>?</p>
<p>i.e., if the use and move are not the same spot, we want to say "value used here after move".  Otherwise, we label it differently.</p>



<a name="147993379"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353773%20erroneous%20loop%20diagnostic/near/147993379" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353773.20erroneous.20loop.20diagnostic.html#147993379">(Nov 19 2018 at 20:39)</a>:</h4>
<p>is there another question I missed, <span class="user-mention" data-user-id="116266">@Santiago Pastorino</span> ?</p>



<a name="147993441"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353773%20erroneous%20loop%20diagnostic/near/147993441" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353773.20erroneous.20loop.20diagnostic.html#147993441">(Nov 19 2018 at 20:40)</a>:</h4>
<blockquote>
<p>first, I guess from the <code>MoveData</code> structure I can get the borrow</p>
</blockquote>
<p>oh, this</p>



<a name="147993456"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353773%20erroneous%20loop%20diagnostic/near/147993456" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353773.20erroneous.20loop.20diagnostic.html#147993456">(Nov 19 2018 at 20:40)</a>:</h4>
<p>let me look at the code</p>



<a name="147993521"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353773%20erroneous%20loop%20diagnostic/near/147993521" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353773.20erroneous.20loop.20diagnostic.html#147993521">(Nov 19 2018 at 20:41)</a>:</h4>
<p>yep that thing</p>



<a name="147993601"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353773%20erroneous%20loop%20diagnostic/near/147993601" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353773.20erroneous.20loop.20diagnostic.html#147993601">(Nov 19 2018 at 20:42)</a>:</h4>
<blockquote>
<blockquote>
<p>why does this <a href="https://github.com/rust-lang/rust/blob/6b9b97bd9b704f85f0184f7a213cc4d62bd9654c/src/librustc_mir/borrow_check/error_reporting.rs#L161" target="_blank" title="https://github.com/rust-lang/rust/blob/6b9b97bd9b704f85f0184f7a213cc4d62bd9654c/src/librustc_mir/borrow_check/error_reporting.rs#L161">https://github.com/rust-lang/rust/blob/6b9b97bd9b704f85f0184f7a213cc4d62bd9654c/src/librustc_mir/borrow_check/error_reporting.rs#L161</a> if branch fill is_loop_move and the next one doesn't?</p>
</blockquote>
<p>I think what <code>is_loop_move</code> is really asking is "did we already put a label on <code>span</code>?</p>
<p>i.e., if the use and move are not the same spot, we want to say "value used here after move".  Otherwise, we label it differently.</p>
</blockquote>
<p>it is weird to me because both branches are about loops</p>



<a name="147993624"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353773%20erroneous%20loop%20diagnostic/near/147993624" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353773.20erroneous.20loop.20diagnostic.html#147993624">(Nov 19 2018 at 20:42)</a>:</h4>
<p>but one gets the is_loop_move = true and the other one not</p>



<a name="147993645"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353773%20erroneous%20loop%20diagnostic/near/147993645" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353773.20erroneous.20loop.20diagnostic.html#147993645">(Nov 19 2018 at 20:42)</a>:</h4>
<p>check <a href="https://github.com/rust-lang/rust/blob/6b9b97bd9b704f85f0184f7a213cc4d62bd9654c/src/librustc_mir/borrow_check/error_reporting.rs#L156-L169" target="_blank" title="https://github.com/rust-lang/rust/blob/6b9b97bd9b704f85f0184f7a213cc4d62bd9654c/src/librustc_mir/borrow_check/error_reporting.rs#L156-L169">https://github.com/rust-lang/rust/blob/6b9b97bd9b704f85f0184f7a213cc4d62bd9654c/src/librustc_mir/borrow_check/error_reporting.rs#L156-L169</a></p>



<a name="147993653"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353773%20erroneous%20loop%20diagnostic/near/147993653" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353773.20erroneous.20loop.20diagnostic.html#147993653">(Nov 19 2018 at 20:43)</a>:</h4>
<p>btw</p>



<a name="147993667"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353773%20erroneous%20loop%20diagnostic/near/147993667" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353773.20erroneous.20loop.20diagnostic.html#147993667">(Nov 19 2018 at 20:43)</a>:</h4>
<p>looking at the actual diagnostic in question</p>



<a name="147993675"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353773%20erroneous%20loop%20diagnostic/near/147993675" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353773.20erroneous.20loop.20diagnostic.html#147993675">(Nov 19 2018 at 20:43)</a>:</h4>
<blockquote>
<p>but one gets the is_loop_move = true and the other one not</p>
</blockquote>
<p>the name of the variable is not good</p>



<a name="147993681"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353773%20erroneous%20loop%20diagnostic/near/147993681" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353773.20erroneous.20loop.20diagnostic.html#147993681">(Nov 19 2018 at 20:43)</a>:</h4>
<p>but also, this part of code is for a sligthly different error</p>



<a name="147993685"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353773%20erroneous%20loop%20diagnostic/near/147993685" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353773.20erroneous.20loop.20diagnostic.html#147993685">(Nov 19 2018 at 20:43)</a>:</h4>
<p>that is, this part of the code is for "use after move"</p>



<a name="147993703"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353773%20erroneous%20loop%20diagnostic/near/147993703" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353773.20erroneous.20loop.20diagnostic.html#147993703">(Nov 19 2018 at 20:43)</a>:</h4>
<p>but <a href="https://github.com/rust-lang/rust/issues/53773" target="_blank" title="https://github.com/rust-lang/rust/issues/53773">#53773</a> is actually " borrow may still be in use when destructor runs "</p>



<a name="147993779"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353773%20erroneous%20loop%20diagnostic/near/147993779" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353773.20erroneous.20loop.20diagnostic.html#147993779">(Nov 19 2018 at 20:44)</a>:</h4>
<p>that message appears to <a href="https://github.com/rust-lang/rust/blob/39852cae2b7486a7fb15a90866b9ad0b7bb7615d/src/librustc_mir/borrow_check/nll/explain_borrow/mod.rs#L73-L84" target="_blank" title="https://github.com/rust-lang/rust/blob/39852cae2b7486a7fb15a90866b9ad0b7bb7615d/src/librustc_mir/borrow_check/nll/explain_borrow/mod.rs#L73-L84">be created here</a>,</p>



<a name="147993802"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353773%20erroneous%20loop%20diagnostic/near/147993802" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353773.20erroneous.20loop.20diagnostic.html#147993802">(Nov 19 2018 at 20:44)</a>:</h4>
<p>based on the <code>UsedLaterInLoop</code> variant, which is <a href="https://github.com/rust-lang/rust/blob/39852cae2b7486a7fb15a90866b9ad0b7bb7615d/src/librustc_mir/borrow_check/nll/explain_borrow/mod.rs#L227-L229" target="_blank" title="https://github.com/rust-lang/rust/blob/39852cae2b7486a7fb15a90866b9ad0b7bb7615d/src/librustc_mir/borrow_check/nll/explain_borrow/mod.rs#L227-L229">created here</a></p>



<a name="147993813"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353773%20erroneous%20loop%20diagnostic/near/147993813" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353773.20erroneous.20loop.20diagnostic.html#147993813">(Nov 19 2018 at 20:45)</a>:</h4>
<p>so maybe the real question is why <code>is_borrow_location_in_loop</code> returns true</p>



<a name="147993904"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353773%20erroneous%20loop%20diagnostic/near/147993904" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353773.20erroneous.20loop.20diagnostic.html#147993904">(Nov 19 2018 at 20:46)</a>:</h4>
<p>(I suspect, also, that maybe this code could be "brought together")</p>



<a name="147993912"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353773%20erroneous%20loop%20diagnostic/near/147993912" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353773.20erroneous.20loop.20diagnostic.html#147993912">(Nov 19 2018 at 20:46)</a>:</h4>
<p>i.e., there is some kind of duplication here it feels like</p>



<a name="147993931"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353773%20erroneous%20loop%20diagnostic/near/147993931" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353773.20erroneous.20loop.20diagnostic.html#147993931">(Nov 19 2018 at 20:46)</a>:</h4>
<p>in other words, <span class="user-mention" data-user-id="116266">@Santiago Pastorino</span>, I may have sent you on a bit of a wild goose chase</p>



<a name="147993964"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353773%20erroneous%20loop%20diagnostic/near/147993964" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353773.20erroneous.20loop.20diagnostic.html#147993964">(Nov 19 2018 at 20:47)</a>:</h4>
<p>hehe, what does that mean?</p>



<a name="147994083"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353773%20erroneous%20loop%20diagnostic/near/147994083" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353773.20erroneous.20loop.20diagnostic.html#147994083">(Nov 19 2018 at 20:49)</a>:</h4>
<p>just saying that the code I was showing you before</p>



<a name="147994090"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353773%20erroneous%20loop%20diagnostic/near/147994090" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353773.20erroneous.20loop.20diagnostic.html#147994090">(Nov 19 2018 at 20:49)</a>:</h4>
<p>isn't actually responsible for the bug I dont' think</p>



<a name="147994095"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353773%20erroneous%20loop%20diagnostic/near/147994095" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353773.20erroneous.20loop.20diagnostic.html#147994095">(Nov 19 2018 at 20:49)</a>:</h4>
<p>rather, this <em>other</em> logic is</p>



<a name="147994101"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353773%20erroneous%20loop%20diagnostic/near/147994101" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353773.20erroneous.20loop.20diagnostic.html#147994101">(Nov 19 2018 at 20:49)</a>:</h4>
<p>logic which is .. kind of similar though</p>



<a name="147994117"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353773%20erroneous%20loop%20diagnostic/near/147994117" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353773.20erroneous.20loop.20diagnostic.html#147994117">(Nov 19 2018 at 20:49)</a>:</h4>
<p>ahh ok ok</p>



<a name="147994955"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353773%20erroneous%20loop%20diagnostic/near/147994955" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353773.20erroneous.20loop.20diagnostic.html#147994955">(Nov 19 2018 at 21:01)</a>:</h4>
<p><span class="user-mention" data-user-id="116009">@nikomatsakis</span> weird</p>



<a name="147994959"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353773%20erroneous%20loop%20diagnostic/near/147994959" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353773.20erroneous.20loop.20diagnostic.html#147994959">(Nov 19 2018 at 21:01)</a>:</h4>
<p><a href="https://github.com/rust-lang/rust/blob/6b9b97bd9b704f85f0184f7a213cc4d62bd9654c/src/librustc_mir/borrow_check/nll/explain_borrow/mod.rs#L289" target="_blank" title="https://github.com/rust-lang/rust/blob/6b9b97bd9b704f85f0184f7a213cc4d62bd9654c/src/librustc_mir/borrow_check/nll/explain_borrow/mod.rs#L289">https://github.com/rust-lang/rust/blob/6b9b97bd9b704f85f0184f7a213cc4d62bd9654c/src/librustc_mir/borrow_check/nll/explain_borrow/mod.rs#L289</a></p>



<a name="147995028"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353773%20erroneous%20loop%20diagnostic/near/147995028" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353773.20erroneous.20loop.20diagnostic.html#147995028">(Nov 19 2018 at 21:02)</a>:</h4>
<p>I don't see how this code would return true for our example</p>



<a name="147995030"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353773%20erroneous%20loop%20diagnostic/near/147995030" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353773.20erroneous.20loop.20diagnostic.html#147995030">(Nov 19 2018 at 21:02)</a>:</h4>
<p>gonna investigate</p>



<a name="147995142"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353773%20erroneous%20loop%20diagnostic/near/147995142" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353773.20erroneous.20loop.20diagnostic.html#147995142">(Nov 19 2018 at 21:04)</a>:</h4>
<p>maybe is called with the wrong location?</p>



<a name="147995959"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353773%20erroneous%20loop%20diagnostic/near/147995959" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353773.20erroneous.20loop.20diagnostic.html#147995959">(Nov 19 2018 at 21:17)</a>:</h4>
<p>not sure</p>



<a name="147996029"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353773%20erroneous%20loop%20diagnostic/near/147996029" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353773.20erroneous.20loop.20diagnostic.html#147996029">(Nov 19 2018 at 21:18)</a>:</h4>
<p>isn't it location instead of context.loc?</p>



<a name="147996068"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353773%20erroneous%20loop%20diagnostic/near/147996068" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353773.20erroneous.20loop.20diagnostic.html#147996068">(Nov 19 2018 at 21:19)</a>:</h4>
<p>I was just trying with it and running but I'm not 100% will need to think and investigate a bit better</p>



<a name="147996084"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353773%20erroneous%20loop%20diagnostic/near/147996084" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353773.20erroneous.20loop.20diagnostic.html#147996084">(Nov 19 2018 at 21:19)</a>:</h4>
<p>using location works but it may be for another reason</p>



<a name="147996813"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353773%20erroneous%20loop%20diagnostic/near/147996813" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353773.20erroneous.20loop.20diagnostic.html#147996813">(Nov 19 2018 at 21:29)</a>:</h4>
<p>ok, I see what's the issue</p>



<a name="147996950"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353773%20erroneous%20loop%20diagnostic/near/147996950" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353773.20erroneous.20loop.20diagnostic.html#147996950">(Nov 19 2018 at 21:31)</a>:</h4>
<p>it's what we talked about</p>



<a name="147996954"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353773%20erroneous%20loop%20diagnostic/near/147996954" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353773.20erroneous.20loop.20diagnostic.html#147996954">(Nov 19 2018 at 21:31)</a>:</h4>
<p>we need to pass both locations</p>



<a name="147996961"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353773%20erroneous%20loop%20diagnostic/near/147996961" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353773.20erroneous.20loop.20diagnostic.html#147996961">(Nov 19 2018 at 21:31)</a>:</h4>
<p>the one of the borrow and the one of the use</p>



<a name="147996970"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353773%20erroneous%20loop%20diagnostic/near/147996970" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353773.20erroneous.20loop.20diagnostic.html#147996970">(Nov 19 2018 at 21:31)</a>:</h4>
<p>and check the things you mentioned</p>



<a name="147996990"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353773%20erroneous%20loop%20diagnostic/near/147996990" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353773.20erroneous.20loop.20diagnostic.html#147996990">(Nov 19 2018 at 21:31)</a>:</h4>
<blockquote>
<p>I think the <em>real</em> test we want is something like this:</p>
<ul>
<li>Did every path from the borrow to the use pass through a backedge? (As today)</li>
<li>And is there a path from the use to the borrow? (Not something we currently check)</li>
</ul>
</blockquote>
<p>this basically</p>



<a name="147998619"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353773%20erroneous%20loop%20diagnostic/near/147998619" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353773.20erroneous.20loop.20diagnostic.html#147998619">(Nov 19 2018 at 21:56)</a>:</h4>
<p>yes, but applied to a different set of code I guess :)</p>



<a name="147998922"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353773%20erroneous%20loop%20diagnostic/near/147998922" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353773.20erroneous.20loop.20diagnostic.html#147998922">(Nov 19 2018 at 22:01)</a>:</h4>
<p><span class="user-mention" data-user-id="116009">@nikomatsakis</span> what do you mean?</p>



<a name="147998938"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353773%20erroneous%20loop%20diagnostic/near/147998938" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353773.20erroneous.20loop.20diagnostic.html#147998938">(Nov 19 2018 at 22:01)</a>:</h4>
<p>I just mean that the code we were talking about earlier had to do with move errors</p>



<a name="147998942"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353773%20erroneous%20loop%20diagnostic/near/147998942" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353773.20erroneous.20loop.20diagnostic.html#147998942">(Nov 19 2018 at 22:01)</a>:</h4>
<p>and is not executing here from what I can tell</p>



<a name="147998947"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353773%20erroneous%20loop%20diagnostic/near/147998947" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353773.20erroneous.20loop.20diagnostic.html#147998947">(Nov 19 2018 at 22:01)</a>:</h4>
<p>unless I'm missing something</p>



<a name="147999027"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353773%20erroneous%20loop%20diagnostic/near/147999027" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353773.20erroneous.20loop.20diagnostic.html#147999027">(Nov 19 2018 at 22:02)</a>:</h4>
<p><span class="user-mention" data-user-id="116009">@nikomatsakis</span> I was talking about this <a href="https://github.com/rust-lang/rust/blob/6b9b97bd9b704f85f0184f7a213cc4d62bd9654c/src/librustc_mir/borrow_check/nll/explain_borrow/mod.rs#L289" target="_blank" title="https://github.com/rust-lang/rust/blob/6b9b97bd9b704f85f0184f7a213cc4d62bd9654c/src/librustc_mir/borrow_check/nll/explain_borrow/mod.rs#L289">https://github.com/rust-lang/rust/blob/6b9b97bd9b704f85f0184f7a213cc4d62bd9654c/src/librustc_mir/borrow_check/nll/explain_borrow/mod.rs#L289</a></p>



<a name="147999046"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353773%20erroneous%20loop%20diagnostic/near/147999046" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353773.20erroneous.20loop.20diagnostic.html#147999046">(Nov 19 2018 at 22:03)</a>:</h4>
<p>seems that the important part is <a href="https://github.com/rust-lang/rust/blob/6b9b97bd9b704f85f0184f7a213cc4d62bd9654c/src/librustc_mir/borrow_check/nll/explain_borrow/mod.rs#L227-L230" target="_blank" title="https://github.com/rust-lang/rust/blob/6b9b97bd9b704f85f0184f7a213cc4d62bd9654c/src/librustc_mir/borrow_check/nll/explain_borrow/mod.rs#L227-L230">https://github.com/rust-lang/rust/blob/6b9b97bd9b704f85f0184f7a213cc4d62bd9654c/src/librustc_mir/borrow_check/nll/explain_borrow/mod.rs#L227-L230</a></p>



<a name="147999055"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353773%20erroneous%20loop%20diagnostic/near/147999055" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353773.20erroneous.20loop.20diagnostic.html#147999055">(Nov 19 2018 at 22:03)</a>:</h4>
<p>I guess that function needs to take both locations</p>



<a name="147999059"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353773%20erroneous%20loop%20diagnostic/near/147999059" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353773.20erroneous.20loop.20diagnostic.html#147999059">(Nov 19 2018 at 22:03)</a>:</h4>
<p>location of use and location of move</p>



<a name="147999064"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353773%20erroneous%20loop%20diagnostic/near/147999064" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353773.20erroneous.20loop.20diagnostic.html#147999064">(Nov 19 2018 at 22:03)</a>:</h4>
<p>and do the logic you mentioned</p>



<a name="148042563"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353773%20erroneous%20loop%20diagnostic/near/148042563" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353773.20erroneous.20loop.20diagnostic.html#148042563">(Nov 20 2018 at 14:29)</a>:</h4>
<p><span class="user-mention" data-user-id="116266">@Santiago Pastorino</span> yeah, the function currently seems to just compute whether the borrow location can reach itself</p>



<a name="148042568"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353773%20erroneous%20loop%20diagnostic/near/148042568" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353773.20erroneous.20loop.20diagnostic.html#148042568">(Nov 20 2018 at 14:30)</a>:</h4>
<p>which isn't really an interesting question</p>



<a name="148042645"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353773%20erroneous%20loop%20diagnostic/near/148042645" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353773.20erroneous.20loop.20diagnostic.html#148042645">(Nov 20 2018 at 14:30)</a>:</h4>
<p>thinking more about this</p>



<a name="148042652"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353773%20erroneous%20loop%20diagnostic/near/148042652" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353773.20erroneous.20loop.20diagnostic.html#148042652">(Nov 20 2018 at 14:30)</a>:</h4>
<p>maybe we want a function like this:</p>



<a name="148042669"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353773%20erroneous%20loop%20diagnostic/near/148042669" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353773.20erroneous.20loop.20diagnostic.html#148042669">(Nov 20 2018 at 14:31)</a>:</h4>
<p><code>can_reach_ignoring_backedges(P, Q)</code> -- is there a path from <code>P</code> to <code>Q</code> that doesn't use any backedges?</p>



<a name="148042710"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353773%20erroneous%20loop%20diagnostic/near/148042710" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353773.20erroneous.20loop.20diagnostic.html#148042710">(Nov 20 2018 at 14:32)</a>:</h4>
<p>in that case, you could say something like this:</p>
<ul>
<li>if <code>can_reach_ignoring_backedges(Borrow, Use)</code> is <strong>false</strong>, then we print "in previous iteration of loop"</li>
</ul>



<a name="148042751"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353773%20erroneous%20loop%20diagnostic/near/148042751" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353773.20erroneous.20loop.20diagnostic.html#148042751">(Nov 20 2018 at 14:32)</a>:</h4>
<p>is it as simple as that? feels like it is</p>



<a name="148042842"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353773%20erroneous%20loop%20diagnostic/near/148042842" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353773.20erroneous.20loop.20diagnostic.html#148042842">(Nov 20 2018 at 14:33)</a>:</h4>
<p>yeah, exactly</p>



<a name="148042911"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353773%20erroneous%20loop%20diagnostic/near/148042911" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353773.20erroneous.20loop.20diagnostic.html#148042911">(Nov 20 2018 at 14:34)</a>:</h4>
<p>the search needs to go in forward direction and stop as soon as we reach the end and ignoring the already visited locations</p>



<a name="148043197"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353773%20erroneous%20loop%20diagnostic/near/148043197" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353773.20erroneous.20loop.20diagnostic.html#148043197">(Nov 20 2018 at 14:39)</a>:</h4>
<p>and ignoring backedges</p>



<a name="148043249"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353773%20erroneous%20loop%20diagnostic/near/148043249" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353773.20erroneous.20loop.20diagnostic.html#148043249">(Nov 20 2018 at 14:40)</a>:</h4>
<p>(any edge <code>P -&gt; Q</code> where <code>Q</code> dominates <code>P</code>)</p>



<a name="148043636"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353773%20erroneous%20loop%20diagnostic/near/148043636" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353773.20erroneous.20loop.20diagnostic.html#148043636">(Nov 20 2018 at 14:46)</a>:</h4>
<p>yep</p>



<a name="148043656"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353773%20erroneous%20loop%20diagnostic/near/148043656" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353773.20erroneous.20loop.20diagnostic.html#148043656">(Nov 20 2018 at 14:46)</a>:</h4>
<p>but wouldn't just moving forward without visiting already visited locations do that already?</p>



<a name="148043748"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353773%20erroneous%20loop%20diagnostic/near/148043748" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353773.20erroneous.20loop.20diagnostic.html#148043748">(Nov 20 2018 at 14:48)</a>:</h4>
<p>already visited when?</p>



<a name="148043935"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353773%20erroneous%20loop%20diagnostic/near/148043935" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353773.20erroneous.20loop.20diagnostic.html#148043935">(Nov 20 2018 at 14:50)</a>:</h4>
<p>you're right ;)</p>



<a name="148050112"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353773%20erroneous%20loop%20diagnostic/near/148050112" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353773.20erroneous.20loop.20diagnostic.html#148050112">(Nov 20 2018 at 16:17)</a>:</h4>
<p><span class="user-mention" data-user-id="116009">@nikomatsakis</span> was starting to build this thing</p>



<a name="148050115"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353773%20erroneous%20loop%20diagnostic/near/148050115" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353773.20erroneous.20loop.20diagnostic.html#148050115">(Nov 20 2018 at 16:17)</a>:</h4>
<p>quick question</p>



<a name="148050121"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353773%20erroneous%20loop%20diagnostic/near/148050121" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353773.20erroneous.20loop.20diagnostic.html#148050121">(Nov 20 2018 at 16:17)</a>:</h4>
<div class="codehilite"><pre><span></span>        stack.extend(mir.predecessor_locations(context.loc).map(|predecessor| {
            let is_back_edge = context.loc.dominates(predecessor, &amp;self.dominators);
            (predecessor, is_back_edge)
        }));
</pre></div>



<a name="148050168"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353773%20erroneous%20loop%20diagnostic/near/148050168" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353773.20erroneous.20loop.20diagnostic.html#148050168">(Nov 20 2018 at 16:18)</a>:</h4>
<p>this is the code of the is_back_edge stuff</p>



<a name="148050201"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353773%20erroneous%20loop%20diagnostic/near/148050201" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353773.20erroneous.20loop.20diagnostic.html#148050201">(Nov 20 2018 at 16:18)</a>:</h4>
<p>in the code I'm writing the search is forward</p>



<a name="148050208"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353773%20erroneous%20loop%20diagnostic/near/148050208" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353773.20erroneous.20loop.20diagnostic.html#148050208">(Nov 20 2018 at 16:18)</a>:</h4>
<p>so I'm looking at one location</p>



<a name="148050219"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353773%20erroneous%20loop%20diagnostic/near/148050219" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353773.20erroneous.20loop.20diagnostic.html#148050219">(Nov 20 2018 at 16:18)</a>:</h4>
<p>I need to get the successors</p>



<a name="148050274"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353773%20erroneous%20loop%20diagnostic/near/148050274" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353773.20erroneous.20loop.20diagnostic.html#148050274">(Nov 20 2018 at 16:19)</a>:</h4>
<p>and check if successors dominates location</p>



<a name="148050275"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353773%20erroneous%20loop%20diagnostic/near/148050275" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353773.20erroneous.20loop.20diagnostic.html#148050275">(Nov 20 2018 at 16:19)</a>:</h4>
<p>right?</p>



<a name="148050431"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353773%20erroneous%20loop%20diagnostic/near/148050431" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353773.20erroneous.20loop.20diagnostic.html#148050431">(Nov 20 2018 at 16:21)</a>:</h4>
<p>and the other question is ... that happens when the TerminatorKind is Goto?</p>



<a name="148055938"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353773%20erroneous%20loop%20diagnostic/near/148055938" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353773.20erroneous.20loop.20diagnostic.html#148055938">(Nov 20 2018 at 17:57)</a>:</h4>
<blockquote>
<p>right?</p>
</blockquote>
<p>right <span class="user-mention" data-user-id="116266">@Santiago Pastorino</span></p>



<a name="148055944"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353773%20erroneous%20loop%20diagnostic/near/148055944" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353773.20erroneous.20loop.20diagnostic.html#148055944">(Nov 20 2018 at 17:57)</a>:</h4>
<blockquote>
<p>and the other question is ... that happens when the TerminatorKind is Goto?</p>
</blockquote>
<p>that should be like any other terminator, I think</p>



<a name="148055949"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353773%20erroneous%20loop%20diagnostic/near/148055949" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353773.20erroneous.20loop.20diagnostic.html#148055949">(Nov 20 2018 at 17:57)</a>:</h4>
<p>there is a method to get the successors I think</p>



<a name="148055995"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353773%20erroneous%20loop%20diagnostic/near/148055995" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353773.20erroneous.20loop.20diagnostic.html#148055995">(Nov 20 2018 at 17:58)</a>:</h4>
<p>I don't know why this particular method is making a difference between different terminators</p>



<a name="148055998"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353773%20erroneous%20loop%20diagnostic/near/148055998" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353773.20erroneous.20loop.20diagnostic.html#148055998">(Nov 20 2018 at 17:58)</a>:</h4>
<p>I guess I just should use a successors method and that's it?</p>



<a name="148055999"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353773%20erroneous%20loop%20diagnostic/near/148055999" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353773.20erroneous.20loop.20diagnostic.html#148055999">(Nov 20 2018 at 17:58)</a>:</h4>
<p>which method</p>



<a name="148056004"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353773%20erroneous%20loop%20diagnostic/near/148056004" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353773.20erroneous.20loop.20diagnostic.html#148056004">(Nov 20 2018 at 17:58)</a>:</h4>
<p>oh</p>



<a name="148056006"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353773%20erroneous%20loop%20diagnostic/near/148056006" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353773.20erroneous.20loop.20diagnostic.html#148056006">(Nov 20 2018 at 17:58)</a>:</h4>
<p>I think it's just written in ignorance of the <code>successors()</code> helper</p>



<a name="148056007"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353773%20erroneous%20loop%20diagnostic/near/148056007" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353773.20erroneous.20loop.20diagnostic.html#148056007">(Nov 20 2018 at 17:58)</a>:</h4>
<p><a href="https://github.com/rust-lang/rust/blob/6b9b97bd9b704f85f0184f7a213cc4d62bd9654c/src/librustc_mir/borrow_check/nll/explain_borrow/mod.rs#L317" target="_blank" title="https://github.com/rust-lang/rust/blob/6b9b97bd9b704f85f0184f7a213cc4d62bd9654c/src/librustc_mir/borrow_check/nll/explain_borrow/mod.rs#L317">https://github.com/rust-lang/rust/blob/6b9b97bd9b704f85f0184f7a213cc4d62bd9654c/src/librustc_mir/borrow_check/nll/explain_borrow/mod.rs#L317</a></p>



<a name="148056010"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353773%20erroneous%20loop%20diagnostic/near/148056010" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353773.20erroneous.20loop.20diagnostic.html#148056010">(Nov 20 2018 at 17:58)</a>:</h4>
<p>ok</p>



<a name="148056013"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353773%20erroneous%20loop%20diagnostic/near/148056013" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353773.20erroneous.20loop.20diagnostic.html#148056013">(Nov 20 2018 at 17:59)</a>:</h4>
<p>yeah, I think that <a href="https://github.com/rust-lang/rust/blob/6b9b97bd9b704f85f0184f7a213cc4d62bd9654c/src/librustc_mir/borrow_check/nll/explain_borrow/mod.rs#L313-L345" target="_blank" title="https://github.com/rust-lang/rust/blob/6b9b97bd9b704f85f0184f7a213cc4d62bd9654c/src/librustc_mir/borrow_check/nll/explain_borrow/mod.rs#L313-L345">all that code</a> can be replaced with one line :)</p>



<a name="148056337"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353773%20erroneous%20loop%20diagnostic/near/148056337" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353773.20erroneous.20loop.20diagnostic.html#148056337">(Nov 20 2018 at 18:05)</a>:</h4>
<p>hehe</p>



<a name="148056338"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353773%20erroneous%20loop%20diagnostic/near/148056338" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353773.20erroneous.20loop.20diagnostic.html#148056338">(Nov 20 2018 at 18:05)</a>:</h4>
<p>yeah</p>



<a name="148056365"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353773%20erroneous%20loop%20diagnostic/near/148056365" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353773.20erroneous.20loop.20diagnostic.html#148056365">(Nov 20 2018 at 18:06)</a>:</h4>
<p>ok, that thing confused me a lot</p>



<a name="148056386"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353773%20erroneous%20loop%20diagnostic/near/148056386" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353773.20erroneous.20loop.20diagnostic.html#148056386">(Nov 20 2018 at 18:06)</a>:</h4>
<p>and also, is the if part needed?</p>



<a name="148056392"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353773%20erroneous%20loop%20diagnostic/near/148056392" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353773.20erroneous.20loop.20diagnostic.html#148056392">(Nov 20 2018 at 18:06)</a>:</h4>
<p>need to check successors method it may already handle that</p>



<a name="148056616"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353773%20erroneous%20loop%20diagnostic/near/148056616" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353773.20erroneous.20loop.20diagnostic.html#148056616">(Nov 20 2018 at 18:11)</a>:</h4>
<p>ok, I need more or less this <a href="https://github.com/rust-lang/rust/blob/6b9b97bd9b704f85f0184f7a213cc4d62bd9654c/src/librustc_mir/borrow_check/nll/explain_borrow/find_use.rs#L77-L93" target="_blank" title="https://github.com/rust-lang/rust/blob/6b9b97bd9b704f85f0184f7a213cc4d62bd9654c/src/librustc_mir/borrow_check/nll/explain_borrow/find_use.rs#L77-L93">https://github.com/rust-lang/rust/blob/6b9b97bd9b704f85f0184f7a213cc4d62bd9654c/src/librustc_mir/borrow_check/nll/explain_borrow/find_use.rs#L77-L93</a></p>



<a name="148056931"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353773%20erroneous%20loop%20diagnostic/near/148056931" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353773.20erroneous.20loop.20diagnostic.html#148056931">(Nov 20 2018 at 18:16)</a>:</h4>
<p>sounds right <span class="user-mention" data-user-id="116266">@Santiago Pastorino</span>, I've wanted to make a helper for that exact bit of logic before</p>



<a name="148057111"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353773%20erroneous%20loop%20diagnostic/near/148057111" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353773.20erroneous.20loop.20diagnostic.html#148057111">(Nov 20 2018 at 18:19)</a>:</h4>
<p><span class="emoji emoji-1f44d" title="+1">:+1:</span></p>



<a name="148060258"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353773%20erroneous%20loop%20diagnostic/near/148060258" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353773.20erroneous.20loop.20diagnostic.html#148060258">(Nov 20 2018 at 19:12)</a>:</h4>
<p>thing is ready, I'm testing this</p>



<a name="148060644"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353773%20erroneous%20loop%20diagnostic/near/148060644" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353773.20erroneous.20loop.20diagnostic.html#148060644">(Nov 20 2018 at 19:18)</a>:</h4>
<p><span class="user-mention" data-user-id="116009">@nikomatsakis</span> in case you want to check it out <a href="https://github.com/rust-lang/rust/compare/master...spastorino:erroneous-loop-diagnostic-in-nll" target="_blank" title="https://github.com/rust-lang/rust/compare/master...spastorino:erroneous-loop-diagnostic-in-nll">https://github.com/rust-lang/rust/compare/master...spastorino:erroneous-loop-diagnostic-in-nll</a></p>



<a name="148060656"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353773%20erroneous%20loop%20diagnostic/near/148060656" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353773.20erroneous.20loop.20diagnostic.html#148060656">(Nov 20 2018 at 19:18)</a>:</h4>
<p>if tests pass gonna open a PR</p>



<a name="148060681"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353773%20erroneous%20loop%20diagnostic/near/148060681" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353773.20erroneous.20loop.20diagnostic.html#148060681">(Nov 20 2018 at 19:19)</a>:</h4>
<p>I'm not sure if I really need the visited_locations, since that the algorithm is already discarding back edges</p>



<a name="148060686"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353773%20erroneous%20loop%20diagnostic/near/148060686" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353773.20erroneous.20loop.20diagnostic.html#148060686">(Nov 20 2018 at 19:19)</a>:</h4>
<p>I guess we don't and I can remove that</p>



<a name="148060797"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353773%20erroneous%20loop%20diagnostic/near/148060797" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353773.20erroneous.20loop.20diagnostic.html#148060797">(Nov 20 2018 at 19:20)</a>:</h4>
<p>well actually we need that despite of back edges :)</p>



<a name="148061247"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353773%20erroneous%20loop%20diagnostic/near/148061247" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353773.20erroneous.20loop.20diagnostic.html#148061247">(Nov 20 2018 at 19:27)</a>:</h4>
<blockquote>
<p>well actually we need that despite of back edges :)</p>
</blockquote>
<p>yeah, could be a DAG</p>



<a name="148061252"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353773%20erroneous%20loop%20diagnostic/near/148061252" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353773.20erroneous.20loop.20diagnostic.html#148061252">(Nov 20 2018 at 19:27)</a>:</h4>
<p>I mean you don't <em>need</em> it</p>



<a name="148061255"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353773%20erroneous%20loop%20diagnostic/near/148061255" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353773.20erroneous.20loop.20diagnostic.html#148061255">(Nov 20 2018 at 19:27)</a>:</h4>
<p>but it's wasteful</p>



<a name="148061520"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353773%20erroneous%20loop%20diagnostic/near/148061520" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353773.20erroneous.20loop.20diagnostic.html#148061520">(Nov 20 2018 at 19:31)</a>:</h4>
<p>yep</p>



<a name="148061835"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353773%20erroneous%20loop%20diagnostic/near/148061835" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353773.20erroneous.20loop.20diagnostic.html#148061835">(Nov 20 2018 at 19:35)</a>:</h4>
<div class="codehilite"><pre><span></span>diff --git a/src/test/ui/borrowck/borrowck-lend-flow-loop.nll.stderr b/src/test/ui/borrowck/borrowck-lend-flow-loop.nll.stderr
index 19de3582c88..396fd6ffa0c 100644
--- a/src/test/ui/borrowck/borrowck-lend-flow-loop.nll.stderr
+++ b/src/test/ui/borrowck/borrowck-lend-flow-loop.nll.stderr
@@ -8,13 +8,13 @@ LL |         borrow(&amp;*v); //[ast]~ ERROR cannot borrow
    |                ^^^ immutable borrow occurs here
 ...
 LL |     *x = box 5;
-   |     -- mutable borrow used here, in later iteration of loop
+   |     -- mutable borrow later used here

 error[E0502]: cannot borrow `*v` as immutable because it is also borrowed as mutable
   --&gt; $DIR/borrowck-lend-flow-loop.rs:109:16
    |
 LL |         **x += 1;
-   |         -------- mutable borrow used here, in later iteration of loop
+   |         -------- mutable borrow later used here
 LL |         borrow(&amp;*v); //[ast]~ ERROR cannot borrow
    |                ^^^ immutable borrow occurs here
 ...
diff --git a/src/test/ui/borrowck/borrowck-mut-borrow-linear-errors.mir.stderr b/src/test/ui/borrowck/borrowck-mut-borrow-linear-errors.mir.stderr
index 5301ee7a403..3b56c00145c 100644
--- a/src/test/ui/borrowck/borrowck-mut-borrow-linear-errors.mir.stderr
+++ b/src/test/ui/borrowck/borrowck-mut-borrow-linear-errors.mir.stderr
@@ -4,7 +4,7 @@ error[E0499]: cannot borrow `x` as mutable more than once at a time
 LL |             1 =&gt; { addr.push(&amp;mut x); } //[ast]~ ERROR [E0499]
    |                    ----      ^^^^^^ second mutable borrow occurs here
    |                    |
-   |                    first borrow used here, in later iteration of loop
+   |                    first borrow later used here
 ...
 LL |             _ =&gt; { addr.push(&amp;mut x); } //[ast]~ ERROR [E0499]
    |                              ------ first mutable borrow occurs here
@@ -13,7 +13,7 @@ error[E0499]: cannot borrow `x` as mutable more than once at a time
   --&gt; $DIR/borrowck-mut-borrow-linear-errors.rs:25:30
    |
 LL |             1 =&gt; { addr.push(&amp;mut x); } //[ast]~ ERROR [E0499]
-   |                    ---- first borrow used here, in later iteration of loop
+   |                    ---- first borrow later used here
 LL |             //[mir]~^ ERROR [E0499]
 LL |             2 =&gt; { addr.push(&amp;mut x); } //[ast]~ ERROR [E0499]
    |                              ^^^^^^ second mutable borrow occurs here
</pre></div>



<a name="148061841"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353773%20erroneous%20loop%20diagnostic/near/148061841" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353773.20erroneous.20loop.20diagnostic.html#148061841">(Nov 20 2018 at 19:35)</a>:</h4>
<p><span class="user-mention" data-user-id="116009">@nikomatsakis</span> it's changing some stuff</p>



<a name="148061904"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353773%20erroneous%20loop%20diagnostic/near/148061904" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353773.20erroneous.20loop.20diagnostic.html#148061904">(Nov 20 2018 at 19:36)</a>:</h4>
<p>in particular</p>



<a name="148061905"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353773%20erroneous%20loop%20diagnostic/near/148061905" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353773.20erroneous.20loop.20diagnostic.html#148061905">(Nov 20 2018 at 19:36)</a>:</h4>
<p><a href="https://github.com/rust-lang/rust/blob/master/src/test/ui/borrowck/borrowck-mut-borrow-linear-errors.rs" target="_blank" title="https://github.com/rust-lang/rust/blob/master/src/test/ui/borrowck/borrowck-mut-borrow-linear-errors.rs">https://github.com/rust-lang/rust/blob/master/src/test/ui/borrowck/borrowck-mut-borrow-linear-errors.rs</a></p>



<a name="148061920"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353773%20erroneous%20loop%20diagnostic/near/148061920" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353773.20erroneous.20loop.20diagnostic.html#148061920">(Nov 20 2018 at 19:36)</a>:</h4>
<p><a href="https://github.com/rust-lang/rust/blob/master/src/test/ui/borrowck/borrowck-mut-borrow-linear-errors.mir.stderr" target="_blank" title="https://github.com/rust-lang/rust/blob/master/src/test/ui/borrowck/borrowck-mut-borrow-linear-errors.mir.stderr">https://github.com/rust-lang/rust/blob/master/src/test/ui/borrowck/borrowck-mut-borrow-linear-errors.mir.stderr</a></p>



<a name="148062049"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353773%20erroneous%20loop%20diagnostic/near/148062049" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353773.20erroneous.20loop.20diagnostic.html#148062049">(Nov 20 2018 at 19:38)</a>:</h4>
<p>in particular this line <a href="https://github.com/rust-lang/rust/blob/master/src/test/ui/borrowck/borrowck-mut-borrow-linear-errors.mir.stderr#L7" target="_blank" title="https://github.com/rust-lang/rust/blob/master/src/test/ui/borrowck/borrowck-mut-borrow-linear-errors.mir.stderr#L7">https://github.com/rust-lang/rust/blob/master/src/test/ui/borrowck/borrowck-mut-borrow-linear-errors.mir.stderr#L7</a></p>



<a name="148062050"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353773%20erroneous%20loop%20diagnostic/near/148062050" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353773.20erroneous.20loop.20diagnostic.html#148062050">(Nov 20 2018 at 19:38)</a>:</h4>
<p>now says</p>



<a name="148062052"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353773%20erroneous%20loop%20diagnostic/near/148062052" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353773.20erroneous.20loop.20diagnostic.html#148062052">(Nov 20 2018 at 19:38)</a>:</h4>
<p><code>first borrow later used here</code></p>



<a name="148062078"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353773%20erroneous%20loop%20diagnostic/near/148062078" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353773.20erroneous.20loop.20diagnostic.html#148062078">(Nov 20 2018 at 19:39)</a>:</h4>
<p>and same here <a href="https://github.com/rust-lang/rust/blob/master/src/test/ui/borrowck/borrowck-mut-borrow-linear-errors.mir.stderr#L16" target="_blank" title="https://github.com/rust-lang/rust/blob/master/src/test/ui/borrowck/borrowck-mut-borrow-linear-errors.mir.stderr#L16">https://github.com/rust-lang/rust/blob/master/src/test/ui/borrowck/borrowck-mut-borrow-linear-errors.mir.stderr#L16</a></p>



<a name="148062221"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353773%20erroneous%20loop%20diagnostic/near/148062221" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353773.20erroneous.20loop.20diagnostic.html#148062221">(Nov 20 2018 at 19:41)</a>:</h4>
<p>I don't understand that example to be honest</p>



<a name="148062223"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353773%20erroneous%20loop%20diagnostic/near/148062223" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353773.20erroneous.20loop.20diagnostic.html#148062223">(Nov 20 2018 at 19:41)</a>:</h4>
<p>what's wrong with it in nll mode?</p>



<a name="148062412"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353773%20erroneous%20loop%20diagnostic/near/148062412" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353773.20erroneous.20loop.20diagnostic.html#148062412">(Nov 20 2018 at 19:43)</a>:</h4>
<p>also, the borrow and the use are siblings in the graph so I'm never going to reach one from the other one</p>



<a name="148062940"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353773%20erroneous%20loop%20diagnostic/near/148062940" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353773.20erroneous.20loop.20diagnostic.html#148062940">(Nov 20 2018 at 19:51)</a>:</h4>
<p>opened PR meanwhile we discuss <a href="https://github.com/rust-lang/rust/pull/56113" target="_blank" title="https://github.com/rust-lang/rust/pull/56113">https://github.com/rust-lang/rust/pull/56113</a></p>



<a name="148063523"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353773%20erroneous%20loop%20diagnostic/near/148063523" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353773.20erroneous.20loop.20diagnostic.html#148063523">(Nov 20 2018 at 19:59)</a>:</h4>
<blockquote>
<p><code>first borrow later used here</code></p>
</blockquote>
<p>i.e., it no longer says "in later iteration of loop"?</p>



<a name="148063528"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353773%20erroneous%20loop%20diagnostic/near/148063528" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353773.20erroneous.20loop.20diagnostic.html#148063528">(Nov 20 2018 at 19:59)</a>:</h4>
<p>seems like it still <em>should</em> say that</p>



<a name="148063530"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353773%20erroneous%20loop%20diagnostic/near/148063530" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353773.20erroneous.20loop.20diagnostic.html#148063530">(Nov 20 2018 at 19:59)</a>:</h4>
<p>let me check the PR</p>



<a name="148064065"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353773%20erroneous%20loop%20diagnostic/near/148064065" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353773.20erroneous.20loop.20diagnostic.html#148064065">(Nov 20 2018 at 20:06)</a>:</h4>
<p><span class="user-mention" data-user-id="116009">@nikomatsakis</span> isn't it because borrow and use are siblings?</p>



<a name="148064097"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353773%20erroneous%20loop%20diagnostic/near/148064097" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353773.20erroneous.20loop.20diagnostic.html#148064097">(Nov 20 2018 at 20:06)</a>:</h4>
<p>never going to reach the arm of the match</p>



<a name="148064402"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353773%20erroneous%20loop%20diagnostic/near/148064402" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353773.20erroneous.20loop.20diagnostic.html#148064402">(Nov 20 2018 at 20:11)</a>:</h4>
<p>yes, so it <em>should</em> print the message</p>



<a name="148064406"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353773%20erroneous%20loop%20diagnostic/near/148064406" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353773.20erroneous.20loop.20diagnostic.html#148064406">(Nov 20 2018 at 20:11)</a>:</h4>
<p>i.e., if one can't reach the other without going through the loop</p>



<a name="148064445"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353773%20erroneous%20loop%20diagnostic/near/148064445" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353773.20erroneous.20loop.20diagnostic.html#148064445">(Nov 20 2018 at 20:12)</a>:</h4>
<p>then you say "in later iteration of loop</p>



<a name="148064823"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353773%20erroneous%20loop%20diagnostic/near/148064823" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353773.20erroneous.20loop.20diagnostic.html#148064823">(Nov 20 2018 at 20:19)</a>:</h4>
<p>left a first round of nits<br>
<a href="https://github.com/rust-lang/rust/pull/56113#pullrequestreview-176955464" target="_blank" title="https://github.com/rust-lang/rust/pull/56113#pullrequestreview-176955464">https://github.com/rust-lang/rust/pull/56113#pullrequestreview-176955464</a></p>



<a name="148064945"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353773%20erroneous%20loop%20diagnostic/near/148064945" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353773.20erroneous.20loop.20diagnostic.html#148064945">(Nov 20 2018 at 20:20)</a>:</h4>
<blockquote>
<p>i.e., if one can't reach the other without going through the loop</p>
</blockquote>
<p>didn't understand what you mean here</p>



<a name="148065003"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353773%20erroneous%20loop%20diagnostic/near/148065003" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353773.20erroneous.20loop.20diagnostic.html#148065003">(Nov 20 2018 at 20:21)</a>:</h4>
<p>shouldn't we also print if the borrow itself is inside the loop? as it was done before</p>



<a name="148065109"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353773%20erroneous%20loop%20diagnostic/near/148065109" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353773.20erroneous.20loop.20diagnostic.html#148065109">(Nov 20 2018 at 20:22)</a>:</h4>
<p>nope</p>



<a name="148065113"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353773%20erroneous%20loop%20diagnostic/near/148065113" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353773.20erroneous.20loop.20diagnostic.html#148065113">(Nov 20 2018 at 20:22)</a>:</h4>
<p>that's not really interesting</p>



<a name="148065148"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353773%20erroneous%20loop%20diagnostic/near/148065148" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353773.20erroneous.20loop.20diagnostic.html#148065148">(Nov 20 2018 at 20:23)</a>:</h4>
<p>I mean the idea is to capture sort of surprising flow</p>



<a name="148065152"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353773%20erroneous%20loop%20diagnostic/near/148065152" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353773.20erroneous.20loop.20diagnostic.html#148065152">(Nov 20 2018 at 20:23)</a>:</h4>
<p>if you see</p>



<a name="148065244"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353773%20erroneous%20loop%20diagnostic/near/148065244" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353773.20erroneous.20loop.20diagnostic.html#148065244">(Nov 20 2018 at 20:24)</a>:</h4>
<div class="codehilite"><pre><span></span><span class="w">  </span><span class="o">|</span><span class="w"> </span><span class="n">read</span><span class="p">(</span><span class="n">p</span><span class="p">);</span><span class="w"></span>
<span class="w">  </span><span class="o">|</span><span class="w">      </span><span class="o">-</span><span class="w"> </span><span class="err">`</span><span class="n">x</span><span class="err">`</span><span class="w"> </span><span class="n">later</span><span class="w"> </span><span class="n">used</span><span class="w"> </span><span class="n">here</span><span class="w"></span>
<span class="w">  </span><span class="o">|</span><span class="w"> </span><span class="n">p</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">&amp;</span><span class="n">x</span><span class="p">;</span><span class="w"></span>
<span class="w">  </span><span class="o">|</span><span class="w">      </span><span class="o">^</span><span class="w"> </span><span class="err">`</span><span class="n">x</span><span class="err">`</span><span class="w"> </span><span class="n">borrowed</span><span class="w"> </span><span class="n">here</span><span class="w"></span>
</pre></div>



<a name="148065249"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353773%20erroneous%20loop%20diagnostic/near/148065249" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353773.20erroneous.20loop.20diagnostic.html#148065249">(Nov 20 2018 at 20:24)</a>:</h4>
<p>it's a bit "surprising" because the use appears to come first</p>



<a name="148065255"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353773%20erroneous%20loop%20diagnostic/near/148065255" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353773.20erroneous.20loop.20diagnostic.html#148065255">(Nov 20 2018 at 20:24)</a>:</h4>
<p>that is why we want to note "because of a loop"</p>



<a name="148065273"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353773%20erroneous%20loop%20diagnostic/near/148065273" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353773.20erroneous.20loop.20diagnostic.html#148065273">(Nov 20 2018 at 20:25)</a>:</h4>
<p>but if you see <code>p = &amp;x; .. read(p);</code>, you don't really care if that's within a loop or not</p>



<a name="148065308"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353773%20erroneous%20loop%20diagnostic/near/148065308" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353773.20erroneous.20loop.20diagnostic.html#148065308">(Nov 20 2018 at 20:25)</a>:</h4>
<p>yeah, that makes sense</p>



<a name="148065335"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353773%20erroneous%20loop%20diagnostic/near/148065335" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353773.20erroneous.20loop.20diagnostic.html#148065335">(Nov 20 2018 at 20:25)</a>:</h4>
<p>what I don't see then is what's going on in those examples where changed the output</p>



<a name="148065564"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353773%20erroneous%20loop%20diagnostic/near/148065564" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353773.20erroneous.20loop.20diagnostic.html#148065564">(Nov 20 2018 at 20:28)</a>:</h4>
<p>as I commented on your PR, I think you just need to invert the sense of the <code>if</code></p>



<a name="148065575"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353773%20erroneous%20loop%20diagnostic/near/148065575" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353773.20erroneous.20loop.20diagnostic.html#148065575">(Nov 20 2018 at 20:28)</a>:</h4>
<p>that is, you are saying "print the loop message if there IS a path from borrow to use"</p>



<a name="148065579"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353773%20erroneous%20loop%20diagnostic/near/148065579" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353773.20erroneous.20loop.20diagnostic.html#148065579">(Nov 20 2018 at 20:28)</a>:</h4>
<p>but I think we want to print it there is NOT a path</p>



<a name="148065595"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353773%20erroneous%20loop%20diagnostic/near/148065595" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353773.20erroneous.20loop.20diagnostic.html#148065595">(Nov 20 2018 at 20:29)</a>:</h4>
<p>or at least, no path that doesn't require backedges</p>



<a name="148065622"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353773%20erroneous%20loop%20diagnostic/near/148065622" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353773.20erroneous.20loop.20diagnostic.html#148065622">(Nov 20 2018 at 20:29)</a>:</h4>
<p>ok, let me check all that</p>



<a name="148066284"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353773%20erroneous%20loop%20diagnostic/near/148066284" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353773.20erroneous.20loop.20diagnostic.html#148066284">(Nov 20 2018 at 20:38)</a>:</h4>
<p><span class="user-mention" data-user-id="116009">@nikomatsakis</span> I didn't understand your feedback about visited_locations</p>



<a name="148066286"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353773%20erroneous%20loop%20diagnostic/near/148066286" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353773.20erroneous.20loop.20diagnostic.html#148066286">(Nov 20 2018 at 20:38)</a>:</h4>
<p><a href="https://github.com/rust-lang/rust/pull/56113#discussion_r235154167" target="_blank" title="https://github.com/rust-lang/rust/pull/56113#discussion_r235154167">https://github.com/rust-lang/rust/pull/56113#discussion_r235154167</a></p>



<a name="148066294"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353773%20erroneous%20loop%20diagnostic/near/148066294" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353773.20erroneous.20loop.20diagnostic.html#148066294">(Nov 20 2018 at 20:39)</a>:</h4>
<p>should I change to a FxHashSet or remove it?</p>



<a name="148066300"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353773%20erroneous%20loop%20diagnostic/near/148066300" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353773.20erroneous.20loop.20diagnostic.html#148066300">(Nov 20 2018 at 20:39)</a>:</h4>
<p>keep it, make it a set</p>



<a name="148066303"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353773%20erroneous%20loop%20diagnostic/near/148066303" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353773.20erroneous.20loop.20diagnostic.html#148066303">(Nov 20 2018 at 20:39)</a>:</h4>
<p>if I should remove it, why?</p>



<a name="148066308"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353773%20erroneous%20loop%20diagnostic/near/148066308" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353773.20erroneous.20loop.20diagnostic.html#148066308">(Nov 20 2018 at 20:39)</a>:</h4>
<p>a vector is just a poor choice of data structure for this</p>



<a name="148066312"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353773%20erroneous%20loop%20diagnostic/near/148066312" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353773.20erroneous.20loop.20diagnostic.html#148066312">(Nov 20 2018 at 20:39)</a>:</h4>
<p>yes</p>



<a name="148066313"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353773%20erroneous%20loop%20diagnostic/near/148066313" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353773.20erroneous.20loop.20diagnostic.html#148066313">(Nov 20 2018 at 20:39)</a>:</h4>
<p>agree</p>



<a name="148066315"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353773%20erroneous%20loop%20diagnostic/near/148066315" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353773.20erroneous.20loop.20diagnostic.html#148066315">(Nov 20 2018 at 20:39)</a>:</h4>
<p>but what about this <a href="https://github.com/rust-lang/rust/pull/56113#discussion_r235154222" target="_blank" title="https://github.com/rust-lang/rust/pull/56113#discussion_r235154222">https://github.com/rust-lang/rust/pull/56113#discussion_r235154222</a> ?</p>



<a name="148066660"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353773%20erroneous%20loop%20diagnostic/near/148066660" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353773.20erroneous.20loop.20diagnostic.html#148066660">(Nov 20 2018 at 20:44)</a>:</h4>
<p><span class="user-mention" data-user-id="116009">@nikomatsakis</span> I guess you regretted of that comment?</p>



<a name="148066724"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353773%20erroneous%20loop%20diagnostic/near/148066724" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353773.20erroneous.20loop.20diagnostic.html#148066724">(Nov 20 2018 at 20:45)</a>:</h4>
<p>I guess you did the if hash_set.insert thing :)</p>



<a name="148066729"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353773%20erroneous%20loop%20diagnostic/near/148066729" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353773.20erroneous.20loop.20diagnostic.html#148066729">(Nov 20 2018 at 20:45)</a>:</h4>
<p><span class="emoji emoji-1f44d" title="+1">:+1:</span></p>



<a name="148066824"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353773%20erroneous%20loop%20diagnostic/near/148066824" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353773.20erroneous.20loop.20diagnostic.html#148066824">(Nov 20 2018 at 20:47)</a>:</h4>
<p>no I mean you don't need that</p>



<a name="148066828"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353773%20erroneous%20loop%20diagnostic/near/148066828" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353773.20erroneous.20loop.20diagnostic.html#148066828">(Nov 20 2018 at 20:47)</a>:</h4>
<p>if you check instead later on</p>



<a name="148066832"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353773%20erroneous%20loop%20diagnostic/near/148066832" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353773.20erroneous.20loop.20diagnostic.html#148066832">(Nov 20 2018 at 20:47)</a>:</h4>
<p>when you do the <code>insert</code></p>



<a name="148066835"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353773%20erroneous%20loop%20diagnostic/near/148066835" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353773.20erroneous.20loop.20diagnostic.html#148066835">(Nov 20 2018 at 20:47)</a>:</h4>
<p>i.e., this code checks when you remove things from the stack</p>



<a name="148066839"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353773%20erroneous%20loop%20diagnostic/near/148066839" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353773.20erroneous.20loop.20diagnostic.html#148066839">(Nov 20 2018 at 20:47)</a>:</h4>
<p>but it's better to check before you put them on</p>



<a name="148066842"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353773%20erroneous%20loop%20diagnostic/near/148066842" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353773.20erroneous.20loop.20diagnostic.html#148066842">(Nov 20 2018 at 20:47)</a>:</h4>
<p>otherwise, you can grow the stack with a lot of duplicates</p>



<a name="148066844"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353773%20erroneous%20loop%20diagnostic/near/148066844" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353773.20erroneous.20loop.20diagnostic.html#148066844">(Nov 20 2018 at 20:47)</a>:</h4>
<p>not super important but...</p>



<a name="148066846"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353773%20erroneous%20loop%20diagnostic/near/148066846" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353773.20erroneous.20loop.20diagnostic.html#148066846">(Nov 20 2018 at 20:47)</a>:</h4>
<p>..it irks me:P</p>



<a name="148067138"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353773%20erroneous%20loop%20diagnostic/near/148067138" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353773.20erroneous.20loop.20diagnostic.html#148067138">(Nov 20 2018 at 20:51)</a>:</h4>
<p>yes yes</p>



<a name="148067142"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353773%20erroneous%20loop%20diagnostic/near/148067142" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353773.20erroneous.20loop.20diagnostic.html#148067142">(Nov 20 2018 at 20:51)</a>:</h4>
<p>figured out after asking</p>



<a name="148067144"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353773%20erroneous%20loop%20diagnostic/near/148067144" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353773.20erroneous.20loop.20diagnostic.html#148067144">(Nov 20 2018 at 20:51)</a>:</h4>
<p>makes sense</p>



<a name="148067203"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353773%20erroneous%20loop%20diagnostic/near/148067203" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353773.20erroneous.20loop.20diagnostic.html#148067203">(Nov 20 2018 at 20:52)</a>:</h4>
<p>that happens to me for copying code without paying a lot of attention ;)</p>



<a name="148067457"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353773%20erroneous%20loop%20diagnostic/near/148067457" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353773.20erroneous.20loop.20diagnostic.html#148067457">(Nov 20 2018 at 20:56)</a>:</h4>
<p>=)</p>



<a name="148068445"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353773%20erroneous%20loop%20diagnostic/near/148068445" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353773.20erroneous.20loop.20diagnostic.html#148068445">(Nov 20 2018 at 21:11)</a>:</h4>
<p>made all the changes the issue still adds in later iteration of loop :(</p>



<a name="148068582"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353773%20erroneous%20loop%20diagnostic/near/148068582" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353773.20erroneous.20loop.20diagnostic.html#148068582">(Nov 20 2018 at 21:13)</a>:</h4>
<p>let me take a look</p>



<a name="148068609"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353773%20erroneous%20loop%20diagnostic/near/148068609" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353773.20erroneous.20loop.20diagnostic.html#148068609">(Nov 20 2018 at 21:14)</a>:</h4>
<p>can you push <span class="user-mention" data-user-id="116266">@Santiago Pastorino</span> to <a href="https://github.com/rust-lang/rust/issues/56113" target="_blank" title="https://github.com/rust-lang/rust/issues/56113">#56113</a> ?</p>



<a name="148068680"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353773%20erroneous%20loop%20diagnostic/near/148068680" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353773.20erroneous.20loop.20diagnostic.html#148068680">(Nov 20 2018 at 21:14)</a>:</h4>
<p>done</p>



<a name="148068833"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353773%20erroneous%20loop%20diagnostic/near/148068833" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353773.20erroneous.20loop.20diagnostic.html#148068833">(Nov 20 2018 at 21:16)</a>:</h4>
<p>forgot to remove the skip locations if</p>



<a name="148068836"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353773%20erroneous%20loop%20diagnostic/near/148068836" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353773.20erroneous.20loop.20diagnostic.html#148068836">(Nov 20 2018 at 21:16)</a>:</h4>
<p>but still that shouldn't make any difference</p>



<a name="148068882"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353773%20erroneous%20loop%20diagnostic/near/148068882" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353773.20erroneous.20loop.20diagnostic.html#148068882">(Nov 20 2018 at 21:18)</a>:</h4>
<p>!location.dominates shouldn't be just location.dominates?</p>



<a name="148068936"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353773%20erroneous%20loop%20diagnostic/near/148068936" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353773.20erroneous.20loop.20diagnostic.html#148068936">(Nov 20 2018 at 21:18)</a>:</h4>
<p>because you're filtering those</p>



<a name="148069187"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353773%20erroneous%20loop%20diagnostic/near/148069187" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353773.20erroneous.20loop.20diagnostic.html#148069187">(Nov 20 2018 at 21:21)</a>:</h4>
<p>(deleted)</p>



<a name="148071276"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353773%20erroneous%20loop%20diagnostic/near/148071276" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353773.20erroneous.20loop.20diagnostic.html#148071276">(Nov 20 2018 at 21:57)</a>:</h4>
<p><span class="user-mention" data-user-id="116009">@nikomatsakis</span> I was wrong in what I've said, still doesn't work</p>



<a name="148071798"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353773%20erroneous%20loop%20diagnostic/near/148071798" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353773.20erroneous.20loop.20diagnostic.html#148071798">(Nov 20 2018 at 22:05)</a>:</h4>
<p>I meant, anyway, the posted code still doesn't work</p>



<a name="148073390"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353773%20erroneous%20loop%20diagnostic/near/148073390" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353773.20erroneous.20loop.20diagnostic.html#148073390">(Nov 20 2018 at 22:33)</a>:</h4>
<p><span class="user-mention" data-user-id="116009">@nikomatsakis</span> and also there are a lot of failures with that code :( <a href="https://github.com/rust-lang/rust/pull/56113#issuecomment-440452364" target="_blank" title="https://github.com/rust-lang/rust/pull/56113#issuecomment-440452364">https://github.com/rust-lang/rust/pull/56113#issuecomment-440452364</a></p>



<a name="148073892"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353773%20erroneous%20loop%20diagnostic/near/148073892" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353773.20erroneous.20loop.20diagnostic.html#148073892">(Nov 20 2018 at 22:41)</a>:</h4>
<p><span class="user-mention" data-user-id="116266">@Santiago Pastorino</span> <a href="https://github.com/rust-lang/rust/pull/56113#pullrequestreview-177006673" target="_blank" title="https://github.com/rust-lang/rust/pull/56113#pullrequestreview-177006673">see comments here</a></p>



<a name="148075117"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353773%20erroneous%20loop%20diagnostic/near/148075117" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353773.20erroneous.20loop.20diagnostic.html#148075117">(Nov 20 2018 at 23:03)</a>:</h4>
<p>still same issue</p>



<a name="148075187"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353773%20erroneous%20loop%20diagnostic/near/148075187" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353773.20erroneous.20loop.20diagnostic.html#148075187">(Nov 20 2018 at 23:04)</a>:</h4>
<p>pushed</p>



<a name="148106963"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353773%20erroneous%20loop%20diagnostic/near/148106963" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353773.20erroneous.20loop.20diagnostic.html#148106963">(Nov 21 2018 at 12:34)</a>:</h4>
<p><span class="user-mention" data-user-id="116009">@nikomatsakis</span> 2 existing examples fail and the new test still says in later iteration of loop</p>



<a name="148106964"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353773%20erroneous%20loop%20diagnostic/near/148106964" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353773.20erroneous.20loop.20diagnostic.html#148106964">(Nov 21 2018 at 12:34)</a>:</h4>
<p><a href="https://travis-ci.org/rust-lang/rust/jobs/457696480" target="_blank" title="https://travis-ci.org/rust-lang/rust/jobs/457696480">https://travis-ci.org/rust-lang/rust/jobs/457696480</a></p>



<a name="148106971"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353773%20erroneous%20loop%20diagnostic/near/148106971" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353773.20erroneous.20loop.20diagnostic.html#148106971">(Nov 21 2018 at 12:34)</a>:</h4>
<p>if you have any other tip let me know, I'm going to debug this later</p>



<a name="148130749"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353773%20erroneous%20loop%20diagnostic/near/148130749" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353773.20erroneous.20loop.20diagnostic.html#148130749">(Nov 21 2018 at 18:59)</a>:</h4>
<p><span class="user-mention" data-user-id="116266">@Santiago Pastorino</span> yeah I'm not quite sure</p>



<a name="148130753"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353773%20erroneous%20loop%20diagnostic/near/148130753" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353773.20erroneous.20loop.20diagnostic.html#148130753">(Nov 21 2018 at 18:59)</a>:</h4>
<p>I'll have to do a local build I guess</p>



<a name="148133818"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353773%20erroneous%20loop%20diagnostic/near/148133818" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353773.20erroneous.20loop.20diagnostic.html#148133818">(Nov 21 2018 at 19:58)</a>:</h4>
<p><span class="user-mention" data-user-id="116009">@nikomatsakis</span> <span class="emoji emoji-1f44d" title="+1">:+1:</span></p>



<a name="148133827"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353773%20erroneous%20loop%20diagnostic/near/148133827" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353773.20erroneous.20loop.20diagnostic.html#148133827">(Nov 21 2018 at 19:58)</a>:</h4>
<p>I guess maybe tomorrow I can start debugging this</p>



<a name="148632039"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353773%20erroneous%20loop%20diagnostic/near/148632039" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353773.20erroneous.20loop.20diagnostic.html#148632039">(Nov 27 2018 at 11:25)</a>:</h4>
<p><span class="user-mention" data-user-id="116009">@nikomatsakis</span> we need to discuss about this issue :)</p>



<a name="148632042"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353773%20erroneous%20loop%20diagnostic/near/148632042" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353773.20erroneous.20loop.20diagnostic.html#148632042">(Nov 27 2018 at 11:25)</a>:</h4>
<p>not sure what exactly should I do now</p>



<a name="148632276"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353773%20erroneous%20loop%20diagnostic/near/148632276" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353773.20erroneous.20loop.20diagnostic.html#148632276">(Nov 27 2018 at 11:30)</a>:</h4>
<p>saw the discussion on Discord but I saw that <span class="user-mention" data-user-id="119009">@eddyb</span> was not ok with adding info to the CFG</p>



<a name="148632283"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353773%20erroneous%20loop%20diagnostic/near/148632283" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353773.20erroneous.20loop.20diagnostic.html#148632283">(Nov 27 2018 at 11:31)</a>:</h4>
<p>dunno what to do to fix that then :)</p>



<a name="148632426"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353773%20erroneous%20loop%20diagnostic/near/148632426" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> eddyb <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353773.20erroneous.20loop.20diagnostic.html#148632426">(Nov 27 2018 at 11:34)</a>:</h4>
<p>I'd defer to <span class="user-mention" data-user-id="116009">@nikomatsakis</span> - it might not be that bad, we already have "false edges" and whatnot</p>



<a name="148632455"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353773%20erroneous%20loop%20diagnostic/near/148632455" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ariel Ben-Yehuda <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353773.20erroneous.20loop.20diagnostic.html#148632455">(Nov 27 2018 at 11:35)</a>:</h4>
<p>false edges are normative, while this is only for diagnostics</p>



<a name="148644796"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353773%20erroneous%20loop%20diagnostic/near/148644796" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353773.20erroneous.20loop.20diagnostic.html#148644796">(Nov 27 2018 at 15:25)</a>:</h4>
<p>Yeah, we should discuss. I personally lean against modifying the MIR, but I guess we should decide how good a job we want to do.</p>
<p>One option might be to modify the way that we print the diagnostic, such that it makes sense in either scenario</p>



<a name="148644801"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353773%20erroneous%20loop%20diagnostic/near/148644801" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353773.20erroneous.20loop.20diagnostic.html#148644801">(Nov 27 2018 at 15:25)</a>:</h4>
<p>Another option might be to be more conservative</p>



<a name="148644808"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353773%20erroneous%20loop%20diagnostic/near/148644808" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353773.20erroneous.20loop.20diagnostic.html#148644808">(Nov 27 2018 at 15:25)</a>:</h4>
<p>Another option is to consider the "lexical scoping" information</p>



<a name="148644922"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353773%20erroneous%20loop%20diagnostic/near/148644922" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353773.20erroneous.20loop.20diagnostic.html#148644922">(Nov 27 2018 at 15:27)</a>:</h4>
<p>each statement has a <a href="https://doc.rust-lang.org/nightly/nightly-rustc/rustc/mir/struct.Statement.html#structfield.source_info" target="_blank" title="https://doc.rust-lang.org/nightly/nightly-rustc/rustc/mir/struct.Statement.html#structfield.source_info"><code>source_info</code></a>, we could check whether the <code>scope</code> of the backedge target includes the <code>scope</code> of the backedge source (in which case, they are part of the same loop from the user's POV)</p>



<a name="148644930"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353773%20erroneous%20loop%20diagnostic/near/148644930" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353773.20erroneous.20loop.20diagnostic.html#148644930">(Nov 27 2018 at 15:27)</a>:</h4>
<p>not sure if scopes are that complete, maybe <span class="user-mention" data-user-id="119009">@eddyb</span> or <span class="user-mention" data-user-id="126804">@Ariel Ben-Yehuda</span> remembers</p>



<a name="148645021"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353773%20erroneous%20loop%20diagnostic/near/148645021" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353773.20erroneous.20loop.20diagnostic.html#148645021">(Nov 27 2018 at 15:28)</a>:</h4>
<blockquote>
<p>One option might be to modify the way that we print the diagnostic, such that it makes sense in either scenario</p>
</blockquote>
<p>For example:</p>
<div class="codehilite"><pre><span></span>error[E0713]: borrow may still be in use when destructor runs
  --&gt; src/main.rs:24:22
   |
23 |    for child in archive.iter() {
   |    --- after the borrow, code flows around this loop to reach the use
24 |         members.push(child.raw);
   |                      ^^^^^^^^^
25 |     }
   |     - here, drop of `child` needs exclusive access to `*child.raw`, because the type `C&lt;&#39;_&gt;` implements the `Drop` trait
26 |     members.len();
   |     ------- borrow used here

error: aborting due to previous error
</pre></div>



<a name="148645070"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353773%20erroneous%20loop%20diagnostic/near/148645070" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> eddyb <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353773.20erroneous.20loop.20diagnostic.html#148645070">(Nov 27 2018 at 15:29)</a>:</h4>
<p>we usually emit scopes after <code>let</code>/inside <code>match</code></p>



<a name="148645195"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353773%20erroneous%20loop%20diagnostic/near/148645195" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353773.20erroneous.20loop.20diagnostic.html#148645195">(Nov 27 2018 at 15:31)</a>:</h4>
<p>I guess we could easily add scopes for loops</p>



<a name="148645211"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353773%20erroneous%20loop%20diagnostic/near/148645211" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> eddyb <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353773.20erroneous.20loop.20diagnostic.html#148645211">(Nov 27 2018 at 15:31)</a>:</h4>
<p>I think it's possible the scope check might make sense, although <span class="user-mention" data-user-id="126804">@Ariel Ben-Yehuda</span> and <span class="user-mention" data-user-id="116118">@Matthew Jasper</span>  found that the only use of <code>visibility_scope</code> in MIR borrowck was redundant (on top of being confusing)</p>



<a name="148645258"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353773%20erroneous%20loop%20diagnostic/near/148645258" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353773.20erroneous.20loop.20diagnostic.html#148645258">(Nov 27 2018 at 15:32)</a>:</h4>
<p>otherwise, I guess we would add some sort of "no-op" statement that marks exiting a loop?</p>



<a name="148645265"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353773%20erroneous%20loop%20diagnostic/near/148645265" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353773.20erroneous.20loop.20diagnostic.html#148645265">(Nov 27 2018 at 15:32)</a>:</h4>
<p>I think that's what <span class="user-mention" data-user-id="126804">@Ariel Ben-Yehuda</span> proposed</p>



<a name="148645307"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353773%20erroneous%20loop%20diagnostic/near/148645307" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353773.20erroneous.20loop.20diagnostic.html#148645307">(Nov 27 2018 at 15:33)</a>:</h4>
<p>I'm wondering about cases like this:</p>
<div class="codehilite"><pre><span></span>loop {
    if something {
        while something_else {
            p = &amp;foo;
        }
    } else {
        foo += 1;
        use(p);
    }
}
</pre></div>



<a name="148645321"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353773%20erroneous%20loop%20diagnostic/near/148645321" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353773.20erroneous.20loop.20diagnostic.html#148645321">(Nov 27 2018 at 15:33)</a>:</h4>
<p>here, my scope proposal would not print any message, but arguably you should</p>



<a name="148645369"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353773%20erroneous%20loop%20diagnostic/near/148645369" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353773.20erroneous.20loop.20diagnostic.html#148645369">(Nov 27 2018 at 15:34)</a>:</h4>
<p>(otoh I think people can sometimes figure this stuff out, it doens't have to be <em>perfect</em>)</p>



<a name="148645385"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353773%20erroneous%20loop%20diagnostic/near/148645385" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353773.20erroneous.20loop.20diagnostic.html#148645385">(Nov 27 2018 at 15:35)</a>:</h4>
<p>well, the scope proposal <em>could</em> figure it out</p>



<a name="148645394"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353773%20erroneous%20loop%20diagnostic/near/148645394" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353773.20erroneous.20loop.20diagnostic.html#148645394">(Nov 27 2018 at 15:35)</a>:</h4>
<p>you'd have to track the 'outermost scope' of the backedges you took</p>



<a name="148652532"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353773%20erroneous%20loop%20diagnostic/near/148652532" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353773.20erroneous.20loop.20diagnostic.html#148652532">(Nov 27 2018 at 17:13)</a>:</h4>
<blockquote>
<p>Yeah, we should discuss. I personally lean against modifying the MIR, but I guess we should decide how good a job we want to do.</p>
<p>One option might be to modify the way that we print the diagnostic, such that it makes sense in either scenario</p>
</blockquote>
<p>I may be completely wrong but can't we just use a separate structure for this? like a bitset where cfg nodes are labelled as this node is the head of the loop and then in diagnostics you look for it, so is separated from the mir?</p>



<a name="148652612"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353773%20erroneous%20loop%20diagnostic/near/148652612" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353773.20erroneous.20loop.20diagnostic.html#148652612">(Nov 27 2018 at 17:14)</a>:</h4>
<p>maybe I got incorrectly what you mean by modifying the mir :)</p>



<a name="148657604"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353773%20erroneous%20loop%20diagnostic/near/148657604" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> eddyb <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353773.20erroneous.20loop.20diagnostic.html#148657604">(Nov 27 2018 at 18:24)</a>:</h4>
<p>the real questions are "why do you want that kind of precise AST shape information?" and "can you talk about the code without referring to specific syntax?"</p>



<a name="148657674"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353773%20erroneous%20loop%20diagnostic/near/148657674" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353773.20erroneous.20loop.20diagnostic.html#148657674">(Nov 27 2018 at 18:25)</a>:</h4>
<blockquote>
<p>maybe I got incorrectly what you mean by modifying the mir :)</p>
</blockquote>
<p>well, that's a kind of modification -- adding a "side channel" for more information</p>



<a name="148666463"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353773%20erroneous%20loop%20diagnostic/near/148666463" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ariel Ben-Yehuda <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353773.20erroneous.20loop.20diagnostic.html#148666463">(Nov 27 2018 at 20:42)</a>:</h4>
<p>The problem with relying on scopes of back-edges is that scopes of Goto instructions can get scrambled pretty well.</p>



<a name="148666501"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353773%20erroneous%20loop%20diagnostic/near/148666501" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ariel Ben-Yehuda <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353773.20erroneous.20loop.20diagnostic.html#148666501">(Nov 27 2018 at 20:43)</a>:</h4>
<p>in the simplify-cfg pass. We could try maintaining them better, but that feels like more of a hack than having a specific "loop header" statement.</p>



<a name="148666514"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353773%20erroneous%20loop%20diagnostic/near/148666514" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ariel Ben-Yehuda <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353773.20erroneous.20loop.20diagnostic.html#148666514">(Nov 27 2018 at 20:43)</a>:</h4>
<p>BTW, in that case you can use the source_info.scope and don't need the visibility_scope - loops are lexically scoped.</p>



<a name="148666970"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353773%20erroneous%20loop%20diagnostic/near/148666970" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ariel Ben-Yehuda <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353773.20erroneous.20loop.20diagnostic.html#148666970">(Nov 27 2018 at 20:50)</a>:</h4>
<p>So the main Q is whether we want to make sure that the source-info of back-edges always represents the source-info of their loop through simplifycfg, or whether we prefer to have loop header statements with the source-info of the loop.</p>



<a name="148747929"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353773%20erroneous%20loop%20diagnostic/near/148747929" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353773.20erroneous.20loop.20diagnostic.html#148747929">(Nov 28 2018 at 22:10)</a>:</h4>
<p>so yeah, what would be a nice idea to try then?</p>



<a name="148747944"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353773%20erroneous%20loop%20diagnostic/near/148747944" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353773.20erroneous.20loop.20diagnostic.html#148747944">(Nov 28 2018 at 22:11)</a>:</h4>
<p>maybe we can try a first simple approach so we fix this and leave an issue to improve?</p>



<a name="148747949"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353773%20erroneous%20loop%20diagnostic/near/148747949" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353773.20erroneous.20loop.20diagnostic.html#148747949">(Nov 28 2018 at 22:11)</a>:</h4>
<p>unsure if that would solve something</p>



<a name="148748950"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353773%20erroneous%20loop%20diagnostic/near/148748950" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353773.20erroneous.20loop.20diagnostic.html#148748950">(Nov 28 2018 at 22:28)</a>:</h4>
<p>so I was thinking if we can find cases that are "unambiguously correct". Basically that would mean finding out that (a) borrow and use are part of the same loop and (b) the borrow cannot reach the use except through a backedge.</p>
<p>I think that would suffice, but it would mean that if you have something that "appears" to be nested in the loop, but breaks out, it doesn't get a message.</p>
<p>But how to decide if they are in the same loop?</p>
<p>I was imagining something like: </p>
<ul>
<li>If the borrow reaches the use through the backedge B</li>
<li>and the use can also reach that backedge without going through any backedges</li>
</ul>



<a name="148748955"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353773%20erroneous%20loop%20diagnostic/near/148748955" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353773.20erroneous.20loop.20diagnostic.html#148748955">(Nov 28 2018 at 22:28)</a>:</h4>
<p>that's not quite right around nested loops I don't think</p>



<a name="148748965"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353773%20erroneous%20loop%20diagnostic/near/148748965" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353773.20erroneous.20loop.20diagnostic.html#148748965">(Nov 28 2018 at 22:29)</a>:</h4>
<p><span class="user-mention" data-user-id="116266">@Santiago Pastorino</span> <span class="emoji emoji-1f446" title="point up">:point_up:</span></p>



<a name="148751745"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353773%20erroneous%20loop%20diagnostic/near/148751745" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ariel Ben-Yehuda <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353773.20erroneous.20loop.20diagnostic.html#148751745">(Nov 28 2018 at 23:18)</a>:</h4>
<p>That would miss the case when there is a return after the <code>use</code></p>
<div class="codehilite"><pre><span></span>let x;
let t = 0;
loop {
    if * {
        return t;
    } else {
        x = &amp;t;
    }
}
</pre></div>



<a name="148752135"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353773%20erroneous%20loop%20diagnostic/near/148752135" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ariel Ben-Yehuda <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353773.20erroneous.20loop.20diagnostic.html#148752135">(Nov 28 2018 at 23:26)</a>:</h4>
<p>and, if implemented stupidly, also the case when there are 2 backedges going to the same place (just a loop with an if).</p>



<a name="148788009"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353773%20erroneous%20loop%20diagnostic/near/148788009" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353773.20erroneous.20loop.20diagnostic.html#148788009">(Nov 29 2018 at 14:00)</a>:</h4>
<p>I am aware that it would miss that case, it seems "ok"</p>



<a name="148788027"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353773%20erroneous%20loop%20diagnostic/near/148788027" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353773.20erroneous.20loop.20diagnostic.html#148788027">(Nov 29 2018 at 14:00)</a>:</h4>
<p>basically I was saying "we could do this without any fancy work and it will be helpful sometimes and not un-helpful othertimes"</p>



<a name="148788034"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353773%20erroneous%20loop%20diagnostic/near/148788034" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353773.20erroneous.20loop.20diagnostic.html#148788034">(Nov 29 2018 at 14:00)</a>:</h4>
<p>I think longer term I would like to think a bit more about our presentation anyway</p>



<a name="148788044"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353773%20erroneous%20loop%20diagnostic/near/148788044" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353773.20erroneous.20loop.20diagnostic.html#148788044">(Nov 29 2018 at 14:01)</a>:</h4>
<p>as I don't think this message is <em>especially</em> clear to people</p>



<a name="148788157"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353773%20erroneous%20loop%20diagnostic/near/148788157" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353773.20erroneous.20loop.20diagnostic.html#148788157">(Nov 29 2018 at 14:02)</a>:</h4>
<p>still <span class="user-mention" data-user-id="126804">@Ariel Ben-Yehuda</span> can you expand a bit on your loop header idea? it doesn't seem enough to me to just have a "loop header block" -- or did you mean for that to be the start of the loop <em>body</em> I guess? so the idea would be if we can't reach the use without going through the start of the loop <em>body</em>?</p>
<p>but does that handle a case like this?</p>
<div class="codehilite"><pre><span></span><span class="k">loop</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="n">condition</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">        </span><span class="k">break</span><span class="p">;</span><span class="w"></span>
<span class="w">    </span><span class="p">}</span><span class="w"></span>
<span class="w">    </span><span class="o">*</span><span class="n">borrow</span><span class="o">*</span><span class="p">;</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>
<span class="o">*</span><span class="k">use</span><span class="p">;</span><span class="o">*</span><span class="w"></span>
</pre></div>



<a name="148788199"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353773%20erroneous%20loop%20diagnostic/near/148788199" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> pnkfelix <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353773.20erroneous.20loop.20diagnostic.html#148788199">(Nov 29 2018 at 14:03)</a>:</h4>
<p>clearly the answer is more dataflow <span class="emoji emoji-1f609" title="wink">:wink:</span></p>



<a name="148788205"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353773%20erroneous%20loop%20diagnostic/near/148788205" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353773.20erroneous.20loop.20diagnostic.html#148788205">(Nov 29 2018 at 14:03)</a>:</h4>
<p>I still sort of wonder if we can't just present the control flow in a way that doesn't talk about "loops" per se -- e.g., </p>
<ul>
<li>borrow occurs here</li>
<li>then we head back to the top of the loop here</li>
<li>then we reach the use from there</li>
</ul>
<p>or something.</p>



<a name="148788254"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353773%20erroneous%20loop%20diagnostic/near/148788254" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353773.20erroneous.20loop.20diagnostic.html#148788254">(Nov 29 2018 at 14:04)</a>:</h4>
<p>but it feels like just only saying ", in previous iteration of loop" when we <em>know</em> it is appropriate is "ok"</p>



<a name="148788260"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353773%20erroneous%20loop%20diagnostic/near/148788260" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353773.20erroneous.20loop.20diagnostic.html#148788260">(Nov 29 2018 at 14:04)</a>:</h4>
<p>(if we can indeed find suitably narrow criteria)</p>



<a name="148788725"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353773%20erroneous%20loop%20diagnostic/near/148788725" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353773.20erroneous.20loop.20diagnostic.html#148788725">(Nov 29 2018 at 14:12)</a>:</h4>
<p>I guess at the end of the day I am probably happy to go either way, though I'd like to see a complete proposal. It seems to me that some sort of "loop exit" blocks probably suffice. Maybe <span class="user-mention" data-user-id="126804">@Ariel Ben-Yehuda</span> wrote it in a comment I should go and re-read.</p>
<p>I just feel a <em>bit</em> reluctant to add more statements into the MIR "just" for diagnostics. It feels like something that could have some unexpected complication down the line, though I guess these sort of "no-op" statements are particularly unlikely to cause problems, since we can always strip them out.</p>
<p>It also seems to me that we are encoding lexical information, which is sort of the same as the unsafe check, so maybe it's inconsistent that we do so differently? (Like, why <em>not</em> use a "scope" to encode whether this statement was "part of" a loop or not?)</p>



<a name="148788918"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353773%20erroneous%20loop%20diagnostic/near/148788918" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353773.20erroneous.20loop.20diagnostic.html#148788918">(Nov 29 2018 at 14:15)</a>:</h4>
<p>Regarding my earlier proposal:</p>
<ul>
<li>The idea was to first land a PR that "stems the bleeding". Stop doing the wrong thing. Print the message when we know we can, and print nothing otherwise.</li>
<li>Then we can open an issue to decide how to handle the remaining cases (if at all)<br>
    - we can document them too for posterity's sake =)</li>
</ul>



<a name="148788923"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353773%20erroneous%20loop%20diagnostic/near/148788923" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353773.20erroneous.20loop.20diagnostic.html#148788923">(Nov 29 2018 at 14:15)</a>:</h4>
<p>it seems I never actually wrote that second part out explicitly :P but it was on my mind</p>



<a name="148794328"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353773%20erroneous%20loop%20diagnostic/near/148794328" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ariel Ben-Yehuda <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353773.20erroneous.20loop.20diagnostic.html#148794328">(Nov 29 2018 at 15:32)</a>:</h4>
<p>The idea was to also use the source-info of the loop header statement</p>



<a name="148794395"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353773%20erroneous%20loop%20diagnostic/near/148794395" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ariel Ben-Yehuda <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353773.20erroneous.20loop.20diagnostic.html#148794395">(Nov 29 2018 at 15:33)</a>:</h4>
<p>to check whether a point is within a loop</p>



<a name="148794465"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353773%20erroneous%20loop%20diagnostic/near/148794465" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ariel Ben-Yehuda <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353773.20erroneous.20loop.20diagnostic.html#148794465">(Nov 29 2018 at 15:34)</a>:</h4>
<p>Y is "across the loop" from X iff there exists a loop header H such that<br>
a) X and Y are both in a subscope of H<br>
2) every path from X to Y goes through H</p>



<a name="148794611"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353773%20erroneous%20loop%20diagnostic/near/148794611" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ariel Ben-Yehuda <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353773.20erroneous.20loop.20diagnostic.html#148794611">(Nov 29 2018 at 15:36)</a>:</h4>
<p>the loop header is just a place where we can slap the loop scope</p>



<a name="148796952"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353773%20erroneous%20loop%20diagnostic/near/148796952" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353773.20erroneous.20loop.20diagnostic.html#148796952">(Nov 29 2018 at 16:07)</a>:</h4>
<p>oh, ok, that makes sense</p>



<a name="148797019"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353773%20erroneous%20loop%20diagnostic/near/148797019" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353773.20erroneous.20loop.20diagnostic.html#148797019">(Nov 29 2018 at 16:08)</a>:</h4>
<p>so we are ultimately using scope, but we are just making a fixed statement for it</p>



<a name="148797035"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353773%20erroneous%20loop%20diagnostic/near/148797035" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353773.20erroneous.20loop.20diagnostic.html#148797035">(Nov 29 2018 at 16:08)</a>:</h4>
<p>(versus, say, putting some scope on the basic block, which is also possible)</p>



<a name="148879668"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353773%20erroneous%20loop%20diagnostic/near/148879668" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353773.20erroneous.20loop.20diagnostic.html#148879668">(Nov 30 2018 at 18:36)</a>:</h4>
<p><span class="user-mention" data-user-id="116009">@nikomatsakis</span> I've implemented your conservative idea</p>



<a name="148879672"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353773%20erroneous%20loop%20diagnostic/near/148879672" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353773.20erroneous.20loop.20diagnostic.html#148879672">(Nov 30 2018 at 18:36)</a>:</h4>
<p>how's it work :)</p>



<a name="148879687"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353773%20erroneous%20loop%20diagnostic/near/148879687" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353773.20erroneous.20loop.20diagnostic.html#148879687">(Nov 30 2018 at 18:36)</a>:</h4>
<p>for now the code is gross</p>



<a name="148879691"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353773%20erroneous%20loop%20diagnostic/near/148879691" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353773.20erroneous.20loop.20diagnostic.html#148879691">(Nov 30 2018 at 18:36)</a>:</h4>
<p>have repeated some stuff over</p>



<a name="148879700"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353773%20erroneous%20loop%20diagnostic/near/148879700" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353773.20erroneous.20loop.20diagnostic.html#148879700">(Nov 30 2018 at 18:37)</a>:</h4>
<p>I just wanted to check if it worked or not</p>



<a name="148879711"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353773%20erroneous%20loop%20diagnostic/near/148879711" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353773.20erroneous.20loop.20diagnostic.html#148879711">(Nov 30 2018 at 18:37)</a>:</h4>
<p>I'm getting a couple of changes</p>



<a name="148879733"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353773%20erroneous%20loop%20diagnostic/near/148879733" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353773.20erroneous.20loop.20diagnostic.html#148879733">(Nov 30 2018 at 18:37)</a>:</h4>
<div class="codehilite"><pre><span></span>diff --git a/src/test/ui/borrowck/borrowck-lend-flow-loop.nll.stderr b/src/test/ui/borrowck/borrowck-lend-flow-loop.nll.stderr
index 19de3582c88..396fd6ffa0c 100644
--- a/src/test/ui/borrowck/borrowck-lend-flow-loop.nll.stderr
+++ b/src/test/ui/borrowck/borrowck-lend-flow-loop.nll.stderr
@@ -8,13 +8,13 @@ LL |         borrow(&amp;*v); //[ast]~ ERROR cannot borrow
    |                ^^^ immutable borrow occurs here
 ...
 LL |     *x = box 5;
-   |     -- mutable borrow used here, in later iteration of loop
+   |     -- mutable borrow later used here

 error[E0502]: cannot borrow `*v` as immutable because it is also borrowed as mutable
   --&gt; $DIR/borrowck-lend-flow-loop.rs:109:16
    |
 LL |         **x += 1;
-   |         -------- mutable borrow used here, in later iteration of loop
+   |         -------- mutable borrow later used here
 LL |         borrow(&amp;*v); //[ast]~ ERROR cannot borrow
    |                ^^^ immutable borrow occurs here
 ...
diff --git a/src/test/ui/borrowck/borrowck-mut-borrow-linear-errors.mir.stderr b/src/test/ui/borrowck/borrowck-mut-borrow-linear-errors.mir.stderr
index 5301ee7a403..3b56c00145c 100644
--- a/src/test/ui/borrowck/borrowck-mut-borrow-linear-errors.mir.stderr
+++ b/src/test/ui/borrowck/borrowck-mut-borrow-linear-errors.mir.stderr
@@ -4,7 +4,7 @@ error[E0499]: cannot borrow `x` as mutable more than once at a time
 LL |             1 =&gt; { addr.push(&amp;mut x); } //[ast]~ ERROR [E0499]
    |                    ----      ^^^^^^ second mutable borrow occurs here
    |                    |
-   |                    first borrow used here, in later iteration of loop
+   |                    first borrow later used here
 ...
 LL |             _ =&gt; { addr.push(&amp;mut x); } //[ast]~ ERROR [E0499]
    |                              ------ first mutable borrow occurs here
@@ -13,7 +13,7 @@ error[E0499]: cannot borrow `x` as mutable more than once at a time
   --&gt; $DIR/borrowck-mut-borrow-linear-errors.rs:25:30
    |
 LL |             1 =&gt; { addr.push(&amp;mut x); } //[ast]~ ERROR [E0499]
-   |                    ---- first borrow used here, in later iteration of loop
+   |                    ---- first borrow later used here
 LL |             //[mir]~^ ERROR [E0499]
 LL |             2 =&gt; { addr.push(&amp;mut x); } //[ast]~ ERROR [E0499]
    |                              ^^^^^^ second mutable borrow occurs here
</pre></div>



<a name="148879865"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353773%20erroneous%20loop%20diagnostic/near/148879865" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353773.20erroneous.20loop.20diagnostic.html#148879865">(Nov 30 2018 at 18:39)</a>:</h4>
<p>actually the first one is right</p>



<a name="148879881"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353773%20erroneous%20loop%20diagnostic/near/148879881" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353773.20erroneous.20loop.20diagnostic.html#148879881">(Nov 30 2018 at 18:39)</a>:</h4>
<div class="codehilite"><pre><span></span><span class="k">fn</span> <span class="nf">block_overarching_alias_mut</span><span class="p">()</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="c1">// In this instance, the borrow encompasses the entire closure call.</span>

<span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="k">mut</span><span class="w"> </span><span class="n">v</span>: <span class="nb">Box</span><span class="o">&lt;</span><span class="n">_</span><span class="o">&gt;</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">box</span><span class="w"> </span><span class="mi">3</span><span class="p">;</span><span class="w"></span>
<span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="k">mut</span><span class="w"> </span><span class="n">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">&amp;</span><span class="k">mut</span><span class="w"> </span><span class="n">v</span><span class="p">;</span><span class="w"></span>
<span class="w">    </span><span class="k">for</span><span class="w"> </span><span class="n">_</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="mi">0</span><span class="p">..</span><span class="mi">3</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">        </span><span class="n">borrow</span><span class="p">(</span><span class="o">&amp;*</span><span class="n">v</span><span class="p">);</span><span class="w"> </span><span class="c1">//[ast]~ ERROR cannot borrow</span>
<span class="w">        </span><span class="c1">//[nll]~^ ERROR cannot borrow</span>
<span class="w">    </span><span class="p">}</span><span class="w"></span>
<span class="w">    </span><span class="o">*</span><span class="n">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">box</span><span class="w"> </span><span class="mi">5</span><span class="p">;</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>
</pre></div>



<a name="148879932"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353773%20erroneous%20loop%20diagnostic/near/148879932" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353773.20erroneous.20loop.20diagnostic.html#148879932">(Nov 30 2018 at 18:39)</a>:</h4>
<p>it's actually the thing we needed to test</p>



<a name="148879989"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353773%20erroneous%20loop%20diagnostic/near/148879989" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353773.20erroneous.20loop.20diagnostic.html#148879989">(Nov 30 2018 at 18:40)</a>:</h4>
<div class="codehilite"><pre><span></span> LL |     *x = box 5;
-   |     -- mutable borrow used here, in later iteration of loop
+   |     -- mutable borrow later used here
</pre></div>



<a name="148879998"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353773%20erroneous%20loop%20diagnostic/near/148879998" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353773.20erroneous.20loop.20diagnostic.html#148879998">(Nov 30 2018 at 18:40)</a>:</h4>
<p>so first it mentioned in later iteration of loop and now it doesn't</p>



<a name="148880021"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353773%20erroneous%20loop%20diagnostic/near/148880021" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353773.20erroneous.20loop.20diagnostic.html#148880021">(Nov 30 2018 at 18:41)</a>:</h4>
<p>then</p>



<a name="148880024"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353773%20erroneous%20loop%20diagnostic/near/148880024" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353773.20erroneous.20loop.20diagnostic.html#148880024">(Nov 30 2018 at 18:41)</a>:</h4>
<div class="codehilite"><pre><span></span><span class="k">fn</span> <span class="nf">while_aliased_mut_cond</span><span class="p">(</span><span class="n">cond</span>: <span class="kt">bool</span><span class="p">,</span><span class="w"> </span><span class="n">cond2</span>: <span class="kt">bool</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="k">mut</span><span class="w"> </span><span class="n">v</span>: <span class="nb">Box</span><span class="o">&lt;</span><span class="n">_</span><span class="o">&gt;</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">box</span><span class="w"> </span><span class="mi">3</span><span class="p">;</span><span class="w"></span>
<span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="k">mut</span><span class="w"> </span><span class="n">w</span>: <span class="nb">Box</span><span class="o">&lt;</span><span class="n">_</span><span class="o">&gt;</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">box</span><span class="w"> </span><span class="mi">4</span><span class="p">;</span><span class="w"></span>
<span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="k">mut</span><span class="w"> </span><span class="n">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">&amp;</span><span class="k">mut</span><span class="w"> </span><span class="n">w</span><span class="p">;</span><span class="w"></span>
<span class="w">    </span><span class="k">while</span><span class="w"> </span><span class="n">cond</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">        </span><span class="o">**</span><span class="n">x</span><span class="w"> </span><span class="o">+=</span><span class="w"> </span><span class="mi">1</span><span class="p">;</span><span class="w"></span>
<span class="w">        </span><span class="n">borrow</span><span class="p">(</span><span class="o">&amp;*</span><span class="n">v</span><span class="p">);</span><span class="w"> </span><span class="c1">//[ast]~ ERROR cannot borrow</span>
<span class="w">        </span><span class="c1">//[nll]~^ ERROR cannot borrow</span>
<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="n">cond2</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">            </span><span class="n">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">&amp;</span><span class="k">mut</span><span class="w"> </span><span class="n">v</span><span class="p">;</span><span class="w"> </span><span class="c1">//[ast]~ ERROR cannot borrow</span>
<span class="w">        </span><span class="p">}</span><span class="w"></span>
<span class="w">    </span><span class="p">}</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>
</pre></div>



<a name="148880035"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353773%20erroneous%20loop%20diagnostic/near/148880035" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353773.20erroneous.20loop.20diagnostic.html#148880035">(Nov 30 2018 at 18:41)</a>:</h4>
<div class="codehilite"><pre><span></span> LL |         **x += 1;
-   |         -------- mutable borrow used here, in later iteration of loop
+   |         -------- mutable borrow later used here
</pre></div>



<a name="148880038"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353773%20erroneous%20loop%20diagnostic/near/148880038" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353773.20erroneous.20loop.20diagnostic.html#148880038">(Nov 30 2018 at 18:41)</a>:</h4>
<p>it's wrong</p>



<a name="148880388"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353773%20erroneous%20loop%20diagnostic/near/148880388" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353773.20erroneous.20loop.20diagnostic.html#148880388">(Nov 30 2018 at 18:47)</a>:</h4>
<p>:)</p>



<a name="148880409"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353773%20erroneous%20loop%20diagnostic/near/148880409" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353773.20erroneous.20loop.20diagnostic.html#148880409">(Nov 30 2018 at 18:47)</a>:</h4>
<p>I'm filtering backedges but I want to find a path that ends in a backedge, need to avoid filtering that one</p>



<a name="148880531"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353773%20erroneous%20loop%20diagnostic/near/148880531" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353773.20erroneous.20loop.20diagnostic.html#148880531">(Nov 30 2018 at 18:49)</a>:</h4>
<p>hmm</p>



<a name="148880542"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353773%20erroneous%20loop%20diagnostic/near/148880542" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353773.20erroneous.20loop.20diagnostic.html#148880542">(Nov 30 2018 at 18:49)</a>:</h4>
<p>that seems lke "the classic" case</p>



<a name="148880549"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353773%20erroneous%20loop%20diagnostic/near/148880549" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353773.20erroneous.20loop.20diagnostic.html#148880549">(Nov 30 2018 at 18:49)</a>:</h4>
<p>what rule did you implement exactly, <span class="user-mention" data-user-id="116266">@Santiago Pastorino</span> ? :)</p>



<a name="148880636"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353773%20erroneous%20loop%20diagnostic/near/148880636" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353773.20erroneous.20loop.20diagnostic.html#148880636">(Nov 30 2018 at 18:50)</a>:</h4>
<blockquote>
<p>I was imagining something like: </p>
<ul>
<li>If the borrow reaches the use through the backedge B</li>
<li>and the use can also reach that backedge without going through any backedges</li>
</ul>
</blockquote>
<p>This one</p>



<a name="148880778"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353773%20erroneous%20loop%20diagnostic/near/148880778" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353773.20erroneous.20loop.20diagnostic.html#148880778">(Nov 30 2018 at 18:53)</a>:</h4>
<p>hmm, it feels like it should work for that example</p>



<a name="148880785"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353773%20erroneous%20loop%20diagnostic/near/148880785" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353773.20erroneous.20loop.20diagnostic.html#148880785">(Nov 30 2018 at 18:53)</a>:</h4>
<p>did you update the PR?</p>



<a name="148880813"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353773%20erroneous%20loop%20diagnostic/near/148880813" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353773.20erroneous.20loop.20diagnostic.html#148880813">(Nov 30 2018 at 18:53)</a>:</h4>
<p>no</p>



<a name="148880819"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353773%20erroneous%20loop%20diagnostic/near/148880819" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353773.20erroneous.20loop.20diagnostic.html#148880819">(Nov 30 2018 at 18:53)</a>:</h4>
<p>but I found the issue</p>



<a name="148880877"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353773%20erroneous%20loop%20diagnostic/near/148880877" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353773.20erroneous.20loop.20diagnostic.html#148880877">(Nov 30 2018 at 18:54)</a>:</h4>
<p>maybe I wrote a bit weird and you didn't figure that :)</p>



<a name="148880880"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353773%20erroneous%20loop%20diagnostic/near/148880880" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353773.20erroneous.20loop.20diagnostic.html#148880880">(Nov 30 2018 at 18:54)</a>:</h4>
<blockquote>
<p>I'm filtering backedges but I want to find a path that ends in a backedge, need to avoid filtering that one</p>
</blockquote>



<a name="148880883"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353773%20erroneous%20loop%20diagnostic/near/148880883" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353773.20erroneous.20loop.20diagnostic.html#148880883">(Nov 30 2018 at 18:54)</a>:</h4>
<p>have already added that</p>



<a name="148880888"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353773%20erroneous%20loop%20diagnostic/near/148880888" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353773.20erroneous.20loop.20diagnostic.html#148880888">(Nov 30 2018 at 18:54)</a>:</h4>
<p>running tests again</p>



<a name="148881056"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353773%20erroneous%20loop%20diagnostic/near/148881056" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353773.20erroneous.20loop.20diagnostic.html#148881056">(Nov 30 2018 at 18:57)</a>:</h4>
<p><span class="user-mention" data-user-id="116009">@nikomatsakis</span> added the thing but didn't make any difference</p>



<a name="148881320"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353773%20erroneous%20loop%20diagnostic/near/148881320" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353773.20erroneous.20loop.20diagnostic.html#148881320">(Nov 30 2018 at 19:01)</a>:</h4>
<p>what do you mean by didn't make any difference?</p>



<a name="148881402"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353773%20erroneous%20loop%20diagnostic/near/148881402" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353773.20erroneous.20loop.20diagnostic.html#148881402">(Nov 30 2018 at 19:02)</a>:</h4>
<p>that it's still wrong</p>



<a name="148881418"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353773%20erroneous%20loop%20diagnostic/near/148881418" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353773.20erroneous.20loop.20diagnostic.html#148881418">(Nov 30 2018 at 19:02)</a>:</h4>
<p>the change I added was</p>



<a name="148881421"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353773%20erroneous%20loop%20diagnostic/near/148881421" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353773.20erroneous.20loop.20diagnostic.html#148881421">(Nov 30 2018 at 19:02)</a>:</h4>
<div class="codehilite"><pre><span></span>-                        .filter(|s| !self.is_back_edge(location, *s))
+                        .filter(|s| !self.is_back_edge(location, *s) || to_any.contains(s))
</pre></div>



<a name="148881429"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353773%20erroneous%20loop%20diagnostic/near/148881429" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353773.20erroneous.20loop.20diagnostic.html#148881429">(Nov 30 2018 at 19:03)</a>:</h4>
<p>with that contains or without it, I get the same results</p>



<a name="148881437"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353773%20erroneous%20loop%20diagnostic/near/148881437" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353773.20erroneous.20loop.20diagnostic.html#148881437">(Nov 30 2018 at 19:03)</a>:</h4>
<p>have pushed in case you want to check out</p>



<a name="148881579"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353773%20erroneous%20loop%20diagnostic/near/148881579" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353773.20erroneous.20loop.20diagnostic.html#148881579">(Nov 30 2018 at 19:04)</a>:</h4>
<p>ok</p>



<a name="148881770"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353773%20erroneous%20loop%20diagnostic/near/148881770" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353773.20erroneous.20loop.20diagnostic.html#148881770">(Nov 30 2018 at 19:07)</a>:</h4>
<p>I found a thing that is wrong but shouldn't make any difference</p>



<a name="148881861"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353773%20erroneous%20loop%20diagnostic/near/148881861" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353773.20erroneous.20loop.20diagnostic.html#148881861">(Nov 30 2018 at 19:08)</a>:</h4>
<p><span class="user-mention" data-user-id="116266">@Santiago Pastorino</span> <a href="https://github.com/rust-lang/rust/pull/56113/files#r237969618" target="_blank" title="https://github.com/rust-lang/rust/pull/56113/files#r237969618">maybe this</a>?</p>



<a name="148881893"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353773%20erroneous%20loop%20diagnostic/near/148881893" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353773.20erroneous.20loop.20diagnostic.html#148881893">(Nov 30 2018 at 19:09)</a>:</h4>
<p>right, that's the issue</p>



<a name="148881895"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353773%20erroneous%20loop%20diagnostic/near/148881895" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353773.20erroneous.20loop.20diagnostic.html#148881895">(Nov 30 2018 at 19:09)</a>:</h4>
<p>and also</p>



<a name="148881901"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353773%20erroneous%20loop%20diagnostic/near/148881901" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353773.20erroneous.20loop.20diagnostic.html#148881901">(Nov 30 2018 at 19:09)</a>:</h4>
<p>that if is wrong, right?</p>



<a name="148881910"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353773%20erroneous%20loop%20diagnostic/near/148881910" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353773.20erroneous.20loop.20diagnostic.html#148881910">(Nov 30 2018 at 19:09)</a>:</h4>
<p>this <a href="https://github.com/rust-lang/rust/pull/56113/files#diff-fe005d3dcf77fde8f189617b2599e10eR340" target="_blank" title="https://github.com/rust-lang/rust/pull/56113/files#diff-fe005d3dcf77fde8f189617b2599e10eR340">https://github.com/rust-lang/rust/pull/56113/files#diff-fe005d3dcf77fde8f189617b2599e10eR340</a> is always false</p>



<a name="148882140"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353773%20erroneous%20loop%20diagnostic/near/148882140" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353773.20erroneous.20loop.20diagnostic.html#148882140">(Nov 30 2018 at 19:13)</a>:</h4>
<p><span class="user-mention" data-user-id="116009">@nikomatsakis</span> <span class="emoji emoji-261d" title="wait one second">:wait_one_second:</span></p>



<a name="148888912"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353773%20erroneous%20loop%20diagnostic/near/148888912" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353773.20erroneous.20loop.20diagnostic.html#148888912">(Nov 30 2018 at 20:59)</a>:</h4>
<p>any more attempts, <span class="user-mention" data-user-id="116266">@Santiago Pastorino</span> ?</p>



<a name="148896026"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353773%20erroneous%20loop%20diagnostic/near/148896026" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353773.20erroneous.20loop.20diagnostic.html#148896026">(Nov 30 2018 at 23:03)</a>:</h4>
<p><span class="user-mention" data-user-id="116009">@nikomatsakis</span> I left since we've talked</p>



<a name="148896070"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353773%20erroneous%20loop%20diagnostic/near/148896070" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353773.20erroneous.20loop.20diagnostic.html#148896070">(Nov 30 2018 at 23:04)</a>:</h4>
<p>gonna see if I have a couple of minutes to try again</p>



<a name="150682969"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353773%20erroneous%20loop%20diagnostic/near/150682969" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353773.20erroneous.20loop.20diagnostic.html#150682969">(Dec 01 2018 at 13:05)</a>:</h4>
<p>I'm consistently hitting this ...</p>



<a name="150682970"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353773%20erroneous%20loop%20diagnostic/near/150682970" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353773.20erroneous.20loop.20diagnostic.html#150682970">(Dec 01 2018 at 13:05)</a>:</h4>
<div class="codehilite"><pre><span></span>error: Could not compile `rustc`.

To learn more, run the command again with --verbose.
command did not execute successfully: &quot;/home/santiago/src/oss/rust1/build/x86_64-unknown-linux-gnu/stage0/bin/cargo&quot; &quot;build&quot; &quot;--target&quot; &quot;x86_64-unknown-linux-gnu&quot; &quot;-j&quot; &quot;4&quot; &quot;--release&quot; &quot;--features&quot; &quot;&quot; &quot;--manifest-path&quot; &quot;/home/santiago/src/oss/rust1/src/rustc/Cargo.toml&quot; &quot;--message-format&quot; &quot;json&quot;
expected success, got: exit code: 101
thread &#39;main&#39; panicked at &#39;cargo must succeed&#39;, bootstrap/compile.rs:1101:9
stack backtrace:
   0:     0x556b86761a9f - std::sys::unix::backtrace::tracing::imp::unwind_backtrace::h3c55afa80a996a32
                               at libstd/sys/unix/backtrace/tracing/gcc_s.rs:49
   1:     0x556b8676ed47 - std::sys_common::backtrace::print::hcef907ea7a07cd40
                               at libstd/sys_common/backtrace.rs:71
                               at libstd/sys_common/backtrace.rs:59
   2:     0x556b8676784f - std::panicking::default_hook::{{closure}}::hf541876c65f36ea7
                               at libstd/panicking.rs:211
   3:     0x556b867675b4 - std::panicking::default_hook::h4ecc06b30ae4459d
                               at libstd/panicking.rs:227
   4:     0x556b86767f2e - std::panicking::rust_panic_with_hook::h0cc6d9cc9f34a947
                               at libstd/panicking.rs:476
   5:     0x556b86740027 - std::panicking::begin_panic::he4089b50490d89cc
                               at libstd/panicking.rs:410
   6:     0x556b85fb242a - bootstrap::compile::run_cargo::h24b31fcf4cc848dc
                               at bootstrap/compile.rs:1101
   7:     0x556b85faa84a - &lt;bootstrap::compile::Rustc as bootstrap::builder::Step&gt;::run::h5a63412c57dc1205
                               at bootstrap/compile.rs:503
   8:     0x556b8636a544 - bootstrap::builder::Builder::ensure::h059931c28a4fae58
                               at bootstrap/builder.rs:1215
   9:     0x556b85fb03b7 - &lt;bootstrap::compile::Assemble as bootstrap::builder::Step&gt;::run::hb1adf09f74ea3290
                               at bootstrap/compile.rs:959
  10:     0x556b86471d54 - bootstrap::builder::Builder::ensure::hf971c4454e83cc78
                               at bootstrap/builder.rs:1215
  11:     0x556b86496079 - bootstrap::builder::Builder::compiler::h261980de65d32f94
                               at bootstrap/builder.rs:579
  12:     0x556b85fa55f6 - &lt;bootstrap::compile::Std as bootstrap::builder::Step&gt;::make_run::h5b3c0a1480f5473a
                               at bootstrap/compile.rs:55
  13:     0x556b86491400 - bootstrap::builder::StepDescription::maybe_run::h4cbaeb9b41a83a82
                               at bootstrap/builder.rs:191
  14:     0x556b86491fd4 - bootstrap::builder::StepDescription::run::h81efe27184fab9ba
                               at bootstrap/builder.rs:234
  15:     0x556b86496028 - bootstrap::builder::Builder::run_step_descriptions::h15ca74516d14f99b
                               at bootstrap/builder.rs:571
  16:     0x556b86495e6a - bootstrap::builder::Builder::execute_cli::h2b142c7158a4cf31
                               at bootstrap/builder.rs:561
  17:     0x556b85d9ae66 - bootstrap::Build::build::h9b1d15d32ff16426
                               at bootstrap/lib.rs:479
  18:     0x556b85cf7414 - bootstrap::main::h4e2538703a968edf
                               at bootstrap/bin/main.rs:29
  19:     0x556b85cf751f - std::rt::lang_start::{{closure}}::h89db4fb3346f68bc
                               at libstd/rt.rs:74
  20:     0x556b86767952 - std::panicking::try::do_call::h203c4989fde7f201
                               at libstd/rt.rs:59
                               at libstd/panicking.rs:310
  21:     0x556b86779f79 - __rust_maybe_catch_panic
                               at libpanic_unwind/lib.rs:102
  22:     0x556b8674f40a - std::rt::lang_start_internal::h80fd76ad39d9c8d9
                               at libstd/panicking.rs:289
                               at libstd/panic.rs:392
                               at libstd/rt.rs:58
  23:     0x556b85cf74f8 - std::rt::lang_start::he4ebe066ecf58bc3
                               at libstd/rt.rs:74
  24:     0x556b85cf7499 - main
  25:     0x7fc8e7717222 - __libc_start_main
  26:     0x556b85cf725d - _start
  27:                0x0 - &lt;unknown&gt;
failed to run: /home/santiago/src/oss/rust1/build/bootstrap/debug/bootstrap build -i --stage 1 --keep-stage 1 src/libstd
Build completed unsuccessfully in 0:04:41
``
</pre></div>



<a name="150697616"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353773%20erroneous%20loop%20diagnostic/near/150697616" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353773.20erroneous.20loop.20diagnostic.html#150697616">(Dec 01 2018 at 21:28)</a>:</h4>
<p><span class="user-mention" data-user-id="116009">@nikomatsakis</span> pushed for you to review, there are some tests that changed the output though</p>



<a name="150697618"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353773%20erroneous%20loop%20diagnostic/near/150697618" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353773.20erroneous.20loop.20diagnostic.html#150697618">(Dec 01 2018 at 21:28)</a>:</h4>
<p>the first one I think is more correct</p>



<a name="150697619"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353773%20erroneous%20loop%20diagnostic/near/150697619" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353773.20erroneous.20loop.20diagnostic.html#150697619">(Dec 01 2018 at 21:28)</a>:</h4>
<p>from the second one on the changes are also more correct because it's not in later iteration of loop, it's inside the loop but it's just later</p>



<a name="150697666"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353773%20erroneous%20loop%20diagnostic/near/150697666" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353773.20erroneous.20loop.20diagnostic.html#150697666">(Dec 01 2018 at 21:30)</a>:</h4>
<p>PR <a href="https://github.com/rust-lang/rust/pull/56113" target="_blank" title="https://github.com/rust-lang/rust/pull/56113">https://github.com/rust-lang/rust/pull/56113</a></p>



<a name="150697988"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353773%20erroneous%20loop%20diagnostic/near/150697988" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353773.20erroneous.20loop.20diagnostic.html#150697988">(Dec 01 2018 at 21:42)</a>:</h4>
<p><span class="user-mention" data-user-id="116009">@nikomatsakis</span> as I told you there is already three times where we are repeating a bfs search</p>



<a name="150697989"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353773%20erroneous%20loop%20diagnostic/near/150697989" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353773.20erroneous.20loop.20diagnostic.html#150697989">(Dec 01 2018 at 21:42)</a>:</h4>
<p>and this PR keeps adding ;)</p>



<a name="150697991"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353773%20erroneous%20loop%20diagnostic/near/150697991" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353773.20erroneous.20loop.20diagnostic.html#150697991">(Dec 01 2018 at 21:42)</a>:</h4>
<p>let me know if you want to refactor that as part of this PR or you just want to merge this and we can refactor as a separate thing</p>



<a name="150841404"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353773%20erroneous%20loop%20diagnostic/near/150841404" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353773.20erroneous.20loop.20diagnostic.html#150841404">(Dec 04 2018 at 11:51)</a>:</h4>
<p><span class="user-mention" data-user-id="116266">@Santiago Pastorino</span> say more about this "could not compile rustc" thing? did it go away?</p>



<a name="150841447"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353773%20erroneous%20loop%20diagnostic/near/150841447" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353773.20erroneous.20loop.20diagnostic.html#150841447">(Dec 04 2018 at 11:52)</a>:</h4>
<p>as it happens, I regularly hit a segfault in llvm that is baffling me (it never happens twice)</p>



<a name="150841449"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353773%20erroneous%20loop%20diagnostic/near/150841449" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353773.20erroneous.20loop.20diagnostic.html#150841449">(Dec 04 2018 at 11:52)</a>:</h4>
<p>I've been tracking backtraces</p>



<a name="150847909"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353773%20erroneous%20loop%20diagnostic/near/150847909" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353773.20erroneous.20loop.20diagnostic.html#150847909">(Dec 04 2018 at 13:57)</a>:</h4>
<p><span class="user-mention" data-user-id="116009">@nikomatsakis</span> it go away yes</p>



<a name="150847931"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353773%20erroneous%20loop%20diagnostic/near/150847931" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353773.20erroneous.20loop.20diagnostic.html#150847931">(Dec 04 2018 at 13:57)</a>:</h4>
<p>I think it’s the same issue I always hit</p>



<a name="150847941"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353773%20erroneous%20loop%20diagnostic/near/150847941" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353773.20erroneous.20loop.20diagnostic.html#150847941">(Dec 04 2018 at 13:57)</a>:</h4>
<p>related to memory</p>



<a name="150848047"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353773%20erroneous%20loop%20diagnostic/near/150848047" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353773.20erroneous.20loop.20diagnostic.html#150848047">(Dec 04 2018 at 13:58)</a>:</h4>
<p>ended shutting down computer and executing without even entering the ui, went straight to the console</p>



<a name="150848052"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353773%20erroneous%20loop%20diagnostic/near/150848052" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353773.20erroneous.20loop.20diagnostic.html#150848052">(Dec 04 2018 at 13:58)</a>:</h4>
<p>and removed build just in case</p>



<a name="150854964"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353773%20erroneous%20loop%20diagnostic/near/150854964" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353773.20erroneous.20loop.20diagnostic.html#150854964">(Dec 04 2018 at 15:28)</a>:</h4>
<p><span class="user-mention" data-user-id="116266">@Santiago Pastorino</span> so I think what <span class="user-mention" data-user-id="126804">@Ariel Ben-Yehuda</span> <a href="https://github.com/rust-lang/rust/pull/56113#discussion_r238454978" target="_blank" title="https://github.com/rust-lang/rust/pull/56113#discussion_r238454978">means here</a> is that the test they describe would be a better way to test "is this use part of the loop X" -- and I think I agree</p>



<a name="150854991"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353773%20erroneous%20loop%20diagnostic/near/150854991" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353773.20erroneous.20loop.20diagnostic.html#150854991">(Dec 04 2018 at 15:29)</a>:</h4>
<p>basically, we first find that the borrow B reaches the use U through some outermost backedge, right? the target L of that backedge is the "head" of the outermost loop</p>



<a name="150855011"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353773%20erroneous%20loop%20diagnostic/near/150855011" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353773.20erroneous.20loop.20diagnostic.html#150855011">(Dec 04 2018 at 15:30)</a>:</h4>
<p>er, that's confusingly written</p>



<a name="150855093"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353773%20erroneous%20loop%20diagnostic/near/150855093" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353773.20erroneous.20loop.20diagnostic.html#150855093">(Dec 04 2018 at 15:30)</a>:</h4>
<p>but basically we find that the borrow B can only reach the use U by going around some loop L</p>



<a name="150855097"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353773%20erroneous%20loop%20diagnostic/near/150855097" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353773.20erroneous.20loop.20diagnostic.html#150855097">(Dec 04 2018 at 15:30)</a>:</h4>
<p>and we want to check if the use U is also in that loop</p>



<a name="150855171"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353773%20erroneous%20loop%20diagnostic/near/150855171" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353773.20erroneous.20loop.20diagnostic.html#150855171">(Dec 04 2018 at 15:32)</a>:</h4>
<p>the check that <span class="user-mention" data-user-id="126804">@Ariel Ben-Yehuda</span> proposed is basically to do a DFS from the use forward, looking for the loop header, but stopping whenever we reach a node that is not dominated by the loop header (which therefore falls outside the loop)</p>



<a name="150942641"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353773%20erroneous%20loop%20diagnostic/near/150942641" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353773.20erroneous.20loop.20diagnostic.html#150942641">(Dec 05 2018 at 16:49)</a>:</h4>
<p><span class="user-mention" data-user-id="116009">@nikomatsakis</span> about this comment <a href="https://github.com/rust-lang/rust/pull/56113#discussion_r238454978" target="_blank" title="https://github.com/rust-lang/rust/pull/56113#discussion_r238454978">https://github.com/rust-lang/rust/pull/56113#discussion_r238454978</a> from <span class="user-mention" data-user-id="126804">@Ariel Ben-Yehuda</span>, so when he talks about <code>N</code> we are talking about the <code>use</code> but when he talks about <code>L</code> he is talking about the header of the loop and we were using the <code>borrow</code></p>



<a name="150942654"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353773%20erroneous%20loop%20diagnostic/near/150942654" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353773.20erroneous.20loop.20diagnostic.html#150942654">(Dec 05 2018 at 16:49)</a>:</h4>
<p>because if it is the header of the loop we are back to square 1, how can we get it?</p>



<a name="150942667"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353773%20erroneous%20loop%20diagnostic/near/150942667" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353773.20erroneous.20loop.20diagnostic.html#150942667">(Dec 05 2018 at 16:49)</a>:</h4>
<p>was reading the stuff on github, now I'm seeing your comments here which seems to clarify a bit :)</p>



<a name="150944334"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353773%20erroneous%20loop%20diagnostic/near/150944334" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353773.20erroneous.20loop.20diagnostic.html#150944334">(Dec 05 2018 at 17:10)</a>:</h4>
<blockquote>
<p>basically, we first find that the borrow B reaches the use U through some outermost backedge, right? the target L of that backedge is the "head" of the outermost loop</p>
</blockquote>
<p>so you meant that <code>L</code> is the thing we found?</p>



<a name="150944363"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353773%20erroneous%20loop%20diagnostic/near/150944363" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353773.20erroneous.20loop.20diagnostic.html#150944363">(Dec 05 2018 at 17:10)</a>:</h4>
<p>unsure what the target L of that backedge is the "head" of the outermost loop</p>



<a name="150944400"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353773%20erroneous%20loop%20diagnostic/near/150944400" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353773.20erroneous.20loop.20diagnostic.html#150944400">(Dec 05 2018 at 17:10)</a>:</h4>
<blockquote>
<p>but basically we find that the borrow B can only reach the use U by going around some loop L</p>
</blockquote>
<p>don't understand what some loop L means, I guess you're talking about the target of a backedge?</p>



<a name="150944437"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353773%20erroneous%20loop%20diagnostic/near/150944437" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353773.20erroneous.20loop.20diagnostic.html#150944437">(Dec 05 2018 at 17:11)</a>:</h4>
<blockquote>
<p>unsure what the target L of that backedge is the "head" of the outermost loop</p>
</blockquote>
<p>I think I see what you meant, so basically this is what we already did</p>



<a name="150944454"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353773%20erroneous%20loop%20diagnostic/near/150944454" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353773.20erroneous.20loop.20diagnostic.html#150944454">(Dec 05 2018 at 17:12)</a>:</h4>
<p><a href="https://github.com/rust-lang/rust/blob/34059401f4f1cb5ef0a0ec6a4d73503eb9d29eb9/src/librustc_mir/borrow_check/nll/explain_borrow/mod.rs#L299" target="_blank" title="https://github.com/rust-lang/rust/blob/34059401f4f1cb5ef0a0ec6a4d73503eb9d29eb9/src/librustc_mir/borrow_check/nll/explain_borrow/mod.rs#L299">https://github.com/rust-lang/rust/blob/34059401f4f1cb5ef0a0ec6a4d73503eb9d29eb9/src/librustc_mir/borrow_check/nll/explain_borrow/mod.rs#L299</a></p>



<a name="150944551"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353773%20erroneous%20loop%20diagnostic/near/150944551" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353773.20erroneous.20loop.20diagnostic.html#150944551">(Dec 05 2018 at 17:13)</a>:</h4>
<p>ok seems like I need to adapt the rest</p>



<a name="150944622"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353773%20erroneous%20loop%20diagnostic/near/150944622" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353773.20erroneous.20loop.20diagnostic.html#150944622">(Dec 05 2018 at 17:14)</a>:</h4>
<p><span class="user-mention" data-user-id="116009">@nikomatsakis</span> do we have a reusable dfs around?, what I've mainly is bfs used around</p>



<a name="150945260"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353773%20erroneous%20loop%20diagnostic/near/150945260" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353773.20erroneous.20loop.20diagnostic.html#150945260">(Dec 05 2018 at 17:25)</a>:</h4>
<p>this <a href="https://github.com/rust-lang/rust/blob/34059401f4f1cb5ef0a0ec6a4d73503eb9d29eb9/src/librustc_mir/borrow_check/error_reporting.rs#L1113" target="_blank" title="https://github.com/rust-lang/rust/blob/34059401f4f1cb5ef0a0ec6a4d73503eb9d29eb9/src/librustc_mir/borrow_check/error_reporting.rs#L1113">https://github.com/rust-lang/rust/blob/34059401f4f1cb5ef0a0ec6a4d73503eb9d29eb9/src/librustc_mir/borrow_check/error_reporting.rs#L1113</a> suggest a dfs given the label there but it's not really a dfs</p>



<a name="150945389"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353773%20erroneous%20loop%20diagnostic/near/150945389" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353773.20erroneous.20loop.20diagnostic.html#150945389">(Dec 05 2018 at 17:27)</a>:</h4>
<p>I mean, I can build one but don't want to keep adding repeated stuff :)</p>



<a name="150945445"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353773%20erroneous%20loop%20diagnostic/near/150945445" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353773.20erroneous.20loop.20diagnostic.html#150945445">(Dec 05 2018 at 17:28)</a>:</h4>
<p>generic bfs and dfs over locations seems something useful :)</p>



<a name="151007281"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353773%20erroneous%20loop%20diagnostic/near/151007281" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353773.20erroneous.20loop.20diagnostic.html#151007281">(Dec 06 2018 at 13:50)</a>:</h4>
<p><span class="user-mention" data-user-id="116266">@Santiago Pastorino</span> so -- was it clear what I meant by "Loop L" and all that?</p>



<a name="151012290"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353773%20erroneous%20loop%20diagnostic/near/151012290" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353773.20erroneous.20loop.20diagnostic.html#151012290">(Dec 06 2018 at 15:01)</a>:</h4>
<p>I don't think so</p>



<a name="154609519"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353773%20erroneous%20loop%20diagnostic/near/154609519" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353773.20erroneous.20loop.20diagnostic.html#154609519">(Jan 07 2019 at 23:17)</a>:</h4>
<p>have pushed something to see what the CI says <a href="https://github.com/rust-lang/rust/pull/56113" target="_blank" title="https://github.com/rust-lang/rust/pull/56113">https://github.com/rust-lang/rust/pull/56113</a></p>



<a name="154609523"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353773%20erroneous%20loop%20diagnostic/near/154609523" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353773.20erroneous.20loop.20diagnostic.html#154609523">(Jan 07 2019 at 23:17)</a>:</h4>
<p><span class="user-mention" data-user-id="116009">@nikomatsakis</span> ^^^</p>



<a name="154609575"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353773%20erroneous%20loop%20diagnostic/near/154609575" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353773.20erroneous.20loop.20diagnostic.html#154609575">(Jan 07 2019 at 23:18)</a>:</h4>
<p>I already see there are some differences on the used in <code>used here, in later iteration of loop</code> that I need to check if are right or not</p>



<a name="154661149"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353773%20erroneous%20loop%20diagnostic/near/154661149" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353773.20erroneous.20loop.20diagnostic.html#154661149">(Jan 08 2019 at 17:32)</a>:</h4>
<p><span class="user-mention" data-user-id="116009">@nikomatsakis</span> checking the diffs now</p>



<a name="154661152"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353773%20erroneous%20loop%20diagnostic/near/154661152" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353773.20erroneous.20loop.20diagnostic.html#154661152">(Jan 08 2019 at 17:32)</a>:</h4>
<p>for instance</p>



<a name="154661154"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353773%20erroneous%20loop%20diagnostic/near/154661154" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353773.20erroneous.20loop.20diagnostic.html#154661154">(Jan 08 2019 at 17:32)</a>:</h4>
<p><a href="https://github.com/rust-lang/rust/pull/56113/files#diff-49dad6257ff5648bdcbcbe5e1b5445f7" target="_blank" title="https://github.com/rust-lang/rust/pull/56113/files#diff-49dad6257ff5648bdcbcbe5e1b5445f7">https://github.com/rust-lang/rust/pull/56113/files#diff-49dad6257ff5648bdcbcbe5e1b5445f7</a></p>



<a name="154661165"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353773%20erroneous%20loop%20diagnostic/near/154661165" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353773.20erroneous.20loop.20diagnostic.html#154661165">(Jan 08 2019 at 17:32)</a>:</h4>
<p>the first change is for the better and the second one is for the worse</p>



<a name="154661486"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353773%20erroneous%20loop%20diagnostic/near/154661486" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353773.20erroneous.20loop.20diagnostic.html#154661486">(Jan 08 2019 at 17:36)</a>:</h4>
<p>unsure if it's one of the confusible cases we were talking about</p>



<a name="154661496"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353773%20erroneous%20loop%20diagnostic/near/154661496" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353773.20erroneous.20loop.20diagnostic.html#154661496">(Jan 08 2019 at 17:36)</a>:</h4>
<p>gonna check that in a while and check the rest of the changes</p>



<a name="154663178"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353773%20erroneous%20loop%20diagnostic/near/154663178" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353773.20erroneous.20loop.20diagnostic.html#154663178">(Jan 08 2019 at 17:59)</a>:</h4>
<p>no, the second one is better too</p>



<a name="154663244"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353773%20erroneous%20loop%20diagnostic/near/154663244" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353773.20erroneous.20loop.20diagnostic.html#154663244">(Jan 08 2019 at 18:00)</a>:</h4>
<p>because there's no need to later in the loop it's just later but it happens that both statements are in the loop</p>



<a name="154663295"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353773%20erroneous%20loop%20diagnostic/near/154663295" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353773.20erroneous.20loop.20diagnostic.html#154663295">(Jan 08 2019 at 18:00)</a>:</h4>
<p>from my point of view this example is better</p>



<a name="154664417"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353773%20erroneous%20loop%20diagnostic/near/154664417" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353773.20erroneous.20loop.20diagnostic.html#154664417">(Jan 08 2019 at 18:16)</a>:</h4>
<p><span class="user-mention" data-user-id="116009">@nikomatsakis</span> this case doesn't seem to be right <a href="https://github.com/rust-lang/rust/pull/56113/files#diff-9c381bde352f6799a887ef7dda1c3318L7" target="_blank" title="https://github.com/rust-lang/rust/pull/56113/files#diff-9c381bde352f6799a887ef7dda1c3318L7">https://github.com/rust-lang/rust/pull/56113/files#diff-9c381bde352f6799a887ef7dda1c3318L7</a></p>



<a name="154664423"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353773%20erroneous%20loop%20diagnostic/near/154664423" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353773.20erroneous.20loop.20diagnostic.html#154664423">(Jan 08 2019 at 18:16)</a>:</h4>
<p>I mean, after my PR</p>



<a name="154664426"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353773%20erroneous%20loop%20diagnostic/near/154664426" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353773.20erroneous.20loop.20diagnostic.html#154664426">(Jan 08 2019 at 18:17)</a>:</h4>
<p>what do you think?</p>



<a name="154664614"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353773%20erroneous%20loop%20diagnostic/near/154664614" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353773.20erroneous.20loop.20diagnostic.html#154664614">(Jan 08 2019 at 18:19)</a>:</h4>
<p>well there are more cases like that one</p>



<a name="154664713"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353773%20erroneous%20loop%20diagnostic/near/154664713" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353773.20erroneous.20loop.20diagnostic.html#154664713">(Jan 08 2019 at 18:20)</a>:</h4>
<p>maybe if use location = borrow location and that's inside of the loop we should just emit that loop message?</p>



<a name="154664740"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353773%20erroneous%20loop%20diagnostic/near/154664740" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353773.20erroneous.20loop.20diagnostic.html#154664740">(Jan 08 2019 at 18:21)</a>:</h4>
<p>actually not 100% sure why the code don't cover that gonna check</p>



<a name="154666727"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353773%20erroneous%20loop%20diagnostic/near/154666727" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353773.20erroneous.20loop.20diagnostic.html#154666727">(Jan 08 2019 at 18:48)</a>:</h4>
<p><span class="user-mention" data-user-id="116009">@nikomatsakis</span> after checking all the examples I think all are better BUT <code>src/test/ui/borrowck/borrowck-mut-borrow-linear-errors.mir.stderr</code></p>



<a name="154666736"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353773%20erroneous%20loop%20diagnostic/near/154666736" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353773.20erroneous.20loop.20diagnostic.html#154666736">(Jan 08 2019 at 18:48)</a>:</h4>
<p>checking that one again</p>



<a name="154669136"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353773%20erroneous%20loop%20diagnostic/near/154669136" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353773.20erroneous.20loop.20diagnostic.html#154669136">(Jan 08 2019 at 19:19)</a>:</h4>
<p>I agree that <code>borrowck-mut-borrow-linear-errors.mir.stderr </code> seems less good</p>



<a name="154669382"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353773%20erroneous%20loop%20diagnostic/near/154669382" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353773.20erroneous.20loop.20diagnostic.html#154669382">(Jan 08 2019 at 19:22)</a>:</h4>
<p><span class="user-mention" data-user-id="116009">@nikomatsakis</span> I think I see what's going on</p>



<a name="154669385"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353773%20erroneous%20loop%20diagnostic/near/154669385" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353773.20erroneous.20loop.20diagnostic.html#154669385">(Jan 08 2019 at 19:22)</a>:</h4>
<div class="codehilite"><pre><span></span>        StorageLive(_10);                // bb9[0]: scope 3 at test.rs:8:20: 8:24
        _10 = &amp;&#39;_#7r mut _2;             // bb9[1]: scope 3 at test.rs:8:20: 8:24
        StorageLive(_11);                // bb9[2]: scope 3 at test.rs:8:30: 8:36
        _11 = &amp;&#39;_#8r mut _1;             // bb9[3]: scope 3 at test.rs:8:30: 8:36
        _9 = const &lt;std::vec::Vec&lt;T&gt;&gt;::push(move _10, move _11) -&gt; [return: bb17, unwind: bb8]; // bb9[4]: scope 3 at test.rs:8:20: 8:37
</pre></div>



<a name="154669396"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353773%20erroneous%20loop%20diagnostic/near/154669396" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353773.20erroneous.20loop.20diagnostic.html#154669396">(Jan 08 2019 at 19:22)</a>:</h4>
<p>the borrow happens before the use</p>



<a name="154669417"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353773%20erroneous%20loop%20diagnostic/near/154669417" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353773.20erroneous.20loop.20diagnostic.html#154669417">(Jan 08 2019 at 19:23)</a>:</h4>
<p>so it's not printing the <code>in later iteration of loop</code></p>



<a name="154669437"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353773%20erroneous%20loop%20diagnostic/near/154669437" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353773.20erroneous.20loop.20diagnostic.html#154669437">(Jan 08 2019 at 19:23)</a>:</h4>
<p>but given that high level code is the same line, it seems like it would be better to print that</p>



<a name="154669454"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353773%20erroneous%20loop%20diagnostic/near/154669454" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353773.20erroneous.20loop.20diagnostic.html#154669454">(Jan 08 2019 at 19:23)</a>:</h4>
<p><span class="user-mention" data-user-id="116009">@nikomatsakis</span> thoughts? what should we do?</p>



<a name="154669572"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353773%20erroneous%20loop%20diagnostic/near/154669572" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353773.20erroneous.20loop.20diagnostic.html#154669572">(Jan 08 2019 at 19:25)</a>:</h4>
<p><span class="user-mention" data-user-id="116266">@Santiago Pastorino</span> I left my comments as to which I think are "better" or "less good" — put another way, places where I think printing "in a later iteration of the loop" would make sense</p>



<a name="154669589"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353773%20erroneous%20loop%20diagnostic/near/154669589" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353773.20erroneous.20loop.20diagnostic.html#154669589">(Jan 08 2019 at 19:26)</a>:</h4>
<blockquote>
<p>the borrow happens before the use</p>
</blockquote>
<p>yes, I wondered if this would be it</p>



<a name="154669636"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353773%20erroneous%20loop%20diagnostic/near/154669636" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353773.20erroneous.20loop.20diagnostic.html#154669636">(Jan 08 2019 at 19:26)</a>:</h4>
<p>well, actually, that's what is confusing to me</p>



<a name="154669662"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353773%20erroneous%20loop%20diagnostic/near/154669662" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353773.20erroneous.20loop.20diagnostic.html#154669662">(Jan 08 2019 at 19:26)</a>:</h4>
<p>that is, the borrow of <code>_10 = &amp;mut _2</code> occurs <em>before</em> the access to <code>_1</code></p>



<a name="154669672"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353773%20erroneous%20loop%20diagnostic/near/154669672" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353773.20erroneous.20loop.20diagnostic.html#154669672">(Jan 08 2019 at 19:26)</a>:</h4>
<p>but I suspect that the error is occuring at the point of the <em>call</em></p>



<a name="154669676"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353773%20erroneous%20loop%20diagnostic/near/154669676" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353773.20erroneous.20loop.20diagnostic.html#154669676">(Jan 08 2019 at 19:26)</a>:</h4>
<p>because of 2-phase borrows</p>



<a name="154669684"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353773%20erroneous%20loop%20diagnostic/near/154669684" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353773.20erroneous.20loop.20diagnostic.html#154669684">(Jan 08 2019 at 19:26)</a>:</h4>
<p>yes, that's what I meant</p>



<a name="154669690"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353773%20erroneous%20loop%20diagnostic/near/154669690" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353773.20erroneous.20loop.20diagnostic.html#154669690">(Jan 08 2019 at 19:26)</a>:</h4>
<p>that seems... ok to me</p>



<a name="154669706"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353773%20erroneous%20loop%20diagnostic/near/154669706" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353773.20erroneous.20loop.20diagnostic.html#154669706">(Jan 08 2019 at 19:27)</a>:</h4>
<p>if that's ok I guess this is good to go</p>



<a name="154669711"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353773%20erroneous%20loop%20diagnostic/near/154669711" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353773.20erroneous.20loop.20diagnostic.html#154669711">(Jan 08 2019 at 19:27)</a>:</h4>
<p>I think the ideal would be</p>



<a name="154669717"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353773%20erroneous%20loop%20diagnostic/near/154669717" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353773.20erroneous.20loop.20diagnostic.html#154669717">(Jan 08 2019 at 19:27)</a>:</h4>
<p>to notice that the use is a call</p>



<a name="154669718"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353773%20erroneous%20loop%20diagnostic/near/154669718" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353773.20erroneous.20loop.20diagnostic.html#154669718">(Jan 08 2019 at 19:27)</a>:</h4>
<p>or at least good to review :)</p>



<a name="154669720"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353773%20erroneous%20loop%20diagnostic/near/154669720" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353773.20erroneous.20loop.20diagnostic.html#154669720">(Jan 08 2019 at 19:27)</a>:</h4>
<p>and say something like ", during the call"</p>



<a name="154669728"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353773%20erroneous%20loop%20diagnostic/near/154669728" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353773.20erroneous.20loop.20diagnostic.html#154669728">(Jan 08 2019 at 19:27)</a>:</h4>
<p>ahh ok</p>



<a name="154669744"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353773%20erroneous%20loop%20diagnostic/near/154669744" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353773.20erroneous.20loop.20diagnostic.html#154669744">(Jan 08 2019 at 19:27)</a>:</h4>
<p>I think I wrote something about this in the RFC</p>



<a name="154669757"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353773%20erroneous%20loop%20diagnostic/near/154669757" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353773.20erroneous.20loop.20diagnostic.html#154669757">(Jan 08 2019 at 19:28)</a>:</h4>
<p>the reason being that "during the call" is a case where the order in which we write things is sort of reverse</p>



<a name="154669811"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353773%20erroneous%20loop%20diagnostic/near/154669811" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353773.20erroneous.20loop.20diagnostic.html#154669811">(Jan 08 2019 at 19:28)</a>:</h4>
<p>yep</p>



<a name="154669821"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353773%20erroneous%20loop%20diagnostic/near/154669821" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353773.20erroneous.20loop.20diagnostic.html#154669821">(Jan 08 2019 at 19:28)</a>:</h4>
<p>do you want me to add during the call in this PR?</p>



<a name="154669837"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353773%20erroneous%20loop%20diagnostic/near/154669837" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353773.20erroneous.20loop.20diagnostic.html#154669837">(Jan 08 2019 at 19:28)</a>:</h4>
<p>because you mentioned an RFC which I'm not sure which one is</p>



<a name="154669844"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353773%20erroneous%20loop%20diagnostic/near/154669844" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353773.20erroneous.20loop.20diagnostic.html#154669844">(Jan 08 2019 at 19:28)</a>:</h4>
<p>oh I meant the NLL RFC</p>



<a name="154669848"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353773%20erroneous%20loop%20diagnostic/near/154669848" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353773.20erroneous.20loop.20diagnostic.html#154669848">(Jan 08 2019 at 19:28)</a>:</h4>
<p>are you planning some future changes?</p>



<a name="154669850"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353773%20erroneous%20loop%20diagnostic/near/154669850" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353773.20erroneous.20loop.20diagnostic.html#154669850">(Jan 08 2019 at 19:28)</a>:</h4>
<p>I think I used that phrasing in some examples</p>



<a name="154669851"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353773%20erroneous%20loop%20diagnostic/near/154669851" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353773.20erroneous.20loop.20diagnostic.html#154669851">(Jan 08 2019 at 19:28)</a>:</h4>
<p>ahh ok ok</p>



<a name="154669857"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353773%20erroneous%20loop%20diagnostic/near/154669857" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353773.20erroneous.20loop.20diagnostic.html#154669857">(Jan 08 2019 at 19:28)</a>:</h4>
<p>but this doesn't really require an RFC or anything</p>



<a name="154669883"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353773%20erroneous%20loop%20diagnostic/near/154669883" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353773.20erroneous.20loop.20diagnostic.html#154669883">(Jan 08 2019 at 19:29)</a>:</h4>
<p>I thought some major changes were going on for a bit :)</p>



<a name="154669888"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353773%20erroneous%20loop%20diagnostic/near/154669888" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353773.20erroneous.20loop.20diagnostic.html#154669888">(Jan 08 2019 at 19:29)</a>:</h4>
<p>I gotta run -- I guess I don't care too much about whether we put it in the PR, if it's easy maybe why not? it feels a bit different but not unrelated</p>



<a name="154669897"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353773%20erroneous%20loop%20diagnostic/near/154669897" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353773.20erroneous.20loop.20diagnostic.html#154669897">(Jan 08 2019 at 19:29)</a>:</h4>
<p>:)</p>



<a name="154669907"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353773%20erroneous%20loop%20diagnostic/near/154669907" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353773.20erroneous.20loop.20diagnostic.html#154669907">(Jan 08 2019 at 19:29)</a>:</h4>
<p>yeah, let me do that in this PR then</p>



<a name="154743680"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353773%20erroneous%20loop%20diagnostic/near/154743680" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353773.20erroneous.20loop.20diagnostic.html#154743680">(Jan 09 2019 at 17:57)</a>:</h4>
<p><span class="user-mention" data-user-id="116009">@nikomatsakis</span> back for a bit with this</p>



<a name="154743681"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353773%20erroneous%20loop%20diagnostic/near/154743681" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353773.20erroneous.20loop.20diagnostic.html#154743681">(Jan 09 2019 at 17:57)</a>:</h4>
<p>first of all</p>



<a name="154743687"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353773%20erroneous%20loop%20diagnostic/near/154743687" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353773.20erroneous.20loop.20diagnostic.html#154743687">(Jan 09 2019 at 17:57)</a>:</h4>
<p>can you elaborate a bit more on <a href="https://github.com/rust-lang/rust/pull/56113#discussion_r246120584" target="_blank" title="https://github.com/rust-lang/rust/pull/56113#discussion_r246120584">https://github.com/rust-lang/rust/pull/56113#discussion_r246120584</a> ?</p>



<a name="154743762"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353773%20erroneous%20loop%20diagnostic/near/154743762" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353773.20erroneous.20loop.20diagnostic.html#154743762">(Jan 09 2019 at 17:58)</a>:</h4>
<p>I mean, more specifically, do you think that the new output is not wrong? it should look like before? or do you want something different?</p>



<a name="154754442"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353773%20erroneous%20loop%20diagnostic/near/154754442" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353773.20erroneous.20loop.20diagnostic.html#154754442">(Jan 09 2019 at 20:21)</a>:</h4>
<p>well, this is the function in question</p>
<div class="codehilite"><pre><span></span><span class="k">fn</span> <span class="nf">while_aliased_mut_cond</span><span class="p">(</span><span class="n">cond</span>: <span class="kt">bool</span><span class="p">,</span><span class="w"> </span><span class="n">cond2</span>: <span class="kt">bool</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="k">mut</span><span class="w"> </span><span class="n">v</span>: <span class="nb">Box</span><span class="o">&lt;</span><span class="n">_</span><span class="o">&gt;</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">box</span><span class="w"> </span><span class="mi">3</span><span class="p">;</span><span class="w"></span>
<span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="k">mut</span><span class="w"> </span><span class="n">w</span>: <span class="nb">Box</span><span class="o">&lt;</span><span class="n">_</span><span class="o">&gt;</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">box</span><span class="w"> </span><span class="mi">4</span><span class="p">;</span><span class="w"></span>
<span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="k">mut</span><span class="w"> </span><span class="n">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">&amp;</span><span class="k">mut</span><span class="w"> </span><span class="n">w</span><span class="p">;</span><span class="w"></span>
<span class="w">    </span><span class="k">while</span><span class="w"> </span><span class="n">cond</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">        </span><span class="o">**</span><span class="n">x</span><span class="w"> </span><span class="o">+=</span><span class="w"> </span><span class="mi">1</span><span class="p">;</span><span class="w"></span>
<span class="w">        </span><span class="n">borrow</span><span class="p">(</span><span class="o">&amp;*</span><span class="n">v</span><span class="p">);</span><span class="w"> </span><span class="c1">//[ast]~ ERROR cannot borrow</span>
<span class="w">        </span><span class="c1">//[nll]~^ ERROR cannot borrow</span>
<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="n">cond2</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">            </span><span class="n">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">&amp;</span><span class="k">mut</span><span class="w"> </span><span class="n">v</span><span class="p">;</span><span class="w"> </span><span class="c1">//[ast]~ ERROR cannot borrow</span>
<span class="w">        </span><span class="p">}</span><span class="w"></span>
<span class="w">    </span><span class="p">}</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>
</pre></div>



<a name="154754453"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353773%20erroneous%20loop%20diagnostic/near/154754453" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353773.20erroneous.20loop.20diagnostic.html#154754453">(Jan 09 2019 at 20:21)</a>:</h4>
<p>and the error</p>
<div class="codehilite"><pre><span></span>error[E0502]: cannot borrow `*v` as immutable because it is also borrowed as mutable
  --&gt; $DIR/borrowck-lend-flow-loop.rs:109:16
   |
LL |         **x += 1;
   |         -------- mutable borrow later used here
LL |         borrow(&amp;*v); //[ast]~ ERROR cannot borrow
   |                ^^^ immutable borrow occurs here
...
LL |             x = &amp;mut v; //[ast]~ ERROR cannot borrow
   |                 ------ mutable borrow occurs here
</pre></div>



<a name="154754511"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353773%20erroneous%20loop%20diagnostic/near/154754511" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353773.20erroneous.20loop.20diagnostic.html#154754511">(Jan 09 2019 at 20:22)</a>:</h4>
<p>yes</p>



<a name="154754519"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353773%20erroneous%20loop%20diagnostic/near/154754519" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353773.20erroneous.20loop.20diagnostic.html#154754519">(Jan 09 2019 at 20:22)</a>:</h4>
<p>that's using the output of my PR</p>



<a name="154754521"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353773%20erroneous%20loop%20diagnostic/near/154754521" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353773.20erroneous.20loop.20diagnostic.html#154754521">(Jan 09 2019 at 20:22)</a>:</h4>
<p>in this case, the "flow of events" is that </p>
<ul>
<li><code>x = &amp;mut v</code> starts a borrow,</li>
<li>we go around the loop,</li>
<li>we start an immutable borrow with <code>&amp;*v</code>,</li>
<li>we go around the loop,</li>
<li>we use the borrow <code>x</code> to do <code>**x += 1</code></li>
</ul>



<a name="154754529"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353773%20erroneous%20loop%20diagnostic/near/154754529" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353773.20erroneous.20loop.20diagnostic.html#154754529">(Jan 09 2019 at 20:22)</a>:</h4>
<p>so you see that we did indeed have to go around the loop</p>



<a name="154754535"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353773%20erroneous%20loop%20diagnostic/near/154754535" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353773.20erroneous.20loop.20diagnostic.html#154754535">(Jan 09 2019 at 20:22)</a>:</h4>
<p>otoh the case is so convoluted...</p>



<a name="154754548"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353773%20erroneous%20loop%20diagnostic/near/154754548" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353773.20erroneous.20loop.20diagnostic.html#154754548">(Jan 09 2019 at 20:23)</a>:</h4>
<p>I see</p>



<a name="154754552"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353773%20erroneous%20loop%20diagnostic/near/154754552" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353773.20erroneous.20loop.20diagnostic.html#154754552">(Jan 09 2019 at 20:23)</a>:</h4>
<p>I feel like this is a good example where it'd be nicer to format the error differently</p>



<a name="154754558"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353773%20erroneous%20loop%20diagnostic/near/154754558" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353773.20erroneous.20loop.20diagnostic.html#154754558">(Jan 09 2019 at 20:23)</a>:</h4>
<p>in a more general way</p>



<a name="154754561"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353773%20erroneous%20loop%20diagnostic/near/154754561" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353773.20erroneous.20loop.20diagnostic.html#154754561">(Jan 09 2019 at 20:23)</a>:</h4>
<p>but that's a whole separate matter</p>



<a name="154754571"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353773%20erroneous%20loop%20diagnostic/near/154754571" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353773.20erroneous.20loop.20diagnostic.html#154754571">(Jan 09 2019 at 20:23)</a>:</h4>
<p>and that means, leave as is? :)</p>



<a name="154754577"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353773%20erroneous%20loop%20diagnostic/near/154754577" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353773.20erroneous.20loop.20diagnostic.html#154754577">(Jan 09 2019 at 20:23)</a>:</h4>
<p>I'm fine with it as is</p>



<a name="154754579"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353773%20erroneous%20loop%20diagnostic/near/154754579" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353773.20erroneous.20loop.20diagnostic.html#154754579">(Jan 09 2019 at 20:23)</a>:</h4>
<p>ok</p>



<a name="154754581"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353773%20erroneous%20loop%20diagnostic/near/154754581" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353773.20erroneous.20loop.20diagnostic.html#154754581">(Jan 09 2019 at 20:23)</a>:</h4>
<p>another thing</p>



<a name="154754593"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353773%20erroneous%20loop%20diagnostic/near/154754593" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353773.20erroneous.20loop.20diagnostic.html#154754593">(Jan 09 2019 at 20:23)</a>:</h4>
<p>about the during the call thing now</p>



<a name="154754595"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353773%20erroneous%20loop%20diagnostic/near/154754595" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353773.20erroneous.20loop.20diagnostic.html#154754595">(Jan 09 2019 at 20:23)</a>:</h4>
<p>I was just saying that it didn't seem <em>more correct</em> than before kind of "for the record" =)</p>



<a name="154754599"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353773%20erroneous%20loop%20diagnostic/near/154754599" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353773.20erroneous.20loop.20diagnostic.html#154754599">(Jan 09 2019 at 20:23)</a>:</h4>
<p><span class="emoji emoji-1f44d" title="+1">:+1:</span></p>



<a name="154754607"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353773%20erroneous%20loop%20diagnostic/near/154754607" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353773.20erroneous.20loop.20diagnostic.html#154754607">(Jan 09 2019 at 20:24)</a>:</h4>
<p><a href="https://github.com/rust-lang/rust/blob/35d970dc09eead49521bbe905180a44f4639c05a/src/librustc_mir/borrow_check/nll/explain_borrow/mod.rs#L66" target="_blank" title="https://github.com/rust-lang/rust/blob/35d970dc09eead49521bbe905180a44f4639c05a/src/librustc_mir/borrow_check/nll/explain_borrow/mod.rs#L66">https://github.com/rust-lang/rust/blob/35d970dc09eead49521bbe905180a44f4639c05a/src/librustc_mir/borrow_check/nll/explain_borrow/mod.rs#L66</a></p>



<a name="154754666"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353773%20erroneous%20loop%20diagnostic/near/154754666" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353773.20erroneous.20loop.20diagnostic.html#154754666">(Jan 09 2019 at 20:24)</a>:</h4>
<p>I was expecting that to be a Call</p>



<a name="154754688"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353773%20erroneous%20loop%20diagnostic/near/154754688" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353773.20erroneous.20loop.20diagnostic.html#154754688">(Jan 09 2019 at 20:25)</a>:</h4>
<p>but if it were a call it should have printed <code>borrow later used by call</code></p>



<a name="154754697"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353773%20erroneous%20loop%20diagnostic/near/154754697" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353773.20erroneous.20loop.20diagnostic.html#154754697">(Jan 09 2019 at 20:25)</a>:</h4>
<p>which is something similar to what we want</p>



<a name="154754711"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353773%20erroneous%20loop%20diagnostic/near/154754711" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353773.20erroneous.20loop.20diagnostic.html#154754711">(Jan 09 2019 at 20:25)</a>:</h4>
<p>the thing is that it's a <code>LaterUseKind::Other</code> thing</p>



<a name="154754720"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353773%20erroneous%20loop%20diagnostic/near/154754720" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353773.20erroneous.20loop.20diagnostic.html#154754720">(Jan 09 2019 at 20:25)</a>:</h4>
<p>so ... when you said, look for a call were you referring to that? or to something else?</p>



<a name="154754839"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353773%20erroneous%20loop%20diagnostic/near/154754839" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353773.20erroneous.20loop.20diagnostic.html#154754839">(Jan 09 2019 at 20:27)</a>:</h4>
<p>that does look like the same general idea</p>



<a name="154754892"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353773%20erroneous%20loop%20diagnostic/near/154754892" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353773.20erroneous.20loop.20diagnostic.html#154754892">(Jan 09 2019 at 20:28)</a>:</h4>
<p>I feel like we probably have a lot of "strands" of code that do similar/same things</p>



<a name="154754903"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353773%20erroneous%20loop%20diagnostic/near/154754903" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353773.20erroneous.20loop.20diagnostic.html#154754903">(Jan 09 2019 at 20:28)</a>:</h4>
<p>yeah, now I wonder why is that an Other in the moment of printing the message</p>



<a name="154754907"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353773%20erroneous%20loop%20diagnostic/near/154754907" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353773.20erroneous.20loop.20diagnostic.html#154754907">(Jan 09 2019 at 20:28)</a>:</h4>
<p>and it's not a call</p>



<a name="154754916"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353773%20erroneous%20loop%20diagnostic/near/154754916" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353773.20erroneous.20loop.20diagnostic.html#154754916">(Jan 09 2019 at 20:28)</a>:</h4>
<p>ok, I'd need to check this out properly</p>



<a name="154754948"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353773%20erroneous%20loop%20diagnostic/near/154754948" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353773.20erroneous.20loop.20diagnostic.html#154754948">(Jan 09 2019 at 20:29)</a>:</h4>
<p><code>addr.push(&amp;mut x);</code> addr was the use, so I guess it should be a call, right?</p>



<a name="154754953"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353773%20erroneous%20loop%20diagnostic/near/154754953" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353773.20erroneous.20loop.20diagnostic.html#154754953">(Jan 09 2019 at 20:29)</a>:</h4>
<p>I mean, theoretically</p>



<a name="154754956"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353773%20erroneous%20loop%20diagnostic/near/154754956" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353773.20erroneous.20loop.20diagnostic.html#154754956">(Jan 09 2019 at 20:29)</a>:</h4>
<p>or am I getting something wrong?</p>



<a name="154756094"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353773%20erroneous%20loop%20diagnostic/near/154756094" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353773.20erroneous.20loop.20diagnostic.html#154756094">(Jan 09 2019 at 20:45)</a>:</h4>
<p>something is confusing to me</p>



<a name="154756099"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353773%20erroneous%20loop%20diagnostic/near/154756099" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353773.20erroneous.20loop.20diagnostic.html#154756099">(Jan 09 2019 at 20:45)</a>:</h4>
<p><a href="https://github.com/rust-lang/rust/blob/35d970dc09eead49521bbe905180a44f4639c05a/src/librustc_mir/borrow_check/nll/explain_borrow/mod.rs#L446-L465" target="_blank" title="https://github.com/rust-lang/rust/blob/35d970dc09eead49521bbe905180a44f4639c05a/src/librustc_mir/borrow_check/nll/explain_borrow/mod.rs#L446-L465">https://github.com/rust-lang/rust/blob/35d970dc09eead49521bbe905180a44f4639c05a/src/librustc_mir/borrow_check/nll/explain_borrow/mod.rs#L446-L465</a></p>



<a name="154756210"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353773%20erroneous%20loop%20diagnostic/near/154756210" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353773.20erroneous.20loop.20diagnostic.html#154756210">(Jan 09 2019 at 20:46)</a>:</h4>
<p><span class="user-mention" data-user-id="116009">@nikomatsakis</span> why the use being a function is tagged as a terminator thing?</p>



<a name="154756373"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353773%20erroneous%20loop%20diagnostic/near/154756373" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353773.20erroneous.20loop.20diagnostic.html#154756373">(Jan 09 2019 at 20:48)</a>:</h4>
<p>basically I think I don't understand this <a href="https://github.com/rust-lang/rust/blob/35d970dc09eead49521bbe905180a44f4639c05a/src/librustc/mir/mod.rs#L1130-L1146" target="_blank" title="https://github.com/rust-lang/rust/blob/35d970dc09eead49521bbe905180a44f4639c05a/src/librustc/mir/mod.rs#L1130-L1146">https://github.com/rust-lang/rust/blob/35d970dc09eead49521bbe905180a44f4639c05a/src/librustc/mir/mod.rs#L1130-L1146</a></p>



<a name="154756380"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353773%20erroneous%20loop%20diagnostic/near/154756380" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353773.20erroneous.20loop.20diagnostic.html#154756380">(Jan 09 2019 at 20:48)</a>:</h4>
<p>or that's talking about something different to what I'm looking for</p>



<a name="154756562"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353773%20erroneous%20loop%20diagnostic/near/154756562" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353773.20erroneous.20loop.20diagnostic.html#154756562">(Jan 09 2019 at 20:51)</a>:</h4>
<p>well maybe I'm not understanding what is <code>/// Block ends with a call of a converging function</code></p>



<a name="154761012"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353773%20erroneous%20loop%20diagnostic/near/154761012" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353773.20erroneous.20loop.20diagnostic.html#154761012">(Jan 09 2019 at 21:56)</a>:</h4>
<blockquote>
<p><code>addr.push(&amp;mut x);</code> addr was the use, so I guess it should be a call, right?</p>
</blockquote>
<p>maybe :) but maybe it's some code elsewhere in the call lowering</p>



<a name="154761024"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353773%20erroneous%20loop%20diagnostic/near/154761024" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353773.20erroneous.20loop.20diagnostic.html#154761024">(Jan 09 2019 at 21:57)</a>:</h4>
<p>re: the Terminator, a "call" in MIr is always the last thing in a basic block (since it can panic)</p>



<a name="154761034"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353773%20erroneous%20loop%20diagnostic/near/154761034" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353773.20erroneous.20loop.20diagnostic.html#154761034">(Jan 09 2019 at 21:57)</a>:</h4>
<p>(given that it can panic, a call has two successors -- the "normal return" and the "unwind" path)</p>



<a name="154761050"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353773%20erroneous%20loop%20diagnostic/near/154761050" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353773.20erroneous.20loop.20diagnostic.html#154761050">(Jan 09 2019 at 21:57)</a>:</h4>
<p>does that answer your question, <span class="user-mention" data-user-id="116266">@Santiago Pastorino</span> ?</p>



<a name="154763310"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353773%20erroneous%20loop%20diagnostic/near/154763310" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353773.20erroneous.20loop.20diagnostic.html#154763310">(Jan 09 2019 at 22:35)</a>:</h4>
<p>yes</p>



<a name="154763362"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353773%20erroneous%20loop%20diagnostic/near/154763362" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353773.20erroneous.20loop.20diagnostic.html#154763362">(Jan 09 2019 at 22:36)</a>:</h4>
<p>it makes sense and it’s more or less what I thought <span class="emoji emoji-1f60a" title="blush">:blush:</span></p>



<a name="154763853"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353773%20erroneous%20loop%20diagnostic/near/154763853" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353773.20erroneous.20loop.20diagnostic.html#154763853">(Jan 09 2019 at 22:45)</a>:</h4>
<p>if <span class="user-mention" data-user-id="116266">@Santiago Pastorino</span> the "during the call" thing is hard, it seems ok not to do it :)</p>



<a name="154765207"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353773%20erroneous%20loop%20diagnostic/near/154765207" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353773.20erroneous.20loop.20diagnostic.html#154765207">(Jan 09 2019 at 23:06)</a>:</h4>
<p>unsure if it’s hard <span class="emoji emoji-1f60a" title="blush">:blush:</span></p>



<a name="154765250"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353773%20erroneous%20loop%20diagnostic/near/154765250" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353773.20erroneous.20loop.20diagnostic.html#154765250">(Jan 09 2019 at 23:07)</a>:</h4>
<p>I already left but tomorrow next thing to do I guess is dumping the mir and debugging this example to see what’s going on</p>



<a name="154765262"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353773%20erroneous%20loop%20diagnostic/near/154765262" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353773.20erroneous.20loop.20diagnostic.html#154765262">(Jan 09 2019 at 23:07)</a>:</h4>
<p><span class="user-mention" data-user-id="116009">@nikomatsakis</span> any other tip?</p>



<a name="154765297"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353773%20erroneous%20loop%20diagnostic/near/154765297" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353773.20erroneous.20loop.20diagnostic.html#154765297">(Jan 09 2019 at 23:08)</a>:</h4>
<p>I mean, if I can’t figure out a call there</p>



<a name="154844166"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353773%20erroneous%20loop%20diagnostic/near/154844166" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353773.20erroneous.20loop.20diagnostic.html#154844166">(Jan 10 2019 at 14:57)</a>:</h4>
<p><span class="user-mention" data-user-id="116009">@nikomatsakis</span></p>



<a name="154844167"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353773%20erroneous%20loop%20diagnostic/near/154844167" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353773.20erroneous.20loop.20diagnostic.html#154844167">(Jan 10 2019 at 14:57)</a>:</h4>
<div class="codehilite"><pre><span></span><span class="cp">#![feature(nll)]</span><span class="w"></span>

<span class="k">fn</span> <span class="nf">main</span><span class="p">()</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="k">mut</span><span class="w"> </span><span class="n">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="p">;</span><span class="w"></span>
<span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="k">mut</span><span class="w"> </span><span class="n">addr</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">vec</span><span class="o">!</span><span class="p">[];</span><span class="w"></span>
<span class="w">    </span><span class="k">loop</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">        </span><span class="k">match</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">            </span><span class="n">_</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="n">addr</span><span class="p">.</span><span class="n">push</span><span class="p">(</span><span class="o">&amp;</span><span class="k">mut</span><span class="w"> </span><span class="n">x</span><span class="p">);</span><span class="w"></span>
<span class="w">        </span><span class="p">}</span><span class="w"></span>
<span class="w">    </span><span class="p">}</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>
</pre></div>



<a name="154844168"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353773%20erroneous%20loop%20diagnostic/near/154844168" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353773.20erroneous.20loop.20diagnostic.html#154844168">(Jan 10 2019 at 14:57)</a>:</h4>
<p>vs</p>



<a name="154844176"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353773%20erroneous%20loop%20diagnostic/near/154844176" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353773.20erroneous.20loop.20diagnostic.html#154844176">(Jan 10 2019 at 14:57)</a>:</h4>
<div class="codehilite"><pre><span></span><span class="cp">#![feature(nll)]</span><span class="w"></span>

<span class="k">fn</span> <span class="nf">main</span><span class="p">()</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="k">mut</span><span class="w"> </span><span class="n">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="p">;</span><span class="w"></span>
<span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="k">mut</span><span class="w"> </span><span class="n">addr</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">vec</span><span class="o">!</span><span class="p">[];</span><span class="w"></span>
<span class="w">    </span><span class="k">loop</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">        </span><span class="k">match</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">            </span><span class="mi">1</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="n">addr</span><span class="p">.</span><span class="n">push</span><span class="p">(</span><span class="o">&amp;</span><span class="k">mut</span><span class="w"> </span><span class="n">x</span><span class="p">),</span><span class="w"></span>
<span class="w">            </span><span class="n">_</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="n">addr</span><span class="p">.</span><span class="n">push</span><span class="p">(</span><span class="o">&amp;</span><span class="k">mut</span><span class="w"> </span><span class="n">x</span><span class="p">),</span><span class="w"></span>
<span class="w">        </span><span class="p">}</span><span class="w"></span>
<span class="w">    </span><span class="p">}</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>
</pre></div>



<a name="154844179"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353773%20erroneous%20loop%20diagnostic/near/154844179" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353773.20erroneous.20loop.20diagnostic.html#154844179">(Jan 10 2019 at 14:57)</a>:</h4>
<p>first example prints</p>



<a name="154844202"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353773%20erroneous%20loop%20diagnostic/near/154844202" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353773.20erroneous.20loop.20diagnostic.html#154844202">(Jan 10 2019 at 14:57)</a>:</h4>
<div class="codehilite"><pre><span></span>error[E0499]: cannot borrow `x` as mutable more than once at a time
  --&gt; test.rs:15:28
   |
15 |             _ =&gt; addr.push(&amp;mut x),
   |                            ^^^^^^ mutable borrow starts here in previous iteration of loop

error: aborting due to previous error

For more information about this error, try `rustc --explain E0499`.
</pre></div>



<a name="154844208"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353773%20erroneous%20loop%20diagnostic/near/154844208" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353773.20erroneous.20loop.20diagnostic.html#154844208">(Jan 10 2019 at 14:58)</a>:</h4>
<p>which seems correct to me</p>



<a name="154844269"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353773%20erroneous%20loop%20diagnostic/near/154844269" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353773.20erroneous.20loop.20diagnostic.html#154844269">(Jan 10 2019 at 14:58)</a>:</h4>
<p>second example prints</p>



<a name="154844271"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353773%20erroneous%20loop%20diagnostic/near/154844271" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353773.20erroneous.20loop.20diagnostic.html#154844271">(Jan 10 2019 at 14:58)</a>:</h4>
<div class="codehilite"><pre><span></span>error[E0499]: cannot borrow `x` as mutable more than once at a time
  --&gt; test.rs:15:28
   |
15 |             1 =&gt; addr.push(&amp;mut x),
   |                  ----      ^^^^^^ second mutable borrow occurs here
   |                  |
   |                  first borrow later used here
16 |             _ =&gt; addr.push(&amp;mut x),
   |                            ------ first mutable borrow occurs here

error[E0499]: cannot borrow `x` as mutable more than once at a time
  --&gt; test.rs:16:28
   |
16 |             _ =&gt; addr.push(&amp;mut x),
   |                            ^^^^^^ mutable borrow starts here in previous iteration of loop

error: aborting due to 2 previous errors

For more information about this error, try `rustc --explain E0499`.
</pre></div>



<a name="154844306"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353773%20erroneous%20loop%20diagnostic/near/154844306" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353773.20erroneous.20loop.20diagnostic.html#154844306">(Jan 10 2019 at 14:59)</a>:</h4>
<p>which is ... weird I guess but not entirely wrong in the sense of mir maybe</p>



<a name="154844325"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353773%20erroneous%20loop%20diagnostic/near/154844325" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353773.20erroneous.20loop.20diagnostic.html#154844325">(Jan 10 2019 at 14:59)</a>:</h4>
<p>I guess on mir the <code>_ =&gt;</code> part shows up before?</p>



<a name="154844329"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353773%20erroneous%20loop%20diagnostic/near/154844329" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353773.20erroneous.20loop.20diagnostic.html#154844329">(Jan 10 2019 at 14:59)</a>:</h4>
<p>can check the mir output</p>



<a name="154844407"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353773%20erroneous%20loop%20diagnostic/near/154844407" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353773.20erroneous.20loop.20diagnostic.html#154844407">(Jan 10 2019 at 15:00)</a>:</h4>
<p>but anyway, there's also something weird about the first and second thing noted there</p>



<a name="154844434"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353773%20erroneous%20loop%20diagnostic/near/154844434" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353773.20erroneous.20loop.20diagnostic.html#154844434">(Jan 10 2019 at 15:00)</a>:</h4>
<p>well it actually makes sense if in mir <code>_ =&gt;</code> happens before</p>



<a name="154844538"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353773%20erroneous%20loop%20diagnostic/near/154844538" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353773.20erroneous.20loop.20diagnostic.html#154844538">(Jan 10 2019 at 15:02)</a>:</h4>
<p>the problem is that the <code>1 =&gt;</code> arm is wrong on it's own as the <code>_ =&gt;</code></p>



<a name="154844567"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353773%20erroneous%20loop%20diagnostic/near/154844567" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353773.20erroneous.20loop.20diagnostic.html#154844567">(Jan 10 2019 at 15:02)</a>:</h4>
<p>so saying <code>mutable borrow starts here in previous iteration of loop</code> only for <code>_ =&gt;</code> and not for <code>1 =&gt;</code> may be weird</p>



<a name="154844786"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353773%20erroneous%20loop%20diagnostic/near/154844786" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353773.20erroneous.20loop.20diagnostic.html#154844786">(Jan 10 2019 at 15:05)</a>:</h4>
<p>I guess what happens before depends on what <code>block.terminator().successors()</code> returns if returns first <code>_ =&gt;</code> that would be the first thing, unsure how that logic works</p>



<a name="154853577"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353773%20erroneous%20loop%20diagnostic/near/154853577" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353773.20erroneous.20loop.20diagnostic.html#154853577">(Jan 10 2019 at 16:53)</a>:</h4>
<p>I mean I think in the end there are many possible diagnostics here <span class="user-mention" data-user-id="116266">@Santiago Pastorino</span></p>



<a name="154853628"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353773%20erroneous%20loop%20diagnostic/near/154853628" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353773.20erroneous.20loop.20diagnostic.html#154853628">(Jan 10 2019 at 16:54)</a>:</h4>
<p>that is, what comes "first" and "second" is sort of arbitrary</p>



<a name="154853648"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353773%20erroneous%20loop%20diagnostic/near/154853648" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353773.20erroneous.20loop.20diagnostic.html#154853648">(Jan 10 2019 at 16:54)</a>:</h4>
<p>since these things are in a loop</p>



<a name="154853670"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353773%20erroneous%20loop%20diagnostic/near/154853670" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353773.20erroneous.20loop.20diagnostic.html#154853670">(Jan 10 2019 at 16:54)</a>:</h4>
<p>yeah, I'd expect first as the one that is above in the source code</p>



<a name="154853686"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353773%20erroneous%20loop%20diagnostic/near/154853686" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353773.20erroneous.20loop.20diagnostic.html#154853686">(Jan 10 2019 at 16:55)</a>:</h4>
<blockquote>
<p>the problem is that the <code>1 =&gt;</code> arm is wrong on it's own as the <code>_ =&gt;</code></p>
</blockquote>
<p>I don't quite get what you mean by this</p>



<a name="154853716"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353773%20erroneous%20loop%20diagnostic/near/154853716" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353773.20erroneous.20loop.20diagnostic.html#154853716">(Jan 10 2019 at 16:55)</a>:</h4>
<blockquote>
<p>yeah, I'd expect first as the one that is above in the source code</p>
</blockquote>
<p>it does seem like that would be a better choice; I'm not sure how hard it would be to fix.</p>



<a name="154853723"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353773%20erroneous%20loop%20diagnostic/near/154853723" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353773.20erroneous.20loop.20diagnostic.html#154853723">(Jan 10 2019 at 16:55)</a>:</h4>
<p>I mean, both arms are wrong if you put them in the code by themselves</p>



<a name="154853724"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353773%20erroneous%20loop%20diagnostic/near/154853724" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353773.20erroneous.20loop.20diagnostic.html#154853724">(Jan 10 2019 at 16:55)</a>:</h4>
<p>I guess I have to dig a bit in the code</p>



<a name="154853733"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353773%20erroneous%20loop%20diagnostic/near/154853733" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353773.20erroneous.20loop.20diagnostic.html#154853733">(Jan 10 2019 at 16:55)</a>:</h4>
<p>I think the diagnostic is also mixing both arms</p>



<a name="154853745"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353773%20erroneous%20loop%20diagnostic/near/154853745" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353773.20erroneous.20loop.20diagnostic.html#154853745">(Jan 10 2019 at 16:55)</a>:</h4>
<p>which is another way for that code of being wrong</p>



<a name="154853799"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353773%20erroneous%20loop%20diagnostic/near/154853799" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353773.20erroneous.20loop.20diagnostic.html#154853799">(Jan 10 2019 at 16:56)</a>:</h4>
<p>right, basically there are multiple ways</p>



<a name="154853801"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353773%20erroneous%20loop%20diagnostic/near/154853801" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353773.20erroneous.20loop.20diagnostic.html#154853801">(Jan 10 2019 at 16:56)</a>:</h4>
<p>the code finds "a way"</p>



<a name="154853805"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353773%20erroneous%20loop%20diagnostic/near/154853805" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353773.20erroneous.20loop.20diagnostic.html#154853805">(Jan 10 2019 at 16:56)</a>:</h4>
<p>and reports it to you</p>



<a name="154853806"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353773%20erroneous%20loop%20diagnostic/near/154853806" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353773.20erroneous.20loop.20diagnostic.html#154853806">(Jan 10 2019 at 16:56)</a>:</h4>
<p>exactly</p>



<a name="154853813"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353773%20erroneous%20loop%20diagnostic/near/154853813" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353773.20erroneous.20loop.20diagnostic.html#154853813">(Jan 10 2019 at 16:56)</a>:</h4>
<p>I'm not sure how hard it would be for it to find "the best way"</p>



<a name="154853822"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353773%20erroneous%20loop%20diagnostic/near/154853822" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353773.20erroneous.20loop.20diagnostic.html#154853822">(Jan 10 2019 at 16:56)</a>:</h4>
<p>I guess I feel like this is an entirely different problem</p>



<a name="154853826"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353773%20erroneous%20loop%20diagnostic/near/154853826" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353773.20erroneous.20loop.20diagnostic.html#154853826">(Jan 10 2019 at 16:56)</a>:</h4>
<p>from the one you set out to fix</p>



<a name="154853829"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353773%20erroneous%20loop%20diagnostic/near/154853829" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353773.20erroneous.20loop.20diagnostic.html#154853829">(Jan 10 2019 at 16:56)</a>:</h4>
<p>though possibly one worth tackling</p>



<a name="154853855"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353773%20erroneous%20loop%20diagnostic/near/154853855" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353773.20erroneous.20loop.20diagnostic.html#154853855">(Jan 10 2019 at 16:57)</a>:</h4>
<p>basically, looking for cases where -- in a loop -- we can "rejigger" the points we consider to be "first second and third" in order to get a more natural display</p>



<a name="154854378"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353773%20erroneous%20loop%20diagnostic/near/154854378" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353773.20erroneous.20loop.20diagnostic.html#154854378">(Jan 10 2019 at 17:02)</a>:</h4>
<p>agreed</p>



<a name="154854398"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353773%20erroneous%20loop%20diagnostic/near/154854398" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353773.20erroneous.20loop.20diagnostic.html#154854398">(Jan 10 2019 at 17:03)</a>:</h4>
<p>in that case should we just merge the PR as is?</p>



<a name="154854478"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353773%20erroneous%20loop%20diagnostic/near/154854478" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353773.20erroneous.20loop.20diagnostic.html#154854478">(Jan 10 2019 at 17:04)</a>:</h4>
<p>probably yes</p>



<a name="154854482"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353773%20erroneous%20loop%20diagnostic/near/154854482" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353773.20erroneous.20loop.20diagnostic.html#154854482">(Jan 10 2019 at 17:04)</a>:</h4>
<p>i'll give it a once over later today</p>



<a name="154854804"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353773%20erroneous%20loop%20diagnostic/near/154854804" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353773.20erroneous.20loop.20diagnostic.html#154854804">(Jan 10 2019 at 17:08)</a>:</h4>
<p><span class="user-mention" data-user-id="116009">@nikomatsakis</span> is there a way to kick travis?</p>



<a name="154854817"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353773%20erroneous%20loop%20diagnostic/near/154854817" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353773.20erroneous.20loop.20diagnostic.html#154854817">(Jan 10 2019 at 17:08)</a>:</h4>
<p>to run tests again over the PR?</p>



<a name="154854847"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353773%20erroneous%20loop%20diagnostic/near/154854847" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353773.20erroneous.20loop.20diagnostic.html#154854847">(Jan 10 2019 at 17:08)</a>:</h4>
<p>I know it should be green, but now after I've pushed a rustfmt commit it failed</p>



<a name="154854863"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353773%20erroneous%20loop%20diagnostic/near/154854863" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353773.20erroneous.20loop.20diagnostic.html#154854863">(Jan 10 2019 at 17:08)</a>:</h4>
<p>doh, my bad</p>



<a name="154854984"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353773%20erroneous%20loop%20diagnostic/near/154854984" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353773.20erroneous.20loop.20diagnostic.html#154854984">(Jan 10 2019 at 17:10)</a>:</h4>
<p>thought it was giving timeouts but was my bad</p>



<a name="154870304"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353773%20erroneous%20loop%20diagnostic/near/154870304" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353773.20erroneous.20loop.20diagnostic.html#154870304">(Jan 10 2019 at 20:46)</a>:</h4>
<p>ci is green <a href="https://github.com/rust-lang/rust/pull/56113" target="_blank" title="https://github.com/rust-lang/rust/pull/56113">https://github.com/rust-lang/rust/pull/56113</a> :)</p>



<a name="154946093"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353773%20erroneous%20loop%20diagnostic/near/154946093" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353773.20erroneous.20loop.20diagnostic.html#154946093">(Jan 11 2019 at 20:50)</a>:</h4>
<p><span class="user-mention" data-user-id="116009">@nikomatsakis</span> just opened the follow up issue <a href="https://github.com/rust-lang/rust/issues/57528" target="_blank" title="https://github.com/rust-lang/rust/issues/57528">https://github.com/rust-lang/rust/issues/57528</a> we talked about</p>



<a name="155169210"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353773%20erroneous%20loop%20diagnostic/near/155169210" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353773.20erroneous.20loop.20diagnostic.html#155169210">(Jan 15 2019 at 13:36)</a>:</h4>
<p><span class="user-mention" data-user-id="116009">@nikomatsakis</span> homu is failing for <code>x86_64-gnu-nopt</code> <a href="https://github.com/rust-lang/rust/pull/56113#issuecomment-453730748" target="_blank" title="https://github.com/rust-lang/rust/pull/56113#issuecomment-453730748">https://github.com/rust-lang/rust/pull/56113#issuecomment-453730748</a></p>



<a name="155169430"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353773%20erroneous%20loop%20diagnostic/near/155169430" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353773.20erroneous.20loop.20diagnostic.html#155169430">(Jan 15 2019 at 13:40)</a>:</h4>
<p>unsure what's going on</p>



<a name="155181399"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353773%20erroneous%20loop%20diagnostic/near/155181399" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353773.20erroneous.20loop.20diagnostic.html#155181399">(Jan 15 2019 at 16:07)</a>:</h4>
<p><span class="user-mention" data-user-id="116266">@Santiago Pastorino</span> hmm there must be some non-determinism here</p>



<a name="155181410"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353773%20erroneous%20loop%20diagnostic/near/155181410" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353773.20erroneous.20loop.20diagnostic.html#155181410">(Jan 15 2019 at 16:07)</a>:</h4>
<p>are we using hashmaps to control ordering or something somewhere?</p>



<a name="155181425"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353773%20erroneous%20loop%20diagnostic/near/155181425" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353773.20erroneous.20loop.20diagnostic.html#155181425">(Jan 15 2019 at 16:07)</a>:</h4>
<p>often this results in error messages that vary slightly depending on the platform</p>



<a name="155181446"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353773%20erroneous%20loop%20diagnostic/near/155181446" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353773.20erroneous.20loop.20diagnostic.html#155181446">(Jan 15 2019 at 16:07)</a>:</h4>
<p>couldn't that be successors?</p>



<a name="155181513"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353773%20erroneous%20loop%20diagnostic/near/155181513" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353773.20erroneous.20loop.20diagnostic.html#155181513">(Jan 15 2019 at 16:08)</a>:</h4>
<p>the output of this strongly depends on the successors list</p>



<a name="155181525"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353773%20erroneous%20loop%20diagnostic/near/155181525" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353773.20erroneous.20loop.20diagnostic.html#155181525">(Jan 15 2019 at 16:08)</a>:</h4>
<p>can we just get successors sorted by location?</p>



<a name="155181532"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353773%20erroneous%20loop%20diagnostic/near/155181532" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353773.20erroneous.20loop.20diagnostic.html#155181532">(Jan 15 2019 at 16:08)</a>:</h4>
<p>that would make things better from my perspective</p>



<a name="155181593"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353773%20erroneous%20loop%20diagnostic/near/155181593" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353773.20erroneous.20loop.20diagnostic.html#155181593">(Jan 15 2019 at 16:09)</a>:</h4>
<p>the successors list from the MIR is meaningful and is not in some arbitrary order</p>



<a name="155181609"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353773%20erroneous%20loop%20diagnostic/near/155181609" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353773.20erroneous.20loop.20diagnostic.html#155181609">(Jan 15 2019 at 16:09)</a>:</h4>
<p>but you could potentially sort the result if you wanted</p>



<a name="155181618"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353773%20erroneous%20loop%20diagnostic/near/155181618" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353773.20erroneous.20loop.20diagnostic.html#155181618">(Jan 15 2019 at 16:09)</a>:</h4>
<p>that is, this particular algorithm doesn't care</p>



<a name="155181763"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353773%20erroneous%20loop%20diagnostic/near/155181763" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353773.20erroneous.20loop.20diagnostic.html#155181763">(Jan 15 2019 at 16:11)</a>:</h4>
<blockquote>
<p>that is, this particular algorithm doesn't care</p>
</blockquote>
<p>what do you mean by this?</p>



<a name="155181770"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353773%20erroneous%20loop%20diagnostic/near/155181770" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353773.20erroneous.20loop.20diagnostic.html#155181770">(Jan 15 2019 at 16:11)</a>:</h4>
<p>what particular algorithm?</p>



<a name="155181785"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353773%20erroneous%20loop%20diagnostic/near/155181785" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353773.20erroneous.20loop.20diagnostic.html#155181785">(Jan 15 2019 at 16:11)</a>:</h4>
<p>skimming the PR, I don't see any obvious problem</p>



<a name="155181787"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353773%20erroneous%20loop%20diagnostic/near/155181787" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353773.20erroneous.20loop.20diagnostic.html#155181787">(Jan 15 2019 at 16:11)</a>:</h4>
<blockquote>
<p>what particular algorithm?</p>
</blockquote>
<p>the one you wrote :)</p>



<a name="155181795"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353773%20erroneous%20loop%20diagnostic/near/155181795" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353773.20erroneous.20loop.20diagnostic.html#155181795">(Jan 15 2019 at 16:11)</a>:</h4>
<p>that decides whether or not to print a label</p>



<a name="155181798"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353773%20erroneous%20loop%20diagnostic/near/155181798" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353773.20erroneous.20loop.20diagnostic.html#155181798">(Jan 15 2019 at 16:11)</a>:</h4>
<p>in my case depending on how I get successors it may say in later iteration or not</p>



<a name="155181867"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353773%20erroneous%20loop%20diagnostic/near/155181867" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353773.20erroneous.20loop.20diagnostic.html#155181867">(Jan 15 2019 at 16:12)</a>:</h4>
<p>or at least I believe that could happen</p>



<a name="155181887"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353773%20erroneous%20loop%20diagnostic/near/155181887" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353773.20erroneous.20loop.20diagnostic.html#155181887">(Jan 15 2019 at 16:12)</a>:</h4>
<p>if I have ...</p>



<a name="155181913"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353773%20erroneous%20loop%20diagnostic/near/155181913" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353773.20erroneous.20loop.20diagnostic.html#155181913">(Jan 15 2019 at 16:13)</a>:</h4>
<div class="codehilite"><pre><span></span>use
something
borrow
</pre></div>



<a name="155181916"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353773%20erroneous%20loop%20diagnostic/near/155181916" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353773.20erroneous.20loop.20diagnostic.html#155181916">(Jan 15 2019 at 16:13)</a>:</h4>
<p>does this pass for you locally?</p>



<a name="155181922"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353773%20erroneous%20loop%20diagnostic/near/155181922" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353773.20erroneous.20loop.20diagnostic.html#155181922">(Jan 15 2019 at 16:13)</a>:</h4>
<p>and I get</p>



<a name="155181923"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353773%20erroneous%20loop%20diagnostic/near/155181923" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353773.20erroneous.20loop.20diagnostic.html#155181923">(Jan 15 2019 at 16:13)</a>:</h4>
<p>maybe it's just an outdated stderr file?</p>



<a name="155181932"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353773%20erroneous%20loop%20diagnostic/near/155181932" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353773.20erroneous.20loop.20diagnostic.html#155181932">(Jan 15 2019 at 16:13)</a>:</h4>
<div class="codehilite"><pre><span></span>borrow
something
use
</pre></div>



<a name="155181937"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353773%20erroneous%20loop%20diagnostic/near/155181937" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353773.20erroneous.20loop.20diagnostic.html#155181937">(Jan 15 2019 at 16:13)</a>:</h4>
<p>output would be different</p>



<a name="155181954"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353773%20erroneous%20loop%20diagnostic/near/155181954" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353773.20erroneous.20loop.20diagnostic.html#155181954">(Jan 15 2019 at 16:13)</a>:</h4>
<p>but it pass on a lot of platforms on travis</p>



<a name="155182115"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353773%20erroneous%20loop%20diagnostic/near/155182115" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353773.20erroneous.20loop.20diagnostic.html#155182115">(Jan 15 2019 at 16:15)</a>:</h4>
<p>the question would be ...</p>



<a name="155182123"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353773%20erroneous%20loop%20diagnostic/near/155182123" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353773.20erroneous.20loop.20diagnostic.html#155182123">(Jan 15 2019 at 16:15)</a>:</h4>
<p>can I get</p>



<a name="155182169"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353773%20erroneous%20loop%20diagnostic/near/155182169" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353773.20erroneous.20loop.20diagnostic.html#155182169">(Jan 15 2019 at 16:16)</a>:</h4>
<div class="codehilite"><pre><span></span>use
something
borrow
</pre></div>


<p>or</p>
<div class="codehilite"><pre><span></span>borrow
something
use
</pre></div>



<a name="155182202"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353773%20erroneous%20loop%20diagnostic/near/155182202" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353773.20erroneous.20loop.20diagnostic.html#155182202">(Jan 15 2019 at 16:16)</a>:</h4>
<p>depending on how successors are returned?</p>



<a name="155182207"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353773%20erroneous%20loop%20diagnostic/near/155182207" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353773.20erroneous.20loop.20diagnostic.html#155182207">(Jan 15 2019 at 16:16)</a>:</h4>
<p>or that's not possible?</p>



<a name="155184971"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353773%20erroneous%20loop%20diagnostic/near/155184971" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353773.20erroneous.20loop.20diagnostic.html#155184971">(Jan 15 2019 at 16:52)</a>:</h4>
<p>I guess it could in the match example we talked about</p>



<a name="155184999"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353773%20erroneous%20loop%20diagnostic/near/155184999" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353773.20erroneous.20loop.20diagnostic.html#155184999">(Jan 15 2019 at 16:53)</a>:</h4>
<div class="codehilite"><pre><span></span>fn main() {
    let mut x = 1;
    let mut addr = vec![];
    loop {
        match 1 {
            1 =&gt; addr.push(&amp;mut x),
            _ =&gt; addr.push(&amp;mut x),
        }
    }
}
</pre></div>



<a name="155185026"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353773%20erroneous%20loop%20diagnostic/near/155185026" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353773.20erroneous.20loop.20diagnostic.html#155185026">(Jan 15 2019 at 16:53)</a>:</h4>
<p>which one shows up first, <code>1 =&gt;</code> or <code>_ =&gt;</code> and in the code it was <code>_ =&gt;</code> if I remember correctly</p>



<a name="155199466"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353773%20erroneous%20loop%20diagnostic/near/155199466" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353773.20erroneous.20loop.20diagnostic.html#155199466">(Jan 15 2019 at 20:03)</a>:</h4>
<p><span class="user-mention" data-user-id="116009">@nikomatsakis</span> I run tests locally and they pass</p>



<a name="155199477"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353773%20erroneous%20loop%20diagnostic/near/155199477" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353773.20erroneous.20loop.20diagnostic.html#155199477">(Jan 15 2019 at 20:03)</a>:</h4>
<p>have rebased and force pushed</p>



<a name="155199492"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353773%20erroneous%20loop%20diagnostic/near/155199492" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353773.20erroneous.20loop.20diagnostic.html#155199492">(Jan 15 2019 at 20:03)</a>:</h4>
<p>maybe we should r+ again and see what happens?</p>



<a name="155202536"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353773%20erroneous%20loop%20diagnostic/near/155202536" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353773.20erroneous.20loop.20diagnostic.html#155202536">(Jan 15 2019 at 20:42)</a>:</h4>
<p>hmm</p>



<a name="155202543"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353773%20erroneous%20loop%20diagnostic/near/155202543" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353773.20erroneous.20loop.20diagnostic.html#155202543">(Jan 15 2019 at 20:42)</a>:</h4>
<p>I feel like the order of successors ought to be consistent across all platforms</p>



<a name="155202544"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353773%20erroneous%20loop%20diagnostic/near/155202544" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353773.20erroneous.20loop.20diagnostic.html#155202544">(Jan 15 2019 at 20:42)</a>:</h4>
<p>so that should not be it</p>



<a name="155202549"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353773%20erroneous%20loop%20diagnostic/near/155202549" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353773.20erroneous.20loop.20diagnostic.html#155202549">(Jan 15 2019 at 20:42)</a>:</h4>
<p>must be something else</p>



<a name="155202991"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353773%20erroneous%20loop%20diagnostic/near/155202991" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353773.20erroneous.20loop.20diagnostic.html#155202991">(Jan 15 2019 at 20:48)</a>:</h4>
<p>can we r+ again and see?</p>



<a name="155202995"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353773%20erroneous%20loop%20diagnostic/near/155202995" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353773.20erroneous.20loop.20diagnostic.html#155202995">(Jan 15 2019 at 20:48)</a>:</h4>
<p>just in case</p>



<a name="155203015"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353773%20erroneous%20loop%20diagnostic/near/155203015" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353773.20erroneous.20loop.20diagnostic.html#155203015">(Jan 15 2019 at 20:48)</a>:</h4>
<p>I've just rebased on top of master and pushed again</p>



<a name="155206457"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353773%20erroneous%20loop%20diagnostic/near/155206457" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353773.20erroneous.20loop.20diagnostic.html#155206457">(Jan 15 2019 at 21:34)</a>:</h4>
<p><span class="user-mention" data-user-id="116266">@Santiago Pastorino</span> we could, if the PR is green, but it seems strange to be a spurious error</p>



<a name="155208821"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353773%20erroneous%20loop%20diagnostic/near/155208821" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353773.20erroneous.20loop.20diagnostic.html#155208821">(Jan 15 2019 at 22:09)</a>:</h4>
<p>hmm yeah, gonna check out tomorrow</p>



<a name="155338169"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353773%20erroneous%20loop%20diagnostic/near/155338169" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353773.20erroneous.20loop.20diagnostic.html#155338169">(Jan 17 2019 at 14:21)</a>:</h4>
<p><span class="user-mention" data-user-id="116009">@nikomatsakis</span> so this is failing according to Travis <a href="https://travis-ci.com/rust-lang/rust/jobs/169962373" target="_blank" title="https://travis-ci.com/rust-lang/rust/jobs/169962373">https://travis-ci.com/rust-lang/rust/jobs/169962373</a> on <code>x86_64-gnu-nopt</code> is there an easy way to get that image and debug?</p>



<a name="155342021"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353773%20erroneous%20loop%20diagnostic/near/155342021" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353773.20erroneous.20loop.20diagnostic.html#155342021">(Jan 17 2019 at 15:08)</a>:</h4>
<p>You may want to ask in the infra channel on Discord -- I think there is some way to use docker images but don't know the details.</p>



<a name="155342095"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353773%20erroneous%20loop%20diagnostic/near/155342095" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353773.20erroneous.20loop.20diagnostic.html#155342095">(Jan 17 2019 at 15:09)</a>:</h4>
<p>maybe I can take a look later today or something though</p>



<a name="155342099"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353773%20erroneous%20loop%20diagnostic/near/155342099" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353773.20erroneous.20loop.20diagnostic.html#155342099">(Jan 17 2019 at 15:10)</a>:</h4>
<p>confusing</p>



<a name="155355335"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353773%20erroneous%20loop%20diagnostic/near/155355335" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353773.20erroneous.20loop.20diagnostic.html#155355335">(Jan 17 2019 at 18:02)</a>:</h4>
<p><span class="emoji emoji-1f44d" title="+1">:+1:</span></p>



<a name="156393093"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353773%20erroneous%20loop%20diagnostic/near/156393093" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353773.20erroneous.20loop.20diagnostic.html#156393093">(Jan 18 2019 at 19:26)</a>:</h4>
<p><span class="user-mention" data-user-id="116009">@nikomatsakis</span> nothing come to my mind other than sorting <code>successors</code> and I was suggested on #infra to run <code>src/ci/docker/run.sh</code></p>



<a name="156393160"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353773%20erroneous%20loop%20diagnostic/near/156393160" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353773.20erroneous.20loop.20diagnostic.html#156393160">(Jan 18 2019 at 19:27)</a>:</h4>
<p>I guess I can pass a flag or something to just use the right platform</p>



<a name="156393162"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353773%20erroneous%20loop%20diagnostic/near/156393162" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353773.20erroneous.20loop.20diagnostic.html#156393162">(Jan 18 2019 at 19:27)</a>:</h4>
<p>need  to investigate</p>



<a name="156393332"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353773%20erroneous%20loop%20diagnostic/near/156393332" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353773.20erroneous.20loop.20diagnostic.html#156393332">(Jan 18 2019 at 19:29)</a>:</h4>
<p>ok, I'll have another look in a bit</p>



<a name="157029834"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353773%20erroneous%20loop%20diagnostic/near/157029834" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> pnkfelix <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353773.20erroneous.20loop.20diagnostic.html#157029834">(Jan 28 2019 at 14:45)</a>:</h4>
<p><span class="user-mention" data-user-id="116266">@Santiago Pastorino</span> have you actually managed to confirm in some fashion that <code>successors</code> is returning different orderings?</p>



<a name="157037388"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353773%20erroneous%20loop%20diagnostic/near/157037388" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353773.20erroneous.20loop.20diagnostic.html#157037388">(Jan 28 2019 at 16:26)</a>:</h4>
<p><span class="user-mention" data-user-id="116083">@pnkfelix</span> no, I have this issue in my todo list still</p>



<a name="157037530"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353773%20erroneous%20loop%20diagnostic/near/157037530" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353773.20erroneous.20loop.20diagnostic.html#157037530">(Jan 28 2019 at 16:28)</a>:</h4>
<p>jumped to <a href="https://github.com/rust-lang/rust/issues/52708" target="_blank" title="https://github.com/rust-lang/rust/issues/52708">#52708</a></p>



<a name="157092685"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353773%20erroneous%20loop%20diagnostic/near/157092685" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> pnkfelix <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353773.20erroneous.20loop.20diagnostic.html#157092685">(Jan 29 2019 at 09:37)</a>:</h4>
<p><span class="user-mention" data-user-id="116266">@Santiago Pastorino</span> maybe I should work-steal this (<a href="https://github.com/rust-lang/rust/issues/53773" target="_blank" title="https://github.com/rust-lang/rust/issues/53773">#53773</a>) from you in that case?</p>



<a name="157095778"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353773%20erroneous%20loop%20diagnostic/near/157095778" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353773.20erroneous.20loop.20diagnostic.html#157095778">(Jan 29 2019 at 10:39)</a>:</h4>
<p>yes, feel free to do so</p>



<a name="157097096"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353773%20erroneous%20loop%20diagnostic/near/157097096" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> pnkfelix <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353773.20erroneous.20loop.20diagnostic.html#157097096">(Jan 29 2019 at 11:06)</a>:</h4>
<p>okay. I'm not ready to work-steal anything immediately, but if I manage to finish one of the tasks I'm multi-tasking between right now, I'll consider doing it then.</p>



<a name="157098054"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353773%20erroneous%20loop%20diagnostic/near/157098054" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353773.20erroneous.20loop.20diagnostic.html#157098054">(Jan 29 2019 at 11:26)</a>:</h4>
<p><span aria-label="+1" class="emoji emoji-1f44d" role="img" title="+1">:+1:</span></p>



<a name="157098067"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353773%20erroneous%20loop%20diagnostic/near/157098067" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353773.20erroneous.20loop.20diagnostic.html#157098067">(Jan 29 2019 at 11:26)</a>:</h4>
<p>I was planning to come back to this task at some point also</p>



<a name="157484372"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353773%20erroneous%20loop%20diagnostic/near/157484372" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353773.20erroneous.20loop.20diagnostic.html#157484372">(Feb 03 2019 at 21:27)</a>:</h4>
<p><span class="user-mention" data-user-id="116009">@nikomatsakis</span> <span class="user-mention" data-user-id="116083">@pnkfelix</span> about this issue I've added a commit that fixes the thing <a href="https://github.com/rust-lang/rust/pull/56113" target="_blank" title="https://github.com/rust-lang/rust/pull/56113">https://github.com/rust-lang/rust/pull/56113</a></p>



<a name="157484416"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353773%20erroneous%20loop%20diagnostic/near/157484416" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353773.20erroneous.20loop.20diagnostic.html#157484416">(Feb 03 2019 at 21:28)</a>:</h4>
<p>it was lacking a bless over .nll files</p>



<a name="157484420"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353773%20erroneous%20loop%20diagnostic/near/157484420" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353773.20erroneous.20loop.20diagnostic.html#157484420">(Feb 03 2019 at 21:28)</a>:</h4>
<p>and had no idea that when opening a PR this tests didn't run</p>



<a name="157484421"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353773%20erroneous%20loop%20diagnostic/near/157484421" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353773.20erroneous.20loop.20diagnostic.html#157484421">(Feb 03 2019 at 21:29)</a>:</h4>
<p>they only run on approval</p>



<hr><p>Last updated: Apr 12 2022 at 20:01 UTC</p>
</html>