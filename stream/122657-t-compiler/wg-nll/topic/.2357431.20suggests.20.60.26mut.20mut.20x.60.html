<html>
<head><meta charset="utf-8"><title>#57431 suggests `&amp;mut mut x` · t-compiler/wg-nll · Zulip Chat Archive</title></head>
<h2>Stream: <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/index.html">t-compiler/wg-nll</a></h2>
<h3>Topic: <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2357431.20suggests.20.60.26mut.20mut.20x.60.html">#57431 suggests `&amp;mut mut x`</a></h3>

<hr>

<base href="https://rust-lang.zulipchat.com">

<head><link href="https://zulip-archive.rust-lang.org/style.css" rel="stylesheet"></head>

<a name="154864813"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2357431%20suggests%20%60%26mut%20mut%20x%60/near/154864813" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2357431.20suggests.20.60.26mut.20mut.20x.60.html#154864813">(Jan 10 2019 at 19:30)</a>:</h4>
<p>This looks like an "easy fix" potentially -- I was chatting with <span class="user-mention" data-user-id="116266">@Santiago Pastorino</span> about maybe picking it up</p>



<a name="154864941"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2357431%20suggests%20%60%26mut%20mut%20x%60/near/154864941" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2357431.20suggests.20.60.26mut.20mut.20x.60.html#154864941">(Jan 10 2019 at 19:32)</a>:</h4>
<p><span class="emoji emoji-1f44d" title="+1">:+1:</span></p>



<a name="154865069"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2357431%20suggests%20%60%26mut%20mut%20x%60/near/154865069" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2357431.20suggests.20.60.26mut.20mut.20x.60.html#154865069">(Jan 10 2019 at 19:34)</a>:</h4>
<p>I haven't really looked at all here, I admit</p>



<a name="154865079"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2357431%20suggests%20%60%26mut%20mut%20x%60/near/154865079" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2357431.20suggests.20.60.26mut.20mut.20x.60.html#154865079">(Jan 10 2019 at 19:34)</a>:</h4>
<p>I guess first thing would be to find where that suggestion is being generated</p>



<a name="154865168"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2357431%20suggests%20%60%26mut%20mut%20x%60/near/154865168" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2357431.20suggests.20.60.26mut.20mut.20x.60.html#154865168">(Jan 10 2019 at 19:35)</a>:</h4>
<p><span class="emoji emoji-1f44d" title="+1">:+1:</span></p>



<a name="154865171"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2357431%20suggests%20%60%26mut%20mut%20x%60/near/154865171" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2357431.20suggests.20.60.26mut.20mut.20x.60.html#154865171">(Jan 10 2019 at 19:35)</a>:</h4>
<p>going to check this tomorrow</p>



<a name="154936532"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2357431%20suggests%20%60%26mut%20mut%20x%60/near/154936532" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2357431.20suggests.20.60.26mut.20mut.20x.60.html#154936532">(Jan 11 2019 at 18:37)</a>:</h4>
<div class="codehilite"><pre><span></span><span class="k">struct</span> <span class="nc">X</span><span class="p">;</span><span class="w"></span>
<span class="k">impl</span><span class="w"> </span><span class="n">X</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="k">fn</span> <span class="nf">mutate</span><span class="p">(</span><span class="o">&amp;</span><span class="k">mut</span><span class="w"> </span><span class="bp">self</span><span class="p">)</span><span class="w"> </span><span class="p">{}</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>

<span class="k">fn</span> <span class="nf">main</span><span class="p">()</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="n">term</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">Some</span><span class="p">(</span><span class="n">X</span><span class="p">);</span><span class="w"></span>
<span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="n">term</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">match</span><span class="w"> </span><span class="o">&amp;</span><span class="n">term</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">        </span><span class="nb">Some</span><span class="p">(</span><span class="n">term</span><span class="p">)</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="o">&amp;</span><span class="k">mut</span><span class="w"> </span><span class="n">term</span><span class="p">,</span><span class="w"></span>
<span class="w">        </span><span class="nb">None</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="n">term</span><span class="p">.</span><span class="n">as_ref</span><span class="p">().</span><span class="n">unwrap</span><span class="p">(),</span><span class="w"></span>
<span class="w">    </span><span class="p">};</span><span class="w"></span>
<span class="w">    </span><span class="n">term</span><span class="p">.</span><span class="n">mutate</span><span class="p">();</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>
</pre></div>



<a name="154936575"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2357431%20suggests%20%60%26mut%20mut%20x%60/near/154936575" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2357431.20suggests.20.60.26mut.20mut.20x.60.html#154936575">(Jan 11 2019 at 18:38)</a>:</h4>
<p><span class="user-mention" data-user-id="116009">@nikomatsakis</span> what are the new semantics exactly of matching on something that's <code>&amp;Option</code> and having the arms being <code>Option</code>s?</p>



<a name="154936616"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2357431%20suggests%20%60%26mut%20mut%20x%60/near/154936616" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2357431.20suggests.20.60.26mut.20mut.20x.60.html#154936616">(Jan 11 2019 at 18:38)</a>:</h4>
<p>does something other than that happens?</p>



<a name="154936631"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2357431%20suggests%20%60%26mut%20mut%20x%60/near/154936631" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2357431.20suggests.20.60.26mut.20mut.20x.60.html#154936631">(Jan 11 2019 at 18:38)</a>:</h4>
<p>I mean, inside the arms after the <code>=&gt;</code> do I have something special?</p>



<a name="154936646"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2357431%20suggests%20%60%26mut%20mut%20x%60/near/154936646" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2357431.20suggests.20.60.26mut.20mut.20x.60.html#154936646">(Jan 11 2019 at 18:39)</a>:</h4>
<p>is the behavior written somewhere? :)</p>



<a name="154936649"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2357431%20suggests%20%60%26mut%20mut%20x%60/near/154936649" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2357431.20suggests.20.60.26mut.20mut.20x.60.html#154936649">(Jan 11 2019 at 18:39)</a>:</h4>
<p>I guess there's an RFC, going to look for it</p>



<a name="154939524"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2357431%20suggests%20%60%26mut%20mut%20x%60/near/154939524" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2357431.20suggests.20.60.26mut.20mut.20x.60.html#154939524">(Jan 11 2019 at 19:16)</a>:</h4>
<p><span class="user-mention" data-user-id="116009">@nikomatsakis</span>how much of <a href="https://github.com/rust-lang/rfcs/blob/master/text/2005-match-ergonomics.md" target="_blank" title="https://github.com/rust-lang/rfcs/blob/master/text/2005-match-ergonomics.md">https://github.com/rust-lang/rfcs/blob/master/text/2005-match-ergonomics.md</a> is implemented on 2018?</p>



<a name="154943304"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2357431%20suggests%20%60%26mut%20mut%20x%60/near/154943304" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2357431.20suggests.20.60.26mut.20mut.20x.60.html#154943304">(Jan 11 2019 at 20:08)</a>:</h4>
<p><span class="user-mention" data-user-id="116009">@nikomatsakis</span> anyway, besides from the question I've asked ...</p>



<a name="154943340"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2357431%20suggests%20%60%26mut%20mut%20x%60/near/154943340" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2357431.20suggests.20.60.26mut.20mut.20x.60.html#154943340">(Jan 11 2019 at 20:09)</a>:</h4>
<p>I think we should just remove <code>help: consider changing this to be a mutable reference: &amp;mut mut term</code> entirely in this case</p>



<a name="154943363"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2357431%20suggests%20%60%26mut%20mut%20x%60/near/154943363" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2357431.20suggests.20.60.26mut.20mut.20x.60.html#154943363">(Jan 11 2019 at 20:10)</a>:</h4>
<p>I guess the code is checking the local but is not considering that there's <code>&amp;mut</code> before the local already</p>



<a name="154943429"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2357431%20suggests%20%60%26mut%20mut%20x%60/near/154943429" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2357431.20suggests.20.60.26mut.20mut.20x.60.html#154943429">(Jan 11 2019 at 20:10)</a>:</h4>
<p>I wonder how in the code can I check if there's a &amp;mut before the local</p>



<a name="154943840"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2357431%20suggests%20%60%26mut%20mut%20x%60/near/154943840" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2357431.20suggests.20.60.26mut.20mut.20x.60.html#154943840">(Jan 11 2019 at 20:16)</a>:</h4>
<blockquote>
<p>how much of <a href="https://github.com/rust-lang/rfcs/blob/master/text/2005-match-ergonomics.md" target="_blank" title="https://github.com/rust-lang/rfcs/blob/master/text/2005-match-ergonomics.md">https://github.com/rust-lang/rfcs/blob/master/text/2005-match-ergonomics.md</a> is implemented on 2018?</p>
</blockquote>
<p>all of it</p>



<a name="154943843"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2357431%20suggests%20%60%26mut%20mut%20x%60/near/154943843" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2357431.20suggests.20.60.26mut.20mut.20x.60.html#154943843">(Jan 11 2019 at 20:16)</a>:</h4>
<p>also in 2015 I think</p>



<a name="154943854"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2357431%20suggests%20%60%26mut%20mut%20x%60/near/154943854" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2357431.20suggests.20.60.26mut.20mut.20x.60.html#154943854">(Jan 11 2019 at 20:16)</a>:</h4>
<p>so basically there is an implicit <code>ref</code> added to the bindings</p>



<a name="154944021"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2357431%20suggests%20%60%26mut%20mut%20x%60/near/154944021" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2357431.20suggests.20.60.26mut.20mut.20x.60.html#154944021">(Jan 11 2019 at 20:19)</a>:</h4>
<p>oh ok, I read that differently given that the issue associated <a href="https://github.com/rust-lang/rust/issues/42640" target="_blank" title="https://github.com/rust-lang/rust/issues/42640">https://github.com/rust-lang/rust/issues/42640</a> is open</p>



<a name="154944130"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2357431%20suggests%20%60%26mut%20mut%20x%60/near/154944130" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2357431.20suggests.20.60.26mut.20mut.20x.60.html#154944130">(Jan 11 2019 at 20:20)</a>:</h4>
<blockquote>
<p>I think we should just remove help: consider changing this to be a mutable reference: &amp;mut mut term entirely in this case<br>
<span class="user-mention" data-user-id="116009">@nikomatsakis</span> we need to do this, right?</p>
</blockquote>



<a name="154944144"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2357431%20suggests%20%60%26mut%20mut%20x%60/near/154944144" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2357431.20suggests.20.60.26mut.20mut.20x.60.html#154944144">(Jan 11 2019 at 20:21)</a>:</h4>
<p>also ...</p>



<a name="154944164"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2357431%20suggests%20%60%26mut%20mut%20x%60/near/154944164" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2357431.20suggests.20.60.26mut.20mut.20x.60.html#154944164">(Jan 11 2019 at 20:21)</a>:</h4>
<blockquote>
<p>I guess the code is checking the local but is not considering that there's &amp;mut before the local already<br>
I wonder how in the code can I check if there's a &amp;mut before the local</p>
</blockquote>
<p><span class="emoji emoji-1f446" title="point up">:point_up:</span></p>



<a name="154948352"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2357431%20suggests%20%60%26mut%20mut%20x%60/near/154948352" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2357431.20suggests.20.60.26mut.20mut.20x.60.html#154948352">(Jan 11 2019 at 21:26)</a>:</h4>
<blockquote>
<p>oh ok, I read that differently given that the issue associated <a href="https://github.com/rust-lang/rust/issues/42640" target="_blank" title="https://github.com/rust-lang/rust/issues/42640">https://github.com/rust-lang/rust/issues/42640</a> is open</p>
</blockquote>
<p>that...should probably be closed</p>



<a name="154948417"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2357431%20suggests%20%60%26mut%20mut%20x%60/near/154948417" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2357431.20suggests.20.60.26mut.20mut.20x.60.html#154948417">(Jan 11 2019 at 21:27)</a>:</h4>
<p>well, <span class="user-mention" data-user-id="116266">@Santiago Pastorino</span>, looking more closely, I think the "span" we are using here is a bit odd</p>



<a name="154948495"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2357431%20suggests%20%60%26mut%20mut%20x%60/near/154948495" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2357431.20suggests.20.60.26mut.20mut.20x.60.html#154948495">(Jan 11 2019 at 21:28)</a>:</h4>
<p>I think I've figured this out</p>



<a name="154948512"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2357431%20suggests%20%60%26mut%20mut%20x%60/near/154948512" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2357431.20suggests.20.60.26mut.20mut.20x.60.html#154948512">(Jan 11 2019 at 21:28)</a>:</h4>
<p>anyway, what do you refer by "span" is a bit odd?</p>



<a name="154948547"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2357431%20suggests%20%60%26mut%20mut%20x%60/near/154948547" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2357431.20suggests.20.60.26mut.20mut.20x.60.html#154948547">(Jan 11 2019 at 21:29)</a>:</h4>
<p>I guess what we really <strong>want</strong> to be saying is</p>
<div class="codehilite"><pre><span></span>error[E0596]: cannot borrow `*term` as mutable, as it is behind a `&amp;` reference
  --&gt; src/main.rs:12:5
   |
8  |        let term = match &amp;term {
   |                         ----- help: consider changing this to be a mutable reference: `&amp;mut term`
...
12 |     term.mutate();
   |     ^^^^ `term` is a `&amp;` reference, so the data it refers to cannot be borrowed as mutable
</pre></div>



<a name="154948561"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2357431%20suggests%20%60%26mut%20mut%20x%60/near/154948561" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2357431.20suggests.20.60.26mut.20mut.20x.60.html#154948561">(Jan 11 2019 at 21:29)</a>:</h4>
<p>note that this is a totally different spot we are underlining</p>



<a name="154948578"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2357431%20suggests%20%60%26mut%20mut%20x%60/near/154948578" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2357431.20suggests.20.60.26mut.20mut.20x.60.html#154948578">(Jan 11 2019 at 21:29)</a>:</h4>
<p>however I don't know that we have the logic in place to track that sort of thing back</p>



<a name="154948657"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2357431%20suggests%20%60%26mut%20mut%20x%60/near/154948657" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2357431.20suggests.20.60.26mut.20mut.20x.60.html#154948657">(Jan 11 2019 at 21:30)</a>:</h4>
<p>in any case the code seems to be getting confused, and probably that "help" should just not be printing</p>



<a name="154948663"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2357431%20suggests%20%60%26mut%20mut%20x%60/near/154948663" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2357431.20suggests.20.60.26mut.20mut.20x.60.html#154948663">(Jan 11 2019 at 21:30)</a>:</h4>
<p>as we are not smart enough to track it back to the <code>&amp;term</code> we really want</p>



<a name="154948681"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2357431%20suggests%20%60%26mut%20mut%20x%60/near/154948681" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2357431.20suggests.20.60.26mut.20mut.20x.60.html#154948681">(Jan 11 2019 at 21:30)</a>:</h4>
<p>I am guessing that somehow the problem has to do with the MIR desugaring</p>



<a name="154948712"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2357431%20suggests%20%60%26mut%20mut%20x%60/near/154948712" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2357431.20suggests.20.60.26mut.20mut.20x.60.html#154948712">(Jan 11 2019 at 21:31)</a>:</h4>
<p>i.e., the error message maybe sort of makes sense if you look at the desugaring somehow</p>



<a name="154948721"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2357431%20suggests%20%60%26mut%20mut%20x%60/near/154948721" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2357431.20suggests.20.60.26mut.20mut.20x.60.html#154948721">(Jan 11 2019 at 21:31)</a>:</h4>
<blockquote>
<p>I think I've figured this out</p>
</blockquote>
<p>oh?</p>



<a name="154948743"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2357431%20suggests%20%60%26mut%20mut%20x%60/near/154948743" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2357431.20suggests.20.60.26mut.20mut.20x.60.html#154948743">(Jan 11 2019 at 21:31)</a>:</h4>
<blockquote>
<p>however I don't know that we have the logic in place to track that sort of thing back</p>
</blockquote>
<p>I don't want to confuse you: I don't expect us to correctly underline line 8. That would be the <em>ideal</em> thing, but I don't know that the MIR contains enough info for us to be that smart right now.</p>



<a name="154949673"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2357431%20suggests%20%60%26mut%20mut%20x%60/near/154949673" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2357431.20suggests.20.60.26mut.20mut.20x.60.html#154949673">(Jan 11 2019 at 21:45)</a>:</h4>
<blockquote>
<blockquote>
<p>however I don't know that we have the logic in place to track that sort of thing back</p>
</blockquote>
<p>I don't want to confuse you: I don't expect us to correctly underline line 8. That would be the <em>ideal</em> thing, but I don't know that the MIR contains enough info for us to be that smart right now.</p>
</blockquote>
<p>don't worry, I guess we can go step by step, first I'd just remove that note</p>



<a name="154949785"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2357431%20suggests%20%60%26mut%20mut%20x%60/near/154949785" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2357431.20suggests.20.60.26mut.20mut.20x.60.html#154949785">(Jan 11 2019 at 21:47)</a>:</h4>
<p>I was wondering if I could just check if the thing is a reference and you are mutably borrowing and in that case avoid doing it</p>



<a name="154949858"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2357431%20suggests%20%60%26mut%20mut%20x%60/near/154949858" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2357431.20suggests.20.60.26mut.20mut.20x.60.html#154949858">(Jan 11 2019 at 21:48)</a>:</h4>
<p>but yeah, I should take a look at the mir to see what's going on</p>



<a name="154949865"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2357431%20suggests%20%60%26mut%20mut%20x%60/near/154949865" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2357431.20suggests.20.60.26mut.20mut.20x.60.html#154949865">(Jan 11 2019 at 21:48)</a>:</h4>
<p>by mir desugaring you meant, to see the mir dump and see the statements generated?</p>



<a name="154950100"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2357431%20suggests%20%60%26mut%20mut%20x%60/near/154950100" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2357431.20suggests.20.60.26mut.20mut.20x.60.html#154950100">(Jan 11 2019 at 21:52)</a>:</h4>
<p><span class="user-mention" data-user-id="116009">@nikomatsakis</span> specifically I was checking if I could add some logic here <a href="https://github.com/rust-lang/rust/blob/b43986184b8f4e0d633e8ae1704f0e19aec30cb2/src/librustc_mir/borrow_check/mutability_errors.rs#L392" target="_blank" title="https://github.com/rust-lang/rust/blob/b43986184b8f4e0d633e8ae1704f0e19aec30cb2/src/librustc_mir/borrow_check/mutability_errors.rs#L392">https://github.com/rust-lang/rust/blob/b43986184b8f4e0d633e8ae1704f0e19aec30cb2/src/librustc_mir/borrow_check/mutability_errors.rs#L392</a> and figure that you're mutably borrowing a reference</p>



<a name="154950841"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2357431%20suggests%20%60%26mut%20mut%20x%60/near/154950841" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2357431.20suggests.20.60.26mut.20mut.20x.60.html#154950841">(Jan 11 2019 at 22:04)</a>:</h4>
<p><span class="user-mention" data-user-id="116266">@Santiago Pastorino</span> ok -- is that the path the code goes down, in this example?</p>



<a name="154952904"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2357431%20suggests%20%60%26mut%20mut%20x%60/near/154952904" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2357431.20suggests.20.60.26mut.20mut.20x.60.html#154952904">(Jan 11 2019 at 22:35)</a>:</h4>
<p>unsure, I need to properly check</p>



<a name="154953644"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2357431%20suggests%20%60%26mut%20mut%20x%60/near/154953644" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2357431.20suggests.20.60.26mut.20mut.20x.60.html#154953644">(Jan 11 2019 at 22:49)</a>:</h4>
<p>but according to the error message it should go through that match</p>



<a name="154953704"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2357431%20suggests%20%60%26mut%20mut%20x%60/near/154953704" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2357431.20suggests.20.60.26mut.20mut.20x.60.html#154953704">(Jan 11 2019 at 22:50)</a>:</h4>
<p>don’t remember now if it definitely goes through that arm or may be a different one</p>



<a name="154982740"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2357431%20suggests%20%60%26mut%20mut%20x%60/near/154982740" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2357431.20suggests.20.60.26mut.20mut.20x.60.html#154982740">(Jan 12 2019 at 12:42)</a>:</h4>
<p><span class="user-mention" data-user-id="116009">@nikomatsakis</span> it executes this branch <a href="https://github.com/rust-lang/rust/blob/b43986184b8f4e0d633e8ae1704f0e19aec30cb2/src/librustc_mir/borrow_check/mutability_errors.rs#L380" target="_blank" title="https://github.com/rust-lang/rust/blob/b43986184b8f4e0d633e8ae1704f0e19aec30cb2/src/librustc_mir/borrow_check/mutability_errors.rs#L380">https://github.com/rust-lang/rust/blob/b43986184b8f4e0d633e8ae1704f0e19aec30cb2/src/librustc_mir/borrow_check/mutability_errors.rs#L380</a> and in particular <code>binding_mode</code> is <code>ty::BindingMode::BindByValue(hir::Mutability::MutImmutable)</code></p>



<a name="154982758"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2357431%20suggests%20%60%26mut%20mut%20x%60/near/154982758" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2357431.20suggests.20.60.26mut.20mut.20x.60.html#154982758">(Jan 12 2019 at 12:42)</a>:</h4>
<p>and I figured that I have no idea what that is</p>



<a name="154982760"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2357431%20suggests%20%60%26mut%20mut%20x%60/near/154982760" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2357431.20suggests.20.60.26mut.20mut.20x.60.html#154982760">(Jan 12 2019 at 12:42)</a>:</h4>
<p>unsure why <code>ByValue</code> and why <code>MutImmutable</code>, I'd have said that is <code>ByReference</code> and <code>MutMutable</code>, hehehe</p>



<a name="154982768"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2357431%20suggests%20%60%26mut%20mut%20x%60/near/154982768" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2357431.20suggests.20.60.26mut.20mut.20x.60.html#154982768">(Jan 12 2019 at 12:43)</a>:</h4>
<p>it's probably talking about a different thing that the one I'm assuming</p>



<a name="154982773"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2357431%20suggests%20%60%26mut%20mut%20x%60/near/154982773" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2357431.20suggests.20.60.26mut.20mut.20x.60.html#154982773">(Jan 12 2019 at 12:43)</a>:</h4>
<p>I'm assuming <code>&amp;mut term</code></p>



<a name="154982935"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2357431%20suggests%20%60%26mut%20mut%20x%60/near/154982935" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Matthew Jasper <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2357431.20suggests.20.60.26mut.20mut.20x.60.html#154982935">(Jan 12 2019 at 12:48)</a>:</h4>
<p>The binding mode is referring to the <code>term</code> in <code>Some(term)</code></p>



<a name="154983572"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2357431%20suggests%20%60%26mut%20mut%20x%60/near/154983572" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2357431.20suggests.20.60.26mut.20mut.20x.60.html#154983572">(Jan 12 2019 at 13:10)</a>:</h4>
<p><span class="user-mention" data-user-id="116118">@Matthew Jasper</span> yeah, that was the other possibility but still that should be of type <code>&amp;X</code> so I'd assume we get a <code>ty::BindingMode::BindByReference(hir::Mutability::MutImmutable</code> instead of <code>BindByValue</code></p>



<a name="154983576"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2357431%20suggests%20%60%26mut%20mut%20x%60/near/154983576" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2357431.20suggests.20.60.26mut.20mut.20x.60.html#154983576">(Jan 12 2019 at 13:10)</a>:</h4>
<p>and I also wonder how to get the <code>&amp;mut</code> info</p>



<a name="154985902"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2357431%20suggests%20%60%26mut%20mut%20x%60/near/154985902" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Matthew Jasper <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2357431.20suggests.20.60.26mut.20mut.20x.60.html#154985902">(Jan 12 2019 at 14:25)</a>:</h4>
<p>Actually, I'm wrong, it's the <code>term</code> in the second <code>let term = </code>. (having the same name for all of the variables isn't great...)</p>



<a name="154998612"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2357431%20suggests%20%60%26mut%20mut%20x%60/near/154998612" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2357431.20suggests.20.60.26mut.20mut.20x.60.html#154998612">(Jan 12 2019 at 20:32)</a>:</h4>
<p>agreed that confuses a lot :P</p>



<a name="154998613"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2357431%20suggests%20%60%26mut%20mut%20x%60/near/154998613" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2357431.20suggests.20.60.26mut.20mut.20x.60.html#154998613">(Jan 12 2019 at 20:32)</a>:</h4>
<p>but, I think it's ...</p>



<a name="154998621"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2357431%20suggests%20%60%26mut%20mut%20x%60/near/154998621" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2357431.20suggests.20.60.26mut.20mut.20x.60.html#154998621">(Jan 12 2019 at 20:32)</a>:</h4>
<div class="codehilite"><pre><span></span>Some(term) =&gt; &amp;mut term,
   |          --------- help: consider changing this to be a mutable reference: &amp;mut mut term
</pre></div>



<a name="154998636"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2357431%20suggests%20%60%26mut%20mut%20x%60/near/154998636" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2357431.20suggests.20.60.26mut.20mut.20x.60.html#154998636">(Jan 12 2019 at 20:33)</a>:</h4>
<p>it's the term that's comes from that arm</p>



<a name="154998638"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2357431%20suggests%20%60%26mut%20mut%20x%60/near/154998638" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2357431.20suggests.20.60.26mut.20mut.20x.60.html#154998638">(Jan 12 2019 at 20:33)</a>:</h4>
<p><code>Some(term)</code></p>



<a name="154998648"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2357431%20suggests%20%60%26mut%20mut%20x%60/near/154998648" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2357431.20suggests.20.60.26mut.20mut.20x.60.html#154998648">(Jan 12 2019 at 20:33)</a>:</h4>
<p>and given match ergonomics, I believe that's a <code>&amp;</code> + the supposed type</p>



<a name="154998695"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2357431%20suggests%20%60%26mut%20mut%20x%60/near/154998695" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2357431.20suggests.20.60.26mut.20mut.20x.60.html#154998695">(Jan 12 2019 at 20:34)</a>:</h4>
<p>which is <code>X</code></p>



<a name="154998699"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2357431%20suggests%20%60%26mut%20mut%20x%60/near/154998699" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2357431.20suggests.20.60.26mut.20mut.20x.60.html#154998699">(Jan 12 2019 at 20:34)</a>:</h4>
<p>that's why I believe that should be a <code>&amp;X</code></p>



<a name="154998700"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2357431%20suggests%20%60%26mut%20mut%20x%60/near/154998700" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2357431.20suggests.20.60.26mut.20mut.20x.60.html#154998700">(Jan 12 2019 at 20:34)</a>:</h4>
<p><span class="user-mention" data-user-id="116118">@Matthew Jasper</span> ^^^</p>



<a name="154999307"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2357431%20suggests%20%60%26mut%20mut%20x%60/near/154999307" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Matthew Jasper <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2357431.20suggests.20.60.26mut.20mut.20x.60.html#154999307">(Jan 12 2019 at 20:53)</a>:</h4>
<p>It might be better to look at a case without a match. This results in the same diagnostics issue:</p>
<div class="codehilite"><pre><span></span><span class="k">struct</span> <span class="nc">X</span><span class="p">;</span><span class="w"></span>
<span class="k">impl</span><span class="w"> </span><span class="n">X</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="k">fn</span> <span class="nf">mutate</span><span class="p">(</span><span class="o">&amp;</span><span class="k">mut</span><span class="w"> </span><span class="bp">self</span><span class="p">)</span><span class="w"> </span><span class="p">{}</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>

<span class="k">fn</span> <span class="nf">foo</span><span class="p">(</span><span class="n">c</span>: <span class="kt">bool</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="k">mut</span><span class="w"> </span><span class="n">term</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">X</span><span class="p">;</span><span class="w"></span>
<span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="n">ref_term</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="n">c</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">        </span><span class="o">&amp;</span><span class="k">mut</span><span class="w"> </span><span class="n">term</span><span class="w"></span>
<span class="w">    </span><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">        </span><span class="o">&amp;</span><span class="n">X</span><span class="w"></span>
<span class="w">    </span><span class="p">};</span><span class="w"></span>
<span class="w">    </span><span class="n">ref_term</span><span class="p">.</span><span class="n">mutate</span><span class="p">();</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>
</pre></div>



<a name="155105771"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2357431%20suggests%20%60%26mut%20mut%20x%60/near/155105771" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2357431.20suggests.20.60.26mut.20mut.20x.60.html#155105771">(Jan 14 2019 at 18:42)</a>:</h4>
<p><span class="user-mention" data-user-id="116118">@Matthew Jasper</span> back with this</p>



<a name="155105779"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2357431%20suggests%20%60%26mut%20mut%20x%60/near/155105779" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2357431.20suggests.20.60.26mut.20mut.20x.60.html#155105779">(Jan 14 2019 at 18:42)</a>:</h4>
<p>yes, your example is simpler</p>



<a name="155105782"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2357431%20suggests%20%60%26mut%20mut%20x%60/near/155105782" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2357431.20suggests.20.60.26mut.20mut.20x.60.html#155105782">(Jan 14 2019 at 18:42)</a>:</h4>
<p>checking it now</p>



<a name="155105801"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2357431%20suggests%20%60%26mut%20mut%20x%60/near/155105801" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2357431.20suggests.20.60.26mut.20mut.20x.60.html#155105801">(Jan 14 2019 at 18:42)</a>:</h4>
<p>I think what I've said is still valid though</p>



<a name="155106094"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2357431%20suggests%20%60%26mut%20mut%20x%60/near/155106094" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2357431.20suggests.20.60.26mut.20mut.20x.60.html#155106094">(Jan 14 2019 at 18:46)</a>:</h4>
<p>so ...</p>



<a name="155106100"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2357431%20suggests%20%60%26mut%20mut%20x%60/near/155106100" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2357431.20suggests.20.60.26mut.20mut.20x.60.html#155106100">(Jan 14 2019 at 18:46)</a>:</h4>
<div class="codehilite"><pre><span></span><span class="k">struct</span> <span class="nc">X</span><span class="p">;</span><span class="w"></span>
<span class="k">impl</span><span class="w"> </span><span class="n">X</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="k">fn</span> <span class="nf">mutate</span><span class="p">(</span><span class="o">&amp;</span><span class="k">mut</span><span class="w"> </span><span class="bp">self</span><span class="p">)</span><span class="w"> </span><span class="p">{}</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>

<span class="k">fn</span> <span class="nf">foo</span><span class="p">(</span><span class="n">c</span>: <span class="kt">bool</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="k">mut</span><span class="w"> </span><span class="n">term</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">X</span><span class="p">;</span><span class="w"></span>
<span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="n">ref_term</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="n">c</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">        </span><span class="o">&amp;</span><span class="k">mut</span><span class="w"> </span><span class="n">term</span><span class="w"></span>
<span class="w">    </span><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">        </span><span class="o">&amp;</span><span class="n">X</span><span class="w"></span>
<span class="w">    </span><span class="p">};</span><span class="w"></span>
<span class="w">    </span><span class="n">ref_term</span><span class="p">.</span><span class="n">mutate</span><span class="p">();</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>
</pre></div>



<a name="155106102"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2357431%20suggests%20%60%26mut%20mut%20x%60/near/155106102" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2357431.20suggests.20.60.26mut.20mut.20x.60.html#155106102">(Jan 14 2019 at 18:46)</a>:</h4>
<p>the error is ...</p>



<a name="155106112"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2357431%20suggests%20%60%26mut%20mut%20x%60/near/155106112" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2357431.20suggests.20.60.26mut.20mut.20x.60.html#155106112">(Jan 14 2019 at 18:46)</a>:</h4>
<div class="codehilite"><pre><span></span>error[E0596]: cannot borrow `*ref_term` as mutable, as it is behind a `&amp;` reference
  --&gt; src/test/ui/nll/issue-57431.rs:15:5
   |
11 |         &amp;mut term
   |         --------- help: consider changing this to be a mutable reference: `&amp;mut mut term`
...
15 |     ref_term.mutate();
   |     ^^^^^^^^ `ref_term` is a `&amp;` reference, so the data it refers to cannot be borrowed as mutable

error: aborting due to previous error

For more information about this error, try `rustc --explain E0596`.
</pre></div>



<a name="155106216"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2357431%20suggests%20%60%26mut%20mut%20x%60/near/155106216" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2357431.20suggests.20.60.26mut.20mut.20x.60.html#155106216">(Jan 14 2019 at 18:48)</a>:</h4>
<p>so here <a href="https://github.com/rust-lang/rust/blob/b43986184b8f4e0d633e8ae1704f0e19aec30cb2/src/librustc_mir/borrow_check/mutability_errors.rs#L380" target="_blank" title="https://github.com/rust-lang/rust/blob/b43986184b8f4e0d633e8ae1704f0e19aec30cb2/src/librustc_mir/borrow_check/mutability_errors.rs#L380">https://github.com/rust-lang/rust/blob/b43986184b8f4e0d633e8ae1704f0e19aec30cb2/src/librustc_mir/borrow_check/mutability_errors.rs#L380</a> <code>local_decl.is_user_variable.as_ref()</code> is returning a thing which it's<code>binding_mode</code> is <code>ty::BindingMode::BindByValue(hir::Mutability::MutImmutable)</code></p>



<a name="155106463"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2357431%20suggests%20%60%26mut%20mut%20x%60/near/155106463" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2357431.20suggests.20.60.26mut.20mut.20x.60.html#155106463">(Jan 14 2019 at 18:50)</a>:</h4>
<p>so I guess that's just talking about <code>term</code> and not <code>&amp;mut term</code></p>



<a name="155106501"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2357431%20suggests%20%60%26mut%20mut%20x%60/near/155106501" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2357431.20suggests.20.60.26mut.20mut.20x.60.html#155106501">(Jan 14 2019 at 18:50)</a>:</h4>
<p>I wonder if I can get somehow that <code>&amp;mut</code> applied to <code>term</code>?</p>



<a name="155111457"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2357431%20suggests%20%60%26mut%20mut%20x%60/near/155111457" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2357431.20suggests.20.60.26mut.20mut.20x.60.html#155111457">(Jan 14 2019 at 19:54)</a>:</h4>
<p><span class="user-mention" data-user-id="116009">@nikomatsakis</span> any thought on this?</p>



<a name="155111466"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2357431%20suggests%20%60%26mut%20mut%20x%60/near/155111466" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2357431.20suggests.20.60.26mut.20mut.20x.60.html#155111466">(Jan 14 2019 at 19:54)</a>:</h4>
<div class="codehilite"><pre><span></span>DEBUG 2019-01-14T19:43:40Z: rustc_mir::borrow_check::mutability_errors: report_mutability_error(access_place=(*_2), span=src/test/ui/nll/issue-57431.rs:15:5: 15:13, the_place_err=(*_2), error_access=MutableBorrow, location=bb4[2],)
DEBUG 2019-01-14T19:43:40Z: rustc_mir::borrow_check::mutability_errors: report_mutability_error: access_place_desc=Some(&quot;*ref_term&quot;)
DEBUG 2019-01-14T19:43:40Z: rustc_mir::borrow_check::mutability_errors: report_mutability_error: item_msg=&quot;`*ref_term`&quot;, reason=&quot;, as it is behind a `&amp;` reference&quot;
DEBUG 2019-01-14T19:43:40Z: rustc_mir::borrow_check::error_reporting: borrow_spans: use_span=src/test/ui/nll/issue-57431.rs:15:5: 15:13 location=bb4[2]
DEBUG 2019-01-14T19:43:40Z: rustc_mir::borrow_check::mutability_errors: report_mutability_error: act=&quot;borrow as mutable&quot;, acted_on=&quot;borrowed as mutable&quot;
DEBUG 2019-01-14T19:43:40Z: rustc_mir::borrow_check::mutability_errors: report_mutability_error:local=_2, local_decl=LocalDecl { mutability: Not, is_user_variable: Some(Set(Var(VarBindingForm { binding_mode: BindByValue(MutImmutable), opt_ty_info: None, opt_match_place: Some((None, src/test/ui/nll/issue-57431.rs:10:20: 14:6)), pat_span: src/test/ui/nll/issue-57431.rs:10:9: 10:17 }))), internal: false, is_block_tail: None, ty: &amp;&#39;_#6r X, user_ty: UserTypeProjections { contents: [] }, name: Some(ref_term), source_info: SourceInfo { span: src/test/ui/nll/issue-57431.rs:10:9: 10:17, scope: scope[4] }, visibility_scope: scope[3] },)
</pre></div>



<a name="155111468"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2357431%20suggests%20%60%26mut%20mut%20x%60/near/155111468" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2357431.20suggests.20.60.26mut.20mut.20x.60.html#155111468">(Jan 14 2019 at 19:54)</a>:</h4>
<p>this is the logs I'm getting</p>



<a name="155111490"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2357431%20suggests%20%60%26mut%20mut%20x%60/near/155111490" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2357431.20suggests.20.60.26mut.20mut.20x.60.html#155111490">(Jan 14 2019 at 19:55)</a>:</h4>
<p>unsure for instance why <code>access_place</code> is <code>Some("*ref_term")</code></p>



<a name="155111723"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2357431%20suggests%20%60%26mut%20mut%20x%60/near/155111723" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2357431.20suggests.20.60.26mut.20mut.20x.60.html#155111723">(Jan 14 2019 at 19:58)</a>:</h4>
<p>I see that the local this is referring to is <code>_2</code></p>



<a name="155111728"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2357431%20suggests%20%60%26mut%20mut%20x%60/near/155111728" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2357431.20suggests.20.60.26mut.20mut.20x.60.html#155111728">(Jan 14 2019 at 19:58)</a>:</h4>
<p>from mir output that is ...</p>



<a name="155111771"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2357431%20suggests%20%60%26mut%20mut%20x%60/near/155111771" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2357431.20suggests.20.60.26mut.20mut.20x.60.html#155111771">(Jan 14 2019 at 19:59)</a>:</h4>
<div class="codehilite"><pre><span></span>        StorageLive(_3);                 // bb2[0]: scope 1 at src/test/ui/nll/issue-57431.rs:11:9: 11:18
        _3 = &amp;&#39;_#2r mut _1;              // bb2[1]: scope 1 at src/test/ui/nll/issue-57431.rs:11:9: 11:18
        _2 = &amp;&#39;_#3r (*_3);               // bb2[2]: scope 1 at src/test/ui/nll/issue-57431.rs:11:9: 11:18
        StorageDead(_3);                 // bb2[3]: scope 1 at src/test/ui/nll/issue-57431.rs:12:5: 12:6
</pre></div>



<a name="155111776"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2357431%20suggests%20%60%26mut%20mut%20x%60/near/155111776" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2357431.20suggests.20.60.26mut.20mut.20x.60.html#155111776">(Jan 14 2019 at 19:59)</a>:</h4>
<p>line 11 is ...</p>



<a name="155111796"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2357431%20suggests%20%60%26mut%20mut%20x%60/near/155111796" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2357431.20suggests.20.60.26mut.20mut.20x.60.html#155111796">(Jan 14 2019 at 19:59)</a>:</h4>
<p><code>&amp;mut term</code></p>



<a name="155111907"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2357431%20suggests%20%60%26mut%20mut%20x%60/near/155111907" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2357431.20suggests.20.60.26mut.20mut.20x.60.html#155111907">(Jan 14 2019 at 20:00)</a>:</h4>
<p>from there I guess <code>_3</code> is <code>&amp;mut term</code> and <code>_1</code> is <code>term</code></p>



<a name="155111929"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2357431%20suggests%20%60%26mut%20mut%20x%60/near/155111929" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2357431.20suggests.20.60.26mut.20mut.20x.60.html#155111929">(Jan 14 2019 at 20:01)</a>:</h4>
<p><code>_2</code> is <code>&amp;*(&amp;mut term)</code>?</p>



<a name="155111939"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2357431%20suggests%20%60%26mut%20mut%20x%60/near/155111939" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2357431.20suggests.20.60.26mut.20mut.20x.60.html#155111939">(Jan 14 2019 at 20:01)</a>:</h4>
<p>if so ... why?</p>



<a name="155112035"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2357431%20suggests%20%60%26mut%20mut%20x%60/near/155112035" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Matthew Jasper <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2357431.20suggests.20.60.26mut.20mut.20x.60.html#155112035">(Jan 14 2019 at 20:02)</a>:</h4>
<p>The <code>else</code> branch has type <code>&amp;X</code>, so <code>&amp;mut term</code> is being coerced to match</p>



<a name="155112145"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2357431%20suggests%20%60%26mut%20mut%20x%60/near/155112145" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2357431.20suggests.20.60.26mut.20mut.20x.60.html#155112145">(Jan 14 2019 at 20:03)</a>:</h4>
<p>you're right :)</p>



<a name="155112314"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2357431%20suggests%20%60%26mut%20mut%20x%60/near/155112314" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2357431.20suggests.20.60.26mut.20mut.20x.60.html#155112314">(Jan 14 2019 at 20:05)</a>:</h4>
<p>so then why is <code>_2</code> which is <code>&amp;*(&amp;mut term)</code> a <code>ty::BindingMode::BindByValue</code> and <code>hir::Mutability::MutImmutable</code> thing?</p>



<a name="155112735"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2357431%20suggests%20%60%26mut%20mut%20x%60/near/155112735" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Matthew Jasper <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2357431.20suggests.20.60.26mut.20mut.20x.60.html#155112735">(Jan 14 2019 at 20:11)</a>:</h4>
<p>It's declared <code>let ref_temp</code>, which is immutable since there's no <code>mut</code> and by value because there's no <code>ref</code></p>



<a name="155141811"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2357431%20suggests%20%60%26mut%20mut%20x%60/near/155141811" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2357431.20suggests.20.60.26mut.20mut.20x.60.html#155141811">(Jan 15 2019 at 03:14)</a>:</h4>
<p>ahh so my understanding about what's BindByValue and what's MutImmutable is completely different from the one it has</p>



<a name="155141815"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2357431%20suggests%20%60%26mut%20mut%20x%60/near/155141815" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2357431.20suggests.20.60.26mut.20mut.20x.60.html#155141815">(Jan 15 2019 at 03:14)</a>:</h4>
<p>you mean that that's solely based on the presence of a <code>mut</code> in the binding and a <code>ref</code>?</p>



<a name="155206559"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2357431%20suggests%20%60%26mut%20mut%20x%60/near/155206559" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2357431.20suggests.20.60.26mut.20mut.20x.60.html#155206559">(Jan 15 2019 at 21:35)</a>:</h4>
<p>OK, that second example is interesting</p>



<a name="155206562"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2357431%20suggests%20%60%26mut%20mut%20x%60/near/155206562" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2357431.20suggests.20.60.26mut.20mut.20x.60.html#155206562">(Jan 15 2019 at 21:35)</a>:</h4>
<p>Hmm</p>



<a name="155206629"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2357431%20suggests%20%60%26mut%20mut%20x%60/near/155206629" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2357431.20suggests.20.60.26mut.20mut.20x.60.html#155206629">(Jan 15 2019 at 21:36)</a>:</h4>
<p>so the problem here is that the <code>&amp;</code> we see in the source is one that was autogenerated from a coercion</p>



<a name="155206635"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2357431%20suggests%20%60%26mut%20mut%20x%60/near/155206635" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2357431.20suggests.20.60.26mut.20mut.20x.60.html#155206635">(Jan 15 2019 at 21:36)</a>:</h4>
<p>it feels like something we could track</p>



<a name="155206650"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2357431%20suggests%20%60%26mut%20mut%20x%60/near/155206650" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2357431.20suggests.20.60.26mut.20mut.20x.60.html#155206650">(Jan 15 2019 at 21:36)</a>:</h4>
<p>in which case we could say "if the borrow in question comes from a coercion, don't print this suggestion" or something</p>



<a name="155208352"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2357431%20suggests%20%60%26mut%20mut%20x%60/near/155208352" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2357431.20suggests.20.60.26mut.20mut.20x.60.html#155208352">(Jan 15 2019 at 22:01)</a>:</h4>
<p>ahh you're right</p>



<a name="155208797"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2357431%20suggests%20%60%26mut%20mut%20x%60/near/155208797" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2357431.20suggests.20.60.26mut.20mut.20x.60.html#155208797">(Jan 15 2019 at 22:08)</a>:</h4>
<p>any pointer or idea on where that could be tracked ... :)</p>



<a name="155208826"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2357431%20suggests%20%60%26mut%20mut%20x%60/near/155208826" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2357431.20suggests.20.60.26mut.20mut.20x.60.html#155208826">(Jan 15 2019 at 22:09)</a>:</h4>
<p>going to check out tomorrow</p>



<a name="155338261"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2357431%20suggests%20%60%26mut%20mut%20x%60/near/155338261" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2357431.20suggests.20.60.26mut.20mut.20x.60.html#155338261">(Jan 17 2019 at 14:22)</a>:</h4>
<blockquote>
<p>so the problem here is that the <code>&amp;</code> we see in the source is one that was autogenerated from a coercion</p>
</blockquote>
<p>ok, so this makes sense but I wonder if my approach was correct</p>



<a name="155338262"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2357431%20suggests%20%60%26mut%20mut%20x%60/near/155338262" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2357431.20suggests.20.60.26mut.20mut.20x.60.html#155338262">(Jan 17 2019 at 14:22)</a>:</h4>
<p>so ...</p>



<a name="155338306"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2357431%20suggests%20%60%26mut%20mut%20x%60/near/155338306" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2357431.20suggests.20.60.26mut.20mut.20x.60.html#155338306">(Jan 17 2019 at 14:22)</a>:</h4>
<p>I could track those autogenerated <code>&amp;</code> from a coercion, need to investigate exactly where</p>



<a name="155338310"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2357431%20suggests%20%60%26mut%20mut%20x%60/near/155338310" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2357431.20suggests.20.60.26mut.20mut.20x.60.html#155338310">(Jan 17 2019 at 14:23)</a>:</h4>
<p>the question is ...</p>



<a name="155338311"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2357431%20suggests%20%60%26mut%20mut%20x%60/near/155338311" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2357431.20suggests.20.60.26mut.20mut.20x.60.html#155338311">(Jan 17 2019 at 14:23)</a>:</h4>
<p><a href="https://github.com/rust-lang/rust/blob/b43986184b8f4e0d633e8ae1704f0e19aec30cb2/src/librustc_mir/borrow_check/mutability_errors.rs#L380" target="_blank" title="https://github.com/rust-lang/rust/blob/b43986184b8f4e0d633e8ae1704f0e19aec30cb2/src/librustc_mir/borrow_check/mutability_errors.rs#L380">https://github.com/rust-lang/rust/blob/b43986184b8f4e0d633e8ae1704f0e19aec30cb2/src/librustc_mir/borrow_check/mutability_errors.rs#L380</a></p>



<a name="155338400"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2357431%20suggests%20%60%26mut%20mut%20x%60/near/155338400" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2357431.20suggests.20.60.26mut.20mut.20x.60.html#155338400">(Jan 17 2019 at 14:24)</a>:</h4>
<p>there I was checking for a <code>BindByValue</code> binding so no occurrence of the borrow</p>



<a name="155338458"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2357431%20suggests%20%60%26mut%20mut%20x%60/near/155338458" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2357431.20suggests.20.60.26mut.20mut.20x.60.html#155338458">(Jan 17 2019 at 14:24)</a>:</h4>
<p>as <span class="user-mention" data-user-id="116118">@Matthew Jasper</span> said that's related with <code>ref</code> or <code>mut</code> in a binding so that's not what I should look for</p>



<a name="155338532"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2357431%20suggests%20%60%26mut%20mut%20x%60/near/155338532" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2357431.20suggests.20.60.26mut.20mut.20x.60.html#155338532">(Jan 17 2019 at 14:25)</a>:</h4>
<p><span class="user-mention" data-user-id="116009">@nikomatsakis</span>  the question is how can I figure out there if the binding is related  to a borrow or a mutable borrow?</p>



<a name="155361046"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2357431%20suggests%20%60%26mut%20mut%20x%60/near/155361046" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2357431.20suggests.20.60.26mut.20mut.20x.60.html#155361046">(Jan 17 2019 at 19:17)</a>:</h4>
<p><span class="user-mention" data-user-id="116009">@nikomatsakis</span> back to this, I figured that just by adding some kind of information that says if the ref is autogenerated or not is enough</p>



<a name="155361059"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2357431%20suggests%20%60%26mut%20mut%20x%60/near/155361059" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2357431.20suggests.20.60.26mut.20mut.20x.60.html#155361059">(Jan 17 2019 at 19:17)</a>:</h4>
<p>my previous question was wrong :)</p>



<a name="155361135"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2357431%20suggests%20%60%26mut%20mut%20x%60/near/155361135" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2357431.20suggests.20.60.26mut.20mut.20x.60.html#155361135">(Jan 17 2019 at 19:18)</a>:</h4>
<p>I wonder where could I track this ... any idea on where to look?</p>



<a name="155361165"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2357431%20suggests%20%60%26mut%20mut%20x%60/near/155361165" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2357431.20suggests.20.60.26mut.20mut.20x.60.html#155361165">(Jan 17 2019 at 19:18)</a>:</h4>
<p>I guess we want <code>Projection</code> to have an autogenerated boolean?</p>



<a name="156323778"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2357431%20suggests%20%60%26mut%20mut%20x%60/near/156323778" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2357431.20suggests.20.60.26mut.20mut.20x.60.html#156323778">(Jan 17 2019 at 22:10)</a>:</h4>
<p>this is not about the <em>projection</em></p>



<a name="156323785"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2357431%20suggests%20%60%26mut%20mut%20x%60/near/156323785" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2357431.20suggests.20.60.26mut.20mut.20x.60.html#156323785">(Jan 17 2019 at 22:10)</a>:</h4>
<p>at least I don't think so</p>



<a name="156323796"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2357431%20suggests%20%60%26mut%20mut%20x%60/near/156323796" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2357431.20suggests.20.60.26mut.20mut.20x.60.html#156323796">(Jan 17 2019 at 22:10)</a>:</h4>
<p>it's about the actual <strong>borrow</strong>, I think?</p>



<a name="156323970"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2357431%20suggests%20%60%26mut%20mut%20x%60/near/156323970" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2357431.20suggests.20.60.26mut.20mut.20x.60.html#156323970">(Jan 17 2019 at 22:13)</a>:</h4>
<p>that is, there is some statement like <code>X = &amp;Y.Z</code>, and I think it is this <em>statement</em> that might carry a flag about it being synthetic</p>



<a name="156324046"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2357431%20suggests%20%60%26mut%20mut%20x%60/near/156324046" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2357431.20suggests.20.60.26mut.20mut.20x.60.html#156324046">(Jan 17 2019 at 22:14)</a>:</h4>
<p>I think if we wanted to trace this, we would extend the MIR and HAIR with such a flag -- <strong>maybe</strong> in the source-info somewhere? -- and then we would modify the HAIR so that when we are generating "auto-generated" refs, we set this flag, and same for HAIR-&gt;MIR lowering</p>



<a name="156324693"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2357431%20suggests%20%60%26mut%20mut%20x%60/near/156324693" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2357431.20suggests.20.60.26mut.20mut.20x.60.html#156324693">(Jan 17 2019 at 22:24)</a>:</h4>
<p>as an example, here is a point in creating the HAIR where we know that the borrow is synthetic:</p>
<p><a href="https://github.com/rust-lang/rust/blob/daa53a52a2667533d5fe59bfcc5b8614b79c3d31/src/librustc_mir/hair/cx/expr.rs#L134-L139" target="_blank" title="https://github.com/rust-lang/rust/blob/daa53a52a2667533d5fe59bfcc5b8614b79c3d31/src/librustc_mir/hair/cx/expr.rs#L134-L139">https://github.com/rust-lang/rust/blob/daa53a52a2667533d5fe59bfcc5b8614b79c3d31/src/librustc_mir/hair/cx/expr.rs#L134-L139</a></p>



<a name="156548241"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2357431%20suggests%20%60%26mut%20mut%20x%60/near/156548241" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2357431.20suggests.20.60.26mut.20mut.20x.60.html#156548241">(Jan 21 2019 at 16:54)</a>:</h4>
<blockquote>
<p>that is, there is some statement like <code>X = &amp;Y.Z</code>, and I think it is this <em>statement</em> that might carry a flag about it being synthetic</p>
</blockquote>
<p><span class="user-mention" data-user-id="116009">@nikomatsakis</span> what's the meaning of being synthetic to start with? :)</p>



<a name="156548320"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2357431%20suggests%20%60%26mut%20mut%20x%60/near/156548320" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2357431.20suggests.20.60.26mut.20mut.20x.60.html#156548320">(Jan 21 2019 at 16:55)</a>:</h4>
<p>I guess I understand given the context but just in case clarification won't hurt</p>



<a name="156548336"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2357431%20suggests%20%60%26mut%20mut%20x%60/near/156548336" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2357431.20suggests.20.60.26mut.20mut.20x.60.html#156548336">(Jan 21 2019 at 16:55)</a>:</h4>
<blockquote>
<p>as an example, here is a point in creating the HAIR where we know that the borrow is synthetic:</p>
<p><a href="https://github.com/rust-lang/rust/blob/daa53a52a2667533d5fe59bfcc5b8614b79c3d31/src/librustc_mir/hair/cx/expr.rs#L134-L139" target="_blank" title="https://github.com/rust-lang/rust/blob/daa53a52a2667533d5fe59bfcc5b8614b79c3d31/src/librustc_mir/hair/cx/expr.rs#L134-L139">https://github.com/rust-lang/rust/blob/daa53a52a2667533d5fe59bfcc5b8614b79c3d31/src/librustc_mir/hair/cx/expr.rs#L134-L139</a></p>
</blockquote>
<p>I guess we may add a flag to <code>ExprKind::Borrow</code> to handle the "auto-generated" fact?</p>



<a name="156636450"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2357431%20suggests%20%60%26mut%20mut%20x%60/near/156636450" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2357431.20suggests.20.60.26mut.20mut.20x.60.html#156636450">(Jan 22 2019 at 20:26)</a>:</h4>
<p><span class="user-mention" data-user-id="116266">@Santiago Pastorino</span> </p>
<blockquote>
<p>what's the meaning of being synthetic to start with? :)</p>
</blockquote>
<p>by synthetic, I meant "does not corespond to a <code>&amp;</code> that the user typed"</p>
<blockquote>
<p>I guess we may add a flag to ExprKind::Borrow to handle the "auto-generated" fact?</p>
</blockquote>
<p>yeah basically</p>



<hr><p>Last updated: Apr 12 2022 at 20:01 UTC</p>
</html>