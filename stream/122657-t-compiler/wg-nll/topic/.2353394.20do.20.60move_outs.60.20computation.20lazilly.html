<html>
<head><meta charset="utf-8"><title>#53394 do `move_outs` computation lazilly · t-compiler/wg-nll · Zulip Chat Archive</title></head>
<h2>Stream: <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/index.html">t-compiler/wg-nll</a></h2>
<h3>Topic: <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353394.20do.20.60move_outs.60.20computation.20lazilly.html">#53394 do `move_outs` computation lazilly</a></h3>

<hr>

<base href="https://rust-lang.zulipchat.com">

<head><link href="https://zulip-archive.rust-lang.org/style.css" rel="stylesheet"></head>

<a name="132203548"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353394%20do%20%60move_outs%60%20computation%20lazilly/near/132203548" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353394.20do.20.60move_outs.60.20computation.20lazilly.html#132203548">(Aug 15 2018 at 22:27)</a>:</h4>
<p>So <span class="user-mention" data-user-id="116266">@Santiago Pastorino</span>, this PR does a reverse DFS <a href="https://github.com/rust-lang/rust/pull/53314/" target="_blank" title="https://github.com/rust-lang/rust/pull/53314/">https://github.com/rust-lang/rust/pull/53314/</a>  -- but I realize it is perhaps a bit different than what you would do, since it does it based on <code>PointIndex</code> values (which map to <code>Location</code>)</p>



<a name="132203573"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353394%20do%20%60move_outs%60%20computation%20lazilly/near/132203573" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353394.20do.20.60move_outs.60.20computation.20lazilly.html#132203573">(Aug 15 2018 at 22:27)</a>:</h4>
<p>the heart of the search though is this:</p>
<div class="codehilite"><pre><span></span><span class="w">    </span><span class="k">fn</span> <span class="nf">compute_use_live_points_for</span><span class="p">(</span><span class="o">&amp;</span><span class="k">mut</span><span class="w"> </span><span class="bp">self</span><span class="p">,</span><span class="w"> </span><span class="n">live_local</span>: <span class="nc">LocalWithRegion</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">        </span><span class="bp">self</span><span class="p">.</span><span class="n">stack</span><span class="p">.</span><span class="n">extend</span><span class="p">(</span><span class="bp">self</span><span class="p">.</span><span class="n">cx</span><span class="p">.</span><span class="n">local_use_map</span><span class="p">.</span><span class="n">uses</span><span class="p">(</span><span class="n">live_local</span><span class="p">));</span><span class="w"></span>
<span class="w">        </span><span class="k">while</span><span class="w"> </span><span class="kd">let</span><span class="w"> </span><span class="nb">Some</span><span class="p">(</span><span class="n">p</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="bp">self</span><span class="p">.</span><span class="n">stack</span><span class="p">.</span><span class="n">pop</span><span class="p">()</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">            </span><span class="k">if</span><span class="w"> </span><span class="bp">self</span><span class="p">.</span><span class="n">defs</span><span class="p">.</span><span class="n">contains</span><span class="p">(</span><span class="n">p</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">                </span><span class="k">continue</span><span class="p">;</span><span class="w"></span>
<span class="w">            </span><span class="p">}</span><span class="w"></span>
<span class="w">            </span><span class="k">if</span><span class="w"> </span><span class="bp">self</span><span class="p">.</span><span class="n">use_live_at</span><span class="p">.</span><span class="n">insert</span><span class="p">(</span><span class="n">p</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">                </span><span class="bp">self</span><span class="p">.</span><span class="n">cx</span><span class="w"></span>
<span class="w">                    </span><span class="p">.</span><span class="n">point_index_map</span><span class="w"></span>
<span class="w">                    </span><span class="p">.</span><span class="n">push_predecessors</span><span class="p">(</span><span class="n">p</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="k">mut</span><span class="w"> </span><span class="bp">self</span><span class="p">.</span><span class="n">stack</span><span class="p">)</span><span class="w"></span>
<span class="w">            </span><span class="p">}</span><span class="w"></span>
<span class="w">        </span><span class="p">}</span><span class="w"></span>
<span class="w">    </span><span class="p">}</span><span class="w"></span>
</pre></div>



<a name="132203640"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353394%20do%20%60move_outs%60%20computation%20lazilly/near/132203640" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353394.20do.20.60move_outs.60.20computation.20lazilly.html#132203640">(Aug 15 2018 at 22:28)</a>:</h4>
<p>from <a href="https://github.com/rust-lang/rust/pull/53314/files#diff-cce6962a21c56d1c1801dd6ebb69fe84R196" target="_blank" title="https://github.com/rust-lang/rust/pull/53314/files#diff-cce6962a21c56d1c1801dd6ebb69fe84R196">here</a></p>



<a name="132203642"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353394%20do%20%60move_outs%60%20computation%20lazilly/near/132203642" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353394.20do.20.60move_outs.60.20computation.20lazilly.html#132203642">(Aug 15 2018 at 22:28)</a>:</h4>
<p>but I think to rewrite in terms of locations it would look something like</p>



<a name="132203705"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353394%20do%20%60move_outs%60%20computation%20lazilly/near/132203705" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353394.20do.20.60move_outs.60.20computation.20lazilly.html#132203705">(Aug 15 2018 at 22:29)</a>:</h4>
<div class="codehilite"><pre><span></span><span class="kd">let</span><span class="w"> </span><span class="k">mut</span><span class="w"> </span><span class="n">stack</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">vec</span><span class="o">!</span><span class="p">[</span><span class="n">initial_location</span><span class="p">];</span><span class="w"></span>

<span class="k">while</span><span class="w"> </span><span class="kd">let</span><span class="w"> </span><span class="nb">Some</span><span class="p">(</span><span class="n">l</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">stack</span><span class="p">.</span><span class="n">pop</span><span class="p">()</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">  </span><span class="k">if</span><span class="w"> </span><span class="n">already_visited</span><span class="p">(</span><span class="n">l</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="k">continue</span><span class="p">;</span><span class="w"> </span><span class="p">}</span><span class="w"></span>
<span class="w">  </span><span class="k">if</span><span class="w"> </span><span class="n">l</span><span class="p">.</span><span class="n">statement_index</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="c1">// start of basic block</span>
<span class="w">    </span><span class="k">for</span><span class="w"> </span><span class="n">predecessor_block</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="n">mir</span><span class="p">.</span><span class="n">predecessors_for</span><span class="p">(</span><span class="n">l</span><span class="p">.</span><span class="n">block</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">       </span><span class="kd">let</span><span class="w"> </span><span class="n">predecessor_end_location</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">mir</span><span class="p">.</span><span class="n">terminator_loc</span><span class="p">(</span><span class="n">predecessor_block</span><span class="p">);</span><span class="w"></span>
<span class="w">        </span><span class="n">stack</span><span class="p">.</span><span class="n">push</span><span class="p">(</span><span class="n">predecessor_end_location</span><span class="p">);</span><span class="w"></span>
<span class="w">    </span><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">        </span><span class="n">stack</span><span class="p">.</span><span class="n">push</span><span class="p">(</span><span class="n">Location</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">block</span>: <span class="nc">l</span><span class="p">.</span><span class="n">block</span><span class="p">,</span><span class="w"> </span><span class="n">statement_index</span>: <span class="nc">l</span><span class="p">.</span><span class="n">statement_index</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="p">});</span><span class="w"></span>
<span class="w">    </span><span class="p">}</span><span class="w"></span>
<span class="w">  </span><span class="p">}</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>
</pre></div>



<a name="132203782"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353394%20do%20%60move_outs%60%20computation%20lazilly/near/132203782" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353394.20do.20.60move_outs.60.20computation.20lazilly.html#132203782">(Aug 15 2018 at 22:30)</a>:</h4>
<p>where <code>terminator_loc</code> is the helper <a href="https://github.com/rust-lang/rust/pull/53314/files#diff-f0577ac900ffbd36d3bb3421a928cbbdR333" target="_blank" title="https://github.com/rust-lang/rust/pull/53314/files#diff-f0577ac900ffbd36d3bb3421a928cbbdR333">I added here</a> and which you probably want to just add in your PR as well:</p>
<div class="codehilite"><pre><span></span><span class="k">pub</span><span class="w"> </span><span class="k">fn</span> <span class="nf">terminator_loc</span><span class="p">(</span><span class="o">&amp;</span><span class="bp">self</span><span class="p">,</span><span class="w"> </span><span class="n">bb</span>: <span class="nc">BasicBlock</span><span class="p">)</span><span class="w"> </span>-&gt; <span class="nc">Location</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">        </span><span class="n">Location</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">            </span><span class="n">block</span>: <span class="nc">bb</span><span class="p">,</span><span class="w"></span>
<span class="w">            </span><span class="n">statement_index</span>: <span class="nc">self</span><span class="p">[</span><span class="n">bb</span><span class="p">].</span><span class="n">statements</span><span class="p">.</span><span class="n">len</span><span class="p">(),</span><span class="w"></span>
<span class="w">        </span><span class="p">}</span><span class="w"></span>
<span class="w">    </span><span class="p">}</span><span class="w"></span>
</pre></div>



<a name="132203783"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353394%20do%20%60move_outs%60%20computation%20lazilly/near/132203783" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353394.20do.20.60move_outs.60.20computation.20lazilly.html#132203783">(Aug 15 2018 at 22:30)</a>:</h4>
<p>does that make any sense?</p>



<a name="132203906"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353394%20do%20%60move_outs%60%20computation%20lazilly/near/132203906" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353394.20do.20.60move_outs.60.20computation.20lazilly.html#132203906">(Aug 15 2018 at 22:32)</a>:</h4>
<p>yeap</p>



<a name="132203907"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353394%20do%20%60move_outs%60%20computation%20lazilly/near/132203907" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353394.20do.20.60move_outs.60.20computation.20lazilly.html#132203907">(Aug 15 2018 at 22:32)</a>:</h4>
<p>makes sense</p>



<a name="132203937"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353394%20do%20%60move_outs%60%20computation%20lazilly/near/132203937" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353394.20do.20.60move_outs.60.20computation.20lazilly.html#132203937">(Aug 15 2018 at 22:33)</a>:</h4>
<p><span class="user-mention" data-user-id="116009">@nikomatsakis</span> I was wondering about some types, in particular <code>MoveData</code></p>



<a name="132203942"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353394%20do%20%60move_outs%60%20computation%20lazilly/near/132203942" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353394.20do.20.60move_outs.60.20computation.20lazilly.html#132203942">(Aug 15 2018 at 22:33)</a>:</h4>
<p>for instance, what does this <a href="https://github.com/rust-lang/rust/blob/0f4b4987cd6dea5406dec0634770839fb31ce72c/src/librustc_mir/dataflow/move_paths/mod.rs#L131" target="_blank" title="https://github.com/rust-lang/rust/blob/0f4b4987cd6dea5406dec0634770839fb31ce72c/src/librustc_mir/dataflow/move_paths/mod.rs#L131">https://github.com/rust-lang/rust/blob/0f4b4987cd6dea5406dec0634770839fb31ce72c/src/librustc_mir/dataflow/move_paths/mod.rs#L131</a> represents?</p>



<a name="132203944"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353394%20do%20%60move_outs%60%20computation%20lazilly/near/132203944" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353394.20do.20.60move_outs.60.20computation.20lazilly.html#132203944">(Aug 15 2018 at 22:33)</a>:</h4>
<p>mpi is the actual location where the move happened?</p>



<a name="132203946"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353394%20do%20%60move_outs%60%20computation%20lazilly/near/132203946" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353394.20do.20.60move_outs.60.20computation.20lazilly.html#132203946">(Aug 15 2018 at 22:33)</a>:</h4>
<p>or what?</p>



<a name="132203994"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353394%20do%20%60move_outs%60%20computation%20lazilly/near/132203994" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353394.20do.20.60move_outs.60.20computation.20lazilly.html#132203994">(Aug 15 2018 at 22:34)</a>:</h4>
<p>well the actual location I guess it's content.loc</p>



<a name="132204004"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353394%20do%20%60move_outs%60%20computation%20lazilly/near/132204004" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353394.20do.20.60move_outs.60.20computation.20lazilly.html#132204004">(Aug 15 2018 at 22:34)</a>:</h4>
<p>I'm not sure what mpi is and what is that mapping</p>



<a name="132204009"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353394%20do%20%60move_outs%60%20computation%20lazilly/near/132204009" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353394.20do.20.60move_outs.60.20computation.20lazilly.html#132204009">(Aug 15 2018 at 22:34)</a>:</h4>
<p>so</p>



<a name="132204012"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353394%20do%20%60move_outs%60%20computation%20lazilly/near/132204012" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353394.20do.20.60move_outs.60.20computation.20lazilly.html#132204012">(Aug 15 2018 at 22:35)</a>:</h4>
<p>a <code>MovePathIndex</code> is the index of a particular place</p>



<a name="132204021"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353394%20do%20%60move_outs%60%20computation%20lazilly/near/132204021" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353394.20do.20.60move_outs.60.20computation.20lazilly.html#132204021">(Aug 15 2018 at 22:35)</a>:</h4>
<p>in particular, we map each place that is moved from (e.g., <code>a.b.c</code>) to an MPI</p>



<a name="132204027"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353394%20do%20%60move_outs%60%20computation%20lazilly/near/132204027" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353394.20do.20.60move_outs.60.20computation.20lazilly.html#132204027">(Aug 15 2018 at 22:35)</a>:</h4>
<p>I believe then that this map you pointed me at</p>



<a name="132204081"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353394%20do%20%60move_outs%60%20computation%20lazilly/near/132204081" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353394.20do.20.60move_outs.60.20computation.20lazilly.html#132204081">(Aug 15 2018 at 22:36)</a>:</h4>
<p>tells us each of the <code>MoveOutIndex</code> values that move a particular MPI</p>



<a name="132204088"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353394%20do%20%60move_outs%60%20computation%20lazilly/near/132204088" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353394.20do.20.60move_outs.60.20computation.20lazilly.html#132204088">(Aug 15 2018 at 22:36)</a>:</h4>
<p>a <code>MoveOutIndex</code> is the unique index given to each move</p>



<a name="132204099"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353394%20do%20%60move_outs%60%20computation%20lazilly/near/132204099" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353394.20do.20.60move_outs.60.20computation.20lazilly.html#132204099">(Aug 15 2018 at 22:36)</a>:</h4>
<p>you can look up more information about a move here:</p>



<a name="132204100"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353394%20do%20%60move_outs%60%20computation%20lazilly/near/132204100" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353394.20do.20.60move_outs.60.20computation.20lazilly.html#132204100">(Aug 15 2018 at 22:36)</a>:</h4>
<p><a href="https://github.com/rust-lang/rust/blob/0f4b4987cd6dea5406dec0634770839fb31ce72c/src/librustc_mir/dataflow/move_paths/mod.rs#L125" target="_blank" title="https://github.com/rust-lang/rust/blob/0f4b4987cd6dea5406dec0634770839fb31ce72c/src/librustc_mir/dataflow/move_paths/mod.rs#L125">https://github.com/rust-lang/rust/blob/0f4b4987cd6dea5406dec0634770839fb31ce72c/src/librustc_mir/dataflow/move_paths/mod.rs#L125</a></p>



<a name="132204105"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353394%20do%20%60move_outs%60%20computation%20lazilly/near/132204105" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353394.20do.20.60move_outs.60.20computation.20lazilly.html#132204105">(Aug 15 2018 at 22:36)</a>:</h4>
<p>see also <a href="https://github.com/rust-lang/rust/blob/0f4b4987cd6dea5406dec0634770839fb31ce72c/src/librustc_mir/dataflow/move_paths/mod.rs#L174-L186" target="_blank" title="https://github.com/rust-lang/rust/blob/0f4b4987cd6dea5406dec0634770839fb31ce72c/src/librustc_mir/dataflow/move_paths/mod.rs#L174-L186">the <code>MoveOut</code> structure</a></p>



<a name="132204109"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353394%20do%20%60move_outs%60%20computation%20lazilly/near/132204109" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353394.20do.20.60move_outs.60.20computation.20lazilly.html#132204109">(Aug 15 2018 at 22:36)</a>:</h4>
<p>make sense <span class="user-mention" data-user-id="116266">@Santiago Pastorino</span> ?</p>



<a name="132204122"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353394%20do%20%60move_outs%60%20computation%20lazilly/near/132204122" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353394.20do.20.60move_outs.60.20computation.20lazilly.html#132204122">(Aug 15 2018 at 22:37)</a>:</h4>
<p>got distracted reading the code :)</p>



<a name="132204125"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353394%20do%20%60move_outs%60%20computation%20lazilly/near/132204125" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353394.20do.20.60move_outs.60.20computation.20lazilly.html#132204125">(Aug 15 2018 at 22:37)</a>:</h4>
<p>let me read what you've said</p>



<a name="132204188"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353394%20do%20%60move_outs%60%20computation%20lazilly/near/132204188" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353394.20do.20.60move_outs.60.20computation.20lazilly.html#132204188">(Aug 15 2018 at 22:38)</a>:</h4>
<p>ahh I see</p>



<a name="132204203"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353394%20do%20%60move_outs%60%20computation%20lazilly/near/132204203" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353394.20do.20.60move_outs.60.20computation.20lazilly.html#132204203">(Aug 15 2018 at 22:39)</a>:</h4>
<p>let me see if I got it right</p>



<a name="132204216"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353394%20do%20%60move_outs%60%20computation%20lazilly/near/132204216" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353394.20do.20.60move_outs.60.20computation.20lazilly.html#132204216">(Aug 15 2018 at 22:39)</a>:</h4>
<p>so when you have a.b.c</p>



<a name="132204295"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353394%20do%20%60move_outs%60%20computation%20lazilly/near/132204295" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353394.20do.20.60move_outs.60.20computation.20lazilly.html#132204295">(Aug 15 2018 at 22:40)</a>:</h4>
<p>you have a map from and index of that path the mpi, which I guess it containts the location where that shows up? to the places a, a.b and a.b.c ?</p>



<a name="132204298"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353394%20do%20%60move_outs%60%20computation%20lazilly/near/132204298" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353394.20do.20.60move_outs.60.20computation.20lazilly.html#132204298">(Aug 15 2018 at 22:40)</a>:</h4>
<p>is more or less that what you meant?</p>



<a name="132204407"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353394%20do%20%60move_outs%60%20computation%20lazilly/near/132204407" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353394.20do.20.60move_outs.60.20computation.20lazilly.html#132204407">(Aug 15 2018 at 22:43)</a>:</h4>
<p>so yes there is an MPI for <code>a.b.c.</code>, but also for <code>a.b</code> and <code>a</code></p>



<a name="132204408"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353394%20do%20%60move_outs%60%20computation%20lazilly/near/132204408" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353394.20do.20.60move_outs.60.20computation.20lazilly.html#132204408">(Aug 15 2018 at 22:43)</a>:</h4>
<p>and they are linked</p>



<a name="132204450"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353394%20do%20%60move_outs%60%20computation%20lazilly/near/132204450" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353394.20do.20.60move_outs.60.20computation.20lazilly.html#132204450">(Aug 15 2018 at 22:44)</a>:</h4>
<p>i.e., I can go to the "parents" of the MPI for <code>a.b.c</code> and it will give me <code>a.b</code> and <code>a</code></p>



<a name="132204453"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353394%20do%20%60move_outs%60%20computation%20lazilly/near/132204453" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353394.20do.20.60move_outs.60.20computation.20lazilly.html#132204453">(Aug 15 2018 at 22:44)</a>:</h4>
<p>the MPI itself just maps to a place</p>



<a name="132204465"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353394%20do%20%60move_outs%60%20computation%20lazilly/near/132204465" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353394.20do.20.60move_outs.60.20computation.20lazilly.html#132204465">(Aug 15 2018 at 22:44)</a>:</h4>
<p>ok</p>



<a name="132204467"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353394%20do%20%60move_outs%60%20computation%20lazilly/near/132204467" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353394.20do.20.60move_outs.60.20computation.20lazilly.html#132204467">(Aug 15 2018 at 22:44)</a>:</h4>
<p>then the <code>MoveOut</code> structure indicates a particular move of some place at some location</p>



<a name="132204473"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353394%20do%20%60move_outs%60%20computation%20lazilly/near/132204473" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353394.20do.20.60move_outs.60.20computation.20lazilly.html#132204473">(Aug 15 2018 at 22:44)</a>:</h4>
<p>and so we have a map from the MPI To the move-outs that involve that MPI</p>



<a name="132204478"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353394%20do%20%60move_outs%60%20computation%20lazilly/near/132204478" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353394.20do.20.60move_outs.60.20computation.20lazilly.html#132204478">(Aug 15 2018 at 22:44)</a>:</h4>
<p>so that gives you -- basically -- all the places that an MPI is moved</p>



<a name="132204495"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353394%20do%20%60move_outs%60%20computation%20lazilly/near/132204495" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353394.20do.20.60move_outs.60.20computation.20lazilly.html#132204495">(Aug 15 2018 at 22:45)</a>:</h4>
<p><span class="emoji emoji-1f44d" title="+1">:+1:</span></p>



<a name="132205191"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353394%20do%20%60move_outs%60%20computation%20lazilly/near/132205191" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353394.20do.20.60move_outs.60.20computation.20lazilly.html#132205191">(Aug 15 2018 at 23:00)</a>:</h4>
<p>so in that search if I need to search for an assign to that place</p>



<a name="132205208"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353394%20do%20%60move_outs%60%20computation%20lazilly/near/132205208" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353394.20do.20.60move_outs.60.20computation.20lazilly.html#132205208">(Aug 15 2018 at 23:01)</a>:</h4>
<p><span class="user-mention" data-user-id="116009">@nikomatsakis</span> I remember you showed me some code this morning about this</p>



<a name="132205212"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353394%20do%20%60move_outs%60%20computation%20lazilly/near/132205212" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353394.20do.20.60move_outs.60.20computation.20lazilly.html#132205212">(Aug 15 2018 at 23:01)</a>:</h4>
<p>I need to search for the kills</p>



<a name="132205262"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353394%20do%20%60move_outs%60%20computation%20lazilly/near/132205262" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353394.20do.20.60move_outs.60.20computation.20lazilly.html#132205262">(Aug 15 2018 at 23:02)</a>:</h4>
<p>mmm</p>



<a name="132205264"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353394%20do%20%60move_outs%60%20computation%20lazilly/near/132205264" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353394.20do.20.60move_outs.60.20computation.20lazilly.html#132205264">(Aug 15 2018 at 23:02)</a>:</h4>
<p>why do you want to search for that? :)</p>



<a name="132205276"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353394%20do%20%60move_outs%60%20computation%20lazilly/near/132205276" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353394.20do.20.60move_outs.60.20computation.20lazilly.html#132205276">(Aug 15 2018 at 23:02)</a>:</h4>
<p>don't we need to explain why the thing was moved?</p>



<a name="132205279"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353394%20do%20%60move_outs%60%20computation%20lazilly/near/132205279" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353394.20do.20.60move_outs.60.20computation.20lazilly.html#132205279">(Aug 15 2018 at 23:02)</a>:</h4>
<p>I think you want to check for the <em>moves</em> that occur at a particular location, right?</p>



<a name="132205286"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353394%20do%20%60move_outs%60%20computation%20lazilly/near/132205286" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353394.20do.20.60move_outs.60.20computation.20lazilly.html#132205286">(Aug 15 2018 at 23:03)</a>:</h4>
<p>(vs assignments)</p>



<a name="132205299"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353394%20do%20%60move_outs%60%20computation%20lazilly/near/132205299" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353394.20do.20.60move_outs.60.20computation.20lazilly.html#132205299">(Aug 15 2018 at 23:03)</a>:</h4>
<p>and I think that <a href="https://github.com/rust-lang/rust/blob/0f4b4987cd6dea5406dec0634770839fb31ce72c/src/librustc_mir/dataflow/move_paths/mod.rs#L130" target="_blank" title="https://github.com/rust-lang/rust/blob/0f4b4987cd6dea5406dec0634770839fb31ce72c/src/librustc_mir/dataflow/move_paths/mod.rs#L130">this field</a> is what you want</p>



<a name="132205353"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353394%20do%20%60move_outs%60%20computation%20lazilly/near/132205353" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353394.20do.20.60move_outs.60.20computation.20lazilly.html#132205353">(Aug 15 2018 at 23:04)</a>:</h4>
<p>yeah, I'm probably not understanding something correctly</p>



<a name="132205359"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353394%20do%20%60move_outs%60%20computation%20lazilly/near/132205359" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353394.20do.20.60move_outs.60.20computation.20lazilly.html#132205359">(Aug 15 2018 at 23:04)</a>:</h4>
<p>so</p>



<a name="132205365"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353394%20do%20%60move_outs%60%20computation%20lazilly/near/132205365" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353394.20do.20.60move_outs.60.20computation.20lazilly.html#132205365">(Aug 15 2018 at 23:04)</a>:</h4>
<div class="codehilite"><pre><span></span><span class="w">    </span><span class="k">pub</span><span class="p">(</span><span class="k">super</span><span class="p">)</span><span class="w"> </span><span class="k">fn</span> <span class="nf">report_use_of_moved_or_uninitialized</span><span class="p">(</span><span class="w"></span>
<span class="w">        </span><span class="o">&amp;</span><span class="k">mut</span><span class="w"> </span><span class="bp">self</span><span class="p">,</span><span class="w"></span>
<span class="w">        </span><span class="n">context</span>: <span class="nc">Context</span><span class="p">,</span><span class="w"></span>
<span class="w">        </span><span class="n">desired_action</span>: <span class="nc">InitializationRequiringAction</span><span class="p">,</span><span class="w"></span>
<span class="w">        </span><span class="p">(</span><span class="n">place</span><span class="p">,</span><span class="w"> </span><span class="n">span</span><span class="p">)</span>: <span class="p">(</span><span class="o">&amp;</span><span class="n">Place</span><span class="o">&lt;</span><span class="na">&#39;tcx</span><span class="o">&gt;</span><span class="p">,</span><span class="w"> </span><span class="n">Span</span><span class="p">),</span><span class="w"></span>
<span class="w">        </span><span class="n">mpi</span>: <span class="nc">MovePathIndex</span><span class="p">,</span><span class="w"></span>
</pre></div>



<a name="132205383"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353394%20do%20%60move_outs%60%20computation%20lazilly/near/132205383" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353394.20do.20.60move_outs.60.20computation.20lazilly.html#132205383">(Aug 15 2018 at 23:05)</a>:</h4>
<p>I was guessing that mpi it's the index for the place that's being used after a move</p>



<a name="132205388"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353394%20do%20%60move_outs%60%20computation%20lazilly/near/132205388" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353394.20do.20.60move_outs.60.20computation.20lazilly.html#132205388">(Aug 15 2018 at 23:05)</a>:</h4>
<p>and given that we don't have the information why that thing was moved</p>



<a name="132205393"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353394%20do%20%60move_outs%60%20computation%20lazilly/near/132205393" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353394.20do.20.60move_outs.60.20computation.20lazilly.html#132205393">(Aug 15 2018 at 23:05)</a>:</h4>
<p>we were going to search for that</p>



<a name="132205486"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353394%20do%20%60move_outs%60%20computation%20lazilly/near/132205486" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353394.20do.20.60move_outs.60.20computation.20lazilly.html#132205486">(Aug 15 2018 at 23:07)</a>:</h4>
<p>so I guess you're saying that we do that search looking for the moves that are happening and see if one of those moves is the one I'm about to report?</p>



<a name="132205488"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353394%20do%20%60move_outs%60%20computation%20lazilly/near/132205488" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353394.20do.20.60move_outs.60.20computation.20lazilly.html#132205488">(Aug 15 2018 at 23:07)</a>:</h4>
<p>is that what you meant?</p>



<a name="132205661"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353394%20do%20%60move_outs%60%20computation%20lazilly/near/132205661" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353394.20do.20.60move_outs.60.20computation.20lazilly.html#132205661">(Aug 15 2018 at 23:10)</a>:</h4>
<p>that sounds right</p>



<a name="132205665"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353394%20do%20%60move_outs%60%20computation%20lazilly/near/132205665" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353394.20do.20.60move_outs.60.20computation.20lazilly.html#132205665">(Aug 15 2018 at 23:10)</a>:</h4>
<p>I think we want to search backwards from <code>context.loc</code></p>



<a name="132205671"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353394%20do%20%60move_outs%60%20computation%20lazilly/near/132205671" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353394.20do.20.60move_outs.60.20computation.20lazilly.html#132205671">(Aug 15 2018 at 23:11)</a>:</h4>
<p>yes</p>



<a name="132205678"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353394%20do%20%60move_outs%60%20computation%20lazilly/near/132205678" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353394.20do.20.60move_outs.60.20computation.20lazilly.html#132205678">(Aug 15 2018 at 23:11)</a>:</h4>
<p>at each place, we can iterate over the moves that occur there</p>



<a name="132205681"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353394%20do%20%60move_outs%60%20computation%20lazilly/near/132205681" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353394.20do.20.60move_outs.60.20computation.20lazilly.html#132205681">(Aug 15 2018 at 23:11)</a>:</h4>
<p>and check which paths they affect</p>



<a name="132205687"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353394%20do%20%60move_outs%60%20computation%20lazilly/near/132205687" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353394.20do.20.60move_outs.60.20computation.20lazilly.html#132205687">(Aug 15 2018 at 23:11)</a>:</h4>
<p>in particular look for a <code>MoveOut</code> that moves <code>mpi</code></p>



<a name="132205692"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353394%20do%20%60move_outs%60%20computation%20lazilly/near/132205692" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353394.20do.20.60move_outs.60.20computation.20lazilly.html#132205692">(Aug 15 2018 at 23:11)</a>:</h4>
<p>when we find that, we can stop the search</p>



<a name="132205696"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353394%20do%20%60move_outs%60%20computation%20lazilly/near/132205696" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353394.20do.20.60move_outs.60.20computation.20lazilly.html#132205696">(Aug 15 2018 at 23:11)</a>:</h4>
<p>so for the sake of understanding a bit better, why does this <code>don't we need to explain why the thing was moved?</code> would be wrong?</p>



<a name="132205701"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353394%20do%20%60move_outs%60%20computation%20lazilly/near/132205701" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353394.20do.20.60move_outs.60.20computation.20lazilly.html#132205701">(Aug 15 2018 at 23:11)</a>:</h4>
<p>maybe I'm not sure what you mean by that</p>



<a name="132205703"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353394%20do%20%60move_outs%60%20computation%20lazilly/near/132205703" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353394.20do.20.60move_outs.60.20computation.20lazilly.html#132205703">(Aug 15 2018 at 23:11)</a>:</h4>
<p>it seems like finding the moves</p>



<a name="132205741"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353394%20do%20%60move_outs%60%20computation%20lazilly/near/132205741" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353394.20do.20.60move_outs.60.20computation.20lazilly.html#132205741">(Aug 15 2018 at 23:12)</a>:</h4>
<p><em>is</em> explaining the thing that was moved</p>



<a name="132205748"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353394%20do%20%60move_outs%60%20computation%20lazilly/near/132205748" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353394.20do.20.60move_outs.60.20computation.20lazilly.html#132205748">(Aug 15 2018 at 23:12)</a>:</h4>
<p>that is, we want to find the moves, so we can show them</p>



<a name="132205753"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353394%20do%20%60move_outs%60%20computation%20lazilly/near/132205753" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353394.20do.20.60move_outs.60.20computation.20lazilly.html#132205753">(Aug 15 2018 at 23:12)</a>:</h4>
<p>ahh the thing is the moves where already calculated, right?</p>



<a name="132205754"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353394%20do%20%60move_outs%60%20computation%20lazilly/near/132205754" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353394.20do.20.60move_outs.60.20computation.20lazilly.html#132205754">(Aug 15 2018 at 23:12)</a>:</h4>
<p>it occurs to me that we will also need to search each place for the initializations, which is maybe what you meant initially</p>



<a name="132205761"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353394%20do%20%60move_outs%60%20computation%20lazilly/near/132205761" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353394.20do.20.60move_outs.60.20computation.20lazilly.html#132205761">(Aug 15 2018 at 23:12)</a>:</h4>
<p>ah, right, yes. the <code>MoveData</code> already has indexed the moves that occur at any given location</p>



<a name="132205763"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353394%20do%20%60move_outs%60%20computation%20lazilly/near/132205763" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353394.20do.20.60move_outs.60.20computation.20lazilly.html#132205763">(Aug 15 2018 at 23:12)</a>:</h4>
<p>so we are just searching backwards through that index</p>



<a name="132205764"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353394%20do%20%60move_outs%60%20computation%20lazilly/near/132205764" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353394.20do.20.60move_outs.60.20computation.20lazilly.html#132205764">(Aug 15 2018 at 23:12)</a>:</h4>
<p>what I've said "calculates" that again</p>



<a name="132205765"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353394%20do%20%60move_outs%60%20computation%20lazilly/near/132205765" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353394.20do.20.60move_outs.60.20computation.20lazilly.html#132205765">(Aug 15 2018 at 23:12)</a>:</h4>
<p>ok</p>



<a name="132205771"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353394%20do%20%60move_outs%60%20computation%20lazilly/near/132205771" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353394.20do.20.60move_outs.60.20computation.20lazilly.html#132205771">(Aug 15 2018 at 23:13)</a>:</h4>
<p>makes a lot of sense</p>



<a name="132205778"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353394%20do%20%60move_outs%60%20computation%20lazilly/near/132205778" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353394.20do.20.60move_outs.60.20computation.20lazilly.html#132205778">(Aug 15 2018 at 23:13)</a>:</h4>
<p>but we also need to look for initialization, because of examples like this:</p>
<div class="codehilite"><pre><span></span><span class="kd">let</span><span class="w"> </span><span class="k">mut</span><span class="w"> </span><span class="n">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">vec</span><span class="o">!</span><span class="p">[];</span><span class="w"></span>
<span class="n">drop</span><span class="p">(</span><span class="n">x</span><span class="p">);</span><span class="w"></span>
<span class="n">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">vec</span><span class="o">!</span><span class="p">[];</span><span class="w"></span>
<span class="k">if</span><span class="w"> </span><span class="kc">true</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">drop</span><span class="p">(</span><span class="n">x</span><span class="p">);</span><span class="w"> </span><span class="p">}</span><span class="w"></span>
<span class="n">println</span><span class="o">!</span><span class="p">(</span><span class="s">&quot;{:?}&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">x</span><span class="p">);</span><span class="w"> </span><span class="c1">// &lt;-- error here</span>
</pre></div>



<a name="132205779"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353394%20do%20%60move_outs%60%20computation%20lazilly/near/132205779" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353394.20do.20.60move_outs.60.20computation.20lazilly.html#132205779">(Aug 15 2018 at 23:13)</a>:</h4>
<p>in particular, we would walk backwards and find the second <code>drop(x)</code></p>



<a name="132205780"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353394%20do%20%60move_outs%60%20computation%20lazilly/near/132205780" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353394.20do.20.60move_outs.60.20computation.20lazilly.html#132205780">(Aug 15 2018 at 23:13)</a>:</h4>
<p>and when we encoutner the <code>x = vec![]</code> we want to stop the search there too</p>



<a name="132205781"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353394%20do%20%60move_outs%60%20computation%20lazilly/near/132205781" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353394.20do.20.60move_outs.60.20computation.20lazilly.html#132205781">(Aug 15 2018 at 23:13)</a>:</h4>
<p>that's more or less what I mean when I ask you about data structures and the information that you have around, it's easy to see what to do, but harder to see what stuff you have around and all that :)</p>



<a name="132205783"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353394%20do%20%60move_outs%60%20computation%20lazilly/near/132205783" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353394.20do.20.60move_outs.60.20computation.20lazilly.html#132205783">(Aug 15 2018 at 23:13)</a>:</h4>
<p>and not keep going (else we wil also find the <em>first</em> <code>x = vec![]</code>)</p>



<a name="132205830"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353394%20do%20%60move_outs%60%20computation%20lazilly/near/132205830" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353394.20do.20.60move_outs.60.20computation.20lazilly.html#132205830">(Aug 15 2018 at 23:14)</a>:</h4>
<p>the code was going ...</p>



<a name="132205833"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353394%20do%20%60move_outs%60%20computation%20lazilly/near/132205833" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353394.20do.20.60move_outs.60.20computation.20lazilly.html#132205833">(Aug 15 2018 at 23:14)</a>:</h4>
<div class="codehilite"><pre><span></span><span class="w"> </span><span class="kd">let</span><span class="w"> </span><span class="n">mois</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="bp">self</span><span class="p">.</span><span class="n">move_data</span><span class="p">.</span><span class="n">path_map</span><span class="p">[</span><span class="n">mpi</span><span class="p">]</span><span class="w"></span>
<span class="w">            </span><span class="p">.</span><span class="n">iter</span><span class="p">()</span><span class="w"></span>
<span class="w">            </span><span class="p">.</span><span class="n">filter</span><span class="p">(</span><span class="o">|</span><span class="n">moi</span><span class="o">|</span><span class="w"> </span><span class="n">curr_move_out</span><span class="p">.</span><span class="n">contains</span><span class="p">(</span><span class="n">moi</span><span class="p">)))</span><span class="w"></span>
<span class="w">            </span><span class="p">.</span><span class="n">collect</span>::<span class="o">&lt;</span><span class="nb">Vec</span><span class="o">&lt;</span><span class="n">_</span><span class="o">&gt;&gt;</span><span class="p">();</span><span class="w"></span>
</pre></div>



<a name="132205836"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353394%20do%20%60move_outs%60%20computation%20lazilly/near/132205836" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353394.20do.20.60move_outs.60.20computation.20lazilly.html#132205836">(Aug 15 2018 at 23:14)</a>:</h4>
<p>I guess I should keep returning mois</p>



<a name="132205838"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353394%20do%20%60move_outs%60%20computation%20lazilly/near/132205838" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353394.20do.20.60move_outs.60.20computation.20lazilly.html#132205838">(Aug 15 2018 at 23:14)</a>:</h4>
<p>?</p>



<a name="132205848"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353394%20do%20%60move_outs%60%20computation%20lazilly/near/132205848" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353394.20do.20.60move_outs.60.20computation.20lazilly.html#132205848">(Aug 15 2018 at 23:15)</a>:</h4>
<p>yes probably</p>



<a name="132205849"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353394%20do%20%60move_outs%60%20computation%20lazilly/near/132205849" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353394.20do.20.60move_outs.60.20computation.20lazilly.html#132205849">(Aug 15 2018 at 23:15)</a>:</h4>
<p>which I don't remember what I was :P</p>



<a name="132205850"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353394%20do%20%60move_outs%60%20computation%20lazilly/near/132205850" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353394.20do.20.60move_outs.60.20computation.20lazilly.html#132205850">(Aug 15 2018 at 23:15)</a>:</h4>
<p>that'd be easy enough to do anyway</p>



<a name="132205851"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353394%20do%20%60move_outs%60%20computation%20lazilly/near/132205851" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353394.20do.20.60move_outs.60.20computation.20lazilly.html#132205851">(Aug 15 2018 at 23:15)</a>:</h4>
<p>ok</p>



<a name="132205852"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353394%20do%20%60move_outs%60%20computation%20lazilly/near/132205852" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353394.20do.20.60move_outs.60.20computation.20lazilly.html#132205852">(Aug 15 2018 at 23:15)</a>:</h4>
<p>that is just a unique index</p>



<a name="132205853"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353394%20do%20%60move_outs%60%20computation%20lazilly/near/132205853" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353394.20do.20.60move_outs.60.20computation.20lazilly.html#132205853">(Aug 15 2018 at 23:15)</a>:</h4>
<p>assigned to each <code>MoveOut</code></p>



<a name="132205854"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353394%20do%20%60move_outs%60%20computation%20lazilly/near/132205854" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353394.20do.20.60move_outs.60.20computation.20lazilly.html#132205854">(Aug 15 2018 at 23:15)</a>:</h4>
<p>ok</p>



<a name="132205856"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353394%20do%20%60move_outs%60%20computation%20lazilly/near/132205856" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353394.20do.20.60move_outs.60.20computation.20lazilly.html#132205856">(Aug 15 2018 at 23:15)</a>:</h4>
<p>(which are collected into a vector)</p>



<a name="132205858"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353394%20do%20%60move_outs%60%20computation%20lazilly/near/132205858" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353394.20do.20.60move_outs.60.20computation.20lazilly.html#132205858">(Aug 15 2018 at 23:15)</a>:</h4>
<p>so last thing I'm not sure about</p>



<a name="132205906"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353394%20do%20%60move_outs%60%20computation%20lazilly/near/132205906" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353394.20do.20.60move_outs.60.20computation.20lazilly.html#132205906">(Aug 15 2018 at 23:16)</a>:</h4>
<p>you said <code>and when we encoutner the x = vec![] we want to stop the search there too</code></p>



<a name="132205911"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353394%20do%20%60move_outs%60%20computation%20lazilly/near/132205911" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353394.20do.20.60move_outs.60.20computation.20lazilly.html#132205911">(Aug 15 2018 at 23:16)</a>:</h4>
<p>well we stop when the thing was first initialized I guess</p>



<a name="132205919"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353394%20do%20%60move_outs%60%20computation%20lazilly/near/132205919" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353394.20do.20.60move_outs.60.20computation.20lazilly.html#132205919">(Aug 15 2018 at 23:16)</a>:</h4>
<p>but if it was moved we keep searching ?</p>



<a name="132205924"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353394%20do%20%60move_outs%60%20computation%20lazilly/near/132205924" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353394.20do.20.60move_outs.60.20computation.20lazilly.html#132205924">(Aug 15 2018 at 23:16)</a>:</h4>
<p>don't remember what's actually being reported but if it's moved in more than one place I guess we want all of them</p>



<a name="132205929"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353394%20do%20%60move_outs%60%20computation%20lazilly/near/132205929" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353394.20do.20.60move_outs.60.20computation.20lazilly.html#132205929">(Aug 15 2018 at 23:17)</a>:</h4>
<p>and that's I guess why is mois and not moi</p>



<a name="132205938"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353394%20do%20%60move_outs%60%20computation%20lazilly/near/132205938" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353394.20do.20.60move_outs.60.20computation.20lazilly.html#132205938">(Aug 15 2018 at 23:17)</a>:</h4>
<blockquote>
<p>but if it was moved we keep searching ?</p>
</blockquote>
<p>no, I think we stop when we encounter a move</p>



<a name="132205940"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353394%20do%20%60move_outs%60%20computation%20lazilly/near/132205940" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353394.20do.20.60move_outs.60.20computation.20lazilly.html#132205940">(Aug 15 2018 at 23:17)</a>:</h4>
<blockquote>
<p>and that's I guess why is mois and not moi</p>
</blockquote>
<p>yes</p>



<a name="132205942"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353394%20do%20%60move_outs%60%20computation%20lazilly/near/132205942" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353394.20do.20.60move_outs.60.20computation.20lazilly.html#132205942">(Aug 15 2018 at 23:17)</a>:</h4>
<p>the <code>MoveData</code> should <em>also</em> track which was initialized at each spot</p>



<a name="132205944"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353394%20do%20%60move_outs%60%20computation%20lazilly/near/132205944" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353394.20do.20.60move_outs.60.20computation.20lazilly.html#132205944">(Aug 15 2018 at 23:17)</a>:</h4>
<p>in terms of the dataflow...</p>



<a name="132205945"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353394%20do%20%60move_outs%60%20computation%20lazilly/near/132205945" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353394.20do.20.60move_outs.60.20computation.20lazilly.html#132205945">(Aug 15 2018 at 23:17)</a>:</h4>
<p>the moves are a <em>gen</em> (and we can stop there, because if there was a preceding move, it'd be an error to move twice)</p>



<a name="132205975"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353394%20do%20%60move_outs%60%20computation%20lazilly/near/132205975" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353394.20do.20.60move_outs.60.20computation.20lazilly.html#132205975">(Aug 15 2018 at 23:18)</a>:</h4>
<p>and the initializations are a <em>kill</em></p>



<a name="132205990"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353394%20do%20%60move_outs%60%20computation%20lazilly/near/132205990" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353394.20do.20.60move_outs.60.20computation.20lazilly.html#132205990">(Aug 15 2018 at 23:18)</a>:</h4>
<p>(and we can stop there, because if there was a preceding move, it would have been killed)</p>



<a name="132205996"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353394%20do%20%60move_outs%60%20computation%20lazilly/near/132205996" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353394.20do.20.60move_outs.60.20computation.20lazilly.html#132205996">(Aug 15 2018 at 23:18)</a>:</h4>
<p>so actually looking at the impl and seeing how it defines gen and kill</p>



<a name="132206003"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353394%20do%20%60move_outs%60%20computation%20lazilly/near/132206003" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353394.20do.20.60move_outs.60.20computation.20lazilly.html#132206003">(Aug 15 2018 at 23:18)</a>:</h4>
<p>can help you to navigate the data structures</p>



<a name="132206004"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353394%20do%20%60move_outs%60%20computation%20lazilly/near/132206004" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353394.20do.20.60move_outs.60.20computation.20lazilly.html#132206004">(Aug 15 2018 at 23:18)</a>:</h4>
<p>one sec I will give you the link</p>



<a name="132206013"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353394%20do%20%60move_outs%60%20computation%20lazilly/near/132206013" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353394.20do.20.60move_outs.60.20computation.20lazilly.html#132206013">(Aug 15 2018 at 23:19)</a>:</h4>
<p>I still not see where the plural of mois come from</p>



<a name="132206015"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353394%20do%20%60move_outs%60%20computation%20lazilly/near/132206015" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353394.20do.20.60move_outs.60.20computation.20lazilly.html#132206015">(Aug 15 2018 at 23:19)</a>:</h4>
<p>that: <a href="https://github.com/rust-lang/rust/blob/0f4b4987cd6dea5406dec0634770839fb31ce72c/src/librustc_mir/dataflow/impls/mod.rs#L491-L566" target="_blank" title="https://github.com/rust-lang/rust/blob/0f4b4987cd6dea5406dec0634770839fb31ce72c/src/librustc_mir/dataflow/impls/mod.rs#L491-L566">https://github.com/rust-lang/rust/blob/0f4b4987cd6dea5406dec0634770839fb31ce72c/src/librustc_mir/dataflow/impls/mod.rs#L491-L566</a></p>



<a name="132206017"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353394%20do%20%60move_outs%60%20computation%20lazilly/near/132206017" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353394.20do.20.60move_outs.60.20computation.20lazilly.html#132206017">(Aug 15 2018 at 23:19)</a>:</h4>
<p>if you stop in the first move</p>



<a name="132206024"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353394%20do%20%60move_outs%60%20computation%20lazilly/near/132206024" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353394.20do.20.60move_outs.60.20computation.20lazilly.html#132206024">(Aug 15 2018 at 23:19)</a>:</h4>
<p>well there can be multiple paths</p>



<a name="132206026"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353394%20do%20%60move_outs%60%20computation%20lazilly/near/132206026" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353394.20do.20.60move_outs.60.20computation.20lazilly.html#132206026">(Aug 15 2018 at 23:19)</a>:</h4>
<p>e.g.</p>



<a name="132206030"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353394%20do%20%60move_outs%60%20computation%20lazilly/near/132206030" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353394.20do.20.60move_outs.60.20computation.20lazilly.html#132206030">(Aug 15 2018 at 23:19)</a>:</h4>
<div class="codehilite"><pre><span></span>if true {
  drop(x);
} else {
  drop(x);
}
use(x);
</pre></div>



<a name="132206033"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353394%20do%20%60move_outs%60%20computation%20lazilly/near/132206033" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353394.20do.20.60move_outs.60.20computation.20lazilly.html#132206033">(Aug 15 2018 at 23:19)</a>:</h4>
<p>ahh ya</p>



<a name="132206034"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353394%20do%20%60move_outs%60%20computation%20lazilly/near/132206034" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353394.20do.20.60move_outs.60.20computation.20lazilly.html#132206034">(Aug 15 2018 at 23:19)</a>:</h4>
<p>right</p>



<a name="132206040"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353394%20do%20%60move_outs%60%20computation%20lazilly/near/132206040" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353394.20do.20.60move_outs.60.20computation.20lazilly.html#132206040">(Aug 15 2018 at 23:19)</a>:</h4>
<p>that's tracked by kills and gens</p>



<a name="132206041"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353394%20do%20%60move_outs%60%20computation%20lazilly/near/132206041" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353394.20do.20.60move_outs.60.20computation.20lazilly.html#132206041">(Aug 15 2018 at 23:19)</a>:</h4>
<p>ok</p>



<a name="132206106"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353394%20do%20%60move_outs%60%20computation%20lazilly/near/132206106" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353394.20do.20.60move_outs.60.20computation.20lazilly.html#132206106">(Aug 15 2018 at 23:21)</a>:</h4>
<p><span class="user-mention" data-user-id="116266">@Santiago Pastorino</span> <a href="https://github.com/rust-lang/rust/blob/0f4b4987cd6dea5406dec0634770839fb31ce72c/src/librustc_mir/dataflow/impls/mod.rs#L527-L528" target="_blank" title="https://github.com/rust-lang/rust/blob/0f4b4987cd6dea5406dec0634770839fb31ce72c/src/librustc_mir/dataflow/impls/mod.rs#L527-L528">here is the code that generates the *kills* at  a given location</a> -- in other words, to walk the set of paths initialized</p>



<a name="132206123"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353394%20do%20%60move_outs%60%20computation%20lazilly/near/132206123" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353394.20do.20.60move_outs.60.20computation.20lazilly.html#132206123">(Aug 15 2018 at 23:21)</a>:</h4>
<p>this I think <a href="https://github.com/rust-lang/rust/blob/0f4b4987cd6dea5406dec0634770839fb31ce72c/src/librustc_mir/dataflow/impls/mod.rs#L523" target="_blank" title="https://github.com/rust-lang/rust/blob/0f4b4987cd6dea5406dec0634770839fb31ce72c/src/librustc_mir/dataflow/impls/mod.rs#L523">generates the <code>gens</code></a></p>



<a name="132206550"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353394%20do%20%60move_outs%60%20computation%20lazilly/near/132206550" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353394.20do.20.60move_outs.60.20computation.20lazilly.html#132206550">(Aug 15 2018 at 23:31)</a>:</h4>
<p>I just need one of those, right?</p>



<a name="132206557"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353394%20do%20%60move_outs%60%20computation%20lazilly/near/132206557" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353394.20do.20.60move_outs.60.20computation.20lazilly.html#132206557">(Aug 15 2018 at 23:31)</a>:</h4>
<p>one of whats? :)</p>



<a name="132206568"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353394%20do%20%60move_outs%60%20computation%20lazilly/near/132206568" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353394.20do.20.60move_outs.60.20computation.20lazilly.html#132206568">(Aug 15 2018 at 23:32)</a>:</h4>
<p>kills or gens</p>



<a name="132206600"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353394%20do%20%60move_outs%60%20computation%20lazilly/near/132206600" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353394.20do.20.60move_outs.60.20computation.20lazilly.html#132206600">(Aug 15 2018 at 23:32)</a>:</h4>
<p>so I keep iterating meanwhile I see the thing in the kills set</p>



<a name="132206603"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353394%20do%20%60move_outs%60%20computation%20lazilly/near/132206603" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353394.20do.20.60move_outs.60.20computation.20lazilly.html#132206603">(Aug 15 2018 at 23:32)</a>:</h4>
<p>well I think we prob want to stop the search at <em>either</em> an initialization (kill) or a move (gen)</p>



<a name="132206606"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353394%20do%20%60move_outs%60%20computation%20lazilly/near/132206606" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353394.20do.20.60move_outs.60.20computation.20lazilly.html#132206606">(Aug 15 2018 at 23:32)</a>:</h4>
<p>so we kind of have to look for both I guess?</p>



<a name="132206608"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353394%20do%20%60move_outs%60%20computation%20lazilly/near/132206608" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353394.20do.20.60move_outs.60.20computation.20lazilly.html#132206608">(Aug 15 2018 at 23:32)</a>:</h4>
<p>ahh right</p>



<a name="132206612"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353394%20do%20%60move_outs%60%20computation%20lazilly/near/132206612" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353394.20do.20.60move_outs.60.20computation.20lazilly.html#132206612">(Aug 15 2018 at 23:32)</a>:</h4>
<p>ok</p>



<a name="132264083"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353394%20do%20%60move_outs%60%20computation%20lazilly/near/132264083" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353394.20do.20.60move_outs.60.20computation.20lazilly.html#132264083">(Aug 16 2018 at 20:29)</a>:</h4>
<p><span class="user-mention" data-user-id="116009">@nikomatsakis</span> just had a chance to leave this thing running</p>



<a name="132264122"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353394%20do%20%60move_outs%60%20computation%20lazilly/near/132264122" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353394.20do.20.60move_outs.60.20computation.20lazilly.html#132264122">(Aug 16 2018 at 20:30)</a>:</h4>
<p>there's a test failing</p>



<a name="132264125"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353394%20do%20%60move_outs%60%20computation%20lazilly/near/132264125" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353394.20do.20.60move_outs.60.20computation.20lazilly.html#132264125">(Aug 16 2018 at 20:30)</a>:</h4>
<p>still running</p>



<a name="132264245"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353394%20do%20%60move_outs%60%20computation%20lazilly/near/132264245" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353394.20do.20.60move_outs.60.20computation.20lazilly.html#132264245">(Aug 16 2018 at 20:32)</a>:</h4>
<p>I mean, so we are covered :)</p>



<a name="132264259"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353394%20do%20%60move_outs%60%20computation%20lazilly/near/132264259" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353394.20do.20.60move_outs.60.20computation.20lazilly.html#132264259">(Aug 16 2018 at 20:32)</a>:</h4>
<p>I need to add the "initialized" code</p>



<a name="132264470"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353394%20do%20%60move_outs%60%20computation%20lazilly/near/132264470" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353394.20do.20.60move_outs.60.20computation.20lazilly.html#132264470">(Aug 16 2018 at 20:36)</a>:</h4>
<div class="codehilite"><pre><span></span>failures:

---- [ui] ui/borrowck/borrowck-storage-dead.rs stdout ----

The actual stderr differed from the expected stderr.
Actual stderr saved to /home/santiago/src/oss/rust1/build/x86_64-unknown-linux-gnu/test/ui/borrowck/borrowck-storage-dead/borrowck-storage-dead.stderr
Actual stderr saved to /home/santiago/src/oss/rust1/src/test/ui/borrowck/borrowck-storage-dead.stderr

error: /home/santiago/src/oss/rust1/src/test/ui/borrowck/borrowck-storage-dead.rs:28: unexpected error: &#39;28:17: 28:18: use of moved value: `x` (Mir) [E0382]&#39;

error: /home/santiago/src/oss/rust1/src/test/ui/borrowck/borrowck-storage-dead.rs:28: expected error not found: (Mir) [E0381]

error: 1 unexpected errors found, 1 expected errors not found
status: exit code: 1
command: &quot;/home/santiago/src/oss/rust1/build/x86_64-unknown-linux-gnu/stage1/bin/rustc&quot; &quot;/home/santiago/src/oss/rust1/src/test/ui/borrowck/borrowck-storage-dead.rs&quot; &quot;--target=x86_64-unknown-linux-gnu&quot; &quot;--error-format&quot; &quot;json&quot; &quot;-Zui-testing&quot; &quot;-C&quot; &quot;prefer-dynamic&quot; &quot;-o&quot; &quot;/home/santiago/src/oss/rust1/build/x86_64-unknown-linux-gnu/test/ui/borrowck/borrowck-storage-dead/a&quot; &quot;-Crpath&quot; &quot;-O&quot; &quot;-Zunstable-options&quot; &quot;-Lnative=/home/santiago/src/oss/rust1/build/x86_64-unknown-linux-gnu/native/rust-test-helpers&quot; &quot;-Z&quot; &quot;borrowck=compare&quot; &quot;-L&quot; &quot;/home/santiago/src/oss/rust1/build/x86_64-unknown-linux-gnu/test/ui/borrowck/borrowck-storage-dead/auxiliary&quot; &quot;-A&quot; &quot;unused&quot;
unexpected errors (from JSON output): [
    Error {
        line_num: 28,
        kind: Some(
            Error
        ),
        msg: &quot;28:17: 28:18: use of moved value: `x` (Mir) [E0382]&quot;
    }
]

not found errors (from test file): [
    Error {
        line_num: 28,
        kind: Some(
            Error
        ),
        msg: &quot;(Mir) [E0381]&quot;
    }
]

thread &#39;[ui] ui/borrowck/borrowck-storage-dead.rs&#39; panicked at &#39;explicit panic&#39;, tools/compiletest/src/runtest.rs:1283:13
stack backtrace:
   0:     0x556149dabcee - std::sys::unix::backtrace::tracing::imp::unwind_backtrace::hab08c28baa7df427
                               at libstd/sys/unix/backtrace/tracing/gcc_s.rs:49
   1:     0x556149d9c3d6 - std::sys_common::backtrace::print::hb73053b1bfdbfebe
                               at libstd/sys_common/backtrace.rs:71
                               at libstd/sys_common/backtrace.rs:59
   2:     0x556149d98c1d - std::panicking::default_hook::{{closure}}::h3f1dc75ac5c59882
                               at libstd/panicking.rs:211
   3:     0x556149d9892b - std::panicking::default_hook::h6e2cc1a5e193171c
                               at libstd/panicking.rs:221
   4:     0x556149d9928c - std::panicking::rust_panic_with_hook::h75e1df07c2b91379
                               at libstd/panicking.rs:475
   5:     0x556149c6b1c6 - std::panicking::begin_panic::he049bbdeb48f06a3
   6:     0x556149c86bc9 - compiletest::runtest::TestCx::check_expected_errors::h1c23466ab236c27d
   7:     0x556149c7bc29 - compiletest::runtest::TestCx::run_revision::heaee5cdb04caf6d8
   8:     0x556149c743eb - compiletest::runtest::run::h70337afe44c21fe2
   9:     0x556149c99ca2 - &lt;F as alloc::boxed::FnBox&lt;A&gt;&gt;::call_box::h827c94cb4a225c9d
  10:     0x556149cdff42 - &lt;F as alloc::boxed::FnBox&lt;A&gt;&gt;::call_box::h389fb44a69e56229
                               at libtest/lib.rs:1444
                               at /checkout/src/liballoc/boxed.rs:642
  11:     0x556149dbe949 - __rust_maybe_catch_panic
                               at libpanic_unwind/lib.rs:105
  12:     0x556149cfcfef - std::sys_common::backtrace::__rust_begin_short_backtrace::h82f6704267b276a2
                               at /checkout/src/libstd/panicking.rs:289
                               at /checkout/src/libstd/panic.rs:392
                               at libtest/lib.rs:1406
                               at /checkout/src/libstd/sys_common/backtrace.rs:136
  13:     0x556149cfd9a4 - std::panicking::try::do_call::h14201cddbab609e9
                               at /checkout/src/libstd/thread/mod.rs:409
                               at /checkout/src/libstd/panic.rs:313
                               at /checkout/src/libstd/panicking.rs:310
  14:     0x556149dbe949 - __rust_maybe_catch_panic
                               at libpanic_unwind/lib.rs:105
  15:     0x556149cf33a6 - &lt;F as alloc::boxed::FnBox&lt;A&gt;&gt;::call_box::h22e4c29e48b9d747
                               at /checkout/src/libstd/panicking.rs:289
                               at /checkout/src/libstd/panic.rs:392
                               at /checkout/src/libstd/thread/mod.rs:408
                               at /checkout/src/liballoc/boxed.rs:642
  16:     0x556149d9b0ca - std::sys_common::thread::start_thread::h54ff7746c22c98d3
                               at /checkout/src/liballoc/boxed.rs:652
                               at libstd/sys_common/thread.rs:24
  17:     0x556149d997f5 - std::sys::unix::thread::Thread::new::thread_start::h817575057e7b413b
                               at libstd/sys/unix/thread.rs:90
  18:     0x7fbfa5206a8c - start_thread
  19:     0x7fbfa511c822 - clone
  20:                0x0 - &lt;unknown&gt;

---- [ui] ui/issues/issue-15919.rs stdout ----

error: Error: expected failure status (Some(1)) but received status None.
status: signal: 6
command: &quot;/home/santiago/src/oss/rust1/build/x86_64-unknown-linux-gnu/stage1/bin/rustc&quot; &quot;/home/santiago/src/oss/rust1/src/test/ui/issues/issue-15919.rs&quot; &quot;--target=x86_64-unknown-linux-gnu&quot; &quot;--error-format&quot; &quot;json&quot; &quot;-Zui-testing&quot; &quot;-C&quot; &quot;prefer-dynamic&quot; &quot;-o&quot; &quot;/home/santiago/src/oss/rust1/build/x86_64-unknown-linux-gnu/test/ui/issues/issue-15919/a&quot; &quot;-Crpath&quot; &quot;-O&quot; &quot;-Zunstable-options&quot; &quot;-Lnative=/home/santiago/src/oss/rust1/build/x86_64-unknown-linux-gnu/native/rust-test-helpers&quot; &quot;-L&quot; &quot;/home/santiago/src/oss/rust1/build/x86_64-unknown-linux-gnu/test/ui/issues/issue-15919/auxiliary&quot; &quot;-A&quot; &quot;unused&quot;
stdout:
------------------------------------------

------------------------------------------
stderr:
------------------------------------------
{&quot;message&quot;:&quot;the type `[usize; 18446744073709551615]` is too big for the current architecture&quot;,&quot;code&quot;:null,&quot;level&quot;:&quot;error&quot;,&quot;spans&quot;:[],&quot;children&quot;:[],&quot;rendered&quot;:&quot;error: the type `[usize; 18446744073709551615]` is too big for the current architecture\n\n&quot;}
{&quot;message&quot;:&quot;aborting due to previous error&quot;,&quot;code&quot;:null,&quot;level&quot;:&quot;error&quot;,&quot;spans&quot;:[],&quot;children&quot;:[],&quot;rendered&quot;:&quot;error: aborting due to previous error\n\n&quot;}
rustc: /home/santiago/src/oss/rust1/src/llvm/lib/CodeGen/TargetPassConfig.cpp:812: virtual void llvm::TargetPassConfig::addMachinePasses(): Assertion `TPI &amp;&amp; IPI &amp;&amp; &quot;Pass ID not registered!&quot;&#39; failed.

------------------------------------------

thread &#39;[ui] ui/issues/issue-15919.rs&#39; panicked at &#39;explicit panic&#39;, tools/compiletest/src/runtest.rs:3166:9
stack backtrace:
   0:     0x556149dabcee - std::sys::unix::backtrace::tracing::imp::unwind_backtrace::hab08c28baa7df427
                               at libstd/sys/unix/backtrace/tracing/gcc_s.rs:49
   1:     0x556149d9c3d6 - std::sys_common::backtrace::print::hb73053b1bfdbfebe
                               at libstd/sys_common/backtrace.rs:71
                               at libstd/sys_common/backtrace.rs:59
   2:     0x556149d98c1d - std::panicking::default_hook::{{closure}}::h3f1dc75ac5c59882
                               at libstd/panicking.rs:211
   3:     0x556149d9892b - std::panicking::default_hook::h6e2cc1a5e193171c
                               at libstd/panicking.rs:221
   4:     0x556149d9928c - std::panicking::rust_panic_with_hook::h75e1df07c2b91379
                               at libstd/panicking.rs:475
   5:     0x556149c6b1c6 - std::panicking::begin_panic::he049bbdeb48f06a3
   6:     0x556149c8fc3f - compiletest::runtest::ProcRes::fatal::hc58d063b69dc5824
   7:     0x556149c8b7f2 - compiletest::runtest::TestCx::fatal_proc_rec::h748991f6d3edcb2a
   8:     0x556149c7fa4f - compiletest::runtest::TestCx::check_correct_failure_status::hd887d1deee64ae79
   9:     0x556149c7b073 - compiletest::runtest::TestCx::run_revision::heaee5cdb04caf6d8
  10:     0x556149c743eb - compiletest::runtest::run::h70337afe44c21fe2
  11:     0x556149c99ca2 - &lt;F as alloc::boxed::FnBox&lt;A&gt;&gt;::call_box::h827c94cb4a225c9d
  12:     0x556149cdff42 - &lt;F as alloc::boxed::FnBox&lt;A&gt;&gt;::call_box::h389fb44a69e56229
                               at libtest/lib.rs:1444
                               at /checkout/src/liballoc/boxed.rs:642
  13:     0x556149dbe949 - __rust_maybe_catch_panic
                               at libpanic_unwind/lib.rs:105
  14:     0x556149cfcfef - std::sys_common::backtrace::__rust_begin_short_backtrace::h82f6704267b276a2
                               at /checkout/src/libstd/panicking.rs:289
                               at /checkout/src/libstd/panic.rs:392
                               at libtest/lib.rs:1406
                               at /checkout/src/libstd/sys_common/backtrace.rs:136
  15:     0x556149cfd9a4 - std::panicking::try::do_call::h14201cddbab609e9
                               at /checkout/src/libstd/thread/mod.rs:409
                               at /checkout/src/libstd/panic.rs:313
                               at /checkout/src/libstd/panicking.rs:310
  16:     0x556149dbe949 - __rust_maybe_catch_panic
                               at libpanic_unwind/lib.rs:105
  17:     0x556149cf33a6 - &lt;F as alloc::boxed::FnBox&lt;A&gt;&gt;::call_box::h22e4c29e48b9d747
                               at /checkout/src/libstd/panicking.rs:289
                               at /checkout/src/libstd/panic.rs:392
                               at /checkout/src/libstd/thread/mod.rs:408
                               at /checkout/src/liballoc/boxed.rs:642
  18:     0x556149d9b0ca - std::sys_common::thread::start_thread::h54ff7746c22c98d3
                               at /checkout/src/liballoc/boxed.rs:652
                               at libstd/sys_common/thread.rs:24
  19:     0x556149d997f5 - std::sys::unix::thread::Thread::new::thread_start::h817575057e7b
</pre></div>



<a name="132267617"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353394%20do%20%60move_outs%60%20computation%20lazilly/near/132267617" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353394.20do.20.60move_outs.60.20computation.20lazilly.html#132267617">(Aug 16 2018 at 21:53)</a>:</h4>
<p><span class="user-mention" data-user-id="116009">@nikomatsakis</span> pushed something <a href="https://github.com/rust-lang/rust/pull/53403" target="_blank" title="https://github.com/rust-lang/rust/pull/53403">https://github.com/rust-lang/rust/pull/53403</a>, it's failing need to figure out what's going on after this thing runs</p>



<a name="132267623"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353394%20do%20%60move_outs%60%20computation%20lazilly/near/132267623" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353394.20do.20.60move_outs.60.20computation.20lazilly.html#132267623">(Aug 16 2018 at 21:53)</a>:</h4>
<p>but if you want to check how it goes you can see the commit there</p>



<a name="132267624"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353394%20do%20%60move_outs%60%20computation%20lazilly/near/132267624" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353394.20do.20.60move_outs.60.20computation.20lazilly.html#132267624">(Aug 16 2018 at 21:53)</a>:</h4>
<blockquote>
<p>I mean, so we are covered :)</p>
</blockquote>
<p>nice :)</p>



<a name="132373956"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353394%20do%20%60move_outs%60%20computation%20lazilly/near/132373956" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353394.20do.20.60move_outs.60.20computation.20lazilly.html#132373956">(Aug 18 2018 at 20:00)</a>:</h4>
<p>debugging this issue</p>



<a name="132373960"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353394%20do%20%60move_outs%60%20computation%20lazilly/near/132373960" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353394.20do.20.60move_outs.60.20computation.20lazilly.html#132373960">(Aug 18 2018 at 20:00)</a>:</h4>
<p>seeing this in the mir dump</p>



<a name="132373968"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353394%20do%20%60move_outs%60%20computation%20lazilly/near/132373968" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353394.20do.20.60move_outs.60.20computation.20lazilly.html#132373968">(Aug 18 2018 at 20:01)</a>:</h4>
<div class="codehilite"><pre><span></span>// MIR for `main`
// source = MirSource { def_id: DefId(0/0:3 ~ test[317d]::main[0]), promoted: None }
// pass_name = nll
// disambiguator = 0

| Free Region Mapping
| &#39;_#0r    | Global   | [&#39;_#0r, &#39;_#1r]
| &#39;_#1r    | Local    | [&#39;_#1r]
|
| Inferred Region Values
| &#39;_#0r    | U0 | {bb0[0..=127], &#39;_#0r}
| &#39;_#1r    | U0 | {bb0[0..=127], &#39;_#1r}
|
| Inference Constraints
| &#39;_#0r live at {bb0[0..=127]}
| &#39;_#1r live at {bb0[0..=127]}
fn main() -&gt; (){
    let mut _0: ();                      // return place
    scope 1 {
    }
    scope 2 {
        let _1: i32;                     // &quot;x&quot; in scope 2 at test.rs:2:13: 2:14
    }
    let mut _2: i32;
    let mut _3: i32;

    bb0: {
                                         | Live variables on entry to bb0[0]: []
        UserAssertTy(Canonical { variables: [], value: i32 }, _1); // bb0[0]: scope 0 at test.rs:1:11: 5:2
                                         | Live variables on entry to bb0[1]: []
        StorageLive(_1);                 // bb0[1]: scope 0 at test.rs:2:13: 2:14
                                         | Live variables on entry to bb0[2]: []
        StorageLive(_2);                 // bb0[2]: scope 1 at test.rs:3:17: 3:22
                                         | Live variables on entry to bb0[3]: []
        StorageLive(_3);                 // bb0[3]: scope 1 at test.rs:3:17: 3:18
                                         | Live variables on entry to bb0[4]: []
        _3 = _1;                         // bb0[4]: scope 1 at test.rs:3:17: 3:18
                                         | Live variables on entry to bb0[5]: []
        _2 = Add(move _3, const 1i32);   // bb0[5]: scope 1 at test.rs:3:17: 3:22
                                         // ty::Const
                                         // + ty: i32
                                         // + val: Scalar(Bits { size: 4, bits: 1 })
                                         // mir::Constant
                                         // + span: test.rs:3:21: 3:22
                                         // + ty: i32
                                         // + literal: Const { ty: i32, val: Scalar(Bits { size: 4, bits: 1 }) }
                                         | Live variables on entry to bb0[6]: []
        StorageDead(_3);                 // bb0[6]: scope 1 at test.rs:3:21: 3:22
                                         | Live variables on entry to bb0[7]: []
        StorageDead(_2);                 // bb0[7]: scope 1 at test.rs:3:22: 3:23
                                         | Live variables on entry to bb0[8]: []
        _0 = ();                         // bb0[8]: scope 0 at test.rs:1:11: 5:2
                                         | Live variables on entry to bb0[9]: []
        StorageDead(_1);                 // bb0[9]: scope 0 at test.rs:5:1: 5:2
                                         | Live variables on entry to bb0[10]: []
        return;                          // bb0[10]: scope 0 at test.rs:5:2: 5:2
    | Live variables on exit from bb0: []
    }
}
</pre></div>



<a name="132373975"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353394%20do%20%60move_outs%60%20computation%20lazilly/near/132373975" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353394.20do.20.60move_outs.60.20computation.20lazilly.html#132373975">(Aug 18 2018 at 20:01)</a>:</h4>
<p>in particular I don't understand <code>_2 = Add(move _3, const 1i32);   // bb0[5]: scope 1 at test.rs:3:17: 3:22</code></p>



<a name="132373978"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353394%20do%20%60move_outs%60%20computation%20lazilly/near/132373978" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353394.20do.20.60move_outs.60.20computation.20lazilly.html#132373978">(Aug 18 2018 at 20:01)</a>:</h4>
<p>why it says <code>move</code> there?</p>



<a name="132373981"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353394%20do%20%60move_outs%60%20computation%20lazilly/near/132373981" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353394.20do.20.60move_outs.60.20computation.20lazilly.html#132373981">(Aug 18 2018 at 20:02)</a>:</h4>
<p><code>_3</code> is x and it's an i32</p>



<a name="132374023"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353394%20do%20%60move_outs%60%20computation%20lazilly/near/132374023" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Matthew Jasper <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353394.20do.20.60move_outs.60.20computation.20lazilly.html#132374023">(Aug 18 2018 at 20:02)</a>:</h4>
<p>Temporaries are always moved</p>



<a name="132374029"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353394%20do%20%60move_outs%60%20computation%20lazilly/near/132374029" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Matthew Jasper <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353394.20do.20.60move_outs.60.20computation.20lazilly.html#132374029">(Aug 18 2018 at 20:02)</a>:</h4>
<p>Well, operands at least</p>



<a name="132374033"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353394%20do%20%60move_outs%60%20computation%20lazilly/near/132374033" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353394.20do.20.60move_outs.60.20computation.20lazilly.html#132374033">(Aug 18 2018 at 20:02)</a>:</h4>
<p><span class="emoji emoji-1f44d" title="+1">:+1:</span></p>



<a name="132381396"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353394%20do%20%60move_outs%60%20computation%20lazilly/near/132381396" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353394.20do.20.60move_outs.60.20computation.20lazilly.html#132381396">(Aug 19 2018 at 00:03)</a>:</h4>
<p>gonna leave a couple of comments about what I've found on this issue, for <span class="user-mention" data-user-id="116009">@nikomatsakis</span> to check out and give some pointers :)</p>



<a name="132381398"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353394%20do%20%60move_outs%60%20computation%20lazilly/near/132381398" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353394.20do.20.60move_outs.60.20computation.20lazilly.html#132381398">(Aug 19 2018 at 00:03)</a>:</h4>
<p>so ...</p>



<a name="132381399"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353394%20do%20%60move_outs%60%20computation%20lazilly/near/132381399" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353394.20do.20.60move_outs.60.20computation.20lazilly.html#132381399">(Aug 19 2018 at 00:03)</a>:</h4>
<p>this code ...</p>



<a name="132381400"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353394%20do%20%60move_outs%60%20computation%20lazilly/near/132381400" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353394.20do.20.60move_outs.60.20computation.20lazilly.html#132381400">(Aug 19 2018 at 00:03)</a>:</h4>
<div class="codehilite"><pre><span></span><span class="k">fn</span> <span class="nf">main</span><span class="p">()</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="k">loop</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">        </span><span class="kd">let</span><span class="w"> </span><span class="n">x</span>: <span class="kt">i32</span><span class="p">;</span><span class="w"></span>
<span class="w">        </span><span class="kd">let</span><span class="w"> </span><span class="n">_</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">x</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span><span class="p">;</span><span class="w"> </span><span class="c1">//~ERROR (Ast) [E0381]</span>
<span class="w">                       </span><span class="c1">//~^ ERROR (Mir) [E0381]</span>
<span class="w">    </span><span class="p">}</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>
</pre></div>



<a name="132381441"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353394%20do%20%60move_outs%60%20computation%20lazilly/near/132381441" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353394.20do.20.60move_outs.60.20computation.20lazilly.html#132381441">(Aug 19 2018 at 00:04)</a>:</h4>
<p>this is the code that make the current PR fail</p>



<a name="132381454"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353394%20do%20%60move_outs%60%20computation%20lazilly/near/132381454" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353394.20do.20.60move_outs.60.20computation.20lazilly.html#132381454">(Aug 19 2018 at 00:05)</a>:</h4>
<p>the thing is that the algorithm is returning a collection with one moi when it should be empty</p>



<a name="132381459"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353394%20do%20%60move_outs%60%20computation%20lazilly/near/132381459" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353394.20do.20.60move_outs.60.20computation.20lazilly.html#132381459">(Aug 19 2018 at 00:05)</a>:</h4>
<p>this is the mir dump ...</p>



<a name="132381461"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353394%20do%20%60move_outs%60%20computation%20lazilly/near/132381461" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353394.20do.20.60move_outs.60.20computation.20lazilly.html#132381461">(Aug 19 2018 at 00:05)</a>:</h4>
<div class="codehilite"><pre><span></span>// MIR for `main`
// source = MirSource { def_id: DefId(0/0:3 ~ test[317d]::main[0]), promoted: None }
// pass_name = nll
// disambiguator = 0

| Free Region Mapping
| &#39;_#0r    | Global   | [&#39;_#0r, &#39;_#1r]
| &#39;_#1r    | Local    | [&#39;_#1r]
|
| Inferred Region Values
| &#39;_#0r    | U0 | {bb0[0], bb1[0], bb2[0..=10], bb3[0..=114], &#39;_#0r}
| &#39;_#1r    | U0 | {bb0[0], bb1[0], bb2[0..=10], bb3[0..=114], &#39;_#1r}
|
| Inference Constraints
| &#39;_#0r live at {bb0[0], bb1[0], bb2[0..=10], bb3[0..=114]}
| &#39;_#1r live at {bb0[0], bb1[0], bb2[0..=10], bb3[0..=114]}
fn main() -&gt; (){
    let mut _0: ();                      // return place
    scope 1 {
    }
    scope 2 {
        let _3: i32;                     // &quot;x&quot; in scope 2 at test.rs:3:13: 3:14
    }
    let mut _1: !;
    let mut _2: ();
    let mut _4: i32;
    let mut _5: i32;

    bb0: {
                                         | Live variables on entry to bb0[0]: []
        goto -&gt; bb1;                     // bb0[0]: scope 0 at test.rs:2:5: 6:6
    | Live variables on exit from bb0: []
    }

    bb1: {
                                         | Live variables on entry to bb1[0]: []
        falseUnwind -&gt; [real: bb2, cleanup: bb3]; // bb1[0]: scope 0 at test.rs:2:5: 6:6
    | Live variables on exit from bb1: []
    }

    bb2: {
                                         | Live variables on entry to bb2[0]: []
        UserAssertTy(Canonical { variables: [], value: i32 }, _3); // bb2[0]: scope 0 at test.rs:2:10: 6:6
                                         | Live variables on entry to bb2[1]: []
        StorageLive(_3);                 // bb2[1]: scope 0 at test.rs:3:13: 3:14
                                         | Live variables on entry to bb2[2]: []
        StorageLive(_4);                 // bb2[2]: scope 1 at test.rs:4:17: 4:22
                                         | Live variables on entry to bb2[3]: []
        StorageLive(_5);                 // bb2[3]: scope 1 at test.rs:4:17: 4:18
                                         | Live variables on entry to bb2[4]: []
        _5 = _3;                         // bb2[4]: scope 1 at test.rs:4:17: 4:18
                                         | Live variables on entry to bb2[5]: []
        _4 = Add(move _5, const 1i32);   // bb2[5]: scope 1 at test.rs:4:17: 4:22
                                         // ty::Const
                                         // + ty: i32
                                         // + val: Scalar(Bits { size: 4, bits: 1 })
                                         // mir::Constant
                                         // + span: test.rs:4:21: 4:22
                                         // + ty: i32
                                         // + literal: Const { ty: i32, val: Scalar(Bits { size: 4, bits: 1 }) }
                                         | Live variables on entry to bb2[6]: []
        StorageDead(_5);                 // bb2[6]: scope 1 at test.rs:4:21: 4:22
                                         | Live variables on entry to bb2[7]: []
        StorageDead(_4);                 // bb2[7]: scope 1 at test.rs:4:22: 4:23
                                         | Live variables on entry to bb2[8]: []
        _2 = ();                         // bb2[8]: scope 0 at test.rs:2:10: 6:6
                                         | Live variables on entry to bb2[9]: []
        StorageDead(_3);                 // bb2[9]: scope 0 at test.rs:6:5: 6:6
                                         | Live variables on entry to bb2[10]: []
        goto -&gt; bb1;                     // bb2[10]: scope 0 at test.rs:2:5: 6:6
    | Live variables on exit from bb2: []
    }

    bb3: {                               // cleanup
                                         | Live variables on entry to bb3[0]: []
        resume;                          // bb3[0]: scope 0 at test.rs:1:1: 7:2
    | Live variables on exit from bb3: []
    }
}
</pre></div>



<a name="132381505"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353394%20do%20%60move_outs%60%20computation%20lazilly/near/132381505" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353394.20do.20.60move_outs.60.20computation.20lazilly.html#132381505">(Aug 19 2018 at 00:06)</a>:</h4>
<p>what I'm seeing when I run with logs enabled is this ...</p>



<a name="132381516"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353394%20do%20%60move_outs%60%20computation%20lazilly/near/132381516" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353394.20do.20.60move_outs.60.20computation.20lazilly.html#132381516">(Aug 19 2018 at 00:07)</a>:</h4>
<div class="codehilite"><pre><span></span>DEBUG 2018-08-18T21:10:04Z: rustc_mir::borrow_check: MirBorrowckCtxt::process_statement(bb2[0], UserAssertTy(Canonical { variables: [], value: i32 }, _3)): borrows in effect: [] borrows generated: [] uninits: [_0, _1, _2, _3, _4, _5] ever_init: [mp2@test.rs:2:10: 6:6 (Deep)]
DEBUG 2018-08-18T21:10:04Z: rustc_mir::borrow_check: MirBorrowckCtxt::process_statement(bb2[1], StorageLive(_3)): borrows in effect: [] borrows generated: [] uninits: [_0, _1, _2, _3, _4, _5] ever_init: [mp2@test.rs:2:10: 6:6 (Deep)]
DEBUG 2018-08-18T21:10:04Z: rustc_mir::borrow_check: MirBorrowckCtxt::process_statement(bb2[2], StorageLive(_4)): borrows in effect: [] borrows generated: [] uninits: [_0, _1, _2, _3, _4, _5] ever_init: [mp2@test.rs:2:10: 6:6 (Deep)]
DEBUG 2018-08-18T21:10:04Z: rustc_mir::borrow_check: MirBorrowckCtxt::process_statement(bb2[3], StorageLive(_5)): borrows in effect: [] borrows generated: [] uninits: [_0, _1, _2, _3, _4, _5] ever_init: [mp2@test.rs:2:10: 6:6 (Deep)]
DEBUG 2018-08-18T21:10:04Z: rustc_mir::borrow_check: MirBorrowckCtxt::process_statement(bb2[4], _5 = _3): borrows in effect: [] borrows generated: [] uninits: [_0, _1, _2, _3, _4, _5] ever_init: [mp2@test.rs:2:10: 6:6 (Deep)]
DEBUG 2018-08-18T21:10:04Z: rustc_mir::borrow_check: check_access_permissions(_3, Read(Copy), No)
DEBUG 2018-08-18T21:10:04Z: rustc_mir::borrow_check: check_access_for_conflict(context=Context { kind: AssignRhs, loc: bb2[4] }, place_span=(_3, test.rs:4:17: 4:18), sd=Deep, rw=Read(Copy))
DEBUG 2018-08-18T21:10:04Z: rustc_mir::borrow_check: check_if_full_path_is_moved place: _3
DEBUG 2018-08-18T21:10:04Z: rustc_mir::borrow_check::error_reporting: report_use_of_moved_or_uninitialized: current_location=bb2[3]
DEBUG 2018-08-18T21:10:04Z: rustc_mir::borrow_check::error_reporting: report_use_of_moved_or_uninitialized: current_location=bb2[2]
DEBUG 2018-08-18T21:10:04Z: rustc_mir::borrow_check::error_reporting: report_use_of_moved_or_uninitialized: current_location=bb2[1]
DEBUG 2018-08-18T21:10:04Z: rustc_mir::borrow_check::error_reporting: report_use_of_moved_or_uninitialized: current_location=bb2[0]
DEBUG 2018-08-18T21:10:04Z: rustc_mir::borrow_check::error_reporting: report_use_of_moved_or_uninitialized: current_location=bb1[0]
DEBUG 2018-08-18T21:10:04Z: rustc_mir::borrow_check::error_reporting: report_use_of_moved_or_uninitialized: current_location=bb2[10]
DEBUG 2018-08-18T21:10:04Z: rustc_mir::borrow_check::error_reporting: report_use_of_moved_or_uninitialized: current_location=bb2[9]
DEBUG 2018-08-18T21:10:04Z: rustc_mir::borrow_check::error_reporting: report_use_of_moved_or_uninitialized: moi=mo3
DEBUG 2018-08-18T21:10:04Z: rustc_mir::borrow_check::error_reporting: report_use_of_moved_or_uninitialized: found
DEBUG 2018-08-18T21:10:04Z: rustc_mir::borrow_check::error_reporting: report_use_of_moved_or_uninitialized: current_location=bb0[0]
DEBUG 2018-08-18T21:10:04Z: rustc_mir::borrow_check::error_reporting: report_use_of_moved_or_uninitialized: mois=[mo3]
DEBUG 2018-08-18T21:10:04Z: rustc_mir::borrow_check: check_if_path_or_subpath_is_moved place: _3
DEBUG 2018-08-18T21:10:04Z: rustc_mir::borrow_check::error_reporting: report_use_of_moved_or_uninitialized: current_location=bb2[3]
DEBUG 2018-08-18T21:10:04Z: rustc_mir::borrow_check::error_reporting: report_use_of_moved_or_uninitialized: current_location=bb2[2]
DEBUG 2018-08-18T21:10:04Z: rustc_mir::borrow_check::error_reporting: report_use_of_moved_or_uninitialized: current_location=bb2[1]
DEBUG 2018-08-18T21:10:04Z: rustc_mir::borrow_check::error_reporting: report_use_of_moved_or_uninitialized: current_location=bb2[0]
DEBUG 2018-08-18T21:10:04Z: rustc_mir::borrow_check::error_reporting: report_use_of_moved_or_uninitialized: current_location=bb1[0]
DEBUG 2018-08-18T21:10:04Z: rustc_mir::borrow_check::error_reporting: report_use_of_moved_or_uninitialized: current_location=bb2[10]
DEBUG 2018-08-18T21:10:04Z: rustc_mir::borrow_check::error_reporting: report_use_of_moved_or_uninitialized: current_location=bb2[9]
DEBUG 2018-08-18T21:10:04Z: rustc_mir::borrow_check::error_reporting: report_use_of_moved_or_uninitialized: moi=mo3
DEBUG 2018-08-18T21:10:04Z: rustc_mir::borrow_check::error_reporting: report_use_of_moved_or_uninitialized: found
DEBUG 2018-08-18T21:10:04Z: rustc_mir::borrow_check::error_reporting: report_use_of_moved_or_uninitialized: current_location=bb0[0]
DEBUG 2018-08-18T21:10:04Z: rustc_mir::borrow_check::error_reporting: report_use_of_moved_or_uninitialized: mois=[mo3]
DEBUG 2018-08-18T21:10:04Z: rustc_mir::borrow_check: check_if_assigned_path_is_moved place: _5
DEBUG 2018-08-18T21:10:04Z: rustc_mir::borrow_check: check_access_permissions(_5, Write(Mutate), ExceptUpvars)
DEBUG 2018-08-18T21:10:04Z: rustc_mir::borrow_check: check_access_for_conflict(context=Context { kind: AssignLhs, loc: bb2[4] }, place_span=(_5, test.rs:4:17: 4:18), sd=Shallow(None), rw=Write(Mutate))
DEBUG 2018-08-18T21:10:04Z: rustc_mir::borrow_check: check_if_reassignment_to_immutable_state(_5)
</pre></div>



<a name="132381566"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353394%20do%20%60move_outs%60%20computation%20lazilly/near/132381566" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353394.20do.20.60move_outs.60.20computation.20lazilly.html#132381566">(Aug 19 2018 at 00:09)</a>:</h4>
<p>there you can see that it start going backwards and from the loop statement it ends restarting from the end and finding the x in x + 1 and it thinks its moved</p>



<a name="132381570"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353394%20do%20%60move_outs%60%20computation%20lazilly/near/132381570" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353394.20do.20.60move_outs.60.20computation.20lazilly.html#132381570">(Aug 19 2018 at 00:09)</a>:</h4>
<p>I guess we should stop when a <code>StorageLive</code> for the thing that we are looking for is found</p>



<a name="132381571"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353394%20do%20%60move_outs%60%20computation%20lazilly/near/132381571" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353394.20do.20.60move_outs.60.20computation.20lazilly.html#132381571">(Aug 19 2018 at 00:09)</a>:</h4>
<p><span class="user-mention" data-user-id="116009">@nikomatsakis</span> those are more or less my thoughts, will wait for your comments to see what are the options :)</p>



<a name="132527118"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353394%20do%20%60move_outs%60%20computation%20lazilly/near/132527118" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353394.20do.20.60move_outs.60.20computation.20lazilly.html#132527118">(Aug 21 2018 at 16:25)</a>:</h4>
<p><span class="user-mention" data-user-id="116266">@Santiago Pastorino</span> <span class="emoji emoji-1f44b" title="wave">:wave:</span> ok I'll try to catch up shortly</p>



<a name="132537028"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353394%20do%20%60move_outs%60%20computation%20lazilly/near/132537028" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353394.20do.20.60move_outs.60.20computation.20lazilly.html#132537028">(Aug 21 2018 at 19:32)</a>:</h4>
<p><span class="user-mention" data-user-id="116009">@nikomatsakis</span> <span class="emoji emoji-1f44b" title="hi">:hi:</span></p>



<a name="132537031"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353394%20do%20%60move_outs%60%20computation%20lazilly/near/132537031" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353394.20do.20.60move_outs.60.20computation.20lazilly.html#132537031">(Aug 21 2018 at 19:32)</a>:</h4>
<p>sure</p>



<a name="132591234"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353394%20do%20%60move_outs%60%20computation%20lazilly/near/132591234" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353394.20do.20.60move_outs.60.20computation.20lazilly.html#132591234">(Aug 22 2018 at 17:35)</a>:</h4>
<p>ping <span class="user-mention" data-user-id="116266">@Santiago Pastorino</span></p>



<a name="132591651"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353394%20do%20%60move_outs%60%20computation%20lazilly/near/132591651" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353394.20do.20.60move_outs.60.20computation.20lazilly.html#132591651">(Aug 22 2018 at 17:42)</a>:</h4>
<p>hey</p>



<a name="132591685"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353394%20do%20%60move_outs%60%20computation%20lazilly/near/132591685" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353394.20do.20.60move_outs.60.20computation.20lazilly.html#132591685">(Aug 22 2018 at 17:43)</a>:</h4>
<p>want to chat about this at some point? :)</p>



<a name="132591693"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353394%20do%20%60move_outs%60%20computation%20lazilly/near/132591693" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353394.20do.20.60move_outs.60.20computation.20lazilly.html#132591693">(Aug 22 2018 at 17:43)</a>:</h4>
<p>not sure what is the current status</p>



<a name="132591754"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353394%20do%20%60move_outs%60%20computation%20lazilly/near/132591754" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353394.20do.20.60move_outs.60.20computation.20lazilly.html#132591754">(Aug 22 2018 at 17:44)</a>:</h4>
<p>sure</p>



<a name="132591758"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353394%20do%20%60move_outs%60%20computation%20lazilly/near/132591758" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353394.20do.20.60move_outs.60.20computation.20lazilly.html#132591758">(Aug 22 2018 at 17:44)</a>:</h4>
<p>current status is the last stuff I've written :)</p>



<a name="132591760"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353394%20do%20%60move_outs%60%20computation%20lazilly/near/132591760" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353394.20do.20.60move_outs.60.20computation.20lazilly.html#132591760">(Aug 22 2018 at 17:44)</a>:</h4>
<p>haven't touched again</p>



<a name="132591765"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353394%20do%20%60move_outs%60%20computation%20lazilly/near/132591765" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353394.20do.20.60move_outs.60.20computation.20lazilly.html#132591765">(Aug 22 2018 at 17:44)</a>:</h4>
<p>my way back home was a pain</p>



<a name="132591767"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353394%20do%20%60move_outs%60%20computation%20lazilly/near/132591767" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353394.20do.20.60move_outs.60.20computation.20lazilly.html#132591767">(Aug 22 2018 at 17:44)</a>:</h4>
<p>:(</p>



<a name="132591770"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353394%20do%20%60move_outs%60%20computation%20lazilly/near/132591770" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353394.20do.20.60move_outs.60.20computation.20lazilly.html#132591770">(Aug 22 2018 at 17:44)</a>:</h4>
<p>had a 12hs delay in the last flight</p>



<a name="132591775"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353394%20do%20%60move_outs%60%20computation%20lazilly/near/132591775" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353394.20do.20.60move_outs.60.20computation.20lazilly.html#132591775">(Aug 22 2018 at 17:44)</a>:</h4>
<p>oh wow</p>



<a name="132591789"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353394%20do%20%60move_outs%60%20computation%20lazilly/near/132591789" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353394.20do.20.60move_outs.60.20computation.20lazilly.html#132591789">(Aug 22 2018 at 17:45)</a>:</h4>
<p>I didn't even had to complain that the airline already gave me a lot of miles</p>



<a name="132591791"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353394%20do%20%60move_outs%60%20computation%20lazilly/near/132591791" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353394.20do.20.60move_outs.60.20computation.20lazilly.html#132591791">(Aug 22 2018 at 17:45)</a>:</h4>
<p>without complaining</p>



<a name="132591801"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353394%20do%20%60move_outs%60%20computation%20lazilly/near/132591801" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353394.20do.20.60move_outs.60.20computation.20lazilly.html#132591801">(Aug 22 2018 at 17:45)</a>:</h4>
<p>anyway, I've sent a huge complain</p>



<a name="132591817"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353394%20do%20%60move_outs%60%20computation%20lazilly/near/132591817" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353394.20do.20.60move_outs.60.20computation.20lazilly.html#132591817">(Aug 22 2018 at 17:45)</a>:</h4>
<p>because we all think they have lied in a lot of things</p>



<a name="132591827"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353394%20do%20%60move_outs%60%20computation%20lazilly/near/132591827" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353394.20do.20.60move_outs.60.20computation.20lazilly.html#132591827">(Aug 22 2018 at 17:46)</a>:</h4>
<p>and basically were avoiding saying that the flight was cancelled to avoid paying a hotel for each of us</p>



<a name="132591876"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353394%20do%20%60move_outs%60%20computation%20lazilly/near/132591876" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353394.20do.20.60move_outs.60.20computation.20lazilly.html#132591876">(Aug 22 2018 at 17:46)</a>:</h4>
<p>they kept delaying 2hs</p>



<a name="132591877"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353394%20do%20%60move_outs%60%20computation%20lazilly/near/132591877" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353394.20do.20.60move_outs.60.20computation.20lazilly.html#132591877">(Aug 22 2018 at 17:46)</a>:</h4>
<p>yeah it seems like some number of hours is effectively a cancellation</p>



<a name="132591879"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353394%20do%20%60move_outs%60%20computation%20lazilly/near/132591879" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353394.20do.20.60move_outs.60.20computation.20lazilly.html#132591879">(Aug 22 2018 at 17:46)</a>:</h4>
<p>then 3 more</p>



<a name="132591881"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353394%20do%20%60move_outs%60%20computation%20lazilly/near/132591881" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353394.20do.20.60move_outs.60.20computation.20lazilly.html#132591881">(Aug 22 2018 at 17:46)</a>:</h4>
<p>etc</p>



<a name="132591890"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353394%20do%20%60move_outs%60%20computation%20lazilly/near/132591890" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353394.20do.20.60move_outs.60.20computation.20lazilly.html#132591890">(Aug 22 2018 at 17:46)</a>:</h4>
<p>in the EU, at least, I know there's a "bill of rights" about this sort of thing. Not sure about the US, probably not.</p>



<a name="132591891"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353394%20do%20%60move_outs%60%20computation%20lazilly/near/132591891" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353394.20do.20.60move_outs.60.20computation.20lazilly.html#132591891">(Aug 22 2018 at 17:46)</a>:</h4>
<p>it was at the end not cancelled</p>



<a name="132591893"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353394%20do%20%60move_outs%60%20computation%20lazilly/near/132591893" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353394.20do.20.60move_outs.60.20computation.20lazilly.html#132591893">(Aug 22 2018 at 17:46)</a>:</h4>
<p>it was moved</p>



<a name="132591902"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353394%20do%20%60move_outs%60%20computation%20lazilly/near/132591902" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353394.20do.20.60move_outs.60.20computation.20lazilly.html#132591902">(Aug 22 2018 at 17:46)</a>:</h4>
<p>but that happens because this is the aircraft they use to go to MVD</p>



<a name="132591916"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353394%20do%20%60move_outs%60%20computation%20lazilly/near/132591916" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353394.20do.20.60move_outs.60.20computation.20lazilly.html#132591916">(Aug 22 2018 at 17:47)</a>:</h4>
<p>they needed to have it in MVD to do the MVD-&gt;MIA flight back</p>



<a name="132591929"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353394%20do%20%60move_outs%60%20computation%20lazilly/near/132591929" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353394.20do.20.60move_outs.60.20computation.20lazilly.html#132591929">(Aug 22 2018 at 17:47)</a>:</h4>
<p>anyway, back to lazily computation ...</p>



<a name="132591939"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353394%20do%20%60move_outs%60%20computation%20lazilly/near/132591939" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353394.20do.20.60move_outs.60.20computation.20lazilly.html#132591939">(Aug 22 2018 at 17:47)</a>:</h4>
<p>if you check the log, the last stuff I've shared are my last thoughts</p>



<a name="132592034"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353394%20do%20%60move_outs%60%20computation%20lazilly/near/132592034" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353394.20do.20.60move_outs.60.20computation.20lazilly.html#132592034">(Aug 22 2018 at 17:49)</a>:</h4>
<p>let me step one step further back</p>



<a name="132592042"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353394%20do%20%60move_outs%60%20computation%20lazilly/near/132592042" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353394.20do.20.60move_outs.60.20computation.20lazilly.html#132592042">(Aug 22 2018 at 17:49)</a>:</h4>
<p>the problem was that your PR was getting the wrong results?</p>



<a name="132592692"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353394%20do%20%60move_outs%60%20computation%20lazilly/near/132592692" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353394.20do.20.60move_outs.60.20computation.20lazilly.html#132592692">(Aug 22 2018 at 18:00)</a>:</h4>
<p>yes</p>



<a name="132687646"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353394%20do%20%60move_outs%60%20computation%20lazilly/near/132687646" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353394.20do.20.60move_outs.60.20computation.20lazilly.html#132687646">(Aug 24 2018 at 09:53)</a>:</h4>
<p><span class="user-mention" data-user-id="116266">@Santiago Pastorino</span> so looking at the code I do see that the original ignored <code>StorageDead</code> for some reason</p>



<a name="132687653"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353394%20do%20%60move_outs%60%20computation%20lazilly/near/132687653" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353394.20do.20.60move_outs.60.20computation.20lazilly.html#132687653">(Aug 24 2018 at 09:53)</a>:</h4>
<p>I think you also mentioned this</p>



<a name="132687654"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353394%20do%20%60move_outs%60%20computation%20lazilly/near/132687654" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353394.20do.20.60move_outs.60.20computation.20lazilly.html#132687654">(Aug 24 2018 at 09:53)</a>:</h4>
<p>that seems like the <strong>most likely</strong> error here?</p>



<a name="132687656"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353394%20do%20%60move_outs%60%20computation%20lazilly/near/132687656" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353394.20do.20.60move_outs.60.20computation.20lazilly.html#132687656">(Aug 24 2018 at 09:53)</a>:</h4>
<p>I've been pondering if we are "hard-coding" this too much</p>



<a name="132687685"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353394%20do%20%60move_outs%60%20computation%20lazilly/near/132687685" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353394.20do.20.60move_outs.60.20computation.20lazilly.html#132687685">(Aug 24 2018 at 09:54)</a>:</h4>
<p>er, sorry, that's sort of an independent thought</p>



<a name="132687710"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353394%20do%20%60move_outs%60%20computation%20lazilly/near/132687710" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353394.20do.20.60move_outs.60.20computation.20lazilly.html#132687710">(Aug 24 2018 at 09:54)</a>:</h4>
<p>in particular, I was wondering if we should write a sort of "reverse depth-first search" that works for <strong>any</strong> <code>BitDenotation</code></p>



<a name="132687713"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353394%20do%20%60move_outs%60%20computation%20lazilly/near/132687713" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353394.20do.20.60move_outs.60.20computation.20lazilly.html#132687713">(Aug 24 2018 at 09:54)</a>:</h4>
<p>then we could invoke it with the existing <code>MovingOutStatements</code> (the one I asked you to remove from the PR)</p>



<a name="132687717"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353394%20do%20%60move_outs%60%20computation%20lazilly/near/132687717" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353394.20do.20.60move_outs.60.20computation.20lazilly.html#132687717">(Aug 24 2018 at 09:54)</a>:</h4>
<p>that would let us write the code once</p>



<a name="132687732"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353394%20do%20%60move_outs%60%20computation%20lazilly/near/132687732" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353394.20do.20.60move_outs.60.20computation.20lazilly.html#132687732">(Aug 24 2018 at 09:55)</a>:</h4>
<p>and let us sort of re-use <em>exactly</em> what <code>MovingOutStatements</code> does today</p>



<a name="132687734"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353394%20do%20%60move_outs%60%20computation%20lazilly/near/132687734" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353394.20do.20.60move_outs.60.20computation.20lazilly.html#132687734">(Aug 24 2018 at 09:55)</a>:</h4>
<p>otoh it's probably a good idea to just make a targeted edit for now to make sure this <code>StorageDead</code> thing is the problem</p>



<a name="132687788"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353394%20do%20%60move_outs%60%20computation%20lazilly/near/132687788" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353394.20do.20.60move_outs.60.20computation.20lazilly.html#132687788">(Aug 24 2018 at 09:56)</a>:</h4>
<p>to that end, I applied this diff</p>



<a name="132687789"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353394%20do%20%60move_outs%60%20computation%20lazilly/near/132687789" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353394.20do.20.60move_outs.60.20computation.20lazilly.html#132687789">(Aug 24 2018 at 09:56)</a>:</h4>
<div class="codehilite"><pre><span></span>modified   src/librustc_mir/borrow_check/error_reporting.rs
<span class="gu">@@ -544,10 +544,18 @@ impl&lt;&#39;cx, &#39;gcx, &#39;tcx&gt; MirBorrowckCtxt&lt;&#39;cx, &#39;gcx, &#39;tcx&gt; {</span>
             }

             // check for moves
<span class="gd">-            for moi in &amp;self.move_data.loc_map[l] {</span>
<span class="gd">-                if self.move_data.moves[*moi].path == mpi {</span>
<span class="gd">-                    result.push(*moi);</span>
<span class="gd">-                    continue &#39;dfs;</span>
<span class="gi">+            let stmt = &amp;mir[l.block].statements[l.statement_index];</span>
<span class="gi">+            if let StatementKind::StorageDead(..) = stmt.kind {</span>
<span class="gi">+                // this analysis only tries to find moves explicitly</span>
<span class="gi">+                // written by the user, so we ignore the move-outs</span>
<span class="gi">+                // created by `StorageDead` and at the beginning</span>
<span class="gi">+                // of a function.</span>
<span class="gi">+            } else {</span>
<span class="gi">+                for moi in &amp;self.move_data.loc_map[l] {</span>
<span class="gi">+                    if self.move_data.moves[*moi].path == mpi {</span>
<span class="gi">+                        result.push(*moi);</span>
<span class="gi">+                        continue &#39;dfs;</span>
<span class="gi">+                    }</span>
                 }
             }
</pre></div>



<a name="132687798"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353394%20do%20%60move_outs%60%20computation%20lazilly/near/132687798" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353394.20do.20.60move_outs.60.20computation.20lazilly.html#132687798">(Aug 24 2018 at 09:57)</a>:</h4>
<p>annoyingly I forgot <code>--keep-stage 1</code>, so it'll be a few minutes before I have the answer :P</p>



<a name="132688470"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353394%20do%20%60move_outs%60%20computation%20lazilly/near/132688470" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353394.20do.20.60move_outs.60.20computation.20lazilly.html#132688470">(Aug 24 2018 at 10:13)</a>:</h4>
<p>ok, a (slightly tweaked) version of that diff fixes on problem, but <code>issue-29723.rs</code> still fails</p>



<a name="132688473"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353394%20do%20%60move_outs%60%20computation%20lazilly/near/132688473" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353394.20do.20.60move_outs.60.20computation.20lazilly.html#132688473">(Aug 24 2018 at 10:14)</a>:</h4>
<p>I'm not quite sure why</p>



<a name="132688517"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353394%20do%20%60move_outs%60%20computation%20lazilly/near/132688517" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353394.20do.20.60move_outs.60.20computation.20lazilly.html#132688517">(Aug 24 2018 at 10:14)</a>:</h4>
<div class="codehilite"><pre><span></span>1       error[E0382]: use of moved value: `s`
2         --&gt; $DIR/issue-29723.rs:22:13
3          |
<span class="gd">-       LL |         0 if { drop(s); false } =&gt; String::from(&quot;oops&quot;),</span>
<span class="gd">-          |                     - value moved here</span>
<span class="gd">-       ...</span>
7       LL |             s
<span class="gd">-          |             ^ value used here after move</span>
<span class="gi">+          |             ^ value moved here in previous iteration of loop</span>
9          |
10         = note: move occurs because `s` has type `std::string::String`, which does not implement the `Copy` trait
</pre></div>



<a name="132688531"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353394%20do%20%60move_outs%60%20computation%20lazilly/near/132688531" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353394.20do.20.60move_outs.60.20computation.20lazilly.html#132688531">(Aug 24 2018 at 10:15)</a>:</h4>
<p>have to look at the MIR I guess</p>



<a name="132688534"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353394%20do%20%60move_outs%60%20computation%20lazilly/near/132688534" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353394.20do.20.60move_outs.60.20computation.20lazilly.html#132688534">(Aug 24 2018 at 10:15)</a>:</h4>
<p>oh, this looks wrong (in your code):</p>
<div class="codehilite"><pre><span></span><span class="w">        </span><span class="kd">let</span><span class="w"> </span><span class="n">l</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">context</span><span class="p">.</span><span class="n">loc</span><span class="p">;</span><span class="w"></span>
<span class="w">        </span><span class="kd">let</span><span class="w"> </span><span class="k">mut</span><span class="w"> </span><span class="n">stack</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">Vec</span>::<span class="n">new</span><span class="p">();</span><span class="w"></span>
<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="n">context</span><span class="p">.</span><span class="n">loc</span><span class="p">.</span><span class="n">statement_index</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">            </span><span class="n">stack</span><span class="p">.</span><span class="n">push</span><span class="p">(</span><span class="n">l</span><span class="p">);</span><span class="w"></span>
<span class="w">        </span><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">            </span><span class="n">stack</span><span class="p">.</span><span class="n">push</span><span class="p">(</span><span class="n">Location</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">block</span>: <span class="nc">l</span><span class="p">.</span><span class="n">block</span><span class="p">,</span><span class="w"> </span><span class="n">statement_index</span>: <span class="nc">l</span><span class="p">.</span><span class="n">statement_index</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="p">});</span><span class="w"></span>
<span class="w">        </span><span class="p">}</span><span class="w"></span>
</pre></div>



<a name="132688581"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353394%20do%20%60move_outs%60%20computation%20lazilly/near/132688581" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353394.20do.20.60move_outs.60.20computation.20lazilly.html#132688581">(Aug 24 2018 at 10:16)</a>:</h4>
<p>I think what you really want is to add a <code>fn predecessor_locations(&amp;self, loc: Location) -&gt; impl Iterator&lt;Item = Location&gt;</code> function to the <code>Mir</code> type</p>



<a name="132688582"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353394%20do%20%60move_outs%60%20computation%20lazilly/near/132688582" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353394.20do.20.60move_outs.60.20computation.20lazilly.html#132688582">(Aug 24 2018 at 10:16)</a>:</h4>
<p>and then do</p>



<a name="132688584"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353394%20do%20%60move_outs%60%20computation%20lazilly/near/132688584" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353394.20do.20.60move_outs.60.20computation.20lazilly.html#132688584">(Aug 24 2018 at 10:16)</a>:</h4>
<p><code>stack.extend(mir.predecessor_locations(l));</code></p>



<a name="132688595"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353394%20do%20%60move_outs%60%20computation%20lazilly/near/132688595" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353394.20do.20.60move_outs.60.20computation.20lazilly.html#132688595">(Aug 24 2018 at 10:16)</a>:</h4>
<p>you can then replace the existing code you have down below</p>
<div class="codehilite"><pre><span></span><span class="w">            </span><span class="k">if</span><span class="w"> </span><span class="n">l</span><span class="p">.</span><span class="n">statement_index</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">                </span><span class="k">for</span><span class="w"> </span><span class="n">predecessor_block</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="n">mir</span><span class="p">.</span><span class="n">predecessors_for</span><span class="p">(</span><span class="n">l</span><span class="p">.</span><span class="n">block</span><span class="p">).</span><span class="n">iter</span><span class="p">()</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">                    </span><span class="kd">let</span><span class="w"> </span><span class="n">predecessor_end_location</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">mir</span><span class="p">.</span><span class="n">terminator_loc</span><span class="p">(</span><span class="o">*</span><span class="n">predecessor_block</span><span class="p">);</span><span class="w"></span>
<span class="w">                    </span><span class="n">stack</span><span class="p">.</span><span class="n">push</span><span class="p">(</span><span class="n">predecessor_end_location</span><span class="p">);</span><span class="w"></span>
<span class="w">                </span><span class="p">}</span><span class="w"></span>
<span class="w">            </span><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">                </span><span class="n">stack</span><span class="p">.</span><span class="n">push</span><span class="p">(</span><span class="n">Location</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">block</span>: <span class="nc">l</span><span class="p">.</span><span class="n">block</span><span class="p">,</span><span class="w"> </span><span class="n">statement_index</span>: <span class="nc">l</span><span class="p">.</span><span class="n">statement_index</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="p">});</span><span class="w"></span>
<span class="w">            </span><span class="p">}</span><span class="w"></span>
</pre></div>


<p>with a call to that same function.</p>



<a name="132688606"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353394%20do%20%60move_outs%60%20computation%20lazilly/near/132688606" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353394.20do.20.60move_outs.60.20computation.20lazilly.html#132688606">(Aug 24 2018 at 10:17)</a>:</h4>
<p>writing these sorts of functions, where you want to return one of two iterators, is a bi tricky -- I usually find it works best to use <code>Option</code> etc</p>



<a name="132688669"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353394%20do%20%60move_outs%60%20computation%20lazilly/near/132688669" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353394.20do.20.60move_outs.60.20computation.20lazilly.html#132688669">(Aug 24 2018 at 10:18)</a>:</h4>
<p>ok, left a review to that effect <span class="user-mention" data-user-id="116266">@Santiago Pastorino</span> — I'll stop here :)</p>



<a name="132693234"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353394%20do%20%60move_outs%60%20computation%20lazilly/near/132693234" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353394.20do.20.60move_outs.60.20computation.20lazilly.html#132693234">(Aug 24 2018 at 12:18)</a>:</h4>
<p>cool, checked your thoughts really quick</p>



<a name="132693242"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353394%20do%20%60move_outs%60%20computation%20lazilly/near/132693242" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353394.20do.20.60move_outs.60.20computation.20lazilly.html#132693242">(Aug 24 2018 at 12:19)</a>:</h4>
<p>using the cellphone</p>



<a name="132693254"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353394%20do%20%60move_outs%60%20computation%20lazilly/near/132693254" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353394.20do.20.60move_outs.60.20computation.20lazilly.html#132693254">(Aug 24 2018 at 12:19)</a>:</h4>
<p>will properly read this later in the computer</p>



<a name="132693257"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353394%20do%20%60move_outs%60%20computation%20lazilly/near/132693257" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353394.20do.20.60move_outs.60.20computation.20lazilly.html#132693257">(Aug 24 2018 at 12:19)</a>:</h4>
<p>but thanks for the feedback</p>



<a name="132693639"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353394%20do%20%60move_outs%60%20computation%20lazilly/near/132693639" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353394.20do.20.60move_outs.60.20computation.20lazilly.html#132693639">(Aug 24 2018 at 12:29)</a>:</h4>
<p><span class="user-mention" data-user-id="116266">@Santiago Pastorino</span> great!</p>



<a name="132791841"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353394%20do%20%60move_outs%60%20computation%20lazilly/near/132791841" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353394.20do.20.60move_outs.60.20computation.20lazilly.html#132791841">(Aug 26 2018 at 15:18)</a>:</h4>
<p><span class="user-mention" data-user-id="116266">@Santiago Pastorino</span> did you ever get a chance to look into this? (no worries if not, just checking in)</p>



<a name="132795179"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353394%20do%20%60move_outs%60%20computation%20lazilly/near/132795179" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353394.20do.20.60move_outs.60.20computation.20lazilly.html#132795179">(Aug 26 2018 at 17:20)</a>:</h4>
<p><span class="user-mention" data-user-id="116009">@nikomatsakis</span> not yet, tomorrow will do</p>



<a name="132795186"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353394%20do%20%60move_outs%60%20computation%20lazilly/near/132795186" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353394.20do.20.60move_outs.60.20computation.20lazilly.html#132795186">(Aug 26 2018 at 17:21)</a>:</h4>
<p>first weekend back was complicated <span class="emoji emoji-1f60a" title="blush">:blush:</span></p>



<a name="132879204"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353394%20do%20%60move_outs%60%20computation%20lazilly/near/132879204" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353394.20do.20.60move_outs.60.20computation.20lazilly.html#132879204">(Aug 27 2018 at 20:36)</a>:</h4>
<blockquote>
<p><span class="user-mention" data-user-id="116266">@Santiago Pastorino</span> so looking at the code I do see that the original ignored <code>StorageDead</code> for some reason</p>
</blockquote>
<p>what do you mean here?</p>



<a name="132879224"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353394%20do%20%60move_outs%60%20computation%20lazilly/near/132879224" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353394.20do.20.60move_outs.60.20computation.20lazilly.html#132879224">(Aug 27 2018 at 20:37)</a>:</h4>
<blockquote>
<p>I've been pondering if we are "hard-coding" this too much</p>
</blockquote>
<p>yeah, it may be too hard coded</p>



<a name="132879341"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353394%20do%20%60move_outs%60%20computation%20lazilly/near/132879341" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353394.20do.20.60move_outs.60.20computation.20lazilly.html#132879341">(Aug 27 2018 at 20:39)</a>:</h4>
<blockquote>
<p>in particular, I was wondering if we should write a sort of "reverse depth-first search" that works for <strong>any</strong> <code>BitDenotation</code></p>
</blockquote>
<p>yeah, I'm all for refactoring and making things that make more sense rather than adding snippets of things that make the thing work :P</p>



<a name="132879346"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353394%20do%20%60move_outs%60%20computation%20lazilly/near/132879346" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353394.20do.20.60move_outs.60.20computation.20lazilly.html#132879346">(Aug 27 2018 at 20:39)</a>:</h4>
<p>I'm torn tbh</p>



<a name="132879352"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353394%20do%20%60move_outs%60%20computation%20lazilly/near/132879352" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353394.20do.20.60move_outs.60.20computation.20lazilly.html#132879352">(Aug 27 2018 at 20:39)</a>:</h4>
<p>but it does seem like we ought to be able to factor this "reverse DFS" out</p>



<a name="132879355"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353394%20do%20%60move_outs%60%20computation%20lazilly/near/132879355" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353394.20do.20.60move_outs.60.20computation.20lazilly.html#132879355">(Aug 27 2018 at 20:39)</a>:</h4>
<p>regarding <code>StorageDead</code></p>



<a name="132879438"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353394%20do%20%60move_outs%60%20computation%20lazilly/near/132879438" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353394.20do.20.60move_outs.60.20computation.20lazilly.html#132879438">(Aug 27 2018 at 20:40)</a>:</h4>
<p>I was referring to <a href="https://github.com/rust-lang/rust/blob/d5a448b3f47b22c9cb010198bdcc49d4392b090b/src/librustc_mir/dataflow/impls/mod.rs#L491" target="_blank" title="https://github.com/rust-lang/rust/blob/d5a448b3f47b22c9cb010198bdcc49d4392b090b/src/librustc_mir/dataflow/impls/mod.rs#L491">the definition of <code>MovingOutStatements</code></a></p>



<a name="132879447"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353394%20do%20%60move_outs%60%20computation%20lazilly/near/132879447" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353394.20do.20.60move_outs.60.20computation.20lazilly.html#132879447">(Aug 27 2018 at 20:41)</a>:</h4>
<p>and specifically <a href="https://github.com/rust-lang/rust/blob/d5a448b3f47b22c9cb010198bdcc49d4392b090b/src/librustc_mir/dataflow/impls/mod.rs#L512-L516" target="_blank" title="https://github.com/rust-lang/rust/blob/d5a448b3f47b22c9cb010198bdcc49d4392b090b/src/librustc_mir/dataflow/impls/mod.rs#L512-L516">this section</a></p>



<a name="132879556"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353394%20do%20%60move_outs%60%20computation%20lazilly/near/132879556" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353394.20do.20.60move_outs.60.20computation.20lazilly.html#132879556">(Aug 27 2018 at 20:42)</a>:</h4>
<blockquote>
<p>ok, a (slightly tweaked) version of that diff fixes on problem, but <code>issue-29723.rs</code> still fails</p>
</blockquote>
<p>you mean that the diff you've pasted is not proper? do you have the new diff?</p>



<a name="132879703"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353394%20do%20%60move_outs%60%20computation%20lazilly/near/132879703" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353394.20do.20.60move_outs.60.20computation.20lazilly.html#132879703">(Aug 27 2018 at 20:45)</a>:</h4>
<blockquote>
<p>and specifically <a href="https://github.com/rust-lang/rust/blob/d5a448b3f47b22c9cb010198bdcc49d4392b090b/src/librustc_mir/dataflow/impls/mod.rs#L512-L516" target="_blank" title="https://github.com/rust-lang/rust/blob/d5a448b3f47b22c9cb010198bdcc49d4392b090b/src/librustc_mir/dataflow/impls/mod.rs#L512-L516">this section</a></p>
</blockquote>
<p>yeah, but what do you mean, should we consider StorageDead or not?</p>



<a name="132880236"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353394%20do%20%60move_outs%60%20computation%20lazilly/near/132880236" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353394.20do.20.60move_outs.60.20computation.20lazilly.html#132880236">(Aug 27 2018 at 20:54)</a>:</h4>
<p>Yes, we should — that is, if we want to match the behavior of the existing dataflow analysis</p>



<a name="132880242"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353394%20do%20%60move_outs%60%20computation%20lazilly/near/132880242" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353394.20do.20.60move_outs.60.20computation.20lazilly.html#132880242">(Aug 27 2018 at 20:54)</a>:</h4>
<p>(which we do)</p>



<a name="132880446"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353394%20do%20%60move_outs%60%20computation%20lazilly/near/132880446" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353394.20do.20.60move_outs.60.20computation.20lazilly.html#132880446">(Aug 27 2018 at 20:58)</a>:</h4>
<blockquote>
<p>you mean that the diff you've pasted is not proper? do you have the new diff?</p>
</blockquote>
<p>I think I pushed it to your branch</p>



<a name="132880466"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353394%20do%20%60move_outs%60%20computation%20lazilly/near/132880466" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353394.20do.20.60move_outs.60.20computation.20lazilly.html#132880466">(Aug 27 2018 at 20:59)</a>:</h4>
<blockquote>
<p>yeah, I'm all for refactoring and making things that make more sense rather than adding snippets of things that make the thing work :P</p>
</blockquote>
<p>what I had in mind <em>here</em> is that we could write a generic "reverse depth-first search" that is customized by the <code>BitDenotation</code></p>



<a name="132880490"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353394%20do%20%60move_outs%60%20computation%20lazilly/near/132880490" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353394.20do.20.60move_outs.60.20computation.20lazilly.html#132880490">(Aug 27 2018 at 20:59)</a>:</h4>
<p>e.g., <code>fn find_live_bits&lt;BD&gt;(bd: &amp;BD, mir: &amp;Mir, point: Location) -&gt; Vec&lt;BD::Idx&gt; where BD: BitDenotation</code></p>



<a name="132881221"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353394%20do%20%60move_outs%60%20computation%20lazilly/near/132881221" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353394.20do.20.60move_outs.60.20computation.20lazilly.html#132881221">(Aug 27 2018 at 21:15)</a>:</h4>
<p>(does that make sense <span class="user-mention" data-user-id="116266">@Santiago Pastorino</span> ?)</p>



<a name="132881272"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353394%20do%20%60move_outs%60%20computation%20lazilly/near/132881272" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353394.20do.20.60move_outs.60.20computation.20lazilly.html#132881272">(Aug 27 2018 at 21:16)</a>:</h4>
<p>this also might be the sort of code that is almost easier to write in the abstract than in the specific, but anyway</p>



<a name="132881902"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353394%20do%20%60move_outs%60%20computation%20lazilly/near/132881902" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353394.20do.20.60move_outs.60.20computation.20lazilly.html#132881902">(Aug 27 2018 at 21:30)</a>:</h4>
<p>will check later, with the phone now</p>



<a name="132892697"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353394%20do%20%60move_outs%60%20computation%20lazilly/near/132892697" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353394.20do.20.60move_outs.60.20computation.20lazilly.html#132892697">(Aug 28 2018 at 02:54)</a>:</h4>
<p>makes sense</p>



<a name="132892705"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353394%20do%20%60move_outs%60%20computation%20lazilly/near/132892705" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353394.20do.20.60move_outs.60.20computation.20lazilly.html#132892705">(Aug 28 2018 at 02:55)</a>:</h4>
<p>anyway, will check and ping you tomorrow, it's late here :)</p>



<a name="132927892"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353394%20do%20%60move_outs%60%20computation%20lazilly/near/132927892" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353394.20do.20.60move_outs.60.20computation.20lazilly.html#132927892">(Aug 28 2018 at 16:41)</a>:</h4>
<p><span class="user-mention" data-user-id="116009">@nikomatsakis</span> back, so ... the branch with my code and your code only lacks handling the location properly and refactoring this find_live_bits thing, right?</p>



<a name="132927905"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353394%20do%20%60move_outs%60%20computation%20lazilly/near/132927905" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353394.20do.20.60move_outs.60.20computation.20lazilly.html#132927905">(Aug 28 2018 at 16:41)</a>:</h4>
<p>also I was wondering what is exactly the error in the predecessor thing in the current code</p>



<a name="132927955"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353394%20do%20%60move_outs%60%20computation%20lazilly/near/132927955" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353394.20do.20.60move_outs.60.20computation.20lazilly.html#132927955">(Aug 28 2018 at 16:42)</a>:</h4>
<p>because I don't know what to do exactly</p>



<a name="132927960"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353394%20do%20%60move_outs%60%20computation%20lazilly/near/132927960" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353394.20do.20.60move_outs.60.20computation.20lazilly.html#132927960">(Aug 28 2018 at 16:42)</a>:</h4>
<p>I guess you want me to do something like ...</p>



<a name="132927965"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353394%20do%20%60move_outs%60%20computation%20lazilly/near/132927965" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353394.20do.20.60move_outs.60.20computation.20lazilly.html#132927965">(Aug 28 2018 at 16:42)</a>:</h4>
<div class="codehilite"><pre><span></span><span class="w">    </span><span class="k">pub</span><span class="w"> </span><span class="k">fn</span> <span class="nf">predecessor_locations</span><span class="p">(</span><span class="o">&amp;</span><span class="bp">self</span><span class="p">,</span><span class="w"> </span><span class="n">loc</span>: <span class="nc">Location</span><span class="p">)</span><span class="w"> </span>-&gt; <span class="nc">impl</span><span class="w"> </span><span class="nb">Iterator</span><span class="o">&lt;</span><span class="n">Item</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Location</span><span class="o">&gt;</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="n">loc</span><span class="p">.</span><span class="n">statement_index</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">            </span><span class="bp">self</span><span class="p">.</span><span class="n">predecessors_for</span><span class="p">(</span><span class="n">loc</span><span class="p">.</span><span class="n">block</span><span class="p">).</span><span class="n">iter</span><span class="p">()</span><span class="w"></span>
<span class="w">        </span><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">            </span><span class="n">vec</span><span class="o">!</span><span class="p">[</span><span class="n">Location</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">block</span>: <span class="nc">loc</span><span class="p">.</span><span class="n">block</span><span class="p">,</span><span class="w"> </span><span class="n">statement_index</span>: <span class="nc">loc</span><span class="p">.</span><span class="n">statement_index</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="p">}].</span><span class="n">iter</span><span class="p">()</span><span class="w"></span>
<span class="w">        </span><span class="p">}</span><span class="w"></span>
<span class="w">    </span><span class="p">}</span><span class="w"></span>
</pre></div>



<a name="132927970"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353394%20do%20%60move_outs%60%20computation%20lazilly/near/132927970" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353394.20do.20.60move_outs.60.20computation.20lazilly.html#132927970">(Aug 28 2018 at 16:42)</a>:</h4>
<p>take that as pseudo code</p>



<a name="132927981"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353394%20do%20%60move_outs%60%20computation%20lazilly/near/132927981" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353394.20do.20.60move_outs.60.20computation.20lazilly.html#132927981">(Aug 28 2018 at 16:43)</a>:</h4>
<p>pretty sure that I can do better on the else branch</p>



<a name="132928049"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353394%20do%20%60move_outs%60%20computation%20lazilly/near/132928049" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353394.20do.20.60move_outs.60.20computation.20lazilly.html#132928049">(Aug 28 2018 at 16:44)</a>:</h4>
<p>hmm now I have doubts ... I guess I should just call predecessors_for without that if</p>



<a name="132928053"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353394%20do%20%60move_outs%60%20computation%20lazilly/near/132928053" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353394.20do.20.60move_outs.60.20computation.20lazilly.html#132928053">(Aug 28 2018 at 16:44)</a>:</h4>
<p>going to see what predecessors_for really do</p>



<a name="132928700"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353394%20do%20%60move_outs%60%20computation%20lazilly/near/132928700" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353394.20do.20.60move_outs.60.20computation.20lazilly.html#132928700">(Aug 28 2018 at 16:57)</a>:</h4>
<p><code>predecessors_for</code> does not exist</p>



<a name="132928702"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353394%20do%20%60move_outs%60%20computation%20lazilly/near/132928702" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353394.20do.20.60move_outs.60.20computation.20lazilly.html#132928702">(Aug 28 2018 at 16:57)</a>:</h4>
<p>or, sorry</p>



<a name="132928706"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353394%20do%20%60move_outs%60%20computation%20lazilly/near/132928706" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353394.20do.20.60move_outs.60.20computation.20lazilly.html#132928706">(Aug 28 2018 at 16:57)</a>:</h4>
<p>there is a method that yields up a sequence of basic blocks</p>



<a name="132928713"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353394%20do%20%60move_outs%60%20computation%20lazilly/near/132928713" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353394.20do.20.60move_outs.60.20computation.20lazilly.html#132928713">(Aug 28 2018 at 16:57)</a>:</h4>
<p>that code looks roughly right, at least as pseudo-code</p>



<a name="132928761"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353394%20do%20%60move_outs%60%20computation%20lazilly/near/132928761" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353394.20do.20.60move_outs.60.20computation.20lazilly.html#132928761">(Aug 28 2018 at 16:58)</a>:</h4>
<p>the point that we distinguish between the predecessors for the location where <code>statement_index</code> is <code>0</code></p>



<a name="132928770"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353394%20do%20%60move_outs%60%20computation%20lazilly/near/132928770" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353394.20do.20.60move_outs.60.20computation.20lazilly.html#132928770">(Aug 28 2018 at 16:58)</a>:</h4>
<p>(in which case we have to go across basic blocks)</p>



<a name="132928774"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353394%20do%20%60move_outs%60%20computation%20lazilly/near/132928774" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353394.20do.20.60move_outs.60.20computation.20lazilly.html#132928774">(Aug 28 2018 at 16:58)</a>:</h4>
<p>from the other cases</p>



<a name="132928775"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353394%20do%20%60move_outs%60%20computation%20lazilly/near/132928775" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353394.20do.20.60move_outs.60.20computation.20lazilly.html#132928775">(Aug 28 2018 at 16:58)</a>:</h4>
<p>(in which case we are going within a basic block)</p>



<a name="132928889"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353394%20do%20%60move_outs%60%20computation%20lazilly/near/132928889" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353394.20do.20.60move_outs.60.20computation.20lazilly.html#132928889">(Aug 28 2018 at 17:00)</a>:</h4>
<blockquote>
<p>the point that we distinguish between the predecessors for the location where <code>statement_index</code> is <code>0</code></p>
</blockquote>
<p>didn't understand since this phrase on ...</p>



<a name="132928910"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353394%20do%20%60move_outs%60%20computation%20lazilly/near/132928910" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353394.20do.20.60move_outs.60.20computation.20lazilly.html#132928910">(Aug 28 2018 at 17:00)</a>:</h4>
<p>you mean that is right to do that?</p>



<a name="132928916"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353394%20do%20%60move_outs%60%20computation%20lazilly/near/132928916" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353394.20do.20.60move_outs.60.20computation.20lazilly.html#132928916">(Aug 28 2018 at 17:00)</a>:</h4>
<p>yes</p>



<a name="132928928"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353394%20do%20%60move_outs%60%20computation%20lazilly/near/132928928" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353394.20do.20.60move_outs.60.20computation.20lazilly.html#132928928">(Aug 28 2018 at 17:00)</a>:</h4>
<p>also ... predecesor_for returns an iterator of basic blocks</p>



<a name="132928944"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353394%20do%20%60move_outs%60%20computation%20lazilly/near/132928944" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353394.20do.20.60move_outs.60.20computation.20lazilly.html#132928944">(Aug 28 2018 at 17:01)</a>:</h4>
<p>I guess we need to do a flat map or something like that and turn that into locations</p>



<a name="132928961"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353394%20do%20%60move_outs%60%20computation%20lazilly/near/132928961" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353394.20do.20.60move_outs.60.20computation.20lazilly.html#132928961">(Aug 28 2018 at 17:01)</a>:</h4>
<p>but anyway, don't see what was wrong in the old code</p>



<a name="132928967"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353394%20do%20%60move_outs%60%20computation%20lazilly/near/132928967" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353394.20do.20.60move_outs.60.20computation.20lazilly.html#132928967">(Aug 28 2018 at 17:01)</a>:</h4>
<p>or is it that you just wanted to move code to mir?</p>



<a name="132928976"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353394%20do%20%60move_outs%60%20computation%20lazilly/near/132928976" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353394.20do.20.60move_outs.60.20computation.20lazilly.html#132928976">(Aug 28 2018 at 17:01)</a>:</h4>
<p>I'm asking because otherwise I'm going to add the same code but on mir :)</p>



<a name="132929067"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353394%20do%20%60move_outs%60%20computation%20lazilly/near/132929067" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353394.20do.20.60move_outs.60.20computation.20lazilly.html#132929067">(Aug 28 2018 at 17:03)</a>:</h4>
<p>the old code didn't handle the case where statement index is 0</p>



<a name="132929069"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353394%20do%20%60move_outs%60%20computation%20lazilly/near/132929069" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353394.20do.20.60move_outs.60.20computation.20lazilly.html#132929069">(Aug 28 2018 at 17:03)</a>:</h4>
<p>correctly</p>



<a name="132929136"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353394%20do%20%60move_outs%60%20computation%20lazilly/near/132929136" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353394.20do.20.60move_outs.60.20computation.20lazilly.html#132929136">(Aug 28 2018 at 17:04)</a>:</h4>
<p>here is the code</p>



<a name="132929139"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353394%20do%20%60move_outs%60%20computation%20lazilly/near/132929139" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353394.20do.20.60move_outs.60.20computation.20lazilly.html#132929139">(Aug 28 2018 at 17:04)</a>:</h4>
<div class="codehilite"><pre><span></span><span class="k">if</span><span class="w"> </span><span class="n">context</span><span class="p">.</span><span class="n">loc</span><span class="p">.</span><span class="n">statement_index</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">            </span><span class="n">stack</span><span class="p">.</span><span class="n">push</span><span class="p">(</span><span class="n">l</span><span class="p">);</span><span class="w"></span>
<span class="w">        </span><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">            </span><span class="n">stack</span><span class="p">.</span><span class="n">push</span><span class="p">(</span><span class="n">Location</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">block</span>: <span class="nc">l</span><span class="p">.</span><span class="n">block</span><span class="p">,</span><span class="w"> </span><span class="n">statement_index</span>: <span class="nc">l</span><span class="p">.</span><span class="n">statement_index</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="p">});</span><span class="w"></span>
<span class="w">        </span><span class="p">}</span><span class="w"></span>
</pre></div>



<a name="132929141"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353394%20do%20%60move_outs%60%20computation%20lazilly/near/132929141" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353394.20do.20.60move_outs.60.20computation.20lazilly.html#132929141">(Aug 28 2018 at 17:04)</a>:</h4>
<p>that is what is in the PR now</p>



<a name="132929144"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353394%20do%20%60move_outs%60%20computation%20lazilly/near/132929144" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353394.20do.20.60move_outs.60.20computation.20lazilly.html#132929144">(Aug 28 2018 at 17:04)</a>:</h4>
<p>the intention is to push the predecessors onto the stack</p>



<a name="132929156"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353394%20do%20%60move_outs%60%20computation%20lazilly/near/132929156" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353394.20do.20.60move_outs.60.20computation.20lazilly.html#132929156">(Aug 28 2018 at 17:05)</a>:</h4>
<p>yeah I see now</p>



<a name="132929157"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353394%20do%20%60move_outs%60%20computation%20lazilly/near/132929157" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353394.20do.20.60move_outs.60.20computation.20lazilly.html#132929157">(Aug 28 2018 at 17:05)</a>:</h4>
<p>here, <code>l == context.loc</code></p>



<a name="132929159"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353394%20do%20%60move_outs%60%20computation%20lazilly/near/132929159" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353394.20do.20.60move_outs.60.20computation.20lazilly.html#132929159">(Aug 28 2018 at 17:05)</a>:</h4>
<p>it was only the terminator being pushed</p>



<a name="132929166"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353394%20do%20%60move_outs%60%20computation%20lazilly/near/132929166" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353394.20do.20.60move_outs.60.20computation.20lazilly.html#132929166">(Aug 28 2018 at 17:05)</a>:</h4>
<p>so long as <code>context.loc</code> fell in the middle of a basic block, it was correct</p>



<a name="132929169"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353394%20do%20%60move_outs%60%20computation%20lazilly/near/132929169" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353394.20do.20.60move_outs.60.20computation.20lazilly.html#132929169">(Aug 28 2018 at 17:05)</a>:</h4>
<p>but if it feel at the <em>start</em> of a block</p>



<a name="132929173"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353394%20do%20%60move_outs%60%20computation%20lazilly/near/132929173" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353394.20do.20.60move_outs.60.20computation.20lazilly.html#132929173">(Aug 28 2018 at 17:05)</a>:</h4>
<p><span class="emoji emoji-1f44d" title="+1">:+1:</span></p>



<a name="132929177"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353394%20do%20%60move_outs%60%20computation%20lazilly/near/132929177" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353394.20do.20.60move_outs.60.20computation.20lazilly.html#132929177">(Aug 28 2018 at 17:05)</a>:</h4>
<p>ok, going to see how to get locations from a basic_block</p>



<a name="132929240"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353394%20do%20%60move_outs%60%20computation%20lazilly/near/132929240" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353394.20do.20.60move_outs.60.20computation.20lazilly.html#132929240">(Aug 28 2018 at 17:06)</a>:</h4>
<p><span class="user-mention" data-user-id="116266">@Santiago Pastorino</span> there is a method <code>terminator_loc</code></p>



<a name="132929242"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353394%20do%20%60move_outs%60%20computation%20lazilly/near/132929242" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353394.20do.20.60move_outs.60.20computation.20lazilly.html#132929242">(Aug 28 2018 at 17:06)</a>:</h4>
<p>actually, there are a few (sigh)</p>



<a name="132929248"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353394%20do%20%60move_outs%60%20computation%20lazilly/near/132929248" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353394.20do.20.60move_outs.60.20computation.20lazilly.html#132929248">(Aug 28 2018 at 17:06)</a>:</h4>
<p>but I literally <em>just</em> added one</p>



<a name="132929252"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353394%20do%20%60move_outs%60%20computation%20lazilly/near/132929252" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353394.20do.20.60move_outs.60.20computation.20lazilly.html#132929252">(Aug 28 2018 at 17:06)</a>:</h4>
<p>that gives you the <code>Location</code> of the terminator of a basic block</p>



<a name="132929273"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353394%20do%20%60move_outs%60%20computation%20lazilly/near/132929273" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353394.20do.20.60move_outs.60.20computation.20lazilly.html#132929273">(Aug 28 2018 at 17:07)</a>:</h4>
<p><a href="https://github.com/rust-lang/rust/blob/ec4a752202e56a9b2d978305cb2603208d4a3ab4/src/librustc/mir/mod.rs#L332-L338" target="_blank" title="https://github.com/rust-lang/rust/blob/ec4a752202e56a9b2d978305cb2603208d4a3ab4/src/librustc/mir/mod.rs#L332-L338">this is the method</a></p>



<a name="132929274"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353394%20do%20%60move_outs%60%20computation%20lazilly/near/132929274" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353394.20do.20.60move_outs.60.20computation.20lazilly.html#132929274">(Aug 28 2018 at 17:07)</a>:</h4>
<p>ok. let me fetch</p>



<a name="132929280"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353394%20do%20%60move_outs%60%20computation%20lazilly/near/132929280" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353394.20do.20.60move_outs.60.20computation.20lazilly.html#132929280">(Aug 28 2018 at 17:07)</a>:</h4>
<p>what I did not notice is that <a href="https://doc.rust-lang.org/nightly/nightly-rustc/rustc/?search=terminator_loc" target="_blank" title="https://doc.rust-lang.org/nightly/nightly-rustc/rustc/?search=terminator_loc">there were two other such methods</a> -- probably those should be removed but oh well</p>



<a name="132929330"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353394%20do%20%60move_outs%60%20computation%20lazilly/near/132929330" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353394.20do.20.60move_outs.60.20computation.20lazilly.html#132929330">(Aug 28 2018 at 17:08)</a>:</h4>
<p>the one I just added is so new it's not in the published rustdocs yet :)</p>



<a name="132929335"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353394%20do%20%60move_outs%60%20computation%20lazilly/near/132929335" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353394.20do.20.60move_outs.60.20computation.20lazilly.html#132929335">(Aug 28 2018 at 17:08)</a>:</h4>
<p>:)</p>



<a name="132929339"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353394%20do%20%60move_outs%60%20computation%20lazilly/near/132929339" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353394.20do.20.60move_outs.60.20computation.20lazilly.html#132929339">(Aug 28 2018 at 17:08)</a>:</h4>
<p>it's a method on the <code>mir</code>, so you would do <code>mir.terminator_loc(bb)</code></p>



<a name="132929350"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353394%20do%20%60move_outs%60%20computation%20lazilly/near/132929350" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353394.20do.20.60move_outs.60.20computation.20lazilly.html#132929350">(Aug 28 2018 at 17:09)</a>:</h4>
<p>(this is because it has to access the data from the basic block that is stored in the MIR to know the index of the terminator)</p>



<a name="132929380"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353394%20do%20%60move_outs%60%20computation%20lazilly/near/132929380" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353394.20do.20.60move_outs.60.20computation.20lazilly.html#132929380">(Aug 28 2018 at 17:09)</a>:</h4>
<p>you're talking about statement_index == 0 case, right?</p>



<a name="132929474"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353394%20do%20%60move_outs%60%20computation%20lazilly/near/132929474" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353394.20do.20.60move_outs.60.20computation.20lazilly.html#132929474">(Aug 28 2018 at 17:10)</a>:</h4>
<p>yes</p>



<a name="132929479"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353394%20do%20%60move_outs%60%20computation%20lazilly/near/132929479" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353394.20do.20.60move_outs.60.20computation.20lazilly.html#132929479">(Aug 28 2018 at 17:10)</a>:</h4>
<p>well, sort of :)</p>



<a name="132929487"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353394%20do%20%60move_outs%60%20computation%20lazilly/near/132929487" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353394.20do.20.60move_outs.60.20computation.20lazilly.html#132929487">(Aug 28 2018 at 17:11)</a>:</h4>
<p>that is, when we are finding the pred's of a location whose <code>statement_index</code> is 0</p>



<a name="132929496"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353394%20do%20%60move_outs%60%20computation%20lazilly/near/132929496" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353394.20do.20.60move_outs.60.20computation.20lazilly.html#132929496">(Aug 28 2018 at 17:11)</a>:</h4>
<p>in that case, we want to push the terminator location from each predecessor block</p>



<a name="132929499"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353394%20do%20%60move_outs%60%20computation%20lazilly/near/132929499" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353394.20do.20.60move_outs.60.20computation.20lazilly.html#132929499">(Aug 28 2018 at 17:11)</a>:</h4>
<p>the <code>predecessors_for(BasicBlock)</code> method gives the pred basic blocks</p>



<a name="132929504"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353394%20do%20%60move_outs%60%20computation%20lazilly/near/132929504" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353394.20do.20.60move_outs.60.20computation.20lazilly.html#132929504">(Aug 28 2018 at 17:11)</a>:</h4>
<p>and the <code>terminator_loc</code> converts that to a <code>Location</code></p>



<a name="132929576"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353394%20do%20%60move_outs%60%20computation%20lazilly/near/132929576" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353394.20do.20.60move_outs.60.20computation.20lazilly.html#132929576">(Aug 28 2018 at 17:13)</a>:</h4>
<p>ok, it's pretty clear to me now what I don't follow :)</p>



<a name="132929620"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353394%20do%20%60move_outs%60%20computation%20lazilly/near/132929620" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353394.20do.20.60move_outs.60.20computation.20lazilly.html#132929620">(Aug 28 2018 at 17:14)</a>:</h4>
<p>why do we want from a regular basic block to ger the terminator loc and not all the locations?</p>



<a name="132929627"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353394%20do%20%60move_outs%60%20computation%20lazilly/near/132929627" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353394.20do.20.60move_outs.60.20computation.20lazilly.html#132929627">(Aug 28 2018 at 17:14)</a>:</h4>
<p>I see that in the case statement_index == 0</p>



<a name="132929634"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353394%20do%20%60move_outs%60%20computation%20lazilly/near/132929634" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353394.20do.20.60move_outs.60.20computation.20lazilly.html#132929634">(Aug 28 2018 at 17:14)</a>:</h4>
<p>don't follow why we want to do that in the rest of the cases</p>



<a name="132929682"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353394%20do%20%60move_outs%60%20computation%20lazilly/near/132929682" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353394.20do.20.60move_outs.60.20computation.20lazilly.html#132929682">(Aug 28 2018 at 17:15)</a>:</h4>
<blockquote>
<p>don't follow why we want to do that in the rest of the cases</p>
</blockquote>
<p>I don't understand this</p>



<a name="132929686"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353394%20do%20%60move_outs%60%20computation%20lazilly/near/132929686" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353394.20do.20.60move_outs.60.20computation.20lazilly.html#132929686">(Aug 28 2018 at 17:16)</a>:</h4>
<p>we're <em>not</em> doing that in the other cases?</p>



<a name="132929732"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353394%20do%20%60move_outs%60%20computation%20lazilly/near/132929732" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353394.20do.20.60move_outs.60.20computation.20lazilly.html#132929732">(Aug 28 2018 at 17:16)</a>:</h4>
<p>to expand on your pseudo-code:</p>



<a name="132929743"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353394%20do%20%60move_outs%60%20computation%20lazilly/near/132929743" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353394.20do.20.60move_outs.60.20computation.20lazilly.html#132929743">(Aug 28 2018 at 17:16)</a>:</h4>
<p>this is what I'm doing ...</p>



<a name="132929744"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353394%20do%20%60move_outs%60%20computation%20lazilly/near/132929744" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353394.20do.20.60move_outs.60.20computation.20lazilly.html#132929744">(Aug 28 2018 at 17:16)</a>:</h4>
<div class="codehilite"><pre><span></span><span class="w">    </span><span class="cp">#[inline]</span><span class="w"></span>
<span class="w">    </span><span class="k">pub</span><span class="w"> </span><span class="k">fn</span> <span class="nf">predecessor_locations</span><span class="p">(</span><span class="o">&amp;</span><span class="bp">self</span><span class="p">,</span><span class="w"> </span><span class="n">loc</span>: <span class="nc">Location</span><span class="p">)</span><span class="w"> </span>-&gt; <span class="nc">impl</span><span class="w"> </span><span class="nb">Iterator</span><span class="o">&lt;</span><span class="n">Item</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">&amp;</span><span class="n">Location</span><span class="o">&gt;</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="n">loc</span><span class="p">.</span><span class="n">statement_index</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">            </span><span class="n">vec</span><span class="o">!</span><span class="p">[</span><span class="bp">self</span><span class="p">.</span><span class="n">terminator_loc</span><span class="p">(</span><span class="n">loc</span><span class="p">.</span><span class="n">block</span><span class="p">)].</span><span class="n">iter</span><span class="p">()</span><span class="w"></span>
<span class="w">        </span><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">            </span><span class="bp">self</span><span class="p">.</span><span class="n">predecessors_for</span><span class="p">(</span><span class="n">loc</span><span class="p">.</span><span class="n">block</span><span class="p">).</span><span class="n">flat_map</span><span class="p">(</span><span class="o">|</span><span class="n">bb</span><span class="o">|</span><span class="w"> </span><span class="n">bb</span><span class="p">.</span><span class="n">locations</span><span class="p">).</span><span class="n">iter</span><span class="p">()</span><span class="w"></span>
<span class="w">        </span><span class="p">}</span><span class="w"></span>
<span class="w">    </span><span class="p">}</span><span class="w"></span>
</pre></div>



<a name="132929745"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353394%20do%20%60move_outs%60%20computation%20lazilly/near/132929745" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353394.20do.20.60move_outs.60.20computation.20lazilly.html#132929745">(Aug 28 2018 at 17:16)</a>:</h4>
<div class="codehilite"><pre><span></span><span class="w"> </span><span class="k">pub</span><span class="w"> </span><span class="k">fn</span> <span class="nf">predecessor_locations</span><span class="p">(</span><span class="o">&amp;</span><span class="bp">self</span><span class="p">,</span><span class="w"> </span><span class="n">loc</span>: <span class="nc">Location</span><span class="p">)</span><span class="w"> </span>-&gt; <span class="nc">impl</span><span class="w"> </span><span class="nb">Iterator</span><span class="o">&lt;</span><span class="n">Item</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Location</span><span class="o">&gt;</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="n">loc</span><span class="p">.</span><span class="n">statement_index</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">            </span><span class="bp">self</span><span class="p">.</span><span class="n">predecessors_for</span><span class="p">(</span><span class="n">loc</span><span class="p">.</span><span class="n">block</span><span class="p">).</span><span class="n">into</span><span class="p">().</span><span class="n">map</span><span class="p">(</span><span class="k">move</span><span class="w"> </span><span class="o">|</span><span class="n">basic_block</span><span class="o">|</span><span class="w"> </span><span class="bp">self</span><span class="p">.</span><span class="n">terminator_loc</span><span class="p">(</span><span class="n">basic_block</span><span class="p">))</span><span class="w"></span>
<span class="w">        </span><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">            </span><span class="n">vec</span><span class="o">!</span><span class="p">[</span><span class="n">Location</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">block</span>: <span class="nc">loc</span><span class="p">.</span><span class="n">block</span><span class="p">,</span><span class="w"> </span><span class="n">statement_index</span>: <span class="nc">loc</span><span class="p">.</span><span class="n">statement_index</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="p">}].</span><span class="n">iter</span><span class="p">()</span><span class="w"></span>
<span class="w">        </span><span class="p">}</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>
</pre></div>



<a name="132929768"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353394%20do%20%60move_outs%60%20computation%20lazilly/near/132929768" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353394.20do.20.60move_outs.60.20computation.20lazilly.html#132929768">(Aug 28 2018 at 17:16)</a>:</h4>
<p>yes so that is exactly backwards the way you have it :)</p>



<a name="132929784"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353394%20do%20%60move_outs%60%20computation%20lazilly/near/132929784" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353394.20do.20.60move_outs.60.20computation.20lazilly.html#132929784">(Aug 28 2018 at 17:17)</a>:</h4>
<p>think of the graph</p>



<a name="132929796"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353394%20do%20%60move_outs%60%20computation%20lazilly/near/132929796" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353394.20do.20.60move_outs.60.20computation.20lazilly.html#132929796">(Aug 28 2018 at 17:17)</a>:</h4>
<p>yes</p>



<a name="132929799"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353394%20do%20%60move_outs%60%20computation%20lazilly/near/132929799" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353394.20do.20.60move_outs.60.20computation.20lazilly.html#132929799">(Aug 28 2018 at 17:17)</a>:</h4>
<p>makes sense</p>



<a name="132929802"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353394%20do%20%60move_outs%60%20computation%20lazilly/near/132929802" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353394.20do.20.60move_outs.60.20computation.20lazilly.html#132929802">(Aug 28 2018 at 17:17)</a>:</h4>
<p>hehe</p>



<a name="132929803"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353394%20do%20%60move_outs%60%20computation%20lazilly/near/132929803" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353394.20do.20.60move_outs.60.20computation.20lazilly.html#132929803">(Aug 28 2018 at 17:17)</a>:</h4>
<p>I understand why</p>



<a name="132929804"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353394%20do%20%60move_outs%60%20computation%20lazilly/near/132929804" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353394.20do.20.60move_outs.60.20computation.20lazilly.html#132929804">(Aug 28 2018 at 17:17)</a>:</h4>
<p>you have e.g.</p>
<div class="codehilite"><pre><span></span>BB0 {
    statement 0
    statement 1
    statement 2
    terminator: goto BB1, ...
}

BB1 {
  statement 0
  statement 1
  ...
}
</pre></div>



<a name="132929843"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353394%20do%20%60move_outs%60%20computation%20lazilly/near/132929843" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353394.20do.20.60move_outs.60.20computation.20lazilly.html#132929843">(Aug 28 2018 at 17:18)</a>:</h4>
<p>here, the predecessor of BB1/1 is BB1/0</p>



<a name="132929856"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353394%20do%20%60move_outs%60%20computation%20lazilly/near/132929856" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353394.20do.20.60move_outs.60.20computation.20lazilly.html#132929856">(Aug 28 2018 at 17:18)</a>:</h4>
<p>the predecessor of BB1/0 is BB0/3 (terminator of BB0)</p>



<a name="132929863"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353394%20do%20%60move_outs%60%20computation%20lazilly/near/132929863" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353394.20do.20.60move_outs.60.20computation.20lazilly.html#132929863">(Aug 28 2018 at 17:18)</a>:</h4>
<p>there's only one parent in statements that are not 0</p>



<a name="132929867"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353394%20do%20%60move_outs%60%20computation%20lazilly/near/132929867" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353394.20do.20.60move_outs.60.20computation.20lazilly.html#132929867">(Aug 28 2018 at 17:18)</a>:</h4>
<p>predecessor of BB0/3 is BB0/2 etc</p>



<a name="132929880"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353394%20do%20%60move_outs%60%20computation%20lazilly/near/132929880" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353394.20do.20.60move_outs.60.20computation.20lazilly.html#132929880">(Aug 28 2018 at 17:18)</a>:</h4>
<blockquote>
<p>there's only one parent in statements that are not 0</p>
</blockquote>
<p>yes</p>



<a name="132929989"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353394%20do%20%60move_outs%60%20computation%20lazilly/near/132929989" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353394.20do.20.60move_outs.60.20computation.20lazilly.html#132929989">(Aug 28 2018 at 17:20)</a>:</h4>
<blockquote>
<div class="codehilite"><pre><span></span><span class="w"> </span><span class="k">pub</span><span class="w"> </span><span class="k">fn</span> <span class="nf">predecessor_locations</span><span class="p">(</span><span class="o">&amp;</span><span class="bp">self</span><span class="p">,</span><span class="w"> </span><span class="n">loc</span>: <span class="nc">Location</span><span class="p">)</span><span class="w"> </span>-&gt; <span class="nc">impl</span><span class="w"> </span><span class="nb">Iterator</span><span class="o">&lt;</span><span class="n">Item</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Location</span><span class="o">&gt;</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="n">loc</span><span class="p">.</span><span class="n">statement_index</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">            </span><span class="bp">self</span><span class="p">.</span><span class="n">predecessors_for</span><span class="p">(</span><span class="n">loc</span><span class="p">.</span><span class="n">block</span><span class="p">).</span><span class="n">into</span><span class="p">().</span><span class="n">map</span><span class="p">(</span><span class="k">move</span><span class="w"> </span><span class="o">|</span><span class="n">basic_block</span><span class="o">|</span><span class="w"> </span><span class="bp">self</span><span class="p">.</span><span class="n">terminator_loc</span><span class="p">(</span><span class="n">basic_block</span><span class="p">))</span><span class="w"></span>
<span class="w">        </span><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">            </span><span class="n">vec</span><span class="o">!</span><span class="p">[</span><span class="n">Location</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">block</span>: <span class="nc">loc</span><span class="p">.</span><span class="n">block</span><span class="p">,</span><span class="w"> </span><span class="n">statement_index</span>: <span class="nc">loc</span><span class="p">.</span><span class="n">statement_index</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="p">}].</span><span class="n">iter</span><span class="p">()</span><span class="w"></span>
<span class="w">        </span><span class="p">}</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>
</pre></div>


</blockquote>
<p>what do you want to do there with the into and map?</p>



<a name="132930010"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353394%20do%20%60move_outs%60%20computation%20lazilly/near/132930010" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353394.20do.20.60move_outs.60.20computation.20lazilly.html#132930010">(Aug 28 2018 at 17:20)</a>:</h4>
<p>that's kind of a flat map or what's the intention?</p>



<a name="132930116"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353394%20do%20%60move_outs%60%20computation%20lazilly/near/132930116" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353394.20do.20.60move_outs.60.20computation.20lazilly.html#132930116">(Aug 28 2018 at 17:22)</a>:</h4>
<p>er sorry I meant to do <code>iter()</code> -- or maybe <code>into_iter</code></p>



<a name="132930122"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353394%20do%20%60move_outs%60%20computation%20lazilly/near/132930122" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353394.20do.20.60move_outs.60.20computation.20lazilly.html#132930122">(Aug 28 2018 at 17:22)</a>:</h4>
<p>it is not a flat map</p>



<a name="132930125"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353394%20do%20%60move_outs%60%20computation%20lazilly/near/132930125" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353394.20do.20.60move_outs.60.20computation.20lazilly.html#132930125">(Aug 28 2018 at 17:22)</a>:</h4>
<p>it is a map</p>



<a name="132930129"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353394%20do%20%60move_outs%60%20computation%20lazilly/near/132930129" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353394.20do.20.60move_outs.60.20computation.20lazilly.html#132930129">(Aug 28 2018 at 17:22)</a>:</h4>
<p>for each predecessor block, there is exactly 1 terminator location</p>



<a name="132930143"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353394%20do%20%60move_outs%60%20computation%20lazilly/near/132930143" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353394.20do.20.60move_outs.60.20computation.20lazilly.html#132930143">(Aug 28 2018 at 17:22)</a>:</h4>
<p>converting this into an <code>impl Iterator</code> might be annoying because of lifetime issues</p>



<a name="132930152"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353394%20do%20%60move_outs%60%20computation%20lazilly/near/132930152" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353394.20do.20.60move_outs.60.20computation.20lazilly.html#132930152">(Aug 28 2018 at 17:23)</a>:</h4>
<p>I hate the way we use a ref-cell here</p>



<a name="132930157"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353394%20do%20%60move_outs%60%20computation%20lazilly/near/132930157" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353394.20do.20.60move_outs.60.20computation.20lazilly.html#132930157">(Aug 28 2018 at 17:23)</a>:</h4>
<p>ya</p>



<a name="132930173"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353394%20do%20%60move_outs%60%20computation%20lazilly/near/132930173" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353394.20do.20.60move_outs.60.20computation.20lazilly.html#132930173">(Aug 28 2018 at 17:23)</a>:</h4>
<p>though the obvious alternatives aren't much better</p>



<a name="132930246"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353394%20do%20%60move_outs%60%20computation%20lazilly/near/132930246" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353394.20do.20.60move_outs.60.20computation.20lazilly.html#132930246">(Aug 28 2018 at 17:24)</a>:</h4>
<p>so one thing that is easy to do is to convert this to a closure callback setup</p>



<a name="132930263"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353394%20do%20%60move_outs%60%20computation%20lazilly/near/132930263" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353394.20do.20.60move_outs.60.20computation.20lazilly.html#132930263">(Aug 28 2018 at 17:24)</a>:</h4>
<p>sorry, to be clear, what I am concerned about is the return type of the existing <code>predecessors_for</code> method:</p>



<a name="132930264"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353394%20do%20%60move_outs%60%20computation%20lazilly/near/132930264" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353394.20do.20.60move_outs.60.20computation.20lazilly.html#132930264">(Aug 28 2018 at 17:24)</a>:</h4>
<p><a href="https://doc.rust-lang.org/nightly/nightly-rustc/rustc/mir/struct.Mir.html#method.predecessors_for" target="_blank" title="https://doc.rust-lang.org/nightly/nightly-rustc/rustc/mir/struct.Mir.html#method.predecessors_for">https://doc.rust-lang.org/nightly/nightly-rustc/rustc/mir/struct.Mir.html#method.predecessors_for</a></p>



<a name="132930274"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353394%20do%20%60move_outs%60%20computation%20lazilly/near/132930274" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353394.20do.20.60move_outs.60.20computation.20lazilly.html#132930274">(Aug 28 2018 at 17:25)</a>:</h4>
<p>which is actually a <code>Ref&lt;'_, Vec&lt;BasicBlock&gt;&gt;</code> (the rustdoc is a bit confusing on this point)</p>



<a name="132930292"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353394%20do%20%60move_outs%60%20computation%20lazilly/near/132930292" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353394.20do.20.60move_outs.60.20computation.20lazilly.html#132930292">(Aug 28 2018 at 17:25)</a>:</h4>
<p>this means that this <code>Ref</code> value is owned by the caller -- so you can't invoke <code>iter()</code> and return that to the caller</p>



<a name="132930310"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353394%20do%20%60move_outs%60%20computation%20lazilly/near/132930310" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353394.20do.20.60move_outs.60.20computation.20lazilly.html#132930310">(Aug 28 2018 at 17:25)</a>:</h4>
<p>since <code>iter</code> will borrow the <code>Ref</code>, and then you are trying to return that borrow longer than the <code>Ref</code> exists</p>



<a name="132930363"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353394%20do%20%60move_outs%60%20computation%20lazilly/near/132930363" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353394.20do.20.60move_outs.60.20computation.20lazilly.html#132930363">(Aug 28 2018 at 17:26)</a>:</h4>
<p>hmmm</p>



<a name="132930369"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353394%20do%20%60move_outs%60%20computation%20lazilly/near/132930369" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353394.20do.20.60move_outs.60.20computation.20lazilly.html#132930369">(Aug 28 2018 at 17:26)</a>:</h4>
<p>was trying stuff and seeing errors already :)</p>



<a name="132930380"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353394%20do%20%60move_outs%60%20computation%20lazilly/near/132930380" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353394.20do.20.60move_outs.60.20computation.20lazilly.html#132930380">(Aug 28 2018 at 17:26)</a>:</h4>
<p>error[E0308]: if and else have incompatible types</p>



<a name="132930384"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353394%20do%20%60move_outs%60%20computation%20lazilly/near/132930384" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353394.20do.20.60move_outs.60.20computation.20lazilly.html#132930384">(Aug 28 2018 at 17:26)</a>:</h4>
<p>well, that's a separate problem</p>



<a name="132930387"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353394%20do%20%60move_outs%60%20computation%20lazilly/near/132930387" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353394.20do.20.60move_outs.60.20computation.20lazilly.html#132930387">(Aug 28 2018 at 17:26)</a>:</h4>
<p>and an easier one to overcome</p>



<a name="132930407"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353394%20do%20%60move_outs%60%20computation%20lazilly/near/132930407" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353394.20do.20.60move_outs.60.20computation.20lazilly.html#132930407">(Aug 28 2018 at 17:27)</a>:</h4>
<p>the problem there is that you are returning an <code>impl Iterator</code> -- that must be a single iterator type</p>



<a name="132930408"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353394%20do%20%60move_outs%60%20computation%20lazilly/near/132930408" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353394.20do.20.60move_outs.60.20computation.20lazilly.html#132930408">(Aug 28 2018 at 17:27)</a>:</h4>
<p>so the if/else can't have two options</p>



<a name="132930412"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353394%20do%20%60move_outs%60%20computation%20lazilly/near/132930412" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353394.20do.20.60move_outs.60.20computation.20lazilly.html#132930412">(Aug 28 2018 at 17:27)</a>:</h4>
<p>the usual way to fix that is to "concatenate" the two iterators</p>



<a name="132930417"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353394%20do%20%60move_outs%60%20computation%20lazilly/near/132930417" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353394.20do.20.60move_outs.60.20computation.20lazilly.html#132930417">(Aug 28 2018 at 17:27)</a>:</h4>
<p>I should write something about this</p>



<a name="132930470"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353394%20do%20%60move_outs%60%20computation%20lazilly/near/132930470" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353394.20do.20.60move_outs.60.20computation.20lazilly.html#132930470">(Aug 28 2018 at 17:28)</a>:</h4>
<p>I guess I haven't seen that trick that often</p>



<a name="132930471"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353394%20do%20%60move_outs%60%20computation%20lazilly/near/132930471" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353394.20do.20.60move_outs.60.20computation.20lazilly.html#132930471">(Aug 28 2018 at 17:28)</a>:</h4>
<p>/me is finding lots of good Intermediate Rust blog topics</p>



<a name="132930481"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353394%20do%20%60move_outs%60%20computation%20lazilly/near/132930481" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353394.20do.20.60move_outs.60.20computation.20lazilly.html#132930481">(Aug 28 2018 at 17:28)</a>:</h4>
<p>so I can explain it,</p>



<a name="132930483"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353394%20do%20%60move_outs%60%20computation%20lazilly/near/132930483" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353394.20do.20.60move_outs.60.20computation.20lazilly.html#132930483">(Aug 28 2018 at 17:28)</a>:</h4>
<p>but the problem is that the first half</p>



<a name="132930485"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353394%20do%20%60move_outs%60%20computation%20lazilly/near/132930485" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353394.20do.20.60move_outs.60.20computation.20lazilly.html#132930485">(Aug 28 2018 at 17:28)</a>:</h4>
<p>isn't going to work</p>



<a name="132930489"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353394%20do%20%60move_outs%60%20computation%20lazilly/near/132930489" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353394.20do.20.60move_outs.60.20computation.20lazilly.html#132930489">(Aug 28 2018 at 17:28)</a>:</h4>
<p>in this particular case</p>



<a name="132930493"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353394%20do%20%60move_outs%60%20computation%20lazilly/near/132930493" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353394.20do.20.60move_outs.60.20computation.20lazilly.html#132930493">(Aug 28 2018 at 17:28)</a>:</h4>
<p>unless you clone the vector  :)</p>



<a name="132930504"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353394%20do%20%60move_outs%60%20computation%20lazilly/near/132930504" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353394.20do.20.60move_outs.60.20computation.20lazilly.html#132930504">(Aug 28 2018 at 17:28)</a>:</h4>
<p>I understand that I have two different iterators and that's wrong</p>



<a name="132930508"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353394%20do%20%60move_outs%60%20computation%20lazilly/near/132930508" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353394.20do.20.60move_outs.60.20computation.20lazilly.html#132930508">(Aug 28 2018 at 17:28)</a>:</h4>
<blockquote>
<p>unless you clone the vector  :)</p>
</blockquote>
<p>yeah, hehe</p>



<a name="132930517"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353394%20do%20%60move_outs%60%20computation%20lazilly/near/132930517" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353394.20do.20.60move_outs.60.20computation.20lazilly.html#132930517">(Aug 28 2018 at 17:29)</a>:</h4>
<p>if you want I can show you how to do it that way</p>



<a name="132930526"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353394%20do%20%60move_outs%60%20computation%20lazilly/near/132930526" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353394.20do.20.60move_outs.60.20computation.20lazilly.html#132930526">(Aug 28 2018 at 17:29)</a>:</h4>
<p>I don't understand what you mean by concatenating iterators</p>



<a name="132930531"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353394%20do%20%60move_outs%60%20computation%20lazilly/near/132930531" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353394.20do.20.60move_outs.60.20computation.20lazilly.html#132930531">(Aug 28 2018 at 17:29)</a>:</h4>
<p>we can validate that it fixes the problem anyway</p>



<a name="132930533"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353394%20do%20%60move_outs%60%20computation%20lazilly/near/132930533" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353394.20do.20.60move_outs.60.20computation.20lazilly.html#132930533">(Aug 28 2018 at 17:29)</a>:</h4>
<p>yes</p>



<a name="132930544"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353394%20do%20%60move_outs%60%20computation%20lazilly/near/132930544" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353394.20do.20.60move_outs.60.20computation.20lazilly.html#132930544">(Aug 28 2018 at 17:29)</a>:</h4>
<p>ok so</p>



<a name="132930559"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353394%20do%20%60move_outs%60%20computation%20lazilly/near/132930559" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353394.20do.20.60move_outs.60.20computation.20lazilly.html#132930559">(Aug 28 2018 at 17:29)</a>:</h4>
<p>the idea would be something like this</p>



<a name="132930726"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353394%20do%20%60move_outs%60%20computation%20lazilly/near/132930726" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353394.20do.20.60move_outs.60.20computation.20lazilly.html#132930726">(Aug 28 2018 at 17:31)</a>:</h4>
<div class="codehilite"><pre><span></span><span class="w"> </span><span class="k">pub</span><span class="w"> </span><span class="k">fn</span> <span class="nf">predecessor_locations</span><span class="p">(</span><span class="o">&amp;</span><span class="bp">self</span><span class="p">,</span><span class="w"> </span><span class="n">loc</span>: <span class="nc">Location</span><span class="p">)</span><span class="w"> </span>-&gt; <span class="nc">impl</span><span class="w"> </span><span class="nb">Iterator</span><span class="o">&lt;</span><span class="n">Item</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Location</span><span class="o">&gt;</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="na">&#39;_</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">        </span><span class="kd">let</span><span class="w"> </span><span class="n">if_zero_locations</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="n">loc</span><span class="p">.</span><span class="n">statement_index</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">            </span><span class="kd">let</span><span class="w"> </span><span class="n">predecessor_blocks</span>: <span class="nb">Vec</span><span class="o">&lt;</span><span class="n">BasicBlock</span><span class="o">&gt;</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="bp">self</span><span class="p">.</span><span class="n">predecessors_for</span><span class="p">(</span><span class="n">loc</span><span class="p">.</span><span class="n">block</span><span class="p">).</span><span class="n">clone</span><span class="p">();</span><span class="w"></span>
<span class="w">            </span><span class="nb">Some</span><span class="p">(</span><span class="n">predecessor_blocks</span><span class="p">.</span><span class="n">into_iter</span><span class="p">().</span><span class="n">map</span><span class="p">(</span><span class="k">move</span><span class="w"> </span><span class="o">|</span><span class="n">basic_block</span><span class="o">|</span><span class="w"> </span><span class="bp">self</span><span class="p">.</span><span class="n">terminator_loc</span><span class="p">(</span><span class="n">basic_block</span><span class="p">)))</span><span class="w"></span>
<span class="w">        </span><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">            </span><span class="nb">None</span><span class="w"></span>
<span class="w">        </span><span class="p">};</span><span class="w"></span>

<span class="w">        </span><span class="kd">let</span><span class="w"> </span><span class="n">if_not_zero_locations</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="n">loc</span><span class="p">.</span><span class="n">statement_index</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">            </span><span class="nb">None</span><span class="w"></span>
<span class="w">        </span><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">            </span><span class="nb">Some</span><span class="p">(</span><span class="n">Location</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">block</span>: <span class="nc">loc</span><span class="p">.</span><span class="n">block</span><span class="p">,</span><span class="w"> </span><span class="n">statement_index</span>: <span class="nc">loc</span><span class="p">.</span><span class="n">statement_index</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="p">})</span><span class="w"></span>
<span class="w">        </span><span class="p">};</span><span class="w"></span>

<span class="w">        </span><span class="n">if_zero_locations</span><span class="p">.</span><span class="n">into_iter</span><span class="p">().</span><span class="n">flatten</span><span class="p">().</span><span class="n">chain</span><span class="p">(</span><span class="n">if_not_zero_locations</span><span class="p">)</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>
</pre></div>



<a name="132930740"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353394%20do%20%60move_outs%60%20computation%20lazilly/near/132930740" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353394.20do.20.60move_outs.60.20computation.20lazilly.html#132930740">(Aug 28 2018 at 17:32)</a>:</h4>
<p>note the final return value:</p>



<a name="132930781"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353394%20do%20%60move_outs%60%20computation%20lazilly/near/132930781" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353394.20do.20.60move_outs.60.20computation.20lazilly.html#132930781">(Aug 28 2018 at 17:32)</a>:</h4>
<p>it is always the same, no matter what</p>



<a name="132930784"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353394%20do%20%60move_outs%60%20computation%20lazilly/near/132930784" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353394.20do.20.60move_outs.60.20computation.20lazilly.html#132930784">(Aug 28 2018 at 17:32)</a>:</h4>
<p>it's the combination of two iterators</p>



<a name="132930790"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353394%20do%20%60move_outs%60%20computation%20lazilly/near/132930790" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353394.20do.20.60move_outs.60.20computation.20lazilly.html#132930790">(Aug 28 2018 at 17:32)</a>:</h4>
<p>but in practice one or the other will be empty</p>



<a name="132930805"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353394%20do%20%60move_outs%60%20computation%20lazilly/near/132930805" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353394.20do.20.60move_outs.60.20computation.20lazilly.html#132930805">(Aug 28 2018 at 17:32)</a>:</h4>
<p>in the case of <code>statement_index == 0</code>, we return a <code>Some(I)</code> where <code>I</code> is some iterator of locations</p>



<a name="132930814"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353394%20do%20%60move_outs%60%20computation%20lazilly/near/132930814" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353394.20do.20.60move_outs.60.20computation.20lazilly.html#132930814">(Aug 28 2018 at 17:32)</a>:</h4>
<p>in the case of <code>statement_index &gt; 0</code>, we return a <code>Some(L)</code> for the pred loc (and <code>None</code> otherwise)</p>



<a name="132930833"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353394%20do%20%60move_outs%60%20computation%20lazilly/near/132930833" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353394.20do.20.60move_outs.60.20computation.20lazilly.html#132930833">(Aug 28 2018 at 17:33)</a>:</h4>
<p>another simpler way to do it might be</p>



<a name="132930834"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353394%20do%20%60move_outs%60%20computation%20lazilly/near/132930834" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353394.20do.20.60move_outs.60.20computation.20lazilly.html#132930834">(Aug 28 2018 at 17:33)</a>:</h4>
<p>I see</p>



<a name="132930835"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353394%20do%20%60move_outs%60%20computation%20lazilly/near/132930835" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353394.20do.20.60move_outs.60.20computation.20lazilly.html#132930835">(Aug 28 2018 at 17:33)</a>:</h4>
<p>well anyway</p>



<a name="132930837"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353394%20do%20%60move_outs%60%20computation%20lazilly/near/132930837" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353394.20do.20.60move_outs.60.20computation.20lazilly.html#132930837">(Aug 28 2018 at 17:33)</a>:</h4>
<p>that's the idea :)</p>



<a name="132930843"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353394%20do%20%60move_outs%60%20computation%20lazilly/near/132930843" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353394.20do.20.60move_outs.60.20computation.20lazilly.html#132930843">(Aug 28 2018 at 17:33)</a>:</h4>
<p>:)</p>



<a name="132930845"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353394%20do%20%60move_outs%60%20computation%20lazilly/near/132930845" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353394.20do.20.60move_outs.60.20computation.20lazilly.html#132930845">(Aug 28 2018 at 17:33)</a>:</h4>
<p>(you can also use the <code>Either</code> crate)</p>



<a name="132930852"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353394%20do%20%60move_outs%60%20computation%20lazilly/near/132930852" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353394.20do.20.60move_outs.60.20computation.20lazilly.html#132930852">(Aug 28 2018 at 17:33)</a>:</h4>
<p>yep</p>



<a name="132930866"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353394%20do%20%60move_outs%60%20computation%20lazilly/near/132930866" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353394.20do.20.60move_outs.60.20computation.20lazilly.html#132930866">(Aug 28 2018 at 17:33)</a>:</h4>
<p>which would look like</p>
<div class="codehilite"><pre><span></span><span class="k">fn</span> <span class="nf">fo</span><span class="p">()</span><span class="w"> </span>-&gt; <span class="nc">impl</span><span class="w"> </span><span class="nb">Iterator</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="n">something</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">Either</span>::<span class="n">Left</span><span class="p">(...)</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">Either</span>::<span class="n">Right</span><span class="p">(...)</span><span class="w"> </span><span class="p">}</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>
</pre></div>



<a name="132930872"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353394%20do%20%60move_outs%60%20computation%20lazilly/near/132930872" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353394.20do.20.60move_outs.60.20computation.20lazilly.html#132930872">(Aug 28 2018 at 17:33)</a>:</h4>
<p>do you want me to try this or just switch directly to the callbacks idea</p>



<a name="132930919"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353394%20do%20%60move_outs%60%20computation%20lazilly/near/132930919" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353394.20do.20.60move_outs.60.20computation.20lazilly.html#132930919">(Aug 28 2018 at 17:34)</a>:</h4>
<p>with this I mean, the code, the Either crate, which I've already used in rustc</p>



<a name="132930926"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353394%20do%20%60move_outs%60%20computation%20lazilly/near/132930926" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353394.20do.20.60move_outs.60.20computation.20lazilly.html#132930926">(Aug 28 2018 at 17:34)</a>:</h4>
<p>I'd probably do the callabcks</p>



<a name="132930931"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353394%20do%20%60move_outs%60%20computation%20lazilly/near/132930931" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353394.20do.20.60move_outs.60.20computation.20lazilly.html#132930931">(Aug 28 2018 at 17:34)</a>:</h4>
<p>cloning the vector seems silly</p>



<a name="132930937"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353394%20do%20%60move_outs%60%20computation%20lazilly/near/132930937" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353394.20do.20.60move_outs.60.20computation.20lazilly.html#132930937">(Aug 28 2018 at 17:34)</a>:</h4>
<p>ok</p>



<a name="132930939"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353394%20do%20%60move_outs%60%20computation%20lazilly/near/132930939" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353394.20do.20.60move_outs.60.20computation.20lazilly.html#132930939">(Aug 28 2018 at 17:34)</a>:</h4>
<p>but it's annoying</p>



<a name="132930950"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353394%20do%20%60move_outs%60%20computation%20lazilly/near/132930950" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353394.20do.20.60move_outs.60.20computation.20lazilly.html#132930950">(Aug 28 2018 at 17:34)</a>:</h4>
<p>I'm pondering if there is anyway to fix that :)</p>



<a name="132930958"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353394%20do%20%60move_outs%60%20computation%20lazilly/near/132930958" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353394.20do.20.60move_outs.60.20computation.20lazilly.html#132930958">(Aug 28 2018 at 17:34)</a>:</h4>
<p>besides refactoring how <code>predecessors_for</code> works</p>



<a name="132930965"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353394%20do%20%60move_outs%60%20computation%20lazilly/near/132930965" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353394.20do.20.60move_outs.60.20computation.20lazilly.html#132930965">(Aug 28 2018 at 17:34)</a>:</h4>
<p>which — although I've wanted to do it for a while — seems out of scope =)</p>



<a name="132931000"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353394%20do%20%60move_outs%60%20computation%20lazilly/near/132931000" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353394.20do.20.60move_outs.60.20computation.20lazilly.html#132931000">(Aug 28 2018 at 17:35)</a>:</h4>
<p>I'm ok to do whatever you prefer :)</p>



<a name="132931051"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353394%20do%20%60move_outs%60%20computation%20lazilly/near/132931051" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353394.20do.20.60move_outs.60.20computation.20lazilly.html#132931051">(Aug 28 2018 at 17:36)</a>:</h4>
<p>part of the problem is I don't know what I would refactor to =)</p>



<a name="132931075"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353394%20do%20%60move_outs%60%20computation%20lazilly/near/132931075" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353394.20do.20.60move_outs.60.20computation.20lazilly.html#132931075">(Aug 28 2018 at 17:36)</a>:</h4>
<p>I think you should do the callback variant</p>



<a name="132931082"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353394%20do%20%60move_outs%60%20computation%20lazilly/near/132931082" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353394.20do.20.60move_outs.60.20computation.20lazilly.html#132931082">(Aug 28 2018 at 17:37)</a>:</h4>
<p>seems easiest for now</p>



<a name="132931100"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353394%20do%20%60move_outs%60%20computation%20lazilly/near/132931100" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353394.20do.20.60move_outs.60.20computation.20lazilly.html#132931100">(Aug 28 2018 at 17:37)</a>:</h4>
<p>er well ok so</p>



<a name="132931115"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353394%20do%20%60move_outs%60%20computation%20lazilly/near/132931115" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353394.20do.20.60move_outs.60.20computation.20lazilly.html#132931115">(Aug 28 2018 at 17:37)</a>:</h4>
<p>so ... you want the thing to be ...</p>



<a name="132931119"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353394%20do%20%60move_outs%60%20computation%20lazilly/near/132931119" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353394.20do.20.60move_outs.60.20computation.20lazilly.html#132931119">(Aug 28 2018 at 17:38)</a>:</h4>
<p>I think I know how you could do it</p>



<a name="132931164"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353394%20do%20%60move_outs%60%20computation%20lazilly/near/132931164" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353394.20do.20.60move_outs.60.20computation.20lazilly.html#132931164">(Aug 28 2018 at 17:38)</a>:</h4>
<p>took me a second to think  of it :)</p>



<a name="132931177"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353394%20do%20%60move_outs%60%20computation%20lazilly/near/132931177" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353394.20do.20.60move_outs.60.20computation.20lazilly.html#132931177">(Aug 28 2018 at 17:38)</a>:</h4>
<p>that is, with <code>impl Iterator</code></p>



<a name="132931188"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353394%20do%20%60move_outs%60%20computation%20lazilly/near/132931188" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353394.20do.20.60move_outs.60.20computation.20lazilly.html#132931188">(Aug 28 2018 at 17:38)</a>:</h4>
<p>ok</p>



<a name="132931189"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353394%20do%20%60move_outs%60%20computation%20lazilly/near/132931189" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353394.20do.20.60move_outs.60.20computation.20lazilly.html#132931189">(Aug 28 2018 at 17:38)</a>:</h4>
<p>something like this would work for the first case (where <code>statement_index</code> == 0)</p>



<a name="132931190"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353394%20do%20%60move_outs%60%20computation%20lazilly/near/132931190" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353394.20do.20.60move_outs.60.20computation.20lazilly.html#132931190">(Aug 28 2018 at 17:38)</a>:</h4>
<p>:)</p>



<a name="132931232"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353394%20do%20%60move_outs%60%20computation%20lazilly/near/132931232" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353394.20do.20.60move_outs.60.20computation.20lazilly.html#132931232">(Aug 28 2018 at 17:39)</a>:</h4>
<div class="codehilite"><pre><span></span><span class="kd">let</span><span class="w"> </span><span class="n">predecessor_blocks</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="bp">self</span><span class="p">.</span><span class="n">predecessors_for</span><span class="p">(</span><span class="n">loc</span><span class="p">.</span><span class="n">block</span><span class="p">);</span><span class="w"> </span><span class="c1">// returns a `Ref&lt;&#39;_, Vec&lt;BasicBlock&gt;&gt;`</span>
<span class="kd">let</span><span class="w"> </span><span class="n">num_predecessor_blocks</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">predecessor_blocks</span><span class="p">.</span><span class="n">len</span><span class="p">();</span><span class="w"></span>
<span class="p">(</span><span class="mi">0</span><span class="w"> </span><span class="p">..</span><span class="w"> </span><span class="n">num_predecessor_blocks</span><span class="p">)</span><span class="w"></span>
<span class="w">    </span><span class="p">.</span><span class="n">map</span><span class="p">(</span><span class="k">move</span><span class="w"> </span><span class="o">|</span><span class="n">i</span><span class="o">|</span><span class="w"> </span><span class="n">predecessor_blocks</span><span class="p">[</span><span class="n">i</span><span class="p">])</span><span class="w"></span>
<span class="w">    </span><span class="p">.</span><span class="n">map</span><span class="p">(</span><span class="k">move</span><span class="w"> </span><span class="o">|</span><span class="n">bb</span><span class="o">|</span><span class="w"> </span><span class="bp">self</span><span class="p">.</span><span class="n">terminator_loc</span><span class="p">(</span><span class="n">bb</span><span class="p">))</span><span class="w"></span>
</pre></div>



<a name="132931278"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353394%20do%20%60move_outs%60%20computation%20lazilly/near/132931278" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353394.20do.20.60move_outs.60.20computation.20lazilly.html#132931278">(Aug 28 2018 at 17:40)</a>:</h4>
<p>the key point here is that the closure will capture (and take ownership of) the <code>predecessor_blocks</code> value</p>



<a name="132931299"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353394%20do%20%60move_outs%60%20computation%20lazilly/near/132931299" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353394.20do.20.60move_outs.60.20computation.20lazilly.html#132931299">(Aug 28 2018 at 17:40)</a>:</h4>
<p>so it lives as long as that closure does</p>



<a name="132931304"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353394%20do%20%60move_outs%60%20computation%20lazilly/near/132931304" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353394.20do.20.60move_outs.60.20computation.20lazilly.html#132931304">(Aug 28 2018 at 17:40)</a>:</h4>
<p>I think you should use this version :)</p>



<a name="132931394"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353394%20do%20%60move_outs%60%20computation%20lazilly/near/132931394" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353394.20do.20.60move_outs.60.20computation.20lazilly.html#132931394">(Aug 28 2018 at 17:42)</a>:</h4>
<p>does it make sense? :)</p>



<a name="132931447"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353394%20do%20%60move_outs%60%20computation%20lazilly/near/132931447" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353394.20do.20.60move_outs.60.20computation.20lazilly.html#132931447">(Aug 28 2018 at 17:43)</a>:</h4>
<p>I see</p>



<a name="132931498"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353394%20do%20%60move_outs%60%20computation%20lazilly/near/132931498" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353394.20do.20.60move_outs.60.20computation.20lazilly.html#132931498">(Aug 28 2018 at 17:44)</a>:</h4>
<p>and then I have this issue</p>



<a name="132931500"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353394%20do%20%60move_outs%60%20computation%20lazilly/near/132931500" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353394.20do.20.60move_outs.60.20computation.20lazilly.html#132931500">(Aug 28 2018 at 17:44)</a>:</h4>
<div class="codehilite"><pre><span></span>    = note: expected type `std::iter::Map&lt;std::iter::Map&lt;std::ops::Range&lt;usize&gt;, [closure@librustc/mir/mod.rs:212:22: 212:52 predecessor_blocks:_]&gt;, [closure@librustc/mir/mod.rs:213:22: 213:55 self:_]&gt;`
               found type `std::slice::Iter&lt;&#39;_, mir::Location&gt;`
</pre></div>



<a name="132931504"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353394%20do%20%60move_outs%60%20computation%20lazilly/near/132931504" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353394.20do.20.60move_outs.60.20computation.20lazilly.html#132931504">(Aug 28 2018 at 17:44)</a>:</h4>
<p>should I combine iterators?</p>



<a name="132931512"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353394%20do%20%60move_outs%60%20computation%20lazilly/near/132931512" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353394.20do.20.60move_outs.60.20computation.20lazilly.html#132931512">(Aug 28 2018 at 17:44)</a>:</h4>
<p>use Either or is there a better idea?</p>



<a name="132931561"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353394%20do%20%60move_outs%60%20computation%20lazilly/near/132931561" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353394.20do.20.60move_outs.60.20computation.20lazilly.html#132931561">(Aug 28 2018 at 17:46)</a>:</h4>
<p>what is the code you have exactly?</p>



<a name="132931604"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353394%20do%20%60move_outs%60%20computation%20lazilly/near/132931604" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353394.20do.20.60move_outs.60.20computation.20lazilly.html#132931604">(Aug 28 2018 at 17:46)</a>:</h4>
<p>I would probably still use the <code>Option</code> approach</p>



<a name="132931605"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353394%20do%20%60move_outs%60%20computation%20lazilly/near/132931605" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353394.20do.20.60move_outs.60.20computation.20lazilly.html#132931605">(Aug 28 2018 at 17:46)</a>:</h4>
<p>I find it more elegant</p>



<a name="132931606"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353394%20do%20%60move_outs%60%20computation%20lazilly/near/132931606" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353394.20do.20.60move_outs.60.20computation.20lazilly.html#132931606">(Aug 28 2018 at 17:46)</a>:</h4>
<p>but it's a matter of taste :P</p>



<a name="132931618"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353394%20do%20%60move_outs%60%20computation%20lazilly/near/132931618" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353394.20do.20.60move_outs.60.20computation.20lazilly.html#132931618">(Aug 28 2018 at 17:46)</a>:</h4>
<p>the option variant is (I think) potentially more efficient, as well, but I doubt it matters much</p>



<a name="132931627"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353394%20do%20%60move_outs%60%20computation%20lazilly/near/132931627" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353394.20do.20.60move_outs.60.20computation.20lazilly.html#132931627">(Aug 28 2018 at 17:46)</a>:</h4>
<p>(the difference is that <code>Either</code> will kind of "re-check" for each call to <code>next()</code> which branch you took)</p>



<a name="132931633"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353394%20do%20%60move_outs%60%20computation%20lazilly/near/132931633" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353394.20do.20.60move_outs.60.20computation.20lazilly.html#132931633">(Aug 28 2018 at 17:47)</a>:</h4>
<p>but there are many other variables</p>



<a name="132931649"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353394%20do%20%60move_outs%60%20computation%20lazilly/near/132931649" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353394.20do.20.60move_outs.60.20computation.20lazilly.html#132931649">(Aug 28 2018 at 17:47)</a>:</h4>
<div class="codehilite"><pre><span></span>        if loc.statement_index == 0 {
            let predecessor_blocks = self.predecessors_for(loc.block); // returns a `Ref&lt;&#39;_, Vec&lt;BasicBlock&gt;&gt;`
            let num_predecessor_blocks = predecessor_blocks.len();
            (0 .. num_predecessor_blocks)
                .map(move |i| predecessor_blocks[i])
                .map(move |bb| self.terminator_loc(bb))
        } else {
            vec![Location { block: loc.block, statement_index: loc.statement_index - 1 }].iter()
        }
</pre></div>



<a name="132931661"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353394%20do%20%60move_outs%60%20computation%20lazilly/near/132931661" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353394.20do.20.60move_outs.60.20computation.20lazilly.html#132931661">(Aug 28 2018 at 17:47)</a>:</h4>
<p>ok, let me go with the option thing because I'm also adding a vec there that doesn't make a lot of sense</p>



<a name="132931825"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353394%20do%20%60move_outs%60%20computation%20lazilly/near/132931825" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353394.20do.20.60move_outs.60.20computation.20lazilly.html#132931825">(Aug 28 2018 at 17:50)</a>:</h4>
<p>wow, got some lifetimes issues</p>



<a name="132931846"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353394%20do%20%60move_outs%60%20computation%20lazilly/near/132931846" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353394.20do.20.60move_outs.60.20computation.20lazilly.html#132931846">(Aug 28 2018 at 17:51)</a>:</h4>
<div class="codehilite"><pre><span></span>error[E0495]: cannot infer an appropriate lifetime for autoref due to conflicting requirements
   --&gt; librustc/mir/mod.rs:209:43
    |
209 |             let predecessor_blocks = self.predecessors_for(loc.block); // returns a `Ref&lt;&#39;_, Vec&lt;BasicBlock&gt;&gt;`
    |                                           ^^^^^^^^^^^^^^^^
    |
note: first, the lifetime cannot outlive the lifetime &#39;tcx as defined on the impl at 137:6...
   --&gt; librustc/mir/mod.rs:137:6
    |
137 | impl&lt;&#39;tcx&gt; Mir&lt;&#39;tcx&gt; {
    |      ^^^^
note: ...so that the type `mir::Mir&lt;&#39;tcx&gt;` is not borrowed for too long
   --&gt; librustc/mir/mod.rs:209:38
    |
209 |             let predecessor_blocks = self.predecessors_for(loc.block); // returns a `Ref&lt;&#39;_, Vec&lt;BasicBlock&gt;&gt;`
    |                                      ^^^^
    = note: but, the lifetime must be valid for the static lifetime...
note: ...so that return value is valid for the call
   --&gt; librustc/mir/mod.rs:207:59
    |
207 |     pub fn predecessor_locations(&amp;self, loc: Location) -&gt; impl Iterator&lt;Item = Location&gt; {
    |                                                           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^

error: cannot infer an appropriate lifetime
   --&gt; librustc/mir/mod.rs:213:22
    |
207 |     pub fn predecessor_locations(&amp;self, loc: Location) -&gt; impl Iterator&lt;Item = Location&gt; {
    |                                                           ------------------------------ this return type evaluates to the `&#39;static` lifetime...
...
213 |                 .map(move |bb| self.terminator_loc(bb))
    |                      ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^ ...but this borrow...
    |
note: ...can&#39;t outlive the anonymous lifetime #1 defined on the method body at 207:5
   --&gt; librustc/mir/mod.rs:207:5
    |
207 | /     pub fn predecessor_locations(&amp;self, loc: Location) -&gt; impl Iterator&lt;Item = Location&gt; {
208 | |         let if_zero_locations = if loc.statement_index == 0 {
209 | |             let predecessor_blocks = self.predecessors_for(loc.block); // returns a `Ref&lt;&#39;_, Vec&lt;BasicBlock&gt;&gt;`
210 | |             let num_predecessor_blocks = predecessor_blocks.len();
...   |
225 | |         if_zero_locations.into_iter().flatten().chain(if_not_zero_locations)
226 | |     }
    | |_____^
help: you can add a constraint to the return type to make it last less than `&#39;static` and match the anonymous lifetime #1 defined on the method body at 207:5
    |
207 |     pub fn predecessor_locations(&amp;self, loc: Location) -&gt; impl Iterator&lt;Item = Location&gt; + &#39;_ {
    |                                                           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^

error[E0495]: cannot infer an appropriate lifetime due to conflicting requirements
   --&gt; librustc/mir/mod.rs:213:22
    |
213 |                 .map(move |bb| self.terminator_loc(bb))
    |                      ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |
note: first, the lifetime cannot outlive the lifetime &#39;tcx as defined on the impl at 137:6...
   --&gt; librustc/mir/mod.rs:137:6
    |
137 | impl&lt;&#39;tcx&gt; Mir&lt;&#39;tcx&gt; {
    |      ^^^^
    = note: ...so that the types are compatible:
            expected &amp;mir::Mir&lt;&#39;_&gt;
               found &amp;mir::Mir&lt;&#39;tcx&gt;
    = note: but, the lifetime must be valid for the static lifetime...
note: ...so that return value is valid for the call
   --&gt; librustc/mir/mod.rs:207:59
    |
207 |     pub fn predecessor_locations(&amp;self, loc: Location) -&gt; impl Iterator&lt;Item = Location&gt; {
    |                                                           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^

error: aborting due to 3 previous errors

For more information about this error, try `rustc --explain E0495`.
error: Could not compile `rustc`.
</pre></div>



<a name="132931849"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353394%20do%20%60move_outs%60%20computation%20lazilly/near/132931849" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353394.20do.20.60move_outs.60.20computation.20lazilly.html#132931849">(Aug 28 2018 at 17:51)</a>:</h4>
<p>so you're gonna have to break it into two <code>ifs</code>, as I wrote, or at least return pairs</p>



<a name="132931853"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353394%20do%20%60move_outs%60%20computation%20lazilly/near/132931853" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353394.20do.20.60move_outs.60.20computation.20lazilly.html#132931853">(Aug 28 2018 at 17:51)</a>:</h4>
<p>oh yes so</p>



<a name="132931854"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353394%20do%20%60move_outs%60%20computation%20lazilly/near/132931854" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353394.20do.20.60move_outs.60.20computation.20lazilly.html#132931854">(Aug 28 2018 at 17:51)</a>:</h4>
<p>you need to change <code>-&gt; impl Iterator</code> to <code>+ '_</code>, as indeed it suggests to you</p>



<a name="132931856"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353394%20do%20%60move_outs%60%20computation%20lazilly/near/132931856" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353394.20do.20.60move_outs.60.20computation.20lazilly.html#132931856">(Aug 28 2018 at 17:51)</a>:</h4>
<p>yeah, I did the two ifs approach</p>



<a name="132931861"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353394%20do%20%60move_outs%60%20computation%20lazilly/near/132931861" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353394.20do.20.60move_outs.60.20computation.20lazilly.html#132931861">(Aug 28 2018 at 17:51)</a>:</h4>
<p>that is</p>
<div class="codehilite"><pre><span></span><span class="k">impl</span><span class="w"> </span><span class="nb">Iterator</span><span class="o">&lt;</span><span class="n">Item</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Location</span><span class="o">&gt;</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="na">&#39;_</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
</pre></div>



<a name="132931900"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353394%20do%20%60move_outs%60%20computation%20lazilly/near/132931900" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353394.20do.20.60move_outs.60.20computation.20lazilly.html#132931900">(Aug 28 2018 at 17:52)</a>:</h4>
<p>the <code>+ '_</code> indicates that this iterator may capture data from <code>self</code></p>



<a name="132931904"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353394%20do%20%60move_outs%60%20computation%20lazilly/near/132931904" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353394.20do.20.60move_outs.60.20computation.20lazilly.html#132931904">(Aug 28 2018 at 17:52)</a>:</h4>
<p>otherwise, we assume it doesn't</p>



<a name="132931906"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353394%20do%20%60move_outs%60%20computation%20lazilly/near/132931906" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353394.20do.20.60move_outs.60.20computation.20lazilly.html#132931906">(Aug 28 2018 at 17:52)</a>:</h4>
<p>that error...needs some love</p>



<a name="132931910"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353394%20do%20%60move_outs%60%20computation%20lazilly/near/132931910" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353394.20do.20.60move_outs.60.20computation.20lazilly.html#132931910">(Aug 28 2018 at 17:52)</a>:</h4>
<p>hehe :)</p>



<a name="132931914"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353394%20do%20%60move_outs%60%20computation%20lazilly/near/132931914" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353394.20do.20.60move_outs.60.20computation.20lazilly.html#132931914">(Aug 28 2018 at 17:52)</a>:</h4>
<p>yeah, didn't even read what it was saying :P</p>



<a name="132931917"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353394%20do%20%60move_outs%60%20computation%20lazilly/near/132931917" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353394.20do.20.60move_outs.60.20computation.20lazilly.html#132931917">(Aug 28 2018 at 17:52)</a>:</h4>
<p>I think it'd be mildly better with NLL but anyway</p>



<a name="132933437"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353394%20do%20%60move_outs%60%20computation%20lazilly/near/132933437" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353394.20do.20.60move_outs.60.20computation.20lazilly.html#132933437">(Aug 28 2018 at 18:19)</a>:</h4>
<p>this is compiling now</p>



<a name="132933439"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353394%20do%20%60move_outs%60%20computation%20lazilly/near/132933439" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353394.20do.20.60move_outs.60.20computation.20lazilly.html#132933439">(Aug 28 2018 at 18:19)</a>:</h4>
<p>running tests</p>



<a name="132933451"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353394%20do%20%60move_outs%60%20computation%20lazilly/near/132933451" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353394.20do.20.60move_outs.60.20computation.20lazilly.html#132933451">(Aug 28 2018 at 18:19)</a>:</h4>
<p>anyway I'd need to do the refactor still</p>



<a name="132934098"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353394%20do%20%60move_outs%60%20computation%20lazilly/near/132934098" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353394.20do.20.60move_outs.60.20computation.20lazilly.html#132934098">(Aug 28 2018 at 18:31)</a>:</h4>
<p>two Fs</p>



<a name="132934202"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353394%20do%20%60move_outs%60%20computation%20lazilly/near/132934202" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353394.20do.20.60move_outs.60.20computation.20lazilly.html#132934202">(Aug 28 2018 at 18:32)</a>:</h4>
<p>which ones? :)</p>



<a name="132940227"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353394%20do%20%60move_outs%60%20computation%20lazilly/near/132940227" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353394.20do.20.60move_outs.60.20computation.20lazilly.html#132940227">(Aug 28 2018 at 18:53)</a>:</h4>
<div class="codehilite"><pre><span></span>failures:
    [ui] ui/issues/issue-29723.rs
    [ui] ui/macros/macros-nonfatal-errors.rs
</pre></div>



<a name="132940235"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353394%20do%20%60move_outs%60%20computation%20lazilly/near/132940235" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353394.20do.20.60move_outs.60.20computation.20lazilly.html#132940235">(Aug 28 2018 at 18:53)</a>:</h4>
<p>I think that the last one is a spurious thing</p>



<a name="132940236"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353394%20do%20%60move_outs%60%20computation%20lazilly/near/132940236" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353394.20do.20.60move_outs.60.20computation.20lazilly.html#132940236">(Aug 28 2018 at 18:53)</a>:</h4>
<p>I've seen it sometimes</p>



<a name="132940290"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353394%20do%20%60move_outs%60%20computation%20lazilly/near/132940290" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353394.20do.20.60move_outs.60.20computation.20lazilly.html#132940290">(Aug 28 2018 at 18:54)</a>:</h4>
<p>the other one is I think the failure I was concerned about?</p>



<a name="132940293"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353394%20do%20%60move_outs%60%20computation%20lazilly/near/132940293" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353394.20do.20.60move_outs.60.20computation.20lazilly.html#132940293">(Aug 28 2018 at 18:54)</a>:</h4>
<p>(what is your full diff?)</p>



<a name="132940296"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353394%20do%20%60move_outs%60%20computation%20lazilly/near/132940296" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353394.20do.20.60move_outs.60.20computation.20lazilly.html#132940296">(Aug 28 2018 at 18:54)</a>:</h4>
<p>it could be I was wrong as to the cause</p>



<a name="132940301"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353394%20do%20%60move_outs%60%20computation%20lazilly/near/132940301" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353394.20do.20.60move_outs.60.20computation.20lazilly.html#132940301">(Aug 28 2018 at 18:54)</a>:</h4>
<p>that would worry me since it would mean we have an untested path, since that code was definitely wrong as is :)</p>



<a name="132940909"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353394%20do%20%60move_outs%60%20computation%20lazilly/near/132940909" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353394.20do.20.60move_outs.60.20computation.20lazilly.html#132940909">(Aug 28 2018 at 19:05)</a>:</h4>
<p>so ...</p>



<a name="132940911"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353394%20do%20%60move_outs%60%20computation%20lazilly/near/132940911" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353394.20do.20.60move_outs.60.20computation.20lazilly.html#132940911">(Aug 28 2018 at 19:05)</a>:</h4>
<p>let me push again :)</p>



<a name="132941416"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353394%20do%20%60move_outs%60%20computation%20lazilly/near/132941416" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353394.20do.20.60move_outs.60.20computation.20lazilly.html#132941416">(Aug 28 2018 at 19:14)</a>:</h4>
<p><a href="https://github.com/spastorino/rust/commit/206088406234f7e27eab9985f6c718a82e868866" target="_blank" title="https://github.com/spastorino/rust/commit/206088406234f7e27eab9985f6c718a82e868866">https://github.com/spastorino/rust/commit/206088406234f7e27eab9985f6c718a82e868866</a></p>



<a name="132941525"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353394%20do%20%60move_outs%60%20computation%20lazilly/near/132941525" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353394.20do.20.60move_outs.60.20computation.20lazilly.html#132941525">(Aug 28 2018 at 19:17)</a>:</h4>
<p><span class="user-mention" data-user-id="116266">@Santiago Pastorino</span> <a href="https://github.com/spastorino/rust/commit/206088406234f7e27eab9985f6c718a82e868866#r30318086" target="_blank" title="https://github.com/spastorino/rust/commit/206088406234f7e27eab9985f6c718a82e868866#r30318086">https://github.com/spastorino/rust/commit/206088406234f7e27eab9985f6c718a82e868866#r30318086</a></p>



<a name="132941688"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353394%20do%20%60move_outs%60%20computation%20lazilly/near/132941688" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353394.20do.20.60move_outs.60.20computation.20lazilly.html#132941688">(Aug 28 2018 at 19:20)</a>:</h4>
<p>hehehe</p>



<a name="132941689"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353394%20do%20%60move_outs%60%20computation%20lazilly/near/132941689" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353394.20do.20.60move_outs.60.20computation.20lazilly.html#132941689">(Aug 28 2018 at 19:20)</a>:</h4>
<p>I did that</p>



<a name="132941700"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353394%20do%20%60move_outs%60%20computation%20lazilly/near/132941700" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353394.20do.20.60move_outs.60.20computation.20lazilly.html#132941700">(Aug 28 2018 at 19:20)</a>:</h4>
<p>probably rebasing issues :)</p>



<a name="132941724"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353394%20do%20%60move_outs%60%20computation%20lazilly/near/132941724" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353394.20do.20.60move_outs.60.20computation.20lazilly.html#132941724">(Aug 28 2018 at 19:21)</a>:</h4>
<p>ok, I don't see it in <a href="https://github.com/rust-lang/rust/pull/53403/files" target="_blank" title="https://github.com/rust-lang/rust/pull/53403/files">https://github.com/rust-lang/rust/pull/53403/files</a></p>



<a name="132941834"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353394%20do%20%60move_outs%60%20computation%20lazilly/near/132941834" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353394.20do.20.60move_outs.60.20computation.20lazilly.html#132941834">(Aug 28 2018 at 19:23)</a>:</h4>
<p>no I did add that in the last of the method but not there</p>



<a name="132941869"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353394%20do%20%60move_outs%60%20computation%20lazilly/near/132941869" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353394.20do.20.60move_outs.60.20computation.20lazilly.html#132941869">(Aug 28 2018 at 19:24)</a>:</h4>
<p>was just distracted</p>



<a name="132941877"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353394%20do%20%60move_outs%60%20computation%20lazilly/near/132941877" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353394.20do.20.60move_outs.60.20computation.20lazilly.html#132941877">(Aug 28 2018 at 19:24)</a>:</h4>
<p>anyway ... did it now</p>



<a name="132941884"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353394%20do%20%60move_outs%60%20computation%20lazilly/near/132941884" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353394.20do.20.60move_outs.60.20computation.20lazilly.html#132941884">(Aug 28 2018 at 19:24)</a>:</h4>
<p>pushing again</p>



<a name="132947778"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353394%20do%20%60move_outs%60%20computation%20lazilly/near/132947778" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353394.20do.20.60move_outs.60.20computation.20lazilly.html#132947778">(Aug 28 2018 at 19:41)</a>:</h4>
<p><span class="user-mention" data-user-id="116266">@Santiago Pastorino</span> running locally, the only UI failure I see is </p>
<p>failures:<br>
    [ui] ui/macros/macros-nonfatal-errors.rs</p>



<a name="132947865"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353394%20do%20%60move_outs%60%20computation%20lazilly/near/132947865" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353394.20do.20.60move_outs.60.20computation.20lazilly.html#132947865">(Aug 28 2018 at 19:42)</a>:</h4>
<p>yes, here it's finishing running</p>



<a name="132947868"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353394%20do%20%60move_outs%60%20computation%20lazilly/near/132947868" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353394.20do.20.60move_outs.60.20computation.20lazilly.html#132947868">(Aug 28 2018 at 19:42)</a>:</h4>
<p>for now one F</p>



<a name="132947903"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353394%20do%20%60move_outs%60%20computation%20lazilly/near/132947903" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353394.20do.20.60move_outs.60.20computation.20lazilly.html#132947903">(Aug 28 2018 at 19:43)</a>:</h4>
<p>I believe that this is some kind of stage1 artifact</p>



<a name="132947908"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353394%20do%20%60move_outs%60%20computation%20lazilly/near/132947908" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353394.20do.20.60move_outs.60.20computation.20lazilly.html#132947908">(Aug 28 2018 at 19:43)</a>:</h4>
<p>I haven't looked more closely though</p>



<a name="132947925"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353394%20do%20%60move_outs%60%20computation%20lazilly/near/132947925" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353394.20do.20.60move_outs.60.20computation.20lazilly.html#132947925">(Aug 28 2018 at 19:43)</a>:</h4>
<p>you mean because of the keep-stage thing?</p>



<a name="132947991"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353394%20do%20%60move_outs%60%20computation%20lazilly/near/132947991" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353394.20do.20.60move_outs.60.20computation.20lazilly.html#132947991">(Aug 28 2018 at 19:44)</a>:</h4>
<p>so yeah, same error</p>



<a name="132948259"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353394%20do%20%60move_outs%60%20computation%20lazilly/near/132948259" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353394.20do.20.60move_outs.60.20computation.20lazilly.html#132948259">(Aug 28 2018 at 19:48)</a>:</h4>
<blockquote>
<p>you mean because of the keep-stage thing?</p>
</blockquote>
<p>not necessarily...sometimes stage1 tests just don't work for whatever reason</p>



<a name="132948291"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353394%20do%20%60move_outs%60%20computation%20lazilly/near/132948291" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353394.20do.20.60move_outs.60.20computation.20lazilly.html#132948291">(Aug 28 2018 at 19:49)</a>:</h4>
<p>I'm also not using <code>--keep-stage 1</code></p>



<a name="132948307"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353394%20do%20%60move_outs%60%20computation%20lazilly/near/132948307" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> pnkfelix <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353394.20do.20.60move_outs.60.20computation.20lazilly.html#132948307">(Aug 28 2018 at 19:49)</a>:</h4>
<blockquote>
<p>not necessarily...sometimes stage1 tests just don't work for whatever reason</p>
</blockquote>
<p>(this is very annoying)</p>



<a name="132948420"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353394%20do%20%60move_outs%60%20computation%20lazilly/near/132948420" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353394.20do.20.60move_outs.60.20computation.20lazilly.html#132948420">(Aug 28 2018 at 19:51)</a>:</h4>
<p>ok, let's see what the ci says then :)</p>



<a name="132948981"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353394%20do%20%60move_outs%60%20computation%20lazilly/near/132948981" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353394.20do.20.60move_outs.60.20computation.20lazilly.html#132948981">(Aug 28 2018 at 20:00)</a>:</h4>
<p>so <span class="user-mention" data-user-id="116009">@nikomatsakis</span> just in case ... about this ... I just need to do the generic reverse depth-first search specialized by <code>BitDenotation</code> and done, right?</p>



<a name="132949014"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353394%20do%20%60move_outs%60%20computation%20lazilly/near/132949014" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353394.20do.20.60move_outs.60.20computation.20lazilly.html#132949014">(Aug 28 2018 at 20:01)</a>:</h4>
<p>well it depends</p>



<a name="132949018"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353394%20do%20%60move_outs%60%20computation%20lazilly/near/132949018" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353394.20do.20.60move_outs.60.20computation.20lazilly.html#132949018">(Aug 28 2018 at 20:02)</a>:</h4>
<p>we could probably land 'as is' and leave that for a follow-up</p>



<a name="132949063"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353394%20do%20%60move_outs%60%20computation%20lazilly/near/132949063" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353394.20do.20.60move_outs.60.20computation.20lazilly.html#132949063">(Aug 28 2018 at 20:02)</a>:</h4>
<p>but I guess it'd be nicer to do it as part of this</p>



<a name="132949065"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353394%20do%20%60move_outs%60%20computation%20lazilly/near/132949065" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353394.20do.20.60move_outs.60.20computation.20lazilly.html#132949065">(Aug 28 2018 at 20:02)</a>:</h4>
<p>since it will need to use the <code>BitDenotation</code> impl that we removed :)</p>



<a name="132949774"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353394%20do%20%60move_outs%60%20computation%20lazilly/near/132949774" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353394.20do.20.60move_outs.60.20computation.20lazilly.html#132949774">(Aug 28 2018 at 20:17)</a>:</h4>
<p>yeah</p>



<a name="132949779"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353394%20do%20%60move_outs%60%20computation%20lazilly/near/132949779" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353394.20do.20.60move_outs.60.20computation.20lazilly.html#132949779">(Aug 28 2018 at 20:17)</a>:</h4>
<p>will do it before we make it land</p>



<a name="132949783"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353394%20do%20%60move_outs%60%20computation%20lazilly/near/132949783" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353394.20do.20.60move_outs.60.20computation.20lazilly.html#132949783">(Aug 28 2018 at 20:17)</a>:</h4>
<p>just wanted to be sure that it was the missing bit</p>



<a name="132950782"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353394%20do%20%60move_outs%60%20computation%20lazilly/near/132950782" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353394.20do.20.60move_outs.60.20computation.20lazilly.html#132950782">(Aug 28 2018 at 20:37)</a>:</h4>
<p>yep</p>



<a name="132951520"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353394%20do%20%60move_outs%60%20computation%20lazilly/near/132951520" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353394.20do.20.60move_outs.60.20computation.20lazilly.html#132951520">(Aug 28 2018 at 20:51)</a>:</h4>
<p><span class="user-mention" data-user-id="116266">@Santiago Pastorino</span> running all the way to stage2, I got this error:</p>
<div class="codehilite"><pre><span></span>---- [ui (nll)] ui/hygiene/fields-move.rs stdout ----
diff of stderr:

1       error[E0382]: use of moved value: `foo.x`
2         --&gt; $DIR/fields-move.rs:28:9
3          |
-       LL |    $foo.x
-          |    ------ value moved here
-       ...
7       LL |         $foo.x //~ ERROR use of moved value: `foo.x`
8          |         ^^^^^^ value used here after move
9       ...

28      error[E0382]: use of moved value: `foo.x`
29        --&gt; $DIR/fields-move.rs:39:42
30         |
-       LL |    $foo.x
-          |    ------ value moved here
-       ...
34      LL |         $foo.x //~ ERROR use of moved value: `foo.x`
35         |         ------ value moved here
36      ...

-       LL |     assert_two_copies(copy_modern!(foo), foo.x); //~ ERROR use of moved value: `foo.x`
-          |                                          ----- value moved here
39      LL |     assert_two_copies(copy_legacy!(foo), foo.x); //~ ERROR use of moved value: `foo.x`
40         |                                          ^^^^^ value used here after move
41         |
</pre></div>



<a name="132951523"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353394%20do%20%60move_outs%60%20computation%20lazilly/near/132951523" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353394.20do.20.60move_outs.60.20computation.20lazilly.html#132951523">(Aug 28 2018 at 20:51)</a>:</h4>
<p>I haven't looked at it at all</p>



<a name="132966636"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353394%20do%20%60move_outs%60%20computation%20lazilly/near/132966636" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353394.20do.20.60move_outs.60.20computation.20lazilly.html#132966636">(Aug 29 2018 at 00:03)</a>:</h4>
<p>doh</p>



<a name="132996222"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353394%20do%20%60move_outs%60%20computation%20lazilly/near/132996222" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353394.20do.20.60move_outs.60.20computation.20lazilly.html#132996222">(Aug 29 2018 at 13:28)</a>:</h4>
<p><span class="user-mention" data-user-id="116009">@nikomatsakis</span> seeing the very same thing now</p>



<a name="132996230"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353394%20do%20%60move_outs%60%20computation%20lazilly/near/132996230" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353394.20do.20.60move_outs.60.20computation.20lazilly.html#132996230">(Aug 29 2018 at 13:29)</a>:</h4>
<p>the CI have also finished</p>



<a name="132996247"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353394%20do%20%60move_outs%60%20computation%20lazilly/near/132996247" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353394.20do.20.60move_outs.60.20computation.20lazilly.html#132996247">(Aug 29 2018 at 13:29)</a>:</h4>
<p>I'd need to investigate a bit</p>



<a name="133016243"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353394%20do%20%60move_outs%60%20computation%20lazilly/near/133016243" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353394.20do.20.60move_outs.60.20computation.20lazilly.html#133016243">(Aug 29 2018 at 19:20)</a>:</h4>
<p><span class="user-mention" data-user-id="116009">@nikomatsakis</span> didn't have time yet but do you have any suggestion on where to look?</p>



<a name="133016277"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353394%20do%20%60move_outs%60%20computation%20lazilly/near/133016277" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353394.20do.20.60move_outs.60.20computation.20lazilly.html#133016277">(Aug 29 2018 at 19:21)</a>:</h4>
<p>I haven't really looked at it yet either— I think comparing the before/after like you did before seems good?</p>



<a name="133016284"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353394%20do%20%60move_outs%60%20computation%20lazilly/near/133016284" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353394.20do.20.60move_outs.60.20computation.20lazilly.html#133016284">(Aug 29 2018 at 19:21)</a>:</h4>
<p>or, alternatively,</p>



<a name="133016290"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353394%20do%20%60move_outs%60%20computation%20lazilly/near/133016290" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353394.20do.20.60move_outs.60.20computation.20lazilly.html#133016290">(Aug 29 2018 at 19:21)</a>:</h4>
<p>yeah, will try to see that</p>



<a name="133016291"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353394%20do%20%60move_outs%60%20computation%20lazilly/near/133016291" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353394.20do.20.60move_outs.60.20computation.20lazilly.html#133016291">(Aug 29 2018 at 19:21)</a>:</h4>
<p>didn't want you to jump into the issue</p>



<a name="133016309"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353394%20do%20%60move_outs%60%20computation%20lazilly/near/133016309" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353394.20do.20.60move_outs.60.20computation.20lazilly.html#133016309">(Aug 29 2018 at 19:22)</a>:</h4>
<p>but maybe from the top of your head you had some tip or something :)</p>



<a name="133016364"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353394%20do%20%60move_outs%60%20computation%20lazilly/near/133016364" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353394.20do.20.60move_outs.60.20computation.20lazilly.html#133016364">(Aug 29 2018 at 19:22)</a>:</h4>
<p>hmm</p>



<a name="133016369"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353394%20do%20%60move_outs%60%20computation%20lazilly/near/133016369" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353394.20do.20.60move_outs.60.20computation.20lazilly.html#133016369">(Aug 29 2018 at 19:22)</a>:</h4>
<p>the move is occurring in a call</p>



<a name="133016393"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353394%20do%20%60move_outs%60%20computation%20lazilly/near/133016393" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353394.20do.20.60move_outs.60.20computation.20lazilly.html#133016393">(Aug 29 2018 at 19:23)</a>:</h4>
<p>or at least one of them</p>



<a name="133016395"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353394%20do%20%60move_outs%60%20computation%20lazilly/near/133016395" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353394.20do.20.60move_outs.60.20computation.20lazilly.html#133016395">(Aug 29 2018 at 19:23)</a>:</h4>
<p>it's from the parameters of a call</p>



<a name="133016409"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353394%20do%20%60move_outs%60%20computation%20lazilly/near/133016409" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353394.20do.20.60move_outs.60.20computation.20lazilly.html#133016409">(Aug 29 2018 at 19:23)</a>:</h4>
<p>calls <em>are</em> treated a bit funny sometimes, but really just their <em>destination</em></p>



<a name="133016425"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353394%20do%20%60move_outs%60%20computation%20lazilly/near/133016425" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353394.20do.20.60move_outs.60.20computation.20lazilly.html#133016425">(Aug 29 2018 at 19:23)</a>:</h4>
<p>isn't the test about a macro?</p>



<a name="133016470"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353394%20do%20%60move_outs%60%20computation%20lazilly/near/133016470" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353394.20do.20.60move_outs.60.20computation.20lazilly.html#133016470">(Aug 29 2018 at 19:24)</a>:</h4>
<p>the macro is just confusing things</p>



<a name="133016474"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353394%20do%20%60move_outs%60%20computation%20lazilly/near/133016474" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353394.20do.20.60move_outs.60.20computation.20lazilly.html#133016474">(Aug 29 2018 at 19:24)</a>:</h4>
<p>or at least I think so</p>



<a name="133016476"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353394%20do%20%60move_outs%60%20computation%20lazilly/near/133016476" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353394.20do.20.60move_outs.60.20computation.20lazilly.html#133016476">(Aug 29 2018 at 19:24)</a>:</h4>
<p>given that it talks about hygiene in the directory</p>



<a name="133016481"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353394%20do%20%60move_outs%60%20computation%20lazilly/near/133016481" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353394.20do.20.60move_outs.60.20computation.20lazilly.html#133016481">(Aug 29 2018 at 19:24)</a>:</h4>
<p>I guess the first thing I might do is to remove the macro from the test and check if you get the same behavior :)</p>



<a name="133016482"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353394%20do%20%60move_outs%60%20computation%20lazilly/near/133016482" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353394.20do.20.60move_outs.60.20computation.20lazilly.html#133016482">(Aug 29 2018 at 19:24)</a>:</h4>
<p>well sure</p>



<a name="133016483"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353394%20do%20%60move_outs%60%20computation%20lazilly/near/133016483" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353394.20do.20.60move_outs.60.20computation.20lazilly.html#133016483">(Aug 29 2018 at 19:24)</a>:</h4>
<p>I guess it should be related to some macro thing</p>



<a name="133016486"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353394%20do%20%60move_outs%60%20computation%20lazilly/near/133016486" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353394.20do.20.60move_outs.60.20computation.20lazilly.html#133016486">(Aug 29 2018 at 19:24)</a>:</h4>
<p>yep</p>



<a name="133016487"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353394%20do%20%60move_outs%60%20computation%20lazilly/near/133016487" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353394.20do.20.60move_outs.60.20computation.20lazilly.html#133016487">(Aug 29 2018 at 19:24)</a>:</h4>
<p>the purpose of the test has something to do with a macro</p>



<a name="133016491"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353394%20do%20%60move_outs%60%20computation%20lazilly/near/133016491" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353394.20do.20.60move_outs.60.20computation.20lazilly.html#133016491">(Aug 29 2018 at 19:24)</a>:</h4>
<p>but that doens't mean it's affecting you at this moment</p>



<a name="133016496"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353394%20do%20%60move_outs%60%20computation%20lazilly/near/133016496" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353394.20do.20.60move_outs.60.20computation.20lazilly.html#133016496">(Aug 29 2018 at 19:24)</a>:</h4>
<p>yep we need to see if this error is because of the macro or not</p>



<a name="133016504"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353394%20do%20%60move_outs%60%20computation%20lazilly/near/133016504" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353394.20do.20.60move_outs.60.20computation.20lazilly.html#133016504">(Aug 29 2018 at 19:25)</a>:</h4>
<p><span class="emoji emoji-1f44d" title="+1">:+1:</span></p>



<a name="133016520"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353394%20do%20%60move_outs%60%20computation%20lazilly/near/133016520" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353394.20do.20.60move_outs.60.20computation.20lazilly.html#133016520">(Aug 29 2018 at 19:25)</a>:</h4>
<p>I guessed it was because it's also failing at stage2, right?</p>



<a name="133016525"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353394%20do%20%60move_outs%60%20computation%20lazilly/near/133016525" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353394.20do.20.60move_outs.60.20computation.20lazilly.html#133016525">(Aug 29 2018 at 19:25)</a>:</h4>
<p>not stage1</p>



<a name="133016549"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353394%20do%20%60move_outs%60%20computation%20lazilly/near/133016549" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353394.20do.20.60move_outs.60.20computation.20lazilly.html#133016549">(Aug 29 2018 at 19:25)</a>:</h4>
<p>if I remember correctly something more happens with macros between those phases</p>



<a name="133016612"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353394%20do%20%60move_outs%60%20computation%20lazilly/near/133016612" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353394.20do.20.60move_outs.60.20computation.20lazilly.html#133016612">(Aug 29 2018 at 19:26)</a>:</h4>
<p>anyway, I guess I should need to compile this thing for stage 2 and start testing and changing the example to get some kind of conclusion</p>



<a name="133016621"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353394%20do%20%60move_outs%60%20computation%20lazilly/near/133016621" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353394.20do.20.60move_outs.60.20computation.20lazilly.html#133016621">(Aug 29 2018 at 19:26)</a>:</h4>
<p>I see</p>



<a name="133016623"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353394%20do%20%60move_outs%60%20computation%20lazilly/near/133016623" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353394.20do.20.60move_outs.60.20computation.20lazilly.html#133016623">(Aug 29 2018 at 19:26)</a>:</h4>
<p>I ran by hand ;)</p>



<a name="133016631"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353394%20do%20%60move_outs%60%20computation%20lazilly/near/133016631" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353394.20do.20.60move_outs.60.20computation.20lazilly.html#133016631">(Aug 29 2018 at 19:27)</a>:</h4>
<p>by hand on stage 1 also fails?</p>



<a name="133016647"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353394%20do%20%60move_outs%60%20computation%20lazilly/near/133016647" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353394.20do.20.60move_outs.60.20computation.20lazilly.html#133016647">(Aug 29 2018 at 19:27)</a>:</h4>
<p>hmm, sorry</p>



<a name="133016648"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353394%20do%20%60move_outs%60%20computation%20lazilly/near/133016648" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353394.20do.20.60move_outs.60.20computation.20lazilly.html#133016648">(Aug 29 2018 at 19:27)</a>:</h4>
<p>yes,</p>



<a name="133016654"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353394%20do%20%60move_outs%60%20computation%20lazilly/near/133016654" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353394.20do.20.60move_outs.60.20computation.20lazilly.html#133016654">(Aug 29 2018 at 19:27)</a>:</h4>
<p>this has nothing to do with stage1/stage2</p>



<a name="133016661"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353394%20do%20%60move_outs%60%20computation%20lazilly/near/133016661" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353394.20do.20.60move_outs.60.20computation.20lazilly.html#133016661">(Aug 29 2018 at 19:27)</a>:</h4>
<p>it's just that the error was uncovered when we run with compare-mode=nll</p>



<a name="133016667"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353394%20do%20%60move_outs%60%20computation%20lazilly/near/133016667" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353394.20do.20.60move_outs.60.20computation.20lazilly.html#133016667">(Aug 29 2018 at 19:27)</a>:</h4>
<p>and stage1 wasn't getting that far</p>



<a name="133016670"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353394%20do%20%60move_outs%60%20computation%20lazilly/near/133016670" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353394.20do.20.60move_outs.60.20computation.20lazilly.html#133016670">(Aug 29 2018 at 19:27)</a>:</h4>
<p>this is the test minus macros:</p>
<div class="codehilite"><pre><span></span><span class="cp">#[derive(Debug)]</span><span class="w"></span>
<span class="k">struct</span> <span class="nc">NonCopy</span><span class="p">(</span><span class="nb">String</span><span class="p">);</span><span class="w"></span>

<span class="k">struct</span> <span class="nc">Foo</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="n">x</span>: <span class="nc">NonCopy</span><span class="p">,</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>

<span class="k">fn</span> <span class="nf">assert_two_copies</span><span class="p">(</span><span class="n">a</span>: <span class="nc">NonCopy</span><span class="p">,</span><span class="w"> </span><span class="n">b</span>: <span class="nc">NonCopy</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="n">println</span><span class="o">!</span><span class="p">(</span><span class="s">&quot;Got two copies: {:?}, {:?}&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">a</span><span class="p">,</span><span class="w"> </span><span class="n">b</span><span class="p">);</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>

<span class="k">fn</span> <span class="nf">main</span><span class="p">()</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="n">foo</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Foo</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">x</span>: <span class="nc">NonCopy</span><span class="p">(</span><span class="s">&quot;foo&quot;</span><span class="p">.</span><span class="n">into</span><span class="p">())</span><span class="w"> </span><span class="p">};</span><span class="w"></span>
<span class="w">    </span><span class="n">assert_two_copies</span><span class="p">(</span><span class="n">foo</span><span class="p">.</span><span class="n">x</span><span class="p">,</span><span class="w"> </span><span class="n">foo</span><span class="p">.</span><span class="n">x</span><span class="p">);</span><span class="w"> </span><span class="c1">//~ ERROR use of moved value: `foo.x`</span>
<span class="w">    </span><span class="n">assert_two_copies</span><span class="p">(</span><span class="n">foo</span><span class="p">.</span><span class="n">x</span><span class="p">,</span><span class="w"> </span><span class="n">foo</span><span class="p">.</span><span class="n">x</span><span class="p">);</span><span class="w"> </span><span class="c1">//~ ERROR use of moved value: `foo.x`</span>
<span class="p">}</span><span class="w"></span>
</pre></div>



<a name="133016674"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353394%20do%20%60move_outs%60%20computation%20lazilly/near/133016674" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353394.20do.20.60move_outs.60.20computation.20lazilly.html#133016674">(Aug 29 2018 at 19:28)</a>:</h4>
<p>it fails in the same basic way either way</p>



<a name="133016715"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353394%20do%20%60move_outs%60%20computation%20lazilly/near/133016715" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353394.20do.20.60move_outs.60.20computation.20lazilly.html#133016715">(Aug 29 2018 at 19:28)</a>:</h4>
<p>though the output looks different</p>



<a name="133016723"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353394%20do%20%60move_outs%60%20computation%20lazilly/near/133016723" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353394.20do.20.60move_outs.60.20computation.20lazilly.html#133016723">(Aug 29 2018 at 19:28)</a>:</h4>
<p>with nightly, we get:</p>
<div class="codehilite"><pre><span></span>error[E0382]: use of moved value: `foo.x`
  --&gt; /home/nmatsakis/tmp/spastorino.rs:15:30
   |
14 |     assert_two_copies(foo.x, foo.x); //~ ERROR use of moved value: `foo.x`
   |                       -----  ----- value moved here
   |                       |
   |                       value moved here
15 |     assert_two_copies(foo.x, foo.x); //~ ERROR use of moved value: `foo.x`
   |                       -----  ^^^^^ value used here after move
   |                       |
   |                       value moved here
   |
   = note: move occurs because `foo.x` has type `NonCopy`, which does not implement the `Copy` trait
</pre></div>



<a name="133016729"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353394%20do%20%60move_outs%60%20computation%20lazilly/near/133016729" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353394.20do.20.60move_outs.60.20computation.20lazilly.html#133016729">(Aug 29 2018 at 19:28)</a>:</h4>
<p>(actually, we get more errors than that, but this is the last one)</p>



<a name="133016737"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353394%20do%20%60move_outs%60%20computation%20lazilly/near/133016737" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353394.20do.20.60move_outs.60.20computation.20lazilly.html#133016737">(Aug 29 2018 at 19:28)</a>:</h4>
<p>with your code, we get:</p>
<div class="codehilite"><pre><span></span>error[E0382]: use of moved value: `foo.x`
  --&gt; /home/nmatsakis/tmp/spastorino.rs:15:30
   |
15 |     assert_two_copies(foo.x, foo.x); //~ ERROR use of moved value: `foo.x`
   |                       -----  ^^^^^ value used here after move
   |                       |
   |                       value moved here
   |
   = note: move occurs because `foo.x` has type `NonCopy`, which does not implement the `Copy` trait
</pre></div>



<a name="133016741"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353394%20do%20%60move_outs%60%20computation%20lazilly/near/133016741" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353394.20do.20.60move_outs.60.20computation.20lazilly.html#133016741">(Aug 29 2018 at 19:28)</a>:</h4>
<p>interestingly, I would say that your code is <em>more</em> correct</p>



<a name="133016745"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353394%20do%20%60move_outs%60%20computation%20lazilly/near/133016745" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353394.20do.20.60move_outs.60.20computation.20lazilly.html#133016745">(Aug 29 2018 at 19:29)</a>:</h4>
<p>I'm surprised by the nightly output</p>



<a name="133016752"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353394%20do%20%60move_outs%60%20computation%20lazilly/near/133016752" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353394.20do.20.60move_outs.60.20computation.20lazilly.html#133016752">(Aug 29 2018 at 19:29)</a>:</h4>
<p>hmmm</p>



<a name="133016758"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353394%20do%20%60move_outs%60%20computation%20lazilly/near/133016758" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353394.20do.20.60move_outs.60.20computation.20lazilly.html#133016758">(Aug 29 2018 at 19:29)</a>:</h4>
<p>in nightly, it highlights three places, but only the last one is relevant</p>



<a name="133016760"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353394%20do%20%60move_outs%60%20computation%20lazilly/near/133016760" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353394.20do.20.60move_outs.60.20computation.20lazilly.html#133016760">(Aug 29 2018 at 19:29)</a>:</h4>
<p>in some sense</p>



<a name="133016762"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353394%20do%20%60move_outs%60%20computation%20lazilly/near/133016762" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353394.20do.20.60move_outs.60.20computation.20lazilly.html#133016762">(Aug 29 2018 at 19:29)</a>:</h4>
<p>but I guess the reason for this is</p>



<a name="133016765"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353394%20do%20%60move_outs%60%20computation%20lazilly/near/133016765" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353394.20do.20.60move_outs.60.20computation.20lazilly.html#133016765">(Aug 29 2018 at 19:29)</a>:</h4>
<p>that you stop walking backwards when you find a move (a GEN)</p>



<a name="133016768"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353394%20do%20%60move_outs%60%20computation%20lazilly/near/133016768" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353394.20do.20.60move_outs.60.20computation.20lazilly.html#133016768">(Aug 29 2018 at 19:29)</a>:</h4>
<p>but in principle you could keep going back further</p>



<a name="133016773"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353394%20do%20%60move_outs%60%20computation%20lazilly/near/133016773" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353394.20do.20.60move_outs.60.20computation.20lazilly.html#133016773">(Aug 29 2018 at 19:29)</a>:</h4>
<p>until you find a kill</p>



<a name="133016823"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353394%20do%20%60move_outs%60%20computation%20lazilly/near/133016823" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353394.20do.20.60move_outs.60.20computation.20lazilly.html#133016823">(Aug 29 2018 at 19:30)</a>:</h4>
<p>yes</p>



<a name="133016831"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353394%20do%20%60move_outs%60%20computation%20lazilly/near/133016831" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353394.20do.20.60move_outs.60.20computation.20lazilly.html#133016831">(Aug 29 2018 at 19:30)</a>:</h4>
<p>I guess nightly isn't <em>wrong</em></p>



<a name="133016842"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353394%20do%20%60move_outs%60%20computation%20lazilly/near/133016842" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353394.20do.20.60move_outs.60.20computation.20lazilly.html#133016842">(Aug 29 2018 at 19:30)</a>:</h4>
<p>all three of those moves consume the same value</p>



<a name="133016844"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353394%20do%20%60move_outs%60%20computation%20lazilly/near/133016844" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353394.20do.20.60move_outs.60.20computation.20lazilly.html#133016844">(Aug 29 2018 at 19:30)</a>:</h4>
<p>that we are trying to later read</p>



<a name="133016855"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353394%20do%20%60move_outs%60%20computation%20lazilly/near/133016855" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353394.20do.20.60move_outs.60.20computation.20lazilly.html#133016855">(Aug 29 2018 at 19:30)</a>:</h4>
<p>yeah so I can just update the stderr file and done?</p>



<a name="133016857"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353394%20do%20%60move_outs%60%20computation%20lazilly/near/133016857" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353394.20do.20.60move_outs.60.20computation.20lazilly.html#133016857">(Aug 29 2018 at 19:30)</a>:</h4>
<p>debatable</p>



<a name="133016859"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353394%20do%20%60move_outs%60%20computation%20lazilly/near/133016859" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353394.20do.20.60move_outs.60.20computation.20lazilly.html#133016859">(Aug 29 2018 at 19:30)</a>:</h4>
<p>either that or update the code :)</p>



<a name="133016862"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353394%20do%20%60move_outs%60%20computation%20lazilly/near/133016862" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353394.20do.20.60move_outs.60.20computation.20lazilly.html#133016862">(Aug 29 2018 at 19:30)</a>:</h4>
<p>I can't decide which is more correct :)</p>



<a name="133016869"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353394%20do%20%60move_outs%60%20computation%20lazilly/near/133016869" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353394.20do.20.60move_outs.60.20computation.20lazilly.html#133016869">(Aug 29 2018 at 19:31)</a>:</h4>
<p>the code?</p>



<a name="133016878"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353394%20do%20%60move_outs%60%20computation%20lazilly/near/133016878" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353394.20do.20.60move_outs.60.20computation.20lazilly.html#133016878">(Aug 29 2018 at 19:31)</a>:</h4>
<p>you mean, the test?</p>



<a name="133016882"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353394%20do%20%60move_outs%60%20computation%20lazilly/near/133016882" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353394.20do.20.60move_outs.60.20computation.20lazilly.html#133016882">(Aug 29 2018 at 19:31)</a>:</h4>
<p>no</p>



<a name="133016884"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353394%20do%20%60move_outs%60%20computation%20lazilly/near/133016884" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353394.20do.20.60move_outs.60.20computation.20lazilly.html#133016884">(Aug 29 2018 at 19:31)</a>:</h4>
<p>ahh ok</p>



<a name="133016887"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353394%20do%20%60move_outs%60%20computation%20lazilly/near/133016887" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353394.20do.20.60move_outs.60.20computation.20lazilly.html#133016887">(Aug 29 2018 at 19:31)</a>:</h4>
<p>you could update your reverse DFS to keep going after it finds a move</p>



<a name="133016892"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353394%20do%20%60move_outs%60%20computation%20lazilly/near/133016892" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353394.20do.20.60move_outs.60.20computation.20lazilly.html#133016892">(Aug 29 2018 at 19:31)</a>:</h4>
<p>then I think the result will match</p>



<a name="133016894"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353394%20do%20%60move_outs%60%20computation%20lazilly/near/133016894" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353394.20do.20.60move_outs.60.20computation.20lazilly.html#133016894">(Aug 29 2018 at 19:31)</a>:</h4>
<p>thought you were saying that it was better :)</p>



<a name="133016953"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353394%20do%20%60move_outs%60%20computation%20lazilly/near/133016953" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353394.20do.20.60move_outs.60.20computation.20lazilly.html#133016953">(Aug 29 2018 at 19:32)</a>:</h4>
<p>I was but now I'm debating :)</p>



<a name="133016959"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353394%20do%20%60move_outs%60%20computation%20lazilly/near/133016959" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353394.20do.20.60move_outs.60.20computation.20lazilly.html#133016959">(Aug 29 2018 at 19:32)</a>:</h4>
<p>I could go either way, I suppose</p>



<a name="133016960"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353394%20do%20%60move_outs%60%20computation%20lazilly/near/133016960" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353394.20do.20.60move_outs.60.20computation.20lazilly.html#133016960">(Aug 29 2018 at 19:32)</a>:</h4>
<p>but it seems like the new output is "less busy"</p>



<a name="133016964"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353394%20do%20%60move_outs%60%20computation%20lazilly/near/133016964" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353394.20do.20.60move_outs.60.20computation.20lazilly.html#133016964">(Aug 29 2018 at 19:32)</a>:</h4>
<p>so it's probably better</p>



<a name="133016972"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353394%20do%20%60move_outs%60%20computation%20lazilly/near/133016972" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353394.20do.20.60move_outs.60.20computation.20lazilly.html#133016972">(Aug 29 2018 at 19:32)</a>:</h4>
<p>the scenario is sort of artificial</p>



<a name="133016988"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353394%20do%20%60move_outs%60%20computation%20lazilly/near/133016988" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353394.20do.20.60move_outs.60.20computation.20lazilly.html#133016988">(Aug 29 2018 at 19:33)</a>:</h4>
<p>ok well I verified that if you do</p>
<div class="codehilite"><pre><span></span>athena. git diff
<span class="gh">diff --git a/src/libcompiler_builtins b/src/libcompiler_builtins</span>
<span class="gd">--- a/src/libcompiler_builtins</span>
<span class="gi">+++ b/src/libcompiler_builtins</span>
<span class="gu">@@ -1 +1 @@</span>
<span class="gd">-Subproject commit d549d85b1735dc5066b2973f8549557a813bb9c8</span>
<span class="gi">+Subproject commit d549d85b1735dc5066b2973f8549557a813bb9c8-dirty</span>
<span class="gh">diff --git a/src/librustc_mir/borrow_check/error_reporting.rs b/src/librustc_mir/borrow_check/error_reporting.rs</span>
<span class="gh">index 818e76957f..28daca5268 100644</span>
<span class="gd">--- a/src/librustc_mir/borrow_check/error_reporting.rs</span>
<span class="gi">+++ b/src/librustc_mir/borrow_check/error_reporting.rs</span>
<span class="gu">@@ -554,7 +554,6 @@ impl&lt;&#39;cx, &#39;gcx, &#39;tcx&gt; MirBorrowckCtxt&lt;&#39;cx, &#39;gcx, &#39;tcx&gt; {</span>
                     if self.move_data.moves[*moi].path == mpi {
                         debug!(&quot;report_use_of_moved_or_uninitialized: found&quot;);
                         result.push(*moi);
<span class="gd">-                        continue &#39;dfs;</span>
                     }
                 }
             }
</pre></div>



<a name="133016991"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353394%20do%20%60move_outs%60%20computation%20lazilly/near/133016991" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353394.20do.20.60move_outs.60.20computation.20lazilly.html#133016991">(Aug 29 2018 at 19:33)</a>:</h4>
<p>then you get the original output :)</p>



<a name="133016999"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353394%20do%20%60move_outs%60%20computation%20lazilly/near/133016999" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353394.20do.20.60move_outs.60.20computation.20lazilly.html#133016999">(Aug 29 2018 at 19:33)</a>:</h4>
<p>but I think I agree that your new output is better</p>



<a name="133017000"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353394%20do%20%60move_outs%60%20computation%20lazilly/near/133017000" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353394.20do.20.60move_outs.60.20computation.20lazilly.html#133017000">(Aug 29 2018 at 19:33)</a>:</h4>
<p>in particular</p>



<a name="133017009"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353394%20do%20%60move_outs%60%20computation%20lazilly/near/133017009" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353394.20do.20.60move_outs.60.20computation.20lazilly.html#133017009">(Aug 29 2018 at 19:33)</a>:</h4>
<p>if there is a scenario where you have two moves A and B</p>



<a name="133017013"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353394%20do%20%60move_outs%60%20computation%20lazilly/near/133017013" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353394.20do.20.60move_outs.60.20computation.20lazilly.html#133017013">(Aug 29 2018 at 19:33)</a>:</h4>
<p>both of which can reach this point</p>



<a name="133017015"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353394%20do%20%60move_outs%60%20computation%20lazilly/near/133017015" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353394.20do.20.60move_outs.60.20computation.20lazilly.html#133017015">(Aug 29 2018 at 19:33)</a>:</h4>
<p>but A also reaches B</p>



<a name="133017019"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353394%20do%20%60move_outs%60%20computation%20lazilly/near/133017019" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353394.20do.20.60move_outs.60.20computation.20lazilly.html#133017019">(Aug 29 2018 at 19:33)</a>:</h4>
<p>(which is what happens here)</p>



<a name="133017035"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353394%20do%20%60move_outs%60%20computation%20lazilly/near/133017035" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353394.20do.20.60move_outs.60.20computation.20lazilly.html#133017035">(Aug 29 2018 at 19:33)</a>:</h4>
<p>then there are really two errors: one is that the move B is illegal</p>



<a name="133017039"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353394%20do%20%60move_outs%60%20computation%20lazilly/near/133017039" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353394.20do.20.60move_outs.60.20computation.20lazilly.html#133017039">(Aug 29 2018 at 19:34)</a>:</h4>
<p>and the current point is <em>also</em> illegal</p>



<a name="133017090"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353394%20do%20%60move_outs%60%20computation%20lazilly/near/133017090" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353394.20do.20.60move_outs.60.20computation.20lazilly.html#133017090">(Aug 29 2018 at 19:34)</a>:</h4>
<p>we are currently showing both A and B for the current move, but that seems kind of redundant</p>



<a name="133017109"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353394%20do%20%60move_outs%60%20computation%20lazilly/near/133017109" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353394.20do.20.60move_outs.60.20computation.20lazilly.html#133017109">(Aug 29 2018 at 19:34)</a>:</h4>
<p>(not sure if that makes sense the way I'm describing it... in this example, my point is that only the most recent <code>self.x</code> is relevant to <em>this</em> error -- the other <code>self.x</code> accesses cause other errors)</p>



<a name="133017120"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353394%20do%20%60move_outs%60%20computation%20lazilly/near/133017120" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353394.20do.20.60move_outs.60.20computation.20lazilly.html#133017120">(Aug 29 2018 at 19:35)</a>:</h4>
<p>so yeah I guess I think you should update the stderr but maybe we should leave a comment or something</p>



<a name="133017167"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353394%20do%20%60move_outs%60%20computation%20lazilly/near/133017167" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353394.20do.20.60move_outs.60.20computation.20lazilly.html#133017167">(Aug 29 2018 at 19:36)</a>:</h4>
<p>saying something like:</p>
<hr>
<div class="codehilite"><pre><span></span>// Strictly speaking, we could continue our DFS here. There may be
// other moves that can reach the point of error. But it is kind of confusing
// to highlight them.
//
// Example:
//
// ```
// let a = vec![];
// let b = a;
// let c = a;
// drop(a); // &lt;-- current point of error
// ```
//
// Because we stop the DFS here, we only highlight `let c = a`,
// and not `let b = a`. We will of course also report an error at `let c = a`
// which highlights `let b = a` as the move.
</pre></div>



<a name="133017873"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353394%20do%20%60move_outs%60%20computation%20lazilly/near/133017873" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jake Goulding <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353394.20do.20.60move_outs.60.20computation.20lazilly.html#133017873">(Aug 29 2018 at 19:49)</a>:</h4>
<p>I think reporting just the first "bad move" makes sense from a user POV. I don't think I'd want to see 30x "it also isn't available here". I'm sure some user will disagree, of course <span class="emoji emoji-1f609" title="wink">:wink:</span></p>



<a name="133063849"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353394%20do%20%60move_outs%60%20computation%20lazilly/near/133063849" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353394.20do.20.60move_outs.60.20computation.20lazilly.html#133063849">(Aug 30 2018 at 14:30)</a>:</h4>
<p>hey</p>



<a name="133063851"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353394%20do%20%60move_outs%60%20computation%20lazilly/near/133063851" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353394.20do.20.60move_outs.60.20computation.20lazilly.html#133063851">(Aug 30 2018 at 14:30)</a>:</h4>
<p>cool <span class="emoji emoji-1f44d" title="+1">:+1:</span></p>



<a name="133063856"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353394%20do%20%60move_outs%60%20computation%20lazilly/near/133063856" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353394.20do.20.60move_outs.60.20computation.20lazilly.html#133063856">(Aug 30 2018 at 14:30)</a>:</h4>
<p>gonna make the changes</p>



<a name="133063973"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353394%20do%20%60move_outs%60%20computation%20lazilly/near/133063973" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353394.20do.20.60move_outs.60.20computation.20lazilly.html#133063973">(Aug 30 2018 at 14:32)</a>:</h4>
<p><span class="user-mention" data-user-id="116009">@nikomatsakis</span> do you know how to reproduce the thing locally?</p>



<a name="133063978"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353394%20do%20%60move_outs%60%20computation%20lazilly/near/133063978" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353394.20do.20.60move_outs.60.20computation.20lazilly.html#133063978">(Aug 30 2018 at 14:32)</a>:</h4>
<p>reproduce..what?</p>



<a name="133063988"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353394%20do%20%60move_outs%60%20computation%20lazilly/near/133063988" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353394.20do.20.60move_outs.60.20computation.20lazilly.html#133063988">(Aug 30 2018 at 14:32)</a>:</h4>
<p>I mean, I 'd run with bless but current test runs in my local machine do not fail</p>



<a name="133063989"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353394%20do%20%60move_outs%60%20computation%20lazilly/near/133063989" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353394.20do.20.60move_outs.60.20computation.20lazilly.html#133063989">(Aug 30 2018 at 14:32)</a>:</h4>
<p>I mean just running <code>./x.py test src/test/ui</code> will work</p>



<a name="133063994"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353394%20do%20%60move_outs%60%20computation%20lazilly/near/133063994" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353394.20do.20.60move_outs.60.20computation.20lazilly.html#133063994">(Aug 30 2018 at 14:32)</a>:</h4>
<p>do you want me to run with <code>--bless</code>?</p>



<a name="133064007"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353394%20do%20%60move_outs%60%20computation%20lazilly/near/133064007" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353394.20do.20.60move_outs.60.20computation.20lazilly.html#133064007">(Aug 30 2018 at 14:33)</a>:</h4>
<p>(I have it all setup)</p>



<a name="133064019"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353394%20do%20%60move_outs%60%20computation%20lazilly/near/133064019" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353394.20do.20.60move_outs.60.20computation.20lazilly.html#133064019">(Aug 30 2018 at 14:33)</a>:</h4>
<p>I mean, I don't know why that test on my machine does not fail</p>



<a name="133064038"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353394%20do%20%60move_outs%60%20computation%20lazilly/near/133064038" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353394.20do.20.60move_outs.60.20computation.20lazilly.html#133064038">(Aug 30 2018 at 14:33)</a>:</h4>
<p>unsure what are you doing to make <code>./x.py test src/test/ui</code> fail</p>



<a name="133064064"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353394%20do%20%60move_outs%60%20computation%20lazilly/near/133064064" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353394.20do.20.60move_outs.60.20computation.20lazilly.html#133064064">(Aug 30 2018 at 14:33)</a>:</h4>
<p>hmm the actual command I ran was <code>./x.py test --stage 2 -i src/test/ui/</code></p>



<a name="133064109"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353394%20do%20%60move_outs%60%20computation%20lazilly/near/133064109" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353394.20do.20.60move_outs.60.20computation.20lazilly.html#133064109">(Aug 30 2018 at 14:34)</a>:</h4>
<p>it failed in the NLL compare-mode part</p>



<a name="133064112"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353394%20do%20%60move_outs%60%20computation%20lazilly/near/133064112" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353394.20do.20.60move_outs.60.20computation.20lazilly.html#133064112">(Aug 30 2018 at 14:34)</a>:</h4>
<p>ok, right it was on stage 2</p>



<a name="133064124"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353394%20do%20%60move_outs%60%20computation%20lazilly/near/133064124" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353394.20do.20.60move_outs.60.20computation.20lazilly.html#133064124">(Aug 30 2018 at 14:34)</a>:</h4>
<p>well I think you said that wasn't related to stage 2</p>



<a name="133064127"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353394%20do%20%60move_outs%60%20computation%20lazilly/near/133064127" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353394.20do.20.60move_outs.60.20computation.20lazilly.html#133064127">(Aug 30 2018 at 14:34)</a>:</h4>
<p>it's not</p>



<a name="133064134"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353394%20do%20%60move_outs%60%20computation%20lazilly/near/133064134" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353394.20do.20.60move_outs.60.20computation.20lazilly.html#133064134">(Aug 30 2018 at 14:34)</a>:</h4>
<p>but if you run with stage1, another test fails (the macro thing)</p>



<a name="133064137"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353394%20do%20%60move_outs%60%20computation%20lazilly/near/133064137" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353394.20do.20.60move_outs.60.20computation.20lazilly.html#133064137">(Aug 30 2018 at 14:34)</a>:</h4>
<p>I guess it's just that doing that is when the compare-mode part is ran?</p>



<a name="133064138"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353394%20do%20%60move_outs%60%20computation%20lazilly/near/133064138" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353394.20do.20.60move_outs.60.20computation.20lazilly.html#133064138">(Aug 30 2018 at 14:34)</a>:</h4>
<p>this prevents us from running in NLL compare-mode</p>



<a name="133064141"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353394%20do%20%60move_outs%60%20computation%20lazilly/near/133064141" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353394.20do.20.60move_outs.60.20computation.20lazilly.html#133064141">(Aug 30 2018 at 14:34)</a>:</h4>
<p>ahhhh</p>



<a name="133064143"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353394%20do%20%60move_outs%60%20computation%20lazilly/near/133064143" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353394.20do.20.60move_outs.60.20computation.20lazilly.html#133064143">(Aug 30 2018 at 14:34)</a>:</h4>
<p>got it got it</p>



<a name="133064151"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353394%20do%20%60move_outs%60%20computation%20lazilly/near/133064151" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353394.20do.20.60move_outs.60.20computation.20lazilly.html#133064151">(Aug 30 2018 at 14:35)</a>:</h4>
<p>that was my missing bit</p>



<a name="133064153"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353394%20do%20%60move_outs%60%20computation%20lazilly/near/133064153" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353394.20do.20.60move_outs.60.20computation.20lazilly.html#133064153">(Aug 30 2018 at 14:35)</a>:</h4>
<p>ok</p>



<a name="133064172"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353394%20do%20%60move_outs%60%20computation%20lazilly/near/133064172" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353394.20do.20.60move_outs.60.20computation.20lazilly.html#133064172">(Aug 30 2018 at 14:35)</a>:</h4>
<p>so I can do the <code>--bless</code> if you want to add the comment :)</p>



<a name="133064175"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353394%20do%20%60move_outs%60%20computation%20lazilly/near/133064175" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353394.20do.20.60move_outs.60.20computation.20lazilly.html#133064175">(Aug 30 2018 at 14:35)</a>:</h4>
<p>I already started it anyway</p>



<a name="133064185"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353394%20do%20%60move_outs%60%20computation%20lazilly/near/133064185" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353394.20do.20.60move_outs.60.20computation.20lazilly.html#133064185">(Aug 30 2018 at 14:35)</a>:</h4>
<p>actually though I did have a local diff so it'll have to rebuild</p>



<a name="133064187"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353394%20do%20%60move_outs%60%20computation%20lazilly/near/133064187" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353394.20do.20.60move_outs.60.20computation.20lazilly.html#133064187">(Aug 30 2018 at 14:35)</a>:</h4>
<p>but it goes relatively fast locally</p>



<a name="133064191"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353394%20do%20%60move_outs%60%20computation%20lazilly/near/133064191" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353394.20do.20.60move_outs.60.20computation.20lazilly.html#133064191">(Aug 30 2018 at 14:35)</a>:</h4>
<p><span class="emoji emoji-1f44d" title="+1">:+1:</span></p>



<a name="133088087"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353394%20do%20%60move_outs%60%20computation%20lazilly/near/133088087" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353394.20do.20.60move_outs.60.20computation.20lazilly.html#133088087">(Aug 30 2018 at 21:39)</a>:</h4>
<p><span class="user-mention" data-user-id="116009">@nikomatsakis</span> I've realized that I haven't added the comment you suggested</p>



<a name="133088092"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353394%20do%20%60move_outs%60%20computation%20lazilly/near/133088092" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353394.20do.20.60move_outs.60.20computation.20lazilly.html#133088092">(Aug 30 2018 at 21:39)</a>:</h4>
<p>did that</p>



<a name="133088096"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353394%20do%20%60move_outs%60%20computation%20lazilly/near/133088096" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353394.20do.20.60move_outs.60.20computation.20lazilly.html#133088096">(Aug 30 2018 at 21:40)</a>:</h4>
<p>should now be ready to +1 I guess</p>



<a name="133147605"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353394%20do%20%60move_outs%60%20computation%20lazilly/near/133147605" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353394.20do.20.60move_outs.60.20computation.20lazilly.html#133147605">(Aug 31 2018 at 20:46)</a>:</h4>
<p><span class="user-mention" data-user-id="116009">@nikomatsakis</span> just ended with this thing compiling</p>



<a name="133147612"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353394%20do%20%60move_outs%60%20computation%20lazilly/near/133147612" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353394.20do.20.60move_outs.60.20computation.20lazilly.html#133147612">(Aug 31 2018 at 20:46)</a>:</h4>
<p>I mean, have pasted the old code, the one related to <code>MovingOutStatements</code> back and it's compiling</p>



<a name="133147631"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353394%20do%20%60move_outs%60%20computation%20lazilly/near/133147631" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353394.20do.20.60move_outs.60.20computation.20lazilly.html#133147631">(Aug 31 2018 at 20:47)</a>:</h4>
<p>uh :)</p>



<a name="133147633"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353394%20do%20%60move_outs%60%20computation%20lazilly/near/133147633" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353394.20do.20.60move_outs.60.20computation.20lazilly.html#133147633">(Aug 31 2018 at 20:47)</a>:</h4>
<p>not sure what you mean :)</p>



<a name="133147638"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353394%20do%20%60move_outs%60%20computation%20lazilly/near/133147638" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353394.20do.20.60move_outs.60.20computation.20lazilly.html#133147638">(Aug 31 2018 at 20:47)</a>:</h4>
<p>doesn't matter :)</p>



<a name="133147642"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353394%20do%20%60move_outs%60%20computation%20lazilly/near/133147642" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353394.20do.20.60move_outs.60.20computation.20lazilly.html#133147642">(Aug 31 2018 at 20:47)</a>:</h4>
<p>so</p>



<a name="133147688"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353394%20do%20%60move_outs%60%20computation%20lazilly/near/133147688" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353394.20do.20.60move_outs.60.20computation.20lazilly.html#133147688">(Aug 31 2018 at 20:48)</a>:</h4>
<p>do you remember that we removed the <code>MovingOutStatements</code> ?</p>



<a name="133147692"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353394%20do%20%60move_outs%60%20computation%20lazilly/near/133147692" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353394.20do.20.60move_outs.60.20computation.20lazilly.html#133147692">(Aug 31 2018 at 20:48)</a>:</h4>
<p>was getting the code back</p>



<a name="133147696"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353394%20do%20%60move_outs%60%20computation%20lazilly/near/133147696" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353394.20do.20.60move_outs.60.20computation.20lazilly.html#133147696">(Aug 31 2018 at 20:48)</a>:</h4>
<p>was compiling that meanwhile I was doing other stuff</p>



<a name="133147698"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353394%20do%20%60move_outs%60%20computation%20lazilly/near/133147698" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353394.20do.20.60move_outs.60.20computation.20lazilly.html#133147698">(Aug 31 2018 at 20:48)</a>:</h4>
<p>now back to the real task</p>



<a name="133147705"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353394%20do%20%60move_outs%60%20computation%20lazilly/near/133147705" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353394.20do.20.60move_outs.60.20computation.20lazilly.html#133147705">(Aug 31 2018 at 20:48)</a>:</h4>
<p>I guess we want to provide for <code>BitDenotation</code> a dfs method that receives a fn</p>



<a name="133147715"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353394%20do%20%60move_outs%60%20computation%20lazilly/near/133147715" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353394.20do.20.60move_outs.60.20computation.20lazilly.html#133147715">(Aug 31 2018 at 20:49)</a>:</h4>
<p>and then we call that for the <code>MovingOutStatements</code> specific thing we are doing in this issue</p>



<a name="133147732"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353394%20do%20%60move_outs%60%20computation%20lazilly/near/133147732" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353394.20do.20.60move_outs.60.20computation.20lazilly.html#133147732">(Aug 31 2018 at 20:49)</a>:</h4>
<p>yes, I imagined writing a function sort of like this (not sure exactly where it would go)</p>



<a name="133147791"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353394%20do%20%60move_outs%60%20computation%20lazilly/near/133147791" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353394.20do.20.60move_outs.60.20computation.20lazilly.html#133147791">(Aug 31 2018 at 20:50)</a>:</h4>
<div class="codehilite"><pre><span></span><span class="k">fn</span> <span class="nf">find_values_in_scope</span><span class="o">&lt;</span><span class="n">BD</span>: <span class="nc">BitDenotation</span><span class="o">&gt;</span><span class="p">(</span><span class="w"></span>
<span class="w">    </span><span class="n">bit</span>: <span class="kp">&amp;</span><span class="nc">BD</span><span class="p">,</span><span class="w"></span>
<span class="w">    </span><span class="n">mir</span>: <span class="kp">&amp;</span><span class="nc">Mir</span><span class="o">&lt;</span><span class="na">&#39;tcx</span><span class="o">&gt;</span><span class="p">,</span><span class="w"></span>
<span class="w">    </span><span class="n">location</span>: <span class="nc">Location</span><span class="p">,</span><span class="w"></span>
<span class="p">)</span><span class="w"> </span>-&gt; <span class="nb">Vec</span><span class="o">&lt;</span><span class="n">BD</span>::<span class="n">Value</span><span class="o">&gt;</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="p">...</span><span class="w"> </span><span class="p">}</span><span class="w"></span>
</pre></div>



<a name="133147794"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353394%20do%20%60move_outs%60%20computation%20lazilly/near/133147794" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353394.20do.20.60move_outs.60.20computation.20lazilly.html#133147794">(Aug 31 2018 at 20:50)</a>:</h4>
<p>it would work fairly similarly to what you have</p>



<a name="133147796"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353394%20do%20%60move_outs%60%20computation%20lazilly/near/133147796" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353394.20do.20.60move_outs.60.20computation.20lazilly.html#133147796">(Aug 31 2018 at 20:50)</a>:</h4>
<p>but not be hard-coded to any one thing</p>



<a name="133148108"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353394%20do%20%60move_outs%60%20computation%20lazilly/near/133148108" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353394.20do.20.60move_outs.60.20computation.20lazilly.html#133148108">(Aug 31 2018 at 20:57)</a>:</h4>
<p>yes</p>



<a name="133148109"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353394%20do%20%60move_outs%60%20computation%20lazilly/near/133148109" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353394.20do.20.60move_outs.60.20computation.20lazilly.html#133148109">(Aug 31 2018 at 20:57)</a>:</h4>
<p>but ... wouldn't that be inside of the trait?</p>



<a name="133148110"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353394%20do%20%60move_outs%60%20computation%20lazilly/near/133148110" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353394.20do.20.60move_outs.60.20computation.20lazilly.html#133148110">(Aug 31 2018 at 20:57)</a>:</h4>
<p>or I guessed it wrongly?</p>



<a name="133148111"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353394%20do%20%60move_outs%60%20computation%20lazilly/near/133148111" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353394.20do.20.60move_outs.60.20computation.20lazilly.html#133148111">(Aug 31 2018 at 20:57)</a>:</h4>
<p>ahh I see what you mean</p>



<a name="133148208"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353394%20do%20%60move_outs%60%20computation%20lazilly/near/133148208" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353394.20do.20.60move_outs.60.20computation.20lazilly.html#133148208">(Aug 31 2018 at 20:59)</a>:</h4>
<p>the fn is not part of the trait, it's just a fn that uses this kind of types</p>



<a name="133148222"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353394%20do%20%60move_outs%60%20computation%20lazilly/near/133148222" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353394.20do.20.60move_outs.60.20computation.20lazilly.html#133148222">(Aug 31 2018 at 20:59)</a>:</h4>
<p>I probably didn't pay that much attention of what the trait is about</p>



<a name="133148237"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353394%20do%20%60move_outs%60%20computation%20lazilly/near/133148237" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353394.20do.20.60move_outs.60.20computation.20lazilly.html#133148237">(Aug 31 2018 at 20:59)</a>:</h4>
<p>but at first I thought you wanted to add the fn as a fn of the trait with a default impl</p>



<a name="133148409"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353394%20do%20%60move_outs%60%20computation%20lazilly/near/133148409" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353394.20do.20.60move_outs.60.20computation.20lazilly.html#133148409">(Aug 31 2018 at 21:02)</a>:</h4>
<p>we could do that</p>



<a name="133148410"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353394%20do%20%60move_outs%60%20computation%20lazilly/near/133148410" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353394.20do.20.60move_outs.60.20computation.20lazilly.html#133148410">(Aug 31 2018 at 21:02)</a>:</h4>
<p>I'd probably make it a standalone thing</p>



<a name="133148417"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353394%20do%20%60move_outs%60%20computation%20lazilly/near/133148417" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353394.20do.20.60move_outs.60.20computation.20lazilly.html#133148417">(Aug 31 2018 at 21:02)</a>:</h4>
<p>probably living in <code>rustc_mir::dataflow</code> though</p>



<a name="133148431"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353394%20do%20%60move_outs%60%20computation%20lazilly/near/133148431" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353394.20do.20.60move_outs.60.20computation.20lazilly.html#133148431">(Aug 31 2018 at 21:03)</a>:</h4>
<p>sort of analogous to <a href="https://doc.rust-lang.org/nightly/nightly-rustc/rustc_mir/dataflow/fn.do_dataflow.html" target="_blank" title="https://doc.rust-lang.org/nightly/nightly-rustc/rustc_mir/dataflow/fn.do_dataflow.html"><code>do_dataflow</code></a></p>



<a name="133148507"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353394%20do%20%60move_outs%60%20computation%20lazilly/near/133148507" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353394.20do.20.60move_outs.60.20computation.20lazilly.html#133148507">(Aug 31 2018 at 21:04)</a>:</h4>
<p><span class="emoji emoji-1f44d" title="+1">:+1:</span></p>



<hr><p>Last updated: Apr 12 2022 at 20:01 UTC</p>
</html>