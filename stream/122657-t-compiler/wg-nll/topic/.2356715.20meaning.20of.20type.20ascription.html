<html>
<head><meta charset="utf-8"><title>#56715 meaning of type ascription · t-compiler/wg-nll · Zulip Chat Archive</title></head>
<h2>Stream: <a href="https://rust-lang.github.io/zulip_archive/stream/122657-t-compiler/wg-nll/index.html">t-compiler/wg-nll</a></h2>
<h3>Topic: <a href="https://rust-lang.github.io/zulip_archive/stream/122657-t-compiler/wg-nll/topic/.2356715.20meaning.20of.20type.20ascription.html">#56715 meaning of type ascription</a></h3>

<hr>

<base href="https://rust-lang.zulipchat.com">

<head><link href="https://rust-lang.github.io/zulip_archive/style.css" rel="stylesheet"></head>

<a name="152030317"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2356715%20meaning%20of%20type%20ascription/near/152030317" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://rust-lang.github.io/zulip_archive/stream/122657-t-compiler/wg-nll/topic/.2356715.20meaning.20of.20type.20ascription.html#152030317">(Dec 17 2018 at 14:20)</a>:</h4>
<p><span class="user-mention" data-user-id="116083">@pnkfelix</span> so the complication with <code>expr: T</code> and the meaning there had to do with <code>ref mut</code> bindings and the potential unsoundness around them. Overall I would say that this effort to move to MIR is forcing us to take a good, hard look at what our <code>: T</code> ascriptions mean in general, and it feels like the answer is "it's complicated".</p>
<p>Anyway the bug we were worried about was something like</p>
<div class="codehilite"><pre><span></span>let ref mut x: T = y;
</pre></div>


<p>this had the semantics of making <code>x</code> be an <code>&amp;mut T</code> that refers to <code>y</code> -- but if we have that the type <code>T_y</code> or <code>y</code> is <em>some subtype</em> of <code>T</code>, that's unsound, for the standard variance reasons.</p>



<a name="152030333"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2356715%20meaning%20of%20type%20ascription/near/152030333" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://rust-lang.github.io/zulip_archive/stream/122657-t-compiler/wg-nll/topic/.2356715.20meaning.20of.20type.20ascription.html#152030333">(Dec 17 2018 at 14:21)</a>:</h4>
<p>same would presumably be true of <code>let ref mut x = y: T</code></p>



<a name="152030368"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2356715%20meaning%20of%20type%20ascription/near/152030368" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://rust-lang.github.io/zulip_archive/stream/122657-t-compiler/wg-nll/topic/.2356715.20meaning.20of.20type.20ascription.html#152030368">(Dec 17 2018 at 14:21)</a>:</h4>
<p>the current rule around the <code>: T</code> ascriptions is that "if the pattern includes a ref binding, then it forces strict equality", and we .. probably? .. need to do something similar around <code>y: T</code> expressions --</p>



<a name="152030431"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2356715%20meaning%20of%20type%20ascription/near/152030431" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> pnkfelix <a href="https://rust-lang.github.io/zulip_archive/stream/122657-t-compiler/wg-nll/topic/.2356715.20meaning.20of.20type.20ascription.html#152030431">(Dec 17 2018 at 14:22)</a>:</h4>
<p>I guess my Q is</p>



<a name="152030435"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2356715%20meaning%20of%20type%20ascription/near/152030435" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://rust-lang.github.io/zulip_archive/stream/122657-t-compiler/wg-nll/topic/.2356715.20meaning.20of.20type.20ascription.html#152030435">(Dec 17 2018 at 14:22)</a>:</h4>
<p>that is, we could either (a) not consider them a place expression or (b) distinguish between the effect of a <code>:T</code> ascription in the context of a place (borrow) vs a use</p>



<a name="152030442"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2356715%20meaning%20of%20type%20ascription/near/152030442" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> pnkfelix <a href="https://rust-lang.github.io/zulip_archive/stream/122657-t-compiler/wg-nll/topic/.2356715.20meaning.20of.20type.20ascription.html#152030442">(Dec 17 2018 at 14:22)</a>:</h4>
<p>would it be so bad to use strict equality everywhere?</p>



<a name="152030446"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2356715%20meaning%20of%20type%20ascription/near/152030446" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://rust-lang.github.io/zulip_archive/stream/122657-t-compiler/wg-nll/topic/.2356715.20meaning.20of.20type.20ascription.html#152030446">(Dec 17 2018 at 14:22)</a>:</h4>
<p>well</p>



<a name="152030455"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2356715%20meaning%20of%20type%20ascription/near/152030455" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://rust-lang.github.io/zulip_archive/stream/122657-t-compiler/wg-nll/topic/.2356715.20meaning.20of.20type.20ascription.html#152030455">(Dec 17 2018 at 14:22)</a>:</h4>
<p>it'd be backwards incompatible</p>



<a name="152030470"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2356715%20meaning%20of%20type%20ascription/near/152030470" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://rust-lang.github.io/zulip_archive/stream/122657-t-compiler/wg-nll/topic/.2356715.20meaning.20of.20type.20ascription.html#152030470">(Dec 17 2018 at 14:22)</a>:</h4>
<p>in a pretty major way</p>



<a name="152030475"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2356715%20meaning%20of%20type%20ascription/near/152030475" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> pnkfelix <a href="https://rust-lang.github.io/zulip_archive/stream/122657-t-compiler/wg-nll/topic/.2356715.20meaning.20of.20type.20ascription.html#152030475">(Dec 17 2018 at 14:22)</a>:</h4>
<p>(and rely on e.g. the moves/assignments  to do the subtyping)</p>



<a name="152030483"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2356715%20meaning%20of%20type%20ascription/near/152030483" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://rust-lang.github.io/zulip_archive/stream/122657-t-compiler/wg-nll/topic/.2356715.20meaning.20of.20type.20ascription.html#152030483">(Dec 17 2018 at 14:23)</a>:</h4>
<p>right now, <code>let x: T = ...</code> is more than subtyping -- it applies <em>coercions</em></p>



<a name="152030489"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2356715%20meaning%20of%20type%20ascription/near/152030489" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> pnkfelix <a href="https://rust-lang.github.io/zulip_archive/stream/122657-t-compiler/wg-nll/topic/.2356715.20meaning.20of.20type.20ascription.html#152030489">(Dec 17 2018 at 14:23)</a>:</h4>
<p>sure, but we get to maybe couple it with NLL migration</p>



<a name="152030504"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2356715%20meaning%20of%20type%20ascription/near/152030504" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://rust-lang.github.io/zulip_archive/stream/122657-t-compiler/wg-nll/topic/.2356715.20meaning.20of.20type.20ascription.html#152030504">(Dec 17 2018 at 14:23)</a>:</h4>
<p>I am not as worried about the subtyping thing as the coercions</p>



<a name="152030527"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2356715%20meaning%20of%20type%20ascription/near/152030527" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://rust-lang.github.io/zulip_archive/stream/122657-t-compiler/wg-nll/topic/.2356715.20meaning.20of.20type.20ascription.html#152030527">(Dec 17 2018 at 14:23)</a>:</h4>
<p>e.g., something like this</p>
<div class="codehilite"><pre><span></span>let x: &amp;[u32] = &amp;[1, 2, 3];
</pre></div>


<p>coerces from the type <code>&amp;[u32; 3]</code> to <code>&amp;[u32]</code></p>



<a name="152030602"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2356715%20meaning%20of%20type%20ascription/near/152030602" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://rust-lang.github.io/zulip_archive/stream/122657-t-compiler/wg-nll/topic/.2356715.20meaning.20of.20type.20ascription.html#152030602">(Dec 17 2018 at 14:24)</a>:</h4>
<p>but maybe you mean something.. <em>less</em> than that</p>



<a name="152030683"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2356715%20meaning%20of%20type%20ascription/near/152030683" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> pnkfelix <a href="https://rust-lang.github.io/zulip_archive/stream/122657-t-compiler/wg-nll/topic/.2356715.20meaning.20of.20type.20ascription.html#152030683">(Dec 17 2018 at 14:25)</a>:</h4>
<p>the stuff I'm talking about, I think, is just about whether to use <code>Variance::Covariant</code> or <code>Variance::Invariant</code> at certain points</p>



<a name="152030737"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2356715%20meaning%20of%20type%20ascription/near/152030737" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> pnkfelix <a href="https://rust-lang.github.io/zulip_archive/stream/122657-t-compiler/wg-nll/topic/.2356715.20meaning.20of.20type.20ascription.html#152030737">(Dec 17 2018 at 14:26)</a>:</h4>
<p>I guess I'm not clear on how that effects coercions. I would have thought it only affects <del>lifetime</del> region inference/checking.</p>



<a name="152030751"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2356715%20meaning%20of%20type%20ascription/near/152030751" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://rust-lang.github.io/zulip_archive/stream/122657-t-compiler/wg-nll/topic/.2356715.20meaning.20of.20type.20ascription.html#152030751">(Dec 17 2018 at 14:26)</a>:</h4>
<p>if we're only talking at the MIR locations</p>



<a name="152030753"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2356715%20meaning%20of%20type%20ascription/near/152030753" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://rust-lang.github.io/zulip_archive/stream/122657-t-compiler/wg-nll/topic/.2356715.20meaning.20of.20type.20ascription.html#152030753">(Dec 17 2018 at 14:26)</a>:</h4>
<p>then I agree</p>



<a name="152030775"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2356715%20meaning%20of%20type%20ascription/near/152030775" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://rust-lang.github.io/zulip_archive/stream/122657-t-compiler/wg-nll/topic/.2356715.20meaning.20of.20type.20ascription.html#152030775">(Dec 17 2018 at 14:26)</a>:</h4>
<p>but I guess I just want to fit it into my "overall view" of the type system</p>



<a name="152030778"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2356715%20meaning%20of%20type%20ascription/near/152030778" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> pnkfelix <a href="https://rust-lang.github.io/zulip_archive/stream/122657-t-compiler/wg-nll/topic/.2356715.20meaning.20of.20type.20ascription.html#152030778">(Dec 17 2018 at 14:26)</a>:</h4>
<p>Okay, yeah, when I said "everywhere", I guess I meant "everywhere in MIR"</p>



<a name="152030784"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2356715%20meaning%20of%20type%20ascription/near/152030784" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> pnkfelix <a href="https://rust-lang.github.io/zulip_archive/stream/122657-t-compiler/wg-nll/topic/.2356715.20meaning.20of.20type.20ascription.html#152030784">(Dec 17 2018 at 14:27)</a>:</h4>
<p>but not even that</p>



<a name="152030796"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2356715%20meaning%20of%20type%20ascription/near/152030796" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> pnkfelix <a href="https://rust-lang.github.io/zulip_archive/stream/122657-t-compiler/wg-nll/topic/.2356715.20meaning.20of.20type.20ascription.html#152030796">(Dec 17 2018 at 14:27)</a>:</h4>
<p>"on every type-ascription in the MIR"</p>



<a name="152030805"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2356715%20meaning%20of%20type%20ascription/near/152030805" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://rust-lang.github.io/zulip_archive/stream/122657-t-compiler/wg-nll/topic/.2356715.20meaning.20of.20type.20ascription.html#152030805">(Dec 17 2018 at 14:27)</a>:</h4>
<p>I'm also not entirely clear on the motivation</p>



<a name="152030814"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2356715%20meaning%20of%20type%20ascription/near/152030814" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> pnkfelix <a href="https://rust-lang.github.io/zulip_archive/stream/122657-t-compiler/wg-nll/topic/.2356715.20meaning.20of.20type.20ascription.html#152030814">(Dec 17 2018 at 14:27)</a>:</h4>
<p>well right now</p>



<a name="152030824"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2356715%20meaning%20of%20type%20ascription/near/152030824" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> pnkfelix <a href="https://rust-lang.github.io/zulip_archive/stream/122657-t-compiler/wg-nll/topic/.2356715.20meaning.20of.20type.20ascription.html#152030824">(Dec 17 2018 at 14:27)</a>:</h4>
<p>when I write <code>let x: T = RHS</code></p>



<a name="152030873"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2356715%20meaning%20of%20type%20ascription/near/152030873" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> pnkfelix <a href="https://rust-lang.github.io/zulip_archive/stream/122657-t-compiler/wg-nll/topic/.2356715.20meaning.20of.20type.20ascription.html#152030873">(Dec 17 2018 at 14:28)</a>:</h4>
<p>is that meant to be saying that <code>x</code> has some type <code>T'</code> that is a subtype of <code>T</code></p>



<a name="152030890"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2356715%20meaning%20of%20type%20ascription/near/152030890" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> pnkfelix <a href="https://rust-lang.github.io/zulip_archive/stream/122657-t-compiler/wg-nll/topic/.2356715.20meaning.20of.20type.20ascription.html#152030890">(Dec 17 2018 at 14:28)</a>:</h4>
<p>or that <code>x</code> has type <code>T</code> exactly</p>



<a name="152030905"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2356715%20meaning%20of%20type%20ascription/near/152030905" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> pnkfelix <a href="https://rust-lang.github.io/zulip_archive/stream/122657-t-compiler/wg-nll/topic/.2356715.20meaning.20of.20type.20ascription.html#152030905">(Dec 17 2018 at 14:28)</a>:</h4>
<p>(I'm not even sure myself, right now...)</p>



<a name="152030972"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2356715%20meaning%20of%20type%20ascription/near/152030972" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> pnkfelix <a href="https://rust-lang.github.io/zulip_archive/stream/122657-t-compiler/wg-nll/topic/.2356715.20meaning.20of.20type.20ascription.html#152030972">(Dec 17 2018 at 14:29)</a>:</h4>
<p>but the whole thing behind <a href="https://github.com/rust-lang/rust/issues/47184" target="_blank" title="https://github.com/rust-lang/rust/issues/47184">#47184</a> was that we needed to respect user type annotations</p>



<a name="152030986"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2356715%20meaning%20of%20type%20ascription/near/152030986" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://rust-lang.github.io/zulip_archive/stream/122657-t-compiler/wg-nll/topic/.2356715.20meaning.20of.20type.20ascription.html#152030986">(Dec 17 2018 at 14:29)</a>:</h4>
<blockquote>
<p>or that <code>x</code> has type <code>T</code> exactly</p>
</blockquote>
<p>there's another question too, right?</p>



<a name="152030987"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2356715%20meaning%20of%20type%20ascription/near/152030987" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> pnkfelix <a href="https://rust-lang.github.io/zulip_archive/stream/122657-t-compiler/wg-nll/topic/.2356715.20meaning.20of.20type.20ascription.html#152030987">(Dec 17 2018 at 14:29)</a>:</h4>
<p>and so I want to pin down what someone writing <code>unsafe</code> code can assume</p>



<a name="152030994"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2356715%20meaning%20of%20type%20ascription/near/152030994" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://rust-lang.github.io/zulip_archive/stream/122657-t-compiler/wg-nll/topic/.2356715.20meaning.20of.20type.20ascription.html#152030994">(Dec 17 2018 at 14:29)</a>:</h4>
<p>"what is the type of the <code>RHS</code>"</p>



<a name="152031038"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2356715%20meaning%20of%20type%20ascription/near/152031038" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> pnkfelix <a href="https://rust-lang.github.io/zulip_archive/stream/122657-t-compiler/wg-nll/topic/.2356715.20meaning.20of.20type.20ascription.html#152031038">(Dec 17 2018 at 14:30)</a>:</h4>
<p>yep</p>



<a name="152031046"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2356715%20meaning%20of%20type%20ascription/near/152031046" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://rust-lang.github.io/zulip_archive/stream/122657-t-compiler/wg-nll/topic/.2356715.20meaning.20of.20type.20ascription.html#152031046">(Dec 17 2018 at 14:30)</a>:</h4>
<p>i.e., what you are proposing seems to have nothing to do with the type of  <code>x</code></p>



<a name="152031054"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2356715%20meaning%20of%20type%20ascription/near/152031054" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://rust-lang.github.io/zulip_archive/stream/122657-t-compiler/wg-nll/topic/.2356715.20meaning.20of.20type.20ascription.html#152031054">(Dec 17 2018 at 14:30)</a>:</h4>
<p>and everything to do with <code>T_rhs</code></p>



<a name="152031062"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2356715%20meaning%20of%20type%20ascription/near/152031062" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> pnkfelix <a href="https://rust-lang.github.io/zulip_archive/stream/122657-t-compiler/wg-nll/topic/.2356715.20meaning.20of.20type.20ascription.html#152031062">(Dec 17 2018 at 14:30)</a>:</h4>
<p>well</p>



<a name="152031067"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2356715%20meaning%20of%20type%20ascription/near/152031067" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> pnkfelix <a href="https://rust-lang.github.io/zulip_archive/stream/122657-t-compiler/wg-nll/topic/.2356715.20meaning.20of.20type.20ascription.html#152031067">(Dec 17 2018 at 14:30)</a>:</h4>
<p>I was starting from my mental model</p>



<a name="152031083"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2356715%20meaning%20of%20type%20ascription/near/152031083" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://rust-lang.github.io/zulip_archive/stream/122657-t-compiler/wg-nll/topic/.2356715.20meaning.20of.20type.20ascription.html#152031083">(Dec 17 2018 at 14:30)</a>:</h4>
<p>my "intuitive feeling" is that:</p>
<ul>
<li><code>T</code> is meant to bound the type <code>T_x</code> of <code>x</code> <em>exactly</em> ("invariant")</li>
<li><code>T</code> is meant to be a supertype of <code>T_rhs</code> (or even a coercion target)</li>
</ul>



<a name="152031087"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2356715%20meaning%20of%20type%20ascription/near/152031087" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> pnkfelix <a href="https://rust-lang.github.io/zulip_archive/stream/122657-t-compiler/wg-nll/topic/.2356715.20meaning.20of.20type.20ascription.html#152031087">(Dec 17 2018 at 14:30)</a>:</h4>
<p>of why we are even passing <code>Variance::Covariant</code> at the point in the code that I identified in <a href="https://github.com/rust-lang/rust/issues/56715" target="_blank" title="https://github.com/rust-lang/rust/issues/56715">#56715</a></p>



<a name="152031124"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2356715%20meaning%20of%20type%20ascription/near/152031124" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://rust-lang.github.io/zulip_archive/stream/122657-t-compiler/wg-nll/topic/.2356715.20meaning.20of.20type.20ascription.html#152031124">(Dec 17 2018 at 14:31)</a>:</h4>
<p>but for more complex patterns, the first part gets tricky</p>



<a name="152031126"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2356715%20meaning%20of%20type%20ascription/near/152031126" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> pnkfelix <a href="https://rust-lang.github.io/zulip_archive/stream/122657-t-compiler/wg-nll/topic/.2356715.20meaning.20of.20type.20ascription.html#152031126">(Dec 17 2018 at 14:31)</a>:</h4>
<p>and that's why <em>I</em> was focusing on <code>let x: T</code></p>



<a name="152031141"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2356715%20meaning%20of%20type%20ascription/near/152031141" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://rust-lang.github.io/zulip_archive/stream/122657-t-compiler/wg-nll/topic/.2356715.20meaning.20of.20type.20ascription.html#152031141">(Dec 17 2018 at 14:31)</a>:</h4>
<p><em>and</em> for <code>ref</code> bindings and "place expressions" on the right-hand-side, the second part is tricky (we actually forbid coercions here I think)</p>



<a name="152031212"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2356715%20meaning%20of%20type%20ascription/near/152031212" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://rust-lang.github.io/zulip_archive/stream/122657-t-compiler/wg-nll/topic/.2356715.20meaning.20of.20type.20ascription.html#152031212">(Dec 17 2018 at 14:32)</a>:</h4>
<p>so my simple, "intuitive" formulation doesn't really capture all of it</p>



<a name="152031322"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2356715%20meaning%20of%20type%20ascription/near/152031322" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://rust-lang.github.io/zulip_archive/stream/122657-t-compiler/wg-nll/topic/.2356715.20meaning.20of.20type.20ascription.html#152031322">(Dec 17 2018 at 14:33)</a>:</h4>
<blockquote>
<p>of why we are even passing <code>Variance::Covariant</code> at the point in the code that I identified in <a href="https://github.com/rust-lang/rust/issues/56715" target="_blank" title="https://github.com/rust-lang/rust/issues/56715">#56715</a></p>
</blockquote>
<p>let me go double check which code you are referring to )</p>



<a name="152031620"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2356715%20meaning%20of%20type%20ascription/near/152031620" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://rust-lang.github.io/zulip_archive/stream/122657-t-compiler/wg-nll/topic/.2356715.20meaning.20of.20type.20ascription.html#152031620">(Dec 17 2018 at 14:37)</a>:</h4>
<p>ok, so, <span class="user-mention" data-user-id="116083">@pnkfelix</span> if I'm not mistaken we are talking more about the relationship of <code>T</code> to <code>T_rhs</code> than the type of <code>x</code></p>



<a name="152031633"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2356715%20meaning%20of%20type%20ascription/near/152031633" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> pnkfelix <a href="https://rust-lang.github.io/zulip_archive/stream/122657-t-compiler/wg-nll/topic/.2356715.20meaning.20of.20type.20ascription.html#152031633">(Dec 17 2018 at 14:37)</a>:</h4>
<p>It was introduced <a href="https://github.com/rust-lang/rust/commit/16f4e8ac1d625c74e9711857afae4dac7fcf36e1#diff-ef9c98f22bf95e3bda12c849d5550cedR1191" target="_blank" title="https://github.com/rust-lang/rust/commit/16f4e8ac1d625c74e9711857afae4dac7fcf36e1#diff-ef9c98f22bf95e3bda12c849d5550cedR1191">here</a>; there wasn't much discussion at the time. <span class="emoji emoji-263a" title="smile">:smile:</span></p>



<a name="152031701"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2356715%20meaning%20of%20type%20ascription/near/152031701" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> pnkfelix <a href="https://rust-lang.github.io/zulip_archive/stream/122657-t-compiler/wg-nll/topic/.2356715.20meaning.20of.20type.20ascription.html#152031701">(Dec 17 2018 at 14:38)</a>:</h4>
<p>Hmm maybe you are right, let me double check how <code>ascribe_types</code> is called.</p>



<a name="152031711"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2356715%20meaning%20of%20type%20ascription/near/152031711" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://rust-lang.github.io/zulip_archive/stream/122657-t-compiler/wg-nll/topic/.2356715.20meaning.20of.20type.20ascription.html#152031711">(Dec 17 2018 at 14:38)</a>:</h4>
<blockquote>
<p>It was introduced <a href="https://github.com/rust-lang/rust/commit/16f4e8ac1d625c74e9711857afae4dac7fcf36e1#diff-ef9c98f22bf95e3bda12c849d5550cedR1191" target="_blank" title="https://github.com/rust-lang/rust/commit/16f4e8ac1d625c74e9711857afae4dac7fcf36e1#diff-ef9c98f22bf95e3bda12c849d5550cedR1191">here</a>; there wasn't much discussion at the time. <span class="emoji emoji-263a" title="smile">:smile:</span></p>
</blockquote>
<p>yeah, I mean, I wrote that code initially, I remember that</p>



<a name="152031749"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2356715%20meaning%20of%20type%20ascription/near/152031749" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> pnkfelix <a href="https://rust-lang.github.io/zulip_archive/stream/122657-t-compiler/wg-nll/topic/.2356715.20meaning.20of.20type.20ascription.html#152031749">(Dec 17 2018 at 14:39)</a>:</h4>
<p>so the calls to <code>ascribe_types</code> are asserting the candidate ascriptions for the relevant places</p>



<a name="152031753"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2356715%20meaning%20of%20type%20ascription/near/152031753" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> pnkfelix <a href="https://rust-lang.github.io/zulip_archive/stream/122657-t-compiler/wg-nll/topic/.2356715.20meaning.20of.20type.20ascription.html#152031753">(Dec 17 2018 at 14:39)</a>:</h4>
<p>as we descend the pattern</p>



<a name="152031813"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2356715%20meaning%20of%20type%20ascription/near/152031813" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> pnkfelix <a href="https://rust-lang.github.io/zulip_archive/stream/122657-t-compiler/wg-nll/topic/.2356715.20meaning.20of.20type.20ascription.html#152031813">(Dec 17 2018 at 14:40)</a>:</h4>
<p>Which ... I still would think would be asserting a statement about <code>x</code></p>



<a name="152031820"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2356715%20meaning%20of%20type%20ascription/near/152031820" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> pnkfelix <a href="https://rust-lang.github.io/zulip_archive/stream/122657-t-compiler/wg-nll/topic/.2356715.20meaning.20of.20type.20ascription.html#152031820">(Dec 17 2018 at 14:40)</a>:</h4>
<p>and not a relationship between <code>T</code> and <code>T_rhs</code> ...</p>



<a name="152031832"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2356715%20meaning%20of%20type%20ascription/near/152031832" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://rust-lang.github.io/zulip_archive/stream/122657-t-compiler/wg-nll/topic/.2356715.20meaning.20of.20type.20ascription.html#152031832">(Dec 17 2018 at 14:40)</a>:</h4>
<p>they are putting in <code>match_pair.place</code></p>



<a name="152031869"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2356715%20meaning%20of%20type%20ascription/near/152031869" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://rust-lang.github.io/zulip_archive/stream/122657-t-compiler/wg-nll/topic/.2356715.20meaning.20of.20type.20ascription.html#152031869">(Dec 17 2018 at 14:40)</a>:</h4>
<p>one sec</p>



<a name="152031954"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2356715%20meaning%20of%20type%20ascription/near/152031954" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://rust-lang.github.io/zulip_archive/stream/122657-t-compiler/wg-nll/topic/.2356715.20meaning.20of.20type.20ascription.html#152031954">(Dec 17 2018 at 14:41)</a>:</h4>
<p>so I think <a href="https://github.com/rust-lang/rust/blob/3a3121337122637fa11f0e5d42aec67551e8c125/src/librustc_mir/build/matches/simplify.rs#L67-L71" target="_blank" title="https://github.com/rust-lang/rust/blob/3a3121337122637fa11f0e5d42aec67551e8c125/src/librustc_mir/build/matches/simplify.rs#L67-L71">this is where the <code>ascriptions</code> vector in <code>Candidate</code> is modified</a></p>



<a name="152031977"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2356715%20meaning%20of%20type%20ascription/near/152031977" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://rust-lang.github.io/zulip_archive/stream/122657-t-compiler/wg-nll/topic/.2356715.20meaning.20of.20type.20ascription.html#152031977">(Dec 17 2018 at 14:41)</a>:</h4>
<p>by this code:</p>
<div class="codehilite"><pre><span></span><span class="w">                </span><span class="n">candidate</span><span class="p">.</span><span class="n">ascriptions</span><span class="p">.</span><span class="n">push</span><span class="p">(</span><span class="n">Ascription</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">                    </span><span class="n">span</span>: <span class="nc">user_ty_span</span><span class="p">,</span><span class="w"></span>
<span class="w">                    </span><span class="n">user_ty</span>: <span class="nc">user_ty</span><span class="p">.</span><span class="n">clone</span><span class="p">(),</span><span class="w"></span>
<span class="w">                    </span><span class="n">source</span>: <span class="nc">match_pair</span><span class="p">.</span><span class="n">place</span><span class="p">.</span><span class="n">clone</span><span class="p">(),</span><span class="w"></span>
<span class="p">});</span><span class="w"></span>
</pre></div>



<a name="152031978"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2356715%20meaning%20of%20type%20ascription/near/152031978" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> pnkfelix <a href="https://rust-lang.github.io/zulip_archive/stream/122657-t-compiler/wg-nll/topic/.2356715.20meaning.20of.20type.20ascription.html#152031978">(Dec 17 2018 at 14:41)</a>:</h4>
<p>okay now I agree with you</p>



<a name="152031982"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2356715%20meaning%20of%20type%20ascription/near/152031982" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://rust-lang.github.io/zulip_archive/stream/122657-t-compiler/wg-nll/topic/.2356715.20meaning.20of.20type.20ascription.html#152031982">(Dec 17 2018 at 14:41)</a>:</h4>
<p>ok</p>



<a name="152032022"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2356715%20meaning%20of%20type%20ascription/near/152032022" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> pnkfelix <a href="https://rust-lang.github.io/zulip_archive/stream/122657-t-compiler/wg-nll/topic/.2356715.20meaning.20of.20type.20ascription.html#152032022">(Dec 17 2018 at 14:42)</a>:</h4>
<p>and I was miscasting the purpose of that code then</p>



<a name="152032028"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2356715%20meaning%20of%20type%20ascription/near/152032028" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> pnkfelix <a href="https://rust-lang.github.io/zulip_archive/stream/122657-t-compiler/wg-nll/topic/.2356715.20meaning.20of.20type.20ascription.html#152032028">(Dec 17 2018 at 14:42)</a>:</h4>
<p>which</p>



<a name="152032039"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2356715%20meaning%20of%20type%20ascription/near/152032039" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> pnkfelix <a href="https://rust-lang.github.io/zulip_archive/stream/122657-t-compiler/wg-nll/topic/.2356715.20meaning.20of.20type.20ascription.html#152032039">(Dec 17 2018 at 14:42)</a>:</h4>
<p>makes it all make more sense in terms of the behavior I was witnessing</p>



<a name="152032052"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2356715%20meaning%20of%20type%20ascription/near/152032052" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> pnkfelix <a href="https://rust-lang.github.io/zulip_archive/stream/122657-t-compiler/wg-nll/topic/.2356715.20meaning.20of.20type.20ascription.html#152032052">(Dec 17 2018 at 14:42)</a>:</h4>
<p>when I made the change I described (of sed -e s/Covariant/Invariant there)</p>



<a name="152032062"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2356715%20meaning%20of%20type%20ascription/near/152032062" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> pnkfelix <a href="https://rust-lang.github.io/zulip_archive/stream/122657-t-compiler/wg-nll/topic/.2356715.20meaning.20of.20type.20ascription.html#152032062">(Dec 17 2018 at 14:42)</a>:</h4>
<p>in terms of it only really affecting <code>let _: T = RHS</code></p>



<a name="152032123"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2356715%20meaning%20of%20type%20ascription/near/152032123" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://rust-lang.github.io/zulip_archive/stream/122657-t-compiler/wg-nll/topic/.2356715.20meaning.20of.20type.20ascription.html#152032123">(Dec 17 2018 at 14:43)</a>:</h4>
<p>yeah</p>



<a name="152032181"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2356715%20meaning%20of%20type%20ascription/near/152032181" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://rust-lang.github.io/zulip_archive/stream/122657-t-compiler/wg-nll/topic/.2356715.20meaning.20of.20type.20ascription.html#152032181">(Dec 17 2018 at 14:44)</a>:</h4>
<p>I contend that it is a bit inconsistent to have permit coercions from <code>T_rhs</code> to <code>T</code> but not subtyping</p>



<a name="152032185"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2356715%20meaning%20of%20type%20ascription/near/152032185" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> pnkfelix <a href="https://rust-lang.github.io/zulip_archive/stream/122657-t-compiler/wg-nll/topic/.2356715.20meaning.20of.20type.20ascription.html#152032185">(Dec 17 2018 at 14:44)</a>:</h4>
<p>Okay yes</p>



<a name="152032191"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2356715%20meaning%20of%20type%20ascription/near/152032191" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> pnkfelix <a href="https://rust-lang.github.io/zulip_archive/stream/122657-t-compiler/wg-nll/topic/.2356715.20meaning.20of.20type.20ascription.html#152032191">(Dec 17 2018 at 14:44)</a>:</h4>
<p>I agree with that.</p>



<a name="152032587"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2356715%20meaning%20of%20type%20ascription/near/152032587" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> pnkfelix <a href="https://rust-lang.github.io/zulip_archive/stream/122657-t-compiler/wg-nll/topic/.2356715.20meaning.20of.20type.20ascription.html#152032587">(Dec 17 2018 at 14:49)</a>:</h4>
<p>just to double-check, your assertion is that <code>let _: T = RHS</code> can and will coerce when necessary, right?</p>



<a name="152032611"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2356715%20meaning%20of%20type%20ascription/near/152032611" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> pnkfelix <a href="https://rust-lang.github.io/zulip_archive/stream/122657-t-compiler/wg-nll/topic/.2356715.20meaning.20of.20type.20ascription.html#152032611">(Dec 17 2018 at 14:49)</a>:</h4>
<p>(i.e. I don't need to bind to an actual variable like <code>_x</code> in order to observe coercion occurring?)</p>



<a name="152032672"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2356715%20meaning%20of%20type%20ascription/near/152032672" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> pnkfelix <a href="https://rust-lang.github.io/zulip_archive/stream/122657-t-compiler/wg-nll/topic/.2356715.20meaning.20of.20type.20ascription.html#152032672">(Dec 17 2018 at 14:50)</a>:</h4>
<p>I guess I could/should test this readily enough.</p>



<a name="152032685"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2356715%20meaning%20of%20type%20ascription/near/152032685" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://rust-lang.github.io/zulip_archive/stream/122657-t-compiler/wg-nll/topic/.2356715.20meaning.20of.20type.20ascription.html#152032685">(Dec 17 2018 at 14:50)</a>:</h4>
<blockquote>
<p>just to double-check, your assertion is that <code>let _: T = RHS</code> can and will coerce when necessary, right?</p>
</blockquote>
<p>yes I believe so</p>



<a name="152032723"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2356715%20meaning%20of%20type%20ascription/near/152032723" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://rust-lang.github.io/zulip_archive/stream/122657-t-compiler/wg-nll/topic/.2356715.20meaning.20of.20type.20ascription.html#152032723">(Dec 17 2018 at 14:51)</a>:</h4>
<p>as there is no <code>ref</code> (syntactically) appearing in the LHS</p>



<a name="152032834"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2356715%20meaning%20of%20type%20ascription/near/152032834" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> pnkfelix <a href="https://rust-lang.github.io/zulip_archive/stream/122657-t-compiler/wg-nll/topic/.2356715.20meaning.20of.20type.20ascription.html#152032834">(Dec 17 2018 at 14:52)</a>:</h4>
<p>super-interesting</p>



<a name="152032847"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2356715%20meaning%20of%20type%20ascription/near/152032847" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> pnkfelix <a href="https://rust-lang.github.io/zulip_archive/stream/122657-t-compiler/wg-nll/topic/.2356715.20meaning.20of.20type.20ascription.html#152032847">(Dec 17 2018 at 14:52)</a>:</h4>
<p>since I sometimes think of <code>_</code> as being "like" a <code>ref</code></p>



<a name="152032861"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2356715%20meaning%20of%20type%20ascription/near/152032861" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> pnkfelix <a href="https://rust-lang.github.io/zulip_archive/stream/122657-t-compiler/wg-nll/topic/.2356715.20meaning.20of.20type.20ascription.html#152032861">(Dec 17 2018 at 14:52)</a>:</h4>
<p>in that it, on its own at least, will not cause a move</p>



<a name="152032897"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2356715%20meaning%20of%20type%20ascription/near/152032897" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> pnkfelix <a href="https://rust-lang.github.io/zulip_archive/stream/122657-t-compiler/wg-nll/topic/.2356715.20meaning.20of.20type.20ascription.html#152032897">(Dec 17 2018 at 14:52)</a>:</h4>
<p>but I believe I understand the basis for the design you present</p>



<a name="152032929"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2356715%20meaning%20of%20type%20ascription/near/152032929" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> pnkfelix <a href="https://rust-lang.github.io/zulip_archive/stream/122657-t-compiler/wg-nll/topic/.2356715.20meaning.20of.20type.20ascription.html#152032929">(Dec 17 2018 at 14:53)</a>:</h4>
<p>since the worrisome semantics would not be exposed by <code>_</code>; only by <code>ref</code> (or just <code>ref mut</code> maybe)</p>



<a name="152033316"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2356715%20meaning%20of%20type%20ascription/near/152033316" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> pnkfelix <a href="https://rust-lang.github.io/zulip_archive/stream/122657-t-compiler/wg-nll/topic/.2356715.20meaning.20of.20type.20ascription.html#152033316">(Dec 17 2018 at 14:57)</a>:</h4>
<p>(actually now I don't know how I'd observe coercion within the program itself without using a binding somewhere in the LHS...)</p>



<a name="152033935"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2356715%20meaning%20of%20type%20ascription/near/152033935" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> centril <a href="https://rust-lang.github.io/zulip_archive/stream/122657-t-compiler/wg-nll/topic/.2356715.20meaning.20of.20type.20ascription.html#152033935">(Dec 17 2018 at 15:06)</a>:</h4>
<p>/me reads backlog :P</p>



<a name="152035631"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2356715%20meaning%20of%20type%20ascription/near/152035631" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> centril <a href="https://rust-lang.github.io/zulip_archive/stream/122657-t-compiler/wg-nll/topic/.2356715.20meaning.20of.20type.20ascription.html#152035631">(Dec 17 2018 at 15:27)</a>:</h4>
<p>My mental model fits with <span class="user-mention" data-user-id="116009">@nikomatsakis</span>'s as well</p>



<a name="152035675"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2356715%20meaning%20of%20type%20ascription/near/152035675" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> pnkfelix <a href="https://rust-lang.github.io/zulip_archive/stream/122657-t-compiler/wg-nll/topic/.2356715.20meaning.20of.20type.20ascription.html#152035675">(Dec 17 2018 at 15:27)</a>:</h4>
<p>yeah at this point I've closed the issue</p>



<a name="152035772"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2356715%20meaning%20of%20type%20ascription/near/152035772" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> centril <a href="https://rust-lang.github.io/zulip_archive/stream/122657-t-compiler/wg-nll/topic/.2356715.20meaning.20of.20type.20ascription.html#152035772">(Dec 17 2018 at 15:28)</a>:</h4>
<p><span class="user-mention" data-user-id="116083">@pnkfelix</span>  if my RFC is unclear and you think some fleshing out is needed I take PRs against my branch ;)</p>



<a name="152035774"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2356715%20meaning%20of%20type%20ascription/near/152035774" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> pnkfelix <a href="https://rust-lang.github.io/zulip_archive/stream/122657-t-compiler/wg-nll/topic/.2356715.20meaning.20of.20type.20ascription.html#152035774">(Dec 17 2018 at 15:29)</a>:</h4>
<p>We'll eventually need to deal with how type ascriptions on expressions behave</p>



<a name="152035800"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2356715%20meaning%20of%20type%20ascription/near/152035800" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> pnkfelix <a href="https://rust-lang.github.io/zulip_archive/stream/122657-t-compiler/wg-nll/topic/.2356715.20meaning.20of.20type.20ascription.html#152035800">(Dec 17 2018 at 15:29)</a>:</h4>
<p>(in terms of whether they need to be Covariant rather than Invariant in more cases)</p>



<a name="152035803"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2356715%20meaning%20of%20type%20ascription/near/152035803" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> pnkfelix <a href="https://rust-lang.github.io/zulip_archive/stream/122657-t-compiler/wg-nll/topic/.2356715.20meaning.20of.20type.20ascription.html#152035803">(Dec 17 2018 at 15:29)</a>:</h4>
<p>but for now all is fine with me.</p>



<a name="152035815"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2356715%20meaning%20of%20type%20ascription/near/152035815" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> centril <a href="https://rust-lang.github.io/zulip_archive/stream/122657-t-compiler/wg-nll/topic/.2356715.20meaning.20of.20type.20ascription.html#152035815">(Dec 17 2018 at 15:29)</a>:</h4>
<p>aight; we can do follow up RFCs</p>



<a name="152044550"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2356715%20meaning%20of%20type%20ascription/near/152044550" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://rust-lang.github.io/zulip_archive/stream/122657-t-compiler/wg-nll/topic/.2356715.20meaning.20of.20type.20ascription.html#152044550">(Dec 17 2018 at 17:26)</a>:</h4>
<p><span class="emoji emoji-1f44d" title="+1">:+1:</span></p>



<hr><p>Last updated: Aug 07 2021 at 22:04 UTC</p>
</html>