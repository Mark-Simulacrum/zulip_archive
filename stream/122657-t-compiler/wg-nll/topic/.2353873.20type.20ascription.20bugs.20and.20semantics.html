<html>
<head><meta charset="utf-8"><title>#53873 type ascription bugs and semantics · t-compiler/wg-nll · Zulip Chat Archive</title></head>
<h2>Stream: <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/index.html">t-compiler/wg-nll</a></h2>
<h3>Topic: <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353873.20type.20ascription.20bugs.20and.20semantics.html">#53873 type ascription bugs and semantics</a></h3>

<hr>

<base href="https://rust-lang.zulipchat.com">

<head><link href="https://zulip-archive.rust-lang.org/style.css" rel="stylesheet"></head>

<a name="133660474"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353873%20type%20ascription%20bugs%20and%20semantics/near/133660474" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> pnkfelix <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353873.20type.20ascription.20bugs.20and.20semantics.html#133660474">(Sep 10 2018 at 13:36)</a>:</h4>
<p><span class="user-mention" data-user-id="116009">@nikomatsakis</span> so we should talk here perhaps</p>



<a name="133660549"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353873%20type%20ascription%20bugs%20and%20semantics/near/133660549" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> pnkfelix <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353873.20type.20ascription.20bugs.20and.20semantics.html#133660549">(Sep 10 2018 at 13:37)</a>:</h4>
<p>you ask a reasonable Q <a href="https://github.com/rust-lang/rust/pull/53873#issuecomment-419543464" target="_blank" title="https://github.com/rust-lang/rust/pull/53873#issuecomment-419543464">here</a>, about when lifetimes in ascribed types should be meaningful</p>



<a name="133660592"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353873%20type%20ascription%20bugs%20and%20semantics/near/133660592" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> pnkfelix <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353873.20type.20ascription.20bugs.20and.20semantics.html#133660592">(Sep 10 2018 at 13:37)</a>:</h4>
<p>to be honest, my intuition is that: if the programmer ascribed a type, at least to a variable (not sure yet about arbitrary expressions), then that type should be applied to the entire scope of that variable</p>



<a name="133660626"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353873%20type%20ascription%20bugs%20and%20semantics/near/133660626" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> pnkfelix <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353873.20type.20ascription.20bugs.20and.20semantics.html#133660626">(Sep 10 2018 at 13:38)</a>:</h4>
<p>even over the course of assignments</p>



<a name="133660661"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353873%20type%20ascription%20bugs%20and%20semantics/near/133660661" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> pnkfelix <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353873.20type.20ascription.20bugs.20and.20semantics.html#133660661">(Sep 10 2018 at 13:38)</a>:</h4>
<p>I realize that this might introduce borrowck errors (in the sense that sound code may start failing to compile, which might then be filed as an <code>NLL-complete</code> bug)</p>



<a name="133660688"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353873%20type%20ascription%20bugs%20and%20semantics/near/133660688" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> pnkfelix <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353873.20type.20ascription.20bugs.20and.20semantics.html#133660688">(Sep 10 2018 at 13:38)</a>:</h4>
<p>but if someone is going to write out an explicit lifetime, I think we are probably better of err'ing on the side of respecting their request</p>



<a name="133660715"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353873%20type%20ascription%20bugs%20and%20semantics/near/133660715" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> pnkfelix <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353873.20type.20ascription.20bugs.20and.20semantics.html#133660715">(Sep 10 2018 at 13:39)</a>:</h4>
<p>and also, I think that semantics will yield more intuitive user experience in terms of diagnostics</p>



<a name="133660735"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353873%20type%20ascription%20bugs%20and%20semantics/near/133660735" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> pnkfelix <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353873.20type.20ascription.20bugs.20and.20semantics.html#133660735">(Sep 10 2018 at 13:39)</a>:</h4>
<p>namely avoiding cases like this: <a href="https://github.com/rust-lang/rust/pull/53873#issuecomment-419440395" target="_blank" title="https://github.com/rust-lang/rust/pull/53873#issuecomment-419440395">https://github.com/rust-lang/rust/pull/53873#issuecomment-419440395</a></p>



<a name="133660940"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353873%20type%20ascription%20bugs%20and%20semantics/near/133660940" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353873.20type.20ascription.20bugs.20and.20semantics.html#133660940">(Sep 10 2018 at 13:42)</a>:</h4>
<p>ok so I wrote up a bunch of tests</p>



<a name="133660943"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353873%20type%20ascription%20bugs%20and%20semantics/near/133660943" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353873.20type.20ascription.20bugs.20and.20semantics.html#133660943">(Sep 10 2018 at 13:42)</a>:</h4>
<p>I pushed them</p>



<a name="133660950"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353873%20type%20ascription%20bugs%20and%20semantics/near/133660950" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353873.20type.20ascription.20bugs.20and.20semantics.html#133660950">(Sep 10 2018 at 13:42)</a>:</h4>
<p>there are two that worry me (both have a FIXME in the file)</p>



<a name="133660983"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353873%20type%20ascription%20bugs%20and%20semantics/near/133660983" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> pnkfelix <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353873.20type.20ascription.20bugs.20and.20semantics.html#133660983">(Sep 10 2018 at 13:43)</a>:</h4>
<p>/me looks</p>



<a name="133661076"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353873%20type%20ascription%20bugs%20and%20semantics/near/133661076" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353873.20type.20ascription.20bugs.20and.20semantics.html#133661076">(Sep 10 2018 at 13:44)</a>:</h4>
<p>one is the one I already showed</p>
<div class="codehilite"><pre><span></span><span class="k">fn</span> <span class="nf">variable_no_initializer</span><span class="p">()</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="c1">// FIXME: It is unclear to me whether this should be an error or not.</span>

<span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="n">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">22</span><span class="p">;</span><span class="w"></span>
<span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="n">y</span>: <span class="kp">&amp;</span><span class="nb">&#39;static</span><span class="w"> </span><span class="kt">u32</span><span class="p">;</span><span class="w"></span>
<span class="w">    </span><span class="n">y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">&amp;</span><span class="n">x</span><span class="p">;</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>
</pre></div>



<a name="133661085"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353873%20type%20ascription%20bugs%20and%20semantics/near/133661085" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353873.20type.20ascription.20bugs.20and.20semantics.html#133661085">(Sep 10 2018 at 13:44)</a>:</h4>
<p>the other is this one</p>
<div class="codehilite"><pre><span></span><span class="k">fn</span> <span class="nf">static_to_a_to_static_through_tuple</span><span class="o">&lt;</span><span class="na">&#39;a</span><span class="o">&gt;</span><span class="p">(</span><span class="n">x</span>: <span class="kp">&amp;</span><span class="na">&#39;a</span><span class="w"> </span><span class="kt">u32</span><span class="p">)</span><span class="w"> </span>-&gt; <span class="kp">&amp;</span><span class="nb">&#39;static</span><span class="w"> </span><span class="kt">u32</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="c1">// FIXME: The fact that this type-checks is perhaps surprising.</span>
<span class="w">    </span><span class="c1">// What happens is that the right-hand side is constrained to have</span>
<span class="w">    </span><span class="c1">// type `&amp;&#39;a u32`, which is possible, because it has type</span>
<span class="w">    </span><span class="c1">// `&amp;&#39;static u32`. The variable `y` is then forced to have type</span>
<span class="w">    </span><span class="c1">// `&amp;&#39;static u32`, but it is constrained only by the right-hand</span>
<span class="w">    </span><span class="c1">// side, not the ascribed type, and hence it passes.</span>

<span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="p">(</span><span class="n">y</span><span class="p">,</span><span class="w"> </span><span class="n">_z</span><span class="p">)</span>: <span class="p">(</span><span class="o">&amp;</span><span class="na">&#39;a</span><span class="w"> </span><span class="kt">u32</span><span class="p">,</span><span class="w"> </span><span class="kt">u32</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="o">&amp;</span><span class="mi">22</span><span class="p">,</span><span class="w"> </span><span class="mi">44</span><span class="p">);</span><span class="w"></span>
<span class="w">    </span><span class="n">y</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>
</pre></div>



<a name="133661088"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353873%20type%20ascription%20bugs%20and%20semantics/near/133661088" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353873.20type.20ascription.20bugs.20and.20semantics.html#133661088">(Sep 10 2018 at 13:44)</a>:</h4>
<p>it's probably worth me explaining a bit what I did in this PR</p>



<a name="133661104"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353873%20type%20ascription%20bugs%20and%20semantics/near/133661104" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353873.20type.20ascription.20bugs.20and.20semantics.html#133661104">(Sep 10 2018 at 13:44)</a>:</h4>
<p>that last test exposes the "gap" — I think I've come to the conclusion that to enforce type constraints,</p>



<a name="133661125"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353873%20type%20ascription%20bugs%20and%20semantics/near/133661125" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353873.20type.20ascription.20bugs.20and.20semantics.html#133661125">(Sep 10 2018 at 13:45)</a>:</h4>
<p>we have to do <em>two</em> things:</p>
<ul>
<li>Enforce the constraint as a supertype of the type of the initializer (what this PR does)</li>
</ul>



<a name="133661132"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353873%20type%20ascription%20bugs%20and%20semantics/near/133661132" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> pnkfelix <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353873.20type.20ascription.20bugs.20and.20semantics.html#133661132">(Sep 10 2018 at 13:45)</a>:</h4>
<p>and if you made the <code>fn variable_no_initializer</code> returns <code>&amp;'static u32</code></p>



<a name="133661133"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353873%20type%20ascription%20bugs%20and%20semantics/near/133661133" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353873.20type.20ascription.20bugs.20and.20semantics.html#133661133">(Sep 10 2018 at 13:45)</a>:</h4>
<ul>
<li>Propagate the constraint <em>down</em> to the bindings within (what this PR does not do except in the case of <code>let x: T</code>)</li>
</ul>



<a name="133661139"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353873%20type%20ascription%20bugs%20and%20semantics/near/133661139" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> pnkfelix <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353873.20type.20ascription.20bugs.20and.20semantics.html#133661139">(Sep 10 2018 at 13:45)</a>:</h4>
<p>and then have it return <code>y</code></p>



<a name="133661155"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353873%20type%20ascription%20bugs%20and%20semantics/near/133661155" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> pnkfelix <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353873.20type.20ascription.20bugs.20and.20semantics.html#133661155">(Sep 10 2018 at 13:45)</a>:</h4>
<p>I assume that <em>would</em> error</p>



<a name="133661164"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353873%20type%20ascription%20bugs%20and%20semantics/near/133661164" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353873.20type.20ascription.20bugs.20and.20semantics.html#133661164">(Sep 10 2018 at 13:45)</a>:</h4>
<p>yes, one hopes :)</p>



<a name="133661170"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353873%20type%20ascription%20bugs%20and%20semantics/near/133661170" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353873.20type.20ascription.20bugs.20and.20semantics.html#133661170">(Sep 10 2018 at 13:45)</a>:</h4>
<p>but yes, it will</p>



<a name="133661218"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353873%20type%20ascription%20bugs%20and%20semantics/near/133661218" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353873.20type.20ascription.20bugs.20and.20semantics.html#133661218">(Sep 10 2018 at 13:46)</a>:</h4>
<blockquote>
<ul>
<li>Propagate the constraint <em>down</em> to the bindings within (what this PR does not do except in the case of <code>let x: T</code>)</li>
</ul>
</blockquote>
<p>the fact that we don't do this is why that second test passes</p>



<a name="133661274"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353873%20type%20ascription%20bugs%20and%20semantics/near/133661274" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> pnkfelix <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353873.20type.20ascription.20bugs.20and.20semantics.html#133661274">(Sep 10 2018 at 13:47)</a>:</h4>
<p>can we discuss the first test a bit more before we move on to the second?</p>



<a name="133661374"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353873%20type%20ascription%20bugs%20and%20semantics/near/133661374" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> pnkfelix <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353873.20type.20ascription.20bugs.20and.20semantics.html#133661374">(Sep 10 2018 at 13:48)</a>:</h4>
<p>... or  do you see them as intrinsically linked?</p>



<a name="133661376"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353873%20type%20ascription%20bugs%20and%20semantics/near/133661376" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353873.20type.20ascription.20bugs.20and.20semantics.html#133661376">(Sep 10 2018 at 13:48)</a>:</h4>
<p>yep</p>



<a name="133661387"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353873%20type%20ascription%20bugs%20and%20semantics/near/133661387" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353873.20type.20ascription.20bugs.20and.20semantics.html#133661387">(Sep 10 2018 at 13:49)</a>:</h4>
<p>I don't think they are really linked</p>



<a name="133661389"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353873%20type%20ascription%20bugs%20and%20semantics/near/133661389" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> pnkfelix <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353873.20type.20ascription.20bugs.20and.20semantics.html#133661389">(Sep 10 2018 at 13:49)</a>:</h4>
<p>poor timing on my followup Q</p>



<a name="133661394"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353873%20type%20ascription%20bugs%20and%20semantics/near/133661394" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> pnkfelix <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353873.20type.20ascription.20bugs.20and.20semantics.html#133661394">(Sep 10 2018 at 13:49)</a>:</h4>
<p>okay</p>



<a name="133661400"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353873%20type%20ascription%20bugs%20and%20semantics/near/133661400" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> pnkfelix <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353873.20type.20ascription.20bugs.20and.20semantics.html#133661400">(Sep 10 2018 at 13:49)</a>:</h4>
<p>that's what I thought</p>



<a name="133661407"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353873%20type%20ascription%20bugs%20and%20semantics/near/133661407" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353873.20type.20ascription.20bugs.20and.20semantics.html#133661407">(Sep 10 2018 at 13:49)</a>:</h4>
<p>there is <em>a</em> link</p>



<a name="133661416"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353873%20type%20ascription%20bugs%20and%20semantics/near/133661416" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353873.20type.20ascription.20bugs.20and.20semantics.html#133661416">(Sep 10 2018 at 13:49)</a>:</h4>
<p>but we could make the first test pass today by special-casing the simple pattern of <code>x</code></p>



<a name="133661427"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353873%20type%20ascription%20bugs%20and%20semantics/near/133661427" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353873.20type.20ascription.20bugs.20and.20semantics.html#133661427">(Sep 10 2018 at 13:49)</a>:</h4>
<p>but if we want <code>let (x, y): (&amp;'static u32, &amp;'static u32);</code> to propagate, we need to handle the pattern thing</p>



<a name="133661429"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353873%20type%20ascription%20bugs%20and%20semantics/near/133661429" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353873.20type.20ascription.20bugs.20and.20semantics.html#133661429">(Sep 10 2018 at 13:49)</a>:</h4>
<p>so that is the link</p>



<a name="133661480"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353873%20type%20ascription%20bugs%20and%20semantics/near/133661480" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353873.20type.20ascription.20bugs.20and.20semantics.html#133661480">(Sep 10 2018 at 13:50)</a>:</h4>
<p>so, I think I agree with your intution btw</p>



<a name="133661484"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353873%20type%20ascription%20bugs%20and%20semantics/near/133661484" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353873.20type.20ascription.20bugs.20and.20semantics.html#133661484">(Sep 10 2018 at 13:50)</a>:</h4>
<p>that we do want an error here</p>



<a name="133661503"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353873%20type%20ascription%20bugs%20and%20semantics/near/133661503" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353873.20type.20ascription.20bugs.20and.20semantics.html#133661503">(Sep 10 2018 at 13:50)</a>:</h4>
<p>that said, I don't know how to think about this in more complex cases, but actually the current solver isn't that smart anyway</p>



<a name="133661507"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353873%20type%20ascription%20bugs%20and%20semantics/near/133661507" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> pnkfelix <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353873.20type.20ascription.20bugs.20and.20semantics.html#133661507">(Sep 10 2018 at 13:50)</a>:</h4>
<p>wait, "first test" is <code>fn variable_no_initializer</code> ?</p>



<a name="133661509"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353873%20type%20ascription%20bugs%20and%20semantics/near/133661509" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353873.20type.20ascription.20bugs.20and.20semantics.html#133661509">(Sep 10 2018 at 13:50)</a>:</h4>
<p>polonius will bring this question more to the fore</p>



<a name="133661511"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353873%20type%20ascription%20bugs%20and%20semantics/near/133661511" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353873.20type.20ascription.20bugs.20and.20semantics.html#133661511">(Sep 10 2018 at 13:50)</a>:</h4>
<blockquote>
<p>wait, "first test" is <code>fn variable_no_initializer</code> ?</p>
</blockquote>
<p>yes</p>



<a name="133661525"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353873%20type%20ascription%20bugs%20and%20semantics/near/133661525" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> pnkfelix <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353873.20type.20ascription.20bugs.20and.20semantics.html#133661525">(Sep 10 2018 at 13:50)</a>:</h4>
<p>hmm. and you're saying the fix is some sort of special case on... the <code>let x = ...</code> ?</p>



<a name="133661528"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353873%20type%20ascription%20bugs%20and%20semantics/near/133661528" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> pnkfelix <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353873.20type.20ascription.20bugs.20and.20semantics.html#133661528">(Sep 10 2018 at 13:50)</a>:</h4>
<p>not on our treatment of assignments?</p>



<a name="133661573"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353873%20type%20ascription%20bugs%20and%20semantics/near/133661573" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353873.20type.20ascription.20bugs.20and.20semantics.html#133661573">(Sep 10 2018 at 13:51)</a>:</h4>
<p>that is correct</p>



<a name="133661586"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353873%20type%20ascription%20bugs%20and%20semantics/near/133661586" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353873.20type.20ascription.20bugs.20and.20semantics.html#133661586">(Sep 10 2018 at 13:51)</a>:</h4>
<p>well</p>



<a name="133661591"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353873%20type%20ascription%20bugs%20and%20semantics/near/133661591" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353873.20type.20ascription.20bugs.20and.20semantics.html#133661591">(Sep 10 2018 at 13:51)</a>:</h4>
<p>you could do various things</p>



<a name="133661637"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353873%20type%20ascription%20bugs%20and%20semantics/near/133661637" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353873.20type.20ascription.20bugs.20and.20semantics.html#133661637">(Sep 10 2018 at 13:52)</a>:</h4>
<p>however, in the current solver, if we had <code>let x: T;</code> impose constraints on the regions in <code>typeof(x)</code></p>



<a name="133661644"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353873%20type%20ascription%20bugs%20and%20semantics/near/133661644" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353873.20type.20ascription.20bugs.20and.20semantics.html#133661644">(Sep 10 2018 at 13:52)</a>:</h4>
<p>those constraints would apply throughout the function</p>



<a name="133661646"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353873%20type%20ascription%20bugs%20and%20semantics/near/133661646" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353873.20type.20ascription.20bugs.20and.20semantics.html#133661646">(Sep 10 2018 at 13:52)</a>:</h4>
<p>and in particular they would affect subsequent constraints</p>



<a name="133661651"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353873%20type%20ascription%20bugs%20and%20semantics/near/133661651" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> pnkfelix <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353873.20type.20ascription.20bugs.20and.20semantics.html#133661651">(Sep 10 2018 at 13:52)</a>:</h4>
<p>wait wait</p>



<a name="133661661"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353873%20type%20ascription%20bugs%20and%20semantics/near/133661661" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> pnkfelix <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353873.20type.20ascription.20bugs.20and.20semantics.html#133661661">(Sep 10 2018 at 13:52)</a>:</h4>
<p>I think</p>



<a name="133661667"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353873%20type%20ascription%20bugs%20and%20semantics/near/133661667" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353873.20type.20ascription.20bugs.20and.20semantics.html#133661667">(Sep 10 2018 at 13:52)</a>:</h4>
<p>this is because our current solver is not (yet) location sensitive; this would not be true for polonius</p>



<a name="133661669"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353873%20type%20ascription%20bugs%20and%20semantics/near/133661669" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> pnkfelix <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353873.20type.20ascription.20bugs.20and.20semantics.html#133661669">(Sep 10 2018 at 13:52)</a>:</h4>
<p>you are writing <code>let x: T</code></p>



<a name="133661672"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353873%20type%20ascription%20bugs%20and%20semantics/near/133661672" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> pnkfelix <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353873.20type.20ascription.20bugs.20and.20semantics.html#133661672">(Sep 10 2018 at 13:52)</a>:</h4>
<p>and the test says <code>let x = ...</code></p>



<a name="133661676"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353873%20type%20ascription%20bugs%20and%20semantics/near/133661676" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353873.20type.20ascription.20bugs.20and.20semantics.html#133661676">(Sep 10 2018 at 13:52)</a>:</h4>
<p>it does not</p>



<a name="133661677"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353873%20type%20ascription%20bugs%20and%20semantics/near/133661677" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> pnkfelix <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353873.20type.20ascription.20bugs.20and.20semantics.html#133661677">(Sep 10 2018 at 13:52)</a>:</h4>
<p>so when you say "special case simple patterns"</p>



<a name="133661688"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353873%20type%20ascription%20bugs%20and%20semantics/near/133661688" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> pnkfelix <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353873.20type.20ascription.20bugs.20and.20semantics.html#133661688">(Sep 10 2018 at 13:53)</a>:</h4>
<p>I am <em>literally</em> talking about the text</p>



<a name="133661690"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353873%20type%20ascription%20bugs%20and%20semantics/near/133661690" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353873.20type.20ascription.20bugs.20and.20semantics.html#133661690">(Sep 10 2018 at 13:53)</a>:</h4>
<p>well</p>



<a name="133661700"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353873%20type%20ascription%20bugs%20and%20semantics/near/133661700" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353873.20type.20ascription.20bugs.20and.20semantics.html#133661700">(Sep 10 2018 at 13:53)</a>:</h4>
<p>in the test, the variable is called <code>y</code></p>



<a name="133661703"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353873%20type%20ascription%20bugs%20and%20semantics/near/133661703" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> pnkfelix <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353873.20type.20ascription.20bugs.20and.20semantics.html#133661703">(Sep 10 2018 at 13:53)</a>:</h4>
<p><code>let x = ...; let y: &amp;'static u32;</code></p>



<a name="133661707"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353873%20type%20ascription%20bugs%20and%20semantics/near/133661707" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> pnkfelix <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353873.20type.20ascription.20bugs.20and.20semantics.html#133661707">(Sep 10 2018 at 13:53)</a>:</h4>
<p>this was in fact the source of my confusion</p>



<a name="133661712"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353873%20type%20ascription%20bugs%20and%20semantics/near/133661712" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> pnkfelix <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353873.20type.20ascription.20bugs.20and.20semantics.html#133661712">(Sep 10 2018 at 13:53)</a>:</h4>
<p>as to why the "fix" would be to <code>let x = ...;</code>;</p>



<a name="133661722"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353873%20type%20ascription%20bugs%20and%20semantics/near/133661722" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353873.20type.20ascription.20bugs.20and.20semantics.html#133661722">(Sep 10 2018 at 13:53)</a>:</h4>
<p>I see, I see</p>



<a name="133661724"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353873%20type%20ascription%20bugs%20and%20semantics/near/133661724" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353873.20type.20ascription.20bugs.20and.20semantics.html#133661724">(Sep 10 2018 at 13:53)</a>:</h4>
<p>sorry, my bad</p>



<a name="133661789"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353873%20type%20ascription%20bugs%20and%20semantics/near/133661789" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> pnkfelix <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353873.20type.20ascription.20bugs.20and.20semantics.html#133661789">(Sep 10 2018 at 13:54)</a>:</h4>
<p>okay now I think I am on a similar page to you, if not the same one</p>



<a name="133661798"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353873%20type%20ascription%20bugs%20and%20semantics/near/133661798" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353873.20type.20ascription.20bugs.20and.20semantics.html#133661798">(Sep 10 2018 at 13:54)</a>:</h4>
<p>in any case, the point remains that if we had <code>let y: &amp;'static u32;</code> impose a constraint on <code>typeof(y)</code> at that point</p>



<a name="133661801"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353873%20type%20ascription%20bugs%20and%20semantics/near/133661801" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353873.20type.20ascription.20bugs.20and.20semantics.html#133661801">(Sep 10 2018 at 13:54)</a>:</h4>
<p>it would propagate down below</p>



<a name="133661805"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353873%20type%20ascription%20bugs%20and%20semantics/near/133661805" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> pnkfelix <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353873.20type.20ascription.20bugs.20and.20semantics.html#133661805">(Sep 10 2018 at 13:54)</a>:</h4>
<p>We can special case <code>let x: T;</code> and also <code>let x: T = ...</code></p>



<a name="133661827"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353873%20type%20ascription%20bugs%20and%20semantics/near/133661827" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353873.20type.20ascription.20bugs.20and.20semantics.html#133661827">(Sep 10 2018 at 13:54)</a>:</h4>
<p>(in fact, maybe I'll handle that special case right now, just because ...)</p>



<a name="133661841"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353873%20type%20ascription%20bugs%20and%20semantics/near/133661841" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> pnkfelix <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353873.20type.20ascription.20bugs.20and.20semantics.html#133661841">(Sep 10 2018 at 13:54)</a>:</h4>
<p>and have it constrain occurrences of <code>x</code> in the function body, including on the RHS of assignments</p>



<a name="133661847"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353873%20type%20ascription%20bugs%20and%20semantics/near/133661847" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353873.20type.20ascription.20bugs.20and.20semantics.html#133661847">(Sep 10 2018 at 13:54)</a>:</h4>
<p>I sort of wish that <code>let non-binding-pattern;</code> were not even legal</p>



<a name="133661848"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353873%20type%20ascription%20bugs%20and%20semantics/near/133661848" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353873.20type.20ascription.20bugs.20and.20semantics.html#133661848">(Sep 10 2018 at 13:54)</a>:</h4>
<p>but oh well :P</p>



<a name="133661864"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353873%20type%20ascription%20bugs%20and%20semantics/near/133661864" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> pnkfelix <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353873.20type.20ascription.20bugs.20and.20semantics.html#133661864">(Sep 10 2018 at 13:55)</a>:</h4>
<p>Oh <code>let non_binding_pattern;</code> is so great though!</p>



<a name="133661866"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353873%20type%20ascription%20bugs%20and%20semantics/near/133661866" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> pnkfelix <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353873.20type.20ascription.20bugs.20and.20semantics.html#133661866">(Sep 10 2018 at 13:55)</a>:</h4>
<p>:)</p>



<a name="133661867"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353873%20type%20ascription%20bugs%20and%20semantics/near/133661867" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353873.20type.20ascription.20bugs.20and.20semantics.html#133661867">(Sep 10 2018 at 13:55)</a>:</h4>
<p>well</p>



<a name="133661875"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353873%20type%20ascription%20bugs%20and%20semantics/near/133661875" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353873.20type.20ascription.20bugs.20and.20semantics.html#133661875">(Sep 10 2018 at 13:55)</a>:</h4>
<p>what I meant <em>really</em> is</p>



<a name="133661879"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353873%20type%20ascription%20bugs%20and%20semantics/near/133661879" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353873.20type.20ascription.20bugs.20and.20semantics.html#133661879">(Sep 10 2018 at 13:55)</a>:</h4>
<p>I wish that it were only legal for variables and maybe tuples</p>



<a name="133661885"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353873%20type%20ascription%20bugs%20and%20semantics/near/133661885" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> pnkfelix <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353873.20type.20ascription.20bugs.20and.20semantics.html#133661885">(Sep 10 2018 at 13:55)</a>:</h4>
<p>ah</p>



<a name="133661888"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353873%20type%20ascription%20bugs%20and%20semantics/near/133661888" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353873.20type.20ascription.20bugs.20and.20semantics.html#133661888">(Sep 10 2018 at 13:55)</a>:</h4>
<p>stuff like</p>
<div class="codehilite"><pre><span></span><span class="kd">let</span><span class="w"> </span><span class="n">Single</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">y</span><span class="w"> </span><span class="p">}</span>: <span class="nc">Single</span><span class="o">&lt;&amp;</span><span class="nb">&#39;static</span><span class="w"> </span><span class="kt">u32</span><span class="o">&gt;</span><span class="p">;</span><span class="w"></span>
</pre></div>



<a name="133661889"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353873%20type%20ascription%20bugs%20and%20semantics/near/133661889" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353873.20type.20ascription.20bugs.20and.20semantics.html#133661889">(Sep 10 2018 at 13:55)</a>:</h4>
<p>is just weird</p>



<a name="133661892"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353873%20type%20ascription%20bugs%20and%20semantics/near/133661892" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> pnkfelix <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353873.20type.20ascription.20bugs.20and.20semantics.html#133661892">(Sep 10 2018 at 13:55)</a>:</h4>
<p>yes okay</p>



<a name="133661893"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353873%20type%20ascription%20bugs%20and%20semantics/near/133661893" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353873.20type.20ascription.20bugs.20and.20semantics.html#133661893">(Sep 10 2018 at 13:55)</a>:</h4>
<p>but annoying for us to handle</p>



<a name="133661901"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353873%20type%20ascription%20bugs%20and%20semantics/near/133661901" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353873.20type.20ascription.20bugs.20and.20semantics.html#133661901">(Sep 10 2018 at 13:55)</a>:</h4>
<p>I wonder if it is <em>ever</em> done</p>



<a name="133661904"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353873%20type%20ascription%20bugs%20and%20semantics/near/133661904" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> pnkfelix <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353873.20type.20ascription.20bugs.20and.20semantics.html#133661904">(Sep 10 2018 at 13:55)</a>:</h4>
<p>that is goofy, I agree about that</p>



<a name="133661907"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353873%20type%20ascription%20bugs%20and%20semantics/near/133661907" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> pnkfelix <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353873.20type.20ascription.20bugs.20and.20semantics.html#133661907">(Sep 10 2018 at 13:56)</a>:</h4>
<p>maybe we can kill it</p>



<a name="133661947"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353873%20type%20ascription%20bugs%20and%20semantics/near/133661947" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353873.20type.20ascription.20bugs.20and.20semantics.html#133661947">(Sep 10 2018 at 13:56)</a>:</h4>
<p>that's what I am wondering :)</p>



<a name="133661948"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353873%20type%20ascription%20bugs%20and%20semantics/near/133661948" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> pnkfelix <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353873.20type.20ascription.20bugs.20and.20semantics.html#133661948">(Sep 10 2018 at 13:56)</a>:</h4>
<p>in Rust 2021</p>



<a name="133661954"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353873%20type%20ascription%20bugs%20and%20semantics/near/133661954" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353873.20type.20ascription.20bugs.20and.20semantics.html#133661954">(Sep 10 2018 at 13:56)</a>:</h4>
<p>or Rust 2018 :)</p>



<a name="133661965"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353873%20type%20ascription%20bugs%20and%20semantics/near/133661965" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> pnkfelix <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353873.20type.20ascription.20bugs.20and.20semantics.html#133661965">(Sep 10 2018 at 13:56)</a>:</h4>
<p>you are optimistic</p>



<a name="133661966"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353873%20type%20ascription%20bugs%20and%20semantics/near/133661966" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> pnkfelix <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353873.20type.20ascription.20bugs.20and.20semantics.html#133661966">(Sep 10 2018 at 13:56)</a>:</h4>
<p>but you are also the one in charge. :)</p>



<a name="133661967"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353873%20type%20ascription%20bugs%20and%20semantics/near/133661967" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353873.20type.20ascription.20bugs.20and.20semantics.html#133661967">(Sep 10 2018 at 13:56)</a>:</h4>
<p>heh yes I know</p>



<a name="133661978"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353873%20type%20ascription%20bugs%20and%20semantics/near/133661978" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> pnkfelix <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353873.20type.20ascription.20bugs.20and.20semantics.html#133661978">(Sep 10 2018 at 13:56)</a>:</h4>
<p>"All hands on deck!"</p>



<a name="133661981"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353873%20type%20ascription%20bugs%20and%20semantics/near/133661981" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353873.20type.20ascription.20bugs.20and.20semantics.html#133661981">(Sep 10 2018 at 13:56)</a>:</h4>
<p>I would be curious if there is even a single <a href="http://crates.io" target="_blank" title="http://crates.io">crates.io</a> crate that uses it</p>



<a name="133661997"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353873%20type%20ascription%20bugs%20and%20semantics/near/133661997" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353873.20type.20ascription.20bugs.20and.20semantics.html#133661997">(Sep 10 2018 at 13:56)</a>:</h4>
<p>hard to grep for</p>



<a name="133662001"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353873%20type%20ascription%20bugs%20and%20semantics/near/133662001" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353873.20type.20ascription.20bugs.20and.20semantics.html#133662001">(Sep 10 2018 at 13:57)</a>:</h4>
<p><em>anyway</em></p>



<a name="133662039"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353873%20type%20ascription%20bugs%20and%20semantics/near/133662039" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353873.20type.20ascription.20bugs.20and.20semantics.html#133662039">(Sep 10 2018 at 13:57)</a>:</h4>
<p>we could make <code>let x: T</code> and even <code>let (a, b, c): (T1, T2, T3)</code> work with relative ease I think...</p>



<a name="133662051"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353873%20type%20ascription%20bugs%20and%20semantics/near/133662051" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353873.20type.20ascription.20bugs.20and.20semantics.html#133662051">(Sep 10 2018 at 13:57)</a>:</h4>
<p>the rest is just sort of annoying to code, but not "undoable"</p>



<a name="133662078"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353873%20type%20ascription%20bugs%20and%20semantics/near/133662078" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> pnkfelix <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353873.20type.20ascription.20bugs.20and.20semantics.html#133662078">(Sep 10 2018 at 13:58)</a>:</h4>
<p>fixing <code>let x: T;</code> and <code>let x: T = ...;</code> would make me pretty happy.</p>



<a name="133662111"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353873%20type%20ascription%20bugs%20and%20semantics/near/133662111" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> pnkfelix <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353873.20type.20ascription.20bugs.20and.20semantics.html#133662111">(Sep 10 2018 at 13:58)</a>:</h4>
<p>the tuple cases probably do need to be done too</p>



<a name="133662115"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353873%20type%20ascription%20bugs%20and%20semantics/near/133662115" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> pnkfelix <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353873.20type.20ascription.20bugs.20and.20semantics.html#133662115">(Sep 10 2018 at 13:58)</a>:</h4>
<p>the rest... eh, just emit a warning</p>



<a name="133662122"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353873%20type%20ascription%20bugs%20and%20semantics/near/133662122" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> pnkfelix <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353873.20type.20ascription.20bugs.20and.20semantics.html#133662122">(Sep 10 2018 at 13:58)</a>:</h4>
<p>"Your lifetimes here are not respected."</p>



<a name="133662132"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353873%20type%20ascription%20bugs%20and%20semantics/near/133662132" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353873.20type.20ascription.20bugs.20and.20semantics.html#133662132">(Sep 10 2018 at 13:58)</a>:</h4>
<p>I agree it's plausible</p>



<a name="133662142"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353873%20type%20ascription%20bugs%20and%20semantics/near/133662142" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353873.20type.20ascription.20bugs.20and.20semantics.html#133662142">(Sep 10 2018 at 13:58)</a>:</h4>
<p>this is why I was wondering if we could even kill it somehow</p>



<a name="133662149"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353873%20type%20ascription%20bugs%20and%20semantics/near/133662149" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353873.20type.20ascription.20bugs.20and.20semantics.html#133662149">(Sep 10 2018 at 13:58)</a>:</h4>
<p>anyway, let's solve the rest</p>



<a name="133662156"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353873%20type%20ascription%20bugs%20and%20semantics/near/133662156" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353873.20type.20ascription.20bugs.20and.20semantics.html#133662156">(Sep 10 2018 at 13:59)</a>:</h4>
<p>let me see, I bet I can fix <code>let x: T</code> pretty easily</p>



<a name="133662164"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353873%20type%20ascription%20bugs%20and%20semantics/near/133662164" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353873.20type.20ascription.20bugs.20and.20semantics.html#133662164">(Sep 10 2018 at 13:59)</a>:</h4>
<p>tuples I would prefer to defer to another PR</p>



<a name="133662170"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353873%20type%20ascription%20bugs%20and%20semantics/near/133662170" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> pnkfelix <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353873.20type.20ascription.20bugs.20and.20semantics.html#133662170">(Sep 10 2018 at 13:59)</a>:</h4>
<p>so okay, that's the first case you described</p>



<a name="133662176"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353873%20type%20ascription%20bugs%20and%20semantics/near/133662176" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> pnkfelix <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353873.20type.20ascription.20bugs.20and.20semantics.html#133662176">(Sep 10 2018 at 13:59)</a>:</h4>
<p>and I'm totally fine with deferring tuples</p>



<a name="133662248"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353873%20type%20ascription%20bugs%20and%20semantics/near/133662248" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> pnkfelix <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353873.20type.20ascription.20bugs.20and.20semantics.html#133662248">(Sep 10 2018 at 14:00)</a>:</h4>
<p>since those are a case of the kind of propagation you describe for the "second case"</p>



<a name="133662276"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353873%20type%20ascription%20bugs%20and%20semantics/near/133662276" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353873.20type.20ascription.20bugs.20and.20semantics.html#133662276">(Sep 10 2018 at 14:00)</a>:</h4>
<p>(I think that would also be something that could be readily mentored — tuples I mean)</p>



<a name="133662283"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353873%20type%20ascription%20bugs%20and%20semantics/near/133662283" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353873.20type.20ascription.20bugs.20and.20semantics.html#133662283">(Sep 10 2018 at 14:00)</a>:</h4>
<p>so, the second case...</p>



<a name="133662289"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353873%20type%20ascription%20bugs%20and%20semantics/near/133662289" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353873.20type.20ascription.20bugs.20and.20semantics.html#133662289">(Sep 10 2018 at 14:00)</a>:</h4>
<p>I guess plausibly the same treatment could be done</p>



<a name="133662298"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353873%20type%20ascription%20bugs%20and%20semantics/near/133662298" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353873.20type.20ascription.20bugs.20and.20semantics.html#133662298">(Sep 10 2018 at 14:00)</a>:</h4>
<p>that is, we could probably solve the 80-20 for both cases by saying that we:</p>



<a name="133662309"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353873%20type%20ascription%20bugs%20and%20semantics/near/133662309" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> pnkfelix <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353873.20type.20ascription.20bugs.20and.20semantics.html#133662309">(Sep 10 2018 at 14:00)</a>:</h4>
<p>so one thing I want to double check about the semantics here</p>



<a name="133662317"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353873%20type%20ascription%20bugs%20and%20semantics/near/133662317" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353873.20type.20ascription.20bugs.20and.20semantics.html#133662317">(Sep 10 2018 at 14:00)</a>:</h4>
<p>"down-propagate" the ascribed type to the bindings for variables + tuples</p>



<a name="133662329"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353873%20type%20ascription%20bugs%20and%20semantics/near/133662329" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353873.20type.20ascription.20bugs.20and.20semantics.html#133662329">(Sep 10 2018 at 14:01)</a>:</h4>
<p>(whether or not there is an initializer)</p>



<a name="133662337"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353873%20type%20ascription%20bugs%20and%20semantics/near/133662337" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> pnkfelix <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353873.20type.20ascription.20bugs.20and.20semantics.html#133662337">(Sep 10 2018 at 14:01)</a>:</h4>
<p><code>let x = E: T;</code> will now not be synonymous with <code>let x: T = E;</code>, right?</p>



<a name="133662355"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353873%20type%20ascription%20bugs%20and%20semantics/near/133662355" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> pnkfelix <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353873.20type.20ascription.20bugs.20and.20semantics.html#133662355">(Sep 10 2018 at 14:01)</a>:</h4>
<p>(because the first case will not constraint all occurrences of <code>x</code> to have the type <code>T</code>)</p>



<a name="133662357"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353873%20type%20ascription%20bugs%20and%20semantics/near/133662357" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353873.20type.20ascription.20bugs.20and.20semantics.html#133662357">(Sep 10 2018 at 14:01)</a>:</h4>
<p>not quite</p>



<a name="133662368"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353873%20type%20ascription%20bugs%20and%20semantics/near/133662368" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353873.20type.20ascription.20bugs.20and.20semantics.html#133662368">(Sep 10 2018 at 14:01)</a>:</h4>
<p>it isn't today, either</p>



<a name="133662383"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353873%20type%20ascription%20bugs%20and%20semantics/near/133662383" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353873.20type.20ascription.20bugs.20and.20semantics.html#133662383">(Sep 10 2018 at 14:01)</a>:</h4>
<p>I wouldn't think</p>



<a name="133662385"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353873%20type%20ascription%20bugs%20and%20semantics/near/133662385" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> pnkfelix <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353873.20type.20ascription.20bugs.20and.20semantics.html#133662385">(Sep 10 2018 at 14:01)</a>:</h4>
<p>oh is that right?</p>



<a name="133662423"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353873%20type%20ascription%20bugs%20and%20semantics/near/133662423" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> pnkfelix <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353873.20type.20ascription.20bugs.20and.20semantics.html#133662423">(Sep 10 2018 at 14:02)</a>:</h4>
<p>okay I shouldn't be surprised</p>



<a name="133662432"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353873%20type%20ascription%20bugs%20and%20semantics/near/133662432" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353873.20type.20ascription.20bugs.20and.20semantics.html#133662432">(Sep 10 2018 at 14:02)</a>:</h4>
<p>e.g. with <code>let mut</code></p>



<a name="133662442"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353873%20type%20ascription%20bugs%20and%20semantics/near/133662442" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353873.20type.20ascription.20bugs.20and.20semantics.html#133662442">(Sep 10 2018 at 14:02)</a>:</h4>
<p>the type <code>T</code> in the first case only applies to <code>E</code></p>



<a name="133662477"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353873%20type%20ascription%20bugs%20and%20semantics/near/133662477" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> pnkfelix <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353873.20type.20ascription.20bugs.20and.20semantics.html#133662477">(Sep 10 2018 at 14:02)</a>:</h4>
<p>when you say "today"</p>



<a name="133662485"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353873%20type%20ascription%20bugs%20and%20semantics/near/133662485" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> pnkfelix <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353873.20type.20ascription.20bugs.20and.20semantics.html#133662485">(Sep 10 2018 at 14:03)</a>:</h4>
<p>are you talking about AST-borrowck too?</p>



<a name="133662492"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353873%20type%20ascription%20bugs%20and%20semantics/near/133662492" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> pnkfelix <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353873.20type.20ascription.20bugs.20and.20semantics.html#133662492">(Sep 10 2018 at 14:03)</a>:</h4>
<p>or just NLL?</p>



<a name="133662495"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353873%20type%20ascription%20bugs%20and%20semantics/near/133662495" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353873.20type.20ascription.20bugs.20and.20semantics.html#133662495">(Sep 10 2018 at 14:03)</a>:</h4>
<p>I mean "as implemented, using AST borrowck"</p>



<a name="133662500"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353873%20type%20ascription%20bugs%20and%20semantics/near/133662500" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> pnkfelix <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353873.20type.20ascription.20bugs.20and.20semantics.html#133662500">(Sep 10 2018 at 14:03)</a>:</h4>
<p>I guess I'm still surprised.</p>



<a name="133662505"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353873%20type%20ascription%20bugs%20and%20semantics/near/133662505" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353873.20type.20ascription.20bugs.20and.20semantics.html#133662505">(Sep 10 2018 at 14:03)</a>:</h4>
<p>(iirc type ascription is usable with a feature gate?)</p>



<a name="133662532"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353873%20type%20ascription%20bugs%20and%20semantics/near/133662532" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353873.20type.20ascription.20bugs.20and.20semantics.html#133662532">(Sep 10 2018 at 14:03)</a>:</h4>
<p>well e.g. I would expect:</p>
<div class="codehilite"><pre><span></span><span class="kd">let</span><span class="w"> </span><span class="k">mut</span><span class="w"> </span><span class="n">x</span>: <span class="kp">&amp;</span><span class="nb">&#39;static</span><span class="w"> </span><span class="kt">u32</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">&amp;</span><span class="mi">22</span><span class="p">;</span><span class="w"></span>
<span class="kd">let</span><span class="w"> </span><span class="n">y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">44</span><span class="p">;</span><span class="w"></span>
<span class="n">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">&amp;</span><span class="n">y</span><span class="p">;</span><span class="w"></span>
</pre></div>


<p>to error</p>



<a name="133662547"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353873%20type%20ascription%20bugs%20and%20semantics/near/133662547" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> pnkfelix <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353873.20type.20ascription.20bugs.20and.20semantics.html#133662547">(Sep 10 2018 at 14:03)</a>:</h4>
<p>oh of course</p>



<a name="133662557"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353873%20type%20ascription%20bugs%20and%20semantics/near/133662557" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> pnkfelix <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353873.20type.20ascription.20bugs.20and.20semantics.html#133662557">(Sep 10 2018 at 14:04)</a>:</h4>
<p>subtyping</p>



<a name="133662600"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353873%20type%20ascription%20bugs%20and%20semantics/near/133662600" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> pnkfelix <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353873.20type.20ascription.20bugs.20and.20semantics.html#133662600">(Sep 10 2018 at 14:04)</a>:</h4>
<p>/me smacks head</p>



<a name="133662604"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353873%20type%20ascription%20bugs%20and%20semantics/near/133662604" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353873.20type.20ascription.20bugs.20and.20semantics.html#133662604">(Sep 10 2018 at 14:04)</a>:</h4>
<p>but I don't expect</p>
<div class="codehilite"><pre><span></span><span class="kd">let</span><span class="w"> </span><span class="k">mut</span><span class="w"> </span><span class="n">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">&amp;</span><span class="mi">22</span>: <span class="kp">&amp;</span><span class="nb">&#39;static</span><span class="w"> </span><span class="kt">u32</span><span class="p">;</span><span class="w"></span>
<span class="kd">let</span><span class="w"> </span><span class="n">y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">44</span><span class="p">;</span><span class="w"></span>
<span class="n">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">&amp;</span><span class="n">y</span><span class="p">;</span><span class="w"></span>
</pre></div>


<p>to error</p>



<a name="133662636"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353873%20type%20ascription%20bugs%20and%20semantics/near/133662636" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353873.20type.20ascription.20bugs.20and.20semantics.html#133662636">(Sep 10 2018 at 14:04)</a>:</h4>
<p>you can probably write the same example with <code>as</code>...</p>



<a name="133662717"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353873%20type%20ascription%20bugs%20and%20semantics/near/133662717" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353873.20type.20ascription.20bugs.20and.20semantics.html#133662717">(Sep 10 2018 at 14:05)</a>:</h4>
<p>ok so, I think now that if I do the "simple fix" for "down-propagating" pattern types into variable types</p>



<a name="133662719"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353873%20type%20ascription%20bugs%20and%20semantics/near/133662719" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353873.20type.20ascription.20bugs.20and.20semantics.html#133662719">(Sep 10 2018 at 14:05)</a>:</h4>
<p>it will fix both my examples</p>



<a name="133662728"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353873%20type%20ascription%20bugs%20and%20semantics/near/133662728" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353873.20type.20ascription.20bugs.20and.20semantics.html#133662728">(Sep 10 2018 at 14:05)</a>:</h4>
<p>it won't fix examples that use more complex patterns</p>



<a name="133662729"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353873%20type%20ascription%20bugs%20and%20semantics/near/133662729" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353873.20type.20ascription.20bugs.20and.20semantics.html#133662729">(Sep 10 2018 at 14:06)</a>:</h4>
<p>e.g., structs etc</p>



<a name="133662782"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353873%20type%20ascription%20bugs%20and%20semantics/near/133662782" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353873.20type.20ascription.20bugs.20and.20semantics.html#133662782">(Sep 10 2018 at 14:06)</a>:</h4>
<p>so in a way I guess my two examples -- <em>today</em> -- are the same problem</p>



<a name="133662805"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353873%20type%20ascription%20bugs%20and%20semantics/near/133662805" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> pnkfelix <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353873.20type.20ascription.20bugs.20and.20semantics.html#133662805">(Sep 10 2018 at 14:06)</a>:</h4>
<p>okay so I think it sounds like we've resolved the questions you had, in terms of next steps. I'm happy to summarize this conversation on the PR if you like, as a way of answering the Q(s) you posed in your last comment there.</p>



<a name="133662813"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353873%20type%20ascription%20bugs%20and%20semantics/near/133662813" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353873.20type.20ascription.20bugs.20and.20semantics.html#133662813">(Sep 10 2018 at 14:06)</a>:</h4>
<p>but I think that with polonius there is a distinct factor of where to enforce the subtyping constraint (this is indeed why I originally introduced <code>Locations::All</code>, but i'd like to remove that, but that's a problem for tomorrow)</p>



<a name="133662820"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353873%20type%20ascription%20bugs%20and%20semantics/near/133662820" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353873.20type.20ascription.20bugs.20and.20semantics.html#133662820">(Sep 10 2018 at 14:06)</a>:</h4>
<p>sounds good</p>



<a name="133662824"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353873%20type%20ascription%20bugs%20and%20semantics/near/133662824" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353873.20type.20ascription.20bugs.20and.20semantics.html#133662824">(Sep 10 2018 at 14:07)</a>:</h4>
<p>I think I can whip up that commit quickly</p>



<a name="133663449"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353873%20type%20ascription%20bugs%20and%20semantics/near/133663449" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> pnkfelix <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353873.20type.20ascription.20bugs.20and.20semantics.html#133663449">(Sep 10 2018 at 14:14)</a>:</h4>
<blockquote>
<p>so in a way I guess my two examples -- <em>today</em> -- are the same problem</p>
</blockquote>
<p>I suppose they are "the same", although the first case is something where we want the type annotation to constrain all assignments <em>to</em> <code>y</code>, while the second case is something where we want the type-checker to continue using the (more constrained/conservative) declared type for <code>y</code> when checking the <em>uses</em> of <code>y</code>. Does that sound right?</p>



<a name="133663510"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353873%20type%20ascription%20bugs%20and%20semantics/near/133663510" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> pnkfelix <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353873.20type.20ascription.20bugs.20and.20semantics.html#133663510">(Sep 10 2018 at 14:15)</a>:</h4>
<p>the words "constrained/conservative" are a bit goofy here</p>



<a name="133663579"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353873%20type%20ascription%20bugs%20and%20semantics/near/133663579" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> pnkfelix <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353873.20type.20ascription.20bugs.20and.20semantics.html#133663579">(Sep 10 2018 at 14:16)</a>:</h4>
<p>its "constrained" in the sense that <code>&amp;'a u32</code> is a more limited type (when compared to <code>&amp;'static u32</code>) for <em>using</em> <code>y</code></p>



<a name="133663637"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353873%20type%20ascription%20bugs%20and%20semantics/near/133663637" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353873.20type.20ascription.20bugs.20and.20semantics.html#133663637">(Sep 10 2018 at 14:17)</a>:</h4>
<p>(I actually have an idea how to implement the more complex patterns now, but I think it's best to leave for follow-up)</p>



<a name="133663754"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353873%20type%20ascription%20bugs%20and%20semantics/near/133663754" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353873.20type.20ascription.20bugs.20and.20semantics.html#133663754">(Sep 10 2018 at 14:18)</a>:</h4>
<blockquote>
<p>I suppose they are "the same", although the first case is something where we want the type annotation to constrain all assignments <em>to</em> <code>y</code>, while the second case is something where we want the type-checker to continue using the (more constrained/conservative) declared type for <code>y</code> when checking the <em>uses</em> of <code>y</code>. Does that sound right?</p>
</blockquote>
<p>yes, I think that the second case has more to do with setting an upper bound on the type -- that is, in the example, it cannot go "up" to the super type <code>&amp;'static u32</code></p>



<a name="133663771"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353873%20type%20ascription%20bugs%20and%20semantics/near/133663771" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353873.20type.20ascription.20bugs.20and.20semantics.html#133663771">(Sep 10 2018 at 14:18)</a>:</h4>
<p>note that I use <code>==</code> constraints when propagating the ascribed type down to the bindings</p>



<a name="133664194"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353873%20type%20ascription%20bugs%20and%20semantics/near/133664194" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353873.20type.20ascription.20bugs.20and.20semantics.html#133664194">(Sep 10 2018 at 14:23)</a>:</h4>
<p><span class="user-mention" data-user-id="116083">@pnkfelix</span> hmm, a thought: given that we both agree that when the user ascribes a type to a variable, it should apply to all assignments/uses to that variable, maybe I should store the <code>user_ty</code> for variables in the <code>LocalDefn</code></p>



<a name="133664255"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353873%20type%20ascription%20bugs%20and%20semantics/near/133664255" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353873.20type.20ascription.20bugs.20and.20semantics.html#133664255">(Sep 10 2018 at 14:24)</a>:</h4>
<p>that is, I was modifying the code so that </p>
<div class="codehilite"><pre><span></span><span class="kd">let</span><span class="w"> </span><span class="n">x</span>: <span class="nc">T</span><span class="p">;</span><span class="w"></span>
</pre></div>


<p>would generate a statement, but instead I can store <code>T</code> in the local definition of <code>x</code>, and enforce it that way in the type checker</p>



<a name="133664259"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353873%20type%20ascription%20bugs%20and%20semantics/near/133664259" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353873.20type.20ascription.20bugs.20and.20semantics.html#133664259">(Sep 10 2018 at 14:24)</a>:</h4>
<p>cool</p>



<a name="133667006"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353873%20type%20ascription%20bugs%20and%20semantics/near/133667006" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353873.20type.20ascription.20bugs.20and.20semantics.html#133667006">(Sep 10 2018 at 14:59)</a>:</h4>
<p><span class="user-mention" data-user-id="116083">@pnkfelix</span> ok I made that change and pushed: indeed, things now work so long as you don't use more complex patterns</p>



<a name="133667031"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353873%20type%20ascription%20bugs%20and%20semantics/near/133667031" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353873.20type.20ascription.20bugs.20and.20semantics.html#133667031">(Sep 10 2018 at 14:59)</a>:</h4>
<p>I realize incidentally that I think we are also not handling normalization correctly, but I want to address that in a follow-up too</p>



<a name="133667047"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353873%20type%20ascription%20bugs%20and%20semantics/near/133667047" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353873.20type.20ascription.20bugs.20and.20semantics.html#133667047">(Sep 10 2018 at 14:59)</a>:</h4>
<p>er, I wonder what I meant by this " Fix the WF rule bug"</p>



<a name="133667066"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353873%20type%20ascription%20bugs%20and%20semantics/near/133667066" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> pnkfelix <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353873.20type.20ascription.20bugs.20and.20semantics.html#133667066">(Sep 10 2018 at 14:59)</a>:</h4>
<p>heh. "Uh oh'</p>



<a name="133667144"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353873%20type%20ascription%20bugs%20and%20semantics/near/133667144" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353873.20type.20ascription.20bugs.20and.20semantics.html#133667144">(Sep 10 2018 at 15:00)</a>:</h4>
<p>oh, I remember what I meant</p>



<a name="133667155"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353873%20type%20ascription%20bugs%20and%20semantics/near/133667155" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353873.20type.20ascription.20bugs.20and.20semantics.html#133667155">(Sep 10 2018 at 15:00)</a>:</h4>
<p>hmm maybe I'll file a follow-up for that, too</p>



<a name="133667164"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353873%20type%20ascription%20bugs%20and%20semantics/near/133667164" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353873.20type.20ascription.20bugs.20and.20semantics.html#133667164">(Sep 10 2018 at 15:00)</a>:</h4>
<p>it's sort of a corner case</p>



<a name="133667182"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353873%20type%20ascription%20bugs%20and%20semantics/near/133667182" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353873.20type.20ascription.20bugs.20and.20semantics.html#133667182">(Sep 10 2018 at 15:01)</a>:</h4>
<p>we are vulnerable, I think, to <a href="https://github.com/rust-lang/rust/issues/41677" target="_blank" title="https://github.com/rust-lang/rust/issues/41677">#41677</a></p>



<a name="133667190"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353873%20type%20ascription%20bugs%20and%20semantics/near/133667190" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353873.20type.20ascription.20bugs.20and.20semantics.html#133667190">(Sep 10 2018 at 15:01)</a>:</h4>
<p>but I'd like to make a test case</p>



<a name="133667228"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353873%20type%20ascription%20bugs%20and%20semantics/near/133667228" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353873.20type.20ascription.20bugs.20and.20semantics.html#133667228">(Sep 10 2018 at 15:01)</a>:</h4>
<p>ok, well, my battery is out of power, so I will stop here for now :)</p>



<a name="133667255"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353873%20type%20ascription%20bugs%20and%20semantics/near/133667255" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353873.20type.20ascription.20bugs.20and.20semantics.html#133667255">(Sep 10 2018 at 15:01)</a>:</h4>
<p>let me see if I have enough power to file a follow-up issue</p>



<a name="133667419"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353873%20type%20ascription%20bugs%20and%20semantics/near/133667419" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353873.20type.20ascription.20bugs.20and.20semantics.html#133667419">(Sep 10 2018 at 15:03)</a>:</h4>
<p><span class="user-mention" data-user-id="116083">@pnkfelix</span> do you want to review the last few commits?</p>



<a name="133667425"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353873%20type%20ascription%20bugs%20and%20semantics/near/133667425" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353873.20type.20ascription.20bugs.20and.20semantics.html#133667425">(Sep 10 2018 at 15:03)</a>:</h4>
<p>if so, the PR is ready</p>



<a name="133667431"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353873%20type%20ascription%20bugs%20and%20semantics/near/133667431" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353873.20type.20ascription.20bugs.20and.20semantics.html#133667431">(Sep 10 2018 at 15:03)</a>:</h4>
<p>/me has to go, bbl</p>



<a name="133667494"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353873%20type%20ascription%20bugs%20and%20semantics/near/133667494" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> pnkfelix <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353873.20type.20ascription.20bugs.20and.20semantics.html#133667494">(Sep 10 2018 at 15:04)</a>:</h4>
<p>great will do</p>



<a name="133685281"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353873%20type%20ascription%20bugs%20and%20semantics/near/133685281" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353873.20type.20ascription.20bugs.20and.20semantics.html#133685281">(Sep 10 2018 at 20:02)</a>:</h4>
<p><span class="user-mention" data-user-id="116083">@pnkfelix</span> so I <a href="https://github.com/rust-lang/rust/issues/47184#issuecomment-420041056" target="_blank" title="https://github.com/rust-lang/rust/issues/47184#issuecomment-420041056">wrote up my idea for how to do the remaining bits without duplicating a ton of code</a>; though we do still duplicate <em>some</em>, in that we have to work out the logic to map from patterns to places. Maybe though we can share that with MIR builder too.</p>



<a name="133685322"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353873%20type%20ascription%20bugs%20and%20semantics/near/133685322" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353873.20type.20ascription.20bugs.20and.20semantics.html#133685322">(Sep 10 2018 at 20:02)</a>:</h4>
<p>This seems like something potentially mentorable</p>



<a name="133686040"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353873%20type%20ascription%20bugs%20and%20semantics/near/133686040" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Keith Yeung <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353873.20type.20ascription.20bugs.20and.20semantics.html#133686040">(Sep 10 2018 at 20:15)</a>:</h4>
<p>Hmm, I think I have an idea of what you just wrote</p>



<a name="133686059"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353873%20type%20ascription%20bugs%20and%20semantics/near/133686059" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Keith Yeung <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353873.20type.20ascription.20bugs.20and.20semantics.html#133686059">(Sep 10 2018 at 20:15)</a>:</h4>
<p>If this does become mentorable, I'd be happy to pick it up</p>



<a name="133686242"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353873%20type%20ascription%20bugs%20and%20semantics/near/133686242" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353873.20type.20ascription.20bugs.20and.20semantics.html#133686242">(Sep 10 2018 at 20:18)</a>:</h4>
<p>I guess the existing PR has to land first</p>



<a name="133686247"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353873%20type%20ascription%20bugs%20and%20semantics/near/133686247" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353873.20type.20ascription.20bugs.20and.20semantics.html#133686247">(Sep 10 2018 at 20:18)</a>:</h4>
<p>there are also a few other "unchecked boxes" to look into too</p>



<a name="133727368"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353873%20type%20ascription%20bugs%20and%20semantics/near/133727368" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> pnkfelix <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353873.20type.20ascription.20bugs.20and.20semantics.html#133727368">(Sep 11 2018 at 12:09)</a>:</h4>
<p>oh wow the "series of projection elements -- basically, the path that leads from the type that was given to the type of the binding" actually sounds very much like something I was going to suggest</p>



<a name="133727427"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353873%20type%20ascription%20bugs%20and%20semantics/near/133727427" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> pnkfelix <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353873.20type.20ascription.20bugs.20and.20semantics.html#133727427">(Sep 11 2018 at 12:10)</a>:</h4>
<p>namely, I kept thinking about the work I've read on Zippers and "The Derivative of a Type is the Type of its One-Hole Contexts"</p>



<a name="133727575"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353873%20type%20ascription%20bugs%20and%20semantics/near/133727575" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> pnkfelix <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353873.20type.20ascription.20bugs.20and.20semantics.html#133727575">(Sep 11 2018 at 12:13)</a>:</h4>
<p>though now that I try to spell that out, a path from the given type down to the type of the binding isn't exactly the same as a One-Hole Context</p>



<a name="133727623"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353873%20type%20ascription%20bugs%20and%20semantics/near/133727623" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> pnkfelix <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353873.20type.20ascription.20bugs.20and.20semantics.html#133727623">(Sep 11 2018 at 12:14)</a>:</h4>
<p>Still it definitely sounds like a promising direction</p>



<hr><p>Last updated: Apr 12 2022 at 20:01 UTC</p>
</html>