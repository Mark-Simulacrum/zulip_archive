<html>
<head><meta charset="utf-8"><title>#47184-user-given-type-annotations · t-compiler/wg-nll · Zulip Chat Archive</title></head>
<h2>Stream: <a href="https://rust-lang.github.io/zulip_archive/stream/122657-t-compiler/wg-nll/index.html">t-compiler/wg-nll</a></h2>
<h3>Topic: <a href="https://rust-lang.github.io/zulip_archive/stream/122657-t-compiler/wg-nll/topic/.2347184-user-given-type-annotations.html">#47184-user-given-type-annotations</a></h3>

<hr>

<base href="https://rust-lang.zulipchat.com">

<head><link href="https://rust-lang.github.io/zulip_archive/style.css" rel="stylesheet"></head>

<a name="130977159"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2347184-user-given-type-annotations/near/130977159" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://rust-lang.github.io/zulip_archive/stream/122657-t-compiler/wg-nll/topic/.2347184-user-given-type-annotations.html#130977159">(Aug 06 2018 at 13:02)</a>:</h4>
<p>So this is one of the major remaining bugs to fix</p>



<a name="130977164"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2347184-user-given-type-annotations/near/130977164" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://rust-lang.github.io/zulip_archive/stream/122657-t-compiler/wg-nll/topic/.2347184-user-given-type-annotations.html#130977164">(Aug 06 2018 at 13:02)</a>:</h4>
<p>I was talking about it with <span class="user-mention" data-user-id="116083">@pnkfelix</span> and we thought we could brainstorm how to fix</p>



<a name="130977170"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2347184-user-given-type-annotations/near/130977170" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://rust-lang.github.io/zulip_archive/stream/122657-t-compiler/wg-nll/topic/.2347184-user-given-type-annotations.html#130977170">(Aug 06 2018 at 13:02)</a>:</h4>
<p>(cc <span class="user-mention" data-user-id="116107">@davidtwco</span> who did the existing work on this)</p>



<a name="130977174"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2347184-user-given-type-annotations/near/130977174" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://rust-lang.github.io/zulip_archive/stream/122657-t-compiler/wg-nll/topic/.2347184-user-given-type-annotations.html#130977174">(Aug 06 2018 at 13:02)</a>:</h4>
<p>I think the first thing is to try to catalog where the points of concern are</p>



<a name="130977186"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2347184-user-given-type-annotations/near/130977186" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://rust-lang.github.io/zulip_archive/stream/122657-t-compiler/wg-nll/topic/.2347184-user-given-type-annotations.html#130977186">(Aug 06 2018 at 13:03)</a>:</h4>
<p>the only case I that I believe works today is this one:</p>



<a name="130977190"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2347184-user-given-type-annotations/near/130977190" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://rust-lang.github.io/zulip_archive/stream/122657-t-compiler/wg-nll/topic/.2347184-user-given-type-annotations.html#130977190">(Aug 06 2018 at 13:03)</a>:</h4>
<div class="codehilite"><pre><span></span><span class="kd">let</span><span class="w"> </span><span class="n">x</span>: <span class="nc">T</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">...;</span><span class="w"></span>
</pre></div>


<p>where <code>x</code> is a single variable, not a pattern like <code>_</code> or <code>(x, y)</code></p>



<a name="130977238"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2347184-user-given-type-annotations/near/130977238" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> pnkfelix <a href="https://rust-lang.github.io/zulip_archive/stream/122657-t-compiler/wg-nll/topic/.2347184-user-given-type-annotations.html#130977238">(Aug 06 2018 at 13:04)</a>:</h4>
<p>should we perhaps transcribe <span class="user-mention" data-user-id="116107">@davidtwco</span> 's <a href="https://github.com/rust-lang/rust/issues/47184#issuecomment-372716098" target="_blank" title="https://github.com/rust-lang/rust/issues/47184#issuecomment-372716098">comment</a> with a categorization of cases remaing, transcribe that to the Issue Descriptioin</p>



<a name="130977241"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2347184-user-given-type-annotations/near/130977241" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> pnkfelix <a href="https://rust-lang.github.io/zulip_archive/stream/122657-t-compiler/wg-nll/topic/.2347184-user-given-type-annotations.html#130977241">(Aug 06 2018 at 13:04)</a>:</h4>
<p>with check boxes, even? :)</p>



<a name="130977243"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2347184-user-given-type-annotations/near/130977243" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://rust-lang.github.io/zulip_archive/stream/122657-t-compiler/wg-nll/topic/.2347184-user-given-type-annotations.html#130977243">(Aug 06 2018 at 13:04)</a>:</h4>
<p>the other cases then are :</p>
<ul>
<li><code>let</code> with a pattern</li>
<li><code>foo::&lt;...&gt;</code> expressions </li>
<li><code>Foo::&lt;...&gt; { .. .}</code> struct constructors</li>
<li><code>foo.bar::&lt;...&gt;</code> method calls</li>
<li><code>&lt;T as Foo&gt;::bar</code> sorts of paths maybe? This may be the same as a <code>foo::&lt;..&gt;</code> expression</li>
</ul>



<a name="130977244"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2347184-user-given-type-annotations/near/130977244" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> pnkfelix <a href="https://rust-lang.github.io/zulip_archive/stream/122657-t-compiler/wg-nll/topic/.2347184-user-given-type-annotations.html#130977244">(Aug 06 2018 at 13:04)</a>:</h4>
<p>ohj it had check boxes</p>



<a name="130977252"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2347184-user-given-type-annotations/near/130977252" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://rust-lang.github.io/zulip_archive/stream/122657-t-compiler/wg-nll/topic/.2347184-user-given-type-annotations.html#130977252">(Aug 06 2018 at 13:04)</a>:</h4>
<p>oh yes I think I remember going through that exercise with <span class="user-mention" data-user-id="116107">@davidtwco</span> before :)</p>



<a name="130977253"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2347184-user-given-type-annotations/near/130977253" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> pnkfelix <a href="https://rust-lang.github.io/zulip_archive/stream/122657-t-compiler/wg-nll/topic/.2347184-user-given-type-annotations.html#130977253">(Aug 06 2018 at 13:04)</a>:</h4>
<p>i'm going to do it</p>



<a name="130977267"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2347184-user-given-type-annotations/near/130977267" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://rust-lang.github.io/zulip_archive/stream/122657-t-compiler/wg-nll/topic/.2347184-user-given-type-annotations.html#130977267">(Aug 06 2018 at 13:05)</a>:</h4>
<p>but it looks like that list is roughly the same as mine</p>



<a name="130977297"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2347184-user-given-type-annotations/near/130977297" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://rust-lang.github.io/zulip_archive/stream/122657-t-compiler/wg-nll/topic/.2347184-user-given-type-annotations.html#130977297">(Aug 06 2018 at 13:05)</a>:</h4>
<p>I'm not entirely sure what</p>
<blockquote>
<p>Lifetimes defined but not used, this currently only occurs in the <a href="http://yield-subtype.rs" target="_blank" title="http://yield-subtype.rs">yield-subtype.rs</a> test but that will also need resolved.</p>
</blockquote>
<p>was referring to, have to check that test, but I think it's maybe the (unrelated, really) issue <a href="https://github.com/rust-lang/rust/issues/51351" target="_blank" title="https://github.com/rust-lang/rust/issues/51351">#51351</a> that <span class="user-mention" data-user-id="116925">@mikhail-m1</span> fixed recently</p>



<a name="130977360"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2347184-user-given-type-annotations/near/130977360" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://rust-lang.github.io/zulip_archive/stream/122657-t-compiler/wg-nll/topic/.2347184-user-given-type-annotations.html#130977360">(Aug 06 2018 at 13:06)</a>:</h4>
<p>(yes, I think I am correct)</p>



<a name="130977363"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2347184-user-given-type-annotations/near/130977363" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://rust-lang.github.io/zulip_archive/stream/122657-t-compiler/wg-nll/topic/.2347184-user-given-type-annotations.html#130977363">(Aug 06 2018 at 13:06)</a>:</h4>
<p><a href="http://yield-subtype.rs" target="_blank" title="http://yield-subtype.rs">yield-subtype.rs</a>:</p>
<div class="codehilite"><pre><span></span><span class="k">fn</span> <span class="nf">bar</span><span class="o">&lt;</span><span class="na">&#39;a</span><span class="o">&gt;</span><span class="p">()</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="n">a</span>: <span class="kp">&amp;</span><span class="nb">&#39;static</span><span class="w"> </span><span class="kt">str</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;hi&quot;</span><span class="p">;</span><span class="w"></span>
<span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="n">b</span>: <span class="kp">&amp;</span><span class="na">&#39;a</span><span class="w"> </span><span class="kt">str</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">a</span><span class="p">;</span><span class="w"></span>

<span class="w">    </span><span class="o">||</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">        </span><span class="kr">yield</span><span class="w"> </span><span class="n">a</span><span class="p">;</span><span class="w"></span>
<span class="w">        </span><span class="kr">yield</span><span class="w"> </span><span class="n">b</span><span class="p">;</span><span class="w"></span>
<span class="w">    </span><span class="p">};</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>
</pre></div>



<a name="130977390"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2347184-user-given-type-annotations/near/130977390" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://rust-lang.github.io/zulip_archive/stream/122657-t-compiler/wg-nll/topic/.2347184-user-given-type-annotations.html#130977390">(Aug 06 2018 at 13:07)</a>:</h4>
<p>so there are a couple of aspects to this</p>



<a name="130977402"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2347184-user-given-type-annotations/near/130977402" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://rust-lang.github.io/zulip_archive/stream/122657-t-compiler/wg-nll/topic/.2347184-user-given-type-annotations.html#130977402">(Aug 06 2018 at 13:07)</a>:</h4>
<p>I think that the case of specifying types in substitutions is somewhat different from the other cases</p>



<a name="130977411"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2347184-user-given-type-annotations/near/130977411" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://rust-lang.github.io/zulip_archive/stream/122657-t-compiler/wg-nll/topic/.2347184-user-given-type-annotations.html#130977411">(Aug 06 2018 at 13:07)</a>:</h4>
<p>e.g., like <code>foo::&lt;&amp;'a u32&gt;</code> or something</p>



<a name="130977421"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2347184-user-given-type-annotations/near/130977421" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://rust-lang.github.io/zulip_archive/stream/122657-t-compiler/wg-nll/topic/.2347184-user-given-type-annotations.html#130977421">(Aug 06 2018 at 13:07)</a>:</h4>
<p>currently, in MIR, those types are just <code>Ty</code> that are embedded in the MIR directly</p>



<a name="130977492"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2347184-user-given-type-annotations/near/130977492" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://rust-lang.github.io/zulip_archive/stream/122657-t-compiler/wg-nll/topic/.2347184-user-given-type-annotations.html#130977492">(Aug 06 2018 at 13:08)</a>:</h4>
<p>so I think that something like <code>let x = foo::&lt;&amp;'a u32&gt;(&amp;22)</code> would be a constant reference</p>



<a name="130977601"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2347184-user-given-type-annotations/near/130977601" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://rust-lang.github.io/zulip_archive/stream/122657-t-compiler/wg-nll/topic/.2347184-user-given-type-annotations.html#130977601">(Aug 06 2018 at 13:10)</a>:</h4>
<p>e.g.</p>
<div class="codehilite"><pre><span></span>TMP0 = foo::&lt;&amp;&#39;a u32&gt;
TMP1 = TMP0(&amp;22)
</pre></div>



<a name="130977613"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2347184-user-given-type-annotations/near/130977613" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://rust-lang.github.io/zulip_archive/stream/122657-t-compiler/wg-nll/topic/.2347184-user-given-type-annotations.html#130977613">(Aug 06 2018 at 13:10)</a>:</h4>
<p>one thought I had for this is that the MIR could stop embedding <code>Ty&lt;'tcx&gt;</code> <em>directly</em></p>



<a name="130977620"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2347184-user-given-type-annotations/near/130977620" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://rust-lang.github.io/zulip_archive/stream/122657-t-compiler/wg-nll/topic/.2347184-user-given-type-annotations.html#130977620">(Aug 06 2018 at 13:10)</a>:</h4>
<p>and instead include a <code>TypeIndex</code></p>



<a name="130977627"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2347184-user-given-type-annotations/near/130977627" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://rust-lang.github.io/zulip_archive/stream/122657-t-compiler/wg-nll/topic/.2347184-user-given-type-annotations.html#130977627">(Aug 06 2018 at 13:10)</a>:</h4>
<p>and the <code>Mir</code> struct would have a list of types</p>



<a name="130977629"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2347184-user-given-type-annotations/near/130977629" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://rust-lang.github.io/zulip_archive/stream/122657-t-compiler/wg-nll/topic/.2347184-user-given-type-annotations.html#130977629">(Aug 06 2018 at 13:11)</a>:</h4>
<p>(probably and substs)</p>



<a name="130977637"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2347184-user-given-type-annotations/near/130977637" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://rust-lang.github.io/zulip_archive/stream/122657-t-compiler/wg-nll/topic/.2347184-user-given-type-annotations.html#130977637">(Aug 06 2018 at 13:11)</a>:</h4>
<p>and then we could have constraints</p>



<a name="130977638"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2347184-user-given-type-annotations/near/130977638" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://rust-lang.github.io/zulip_archive/stream/122657-t-compiler/wg-nll/topic/.2347184-user-given-type-annotations.html#130977638">(Aug 06 2018 at 13:11)</a>:</h4>
<p>i'm not sure how easy that would be though, might be horribly annoying</p>



<a name="130977641"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2347184-user-given-type-annotations/near/130977641" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> pnkfelix <a href="https://rust-lang.github.io/zulip_archive/stream/122657-t-compiler/wg-nll/topic/.2347184-user-given-type-annotations.html#130977641">(Aug 06 2018 at 13:11)</a>:</h4>
<p>the goal would be...</p>



<a name="130977650"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2347184-user-given-type-annotations/near/130977650" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://rust-lang.github.io/zulip_archive/stream/122657-t-compiler/wg-nll/topic/.2347184-user-given-type-annotations.html#130977650">(Aug 06 2018 at 13:11)</a>:</h4>
<p>basically the challenge is.. how do we distinguish "this is a region that user wrote"</p>



<a name="130977652"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2347184-user-given-type-annotations/near/130977652" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://rust-lang.github.io/zulip_archive/stream/122657-t-compiler/wg-nll/topic/.2347184-user-given-type-annotations.html#130977652">(Aug 06 2018 at 13:11)</a>:</h4>
<p>from "this is a region we inferred"</p>



<a name="130977717"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2347184-user-given-type-annotations/near/130977717" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://rust-lang.github.io/zulip_archive/stream/122657-t-compiler/wg-nll/topic/.2347184-user-given-type-annotations.html#130977717">(Aug 06 2018 at 13:12)</a>:</h4>
<p>alternatively we could, in those constraints we add, have some other way to "uniquely identify" the substs we are constraining</p>



<a name="130977725"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2347184-user-given-type-annotations/near/130977725" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://rust-lang.github.io/zulip_archive/stream/122657-t-compiler/wg-nll/topic/.2347184-user-given-type-annotations.html#130977725">(Aug 06 2018 at 13:12)</a>:</h4>
<p>but it seems tricky to do</p>



<a name="130977750"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2347184-user-given-type-annotations/near/130977750" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://rust-lang.github.io/zulip_archive/stream/122657-t-compiler/wg-nll/topic/.2347184-user-given-type-annotations.html#130977750">(Aug 06 2018 at 13:13)</a>:</h4>
<p>so the MIR after my change might "look like"</p>
<div class="codehilite"><pre><span></span>B0 {
  TMP0 = foo::&lt;S0&gt;
  TMP1 = TMP0(&amp;22)
}

Substs {
  S0 = [&amp;&#39;a u32]
}
</pre></div>


<p>and then a side constraint like <code>User [ S0 = &amp;'a u32 ]</code> because that was given from the user</p>



<a name="130977789"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2347184-user-given-type-annotations/near/130977789" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://rust-lang.github.io/zulip_archive/stream/122657-t-compiler/wg-nll/topic/.2347184-user-given-type-annotations.html#130977789">(Aug 06 2018 at 13:14)</a>:</h4>
<p>let me show a slightly more extended example...</p>



<a name="130977803"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2347184-user-given-type-annotations/near/130977803" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://rust-lang.github.io/zulip_archive/stream/122657-t-compiler/wg-nll/topic/.2347184-user-given-type-annotations.html#130977803">(Aug 06 2018 at 13:14)</a>:</h4>
<p><code>foo::&lt;&amp;u32, _&gt;(...)</code></p>



<a name="130977821"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2347184-user-given-type-annotations/near/130977821" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://rust-lang.github.io/zulip_archive/stream/122657-t-compiler/wg-nll/topic/.2347184-user-given-type-annotations.html#130977821">(Aug 06 2018 at 13:14)</a>:</h4>
<p>might wind up as <code>foo::&lt;S0&gt;</code> with</p>
<div class="codehilite"><pre><span></span>substs {
  S0 = [&amp;&#39;a u32, &amp;&#39;b u32] // final inferred values
}

user {
  S0 = [&amp;&#39;a u32, _] // a canonical type
}
</pre></div>



<a name="130977839"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2347184-user-given-type-annotations/near/130977839" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://rust-lang.github.io/zulip_archive/stream/122657-t-compiler/wg-nll/topic/.2347184-user-given-type-annotations.html#130977839">(Aug 06 2018 at 13:15)</a>:</h4>
<p>eventually the "inferred" values will actually be <em>erased</em> values</p>



<a name="130977860"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2347184-user-given-type-annotations/near/130977860" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://rust-lang.github.io/zulip_archive/stream/122657-t-compiler/wg-nll/topic/.2347184-user-given-type-annotations.html#130977860">(Aug 06 2018 at 13:15)</a>:</h4>
<p>anyway, that's the rough idea I had for modifying the MIr. The next question is how to generate those <code>user { .. }</code> things, but let's  leave that aside for the second :)</p>



<a name="130978059"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2347184-user-given-type-annotations/near/130978059" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://rust-lang.github.io/zulip_archive/stream/122657-t-compiler/wg-nll/topic/.2347184-user-given-type-annotations.html#130978059">(Aug 06 2018 at 13:19)</a>:</h4>
<p><span class="user-mention" data-user-id="116083">@pnkfelix</span> thoughts?</p>



<a name="130978134"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2347184-user-given-type-annotations/near/130978134" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> pnkfelix <a href="https://rust-lang.github.io/zulip_archive/stream/122657-t-compiler/wg-nll/topic/.2347184-user-given-type-annotations.html#130978134">(Aug 06 2018 at 13:20)</a>:</h4>
<p>i guess it seems more complicated than what I had idealized</p>



<a name="130978144"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2347184-user-given-type-annotations/near/130978144" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> davidtwco <a href="https://rust-lang.github.io/zulip_archive/stream/122657-t-compiler/wg-nll/topic/.2347184-user-given-type-annotations.html#130978144">(Aug 06 2018 at 13:20)</a>:</h4>
<p>I'm still happy to help out on this issue with any parts of it where I might be of use.</p>



<a name="130978145"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2347184-user-given-type-annotations/near/130978145" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> pnkfelix <a href="https://rust-lang.github.io/zulip_archive/stream/122657-t-compiler/wg-nll/topic/.2347184-user-given-type-annotations.html#130978145">(Aug 06 2018 at 13:20)</a>:</h4>
<p>but I also am sure you know more about the problems that are going t oarise</p>



<a name="130978187"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2347184-user-given-type-annotations/near/130978187" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> pnkfelix <a href="https://rust-lang.github.io/zulip_archive/stream/122657-t-compiler/wg-nll/topic/.2347184-user-given-type-annotations.html#130978187">(Aug 06 2018 at 13:21)</a>:</h4>
<p>(I think part of my problem is that I've forgotten your explanation for why emitting more UserAssertTy stmts is not going to suffice for all cases...)</p>



<a name="130978263"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2347184-user-given-type-annotations/near/130978263" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> pnkfelix <a href="https://rust-lang.github.io/zulip_archive/stream/122657-t-compiler/wg-nll/topic/.2347184-user-given-type-annotations.html#130978263">(Aug 06 2018 at 13:23)</a>:</h4>
<p>e.g. for turbofish cases: if they wrote <code>"2048".parse::&lt;u32&gt;()</code>, I would have thought we could emit UserAssertTy</p>



<a name="130978266"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2347184-user-given-type-annotations/near/130978266" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> pnkfelix <a href="https://rust-lang.github.io/zulip_archive/stream/122657-t-compiler/wg-nll/topic/.2347184-user-given-type-annotations.html#130978266">(Aug 06 2018 at 13:23)</a>:</h4>
<p>anyway I have to go AFK</p>



<a name="130978439"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2347184-user-given-type-annotations/near/130978439" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://rust-lang.github.io/zulip_archive/stream/122657-t-compiler/wg-nll/topic/.2347184-user-given-type-annotations.html#130978439">(Aug 06 2018 at 13:26)</a>:</h4>
<p>ok ttyl</p>



<a name="130978466"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2347184-user-given-type-annotations/near/130978466" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://rust-lang.github.io/zulip_archive/stream/122657-t-compiler/wg-nll/topic/.2347184-user-given-type-annotations.html#130978466">(Aug 06 2018 at 13:27)</a>:</h4>
<p>we <em>might</em> be able to do <code>UserAssertTy</code> in that case, though it seems complicated, but I don't know about stuff like <code>x = foo::&lt;...&gt;(...)</code> calls</p>



<a name="130978474"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2347184-user-given-type-annotations/near/130978474" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://rust-lang.github.io/zulip_archive/stream/122657-t-compiler/wg-nll/topic/.2347184-user-given-type-annotations.html#130978474">(Aug 06 2018 at 13:27)</a>:</h4>
<p>since then the type parameter may not show up in any variable's type necessarily</p>



<a name="130978481"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2347184-user-given-type-annotations/near/130978481" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://rust-lang.github.io/zulip_archive/stream/122657-t-compiler/wg-nll/topic/.2347184-user-given-type-annotations.html#130978481">(Aug 06 2018 at 13:27)</a>:</h4>
<p><span class="user-mention" data-user-id="116107">@davidtwco</span> I definitely think this is going to need some refactoring / exploration help :)</p>



<a name="130979404"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2347184-user-given-type-annotations/near/130979404" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> pnkfelix <a href="https://rust-lang.github.io/zulip_archive/stream/122657-t-compiler/wg-nll/topic/.2347184-user-given-type-annotations.html#130979404">(Aug 06 2018 at 13:44)</a>:</h4>
<p>(oh yes, now I remember thinking that maybe UserAssertTy should take a Place ratehr than a Local or something along those lines</p>



<a name="130979803"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2347184-user-given-type-annotations/near/130979803" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://rust-lang.github.io/zulip_archive/stream/122657-t-compiler/wg-nll/topic/.2347184-user-given-type-annotations.html#130979803">(Aug 06 2018 at 13:53)</a>:</h4>
<p>so there is one other problem which is that things like <code>let PATTERN: TYPE</code> don't obviously have a type to annotate -- there I think  we probably <em>do</em> want to extend <code>UserAssertTy</code>, except that it would take -- not, I think -- a <code>Place</code> but rather some kind of "pattern-like-thing"?</p>



<a name="130979807"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2347184-user-given-type-annotations/near/130979807" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://rust-lang.github.io/zulip_archive/stream/122657-t-compiler/wg-nll/topic/.2347184-user-given-type-annotations.html#130979807">(Aug 06 2018 at 13:53)</a>:</h4>
<p>it's probably worth exploring those cases a bit too</p>



<a name="130979809"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2347184-user-given-type-annotations/near/130979809" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://rust-lang.github.io/zulip_archive/stream/122657-t-compiler/wg-nll/topic/.2347184-user-given-type-annotations.html#130979809">(Aug 06 2018 at 13:53)</a>:</h4>
<p>there is e.g.</p>



<a name="131134605"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2347184-user-given-type-annotations/near/131134605" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://rust-lang.github.io/zulip_archive/stream/122657-t-compiler/wg-nll/topic/.2347184-user-given-type-annotations.html#131134605">(Aug 08 2018 at 21:50)</a>:</h4>
<p>I'm making some progress here</p>



<a name="131134610"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2347184-user-given-type-annotations/near/131134610" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://rust-lang.github.io/zulip_archive/stream/122657-t-compiler/wg-nll/topic/.2347184-user-given-type-annotations.html#131134610">(Aug 08 2018 at 21:50)</a>:</h4>
<p>I've got a branch that is now recording -- as part of type-check -- the user-given annotations in various fns and method scenarios</p>



<a name="131134704"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2347184-user-given-type-annotations/near/131134704" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://rust-lang.github.io/zulip_archive/stream/122657-t-compiler/wg-nll/topic/.2347184-user-given-type-annotations.html#131134704">(Aug 08 2018 at 21:53)</a>:</h4>
<p>e.g., these cases seem to work</p>
<div class="codehilite"><pre><span></span><span class="cp">#[rustc_dump_user_substs]</span><span class="w"></span>
<span class="k">fn</span> <span class="nf">main</span><span class="p">()</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="c1">// Here: nothing is given. In fact, it&#39;d be sort of nice to not</span>
<span class="w">    </span><span class="c1">// have any annotation here.</span>
<span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="n">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">foo</span><span class="p">;</span><span class="w"> </span><span class="c1">//~ ERROR [?0]</span>
<span class="w">    </span><span class="n">x</span><span class="p">(</span><span class="mi">22</span><span class="p">);</span><span class="w"></span>

<span class="w">    </span><span class="c1">// Here: `u32` is given.</span>
<span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="n">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">foo</span>::<span class="o">&lt;</span><span class="kt">u32</span><span class="o">&gt;</span><span class="p">;</span><span class="w"> </span><span class="c1">//~ ERROR [u32]</span>
<span class="w">    </span><span class="n">x</span><span class="p">(</span><span class="mi">22</span><span class="p">);</span><span class="w"></span>

<span class="w">    </span><span class="c1">// Here: we only want the `T` to be given, the rest should be variables.</span>
<span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="n">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">&lt;</span><span class="n">_</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="n">Bazoom</span><span class="o">&lt;</span><span class="kt">u32</span><span class="o">&gt;&gt;</span>::<span class="n">method</span>::<span class="o">&lt;</span><span class="n">_</span><span class="o">&gt;</span><span class="p">;</span><span class="w"> </span><span class="c1">//~ ERROR [?0, u32, ?1]</span>
<span class="w">    </span><span class="n">x</span><span class="p">(</span><span class="o">&amp;</span><span class="mi">22</span><span class="p">,</span><span class="w"> </span><span class="mi">44</span><span class="p">,</span><span class="w"> </span><span class="mi">66</span><span class="p">);</span><span class="w"></span>

<span class="w">    </span><span class="c1">// Here: all are given</span>
<span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="n">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">&lt;</span><span class="kt">u8</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="n">Bazoom</span><span class="o">&lt;</span><span class="kt">u16</span><span class="o">&gt;&gt;</span>::<span class="n">method</span>::<span class="o">&lt;</span><span class="kt">u32</span><span class="o">&gt;</span><span class="p">;</span><span class="w"> </span><span class="c1">//~ ERROR [u8, u16, u32]</span>
<span class="w">    </span><span class="n">x</span><span class="p">(</span><span class="o">&amp;</span><span class="mi">22</span><span class="p">,</span><span class="w"> </span><span class="mi">44</span><span class="p">,</span><span class="w"> </span><span class="mi">66</span><span class="p">);</span><span class="w"></span>

<span class="w">    </span><span class="c1">// Here: we want in particular that *only* the method `U`</span>
<span class="w">    </span><span class="c1">// annotation is given, the rest are variables.</span>
<span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="n">y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">22_</span><span class="k">u32</span><span class="p">;</span><span class="w"></span>
<span class="w">    </span><span class="n">y</span><span class="p">.</span><span class="n">method</span>::<span class="o">&lt;</span><span class="kt">u32</span><span class="o">&gt;</span><span class="p">(</span><span class="mi">44</span><span class="p">,</span><span class="w"> </span><span class="mi">66</span><span class="p">);</span><span class="w"> </span><span class="c1">//~ ERROR [?0, ?1, u32]</span>

<span class="w">    </span><span class="c1">// Here: nothing is given. In fact, it&#39;d be sort of nice to not</span>
<span class="w">    </span><span class="c1">// have any annotation here.</span>
<span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="n">y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">22_</span><span class="k">u32</span><span class="p">;</span><span class="w"></span>
<span class="w">    </span><span class="n">y</span><span class="p">.</span><span class="n">method</span><span class="p">(</span><span class="mi">44</span><span class="p">,</span><span class="w"> </span><span class="mi">66</span><span class="p">);</span><span class="w"> </span><span class="c1">//~ ERROR [?0, ?1, ?2]</span>
<span class="p">}</span><span class="w"></span>
</pre></div>



<a name="131134710"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2347184-user-given-type-annotations/near/131134710" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://rust-lang.github.io/zulip_archive/stream/122657-t-compiler/wg-nll/topic/.2347184-user-given-type-annotations.html#131134710">(Aug 08 2018 at 21:53)</a>:</h4>
<p>well, by work I mean "we record the write thing"</p>



<a name="131134711"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2347184-user-given-type-annotations/near/131134711" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://rust-lang.github.io/zulip_archive/stream/122657-t-compiler/wg-nll/topic/.2347184-user-given-type-annotations.html#131134711">(Aug 08 2018 at 21:53)</a>:</h4>
<p>I have some thoughts about how to encode it in the MIR level, I think there is something relatively simple we can do</p>



<a name="131135123"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2347184-user-given-type-annotations/near/131135123" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> davidtwco <a href="https://rust-lang.github.io/zulip_archive/stream/122657-t-compiler/wg-nll/topic/.2347184-user-given-type-annotations.html#131135123">(Aug 08 2018 at 22:02)</a>:</h4>
<p><span class="emoji emoji-1f389" title="tada">:tada:</span></p>



<a name="131135206"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2347184-user-given-type-annotations/near/131135206" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://rust-lang.github.io/zulip_archive/stream/122657-t-compiler/wg-nll/topic/.2347184-user-given-type-annotations.html#131135206">(Aug 08 2018 at 22:04)</a>:</h4>
<p><span class="user-mention" data-user-id="116107">@davidtwco</span> this won't help at all with the pattern case</p>



<a name="131135208"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2347184-user-given-type-annotations/near/131135208" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://rust-lang.github.io/zulip_archive/stream/122657-t-compiler/wg-nll/topic/.2347184-user-given-type-annotations.html#131135208">(Aug 08 2018 at 22:04)</a>:</h4>
<p>I think we just have to handle that separately</p>



<a name="131135211"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2347184-user-given-type-annotations/near/131135211" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://rust-lang.github.io/zulip_archive/stream/122657-t-compiler/wg-nll/topic/.2347184-user-given-type-annotations.html#131135211">(Aug 08 2018 at 22:04)</a>:</h4>
<p>that's actually the most common, of course</p>



<a name="131135242"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2347184-user-given-type-annotations/near/131135242" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> davidtwco <a href="https://rust-lang.github.io/zulip_archive/stream/122657-t-compiler/wg-nll/topic/.2347184-user-given-type-annotations.html#131135242">(Aug 08 2018 at 22:05)</a>:</h4>
<p>Will you be able to funnel all these cases through the same code that unpacks the complex cases? Or will they need their own handling?</p>



<a name="131135251"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2347184-user-given-type-annotations/near/131135251" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://rust-lang.github.io/zulip_archive/stream/122657-t-compiler/wg-nll/topic/.2347184-user-given-type-annotations.html#131135251">(Aug 08 2018 at 22:05)</a>:</h4>
<p>which do you mean by "these cases", sorry?</p>



<a name="131135292"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2347184-user-given-type-annotations/near/131135292" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> davidtwco <a href="https://rust-lang.github.io/zulip_archive/stream/122657-t-compiler/wg-nll/topic/.2347184-user-given-type-annotations.html#131135292">(Aug 08 2018 at 22:06)</a>:</h4>
<p>All the different places you are pulling annotations from.</p>



<a name="131136258"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2347184-user-given-type-annotations/near/131136258" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://rust-lang.github.io/zulip_archive/stream/122657-t-compiler/wg-nll/topic/.2347184-user-given-type-annotations.html#131136258">(Aug 08 2018 at 22:29)</a>:</h4>
<p>I think it will come down to two cases, basically:</p>



<a name="131136261"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2347184-user-given-type-annotations/near/131136261" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://rust-lang.github.io/zulip_archive/stream/122657-t-compiler/wg-nll/topic/.2347184-user-given-type-annotations.html#131136261">(Aug 08 2018 at 22:29)</a>:</h4>
<p>pattern annotations on <code>let</code></p>



<a name="131136265"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2347184-user-given-type-annotations/near/131136265" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://rust-lang.github.io/zulip_archive/stream/122657-t-compiler/wg-nll/topic/.2347184-user-given-type-annotations.html#131136265">(Aug 08 2018 at 22:29)</a>:</h4>
<p>and other annotations</p>



<a name="131136266"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2347184-user-given-type-annotations/near/131136266" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://rust-lang.github.io/zulip_archive/stream/122657-t-compiler/wg-nll/topic/.2347184-user-given-type-annotations.html#131136266">(Aug 08 2018 at 22:29)</a>:</h4>
<p>the latter is what I am focusing on now</p>



<a name="131136267"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2347184-user-given-type-annotations/near/131136267" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://rust-lang.github.io/zulip_archive/stream/122657-t-compiler/wg-nll/topic/.2347184-user-given-type-annotations.html#131136267">(Aug 08 2018 at 22:29)</a>:</h4>
<p>I don't think those two cases will be <em>particularly</em> unified though</p>



<a name="131138417"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2347184-user-given-type-annotations/near/131138417" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://rust-lang.github.io/zulip_archive/stream/122657-t-compiler/wg-nll/topic/.2347184-user-given-type-annotations.html#131138417">(Aug 08 2018 at 23:22)</a>:</h4>
<p>actually... I maybe take that back a bit. We may be able to re-use the <code>UserAssertTy</code> MIR statements</p>



<a name="131181872"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2347184-user-given-type-annotations/near/131181872" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://rust-lang.github.io/zulip_archive/stream/122657-t-compiler/wg-nll/topic/.2347184-user-given-type-annotations.html#131181872">(Aug 09 2018 at 16:05)</a>:</h4>
<p>opened PR <a href="https://github.com/rust-lang/rust/pull/53225" target="_blank" title="https://github.com/rust-lang/rust/pull/53225">https://github.com/rust-lang/rust/pull/53225</a> — not a complete fix yet but covers a lot of the cases</p>



<a name="133154705"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2347184-user-given-type-annotations/near/133154705" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://rust-lang.github.io/zulip_archive/stream/122657-t-compiler/wg-nll/topic/.2347184-user-given-type-annotations.html#133154705">(Aug 31 2018 at 23:33)</a>:</h4>
<p>this test passes now:</p>
<div class="codehilite"><pre><span></span><span class="cp">#![feature(nll)]</span><span class="w"></span>

<span class="k">fn</span> <span class="nf">main</span><span class="p">()</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="n">_</span>: <span class="nb">Vec</span><span class="o">&lt;&amp;</span><span class="nb">&#39;static</span><span class="w"> </span><span class="nb">String</span><span class="o">&gt;</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">vec</span><span class="o">!</span><span class="p">[</span><span class="o">&amp;</span><span class="nb">String</span>::<span class="n">new</span><span class="p">()];</span><span class="w"></span>
<span class="w">    </span><span class="c1">//~^ ERROR borrowed value does not live long enough [E0597]</span>

<span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="p">(</span><span class="n">_</span><span class="p">,</span><span class="w"> </span><span class="n">a</span><span class="p">)</span>: <span class="p">(</span><span class="nb">Vec</span><span class="o">&lt;&amp;</span><span class="nb">&#39;static</span><span class="w"> </span><span class="nb">String</span><span class="o">&gt;</span><span class="p">,</span><span class="w"> </span><span class="n">_</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="n">vec</span><span class="o">!</span><span class="p">[</span><span class="o">&amp;</span><span class="nb">String</span>::<span class="n">new</span><span class="p">()],</span><span class="w"> </span><span class="mi">44</span><span class="p">);</span><span class="w"></span>
<span class="w">    </span><span class="c1">//~^ ERROR borrowed value does not live long enough [E0597]</span>

<span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="p">(</span><span class="n">_a</span><span class="p">,</span><span class="w"> </span><span class="n">b</span><span class="p">)</span>: <span class="p">(</span><span class="nb">Vec</span><span class="o">&lt;&amp;</span><span class="nb">&#39;static</span><span class="w"> </span><span class="nb">String</span><span class="o">&gt;</span><span class="p">,</span><span class="w"> </span><span class="n">_</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="n">vec</span><span class="o">!</span><span class="p">[</span><span class="o">&amp;</span><span class="nb">String</span>::<span class="n">new</span><span class="p">()],</span><span class="w"> </span><span class="mi">44</span><span class="p">);</span><span class="w"></span>
<span class="w">    </span><span class="c1">//~^ ERROR borrowed value does not live long enough [E0597]</span>
<span class="p">}</span><span class="w"></span>
</pre></div>



<a name="133154707"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2347184-user-given-type-annotations/near/133154707" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://rust-lang.github.io/zulip_archive/stream/122657-t-compiler/wg-nll/topic/.2347184-user-given-type-annotations.html#133154707">(Aug 31 2018 at 23:33)</a>:</h4>
<p>(on my branch)</p>



<a name="133532024"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2347184-user-given-type-annotations/near/133532024" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://rust-lang.github.io/zulip_archive/stream/122657-t-compiler/wg-nll/topic/.2347184-user-given-type-annotations.html#133532024">(Sep 07 2018 at 19:29)</a>:</h4>
<p><span class="user-mention" data-user-id="116083">@pnkfelix</span> and whomever else: I'd like to have another change to talk over what we want to do here</p>



<a name="133532027"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2347184-user-given-type-annotations/near/133532027" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://rust-lang.github.io/zulip_archive/stream/122657-t-compiler/wg-nll/topic/.2347184-user-given-type-annotations.html#133532027">(Sep 07 2018 at 19:29)</a>:</h4>
<p>the more I think about it, the more unsure I am :)</p>



<a name="133532028"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2347184-user-given-type-annotations/near/133532028" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://rust-lang.github.io/zulip_archive/stream/122657-t-compiler/wg-nll/topic/.2347184-user-given-type-annotations.html#133532028">(Sep 07 2018 at 19:29)</a>:</h4>
<p>maybe Monday?</p>



<a name="133537389"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2347184-user-given-type-annotations/near/133537389" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> pnkfelix <a href="https://rust-lang.github.io/zulip_archive/stream/122657-t-compiler/wg-nll/topic/.2347184-user-given-type-annotations.html#133537389">(Sep 07 2018 at 21:07)</a>:</h4>
<p>Sure Monday is good. I assume you meant to write “another <em>chance</em> ...”</p>



<a name="133539268"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2347184-user-given-type-annotations/near/133539268" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://rust-lang.github.io/zulip_archive/stream/122657-t-compiler/wg-nll/topic/.2347184-user-given-type-annotations.html#133539268">(Sep 07 2018 at 21:48)</a>:</h4>
<p>yes :)</p>



<a name="134191884"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2347184-user-given-type-annotations/near/134191884" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://rust-lang.github.io/zulip_archive/stream/122657-t-compiler/wg-nll/topic/.2347184-user-given-type-annotations.html#134191884">(Sep 18 2018 at 20:44)</a>:</h4>
<p>ok so on the topic of user-given type annotations...</p>
<p>I just wrote up some mentoring instructions for <a href="https://github.com/rust-lang/rust/issues/54331" target="_blank" title="https://github.com/rust-lang/rust/issues/54331">https://github.com/rust-lang/rust/issues/54331</a>, describing how to handle the type ascription case. </p>
<p>I realize now how much stuff has yet to be added to rustc-guide :P</p>



<a name="134191892"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2347184-user-given-type-annotations/near/134191892" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://rust-lang.github.io/zulip_archive/stream/122657-t-compiler/wg-nll/topic/.2347184-user-given-type-annotations.html#134191892">(Sep 18 2018 at 20:44)</a>:</h4>
<p>but <span class="user-mention" data-user-id="116266">@Santiago Pastorino</span> and <span class="user-mention" data-user-id="116108">@Keith Yeung</span> I had tagged both of you as possible folks for this</p>



<a name="134191895"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2347184-user-given-type-annotations/near/134191895" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://rust-lang.github.io/zulip_archive/stream/122657-t-compiler/wg-nll/topic/.2347184-user-given-type-annotations.html#134191895">(Sep 18 2018 at 20:44)</a>:</h4>
<p>there is more than one case</p>



<a name="134191922"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2347184-user-given-type-annotations/near/134191922" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://rust-lang.github.io/zulip_archive/stream/122657-t-compiler/wg-nll/topic/.2347184-user-given-type-annotations.html#134191922">(Sep 18 2018 at 20:45)</a>:</h4>
<p>it will require modifying the main type checker, as well as the "HAIR" and MIR construction...</p>



<a name="134191923"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2347184-user-given-type-annotations/near/134191923" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Keith Yeung <a href="https://rust-lang.github.io/zulip_archive/stream/122657-t-compiler/wg-nll/topic/.2347184-user-given-type-annotations.html#134191923">(Sep 18 2018 at 20:45)</a>:</h4>
<p>does HIR/AST get lowered to HAIR first, before finally being lowered to MIR?</p>



<a name="134191924"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2347184-user-given-type-annotations/near/134191924" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://rust-lang.github.io/zulip_archive/stream/122657-t-compiler/wg-nll/topic/.2347184-user-given-type-annotations.html#134191924">(Sep 18 2018 at 20:45)</a>:</h4>
<p>oh, dang it</p>



<a name="134191928"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2347184-user-given-type-annotations/near/134191928" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://rust-lang.github.io/zulip_archive/stream/122657-t-compiler/wg-nll/topic/.2347184-user-given-type-annotations.html#134191928">(Sep 18 2018 at 20:45)</a>:</h4>
<p>yes, it does</p>



<a name="134191929"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2347184-user-given-type-annotations/near/134191929" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://rust-lang.github.io/zulip_archive/stream/122657-t-compiler/wg-nll/topic/.2347184-user-given-type-annotations.html#134191929">(Sep 18 2018 at 20:45)</a>:</h4>
<p>just realized that I sort of left out a step</p>



<a name="134191936"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2347184-user-given-type-annotations/near/134191936" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://rust-lang.github.io/zulip_archive/stream/122657-t-compiler/wg-nll/topic/.2347184-user-given-type-annotations.html#134191936">(Sep 18 2018 at 20:45)</a>:</h4>
<p>which is that we have to figure out how this will be reflected in MIR, and that is .. hmm. Potentially mildly tricky?</p>



<a name="134191940"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2347184-user-given-type-annotations/near/134191940" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://rust-lang.github.io/zulip_archive/stream/122657-t-compiler/wg-nll/topic/.2347184-user-given-type-annotations.html#134191940">(Sep 18 2018 at 20:45)</a>:</h4>
<p>nah it's .. probably ok</p>



<a name="134191988"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2347184-user-given-type-annotations/near/134191988" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://rust-lang.github.io/zulip_archive/stream/122657-t-compiler/wg-nll/topic/.2347184-user-given-type-annotations.html#134191988">(Sep 18 2018 at 20:46)</a>:</h4>
<p>well, we may have to make a new temporary or something, so that we can assert its type in MIR land</p>



<a name="134191993"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2347184-user-given-type-annotations/near/134191993" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://rust-lang.github.io/zulip_archive/stream/122657-t-compiler/wg-nll/topic/.2347184-user-given-type-annotations.html#134191993">(Sep 18 2018 at 20:46)</a>:</h4>
<p>anyway the first few steps dont' require that</p>



<a name="134192444"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2347184-user-given-type-annotations/near/134192444" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://rust-lang.github.io/zulip_archive/stream/122657-t-compiler/wg-nll/topic/.2347184-user-given-type-annotations.html#134192444">(Sep 18 2018 at 20:53)</a>:</h4>
<blockquote>
<p>but <span class="user-mention" data-user-id="116266">@Santiago Pastorino</span> and <span class="user-mention" data-user-id="116108">@Keith Yeung</span> I had tagged both of you as possible folks for this</p>
</blockquote>
<p>I can take this</p>



<a name="134192504"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2347184-user-given-type-annotations/near/134192504" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://rust-lang.github.io/zulip_archive/stream/122657-t-compiler/wg-nll/topic/.2347184-user-given-type-annotations.html#134192504">(Sep 18 2018 at 20:54)</a>:</h4>
<p>I mean, unless <span class="user-mention" data-user-id="116108">@Keith Yeung</span> really want to do it :)</p>



<a name="134192617"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2347184-user-given-type-annotations/near/134192617" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Keith Yeung <a href="https://rust-lang.github.io/zulip_archive/stream/122657-t-compiler/wg-nll/topic/.2347184-user-given-type-annotations.html#134192617">(Sep 18 2018 at 20:56)</a>:</h4>
<p>i haven't really looked into it yet</p>



<a name="134192662"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2347184-user-given-type-annotations/near/134192662" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://rust-lang.github.io/zulip_archive/stream/122657-t-compiler/wg-nll/topic/.2347184-user-given-type-annotations.html#134192662">(Sep 18 2018 at 20:57)</a>:</h4>
<p>there are other parts too</p>



<a name="134192667"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2347184-user-given-type-annotations/near/134192667" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://rust-lang.github.io/zulip_archive/stream/122657-t-compiler/wg-nll/topic/.2347184-user-given-type-annotations.html#134192667">(Sep 18 2018 at 20:57)</a>:</h4>
<p>but I won't be able to write those up yet...</p>



<a name="134192682"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2347184-user-given-type-annotations/near/134192682" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://rust-lang.github.io/zulip_archive/stream/122657-t-compiler/wg-nll/topic/.2347184-user-given-type-annotations.html#134192682">(Sep 18 2018 at 20:57)</a>:</h4>
<p>I am thinking mostly of <a href="https://github.com/rust-lang/rust/issues/47184#issuecomment-420041056" target="_blank" title="https://github.com/rust-lang/rust/issues/47184#issuecomment-420041056">what I described here</a></p>



<a name="134192688"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2347184-user-given-type-annotations/near/134192688" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://rust-lang.github.io/zulip_archive/stream/122657-t-compiler/wg-nll/topic/.2347184-user-given-type-annotations.html#134192688">(Sep 18 2018 at 20:57)</a>:</h4>
<p>which may be enough to go on, but maybe not</p>



<a name="134192695"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2347184-user-given-type-annotations/near/134192695" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://rust-lang.github.io/zulip_archive/stream/122657-t-compiler/wg-nll/topic/.2347184-user-given-type-annotations.html#134192695">(Sep 18 2018 at 20:58)</a>:</h4>
<blockquote>
<p>i haven't really looked into it yet</p>
</blockquote>
<p>me neither but I have no tasks so, I guess when I start taking a look at it I just start tackling it :P</p>



<a name="134192916"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2347184-user-given-type-annotations/near/134192916" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://rust-lang.github.io/zulip_archive/stream/122657-t-compiler/wg-nll/topic/.2347184-user-given-type-annotations.html#134192916">(Sep 18 2018 at 21:01)</a>:</h4>
<blockquote>
<p>there are other parts too</p>
</blockquote>
<p><span class="emoji emoji-1f44d" title="+1">:+1:</span>, I'm fine to do whatever is needed :)</p>



<a name="134193539"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2347184-user-given-type-annotations/near/134193539" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Keith Yeung <a href="https://rust-lang.github.io/zulip_archive/stream/122657-t-compiler/wg-nll/topic/.2347184-user-given-type-annotations.html#134193539">(Sep 18 2018 at 21:11)</a>:</h4>
<p>i think i have an idea of what we wanna do for this issue right now</p>



<a name="134193695"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2347184-user-given-type-annotations/near/134193695" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Keith Yeung <a href="https://rust-lang.github.io/zulip_archive/stream/122657-t-compiler/wg-nll/topic/.2347184-user-given-type-annotations.html#134193695">(Sep 18 2018 at 21:14)</a>:</h4>
<p>we have indeed missed a step</p>



<a name="134193718"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2347184-user-given-type-annotations/near/134193718" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Keith Yeung <a href="https://rust-lang.github.io/zulip_archive/stream/122657-t-compiler/wg-nll/topic/.2347184-user-given-type-annotations.html#134193718">(Sep 18 2018 at 21:14)</a>:</h4>
<p>HAIR to MIR lowering</p>



<a name="134193844"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2347184-user-given-type-annotations/near/134193844" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://rust-lang.github.io/zulip_archive/stream/122657-t-compiler/wg-nll/topic/.2347184-user-given-type-annotations.html#134193844">(Sep 18 2018 at 21:16)</a>:</h4>
<p>Yeah so the challenge here is that</p>



<a name="134193961"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2347184-user-given-type-annotations/near/134193961" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Keith Yeung <a href="https://rust-lang.github.io/zulip_archive/stream/122657-t-compiler/wg-nll/topic/.2347184-user-given-type-annotations.html#134193961">(Sep 18 2018 at 21:17)</a>:</h4>
<p>but i think it's a matter of creating a new Rvalue variant?</p>



<a name="134194004"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2347184-user-given-type-annotations/near/134194004" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Keith Yeung <a href="https://rust-lang.github.io/zulip_archive/stream/122657-t-compiler/wg-nll/topic/.2347184-user-given-type-annotations.html#134194004">(Sep 18 2018 at 21:18)</a>:</h4>
<p>or perhaps that is the challenge</p>



<a name="134194011"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2347184-user-given-type-annotations/near/134194011" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Keith Yeung <a href="https://rust-lang.github.io/zulip_archive/stream/122657-t-compiler/wg-nll/topic/.2347184-user-given-type-annotations.html#134194011">(Sep 18 2018 at 21:18)</a>:</h4>
<p>figuring out exactly what kind of node we wanna generate</p>



<a name="134194031"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2347184-user-given-type-annotations/near/134194031" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Keith Yeung <a href="https://rust-lang.github.io/zulip_archive/stream/122657-t-compiler/wg-nll/topic/.2347184-user-given-type-annotations.html#134194031">(Sep 18 2018 at 21:18)</a>:</h4>
<p>or really, what kind of statement</p>



<a name="134194046"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2347184-user-given-type-annotations/near/134194046" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://rust-lang.github.io/zulip_archive/stream/122657-t-compiler/wg-nll/topic/.2347184-user-given-type-annotations.html#134194046">(Sep 18 2018 at 21:18)</a>:</h4>
<p>there is presently a <code>AscribeUserType</code> statement</p>



<a name="134194047"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2347184-user-given-type-annotations/near/134194047" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://rust-lang.github.io/zulip_archive/stream/122657-t-compiler/wg-nll/topic/.2347184-user-given-type-annotations.html#134194047">(Sep 18 2018 at 21:18)</a>:</h4>
<p><a href="https://doc.rust-lang.org/nightly/nightly-rustc/rustc/mir/enum.StatementKind.html#variant.AscribeUserType" target="_blank" title="https://doc.rust-lang.org/nightly/nightly-rustc/rustc/mir/enum.StatementKind.html#variant.AscribeUserType">https://doc.rust-lang.org/nightly/nightly-rustc/rustc/mir/enum.StatementKind.html#variant.AscribeUserType</a></p>



<a name="134194060"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2347184-user-given-type-annotations/near/134194060" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://rust-lang.github.io/zulip_archive/stream/122657-t-compiler/wg-nll/topic/.2347184-user-given-type-annotations.html#134194060">(Sep 18 2018 at 21:19)</a>:</h4>
<p>so we basically want to lower to that</p>



<a name="134194222"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2347184-user-given-type-annotations/near/134194222" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Keith Yeung <a href="https://rust-lang.github.io/zulip_archive/stream/122657-t-compiler/wg-nll/topic/.2347184-user-given-type-annotations.html#134194222">(Sep 18 2018 at 21:19)</a>:</h4>
<p>ah, i see it</p>



<a name="134194339"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2347184-user-given-type-annotations/near/134194339" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://rust-lang.github.io/zulip_archive/stream/122657-t-compiler/wg-nll/topic/.2347184-user-given-type-annotations.html#134194339">(Sep 18 2018 at 21:20)</a>:</h4>
<p>actually, I think I take back what I said about <code>Adt</code></p>



<a name="134194347"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2347184-user-given-type-annotations/near/134194347" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://rust-lang.github.io/zulip_archive/stream/122657-t-compiler/wg-nll/topic/.2347184-user-given-type-annotations.html#134194347">(Sep 18 2018 at 21:20)</a>:</h4>
<p>well, I don't know</p>



<a name="134194390"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2347184-user-given-type-annotations/near/134194390" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://rust-lang.github.io/zulip_archive/stream/122657-t-compiler/wg-nll/topic/.2347184-user-given-type-annotations.html#134194390">(Sep 18 2018 at 21:21)</a>:</h4>
<p>yeah, I think we could refactor that, I stand by what I wrote ;)</p>



<a name="134194394"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2347184-user-given-type-annotations/near/134194394" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://rust-lang.github.io/zulip_archive/stream/122657-t-compiler/wg-nll/topic/.2347184-user-given-type-annotations.html#134194394">(Sep 18 2018 at 21:21)</a>:</h4>
<p>but first things first</p>



<a name="134194499"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2347184-user-given-type-annotations/near/134194499" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Keith Yeung <a href="https://rust-lang.github.io/zulip_archive/stream/122657-t-compiler/wg-nll/topic/.2347184-user-given-type-annotations.html#134194499">(Sep 18 2018 at 21:23)</a>:</h4>
<p><span class="user-mention" data-user-id="116266">@Santiago Pastorino</span> sorry, it looks like i got myself too invested in this right now :D mind if i tackle this instead?</p>



<a name="134194621"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2347184-user-given-type-annotations/near/134194621" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://rust-lang.github.io/zulip_archive/stream/122657-t-compiler/wg-nll/topic/.2347184-user-given-type-annotations.html#134194621">(Sep 18 2018 at 21:25)</a>:</h4>
<p>heh :) I'll put <span class="user-mention" data-user-id="116266">@Santiago Pastorino</span> to work somehow</p>



<a name="134195145"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2347184-user-given-type-annotations/near/134195145" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://rust-lang.github.io/zulip_archive/stream/122657-t-compiler/wg-nll/topic/.2347184-user-given-type-annotations.html#134195145">(Sep 18 2018 at 21:33)</a>:</h4>
<p><span class="emoji emoji-1f44d" title="+1">:+1:</span></p>



<a name="134199655"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2347184-user-given-type-annotations/near/134199655" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Keith Yeung <a href="https://rust-lang.github.io/zulip_archive/stream/122657-t-compiler/wg-nll/topic/.2347184-user-given-type-annotations.html#134199655">(Sep 18 2018 at 23:13)</a>:</h4>
<p>hmm... so i'm not sure what happens when we lower the HAIR expression to MIR</p>



<a name="134199660"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2347184-user-given-type-annotations/near/134199660" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Keith Yeung <a href="https://rust-lang.github.io/zulip_archive/stream/122657-t-compiler/wg-nll/topic/.2347184-user-given-type-annotations.html#134199660">(Sep 18 2018 at 23:13)</a>:</h4>
<p>there are a couple of places that require changing</p>



<a name="134199713"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2347184-user-given-type-annotations/near/134199713" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Keith Yeung <a href="https://rust-lang.github.io/zulip_archive/stream/122657-t-compiler/wg-nll/topic/.2347184-user-given-type-annotations.html#134199713">(Sep 18 2018 at 23:14)</a>:</h4>
<p><code>as_place.rs</code>, <code>as_rvalue.rs</code>, <code>category.rs</code> and <code>into.rs</code></p>



<a name="134199906"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2347184-user-given-type-annotations/near/134199906" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Keith Yeung <a href="https://rust-lang.github.io/zulip_archive/stream/122657-t-compiler/wg-nll/topic/.2347184-user-given-type-annotations.html#134199906">(Sep 18 2018 at 23:19)</a>:</h4>
<p><code>category.rs</code> should be easy -- we just return None, since it doesn't match any of the category listed</p>



<a name="134201101"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2347184-user-given-type-annotations/near/134201101" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Keith Yeung <a href="https://rust-lang.github.io/zulip_archive/stream/122657-t-compiler/wg-nll/topic/.2347184-user-given-type-annotations.html#134201101">(Sep 18 2018 at 23:49)</a>:</h4>
<p><span class="user-mention" data-user-id="116009">@nikomatsakis</span> woah ok, now i'm feeling the trouble when attempting to lower it to MIR</p>



<a name="134201152"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2347184-user-given-type-annotations/near/134201152" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Keith Yeung <a href="https://rust-lang.github.io/zulip_archive/stream/122657-t-compiler/wg-nll/topic/.2347184-user-given-type-annotations.html#134201152">(Sep 18 2018 at 23:50)</a>:</h4>
<p><code>AscribeUserType</code> requires an expression as one of its fields</p>



<a name="134201155"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2347184-user-given-type-annotations/near/134201155" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Keith Yeung <a href="https://rust-lang.github.io/zulip_archive/stream/122657-t-compiler/wg-nll/topic/.2347184-user-given-type-annotations.html#134201155">(Sep 18 2018 at 23:50)</a>:</h4>
<p>and in the <code>ExprType</code> variant you proposed, it doesn't contain any information about the expression that the ascription is applied to</p>



<a name="134201162"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2347184-user-given-type-annotations/near/134201162" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Keith Yeung <a href="https://rust-lang.github.io/zulip_archive/stream/122657-t-compiler/wg-nll/topic/.2347184-user-given-type-annotations.html#134201162">(Sep 18 2018 at 23:50)</a>:</h4>
<p>perhaps we need to extend it to contain that</p>



<a name="134201300"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2347184-user-given-type-annotations/near/134201300" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Keith Yeung <a href="https://rust-lang.github.io/zulip_archive/stream/122657-t-compiler/wg-nll/topic/.2347184-user-given-type-annotations.html#134201300">(Sep 18 2018 at 23:55)</a>:</h4>
<p>... in which case, we really need to rename <code>ExprType</code> to maybe <code>TypeAscription</code></p>



<a name="134201648"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2347184-user-given-type-annotations/near/134201648" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Keith Yeung <a href="https://rust-lang.github.io/zulip_archive/stream/122657-t-compiler/wg-nll/topic/.2347184-user-given-type-annotations.html#134201648">(Sep 19 2018 at 00:04)</a>:</h4>
<p>darn it, i mispoke</p>



<a name="134201653"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2347184-user-given-type-annotations/near/134201653" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Keith Yeung <a href="https://rust-lang.github.io/zulip_archive/stream/122657-t-compiler/wg-nll/topic/.2347184-user-given-type-annotations.html#134201653">(Sep 19 2018 at 00:04)</a>:</h4>
<p><code>AscribeUserType</code> requires a <code>Place</code></p>



<a name="134203734"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2347184-user-given-type-annotations/near/134203734" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Keith Yeung <a href="https://rust-lang.github.io/zulip_archive/stream/122657-t-compiler/wg-nll/topic/.2347184-user-given-type-annotations.html#134203734">(Sep 19 2018 at 01:04)</a>:</h4>
<p>ok, so here's what i'm thinking:</p>



<a name="134203806"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2347184-user-given-type-annotations/near/134203806" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Keith Yeung <a href="https://rust-lang.github.io/zulip_archive/stream/122657-t-compiler/wg-nll/topic/.2347184-user-given-type-annotations.html#134203806">(Sep 19 2018 at 01:06)</a>:</h4>
<p>if i'm not mistaken, the only use of the <code>Place</code> field in <code>AscribeUserType</code> is to get the type of the <code>Place</code> <a href="https://github.com/rust-lang/rust/blob/79fcc58b24d85743d025fd880fca55748662ed3e/src/librustc_mir/borrow_check/nll/type_check/mod.rs#L984" target="_blank" title="https://github.com/rust-lang/rust/blob/79fcc58b24d85743d025fd880fca55748662ed3e/src/librustc_mir/borrow_check/nll/type_check/mod.rs#L984">here</a></p>



<a name="134203955"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2347184-user-given-type-annotations/near/134203955" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Keith Yeung <a href="https://rust-lang.github.io/zulip_archive/stream/122657-t-compiler/wg-nll/topic/.2347184-user-given-type-annotations.html#134203955">(Sep 19 2018 at 01:10)</a>:</h4>
<p>given that, i wonder if we can just thread through a <code>Ty</code> instead of a <code>Place</code>, in which case this would help us in lowering the type ascriptions, since we can provide the <code>Ty</code> of the ascribed expression</p>



<a name="134257386"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2347184-user-given-type-annotations/near/134257386" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://rust-lang.github.io/zulip_archive/stream/122657-t-compiler/wg-nll/topic/.2347184-user-given-type-annotations.html#134257386">(Sep 19 2018 at 17:47)</a>:</h4>
<p><span class="user-mention" data-user-id="116108">@Keith Yeung</span> so the HAIR node has to wrap an expression</p>



<a name="134257415"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2347184-user-given-type-annotations/near/134257415" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://rust-lang.github.io/zulip_archive/stream/122657-t-compiler/wg-nll/topic/.2347184-user-given-type-annotations.html#134257415">(Sep 19 2018 at 17:47)</a>:</h4>
<p>and if/when it is lowered to a MIR operand,  it has to store the result of evaluating that expression into a temporary, assert the type on that temporary, and then return that temporary as a MIR operand</p>



<a name="134257464"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2347184-user-given-type-annotations/near/134257464" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://rust-lang.github.io/zulip_archive/stream/122657-t-compiler/wg-nll/topic/.2347184-user-given-type-annotations.html#134257464">(Sep 19 2018 at 17:48)</a>:</h4>
<p>(if it is lowered to a place, it can do something mildly different)</p>



<a name="134257471"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2347184-user-given-type-annotations/near/134257471" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://rust-lang.github.io/zulip_archive/stream/122657-t-compiler/wg-nll/topic/.2347184-user-given-type-annotations.html#134257471">(Sep 19 2018 at 17:48)</a>:</h4>
<p>I can probably find an example of another HAIR form that works similarly</p>



<a name="134293163"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2347184-user-given-type-annotations/near/134293163" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Keith Yeung <a href="https://rust-lang.github.io/zulip_archive/stream/122657-t-compiler/wg-nll/topic/.2347184-user-given-type-annotations.html#134293163">(Sep 20 2018 at 07:55)</a>:</h4>
<p>huh, that poses some trouble, in particular the way we attempt to <a href="https://github.com/rust-lang/rust/blob/79fcc58b24d85743d025fd880fca55748662ed3e/src/librustc_mir/build/expr/category.rs#L14-L27" target="_blank" title="https://github.com/rust-lang/rust/blob/79fcc58b24d85743d025fd880fca55748662ed3e/src/librustc_mir/build/expr/category.rs#L14-L27">categorize the expression</a> during MIR construction</p>



<a name="134293247"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2347184-user-given-type-annotations/near/134293247" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Keith Yeung <a href="https://rust-lang.github.io/zulip_archive/stream/122657-t-compiler/wg-nll/topic/.2347184-user-given-type-annotations.html#134293247">(Sep 20 2018 at 07:57)</a>:</h4>
<p>it is most likely better to be categorized as an <code>Rvalue</code> that can be generated by <code>Into</code></p>



<a name="134293266"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2347184-user-given-type-annotations/near/134293266" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Keith Yeung <a href="https://rust-lang.github.io/zulip_archive/stream/122657-t-compiler/wg-nll/topic/.2347184-user-given-type-annotations.html#134293266">(Sep 20 2018 at 07:57)</a>:</h4>
<p>but the fact that types can also be ascribed on places is a little problematic</p>



<a name="134309449"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2347184-user-given-type-annotations/near/134309449" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://rust-lang.github.io/zulip_archive/stream/122657-t-compiler/wg-nll/topic/.2347184-user-given-type-annotations.html#134309449">(Sep 20 2018 at 13:31)</a>:</h4>
<p><span class="user-mention" data-user-id="116108">@Keith Yeung</span> I think there are other "dual mode" expressions</p>



<a name="134309465"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2347184-user-given-type-annotations/near/134309465" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://rust-lang.github.io/zulip_archive/stream/122657-t-compiler/wg-nll/topic/.2347184-user-given-type-annotations.html#134309465">(Sep 20 2018 at 13:31)</a>:</h4>
<p>hmm</p>



<a name="134309468"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2347184-user-given-type-annotations/near/134309468" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://rust-lang.github.io/zulip_archive/stream/122657-t-compiler/wg-nll/topic/.2347184-user-given-type-annotations.html#134309468">(Sep 20 2018 at 13:31)</a>:</h4>
<p>it seems like we don't</p>



<a name="134309489"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2347184-user-given-type-annotations/near/134309489" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://rust-lang.github.io/zulip_archive/stream/122657-t-compiler/wg-nll/topic/.2347184-user-given-type-annotations.html#134309489">(Sep 20 2018 at 13:32)</a>:</h4>
<p>well, we can make multiple expressions then</p>



<a name="134309535"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2347184-user-given-type-annotations/near/134309535" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://rust-lang.github.io/zulip_archive/stream/122657-t-compiler/wg-nll/topic/.2347184-user-given-type-annotations.html#134309535">(Sep 20 2018 at 13:32)</a>:</h4>
<p>since we do categorize <code>a.b.c: Foo</code> as a "place expression" in the HIR</p>



<a name="134309537"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2347184-user-given-type-annotations/near/134309537" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://rust-lang.github.io/zulip_archive/stream/122657-t-compiler/wg-nll/topic/.2347184-user-given-type-annotations.html#134309537">(Sep 20 2018 at 13:32)</a>:</h4>
<p>and it's kind of important to preserve that</p>



<a name="134309554"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2347184-user-given-type-annotations/near/134309554" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://rust-lang.github.io/zulip_archive/stream/122657-t-compiler/wg-nll/topic/.2347184-user-given-type-annotations.html#134309554">(Sep 20 2018 at 13:33)</a>:</h4>
<p>(That said, I think there is no fundamental reason we <em>can't</em> have the HAIR expression play two roles — but it might be simpler not to.)</p>



<a name="134309774"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2347184-user-given-type-annotations/near/134309774" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Keith Yeung <a href="https://rust-lang.github.io/zulip_archive/stream/122657-t-compiler/wg-nll/topic/.2347184-user-given-type-annotations.html#134309774">(Sep 20 2018 at 13:37)</a>:</h4>
<p>I was thinking that you could do an analysis of what role the expression plays before you categorize it</p>



<a name="134309833"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2347184-user-given-type-annotations/near/134309833" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Keith Yeung <a href="https://rust-lang.github.io/zulip_archive/stream/122657-t-compiler/wg-nll/topic/.2347184-user-given-type-annotations.html#134309833">(Sep 20 2018 at 13:38)</a>:</h4>
<p>There might be a function somewhere where you can input an expression, and it tells you whether it is acting as a place or an rvalue</p>



<a name="134310360"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2347184-user-given-type-annotations/near/134310360" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://rust-lang.github.io/zulip_archive/stream/122657-t-compiler/wg-nll/topic/.2347184-user-given-type-annotations.html#134310360">(Sep 20 2018 at 13:48)</a>:</h4>
<p>there are such functions</p>



<a name="134310364"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2347184-user-given-type-annotations/near/134310364" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://rust-lang.github.io/zulip_archive/stream/122657-t-compiler/wg-nll/topic/.2347184-user-given-type-annotations.html#134310364">(Sep 20 2018 at 13:48)</a>:</h4>
<p>when you say "expression" I don't quite know which stage of the IR you are referring to</p>



<a name="134310376"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2347184-user-given-type-annotations/near/134310376" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://rust-lang.github.io/zulip_archive/stream/122657-t-compiler/wg-nll/topic/.2347184-user-given-type-annotations.html#134310376">(Sep 20 2018 at 13:48)</a>:</h4>
<p>e.g., for HAIR, there is <a href="https://github.com/rust-lang/rust/blob/79fcc58b24d85743d025fd880fca55748662ed3e/src/librustc_mir/build/expr/category.rs#L41-L44" target="_blank" title="https://github.com/rust-lang/rust/blob/79fcc58b24d85743d025fd880fca55748662ed3e/src/librustc_mir/build/expr/category.rs#L41-L44"><code>Category::of</code></a></p>



<a name="134310398"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2347184-user-given-type-annotations/near/134310398" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://rust-lang.github.io/zulip_archive/stream/122657-t-compiler/wg-nll/topic/.2347184-user-given-type-annotations.html#134310398">(Sep 20 2018 at 13:49)</a>:</h4>
<p>during typeck, we have <a href="https://doc.rust-lang.org/nightly/nightly-rustc/rustc_typeck/check/struct.FnCtxt.html#method.is_place_expr" target="_blank" title="https://doc.rust-lang.org/nightly/nightly-rustc/rustc_typeck/check/struct.FnCtxt.html#method.is_place_expr"><code>is_place_expr</code></a> that operates on the HIR</p>



<a name="134310414"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2347184-user-given-type-annotations/near/134310414" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://rust-lang.github.io/zulip_archive/stream/122657-t-compiler/wg-nll/topic/.2347184-user-given-type-annotations.html#134310414">(Sep 20 2018 at 13:49)</a>:</h4>
<p>but there is no reason for that to be defined on the <code>FnCtxt</code> in particular, it could be moved very easily</p>



<a name="134310478"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2347184-user-given-type-annotations/near/134310478" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://rust-lang.github.io/zulip_archive/stream/122657-t-compiler/wg-nll/topic/.2347184-user-given-type-annotations.html#134310478">(Sep 20 2018 at 13:50)</a>:</h4>
<p>crucially, though, you can see that <code>a.b.c: Foo</code> is <a href="https://github.com/rust-lang/rust/blob/79fcc58b24d85743d025fd880fca55748662ed3e/src/librustc_typeck/check/mod.rs#L2459-L2461" target="_blank" title="https://github.com/rust-lang/rust/blob/79fcc58b24d85743d025fd880fca55748662ed3e/src/librustc_typeck/check/mod.rs#L2459-L2461">categorized as a place-expr here</a></p>



<a name="134310490"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2347184-user-given-type-annotations/near/134310490" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://rust-lang.github.io/zulip_archive/stream/122657-t-compiler/wg-nll/topic/.2347184-user-given-type-annotations.html#134310490">(Sep 20 2018 at 13:50)</a>:</h4>
<p>so I think what we would want to do is — when lowering <code>HIR::ExprKind::Type</code> to HAIR — check if it is a place-expression (using that fn, lifted out from typeck)</p>



<a name="134310504"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2347184-user-given-type-annotations/near/134310504" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://rust-lang.github.io/zulip_archive/stream/122657-t-compiler/wg-nll/topic/.2347184-user-given-type-annotations.html#134310504">(Sep 20 2018 at 13:51)</a>:</h4>
<p>and, if so, create a HAIR expression like <code>TypePlace</code> versus <code>TypeValue</code>, or something like that</p>



<a name="134310518"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2347184-user-given-type-annotations/near/134310518" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://rust-lang.github.io/zulip_archive/stream/122657-t-compiler/wg-nll/topic/.2347184-user-given-type-annotations.html#134310518">(Sep 20 2018 at 13:51)</a>:</h4>
<p>the only difference between the two being that the first one always decorates a "place" expression inside</p>



<a name="134310521"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2347184-user-given-type-annotations/near/134310521" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://rust-lang.github.io/zulip_archive/stream/122657-t-compiler/wg-nll/topic/.2347184-user-given-type-annotations.html#134310521">(Sep 20 2018 at 13:51)</a>:</h4>
<p>so it doesn't need to create a temporary to ascribe the type</p>



<a name="134310525"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2347184-user-given-type-annotations/near/134310525" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://rust-lang.github.io/zulip_archive/stream/122657-t-compiler/wg-nll/topic/.2347184-user-given-type-annotations.html#134310525">(Sep 20 2018 at 13:51)</a>:</h4>
<p>sound reasonable?</p>



<a name="134310529"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2347184-user-given-type-annotations/near/134310529" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://rust-lang.github.io/zulip_archive/stream/122657-t-compiler/wg-nll/topic/.2347184-user-given-type-annotations.html#134310529">(Sep 20 2018 at 13:51)</a>:</h4>
<p>probably we need a better name for those HAIR nodes</p>



<a name="134310531"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2347184-user-given-type-annotations/near/134310531" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://rust-lang.github.io/zulip_archive/stream/122657-t-compiler/wg-nll/topic/.2347184-user-given-type-annotations.html#134310531">(Sep 20 2018 at 13:52)</a>:</h4>
<p>maybe <code>AscribeTypeToPlace</code> or something</p>



<a name="134311654"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2347184-user-given-type-annotations/near/134311654" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Keith Yeung <a href="https://rust-lang.github.io/zulip_archive/stream/122657-t-compiler/wg-nll/topic/.2347184-user-given-type-annotations.html#134311654">(Sep 20 2018 at 14:09)</a>:</h4>
<p>yes, that's exactly the kind of function that i'm thinking of using during MIR lowering, i.e. in the body of <code>Category::of</code></p>



<a name="134311759"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2347184-user-given-type-annotations/near/134311759" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Keith Yeung <a href="https://rust-lang.github.io/zulip_archive/stream/122657-t-compiler/wg-nll/topic/.2347184-user-given-type-annotations.html#134311759">(Sep 20 2018 at 14:11)</a>:</h4>
<p>but i suppose it also makes sense to use it during HAIR lowering</p>



<a name="134311780"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2347184-user-given-type-annotations/near/134311780" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://rust-lang.github.io/zulip_archive/stream/122657-t-compiler/wg-nll/topic/.2347184-user-given-type-annotations.html#134311780">(Sep 20 2018 at 14:11)</a>:</h4>
<blockquote>
<p>yes, that's exactly the kind of function that i'm thinking of using during MIR lowering, i.e. in the body of <code>Category::of</code></p>
</blockquote>
<p>MIR lowering already has this function</p>



<a name="134311786"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2347184-user-given-type-annotations/near/134311786" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://rust-lang.github.io/zulip_archive/stream/122657-t-compiler/wg-nll/topic/.2347184-user-given-type-annotations.html#134311786">(Sep 20 2018 at 14:11)</a>:</h4>
<p>it's called <code>Category::of</code> :P</p>



<a name="134311833"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2347184-user-given-type-annotations/near/134311833" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://rust-lang.github.io/zulip_archive/stream/122657-t-compiler/wg-nll/topic/.2347184-user-given-type-annotations.html#134311833">(Sep 20 2018 at 14:12)</a>:</h4>
<p>the point is, we don't <em>currently</em> at least have any nodes that require this "recursive setup" to figure out the answer</p>



<a name="134311844"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2347184-user-given-type-annotations/near/134311844" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://rust-lang.github.io/zulip_archive/stream/122657-t-compiler/wg-nll/topic/.2347184-user-given-type-annotations.html#134311844">(Sep 20 2018 at 14:12)</a>:</h4>
<p>another option would be to try having <code>Type</code> do that</p>



<a name="134311858"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2347184-user-given-type-annotations/near/134311858" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://rust-lang.github.io/zulip_archive/stream/122657-t-compiler/wg-nll/topic/.2347184-user-given-type-annotations.html#134311858">(Sep 20 2018 at 14:12)</a>:</h4>
<p>that is, to ask the base expression what category <em>it</em> has</p>



<a name="134311866"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2347184-user-given-type-annotations/near/134311866" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Keith Yeung <a href="https://rust-lang.github.io/zulip_archive/stream/122657-t-compiler/wg-nll/topic/.2347184-user-given-type-annotations.html#134311866">(Sep 20 2018 at 14:12)</a>:</h4>
<p>indeed, that i didn't think of</p>



<a name="134311869"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2347184-user-given-type-annotations/near/134311869" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://rust-lang.github.io/zulip_archive/stream/122657-t-compiler/wg-nll/topic/.2347184-user-given-type-annotations.html#134311869">(Sep 20 2018 at 14:12)</a>:</h4>
<p>but I think this may ultimately be a bit more complex</p>



<a name="134311874"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2347184-user-given-type-annotations/near/134311874" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://rust-lang.github.io/zulip_archive/stream/122657-t-compiler/wg-nll/topic/.2347184-user-given-type-annotations.html#134311874">(Sep 20 2018 at 14:12)</a>:</h4>
<p>than figuring it out ahead of time in HAIR time</p>



<a name="134311881"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2347184-user-given-type-annotations/near/134311881" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://rust-lang.github.io/zulip_archive/stream/122657-t-compiler/wg-nll/topic/.2347184-user-given-type-annotations.html#134311881">(Sep 20 2018 at 14:13)</a>:</h4>
<p>and in any case the MIR you want to generate is mildly different</p>



<a name="134311889"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2347184-user-given-type-annotations/near/134311889" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Keith Yeung <a href="https://rust-lang.github.io/zulip_archive/stream/122657-t-compiler/wg-nll/topic/.2347184-user-given-type-annotations.html#134311889">(Sep 20 2018 at 14:13)</a>:</h4>
<p>yeah, it seems like it makes more sense to just create a new HAIR node</p>



<a name="134311900"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2347184-user-given-type-annotations/near/134311900" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://rust-lang.github.io/zulip_archive/stream/122657-t-compiler/wg-nll/topic/.2347184-user-given-type-annotations.html#134311900">(Sep 20 2018 at 14:13)</a>:</h4>
<p>I guess i'm not sure, I'd probably try it the way I described first though</p>



<a name="134336012"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2347184-user-given-type-annotations/near/134336012" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Keith Yeung <a href="https://rust-lang.github.io/zulip_archive/stream/122657-t-compiler/wg-nll/topic/.2347184-user-given-type-annotations.html#134336012">(Sep 20 2018 at 20:47)</a>:</h4>
<p>i have a slight problem -- where should i put <code>is_place_expr</code>?</p>



<a name="134336126"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2347184-user-given-type-annotations/near/134336126" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Keith Yeung <a href="https://rust-lang.github.io/zulip_archive/stream/122657-t-compiler/wg-nll/topic/.2347184-user-given-type-annotations.html#134336126">(Sep 20 2018 at 20:48)</a>:</h4>
<p>i <em>could</em> make it a free-standing function in <code>librustc_typeck/check/mod.rs</code>, but i'm not sure if that's the best place to do so</p>



<a name="134336176"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2347184-user-given-type-annotations/near/134336176" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://rust-lang.github.io/zulip_archive/stream/122657-t-compiler/wg-nll/topic/.2347184-user-given-type-annotations.html#134336176">(Sep 20 2018 at 20:49)</a>:</h4>
<p>it does not appear to use <code>self</code></p>



<a name="134336178"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2347184-user-given-type-annotations/near/134336178" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://rust-lang.github.io/zulip_archive/stream/122657-t-compiler/wg-nll/topic/.2347184-user-given-type-annotations.html#134336178">(Sep 20 2018 at 20:49)</a>:</h4>
<p>I would make it a method of <code>hir::Expr</code></p>



<a name="134336179"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2347184-user-given-type-annotations/near/134336179" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://rust-lang.github.io/zulip_archive/stream/122657-t-compiler/wg-nll/topic/.2347184-user-given-type-annotations.html#134336179">(Sep 20 2018 at 20:49)</a>:</h4>
<p>if at all possible</p>



<a name="134336189"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2347184-user-given-type-annotations/near/134336189" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://rust-lang.github.io/zulip_archive/stream/122657-t-compiler/wg-nll/topic/.2347184-user-given-type-annotations.html#134336189">(Sep 20 2018 at 20:49)</a>:</h4>
<p>and hence put it in <code>src/librustc/hir/mod.rs</code></p>



<a name="134397101"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2347184-user-given-type-annotations/near/134397101" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Keith Yeung <a href="https://rust-lang.github.io/zulip_archive/stream/122657-t-compiler/wg-nll/topic/.2347184-user-given-type-annotations.html#134397101">(Sep 21 2018 at 18:53)</a>:</h4>
<p>status update: i'm onto the final step in actually asserting the ascribed type with the expression's type</p>



<a name="134397498"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2347184-user-given-type-annotations/near/134397498" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://rust-lang.github.io/zulip_archive/stream/122657-t-compiler/wg-nll/topic/.2347184-user-given-type-annotations.html#134397498">(Sep 21 2018 at 19:00)</a>:</h4>
<p><span class="user-mention" data-user-id="116108">@Keith Yeung</span> nice!</p>



<a name="134397568"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2347184-user-given-type-annotations/near/134397568" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Keith Yeung <a href="https://rust-lang.github.io/zulip_archive/stream/122657-t-compiler/wg-nll/topic/.2347184-user-given-type-annotations.html#134397568">(Sep 21 2018 at 19:00)</a>:</h4>
<p>actually, i'm not sure if i even need to do that</p>



<a name="134397604"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2347184-user-given-type-annotations/near/134397604" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Keith Yeung <a href="https://rust-lang.github.io/zulip_archive/stream/122657-t-compiler/wg-nll/topic/.2347184-user-given-type-annotations.html#134397604">(Sep 21 2018 at 19:01)</a>:</h4>
<p>it seems to me that <a href="https://github.com/rust-lang/rust/blob/79fcc58b24d85743d025fd880fca55748662ed3e/src/librustc_mir/borrow_check/nll/type_check/mod.rs#L983-L997" target="_blank" title="https://github.com/rust-lang/rust/blob/79fcc58b24d85743d025fd880fca55748662ed3e/src/librustc_mir/borrow_check/nll/type_check/mod.rs#L983-L997">there's already code to assert the place's type with the ascribed type in MIR borrowck</a></p>



<a name="134397629"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2347184-user-given-type-annotations/near/134397629" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Keith Yeung <a href="https://rust-lang.github.io/zulip_archive/stream/122657-t-compiler/wg-nll/topic/.2347184-user-given-type-annotations.html#134397629">(Sep 21 2018 at 19:01)</a>:</h4>
<p>so... yay?</p>



<a name="134397782"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2347184-user-given-type-annotations/near/134397782" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> pnkfelix <a href="https://rust-lang.github.io/zulip_archive/stream/122657-t-compiler/wg-nll/topic/.2347184-user-given-type-annotations.html#134397782">(Sep 21 2018 at 19:04)</a>:</h4>
<p><span class="user-mention" data-user-id="116108">@Keith Yeung</span>  what did you end up doing about the problem described by <span class="user-mention" data-user-id="116009">@nikomatsakis</span> <a href="https://github.com/rust-lang/rust/issues/47184#issuecomment-420041056" target="_blank" title="https://github.com/rust-lang/rust/issues/47184#issuecomment-420041056">here</a> ?</p>



<a name="134397792"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2347184-user-given-type-annotations/near/134397792" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Keith Yeung <a href="https://rust-lang.github.io/zulip_archive/stream/122657-t-compiler/wg-nll/topic/.2347184-user-given-type-annotations.html#134397792">(Sep 21 2018 at 19:04)</a>:</h4>
<p>oh, i wasn't aware of that</p>



<a name="134397798"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2347184-user-given-type-annotations/near/134397798" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> pnkfelix <a href="https://rust-lang.github.io/zulip_archive/stream/122657-t-compiler/wg-nll/topic/.2347184-user-given-type-annotations.html#134397798">(Sep 21 2018 at 19:05)</a>:</h4>
<p>i.e. I had assumed part of the problem was going to be generalizing the code so that you would assert that a Place matched not merely just a Ty, but rather a series of projections into the Ty</p>



<a name="134397881"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2347184-user-given-type-annotations/near/134397881" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> pnkfelix <a href="https://rust-lang.github.io/zulip_archive/stream/122657-t-compiler/wg-nll/topic/.2347184-user-given-type-annotations.html#134397881">(Sep 21 2018 at 19:06)</a>:</h4>
<p>(the main reason why that idea appeals to me is that I already <em>tried</em> to take the approach of descending the Type structuring eagerly, in order to make it match up with the Places in the pattern structure. But  I couldn't get that to 100% work, while the idea posted there by Niko seems much more plausible...)</p>



<a name="134399121"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2347184-user-given-type-annotations/near/134399121" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://rust-lang.github.io/zulip_archive/stream/122657-t-compiler/wg-nll/topic/.2347184-user-given-type-annotations.html#134399121">(Sep 21 2018 at 19:28)</a>:</h4>
<blockquote>
<p>i.e. I had assumed part of the problem was going to be generalizing the code so that you would assert that a Place matched not merely just a Ty, but rather a series of projections into the Ty</p>
</blockquote>
<p><span class="user-mention" data-user-id="116083">@pnkfelix</span> actually the steps that <span class="user-mention" data-user-id="116108">@Keith Yeung</span> is working on now are orthogonal from that</p>



<a name="134399132"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2347184-user-given-type-annotations/near/134399132" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://rust-lang.github.io/zulip_archive/stream/122657-t-compiler/wg-nll/topic/.2347184-user-given-type-annotations.html#134399132">(Sep 21 2018 at 19:29)</a>:</h4>
<p>that is, they are working on the type ascription and cast expressions</p>



<a name="134399135"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2347184-user-given-type-annotations/near/134399135" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> pnkfelix <a href="https://rust-lang.github.io/zulip_archive/stream/122657-t-compiler/wg-nll/topic/.2347184-user-given-type-annotations.html#134399135">(Sep 21 2018 at 19:29)</a>:</h4>
<p>oh sorry</p>



<a name="134399136"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2347184-user-given-type-annotations/near/134399136" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://rust-lang.github.io/zulip_archive/stream/122657-t-compiler/wg-nll/topic/.2347184-user-given-type-annotations.html#134399136">(Sep 21 2018 at 19:29)</a>:</h4>
<p>but we should probably have somebody on that</p>



<a name="134399139"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2347184-user-given-type-annotations/near/134399139" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://rust-lang.github.io/zulip_archive/stream/122657-t-compiler/wg-nll/topic/.2347184-user-given-type-annotations.html#134399139">(Sep 21 2018 at 19:29)</a>:</h4>
<p>if <span class="user-mention" data-user-id="116108">@Keith Yeung</span> is game, it might make sense for them to continue</p>



<a name="134399141"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2347184-user-given-type-annotations/near/134399141" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://rust-lang.github.io/zulip_archive/stream/122657-t-compiler/wg-nll/topic/.2347184-user-given-type-annotations.html#134399141">(Sep 21 2018 at 19:29)</a>:</h4>
<p>since their head is in the right space</p>



<a name="134399526"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2347184-user-given-type-annotations/near/134399526" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Keith Yeung <a href="https://rust-lang.github.io/zulip_archive/stream/122657-t-compiler/wg-nll/topic/.2347184-user-given-type-annotations.html#134399526">(Sep 21 2018 at 19:36)</a>:</h4>
<p>i need to try and understand what the problem is...</p>



<a name="134399543"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2347184-user-given-type-annotations/near/134399543" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> pnkfelix <a href="https://rust-lang.github.io/zulip_archive/stream/122657-t-compiler/wg-nll/topic/.2347184-user-given-type-annotations.html#134399543">(Sep 21 2018 at 19:37)</a>:</h4>
<p><span class="user-mention" data-user-id="116108">@Keith Yeung</span> niko is right that its an orthogonal thing</p>



<a name="134399548"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2347184-user-given-type-annotations/near/134399548" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> pnkfelix <a href="https://rust-lang.github.io/zulip_archive/stream/122657-t-compiler/wg-nll/topic/.2347184-user-given-type-annotations.html#134399548">(Sep 21 2018 at 19:37)</a>:</h4>
<p><span class="user-mention" data-user-id="116108">@Keith Yeung</span> namely I thought you were working on the part about making bindings like <code>let (a, b): Type;</code> work</p>



<a name="134399556"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2347184-user-given-type-annotations/near/134399556" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Keith Yeung <a href="https://rust-lang.github.io/zulip_archive/stream/122657-t-compiler/wg-nll/topic/.2347184-user-given-type-annotations.html#134399556">(Sep 21 2018 at 19:37)</a>:</h4>
<p>ah</p>



<a name="134399625"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2347184-user-given-type-annotations/near/134399625" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Keith Yeung <a href="https://rust-lang.github.io/zulip_archive/stream/122657-t-compiler/wg-nll/topic/.2347184-user-given-type-annotations.html#134399625">(Sep 21 2018 at 19:38)</a>:</h4>
<p>i guess i'm surprised that <code>relate_type_and_user_type</code> doesn't "propagate downward to more complex type patterns"</p>



<a name="134399664"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2347184-user-given-type-annotations/near/134399664" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Keith Yeung <a href="https://rust-lang.github.io/zulip_archive/stream/122657-t-compiler/wg-nll/topic/.2347184-user-given-type-annotations.html#134399664">(Sep 21 2018 at 19:39)</a>:</h4>
<p>so, say given that we have <code>Foo&lt;'static&gt;</code> as a expression type, i would've expected <code>relate_type_and_user_type</code> to be able to relate that with <code>Foo&lt;'a&gt;</code></p>



<a name="134399706"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2347184-user-given-type-annotations/near/134399706" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Keith Yeung <a href="https://rust-lang.github.io/zulip_archive/stream/122657-t-compiler/wg-nll/topic/.2347184-user-given-type-annotations.html#134399706">(Sep 21 2018 at 19:40)</a>:</h4>
<p>and tell us that there's a type mismatch</p>



<a name="134399892"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2347184-user-given-type-annotations/near/134399892" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> pnkfelix <a href="https://rust-lang.github.io/zulip_archive/stream/122657-t-compiler/wg-nll/topic/.2347184-user-given-type-annotations.html#134399892">(Sep 21 2018 at 19:44)</a>:</h4>
<p>well hold on</p>



<a name="134399905"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2347184-user-given-type-annotations/near/134399905" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> pnkfelix <a href="https://rust-lang.github.io/zulip_archive/stream/122657-t-compiler/wg-nll/topic/.2347184-user-given-type-annotations.html#134399905">(Sep 21 2018 at 19:44)</a>:</h4>
<p>the comment I linked is talking specifically about a <em>pattern</em> where the binding <code>x</code> is, well, "deep"</p>



<a name="134399909"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2347184-user-given-type-annotations/near/134399909" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> pnkfelix <a href="https://rust-lang.github.io/zulip_archive/stream/122657-t-compiler/wg-nll/topic/.2347184-user-given-type-annotations.html#134399909">(Sep 21 2018 at 19:44)</a>:</h4>
<p><code>let &amp;Foo { x }: &amp;Foo&lt;'static&gt; = ...;</code></p>



<a name="134399928"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2347184-user-given-type-annotations/near/134399928" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> pnkfelix <a href="https://rust-lang.github.io/zulip_archive/stream/122657-t-compiler/wg-nll/topic/.2347184-user-given-type-annotations.html#134399928">(Sep 21 2018 at 19:45)</a>:</h4>
<p>and so we end up descending the structure and trying to ascribe a type to <code>x</code> alone</p>



<a name="134399948"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2347184-user-given-type-annotations/near/134399948" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> pnkfelix <a href="https://rust-lang.github.io/zulip_archive/stream/122657-t-compiler/wg-nll/topic/.2347184-user-given-type-annotations.html#134399948">(Sep 21 2018 at 19:45)</a>:</h4>
<p>the problem you are outlining, when you say " say given that we have <code>Foo&lt;'static&gt;</code> as a expression type ..."</p>



<a name="134400032"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2347184-user-given-type-annotations/near/134400032" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> pnkfelix <a href="https://rust-lang.github.io/zulip_archive/stream/122657-t-compiler/wg-nll/topic/.2347184-user-given-type-annotations.html#134400032">(Sep 21 2018 at 19:46)</a>:</h4>
<p>I believe we <em>can</em> accomplish exactly what you describe, via <code>relate_type_and_user_type</code>; you just need to pass in the appropriate <code>ty::Variance</code></p>



<a name="134400051"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2347184-user-given-type-annotations/near/134400051" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> pnkfelix <a href="https://rust-lang.github.io/zulip_archive/stream/122657-t-compiler/wg-nll/topic/.2347184-user-given-type-annotations.html#134400051">(Sep 21 2018 at 19:46)</a>:</h4>
<p>Unless I am just wrong about this?</p>



<a name="134400060"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2347184-user-given-type-annotations/near/134400060" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://rust-lang.github.io/zulip_archive/stream/122657-t-compiler/wg-nll/topic/.2347184-user-given-type-annotations.html#134400060">(Sep 21 2018 at 19:46)</a>:</h4>
<p>you are not wrong :)</p>



<a name="134400081"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2347184-user-given-type-annotations/near/134400081" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://rust-lang.github.io/zulip_archive/stream/122657-t-compiler/wg-nll/topic/.2347184-user-given-type-annotations.html#134400081">(Sep 21 2018 at 19:47)</a>:</h4>
<p>the thing we cannot (yet) do is to extract the implications of that annotation for <code>x</code> (that is, some field of <code>Foo</code>)</p>



<a name="134400159"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2347184-user-given-type-annotations/near/134400159" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> pnkfelix <a href="https://rust-lang.github.io/zulip_archive/stream/122657-t-compiler/wg-nll/topic/.2347184-user-given-type-annotations.html#134400159">(Sep 21 2018 at 19:48)</a>:</h4>
<p>By the way, I <em>would</em> be interested in trying to attack this problem.  But I think <a href="https://github.com/rust-lang/rust/issues/21114" target="_blank" title="https://github.com/rust-lang/rust/issues/21114">#21114</a> is a better item for me to attack, since I think we can get other people to attack the former.</p>



<a name="134400857"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2347184-user-given-type-annotations/near/134400857" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Keith Yeung <a href="https://rust-lang.github.io/zulip_archive/stream/122657-t-compiler/wg-nll/topic/.2347184-user-given-type-annotations.html#134400857">(Sep 21 2018 at 20:00)</a>:</h4>
<p>btw I've got a PR here <a href="https://github.com/rust-lang/rust/pull/54447" target="_blank" title="https://github.com/rust-lang/rust/pull/54447">https://github.com/rust-lang/rust/pull/54447</a></p>



<a name="134400874"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2347184-user-given-type-annotations/near/134400874" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Keith Yeung <a href="https://rust-lang.github.io/zulip_archive/stream/122657-t-compiler/wg-nll/topic/.2347184-user-given-type-annotations.html#134400874">(Sep 21 2018 at 20:00)</a>:</h4>
<p>i might also want to do the refactoring that niko mentioned on the issue</p>



<a name="134400991"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2347184-user-given-type-annotations/near/134400991" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> lqd <a href="https://rust-lang.github.io/zulip_archive/stream/122657-t-compiler/wg-nll/topic/.2347184-user-given-type-annotations.html#134400991">(Sep 21 2018 at 20:02)</a>:</h4>
<p>heads up <code>ui/run-pass/mir/mir_ascription_coercion.rs</code> failed in CI</p>



<a name="134402077"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2347184-user-given-type-annotations/near/134402077" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Keith Yeung <a href="https://rust-lang.github.io/zulip_archive/stream/122657-t-compiler/wg-nll/topic/.2347184-user-given-type-annotations.html#134402077">(Sep 21 2018 at 20:21)</a>:</h4>
<p>yeah, knew something was wrong</p>



<a name="134402102"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2347184-user-given-type-annotations/near/134402102" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Keith Yeung <a href="https://rust-lang.github.io/zulip_archive/stream/122657-t-compiler/wg-nll/topic/.2347184-user-given-type-annotations.html#134402102">(Sep 21 2018 at 20:22)</a>:</h4>
<p>the logic for lowering type ascriptions to MIR is problematic</p>



<a name="134403556"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2347184-user-given-type-annotations/near/134403556" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://rust-lang.github.io/zulip_archive/stream/122657-t-compiler/wg-nll/topic/.2347184-user-given-type-annotations.html#134403556">(Sep 21 2018 at 20:43)</a>:</h4>
<p>left a few comments <span class="user-mention" data-user-id="116108">@Keith Yeung</span></p>



<a name="134407750"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2347184-user-given-type-annotations/near/134407750" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Keith Yeung <a href="https://rust-lang.github.io/zulip_archive/stream/122657-t-compiler/wg-nll/topic/.2347184-user-given-type-annotations.html#134407750">(Sep 21 2018 at 22:00)</a>:</h4>
<p>made changes according to comments</p>



<a name="134468678"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2347184-user-given-type-annotations/near/134468678" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Keith Yeung <a href="https://rust-lang.github.io/zulip_archive/stream/122657-t-compiler/wg-nll/topic/.2347184-user-given-type-annotations.html#134468678">(Sep 23 2018 at 07:11)</a>:</h4>
<p>so my PR is currently failing on a const eval stack overflow, and I'm not exactly sure how to diagnose this</p>



<a name="134535078"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2347184-user-given-type-annotations/near/134535078" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://rust-lang.github.io/zulip_archive/stream/122657-t-compiler/wg-nll/topic/.2347184-user-given-type-annotations.html#134535078">(Sep 24 2018 at 15:55)</a>:</h4>
<p>I'll take a look</p>



<a name="134557445"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2347184-user-given-type-annotations/near/134557445" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://rust-lang.github.io/zulip_archive/stream/122657-t-compiler/wg-nll/topic/.2347184-user-given-type-annotations.html#134557445">(Sep 24 2018 at 21:20)</a>:</h4>
<p>(doing a local build now)</p>



<a name="134557932"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2347184-user-given-type-annotations/near/134557932" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Keith Yeung <a href="https://rust-lang.github.io/zulip_archive/stream/122657-t-compiler/wg-nll/topic/.2347184-user-given-type-annotations.html#134557932">(Sep 24 2018 at 21:29)</a>:</h4>
<p>i also recently found out that i can use VS to debug on windows</p>



<a name="134557950"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2347184-user-given-type-annotations/near/134557950" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Keith Yeung <a href="https://rust-lang.github.io/zulip_archive/stream/122657-t-compiler/wg-nll/topic/.2347184-user-given-type-annotations.html#134557950">(Sep 24 2018 at 21:29)</a>:</h4>
<p>so i don't necessarily have to get a linux or mac in order to use gdb/lldb to look at the stack</p>



<a name="134558461"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2347184-user-given-type-annotations/near/134558461" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://rust-lang.github.io/zulip_archive/stream/122657-t-compiler/wg-nll/topic/.2347184-user-given-type-annotations.html#134558461">(Sep 24 2018 at 21:37)</a>:</h4>
<p>the problem is not specific to constants</p>



<a name="134558750"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2347184-user-given-type-annotations/near/134558750" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://rust-lang.github.io/zulip_archive/stream/122657-t-compiler/wg-nll/topic/.2347184-user-given-type-annotations.html#134558750">(Sep 24 2018 at 21:43)</a>:</h4>
<p>hmm. what happens is:</p>
<ul>
<li><code>as_local_rvalue</code> is called which invokes</li>
<li><code>as_operand</code>, which invokes</li>
<li><code>as_temp</code>, which invokes</li>
<li><code>into</code>, which invokes</li>
<li><code>as_local_rvalue</code></li>
</ul>



<a name="134558763"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2347184-user-given-type-annotations/near/134558763" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://rust-lang.github.io/zulip_archive/stream/122657-t-compiler/wg-nll/topic/.2347184-user-given-type-annotations.html#134558763">(Sep 24 2018 at 21:43)</a>:</h4>
<p>I don't quite know why this problem seems to be specific to <code>ValueTypeAscription</code> though</p>



<a name="134558785"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2347184-user-given-type-annotations/near/134558785" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://rust-lang.github.io/zulip_archive/stream/122657-t-compiler/wg-nll/topic/.2347184-user-given-type-annotations.html#134558785">(Sep 24 2018 at 21:44)</a>:</h4>
<p>well, it occurs with either case</p>



<a name="134558875"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2347184-user-given-type-annotations/near/134558875" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://rust-lang.github.io/zulip_archive/stream/122657-t-compiler/wg-nll/topic/.2347184-user-given-type-annotations.html#134558875">(Sep 24 2018 at 21:45)</a>:</h4>
<p>it seems like the problem is</p>



<a name="134558884"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2347184-user-given-type-annotations/near/134558884" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://rust-lang.github.io/zulip_archive/stream/122657-t-compiler/wg-nll/topic/.2347184-user-given-type-annotations.html#134558884">(Sep 24 2018 at 21:45)</a>:</h4>
<p>if you look, <code>into</code> <em>also</em> includes code for <code>Place</code> category things</p>



<a name="134558992"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2347184-user-given-type-annotations/near/134558992" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://rust-lang.github.io/zulip_archive/stream/122657-t-compiler/wg-nll/topic/.2347184-user-given-type-annotations.html#134558992">(Sep 24 2018 at 21:47)</a>:</h4>
<p>I added a possible fix, will test and push</p>



<a name="134559318"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2347184-user-given-type-annotations/near/134559318" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://rust-lang.github.io/zulip_archive/stream/122657-t-compiler/wg-nll/topic/.2347184-user-given-type-annotations.html#134559318">(Sep 24 2018 at 21:54)</a>:</h4>
<p><span class="user-mention" data-user-id="116108">@Keith Yeung</span> I pushed a commit — the problem is that <code>into</code> seems to special-case "places" to avoid precisely this loop</p>



<a name="134559323"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2347184-user-given-type-annotations/near/134559323" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://rust-lang.github.io/zulip_archive/stream/122657-t-compiler/wg-nll/topic/.2347184-user-given-type-annotations.html#134559323">(Sep 24 2018 at 21:54)</a>:</h4>
<p>I added an add'l assertion as well to catch this case...</p>



<a name="134559369"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2347184-user-given-type-annotations/near/134559369" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Keith Yeung <a href="https://rust-lang.github.io/zulip_archive/stream/122657-t-compiler/wg-nll/topic/.2347184-user-given-type-annotations.html#134559369">(Sep 24 2018 at 21:55)</a>:</h4>
<p>huh, so it's actually a pre-existing bug</p>



<a name="134559424"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2347184-user-given-type-annotations/near/134559424" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Keith Yeung <a href="https://rust-lang.github.io/zulip_archive/stream/122657-t-compiler/wg-nll/topic/.2347184-user-given-type-annotations.html#134559424">(Sep 24 2018 at 21:56)</a>:</h4>
<p>because all Category::Place expressions aren't supposed to be handled in the catch-all branch</p>



<a name="134559481"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2347184-user-given-type-annotations/near/134559481" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://rust-lang.github.io/zulip_archive/stream/122657-t-compiler/wg-nll/topic/.2347184-user-given-type-annotations.html#134559481">(Sep 24 2018 at 21:57)</a>:</h4>
<p>there was a missing assertion, at minimum</p>



<a name="134559482"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2347184-user-given-type-annotations/near/134559482" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Keith Yeung <a href="https://rust-lang.github.io/zulip_archive/stream/122657-t-compiler/wg-nll/topic/.2347184-user-given-type-annotations.html#134559482">(Sep 24 2018 at 21:57)</a>:</h4>
<p>also, i'm quite confused by the fact that it seems to <em>only</em> happen with const declarations -- tests with other rvalue ascriptions seemed to turn out okay</p>



<a name="134559483"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2347184-user-given-type-annotations/near/134559483" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://rust-lang.github.io/zulip_archive/stream/122657-t-compiler/wg-nll/topic/.2347184-user-given-type-annotations.html#134559483">(Sep 24 2018 at 21:57)</a>:</h4>
<p>no,they all fail</p>



<a name="134559486"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2347184-user-given-type-annotations/near/134559486" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://rust-lang.github.io/zulip_archive/stream/122657-t-compiler/wg-nll/topic/.2347184-user-given-type-annotations.html#134559486">(Sep 24 2018 at 21:57)</a>:</h4>
<p>at least for me they did</p>



<a name="134559499"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2347184-user-given-type-annotations/near/134559499" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Keith Yeung <a href="https://rust-lang.github.io/zulip_archive/stream/122657-t-compiler/wg-nll/topic/.2347184-user-given-type-annotations.html#134559499">(Sep 24 2018 at 21:58)</a>:</h4>
<p>i see, i suppose i only knew about the const eval case</p>



<a name="134559550"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2347184-user-given-type-annotations/near/134559550" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Keith Yeung <a href="https://rust-lang.github.io/zulip_archive/stream/122657-t-compiler/wg-nll/topic/.2347184-user-given-type-annotations.html#134559550">(Sep 24 2018 at 21:58)</a>:</h4>
<p>if travis is happy with this, i guess we're good to go</p>



<a name="134559554"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2347184-user-given-type-annotations/near/134559554" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Keith Yeung <a href="https://rust-lang.github.io/zulip_archive/stream/122657-t-compiler/wg-nll/topic/.2347184-user-given-type-annotations.html#134559554">(Sep 24 2018 at 21:58)</a>:</h4>
<p>i can also roll in the changes for typecasts though</p>



<a name="134559571"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2347184-user-given-type-annotations/near/134559571" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Keith Yeung <a href="https://rust-lang.github.io/zulip_archive/stream/122657-t-compiler/wg-nll/topic/.2347184-user-given-type-annotations.html#134559571">(Sep 24 2018 at 21:59)</a>:</h4>
<p>perhaps i should do that since merge times with bors is about 3-4 hours</p>



<a name="134559885"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2347184-user-given-type-annotations/near/134559885" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://rust-lang.github.io/zulip_archive/stream/122657-t-compiler/wg-nll/topic/.2347184-user-given-type-annotations.html#134559885">(Sep 24 2018 at 22:05)</a>:</h4>
<p>I'd say yes, add them in, should be a small-ish change</p>



<a name="134559887"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2347184-user-given-type-annotations/near/134559887" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://rust-lang.github.io/zulip_archive/stream/122657-t-compiler/wg-nll/topic/.2347184-user-given-type-annotations.html#134559887">(Sep 24 2018 at 22:05)</a>:</h4>
<p>it'd be nice to have some tests though</p>



<a name="134559889"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2347184-user-given-type-annotations/near/134559889" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://rust-lang.github.io/zulip_archive/stream/122657-t-compiler/wg-nll/topic/.2347184-user-given-type-annotations.html#134559889">(Sep 24 2018 at 22:05)</a>:</h4>
<p>unless I missed 'em</p>



<a name="134559935"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2347184-user-given-type-annotations/near/134559935" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://rust-lang.github.io/zulip_archive/stream/122657-t-compiler/wg-nll/topic/.2347184-user-given-type-annotations.html#134559935">(Sep 24 2018 at 22:06)</a>:</h4>
<p>this directory <code>src/test/ui/nll/user-annotations/</code></p>



<a name="134765582"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2347184-user-given-type-annotations/near/134765582" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://rust-lang.github.io/zulip_archive/stream/122657-t-compiler/wg-nll/topic/.2347184-user-given-type-annotations.html#134765582">(Sep 27 2018 at 18:41)</a>:</h4>
<p><span class="user-mention" data-user-id="116108">@Keith Yeung</span> you are planning to add the <code>as</code> code into <a href="https://github.com/rust-lang/rust/pull/54447/" target="_blank" title="https://github.com/rust-lang/rust/pull/54447/">https://github.com/rust-lang/rust/pull/54447/</a>, right?</p>



<a name="134765595"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2347184-user-given-type-annotations/near/134765595" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Keith Yeung <a href="https://rust-lang.github.io/zulip_archive/stream/122657-t-compiler/wg-nll/topic/.2347184-user-given-type-annotations.html#134765595">(Sep 27 2018 at 18:41)</a>:</h4>
<p>yes, sorry i haven't gotten into it yet</p>



<a name="134765685"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2347184-user-given-type-annotations/near/134765685" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://rust-lang.github.io/zulip_archive/stream/122657-t-compiler/wg-nll/topic/.2347184-user-given-type-annotations.html#134765685">(Sep 27 2018 at 18:42)</a>:</h4>
<p>no worries just wanted to know, else I would r+</p>



<a name="134862453"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2347184-user-given-type-annotations/near/134862453" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Keith Yeung <a href="https://rust-lang.github.io/zulip_archive/stream/122657-t-compiler/wg-nll/topic/.2347184-user-given-type-annotations.html#134862453">(Sep 29 2018 at 01:45)</a>:</h4>
<p>hmm... so casts are a bit different in the sense that we already have <code>ExprKind::Cast</code> in the HAIR</p>



<a name="134862500"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2347184-user-given-type-annotations/near/134862500" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Keith Yeung <a href="https://rust-lang.github.io/zulip_archive/stream/122657-t-compiler/wg-nll/topic/.2347184-user-given-type-annotations.html#134862500">(Sep 29 2018 at 01:46)</a>:</h4>
<p>according to issue <a href="https://github.com/rust-lang/rust/issues/54332" target="_blank" title="https://github.com/rust-lang/rust/issues/54332">#54332</a>, it says that i should instead lower it differently and reuse the <code>ExprKind::ValueTypeAscription</code> variant that i've created previously</p>



<a name="134875737"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2347184-user-given-type-annotations/near/134875737" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Matthew Jasper <a href="https://rust-lang.github.io/zulip_archive/stream/122657-t-compiler/wg-nll/topic/.2347184-user-given-type-annotations.html#134875737">(Sep 29 2018 at 09:23)</a>:</h4>
<p>I think Niko meant that <code>(x as T)</code> should be lowered as <code>ValueTypeAscription { source: Cast { /* same as currently */ }, user_ty: T }</code>, the <code>Cast</code> is still needed.</p>



<a name="134876214"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2347184-user-given-type-annotations/near/134876214" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Matthew Jasper <a href="https://rust-lang.github.io/zulip_archive/stream/122657-t-compiler/wg-nll/topic/.2347184-user-given-type-annotations.html#134876214">(Sep 29 2018 at 09:39)</a>:</h4>
<p>While your there can you also move the branch in <a href="http://expr.rs" target="_blank" title="http://expr.rs">expr.rs</a> above the <code>// Now comes the rote stuff:</code>comment? Even currently it's in no way rote.</p>



<a name="134888690"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2347184-user-given-type-annotations/near/134888690" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Keith Yeung <a href="https://rust-lang.github.io/zulip_archive/stream/122657-t-compiler/wg-nll/topic/.2347184-user-given-type-annotations.html#134888690">(Sep 29 2018 at 16:50)</a>:</h4>
<blockquote>
<p>I think Niko meant that <code>(x as T)</code> should be lowered as <code>ValueTypeAscription { source: Cast { /* same as currently */ }, user_ty: T }</code>, the <code>Cast</code> is still needed.</p>
</blockquote>
<p>what you wrote there would mean that i have to box the ExprKind</p>



<a name="134888878"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2347184-user-given-type-annotations/near/134888878" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Keith Yeung <a href="https://rust-lang.github.io/zulip_archive/stream/122657-t-compiler/wg-nll/topic/.2347184-user-given-type-annotations.html#134888878">(Sep 29 2018 at 16:56)</a>:</h4>
<p>oh, nevermind... I can use the ExprKind::to_ref method so that i don't need to box it</p>



<a name="134889195"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2347184-user-given-type-annotations/near/134889195" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Matthew Jasper <a href="https://rust-lang.github.io/zulip_archive/stream/122657-t-compiler/wg-nll/topic/.2347184-user-given-type-annotations.html#134889195">(Sep 29 2018 at 17:06)</a>:</h4>
<p>Doesn't <code>to_ref</code> box it?</p>



<a name="134890068"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2347184-user-given-type-annotations/near/134890068" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Keith Yeung <a href="https://rust-lang.github.io/zulip_archive/stream/122657-t-compiler/wg-nll/topic/.2347184-user-given-type-annotations.html#134890068">(Sep 29 2018 at 17:33)</a>:</h4>
<p>not sure, i just know that it typechecks</p>



<a name="134890984"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2347184-user-given-type-annotations/near/134890984" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Keith Yeung <a href="https://rust-lang.github.io/zulip_archive/stream/122657-t-compiler/wg-nll/topic/.2347184-user-given-type-annotations.html#134890984">(Sep 29 2018 at 18:06)</a>:</h4>
<p>NUPE, it doesn't type check</p>



<a name="134890995"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2347184-user-given-type-annotations/near/134890995" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Keith Yeung <a href="https://rust-lang.github.io/zulip_archive/stream/122657-t-compiler/wg-nll/topic/.2347184-user-given-type-annotations.html#134890995">(Sep 29 2018 at 18:07)</a>:</h4>
<p>primarily because ExprKind doesn't implement ToRef</p>



<a name="134985577"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2347184-user-given-type-annotations/near/134985577" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://rust-lang.github.io/zulip_archive/stream/122657-t-compiler/wg-nll/topic/.2347184-user-given-type-annotations.html#134985577">(Oct 01 2018 at 17:52)</a>:</h4>
<p><span class="user-mention" data-user-id="116108">@Keith Yeung</span> yes you have to box the ExprKind... seems ok?</p>



<a name="134985583"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2347184-user-given-type-annotations/near/134985583" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://rust-lang.github.io/zulip_archive/stream/122657-t-compiler/wg-nll/topic/.2347184-user-given-type-annotations.html#134985583">(Oct 01 2018 at 17:52)</a>:</h4>
<p>I did indeed mean what <span class="user-mention" data-user-id="116118">@Matthew Jasper</span> suggested</p>



<a name="134985591"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2347184-user-given-type-annotations/near/134985591" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Keith Yeung <a href="https://rust-lang.github.io/zulip_archive/stream/122657-t-compiler/wg-nll/topic/.2347184-user-given-type-annotations.html#134985591">(Oct 01 2018 at 17:52)</a>:</h4>
<p>i just haven't seen this pattern before for other variants</p>



<a name="134985595"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2347184-user-given-type-annotations/near/134985595" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Keith Yeung <a href="https://rust-lang.github.io/zulip_archive/stream/122657-t-compiler/wg-nll/topic/.2347184-user-given-type-annotations.html#134985595">(Oct 01 2018 at 17:52)</a>:</h4>
<p>so wanted to double-check if that was the solution</p>



<a name="134985611"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2347184-user-given-type-annotations/near/134985611" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://rust-lang.github.io/zulip_archive/stream/122657-t-compiler/wg-nll/topic/.2347184-user-given-type-annotations.html#134985611">(Oct 01 2018 at 17:53)</a>:</h4>
<p>well, I'm not sure about boxing</p>



<a name="134985622"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2347184-user-given-type-annotations/near/134985622" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://rust-lang.github.io/zulip_archive/stream/122657-t-compiler/wg-nll/topic/.2347184-user-given-type-annotations.html#134985622">(Oct 01 2018 at 17:53)</a>:</h4>
<p><a href="https://github.com/rust-lang/rust/blob/de3d640f59c4fa4a09faf2a8d6b0a812aaa6d6cb/src/librustc_mir/hair/cx/expr.rs#L159-L178" target="_blank" title="https://github.com/rust-lang/rust/blob/de3d640f59c4fa4a09faf2a8d6b0a812aaa6d6cb/src/librustc_mir/hair/cx/expr.rs#L159-L178">here is an example where we do something similar</a></p>



<a name="134985642"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2347184-user-given-type-annotations/near/134985642" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://rust-lang.github.io/zulip_archive/stream/122657-t-compiler/wg-nll/topic/.2347184-user-given-type-annotations.html#134985642">(Oct 01 2018 at 17:53)</a>:</h4>
<p>except there we are wrapping something else with a <code>Cast</code> node</p>



<a name="134985756"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2347184-user-given-type-annotations/near/134985756" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://rust-lang.github.io/zulip_archive/stream/122657-t-compiler/wg-nll/topic/.2347184-user-given-type-annotations.html#134985756">(Oct 01 2018 at 17:55)</a>:</h4>
<p>in general, one HIR node can definitely to multiple HAIR nodes (e.g., for adjustments)</p>



<a name="134986427"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2347184-user-given-type-annotations/near/134986427" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Keith Yeung <a href="https://rust-lang.github.io/zulip_archive/stream/122657-t-compiler/wg-nll/topic/.2347184-user-given-type-annotations.html#134986427">(Oct 01 2018 at 18:04)</a>:</h4>
<p>so is it true that i should follow this format?</p>



<a name="134986454"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2347184-user-given-type-annotations/near/134986454" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://rust-lang.github.io/zulip_archive/stream/122657-t-compiler/wg-nll/topic/.2347184-user-given-type-annotations.html#134986454">(Oct 01 2018 at 18:04)</a>:</h4>
<p>I think so, yes</p>



<a name="134986462"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2347184-user-given-type-annotations/near/134986462" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://rust-lang.github.io/zulip_archive/stream/122657-t-compiler/wg-nll/topic/.2347184-user-given-type-annotations.html#134986462">(Oct 01 2018 at 18:04)</a>:</h4>
<p>however</p>



<a name="134986466"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2347184-user-given-type-annotations/near/134986466" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://rust-lang.github.io/zulip_archive/stream/122657-t-compiler/wg-nll/topic/.2347184-user-given-type-annotations.html#134986466">(Oct 01 2018 at 18:04)</a>:</h4>
<p>well..</p>



<a name="134986471"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2347184-user-given-type-annotations/near/134986471" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Keith Yeung <a href="https://rust-lang.github.io/zulip_archive/stream/122657-t-compiler/wg-nll/topic/.2347184-user-given-type-annotations.html#134986471">(Oct 01 2018 at 18:05)</a>:</h4>
<p>i.e. create a <code>cast_expr</code>, and then put it inside of <code>ValueTypeAscription</code></p>



<a name="134986481"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2347184-user-given-type-annotations/near/134986481" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://rust-lang.github.io/zulip_archive/stream/122657-t-compiler/wg-nll/topic/.2347184-user-given-type-annotations.html#134986481">(Oct 01 2018 at 18:05)</a>:</h4>
<p>so there are two options</p>



<a name="134986490"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2347184-user-given-type-annotations/near/134986490" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://rust-lang.github.io/zulip_archive/stream/122657-t-compiler/wg-nll/topic/.2347184-user-given-type-annotations.html#134986490">(Oct 01 2018 at 18:05)</a>:</h4>
<p>we could just modify casts to always carry a user-type I guess..</p>



<a name="134986494"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2347184-user-given-type-annotations/near/134986494" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://rust-lang.github.io/zulip_archive/stream/122657-t-compiler/wg-nll/topic/.2347184-user-given-type-annotations.html#134986494">(Oct 01 2018 at 18:05)</a>:</h4>
<p>but it seems better to nest it</p>



<a name="134986500"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2347184-user-given-type-annotations/near/134986500" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://rust-lang.github.io/zulip_archive/stream/122657-t-compiler/wg-nll/topic/.2347184-user-given-type-annotations.html#134986500">(Oct 01 2018 at 18:05)</a>:</h4>
<p>however: we don't <em>always</em> have to do so</p>



<a name="134986514"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2347184-user-given-type-annotations/near/134986514" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://rust-lang.github.io/zulip_archive/stream/122657-t-compiler/wg-nll/topic/.2347184-user-given-type-annotations.html#134986514">(Oct 01 2018 at 18:05)</a>:</h4>
<p>e.g. <code>foo as u32</code> would need a <code>ValueTypeAscription</code></p>



<a name="134986521"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2347184-user-given-type-annotations/near/134986521" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://rust-lang.github.io/zulip_archive/stream/122657-t-compiler/wg-nll/topic/.2347184-user-given-type-annotations.html#134986521">(Oct 01 2018 at 18:05)</a>:</h4>
<p>there is some efficiency cost so it may be worth distinguishing</p>



<a name="134986565"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2347184-user-given-type-annotations/near/134986565" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://rust-lang.github.io/zulip_archive/stream/122657-t-compiler/wg-nll/topic/.2347184-user-given-type-annotations.html#134986565">(Oct 01 2018 at 18:06)</a>:</h4>
<blockquote>
<p>i.e. create a <code>cast_expr</code>, and then put it inside of <code>ValueTypeAscription</code></p>
</blockquote>
<p>right</p>



<a name="134986569"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2347184-user-given-type-annotations/near/134986569" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://rust-lang.github.io/zulip_archive/stream/122657-t-compiler/wg-nll/topic/.2347184-user-given-type-annotations.html#134986569">(Oct 01 2018 at 18:06)</a>:</h4>
<p>I guess to start we can do it indiscriminantely</p>



<a name="134986583"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2347184-user-given-type-annotations/near/134986583" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Keith Yeung <a href="https://rust-lang.github.io/zulip_archive/stream/122657-t-compiler/wg-nll/topic/.2347184-user-given-type-annotations.html#134986583">(Oct 01 2018 at 18:06)</a>:</h4>
<p>when perf becomes a problem we can revisit</p>



<a name="134986588"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2347184-user-given-type-annotations/near/134986588" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://rust-lang.github.io/zulip_archive/stream/122657-t-compiler/wg-nll/topic/.2347184-user-given-type-annotations.html#134986588">(Oct 01 2018 at 18:06)</a>:</h4>
<p>exactly</p>



<a name="134986607"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2347184-user-given-type-annotations/near/134986607" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Keith Yeung <a href="https://rust-lang.github.io/zulip_archive/stream/122657-t-compiler/wg-nll/topic/.2347184-user-given-type-annotations.html#134986607">(Oct 01 2018 at 18:06)</a>:</h4>
<p>should probably write a note on that point</p>



<a name="135055354"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2347184-user-given-type-annotations/near/135055354" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Keith Yeung <a href="https://rust-lang.github.io/zulip_archive/stream/122657-t-compiler/wg-nll/topic/.2347184-user-given-type-annotations.html#135055354">(Oct 02 2018 at 18:46)</a>:</h4>
<p>ok, so my naïve implementation didn't work</p>



<a name="135055390"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2347184-user-given-type-annotations/near/135055390" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://rust-lang.github.io/zulip_archive/stream/122657-t-compiler/wg-nll/topic/.2347184-user-given-type-annotations.html#135055390">(Oct 02 2018 at 18:47)</a>:</h4>
<p>for casts?</p>



<a name="135055404"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2347184-user-given-type-annotations/near/135055404" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Keith Yeung <a href="https://rust-lang.github.io/zulip_archive/stream/122657-t-compiler/wg-nll/topic/.2347184-user-given-type-annotations.html#135055404">(Oct 02 2018 at 18:47)</a>:</h4>
<p>yes</p>



<a name="135055469"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2347184-user-given-type-annotations/near/135055469" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Keith Yeung <a href="https://rust-lang.github.io/zulip_archive/stream/122657-t-compiler/wg-nll/topic/.2347184-user-given-type-annotations.html#135055469">(Oct 02 2018 at 18:48)</a>:</h4>
<p>in fact it passed my test case when it's supposed to fail</p>



<a name="135055502"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2347184-user-given-type-annotations/near/135055502" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Keith Yeung <a href="https://rust-lang.github.io/zulip_archive/stream/122657-t-compiler/wg-nll/topic/.2347184-user-given-type-annotations.html#135055502">(Oct 02 2018 at 18:48)</a>:</h4>
<p>i wonder what the type of the cast expression is</p>



<a name="135055507"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2347184-user-given-type-annotations/near/135055507" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Keith Yeung <a href="https://rust-lang.github.io/zulip_archive/stream/122657-t-compiler/wg-nll/topic/.2347184-user-given-type-annotations.html#135055507">(Oct 02 2018 at 18:48)</a>:</h4>
<p>perhaps i'm not using it correctly</p>



<a name="135055703"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2347184-user-given-type-annotations/near/135055703" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://rust-lang.github.io/zulip_archive/stream/122657-t-compiler/wg-nll/topic/.2347184-user-given-type-annotations.html#135055703">(Oct 02 2018 at 18:51)</a>:</h4>
<p>maybe check the MIR you are generating?</p>



<a name="135055707"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2347184-user-given-type-annotations/near/135055707" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://rust-lang.github.io/zulip_archive/stream/122657-t-compiler/wg-nll/topic/.2347184-user-given-type-annotations.html#135055707">(Oct 02 2018 at 18:51)</a>:</h4>
<p>if you push the code, I'll take a look</p>



<a name="135058938"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2347184-user-given-type-annotations/near/135058938" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Keith Yeung <a href="https://rust-lang.github.io/zulip_archive/stream/122657-t-compiler/wg-nll/topic/.2347184-user-given-type-annotations.html#135058938">(Oct 02 2018 at 19:40)</a>:</h4>
<p>I have, in fact it's high five that told me about the error</p>



<a name="135058975"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2347184-user-given-type-annotations/near/135058975" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Keith Yeung <a href="https://rust-lang.github.io/zulip_archive/stream/122657-t-compiler/wg-nll/topic/.2347184-user-given-type-annotations.html#135058975">(Oct 02 2018 at 19:41)</a>:</h4>
<p>That was in fact what I had in mind for next steps too</p>



<a name="135059064"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2347184-user-given-type-annotations/near/135059064" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://rust-lang.github.io/zulip_archive/stream/122657-t-compiler/wg-nll/topic/.2347184-user-given-type-annotations.html#135059064">(Oct 02 2018 at 19:42)</a>:</h4>
<p>it might be something to do with constants</p>



<a name="135060804"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2347184-user-given-type-annotations/near/135060804" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://rust-lang.github.io/zulip_archive/stream/122657-t-compiler/wg-nll/topic/.2347184-user-given-type-annotations.html#135060804">(Oct 02 2018 at 20:11)</a>:</h4>
<p>hmm</p>



<a name="135060806"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2347184-user-given-type-annotations/near/135060806" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://rust-lang.github.io/zulip_archive/stream/122657-t-compiler/wg-nll/topic/.2347184-user-given-type-annotations.html#135060806">(Oct 02 2018 at 20:11)</a>:</h4>
<p>your PR <em>looks</em> reasonable</p>



<a name="135060818"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2347184-user-given-type-annotations/near/135060818" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://rust-lang.github.io/zulip_archive/stream/122657-t-compiler/wg-nll/topic/.2347184-user-given-type-annotations.html#135060818">(Oct 02 2018 at 20:11)</a>:</h4>
<p>I can imagine the problems around constants, but I'm not sure why the test is not passing yet...</p>



<a name="135130268"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2347184-user-given-type-annotations/near/135130268" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://rust-lang.github.io/zulip_archive/stream/122657-t-compiler/wg-nll/topic/.2347184-user-given-type-annotations.html#135130268">(Oct 03 2018 at 20:16)</a>:</h4>
<p><span class="user-mention" data-user-id="116108">@Keith Yeung</span> make any progress here? We could land the type ascriptions and come back to the cast expressions</p>



<a name="135130279"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2347184-user-given-type-annotations/near/135130279" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Keith Yeung <a href="https://rust-lang.github.io/zulip_archive/stream/122657-t-compiler/wg-nll/topic/.2347184-user-given-type-annotations.html#135130279">(Oct 03 2018 at 20:16)</a>:</h4>
<p>no, i haven't looked into this yesterday unfortunately</p>



<a name="135130293"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2347184-user-given-type-annotations/near/135130293" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Keith Yeung <a href="https://rust-lang.github.io/zulip_archive/stream/122657-t-compiler/wg-nll/topic/.2347184-user-given-type-annotations.html#135130293">(Oct 03 2018 at 20:16)</a>:</h4>
<p>but yes, perhaps that's what we can do for now</p>



<a name="135130406"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2347184-user-given-type-annotations/near/135130406" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Keith Yeung <a href="https://rust-lang.github.io/zulip_archive/stream/122657-t-compiler/wg-nll/topic/.2347184-user-given-type-annotations.html#135130406">(Oct 03 2018 at 20:18)</a>:</h4>
<p><span class="user-mention" data-user-id="116009">@nikomatsakis</span> i've just removed my last commit for the type casts</p>



<a name="135130408"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2347184-user-given-type-annotations/near/135130408" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Keith Yeung <a href="https://rust-lang.github.io/zulip_archive/stream/122657-t-compiler/wg-nll/topic/.2347184-user-given-type-annotations.html#135130408">(Oct 03 2018 at 20:18)</a>:</h4>
<p>think it's ready to be r+'d</p>



<a name="135131455"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2347184-user-given-type-annotations/near/135131455" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://rust-lang.github.io/zulip_archive/stream/122657-t-compiler/wg-nll/topic/.2347184-user-given-type-annotations.html#135131455">(Oct 03 2018 at 20:28)</a>:</h4>
<p>ok</p>



<a name="135249043"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2347184-user-given-type-annotations/near/135249043" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> pnkfelix <a href="https://rust-lang.github.io/zulip_archive/stream/122657-t-compiler/wg-nll/topic/.2347184-user-given-type-annotations.html#135249043">(Oct 05 2018 at 11:30)</a>:</h4>
<p>hey <span class="user-mention" data-user-id="116009">@nikomatsakis</span> do you think you'll be looking into the ICE on your PR <a href="https://github.com/rust-lang/rust/issues/54757" target="_blank" title="https://github.com/rust-lang/rust/issues/54757">#54757</a> any time soon?</p>



<a name="135249084"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2347184-user-given-type-annotations/near/135249084" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> pnkfelix <a href="https://rust-lang.github.io/zulip_archive/stream/122657-t-compiler/wg-nll/topic/.2347184-user-given-type-annotations.html#135249084">(Oct 05 2018 at 11:31)</a>:</h4>
<p>the reason that I ask is that it looks similar to ICE's that I am dealing with elsewhere, and so I am curious if you already have a fix in mind. (and/or if you think it overlaps with bugs related to normalization...)</p>



<a name="135261590"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2347184-user-given-type-annotations/near/135261590" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://rust-lang.github.io/zulip_archive/stream/122657-t-compiler/wg-nll/topic/.2347184-user-given-type-annotations.html#135261590">(Oct 05 2018 at 15:25)</a>:</h4>
<p><span class="user-mention" data-user-id="116083">@pnkfelix</span> I am investigating this ICE right now, yes.</p>



<a name="135261908"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2347184-user-given-type-annotations/near/135261908" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://rust-lang.github.io/zulip_archive/stream/122657-t-compiler/wg-nll/topic/.2347184-user-given-type-annotations.html#135261908">(Oct 05 2018 at 15:30)</a>:</h4>
<p>(if you have other examples, I'd like to see them)</p>



<a name="135264497"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2347184-user-given-type-annotations/near/135264497" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> pnkfelix <a href="https://rust-lang.github.io/zulip_archive/stream/122657-t-compiler/wg-nll/topic/.2347184-user-given-type-annotations.html#135264497">(Oct 05 2018 at 16:16)</a>:</h4>
<p>Well some are on a development branch, so who knows...?</p>



<a name="135431451"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2347184-user-given-type-annotations/near/135431451" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Keith Yeung <a href="https://rust-lang.github.io/zulip_archive/stream/122657-t-compiler/wg-nll/topic/.2347184-user-given-type-annotations.html#135431451">(Oct 08 2018 at 22:22)</a>:</h4>
<p>here's the relevant sections of the MIR that gets generated with my attempt at the "respect casts" issue:</p>
<p>first, the temporary created by <code>ValueTypeAscription</code> when lowering to MIR and the cast temporary is defined as such:</p>
<div class="codehilite"><pre><span></span>let _2: &amp;u32 as Canonical { variables: [CanonicalVarInfo { kind: Region }], value: &amp;u32 };
let mut _3: &amp;&#39;static u32;
</pre></div>


<p>then, the relevant lines pertaining to <code>ValueTypeAscription</code> is here:</p>
<div class="codehilite"><pre><span></span>        _2 = &amp;(*_3);
        StorageDead(_4);
        AscribeUserType(_2, o, Canonical { variables: [CanonicalVarInfo { kind: Region }], value: &amp;u32 });
</pre></div>



<a name="135431471"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2347184-user-given-type-annotations/near/135431471" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Keith Yeung <a href="https://rust-lang.github.io/zulip_archive/stream/122657-t-compiler/wg-nll/topic/.2347184-user-given-type-annotations.html#135431471">(Oct 08 2018 at 22:23)</a>:</h4>
<p>the question that immediately popped up in my head is "how do you even represent a &amp;'static u32 in canonical types?"</p>



<a name="135431479"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2347184-user-given-type-annotations/near/135431479" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Keith Yeung <a href="https://rust-lang.github.io/zulip_archive/stream/122657-t-compiler/wg-nll/topic/.2347184-user-given-type-annotations.html#135431479">(Oct 08 2018 at 22:23)</a>:</h4>
<p>or is it impossible and we are stuck with this data structure?</p>



<a name="135431523"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2347184-user-given-type-annotations/near/135431523" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Keith Yeung <a href="https://rust-lang.github.io/zulip_archive/stream/122657-t-compiler/wg-nll/topic/.2347184-user-given-type-annotations.html#135431523">(Oct 08 2018 at 22:24)</a>:</h4>
<p>because whatever it is doing right now seems to not be able to capture the intent of &amp;'static u32 for <code>_2</code>, which is what we need</p>



<a name="135468299"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2347184-user-given-type-annotations/near/135468299" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://rust-lang.github.io/zulip_archive/stream/122657-t-compiler/wg-nll/topic/.2347184-user-given-type-annotations.html#135468299">(Oct 09 2018 at 13:14)</a>:</h4>
<p><span class="user-mention" data-user-id="116108">@Keith Yeung</span> I wonder if the cast problem was related to the bug I found in <a href="https://github.com/rust-lang/rust/pull/54757" target="_blank" title="https://github.com/rust-lang/rust/pull/54757">https://github.com/rust-lang/rust/pull/54757</a></p>



<a name="135468307"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2347184-user-given-type-annotations/near/135468307" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://rust-lang.github.io/zulip_archive/stream/122657-t-compiler/wg-nll/topic/.2347184-user-given-type-annotations.html#135468307">(Oct 09 2018 at 13:14)</a>:</h4>
<p>we should try your commits again</p>



<a name="135468316"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2347184-user-given-type-annotations/near/135468316" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://rust-lang.github.io/zulip_archive/stream/122657-t-compiler/wg-nll/topic/.2347184-user-given-type-annotations.html#135468316">(Oct 09 2018 at 13:14)</a>:</h4>
<blockquote>
<p>the question that immediately popped up in my head is "how do you even represent a &amp;'static u32 in canonical types?"</p>
</blockquote>
<p>I don't know what the problem would be here, that should .. be fine?</p>



<a name="135468387"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2347184-user-given-type-annotations/near/135468387" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://rust-lang.github.io/zulip_archive/stream/122657-t-compiler/wg-nll/topic/.2347184-user-given-type-annotations.html#135468387">(Oct 09 2018 at 13:15)</a>:</h4>
<p>I guess you're saying that we are getting the wrong "user type"; might be true, but it's not a limitation of <code>Canonical</code></p>



<a name="135500233"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2347184-user-given-type-annotations/near/135500233" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Keith Yeung <a href="https://rust-lang.github.io/zulip_archive/stream/122657-t-compiler/wg-nll/topic/.2347184-user-given-type-annotations.html#135500233">(Oct 09 2018 at 21:25)</a>:</h4>
<p>yep, travis is not happy</p>



<a name="135500292"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2347184-user-given-type-annotations/near/135500292" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Keith Yeung <a href="https://rust-lang.github.io/zulip_archive/stream/122657-t-compiler/wg-nll/topic/.2347184-user-given-type-annotations.html#135500292">(Oct 09 2018 at 21:26)</a>:</h4>
<p>and yes, i was attempting to express that the canonical types are not exactly "canonical", so to speak</p>



<a name="135500307"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2347184-user-given-type-annotations/near/135500307" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Keith Yeung <a href="https://rust-lang.github.io/zulip_archive/stream/122657-t-compiler/wg-nll/topic/.2347184-user-given-type-annotations.html#135500307">(Oct 09 2018 at 21:26)</a>:</h4>
<p>as in, they're not exactly the type that the user has ascribed to the expression</p>



<a name="135500323"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2347184-user-given-type-annotations/near/135500323" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Keith Yeung <a href="https://rust-lang.github.io/zulip_archive/stream/122657-t-compiler/wg-nll/topic/.2347184-user-given-type-annotations.html#135500323">(Oct 09 2018 at 21:26)</a>:</h4>
<p>or in this case, not the exact target type the user wishes to cast to</p>



<a name="135500440"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2347184-user-given-type-annotations/near/135500440" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://rust-lang.github.io/zulip_archive/stream/122657-t-compiler/wg-nll/topic/.2347184-user-given-type-annotations.html#135500440">(Oct 09 2018 at 21:28)</a>:</h4>
<p>thing is, they <em>are</em>, so we must be canonicalizing the wrong thing</p>



<a name="135500448"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2347184-user-given-type-annotations/near/135500448" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://rust-lang.github.io/zulip_archive/stream/122657-t-compiler/wg-nll/topic/.2347184-user-given-type-annotations.html#135500448">(Oct 09 2018 at 21:28)</a>:</h4>
<p>would have to dig in a bit more to see why I guess</p>



<a name="135500461"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2347184-user-given-type-annotations/near/135500461" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://rust-lang.github.io/zulip_archive/stream/122657-t-compiler/wg-nll/topic/.2347184-user-given-type-annotations.html#135500461">(Oct 09 2018 at 21:29)</a>:</h4>
<p>they ought to e.g. preserve <code>'static</code>, unless the input type did not have <code>'static</code> to start with</p>



<a name="135508387"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2347184-user-given-type-annotations/near/135508387" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Keith Yeung <a href="https://rust-lang.github.io/zulip_archive/stream/122657-t-compiler/wg-nll/topic/.2347184-user-given-type-annotations.html#135508387">(Oct 10 2018 at 00:02)</a>:</h4>
<p>that's what i thought initially as well, and i can point to you where i think the culprit is</p>



<a name="135508412"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2347184-user-given-type-annotations/near/135508412" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Keith Yeung <a href="https://rust-lang.github.io/zulip_archive/stream/122657-t-compiler/wg-nll/topic/.2347184-user-given-type-annotations.html#135508412">(Oct 10 2018 at 00:03)</a>:</h4>
<p>here: <a href="https://github.com/rust-lang/rust/pull/54938/files#diff-1d1b0d29a2e8da97c6bfb6e364d920c7R4143" target="_blank" title="https://github.com/rust-lang/rust/pull/54938/files#diff-1d1b0d29a2e8da97c6bfb6e364d920c7R4143">https://github.com/rust-lang/rust/pull/54938/files#diff-1d1b0d29a2e8da97c6bfb6e364d920c7R4143</a></p>



<a name="135508426"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2347184-user-given-type-annotations/near/135508426" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Keith Yeung <a href="https://rust-lang.github.io/zulip_archive/stream/122657-t-compiler/wg-nll/topic/.2347184-user-given-type-annotations.html#135508426">(Oct 10 2018 at 00:03)</a>:</h4>
<p>i've tried moving this up so that i use the canonicalized type directly</p>



<a name="135508437"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2347184-user-given-type-annotations/near/135508437" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Keith Yeung <a href="https://rust-lang.github.io/zulip_archive/stream/122657-t-compiler/wg-nll/topic/.2347184-user-given-type-annotations.html#135508437">(Oct 10 2018 at 00:03)</a>:</h4>
<p>instead of it being passed through all the cast checks and whatnot</p>



<a name="135508472"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2347184-user-given-type-annotations/near/135508472" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Keith Yeung <a href="https://rust-lang.github.io/zulip_archive/stream/122657-t-compiler/wg-nll/topic/.2347184-user-given-type-annotations.html#135508472">(Oct 10 2018 at 00:04)</a>:</h4>
<p>and it still didn't work</p>



<a name="135994625"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2347184-user-given-type-annotations/near/135994625" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://rust-lang.github.io/zulip_archive/stream/122657-t-compiler/wg-nll/topic/.2347184-user-given-type-annotations.html#135994625">(Oct 17 2018 at 19:21)</a>:</h4>
<p><span class="user-mention" data-user-id="116108">@Keith Yeung</span> argh forgot about this I will do some digging now</p>



<a name="135997206"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2347184-user-given-type-annotations/near/135997206" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://rust-lang.github.io/zulip_archive/stream/122657-t-compiler/wg-nll/topic/.2347184-user-given-type-annotations.html#135997206">(Oct 17 2018 at 20:03)</a>:</h4>
<p>ok, the problem is caused by shadowing</p>



<a name="135997226"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2347184-user-given-type-annotations/near/135997226" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://rust-lang.github.io/zulip_archive/stream/122657-t-compiler/wg-nll/topic/.2347184-user-given-type-annotations.html#135997226">(Oct 17 2018 at 20:03)</a>:</h4>
<p>the <code>ty</code> you want to be referring to is bound in the <code>match</code> higher up, but the one you <em>are</em> referring to is bound here:</p>
<div class="codehilite"><pre><span></span><span class="kd">let</span><span class="w"> </span><span class="n">source</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="kd">let</span><span class="w"> </span><span class="nb">Some</span><span class="p">((</span><span class="n">did</span><span class="p">,</span><span class="w"> </span><span class="n">offset</span><span class="p">,</span><span class="w"> </span><span class="n">ty</span><span class="p">))</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">var</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
</pre></div>



<a name="135997281"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2347184-user-given-type-annotations/near/135997281" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://rust-lang.github.io/zulip_archive/stream/122657-t-compiler/wg-nll/topic/.2347184-user-given-type-annotations.html#135997281">(Oct 17 2018 at 20:04)</a>:</h4>
<p>I don't know what's up with the const evaluation, otoh, I guess it's something caused by introducing a <code>let</code> and an <code>ascribeusertype</code> into the MIR</p>



<a name="135997284"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2347184-user-given-type-annotations/near/135997284" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://rust-lang.github.io/zulip_archive/stream/122657-t-compiler/wg-nll/topic/.2347184-user-given-type-annotations.html#135997284">(Oct 17 2018 at 20:04)</a>:</h4>
<p>probably..harmless enough, but kind of lame</p>



<a name="135997398"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2347184-user-given-type-annotations/near/135997398" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://rust-lang.github.io/zulip_archive/stream/122657-t-compiler/wg-nll/topic/.2347184-user-given-type-annotations.html#135997398">(Oct 17 2018 at 20:06)</a>:</h4>
<p>hmm</p>



<a name="135997399"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2347184-user-given-type-annotations/near/135997399" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://rust-lang.github.io/zulip_archive/stream/122657-t-compiler/wg-nll/topic/.2347184-user-given-type-annotations.html#135997399">(Oct 17 2018 at 20:07)</a>:</h4>
<p>maybe not the whole story</p>



<a name="135997404"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2347184-user-given-type-annotations/near/135997404" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://rust-lang.github.io/zulip_archive/stream/122657-t-compiler/wg-nll/topic/.2347184-user-given-type-annotations.html#135997404">(Oct 17 2018 at 20:07)</a>:</h4>
<p>test still doesn't pass for some reason</p>



<a name="136242697"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2347184-user-given-type-annotations/near/136242697" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Keith Yeung <a href="https://rust-lang.github.io/zulip_archive/stream/122657-t-compiler/wg-nll/topic/.2347184-user-given-type-annotations.html#136242697">(Oct 22 2018 at 03:31)</a>:</h4>
<p>what ended up being the problem for this?</p>



<a name="136242698"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2347184-user-given-type-annotations/near/136242698" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Keith Yeung <a href="https://rust-lang.github.io/zulip_archive/stream/122657-t-compiler/wg-nll/topic/.2347184-user-given-type-annotations.html#136242698">(Oct 22 2018 at 03:31)</a>:</h4>
<p>because i surely didn't spot what it was</p>



<a name="136274518"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2347184-user-given-type-annotations/near/136274518" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://rust-lang.github.io/zulip_archive/stream/122657-t-compiler/wg-nll/topic/.2347184-user-given-type-annotations.html#136274518">(Oct 22 2018 at 15:26)</a>:</h4>
<p>well, <span class="user-mention" data-user-id="116108">@Keith Yeung</span>, there was the shadowing I pointed out earlier (on this topic)</p>



<a name="136274543"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2347184-user-given-type-annotations/near/136274543" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://rust-lang.github.io/zulip_archive/stream/122657-t-compiler/wg-nll/topic/.2347184-user-given-type-annotations.html#136274543">(Oct 22 2018 at 15:26)</a>:</h4>
<p>but in terms of the consts, there is some const code that was a bit over-active in terms of issuing errors because we now emitted the <code>ValidateUserTypeAscription</code> opcode...</p>



<a name="136274551"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2347184-user-given-type-annotations/near/136274551" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://rust-lang.github.io/zulip_archive/stream/122657-t-compiler/wg-nll/topic/.2347184-user-given-type-annotations.html#136274551">(Oct 22 2018 at 15:27)</a>:</h4>
<p>...I side-stepped that for the time being</p>



<a name="136274570"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2347184-user-given-type-annotations/near/136274570" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://rust-lang.github.io/zulip_archive/stream/122657-t-compiler/wg-nll/topic/.2347184-user-given-type-annotations.html#136274570">(Oct 22 2018 at 15:27)</a>:</h4>
<p>by not emitting those MIR statements for ascriptions like <code>x as usize</code></p>



<a name="136274579"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2347184-user-given-type-annotations/near/136274579" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://rust-lang.github.io/zulip_archive/stream/122657-t-compiler/wg-nll/topic/.2347184-user-given-type-annotations.html#136274579">(Oct 22 2018 at 15:27)</a>:</h4>
<p>since we don't need them anyway</p>



<a name="136274602"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2347184-user-given-type-annotations/near/136274602" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://rust-lang.github.io/zulip_archive/stream/122657-t-compiler/wg-nll/topic/.2347184-user-given-type-annotations.html#136274602">(Oct 22 2018 at 15:27)</a>:</h4>
<p>the const code should prob be fixed though</p>



<a name="136792258"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2347184-user-given-type-annotations/near/136792258" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://rust-lang.github.io/zulip_archive/stream/122657-t-compiler/wg-nll/topic/.2347184-user-given-type-annotations.html#136792258">(Oct 30 2018 at 17:26)</a>:</h4>
<p>so I was looking at breaking up <a href="https://github.com/rust-lang/rust/issues/47184" target="_blank" title="https://github.com/rust-lang/rust/issues/47184">#47184</a> into issues for the remaining problems</p>



<a name="136792266"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2347184-user-given-type-annotations/near/136792266" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://rust-lang.github.io/zulip_archive/stream/122657-t-compiler/wg-nll/topic/.2347184-user-given-type-annotations.html#136792266">(Oct 30 2018 at 17:26)</a>:</h4>
<p>we've really made good progress it seems</p>



<a name="136792284"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2347184-user-given-type-annotations/near/136792284" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://rust-lang.github.io/zulip_archive/stream/122657-t-compiler/wg-nll/topic/.2347184-user-given-type-annotations.html#136792284">(Oct 30 2018 at 17:27)</a>:</h4>
<p>I see a few remaining cases:</p>
<ul>
<li>ref bindings: e.g. <code>let ref x: u32 = 3;</code>, broken out into <a href="https://github.com/rust-lang/rust/issues/55401" target="_blank" title="https://github.com/rust-lang/rust/issues/55401">#55401</a></li>
<li>Associated constants in patterns: <code>&lt;T as Foo&gt;::BAR</code> ?</li>
<li>types are captured post normalization (<a href="https://github.com/rust-lang/rust/issues/54940" target="_blank" title="https://github.com/rust-lang/rust/issues/54940">#54940</a>)</li>
</ul>



<a name="136792313"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2347184-user-given-type-annotations/near/136792313" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://rust-lang.github.io/zulip_archive/stream/122657-t-compiler/wg-nll/topic/.2347184-user-given-type-annotations.html#136792313">(Oct 30 2018 at 17:27)</a>:</h4>
<p>I'm not sure about the associated constants in patterns case</p>



<a name="136792367"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2347184-user-given-type-annotations/near/136792367" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://rust-lang.github.io/zulip_archive/stream/122657-t-compiler/wg-nll/topic/.2347184-user-given-type-annotations.html#136792367">(Oct 30 2018 at 17:28)</a>:</h4>
<p>e.g., this does not error today:</p>
<div class="codehilite"><pre><span></span><span class="k">trait</span><span class="w"> </span><span class="n">Foo</span><span class="o">&lt;</span><span class="na">&#39;a</span><span class="o">&gt;</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="k">const</span><span class="w"> </span><span class="n">C</span>: <span class="kp">&amp;</span><span class="na">&#39;a</span><span class="w"> </span><span class="kt">u32</span><span class="p">;</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>

<span class="k">impl</span><span class="o">&lt;</span><span class="na">&#39;a</span><span class="p">,</span><span class="w"> </span><span class="n">T</span><span class="o">&gt;</span><span class="w"> </span><span class="n">Foo</span><span class="o">&lt;</span><span class="na">&#39;a</span><span class="o">&gt;</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="n">T</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="k">const</span><span class="w"> </span><span class="n">C</span>: <span class="kp">&amp;</span><span class="na">&#39;a</span><span class="w"> </span><span class="kt">u32</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">&amp;</span><span class="mi">22</span><span class="p">;</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>

<span class="k">fn</span> <span class="nf">foo</span><span class="p">()</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">22</span><span class="p">;</span><span class="w"></span>
<span class="w">    </span><span class="k">match</span><span class="w"> </span><span class="o">&amp;</span><span class="n">a</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">        </span><span class="o">&lt;</span><span class="p">()</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="n">Foo</span><span class="o">&lt;</span><span class="nb">&#39;static</span><span class="o">&gt;&gt;</span>::<span class="n">C</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="p">}</span><span class="w"></span>
<span class="w">        </span><span class="o">&amp;</span><span class="n">_</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="p">}</span><span class="w"></span>
<span class="w">    </span><span class="p">}</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>

<span class="k">fn</span> <span class="nf">main</span><span class="p">()</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>
</pre></div>



<a name="136792375"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2347184-user-given-type-annotations/near/136792375" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://rust-lang.github.io/zulip_archive/stream/122657-t-compiler/wg-nll/topic/.2347184-user-given-type-annotations.html#136792375">(Oct 30 2018 at 17:28)</a>:</h4>
<p>and it's not clear that it <em>should</em></p>



<a name="136792513"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2347184-user-given-type-annotations/near/136792513" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://rust-lang.github.io/zulip_archive/stream/122657-t-compiler/wg-nll/topic/.2347184-user-given-type-annotations.html#136792513">(Oct 30 2018 at 17:30)</a>:</h4>
<p>ah, but this <strong>does</strong> error today (using a <code>Cell</code> to force invariance)</p>
<div class="codehilite"><pre><span></span><span class="k">use</span><span class="w"> </span><span class="n">std</span>::<span class="n">cell</span>::<span class="n">Cell</span><span class="p">;</span><span class="w"></span>

<span class="k">trait</span><span class="w"> </span><span class="n">Foo</span><span class="o">&lt;</span><span class="na">&#39;a</span><span class="o">&gt;</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="k">const</span><span class="w"> </span><span class="n">C</span>: <span class="nb">Option</span><span class="o">&lt;</span><span class="n">Cell</span><span class="o">&lt;&amp;</span><span class="na">&#39;a</span><span class="w"> </span><span class="kt">u32</span><span class="o">&gt;&gt;</span><span class="p">;</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>

<span class="k">impl</span><span class="o">&lt;</span><span class="na">&#39;a</span><span class="p">,</span><span class="w"> </span><span class="n">T</span><span class="o">&gt;</span><span class="w"> </span><span class="n">Foo</span><span class="o">&lt;</span><span class="na">&#39;a</span><span class="o">&gt;</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="n">T</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="k">const</span><span class="w"> </span><span class="n">C</span>: <span class="nb">Option</span><span class="o">&lt;</span><span class="n">Cell</span><span class="o">&lt;&amp;</span><span class="na">&#39;a</span><span class="w"> </span><span class="kt">u32</span><span class="o">&gt;&gt;</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">None</span><span class="p">;</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>

<span class="k">fn</span> <span class="nf">foo</span><span class="p">()</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">22</span><span class="p">;</span><span class="w"></span>
<span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="n">b</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">Some</span><span class="p">(</span><span class="n">Cell</span>::<span class="n">new</span><span class="p">(</span><span class="o">&amp;</span><span class="n">a</span><span class="p">));</span><span class="w"></span>
<span class="w">    </span><span class="k">match</span><span class="w"> </span><span class="n">b</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">        </span><span class="o">&lt;</span><span class="p">()</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="n">Foo</span><span class="o">&lt;</span><span class="nb">&#39;static</span><span class="o">&gt;&gt;</span>::<span class="n">C</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="p">}</span><span class="w"></span>
<span class="w">        </span><span class="n">_</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="p">}</span><span class="w"></span>
<span class="w">    </span><span class="p">}</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>

<span class="k">fn</span> <span class="nf">main</span><span class="p">()</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>
</pre></div>



<a name="136793197"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2347184-user-given-type-annotations/near/136793197" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://rust-lang.github.io/zulip_archive/stream/122657-t-compiler/wg-nll/topic/.2347184-user-given-type-annotations.html#136793197">(Oct 30 2018 at 17:40)</a>:</h4>
<p><span class="user-mention" data-user-id="116083">@pnkfelix</span> I see you put <a href="https://github.com/rust-lang/rust/issues/55401" target="_blank" title="https://github.com/rust-lang/rust/issues/55401">https://github.com/rust-lang/rust/issues/55401</a> as NLL-deferred, you don't think it needs to be fixed for the release?</p>



<a name="136793251"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2347184-user-given-type-annotations/near/136793251" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://rust-lang.github.io/zulip_archive/stream/122657-t-compiler/wg-nll/topic/.2347184-user-given-type-annotations.html#136793251">(Oct 30 2018 at 17:41)</a>:</h4>
<p>I'm trying to think what would be an example of a program that (fails to) error as a result of <a href="https://github.com/rust-lang/rust/issues/55401" target="_blank" title="https://github.com/rust-lang/rust/issues/55401">#55401</a></p>



<a name="136795197"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2347184-user-given-type-annotations/near/136795197" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> pnkfelix <a href="https://rust-lang.github.io/zulip_archive/stream/122657-t-compiler/wg-nll/topic/.2347184-user-given-type-annotations.html#136795197">(Oct 30 2018 at 18:09)</a>:</h4>
<p>I think that’s part of why I deferred it ...</p>



<a name="136795258"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2347184-user-given-type-annotations/near/136795258" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> pnkfelix <a href="https://rust-lang.github.io/zulip_archive/stream/122657-t-compiler/wg-nll/topic/.2347184-user-given-type-annotations.html#136795258">(Oct 30 2018 at 18:10)</a>:</h4>
<p>But at this point we can promote it to release milestone</p>



<a name="136795295"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2347184-user-given-type-annotations/near/136795295" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://rust-lang.github.io/zulip_archive/stream/122657-t-compiler/wg-nll/topic/.2347184-user-given-type-annotations.html#136795295">(Oct 30 2018 at 18:10)</a>:</h4>
<p>I wasn't able yet to come up with a problem program</p>



<a name="136800902"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2347184-user-given-type-annotations/near/136800902" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> pnkfelix <a href="https://rust-lang.github.io/zulip_archive/stream/122657-t-compiler/wg-nll/topic/.2347184-user-given-type-annotations.html#136800902">(Oct 30 2018 at 19:31)</a>:</h4>
<p>hmm. this is worrisome. This code (<a href="https://play.rust-lang.org/?version=nightly&amp;mode=debug&amp;edition=2018&amp;gist=c9c5ca8bf871fcec58053dcc3dedb800" target="_blank" title="https://play.rust-lang.org/?version=nightly&amp;mode=debug&amp;edition=2018&amp;gist=c9c5ca8bf871fcec58053dcc3dedb800">playpen</a>) errors, but if I <em>uncomment</em> <code>#![feature(nll)]</code>, the compiler <strong>accepts</strong> it.</p>



<a name="136800912"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2347184-user-given-type-annotations/near/136800912" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> pnkfelix <a href="https://rust-lang.github.io/zulip_archive/stream/122657-t-compiler/wg-nll/topic/.2347184-user-given-type-annotations.html#136800912">(Oct 30 2018 at 19:31)</a>:</h4>
<p>better file a ticket</p>



<a name="136801016"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2347184-user-given-type-annotations/near/136801016" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://rust-lang.github.io/zulip_archive/stream/122657-t-compiler/wg-nll/topic/.2347184-user-given-type-annotations.html#136801016">(Oct 30 2018 at 19:33)</a>:</h4>
<p><span class="user-mention" data-user-id="116083">@pnkfelix</span> that code looks ok to me though</p>



<a name="136801020"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2347184-user-given-type-annotations/near/136801020" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://rust-lang.github.io/zulip_archive/stream/122657-t-compiler/wg-nll/topic/.2347184-user-given-type-annotations.html#136801020">(Oct 30 2018 at 19:33)</a>:</h4>
<p>I'm not sure why we reject it outside of NLL</p>



<a name="136801031"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2347184-user-given-type-annotations/near/136801031" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://rust-lang.github.io/zulip_archive/stream/122657-t-compiler/wg-nll/topic/.2347184-user-given-type-annotations.html#136801031">(Oct 30 2018 at 19:33)</a>:</h4>
<p>in particular I expect <code>&amp;22</code> to be promoted</p>



<a name="136801032"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2347184-user-given-type-annotations/near/136801032" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> pnkfelix <a href="https://rust-lang.github.io/zulip_archive/stream/122657-t-compiler/wg-nll/topic/.2347184-user-given-type-annotations.html#136801032">(Oct 30 2018 at 19:33)</a>:</h4>
<p>its the basis of one of the <a href="http://patterns.rs" target="_blank" title="http://patterns.rs">patterns.rs</a> tests</p>



<a name="136801044"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2347184-user-given-type-annotations/near/136801044" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> pnkfelix <a href="https://rust-lang.github.io/zulip_archive/stream/122657-t-compiler/wg-nll/topic/.2347184-user-given-type-annotations.html#136801044">(Oct 30 2018 at 19:33)</a>:</h4>
<p>the ascription of <code>y</code> to have type <code>&amp;'a _</code></p>



<a name="136801045"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2347184-user-given-type-annotations/near/136801045" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://rust-lang.github.io/zulip_archive/stream/122657-t-compiler/wg-nll/topic/.2347184-user-given-type-annotations.html#136801045">(Oct 30 2018 at 19:33)</a>:</h4>
<p>oh wait</p>



<a name="136801048"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2347184-user-given-type-annotations/near/136801048" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://rust-lang.github.io/zulip_archive/stream/122657-t-compiler/wg-nll/topic/.2347184-user-given-type-annotations.html#136801048">(Oct 30 2018 at 19:33)</a>:</h4>
<p>I see I see</p>



<a name="136801097"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2347184-user-given-type-annotations/near/136801097" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://rust-lang.github.io/zulip_archive/stream/122657-t-compiler/wg-nll/topic/.2347184-user-given-type-annotations.html#136801097">(Oct 30 2018 at 19:34)</a>:</h4>
<p>right, we should be pushing the <code>&amp;'a</code> <em>down</em> to <code>y</code></p>



<a name="136801101"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2347184-user-given-type-annotations/near/136801101" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> pnkfelix <a href="https://rust-lang.github.io/zulip_archive/stream/122657-t-compiler/wg-nll/topic/.2347184-user-given-type-annotations.html#136801101">(Oct 30 2018 at 19:34)</a>:</h4>
<p>yeah so something is goofy</p>



<a name="136801105"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2347184-user-given-type-annotations/near/136801105" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://rust-lang.github.io/zulip_archive/stream/122657-t-compiler/wg-nll/topic/.2347184-user-given-type-annotations.html#136801105">(Oct 30 2018 at 19:34)</a>:</h4>
<p>as a "lower bound" or "upper bound" or whichever</p>



<a name="136801106"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2347184-user-given-type-annotations/near/136801106" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> pnkfelix <a href="https://rust-lang.github.io/zulip_archive/stream/122657-t-compiler/wg-nll/topic/.2347184-user-given-type-annotations.html#136801106">(Oct 30 2018 at 19:34)</a>:</h4>
<p>I'll have to look at it later</p>



<a name="136801113"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2347184-user-given-type-annotations/near/136801113" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> pnkfelix <a href="https://rust-lang.github.io/zulip_archive/stream/122657-t-compiler/wg-nll/topic/.2347184-user-given-type-annotations.html#136801113">(Oct 30 2018 at 19:34)</a>:</h4>
<p>I'm assuming playpen is up to date</p>



<a name="136801117"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2347184-user-given-type-annotations/near/136801117" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> pnkfelix <a href="https://rust-lang.github.io/zulip_archive/stream/122657-t-compiler/wg-nll/topic/.2347184-user-given-type-annotations.html#136801117">(Oct 30 2018 at 19:34)</a>:</h4>
<p>mabye that's assumption is wrong</p>



<a name="136801141"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2347184-user-given-type-annotations/near/136801141" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> pnkfelix <a href="https://rust-lang.github.io/zulip_archive/stream/122657-t-compiler/wg-nll/topic/.2347184-user-given-type-annotations.html#136801141">(Oct 30 2018 at 19:35)</a>:</h4>
<p>oh no playpen is totally out of date, its from 10-25 or something</p>



<a name="136801152"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2347184-user-given-type-annotations/near/136801152" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> pnkfelix <a href="https://rust-lang.github.io/zulip_archive/stream/122657-t-compiler/wg-nll/topic/.2347184-user-given-type-annotations.html#136801152">(Oct 30 2018 at 19:35)</a>:</h4>
<p>so that was my mistake, using the playpen as the basis for a test</p>



<a name="136801163"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2347184-user-given-type-annotations/near/136801163" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://rust-lang.github.io/zulip_archive/stream/122657-t-compiler/wg-nll/topic/.2347184-user-given-type-annotations.html#136801163">(Oct 30 2018 at 19:35)</a>:</h4>
<p>ah :)</p>



<a name="136802947"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2347184-user-given-type-annotations/near/136802947" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> pnkfelix <a href="https://rust-lang.github.io/zulip_archive/stream/122657-t-compiler/wg-nll/topic/.2347184-user-given-type-annotations.html#136802947">(Oct 30 2018 at 20:04)</a>:</h4>
<p>I did find an example, I think.</p>



<a name="136802956"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2347184-user-given-type-annotations/near/136802956" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> pnkfelix <a href="https://rust-lang.github.io/zulip_archive/stream/122657-t-compiler/wg-nll/topic/.2347184-user-given-type-annotations.html#136802956">(Oct 30 2018 at 20:04)</a>:</h4>
<div class="codehilite"><pre><span></span><span class="k">fn</span> <span class="nf">static_to_a_to_static_through_ref_in_tuple</span><span class="o">&lt;</span><span class="na">&#39;a</span><span class="o">&gt;</span><span class="p">(</span><span class="n">x</span>: <span class="kp">&amp;</span><span class="na">&#39;a</span><span class="w"> </span><span class="kt">u32</span><span class="p">)</span><span class="w"> </span>-&gt; <span class="kp">&amp;</span><span class="nb">&#39;static</span><span class="w"> </span><span class="kt">u32</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="p">(</span><span class="k">ref</span><span class="w"> </span><span class="n">y</span><span class="p">,</span><span class="w"> </span><span class="n">_z</span><span class="p">)</span>: <span class="p">(</span><span class="o">&amp;</span><span class="na">&#39;a</span><span class="w"> </span><span class="kt">u32</span><span class="p">,</span><span class="w"> </span><span class="kt">u32</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="o">&amp;</span><span class="mi">22</span><span class="p">,</span><span class="w"> </span><span class="mi">44</span><span class="p">);</span><span class="w"></span>
<span class="w">    </span><span class="o">*</span><span class="n">y</span><span class="w"> </span><span class="c1">//~ ERROR</span>
<span class="p">}</span><span class="w"></span>
</pre></div>



<a name="136802976"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2347184-user-given-type-annotations/near/136802976" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> pnkfelix <a href="https://rust-lang.github.io/zulip_archive/stream/122657-t-compiler/wg-nll/topic/.2347184-user-given-type-annotations.html#136802976">(Oct 30 2018 at 20:04)</a>:</h4>
<p>I <em>think</em> that's supposed to error, but does not today under <code>-Z borrowck=mir</code></p>



<a name="136803031"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2347184-user-given-type-annotations/near/136803031" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://rust-lang.github.io/zulip_archive/stream/122657-t-compiler/wg-nll/topic/.2347184-user-given-type-annotations.html#136803031">(Oct 30 2018 at 20:05)</a>:</h4>
<p>I see</p>



<a name="136805623"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2347184-user-given-type-annotations/near/136805623" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jake Goulding <a href="https://rust-lang.github.io/zulip_archive/stream/122657-t-compiler/wg-nll/topic/.2347184-user-given-type-annotations.html#136805623">(Oct 30 2018 at 20:43)</a>:</h4>
<blockquote>
<p>oh no playpen is totally out of date,</p>
</blockquote>
<p>The play<em>ground</em> is out of date because nightly cannot compile hyper.</p>



<a name="136805685"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2347184-user-given-type-annotations/near/136805685" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jake Goulding <a href="https://rust-lang.github.io/zulip_archive/stream/122657-t-compiler/wg-nll/topic/.2347184-user-given-type-annotations.html#136805685">(Oct 30 2018 at 20:44)</a>:</h4>
<p><a href="https://github.com/rust-lang/rust/issues/55376" target="_blank" title="https://github.com/rust-lang/rust/issues/55376">https://github.com/rust-lang/rust/issues/55376</a></p>



<a name="136810063"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2347184-user-given-type-annotations/near/136810063" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> pnkfelix <a href="https://rust-lang.github.io/zulip_archive/stream/122657-t-compiler/wg-nll/topic/.2347184-user-given-type-annotations.html#136810063">(Oct 30 2018 at 21:58)</a>:</h4>
<p>okay well it sounds like that is now resolved, so hopefully things will start working again soon-ish...?</p>



<a name="136810648"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2347184-user-given-type-annotations/near/136810648" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jake Goulding <a href="https://rust-lang.github.io/zulip_archive/stream/122657-t-compiler/wg-nll/topic/.2347184-user-given-type-annotations.html#136810648">(Oct 30 2018 at 22:09)</a>:</h4>
<p>should - need to watch after today's nightly</p>



<hr><p>Last updated: Aug 07 2021 at 22:04 UTC</p>
</html>