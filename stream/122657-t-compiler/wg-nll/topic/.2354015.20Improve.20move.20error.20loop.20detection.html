<html>
<head><meta charset="utf-8"><title>#54015 Improve move error loop detection · t-compiler/wg-nll · Zulip Chat Archive</title></head>
<h2>Stream: <a href="https://rust-lang.github.io/zulip_archive/stream/122657-t-compiler/wg-nll/index.html">t-compiler/wg-nll</a></h2>
<h3>Topic: <a href="https://rust-lang.github.io/zulip_archive/stream/122657-t-compiler/wg-nll/topic/.2354015.20Improve.20move.20error.20loop.20detection.html">#54015 Improve move error loop detection</a></h3>

<hr>

<base href="https://rust-lang.zulipchat.com">

<head><link href="https://rust-lang.github.io/zulip_archive/style.css" rel="stylesheet"></head>

<a name="133789737"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2354015%20Improve%20move%20error%20loop%20detection/near/133789737" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://rust-lang.github.io/zulip_archive/stream/122657-t-compiler/wg-nll/topic/.2354015.20Improve.20move.20error.20loop.20detection.html#133789737">(Sep 12 2018 at 10:15)</a>:</h4>
<p>cc <span class="user-mention" data-user-id="128294">@blitzerr</span> let's chat here if needed...</p>



<a name="133793745"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2354015%20Improve%20move%20error%20loop%20detection/near/133793745" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> blitzerr <a href="https://rust-lang.github.io/zulip_archive/stream/122657-t-compiler/wg-nll/topic/.2354015.20Improve.20move.20error.20loop.20detection.html#133793745">(Sep 12 2018 at 11:51)</a>:</h4>
<p>Got it<span class="emoji emoji-1f44d" title="+1">:+1:</span></p>



<a name="133898869"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2354015%20Improve%20move%20error%20loop%20detection/near/133898869" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> blitzerr <a href="https://rust-lang.github.io/zulip_archive/stream/122657-t-compiler/wg-nll/topic/.2354015.20Improve.20move.20error.20loop.20detection.html#133898869">(Sep 13 2018 at 17:05)</a>:</h4>
<p><span class="user-mention" data-user-id="116009">@nikomatsakis</span>  <br>
I have a question related to the mentoring notes<br>
"This only works when you have something like (1) loop { drop(x); } -- here, the drop(x) from the previous loop iteration is conflicting with the drop(x) with the next iteration. But it doesn't work for a case like this:(2) loop { use(x); drop(x); }, which is what we have in this example."<br>
<a href="https://github.com/rust-lang/rust/issues/1" target="_blank" title="https://github.com/rust-lang/rust/issues/1">#1</a> is obvious but why is <a href="https://github.com/rust-lang/rust/issues/2" target="_blank" title="https://github.com/rust-lang/rust/issues/2">#2</a> not the same? I think in <a href="https://github.com/rust-lang/rust/issues/2" target="_blank" title="https://github.com/rust-lang/rust/issues/2">#2</a> as well in the second iteration of the loop, it is being used as well. But also in <a href="https://github.com/rust-lang/rust/issues/2" target="_blank" title="https://github.com/rust-lang/rust/issues/2">#2</a>, drop(x) is trying to borrow what use(x) already borrowed ? Is my understanding correct ?</p>



<a name="133899148"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2354015%20Improve%20move%20error%20loop%20detection/near/133899148" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://rust-lang.github.io/zulip_archive/stream/122657-t-compiler/wg-nll/topic/.2354015.20Improve.20move.20error.20loop.20detection.html#133899148">(Sep 13 2018 at 17:10)</a>:</h4>
<p><span class="user-mention" data-user-id="128294">@blitzerr</span> </p>
<p>So, in the second example:</p>
<div class="codehilite"><pre><span></span><span class="k">loop</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">  </span><span class="n">drop</span><span class="p">(</span><span class="n">x</span><span class="p">);</span><span class="w"> </span><span class="c1">// L1</span>
<span class="w">  </span><span class="n">drop</span><span class="p">(</span><span class="n">x</span><span class="p">);</span><span class="w"> </span><span class="c1">// L2</span>
<span class="p">}</span><span class="w"></span>
</pre></div>


<p>when we get to L1, we see that <code>x</code> is uninitialized on entry. So we walk backwards to find where the move came from. We go backwards around the loop and stop when we reach L2.</p>
<p>Now, the problem is that our "in previous iteration of the loop" message prints only if L1 == L2 (not true here)</p>



<a name="133899554"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2354015%20Improve%20move%20error%20loop%20detection/near/133899554" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> blitzerr <a href="https://rust-lang.github.io/zulip_archive/stream/122657-t-compiler/wg-nll/topic/.2354015.20Improve.20move.20error.20loop.20detection.html#133899554">(Sep 13 2018 at 17:18)</a>:</h4>
<p>I didn't think x was uninitialized. I just thought this is a code snippet and x can be initialized earlier. Also to be clear, drop is a normal function call and not the destructor ?</p>



<a name="133899560"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2354015%20Improve%20move%20error%20loop%20detection/near/133899560" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://rust-lang.github.io/zulip_archive/stream/122657-t-compiler/wg-nll/topic/.2354015.20Improve.20move.20error.20loop.20detection.html#133899560">(Sep 13 2018 at 17:18)</a>:</h4>
<p><code>drop</code> is just a normal function, yes</p>



<a name="133899562"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2354015%20Improve%20move%20error%20loop%20detection/near/133899562" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://rust-lang.github.io/zulip_archive/stream/122657-t-compiler/wg-nll/topic/.2354015.20Improve.20move.20error.20loop.20detection.html#133899562">(Sep 13 2018 at 17:18)</a>:</h4>
<p>presumably it was initialized somewhere outside the loop</p>



<a name="133899574"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2354015%20Improve%20move%20error%20loop%20detection/near/133899574" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://rust-lang.github.io/zulip_archive/stream/122657-t-compiler/wg-nll/topic/.2354015.20Improve.20move.20error.20loop.20detection.html#133899574">(Sep 13 2018 at 17:19)</a>:</h4>
<p>by <code>drop</code> I meant <a href="https://doc.rust-lang.org/std/mem/fn.drop.html" target="_blank" title="https://doc.rust-lang.org/std/mem/fn.drop.html"><code>std::mem::drop</code></a></p>



<a name="133899581"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2354015%20Improve%20move%20error%20loop%20detection/near/133899581" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://rust-lang.github.io/zulip_archive/stream/122657-t-compiler/wg-nll/topic/.2354015.20Improve.20move.20error.20loop.20detection.html#133899581">(Sep 13 2018 at 17:19)</a>:</h4>
<p>which is just <code>fn drop&lt;T&gt;(x: T) { }</code> :)</p>



<a name="133899595"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2354015%20Improve%20move%20error%20loop%20detection/near/133899595" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://rust-lang.github.io/zulip_archive/stream/122657-t-compiler/wg-nll/topic/.2354015.20Improve.20move.20error.20loop.20detection.html#133899595">(Sep 13 2018 at 17:19)</a>:</h4>
<p>so e.g. </p>
<div class="codehilite"><pre><span></span><span class="kd">let</span><span class="w"> </span><span class="n">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">vec</span><span class="o">!</span><span class="p">[];</span><span class="w"></span>
<span class="k">loop</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">  </span><span class="n">drop</span><span class="p">(</span><span class="n">x</span><span class="p">);</span><span class="w"> </span><span class="c1">// L1</span>
<span class="w">  </span><span class="n">drop</span><span class="p">(</span><span class="n">x</span><span class="p">);</span><span class="w"> </span><span class="c1">// L2</span>
<span class="p">}</span><span class="w"></span>
</pre></div>



<a name="133899600"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2354015%20Improve%20move%20error%20loop%20detection/near/133899600" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://rust-lang.github.io/zulip_archive/stream/122657-t-compiler/wg-nll/topic/.2354015.20Improve.20move.20error.20loop.20detection.html#133899600">(Sep 13 2018 at 17:19)</a>:</h4>
<p>now L1 is reachable via two paths</p>



<a name="133899602"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2354015%20Improve%20move%20error%20loop%20detection/near/133899602" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> blitzerr <a href="https://rust-lang.github.io/zulip_archive/stream/122657-t-compiler/wg-nll/topic/.2354015.20Improve.20move.20error.20loop.20detection.html#133899602">(Sep 13 2018 at 17:19)</a>:</h4>
<p>So in the new example that you just pasted because L1 and L2 are same, here "in the previous iteration of the loop" will be printed just fine as we want it to, right ?</p>



<a name="133899603"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2354015%20Improve%20move%20error%20loop%20detection/near/133899603" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://rust-lang.github.io/zulip_archive/stream/122657-t-compiler/wg-nll/topic/.2354015.20Improve.20move.20error.20loop.20detection.html#133899603">(Sep 13 2018 at 17:19)</a>:</h4>
<p>on one path (the first loop iteration) it is initialized</p>



<a name="133899606"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2354015%20Improve%20move%20error%20loop%20detection/near/133899606" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://rust-lang.github.io/zulip_archive/stream/122657-t-compiler/wg-nll/topic/.2354015.20Improve.20move.20error.20loop.20detection.html#133899606">(Sep 13 2018 at 17:19)</a>:</h4>
<p>but on the second one, it is not</p>



<a name="133899645"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2354015%20Improve%20move%20error%20loop%20detection/near/133899645" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://rust-lang.github.io/zulip_archive/stream/122657-t-compiler/wg-nll/topic/.2354015.20Improve.20move.20error.20loop.20detection.html#133899645">(Sep 13 2018 at 17:20)</a>:</h4>
<blockquote>
<p>So in the new example that you just pasted because L1 and L2 are same, here "in the previous iteration of the loop" will be printed just fine as we want it to, right ?</p>
</blockquote>
<p>no, it will not</p>



<a name="133899658"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2354015%20Improve%20move%20error%20loop%20detection/near/133899658" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://rust-lang.github.io/zulip_archive/stream/122657-t-compiler/wg-nll/topic/.2354015.20Improve.20move.20error.20loop.20detection.html#133899658">(Sep 13 2018 at 17:20)</a>:</h4>
<p>because L1 and L2 are <em>not</em> the same point in the program :)</p>



<a name="133899660"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2354015%20Improve%20move%20error%20loop%20detection/near/133899660" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://rust-lang.github.io/zulip_archive/stream/122657-t-compiler/wg-nll/topic/.2354015.20Improve.20move.20error.20loop.20detection.html#133899660">(Sep 13 2018 at 17:20)</a>:</h4>
<p>if you had</p>
<div class="codehilite"><pre><span></span><span class="k">loop</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">  </span><span class="n">drop</span><span class="p">(</span><span class="n">x</span><span class="p">);</span><span class="w"> </span><span class="c1">// L1</span>
<span class="p">}</span><span class="w"></span>
</pre></div>



<a name="133899667"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2354015%20Improve%20move%20error%20loop%20detection/near/133899667" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://rust-lang.github.io/zulip_archive/stream/122657-t-compiler/wg-nll/topic/.2354015.20Improve.20move.20error.20loop.20detection.html#133899667">(Sep 13 2018 at 17:20)</a>:</h4>
<p>then it would walk backwards from L1 and find L1 again</p>



<a name="133899698"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2354015%20Improve%20move%20error%20loop%20detection/near/133899698" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> blitzerr <a href="https://rust-lang.github.io/zulip_archive/stream/122657-t-compiler/wg-nll/topic/.2354015.20Improve.20move.20error.20loop.20detection.html#133899698">(Sep 13 2018 at 17:21)</a>:</h4>
<p>makes sense. Thank you so much.</p>



<a name="133899809"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2354015%20Improve%20move%20error%20loop%20detection/near/133899809" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> blitzerr <a href="https://rust-lang.github.io/zulip_archive/stream/122657-t-compiler/wg-nll/topic/.2354015.20Improve.20move.20error.20loop.20detection.html#133899809">(Sep 13 2018 at 17:23)</a>:</h4>
<p>One more trivial question and mostly because of ignorance. <br>
In the playground (<a href="https://play.rust-lang.org/?gist=1d1523cfeed2f9648f3de855eebb1c00&amp;version=nightly&amp;mode=debug&amp;edition=2015" target="_blank" title="https://play.rust-lang.org/?gist=1d1523cfeed2f9648f3de855eebb1c00&amp;version=nightly&amp;mode=debug&amp;edition=2015">https://play.rust-lang.org/?gist=1d1523cfeed2f9648f3de855eebb1c00&amp;version=nightly&amp;mode=debug&amp;edition=2015</a>)<br>
I find this line:<br>
let y: Box&lt;isize&gt; = box 42;</p>
<p>Box is widely discussed and there are docs on it but what is "box" the small case ?<br>
box 42  (Is that type casting in Rust) ?</p>



<a name="133899986"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2354015%20Improve%20move%20error%20loop%20detection/near/133899986" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://rust-lang.github.io/zulip_archive/stream/122657-t-compiler/wg-nll/topic/.2354015.20Improve.20move.20error.20loop.20detection.html#133899986">(Sep 13 2018 at 17:26)</a>:</h4>
<p>ah</p>



<a name="133899988"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2354015%20Improve%20move%20error%20loop%20detection/near/133899988" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://rust-lang.github.io/zulip_archive/stream/122657-t-compiler/wg-nll/topic/.2354015.20Improve.20move.20error.20loop.20detection.html#133899988">(Sep 13 2018 at 17:26)</a>:</h4>
<p>that's older syntax</p>



<a name="133899989"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2354015%20Improve%20move%20error%20loop%20detection/near/133899989" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://rust-lang.github.io/zulip_archive/stream/122657-t-compiler/wg-nll/topic/.2354015.20Improve.20move.20error.20loop.20detection.html#133899989">(Sep 13 2018 at 17:26)</a>:</h4>
<p>that is now behind a feature gate</p>



<a name="133899992"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2354015%20Improve%20move%20error%20loop%20detection/near/133899992" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://rust-lang.github.io/zulip_archive/stream/122657-t-compiler/wg-nll/topic/.2354015.20Improve.20move.20error.20loop.20detection.html#133899992">(Sep 13 2018 at 17:26)</a>:</h4>
<p>it is effectively synonymous with <code>Box::new(42)</code></p>



<a name="133899999"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2354015%20Improve%20move%20error%20loop%20detection/near/133899999" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://rust-lang.github.io/zulip_archive/stream/122657-t-compiler/wg-nll/topic/.2354015.20Improve.20move.20error.20loop.20detection.html#133899999">(Sep 13 2018 at 17:27)</a>:</h4>
<p>certainly for the purposes of this example, they are the same</p>



<a name="133900005"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2354015%20Improve%20move%20error%20loop%20detection/near/133900005" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://rust-lang.github.io/zulip_archive/stream/122657-t-compiler/wg-nll/topic/.2354015.20Improve.20move.20error.20loop.20detection.html#133900005">(Sep 13 2018 at 17:27)</a>:</h4>
<p>the test case dates from when <code>Box::new</code> was built into the language and used only via keyword</p>



<a name="133900012"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2354015%20Improve%20move%20error%20loop%20detection/near/133900012" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://rust-lang.github.io/zulip_archive/stream/122657-t-compiler/wg-nll/topic/.2354015.20Improve.20move.20error.20loop.20detection.html#133900012">(Sep 13 2018 at 17:27)</a>:</h4>
<p>we've kept the keyword around but never permitted it in Stable Rust</p>



<a name="133900023"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2354015%20Improve%20move%20error%20loop%20detection/near/133900023" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://rust-lang.github.io/zulip_archive/stream/122657-t-compiler/wg-nll/topic/.2354015.20Improve.20move.20error.20loop.20detection.html#133900023">(Sep 13 2018 at 17:27)</a>:</h4>
<p>because it can do some things more efficiently</p>



<a name="133900035"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2354015%20Improve%20move%20error%20loop%20detection/near/133900035" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://rust-lang.github.io/zulip_archive/stream/122657-t-compiler/wg-nll/topic/.2354015.20Improve.20move.20error.20loop.20detection.html#133900035">(Sep 13 2018 at 17:27)</a>:</h4>
<p>(and we wanted to maybe add it back later, once we settled on various details)</p>



<a name="133900079"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2354015%20Improve%20move%20error%20loop%20detection/near/133900079" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> blitzerr <a href="https://rust-lang.github.io/zulip_archive/stream/122657-t-compiler/wg-nll/topic/.2354015.20Improve.20move.20error.20loop.20detection.html#133900079">(Sep 13 2018 at 17:28)</a>:</h4>
<p>cool. Thank s a lot for explaining that.</p>



<a name="133900080"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2354015%20Improve%20move%20error%20loop%20detection/near/133900080" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://rust-lang.github.io/zulip_archive/stream/122657-t-compiler/wg-nll/topic/.2354015.20Improve.20move.20error.20loop.20detection.html#133900080">(Sep 13 2018 at 17:28)</a>:</h4>
<p>I would rewrite the test to use <code>Box::new</code></p>



<a name="133900090"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2354015%20Improve%20move%20error%20loop%20detection/near/133900090" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://rust-lang.github.io/zulip_archive/stream/122657-t-compiler/wg-nll/topic/.2354015.20Improve.20move.20error.20loop.20detection.html#133900090">(Sep 13 2018 at 17:28)</a>:</h4>
<p>always better to avoid feature gates in tests if we can</p>



<a name="133900096"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2354015%20Improve%20move%20error%20loop%20detection/near/133900096" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://rust-lang.github.io/zulip_archive/stream/122657-t-compiler/wg-nll/topic/.2354015.20Improve.20move.20error.20loop.20detection.html#133900096">(Sep 13 2018 at 17:28)</a>:</h4>
<p>so they don't bit rot if the feature is removed or changed</p>



<a name="133900111"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2354015%20Improve%20move%20error%20loop%20detection/near/133900111" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> blitzerr <a href="https://rust-lang.github.io/zulip_archive/stream/122657-t-compiler/wg-nll/topic/.2354015.20Improve.20move.20error.20loop.20detection.html#133900111">(Sep 13 2018 at 17:28)</a>:</h4>
<p>Benefits of asking the compiler writer directly, you get to the point answer :P</p>



<a name="133900114"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2354015%20Improve%20move%20error%20loop%20detection/near/133900114" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://rust-lang.github.io/zulip_archive/stream/122657-t-compiler/wg-nll/topic/.2354015.20Improve.20move.20error.20loop.20detection.html#133900114">(Sep 13 2018 at 17:28)</a>:</h4>
<p>feature gate being the <code>#![feature(xxx)]</code> syntax</p>



<a name="133900126"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2354015%20Improve%20move%20error%20loop%20detection/near/133900126" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> blitzerr <a href="https://rust-lang.github.io/zulip_archive/stream/122657-t-compiler/wg-nll/topic/.2354015.20Improve.20move.20error.20loop.20detection.html#133900126">(Sep 13 2018 at 17:29)</a>:</h4>
<p>That I guessed <span class="emoji emoji-1f642" title="slight smile">:slight_smile:</span></p>



<a name="133900232"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2354015%20Improve%20move%20error%20loop%20detection/near/133900232" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> blitzerr <a href="https://rust-lang.github.io/zulip_archive/stream/122657-t-compiler/wg-nll/topic/.2354015.20Improve.20move.20error.20loop.20detection.html#133900232">(Sep 13 2018 at 17:30)</a>:</h4>
<p>NLL is not available in stable release or is it ?</p>



<a name="133900252"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2354015%20Improve%20move%20error%20loop%20detection/near/133900252" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> blitzerr <a href="https://rust-lang.github.io/zulip_archive/stream/122657-t-compiler/wg-nll/topic/.2354015.20Improve.20move.20error.20loop.20detection.html#133900252">(Sep 13 2018 at 17:31)</a>:</h4>
<p>I think the feature is developed, right ?</p>



<a name="133900385"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2354015%20Improve%20move%20error%20loop%20detection/near/133900385" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://rust-lang.github.io/zulip_archive/stream/122657-t-compiler/wg-nll/topic/.2354015.20Improve.20move.20error.20loop.20detection.html#133900385">(Sep 13 2018 at 17:33)</a>:</h4>
<p>not stable yet</p>



<a name="133900388"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2354015%20Improve%20move%20error%20loop%20detection/near/133900388" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://rust-lang.github.io/zulip_archive/stream/122657-t-compiler/wg-nll/topic/.2354015.20Improve.20move.20error.20loop.20detection.html#133900388">(Sep 13 2018 at 17:33)</a>:</h4>
<p>you have to add <code>#![feature(nll)]</code></p>



<a name="133900676"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2354015%20Improve%20move%20error%20loop%20detection/near/133900676" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> blitzerr <a href="https://rust-lang.github.io/zulip_archive/stream/122657-t-compiler/wg-nll/topic/.2354015.20Improve.20move.20error.20loop.20detection.html#133900676">(Sep 13 2018 at 17:38)</a>:</h4>
<p>Also. When I make a change in the librustc-mir do I run ./x.py build ?</p>



<a name="133900689"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2354015%20Improve%20move%20error%20loop%20detection/near/133900689" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> blitzerr <a href="https://rust-lang.github.io/zulip_archive/stream/122657-t-compiler/wg-nll/topic/.2354015.20Improve.20move.20error.20loop.20detection.html#133900689">(Sep 13 2018 at 17:39)</a>:</h4>
<p>It takes several minutes even with the -i flag set</p>



<a name="133901253"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2354015%20Improve%20move%20error%20loop%20detection/near/133901253" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://rust-lang.github.io/zulip_archive/stream/122657-t-compiler/wg-nll/topic/.2354015.20Improve.20move.20error.20loop.20detection.html#133901253">(Sep 13 2018 at 17:49)</a>:</h4>
<p>you can, but it will be slow, yes</p>



<a name="133901266"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2354015%20Improve%20move%20error%20loop%20detection/near/133901266" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://rust-lang.github.io/zulip_archive/stream/122657-t-compiler/wg-nll/topic/.2354015.20Improve.20move.20error.20loop.20detection.html#133901266">(Sep 13 2018 at 17:49)</a>:</h4>
<p>I suggest <a href="https://rust-lang-nursery.github.io/rustc-guide/how-to-build-and-run.html#suggested-workflows-for-faster-builds-of-the-compiler" target="_blank" title="https://rust-lang-nursery.github.io/rustc-guide/how-to-build-and-run.html#suggested-workflows-for-faster-builds-of-the-compiler">the workflow described in rustc-guide</a></p>



<a name="133901275"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2354015%20Improve%20move%20error%20loop%20detection/near/133901275" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://rust-lang.github.io/zulip_archive/stream/122657-t-compiler/wg-nll/topic/.2354015.20Improve.20move.20error.20loop.20detection.html#133901275">(Sep 13 2018 at 17:49)</a>:</h4>
<p>specifically, the "Incremental builds with --keep-stage"</p>



<a name="133903945"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2354015%20Improve%20move%20error%20loop%20detection/near/133903945" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> blitzerr <a href="https://rust-lang.github.io/zulip_archive/stream/122657-t-compiler/wg-nll/topic/.2354015.20Improve.20move.20error.20loop.20detection.html#133903945">(Sep 13 2018 at 18:28)</a>:</h4>
<p>Thanks.</p>



<a name="133904029"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2354015%20Improve%20move%20error%20loop%20detection/near/133904029" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> blitzerr <a href="https://rust-lang.github.io/zulip_archive/stream/122657-t-compiler/wg-nll/topic/.2354015.20Improve.20move.20error.20loop.20detection.html#133904029">(Sep 13 2018 at 18:29)</a>:</h4>
<p>I am assuming there is no option of attaching a debugger and stepping through the code as the doc does not mention that in the debugging the compiler section ?</p>



<a name="133904135"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2354015%20Improve%20move%20error%20loop%20detection/near/133904135" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://rust-lang.github.io/zulip_archive/stream/122657-t-compiler/wg-nll/topic/.2354015.20Improve.20move.20error.20loop.20detection.html#133904135">(Sep 13 2018 at 18:31)</a>:</h4>
<p>sometimes it works</p>



<a name="133904141"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2354015%20Improve%20move%20error%20loop%20detection/near/133904141" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://rust-lang.github.io/zulip_archive/stream/122657-t-compiler/wg-nll/topic/.2354015.20Improve.20move.20error.20loop.20detection.html#133904141">(Sep 13 2018 at 18:31)</a>:</h4>
<p>but i've not had much luck with it</p>



<a name="133904149"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2354015%20Improve%20move%20error%20loop%20detection/near/133904149" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://rust-lang.github.io/zulip_archive/stream/122657-t-compiler/wg-nll/topic/.2354015.20Improve.20move.20error.20loop.20detection.html#133904149">(Sep 13 2018 at 18:31)</a>:</h4>
<p>debuginfo doesn't survive optimizations very well</p>



<a name="133904154"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2354015%20Improve%20move%20error%20loop%20detection/near/133904154" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://rust-lang.github.io/zulip_archive/stream/122657-t-compiler/wg-nll/topic/.2354015.20Improve.20move.20error.20loop.20detection.html#133904154">(Sep 13 2018 at 18:31)</a>:</h4>
<p>and if you don't optimize, rustc is unbearably slow</p>



<a name="133904898"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2354015%20Improve%20move%20error%20loop%20detection/near/133904898" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> blitzerr <a href="https://rust-lang.github.io/zulip_archive/stream/122657-t-compiler/wg-nll/topic/.2354015.20Improve.20move.20error.20loop.20detection.html#133904898">(Sep 13 2018 at 18:42)</a>:</h4>
<p>Sounds good. Thanks you</p>



<a name="133910135"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2354015%20Improve%20move%20error%20loop%20detection/near/133910135" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> pnkfelix <a href="https://rust-lang.github.io/zulip_archive/stream/122657-t-compiler/wg-nll/topic/.2354015.20Improve.20move.20error.20loop.20detection.html#133910135">(Sep 13 2018 at 20:09)</a>:</h4>
<p>On the subject of running <code>rustc</code> under a debugger: I used to do it more regularly, and still do it (in the form of an <code>rr</code> run) from time to time. But its mostly a tool for me to get into the middle of the control flow and analyze how we jump between procedures, not really for inspecting the data structures themselves.</p>



<a name="133910224"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2354015%20Improve%20move%20error%20loop%20detection/near/133910224" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> pnkfelix <a href="https://rust-lang.github.io/zulip_archive/stream/122657-t-compiler/wg-nll/topic/.2354015.20Improve.20move.20error.20loop.20detection.html#133910224">(Sep 13 2018 at 20:10)</a>:</h4>
<p>My advice for anyone who wants to try it is to use <code>rr</code>, and to be prepared to do things like use <code>stepi</code> instead of <code>step</code> in order to deal with the issues of code reorder by optimizations...</p>



<a name="133910938"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2354015%20Improve%20move%20error%20loop%20detection/near/133910938" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> blitzerr <a href="https://rust-lang.github.io/zulip_archive/stream/122657-t-compiler/wg-nll/topic/.2354015.20Improve.20move.20error.20loop.20detection.html#133910938">(Sep 13 2018 at 20:21)</a>:</h4>
<p>Thanks a lot <span class="user-mention" data-user-id="116083">@pnkfelix</span> . I will try that.</p>



<a name="133918316"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2354015%20Improve%20move%20error%20loop%20detection/near/133918316" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> blitzerr <a href="https://rust-lang.github.io/zulip_archive/stream/122657-t-compiler/wg-nll/topic/.2354015.20Improve.20move.20error.20loop.20detection.html#133918316">(Sep 13 2018 at 22:50)</a>:</h4>
<p>@pnkfelix rr looks to only work with linux and not macOs.</p>



<a name="133940201"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2354015%20Improve%20move%20error%20loop%20detection/near/133940201" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> pnkfelix <a href="https://rust-lang.github.io/zulip_archive/stream/122657-t-compiler/wg-nll/topic/.2354015.20Improve.20move.20error.20loop.20detection.html#133940201">(Sep 14 2018 at 08:56)</a>:</h4>
<p>oh, yeah, I forgot to mention that I have a Linux desktop that is basically dedicated to the purpose of running <code>rr</code>. (Well, that and its a faster box in general than my laptop)</p>



<a name="133965444"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2354015%20Improve%20move%20error%20loop%20detection/near/133965444" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> blitzerr <a href="https://rust-lang.github.io/zulip_archive/stream/122657-t-compiler/wg-nll/topic/.2354015.20Improve.20move.20error.20loop.20detection.html#133965444">(Sep 14 2018 at 16:54)</a>:</h4>
<p>makes sense. I will have to go with the old school print statements.  If rr works then gdb would work, no ?</p>



<a name="133968991"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2354015%20Improve%20move%20error%20loop%20detection/near/133968991" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://rust-lang.github.io/zulip_archive/stream/122657-t-compiler/wg-nll/topic/.2354015.20Improve.20move.20error.20loop.20detection.html#133968991">(Sep 14 2018 at 17:58)</a>:</h4>
<p><span class="user-mention" data-user-id="128294">@blitzerr</span> you know about the <code>debug!</code> macros?</p>



<a name="133969754"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2354015%20Improve%20move%20error%20loop%20detection/near/133969754" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> blitzerr <a href="https://rust-lang.github.io/zulip_archive/stream/122657-t-compiler/wg-nll/topic/.2354015.20Improve.20move.20error.20loop.20detection.html#133969754">(Sep 14 2018 at 18:09)</a>:</h4>
<p>Ya, to print logs for debug builds but are stripped off in the release build. Basically you are saying I can use it for print debugging. Is there more to it that I am not aware of ?</p>



<a name="133970163"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2354015%20Improve%20move%20error%20loop%20detection/near/133970163" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://rust-lang.github.io/zulip_archive/stream/122657-t-compiler/wg-nll/topic/.2354015.20Improve.20move.20error.20loop.20detection.html#133970163">(Sep 14 2018 at 18:16)</a>:</h4>
<p>I would advise you to <a href="https://rust-lang-nursery.github.io/rustc-guide/how-to-build-and-run.html#create-a-configtoml" target="_blank" title="https://rust-lang-nursery.github.io/rustc-guide/how-to-build-and-run.html#create-a-configtoml">create a config.toml like it describes in the rustc-guide</a></p>



<a name="133970169"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2354015%20Improve%20move%20error%20loop%20detection/near/133970169" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://rust-lang.github.io/zulip_archive/stream/122657-t-compiler/wg-nll/topic/.2354015.20Improve.20move.20error.20loop.20detection.html#133970169">(Sep 14 2018 at 18:16)</a>:</h4>
<p>in particular, one that includes <code>debug-assertions = true</code></p>



<a name="133970175"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2354015%20Improve%20move%20error%20loop%20detection/near/133970175" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://rust-lang.github.io/zulip_archive/stream/122657-t-compiler/wg-nll/topic/.2354015.20Improve.20move.20error.20loop.20detection.html#133970175">(Sep 14 2018 at 18:16)</a>:</h4>
<p>then you can use <code>debug!</code> to get logs</p>



<a name="133970182"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2354015%20Improve%20move%20error%20loop%20detection/near/133970182" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://rust-lang.github.io/zulip_archive/stream/122657-t-compiler/wg-nll/topic/.2354015.20Improve.20move.20error.20loop.20detection.html#133970182">(Sep 14 2018 at 18:16)</a>:</h4>
<p><a href="https://rust-lang-nursery.github.io/rustc-guide/compiler-debugging.html#getting-logging-output" target="_blank" title="https://rust-lang-nursery.github.io/rustc-guide/compiler-debugging.html#getting-logging-output">as described here</a></p>



<a name="133970187"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2354015%20Improve%20move%20error%20loop%20detection/near/133970187" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://rust-lang.github.io/zulip_archive/stream/122657-t-compiler/wg-nll/topic/.2354015.20Improve.20move.20error.20loop.20detection.html#133970187">(Sep 14 2018 at 18:16)</a>:</h4>
<p>(and/or add your own)</p>



<a name="133993927"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2354015%20Improve%20move%20error%20loop%20detection/near/133993927" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> blitzerr <a href="https://rust-lang.github.io/zulip_archive/stream/122657-t-compiler/wg-nll/topic/.2354015.20Improve.20move.20error.20loop.20detection.html#133993927">(Sep 15 2018 at 03:23)</a>:</h4>
<p>Sorry I missed this message as Zuip didn't notify.</p>



<a name="133993971"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2354015%20Improve%20move%20error%20loop%20detection/near/133993971" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> blitzerr <a href="https://rust-lang.github.io/zulip_archive/stream/122657-t-compiler/wg-nll/topic/.2354015.20Improve.20move.20error.20loop.20detection.html#133993971">(Sep 15 2018 at 03:24)</a>:</h4>
<p>I did make the changes as suggested in the rustc development guide.</p>



<a name="133993982"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2354015%20Improve%20move%20error%20loop%20detection/near/133993982" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> blitzerr <a href="https://rust-lang.github.io/zulip_archive/stream/122657-t-compiler/wg-nll/topic/.2354015.20Improve.20move.20error.20loop.20detection.html#133993982">(Sep 15 2018 at 03:25)</a>:</h4>
<p>Thanks for the RUST_LOG suggestion. I will use that</p>



<a name="134005882"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2354015%20Improve%20move%20error%20loop%20detection/near/134005882" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://rust-lang.github.io/zulip_archive/stream/122657-t-compiler/wg-nll/topic/.2354015.20Improve.20move.20error.20loop.20detection.html#134005882">(Sep 15 2018 at 10:13)</a>:</h4>
<p><span class="user-mention" data-user-id="128294">@blitzerr</span> I'll remember to mention you specifically in the future :)</p>



<a name="134029675"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2354015%20Improve%20move%20error%20loop%20detection/near/134029675" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> blitzerr <a href="https://rust-lang.github.io/zulip_archive/stream/122657-t-compiler/wg-nll/topic/.2354015.20Improve.20move.20error.20loop.20detection.html#134029675">(Sep 15 2018 at 23:16)</a>:</h4>
<p><span class="emoji emoji-1f642" title="slight smile">:slight_smile:</span></p>



<a name="134029676"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2354015%20Improve%20move%20error%20loop%20detection/near/134029676" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> blitzerr <a href="https://rust-lang.github.io/zulip_archive/stream/122657-t-compiler/wg-nll/topic/.2354015.20Improve.20move.20error.20loop.20detection.html#134029676">(Sep 15 2018 at 23:16)</a>:</h4>
<p>RUST_LOG=rustc::traits::error_reporting rustc +stage1 ./src/librustc_mir/borrow_check/error_reporting.rs</p>



<a name="134029722"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2354015%20Improve%20move%20error%20loop%20detection/near/134029722" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> blitzerr <a href="https://rust-lang.github.io/zulip_archive/stream/122657-t-compiler/wg-nll/topic/.2354015.20Improve.20move.20error.20loop.20detection.html#134029722">(Sep 15 2018 at 23:18)</a>:</h4>
<div class="codehilite"><pre><span></span>RUST_LOG=rustc::traits::error_reporting rustc +stage1 ./src/librustc_mir/borrow_check/error_reporting.rs
</pre></div>


<p>I did that to print the debug statements but it errors out</p>



<a name="134103655"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2354015%20Improve%20move%20error%20loop%20detection/near/134103655" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> blitzerr <a href="https://rust-lang.github.io/zulip_archive/stream/122657-t-compiler/wg-nll/topic/.2354015.20Improve.20move.20error.20loop.20detection.html#134103655">(Sep 17 2018 at 14:22)</a>:</h4>
<p><span class="user-mention" data-user-id="116009">@nikomatsakis</span>  what would be the correct format to enable debug! Output for the <a href="http://error_reporting.rs" target="_blank" title="http://error_reporting.rs">error_reporting.rs</a> module only ?</p>



<a name="134103699"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2354015%20Improve%20move%20error%20loop%20detection/near/134103699" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> davidtwco <a href="https://rust-lang.github.io/zulip_archive/stream/122657-t-compiler/wg-nll/topic/.2354015.20Improve.20move.20error.20loop.20detection.html#134103699">(Sep 17 2018 at 14:23)</a>:</h4>
<p><code>RUST_LOG=rustc_mir::borrow_check::error_reporting</code> (or similar with the correct path to that module if I've misremembered)</p>



<a name="134104103"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2354015%20Improve%20move%20error%20loop%20detection/near/134104103" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> blitzerr <a href="https://rust-lang.github.io/zulip_archive/stream/122657-t-compiler/wg-nll/topic/.2354015.20Improve.20move.20error.20loop.20detection.html#134104103">(Sep 17 2018 at 14:29)</a>:</h4>
<p>Thanks <span class="user-mention" data-user-id="116107">@davidtwco</span></p>



<a name="134106328"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2354015%20Improve%20move%20error%20loop%20detection/near/134106328" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://rust-lang.github.io/zulip_archive/stream/122657-t-compiler/wg-nll/topic/.2354015.20Improve.20move.20error.20loop.20detection.html#134106328">(Sep 17 2018 at 15:04)</a>:</h4>
<p>how goes <span class="user-mention" data-user-id="128294">@blitzerr</span> ?</p>



<a name="134114639"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2354015%20Improve%20move%20error%20loop%20detection/near/134114639" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> blitzerr <a href="https://rust-lang.github.io/zulip_archive/stream/122657-t-compiler/wg-nll/topic/.2354015.20Improve.20move.20error.20loop.20detection.html#134114639">(Sep 17 2018 at 17:26)</a>:</h4>
<p>Hi <span class="user-mention" data-user-id="116009">@nikomatsakis</span>  Its going well. I read through the code, made the changes suggested by you in the mentoring notes (and the cosmetic changes to go with it) except for the key piece<br>
'''<br>
   if span == move_span { //*is_back_edge { <br>
'''<br>
And I expected the test to still fail and it did but <em>not</em> with an error message I expected<br>
'''<br>
F<br>
failures:</p>
<p>---- [ui] ui/liveness/liveness-move-in-while.rs stdout ----<br>
diff of stderr:</p>
<p>1   error[E0382]: use of moved value: <code>y</code><br>
-     --&gt; $DIR/liveness-move-in-while.rs:17:24<br>
+     --&gt; $DIR/liveness-move-in-while.rs:15:24<br>
3      |<br>
4   LL |         println!("{}", y); //~ ERROR use of moved value: <code>y</code><br>
5      |                        ^ value used here after move</p>
<p>9      = note: move occurs because <code>y</code> has type <code>std::boxed::Box&lt;isize&gt;</code>, which does not implement the <code>Copy</code> trait<br>
10<br>
11  error[E0382]: use of moved value: <code>y</code><br>
-     --&gt; $DIR/liveness-move-in-while.rs:18:52<br>
+     --&gt; $DIR/liveness-move-in-while.rs:16:52<br>
13     |<br>
14  LL |         while true { while true { while true { x = y; x.clone(); } } }<br>
15     |                                                    ^ value moved here in previous iteration of loop<br>
'''</p>



<a name="134114736"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2354015%20Improve%20move%20error%20loop%20detection/near/134114736" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> blitzerr <a href="https://rust-lang.github.io/zulip_archive/stream/122657-t-compiler/wg-nll/topic/.2354015.20Improve.20move.20error.20loop.20detection.html#134114736">(Sep 17 2018 at 17:28)</a>:</h4>
<div class="codehilite"><pre><span></span>F
failures:

---- [ui] ui/liveness/liveness-move-in-while.rs stdout ----
diff of stderr:

1   error[E0382]: use of moved value: `y`
-     --&gt; $DIR/liveness-move-in-while.rs:17:24
+     --&gt; $DIR/liveness-move-in-while.rs:15:24
3      |
4   LL |         println!(&quot;{}&quot;, y); //~ ERROR use of moved value: `y`
5      |                        ^ value used here after move

9      = note: move occurs because `y` has type `std::boxed::Box&lt;isize&gt;`, which does not implement the `Copy` trait
10
11  error[E0382]: use of moved value: `y`
-     --&gt; $DIR/liveness-move-in-while.rs:18:52
+     --&gt; $DIR/liveness-move-in-while.rs:16:52
13     |
14  LL |         while true { while true { while true { x = y; x.clone(); } } }
15     |                                                    ^ value moved here in previous iteration of loop
</pre></div>



<a name="134114834"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2354015%20Improve%20move%20error%20loop%20detection/near/134114834" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> blitzerr <a href="https://rust-lang.github.io/zulip_archive/stream/122657-t-compiler/wg-nll/topic/.2354015.20Improve.20move.20error.20loop.20detection.html#134114834">(Sep 17 2018 at 17:30)</a>:</h4>
<p>So from this error, it looks like the test fails because of two line number mismatches (17 vs 15 and 18 vs 16) and not because of the lack of the text "previous iteration of loop"</p>



<a name="134114876"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2354015%20Improve%20move%20error%20loop%20detection/near/134114876" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://rust-lang.github.io/zulip_archive/stream/122657-t-compiler/wg-nll/topic/.2354015.20Improve.20move.20error.20loop.20detection.html#134114876">(Sep 17 2018 at 17:31)</a>:</h4>
<p>what is the test again? also, are you fully rebased?</p>



<a name="134114887"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2354015%20Improve%20move%20error%20loop%20detection/near/134114887" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://rust-lang.github.io/zulip_archive/stream/122657-t-compiler/wg-nll/topic/.2354015.20Improve.20move.20error.20loop.20detection.html#134114887">(Sep 17 2018 at 17:31)</a>:</h4>
<p>ok, I see...</p>



<a name="134114918"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2354015%20Improve%20move%20error%20loop%20detection/near/134114918" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://rust-lang.github.io/zulip_archive/stream/122657-t-compiler/wg-nll/topic/.2354015.20Improve.20move.20error.20loop.20detection.html#134114918">(Sep 17 2018 at 17:32)</a>:</h4>
<p><span class="user-mention" data-user-id="128294">@blitzerr</span> so I'm not really sure what your diff is, I guess :)</p>



<a name="134114946"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2354015%20Improve%20move%20error%20loop%20detection/near/134114946" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://rust-lang.github.io/zulip_archive/stream/122657-t-compiler/wg-nll/topic/.2354015.20Improve.20move.20error.20loop.20detection.html#134114946">(Sep 17 2018 at 17:32)</a>:</h4>
<p>however, the test has a stderr file that encodes our current output as the expected output</p>



<a name="134114954"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2354015%20Improve%20move%20error%20loop%20detection/near/134114954" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://rust-lang.github.io/zulip_archive/stream/122657-t-compiler/wg-nll/topic/.2354015.20Improve.20move.20error.20loop.20detection.html#134114954">(Sep 17 2018 at 17:32)</a>:</h4>
<p>so if you've not made the "real fix" yet (which I think you haven't) then I would expect the test to pass</p>



<a name="134114955"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2354015%20Improve%20move%20error%20loop%20detection/near/134114955" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> blitzerr <a href="https://rust-lang.github.io/zulip_archive/stream/122657-t-compiler/wg-nll/topic/.2354015.20Improve.20move.20error.20loop.20detection.html#134114955">(Sep 17 2018 at 17:32)</a>:</h4>
<p>The test is ui/liveness/liveness-move-in-while.rs</p>



<a name="134114962"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2354015%20Improve%20move%20error%20loop%20detection/near/134114962" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://rust-lang.github.io/zulip_archive/stream/122657-t-compiler/wg-nll/topic/.2354015.20Improve.20move.20error.20loop.20detection.html#134114962">(Sep 17 2018 at 17:32)</a>:</h4>
<p>presumably you edited it slightly, which is why it's failing at all</p>



<a name="134114981"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2354015%20Improve%20move%20error%20loop%20detection/near/134114981" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://rust-lang.github.io/zulip_archive/stream/122657-t-compiler/wg-nll/topic/.2354015.20Improve.20move.20error.20loop.20detection.html#134114981">(Sep 17 2018 at 17:33)</a>:</h4>
<p>but once you've made the real fix, it will start to fail for real (because the output changed in a more significant way)</p>



<a name="134114996"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2354015%20Improve%20move%20error%20loop%20detection/near/134114996" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://rust-lang.github.io/zulip_archive/stream/122657-t-compiler/wg-nll/topic/.2354015.20Improve.20move.20error.20loop.20detection.html#134114996">(Sep 17 2018 at 17:33)</a>:</h4>
<p>you can run <code>./x.py test</code> with <code>--bless</code> to update the "expected output" file based on the current output (I always do, personally)</p>



<a name="134115000"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2354015%20Improve%20move%20error%20loop%20detection/near/134115000" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://rust-lang.github.io/zulip_archive/stream/122657-t-compiler/wg-nll/topic/.2354015.20Improve.20move.20error.20loop.20detection.html#134115000">(Sep 17 2018 at 17:33)</a>:</h4>
<p>then you can just look at <code>git status</code> to see what changed...</p>



<a name="134115009"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2354015%20Improve%20move%20error%20loop%20detection/near/134115009" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://rust-lang.github.io/zulip_archive/stream/122657-t-compiler/wg-nll/topic/.2354015.20Improve.20move.20error.20loop.20detection.html#134115009">(Sep 17 2018 at 17:33)</a>:</h4>
<p>(and look for anything unexpected)</p>



<a name="134115406"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2354015%20Improve%20move%20error%20loop%20detection/near/134115406" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> blitzerr <a href="https://rust-lang.github.io/zulip_archive/stream/122657-t-compiler/wg-nll/topic/.2354015.20Improve.20move.20error.20loop.20detection.html#134115406">(Sep 17 2018 at 17:40)</a>:</h4>
<p>I understand the cause of the line number change / mismatch in the error message but my question is this:<br>
This change is to add this error message :</p>
<div class="codehilite"><pre><span></span>value moved here in previous iteration of loop
</pre></div>


<p>But it looks like that line already exists. So, I am assuming that I need to enable nll and then this test will fail ?</p>



<a name="134115447"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2354015%20Improve%20move%20error%20loop%20detection/near/134115447" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> blitzerr <a href="https://rust-lang.github.io/zulip_archive/stream/122657-t-compiler/wg-nll/topic/.2354015.20Improve.20move.20error.20loop.20detection.html#134115447">(Sep 17 2018 at 17:41)</a>:</h4>
<p>Because the whole point of the change is that it was not printing <br>
<code>previous iteration of loop</code>, right <span class="user-mention" data-user-id="116009">@nikomatsakis</span></p>



<a name="134115528"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2354015%20Improve%20move%20error%20loop%20detection/near/134115528" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://rust-lang.github.io/zulip_archive/stream/122657-t-compiler/wg-nll/topic/.2354015.20Improve.20move.20error.20loop.20detection.html#134115528">(Sep 17 2018 at 17:42)</a>:</h4>
<p><span class="user-mention" data-user-id="128294">@blitzerr</span> it only exists on the second error, not the first</p>



<a name="134115540"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2354015%20Improve%20move%20error%20loop%20detection/near/134115540" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://rust-lang.github.io/zulip_archive/stream/122657-t-compiler/wg-nll/topic/.2354015.20Improve.20move.20error.20loop.20detection.html#134115540">(Sep 17 2018 at 17:43)</a>:</h4>
<p>moreover, there is another change from <span class="user-mention" data-user-id="116107">@davidtwco</span> (which I guess hasn't landed yet) which will suppress the second error as a duplicate</p>



<a name="134115566"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2354015%20Improve%20move%20error%20loop%20detection/near/134115566" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://rust-lang.github.io/zulip_archive/stream/122657-t-compiler/wg-nll/topic/.2354015.20Improve.20move.20error.20loop.20detection.html#134115566">(Sep 17 2018 at 17:43)</a>:</h4>
<p><a href="https://github.com/rust-lang/rust/pull/53995" target="_blank" title="https://github.com/rust-lang/rust/pull/53995">https://github.com/rust-lang/rust/pull/53995</a></p>



<a name="134115568"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2354015%20Improve%20move%20error%20loop%20detection/near/134115568" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> blitzerr <a href="https://rust-lang.github.io/zulip_archive/stream/122657-t-compiler/wg-nll/topic/.2354015.20Improve.20move.20error.20loop.20detection.html#134115568">(Sep 17 2018 at 17:43)</a>:</h4>
<p>2.</p>
<div class="codehilite"><pre><span></span>RUST_LOG=rustc_mir::borrow_check::error_reporting rustc +stage1 ./src/librustc_mir/borrow_check/error_reporting.rs
</pre></div>


<p>gives me errors like this</p>
<div class="codehilite"><pre><span></span>error[E0433]: failed to resolve. There are too many initial `super`s.
   --&gt; ./src/librustc_mir/borrow_check/error_reporting.rs:716:5
    |
716 | pub(super) struct IncludingDowncast(bool);
    |     ^^^^^ There are too many initial `super`s.

error[E0433]: failed to resolve. There are too many initial `super`s.
   --&gt; ./src/librustc_mir/borrow_check/error_reporting.rs:993:5
    |
993 | pub(super) enum UseSpans {
    |     ^^^^^ There are too many initial `super`s.
</pre></div>



<a name="134115641"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2354015%20Improve%20move%20error%20loop%20detection/near/134115641" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> blitzerr <a href="https://rust-lang.github.io/zulip_archive/stream/122657-t-compiler/wg-nll/topic/.2354015.20Improve.20move.20error.20loop.20detection.html#134115641">(Sep 17 2018 at 17:44)</a>:</h4>
<p><a href="https://github.com/rust-lang/rust/issues/2" target="_blank" title="https://github.com/rust-lang/rust/issues/2">#2</a> is a different issue, but I wanted to put it there before I go away from my laptop. <span class="emoji emoji-1f642" title="slight smile">:slight_smile:</span></p>



<a name="134115650"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2354015%20Improve%20move%20error%20loop%20detection/near/134115650" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> blitzerr <a href="https://rust-lang.github.io/zulip_archive/stream/122657-t-compiler/wg-nll/topic/.2354015.20Improve.20move.20error.20loop.20detection.html#134115650">(Sep 17 2018 at 17:44)</a>:</h4>
<p>back to <a href="https://github.com/rust-lang/rust/issues/1" target="_blank" title="https://github.com/rust-lang/rust/issues/1">#1</a>, the test.</p>



<a name="134115796"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2354015%20Improve%20move%20error%20loop%20detection/near/134115796" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://rust-lang.github.io/zulip_archive/stream/122657-t-compiler/wg-nll/topic/.2354015.20Improve.20move.20error.20loop.20detection.html#134115796">(Sep 17 2018 at 17:47)</a>:</h4>
<p>that's a wacky error. I think the syntax is <code>pub(in super)</code></p>



<a name="134115851"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2354015%20Improve%20move%20error%20loop%20detection/near/134115851" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> davidtwco <a href="https://rust-lang.github.io/zulip_archive/stream/122657-t-compiler/wg-nll/topic/.2354015.20Improve.20move.20error.20loop.20detection.html#134115851">(Sep 17 2018 at 17:48)</a>:</h4>
<p>(pretty sure <code>pub(super)</code> is valid)</p>



<a name="134115867"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2354015%20Improve%20move%20error%20loop%20detection/near/134115867" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://rust-lang.github.io/zulip_archive/stream/122657-t-compiler/wg-nll/topic/.2354015.20Improve.20move.20error.20loop.20detection.html#134115867">(Sep 17 2018 at 17:48)</a>:</h4>
<p>I don't think so</p>



<a name="134115869"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2354015%20Improve%20move%20error%20loop%20detection/near/134115869" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://rust-lang.github.io/zulip_archive/stream/122657-t-compiler/wg-nll/topic/.2354015.20Improve.20move.20error.20loop.20detection.html#134115869">(Sep 17 2018 at 17:48)</a>:</h4>
<p>but maybe</p>



<a name="134115872"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2354015%20Improve%20move%20error%20loop%20detection/near/134115872" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://rust-lang.github.io/zulip_archive/stream/122657-t-compiler/wg-nll/topic/.2354015.20Improve.20move.20error.20loop.20detection.html#134115872">(Sep 17 2018 at 17:48)</a>:</h4>
<p>can't recall</p>



<a name="134115881"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2354015%20Improve%20move%20error%20loop%20detection/near/134115881" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> blitzerr <a href="https://rust-lang.github.io/zulip_archive/stream/122657-t-compiler/wg-nll/topic/.2354015.20Improve.20move.20error.20loop.20detection.html#134115881">(Sep 17 2018 at 17:49)</a>:</h4>
<div class="codehilite"><pre><span></span>error[E0382]: borrow of moved value: `y`
 --&gt; src/main.rs:8:24
  |
8 |         println!(&quot;{}&quot;, y); //~ ERROR use of moved value: `y`
  |                        ^ value borrowed here after move
9 |         while true { while true { while true { x = y; x.clone(); } } }
  |                                                    - value moved here
  |
  = note: move occurs because `y` has type `std::boxed::Box&lt;isize&gt;`, which does not implement the `Copy` trait

we would rather add &quot;in previous iteration of loop&quot; to the &quot;value moved here&quot; message:

9 |         while true { while true { while true { x = y; x.clone(); } } }
  |                                                    - value moved here, in previous iteration of loop
</pre></div>


<p>That's  from the mentoring notes. I thought that we wanted the "in previous iteration of loop" only in the second case ? Did I misinterpret it ?</p>



<a name="134115887"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2354015%20Improve%20move%20error%20loop%20detection/near/134115887" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://rust-lang.github.io/zulip_archive/stream/122657-t-compiler/wg-nll/topic/.2354015.20Improve.20move.20error.20loop.20detection.html#134115887">(Sep 17 2018 at 17:49)</a>:</h4>
<p>I take it back, a quick ripgrep suggests it is :)</p>



<a name="134115914"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2354015%20Improve%20move%20error%20loop%20detection/near/134115914" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://rust-lang.github.io/zulip_archive/stream/122657-t-compiler/wg-nll/topic/.2354015.20Improve.20move.20error.20loop.20detection.html#134115914">(Sep 17 2018 at 17:49)</a>:</h4>
<p>this is the full error I get:</p>
<div class="codehilite"><pre><span></span>error[E0382]: use of moved value: `y`
 --&gt; src/main.rs:7:24
  |
7 |         println!(&quot;{}&quot;, y); //~ ERROR use of moved value: `y`
  |                        ^ value used here after move
8 |         while true { while true { while true { x = y; x.clone(); } } }
  |                                                    - value moved here
  |
  = note: move occurs because `y` has type `std::boxed::Box&lt;isize&gt;`, which does not implement the `Copy` trait

error[E0382]: use of moved value: `y`
 --&gt; src/main.rs:8:52
  |
8 |         while true { while true { while true { x = y; x.clone(); } } }
  |                                                    ^ value moved here in previous iteration of loop
  |
  = note: move occurs because `y` has type `std::boxed::Box&lt;isize&gt;`, which does not implement the `Copy` trait
</pre></div>



<a name="134115917"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2354015%20Improve%20move%20error%20loop%20detection/near/134115917" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://rust-lang.github.io/zulip_archive/stream/122657-t-compiler/wg-nll/topic/.2354015.20Improve.20move.20error.20loop.20detection.html#134115917">(Sep 17 2018 at 17:49)</a>:</h4>
<p>the second error looks right</p>



<a name="134115958"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2354015%20Improve%20move%20error%20loop%20detection/near/134115958" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://rust-lang.github.io/zulip_archive/stream/122657-t-compiler/wg-nll/topic/.2354015.20Improve.20move.20error.20loop.20detection.html#134115958">(Sep 17 2018 at 17:50)</a>:</h4>
<p>but I think the first error is not</p>



<a name="134115959"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2354015%20Improve%20move%20error%20loop%20detection/near/134115959" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://rust-lang.github.io/zulip_archive/stream/122657-t-compiler/wg-nll/topic/.2354015.20Improve.20move.20error.20loop.20detection.html#134115959">(Sep 17 2018 at 17:50)</a>:</h4>
<p>I would expect:</p>



<a name="134115975"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2354015%20Improve%20move%20error%20loop%20detection/near/134115975" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://rust-lang.github.io/zulip_archive/stream/122657-t-compiler/wg-nll/topic/.2354015.20Improve.20move.20error.20loop.20detection.html#134115975">(Sep 17 2018 at 17:50)</a>:</h4>
<div class="codehilite"><pre><span></span>error[E0382]: use of moved value: `y`
 --&gt; src/main.rs:7:24
  |
7 |         println!(&quot;{}&quot;, y); //~ ERROR use of moved value: `y`
  |                        ^ value used here after move
8 |         while true { while true { while true { x = y; x.clone(); } } }
  |                                                    - value moved here in previous iteration of loop
  |
  = note: move occurs because `y` has type `std::boxed::Box&lt;isize&gt;`, which does not implement the `Copy` trait

error[E0382]: use of moved value: `y`
 --&gt; src/main.rs:8:52
  |
8 |         while true { while true { while true { x = y; x.clone(); } } }
  |                                                    ^ value moved here in previous iteration of loop
  |
  = note: move occurs because `y` has type `std::boxed::Box&lt;isize&gt;`, which does not implement the `Copy` trait
</pre></div>



<a name="134115990"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2354015%20Improve%20move%20error%20loop%20detection/near/134115990" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://rust-lang.github.io/zulip_archive/stream/122657-t-compiler/wg-nll/topic/.2354015.20Improve.20move.20error.20loop.20detection.html#134115990">(Sep 17 2018 at 17:50)</a>:</h4>
<p>though really I want there to be a comma too, but that's a grammatical nit :P</p>



<a name="134115995"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2354015%20Improve%20move%20error%20loop%20detection/near/134115995" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://rust-lang.github.io/zulip_archive/stream/122657-t-compiler/wg-nll/topic/.2354015.20Improve.20move.20error.20loop.20detection.html#134115995">(Sep 17 2018 at 17:50)</a>:</h4>
<p>"value moved here, in previous iteration of loop"</p>



<a name="134116032"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2354015%20Improve%20move%20error%20loop%20detection/near/134116032" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> blitzerr <a href="https://rust-lang.github.io/zulip_archive/stream/122657-t-compiler/wg-nll/topic/.2354015.20Improve.20move.20error.20loop.20detection.html#134116032">(Sep 17 2018 at 17:51)</a>:</h4>
<p>A comma, that's too much :P</p>



<a name="134116153"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2354015%20Improve%20move%20error%20loop%20detection/near/134116153" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://rust-lang.github.io/zulip_archive/stream/122657-t-compiler/wg-nll/topic/.2354015.20Improve.20move.20error.20loop.20detection.html#134116153">(Sep 17 2018 at 17:53)</a>:</h4>
<p>(I feel like this is a parenthetical clause, hence the comma)</p>



<a name="134116550"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2354015%20Improve%20move%20error%20loop%20detection/near/134116550" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> blitzerr <a href="https://rust-lang.github.io/zulip_archive/stream/122657-t-compiler/wg-nll/topic/.2354015.20Improve.20move.20error.20loop.20detection.html#134116550">(Sep 17 2018 at 17:59)</a>:</h4>
<p>I was not debating the introduction of a comma. It was meant to be a joke <span class="emoji emoji-1f603" title="smiley">:smiley:</span></p>



<a name="134118312"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2354015%20Improve%20move%20error%20loop%20detection/near/134118312" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> blitzerr <a href="https://rust-lang.github.io/zulip_archive/stream/122657-t-compiler/wg-nll/topic/.2354015.20Improve.20move.20error.20loop.20detection.html#134118312">(Sep 17 2018 at 18:28)</a>:</h4>
<p><span class="user-mention" data-user-id="116009">@nikomatsakis</span> what is the correct format to enable rust_log for the <a href="http://error_reporting.rs" target="_blank" title="http://error_reporting.rs">error_reporting.rs</a></p>



<a name="134119247"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2354015%20Improve%20move%20error%20loop%20detection/near/134119247" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://rust-lang.github.io/zulip_archive/stream/122657-t-compiler/wg-nll/topic/.2354015.20Improve.20move.20error.20loop.20detection.html#134119247">(Sep 17 2018 at 18:43)</a>:</h4>
<p><span class="user-mention" data-user-id="128294">@blitzerr</span> <code>RUST_LOG=crate::module::module</code> is the general format</p>



<a name="134119259"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2354015%20Improve%20move%20error%20loop%20detection/near/134119259" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://rust-lang.github.io/zulip_archive/stream/122657-t-compiler/wg-nll/topic/.2354015.20Improve.20move.20error.20loop.20detection.html#134119259">(Sep 17 2018 at 18:43)</a>:</h4>
<p>you can use a comma separated list</p>



<a name="134119878"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2354015%20Improve%20move%20error%20loop%20detection/near/134119878" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> blitzerr <a href="https://rust-lang.github.io/zulip_archive/stream/122657-t-compiler/wg-nll/topic/.2354015.20Improve.20move.20error.20loop.20detection.html#134119878">(Sep 17 2018 at 18:53)</a>:</h4>
<p><code>RUST_LOG=rustc_mir::borrow_check::error_reporting rustc +stage1 ./src/librustc_mir/borrow_check/error_reporting.rs</code><br>
this should be just </p>
<div class="codehilite"><pre><span></span>RUST_LOG=rustc_mir::borrow_check::error_reporting rustc +stage1 ./src/librustc_mir/borrow_check/error_reporting.rs
``` ?
</pre></div>



<a name="134119979"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2354015%20Improve%20move%20error%20loop%20detection/near/134119979" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> blitzerr <a href="https://rust-lang.github.io/zulip_archive/stream/122657-t-compiler/wg-nll/topic/.2354015.20Improve.20move.20error.20loop.20detection.html#134119979">(Sep 17 2018 at 18:55)</a>:</h4>
<p>I meant should be just:</p>
<div class="codehilite"><pre><span></span>RUST_LOG=rustc_mir::borrow_check::error_reporting
</pre></div>


<p>?</p>



<a name="134119997"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2354015%20Improve%20move%20error%20loop%20detection/near/134119997" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> lqd <a href="https://rust-lang.github.io/zulip_archive/stream/122657-t-compiler/wg-nll/topic/.2354015.20Improve.20move.20error.20loop.20detection.html#134119997">(Sep 17 2018 at 18:55)</a>:</h4>
<p>the log looks correct, but you'll be seeing what is logged when you compile your test case, that is, probably <a href="http://liveness-move-in-while.rs" target="_blank" title="http://liveness-move-in-while.rs">liveness-move-in-while.rs</a> ? (rather than compiling <code>./src/librustc_mir/borrow_check/error_reporting.rs</code>)</p>



<a name="134120052"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2354015%20Improve%20move%20error%20loop%20detection/near/134120052" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> davidtwco <a href="https://rust-lang.github.io/zulip_archive/stream/122657-t-compiler/wg-nll/topic/.2354015.20Improve.20move.20error.20loop.20detection.html#134120052">(Sep 17 2018 at 18:56)</a>:</h4>
<p>Did you compile with the <code>config.toml</code> set to enable debug assertions and logging? If you're not seeing anything then it could be that.</p>



<a name="134120062"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2354015%20Improve%20move%20error%20loop%20detection/near/134120062" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> blitzerr <a href="https://rust-lang.github.io/zulip_archive/stream/122657-t-compiler/wg-nll/topic/.2354015.20Improve.20move.20error.20loop.20detection.html#134120062">(Sep 17 2018 at 18:56)</a>:</h4>
<p>So those error messages are normal ?</p>



<a name="134120078"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2354015%20Improve%20move%20error%20loop%20detection/near/134120078" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> lqd <a href="https://rust-lang.github.io/zulip_archive/stream/122657-t-compiler/wg-nll/topic/.2354015.20Improve.20move.20error.20loop.20detection.html#134120078">(Sep 17 2018 at 18:57)</a>:</h4>
<p>which error messages ?</p>



<a name="134120083"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2354015%20Improve%20move%20error%20loop%20detection/near/134120083" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> blitzerr <a href="https://rust-lang.github.io/zulip_archive/stream/122657-t-compiler/wg-nll/topic/.2354015.20Improve.20move.20error.20loop.20detection.html#134120083">(Sep 17 2018 at 18:57)</a>:</h4>
<p><span class="user-mention" data-user-id="116107">@davidtwco</span>  I have those settings ON in config.toml</p>



<a name="134120088"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2354015%20Improve%20move%20error%20loop%20detection/near/134120088" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> davidtwco <a href="https://rust-lang.github.io/zulip_archive/stream/122657-t-compiler/wg-nll/topic/.2354015.20Improve.20move.20error.20loop.20detection.html#134120088">(Sep 17 2018 at 18:57)</a>:</h4>
<p>That depends on the error messages.</p>



<a name="134120167"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2354015%20Improve%20move%20error%20loop%20detection/near/134120167" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> blitzerr <a href="https://rust-lang.github.io/zulip_archive/stream/122657-t-compiler/wg-nll/topic/.2354015.20Improve.20move.20error.20loop.20detection.html#134120167">(Sep 17 2018 at 18:58)</a>:</h4>
<p><span class="user-mention" data-user-id="116113">@lqd</span> </p>
<div class="codehilite"><pre><span></span>error[E0433]: failed to resolve. There are too many initial `super`s.
   --&gt; ./src/librustc_mir/borrow_check/error_reporting.rs:716:5
    |
716 | pub(super) struct IncludingDowncast(bool);
    |     ^^^^^ There are too many initial `super`s.

error[E0433]: failed to resolve. There are too many initial `super`s.
   --&gt; ./src/librustc_mir/borrow_check/error_reporting.rs:993:5
    |
993 | pub(super) enum UseSpans {
    |     ^^^^^ There are too many initial `super`s.
</pre></div>



<a name="134120182"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2354015%20Improve%20move%20error%20loop%20detection/near/134120182" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> lqd <a href="https://rust-lang.github.io/zulip_archive/stream/122657-t-compiler/wg-nll/topic/.2354015.20Improve.20move.20error.20loop.20detection.html#134120182">(Sep 17 2018 at 18:58)</a>:</h4>
<p><span class="user-mention" data-user-id="128294">@blitzerr</span> why are you compiling this file btw ?</p>



<a name="134120183"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2354015%20Improve%20move%20error%20loop%20detection/near/134120183" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> blitzerr <a href="https://rust-lang.github.io/zulip_archive/stream/122657-t-compiler/wg-nll/topic/.2354015.20Improve.20move.20error.20loop.20detection.html#134120183">(Sep 17 2018 at 18:58)</a>:</h4>
<p>There are many like those, I just copied some</p>



<a name="134120197"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2354015%20Improve%20move%20error%20loop%20detection/near/134120197" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> lqd <a href="https://rust-lang.github.io/zulip_archive/stream/122657-t-compiler/wg-nll/topic/.2354015.20Improve.20move.20error.20loop.20detection.html#134120197">(Sep 17 2018 at 18:59)</a>:</h4>
<p>try <code>RUST_LOG=rustc_mir::borrow_check::error_reporting rustc +stage1 ./src/test/ui/liveness/liveness-move-in-while.rs</code></p>



<a name="134120200"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2354015%20Improve%20move%20error%20loop%20detection/near/134120200" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> davidtwco <a href="https://rust-lang.github.io/zulip_archive/stream/122657-t-compiler/wg-nll/topic/.2354015.20Improve.20move.20error.20loop.20detection.html#134120200">(Sep 17 2018 at 18:59)</a>:</h4>
<p>Ah, yeah, so the issue is that you're compiling one of the compiler source files - not a test.</p>



<a name="134120209"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2354015%20Improve%20move%20error%20loop%20detection/near/134120209" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> blitzerr <a href="https://rust-lang.github.io/zulip_archive/stream/122657-t-compiler/wg-nll/topic/.2354015.20Improve.20move.20error.20loop.20detection.html#134120209">(Sep 17 2018 at 18:59)</a>:</h4>
<p><span class="user-mention" data-user-id="116113">@lqd</span>  I am making changes to that file and want to understand the code flow</p>



<a name="134120275"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2354015%20Improve%20move%20error%20loop%20detection/near/134120275" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> davidtwco <a href="https://rust-lang.github.io/zulip_archive/stream/122657-t-compiler/wg-nll/topic/.2354015.20Improve.20move.20error.20loop.20detection.html#134120275">(Sep 17 2018 at 19:00)</a>:</h4>
<p>The path after <code>rustc</code> should be the file that will be compiled (ie. the test case that you're expecting to make a change to). You can then see the logging from <code>RUST_LOG=rustc_mir::borrow_check::error_reporting</code> (which is the file you want to understand the code flow of) as it compiles the test case.</p>



<a name="134120278"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2354015%20Improve%20move%20error%20loop%20detection/near/134120278" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> blitzerr <a href="https://rust-lang.github.io/zulip_archive/stream/122657-t-compiler/wg-nll/topic/.2354015.20Improve.20move.20error.20loop.20detection.html#134120278">(Sep 17 2018 at 19:00)</a>:</h4>
<p><span class="user-mention" data-user-id="116107">@davidtwco</span>  That might be it. Thanks a lot</p>



<a name="134120281"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2354015%20Improve%20move%20error%20loop%20detection/near/134120281" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> lqd <a href="https://rust-lang.github.io/zulip_archive/stream/122657-t-compiler/wg-nll/topic/.2354015.20Improve.20move.20error.20loop.20detection.html#134120281">(Sep 17 2018 at 19:00)</a>:</h4>
<p>are you compiling this file to get a working compiler with your changes ? if so, the command you want is probably one of the <code>./x.py buid</code>s</p>



<a name="134120382"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2354015%20Improve%20move%20error%20loop%20detection/near/134120382" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> blitzerr <a href="https://rust-lang.github.io/zulip_archive/stream/122657-t-compiler/wg-nll/topic/.2354015.20Improve.20move.20error.20loop.20detection.html#134120382">(Sep 17 2018 at 19:02)</a>:</h4>
<p>I have the compiler built just fine with the new changes (using x.py ...). I wanted to get the debug statements when the test is run</p>



<a name="134120392"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2354015%20Improve%20move%20error%20loop%20detection/near/134120392" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> blitzerr <a href="https://rust-lang.github.io/zulip_archive/stream/122657-t-compiler/wg-nll/topic/.2354015.20Improve.20move.20error.20loop.20detection.html#134120392">(Sep 17 2018 at 19:02)</a>:</h4>
<p><span class="user-mention" data-user-id="116113">@lqd</span>  ^^</p>



<a name="134120398"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2354015%20Improve%20move%20error%20loop%20detection/near/134120398" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> lqd <a href="https://rust-lang.github.io/zulip_archive/stream/122657-t-compiler/wg-nll/topic/.2354015.20Improve.20move.20error.20loop.20detection.html#134120398">(Sep 17 2018 at 19:02)</a>:</h4>
<p>then try my previous command, compiling the test file :)</p>



<a name="134120434"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2354015%20Improve%20move%20error%20loop%20detection/near/134120434" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> lqd <a href="https://rust-lang.github.io/zulip_archive/stream/122657-t-compiler/wg-nll/topic/.2354015.20Improve.20move.20error.20loop.20detection.html#134120434">(Sep 17 2018 at 19:03)</a>:</h4>
<p>or using x.py test with the test args for that test would probably also work</p>



<a name="134120435"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2354015%20Improve%20move%20error%20loop%20detection/near/134120435" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> blitzerr <a href="https://rust-lang.github.io/zulip_archive/stream/122657-t-compiler/wg-nll/topic/.2354015.20Improve.20move.20error.20loop.20detection.html#134120435">(Sep 17 2018 at 19:03)</a>:</h4>
<p>What you suggested should do the trick for me, <br>
<code>rustc +stage1 ./src/test/ui/liveness/liveness-move-in-while.rs</code></p>



<a name="134120503"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2354015%20Improve%20move%20error%20loop%20detection/near/134120503" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> lqd <a href="https://rust-lang.github.io/zulip_archive/stream/122657-t-compiler/wg-nll/topic/.2354015.20Improve.20move.20error.20loop.20detection.html#134120503">(Sep 17 2018 at 19:04)</a>:</h4>
<p>yes, with the RUST_LOG set as you mentioned</p>



<a name="134120524"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2354015%20Improve%20move%20error%20loop%20detection/near/134120524" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> blitzerr <a href="https://rust-lang.github.io/zulip_archive/stream/122657-t-compiler/wg-nll/topic/.2354015.20Improve.20move.20error.20loop.20detection.html#134120524">(Sep 17 2018 at 19:05)</a>:</h4>
<p>Right. Thanks a lot @lqd <span class="user-mention" data-user-id="116107">@davidtwco</span></p>



<a name="134120526"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2354015%20Improve%20move%20error%20loop%20detection/near/134120526" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> lqd <a href="https://rust-lang.github.io/zulip_archive/stream/122657-t-compiler/wg-nll/topic/.2354015.20Improve.20move.20error.20loop.20detection.html#134120526">(Sep 17 2018 at 19:05)</a>:</h4>
<p>let us know if that doesn't work and we'll figure it out</p>



<a name="134120590"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2354015%20Improve%20move%20error%20loop%20detection/near/134120590" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> blitzerr <a href="https://rust-lang.github.io/zulip_archive/stream/122657-t-compiler/wg-nll/topic/.2354015.20Improve.20move.20error.20loop.20detection.html#134120590">(Sep 17 2018 at 19:06)</a>:</h4>
<p>I will. That's very helpful. I will let you guys know later though as I don't have my laptop on which I build rustc</p>



<a name="134120607"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2354015%20Improve%20move%20error%20loop%20detection/near/134120607" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> lqd <a href="https://rust-lang.github.io/zulip_archive/stream/122657-t-compiler/wg-nll/topic/.2354015.20Improve.20move.20error.20loop.20detection.html#134120607">(Sep 17 2018 at 19:06)</a>:</h4>
<p>alright :)</p>



<a name="134141468"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2354015%20Improve%20move%20error%20loop%20detection/near/134141468" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> blitzerr <a href="https://rust-lang.github.io/zulip_archive/stream/122657-t-compiler/wg-nll/topic/.2354015.20Improve.20move.20error.20loop.20detection.html#134141468">(Sep 18 2018 at 02:48)</a>:</h4>
<div class="codehilite"><pre><span></span>RUST_LOG=rustc_mir::borrow_check::move_errors rustc +stage2 ./src/test/ui/liveness/liveness-move-in-while.rs
error[E0382]: use of moved value: `y`
  --&gt; ./src/test/ui/liveness/liveness-move-in-while.rs:17:24
   |
17 |         println!(&quot;{}&quot;, y); //~ ERROR use of moved value: `y`
   |                        ^ value used here after move
18 |         while true { while true { while true { x = y; x.clone(); } } }
   |                                                    - value moved here
   |
   = note: move occurs because `y` has type `std::boxed::Box&lt;isize&gt;`, which does not implement the `Copy` trait
</pre></div>


<p>The compilation fails as expected but no debug statements are printed(no errors are generated either, so this command is correct). Your suggestion was the right one. Thanks</p>



<a name="134141580"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2354015%20Improve%20move%20error%20loop%20detection/near/134141580" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> blitzerr <a href="https://rust-lang.github.io/zulip_archive/stream/122657-t-compiler/wg-nll/topic/.2354015.20Improve.20move.20error.20loop.20detection.html#134141580">(Sep 18 2018 at 02:52)</a>:</h4>
<div class="codehilite"><pre><span></span> RUST_LOG=rustc_mir::borrow_check rustc +stage2 ./src/test/ui/liveness/liveness-move-in-while.rs
DEBUG 2018-09-18T02:48:31Z: rustc_mir::borrow_check::nll::type_check: run_pass: DefId(0/0:3 ~ liveness_move_in_while[317d]::main[0])
DEBUG 2018-09-18T02:48:31Z: rustc_mir::borrow_check::nll::type_check: sanitize_place: _2
</pre></div>


<p>This prints the debug messages but only from the module <em>rustc_mir::borrow_check::nll::type_check</em>, rightly so because the debug messages I expect like </p>
<div class="codehilite"><pre><span></span>report_use_of_moved_or_uninitialized: mois=
</pre></div>


<p>Don't feature here.</p>



<a name="134141856"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2354015%20Improve%20move%20error%20loop%20detection/near/134141856" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> blitzerr <a href="https://rust-lang.github.io/zulip_archive/stream/122657-t-compiler/wg-nll/topic/.2354015.20Improve.20move.20error.20loop.20detection.html#134141856">(Sep 18 2018 at 03:01)</a>:</h4>
<p><span class="user-mention" data-user-id="116113">@lqd</span></p>



<a name="134148891"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2354015%20Improve%20move%20error%20loop%20detection/near/134148891" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> lqd <a href="https://rust-lang.github.io/zulip_archive/stream/122657-t-compiler/wg-nll/topic/.2354015.20Improve.20move.20error.20loop.20detection.html#134148891">(Sep 18 2018 at 06:43)</a>:</h4>
<p>oh that's unfortunate, let me try it when I'm in front of a computer</p>



<a name="134152997"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2354015%20Improve%20move%20error%20loop%20detection/near/134152997" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> lqd <a href="https://rust-lang.github.io/zulip_archive/stream/122657-t-compiler/wg-nll/topic/.2354015.20Improve.20move.20error.20loop.20detection.html#134152997">(Sep 18 2018 at 08:35)</a>:</h4>
<p><span class="user-mention" data-user-id="128294">@blitzerr</span> so, what you're seeing there are actually old borrowck errors: this test doesn't enable NLL, and niko manually did so <a href="https://play.rust-lang.org/?gist=1d1523cfeed2f9648f3de855eebb1c00&amp;version=nightly&amp;mode=debug&amp;edition=2015" target="_blank" title="https://play.rust-lang.org/?gist=1d1523cfeed2f9648f3de855eebb1c00&amp;version=nightly&amp;mode=debug&amp;edition=2015">here</a>. You could do a similar thing, adding <code>#![feature(nll)]</code>to the file but let's not: you can turn on NLL with rustc flags, as so: <code>RUST_LOG=rustc_mir::borrow_check::error_reporting rustc +stage2 -Zborrowck=mir -Ztwo-phase-borrows ./src/test/ui/liveness/liveness-move-in-while.rs</code>. Then you'll have approximately 400+ lines of <code>report_use_of_moved_or_uninitialized</code> logs you wanted :)</p>



<a name="134173840"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2354015%20Improve%20move%20error%20loop%20detection/near/134173840" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> blitzerr <a href="https://rust-lang.github.io/zulip_archive/stream/122657-t-compiler/wg-nll/topic/.2354015.20Improve.20move.20error.20loop.20detection.html#134173840">(Sep 18 2018 at 15:39)</a>:</h4>
<p><span class="user-mention" data-user-id="116113">@lqd</span>  Thank you so much for your time in trying this out yourself. It worked like a charm.</p>



<a name="134173939"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2354015%20Improve%20move%20error%20loop%20detection/near/134173939" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> blitzerr <a href="https://rust-lang.github.io/zulip_archive/stream/122657-t-compiler/wg-nll/topic/.2354015.20Improve.20move.20error.20loop.20detection.html#134173939">(Sep 18 2018 at 15:40)</a>:</h4>
<p>For the next time in other module how do I know if I have to use what in place of <br>
<code>Zborrowck=mir -Ztwo-phase-borrows </code>   ?<br>
I have problems with Rust module imports. They are not file paths as it is in cpp</p>



<a name="134173974"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2354015%20Improve%20move%20error%20loop%20detection/near/134173974" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://rust-lang.github.io/zulip_archive/stream/122657-t-compiler/wg-nll/topic/.2354015.20Improve.20move.20error.20loop.20detection.html#134173974">(Sep 18 2018 at 15:41)</a>:</h4>
<p>those are flags to rustc</p>



<a name="134173975"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2354015%20Improve%20move%20error%20loop%20detection/near/134173975" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://rust-lang.github.io/zulip_archive/stream/122657-t-compiler/wg-nll/topic/.2354015.20Improve.20move.20error.20loop.20detection.html#134173975">(Sep 18 2018 at 15:41)</a>:</h4>
<p>that tell it to enable NLL</p>



<a name="134173981"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2354015%20Improve%20move%20error%20loop%20detection/near/134173981" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://rust-lang.github.io/zulip_archive/stream/122657-t-compiler/wg-nll/topic/.2354015.20Improve.20move.20error.20loop.20detection.html#134173981">(Sep 18 2018 at 15:41)</a>:</h4>
<p>I would just put <code>#![feature(nll)]</code> on the top of the test file, though</p>



<a name="134173982"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2354015%20Improve%20move%20error%20loop%20detection/near/134173982" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://rust-lang.github.io/zulip_archive/stream/122657-t-compiler/wg-nll/topic/.2354015.20Improve.20move.20error.20loop.20detection.html#134173982">(Sep 18 2018 at 15:41)</a>:</h4>
<p>easier ;)</p>



<a name="134173984"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2354015%20Improve%20move%20error%20loop%20detection/near/134173984" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://rust-lang.github.io/zulip_archive/stream/122657-t-compiler/wg-nll/topic/.2354015.20Improve.20move.20error.20loop.20detection.html#134173984">(Sep 18 2018 at 15:41)</a>:</h4>
<p>then you don't need the flags</p>



<a name="134173989"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2354015%20Improve%20move%20error%20loop%20detection/near/134173989" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://rust-lang.github.io/zulip_archive/stream/122657-t-compiler/wg-nll/topic/.2354015.20Improve.20move.20error.20loop.20detection.html#134173989">(Sep 18 2018 at 15:41)</a>:</h4>
<p>those flags are independent from logging, though</p>



<a name="134174062"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2354015%20Improve%20move%20error%20loop%20detection/near/134174062" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> davidtwco <a href="https://rust-lang.github.io/zulip_archive/stream/122657-t-compiler/wg-nll/topic/.2354015.20Improve.20move.20error.20loop.20detection.html#134174062">(Sep 18 2018 at 15:42)</a>:</h4>
<p>(well, they make the code that you're changing run, so without them you won't see the logging from that code, but they in and of themselves, don't "enable" logging or anything like that)</p>



<a name="134174093"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2354015%20Improve%20move%20error%20loop%20detection/near/134174093" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> blitzerr <a href="https://rust-lang.github.io/zulip_archive/stream/122657-t-compiler/wg-nll/topic/.2354015.20Improve.20move.20error.20loop.20detection.html#134174093">(Sep 18 2018 at 15:43)</a>:</h4>
<p>That I got.</p>



<a name="134174187"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2354015%20Improve%20move%20error%20loop%20detection/near/134174187" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> blitzerr <a href="https://rust-lang.github.io/zulip_archive/stream/122657-t-compiler/wg-nll/topic/.2354015.20Improve.20move.20error.20loop.20detection.html#134174187">(Sep 18 2018 at 15:44)</a>:</h4>
<p>That they enable the feature via command line args instead of a code change. Thanks everyone.</p>



<a name="134177334"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2354015%20Improve%20move%20error%20loop%20detection/near/134177334" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://rust-lang.github.io/zulip_archive/stream/122657-t-compiler/wg-nll/topic/.2354015.20Improve.20move.20error.20loop.20detection.html#134177334">(Sep 18 2018 at 16:38)</a>:</h4>
<p><span class="user-mention" data-user-id="128294">@blitzerr</span> PR working? if you're having trouble, feel free to open a PR with <code>[WIP]</code> in the title and send me a link. That's the easiest way for me to give feedback.</p>



<a name="134177608"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2354015%20Improve%20move%20error%20loop%20detection/near/134177608" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> blitzerr <a href="https://rust-lang.github.io/zulip_archive/stream/122657-t-compiler/wg-nll/topic/.2354015.20Improve.20move.20error.20loop.20detection.html#134177608">(Sep 18 2018 at 16:42)</a>:</h4>
<p>Sure <span class="user-mention" data-user-id="116009">@nikomatsakis</span>  I will do that tonight, the first version</p>



<a name="134211000"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2354015%20Improve%20move%20error%20loop%20detection/near/134211000" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> blitzerr <a href="https://rust-lang.github.io/zulip_archive/stream/122657-t-compiler/wg-nll/topic/.2354015.20Improve.20move.20error.20loop.20detection.html#134211000">(Sep 19 2018 at 04:56)</a>:</h4>
<p><span class="user-mention" data-user-id="116009">@nikomatsakis</span>  <a href="https://github.com/rust-lang/rust/pull/54343/files" target="_blank" title="https://github.com/rust-lang/rust/pull/54343/files">https://github.com/rust-lang/rust/pull/54343/files</a> - not ready but posted what I had locally</p>



<a name="134258048"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2354015%20Improve%20move%20error%20loop%20detection/near/134258048" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://rust-lang.github.io/zulip_archive/stream/122657-t-compiler/wg-nll/topic/.2354015.20Improve.20move.20error.20loop.20detection.html#134258048">(Sep 19 2018 at 17:58)</a>:</h4>
<p>cool; btw, do you have rustfmt installed?</p>



<a name="134258067"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2354015%20Improve%20move%20error%20loop%20detection/near/134258067" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://rust-lang.github.io/zulip_archive/stream/122657-t-compiler/wg-nll/topic/.2354015.20Improve.20move.20error.20loop.20detection.html#134258067">(Sep 19 2018 at 17:58)</a>:</h4>
<p>(I'm trying to keep the new code — like this — formatted with rustfmt)</p>



<a name="134262403"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2354015%20Improve%20move%20error%20loop%20detection/near/134262403" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> blitzerr <a href="https://rust-lang.github.io/zulip_archive/stream/122657-t-compiler/wg-nll/topic/.2354015.20Improve.20move.20error.20loop.20detection.html#134262403">(Sep 19 2018 at 19:06)</a>:</h4>
<p>Sure, I will install  rustfmt and format it when I send the next revision</p>



<a name="134262490"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2354015%20Improve%20move%20error%20loop%20detection/near/134262490" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> blitzerr <a href="https://rust-lang.github.io/zulip_archive/stream/122657-t-compiler/wg-nll/topic/.2354015.20Improve.20move.20error.20loop.20detection.html#134262490">(Sep 19 2018 at 19:08)</a>:</h4>
<p><span class="user-mention" data-user-id="116009">@nikomatsakis</span>  did you get a chance to take a look. I have a few questions from the rust_log output and basic blocks. Maybe that would explain why the current code doesn't work</p>



<a name="134262510"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2354015%20Improve%20move%20error%20loop%20detection/near/134262510" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://rust-lang.github.io/zulip_archive/stream/122657-t-compiler/wg-nll/topic/.2354015.20Improve.20move.20error.20loop.20detection.html#134262510">(Sep 19 2018 at 19:08)</a>:</h4>
<p>I didn't look closely — what is the otuput from current version? (no changes?)</p>



<a name="134262513"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2354015%20Improve%20move%20error%20loop%20detection/near/134262513" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://rust-lang.github.io/zulip_archive/stream/122657-t-compiler/wg-nll/topic/.2354015.20Improve.20move.20error.20loop.20detection.html#134262513">(Sep 19 2018 at 19:08)</a>:</h4>
<p>I can look now</p>



<a name="134262729"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2354015%20Improve%20move%20error%20loop%20detection/near/134262729" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://rust-lang.github.io/zulip_archive/stream/122657-t-compiler/wg-nll/topic/.2354015.20Improve.20move.20error.20loop.20detection.html#134262729">(Sep 19 2018 at 19:12)</a>:</h4>
<p>I see the bug, will leave some comments</p>



<a name="134262761"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2354015%20Improve%20move%20error%20loop%20detection/near/134262761" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://rust-lang.github.io/zulip_archive/stream/122657-t-compiler/wg-nll/topic/.2354015.20Improve.20move.20error.20loop.20detection.html#134262761">(Sep 19 2018 at 19:13)</a>:</h4>
<p><span class="user-mention" data-user-id="128294">@blitzerr</span> <a href="https://github.com/rust-lang/rust/pull/54343#pullrequestreview-156977839" target="_blank" title="https://github.com/rust-lang/rust/pull/54343#pullrequestreview-156977839">see my review</a></p>



<a name="134262765"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2354015%20Improve%20move%20error%20loop%20detection/near/134262765" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://rust-lang.github.io/zulip_archive/stream/122657-t-compiler/wg-nll/topic/.2354015.20Improve.20move.20error.20loop.20detection.html#134262765">(Sep 19 2018 at 19:13)</a>:</h4>
<p>mostly nits, but the final comment identifies the bug I think</p>



<a name="134262767"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2354015%20Improve%20move%20error%20loop%20detection/near/134262767" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://rust-lang.github.io/zulip_archive/stream/122657-t-compiler/wg-nll/topic/.2354015.20Improve.20move.20error.20loop.20detection.html#134262767">(Sep 19 2018 at 19:13)</a>:</h4>
<p>let me know if that makes sense</p>



<a name="134263318"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2354015%20Improve%20move%20error%20loop%20detection/near/134263318" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> blitzerr <a href="https://rust-lang.github.io/zulip_archive/stream/122657-t-compiler/wg-nll/topic/.2354015.20Improve.20move.20error.20loop.20detection.html#134263318">(Sep 19 2018 at 19:24)</a>:</h4>
<p>Just now got the GitHub email <span class="emoji emoji-1f642" title="slight smile">:slight_smile:</span></p>



<a name="134263615"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2354015%20Improve%20move%20error%20loop%20detection/near/134263615" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> blitzerr <a href="https://rust-lang.github.io/zulip_archive/stream/122657-t-compiler/wg-nll/topic/.2354015.20Improve.20move.20error.20loop.20detection.html#134263615">(Sep 19 2018 at 19:30)</a>:</h4>
<p>I wanted to comment on the review but I am not hip enough to comment on a GitHub review from my phone, so I ask here <span class="emoji emoji-1f600" title="grinning">:grinning:</span></p>



<a name="134263666"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2354015%20Improve%20move%20error%20loop%20detection/near/134263666" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> blitzerr <a href="https://rust-lang.github.io/zulip_archive/stream/122657-t-compiler/wg-nll/topic/.2354015.20Improve.20move.20error.20loop.20detection.html#134263666">(Sep 19 2018 at 19:30)</a>:</h4>
<p>Why do we prefer a struct instead of a tuple?  <span class="user-mention" data-user-id="116009">@nikomatsakis</span></p>



<a name="134263677"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2354015%20Improve%20move%20error%20loop%20detection/near/134263677" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://rust-lang.github.io/zulip_archive/stream/122657-t-compiler/wg-nll/topic/.2354015.20Improve.20move.20error.20loop.20detection.html#134263677">(Sep 19 2018 at 19:31)</a>:</h4>
<p>I prefer a struct for a few reasons;</p>



<a name="134263688"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2354015%20Improve%20move%20error%20loop%20detection/near/134263688" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://rust-lang.github.io/zulip_archive/stream/122657-t-compiler/wg-nll/topic/.2354015.20Improve.20move.20error.20loop.20detection.html#134263688">(Sep 19 2018 at 19:31)</a>:</h4>
<p>it gives a place to add comments, first of all, explaining what is going on</p>



<a name="134263694"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2354015%20Improve%20move%20error%20loop%20detection/near/134263694" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://rust-lang.github.io/zulip_archive/stream/122657-t-compiler/wg-nll/topic/.2354015.20Improve.20move.20error.20loop.20detection.html#134263694">(Sep 19 2018 at 19:31)</a>:</h4>
<p>it lets us use named fields like <code>is_back_edge</code> instead of <code>foo.1</code></p>



<a name="134263702"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2354015%20Improve%20move%20error%20loop%20detection/near/134263702" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://rust-lang.github.io/zulip_archive/stream/122657-t-compiler/wg-nll/topic/.2354015.20Improve.20move.20error.20loop.20detection.html#134263702">(Sep 19 2018 at 19:31)</a>:</h4>
<p>and finally it lets us define a name ("MoveSite") that we can use for variables and the like :)</p>



<a name="134263705"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2354015%20Improve%20move%20error%20loop%20detection/near/134263705" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://rust-lang.github.io/zulip_archive/stream/122657-t-compiler/wg-nll/topic/.2354015.20Improve.20move.20error.20loop.20detection.html#134263705">(Sep 19 2018 at 19:31)</a>:</h4>
<p>we could of course do that with the tuple too...</p>



<a name="134263708"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2354015%20Improve%20move%20error%20loop%20detection/near/134263708" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://rust-lang.github.io/zulip_archive/stream/122657-t-compiler/wg-nll/topic/.2354015.20Improve.20move.20error.20loop.20detection.html#134263708">(Sep 19 2018 at 19:31)</a>:</h4>
<p>basically I just find it more self-documenting</p>



<a name="134279407"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2354015%20Improve%20move%20error%20loop%20detection/near/134279407" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> blitzerr <a href="https://rust-lang.github.io/zulip_archive/stream/122657-t-compiler/wg-nll/topic/.2354015.20Improve.20move.20error.20loop.20detection.html#134279407">(Sep 20 2018 at 01:23)</a>:</h4>
<p>All that makes sense. And it also comes at no performance penalties ? I guess it would depend on how a tuple is implemented, one can more or less expensive than the other but because we will recursively create an object of all basic blocks, it can have a large cost of compilation in big projects ? <br>
These are just questions out of curiosity, I do agree with the self documenting part with well named members argument about structs.</p>



<a name="134279409"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2354015%20Improve%20move%20error%20loop%20detection/near/134279409" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> blitzerr <a href="https://rust-lang.github.io/zulip_archive/stream/122657-t-compiler/wg-nll/topic/.2354015.20Improve.20move.20error.20loop.20detection.html#134279409">(Sep 20 2018 at 01:23)</a>:</h4>
<p><span class="user-mention" data-user-id="116009">@nikomatsakis</span></p>



<a name="134309429"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2354015%20Improve%20move%20error%20loop%20detection/near/134309429" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://rust-lang.github.io/zulip_archive/stream/122657-t-compiler/wg-nll/topic/.2354015.20Improve.20move.20error.20loop.20detection.html#134309429">(Sep 20 2018 at 13:30)</a>:</h4>
<blockquote>
<p>All that makes sense. And it also comes at no performance penalties ?</p>
</blockquote>
<p>tuples and structs are identical at runtime, yes</p>



<a name="134331016"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2354015%20Improve%20move%20error%20loop%20detection/near/134331016" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> blitzerr <a href="https://rust-lang.github.io/zulip_archive/stream/122657-t-compiler/wg-nll/topic/.2354015.20Improve.20move.20error.20loop.20detection.html#134331016">(Sep 20 2018 at 19:20)</a>:</h4>
<p>Awesome thanks <span class="user-mention" data-user-id="116009">@nikomatsakis</span></p>



<a name="134331121"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2354015%20Improve%20move%20error%20loop%20detection/near/134331121" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> blitzerr <a href="https://rust-lang.github.io/zulip_archive/stream/122657-t-compiler/wg-nll/topic/.2354015.20Improve.20move.20error.20loop.20detection.html#134331121">(Sep 20 2018 at 19:22)</a>:</h4>
<p>I have another question. The basic blocks's location is the line number of a statement, right? Does it strips the empty lines. I was trying to change the lines numbers in the debug logging for the test for it wouldn't change.</p>



<a name="134332123"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2354015%20Improve%20move%20error%20loop%20detection/near/134332123" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> davidtwco <a href="https://rust-lang.github.io/zulip_archive/stream/122657-t-compiler/wg-nll/topic/.2354015.20Improve.20move.20error.20loop.20detection.html#134332123">(Sep 20 2018 at 19:41)</a>:</h4>
<p>The <code>Location</code> that you're talking about is the location in the MIR - which is an intermediate representation of the language. It's made up of basic blocks with statements and then a terminator. If you run the compiler with <code>-Z dump-mir=all</code> then you get a <code>mir_dump</code> folder that shows you the MIR. In those files (there's one for each function/closure) you'll see things like <code>bb0[2]</code> which is basic block 0, statement 2. There aren't any empty lines in the MIR.<br>
<a href="https://rust-lang-nursery.github.io/rustc-guide/mir/index.html" target="_blank" title="https://rust-lang-nursery.github.io/rustc-guide/mir/index.html">https://rust-lang-nursery.github.io/rustc-guide/mir/index.html</a></p>



<a name="134341224"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2354015%20Improve%20move%20error%20loop%20detection/near/134341224" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> blitzerr <a href="https://rust-lang.github.io/zulip_archive/stream/122657-t-compiler/wg-nll/topic/.2354015.20Improve.20move.20error.20loop.20detection.html#134341224">(Sep 20 2018 at 22:16)</a>:</h4>
<p>thanks <span class="user-mention" data-user-id="116107">@davidtwco</span> <br>
I will do what you suggested. Usually basic block is for a block of code but are you suggesting that Mir treats single statements as the basic block ?</p>



<a name="134341281"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2354015%20Improve%20move%20error%20loop%20detection/near/134341281" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> blitzerr <a href="https://rust-lang.github.io/zulip_archive/stream/122657-t-compiler/wg-nll/topic/.2354015.20Improve.20move.20error.20loop.20detection.html#134341281">(Sep 20 2018 at 22:17)</a>:</h4>
<p>Thanks for the link<span class="emoji emoji-1f44d" title="+1">:+1:</span></p>



<a name="134341283"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2354015%20Improve%20move%20error%20loop%20detection/near/134341283" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> davidtwco <a href="https://rust-lang.github.io/zulip_archive/stream/122657-t-compiler/wg-nll/topic/.2354015.20Improve.20move.20error.20loop.20detection.html#134341283">(Sep 20 2018 at 22:17)</a>:</h4>
<p>A single statement in a test might end up as multiple statements in the Mir with compiler inserted temporaries.</p>



<a name="134341352"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2354015%20Improve%20move%20error%20loop%20detection/near/134341352" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> davidtwco <a href="https://rust-lang.github.io/zulip_archive/stream/122657-t-compiler/wg-nll/topic/.2354015.20Improve.20move.20error.20loop.20detection.html#134341352">(Sep 20 2018 at 22:18)</a>:</h4>
<p>But within the parts of the code you're working on, you'll always be working within the Mir of one function or closure, which can have many basic blocks, each with statements and a terminator.</p>



<a name="134351120"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2354015%20Improve%20move%20error%20loop%20detection/near/134351120" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> blitzerr <a href="https://rust-lang.github.io/zulip_archive/stream/122657-t-compiler/wg-nll/topic/.2354015.20Improve.20move.20error.20loop.20detection.html#134351120">(Sep 21 2018 at 02:10)</a>:</h4>
<p>Thanks a  lot <span class="user-mention" data-user-id="116107">@davidtwco</span>  I will try this out.</p>



<a name="134539271"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2354015%20Improve%20move%20error%20loop%20detection/near/134539271" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> blitzerr <a href="https://rust-lang.github.io/zulip_archive/stream/122657-t-compiler/wg-nll/topic/.2354015.20Improve.20move.20error.20loop.20detection.html#134539271">(Sep 24 2018 at 17:08)</a>:</h4>
<p><span class="user-mention" data-user-id="116009">@nikomatsakis</span>   <br>
I did get my question answered</p>



<a name="134539811"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2354015%20Improve%20move%20error%20loop%20detection/near/134539811" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> blitzerr <a href="https://rust-lang.github.io/zulip_archive/stream/122657-t-compiler/wg-nll/topic/.2354015.20Improve.20move.20error.20loop.20detection.html#134539811">(Sep 24 2018 at 17:19)</a>:</h4>
<p><span class="user-mention" data-user-id="116009">@nikomatsakis</span>  I didn't make much progress this weekend. I am sorry that this seemingly an hour worth of work is taking me over a week to get done.</p>



<a name="134542034"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2354015%20Improve%20move%20error%20loop%20detection/near/134542034" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://rust-lang.github.io/zulip_archive/stream/122657-t-compiler/wg-nll/topic/.2354015.20Improve.20move.20error.20loop.20detection.html#134542034">(Sep 24 2018 at 18:00)</a>:</h4>
<p><span class="user-mention" data-user-id="128294">@blitzerr</span> first PR is the hardest :)</p>



<a name="134542552"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2354015%20Improve%20move%20error%20loop%20detection/near/134542552" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> blitzerr <a href="https://rust-lang.github.io/zulip_archive/stream/122657-t-compiler/wg-nll/topic/.2354015.20Improve.20move.20error.20loop.20detection.html#134542552">(Sep 24 2018 at 18:08)</a>:</h4>
<p>Tell me about it <span class="emoji emoji-1f600" title="grinning">:grinning:</span></p>



<a name="134556186"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2354015%20Improve%20move%20error%20loop%20detection/near/134556186" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> blitzerr <a href="https://rust-lang.github.io/zulip_archive/stream/122657-t-compiler/wg-nll/topic/.2354015.20Improve.20move.20error.20loop.20detection.html#134556186">(Sep 24 2018 at 20:56)</a>:</h4>
<p><span class="user-mention" data-user-id="116009">@nikomatsakis</span>  Also I looked at your comments. It looks more than just the error annotations not updated. My pull just eliminated the second  comment for the error, which points to the while loop and where the move happened.</p>



<a name="134556198"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2354015%20Improve%20move%20error%20loop%20detection/near/134556198" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> blitzerr <a href="https://rust-lang.github.io/zulip_archive/stream/122657-t-compiler/wg-nll/topic/.2354015.20Improve.20move.20error.20loop.20detection.html#134556198">(Sep 24 2018 at 20:56)</a>:</h4>
<p>I added a comment on the GitHub earlier. <br>
I will take a look today</p>



<a name="134689945"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2354015%20Improve%20move%20error%20loop%20detection/near/134689945" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> blitzerr <a href="https://rust-lang.github.io/zulip_archive/stream/122657-t-compiler/wg-nll/topic/.2354015.20Improve.20move.20error.20loop.20detection.html#134689945">(Sep 26 2018 at 17:18)</a>:</h4>
<p><span class="user-mention" data-user-id="116009">@nikomatsakis</span> <br>
I added a comment on the PR.</p>



<a name="134752253"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2354015%20Improve%20move%20error%20loop%20detection/near/134752253" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> blitzerr <a href="https://rust-lang.github.io/zulip_archive/stream/122657-t-compiler/wg-nll/topic/.2354015.20Improve.20move.20error.20loop.20detection.html#134752253">(Sep 27 2018 at 15:25)</a>:</h4>
<div class="codehilite"><pre><span></span><span class="cp">$</span><span class="w"> </span><span class="n">rustc</span><span class="w"> </span><span class="o">+</span><span class="n">stage1</span><span class="w"> </span><span class="p">.</span><span class="o">/</span><span class="n">src</span><span class="o">/</span><span class="n">test</span><span class="o">/</span><span class="n">ui</span><span class="o">/</span><span class="n">liveness</span><span class="o">/</span><span class="n">liveness</span><span class="o">-</span><span class="k">move</span><span class="o">-</span><span class="k">in</span><span class="o">-</span><span class="k">while</span><span class="p">.</span><span class="n">rs</span><span class="w"></span>
<span class="n">error</span><span class="p">[</span><span class="n">E0382</span><span class="p">]</span>: <span class="nc">use</span><span class="w"> </span><span class="n">of</span><span class="w"> </span><span class="n">moved</span><span class="w"> </span><span class="n">value</span>: <span class="err">`</span><span class="n">y</span><span class="err">`</span><span class="w"></span>
<span class="w">  </span><span class="o">-</span>-&gt; <span class="p">.</span><span class="o">/</span><span class="n">src</span><span class="o">/</span><span class="n">test</span><span class="o">/</span><span class="n">ui</span><span class="o">/</span><span class="n">liveness</span><span class="o">/</span><span class="n">liveness</span><span class="o">-</span><span class="k">move</span><span class="o">-</span><span class="k">in</span><span class="o">-</span><span class="k">while</span><span class="p">.</span><span class="n">rs</span>:<span class="mi">17</span>:<span class="mi">24</span><span class="w"></span>
<span class="w">   </span><span class="o">|</span><span class="w"></span>
<span class="mi">17</span><span class="w"> </span><span class="o">|</span><span class="w">         </span><span class="n">println</span><span class="o">!</span><span class="p">(</span><span class="s">&quot;{}&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">y</span><span class="p">);</span><span class="w"> </span><span class="c1">//~ ERROR use of moved value: `y`</span>
<span class="w">   </span><span class="o">|</span><span class="w">                        </span><span class="o">^</span><span class="w"> </span><span class="n">value</span><span class="w"> </span><span class="n">used</span><span class="w"> </span><span class="n">here</span><span class="w"> </span><span class="n">after</span><span class="w"> </span><span class="k">move</span><span class="w"></span>
<span class="mi">18</span><span class="w"> </span><span class="o">|</span><span class="w">         </span><span class="k">while</span><span class="w"> </span><span class="kc">true</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="k">while</span><span class="w"> </span><span class="kc">true</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="k">while</span><span class="w"> </span><span class="kc">true</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">y</span><span class="p">;</span><span class="w"> </span><span class="n">x</span><span class="p">.</span><span class="n">clone</span><span class="p">();</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="p">}</span><span class="w"></span>
<span class="w">   </span><span class="o">|</span><span class="w">                                                    </span><span class="o">-</span><span class="w"> </span><span class="n">value</span><span class="w"> </span><span class="n">moved</span><span class="w"> </span><span class="n">here</span><span class="w"></span>
<span class="w">   </span><span class="o">|</span><span class="w"></span>
<span class="w">   </span><span class="o">=</span><span class="w"> </span><span class="n">note</span>: <span class="nc">move</span><span class="w"> </span><span class="n">occurs</span><span class="w"> </span><span class="n">because</span><span class="w"> </span><span class="err">`</span><span class="n">y</span><span class="err">`</span><span class="w"> </span><span class="n">has</span><span class="w"> </span><span class="k">type</span> <span class="err">`</span><span class="n">std</span>::<span class="n">boxed</span>::<span class="nb">Box</span><span class="o">&lt;</span><span class="kt">isize</span><span class="o">&gt;</span><span class="err">`</span><span class="p">,</span><span class="w"> </span><span class="n">which</span><span class="w"> </span><span class="n">does</span><span class="w"> </span><span class="n">not</span><span class="w"> </span><span class="n">implement</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="err">`</span><span class="nb">Copy</span><span class="err">`</span><span class="w"> </span><span class="k">trait</span><span class="w"></span>

<span class="n">error</span><span class="p">[</span><span class="n">E0382</span><span class="p">]</span>: <span class="nc">use</span><span class="w"> </span><span class="n">of</span><span class="w"> </span><span class="n">moved</span><span class="w"> </span><span class="n">value</span>: <span class="err">`</span><span class="n">y</span><span class="err">`</span><span class="w"></span>
<span class="w">  </span><span class="o">-</span>-&gt; <span class="p">.</span><span class="o">/</span><span class="n">src</span><span class="o">/</span><span class="n">test</span><span class="o">/</span><span class="n">ui</span><span class="o">/</span><span class="n">liveness</span><span class="o">/</span><span class="n">liveness</span><span class="o">-</span><span class="k">move</span><span class="o">-</span><span class="k">in</span><span class="o">-</span><span class="k">while</span><span class="p">.</span><span class="n">rs</span>:<span class="mi">18</span>:<span class="mi">52</span><span class="w"></span>
<span class="w">   </span><span class="o">|</span><span class="w"></span>
<span class="mi">18</span><span class="w"> </span><span class="o">|</span><span class="w">         </span><span class="k">while</span><span class="w"> </span><span class="kc">true</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="k">while</span><span class="w"> </span><span class="kc">true</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="k">while</span><span class="w"> </span><span class="kc">true</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">y</span><span class="p">;</span><span class="w"> </span><span class="n">x</span><span class="p">.</span><span class="n">clone</span><span class="p">();</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="p">}</span><span class="w"></span>
<span class="w">   </span><span class="o">|</span><span class="w">                                                    </span><span class="o">^</span><span class="w"> </span><span class="n">value</span><span class="w"> </span><span class="n">moved</span><span class="w"> </span><span class="n">here</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="n">previous</span><span class="w"> </span><span class="n">iteration</span><span class="w"> </span><span class="n">of</span><span class="w"> </span><span class="k">loop</span><span class="w"></span>
<span class="w">   </span><span class="o">|</span><span class="w"></span>
<span class="w">   </span><span class="o">=</span><span class="w"> </span><span class="n">note</span>: <span class="nc">move</span><span class="w"> </span><span class="n">occurs</span><span class="w"> </span><span class="n">because</span><span class="w"> </span><span class="err">`</span><span class="n">y</span><span class="err">`</span><span class="w"> </span><span class="n">has</span><span class="w"> </span><span class="k">type</span> <span class="err">`</span><span class="n">std</span>::<span class="n">boxed</span>::<span class="nb">Box</span><span class="o">&lt;</span><span class="kt">isize</span><span class="o">&gt;</span><span class="err">`</span><span class="p">,</span><span class="w"> </span><span class="n">which</span><span class="w"> </span><span class="n">does</span><span class="w"> </span><span class="n">not</span><span class="w"> </span><span class="n">implement</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="err">`</span><span class="nb">Copy</span><span class="err">`</span><span class="w"> </span><span class="k">trait</span><span class="w"></span>

<span class="n">error</span>: <span class="nc">aborting</span><span class="w"> </span><span class="n">due</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="mi">2</span><span class="w"> </span><span class="n">previous</span><span class="w"> </span><span class="n">errors</span><span class="w"></span>

<span class="n">For</span><span class="w"> </span><span class="n">more</span><span class="w"> </span><span class="n">information</span><span class="w"> </span><span class="n">about</span><span class="w"> </span><span class="n">this</span><span class="w"> </span><span class="n">error</span><span class="p">,</span><span class="w"> </span><span class="n">try</span><span class="w"> </span><span class="err">`</span><span class="n">rustc</span><span class="w"> </span><span class="o">--</span><span class="n">explain</span><span class="w"> </span><span class="n">E0382</span><span class="err">`</span><span class="p">.</span><span class="w"></span>
</pre></div>



<a name="134752385"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2354015%20Improve%20move%20error%20loop%20detection/near/134752385" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> blitzerr <a href="https://rust-lang.github.io/zulip_archive/stream/122657-t-compiler/wg-nll/topic/.2354015.20Improve.20move.20error.20loop.20detection.html#134752385">(Sep 27 2018 at 15:26)</a>:</h4>
<p>After fetching from upstream and doing a clean build, I see these errors while trying to compile the test file. I remember you saying that there is a PR that removes the second error as a duplicate?</p>



<a name="134752452"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2354015%20Improve%20move%20error%20loop%20detection/near/134752452" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> blitzerr <a href="https://rust-lang.github.io/zulip_archive/stream/122657-t-compiler/wg-nll/topic/.2354015.20Improve.20move.20error.20loop.20detection.html#134752452">(Sep 27 2018 at 15:27)</a>:</h4>
<p>I see the code in my repo, but the output has it, maybe I misunderstood the intended meaning of duplicate ?</p>



<a name="134752459"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2354015%20Improve%20move%20error%20loop%20detection/near/134752459" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> blitzerr <a href="https://rust-lang.github.io/zulip_archive/stream/122657-t-compiler/wg-nll/topic/.2354015.20Improve.20move.20error.20loop.20detection.html#134752459">(Sep 27 2018 at 15:28)</a>:</h4>
<p><span class="user-mention" data-user-id="116009">@nikomatsakis</span></p>



<a name="134753272"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2354015%20Improve%20move%20error%20loop%20detection/near/134753272" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://rust-lang.github.io/zulip_archive/stream/122657-t-compiler/wg-nll/topic/.2354015.20Improve.20move.20error.20loop.20detection.html#134753272">(Sep 27 2018 at 15:38)</a>:</h4>
<p><span class="user-mention" data-user-id="128294">@blitzerr</span> can you test against the output when you use <code>rustc +nightly</code>?</p>



<a name="134753445"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2354015%20Improve%20move%20error%20loop%20detection/near/134753445" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> blitzerr <a href="https://rust-lang.github.io/zulip_archive/stream/122657-t-compiler/wg-nll/topic/.2354015.20Improve.20move.20error.20loop.20detection.html#134753445">(Sep 27 2018 at 15:40)</a>:</h4>
<div class="codehilite"><pre><span></span><span class="cp">$</span><span class="w"> </span><span class="n">rustc</span><span class="w"> </span><span class="o">+</span><span class="n">nightly</span><span class="w"> </span><span class="p">.</span><span class="o">/</span><span class="n">src</span><span class="o">/</span><span class="n">test</span><span class="o">/</span><span class="n">ui</span><span class="o">/</span><span class="n">liveness</span><span class="o">/</span><span class="n">liveness</span><span class="o">-</span><span class="k">move</span><span class="o">-</span><span class="k">in</span><span class="o">-</span><span class="k">while</span><span class="p">.</span><span class="n">rs</span><span class="w"></span>
<span class="n">error</span><span class="p">[</span><span class="n">E0382</span><span class="p">]</span>: <span class="nc">use</span><span class="w"> </span><span class="n">of</span><span class="w"> </span><span class="n">moved</span><span class="w"> </span><span class="n">value</span>: <span class="err">`</span><span class="n">y</span><span class="err">`</span><span class="w"></span>
<span class="w">  </span><span class="o">-</span>-&gt; <span class="p">.</span><span class="o">/</span><span class="n">src</span><span class="o">/</span><span class="n">test</span><span class="o">/</span><span class="n">ui</span><span class="o">/</span><span class="n">liveness</span><span class="o">/</span><span class="n">liveness</span><span class="o">-</span><span class="k">move</span><span class="o">-</span><span class="k">in</span><span class="o">-</span><span class="k">while</span><span class="p">.</span><span class="n">rs</span>:<span class="mi">17</span>:<span class="mi">24</span><span class="w"></span>
<span class="w">   </span><span class="o">|</span><span class="w"></span>
<span class="mi">17</span><span class="w"> </span><span class="o">|</span><span class="w">         </span><span class="n">println</span><span class="o">!</span><span class="p">(</span><span class="s">&quot;{}&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">y</span><span class="p">);</span><span class="w"> </span><span class="c1">//~ ERROR use of moved value: `y`</span>
<span class="w">   </span><span class="o">|</span><span class="w">                        </span><span class="o">^</span><span class="w"> </span><span class="n">value</span><span class="w"> </span><span class="n">used</span><span class="w"> </span><span class="n">here</span><span class="w"> </span><span class="n">after</span><span class="w"> </span><span class="k">move</span><span class="w"></span>
<span class="mi">18</span><span class="w"> </span><span class="o">|</span><span class="w">         </span><span class="k">while</span><span class="w"> </span><span class="kc">true</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="k">while</span><span class="w"> </span><span class="kc">true</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="k">while</span><span class="w"> </span><span class="kc">true</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">y</span><span class="p">;</span><span class="w"> </span><span class="n">x</span><span class="p">.</span><span class="n">clone</span><span class="p">();</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="p">}</span><span class="w"></span>
<span class="w">   </span><span class="o">|</span><span class="w">                                                    </span><span class="o">-</span><span class="w"> </span><span class="n">value</span><span class="w"> </span><span class="n">moved</span><span class="w"> </span><span class="n">here</span><span class="w"></span>
<span class="w">   </span><span class="o">|</span><span class="w"></span>
<span class="w">   </span><span class="o">=</span><span class="w"> </span><span class="n">note</span>: <span class="nc">move</span><span class="w"> </span><span class="n">occurs</span><span class="w"> </span><span class="n">because</span><span class="w"> </span><span class="err">`</span><span class="n">y</span><span class="err">`</span><span class="w"> </span><span class="n">has</span><span class="w"> </span><span class="k">type</span> <span class="err">`</span><span class="n">std</span>::<span class="n">boxed</span>::<span class="nb">Box</span><span class="o">&lt;</span><span class="kt">isize</span><span class="o">&gt;</span><span class="err">`</span><span class="p">,</span><span class="w"> </span><span class="n">which</span><span class="w"> </span><span class="n">does</span><span class="w"> </span><span class="n">not</span><span class="w"> </span><span class="n">implement</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="err">`</span><span class="nb">Copy</span><span class="err">`</span><span class="w"> </span><span class="k">trait</span><span class="w"></span>

<span class="n">error</span><span class="p">[</span><span class="n">E0382</span><span class="p">]</span>: <span class="nc">use</span><span class="w"> </span><span class="n">of</span><span class="w"> </span><span class="n">moved</span><span class="w"> </span><span class="n">value</span>: <span class="err">`</span><span class="n">y</span><span class="err">`</span><span class="w"></span>
<span class="w">  </span><span class="o">-</span>-&gt; <span class="p">.</span><span class="o">/</span><span class="n">src</span><span class="o">/</span><span class="n">test</span><span class="o">/</span><span class="n">ui</span><span class="o">/</span><span class="n">liveness</span><span class="o">/</span><span class="n">liveness</span><span class="o">-</span><span class="k">move</span><span class="o">-</span><span class="k">in</span><span class="o">-</span><span class="k">while</span><span class="p">.</span><span class="n">rs</span>:<span class="mi">18</span>:<span class="mi">52</span><span class="w"></span>
<span class="w">   </span><span class="o">|</span><span class="w"></span>
<span class="mi">18</span><span class="w"> </span><span class="o">|</span><span class="w">         </span><span class="k">while</span><span class="w"> </span><span class="kc">true</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="k">while</span><span class="w"> </span><span class="kc">true</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="k">while</span><span class="w"> </span><span class="kc">true</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">y</span><span class="p">;</span><span class="w"> </span><span class="n">x</span><span class="p">.</span><span class="n">clone</span><span class="p">();</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="p">}</span><span class="w"></span>
<span class="w">   </span><span class="o">|</span><span class="w">                                                    </span><span class="o">^</span><span class="w"> </span><span class="n">value</span><span class="w"> </span><span class="n">moved</span><span class="w"> </span><span class="n">here</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="n">previous</span><span class="w"> </span><span class="n">iteration</span><span class="w"> </span><span class="n">of</span><span class="w"> </span><span class="k">loop</span><span class="w"></span>
<span class="w">   </span><span class="o">|</span><span class="w"></span>
<span class="w">   </span><span class="o">=</span><span class="w"> </span><span class="n">note</span>: <span class="nc">move</span><span class="w"> </span><span class="n">occurs</span><span class="w"> </span><span class="n">because</span><span class="w"> </span><span class="err">`</span><span class="n">y</span><span class="err">`</span><span class="w"> </span><span class="n">has</span><span class="w"> </span><span class="k">type</span> <span class="err">`</span><span class="n">std</span>::<span class="n">boxed</span>::<span class="nb">Box</span><span class="o">&lt;</span><span class="kt">isize</span><span class="o">&gt;</span><span class="err">`</span><span class="p">,</span><span class="w"> </span><span class="n">which</span><span class="w"> </span><span class="n">does</span><span class="w"> </span><span class="n">not</span><span class="w"> </span><span class="n">implement</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="err">`</span><span class="nb">Copy</span><span class="err">`</span><span class="w"> </span><span class="k">trait</span><span class="w"></span>

<span class="n">error</span>: <span class="nc">aborting</span><span class="w"> </span><span class="n">due</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="mi">2</span><span class="w"> </span><span class="n">previous</span><span class="w"> </span><span class="n">errors</span><span class="w"></span>

<span class="n">For</span><span class="w"> </span><span class="n">more</span><span class="w"> </span><span class="n">information</span><span class="w"> </span><span class="n">about</span><span class="w"> </span><span class="n">this</span><span class="w"> </span><span class="n">error</span><span class="p">,</span><span class="w"> </span><span class="n">try</span><span class="w"> </span><span class="err">`</span><span class="n">rustc</span><span class="w"> </span><span class="o">--</span><span class="n">explain</span><span class="w"> </span><span class="n">E0382</span><span class="err">`</span><span class="p">.</span><span class="w"></span>
</pre></div>



<a name="134753447"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2354015%20Improve%20move%20error%20loop%20detection/near/134753447" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://rust-lang.github.io/zulip_archive/stream/122657-t-compiler/wg-nll/topic/.2354015.20Improve.20move.20error.20loop.20detection.html#134753447">(Sep 27 2018 at 15:40)</a>:</h4>
<p>e.g., I get</p>
<div class="codehilite"><pre><span></span>athena. rustc +nightly liveness-move-in-while.rs -Zborrowck=mir -Ztwo-phase-borrows
error[E0382]: borrow of moved value: `y`
  --&gt; liveness-move-in-while.rs:17:24
   |
17 |         println!(&quot;{}&quot;, y); //~ ERROR use of moved value: `y`
   |                        ^ value borrowed here after move
18 |         while true { while true { while true { x = y; x.clone(); } } }
   |                                                    - value moved here
   |
   = note: move occurs because `y` has type `std::boxed::Box&lt;isize&gt;`, which does not implement the `Copy` trait
</pre></div>



<a name="134753463"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2354015%20Improve%20move%20error%20loop%20detection/near/134753463" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://rust-lang.github.io/zulip_archive/stream/122657-t-compiler/wg-nll/topic/.2354015.20Improve.20move.20error.20loop.20detection.html#134753463">(Sep 27 2018 at 15:40)</a>:</h4>
<p>are you running with <code>-Zborrowck=mir</code>? Otherwise, unless the test has <code>#![feature(nll)]</code>, you are running the older, AST-based borrow checker</p>



<a name="134753482"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2354015%20Improve%20move%20error%20loop%20detection/near/134753482" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> blitzerr <a href="https://rust-lang.github.io/zulip_archive/stream/122657-t-compiler/wg-nll/topic/.2354015.20Improve.20move.20error.20loop.20detection.html#134753482">(Sep 27 2018 at 15:41)</a>:</h4>
<p>Ahh ! This is what I am beating my head against <span class="emoji emoji-1f642" title="slight smile">:slight_smile:</span></p>



<a name="134753485"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2354015%20Improve%20move%20error%20loop%20detection/near/134753485" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://rust-lang.github.io/zulip_archive/stream/122657-t-compiler/wg-nll/topic/.2354015.20Improve.20move.20error.20loop.20detection.html#134753485">(Sep 27 2018 at 15:41)</a>:</h4>
<p>d'oh, sorry for the confusion :)</p>



<a name="134753575"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2354015%20Improve%20move%20error%20loop%20detection/near/134753575" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> blitzerr <a href="https://rust-lang.github.io/zulip_archive/stream/122657-t-compiler/wg-nll/topic/.2354015.20Improve.20move.20error.20loop.20detection.html#134753575">(Sep 27 2018 at 15:42)</a>:</h4>
<div class="codehilite"><pre><span></span>
</pre></div>



<a name="134753581"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2354015%20Improve%20move%20error%20loop%20detection/near/134753581" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> blitzerr <a href="https://rust-lang.github.io/zulip_archive/stream/122657-t-compiler/wg-nll/topic/.2354015.20Improve.20move.20error.20loop.20detection.html#134753581">(Sep 27 2018 at 15:42)</a>:</h4>
<div class="codehilite"><pre><span></span>$ rustc +nightly ./src/test/ui/liveness/liveness-move-in-while.rs -Zborrowck=mir -Ztwo-phase-borrows
error[E0382]: borrow of moved value: `y`
  --&gt; ./src/test/ui/liveness/liveness-move-in-while.rs:17:24
   |
17 |         println!(&quot;{}&quot;, y); //~ ERROR use of moved value: `y`
   |                        ^ value borrowed here after move
18 |         while true { while true { while true { x = y; x.clone(); } } }
   |                                                    - value moved here
   |
   = note: move occurs because `y` has type `std::boxed::Box&lt;isize&gt;`, which does not implement the `Copy` trait

error[E0382]: use of moved value: `y`
  --&gt; ./src/test/ui/liveness/liveness-move-in-while.rs:18:52
   |
18 |         while true { while true { while true { x = y; x.clone(); } } }
   |                                                    ^ value moved here in previous iteration of loop
   |
   = note: move occurs because `y` has type `std::boxed::Box&lt;isize&gt;`, which does not implement the `Copy` trait

error: aborting due to 2 previous errors

For more information about this error, try `rustc --explain E0382`.
</pre></div>



<a name="134753602"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2354015%20Improve%20move%20error%20loop%20detection/near/134753602" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> blitzerr <a href="https://rust-lang.github.io/zulip_archive/stream/122657-t-compiler/wg-nll/topic/.2354015.20Improve.20move.20error.20loop.20detection.html#134753602">(Sep 27 2018 at 15:43)</a>:</h4>
<p>Still the same, right ?</p>



<a name="134753683"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2354015%20Improve%20move%20error%20loop%20detection/near/134753683" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> blitzerr <a href="https://rust-lang.github.io/zulip_archive/stream/122657-t-compiler/wg-nll/topic/.2354015.20Improve.20move.20error.20loop.20detection.html#134753683">(Sep 27 2018 at 15:44)</a>:</h4>
<p>You have a different output than I do ! <span class="emoji emoji-1f642" title="slight smile">:slight_smile:</span></p>



<a name="134753837"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2354015%20Improve%20move%20error%20loop%20detection/near/134753837" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> blitzerr <a href="https://rust-lang.github.io/zulip_archive/stream/122657-t-compiler/wg-nll/topic/.2354015.20Improve.20move.20error.20loop.20detection.html#134753837">(Sep 27 2018 at 15:46)</a>:</h4>
<p>The only change I have in my repo right now, is the RustFmt-ed file<br>
<a href="https://github.com/rust-lang/rust/pull/54343/files" target="_blank" title="https://github.com/rust-lang/rust/pull/54343/files">https://github.com/rust-lang/rust/pull/54343/files</a></p>



<a name="134756833"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2354015%20Improve%20move%20error%20loop%20detection/near/134756833" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> blitzerr <a href="https://rust-lang.github.io/zulip_archive/stream/122657-t-compiler/wg-nll/topic/.2354015.20Improve.20move.20error.20loop.20detection.html#134756833">(Sep 27 2018 at 16:27)</a>:</h4>
<p>I did a hard reset and this is what my git log shows :</p>
<div class="codehilite"><pre><span></span>commit c9865b1c37f8cb8a257591e6ea0b32a5df1f3d41 (HEAD -&gt; master, upstream/master)
Merge: c4501a0f1d 3feffd48bd
Author: bors &lt;bors@rust-lang.org&gt;
Date:   Thu Sep 27 12:35:36 2018 +0000

    Auto merge of #54355 - pnkfelix:issue-22323-regression-test, r=davidtwco

    NLL: regression test for &quot;dropck: track order of destruction for r-value temporaries&quot;

    Once this lands, we can remove the E-needstest from #22323.

    (We shouldn&#39;t close the bug itself, however, because we are leaving the NLL-fixed-by-NLL bugs open until NLL is turned on by default.)
</pre></div>



<a name="134756912"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2354015%20Improve%20move%20error%20loop%20detection/near/134756912" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> blitzerr <a href="https://rust-lang.github.io/zulip_archive/stream/122657-t-compiler/wg-nll/topic/.2354015.20Improve.20move.20error.20loop.20detection.html#134756912">(Sep 27 2018 at 16:28)</a>:</h4>
<p><span class="user-mention" data-user-id="116009">@nikomatsakis</span> <br>
This is the output :</p>
<div class="codehilite"><pre><span></span><span class="cp">$</span><span class="w"> </span><span class="n">rustc</span><span class="w"> </span><span class="o">+</span><span class="n">nightly</span><span class="w"> </span><span class="p">.</span><span class="o">/</span><span class="n">src</span><span class="o">/</span><span class="n">test</span><span class="o">/</span><span class="n">ui</span><span class="o">/</span><span class="n">liveness</span><span class="o">/</span><span class="n">liveness</span><span class="o">-</span><span class="k">move</span><span class="o">-</span><span class="k">in</span><span class="o">-</span><span class="k">while</span><span class="p">.</span><span class="n">rs</span><span class="w"> </span><span class="o">-</span><span class="n">Zborrowck</span><span class="o">=</span><span class="n">mir</span><span class="w"> </span><span class="o">-</span><span class="n">Ztwo</span><span class="o">-</span><span class="n">phase</span><span class="o">-</span><span class="n">borrows</span><span class="w"></span>
<span class="n">error</span><span class="p">[</span><span class="n">E0382</span><span class="p">]</span>: <span class="nc">borrow</span><span class="w"> </span><span class="n">of</span><span class="w"> </span><span class="n">moved</span><span class="w"> </span><span class="n">value</span>: <span class="err">`</span><span class="n">y</span><span class="err">`</span><span class="w"></span>
<span class="w">  </span><span class="o">-</span>-&gt; <span class="p">.</span><span class="o">/</span><span class="n">src</span><span class="o">/</span><span class="n">test</span><span class="o">/</span><span class="n">ui</span><span class="o">/</span><span class="n">liveness</span><span class="o">/</span><span class="n">liveness</span><span class="o">-</span><span class="k">move</span><span class="o">-</span><span class="k">in</span><span class="o">-</span><span class="k">while</span><span class="p">.</span><span class="n">rs</span>:<span class="mi">17</span>:<span class="mi">24</span><span class="w"></span>
<span class="w">   </span><span class="o">|</span><span class="w"></span>
<span class="mi">17</span><span class="w"> </span><span class="o">|</span><span class="w">         </span><span class="n">println</span><span class="o">!</span><span class="p">(</span><span class="s">&quot;{}&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">y</span><span class="p">);</span><span class="w"> </span><span class="c1">//~ ERROR use of moved value: `y`</span>
<span class="w">   </span><span class="o">|</span><span class="w">                        </span><span class="o">^</span><span class="w"> </span><span class="n">value</span><span class="w"> </span><span class="n">borrowed</span><span class="w"> </span><span class="n">here</span><span class="w"> </span><span class="n">after</span><span class="w"> </span><span class="k">move</span><span class="w"></span>
<span class="mi">18</span><span class="w"> </span><span class="o">|</span><span class="w">         </span><span class="k">while</span><span class="w"> </span><span class="kc">true</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="k">while</span><span class="w"> </span><span class="kc">true</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="k">while</span><span class="w"> </span><span class="kc">true</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">y</span><span class="p">;</span><span class="w"> </span><span class="n">x</span><span class="p">.</span><span class="n">clone</span><span class="p">();</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="p">}</span><span class="w"></span>
<span class="w">   </span><span class="o">|</span><span class="w">                                                    </span><span class="o">-</span><span class="w"> </span><span class="n">value</span><span class="w"> </span><span class="n">moved</span><span class="w"> </span><span class="n">here</span><span class="w"></span>
<span class="w">   </span><span class="o">|</span><span class="w"></span>
<span class="w">   </span><span class="o">=</span><span class="w"> </span><span class="n">note</span>: <span class="nc">move</span><span class="w"> </span><span class="n">occurs</span><span class="w"> </span><span class="n">because</span><span class="w"> </span><span class="err">`</span><span class="n">y</span><span class="err">`</span><span class="w"> </span><span class="n">has</span><span class="w"> </span><span class="k">type</span> <span class="err">`</span><span class="n">std</span>::<span class="n">boxed</span>::<span class="nb">Box</span><span class="o">&lt;</span><span class="kt">isize</span><span class="o">&gt;</span><span class="err">`</span><span class="p">,</span><span class="w"> </span><span class="n">which</span><span class="w"> </span><span class="n">does</span><span class="w"> </span><span class="n">not</span><span class="w"> </span><span class="n">implement</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="err">`</span><span class="nb">Copy</span><span class="err">`</span><span class="w"> </span><span class="k">trait</span><span class="w"></span>

<span class="n">error</span><span class="p">[</span><span class="n">E0382</span><span class="p">]</span>: <span class="nc">use</span><span class="w"> </span><span class="n">of</span><span class="w"> </span><span class="n">moved</span><span class="w"> </span><span class="n">value</span>: <span class="err">`</span><span class="n">y</span><span class="err">`</span><span class="w"></span>
<span class="w">  </span><span class="o">-</span>-&gt; <span class="p">.</span><span class="o">/</span><span class="n">src</span><span class="o">/</span><span class="n">test</span><span class="o">/</span><span class="n">ui</span><span class="o">/</span><span class="n">liveness</span><span class="o">/</span><span class="n">liveness</span><span class="o">-</span><span class="k">move</span><span class="o">-</span><span class="k">in</span><span class="o">-</span><span class="k">while</span><span class="p">.</span><span class="n">rs</span>:<span class="mi">18</span>:<span class="mi">52</span><span class="w"></span>
<span class="w">   </span><span class="o">|</span><span class="w"></span>
<span class="mi">18</span><span class="w"> </span><span class="o">|</span><span class="w">         </span><span class="k">while</span><span class="w"> </span><span class="kc">true</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="k">while</span><span class="w"> </span><span class="kc">true</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="k">while</span><span class="w"> </span><span class="kc">true</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">y</span><span class="p">;</span><span class="w"> </span><span class="n">x</span><span class="p">.</span><span class="n">clone</span><span class="p">();</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="p">}</span><span class="w"></span>
<span class="w">   </span><span class="o">|</span><span class="w">                                                    </span><span class="o">^</span><span class="w"> </span><span class="n">value</span><span class="w"> </span><span class="n">moved</span><span class="w"> </span><span class="n">here</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="n">previous</span><span class="w"> </span><span class="n">iteration</span><span class="w"> </span><span class="n">of</span><span class="w"> </span><span class="k">loop</span><span class="w"></span>
<span class="w">   </span><span class="o">|</span><span class="w"></span>
<span class="w">   </span><span class="o">=</span><span class="w"> </span><span class="n">note</span>: <span class="nc">move</span><span class="w"> </span><span class="n">occurs</span><span class="w"> </span><span class="n">because</span><span class="w"> </span><span class="err">`</span><span class="n">y</span><span class="err">`</span><span class="w"> </span><span class="n">has</span><span class="w"> </span><span class="k">type</span> <span class="err">`</span><span class="n">std</span>::<span class="n">boxed</span>::<span class="nb">Box</span><span class="o">&lt;</span><span class="kt">isize</span><span class="o">&gt;</span><span class="err">`</span><span class="p">,</span><span class="w"> </span><span class="n">which</span><span class="w"> </span><span class="n">does</span><span class="w"> </span><span class="n">not</span><span class="w"> </span><span class="n">implement</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="err">`</span><span class="nb">Copy</span><span class="err">`</span><span class="w"> </span><span class="k">trait</span><span class="w"></span>

<span class="n">error</span>: <span class="nc">aborting</span><span class="w"> </span><span class="n">due</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="mi">2</span><span class="w"> </span><span class="n">previous</span><span class="w"> </span><span class="n">errors</span><span class="w"></span>

<span class="n">For</span><span class="w"> </span><span class="n">more</span><span class="w"> </span><span class="n">information</span><span class="w"> </span><span class="n">about</span><span class="w"> </span><span class="n">this</span><span class="w"> </span><span class="n">error</span><span class="p">,</span><span class="w"> </span><span class="n">try</span><span class="w"> </span><span class="err">`</span><span class="n">rustc</span><span class="w"> </span><span class="o">--</span><span class="n">explain</span><span class="w"> </span><span class="n">E0382</span><span class="err">`</span><span class="p">.</span><span class="w"></span>
</pre></div>



<a name="134757812"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2354015%20Improve%20move%20error%20loop%20detection/near/134757812" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> blitzerr <a href="https://rust-lang.github.io/zulip_archive/stream/122657-t-compiler/wg-nll/topic/.2354015.20Improve.20move.20error.20loop.20detection.html#134757812">(Sep 27 2018 at 16:42)</a>:</h4>
<div class="codehilite"><pre><span></span>
</pre></div>



<a name="134757818"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2354015%20Improve%20move%20error%20loop%20detection/near/134757818" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> blitzerr <a href="https://rust-lang.github.io/zulip_archive/stream/122657-t-compiler/wg-nll/topic/.2354015.20Improve.20move.20error.20loop.20detection.html#134757818">(Sep 27 2018 at 16:43)</a>:</h4>
<div class="codehilite"><pre><span></span>
</pre></div>



<a name="134757830"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2354015%20Improve%20move%20error%20loop%20detection/near/134757830" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> blitzerr <a href="https://rust-lang.github.io/zulip_archive/stream/122657-t-compiler/wg-nll/topic/.2354015.20Improve.20move.20error.20loop.20detection.html#134757830">(Sep 27 2018 at 16:43)</a>:</h4>
<div class="codehilite"><pre><span></span>$ rustc +nightly -vV
rustc 1.28.0-nightly (cbc4c8380 2018-06-22)
binary: rustc
commit-hash: cbc4c8380fb92a719ae9be40f9da44ca7e3e2f3f
commit-date: 2018-06-22
host: x86_64-apple-darwin
release: 1.28.0-nightly
LLVM version: 6.0
</pre></div>



<a name="134757854"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2354015%20Improve%20move%20error%20loop%20detection/near/134757854" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> blitzerr <a href="https://rust-lang.github.io/zulip_archive/stream/122657-t-compiler/wg-nll/topic/.2354015.20Improve.20move.20error.20loop.20detection.html#134757854">(Sep 27 2018 at 16:43)</a>:</h4>
<div class="codehilite"><pre><span></span> rustc +stage1 -vV
rustc 1.30.0-dev
binary: rustc
commit-hash: unknown
commit-date: unknown
host: x86_64-apple-darwin
release: 1.30.0-dev
LLVM version: 8.0
</pre></div>



<a name="134761771"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2354015%20Improve%20move%20error%20loop%20detection/near/134761771" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://rust-lang.github.io/zulip_archive/stream/122657-t-compiler/wg-nll/topic/.2354015.20Improve.20move.20error.20loop.20detection.html#134761771">(Sep 27 2018 at 17:44)</a>:</h4>
<p><span class="user-mention" data-user-id="128294">@blitzerr</span> <code>rustup update nightly</code>, perhaps?</p>



<a name="134761787"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2354015%20Improve%20move%20error%20loop%20detection/near/134761787" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://rust-lang.github.io/zulip_archive/stream/122657-t-compiler/wg-nll/topic/.2354015.20Improve.20move.20error.20loop.20detection.html#134761787">(Sep 27 2018 at 17:44)</a>:</h4>
<p>in particular your nightly is super old :)</p>



<a name="134761798"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2354015%20Improve%20move%20error%20loop%20detection/near/134761798" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://rust-lang.github.io/zulip_archive/stream/122657-t-compiler/wg-nll/topic/.2354015.20Improve.20move.20error.20loop.20detection.html#134761798">(Sep 27 2018 at 17:45)</a>:</h4>
<p>my nightly is:</p>
<div class="codehilite"><pre><span></span>athena. rustc +nightly -vV
rustc 1.30.0-nightly (ae7fe84e8 2018-09-26)
binary: rustc
commit-hash: ae7fe84e8cf7523f6853d9786e28e9d066d4e5cd
commit-date: 2018-09-26
host: x86_64-unknown-linux-gnu
release: 1.30.0-nightly
LLVM version: 8.0
</pre></div>



<a name="134761822"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2354015%20Improve%20move%20error%20loop%20detection/near/134761822" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://rust-lang.github.io/zulip_archive/stream/122657-t-compiler/wg-nll/topic/.2354015.20Improve.20move.20error.20loop.20detection.html#134761822">(Sep 27 2018 at 17:45)</a>:</h4>
<p>what does your branch do if you supply <code>-Zborrowck=mir</code>?</p>



<a name="134761823"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2354015%20Improve%20move%20error%20loop%20detection/near/134761823" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://rust-lang.github.io/zulip_archive/stream/122657-t-compiler/wg-nll/topic/.2354015.20Improve.20move.20error.20loop.20detection.html#134761823">(Sep 27 2018 at 17:45)</a>:</h4>
<p>I don't see that above</p>



<a name="134762049"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2354015%20Improve%20move%20error%20loop%20detection/near/134762049" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> blitzerr <a href="https://rust-lang.github.io/zulip_archive/stream/122657-t-compiler/wg-nll/topic/.2354015.20Improve.20move.20error.20loop.20detection.html#134762049">(Sep 27 2018 at 17:48)</a>:</h4>
<p>I see nightly is a separate build, unrelated to the rust forked branch. Sure, I will update that</p>



<a name="134762162"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2354015%20Improve%20move%20error%20loop%20detection/near/134762162" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> blitzerr <a href="https://rust-lang.github.io/zulip_archive/stream/122657-t-compiler/wg-nll/topic/.2354015.20Improve.20move.20error.20loop.20detection.html#134762162">(Sep 27 2018 at 17:50)</a>:</h4>
<p>I will get back to you on that flag <code>-Zborrowck=mir</code>?<br>
I think it will work like a charm. <span class="emoji emoji-1f642" title="slight smile">:slight_smile:</span><br>
Don't have my laptop with me right now <span class="user-mention" data-user-id="116009">@nikomatsakis</span></p>



<a name="134762995"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2354015%20Improve%20move%20error%20loop%20detection/near/134762995" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://rust-lang.github.io/zulip_archive/stream/122657-t-compiler/wg-nll/topic/.2354015.20Improve.20move.20error.20loop.20detection.html#134762995">(Sep 27 2018 at 18:02)</a>:</h4>
<p><span class="user-mention" data-user-id="128294">@blitzerr</span> ok</p>



<a name="134796430"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2354015%20Improve%20move%20error%20loop%20detection/near/134796430" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> blitzerr <a href="https://rust-lang.github.io/zulip_archive/stream/122657-t-compiler/wg-nll/topic/.2354015.20Improve.20move.20error.20loop.20detection.html#134796430">(Sep 28 2018 at 05:25)</a>:</h4>
<p><a href="https://github.com/rust-lang/rust/pull/54343/commits/a4ccbdbb939b7c3d63fadef24ec9fcda5f789347" target="_blank" title="https://github.com/rust-lang/rust/pull/54343/commits/a4ccbdbb939b7c3d63fadef24ec9fcda5f789347">https://github.com/rust-lang/rust/pull/54343/commits/a4ccbdbb939b7c3d63fadef24ec9fcda5f789347</a></p>
<p><span class="user-mention" data-user-id="116009">@nikomatsakis</span>  The PR fixes <a href="https://github.com/rust-lang/rust/issues/54015" target="_blank" title="https://github.com/rust-lang/rust/issues/54015">#54015</a>. Please take a look at you convenience and let me know.</p>
<div class="codehilite"><pre><span></span>$ rustc +stage1 src/test/ui/liveness/liveness-move-in-while.rs -Zborrowck=mir -Ztwo-phase-borrows
error[E0382]: borrow of moved value: `y`
  --&gt; src/test/ui/liveness/liveness-move-in-while.rs:17:24
   |
17 |         println!(&quot;{}&quot;, y); //~ ERROR use of moved value: `y`
   |                        ^ value borrowed here after move
18 |         while true { while true { while true { x = y; x.clone(); } } }
   |                                                    - value moved here, in previous iteration of loop
   |
   = note: move occurs because `y` has type `std::boxed::Box&lt;isize&gt;`, which does not implement the `Copy` trait

error: aborting due to previous error
</pre></div>


<p>Gives the desired error message now and as you can see, it also has the comma. :D</p>



<a name="134811345"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2354015%20Improve%20move%20error%20loop%20detection/near/134811345" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> davidtwco <a href="https://rust-lang.github.io/zulip_archive/stream/122657-t-compiler/wg-nll/topic/.2354015.20Improve.20move.20error.20loop.20detection.html#134811345">(Sep 28 2018 at 09:10)</a>:</h4>
<p>Looks great <span class="user-mention" data-user-id="128294">@blitzerr</span>, I added a couple small nits when I was taking a peek.</p>



<a name="134816849"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2354015%20Improve%20move%20error%20loop%20detection/near/134816849" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> blitzerr <a href="https://rust-lang.github.io/zulip_archive/stream/122657-t-compiler/wg-nll/topic/.2354015.20Improve.20move.20error.20loop.20detection.html#134816849">(Sep 28 2018 at 11:14)</a>:</h4>
<p>Thanks <span class="user-mention" data-user-id="116107">@davidtwco</span>  for taking a look. I will address them.</p>



<a name="134818268"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2354015%20Improve%20move%20error%20loop%20detection/near/134818268" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> blitzerr <a href="https://rust-lang.github.io/zulip_archive/stream/122657-t-compiler/wg-nll/topic/.2354015.20Improve.20move.20error.20loop.20detection.html#134818268">(Sep 28 2018 at 11:48)</a>:</h4>
<p><span class="user-mention" data-user-id="116107">@davidtwco</span>  I updated my PR with your suggestions.</p>



<a name="134821347"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2354015%20Improve%20move%20error%20loop%20detection/near/134821347" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> davidtwco <a href="https://rust-lang.github.io/zulip_archive/stream/122657-t-compiler/wg-nll/topic/.2354015.20Improve.20move.20error.20loop.20detection.html#134821347">(Sep 28 2018 at 12:50)</a>:</h4>
<p>You'll need to <code>--bless</code> some of the UI tests that made fail <span class="user-mention" data-user-id="128294">@blitzerr</span>.</p>



<a name="134821371"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2354015%20Improve%20move%20error%20loop%20detection/near/134821371" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> davidtwco <a href="https://rust-lang.github.io/zulip_archive/stream/122657-t-compiler/wg-nll/topic/.2354015.20Improve.20move.20error.20loop.20detection.html#134821371">(Sep 28 2018 at 12:50)</a>:</h4>
<p>Otherwise, the nits seem fixed!</p>



<a name="134821375"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2354015%20Improve%20move%20error%20loop%20detection/near/134821375" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> davidtwco <a href="https://rust-lang.github.io/zulip_archive/stream/122657-t-compiler/wg-nll/topic/.2354015.20Improve.20move.20error.20loop.20detection.html#134821375">(Sep 28 2018 at 12:50)</a>:</h4>
<p><span class="emoji emoji-1f389" title="tada">:tada:</span></p>



<a name="134821644"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2354015%20Improve%20move%20error%20loop%20detection/near/134821644" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> blitzerr <a href="https://rust-lang.github.io/zulip_archive/stream/122657-t-compiler/wg-nll/topic/.2354015.20Improve.20move.20error.20loop.20detection.html#134821644">(Sep 28 2018 at 12:55)</a>:</h4>
<p>Currently doing that. <span class="emoji emoji-1f642" title="slight smile">:slight_smile:</span>Will update the PR once the UI tests runs fine locally</p>



<a name="134821649"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2354015%20Improve%20move%20error%20loop%20detection/near/134821649" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> blitzerr <a href="https://rust-lang.github.io/zulip_archive/stream/122657-t-compiler/wg-nll/topic/.2354015.20Improve.20move.20error.20loop.20detection.html#134821649">(Sep 28 2018 at 12:55)</a>:</h4>
<p>Thanks for reviewing <span class="user-mention" data-user-id="116107">@davidtwco</span></p>



<a name="134830345"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2354015%20Improve%20move%20error%20loop%20detection/near/134830345" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> blitzerr <a href="https://rust-lang.github.io/zulip_archive/stream/122657-t-compiler/wg-nll/topic/.2354015.20Improve.20move.20error.20loop.20detection.html#134830345">(Sep 28 2018 at 14:59)</a>:</h4>
<p><span class="user-mention" data-user-id="116009">@nikomatsakis</span> <br>
I saw you mention me on GitHub. Are you not able to access my new PR ?</p>



<a name="134830375"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2354015%20Improve%20move%20error%20loop%20detection/near/134830375" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> blitzerr <a href="https://rust-lang.github.io/zulip_archive/stream/122657-t-compiler/wg-nll/topic/.2354015.20Improve.20move.20error.20loop.20detection.html#134830375">(Sep 28 2018 at 14:59)</a>:</h4>
<p>What can I do to help you (not that you need any<span class="emoji emoji-1f600" title="grinning">:grinning:</span>)?</p>



<a name="134830832"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2354015%20Improve%20move%20error%20loop%20detection/near/134830832" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://rust-lang.github.io/zulip_archive/stream/122657-t-compiler/wg-nll/topic/.2354015.20Improve.20move.20error.20loop.20detection.html#134830832">(Sep 28 2018 at 15:05)</a>:</h4>
<p>I am able to</p>



<a name="134830836"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2354015%20Improve%20move%20error%20loop%20detection/near/134830836" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://rust-lang.github.io/zulip_archive/stream/122657-t-compiler/wg-nll/topic/.2354015.20Improve.20move.20error.20loop.20detection.html#134830836">(Sep 28 2018 at 15:05)</a>:</h4>
<p>I just wanted to have a link from the main issue</p>



<a name="134830846"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2354015%20Improve%20move%20error%20loop%20detection/near/134830846" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://rust-lang.github.io/zulip_archive/stream/122657-t-compiler/wg-nll/topic/.2354015.20Improve.20move.20error.20loop.20detection.html#134830846">(Sep 28 2018 at 15:05)</a>:</h4>
<p>(normally, in your PR description, you would "cite" the issue, and it would get created automatically)</p>



<a name="134835414"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2354015%20Improve%20move%20error%20loop%20detection/near/134835414" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> blitzerr <a href="https://rust-lang.github.io/zulip_archive/stream/122657-t-compiler/wg-nll/topic/.2354015.20Improve.20move.20error.20loop.20detection.html#134835414">(Sep 28 2018 at 16:17)</a>:</h4>
<p>I did cite it like this: <br>
<code>[54015] NLL:Improve move error loop detection</code></p>



<a name="134835487"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2354015%20Improve%20move%20error%20loop%20detection/near/134835487" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> blitzerr <a href="https://rust-lang.github.io/zulip_archive/stream/122657-t-compiler/wg-nll/topic/.2354015.20Improve.20move.20error.20loop.20detection.html#134835487">(Sep 28 2018 at 16:18)</a>:</h4>
<p>Maybe the square brackets messes up the back-linking <span class="emoji emoji-1f642" title="slight smile">:slight_smile:</span></p>



<a name="134835702"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2354015%20Improve%20move%20error%20loop%20detection/near/134835702" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> lqd <a href="https://rust-lang.github.io/zulip_archive/stream/122657-t-compiler/wg-nll/topic/.2354015.20Improve.20move.20error.20loop.20detection.html#134835702">(Sep 28 2018 at 16:21)</a>:</h4>
<p>you can cite using github's special syntax: in your PR's description (or any comment) using the issue number like "<a href="https://github.com/rust-lang/rust/issues/54015" target="_blank" title="https://github.com/rust-lang/rust/issues/54015">#54015</a>", it will create a backlink from this 54015 issue to the PR/comment, so it's easy to track using links directly in the issue page (rather than search if we don't)</p>



<a name="134836078"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2354015%20Improve%20move%20error%20loop%20detection/near/134836078" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> blitzerr <a href="https://rust-lang.github.io/zulip_archive/stream/122657-t-compiler/wg-nll/topic/.2354015.20Improve.20move.20error.20loop.20detection.html#134836078">(Sep 28 2018 at 16:27)</a>:</h4>
<p>I just added the test fixes to make Travis happy and I added the "#" before 54015 and things look fine.<br>
Sorry guys</p>



<a name="134836152"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2354015%20Improve%20move%20error%20loop%20detection/near/134836152" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> lqd <a href="https://rust-lang.github.io/zulip_archive/stream/122657-t-compiler/wg-nll/topic/.2354015.20Improve.20move.20error.20loop.20detection.html#134836152">(Sep 28 2018 at 16:28)</a>:</h4>
<p><span class="user-mention" data-user-id="128294">@blitzerr</span> there are no worries whatsoever</p>



<a name="134836162"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2354015%20Improve%20move%20error%20loop%20detection/near/134836162" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> blitzerr <a href="https://rust-lang.github.io/zulip_archive/stream/122657-t-compiler/wg-nll/topic/.2354015.20Improve.20move.20error.20loop.20detection.html#134836162">(Sep 28 2018 at 16:29)</a>:</h4>
<p>:D</p>



<a name="134836171"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2354015%20Improve%20move%20error%20loop%20detection/near/134836171" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> lqd <a href="https://rust-lang.github.io/zulip_archive/stream/122657-t-compiler/wg-nll/topic/.2354015.20Improve.20move.20error.20loop.20detection.html#134836171">(Sep 28 2018 at 16:29)</a>:</h4>
<p><span class="user-mention" data-user-id="128294">@blitzerr</span> thanks for the awesome work</p>



<a name="134836174"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2354015%20Improve%20move%20error%20loop%20detection/near/134836174" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> blitzerr <a href="https://rust-lang.github.io/zulip_archive/stream/122657-t-compiler/wg-nll/topic/.2354015.20Improve.20move.20error.20loop.20detection.html#134836174">(Sep 28 2018 at 16:29)</a>:</h4>
<p><span class="emoji emoji-1f604" title="big smile">:big_smile:</span></p>



<a name="134836266"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2354015%20Improve%20move%20error%20loop%20detection/near/134836266" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> blitzerr <a href="https://rust-lang.github.io/zulip_archive/stream/122657-t-compiler/wg-nll/topic/.2354015.20Improve.20move.20error.20loop.20detection.html#134836266">(Sep 28 2018 at 16:30)</a>:</h4>
<p>Not quite <span class="user-mention" data-user-id="116113">@lqd</span> , it took me a long time to get the first PR out. It should have been trivial piece of work. <span class="emoji emoji-1f642" title="slight smile">:slight_smile:</span></p>



<a name="134836269"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2354015%20Improve%20move%20error%20loop%20detection/near/134836269" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> lqd <a href="https://rust-lang.github.io/zulip_archive/stream/122657-t-compiler/wg-nll/topic/.2354015.20Improve.20move.20error.20loop.20detection.html#134836269">(Sep 28 2018 at 16:30)</a>:</h4>
<p>(easy access to the PR: <a href="https://github.com/rust-lang/rust/issues/54343" target="_blank" title="https://github.com/rust-lang/rust/issues/54343">#54343</a>)</p>



<a name="134836448"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2354015%20Improve%20move%20error%20loop%20detection/near/134836448" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> lqd <a href="https://rust-lang.github.io/zulip_archive/stream/122657-t-compiler/wg-nll/topic/.2354015.20Improve.20move.20error.20loop.20detection.html#134836448">(Sep 28 2018 at 16:34)</a>:</h4>
<p>let's just say that rustc and the whole environment wasn't trivial to me for my first PR <span class="user-mention" data-user-id="128294">@blitzerr</span> :) nicely done in any case <span class="emoji emoji-1f44d" title="thumbs up">:thumbs_up:</span></p>



<a name="134836665"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2354015%20Improve%20move%20error%20loop%20detection/near/134836665" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> blitzerr <a href="https://rust-lang.github.io/zulip_archive/stream/122657-t-compiler/wg-nll/topic/.2354015.20Improve.20move.20error.20loop.20detection.html#134836665">(Sep 28 2018 at 16:39)</a>:</h4>
<p>Everyone here I have interacted with  is very kind and helpful. It makes it a great experience. Thanks all <span class="emoji emoji-1f44f" title="clap">:clap:</span></p>



<a name="134845473"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2354015%20Improve%20move%20error%20loop%20detection/near/134845473" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://rust-lang.github.io/zulip_archive/stream/122657-t-compiler/wg-nll/topic/.2354015.20Improve.20move.20error.20loop.20detection.html#134845473">(Sep 28 2018 at 19:16)</a>:</h4>
<p><span class="user-mention" data-user-id="128294">@blitzerr</span> still seeing some failures in your PR though — do you know what those are about?</p>



<a name="134845475"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2354015%20Improve%20move%20error%20loop%20detection/near/134845475" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://rust-lang.github.io/zulip_archive/stream/122657-t-compiler/wg-nll/topic/.2354015.20Improve.20move.20error.20loop.20detection.html#134845475">(Sep 28 2018 at 19:16)</a>:</h4>
<p>I didn't look too closely</p>



<a name="134845484"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2354015%20Improve%20move%20error%20loop%20detection/near/134845484" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://rust-lang.github.io/zulip_archive/stream/122657-t-compiler/wg-nll/topic/.2354015.20Improve.20move.20error.20loop.20detection.html#134845484">(Sep 28 2018 at 19:16)</a>:</h4>
<p>ah, looks like you need to run <code>x.py test</code> with <code>--bless</code></p>



<a name="134845485"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2354015%20Improve%20move%20error%20loop%20detection/near/134845485" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://rust-lang.github.io/zulip_archive/stream/122657-t-compiler/wg-nll/topic/.2354015.20Improve.20move.20error.20loop.20detection.html#134845485">(Sep 28 2018 at 19:16)</a>:</h4>
<p>to update the reference files</p>



<a name="134845511"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2354015%20Improve%20move%20error%20loop%20detection/near/134845511" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://rust-lang.github.io/zulip_archive/stream/122657-t-compiler/wg-nll/topic/.2354015.20Improve.20move.20error.20loop.20detection.html#134845511">(Sep 28 2018 at 19:17)</a>:</h4>
<p>otherwise, looking great!</p>



<a name="134846493"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2354015%20Improve%20move%20error%20loop%20detection/near/134846493" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> blitzerr <a href="https://rust-lang.github.io/zulip_archive/stream/122657-t-compiler/wg-nll/topic/.2354015.20Improve.20move.20error.20loop.20detection.html#134846493">(Sep 28 2018 at 19:35)</a>:</h4>
<p>I did run bless on the files for which I got error locally. Will do that again. Thanks for taking a look <span class="user-mention" data-user-id="116009">@nikomatsakis</span></p>



<a name="134884382"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2354015%20Improve%20move%20error%20loop%20detection/near/134884382" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> blitzerr <a href="https://rust-lang.github.io/zulip_archive/stream/122657-t-compiler/wg-nll/topic/.2354015.20Improve.20move.20error.20loop.20detection.html#134884382">(Sep 29 2018 at 14:19)</a>:</h4>
<p><a href="https://travis-ci.org/rust-lang/rust/builds/434870102?utm_source=github_status&amp;utm_medium=notification" target="_blank" title="https://travis-ci.org/rust-lang/rust/builds/434870102?utm_source=github_status&amp;utm_medium=notification">https://travis-ci.org/rust-lang/rust/builds/434870102?utm_source=github_status&amp;utm_medium=notification</a></p>
<p>The build passed.</p>



<a name="134985767"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2354015%20Improve%20move%20error%20loop%20detection/near/134985767" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://rust-lang.github.io/zulip_archive/stream/122657-t-compiler/wg-nll/topic/.2354015.20Improve.20move.20error.20loop.20detection.html#134985767">(Oct 01 2018 at 17:55)</a>:</h4>
<p><span class="user-mention" data-user-id="128294">@blitzerr</span> great!</p>



<a name="134991863"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2354015%20Improve%20move%20error%20loop%20detection/near/134991863" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> blitzerr <a href="https://rust-lang.github.io/zulip_archive/stream/122657-t-compiler/wg-nll/topic/.2354015.20Improve.20move.20error.20loop.20detection.html#134991863">(Oct 01 2018 at 19:38)</a>:</h4>
<p>I think this failed again. How to run compile test for UI suite in "compare_mode=nll"?</p>



<a name="134991998"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2354015%20Improve%20move%20error%20loop%20detection/near/134991998" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Matthew Jasper <a href="https://rust-lang.github.io/zulip_archive/stream/122657-t-compiler/wg-nll/topic/.2354015.20Improve.20move.20error.20loop.20detection.html#134991998">(Oct 01 2018 at 19:41)</a>:</h4>
<p><code>./x.py test src/test/ui --bless</code> (--bless will update test output for you), you'll also want to add <code>-i</code>, <code>--stage 1</code>, etc. to match how you're building.</p>



<a name="134992046"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2354015%20Improve%20move%20error%20loop%20detection/near/134992046" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Matthew Jasper <a href="https://rust-lang.github.io/zulip_archive/stream/122657-t-compiler/wg-nll/topic/.2354015.20Improve.20move.20error.20loop.20detection.html#134992046">(Oct 01 2018 at 19:42)</a>:</h4>
<p>That will run in non-compare mode first</p>



<hr><p>Last updated: Aug 07 2021 at 22:04 UTC</p>
</html>