<html>
<head><meta charset="utf-8"><title>#57202 bounds from promoted constant · t-compiler/wg-nll · Zulip Chat Archive</title></head>
<h2>Stream: <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/index.html">t-compiler/wg-nll</a></h2>
<h3>Topic: <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2357202.20bounds.20from.20promoted.20constant.html">#57202 bounds from promoted constant</a></h3>

<hr>

<base href="https://rust-lang.zulipchat.com">

<head><link href="https://zulip-archive.rust-lang.org/style.css" rel="stylesheet"></head>

<a name="159622218"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2357202%20bounds%20from%20promoted%20constant/near/159622218" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2357202.20bounds.20from.20promoted.20constant.html#159622218">(Feb 28 2019 at 15:15)</a>:</h4>
<p>Hey <span class="user-mention" data-user-id="116118">@Matthew Jasper</span> -- can we schedule a time to chat about <a href="https://github.com/rust-lang/rust/pull/57202" target="_blank" title="https://github.com/rust-lang/rust/pull/57202">https://github.com/rust-lang/rust/pull/57202</a>, together with <span class="user-mention" data-user-id="116083">@pnkfelix</span> perhaps? I'd be available tomorrow for the most part, or we can find a time next week</p>



<a name="159622423"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2357202%20bounds%20from%20promoted%20constant/near/159622423" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Matthew Jasper <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2357202.20bounds.20from.20promoted.20constant.html#159622423">(Feb 28 2019 at 15:17)</a>:</h4>
<p>I'll probably be available from 19:00 UTC tomorrow</p>



<a name="159739538"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2357202%20bounds%20from%20promoted%20constant/near/159739538" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2357202.20bounds.20from.20promoted.20constant.html#159739538">(Mar 01 2019 at 19:01)</a>:</h4>
<p>So today turned out to be terrible :P</p>



<a name="159739547"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2357202%20bounds%20from%20promoted%20constant/near/159739547" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2357202.20bounds.20from.20promoted.20constant.html#159739547">(Mar 01 2019 at 19:01)</a>:</h4>
<p>I mean it's not over yet</p>



<a name="159739643"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2357202%20bounds%20from%20promoted%20constant/near/159739643" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Matthew Jasper <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2357202.20bounds.20from.20promoted.20constant.html#159739643">(Mar 01 2019 at 19:02)</a>:</h4>
<p>I'm available now if you want to talk. Otherwise I'm available from around this time most weekdays.</p>



<a name="159739788"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2357202%20bounds%20from%20promoted%20constant/near/159739788" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2357202.20bounds.20from.20promoted.20constant.html#159739788">(Mar 01 2019 at 19:04)</a>:</h4>
<p>I was going to suggest before the NLL meeting next week</p>



<a name="159739800"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2357202%20bounds%20from%20promoted%20constant/near/159739800" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2357202.20bounds.20from.20promoted.20constant.html#159739800">(Mar 01 2019 at 19:05)</a>:</h4>
<p>Probably that doesn't work for <span class="user-mention" data-user-id="116083">@pnkfelix</span> but that's .. probably ok</p>



<a name="159739826"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2357202%20bounds%20from%20promoted%20constant/near/159739826" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2357202.20bounds.20from.20promoted.20constant.html#159739826">(Mar 01 2019 at 19:05)</a>:</h4>
<p>I'd kind of like to focus on finish up my to do list for this week at the moment, if that's ok, and this doesn't seem <em>that</em> urgent</p>



<a name="159739836"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2357202%20bounds%20from%20promoted%20constant/near/159739836" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2357202.20bounds.20from.20promoted.20constant.html#159739836">(Mar 01 2019 at 19:05)</a>:</h4>
<p>If that works for you, I'll add a calendar event?</p>



<a name="159739841"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2357202%20bounds%20from%20promoted%20constant/near/159739841" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Matthew Jasper <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2357202.20bounds.20from.20promoted.20constant.html#159739841">(Mar 01 2019 at 19:05)</a>:</h4>
<blockquote>
<p>I was going to suggest before the NLL meeting next week</p>
</blockquote>
<p>Sounds good</p>



<a name="159739953"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2357202%20bounds%20from%20promoted%20constant/near/159739953" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2357202.20bounds.20from.20promoted.20constant.html#159739953">(Mar 01 2019 at 19:07)</a>:</h4>
<p>sent you a calendar invite</p>



<a name="159739960"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2357202%20bounds%20from%20promoted%20constant/near/159739960" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2357202.20bounds.20from.20promoted.20constant.html#159739960">(Mar 01 2019 at 19:07)</a>:</h4>
<p>I debated about adding to the rustc calendar but it seems...not quite to rise to that level :)</p>



<a name="159739976"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2357202%20bounds%20from%20promoted%20constant/near/159739976" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2357202.20bounds.20from.20promoted.20constant.html#159739976">(Mar 01 2019 at 19:07)</a>:</h4>
<p>thanks!</p>



<a name="160126218"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2357202%20bounds%20from%20promoted%20constant/near/160126218" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Matthew Jasper <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2357202.20bounds.20from.20promoted.20constant.html#160126218">(Mar 06 2019 at 19:25)</a>:</h4>
<p><span class="user-mention" data-user-id="116009">@nikomatsakis</span>  I might be a little late for the meeting tonight, hopefully it won't need the whole hour anyway.</p>



<a name="160127000"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2357202%20bounds%20from%20promoted%20constant/near/160127000" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2357202.20bounds.20from.20promoted.20constant.html#160127000">(Mar 06 2019 at 19:33)</a>:</h4>
<p>OK, let me know when you're around <span class="user-mention" data-user-id="116118">@Matthew Jasper</span></p>



<a name="160127719"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2357202%20bounds%20from%20promoted%20constant/near/160127719" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Matthew Jasper <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2357202.20bounds.20from.20promoted.20constant.html#160127719">(Mar 06 2019 at 19:42)</a>:</h4>
<p><span class="user-mention" data-user-id="116009">@nikomatsakis</span> I'm here</p>



<a name="160127725"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2357202%20bounds%20from%20promoted%20constant/near/160127725" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2357202.20bounds.20from.20promoted.20constant.html#160127725">(Mar 06 2019 at 19:42)</a>:</h4>
<p>Hey <span class="user-mention" data-user-id="116118">@Matthew Jasper</span> =)</p>



<a name="160127779"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2357202%20bounds%20from%20promoted%20constant/near/160127779" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2357202.20bounds.20from.20promoted.20constant.html#160127779">(Mar 06 2019 at 19:43)</a>:</h4>
<p>So I'm looking over the PR</p>



<a name="160127789"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2357202%20bounds%20from%20promoted%20constant/near/160127789" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2357202.20bounds.20from.20promoted.20constant.html#160127789">(Mar 06 2019 at 19:43)</a>:</h4>
<p>I'm trying to make a good summary of what it does, to start</p>



<a name="160127802"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2357202%20bounds%20from%20promoted%20constant/near/160127802" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2357202.20bounds.20from.20promoted.20constant.html#160127802">(Mar 06 2019 at 19:43)</a>:</h4>
<p>I think the behavior that I would hope to see is something analogous to what we do for closures:</p>



<a name="160127821"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2357202%20bounds%20from%20promoted%20constant/near/160127821" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2357202.20bounds.20from.20promoted.20constant.html#160127821">(Mar 06 2019 at 19:43)</a>:</h4>
<p>We have some kind of query that we can execute which types the constant and produces a "constraint set" that we can incorporate into our result</p>



<a name="160127833"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2357202%20bounds%20from%20promoted%20constant/near/160127833" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2357202.20bounds.20from.20promoted.20constant.html#160127833">(Mar 06 2019 at 19:43)</a>:</h4>
<p>I'm curious if you considered that and why it didn't work</p>



<a name="160127887"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2357202%20bounds%20from%20promoted%20constant/near/160127887" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2357202.20bounds.20from.20promoted.20constant.html#160127887">(Mar 06 2019 at 19:44)</a>:</h4>
<p>Re-reading the PR, it looks .. kind of like what it does</p>



<a name="160127982"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2357202%20bounds%20from%20promoted%20constant/near/160127982" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2357202.20bounds.20from.20promoted.20constant.html#160127982">(Mar 06 2019 at 19:45)</a>:</h4>
<p>I guess that on each reference to a promoted constant</p>



<a name="160127988"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2357202%20bounds%20from%20promoted%20constant/near/160127988" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2357202.20bounds.20from.20promoted.20constant.html#160127988">(Mar 06 2019 at 19:45)</a>:</h4>
<p>we run the type-check on it <strong>again</strong></p>



<a name="160127999"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2357202%20bounds%20from%20promoted%20constant/near/160127999" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2357202.20bounds.20from.20promoted.20constant.html#160127999">(Mar 06 2019 at 19:45)</a>:</h4>
<p>I suppose most promoted constants are only referenced once</p>



<a name="160128058"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2357202%20bounds%20from%20promoted%20constant/near/160128058" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Matthew Jasper <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2357202.20bounds.20from.20promoted.20constant.html#160128058">(Mar 06 2019 at 19:46)</a>:</h4>
<p>I considered it. I didn't like it because it felt "too heavy".</p>



<a name="160128081"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2357202%20bounds%20from%20promoted%20constant/near/160128081" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Matthew Jasper <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2357202.20bounds.20from.20promoted.20constant.html#160128081">(Mar 06 2019 at 19:46)</a>:</h4>
<blockquote>
<p>I suppose most promoted constants are only referenced once</p>
</blockquote>
<p>I think so, we definitely don't deduplicate them as much as we could</p>



<a name="160128117"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2357202%20bounds%20from%20promoted%20constant/near/160128117" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2357202.20bounds.20from.20promoted.20constant.html#160128117">(Mar 06 2019 at 19:47)</a>:</h4>
<p>Probably that de-duplication would come later</p>



<a name="160128122"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2357202%20bounds%20from%20promoted%20constant/near/160128122" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2357202.20bounds.20from.20promoted.20constant.html#160128122">(Mar 06 2019 at 19:47)</a>:</h4>
<p>Although you could imagine doing it early</p>



<a name="160128130"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2357202%20bounds%20from%20promoted%20constant/near/160128130" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2357202.20bounds.20from.20promoted.20constant.html#160128130">(Mar 06 2019 at 19:47)</a>:</h4>
<blockquote>
<p>I considered it. I didn't like it because it felt "too heavy".</p>
</blockquote>
<p>interesting. Heavy from a runtime overhead perspective or something like that?</p>



<a name="160128137"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2357202%20bounds%20from%20promoted%20constant/near/160128137" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2357202.20bounds.20from.20promoted.20constant.html#160128137">(Mar 06 2019 at 19:47)</a>:</h4>
<p>It feels cleaner to me</p>



<a name="160128144"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2357202%20bounds%20from%20promoted%20constant/near/160128144" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2357202.20bounds.20from.20promoted.20constant.html#160128144">(Mar 06 2019 at 19:47)</a>:</h4>
<p>I guess because I really wanted us to get to the point where</p>



<a name="160128179"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2357202%20bounds%20from%20promoted%20constant/near/160128179" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Matthew Jasper <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2357202.20bounds.20from.20promoted.20constant.html#160128179">(Mar 06 2019 at 19:48)</a>:</h4>
<p>Yes, they're deduplicated in the llvm output.</p>



<a name="160128203"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2357202%20bounds%20from%20promoted%20constant/near/160128203" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2357202.20bounds.20from.20promoted.20constant.html#160128203">(Mar 06 2019 at 19:48)</a>:</h4>
<p>we weren't type-checking multiple MIR functions within one context</p>



<a name="160128228"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2357202%20bounds%20from%20promoted%20constant/near/160128228" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2357202.20bounds.20from.20promoted.20constant.html#160128228">(Mar 06 2019 at 19:48)</a>:</h4>
<p>it feels "confusing" to do so, since regions are sets of points, but points from which MIR?</p>



<a name="160128261"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2357202%20bounds%20from%20promoted%20constant/near/160128261" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Matthew Jasper <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2357202.20bounds.20from.20promoted.20constant.html#160128261">(Mar 06 2019 at 19:49)</a>:</h4>
<p>Yes, I essential collapsed the promoted MIR to a point</p>



<a name="160128284"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2357202%20bounds%20from%20promoted%20constant/near/160128284" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2357202.20bounds.20from.20promoted.20constant.html#160128284">(Mar 06 2019 at 19:49)</a>:</h4>
<p>I guess that is this line:</p>
<blockquote>
<p>constraint.locations = locations;</p>
</blockquote>



<a name="160128360"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2357202%20bounds%20from%20promoted%20constant/near/160128360" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2357202.20bounds.20from.20promoted.20constant.html#160128360">(Mar 06 2019 at 19:50)</a>:</h4>
<p>how hard do you think it would be to restructure this into a recursive query?</p>



<a name="160128373"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2357202%20bounds%20from%20promoted%20constant/near/160128373" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2357202.20bounds.20from.20promoted.20constant.html#160128373">(Mar 06 2019 at 19:50)</a>:</h4>
<p>I wonder if the existing query around closures can .. mostly just work?</p>



<a name="160128386"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2357202%20bounds%20from%20promoted%20constant/near/160128386" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2357202.20bounds.20from.20promoted.20constant.html#160128386">(Mar 06 2019 at 19:50)</a>:</h4>
<p>in some sense a promoted constant is a lot like a closure</p>



<a name="160128395"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2357202%20bounds%20from%20promoted%20constant/near/160128395" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Matthew Jasper <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2357202.20bounds.20from.20promoted.20constant.html#160128395">(Mar 06 2019 at 19:51)</a>:</h4>
<blockquote>
<p>I guess that is this line:</p>
<blockquote>
<p>constraint.locations = locations;</p>
</blockquote>
</blockquote>
<p>yes</p>



<a name="160128576"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2357202%20bounds%20from%20promoted%20constant/near/160128576" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Matthew Jasper <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2357202.20bounds.20from.20promoted.20constant.html#160128576">(Mar 06 2019 at 19:53)</a>:</h4>
<blockquote>
<p>in some sense a promoted constant is a lot like a closure</p>
</blockquote>
<p>Except it promoteds share type annotations. I don't think I could find a case where we need to ensure the types are unified between the promoted and non-promoted MIR though.</p>



<a name="160128706"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2357202%20bounds%20from%20promoted%20constant/near/160128706" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2357202.20bounds.20from.20promoted.20constant.html#160128706">(Mar 06 2019 at 19:54)</a>:</h4>
<p>what do you mean by that?</p>



<a name="160128721"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2357202%20bounds%20from%20promoted%20constant/near/160128721" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2357202.20bounds.20from.20promoted.20constant.html#160128721">(Mar 06 2019 at 19:54)</a>:</h4>
<p>I noticed that comment</p>



<a name="160128737"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2357202%20bounds%20from%20promoted%20constant/near/160128737" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Matthew Jasper <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2357202.20bounds.20from.20promoted.20constant.html#160128737">(Mar 06 2019 at 19:55)</a>:</h4>
<blockquote>
<p>I wonder if the existing query around closures can .. mostly just work?</p>
</blockquote>
<p>As in changing the query to <code>mir_borrowck(DefId, Option&lt;Promoted&gt;)</code>, making sure that the return type uses external regions. Well, it's possible.</p>



<a name="160128753"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2357202%20bounds%20from%20promoted%20constant/near/160128753" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2357202.20bounds.20from.20promoted.20constant.html#160128753">(Mar 06 2019 at 19:55)</a>:</h4>
<p><em>ah</em>, a type annotation is the canonical version of the things users wrote by hand, right?</p>



<a name="160128802"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2357202%20bounds%20from%20promoted%20constant/near/160128802" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2357202.20bounds.20from.20promoted.20constant.html#160128802">(Mar 06 2019 at 19:55)</a>:</h4>
<p>I was looking at this line and trying to remember what it was</p>



<a name="160128855"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2357202%20bounds%20from%20promoted%20constant/near/160128855" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2357202.20bounds.20from.20promoted.20constant.html#160128855">(Mar 06 2019 at 19:56)</a>:</h4>
<p><code>user_type_annotations: &amp;'a CanonicalUserTypeAnnotations&lt;'tcx&gt;,</code></p>



<a name="160128872"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2357202%20bounds%20from%20promoted%20constant/near/160128872" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2357202.20bounds.20from.20promoted.20constant.html#160128872">(Mar 06 2019 at 19:56)</a>:</h4>
<blockquote>
<p>As in changing the query to <code>mir_borrowck(DefId, Option&lt;Promoted&gt;)</code>, making sure that the return type uses external regions. Well, it's possible.</p>
</blockquote>
<p>what is <code>Option&lt;Promoted&gt;</code> here?</p>



<a name="160128921"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2357202%20bounds%20from%20promoted%20constant/near/160128921" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Matthew Jasper <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2357202.20bounds.20from.20promoted.20constant.html#160128921">(Mar 06 2019 at 19:57)</a>:</h4>
<p>The id of the promoted we need to check, or <code>None</code> if we want to check the main MIR</p>



<a name="160129031"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2357202%20bounds%20from%20promoted%20constant/near/160129031" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Matthew Jasper <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2357202.20bounds.20from.20promoted.20constant.html#160129031">(Mar 06 2019 at 19:58)</a>:</h4>
<p>MIR contains a field <code>pub user_type_annotations: CanonicalUserTypeAnnotations&lt;'tcx&gt;,</code> which is indexed by <code>UserTypeAnnotationIndex</code>.</p>



<a name="160129070"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2357202%20bounds%20from%20promoted%20constant/near/160129070" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2357202.20bounds.20from.20promoted.20constant.html#160129070">(Mar 06 2019 at 19:58)</a>:</h4>
<blockquote>
<p>The id of the promoted we need to check, or <code>None</code> if we want to check the main MIR</p>
</blockquote>
<p>oh, right, they don't have def-ids of their own</p>



<a name="160129075"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2357202%20bounds%20from%20promoted%20constant/near/160129075" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2357202.20bounds.20from.20promoted.20constant.html#160129075">(Mar 06 2019 at 19:59)</a>:</h4>
<blockquote>
<p>MIR contains a field <code>pub user_type_annotations: CanonicalUserTypeAnnotations&lt;'tcx&gt;,</code> which is indexed by <code>UserTypeAnnotationIndex</code>.</p>
</blockquote>
<p>yeah I remember this now</p>



<a name="160129092"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2357202%20bounds%20from%20promoted%20constant/near/160129092" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Matthew Jasper <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2357202.20bounds.20from.20promoted.20constant.html#160129092">(Mar 06 2019 at 19:59)</a>:</h4>
<p>TypeAnnotations in promoted index into the list of their parent.</p>



<a name="160129103"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2357202%20bounds%20from%20promoted%20constant/near/160129103" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Matthew Jasper <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2357202.20bounds.20from.20promoted.20constant.html#160129103">(Mar 06 2019 at 19:59)</a>:</h4>
<p>i.e. we don't renumber them</p>



<a name="160129104"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2357202%20bounds%20from%20promoted%20constant/near/160129104" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2357202.20bounds.20from.20promoted.20constant.html#160129104">(Mar 06 2019 at 19:59)</a>:</h4>
<p>seems like they should really copy that field over from their parent</p>



<a name="160129108"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2357202%20bounds%20from%20promoted%20constant/near/160129108" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2357202.20bounds.20from.20promoted.20constant.html#160129108">(Mar 06 2019 at 19:59)</a>:</h4>
<p>but..</p>



<a name="160129117"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2357202%20bounds%20from%20promoted%20constant/near/160129117" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2357202.20bounds.20from.20promoted.20constant.html#160129117">(Mar 06 2019 at 19:59)</a>:</h4>
<p>...well, so,</p>



<a name="160129184"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2357202%20bounds%20from%20promoted%20constant/near/160129184" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2357202.20bounds.20from.20promoted.20constant.html#160129184">(Mar 06 2019 at 20:00)</a>:</h4>
<p>that seems to imply that type-checking the promoted constants may "inform" the user-type annot from parent, right?</p>



<a name="160129217"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2357202%20bounds%20from%20promoted%20constant/near/160129217" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2357202.20bounds.20from.20promoted.20constant.html#160129217">(Mar 06 2019 at 20:00)</a>:</h4>
<p>i.e., they may share type variables</p>



<a name="160129237"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2357202%20bounds%20from%20promoted%20constant/near/160129237" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Matthew Jasper <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2357202.20bounds.20from.20promoted.20constant.html#160129237">(Mar 06 2019 at 20:00)</a>:</h4>
<p>Yes.</p>



<a name="160129239"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2357202%20bounds%20from%20promoted%20constant/near/160129239" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2357202.20bounds.20from.20promoted.20constant.html#160129239">(Mar 06 2019 at 20:00)</a>:</h4>
<p>at least in the present setup, they definitely do</p>



<a name="160129247"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2357202%20bounds%20from%20promoted%20constant/near/160129247" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2357202.20bounds.20from.20promoted.20constant.html#160129247">(Mar 06 2019 at 20:00)</a>:</h4>
<p>that certainly complicates matters</p>



<a name="160129276"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2357202%20bounds%20from%20promoted%20constant/near/160129276" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Matthew Jasper <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2357202.20bounds.20from.20promoted.20constant.html#160129276">(Mar 06 2019 at 20:00)</a>:</h4>
<p>Well, they also shared region variables right now.</p>



<a name="160129302"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2357202%20bounds%20from%20promoted%20constant/near/160129302" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2357202.20bounds.20from.20promoted.20constant.html#160129302">(Mar 06 2019 at 20:01)</a>:</h4>
<p>in what sense?</p>



<a name="160129315"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2357202%20bounds%20from%20promoted%20constant/near/160129315" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2357202.20bounds.20from.20promoted.20constant.html#160129315">(Mar 06 2019 at 20:01)</a>:</h4>
<p>they get renumbered, no?</p>



<a name="160129333"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2357202%20bounds%20from%20promoted%20constant/near/160129333" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2357202.20bounds.20from.20promoted.20constant.html#160129333">(Mar 06 2019 at 20:01)</a>:</h4>
<p>they share free regions</p>



<a name="160129344"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2357202%20bounds%20from%20promoted%20constant/near/160129344" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Matthew Jasper <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2357202.20bounds.20from.20promoted.20constant.html#160129344">(Mar 06 2019 at 20:01)</a>:</h4>
<p>In the sense that they're renumbered together.</p>



<a name="160129348"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2357202%20bounds%20from%20promoted%20constant/near/160129348" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2357202.20bounds.20from.20promoted.20constant.html#160129348">(Mar 06 2019 at 20:01)</a>:</h4>
<p>but do they share other regions too?</p>



<a name="160129447"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2357202%20bounds%20from%20promoted%20constant/near/160129447" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Matthew Jasper <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2357202.20bounds.20from.20promoted.20constant.html#160129447">(Mar 06 2019 at 20:02)</a>:</h4>
<p>Which I guess could be described in the opposite way.</p>



<a name="160129453"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2357202%20bounds%20from%20promoted%20constant/near/160129453" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2357202.20bounds.20from.20promoted.20constant.html#160129453">(Mar 06 2019 at 20:02)</a>:</h4>
<p>:)</p>



<a name="160129468"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2357202%20bounds%20from%20promoted%20constant/near/160129468" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2357202.20bounds.20from.20promoted.20constant.html#160129468">(Mar 06 2019 at 20:03)</a>:</h4>
<p>I guess what I'm saying is, apart from free regions, they should have disjoint region variables</p>



<a name="160129498"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2357202%20bounds%20from%20promoted%20constant/near/160129498" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2357202.20bounds.20from.20promoted.20constant.html#160129498">(Mar 06 2019 at 20:03)</a>:</h4>
<p>(unless i'm misunderstanding something)</p>



<a name="160129499"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2357202%20bounds%20from%20promoted%20constant/near/160129499" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Matthew Jasper <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2357202.20bounds.20from.20promoted.20constant.html#160129499">(Mar 06 2019 at 20:03)</a>:</h4>
<p>Yes</p>



<a name="160129524"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2357202%20bounds%20from%20promoted%20constant/near/160129524" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2357202.20bounds.20from.20promoted.20constant.html#160129524">(Mar 06 2019 at 20:03)</a>:</h4>
<p>the user type annotation thing is a bit odd</p>



<a name="160129599"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2357202%20bounds%20from%20promoted%20constant/near/160129599" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2357202.20bounds.20from.20promoted.20constant.html#160129599">(Mar 06 2019 at 20:04)</a>:</h4>
<p>I guess I have to review the details of what we did there</p>



<a name="160129614"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2357202%20bounds%20from%20promoted%20constant/near/160129614" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2357202.20bounds.20from.20promoted.20constant.html#160129614">(Mar 06 2019 at 20:04)</a>:</h4>
<p>it makes me a bit nervous that the promoted can -- in theory, anyway -- influence the outside type-check by unifying some type variable</p>



<a name="160129625"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2357202%20bounds%20from%20promoted%20constant/near/160129625" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2357202.20bounds.20from.20promoted.20constant.html#160129625">(Mar 06 2019 at 20:04)</a>:</h4>
<p>otoh, I can't see why they would share type annotations with the surrounding context</p>



<a name="160129676"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2357202%20bounds%20from%20promoted%20constant/near/160129676" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2357202.20bounds.20from.20promoted.20constant.html#160129676">(Mar 06 2019 at 20:05)</a>:</h4>
<blockquote>
<p>I don't think I could find a case where we need to ensure the types are unified between the promoted and non-promoted MIR though.</p>
</blockquote>
<p>I guess this is what you were talking about here</p>



<a name="160129796"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2357202%20bounds%20from%20promoted%20constant/near/160129796" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Matthew Jasper <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2357202.20bounds.20from.20promoted.20constant.html#160129796">(Mar 06 2019 at 20:07)</a>:</h4>
<p>Yes, so the potential issue is something like:</p>
<div class="codehilite"><pre><span></span><span class="k">match</span><span class="w"> </span><span class="n">constant_with_types</span>::<span class="o">&lt;</span><span class="n">Types</span><span class="o">&gt;</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="k">ref</span><span class="w"> </span><span class="n">x</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="p">(),</span><span class="w"> </span><span class="c1">// x refernces promoted MIR</span>
<span class="w">    </span><span class="k">ref</span><span class="w"> </span><span class="n">y</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="p">(),</span><span class="w"> </span><span class="c1">// y reference different promoted MIR</span>
<span class="w">    </span><span class="k">ref</span><span class="w"> </span><span class="k">mut</span><span class="w"> </span><span class="n">z</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="p">(),</span><span class="w"> </span><span class="c1">// z references a temporary</span>
<span class="p">}</span><span class="w"></span>
</pre></div>



<a name="160129872"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2357202%20bounds%20from%20promoted%20constant/near/160129872" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Matthew Jasper <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2357202.20bounds.20from.20promoted.20constant.html#160129872">(Mar 06 2019 at 20:08)</a>:</h4>
<p>Not that sharing type annotations is obviously enough here.</p>



<a name="160129944"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2357202%20bounds%20from%20promoted%20constant/near/160129944" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2357202.20bounds.20from.20promoted.20constant.html#160129944">(Mar 06 2019 at 20:09)</a>:</h4>
<p>why would <code>x</code> and <code>y</code> reference a different promoted MIR? will we promote same MIR twice?</p>



<a name="160129965"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2357202%20bounds%20from%20promoted%20constant/near/160129965" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Matthew Jasper <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2357202.20bounds.20from.20promoted.20constant.html#160129965">(Mar 06 2019 at 20:09)</a>:</h4>
<p>Yes, we promote for each use</p>



<a name="160129972"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2357202%20bounds%20from%20promoted%20constant/near/160129972" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2357202.20bounds.20from.20promoted.20constant.html#160129972">(Mar 06 2019 at 20:09)</a>:</h4>
<p>(also, seems a bit strange that we promote <em>at all</em> there, but ...)</p>



<a name="160130020"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2357202%20bounds%20from%20promoted%20constant/near/160130020" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2357202.20bounds.20from.20promoted.20constant.html#160130020">(Mar 06 2019 at 20:10)</a>:</h4>
<p>an aside: I keep wondering about the role of a HAIR</p>



<a name="160130033"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2357202%20bounds%20from%20promoted%20constant/near/160130033" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2357202.20bounds.20from.20promoted.20constant.html#160130033">(Mar 06 2019 at 20:10)</a>:</h4>
<p>i.e., I'm not entirely convinced that promotion should operate on the MIR level</p>



<a name="160130040"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2357202%20bounds%20from%20promoted%20constant/near/160130040" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2357202.20bounds.20from.20promoted.20constant.html#160130040">(Mar 06 2019 at 20:10)</a>:</h4>
<p>but a bit late for that I guess</p>



<a name="160130054"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2357202%20bounds%20from%20promoted%20constant/near/160130054" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2357202.20bounds.20from.20promoted.20constant.html#160130054">(Mar 06 2019 at 20:10)</a>:</h4>
<p>I guess a side-effect of the above would be that <code>x</code> and <code>y</code> may have <code>'static</code> lifetime but <code>z</code> cannot?</p>



<a name="160130083"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2357202%20bounds%20from%20promoted%20constant/near/160130083" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Matthew Jasper <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2357202.20bounds.20from.20promoted.20constant.html#160130083">(Mar 06 2019 at 20:11)</a>:</h4>
<p>indeed</p>



<a name="160130096"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2357202%20bounds%20from%20promoted%20constant/near/160130096" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2357202.20bounds.20from.20promoted.20constant.html#160130096">(Mar 06 2019 at 20:11)</a>:</h4>
<p>/me grumbles</p>



<a name="160130106"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2357202%20bounds%20from%20promoted%20constant/near/160130106" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Matthew Jasper <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2357202.20bounds.20from.20promoted.20constant.html#160130106">(Mar 06 2019 at 20:11)</a>:</h4>
<p>The <code>ref mut</code> thing is arguably a bug.</p>



<a name="160130116"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2357202%20bounds%20from%20promoted%20constant/near/160130116" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2357202.20bounds.20from.20promoted.20constant.html#160130116">(Mar 06 2019 at 20:11)</a>:</h4>
<p>what about it specifically?</p>



<a name="160130124"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2357202%20bounds%20from%20promoted%20constant/near/160130124" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2357202.20bounds.20from.20promoted.20constant.html#160130124">(Mar 06 2019 at 20:11)</a>:</h4>
<p>like, what do you see as the correct behavior here?</p>



<a name="160130146"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2357202%20bounds%20from%20promoted%20constant/near/160130146" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Matthew Jasper <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2357202.20bounds.20from.20promoted.20constant.html#160130146">(Mar 06 2019 at 20:12)</a>:</h4>
<p><code>(ref mut z,)</code> prevents any promotion</p>



<a name="160130200"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2357202%20bounds%20from%20promoted%20constant/near/160130200" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Matthew Jasper <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2357202.20bounds.20from.20promoted.20constant.html#160130200">(Mar 06 2019 at 20:12)</a>:</h4>
<p>The correct behavior is for them to be the same.</p>



<a name="160130230"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2357202%20bounds%20from%20promoted%20constant/near/160130230" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2357202.20bounds.20from.20promoted.20constant.html#160130230">(Mar 06 2019 at 20:12)</a>:</h4>
<p>i.e., if we were doing <code>&amp;mut x.0</code> instead of <code>&amp;mut x</code>, we would not promote <code>x</code> anywhere</p>



<a name="160130237"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2357202%20bounds%20from%20promoted%20constant/near/160130237" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2357202.20bounds.20from.20promoted.20constant.html#160130237">(Mar 06 2019 at 20:13)</a>:</h4>
<p>I agree that feels like a bug</p>



<a name="160130249"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2357202%20bounds%20from%20promoted%20constant/near/160130249" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2357202.20bounds.20from.20promoted.20constant.html#160130249">(Mar 06 2019 at 20:13)</a>:</h4>
<p>(cc <span class="user-mention" data-user-id="124288">@oli</span> -- question about promotion here =)</p>



<a name="160130258"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2357202%20bounds%20from%20promoted%20constant/near/160130258" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2357202.20bounds.20from.20promoted.20constant.html#160130258">(Mar 06 2019 at 20:13)</a>:</h4>
<p>Or at least it feels mildly surprising</p>



<a name="160130445"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2357202%20bounds%20from%20promoted%20constant/near/160130445" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2357202.20bounds.20from.20promoted.20constant.html#160130445">(Mar 06 2019 at 20:15)</a>:</h4>
<p><span class="user-mention" data-user-id="116118">@Matthew Jasper</span> well even leaving that aside, one possibility might be that .. somehow .. type-checking <code>x</code> could influence type-checking <code>y</code>?</p>



<a name="160130457"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2357202%20bounds%20from%20promoted%20constant/near/160130457" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2357202.20bounds.20from.20promoted.20constant.html#160130457">(Mar 06 2019 at 20:15)</a>:</h4>
<p>i.e., because they share a type variable through the user-type-annot</p>



<a name="160130474"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2357202%20bounds%20from%20promoted%20constant/near/160130474" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2357202.20bounds.20from.20promoted.20constant.html#160130474">(Mar 06 2019 at 20:16)</a>:</h4>
<p>which is shared</p>



<a name="160130522"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2357202%20bounds%20from%20promoted%20constant/near/160130522" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2357202.20bounds.20from.20promoted.20constant.html#160130522">(Mar 06 2019 at 20:16)</a>:</h4>
<p>kind of hard for me to see though</p>



<a name="160130552"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2357202%20bounds%20from%20promoted%20constant/near/160130552" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2357202.20bounds.20from.20promoted.20constant.html#160130552">(Mar 06 2019 at 20:16)</a>:</h4>
<p>Also, <span class="user-mention" data-user-id="116118">@Matthew Jasper</span>, are we giving some of error if type variables from the user-type annot wind up unconstrained?</p>



<a name="160130589"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2357202%20bounds%20from%20promoted%20constant/near/160130589" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2357202.20bounds.20from.20promoted.20constant.html#160130589">(Mar 06 2019 at 20:17)</a>:</h4>
<p>Anyway, I think my conclusion from this conversation is that I would indeed prefer to try a closure-like approach, but I'm .. fairly convinced that the current one is largely equivalent in practice.</p>



<a name="160130596"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2357202%20bounds%20from%20promoted%20constant/near/160130596" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Matthew Jasper <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2357202.20bounds.20from.20promoted.20constant.html#160130596">(Mar 06 2019 at 20:17)</a>:</h4>
<p>Well, they don't share a type variable actually, since I changed type annotations to do <code>place type &lt;-&gt; inferred renumbered type &lt;-&gt; type annotation</code></p>



<a name="160130673"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2357202%20bounds%20from%20promoted%20constant/near/160130673" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Matthew Jasper <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2357202.20bounds.20from.20promoted.20constant.html#160130673">(Mar 06 2019 at 20:18)</a>:</h4>
<blockquote>
<p>Also, <span class="user-mention silent" data-user-id="116118">Matthew Jasper</span>, are we giving some of error if type variables from the user-type annot wind up unconstrained?</p>
</blockquote>
<p>I certainly haven't added one.</p>



<a name="160130690"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2357202%20bounds%20from%20promoted%20constant/near/160130690" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2357202.20bounds.20from.20promoted.20constant.html#160130690">(Mar 06 2019 at 20:18)</a>:</h4>
<blockquote>
<p>Well, they don't share a type variable actually, since I changed type annotations to do <code>place type &lt;-&gt; inferred renumbered type &lt;-&gt; type annotation</code></p>
</blockquote>
<p>what does <code>&lt;-&gt;</code> represent here?</p>



<a name="160130704"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2357202%20bounds%20from%20promoted%20constant/near/160130704" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Matthew Jasper <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2357202.20bounds.20from.20promoted.20constant.html#160130704">(Mar 06 2019 at 20:18)</a>:</h4>
<p>"Are used in the same call of <code>eq</code> or <code>sub</code>"</p>



<a name="160130744"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2357202%20bounds%20from%20promoted%20constant/near/160130744" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Matthew Jasper <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2357202.20bounds.20from.20promoted.20constant.html#160130744">(Mar 06 2019 at 20:19)</a>:</h4>
<p>Or "are related directly while type checking"</p>



<a name="160130776"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2357202%20bounds%20from%20promoted%20constant/near/160130776" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2357202.20bounds.20from.20promoted.20constant.html#160130776">(Mar 06 2019 at 20:20)</a>:</h4>
<p>ok, I'm reading into the user-type annotation</p>



<a name="160130835"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2357202%20bounds%20from%20promoted%20constant/near/160130835" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2357202.20bounds.20from.20promoted.20constant.html#160130835">(Mar 06 2019 at 20:20)</a>:</h4>
<p>I see that we have:</p>
<div class="codehilite"><pre><span></span><span class="k">pub</span><span class="w"> </span><span class="k">struct</span> <span class="nc">CanonicalUserTypeAnnotation</span><span class="o">&lt;</span><span class="na">&#39;tcx</span><span class="o">&gt;</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="k">pub</span><span class="w"> </span><span class="n">user_ty</span>: <span class="nc">CanonicalUserType</span><span class="o">&lt;</span><span class="na">&#39;tcx</span><span class="o">&gt;</span><span class="p">,</span><span class="w"></span>
<span class="w">    </span><span class="k">pub</span><span class="w"> </span><span class="n">span</span>: <span class="nc">Span</span><span class="p">,</span><span class="w"></span>
<span class="w">    </span><span class="k">pub</span><span class="w"> </span><span class="n">inferred_ty</span>: <span class="nc">Ty</span><span class="o">&lt;</span><span class="na">&#39;tcx</span><span class="o">&gt;</span><span class="p">,</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>
</pre></div>



<a name="160130851"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2357202%20bounds%20from%20promoted%20constant/near/160130851" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2357202.20bounds.20from.20promoted.20constant.html#160130851">(Mar 06 2019 at 20:20)</a>:</h4>
<p><code>inferred_ty</code>, I take it, is the type that type-check resulted in?</p>



<a name="160130900"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2357202%20bounds%20from%20promoted%20constant/near/160130900" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Matthew Jasper <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2357202.20bounds.20from.20promoted.20constant.html#160130900">(Mar 06 2019 at 20:21)</a>:</h4>
<p>Yes, although it's obtained somewhat hackily from the expression/pattern that the type annotation is being applied to.</p>



<a name="160130919"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2357202%20bounds%20from%20promoted%20constant/near/160130919" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Matthew Jasper <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2357202.20bounds.20from.20promoted.20constant.html#160130919">(Mar 06 2019 at 20:21)</a>:</h4>
<p>I think at least.</p>



<a name="160131019"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2357202%20bounds%20from%20promoted%20constant/near/160131019" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Matthew Jasper <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2357202.20bounds.20from.20promoted.20constant.html#160131019">(Mar 06 2019 at 20:22)</a>:</h4>
<p>Although now I'm not sure why it should be done that way.</p>



<a name="160131131"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2357202%20bounds%20from%20promoted%20constant/near/160131131" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2357202.20bounds.20from.20promoted.20constant.html#160131131">(Mar 06 2019 at 20:23)</a>:</h4>
<p>I was looking through the code a bit to see where it comes from</p>



<a name="160131177"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2357202%20bounds%20from%20promoted%20constant/near/160131177" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2357202.20bounds.20from.20promoted.20constant.html#160131177">(Mar 06 2019 at 20:24)</a>:</h4>
<p>I remember thinking that would be necessary</p>



<a name="160131192"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2357202%20bounds%20from%20promoted%20constant/near/160131192" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2357202.20bounds.20from.20promoted.20constant.html#160131192">(Mar 06 2019 at 20:24)</a>:</h4>
<p>but I can't entirely remember why anymore :)</p>



<a name="160131232"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2357202%20bounds%20from%20promoted%20constant/near/160131232" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2357202.20bounds.20from.20promoted.20constant.html#160131232">(Mar 06 2019 at 20:24)</a>:</h4>
<p>so yeah looks like it comes from the <code>expr.ty</code> on the HAIR expression</p>



<a name="160131238"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2357202%20bounds%20from%20promoted%20constant/near/160131238" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2357202.20bounds.20from.20promoted.20constant.html#160131238">(Mar 06 2019 at 20:25)</a>:</h4>
<p>..which is probably ok</p>



<a name="160131244"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2357202%20bounds%20from%20promoted%20constant/near/160131244" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2357202.20bounds.20from.20promoted.20constant.html#160131244">(Mar 06 2019 at 20:25)</a>:</h4>
<p>anyway an orthogonal thing</p>



<a name="160131276"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2357202%20bounds%20from%20promoted%20constant/near/160131276" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Matthew Jasper <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2357202.20bounds.20from.20promoted.20constant.html#160131276">(Mar 06 2019 at 20:25)</a>:</h4>
<p>There was a point where I remember having problems with canocicalizing one type and resolving another.</p>



<a name="160131362"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2357202%20bounds%20from%20promoted%20constant/near/160131362" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2357202.20bounds.20from.20promoted.20constant.html#160131362">(Mar 06 2019 at 20:26)</a>:</h4>
<p>right, so the scheme now is that we use the <code>inferred_ty</code> to relate to everything</p>



<a name="160131367"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2357202%20bounds%20from%20promoted%20constant/near/160131367" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2357202.20bounds.20from.20promoted.20constant.html#160131367">(Mar 06 2019 at 20:26)</a>:</h4>
<p>and then we relate the (instantiated) user-given type to <em>that</em></p>



<a name="160131396"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2357202%20bounds%20from%20promoted%20constant/near/160131396" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2357202.20bounds.20from.20promoted.20constant.html#160131396">(Mar 06 2019 at 20:26)</a>:</h4>
<p>I don't know how much that changes things, though, in that the <code>inferred_ty</code> thus represents shared regions between the various promoted constants</p>



<a name="160131405"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2357202%20bounds%20from%20promoted%20constant/near/160131405" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2357202.20bounds.20from.20promoted.20constant.html#160131405">(Mar 06 2019 at 20:27)</a>:</h4>
<p>but it doesn't sound like a big problem</p>



<a name="160131414"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2357202%20bounds%20from%20promoted%20constant/near/160131414" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2357202.20bounds.20from.20promoted.20constant.html#160131414">(Mar 06 2019 at 20:27)</a>:</h4>
<p>I think there's no real concern here</p>



<a name="160131450"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2357202%20bounds%20from%20promoted%20constant/near/160131450" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2357202.20bounds.20from.20promoted.20constant.html#160131450">(Mar 06 2019 at 20:27)</a>:</h4>
<p>I was more worried about having some type variable like <code>?X</code> where one arm leaves it unconstrained but the other equates it to <code>u32</code> and somehow that causes trouble when checking the constant from the first arm, since <code>?X</code> would never wind up as <code>u32</code></p>



<a name="160131579"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2357202%20bounds%20from%20promoted%20constant/near/160131579" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2357202.20bounds.20from.20promoted.20constant.html#160131579">(Mar 06 2019 at 20:29)</a>:</h4>
<p>I'm trying to think now how this closure-like check might work and whether we could lose region constraints</p>



<a name="160131694"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2357202%20bounds%20from%20promoted%20constant/near/160131694" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Matthew Jasper <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2357202.20bounds.20from.20promoted.20constant.html#160131694">(Mar 06 2019 at 20:30)</a>:</h4>
<p>I think doing the obvious thing and seeing what goes wrong should be fine.</p>



<a name="160131885"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2357202%20bounds%20from%20promoted%20constant/near/160131885" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2357202.20bounds.20from.20promoted.20constant.html#160131885">(Mar 06 2019 at 20:32)</a>:</h4>
<p>I was just reading over the tests</p>



<a name="160131889"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2357202%20bounds%20from%20promoted%20constant/near/160131889" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2357202.20bounds.20from.20promoted.20constant.html#160131889">(Mar 06 2019 at 20:32)</a>:</h4>
<p>Are you interested in trying that change?</p>



<a name="160131897"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2357202%20bounds%20from%20promoted%20constant/near/160131897" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2357202.20bounds.20from.20promoted.20constant.html#160131897">(Mar 06 2019 at 20:32)</a>:</h4>
<p>(I see meeting is now)</p>



<a name="160131960"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2357202%20bounds%20from%20promoted%20constant/near/160131960" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Matthew Jasper <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2357202.20bounds.20from.20promoted.20constant.html#160131960">(Mar 06 2019 at 20:33)</a>:</h4>
<p>Yes, but I may take a while to get around to it</p>



<a name="160132086"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2357202%20bounds%20from%20promoted%20constant/near/160132086" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2357202.20bounds.20from.20promoted.20constant.html#160132086">(Mar 06 2019 at 20:35)</a>:</h4>
<p>Should we file an issue about it?</p>



<a name="160132089"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2357202%20bounds%20from%20promoted%20constant/near/160132089" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2357202.20bounds.20from.20promoted.20constant.html#160132089">(Mar 06 2019 at 20:35)</a>:</h4>
<p>(Probably)</p>



<a name="160132134"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2357202%20bounds%20from%20promoted%20constant/near/160132134" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2357202.20bounds.20from.20promoted.20constant.html#160132134">(Mar 06 2019 at 20:36)</a>:</h4>
<p>It doesn't seem like high priority</p>



<a name="160132146"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2357202%20bounds%20from%20promoted%20constant/near/160132146" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Matthew Jasper <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2357202.20bounds.20from.20promoted.20constant.html#160132146">(Mar 06 2019 at 20:36)</a>:</h4>
<blockquote>
<p>Should we file an issue about it?</p>
</blockquote>
<p><span aria-label="+1" class="emoji emoji-1f44d" role="img" title="+1">:+1:</span></p>



<a name="160132147"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2357202%20bounds%20from%20promoted%20constant/near/160132147" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2357202.20bounds.20from.20promoted.20constant.html#160132147">(Mar 06 2019 at 20:36)</a>:</h4>
<p>I'd like to at least link to this thread :)</p>



<a name="160180874"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2357202%20bounds%20from%20promoted%20constant/near/160180874" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> oli <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2357202.20bounds.20from.20promoted.20constant.html#160180874">(Mar 07 2019 at 09:11)</a>:</h4>
<p>I was slightly suprised promotion works across match arms</p>



<a name="160180978"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2357202%20bounds%20from%20promoted%20constant/near/160180978" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> oli <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2357202.20bounds.20from.20promoted.20constant.html#160180978">(Mar 07 2019 at 09:12)</a>:</h4>
<p>I could not come up with anything problematic, but <span class="user-mention" data-user-id="119009">@eddyb</span> worries that this could be a symptom that there might be problematic cases</p>



<a name="160184283"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2357202%20bounds%20from%20promoted%20constant/near/160184283" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> blitzerr <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2357202.20bounds.20from.20promoted.20constant.html#160184283">(Mar 07 2019 at 10:07)</a>:</h4>
<blockquote>
<p>I could not come up with anything problematic, but <span class="user-mention silent" data-user-id="119009">eddyb</span> worries that this could be a symptom that there might be problematic cases</p>
</blockquote>
<p><span class="user-mention" data-user-id="124288">@oli</span>  Are you suggesting that the reason you coouldn't come up with something problematic is an indication enough that there might be something problematic ? <span aria-label="smiley" class="emoji emoji-1f603" role="img" title="smiley">:smiley:</span></p>



<a name="160184394"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2357202%20bounds%20from%20promoted%20constant/near/160184394" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> oli <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2357202.20bounds.20from.20promoted.20constant.html#160184394">(Mar 07 2019 at 10:09)</a>:</h4>
<p>that sentence took me a bit to parse</p>



<a name="160184398"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2357202%20bounds%20from%20promoted%20constant/near/160184398" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> oli <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2357202.20bounds.20from.20promoted.20constant.html#160184398">(Mar 07 2019 at 10:09)</a>:</h4>
<p>No, I believe there's no way to abuse this (right now)</p>



<a name="160184472"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2357202%20bounds%20from%20promoted%20constant/near/160184472" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> oli <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2357202.20bounds.20from.20promoted.20constant.html#160184472">(Mar 07 2019 at 10:10)</a>:</h4>
<p>I screwed up the previous sentence. <code>this</code> is "promotion works across match arms" and not "I could not come up with anything problematic"</p>



<a name="160184587"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2357202%20bounds%20from%20promoted%20constant/near/160184587" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> blitzerr <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2357202.20bounds.20from.20promoted.20constant.html#160184587">(Mar 07 2019 at 10:13)</a>:</h4>
<p><span class="user-mention" data-user-id="124288">@oli</span>  No worries. I was just being annoying <span aria-label="smiley" class="emoji emoji-1f603" role="img" title="smiley">:smiley:</span></p>



<a name="160279882"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2357202%20bounds%20from%20promoted%20constant/near/160279882" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2357202.20bounds.20from.20promoted.20constant.html#160279882">(Mar 08 2019 at 10:47)</a>:</h4>
<blockquote>
<p>I could not come up with anything problematic, but <span class="user-mention silent" data-user-id="119009">eddyb</span> worries that this could be a symptom that there might be problematic cases</p>
</blockquote>
<p>It does worry me mildly, <span class="user-mention" data-user-id="124288">@oli</span></p>



<a name="160279904"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2357202%20bounds%20from%20promoted%20constant/near/160279904" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2357202.20bounds.20from.20promoted.20constant.html#160279904">(Mar 08 2019 at 10:47)</a>:</h4>
<p>Did you see the point about mixed <code>ref mut</code> vs <code>ref</code> and how that could result in perhaps surprising lifetimes?</p>



<a name="160279962"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2357202%20bounds%20from%20promoted%20constant/near/160279962" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2357202.20bounds.20from.20promoted.20constant.html#160279962">(Mar 08 2019 at 10:48)</a>:</h4>
<blockquote>
<p>Yes, so the potential issue is something like:</p>
<div class="codehilite"><pre><span></span><span class="k">match</span><span class="w"> </span><span class="n">constant_with_types</span>::<span class="o">&lt;</span><span class="n">Types</span><span class="o">&gt;</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="k">ref</span><span class="w"> </span><span class="n">x</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="p">(),</span><span class="w"> </span><span class="c1">// x refernces promoted MIR</span>
<span class="w">    </span><span class="k">ref</span><span class="w"> </span><span class="n">y</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="p">(),</span><span class="w"> </span><span class="c1">// y reference different promoted MIR</span>
<span class="w">    </span><span class="k">ref</span><span class="w"> </span><span class="k">mut</span><span class="w"> </span><span class="n">z</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="p">(),</span><span class="w"> </span><span class="c1">// z references a temporary</span>
<span class="p">}</span><span class="w"></span>
</pre></div>


</blockquote>
<p>in particular here the type of <code>x</code> and <code>y</code> could wind up inferred to <code>&amp;'static Foo</code> while <code>z</code> would be <code>&amp;'x mut Foo</code> -- i.e., it cannot be <code>'static</code></p>



<a name="160279969"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2357202%20bounds%20from%20promoted%20constant/near/160279969" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2357202.20bounds.20from.20promoted.20constant.html#160279969">(Mar 08 2019 at 10:48)</a>:</h4>
<p><span class="user-mention" data-user-id="116118">@Matthew Jasper</span> there isn't an issue filed about this discrepancy, is there?</p>



<a name="160283467"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2357202%20bounds%20from%20promoted%20constant/near/160283467" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Matthew Jasper <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2357202.20bounds.20from.20promoted.20constant.html#160283467">(Mar 08 2019 at 12:00)</a>:</h4>
<p>There's no issue for this.</p>



<a name="160284992"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2357202%20bounds%20from%20promoted%20constant/near/160284992" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> oli <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2357202.20bounds.20from.20promoted.20constant.html#160284992">(Mar 08 2019 at 12:31)</a>:</h4>
<p>We basically have to treat such a match as</p>
<div class="codehilite"><pre><span></span><span class="kd">let</span><span class="w"> </span><span class="n">tmp</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">constant_with_types</span>::<span class="o">&lt;</span><span class="n">Types</span><span class="o">&gt;</span><span class="p">;</span><span class="w"></span>
<span class="k">match</span><span class="w"> </span><span class="n">constant_with_types</span>::<span class="o">&lt;</span><span class="n">Types</span><span class="o">&gt;</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="n">_</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="kd">let</span><span class="w"> </span><span class="n">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">&amp;</span><span class="n">constant_with_types</span>::<span class="o">&lt;</span><span class="n">Types</span><span class="o">&gt;</span><span class="p">;</span><span class="w"> </span><span class="p">},</span><span class="w"></span>
<span class="w">    </span><span class="n">_</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="kd">let</span><span class="w"> </span><span class="n">y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">&amp;</span><span class="n">constant_with_types</span>::<span class="o">&lt;</span><span class="n">Types</span><span class="o">&gt;</span><span class="p">;</span><span class="w"> </span><span class="p">},</span><span class="w"></span>
<span class="w">    </span><span class="n">_</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="kd">let</span><span class="w"> </span><span class="n">z</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">&amp;</span><span class="k">mut</span><span class="w"> </span><span class="n">tmp</span><span class="p">;</span><span class="w"> </span><span class="p">},</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>
</pre></div>



<a name="160285287"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2357202%20bounds%20from%20promoted%20constant/near/160285287" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> oli <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2357202.20bounds.20from.20promoted.20constant.html#160285287">(Mar 08 2019 at 12:36)</a>:</h4>
<p>I agree with the surprising part, I was surprised by it after all. Not sure if there's a discrepancy here that needs addressing.</p>



<hr><p>Last updated: Apr 12 2022 at 20:01 UTC</p>
</html>