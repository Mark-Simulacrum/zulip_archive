<html>
<head><meta charset="utf-8"><title>#57374 higher ranked subtype errors · t-compiler/wg-nll · Zulip Chat Archive</title></head>
<h2>Stream: <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/index.html">t-compiler/wg-nll</a></h2>
<h3>Topic: <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2357374.20higher.20ranked.20subtype.20errors.html">#57374 higher ranked subtype errors</a></h3>

<hr>

<base href="https://rust-lang.zulipchat.com">

<head><link href="https://zulip-archive.rust-lang.org/style.css" rel="stylesheet"></head>

<a name="154918388"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2357374%20higher%20ranked%20subtype%20errors/near/154918388" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> lqd <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2357374.20higher.20ranked.20subtype.20errors.html#154918388">(Jan 11 2019 at 13:59)</a>:</h4>
<p>so I started looking at this during my lunchbreak: I'll summarize what I think I understood (or more likely "misunderstood", heh). The "bad" error comes from <a href="https://github.com/rust-lang/rust/blob/79d8a0fcefa5134db2a94739b1d18daa01fc6e9f/src/librustc_mir/borrow_check/nll/region_infer/mod.rs#L1217" target="_blank" title="https://github.com/rust-lang/rust/blob/79d8a0fcefa5134db2a94739b1d18daa01fc6e9f/src/librustc_mir/borrow_check/nll/region_infer/mod.rs#L1217">check_bound_universal_region</a>. We're checking '10 when we notice the error that the bb0/0 Location is present in its scc and emit an error where we think this "'10: '0" (IIUC) constraint is coming from, and we might have needed (if we wanted to mimick the AST borrowck behaviour) to emit a <code>TypeError::RegionsPlaceholderMismatch</code> placeholder failure error ("one type is more general than the other") between the 2 regions ? (however, in order to do that I'm not sure where to get a <code>SubregionOrigin::Subtype</code> constraint origin, or the <code>TypeTrace</code> needed by <code>InferCtxt::report_and_explain_type_error</code>)</p>



<a name="154947293"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2357374%20higher%20ranked%20subtype%20errors/near/154947293" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2357374.20higher.20ranked.20subtype.20errors.html#154947293">(Jan 11 2019 at 21:09)</a>:</h4>
<p><span class="user-mention" data-user-id="116113">@lqd</span> that sounds about right</p>



<a name="154947317"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2357374%20higher%20ranked%20subtype%20errors/near/154947317" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2357374.20higher.20ranked.20subtype.20errors.html#154947317">(Jan 11 2019 at 21:09)</a>:</h4>
<p>we probably can't get exactly that information</p>



<a name="154947321"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2357374%20higher%20ranked%20subtype%20errors/near/154947321" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2357374.20higher.20ranked.20subtype.20errors.html#154947321">(Jan 11 2019 at 21:09)</a>:</h4>
<p>I'm not sure if I recall what information we <em>can</em> get</p>



<a name="154948806"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2357374%20higher%20ranked%20subtype%20errors/near/154948806" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> lqd <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2357374.20higher.20ranked.20subtype.20errors.html#154948806">(Jan 11 2019 at 21:32)</a>:</h4>
<p>I'll try to find out</p>



<a name="154949554"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2357374%20higher%20ranked%20subtype%20errors/near/154949554" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> lqd <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2357374.20higher.20ranked.20subtype.20errors.html#154949554">(Jan 11 2019 at 21:43)</a>:</h4>
<p>(but if somehow you recall, maybe while working on the similar "one type is more general than the other" error  <a href="https://github.com/rust-lang/rust/issues/57362" target="_blank" title="https://github.com/rust-lang/rust/issues/57362">#57362</a>, please let me know ;)</p>



<a name="155103200"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2357374%20higher%20ranked%20subtype%20errors/near/155103200" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> lqd <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2357374.20higher.20ranked.20subtype.20errors.html#155103200">(Jan 14 2019 at 18:07)</a>:</h4>
<p>ok so after more hours looking at this: I'm not sure how/if to reuse the parts of  <code>rustc::infer::error_reporting</code> and <code>TypeError::RegionsPlaceholderMismatch</code> in region_infer's error reporting. The 4-5 directions I've tried seemed to ultimately require some information I don't know how to get or whether it can be gotten (hitting these dead-ends is more indicative that <em>I</em> couldn't make them build/work rather than them not being the correct direction, possibly after some modifications, of course).</p>



<a name="155103259"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2357374%20higher%20ranked%20subtype%20errors/near/155103259" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> lqd <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2357374.20higher.20ranked.20subtype.20errors.html#155103259">(Jan 14 2019 at 18:08)</a>:</h4>
<p>While I know I can manually craft an error message which adds notes and such, I'm not sure how it should look in the handful of cases in our tests (whether it should look more like the "one type is more general than the other" or "expected concrete lifetime, found bound lifetime parameter 'a" errors). So I unfortunately haven't made a lot of progress per se, apart from maybe knowing a bit more about what didn't immediately work out of the box</p>



<a name="155103287"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2357374%20higher%20ranked%20subtype%20errors/near/155103287" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> lqd <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2357374.20higher.20ranked.20subtype.20errors.html#155103287">(Jan 14 2019 at 18:09)</a>:</h4>
<p>(or maybe noticing the span returned from <code>find_outlives_blame_span</code> seems to do subtly different things in these cases, as we can see in <a href="https://github.com/rust-lang/rust/blob/906deae0790bd18681b937fe9a141a3c26cf1855/src/test/ui/nll/relate_tys/hr-fn-aaa-as-aba.rs" target="_blank" title="https://github.com/rust-lang/rust/blob/906deae0790bd18681b937fe9a141a3c26cf1855/src/test/ui/nll/relate_tys/hr-fn-aaa-as-aba.rs">the hr-fn-aaa-as-aba test</a>'s <a href="https://github.com/rust-lang/rust/blob/906deae0790bd18681b937fe9a141a3c26cf1855/src/test/ui/nll/relate_tys/hr-fn-aaa-as-aba.stderr" target="_blank" title="https://github.com/rust-lang/rust/blob/906deae0790bd18681b937fe9a141a3c26cf1855/src/test/ui/nll/relate_tys/hr-fn-aaa-as-aba.stderr">output</a>; or that I'm not sure whether disabling leak-check actually has an impact on these errors)</p>



<a name="155196743"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2357374%20higher%20ranked%20subtype%20errors/near/155196743" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2357374.20higher.20ranked.20subtype.20errors.html#155196743">(Jan 15 2019 at 19:25)</a>:</h4>
<p><span class="user-mention" data-user-id="116113">@lqd</span> ok let me see here</p>



<a name="155196745"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2357374%20higher%20ranked%20subtype%20errors/near/155196745" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2357374.20higher.20ranked.20subtype.20errors.html#155196745">(Jan 15 2019 at 19:25)</a>:</h4>
<p>sorry I've faile to give you much actionable advice yet</p>



<a name="155196861"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2357374%20higher%20ranked%20subtype%20errors/near/155196861" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> lqd <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2357374.20higher.20ranked.20subtype.20errors.html#155196861">(Jan 15 2019 at 19:27)</a>:</h4>
<p>oh no worries !</p>



<a name="155196887"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2357374%20higher%20ranked%20subtype%20errors/near/155196887" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2357374.20higher.20ranked.20subtype.20errors.html#155196887">(Jan 15 2019 at 19:27)</a>:</h4>
<p>the other thing is that there is the other bug</p>



<a name="155196899"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2357374%20higher%20ranked%20subtype%20errors/near/155196899" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2357374.20higher.20ranked.20subtype.20errors.html#155196899">(Jan 15 2019 at 19:27)</a>:</h4>
<p>I have some better idea what is needed there</p>



<a name="155196905"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2357374%20higher%20ranked%20subtype%20errors/near/155196905" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2357374.20higher.20ranked.20subtype.20errors.html#155196905">(Jan 15 2019 at 19:27)</a>:</h4>
<p>I should leave some notes</p>



<a name="155196908"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2357374%20higher%20ranked%20subtype%20errors/near/155196908" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2357374.20higher.20ranked.20subtype.20errors.html#155196908">(Jan 15 2019 at 19:28)</a>:</h4>
<p>it might be a good starter issue :P</p>



<a name="155196962"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2357374%20higher%20ranked%20subtype%20errors/near/155196962" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> lqd <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2357374.20higher.20ranked.20subtype.20errors.html#155196962">(Jan 15 2019 at 19:28)</a>:</h4>
<p>haha :) sure why not</p>



<a name="155196963"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2357374%20higher%20ranked%20subtype%20errors/near/155196963" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2357374.20higher.20ranked.20subtype.20errors.html#155196963">(Jan 15 2019 at 19:28)</a>:</h4>
<p>I am referring to <a href="https://github.com/rust-lang/rust/issues/57362" target="_blank" title="https://github.com/rust-lang/rust/issues/57362">https://github.com/rust-lang/rust/issues/57362</a></p>



<a name="155196978"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2357374%20higher%20ranked%20subtype%20errors/near/155196978" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2357374.20higher.20ranked.20subtype.20errors.html#155196978">(Jan 15 2019 at 19:28)</a>:</h4>
<p>let me try to leave a few notes on the issue</p>



<a name="155197006"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2357374%20higher%20ranked%20subtype%20errors/near/155197006" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> lqd <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2357374.20higher.20ranked.20subtype.20errors.html#155197006">(Jan 15 2019 at 19:29)</a>:</h4>
<p>awesome, thank you</p>



<a name="155201902"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2357374%20higher%20ranked%20subtype%20errors/near/155201902" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2357374.20higher.20ranked.20subtype.20errors.html#155201902">(Jan 15 2019 at 20:34)</a>:</h4>
<p><span class="user-mention" data-user-id="116113">@lqd</span> <a href="https://github.com/rust-lang/rust/issues/57362#issuecomment-454540850" target="_blank" title="https://github.com/rust-lang/rust/issues/57362#issuecomment-454540850">some notes here</a></p>



<a name="155201904"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2357374%20higher%20ranked%20subtype%20errors/near/155201904" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2357374.20higher.20ranked.20subtype.20errors.html#155201904">(Jan 15 2019 at 20:34)</a>:</h4>
<p>I don't really know <em>precisely</em> how I would fix it</p>



<a name="155201914"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2357374%20higher%20ranked%20subtype%20errors/near/155201914" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2357374.20higher.20ranked.20subtype.20errors.html#155201914">(Jan 15 2019 at 20:34)</a>:</h4>
<p>but I think that's the "lay of the land" in terms of what's causing the problem</p>



<a name="155201921"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2357374%20higher%20ranked%20subtype%20errors/near/155201921" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2357374.20higher.20ranked.20subtype.20errors.html#155201921">(Jan 15 2019 at 20:34)</a>:</h4>
<p>I guess I can imagine a few different things to tweak</p>



<a name="155202073"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2357374%20higher%20ranked%20subtype%20errors/near/155202073" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> lqd <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2357374.20higher.20ranked.20subtype.20errors.html#155202073">(Jan 15 2019 at 20:36)</a>:</h4>
<p>it does overlap nicely with the investigation I had been doing for the higher ranked subtyping errors</p>



<a name="155202147"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2357374%20higher%20ranked%20subtype%20errors/near/155202147" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> lqd <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2357374.20higher.20ranked.20subtype.20errors.html#155202147">(Jan 15 2019 at 20:37)</a>:</h4>
<p>thanks for the notes, I'll dig into this part and see what stumbling blocks I find in order to construct such a message :)</p>



<a name="157184765"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2357374%20higher%20ranked%20subtype%20errors/near/157184765" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> lqd <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2357374.20higher.20ranked.20subtype.20errors.html#157184765">(Jan 30 2019 at 12:58)</a>:</h4>
<p><span class="user-mention" data-user-id="116083">@pnkfelix</span> re: <a href="https://github.com/rust-lang/rust/issues/57374#issuecomment-458900638" target="_blank" title="https://github.com/rust-lang/rust/issues/57374#issuecomment-458900638">GH comment</a> yeah my understanding is <a href="https://github.com/rust-lang/rust/issues/57374" target="_blank" title="https://github.com/rust-lang/rust/issues/57374">#57374</a> is specific to MIR borrowck, while <a href="https://github.com/rust-lang/rust/issues/57362" target="_blank" title="https://github.com/rust-lang/rust/issues/57362">#57362</a> was the dual in AST borrowck, and there's another similar one for non-NLLs <a href="https://github.com/rust-lang/rust/issues/57875" target="_blank" title="https://github.com/rust-lang/rust/issues/57875">#57875</a> which IIUC should be a dupe of <a href="https://github.com/rust-lang/rust/issues/57374" target="_blank" title="https://github.com/rust-lang/rust/issues/57374">#57374</a> under NLLs (but haven't investigated yet)</p>



<a name="157185332"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2357374%20higher%20ranked%20subtype%20errors/near/157185332" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> pnkfelix <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2357374.20higher.20ranked.20subtype.20errors.html#157185332">(Jan 30 2019 at 13:06)</a>:</h4>
<p>yeah I had just had an idle hope that whatever fixed <a href="https://github.com/rust-lang/rust/issues/57362" target="_blank" title="https://github.com/rust-lang/rust/issues/57362">#57362</a> would apply to <a href="https://github.com/rust-lang/rust/issues/57374" target="_blank" title="https://github.com/rust-lang/rust/issues/57374">#57374</a>. But it seems pretty obvious in hindsight based on  skimming PR <a href="https://github.com/rust-lang/rust/issues/57362" target="_blank" title="https://github.com/rust-lang/rust/issues/57362">#57362</a> that it was independent.</p>



<a name="157185705"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2357374%20higher%20ranked%20subtype%20errors/near/157185705" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> lqd <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2357374.20higher.20ranked.20subtype.20errors.html#157185705">(Jan 30 2019 at 13:12)</a>:</h4>
<p>if you have any ideas on how I might "generalize" the PR to handle <a href="https://github.com/rust-lang/rust/issues/57875" target="_blank" title="https://github.com/rust-lang/rust/issues/57875">#57875</a> as well (the problem there being very similar, but with PolyTraitRefs instead of TraitRefs) -- or how to go at fixing <a href="https://github.com/rust-lang/rust/issues/57374" target="_blank" title="https://github.com/rust-lang/rust/issues/57374">#57374</a>, it would also ofc be very helpful :)</p>



<a name="157217420"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2357374%20higher%20ranked%20subtype%20errors/near/157217420" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2357374.20higher.20ranked.20subtype.20errors.html#157217420">(Jan 30 2019 at 20:07)</a>:</h4>
<p><span class="user-mention" data-user-id="116113">@lqd</span> right, so, now that you dug into the "error" code for non-NLL, we can come back to this point I guess =)</p>



<a name="157217457"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2357374%20higher%20ranked%20subtype%20errors/near/157217457" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> lqd <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2357374.20higher.20ranked.20subtype.20errors.html#157217457">(Jan 30 2019 at 20:07)</a>:</h4>
<p>we definitely can :)</p>



<a name="157217613"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2357374%20higher%20ranked%20subtype%20errors/near/157217613" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> lqd <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2357374.20higher.20ranked.20subtype.20errors.html#157217613">(Jan 30 2019 at 20:09)</a>:</h4>
<p>I feel like it'll be similar for NLLs ?</p>



<a name="157218215"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2357374%20higher%20ranked%20subtype%20errors/near/157218215" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> lqd <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2357374.20higher.20ranked.20subtype.20errors.html#157218215">(Jan 30 2019 at 20:16)</a>:</h4>
<p>hum I feel I can investigate this better, and experiment with it, now that I've seen the non-NLL scaffolding</p>



<a name="157219523"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2357374%20higher%20ranked%20subtype%20errors/near/157219523" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2357374.20higher.20ranked.20subtype.20errors.html#157219523">(Jan 30 2019 at 20:33)</a>:</h4>
<p>it should be similar, the main question is how to get the information about the traits being solved. I can't recall what we have and what we don't off hand</p>



<a name="157220248"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2357374%20higher%20ranked%20subtype%20errors/near/157220248" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> lqd <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2357374.20higher.20ranked.20subtype.20errors.html#157220248">(Jan 30 2019 at 20:45)</a>:</h4>
<p>yeah, after looking a bit at it, I remembered getting this information or knowing which info we had access to, was the area where I had the most difficulty. Maybe a roundabount way of finding the PlaceholderRegion's BoundRegion elsewhere. Or maybe it'd need to be added.</p>



<a name="157265681"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2357374%20higher%20ranked%20subtype%20errors/near/157265681" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> lqd <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2357374.20higher.20ranked.20subtype.20errors.html#157265681">(Jan 31 2019 at 11:39)</a>:</h4>
<p>hey <span class="user-mention" data-user-id="116083">@pnkfelix</span> <span aria-label="wave" class="emoji emoji-1f44b" role="img" title="wave">:wave:</span> -- I've noticed you're also assigned to <a href="https://github.com/rust-lang/rust/issues/57374" target="_blank" title="https://github.com/rust-lang/rust/issues/57374">#57374</a>, and wondered if you could give me a couple pointers as to how/where to find some of the information we need to display the correct error message in this case (maybe some expected/found TraitRefs if it's anything like <a href="https://github.com/rust-lang/rust/issues/57362" target="_blank" title="https://github.com/rust-lang/rust/issues/57362">#57362</a>) from <a href="https://github.com/rust-lang/rust/blob/79d8a0fcefa5134db2a94739b1d18daa01fc6e9f/src/librustc_mir/borrow_check/nll/region_infer/mod.rs#L1217" target="_blank" title="https://github.com/rust-lang/rust/blob/79d8a0fcefa5134db2a94739b1d18daa01fc6e9f/src/librustc_mir/borrow_check/nll/region_infer/mod.rs#L1217">check_bound_universal_region</a> ? I have a Placeholder and a couple erroneous regions and everything I've tried has turned up a dead-end; I'm not sure where to look anymore :)</p>



<a name="157265744"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2357374%20higher%20ranked%20subtype%20errors/near/157265744" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> pnkfelix <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2357374.20higher.20ranked.20subtype.20errors.html#157265744">(Jan 31 2019 at 11:40)</a>:</h4>
<p>let me look</p>



<a name="157265755"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2357374%20higher%20ranked%20subtype%20errors/near/157265755" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> lqd <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2357374.20higher.20ranked.20subtype.20errors.html#157265755">(Jan 31 2019 at 11:40)</a>:</h4>
<p>thank you</p>



<a name="157266057"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2357374%20higher%20ranked%20subtype%20errors/near/157266057" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> pnkfelix <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2357374.20higher.20ranked.20subtype.20errors.html#157266057">(Jan 31 2019 at 11:47)</a>:</h4>
<p>(hmm, I hadn't previously noticed that NLL is highlighting the type annotation for <code>let x</code> (while without NLL we are highlighting the use of <code>x</code> on the RHS of the <code>let y</code> statement)</p>



<a name="157266114"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2357374%20higher%20ranked%20subtype%20errors/near/157266114" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> pnkfelix <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2357374.20higher.20ranked.20subtype.20errors.html#157266114">(Jan 31 2019 at 11:48)</a>:</h4>
<p>I don't have any immediate answers for you, but I've been sort of wandering around looking for something to poke at, so I might as well keep looking at this with you. <span aria-label="smiley" class="emoji emoji-1f603" role="img" title="smiley">:smiley:</span></p>



<a name="157266134"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2357374%20higher%20ranked%20subtype%20errors/near/157266134" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> lqd <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2357374.20higher.20ranked.20subtype.20errors.html#157266134">(Jan 31 2019 at 11:49)</a>:</h4>
<p>yeah I had noticed <code>find_outlives_blame_span</code> seemed to do subtly different things for these error cases, <a href="https://github.com/rust-lang/rust/blob/906deae0790bd18681b937fe9a141a3c26cf1855/src/test/ui/nll/relate_tys/hr-fn-aaa-as-aba.stderr" target="_blank" title="https://github.com/rust-lang/rust/blob/906deae0790bd18681b937fe9a141a3c26cf1855/src/test/ui/nll/relate_tys/hr-fn-aaa-as-aba.stderr">e.g. this test</a> has both</p>



<a name="157266501"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2357374%20higher%20ranked%20subtype%20errors/near/157266501" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> pnkfelix <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2357374.20higher.20ranked.20subtype.20errors.html#157266501">(Jan 31 2019 at 11:57)</a>:</h4>
<p>so, I don't know if this helps</p>



<a name="157266527"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2357374%20higher%20ranked%20subtype%20errors/near/157266527" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> pnkfelix <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2357374.20higher.20ranked.20subtype.20errors.html#157266527">(Jan 31 2019 at 11:57)</a>:</h4>
<p>but I do notice that the RUST_LOG debug output indicates that best_blame_constraint is being fed three things on the path</p>



<a name="157266576"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2357374%20higher%20ranked%20subtype%20errors/near/157266576" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> pnkfelix <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2357374.20higher.20ranked.20subtype.20errors.html#157266576">(Jan 31 2019 at 11:58)</a>:</h4>
<p>(the path being the constraint path between regions)</p>



<a name="157266602"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2357374%20higher%20ranked%20subtype%20errors/near/157266602" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> pnkfelix <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2357374.20higher.20ranked.20subtype.20errors.html#157266602">(Jan 31 2019 at 11:59)</a>:</h4>
<p>and one of the three things is an assignment at bb0[8], <code>_3 = _1;</code></p>



<a name="157266615"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2357374%20higher%20ranked%20subtype%20errors/near/157266615" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> pnkfelix <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2357374.20higher.20ranked.20subtype.20errors.html#157266615">(Jan 31 2019 at 11:59)</a>:</h4>
<p>and <code>_3</code> has the type <code>for&lt;'a&gt; fn(&amp;'a ())</code></p>



<a name="157266617"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2357374%20higher%20ranked%20subtype%20errors/near/157266617" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> pnkfelix <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2357374.20higher.20ranked.20subtype.20errors.html#157266617">(Jan 31 2019 at 11:59)</a>:</h4>
<p>while <code>_1</code> has the type <code>fn(&amp;())</code></p>



<a name="157266624"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2357374%20higher%20ranked%20subtype%20errors/near/157266624" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> pnkfelix <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2357374.20higher.20ranked.20subtype.20errors.html#157266624">(Jan 31 2019 at 12:00)</a>:</h4>
<p>so its possible one might try to reconstruct the useful diagnostic from that</p>



<a name="157266693"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2357374%20higher%20ranked%20subtype%20errors/near/157266693" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> lqd <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2357374.20higher.20ranked.20subtype.20errors.html#157266693">(Jan 31 2019 at 12:00)</a>:</h4>
<p>I had difficulty finding out how to go from the regions themselves to the types and def_id (maybe substs as well) they came from</p>



<a name="157266718"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2357374%20higher%20ranked%20subtype%20errors/near/157266718" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> lqd <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2357374.20higher.20ranked.20subtype.20errors.html#157266718">(Jan 31 2019 at 12:01)</a>:</h4>
<p>but maybe these are accessible from the path</p>



<a name="157266823"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2357374%20higher%20ranked%20subtype%20errors/near/157266823" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> pnkfelix <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2357374.20higher.20ranked.20subtype.20errors.html#157266823">(Jan 31 2019 at 12:03)</a>:</h4>
<p>you might also consider generalizing the callback that we pass into <code>best_blame_constraint</code></p>



<a name="157266871"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2357374%20higher%20ranked%20subtype%20errors/near/157266871" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> pnkfelix <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2357374.20higher.20ranked.20subtype.20errors.html#157266871">(Jan 31 2019 at 12:04)</a>:</h4>
<p>well, maybe "generalizing" is the wrong word</p>



<a name="157266878"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2357374%20higher%20ranked%20subtype%20errors/near/157266878" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> pnkfelix <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2357374.20higher.20ranked.20subtype.20errors.html#157266878">(Jan 31 2019 at 12:04)</a>:</h4>
<p>"arbitrarily changing" :)</p>



<a name="157266986"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2357374%20higher%20ranked%20subtype%20errors/near/157266986" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> lqd <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2357374.20higher.20ranked.20subtype.20errors.html#157266986">(Jan 31 2019 at 12:06)</a>:</h4>
<p>alright I'll poke in this direction and see what happens, thanks Felix!</p>



<a name="157266996"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2357374%20higher%20ranked%20subtype%20errors/near/157266996" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> pnkfelix <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2357374.20higher.20ranked.20subtype.20errors.html#157266996">(Jan 31 2019 at 12:06)</a>:</h4>
<p>(I want to better understand what's happening in this code path anyway, so I'll keep looking even if I don't keep posting notes here.)</p>



<a name="157301017"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2357374%20higher%20ranked%20subtype%20errors/near/157301017" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> lqd <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2357374.20higher.20ranked.20subtype.20errors.html#157301017">(Jan 31 2019 at 19:56)</a>:</h4>
<p>thanks to Felix's pointers I've made a bit of progress: I think the problem revolves around <a href="https://github.com/rust-lang/rust/blob/master/src/librustc_mir/borrow_check/nll/region_infer/error_reporting/mod.rs#L121-L133" target="_blank" title="https://github.com/rust-lang/rust/blob/master/src/librustc_mir/borrow_check/nll/region_infer/error_reporting/mod.rs#L121-L133">this part of best_blame_constraint</a> in our case we have a path starting with an Assignment constraint <em>but</em> followed by a TypeAnnotation, which will be immediately chosen as the best one (and the reason why the span seems incorrect for example). The same will happen with other categories, say, a function call argument. I tried returning the Assignment in this case, just so that I could access the Tys of the locals, and see the fallout. It didn't seem to change our existing tests (so it's likely there are other similar cases to uncover here)</p>



<a name="157307479"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2357374%20higher%20ranked%20subtype%20errors/near/157307479" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> lqd <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2357374.20higher.20ranked.20subtype.20errors.html#157307479">(Jan 31 2019 at 21:20)</a>:</h4>
<p>(err, I meant changing <code>find_outlives_blame_span</code> to return the assignment didn't seem to make tests fail: changing <code>best_blame_constraint</code> itself (eg the piece of code I linked) instead would impact tests for sure)</p>



<a name="159553040"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2357374%20higher%20ranked%20subtype%20errors/near/159553040" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> pnkfelix <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2357374.20higher.20ranked.20subtype.20errors.html#159553040">(Feb 27 2019 at 21:14)</a>:</h4>
<p>to be clear: did returning the Assignment at least help the particular case of <a href="https://github.com/rust-lang/rust/issues/57374" target="_blank" title="https://github.com/rust-lang/rust/issues/57374">#57374</a> itself? Or did it not even have an affect on that test (which to my knowledge is not part of our existing test suite)</p>



<a name="159553359"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2357374%20higher%20ranked%20subtype%20errors/near/159553359" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> lqd <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2357374.20higher.20ranked.20subtype.20errors.html#159553359">(Feb 27 2019 at 21:18)</a>:</h4>
<p>I'll have to retry this and get back to you to be sure about the details, but it was not "the solution" for sure. It just pointed to the correct span which seems like only a smaller part of the problem, but not the error itself. in particular I remember thinking, "ok I can now see this MIR assignment should have been an error before getting to this point, so how do I reemit the same error ?"</p>



<a name="160028443"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2357374%20higher%20ranked%20subtype%20errors/near/160028443" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> lqd <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2357374.20higher.20ranked.20subtype.20errors.html#160028443">(Mar 05 2019 at 18:43)</a>:</h4>
<p>omfg after 2 months, I <em>finally</em> have a lead on this</p>



<a name="160045523"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2357374%20higher%20ranked%20subtype%20errors/near/160045523" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> lqd <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2357374.20higher.20ranked.20subtype.20errors.html#160045523">(Mar 05 2019 at 22:13)</a>:</h4>
<p><span class="user-mention" data-user-id="116009">@nikomatsakis</span> do you remember what you were looking for <a href="https://github.com/rust-lang/rust/blob/a21d82438b72a0394a670b6bfe95e3e62ee08802/src/librustc_mir/borrow_check/nll/region_infer/mod.rs#L1294-L1300" target="_blank" title="https://github.com/rust-lang/rust/blob/a21d82438b72a0394a670b6bfe95e3e62ee08802/src/librustc_mir/borrow_check/nll/region_infer/mod.rs#L1294-L1300">here</a> ?</p>



<a name="160091536"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2357374%20higher%20ranked%20subtype%20errors/near/160091536" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> lqd <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2357374.20higher.20ranked.20subtype.20errors.html#160091536">(Mar 06 2019 at 12:41)</a>:</h4>
<p>nvm, I'll add it to my notes and send them to the both of you for guidance</p>



<a name="160100261"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2357374%20higher%20ranked%20subtype%20errors/near/160100261" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> lqd <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2357374.20higher.20ranked.20subtype.20errors.html#160100261">(Mar 06 2019 at 14:32)</a>:</h4>
<p>ok <span class="user-mention" data-user-id="116083">@pnkfelix</span> so here's the (long-ish) <a href="https://hackmd.io/s/HyBGK9SLN" target="_blank" title="https://hackmd.io/s/HyBGK9SLN">summary of my understanding</a> so far, and with that done I don't think I can make any more progress on this (maybe I should unassign myself from the issue until then)</p>



<a name="160100343"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2357374%20higher%20ranked%20subtype%20errors/near/160100343" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> pnkfelix <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2357374.20higher.20ranked.20subtype.20errors.html#160100343">(Mar 06 2019 at 14:33)</a>:</h4>
<p>okay thanks for writing this up</p>



<a name="160100378"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2357374%20higher%20ranked%20subtype%20errors/near/160100378" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> pnkfelix <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2357374.20higher.20ranked.20subtype.20errors.html#160100378">(Mar 06 2019 at 14:33)</a>:</h4>
<p>I wonder if it is worthwhile to post this in a comment (hidden in a <code>&lt;details&gt;</code> block) on the issue itself...</p>



<a name="160100442"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2357374%20higher%20ranked%20subtype%20errors/near/160100442" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> pnkfelix <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2357374.20higher.20ranked.20subtype.20errors.html#160100442">(Mar 06 2019 at 14:34)</a>:</h4>
<p>in any case, yes, please do unassign yourself for now then</p>



<a name="160100448"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2357374%20higher%20ranked%20subtype%20errors/near/160100448" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> lqd <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2357374.20higher.20ranked.20subtype.20errors.html#160100448">(Mar 06 2019 at 14:34)</a>:</h4>
<p>there are questions and meanderings in there</p>



<a name="160100496"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2357374%20higher%20ranked%20subtype%20errors/near/160100496" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> pnkfelix <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2357374.20higher.20ranked.20subtype.20errors.html#160100496">(Mar 06 2019 at 14:34)</a>:</h4>
<p>yeah I can understand being hesitant to post that in a github comment</p>



<a name="160100522"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2357374%20higher%20ranked%20subtype%20errors/near/160100522" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> lqd <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2357374.20higher.20ranked.20subtype.20errors.html#160100522">(Mar 06 2019 at 14:35)</a>:</h4>
<p>maybe after you vet it, let's say</p>



<a name="160100857"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2357374%20higher%20ranked%20subtype%20errors/near/160100857" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> pnkfelix <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2357374.20higher.20ranked.20subtype.20errors.html#160100857">(Mar 06 2019 at 14:39)</a>:</h4>
<p>my immediate reaction is that points 1 ("The span points at the type of x.") and 2 ("The span can be incorrect in other similar cases") seem of general interest and to the point. Point 3 may be useful but it definitely meanders; I'd like to figure out a way to condense it before transcribing to the issue.</p>



<a name="160100861"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2357374%20higher%20ranked%20subtype%20errors/near/160100861" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> lqd <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2357374.20higher.20ranked.20subtype.20errors.html#160100861">(Mar 06 2019 at 14:39)</a>:</h4>
<p>depending on how long we'll keep the leak check, this may be less important than P-high</p>



<a name="160100981"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2357374%20higher%20ranked%20subtype%20errors/near/160100981" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> lqd <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2357374.20higher.20ranked.20subtype.20errors.html#160100981">(Mar 06 2019 at 14:41)</a>:</h4>
<p>yeah I had kept point 3 because of the similarity of the path with an existing test</p>



<a name="160101020"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2357374%20higher%20ranked%20subtype%20errors/near/160101020" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> pnkfelix <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2357374.20higher.20ranked.20subtype.20errors.html#160101020">(Mar 06 2019 at 14:41)</a>:</h4>
<p>(To be clear, I'm not saying to kill off point 3. It is interesting, I think.)</p>



<a name="160101170"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2357374%20higher%20ranked%20subtype%20errors/near/160101170" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> lqd <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2357374.20higher.20ranked.20subtype.20errors.html#160101170">(Mar 06 2019 at 14:43)</a>:</h4>
<p>yeah, just more information on subtly different things</p>



<a name="160101226"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2357374%20higher%20ranked%20subtype%20errors/near/160101226" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> lqd <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2357374.20higher.20ranked.20subtype.20errors.html#160101226">(Mar 06 2019 at 14:43)</a>:</h4>
<p><span class="user-mention" data-user-id="116083">@pnkfelix</span> sorry but I seem to have lost writing rights or something on the repo so can't unassign myself, if you could please do it</p>



<a name="160101288"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2357374%20higher%20ranked%20subtype%20errors/near/160101288" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> pnkfelix <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2357374.20higher.20ranked.20subtype.20errors.html#160101288">(Mar 06 2019 at 14:44)</a>:</h4>
<p>oh sure, no problem</p>



<a name="160101305"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2357374%20higher%20ranked%20subtype%20errors/near/160101305" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> lqd <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2357374.20higher.20ranked.20subtype.20errors.html#160101305">(Mar 06 2019 at 14:44)</a>:</h4>
<p>thanks</p>



<a name="160101328"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2357374%20higher%20ranked%20subtype%20errors/near/160101328" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> pnkfelix <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2357374.20higher.20ranked.20subtype.20errors.html#160101328">(Mar 06 2019 at 14:44)</a>:</h4>
<p>you mind linking to your notes from the ticket, at least?</p>



<a name="160101340"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2357374%20higher%20ranked%20subtype%20errors/near/160101340" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> lqd <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2357374.20higher.20ranked.20subtype.20errors.html#160101340">(Mar 06 2019 at 14:44)</a>:</h4>
<p>yeah no problem</p>



<a name="160101343"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2357374%20higher%20ranked%20subtype%20errors/near/160101343" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> pnkfelix <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2357374.20higher.20ranked.20subtype.20errors.html#160101343">(Mar 06 2019 at 14:45)</a>:</h4>
<p>(just so I don't have to go digging through the zulip log to find it)</p>



<a name="160101462"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2357374%20higher%20ranked%20subtype%20errors/near/160101462" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> lqd <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2357374.20higher.20ranked.20subtype.20errors.html#160101462">(Mar 06 2019 at 14:46)</a>:</h4>
<p>done</p>



<a name="160127949"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2357374%20higher%20ranked%20subtype%20errors/near/160127949" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2357374.20higher.20ranked.20subtype.20errors.html#160127949">(Mar 06 2019 at 19:45)</a>:</h4>
<p><span class="user-mention" data-user-id="116113">@lqd</span> btw, sorry for dropping the ball, can you point me to the latest thing I should be reading? :P</p>



<a name="160127996"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2357374%20higher%20ranked%20subtype%20errors/near/160127996" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> lqd <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2357374.20higher.20ranked.20subtype.20errors.html#160127996">(Mar 06 2019 at 19:45)</a>:</h4>
<p>no worries</p>



<a name="160128070"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2357374%20higher%20ranked%20subtype%20errors/near/160128070" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> lqd <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2357374.20higher.20ranked.20subtype.20errors.html#160128070">(Mar 06 2019 at 19:46)</a>:</h4>
<p>it's a bit long but <a href="https://hackmd.io/s/HyBGK9SLN" target="_blank" title="https://hackmd.io/s/HyBGK9SLN">here's</a> a summary of my explorations / meandering</p>



<a name="160128278"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2357374%20higher%20ranked%20subtype%20errors/near/160128278" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> lqd <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2357374.20higher.20ranked.20subtype.20errors.html#160128278">(Mar 06 2019 at 19:49)</a>:</h4>
<p>(it also has some questions I had, which are both tied to understanding the current behaviour and the reasons behind it, and what it is we want to do here, and ofc how to do it)</p>



<a name="161749863"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2357374%20higher%20ranked%20subtype%20errors/near/161749863" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> lqd <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2357374.20higher.20ranked.20subtype.20errors.html#161749863">(Mar 26 2019 at 10:52)</a>:</h4>
<p><span class="user-mention" data-user-id="116083">@pnkfelix</span> have you been able to look at this btw ?</p>



<a name="161749871"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2357374%20higher%20ranked%20subtype%20errors/near/161749871" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> pnkfelix <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2357374.20higher.20ranked.20subtype.20errors.html#161749871">(Mar 26 2019 at 10:52)</a>:</h4>
<p>no</p>



<a name="161749932"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2357374%20higher%20ranked%20subtype%20errors/near/161749932" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> pnkfelix <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2357374.20higher.20ranked.20subtype.20errors.html#161749932">(Mar 26 2019 at 10:54)</a>:</h4>
<p>given the return of the leak-check, I think in my subconscious this bug has become P-medium (even though the actual bug is still marked P-high)</p>



<a name="161749985"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2357374%20higher%20ranked%20subtype%20errors/near/161749985" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> lqd <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2357374.20higher.20ranked.20subtype.20errors.html#161749985">(Mar 26 2019 at 10:54)</a>:</h4>
<p>I was typing the same thing</p>



<a name="161750003"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2357374%20higher%20ranked%20subtype%20errors/near/161750003" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> lqd <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2357374.20higher.20ranked.20subtype.20errors.html#161750003">(Mar 26 2019 at 10:54)</a>:</h4>
<p>I'm still unsure on how long the check is supposed to stay though</p>



<a name="161750034"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2357374%20higher%20ranked%20subtype%20errors/near/161750034" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> lqd <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2357374.20higher.20ranked.20subtype.20errors.html#161750034">(Mar 26 2019 at 10:55)</a>:</h4>
<p>and there are other issues involving higher rank subtypes as well</p>



<a name="161750558"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2357374%20higher%20ranked%20subtype%20errors/near/161750558" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> pnkfelix <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2357374.20higher.20ranked.20subtype.20errors.html#161750558">(Mar 26 2019 at 11:02)</a>:</h4>
<p>sure</p>



<hr><p>Last updated: Apr 12 2022 at 20:01 UTC</p>
</html>