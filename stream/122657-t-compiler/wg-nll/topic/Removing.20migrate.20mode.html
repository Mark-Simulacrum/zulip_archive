<html>
<head><meta charset="utf-8"><title>Removing migrate mode · t-compiler/wg-nll · Zulip Chat Archive</title></head>
<h2>Stream: <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/index.html">t-compiler/wg-nll</a></h2>
<h3>Topic: <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/Removing.20migrate.20mode.html">Removing migrate mode</a></h3>

<hr>

<base href="https://rust-lang.zulipchat.com">

<head><link href="https://zulip-archive.rust-lang.org/style.css" rel="stylesheet"></head>

<a name="261377179"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/Removing%20migrate%20mode/near/261377179" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/Removing.20migrate.20mode.html#261377179">(Nov 13 2021 at 19:58)</a>:</h4>
<p>So, I'm looking locally, and I think we're probably in a place that migrate mode can be removed, at least from the standpoint of error messages.<br>
Mir mode is not 100% the same as Migrate, but it's pretty close. The change I see most often is <code>error[E0308]: mismatched types</code> -&gt; <code>error: lifetime may not live long enough</code>, which is actually an improvement imo (the actual error text is quite nice). I don't personally have the bandwidth to see this through, but I would love for someone to essentially just make the PR. At worst, during review someone doesn't like the error output change and that needs to block it; at best, we accept the changes and move forward.</p>



<a name="261784258"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/Removing%20migrate%20mode/near/261784258" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/Removing.20migrate.20mode.html#261784258">(Nov 17 2021 at 13:36)</a>:</h4>
<p>ohh yeah, this seems good, I've talked about this with <span class="user-mention" data-user-id="116113">@lqd</span></p>



<a name="261784305"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/Removing%20migrate%20mode/near/261784305" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/Removing.20migrate.20mode.html#261784305">(Nov 17 2021 at 13:37)</a>:</h4>
<p><span class="user-mention" data-user-id="116113">@lqd</span> is someone working on this already?</p>



<a name="261807338"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/Removing%20migrate%20mode/near/261807338" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> lqd <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/Removing.20migrate.20mode.html#261807338">(Nov 17 2021 at 16:16)</a>:</h4>
<p>I'm not sure tbh, I'm not aware of more work being done since aaron hill's recent-ish great work on diagnostics (but I may have missed some, easily)</p>



<a name="261813040"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/Removing%20migrate%20mode/near/261813040" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/Removing.20migrate.20mode.html#261813040">(Nov 17 2021 at 16:52)</a>:</h4>
<p>Honestly, it's a pretty easy PR, I think. Just removing migrate mode and blessing tests (if there's actual followup work, that could be harder, but honestly unless there is something I missed, we can probably land)</p>



<a name="261830463"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/Removing%20migrate%20mode/near/261830463" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> lqd <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/Removing.20migrate.20mode.html#261830463">(Nov 17 2021 at 18:50)</a>:</h4>
<p>There is still some work to be done for diagnostics IIRC, in that esteban would not like it if we regressed them; se we may have to manually compare the 200 or so tests with different blessed expectations to make sure of that</p>
<p>it <em>was</em> my understanding that when enabling full NLLs we’d also wish to remove the leak check (while keeping some of its functionality) but I may have misunderstood Niko and maybe they meant this as one of the multiple steps to clean up what’s left of the old  regionck and so on ?</p>



<a name="261865172"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/Removing%20migrate%20mode/near/261865172" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/Removing.20migrate.20mode.html#261865172">(Nov 17 2021 at 23:23)</a>:</h4>
<p><span class="user-mention silent" data-user-id="116113">lqd</span> <a href="#narrow/stream/122657-t-compiler.2Fwg-nll/topic/Removing.20migrate.20mode/near/261830463">said</a>:</p>
<blockquote>
<p>There is still some work to be done for diagnostics IIRC, in that esteban would not like it if we regressed them; so we may have to manually compare the 200 or so tests with different blessed expectations to make sure of that</p>
</blockquote>
<p>Right, this is what I was saying; as I was going through them, I didn't see any that were particularly bad</p>



<a name="261865321"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/Removing%20migrate%20mode/near/261865321" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/Removing.20migrate.20mode.html#261865321">(Nov 17 2021 at 23:25)</a>:</h4>
<p><span class="user-mention silent" data-user-id="116113">lqd</span> <a href="#narrow/stream/122657-t-compiler.2Fwg-nll/topic/Removing.20migrate.20mode/near/261830463">said</a>:</p>
<blockquote>
<p>it <em>was</em> my understanding that when enabling full NLLs we’d also wish to remove the leak check (while keeping some of its functionality) but I may have misunderstood Niko and maybe they meant this as one of the multiple steps to clean up what’s left of the old  regionck and so on ?</p>
</blockquote>
<p>I don't think removing leak check needs to be done together with removing migrate mode. As I've recently found out (while working on the outlives lint), there's still quite a bit of code that relies on the hir regionck, at least as far as implied bounds during type checking and such</p>



<a name="261868053"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/Removing%20migrate%20mode/near/261868053" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> lqd <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/Removing.20migrate.20mode.html#261868053">(Nov 17 2021 at 23:57)</a>:</h4>
<p>the leak check thing was about this comment from niko <a href="https://github.com/rust-lang/rust/issues/58781#issuecomment-933606424">https://github.com/rust-lang/rust/issues/58781#issuecomment-933606424</a> maybe we'll need some clarification :)</p>



<a name="261868500"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/Removing%20migrate%20mode/near/261868500" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> lqd <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/Removing.20migrate.20mode.html#261868500">(Nov 18 2021 at 00:01)</a>:</h4>
<p>I agree there probably aren't any tests that are awful now that the higher ranked subtype error ones have been fixed (at least the ones we know about, we're not sure whether there still are some in the wild, but that seems possible)</p>



<a name="261869421"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/Removing%20migrate%20mode/near/261869421" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> lqd <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/Removing.20migrate.20mode.html#261869421">(Nov 18 2021 at 00:10)</a>:</h4>
<p>even if none are particularly bad, they could still be worse than the current ones, and even just regressing the quality would be unfortunate. there are cases where they are better and that's nice. we could weigh the pros and the cons, and the different ways to achieve the removal (and divvy up some tasks). </p>
<p>it would sure be nice for us contributors to not have to bless the NLL tests anymore, but we oughta make sure that the cost of fixing that isn't too big for users wrt diagnostics :)</p>



<a name="261869506"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/Removing%20migrate%20mode/near/261869506" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> lqd <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/Removing.20migrate.20mode.html#261869506">(Nov 18 2021 at 00:11)</a>:</h4>
<p>(in addition to the other blockers, like <a href="https://github.com/rust-lang/rust/issues/73154">https://github.com/rust-lang/rust/issues/73154</a>)</p>



<a name="261873327"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/Removing%20migrate%20mode/near/261873327" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/Removing.20migrate.20mode.html#261873327">(Nov 18 2021 at 01:00)</a>:</h4>
<p><span class="user-mention silent" data-user-id="116113">lqd</span> <a href="#narrow/stream/122657-t-compiler.2Fwg-nll/topic/Removing.20migrate.20mode/near/261868053">said</a>:</p>
<blockquote>
<p>the leak check thing was about this comment from niko <a href="https://github.com/rust-lang/rust/issues/58781#issuecomment-933606424">https://github.com/rust-lang/rust/issues/58781#issuecomment-933606424</a> maybe we'll need some clarification :) (maybe it's about the coercion order issue ?)</p>
</blockquote>
<p>ah I see</p>



<hr><p>Last updated: Apr 12 2022 at 20:01 UTC</p>
</html>