<html>
<head><meta charset="utf-8"><title>#47349-suggestion-to-pull-out-subcomputation · t-compiler/wg-nll · Zulip Chat Archive</title></head>
<h2>Stream: <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/index.html">t-compiler/wg-nll</a></h2>
<h3>Topic: <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2347349-suggestion-to-pull-out-subcomputation.html">#47349-suggestion-to-pull-out-subcomputation</a></h3>

<hr>

<base href="https://rust-lang.zulipchat.com">

<head><link href="https://zulip-archive.rust-lang.org/style.css" rel="stylesheet"></head>

<a name="131007960"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2347349-suggestion-to-pull-out-subcomputation/near/131007960" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Keith Yeung <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2347349-suggestion-to-pull-out-subcomputation.html#131007960">(Aug 06 2018 at 22:36)</a>:</h4>
<p>okay, so i'm currently looking at this issue, and the first thing i'd like to know now is which function MIR borrowck calls in order to generate that error message</p>



<a name="131007968"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2347349-suggestion-to-pull-out-subcomputation/near/131007968" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Keith Yeung <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2347349-suggestion-to-pull-out-subcomputation.html#131007968">(Aug 06 2018 at 22:37)</a>:</h4>
<p>i currently have a few ideas: <code>check_access_conflict</code> or <code>check_access_permissions</code></p>



<a name="131009079"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2347349-suggestion-to-pull-out-subcomputation/near/131009079" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2347349-suggestion-to-pull-out-subcomputation.html#131009079">(Aug 06 2018 at 23:08)</a>:</h4>
<p><code>check_access_conflict</code>, I believe</p>



<a name="131009089"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2347349-suggestion-to-pull-out-subcomputation/near/131009089" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2347349-suggestion-to-pull-out-subcomputation.html#131009089">(Aug 06 2018 at 23:09)</a>:</h4>
<p><code>check_access_permissions</code> is different -- it checks just one borrow to see if you have sufficient permissions to do that (e.g., an <code>&amp;mut</code> borrow of something that is not mutable is just a plain error)</p>



<a name="131965137"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2347349-suggestion-to-pull-out-subcomputation/near/131965137" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Keith Yeung <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2347349-suggestion-to-pull-out-subcomputation.html#131965137">(Aug 11 2018 at 18:53)</a>:</h4>
<p>i'm forgetting things, but I recall that there's a BasicBlock data structure that i can access somewhere</p>



<a name="131965192"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2347349-suggestion-to-pull-out-subcomputation/near/131965192" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Keith Yeung <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2347349-suggestion-to-pull-out-subcomputation.html#131965192">(Aug 11 2018 at 18:54)</a>:</h4>
<p>bingo, it's MIR</p>



<a name="131965204"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2347349-suggestion-to-pull-out-subcomputation/near/131965204" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Keith Yeung <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2347349-suggestion-to-pull-out-subcomputation.html#131965204">(Aug 11 2018 at 18:55)</a>:</h4>
<p>i'm planning to use this to look for the next MIR statements that have a function call argument containing the "starting borrow's" temporary</p>



<a name="131975021"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2347349-suggestion-to-pull-out-subcomputation/near/131975021" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Keith Yeung <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2347349-suggestion-to-pull-out-subcomputation.html#131975021">(Aug 12 2018 at 00:55)</a>:</h4>
<p>actually, that is not necessary, because function calls are only done in terminators</p>



<a name="131975160"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2347349-suggestion-to-pull-out-subcomputation/near/131975160" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Keith Yeung <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2347349-suggestion-to-pull-out-subcomputation.html#131975160">(Aug 12 2018 at 01:00)</a>:</h4>
<p>now here comes a problem: i have two <code>Place</code>s, and i want to know if one of them is assigned from another (or if they're both equal)</p>



<a name="131975260"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2347349-suggestion-to-pull-out-subcomputation/near/131975260" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Keith Yeung <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2347349-suggestion-to-pull-out-subcomputation.html#131975260">(Aug 12 2018 at 01:04)</a>:</h4>
<p>oh, looks like i can call <code>base_path</code> to achieve that effect</p>



<a name="131976068"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2347349-suggestion-to-pull-out-subcomputation/near/131976068" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Keith Yeung <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2347349-suggestion-to-pull-out-subcomputation.html#131976068">(Aug 12 2018 at 01:34)</a>:</h4>
<p>nope, that's only for dereffing Projections</p>



<a name="131988954"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2347349-suggestion-to-pull-out-subcomputation/near/131988954" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2347349-suggestion-to-pull-out-subcomputation.html#131988954">(Aug 12 2018 at 08:48)</a>:</h4>
<p>what does "assigned from another" mean? can you give an example?</p>



<a name="131988959"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2347349-suggestion-to-pull-out-subcomputation/near/131988959" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2347349-suggestion-to-pull-out-subcomputation.html#131988959">(Aug 12 2018 at 08:48)</a>:</h4>
<p>you might want <a href="https://doc.rust-lang.org/nightly/nightly-rustc/rustc_mir/borrow_check/places_conflict/fn.places_conflict.html" target="_blank" title="https://doc.rust-lang.org/nightly/nightly-rustc/rustc_mir/borrow_check/places_conflict/fn.places_conflict.html"><code>places_conflict</code></a>?</p>



<a name="131990525"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2347349-suggestion-to-pull-out-subcomputation/near/131990525" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Keith Yeung <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2347349-suggestion-to-pull-out-subcomputation.html#131990525">(Aug 12 2018 at 09:46)</a>:</h4>
<p>i meant "from the other"</p>



<a name="131990527"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2347349-suggestion-to-pull-out-subcomputation/near/131990527" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Keith Yeung <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2347349-suggestion-to-pull-out-subcomputation.html#131990527">(Aug 12 2018 at 09:46)</a>:</h4>
<p>i have two <code>Place</code>s, and i want to determine whether there is a relationship between them</p>



<a name="132021073"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2347349-suggestion-to-pull-out-subcomputation/near/132021073" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Keith Yeung <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2347349-suggestion-to-pull-out-subcomputation.html#132021073">(Aug 13 2018 at 03:00)</a>:</h4>
<p>it doesn't look like <code>places_conflict</code> does what i need, since it doesn't trace the "assignment path" that a place took</p>



<a name="132021088"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2347349-suggestion-to-pull-out-subcomputation/near/132021088" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Keith Yeung <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2347349-suggestion-to-pull-out-subcomputation.html#132021088">(Aug 13 2018 at 03:01)</a>:</h4>
<p>here's an MIR example:</p>
<p>_2 = _1<br>
_3 = _2<br>
_4 = const Foo::foo(move _3)</p>



<a name="132021129"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2347349-suggestion-to-pull-out-subcomputation/near/132021129" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Keith Yeung <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2347349-suggestion-to-pull-out-subcomputation.html#132021129">(Aug 13 2018 at 03:02)</a>:</h4>
<p>now, suppose that i have _1 and _3</p>



<a name="132021131"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2347349-suggestion-to-pull-out-subcomputation/near/132021131" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Keith Yeung <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2347349-suggestion-to-pull-out-subcomputation.html#132021131">(Aug 13 2018 at 03:02)</a>:</h4>
<p>my objective here is to show that they're the same place</p>



<a name="132021296"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2347349-suggestion-to-pull-out-subcomputation/near/132021296" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Keith Yeung <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2347349-suggestion-to-pull-out-subcomputation.html#132021296">(Aug 13 2018 at 03:06)</a>:</h4>
<p>aside from that, I seem to be running into trouble getting the correct span for the function call i want</p>



<a name="132021303"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2347349-suggestion-to-pull-out-subcomputation/near/132021303" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Keith Yeung <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2347349-suggestion-to-pull-out-subcomputation.html#132021303">(Aug 13 2018 at 03:06)</a>:</h4>
<div class="codehilite"><pre><span></span><span class="w">    </span><span class="n">buckets</span><span class="p">.</span><span class="n">slice_mut</span><span class="p">()[(</span><span class="n">key</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="kt">usize</span><span class="p">).</span><span class="n">wrapping_add</span><span class="p">(</span><span class="mi">22</span><span class="p">).</span><span class="n">wrapping_rem</span><span class="p">(</span><span class="n">buckets</span><span class="p">.</span><span class="n">sweep</span><span class="p">())]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">22</span><span class="p">;</span><span class="w"></span>
</pre></div>



<a name="132021312"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2347349-suggestion-to-pull-out-subcomputation/near/132021312" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Keith Yeung <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2347349-suggestion-to-pull-out-subcomputation.html#132021312">(Aug 13 2018 at 03:07)</a>:</h4>
<p>for some reason, the basic block terminator's span underlines <code>buckets.slice_mut()</code> and not <code>buckets.sweep()</code></p>



<a name="132022225"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2347349-suggestion-to-pull-out-subcomputation/near/132022225" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Keith Yeung <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2347349-suggestion-to-pull-out-subcomputation.html#132022225">(Aug 13 2018 at 03:31)</a>:</h4>
<p>huh, so i was looking at the wrong bb</p>



<a name="132022708"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2347349-suggestion-to-pull-out-subcomputation/near/132022708" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Keith Yeung <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2347349-suggestion-to-pull-out-subcomputation.html#132022708">(Aug 13 2018 at 03:46)</a>:</h4>
<p>also, i'm heavily overthinking this, the relevant data that i need is all in <code>BorrowData</code></p>



<a name="132025698"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2347349-suggestion-to-pull-out-subcomputation/near/132025698" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Keith Yeung <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2347349-suggestion-to-pull-out-subcomputation.html#132025698">(Aug 13 2018 at 05:28)</a>:</h4>
<p>alright, PR out <a href="https://github.com/rust-lang/rust/pull/53305" target="_blank" title="https://github.com/rust-lang/rust/pull/53305">https://github.com/rust-lang/rust/pull/53305</a></p>



<a name="132270609"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2347349-suggestion-to-pull-out-subcomputation/near/132270609" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Keith Yeung <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2347349-suggestion-to-pull-out-subcomputation.html#132270609">(Aug 16 2018 at 23:09)</a>:</h4>
<p><span class="user-mention" data-user-id="116009">@nikomatsakis</span> I'm thinking that your suggestion as written doesn't quite work the way we want it</p>



<a name="132270663"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2347349-suggestion-to-pull-out-subcomputation/near/132270663" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Keith Yeung <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2347349-suggestion-to-pull-out-subcomputation.html#132270663">(Aug 16 2018 at 23:10)</a>:</h4>
<p>in my PR, i ignore the "starting borrow" altogether, and only focused on looking at the location that the conflicting borrow occured</p>



<a name="132270695"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2347349-suggestion-to-pull-out-subcomputation/near/132270695" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Keith Yeung <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2347349-suggestion-to-pull-out-subcomputation.html#132270695">(Aug 16 2018 at 23:11)</a>:</h4>
<p>that's obviously not the correct way, but factoring the "starting borrow" into consideration doesn't help much</p>



<a name="132270741"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2347349-suggestion-to-pull-out-subcomputation/near/132270741" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Keith Yeung <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2347349-suggestion-to-pull-out-subcomputation.html#132270741">(Aug 16 2018 at 23:12)</a>:</h4>
<p>because the lvalue on that starting borrow immediately gets used as an argument to a function, and so there's nothing in between the "starting borrow" and the error location</p>



<a name="132270801"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2347349-suggestion-to-pull-out-subcomputation/near/132270801" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Keith Yeung <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2347349-suggestion-to-pull-out-subcomputation.html#132270801">(Aug 16 2018 at 23:14)</a>:</h4>
<p>i suspect you wanted to say "the error case between the lvalue of the return value of the function and the time it's dropped", instead of "the error case between the starting borrow and the call"?</p>



<a name="132273135"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2347349-suggestion-to-pull-out-subcomputation/near/132273135" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Keith Yeung <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2347349-suggestion-to-pull-out-subcomputation.html#132273135">(Aug 17 2018 at 00:17)</a>:</h4>
<p>possibly also with the additional requirement that the return value of that function contains a lifetime associated with the "starting borrow"</p>



<a name="132527083"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2347349-suggestion-to-pull-out-subcomputation/near/132527083" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2347349-suggestion-to-pull-out-subcomputation.html#132527083">(Aug 21 2018 at 16:24)</a>:</h4>
<p>hmm <span class="user-mention" data-user-id="116108">@Keith Yeung</span> quite possibly so!</p>



<a name="132527105"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2347349-suggestion-to-pull-out-subcomputation/near/132527105" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2347349-suggestion-to-pull-out-subcomputation.html#132527105">(Aug 21 2018 at 16:25)</a>:</h4>
<p>can I check your PR for context?</p>



<a name="132528288"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2347349-suggestion-to-pull-out-subcomputation/near/132528288" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Keith Yeung <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2347349-suggestion-to-pull-out-subcomputation.html#132528288">(Aug 21 2018 at 16:48)</a>:</h4>
<p>Yeah, it's  <a href="https://github.com/rust-lang/rust/pull/53305" target="_blank" title="https://github.com/rust-lang/rust/pull/53305">https://github.com/rust-lang/rust/pull/53305</a></p>



<a name="132662113"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2347349-suggestion-to-pull-out-subcomputation/near/132662113" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Keith Yeung <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2347349-suggestion-to-pull-out-subcomputation.html#132662113">(Aug 23 2018 at 21:34)</a>:</h4>
<p><span class="user-mention" data-user-id="116009">@nikomatsakis</span>  regarding the comments you left, i think what you have in mind is significantly less in scope than what I have imagined</p>



<a name="132662131"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2347349-suggestion-to-pull-out-subcomputation/near/132662131" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Keith Yeung <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2347349-suggestion-to-pull-out-subcomputation.html#132662131">(Aug 23 2018 at 21:35)</a>:</h4>
<p>because it seems that we're only interested in solving the cases where <code>foo(xxx, ..., yyy)</code> causes a problem</p>



<a name="132662189"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2347349-suggestion-to-pull-out-subcomputation/near/132662189" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Keith Yeung <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2347349-suggestion-to-pull-out-subcomputation.html#132662189">(Aug 23 2018 at 21:36)</a>:</h4>
<p>whereas in the problematic code where the issue was raised, the line of code is:</p>



<a name="132662192"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2347349-suggestion-to-pull-out-subcomputation/near/132662192" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Keith Yeung <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2347349-suggestion-to-pull-out-subcomputation.html#132662192">(Aug 23 2018 at 21:36)</a>:</h4>
<div class="codehilite"><pre><span></span>buckets.slice_mut()[(key as usize).wrapping_add(22).wrapping_rem(buckets.sweep())] = 22;
</pre></div>



<a name="132662212"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2347349-suggestion-to-pull-out-subcomputation/near/132662212" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Keith Yeung <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2347349-suggestion-to-pull-out-subcomputation.html#132662212">(Aug 23 2018 at 21:36)</a>:</h4>
<p>and this is a conflict between <code>buckets.slice_mut()</code> and <code>buckets.sweep()</code></p>



<a name="132662219"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2347349-suggestion-to-pull-out-subcomputation/near/132662219" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Keith Yeung <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2347349-suggestion-to-pull-out-subcomputation.html#132662219">(Aug 23 2018 at 21:37)</a>:</h4>
<p>it does not follow the format of <code>foo(xxx, ..., yyy)</code></p>



<a name="132662291"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2347349-suggestion-to-pull-out-subcomputation/near/132662291" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2347349-suggestion-to-pull-out-subcomputation.html#132662291">(Aug 23 2018 at 21:38)</a>:</h4>
<p>well, it does</p>



<a name="132662294"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2347349-suggestion-to-pull-out-subcomputation/near/132662294" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2347349-suggestion-to-pull-out-subcomputation.html#132662294">(Aug 23 2018 at 21:38)</a>:</h4>
<p>if you desugar, you get</p>



<a name="132662302"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2347349-suggestion-to-pull-out-subcomputation/near/132662302" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2347349-suggestion-to-pull-out-subcomputation.html#132662302">(Aug 23 2018 at 21:39)</a>:</h4>
<p><code>wrapping_rem(&amp;mut buckets.slice_mut()[(key as usize).wrapping_add(22), buckets.sweep())</code> or something like that...</p>



<a name="132662305"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2347349-suggestion-to-pull-out-subcomputation/near/132662305" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2347349-suggestion-to-pull-out-subcomputation.html#132662305">(Aug 23 2018 at 21:39)</a>:</h4>
<p>I'm not sure how much that matters though</p>



<a name="132662307"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2347349-suggestion-to-pull-out-subcomputation/near/132662307" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2347349-suggestion-to-pull-out-subcomputation.html#132662307">(Aug 23 2018 at 21:39)</a>:</h4>
<p>all this stuff disappears in MIR to some extent</p>



<a name="132662310"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2347349-suggestion-to-pull-out-subcomputation/near/132662310" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Keith Yeung <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2347349-suggestion-to-pull-out-subcomputation.html#132662310">(Aug 23 2018 at 21:39)</a>:</h4>
<p>that doesn't seem to look like what you described in the MIR</p>



<a name="132662348"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2347349-suggestion-to-pull-out-subcomputation/near/132662348" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Keith Yeung <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2347349-suggestion-to-pull-out-subcomputation.html#132662348">(Aug 23 2018 at 21:40)</a>:</h4>
<p>oh, you were talking strictly about HIR?</p>



<a name="132662367"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2347349-suggestion-to-pull-out-subcomputation/near/132662367" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2347349-suggestion-to-pull-out-subcomputation.html#132662367">(Aug 23 2018 at 21:40)</a>:</h4>
<p>no, not at all</p>



<a name="132662371"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2347349-suggestion-to-pull-out-subcomputation/near/132662371" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2347349-suggestion-to-pull-out-subcomputation.html#132662371">(Aug 23 2018 at 21:40)</a>:</h4>
<p>I mean .. we're analyzing the MIR</p>



<a name="132662374"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2347349-suggestion-to-pull-out-subcomputation/near/132662374" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2347349-suggestion-to-pull-out-subcomputation.html#132662374">(Aug 23 2018 at 21:40)</a>:</h4>
<p>I'm not proposing we look at the HIR</p>



<a name="132662385"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2347349-suggestion-to-pull-out-subcomputation/near/132662385" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2347349-suggestion-to-pull-out-subcomputation.html#132662385">(Aug 23 2018 at 21:40)</a>:</h4>
<p>but in the MIR there is somewhere a <code>Call(A, B)</code> -- and producing that value <code>A</code> creates a mut borrow, whereas producing <code>B</code> takes a shared borrow of same path</p>



<a name="132662400"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2347349-suggestion-to-pull-out-subcomputation/near/132662400" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2347349-suggestion-to-pull-out-subcomputation.html#132662400">(Aug 23 2018 at 21:41)</a>:</h4>
<p>but I'm not sure it's the right way to think about it</p>



<a name="132662412"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2347349-suggestion-to-pull-out-subcomputation/near/132662412" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Keith Yeung <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2347349-suggestion-to-pull-out-subcomputation.html#132662412">(Aug 23 2018 at 21:41)</a>:</h4>
<p>huh, i'm not seeing that...</p>



<a name="132662417"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2347349-suggestion-to-pull-out-subcomputation/near/132662417" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Keith Yeung <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2347349-suggestion-to-pull-out-subcomputation.html#132662417">(Aug 23 2018 at 21:41)</a>:</h4>
<p>here's the MIR in question <a href="https://github.com/rust-lang/rust/pull/53305#issuecomment-412427620" target="_blank" title="https://github.com/rust-lang/rust/pull/53305#issuecomment-412427620">https://github.com/rust-lang/rust/pull/53305#issuecomment-412427620</a></p>



<a name="132662469"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2347349-suggestion-to-pull-out-subcomputation/near/132662469" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Keith Yeung <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2347349-suggestion-to-pull-out-subcomputation.html#132662469">(Aug 23 2018 at 21:42)</a>:</h4>
<p>it's the terminator for bb0 and bb4</p>



<a name="132662476"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2347349-suggestion-to-pull-out-subcomputation/near/132662476" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Keith Yeung <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2347349-suggestion-to-pull-out-subcomputation.html#132662476">(Aug 23 2018 at 21:42)</a>:</h4>
<p>they both take a reference of _1, bb0 uses it mutably while bb4 uses it immutably</p>



<a name="132662495"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2347349-suggestion-to-pull-out-subcomputation/near/132662495" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2347349-suggestion-to-pull-out-subcomputation.html#132662495">(Aug 23 2018 at 21:42)</a>:</h4>
<p>well, the call that brings them togther is</p>
<div class="codehilite"><pre><span></span>_5 = const core::num::&lt;impl usize&gt;::wrapping_rem(move _6, move _9)
</pre></div>



<a name="132662498"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2347349-suggestion-to-pull-out-subcomputation/near/132662498" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2347349-suggestion-to-pull-out-subcomputation.html#132662498">(Aug 23 2018 at 21:43)</a>:</h4>
<p>from <code>bb5</code></p>



<a name="132662509"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2347349-suggestion-to-pull-out-subcomputation/near/132662509" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Keith Yeung <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2347349-suggestion-to-pull-out-subcomputation.html#132662509">(Aug 23 2018 at 21:43)</a>:</h4>
<p>i see, but the error is raised at bb4</p>



<a name="132662513"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2347349-suggestion-to-pull-out-subcomputation/near/132662513" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2347349-suggestion-to-pull-out-subcomputation.html#132662513">(Aug 23 2018 at 21:43)</a>:</h4>
<p>I didn't mean to imply that the point where the error is raised</p>



<a name="132662515"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2347349-suggestion-to-pull-out-subcomputation/near/132662515" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2347349-suggestion-to-pull-out-subcomputation.html#132662515">(Aug 23 2018 at 21:43)</a>:</h4>
<p>is the call that brings them together</p>



<a name="132662516"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2347349-suggestion-to-pull-out-subcomputation/near/132662516" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2347349-suggestion-to-pull-out-subcomputation.html#132662516">(Aug 23 2018 at 21:43)</a>:</h4>
<p>in fact, I would not expect that</p>



<a name="132662523"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2347349-suggestion-to-pull-out-subcomputation/near/132662523" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2347349-suggestion-to-pull-out-subcomputation.html#132662523">(Aug 23 2018 at 21:43)</a>:</h4>
<p>the point where error is part of creating the <em>argument</em> (probably the 2nd one)</p>



<a name="132662566"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2347349-suggestion-to-pull-out-subcomputation/near/132662566" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2347349-suggestion-to-pull-out-subcomputation.html#132662566">(Aug 23 2018 at 21:44)</a>:</h4>
<p>so e.g. this call from bb4 produces <code>_9</code></p>



<a name="132662570"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2347349-suggestion-to-pull-out-subcomputation/near/132662570" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2347349-suggestion-to-pull-out-subcomputation.html#132662570">(Aug 23 2018 at 21:44)</a>:</h4>
<p>which then feeds into the call at <code>bb6</code> (along with <code>_6</code>)</p>



<a name="132662575"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2347349-suggestion-to-pull-out-subcomputation/near/132662575" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2347349-suggestion-to-pull-out-subcomputation.html#132662575">(Aug 23 2018 at 21:44)</a>:</h4>
<p>and here the bug is because there is some mut borrow that is held live because of <code>_6</code></p>



<a name="132662582"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2347349-suggestion-to-pull-out-subcomputation/near/132662582" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2347349-suggestion-to-pull-out-subcomputation.html#132662582">(Aug 23 2018 at 21:45)</a>:</h4>
<p>but I'm not sure how relevant that is</p>



<a name="132662599"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2347349-suggestion-to-pull-out-subcomputation/near/132662599" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2347349-suggestion-to-pull-out-subcomputation.html#132662599">(Aug 23 2018 at 21:45)</a>:</h4>
<p>like, we're basically trying to say "maybe you should pull this subcomputation out and do it earlier"</p>



<a name="132662600"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2347349-suggestion-to-pull-out-subcomputation/near/132662600" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2347349-suggestion-to-pull-out-subcomputation.html#132662600">(Aug 23 2018 at 21:45)</a>:</h4>
<p>and that could apply in many cases</p>



<a name="132662602"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2347349-suggestion-to-pull-out-subcomputation/near/132662602" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2347349-suggestion-to-pull-out-subcomputation.html#132662602">(Aug 23 2018 at 21:45)</a>:</h4>
<p>for example</p>



<a name="132662615"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2347349-suggestion-to-pull-out-subcomputation/near/132662615" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2347349-suggestion-to-pull-out-subcomputation.html#132662615">(Aug 23 2018 at 21:45)</a>:</h4>
<div class="codehilite"><pre><span></span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="n">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">&amp;</span><span class="k">mut</span><span class="w"> </span><span class="n">foo</span><span class="p">;</span><span class="w"></span>
<span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="n">y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">foo</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span><span class="p">;</span><span class="w"></span>
<span class="w">    </span><span class="o">*</span><span class="n">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">y</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span><span class="p">;</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>
</pre></div>



<a name="132662622"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2347349-suggestion-to-pull-out-subcomputation/near/132662622" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2347349-suggestion-to-pull-out-subcomputation.html#132662622">(Aug 23 2018 at 21:45)</a>:</h4>
<p>maybe we can identify that <code>foo + 1</code> could be extracted earlier</p>



<a name="132662679"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2347349-suggestion-to-pull-out-subcomputation/near/132662679" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2347349-suggestion-to-pull-out-subcomputation.html#132662679">(Aug 23 2018 at 21:46)</a>:</h4>
<p>I guess to be <em>really</em> right here we'd want to do a more involved "availability" analysis</p>



<a name="132662682"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2347349-suggestion-to-pull-out-subcomputation/near/132662682" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2347349-suggestion-to-pull-out-subcomputation.html#132662682">(Aug 23 2018 at 21:46)</a>:</h4>
<p>(e.g., this is a kind of code motion)</p>



<a name="132662686"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2347349-suggestion-to-pull-out-subcomputation/near/132662686" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2347349-suggestion-to-pull-out-subcomputation.html#132662686">(Aug 23 2018 at 21:46)</a>:</h4>
<p>that seems a bit much</p>



<a name="132662696"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2347349-suggestion-to-pull-out-subcomputation/near/132662696" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Keith Yeung <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2347349-suggestion-to-pull-out-subcomputation.html#132662696">(Aug 23 2018 at 21:47)</a>:</h4>
<p>yeah, i feel like with the tools we currently have in the compiler, we aren't able to accomplish this analysis yet</p>



<a name="132662705"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2347349-suggestion-to-pull-out-subcomputation/near/132662705" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2347349-suggestion-to-pull-out-subcomputation.html#132662705">(Aug 23 2018 at 21:47)</a>:</h4>
<p>we could do something hackier involving spans or something but..ugh</p>



<a name="132662707"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2347349-suggestion-to-pull-out-subcomputation/near/132662707" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Keith Yeung <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2347349-suggestion-to-pull-out-subcomputation.html#132662707">(Aug 23 2018 at 21:47)</a>:</h4>
<p>but that does sound like the correct way</p>



<a name="132662715"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2347349-suggestion-to-pull-out-subcomputation/near/132662715" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2347349-suggestion-to-pull-out-subcomputation.html#132662715">(Aug 23 2018 at 21:48)</a>:</h4>
<p>yeah I mean the code motion thing is the <em>right</em> thing</p>



<a name="132662732"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2347349-suggestion-to-pull-out-subcomputation/near/132662732" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Keith Yeung <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2347349-suggestion-to-pull-out-subcomputation.html#132662732">(Aug 23 2018 at 21:48)</a>:</h4>
<p>the only problem is whether we'd want a reduced (and perhaps a bit incorrect) subset of this analysis</p>



<a name="132662777"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2347349-suggestion-to-pull-out-subcomputation/near/132662777" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2347349-suggestion-to-pull-out-subcomputation.html#132662777">(Aug 23 2018 at 21:48)</a>:</h4>
<p>it's sort of unclear because we might want to make the suggestion</p>



<a name="132662781"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2347349-suggestion-to-pull-out-subcomputation/near/132662781" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2347349-suggestion-to-pull-out-subcomputation.html#132662781">(Aug 23 2018 at 21:48)</a>:</h4>
<p>even if we can't be sure it wouldn't affect semantics..?</p>



<a name="132662782"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2347349-suggestion-to-pull-out-subcomputation/near/132662782" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2347349-suggestion-to-pull-out-subcomputation.html#132662782">(Aug 23 2018 at 21:48)</a>:</h4>
<p>anyway</p>



<a name="132662783"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2347349-suggestion-to-pull-out-subcomputation/near/132662783" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2347349-suggestion-to-pull-out-subcomputation.html#132662783">(Aug 23 2018 at 21:48)</a>:</h4>
<p>the alternative is</p>



<a name="132662785"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2347349-suggestion-to-pull-out-subcomputation/near/132662785" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2347349-suggestion-to-pull-out-subcomputation.html#132662785">(Aug 23 2018 at 21:48)</a>:</h4>
<p>we don't necessarily <em>suggest</em> anything</p>



<a name="132662790"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2347349-suggestion-to-pull-out-subcomputation/near/132662790" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2347349-suggestion-to-pull-out-subcomputation.html#132662790">(Aug 23 2018 at 21:48)</a>:</h4>
<p>well</p>



<a name="132662794"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2347349-suggestion-to-pull-out-subcomputation/near/132662794" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2347349-suggestion-to-pull-out-subcomputation.html#132662794">(Aug 23 2018 at 21:48)</a>:</h4>
<p>we can make a more generic suggestion like</p>



<a name="132662797"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2347349-suggestion-to-pull-out-subcomputation/near/132662797" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2347349-suggestion-to-pull-out-subcomputation.html#132662797">(Aug 23 2018 at 21:49)</a>:</h4>
<p>"is it possible to move the shared borrow so it executes earlier?"</p>



<a name="132662803"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2347349-suggestion-to-pull-out-subcomputation/near/132662803" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2347349-suggestion-to-pull-out-subcomputation.html#132662803">(Aug 23 2018 at 21:49)</a>:</h4>
<p>this could apply a lot of times</p>



<a name="132662808"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2347349-suggestion-to-pull-out-subcomputation/near/132662808" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2347349-suggestion-to-pull-out-subcomputation.html#132662808">(Aug 23 2018 at 21:49)</a>:</h4>
<p>and/or we somehow explain what is happening better</p>



<a name="132662892"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2347349-suggestion-to-pull-out-subcomputation/near/132662892" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Keith Yeung <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2347349-suggestion-to-pull-out-subcomputation.html#132662892">(Aug 23 2018 at 21:51)</a>:</h4>
<p>sorry, i'm still stuck at looking at the MIR for this particular issue</p>



<a name="132662894"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2347349-suggestion-to-pull-out-subcomputation/near/132662894" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Keith Yeung <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2347349-suggestion-to-pull-out-subcomputation.html#132662894">(Aug 23 2018 at 21:51)</a>:</h4>
<p>i can't see how <code>_6</code> matters here</p>



<a name="132662897"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2347349-suggestion-to-pull-out-subcomputation/near/132662897" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2347349-suggestion-to-pull-out-subcomputation.html#132662897">(Aug 23 2018 at 21:51)</a>:</h4>
<p>it doesn't <em>in particular</em></p>



<a name="132662941"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2347349-suggestion-to-pull-out-subcomputation/near/132662941" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2347349-suggestion-to-pull-out-subcomputation.html#132662941">(Aug 23 2018 at 21:52)</a>:</h4>
<p>the question is basically "when do we offer a suggestion"</p>



<a name="132662948"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2347349-suggestion-to-pull-out-subcomputation/near/132662948" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2347349-suggestion-to-pull-out-subcomputation.html#132662948">(Aug 23 2018 at 21:53)</a>:</h4>
<p>basically from the MIR POV there is no difference between "a[x] += a[y]" and <code>let p = &amp;mut a[x]; let v = a[y]; *p += v</code></p>



<a name="132662952"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2347349-suggestion-to-pull-out-subcomputation/near/132662952" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2347349-suggestion-to-pull-out-subcomputation.html#132662952">(Aug 23 2018 at 21:53)</a>:</h4>
<p>which is exactly the problem</p>



<a name="132662954"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2347349-suggestion-to-pull-out-subcomputation/near/132662954" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2347349-suggestion-to-pull-out-subcomputation.html#132662954">(Aug 23 2018 at 21:53)</a>:</h4>
<p>i.e., why we have an error</p>



<a name="132662958"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2347349-suggestion-to-pull-out-subcomputation/near/132662958" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2347349-suggestion-to-pull-out-subcomputation.html#132662958">(Aug 23 2018 at 21:53)</a>:</h4>
<p>but so either we just suggest "maybe move the shared borrow earlier" like... all the time</p>



<a name="132662960"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2347349-suggestion-to-pull-out-subcomputation/near/132662960" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2347349-suggestion-to-pull-out-subcomputation.html#132662960">(Aug 23 2018 at 21:53)</a>:</h4>
<p>or we compare lines or something</p>



<a name="132662968"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2347349-suggestion-to-pull-out-subcomputation/near/132662968" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2347349-suggestion-to-pull-out-subcomputation.html#132662968">(Aug 23 2018 at 21:53)</a>:</h4>
<p>I was thinking "or else we try to see if this arose as part of generating temporaries for a method call"</p>



<a name="132662970"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2347349-suggestion-to-pull-out-subcomputation/near/132662970" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Keith Yeung <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2347349-suggestion-to-pull-out-subcomputation.html#132662970">(Aug 23 2018 at 21:53)</a>:</h4>
<p>ahh ok, so all we're really concerned about is whether the problematic borrow is later used as an argument to a funciton</p>



<a name="132663006"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2347349-suggestion-to-pull-out-subcomputation/near/132663006" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2347349-suggestion-to-pull-out-subcomputation.html#132663006">(Aug 23 2018 at 21:54)</a>:</h4>
<p>which kind of suggests that it was a <code>foo(&amp;mut a[x], a[y])</code> situation</p>



<a name="132663017"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2347349-suggestion-to-pull-out-subcomputation/near/132663017" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2347349-suggestion-to-pull-out-subcomputation.html#132663017">(Aug 23 2018 at 21:54)</a>:</h4>
<p>but there is no particular reason that this suggestion only applies then</p>



<a name="132663019"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2347349-suggestion-to-pull-out-subcomputation/near/132663019" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Keith Yeung <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2347349-suggestion-to-pull-out-subcomputation.html#132663019">(Aug 23 2018 at 21:54)</a>:</h4>
<p>and we don't check what happens with the "starting borrow"</p>



<a name="132663024"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2347349-suggestion-to-pull-out-subcomputation/near/132663024" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2347349-suggestion-to-pull-out-subcomputation.html#132663024">(Aug 23 2018 at 21:54)</a>:</h4>
<p>except it's sort of... mildly less likely that there is "interference"</p>



<a name="132663186"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2347349-suggestion-to-pull-out-subcomputation/near/132663186" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Keith Yeung <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2347349-suggestion-to-pull-out-subcomputation.html#132663186">(Aug 23 2018 at 21:58)</a>:</h4>
<p>hmm... i would've expected <code>let p = &amp;mut a[x]; let v = a[y]; *p += v</code> to compile</p>



<a name="132663204"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2347349-suggestion-to-pull-out-subcomputation/near/132663204" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Keith Yeung <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2347349-suggestion-to-pull-out-subcomputation.html#132663204">(Aug 23 2018 at 21:59)</a>:</h4>
<p>but <code>a[x] += a[y]</code> would not</p>



<a name="132669003"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2347349-suggestion-to-pull-out-subcomputation/near/132669003" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2347349-suggestion-to-pull-out-subcomputation.html#132669003">(Aug 24 2018 at 00:43)</a>:</h4>
<p><code>a[x] += a[y]</code> only sometimes does, I think; only if a is a <code>&amp;mut [u32]</code> or some such thing</p>



<hr><p>Last updated: Apr 12 2022 at 20:01 UTC</p>
</html>