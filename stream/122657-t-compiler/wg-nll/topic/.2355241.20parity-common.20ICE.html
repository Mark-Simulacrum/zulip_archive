<html>
<head><meta charset="utf-8"><title>#55241 parity-common ICE · t-compiler/wg-nll · Zulip Chat Archive</title></head>
<h2>Stream: <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/index.html">t-compiler/wg-nll</a></h2>
<h3>Topic: <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2355241.20parity-common.20ICE.html">#55241 parity-common ICE</a></h3>

<hr>

<base href="https://rust-lang.zulipchat.com">

<head><link href="https://zulip-archive.rust-lang.org/style.css" rel="stylesheet"></head>

<a name="136364257"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2355241%20parity-common%20ICE/near/136364257" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2355241.20parity-common.20ICE.html#136364257">(Oct 23 2018 at 20:17)</a>:</h4>
<p>I am looking at this <span class="user-mention" data-user-id="116083">@pnkfelix</span> fyi. Getting kind of worried about these ICEs.</p>



<a name="136364303"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2355241%20parity-common%20ICE/near/136364303" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> pnkfelix <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2355241.20parity-common.20ICE.html#136364303">(Oct 23 2018 at 20:18)</a>:</h4>
<p>okay i'm glad you're looking at it</p>



<a name="136364309"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2355241%20parity-common%20ICE/near/136364309" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2355241.20parity-common.20ICE.html#136364309">(Oct 23 2018 at 20:18)</a>:</h4>
<p>ah, wait, I ran my test in the wrong branch</p>



<a name="136364319"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2355241%20parity-common%20ICE/near/136364319" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2355241.20parity-common.20ICE.html#136364319">(Oct 23 2018 at 20:18)</a>:</h4>
<p>I am hoping my PR fixes it :P</p>



<a name="136364323"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2355241%20parity-common%20ICE/near/136364323" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> pnkfelix <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2355241.20parity-common.20ICE.html#136364323">(Oct 23 2018 at 20:18)</a>:</h4>
<p>I was going to try to look at the ICE's after I finished trying to fix my PR</p>



<a name="136364327"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2355241%20parity-common%20ICE/near/136364327" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2355241.20parity-common.20ICE.html#136364327">(Oct 23 2018 at 20:18)</a>:</h4>
<p>I remember fixing some similar asserions</p>



<a name="136364399"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2355241%20parity-common%20ICE/near/136364399" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2355241.20parity-common.20ICE.html#136364399">(Oct 23 2018 at 20:19)</a>:</h4>
<p>sadly, still fails</p>



<a name="136364400"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2355241%20parity-common%20ICE/near/136364400" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> pnkfelix <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2355241.20parity-common.20ICE.html#136364400">(Oct 23 2018 at 20:19)</a>:</h4>
<p>are you also looking at the "ICE when accessing an associated constant of a generic impl" <a href="https://github.com/rust-lang/rust/issues/55219" target="_blank" title="https://github.com/rust-lang/rust/issues/55219">#55219</a> ?</p>



<a name="136364466"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2355241%20parity-common%20ICE/near/136364466" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2355241.20parity-common.20ICE.html#136364466">(Oct 23 2018 at 20:20)</a>:</h4>
<p>not yet</p>



<a name="136364471"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2355241%20parity-common%20ICE/near/136364471" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> pnkfelix <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2355241.20parity-common.20ICE.html#136364471">(Oct 23 2018 at 20:20)</a>:</h4>
<p>that one, <a href="https://github.com/rust-lang/rust/issues/55219" target="_blank" title="https://github.com/rust-lang/rust/issues/55219">#55219</a>, I <em>hope</em> will have a straight forward fix</p>



<a name="136364475"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2355241%20parity-common%20ICE/near/136364475" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2355241.20parity-common.20ICE.html#136364475">(Oct 23 2018 at 20:20)</a>:</h4>
<p>oh, this is one of those weird bugs... goes away with incremental rebuilds</p>



<a name="136364506"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2355241%20parity-common%20ICE/near/136364506" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2355241.20parity-common.20ICE.html#136364506">(Oct 23 2018 at 20:21)</a>:</h4>
<p>that one was also reported on <a href="https://github.com/rust-lang/rust/issues/55241" target="_blank" title="https://github.com/rust-lang/rust/issues/55241">#55241</a></p>



<a name="136364521"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2355241%20parity-common%20ICE/near/136364521" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> pnkfelix <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2355241.20parity-common.20ICE.html#136364521">(Oct 23 2018 at 20:21)</a>:</h4>
<p>yeah I was going to make a comment about that</p>



<a name="136364524"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2355241%20parity-common%20ICE/near/136364524" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> pnkfelix <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2355241.20parity-common.20ICE.html#136364524">(Oct 23 2018 at 20:21)</a>:</h4>
<p>but I didn't get a chance to look at the tar.gz</p>



<a name="136364527"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2355241%20parity-common%20ICE/near/136364527" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> pnkfelix <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2355241.20parity-common.20ICE.html#136364527">(Oct 23 2018 at 20:21)</a>:</h4>
<p>to verify that it really was a duplicate</p>



<a name="136364549"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2355241%20parity-common%20ICE/near/136364549" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> pnkfelix <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2355241.20parity-common.20ICE.html#136364549">(Oct 23 2018 at 20:21)</a>:</h4>
<p>in terms of being a case of <code>impl&lt;T&gt; Foo&lt;T&gt; { const C: Other = ...; ... }</code></p>



<a name="136364603"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2355241%20parity-common%20ICE/near/136364603" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2355241.20parity-common.20ICE.html#136364603">(Oct 23 2018 at 20:22)</a>:</h4>
<p>that one at least has a minimzed test case I guess</p>



<a name="136364609"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2355241%20parity-common%20ICE/near/136364609" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2355241.20parity-common.20ICE.html#136364609">(Oct 23 2018 at 20:22)</a>:</h4>
<p>it still reproduces with my PR too :)</p>



<a name="136364629"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2355241%20parity-common%20ICE/near/136364629" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> pnkfelix <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2355241.20parity-common.20ICE.html#136364629">(Oct 23 2018 at 20:22)</a>:</h4>
<p>I can imagine <em>why</em> it happens</p>



<a name="136364638"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2355241%20parity-common%20ICE/near/136364638" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> pnkfelix <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2355241.20parity-common.20ICE.html#136364638">(Oct 23 2018 at 20:22)</a>:</h4>
<p><code>impl&lt;T&gt; Foo&lt;T&gt; { const C: u32 = 10; ... }</code></p>



<a name="136364653"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2355241%20parity-common%20ICE/near/136364653" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> pnkfelix <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2355241.20parity-common.20ICE.html#136364653">(Oct 23 2018 at 20:23)</a>:</h4>
<p>it not surprising that <code>T</code> is in some sense floating around as an infer type when we look at the <code>const C</code></p>



<a name="136364662"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2355241%20parity-common%20ICE/near/136364662" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2355241.20parity-common.20ICE.html#136364662">(Oct 23 2018 at 20:23)</a>:</h4>
<p>hmm</p>



<a name="136364677"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2355241%20parity-common%20ICE/near/136364677" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2355241.20parity-common.20ICE.html#136364677">(Oct 23 2018 at 20:23)</a>:</h4>
<p>true</p>



<a name="136364678"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2355241%20parity-common%20ICE/near/136364678" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> pnkfelix <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2355241.20parity-common.20ICE.html#136364678">(Oct 23 2018 at 20:23)</a>:</h4>
<p>I also mused about suggesting that we just ... kill the assertion ..</p>



<a name="136364684"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2355241%20parity-common%20ICE/near/136364684" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2355241.20parity-common.20ICE.html#136364684">(Oct 23 2018 at 20:23)</a>:</h4>
<p>well</p>



<a name="136364687"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2355241%20parity-common%20ICE/near/136364687" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> pnkfelix <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2355241.20parity-common.20ICE.html#136364687">(Oct 23 2018 at 20:23)</a>:</h4>
<p>but I suspect that would be bad</p>



<a name="136364692"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2355241%20parity-common%20ICE/near/136364692" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2355241.20parity-common.20ICE.html#136364692">(Oct 23 2018 at 20:23)</a>:</h4>
<p>plausible</p>



<a name="136364696"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2355241%20parity-common%20ICE/near/136364696" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> pnkfelix <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2355241.20parity-common.20ICE.html#136364696">(Oct 23 2018 at 20:24)</a>:</h4>
<p>better to find a more principled fix</p>



<a name="136364735"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2355241%20parity-common%20ICE/near/136364735" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2355241.20parity-common.20ICE.html#136364735">(Oct 23 2018 at 20:24)</a>:</h4>
<p>we could maybe <em>move</em> it</p>



<a name="136364740"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2355241%20parity-common%20ICE/near/136364740" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2355241.20parity-common.20ICE.html#136364740">(Oct 23 2018 at 20:24)</a>:</h4>
<p>I think there is another one</p>



<a name="136364752"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2355241%20parity-common%20ICE/near/136364752" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2355241.20parity-common.20ICE.html#136364752">(Oct 23 2018 at 20:24)</a>:</h4>
<p>in particular, the goal is to ensure that we don't instantiate a type variable with a value that contains another type variable</p>



<a name="136364755"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2355241%20parity-common%20ICE/near/136364755" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2355241.20parity-common.20ICE.html#136364755">(Oct 23 2018 at 20:24)</a>:</h4>
<p>well that would probably happen</p>



<a name="136364756"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2355241%20parity-common%20ICE/near/136364756" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> pnkfelix <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2355241.20parity-common.20ICE.html#136364756">(Oct 23 2018 at 20:24)</a>:</h4>
<p>occurs check!</p>



<a name="136364760"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2355241%20parity-common%20ICE/near/136364760" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> pnkfelix <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2355241.20parity-common.20ICE.html#136364760">(Oct 23 2018 at 20:24)</a>:</h4>
<p>(not exactly, I know)</p>



<a name="136364761"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2355241%20parity-common%20ICE/near/136364761" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2355241.20parity-common.20ICE.html#136364761">(Oct 23 2018 at 20:24)</a>:</h4>
<p>right we could basically just implement the proper path</p>



<a name="136364765"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2355241%20parity-common%20ICE/near/136364765" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2355241.20parity-common.20ICE.html#136364765">(Oct 23 2018 at 20:24)</a>:</h4>
<p>or at least more of it</p>



<a name="136364768"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2355241%20parity-common%20ICE/near/136364768" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2355241.20parity-common.20ICE.html#136364768">(Oct 23 2018 at 20:24)</a>:</h4>
<p>and then this assert wouldn't be needed</p>



<a name="136364773"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2355241%20parity-common%20ICE/near/136364773" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2355241.20parity-common.20ICE.html#136364773">(Oct 23 2018 at 20:25)</a>:</h4>
<p>that may be the right fix</p>



<a name="136364800"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2355241%20parity-common%20ICE/near/136364800" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2355241.20parity-common.20ICE.html#136364800">(Oct 23 2018 at 20:25)</a>:</h4>
<p>e.g., maybe we allow a type variable, but only if it is unbound or something...?</p>



<a name="136364815"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2355241%20parity-common%20ICE/near/136364815" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2355241.20parity-common.20ICE.html#136364815">(Oct 23 2018 at 20:25)</a>:</h4>
<p>the other ICE (<a href="https://github.com/rust-lang/rust/issues/55241" target="_blank" title="https://github.com/rust-lang/rust/issues/55241">#55241</a>) definitely worries me more</p>



<a name="136365039"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2355241%20parity-common%20ICE/near/136365039" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2355241.20parity-common.20ICE.html#136365039">(Oct 23 2018 at 20:28)</a>:</h4>
<p>ah, I think I see what it is</p>



<a name="136365774"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2355241%20parity-common%20ICE/near/136365774" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2355241.20parity-common.20ICE.html#136365774">(Oct 23 2018 at 20:41)</a>:</h4>
<p><span class="user-mention" data-user-id="116083">@pnkfelix</span> I <em>think</em> I might be able to fix both of those ICEs at once</p>



<a name="136367418"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2355241%20parity-common%20ICE/near/136367418" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2355241.20parity-common.20ICE.html#136367418">(Oct 23 2018 at 21:09)</a>:</h4>
<p>so the problem here is basically that the NLL type checker is a bit too rigid, I think</p>



<a name="136367428"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2355241%20parity-common%20ICE/near/136367428" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2355241.20parity-common.20ICE.html#136367428">(Oct 23 2018 at 21:09)</a>:</h4>
<p>(also that we are encoding tons more user-type annotations than we really need, but I guess it's good to be able to handle them)</p>



<a name="136367436"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2355241%20parity-common%20ICE/near/136367436" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2355241.20parity-common.20ICE.html#136367436">(Oct 23 2018 at 21:09)</a>:</h4>
<p>/me rubber ducks a bit</p>



<a name="136367446"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2355241%20parity-common%20ICE/near/136367446" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2355241.20parity-common.20ICE.html#136367446">(Oct 23 2018 at 21:09)</a>:</h4>
<p>e.g., in one of the ICE cases, we have <code>C::Out</code>, which expands to <code>&lt;C as Hasher&lt;_&gt;&gt;::Out</code></p>



<a name="136367455"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2355241%20parity-common%20ICE/near/136367455" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2355241.20parity-common.20ICE.html#136367455">(Oct 23 2018 at 21:09)</a>:</h4>
<p>this fails to normalize because we don't know what the <code>_</code> is</p>



<a name="136367514"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2355241%20parity-common%20ICE/near/136367514" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2355241.20parity-common.20ICE.html#136367514">(Oct 23 2018 at 21:10)</a>:</h4>
<p>the only reason it works ever is that we have <code>C: Hasher&lt;H&gt;</code> in the environment</p>



<a name="136367524"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2355241%20parity-common%20ICE/near/136367524" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2355241.20parity-common.20ICE.html#136367524">(Oct 23 2018 at 21:10)</a>:</h4>
<p>and hence we can infer that <code>_</code> must be <code>H</code> because there is no other way to prove <code>C: Hasher</code></p>



<a name="136367540"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2355241%20parity-common%20ICE/near/136367540" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2355241.20parity-common.20ICE.html#136367540">(Oct 23 2018 at 21:10)</a>:</h4>
<p>problem is, in the NLL type checker, we normalize <em>first</em> and <em>then</em> solve predicates</p>



<a name="136367569"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2355241%20parity-common%20ICE/near/136367569" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2355241.20parity-common.20ICE.html#136367569">(Oct 23 2018 at 21:11)</a>:</h4>
<p>but if we swap the order, I think other things will fail, because the predicates might depend on stuff that proving type equality needed</p>



<a name="136367578"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2355241%20parity-common%20ICE/near/136367578" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2355241.20parity-common.20ICE.html#136367578">(Oct 23 2018 at 21:11)</a>:</h4>
<p>what we can do though is to add a query that creates a fresh infcx and adds all these constraints so that they can get solved in any order</p>



<a name="136367630"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2355241%20parity-common%20ICE/near/136367630" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2355241.20parity-common.20ICE.html#136367630">(Oct 23 2018 at 21:12)</a>:</h4>
<p>this would also let us go through the more general infcx code paths and avoid the limitations around type variables that triggered that other assertion</p>



<a name="136400049"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2355241%20parity-common%20ICE/near/136400049" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> pnkfelix <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2355241.20parity-common.20ICE.html#136400049">(Oct 24 2018 at 10:27)</a>:</h4>
<p>hey <span class="user-mention" data-user-id="116009">@nikomatsakis</span> if you've already extracted a standalone test case for <a href="https://github.com/rust-lang/rust/issues/55421" target="_blank" title="https://github.com/rust-lang/rust/issues/55421">#55421</a>, would you mind posting it to the issue for posterity's sake (and so that I or others don't waste time trying to do so in parallel) ?</p>



<a name="136400099"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2355241%20parity-common%20ICE/near/136400099" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2355241.20parity-common.20ICE.html#136400099">(Oct 24 2018 at 10:28)</a>:</h4>
<p><span class="user-mention" data-user-id="116083">@pnkfelix</span> I haven't yet but I prob can later this morning</p>



<a name="136400101"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2355241%20parity-common%20ICE/near/136400101" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2355241.20parity-common.20ICE.html#136400101">(Oct 24 2018 at 10:28)</a>:</h4>
<p>or .. did I ..</p>



<a name="136400102"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2355241%20parity-common%20ICE/near/136400102" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2355241.20parity-common.20ICE.html#136400102">(Oct 24 2018 at 10:28)</a>:</h4>
<p>I forget :)</p>



<a name="136400104"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2355241%20parity-common%20ICE/near/136400104" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> pnkfelix <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2355241.20parity-common.20ICE.html#136400104">(Oct 24 2018 at 10:28)</a>:</h4>
<p>no problem, just wanted to make sure I mentioned it somewhere</p>



<a name="136400109"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2355241%20parity-common%20ICE/near/136400109" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> pnkfelix <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2355241.20parity-common.20ICE.html#136400109">(Oct 24 2018 at 10:28)</a>:</h4>
<p>(i'm going through all my issues and trying to close off the easy tasks before I embark on round 3 of .stderr review for NLL)</p>



<hr><p>Last updated: Apr 12 2022 at 20:01 UTC</p>
</html>