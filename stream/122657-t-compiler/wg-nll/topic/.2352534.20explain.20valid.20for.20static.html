<html>
<head><meta charset="utf-8"><title>#52534 explain valid for static · t-compiler/wg-nll · Zulip Chat Archive</title></head>
<h2>Stream: <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/index.html">t-compiler/wg-nll</a></h2>
<h3>Topic: <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2352534.20explain.20valid.20for.20static.html">#52534 explain valid for static</a></h3>

<hr>

<base href="https://rust-lang.zulipchat.com">

<head><link href="https://zulip-archive.rust-lang.org/style.css" rel="stylesheet"></head>

<a name="133456617"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2352534%20explain%20valid%20for%20static/near/133456617" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> davidtwco <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2352534.20explain.20valid.20for.20static.html#133456617">(Sep 06 2018 at 17:25)</a>:</h4>
<p><span class="user-mention" data-user-id="116009">@nikomatsakis</span> If I have an error being reported - and when it is reported the <code>MIr</code> at the time refers to a function. Inside that function is a closure that contains a captured variable from the parent function that isn't living long enough. I want to get the <code>Mir</code> of that closure that is inside. For example:</p>
<div class="codehilite"><pre><span></span>fn bar() {
    let x = 22;
    foo(|a| &amp;x)
}
</pre></div>


<p>When the error is being reported for the above code, we've got the <code>Mir</code> and <code>mir_def_id</code> for the function <code>bar</code>. But at that point, in order to add the note that I want, I'll need to get the <code>Mir</code> (and <code>mir_def_id</code>) of the closure being passed to <code>foo</code> so I can look at the arguments and at whether it is a function or closure for when I refer to it.</p>



<a name="133456690"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2352534%20explain%20valid%20for%20static/near/133456690" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2352534.20explain.20valid.20for.20static.html#133456690">(Sep 06 2018 at 17:26)</a>:</h4>
<p>are you sure you want the <em>MIR</em>?</p>



<a name="133456695"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2352534%20explain%20valid%20for%20static/near/133456695" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2352534.20explain.20valid.20for.20static.html#133456695">(Sep 06 2018 at 17:26)</a>:</h4>
<p>it's not that it's necessarily hard to get, but it doesn't seem right to me</p>



<a name="133456722"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2352534%20explain%20valid%20for%20static/near/133456722" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2352534.20explain.20valid.20for.20static.html#133456722">(Sep 06 2018 at 17:27)</a>:</h4>
<p>you can easily find out if it is a closure — and which variables it captures etc — without the MIR itself though</p>



<a name="133456726"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2352534%20explain%20valid%20for%20static/near/133456726" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2352534.20explain.20valid.20for.20static.html#133456726">(Sep 06 2018 at 17:27)</a>:</h4>
<p>well, you can find out anyway</p>



<a name="133456906"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2352534%20explain%20valid%20for%20static/near/133456906" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> davidtwco <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2352534.20explain.20valid.20for.20static.html#133456906">(Sep 06 2018 at 17:30)</a>:</h4>
<p>Well, I need to find out what arguments it takes and then just how to name it.</p>



<a name="133456920"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2352534%20explain%20valid%20for%20static/near/133456920" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> davidtwco <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2352534.20explain.20valid.20for.20static.html#133456920">(Sep 06 2018 at 17:31)</a>:</h4>
<p>In particular, I need to find out if any of the arguments are references to see if my suggestion is appropriate.</p>



<a name="133456977"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2352534%20explain%20valid%20for%20static/near/133456977" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> davidtwco <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2352534.20explain.20valid.20for.20static.html#133456977">(Sep 06 2018 at 17:32)</a>:</h4>
<p>I've just got that check and the "what should I call this" code written in terms of the <code>Mir</code> currently - though that is for the parent function not the closure.</p>



<a name="133457084"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2352534%20explain%20valid%20for%20static/near/133457084" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> davidtwco <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2352534.20explain.20valid.20for.20static.html#133457084">(Sep 06 2018 at 17:34)</a>:</h4>
<p>Won't be around much for the next few hours though.</p>



<a name="133463356"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2352534%20explain%20valid%20for%20static/near/133463356" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2352534.20explain.20valid.20for.20static.html#133463356">(Sep 06 2018 at 19:22)</a>:</h4>
<p>can you give a bit more details about what it is you are trying to figure out?</p>



<a name="133473121"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2352534%20explain%20valid%20for%20static/near/133473121" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> davidtwco <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2352534.20explain.20valid.20for.20static.html#133473121">(Sep 06 2018 at 22:08)</a>:</h4>
<p>I'm trying to add an explanation for the <code>borrowed value must be valid for the static lifetime...</code> note. In particular, the explaination says something along the lines of "we're expecting a static bound because we couldn't infer an applicable lifetime from the arguments to the function/closure". </p>
<p>Therefore, I'm trying to check whether or not there are arguments to the functions that are references - since that little explaination makes no sense if there aren't any applicable lifetimes in the arguments because there are no lifetimes in the arguments.</p>
<p>I did that by just iterating over the arguments and checking for any references - via <code>Mir::args_iter</code>. But the <code>Mir</code> in this case is for the parent function and not the closure which is the arguments I'm trying to iterate over.  (I also use the <code>mir_def_id</code> field of the <code>MirBorrowckCtxt</code> to check whether it is the arguments of the "closure" or "function" I'm printing in my help message, and that's also referring to the wrong thing).</p>



<a name="133519391"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2352534%20explain%20valid%20for%20static/near/133519391" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2352534.20explain.20valid.20for.20static.html#133519391">(Sep 07 2018 at 15:40)</a>:</h4>
<p>Hmm. I am not sure if this is the right road.</p>



<a name="133519400"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2352534%20explain%20valid%20for%20static/near/133519400" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2352534.20explain.20valid.20for.20static.html#133519400">(Sep 07 2018 at 15:40)</a>:</h4>
<p>One challenge here is that the inference is spread across two functions:</p>



<a name="133519405"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2352534%20explain%20valid%20for%20static/near/133519405" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2352534.20explain.20valid.20for.20static.html#133519405">(Sep 07 2018 at 15:40)</a>:</h4>
<p>The closure will infer that <code>&amp;x</code> must be borrowed for the lifetime <code>'static</code></p>



<a name="133519420"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2352534%20explain%20valid%20for%20static/near/133519420" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2352534.20explain.20valid.20for.20static.html#133519420">(Sep 07 2018 at 15:41)</a>:</h4>
<p>it will propagate that back to the creator, which is the one that actually knows how long <code>x</code> can live</p>



<a name="133519430"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2352534%20explain%20valid%20for%20static/near/133519430" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2352534.20explain.20valid.20for.20static.html#133519430">(Sep 07 2018 at 15:41)</a>:</h4>
<p>so — at the where we report out error — we know that the closure imposed a <code>'static</code> view but (currently, anyway) we don't have a very good view as to <em>why</em></p>



<a name="133519431"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2352534%20explain%20valid%20for%20static/near/133519431" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2352534.20explain.20valid.20for.20static.html#133519431">(Sep 07 2018 at 15:41)</a>:</h4>
<p>we do propagate a span back</p>



<a name="133519434"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2352534%20explain%20valid%20for%20static/near/133519434" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2352534.20explain.20valid.20for.20static.html#133519434">(Sep 07 2018 at 15:41)</a>:</h4>
<p>we could give more information back</p>



<a name="133519438"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2352534%20explain%20valid%20for%20static/near/133519438" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2352534.20explain.20valid.20for.20static.html#133519438">(Sep 07 2018 at 15:41)</a>:</h4>
<p>one complication of that is that it might have some runtime cost, since we would be doing it all the time, not only when we are about to report an error</p>



<a name="133519630"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2352534%20explain%20valid%20for%20static/near/133519630" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> davidtwco <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2352534.20explain.20valid.20for.20static.html#133519630">(Sep 07 2018 at 15:45)</a>:</h4>
<p>I figure that in some cases it won't be over two functions too.</p>



<a name="133520379"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2352534%20explain%20valid%20for%20static/near/133520379" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2352534.20explain.20valid.20for.20static.html#133520379">(Sep 07 2018 at 15:58)</a>:</h4>
<p>I guess it depends. There are many things that could extend the lifetime to <code>'static</code>, is the bottom line, and we should be "explaining" them</p>



<a name="133520386"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2352534%20explain%20valid%20for%20static/near/133520386" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2352534.20explain.20valid.20for.20static.html#133520386">(Sep 07 2018 at 15:58)</a>:</h4>
<p>in this case, we can probably get a pointer to the fact that this arose from a closure constraint</p>



<a name="133520399"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2352534%20explain%20valid%20for%20static/near/133520399" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2352534.20explain.20valid.20for.20static.html#133520399">(Sep 07 2018 at 15:59)</a>:</h4>
<p>but I think that the right bit of code to diagnose <em>why</em> the closure is imposing that constraint</p>



<a name="133520400"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2352534%20explain%20valid%20for%20static/near/133520400" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2352534.20explain.20valid.20for.20static.html#133520400">(Sep 07 2018 at 15:59)</a>:</h4>
<p>is the closure itself</p>



<a name="133520688"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2352534%20explain%20valid%20for%20static/near/133520688" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> davidtwco <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2352534.20explain.20valid.20for.20static.html#133520688">(Sep 07 2018 at 16:04)</a>:</h4>
<p>Sure.</p>



<a name="133528179"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2352534%20explain%20valid%20for%20static/near/133528179" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> davidtwco <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2352534.20explain.20valid.20for.20static.html#133528179">(Sep 07 2018 at 18:23)</a>:</h4>
<p>What approach would you like to take with this <span class="user-mention" data-user-id="116009">@nikomatsakis</span>?</p>



<a name="133531944"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2352534%20explain%20valid%20for%20static/near/133531944" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2352534.20explain.20valid.20for.20static.html#133531944">(Sep 07 2018 at 19:27)</a>:</h4>
<p>I think my first question is</p>



<a name="133531946"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2352534%20explain%20valid%20for%20static/near/133531946" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2352534.20explain.20valid.20for.20static.html#133531946">(Sep 07 2018 at 19:27)</a>:</h4>
<p>what message do we want to give?</p>



<a name="133531995"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2352534%20explain%20valid%20for%20static/near/133531995" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2352534.20explain.20valid.20for.20static.html#133531995">(Sep 07 2018 at 19:28)</a>:</h4>
<p>I think what I would like to see is something where we share code between the "'a outlives 'b" stuff and here</p>



<a name="133532000"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2352534%20explain%20valid%20for%20static/near/133532000" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2352534.20explain.20valid.20for.20static.html#133532000">(Sep 07 2018 at 19:28)</a>:</h4>
<p>since both have the job of explaining why it is that one region outlives another</p>



<a name="133533758"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2352534%20explain%20valid%20for%20static/near/133533758" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> davidtwco <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2352534.20explain.20valid.20for.20static.html#133533758">(Sep 07 2018 at 20:02)</a>:</h4>
<p><span class="user-mention" data-user-id="116009">@nikomatsakis</span> I think there were some suggestions in the issue for what the error might look like.</p>



<a name="133533942"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2352534%20explain%20valid%20for%20static/near/133533942" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> davidtwco <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2352534.20explain.20valid.20for.20static.html#133533942">(Sep 07 2018 at 20:06)</a>:</h4>
<p>Locally, I've been adding a <code>...as no applicable lifetime from function arguments was found to match '&amp;y'</code> note for testing.</p>



<a name="133539312"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2352534%20explain%20valid%20for%20static/near/133539312" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2352534.20explain.20valid.20for.20static.html#133539312">(Sep 07 2018 at 21:49)</a>:</h4>
<p>I feel like this is pretty wordy and not going to be that easy for people to understand</p>



<a name="133539388"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2352534%20explain%20valid%20for%20static/near/133539388" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> davidtwco <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2352534.20explain.20valid.20for.20static.html#133539388">(Sep 07 2018 at 21:50)</a>:</h4>
<p>Probably, we can iterate on what it actually says.</p>



<a name="133539396"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2352534%20explain%20valid%20for%20static/near/133539396" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> davidtwco <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2352534.20explain.20valid.20for.20static.html#133539396">(Sep 07 2018 at 21:50)</a>:</h4>
<p>The suggestions in the issue were good.</p>



<a name="133539408"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2352534%20explain%20valid%20for%20static/near/133539408" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2352534.20explain.20valid.20for.20static.html#133539408">(Sep 07 2018 at 21:51)</a>:</h4>
<p>in my ideal world, we would recognize that <code>'static</code> was kind of a "hail mary" pass</p>



<a name="133539409"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2352534%20explain%20valid%20for%20static/near/133539409" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2352534.20explain.20valid.20for.20static.html#133539409">(Sep 07 2018 at 21:51)</a>:</h4>
<p>and not talk about it in the error at all</p>



<a name="133539423"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2352534%20explain%20valid%20for%20static/near/133539423" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2352534.20explain.20valid.20for.20static.html#133539423">(Sep 07 2018 at 21:52)</a>:</h4>
<p>in this particular case, I think that the "does not live long enough" error framing is unhelpful</p>



<a name="133539556"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2352534%20explain%20valid%20for%20static/near/133539556" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2352534.20explain.20valid.20for.20static.html#133539556">(Sep 07 2018 at 21:54)</a>:</h4>
<p>e.g.</p>
<div class="codehilite"><pre><span></span>error[E0597]: returning local variable
  --&gt; src/main.rs:9:14
   |
9  |     foo(|a| &amp;x)
   |          -  ^^ return value has to have the lifetime `&#39;1`
   |          |
   |          let&#39;s call the type of this `&amp;&#39;1 u32`
   |
</pre></div>



<a name="133539558"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2352534%20explain%20valid%20for%20static/near/133539558" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2352534.20explain.20valid.20for.20static.html#133539558">(Sep 07 2018 at 21:54)</a>:</h4>
<p>(from issue)</p>



<a name="133539579"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2352534%20explain%20valid%20for%20static/near/133539579" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> davidtwco <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2352534.20explain.20valid.20for.20static.html#133539579">(Sep 07 2018 at 21:55)</a>:</h4>
<p>I like that error.</p>



<a name="133539603"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2352534%20explain%20valid%20for%20static/near/133539603" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> davidtwco <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2352534.20explain.20valid.20for.20static.html#133539603">(Sep 07 2018 at 21:55)</a>:</h4>
<p>I agree that mentioning <code>'static</code> at all can confuse the situation - particularly if it isn't mentioned at all in the source.</p>



<a name="133539833"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2352534%20explain%20valid%20for%20static/near/133539833" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2352534.20explain.20valid.20for.20static.html#133539833">(Sep 07 2018 at 22:00)</a>:</h4>
<p>some further iterations in the issue</p>



<a name="133539918"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2352534%20explain%20valid%20for%20static/near/133539918" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> davidtwco <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2352534.20explain.20valid.20for.20static.html#133539918">(Sep 07 2018 at 22:00)</a>:</h4>
<p>I see them. I like those.</p>
<div class="codehilite"><pre><span></span>error[E0597]: lifetime error
 --&gt; src/main.rs:9:14
  |
8 | fn foo(x: &amp;u32) -&gt; &amp;u32 {
  |            -        -
  |            |--------| let&#39;s call these `&#39;1`
9 |     &amp;y
  |      ^ `y` would have to be valid for `&#39;1`
10| }
  | - but `y` goes out of scope here
</pre></div>



<a name="133539944"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2352534%20explain%20valid%20for%20static/near/133539944" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> davidtwco <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2352534.20explain.20valid.20for.20static.html#133539944">(Sep 07 2018 at 22:01)</a>:</h4>
<p>I like the idea of highlighting both the arg and the return type when we name it.</p>



<a name="133539956"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2352534%20explain%20valid%20for%20static/near/133539956" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> davidtwco <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2352534.20explain.20valid.20for.20static.html#133539956">(Sep 07 2018 at 22:01)</a>:</h4>
<p>To highlight that they are inferred as the same.</p>



<a name="133539964"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2352534%20explain%20valid%20for%20static/near/133539964" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> davidtwco <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2352534.20explain.20valid.20for.20static.html#133539964">(Sep 07 2018 at 22:01)</a>:</h4>
<p>As I kind-of show in the example above.</p>



<a name="133540009"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2352534%20explain%20valid%20for%20static/near/133540009" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> lqd <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2352534.20explain.20valid.20for.20static.html#133540009">(Sep 07 2018 at 22:02)</a>:</h4>
<p>let's call <em>these</em> <code>'1</code> ?</p>



<a name="133540066"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2352534%20explain%20valid%20for%20static/near/133540066" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> davidtwco <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2352534.20explain.20valid.20for.20static.html#133540066">(Sep 07 2018 at 22:03)</a>:</h4>
<p>With an idea of what to aim for I should be able to experiment and see how close I can get though, so <span class="emoji emoji-1f44d" title="thumbs up">:thumbs_up:</span></p>



<a name="133540319"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2352534%20explain%20valid%20for%20static/near/133540319" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> lqd <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2352534.20explain.20valid.20for.20static.html#133540319">(Sep 07 2018 at 22:08)</a>:</h4>
<p>interesting :)</p>



<a name="133542367"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2352534%20explain%20valid%20for%20static/near/133542367" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2352534.20explain.20valid.20for.20static.html#133542367">(Sep 07 2018 at 22:55)</a>:</h4>
<blockquote>
<p>I like the idea of highlighting both the arg and the return type when we name it.</p>
</blockquote>
<p>ooh</p>



<a name="133542373"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2352534%20explain%20valid%20for%20static/near/133542373" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2352534.20explain.20valid.20for.20static.html#133542373">(Sep 07 2018 at 22:55)</a>:</h4>
<p><span class="user-mention" data-user-id="116107">@davidtwco</span> maybe start on the non-closure one, I would say</p>



<a name="133542410"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2352534%20explain%20valid%20for%20static/near/133542410" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2352534.20explain.20valid.20for.20static.html#133542410">(Sep 07 2018 at 22:56)</a>:</h4>
<p>then we can talk about the closure details</p>



<a name="133542418"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2352534%20explain%20valid%20for%20static/near/133542418" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> davidtwco <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2352534.20explain.20valid.20for.20static.html#133542418">(Sep 07 2018 at 22:56)</a>:</h4>
<p>Yeah, that's what I was intending.</p>



<a name="133542763"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2352534%20explain%20valid%20for%20static/near/133542763" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Matthew Jasper <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2352534.20explain.20valid.20for.20static.html#133542763">(Sep 07 2018 at 23:02)</a>:</h4>
<p>IMO, if the error is caused by returning a reference to a local variable, the error should just say that, no mention of lifetimes.</p>



<a name="133542849"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2352534%20explain%20valid%20for%20static/near/133542849" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Matthew Jasper <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2352534.20explain.20valid.20for.20static.html#133542849">(Sep 07 2018 at 23:04)</a>:</h4>
<p>Highlighting both lifetimes in the free region errors where we just highlight the argument lifetime would definitely be an improvement though.</p>



<a name="133570803"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2352534%20explain%20valid%20for%20static/near/133570803" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2352534.20explain.20valid.20for.20static.html#133570803">(Sep 08 2018 at 15:00)</a>:</h4>
<p>Hmm, so, I sort of agree and sort of not. I guess the two cases are mildly different here:</p>
<p>In the case of the <em>closure</em>, the reason that returning a reference is wrong is because of the closure's return type. So it feels important to highlight that.</p>



<a name="133570855"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2352534%20explain%20valid%20for%20static/near/133570855" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2352534.20explain.20valid.20for.20static.html#133570855">(Sep 08 2018 at 15:00)</a>:</h4>
<p>In the case of the <code>fn</code>, the same is less true: it is probably just wrong no matter the return type.</p>



<a name="133570861"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2352534%20explain%20valid%20for%20static/near/133570861" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2352534.20explain.20valid.20for.20static.html#133570861">(Sep 08 2018 at 15:00)</a>:</h4>
<p>(I was initially trying to remove all reference to the return type in the closure case, and it felt like I couldn't explain what was going on that way)</p>



<a name="133575217"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2352534%20explain%20valid%20for%20static/near/133575217" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Matthew Jasper <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2352534.20explain.20valid.20for.20static.html#133575217">(Sep 08 2018 at 17:24)</a>:</h4>
<p>Yes, the closure case should mention lifetimes, since they matter there.</p>



<a name="133741889"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2352534%20explain%20valid%20for%20static/near/133741889" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> davidtwco <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2352534.20explain.20valid.20for.20static.html#133741889">(Sep 11 2018 at 15:53)</a>:</h4>
<p><span class="user-mention" data-user-id="116009">@nikomatsakis</span> I've been struggling with this one a little bit. I've got the error for the non-closure case working relatively well (unfortunately not as nice as what we wanted, but that's because I don't think the type of label I sent before is possible):</p>
<div class="codehilite"><pre><span></span>error[E0597]: `x` does not live long enough
  --&gt; src/test/ui/nll/issue-52534-1.rs:19:9
   |
17 |     fn bar(&amp;self, x: &amp;u32) -&gt; &amp;u32 {
   |            -----              ---- also `&#39;1`
   |            |
   |            let&#39;s call this `&#39;1`
18 |         let x = 22;
19 |         &amp;x
   |         ^^ `x` would have to be valid for `&#39;1`
20 |     }
   |     - but `x` dropped here while still borrowed

error[E0597]: `x` does not live long enough
  --&gt; src/test/ui/nll/issue-52534-1.rs:25:5
   |
23 | fn foo(x: &amp;u32) -&gt; &amp;u32 {
   |           ----     ---- also `&#39;1`
   |           |
   |           let&#39;s call this `&#39;1`
24 |     let x = 22;
25 |     &amp;x
   |     ^^ `x` would have to be valid for `&#39;1`
26 | }
| - but `x` dropped here while still borrowed
</pre></div>


<p>There are some problems though:</p>
<p>I've currently got <code>'1</code> hardcoded (therefore making no sense with user-named lifetimes) - I've done some refactoring so I can call the region naming code (from the region inference error reporting) but it ICEs with the <code>is_universal_region</code> assertion.</p>



<a name="133741919"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2352534%20explain%20valid%20for%20static/near/133741919" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> davidtwco <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2352534.20explain.20valid.20for.20static.html#133741919">(Sep 11 2018 at 15:53)</a>:</h4>
<p>In some cases as well, it would benefit from having the definition of the variable (<code>x</code> in the above example) labelled too.</p>



<a name="133742112"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2352534%20explain%20valid%20for%20static/near/133742112" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2352534.20explain.20valid.20for.20static.html#133742112">(Sep 11 2018 at 15:56)</a>:</h4>
<p>can you send me your branch?</p>



<a name="133742118"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2352534%20explain%20valid%20for%20static/near/133742118" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2352534.20explain.20valid.20for.20static.html#133742118">(Sep 11 2018 at 15:56)</a>:</h4>
<p>also,I think we can do those sorts of labels</p>



<a name="133742121"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2352534%20explain%20valid%20for%20static/near/133742121" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2352534.20explain.20valid.20for.20static.html#133742121">(Sep 11 2018 at 15:56)</a>:</h4>
<p>via a <code>Multispan</code> thing</p>



<a name="133742123"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2352534%20explain%20valid%20for%20static/near/133742123" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2352534.20explain.20valid.20for.20static.html#133742123">(Sep 11 2018 at 15:56)</a>:</h4>
<p>but I'm not entirely sure</p>



<a name="133742128"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2352534%20explain%20valid%20for%20static/near/133742128" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2352534.20explain.20valid.20for.20static.html#133742128">(Sep 11 2018 at 15:56)</a>:</h4>
<p>maybe we don't support them for inline labels</p>



<a name="133742137"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2352534%20explain%20valid%20for%20static/near/133742137" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2352534.20explain.20valid.20for.20static.html#133742137">(Sep 11 2018 at 15:57)</a>:</h4>
<p>regardless, I think that the formatting here seems fine...</p>



<a name="133742236"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2352534%20explain%20valid%20for%20static/near/133742236" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> davidtwco <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2352534.20explain.20valid.20for.20static.html#133742236">(Sep 11 2018 at 15:58)</a>:</h4>
<p><span class="user-mention" data-user-id="116009">@nikomatsakis</span> <a href="https://github.com/davidtwco/rust/tree/issue-52534" target="_blank" title="https://github.com/davidtwco/rust/tree/issue-52534">https://github.com/davidtwco/rust/tree/issue-52534</a></p>



<a name="133742483"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2352534%20explain%20valid%20for%20static/near/133742483" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> davidtwco <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2352534.20explain.20valid.20for.20static.html#133742483">(Sep 11 2018 at 16:02)</a>:</h4>
<p>That doesn't include the call to <code>to_error_region</code> on the <code>borrow.region</code> and then the attempt to get the name using the region naming code but it has all the foundations for that.</p>



<a name="133742617"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2352534%20explain%20valid%20for%20static/near/133742617" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2352534.20explain.20valid.20for.20static.html#133742617">(Sep 11 2018 at 16:04)</a>:</h4>
<p>ok</p>



<a name="133742758"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2352534%20explain%20valid%20for%20static/near/133742758" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2352534.20explain.20valid.20for.20static.html#133742758">(Sep 11 2018 at 16:06)</a>:</h4>
<p>I think what you are going to want to do is to iterate over the universal regions contained in <code>borrow.region</code>'s <em>value</em></p>



<a name="133742770"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2352534%20explain%20valid%20for%20static/near/133742770" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2352534.20explain.20valid.20for.20static.html#133742770">(Sep 11 2018 at 16:06)</a>:</h4>
<p>but I also think this code should maybe move somewhere else</p>



<a name="133742786"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2352534%20explain%20valid%20for%20static/near/133742786" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2352534.20explain.20valid.20for.20static.html#133742786">(Sep 11 2018 at 16:06)</a>:</h4>
<p>I am going to go grab lunch, but I'll pull a local copy and try to form a more informed opinion</p>



<a name="133742808"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2352534%20explain%20valid%20for%20static/near/133742808" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> davidtwco <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2352534.20explain.20valid.20for.20static.html#133742808">(Sep 11 2018 at 16:07)</a>:</h4>
<p>Thanks, I'll give that a go.</p>



<a name="133744343"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2352534%20explain%20valid%20for%20static/near/133744343" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> davidtwco <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2352534.20explain.20valid.20for.20static.html#133744343">(Sep 11 2018 at 16:35)</a>:</h4>
<p>I've come to the conclusion that I'm not really sure how to "iterate over the universal regions contained in <code>borrow.regions</code>'s value".</p>



<a name="133744401"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2352534%20explain%20valid%20for%20static/near/133744401" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2352534.20explain.20valid.20for.20static.html#133744401">(Sep 11 2018 at 16:36)</a>:</h4>
<p>=)</p>



<a name="133744409"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2352534%20explain%20valid%20for%20static/near/133744409" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> davidtwco <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2352534.20explain.20valid.20for.20static.html#133744409">(Sep 11 2018 at 16:36)</a>:</h4>
<p>I attempted to call the naming function on the <code>RegionVid</code> contained in any variants with one, but that ICE'd, so it is presumably not that.</p>



<a name="133746247"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2352534%20explain%20valid%20for%20static/near/133746247" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2352534.20explain.20valid.20for.20static.html#133746247">(Sep 11 2018 at 17:11)</a>:</h4>
<p><span class="user-mention" data-user-id="116107">@davidtwco</span> sorry, so... what you want to do...</p>



<a name="133746371"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2352534%20explain%20valid%20for%20static/near/133746371" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2352534.20explain.20valid.20for.20static.html#133746371">(Sep 11 2018 at 17:13)</a>:</h4>
<p>something like this: <a href="https://github.com/rust-lang/rust/blob/7ee72070bdb789f58f272fab50d49bd48dd9c11f/src/librustc_mir/borrow_check/nll/region_infer/mod.rs#L702-L703" target="_blank" title="https://github.com/rust-lang/rust/blob/7ee72070bdb789f58f272fab50d49bd48dd9c11f/src/librustc_mir/borrow_check/nll/region_infer/mod.rs#L702-L703">https://github.com/rust-lang/rust/blob/7ee72070bdb789f58f272fab50d49bd48dd9c11f/src/librustc_mir/borrow_check/nll/region_infer/mod.rs#L702-L703</a></p>



<a name="133746408"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2352534%20explain%20valid%20for%20static/near/133746408" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2352534.20explain.20valid.20for.20static.html#133746408">(Sep 11 2018 at 17:14)</a>:</h4>
<p>but I'm not seeing any public helpers...</p>



<a name="133746433"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2352534%20explain%20valid%20for%20static/near/133746433" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2352534.20explain.20valid.20for.20static.html#133746433">(Sep 11 2018 at 17:14)</a>:</h4>
<p>there is <a href="https://github.com/rust-lang/rust/blob/7ee72070bdb789f58f272fab50d49bd48dd9c11f/src/librustc_mir/borrow_check/nll/region_infer/mod.rs#L867" target="_blank" title="https://github.com/rust-lang/rust/blob/7ee72070bdb789f58f272fab50d49bd48dd9c11f/src/librustc_mir/borrow_check/nll/region_infer/mod.rs#L867"><code>universal_upper_bound</code></a>, which is sort of close</p>



<a name="133746443"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2352534%20explain%20valid%20for%20static/near/133746443" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2352534.20explain.20valid.20for.20static.html#133746443">(Sep 11 2018 at 17:14)</a>:</h4>
<p>might even do for your purposes, but it tries to combine the bounds</p>



<a name="133746464"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2352534%20explain%20valid%20for%20static/near/133746464" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2352534.20explain.20valid.20for.20static.html#133746464">(Sep 11 2018 at 17:15)</a>:</h4>
<p>the thing here is that a region in NLL can be in general composed of the union of multiple named lifetimes</p>



<a name="133746479"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2352534%20explain%20valid%20for%20static/near/133746479" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2352534.20explain.20valid.20for.20static.html#133746479">(Sep 11 2018 at 17:15)</a>:</h4>
<p>e.g., if you have something like:</p>
<div class="codehilite"><pre><span></span><span class="k">fn</span> <span class="nf">foo</span><span class="o">&lt;</span><span class="na">&#39;a</span><span class="p">,</span><span class="w"> </span><span class="na">&#39;b</span><span class="o">&gt;</span><span class="p">()</span><span class="w"> </span>-&gt; <span class="p">(</span><span class="o">&amp;</span><span class="na">&#39;a</span><span class="w"> </span><span class="kt">u32</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="na">&#39;b</span><span class="w"> </span><span class="kt">u32</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="n">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">&amp;</span><span class="p">....;</span><span class="w"></span>
<span class="w">    </span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="w"> </span><span class="n">x</span><span class="p">)</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>
</pre></div>



<a name="133746485"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2352534%20explain%20valid%20for%20static/near/133746485" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2352534.20explain.20valid.20for.20static.html#133746485">(Sep 11 2018 at 17:15)</a>:</h4>
<p>then the region for <code>x</code> might include both <code>'a</code> and <code>'b</code> — as it has to outlive both</p>



<a name="133746497"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2352534%20explain%20valid%20for%20static/near/133746497" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2352534.20explain.20valid.20for.20static.html#133746497">(Sep 11 2018 at 17:15)</a>:</h4>
<p>if you invoke <code>universal_upper_bound</code>, it will combine those to yield <code>'static</code>, which isn't quite right</p>



<a name="133746539"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2352534%20explain%20valid%20for%20static/near/133746539" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2352534.20explain.20valid.20for.20static.html#133746539">(Sep 11 2018 at 17:16)</a>:</h4>
<p>so you probably want to add another helper that yields up an iterator or something</p>



<a name="133746589"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2352534%20explain%20valid%20for%20static/near/133746589" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> davidtwco <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2352534.20explain.20valid.20for.20static.html#133746589">(Sep 11 2018 at 17:17)</a>:</h4>
<p>Sounds good, thanks.</p>



<a name="133747433"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2352534%20explain%20valid%20for%20static/near/133747433" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> davidtwco <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2352534.20explain.20valid.20for.20static.html#133747433">(Sep 11 2018 at 17:32)</a>:</h4>
<p>That ICEs less. But there are still free regions it cannot name.</p>



<a name="133747486"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2352534%20explain%20valid%20for%20static/near/133747486" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2352534.20explain.20valid.20for.20static.html#133747486">(Sep 11 2018 at 17:34)</a>:</h4>
<p>heh</p>



<a name="133747524"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2352534%20explain%20valid%20for%20static/near/133747524" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2352534.20explain.20valid.20for.20static.html#133747524">(Sep 11 2018 at 17:34)</a>:</h4>
<p>example?</p>



<a name="133747576"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2352534%20explain%20valid%20for%20static/near/133747576" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> davidtwco <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2352534.20explain.20valid.20for.20static.html#133747576">(Sep 11 2018 at 17:35)</a>:</h4>
<div class="codehilite"><pre><span></span>error: internal compiler error: librustc_mir/borrow_check/nll/region_infer/error_reporting/region_name.rs:181: can&#39;t make a name for free region &#39;_#1r
  --&gt; src/test/ui/nll/issue-52534.rs:17:1
   |
17 | / fn bar() {
18 | |     let x = 22;
19 | |     foo(|a| &amp;x)
20 | | }
   | |_^

thread &#39;main&#39; panicked at &#39;Box&lt;Any&gt;&#39;, librustc_errors/lib.rs:525:9
note: Run with `RUST_BACKTRACE=1` for a backtrace.
error: aborting due to previous error


note: the compiler unexpectedly panicked. this is a bug.

note: we would appreciate a bug report: https://github.com/rust-lang/rust/blob/master/CONTRIBUTING.md#bug-reports

note: rustc 1.30.0-dev running on x86_64-unknown-linux-gnu

note: compiler flags: -Z borrowck=mir -Z two-phase-borrows
</pre></div>



<a name="133747732"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2352534%20explain%20valid%20for%20static/near/133747732" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2352534.20explain.20valid.20for.20static.html#133747732">(Sep 11 2018 at 17:37)</a>:</h4>
<p>hmm</p>



<a name="133747743"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2352534%20explain%20valid%20for%20static/near/133747743" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2352534.20explain.20valid.20for.20static.html#133747743">(Sep 11 2018 at 17:37)</a>:</h4>
<p>can you run <code>-Zdump-mir=nll</code></p>



<a name="133747753"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2352534%20explain%20valid%20for%20static/near/133747753" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2352534.20explain.20valid.20for.20static.html#133747753">(Sep 11 2018 at 17:37)</a>:</h4>
<p>and maybe extract the universal region part of that?</p>



<a name="133747761"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2352534%20explain%20valid%20for%20static/near/133747761" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2352534.20explain.20valid.20for.20static.html#133747761">(Sep 11 2018 at 17:37)</a>:</h4>
<p>what is <code>_#1r</code>, I'm trying to figure out</p>



<a name="133747840"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2352534%20explain%20valid%20for%20static/near/133747840" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> davidtwco <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2352534.20explain.20valid.20for.20static.html#133747840">(Sep 11 2018 at 17:38)</a>:</h4>
<p><a href="https://gist.github.com/davidtwco/fedafbdd92a17b0e62856bad224997cf" target="_blank" title="https://gist.github.com/davidtwco/fedafbdd92a17b0e62856bad224997cf">https://gist.github.com/davidtwco/fedafbdd92a17b0e62856bad224997cf</a></p>



<a name="133749621"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2352534%20explain%20valid%20for%20static/near/133749621" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Matthew Jasper <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2352534.20explain.20valid.20for.20static.html#133749621">(Sep 11 2018 at 18:06)</a>:</h4>
<p>What if you compile with <code>-Zidentify-regions -Zverbose</code>? ( I think those are the correct flags names)</p>



<a name="133749669"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2352534%20explain%20valid%20for%20static/near/133749669" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> davidtwco <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2352534.20explain.20valid.20for.20static.html#133749669">(Sep 11 2018 at 18:07)</a>:</h4>
<p>Should that change the MIR output or output something new?</p>



<a name="133749729"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2352534%20explain%20valid%20for%20static/near/133749729" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2352534.20explain.20valid.20for.20static.html#133749729">(Sep 11 2018 at 18:08)</a>:</h4>
<p>oh right so</p>



<a name="133749735"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2352534%20explain%20valid%20for%20static/near/133749735" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2352534.20explain.20valid.20for.20static.html#133749735">(Sep 11 2018 at 18:08)</a>:</h4>
<p><code>'_#1r</code> is the free lifetime representing the function body</p>



<a name="133749741"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2352534%20explain%20valid%20for%20static/near/133749741" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2352534.20explain.20valid.20for.20static.html#133749741">(Sep 11 2018 at 18:08)</a>:</h4>
<p>makes sense that we can't really name it</p>



<a name="133749758"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2352534%20explain%20valid%20for%20static/near/133749758" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2352534.20explain.20valid.20for.20static.html#133749758">(Sep 11 2018 at 18:09)</a>:</h4>
<p>I think part of this is that — for the non-closure case — we ought to consider a distinct error ;)</p>



<a name="133749766"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2352534%20explain%20valid%20for%20static/near/133749766" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2352534.20explain.20valid.20for.20static.html#133749766">(Sep 11 2018 at 18:09)</a>:</h4>
<p>that said, we could add some code to give that a name for now, just to see what output looks like, or else potentially filter it out</p>



<a name="133749772"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2352534%20explain%20valid%20for%20static/near/133749772" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> davidtwco <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2352534.20explain.20valid.20for.20static.html#133749772">(Sep 11 2018 at 18:09)</a>:</h4>
<p>I could compare against <code>UniversalRegions.fr_fn_body</code> and skip?</p>



<a name="133749826"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2352534%20explain%20valid%20for%20static/near/133749826" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> davidtwco <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2352534.20explain.20valid.20for.20static.html#133749826">(Sep 11 2018 at 18:10)</a>:</h4>
<p>If my understanding of what you're saying is correct at least.</p>



<a name="133749849"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2352534%20explain%20valid%20for%20static/near/133749849" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2352534.20explain.20valid.20for.20static.html#133749849">(Sep 11 2018 at 18:10)</a>:</h4>
<p>at least for now, yes, though it doesn't sound complete long term</p>



<a name="133749866"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2352534%20explain%20valid%20for%20static/near/133749866" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2352534.20explain.20valid.20for.20static.html#133749866">(Sep 11 2018 at 18:11)</a>:</h4>
<p>we should talk about how to deal with the closure case, though</p>



<a name="133749959"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2352534%20explain%20valid%20for%20static/near/133749959" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> davidtwco <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2352534.20explain.20valid.20for.20static.html#133749959">(Sep 11 2018 at 18:13)</a>:</h4>
<p>This issue is strange. It's been an oddly frustrating one as it's seemed like whatever I attempt to get spans or names or whatever it may be always seems to fail in one case but work in another.</p>



<a name="133750653"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2352534%20explain%20valid%20for%20static/near/133750653" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2352534.20explain.20valid.20for.20static.html#133750653">(Sep 11 2018 at 18:24)</a>:</h4>
<p>I've got a local build of your branch now</p>



<a name="133750656"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2352534%20explain%20valid%20for%20static/near/133750656" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2352534.20explain.20valid.20for.20static.html#133750656">(Sep 11 2018 at 18:24)</a>:</h4>
<p>but I don't have your latest trial commits I guess</p>



<a name="133750663"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2352534%20explain%20valid%20for%20static/near/133750663" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> davidtwco <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2352534.20explain.20valid.20for.20static.html#133750663">(Sep 11 2018 at 18:24)</a>:</h4>
<p>I can push them if you'd like.</p>



<a name="133750678"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2352534%20explain%20valid%20for%20static/near/133750678" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> davidtwco <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2352534.20explain.20valid.20for.20static.html#133750678">(Sep 11 2018 at 18:25)</a>:</h4>
<p>Pushed another WIP commit.</p>



<a name="133750706"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2352534%20explain%20valid%20for%20static/near/133750706" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> davidtwco <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2352534.20explain.20valid.20for.20static.html#133750706">(Sep 11 2018 at 18:25)</a>:</h4>
<p>This one is printing out generally reasonable errors in the non-closure cases. I suspect it would fall down if there are multiple lifetimes involved.</p>



<a name="133751050"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2352534%20explain%20valid%20for%20static/near/133751050" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> davidtwco <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2352534.20explain.20valid.20for.20static.html#133751050">(Sep 11 2018 at 18:31)</a>:</h4>
<p>I think using the <code>region</code> from <code>ty::TyKind::Ref(region, _, _)</code> could be beneficial now that I can name regions. Would make me more confident that the names I'm giving things make sense.</p>



<a name="133751069"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2352534%20explain%20valid%20for%20static/near/133751069" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> davidtwco <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2352534.20explain.20valid.20for.20static.html#133751069">(Sep 11 2018 at 18:31)</a>:</h4>
<p>That is, for both the return and first argument <code>Ty</code>s.</p>



<a name="133751441"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2352534%20explain%20valid%20for%20static/near/133751441" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2352534.20explain.20valid.20for.20static.html#133751441">(Sep 11 2018 at 18:38)</a>:</h4>
<p>one thing is that I feel like this code making labels and things probably belongs in the <code>region_name</code> module</p>



<a name="133751443"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2352534%20explain%20valid%20for%20static/near/133751443" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2352534.20explain.20valid.20for.20static.html#133751443">(Sep 11 2018 at 18:38)</a>:</h4>
<p>(as an aside)</p>



<a name="133751469"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2352534%20explain%20valid%20for%20static/near/133751469" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> davidtwco <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2352534.20explain.20valid.20for.20static.html#133751469">(Sep 11 2018 at 18:39)</a>:</h4>
<p>Yeah, I'm sure I'll move things around and comment things once I've got it working how I want.</p>



<a name="133754596"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2352534%20explain%20valid%20for%20static/near/133754596" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> davidtwco <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2352534.20explain.20valid.20for.20static.html#133754596">(Sep 11 2018 at 19:28)</a>:</h4>
<p>I've pushed a commit (that removes the "WIP" ones) that tackles this in a slightly nicer (IMO) way. It doesn't handle closures but it seems to handle the other cases nicely as far as I can tell.</p>



<a name="133754600"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2352534%20explain%20valid%20for%20static/near/133754600" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> davidtwco <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2352534.20explain.20valid.20for.20static.html#133754600">(Sep 11 2018 at 19:28)</a>:</h4>
<p>No doubt there's some way that it would completely fall on it's head that I've not thought of though.</p>



<a name="133754637"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2352534%20explain%20valid%20for%20static/near/133754637" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> davidtwco <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2352534.20explain.20valid.20for.20static.html#133754637">(Sep 11 2018 at 19:29)</a>:</h4>
<div class="codehilite"><pre><span></span>error[E0597]: `x` does not live long enough
  --&gt; src/test/ui/issues/issue-30438-c.rs:19:5
   |
17 | fn silly&lt;&#39;y, &#39;z&gt;(_s: &amp;&#39;y Test&lt;&#39;z&gt;) -&gt; &amp;&#39;y &lt;Test&lt;&#39;z&gt; as Trait&gt;::Out where &#39;z: &#39;static {
   |                       --               -- also has lifetime `&#39;y`
   |                       |
   |                       has lifetime `&#39;y`
18 |     let x = Test { s: &quot;this cannot last&quot; };
19 |     &amp;x
   |     ^^ `x` would have to be valid for `&#39;y`
20 |     //~^ ERROR: `x` does not live long enough
21 | }
   | - but `x` dropped here while still borrowed

error: aborting due to previous error

For more information about this error, try `rustc --explain E0597`.
</pre></div>



<a name="133811346"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2352534%20explain%20valid%20for%20static/near/133811346" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> davidtwco <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2352534.20explain.20valid.20for.20static.html#133811346">(Sep 12 2018 at 16:42)</a>:</h4>
<p><span class="user-mention" data-user-id="116009">@nikomatsakis</span> I've gotten the non-closure case where I'd like it. What ideas did you have for handling closure cases like this:</p>
<div class="codehilite"><pre><span></span>fn foo(_: impl FnOnce(&amp;u32) -&gt; &amp;u32) {
}

fn bar() {
    let x = 22;
    foo(|a| &amp;x)
}
</pre></div>



<a name="133811370"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2352534%20explain%20valid%20for%20static/near/133811370" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2352534.20explain.20valid.20for.20static.html#133811370">(Sep 12 2018 at 16:43)</a>:</h4>
<p>well I think we have to somehow store information from the closure as part of the <code>ClosureRegionRequirements</code></p>



<a name="133811372"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2352534%20explain%20valid%20for%20static/near/133811372" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2352534.20explain.20valid.20for.20static.html#133811372">(Sep 12 2018 at 16:43)</a>:</h4>
<p>currently we store a span</p>



<a name="133811383"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2352534%20explain%20valid%20for%20static/near/133811383" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2352534.20explain.20valid.20for.20static.html#133811383">(Sep 12 2018 at 16:43)</a>:</h4>
<p>but I think we need to store enough info that we can recreate the error message we want</p>



<a name="133811584"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2352534%20explain%20valid%20for%20static/near/133811584" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> davidtwco <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2352534.20explain.20valid.20for.20static.html#133811584">(Sep 12 2018 at 16:47)</a>:</h4>
<p>Alright, if I add more information to that, how do I access it where the error is reported?</p>



<a name="133811770"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2352534%20explain%20valid%20for%20static/near/133811770" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2352534.20explain.20valid.20for.20static.html#133811770">(Sep 12 2018 at 16:51)</a>:</h4>
<p>so the <code>ClosureRegionRequirements</code> creates a bunch of "outlives" reuqirements</p>



<a name="133811779"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2352534%20explain%20valid%20for%20static/near/133811779" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2352534.20explain.20valid.20for.20static.html#133811779">(Sep 12 2018 at 16:51)</a>:</h4>
<p>you would attach it to those in the form of causal information</p>



<a name="133811873"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2352534%20explain%20valid%20for%20static/near/133811873" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2352534.20explain.20valid.20for.20static.html#133811873">(Sep 12 2018 at 16:52)</a>:</h4>
<p>I think we are using <code>Locations</code> for that</p>



<a name="133811874"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2352534%20explain%20valid%20for%20static/near/133811874" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2352534.20explain.20valid.20for.20static.html#133811874">(Sep 12 2018 at 16:52)</a>:</h4>
<p>I imagine we would add something like</p>



<a name="133811878"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2352534%20explain%20valid%20for%20static/near/133811878" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2352534.20explain.20valid.20for.20static.html#133811878">(Sep 12 2018 at 16:53)</a>:</h4>
<p>well, I imagine we would translate it somehow</p>



<a name="133811889"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2352534%20explain%20valid%20for%20static/near/133811889" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2352534.20explain.20valid.20for.20static.html#133811889">(Sep 12 2018 at 16:53)</a>:</h4>
<p>we might add <code>Locations::ClosureBlahBlah</code> or something, not sure</p>



<a name="133811895"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2352534%20explain%20valid%20for%20static/near/133811895" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2352534.20explain.20valid.20for.20static.html#133811895">(Sep 12 2018 at 16:53)</a>:</h4>
<p>the first question is... what info we are we going to keep exactly</p>



<a name="133811901"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2352534%20explain%20valid%20for%20static/near/133811901" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2352534.20explain.20valid.20for.20static.html#133811901">(Sep 12 2018 at 16:53)</a>:</h4>
<p>I'm a bit nervous because this is stuff we have to do even without an error having been reported</p>



<a name="133811904"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2352534%20explain%20valid%20for%20static/near/133811904" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2352534.20explain.20valid.20for.20static.html#133811904">(Sep 12 2018 at 16:53)</a>:</h4>
<p>since we don't know yet if there is an error</p>



<a name="133811913"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2352534%20explain%20valid%20for%20static/near/133811913" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2352534.20explain.20valid.20for.20static.html#133811913">(Sep 12 2018 at 16:53)</a>:</h4>
<p>so ideally we won't do too much poking around, just store a few things and return</p>



<a name="133812185"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2352534%20explain%20valid%20for%20static/near/133812185" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2352534.20explain.20valid.20for.20static.html#133812185">(Sep 12 2018 at 16:59)</a>:</h4>
<p>(do you know which bits of code I am talking about? want some pointers?)</p>



<a name="133812195"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2352534%20explain%20valid%20for%20static/near/133812195" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> davidtwco <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2352534.20explain.20valid.20for.20static.html#133812195">(Sep 12 2018 at 16:59)</a>:</h4>
<p>I'll poke around and see what I come up with.</p>



<a name="133812198"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2352534%20explain%20valid%20for%20static/near/133812198" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> davidtwco <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2352534.20explain.20valid.20for.20static.html#133812198">(Sep 12 2018 at 16:59)</a>:</h4>
<p>Thanks.</p>



<a name="133874959"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2352534%20explain%20valid%20for%20static/near/133874959" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> davidtwco <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2352534.20explain.20valid.20for.20static.html#133874959">(Sep 13 2018 at 10:28)</a>:</h4>
<p><span class="user-mention" data-user-id="116009">@nikomatsakis</span> What I've not been able to work out is: once I've created a <code>Locations</code> variant and added that with the closure constraints, how I can then access it near where the error reporting is.</p>



<a name="133880951"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2352534%20explain%20valid%20for%20static/near/133880951" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> davidtwco <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2352534.20explain.20valid.20for.20static.html#133880951">(Sep 13 2018 at 12:35)</a>:</h4>
<p>Figured that out a bit ago. Now working out what I want to add to my variant.</p>



<a name="133881002"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2352534%20explain%20valid%20for%20static/near/133881002" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> davidtwco <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2352534.20explain.20valid.20for.20static.html#133881002">(Sep 13 2018 at 12:36)</a>:</h4>
<p>Is the closure's <code>DefId</code> and <code>ClosureSubsts&lt;'tcx&gt;</code> too much? I'd need that to work out the signature.</p>



<a name="133882003"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2352534%20explain%20valid%20for%20static/near/133882003" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2352534.20explain.20valid.20for.20static.html#133882003">(Sep 13 2018 at 12:54)</a>:</h4>
<p><span class="user-mention" data-user-id="116107">@davidtwco</span> ok — did you  push your latest somewhere btw?</p>



<a name="133882008"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2352534%20explain%20valid%20for%20static/near/133882008" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> davidtwco <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2352534.20explain.20valid.20for.20static.html#133882008">(Sep 13 2018 at 12:54)</a>:</h4>
<p>Not yet.</p>



<a name="133882023"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2352534%20explain%20valid%20for%20static/near/133882023" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> davidtwco <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2352534.20explain.20valid.20for.20static.html#133882023">(Sep 13 2018 at 12:55)</a>:</h4>
<p>Still trying to include <code>ClosureSubsts</code> since it has a lifetime it ends up propagating everywhere <span class="emoji emoji-1f641" title="frown">:frown:</span></p>



<a name="133882927"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2352534%20explain%20valid%20for%20static/near/133882927" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2352534.20explain.20valid.20for.20static.html#133882927">(Sep 13 2018 at 13:08)</a>:</h4>
<p>Hmm</p>



<a name="133882957"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2352534%20explain%20valid%20for%20static/near/133882957" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2352534.20explain.20valid.20for.20static.html#133882957">(Sep 13 2018 at 13:08)</a>:</h4>
<p>Yeah, I think I used to have some tcx data in there but wound up stripping it out</p>



<a name="133884243"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2352534%20explain%20valid%20for%20static/near/133884243" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> davidtwco <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2352534.20explain.20valid.20for.20static.html#133884243">(Sep 13 2018 at 13:28)</a>:</h4>
<p>I can't get the lifetimes to work out when I add a lifetime to <code>Locations</code> so it can include a <code>ClosureSubsts&lt;'tcx&gt;</code>. I've pushed a broken commit that has everything up to attempting that.</p>



<a name="133884264"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2352534%20explain%20valid%20for%20static/near/133884264" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2352534.20explain.20valid.20for.20static.html#133884264">(Sep 13 2018 at 13:28)</a>:</h4>
<p>ok, let me take a look.</p>



<a name="133885870"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2352534%20explain%20valid%20for%20static/near/133885870" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2352534.20explain.20valid.20for.20static.html#133885870">(Sep 13 2018 at 13:52)</a>:</h4>
<p>fetching now</p>



<a name="133885873"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2352534%20explain%20valid%20for%20static/near/133885873" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2352534.20explain.20valid.20for.20static.html#133885873">(Sep 13 2018 at 13:52)</a>:</h4>
<p>though compiler team mtg is in 10 minutes :)</p>



<a name="133885883"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2352534%20explain%20valid%20for%20static/near/133885883" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> davidtwco <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2352534.20explain.20valid.20for.20static.html#133885883">(Sep 13 2018 at 13:53)</a>:</h4>
<p>I got my reminder for it.</p>



<a name="133886111"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2352534%20explain%20valid%20for%20static/near/133886111" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> davidtwco <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2352534.20explain.20valid.20for.20static.html#133886111">(Sep 13 2018 at 13:56)</a>:</h4>
<p>I've tried to move some of the computation to when I add it to <code>Locations</code> so I can avoid adding something with a lifetime at that point, that didn't work.</p>



<a name="133886142"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2352534%20explain%20valid%20for%20static/near/133886142" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> davidtwco <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2352534.20explain.20valid.20for.20static.html#133886142">(Sep 13 2018 at 13:57)</a>:</h4>
<p>Not sure if you've seen the branch since I ditched using <code>give_region_a_name</code> since none of the universal regions I could find using the technique you mentioned were the arguments or return type that I wanted - normally there wasn't any.</p>



<a name="133891640"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2352534%20explain%20valid%20for%20static/near/133891640" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> davidtwco <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2352534.20explain.20valid.20for.20static.html#133891640">(Sep 13 2018 at 15:12)</a>:</h4>
<p>Seems that <code>Locations</code> (and types using it) rely on being <code>Copy</code> so I'm limited in that regard too.</p>



<a name="133894797"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2352534%20explain%20valid%20for%20static/near/133894797" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> davidtwco <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2352534.20explain.20valid.20for.20static.html#133894797">(Sep 13 2018 at 15:53)</a>:</h4>
<p>Yeah, making another attempt to add a <code>ClosureSubsts&lt;'tcx&gt;</code> to the variant and it's definitely the <code>nll/constraints/graph.rs</code> code that I just can't get to work out. Since adding a lifetime to <code>Locations</code> requires adding one to <code>OutlivesConstraint</code> which this operates on.</p>



<a name="133898415"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2352534%20explain%20valid%20for%20static/near/133898415" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> davidtwco <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2352534.20explain.20valid.20for.20static.html#133898415">(Sep 13 2018 at 16:56)</a>:</h4>
<p><span class="user-mention" data-user-id="116009">@nikomatsakis</span> Pushed a commit where I attempt to include the <code>ClosureSubsts&lt;'tcx&gt;</code> that I need and fail spectacularly.</p>



<a name="133898519"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2352534%20explain%20valid%20for%20static/near/133898519" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2352534.20explain.20valid.20for.20static.html#133898519">(Sep 13 2018 at 16:58)</a>:</h4>
<p>ok</p>



<a name="133898522"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2352534%20explain%20valid%20for%20static/near/133898522" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2352534.20explain.20valid.20for.20static.html#133898522">(Sep 13 2018 at 16:58)</a>:</h4>
<p>I can try to take a look now-ish, sorry, was busy earlier</p>



<a name="133898710"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2352534%20explain%20valid%20for%20static/near/133898710" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2352534.20explain.20valid.20for.20static.html#133898710">(Sep 13 2018 at 17:02)</a>:</h4>
<p>(incidentally, one option to address this is also indirection)</p>



<a name="133898715"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2352534%20explain%20valid%20for%20static/near/133898715" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2352534.20explain.20valid.20for.20static.html#133898715">(Sep 13 2018 at 17:02)</a>:</h4>
<p>but I want to see if there's some other alternative</p>



<a name="133898851"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2352534%20explain%20valid%20for%20static/near/133898851" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> davidtwco <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2352534.20explain.20valid.20for.20static.html#133898851">(Sep 13 2018 at 17:05)</a>:</h4>
<p>Thanks.</p>



<a name="133899035"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2352534%20explain%20valid%20for%20static/near/133899035" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2352534.20explain.20valid.20for.20static.html#133899035">(Sep 13 2018 at 17:08)</a>:</h4>
<p><span class="user-mention" data-user-id="116107">@davidtwco</span> which test case are you running again?</p>



<a name="133899160"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2352534%20explain%20valid%20for%20static/near/133899160" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> davidtwco <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2352534.20explain.20valid.20for.20static.html#133899160">(Sep 13 2018 at 17:10)</a>:</h4>
<p>Ah, one I have locally that I've not included with a commit. <span class="user-mention" data-user-id="116009">@nikomatsakis</span> </p>
<div class="codehilite"><pre><span></span>fn foo(_: impl FnOnce(&amp;u32) -&gt; &amp;u32) {
}

fn bar() {
    let x = 22;
    foo(|a| &amp;x)
}
</pre></div>



<a name="133899195"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2352534%20explain%20valid%20for%20static/near/133899195" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2352534.20explain.20valid.20for.20static.html#133899195">(Sep 13 2018 at 17:11)</a>:</h4>
<p>ok I want to stare at the data a bit :)</p>



<a name="133899204"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2352534%20explain%20valid%20for%20static/near/133899204" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2352534.20explain.20valid.20for.20static.html#133899204">(Sep 13 2018 at 17:11)</a>:</h4>
<p>I'm currently considering a few things</p>



<a name="133899216"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2352534%20explain%20valid%20for%20static/near/133899216" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2352534.20explain.20valid.20for.20static.html#133899216">(Sep 13 2018 at 17:11)</a>:</h4>
<p>one of them is that we might produce, in the closure, a bit more information about what to print</p>



<a name="133899266"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2352534%20explain%20valid%20for%20static/near/133899266" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2352534.20explain.20valid.20for.20static.html#133899266">(Sep 13 2018 at 17:12)</a>:</h4>
<p>so that we don't have the <code>Locations</code> just say "from this closure" but rather something higher-level</p>



<a name="133899268"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2352534%20explain%20valid%20for%20static/near/133899268" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2352534.20explain.20valid.20for.20static.html#133899268">(Sep 13 2018 at 17:12)</a>:</h4>
<p>that is sort of what I suggested <em>not</em> to do earlier :P</p>



<a name="133899271"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2352534%20explain%20valid%20for%20static/near/133899271" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2352534.20explain.20valid.20for.20static.html#133899271">(Sep 13 2018 at 17:12)</a>:</h4>
<p>but maybe it makes sense</p>



<a name="133899277"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2352534%20explain%20valid%20for%20static/near/133899277" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2352534.20explain.20valid.20for.20static.html#133899277">(Sep 13 2018 at 17:12)</a>:</h4>
<p>depends how much work it is for us to diagnose, kind of</p>



<a name="133899286"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2352534%20explain%20valid%20for%20static/near/133899286" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2352534.20explain.20valid.20for.20static.html#133899286">(Sep 13 2018 at 17:13)</a>:</h4>
<p>in particular, it seems like these errors always come from certain kinds of interactions</p>



<a name="133899295"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2352534%20explain%20valid%20for%20static/near/133899295" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2352534.20explain.20valid.20for.20static.html#133899295">(Sep 13 2018 at 17:13)</a>:</h4>
<p>at least I think that's true</p>



<a name="133899298"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2352534%20explain%20valid%20for%20static/near/133899298" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2352534.20explain.20valid.20for.20static.html#133899298">(Sep 13 2018 at 17:13)</a>:</h4>
<p>e.g., escaping references that ought to be local and the like</p>



<a name="133899299"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2352534%20explain%20valid%20for%20static/near/133899299" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2352534.20explain.20valid.20for.20static.html#133899299">(Sep 13 2018 at 17:13)</a>:</h4>
<p>and maybe we can identify those pretty cheaply</p>



<a name="133899307"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2352534%20explain%20valid%20for%20static/near/133899307" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2352534.20explain.20valid.20for.20static.html#133899307">(Sep 13 2018 at 17:13)</a>:</h4>
<p>(I should think so)</p>



<a name="133899368"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2352534%20explain%20valid%20for%20static/near/133899368" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> davidtwco <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2352534.20explain.20valid.20for.20static.html#133899368">(Sep 13 2018 at 17:14)</a>:</h4>
<p>The main thing I need for the error is a way to get the type of a closure argument (so I can print it out with some synthesized lifetime). The primary issue that makes it painful is that getting the DefId for the closure and then looking it up in the HIR has a lot of TyKind::Infer. So we need to do the workarounds like including things in <code>Locations</code> in order to get anything.</p>



<a name="133899470"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2352534%20explain%20valid%20for%20static/near/133899470" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> davidtwco <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2352534.20explain.20valid.20for.20static.html#133899470">(Sep 13 2018 at 17:16)</a>:</h4>
<p>I can't quite put my finger on why I've gotten frustrated with this PR and not with any others.</p>



<a name="133899496"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2352534%20explain%20valid%20for%20static/near/133899496" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2352534.20explain.20valid.20for.20static.html#133899496">(Sep 13 2018 at 17:17)</a>:</h4>
<p>:)</p>



<a name="133899537"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2352534%20explain%20valid%20for%20static/near/133899537" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2352534.20explain.20valid.20for.20static.html#133899537">(Sep 13 2018 at 17:18)</a>:</h4>
<p>this stuff is always a bit tricky</p>



<a name="133899543"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2352534%20explain%20valid%20for%20static/near/133899543" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2352534.20explain.20valid.20for.20static.html#133899543">(Sep 13 2018 at 17:18)</a>:</h4>
<p>I wish we didn't poke at the HIR quite so much</p>



<a name="133899544"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2352534%20explain%20valid%20for%20static/near/133899544" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2352534.20explain.20valid.20for.20static.html#133899544">(Sep 13 2018 at 17:18)</a>:</h4>
<p>but I'm not sure what else to do :P</p>



<a name="133899547"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2352534%20explain%20valid%20for%20static/near/133899547" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2352534.20explain.20valid.20for.20static.html#133899547">(Sep 13 2018 at 17:18)</a>:</h4>
<p>anyway</p>



<a name="133899555"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2352534%20explain%20valid%20for%20static/near/133899555" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2352534.20explain.20valid.20for.20static.html#133899555">(Sep 13 2018 at 17:18)</a>:</h4>
<p>(I'm thinking a lot lately about how to "slice up" rustc to have fewer interdependencies)</p>



<a name="133899798"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2352534%20explain%20valid%20for%20static/near/133899798" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2352534.20explain.20valid.20for.20static.html#133899798">(Sep 13 2018 at 17:23)</a>:</h4>
<p>as a random comment on that example:</p>



<a name="133899811"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2352534%20explain%20valid%20for%20static/near/133899811" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2352534.20explain.20valid.20for.20static.html#133899811">(Sep 13 2018 at 17:23)</a>:</h4>
<p>AST borrow check says:</p>
<div class="codehilite"><pre><span></span>error[E0373]: closure may outlive the current function, but it borrows `x`, which is owned by the current function
 --&gt; /home/nmatsakis/tmp/davidtwco.rs:6:9
  |
6 |     foo(|a| &amp;x)
  |         ^^^  - `x` is borrowed here
  |         |
  |         may outlive borrowed value `x`
help: to force the closure to take ownership of `x` (and any other referenced variables), use the `move` keyword
  |
6 |     foo(move |a| &amp;x)
  |         ^^^^^^^^
</pre></div>



<a name="133899860"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2352534%20explain%20valid%20for%20static/near/133899860" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> davidtwco <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2352534.20explain.20valid.20for.20static.html#133899860">(Sep 13 2018 at 17:24)</a>:</h4>
<p>That's not a bad error.</p>



<a name="133899861"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2352534%20explain%20valid%20for%20static/near/133899861" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2352534.20explain.20valid.20for.20static.html#133899861">(Sep 13 2018 at 17:24)</a>:</h4>
<p>I think that " may outlive borrowed value <code>x</code> " is actually sort of confusing</p>



<a name="133899865"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2352534%20explain%20valid%20for%20static/near/133899865" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2352534.20explain.20valid.20for.20static.html#133899865">(Sep 13 2018 at 17:24)</a>:</h4>
<p>yes, I worked hard on that one :)</p>



<a name="133899885"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2352534%20explain%20valid%20for%20static/near/133899885" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2352534.20explain.20valid.20for.20static.html#133899885">(Sep 13 2018 at 17:24)</a>:</h4>
<p>I think I would prefer something like "this closure may outlive the current function"</p>



<a name="133899887"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2352534%20explain%20valid%20for%20static/near/133899887" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> davidtwco <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2352534.20explain.20valid.20for.20static.html#133899887">(Sep 13 2018 at 17:24)</a>:</h4>
<p>"the closure may outlive the current function" is not intuitive to me.</p>



<a name="133899891"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2352534%20explain%20valid%20for%20static/near/133899891" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2352534.20explain.20valid.20for.20static.html#133899891">(Sep 13 2018 at 17:24)</a>:</h4>
<p>lol</p>



<a name="133899895"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2352534%20explain%20valid%20for%20static/near/133899895" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2352534.20explain.20valid.20for.20static.html#133899895">(Sep 13 2018 at 17:25)</a>:</h4>
<p>I actually think I prefer the "escapes" terminology</p>



<a name="133899905"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2352534%20explain%20valid%20for%20static/near/133899905" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2352534.20explain.20valid.20for.20static.html#133899905">(Sep 13 2018 at 17:25)</a>:</h4>
<p>"this closure escapes the current function,"</p>



<a name="133899908"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2352534%20explain%20valid%20for%20static/near/133899908" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2352534.20explain.20valid.20for.20static.html#133899908">(Sep 13 2018 at 17:25)</a>:</h4>
<p>but I don't really know</p>



<a name="133899910"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2352534%20explain%20valid%20for%20static/near/133899910" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2352534.20explain.20valid.20for.20static.html#133899910">(Sep 13 2018 at 17:25)</a>:</h4>
<p>anyway, wording tweaks aside...</p>



<a name="133899969"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2352534%20explain%20valid%20for%20static/near/133899969" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2352534.20explain.20valid.20for.20static.html#133899969">(Sep 13 2018 at 17:26)</a>:</h4>
<p>when we generate the <code>ClosureRegionRequirements</code>, we are going to be adding a <code>'x: 'static</code> constraint -- the <code>'static</code> arises beacuse we <em>had</em> a <code>'x: 'X</code> where <code>'X</code> is a local region...</p>



<a name="133899977"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2352534%20explain%20valid%20for%20static/near/133899977" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2352534.20explain.20valid.20for.20static.html#133899977">(Sep 13 2018 at 17:26)</a>:</h4>
<p>...and you're saying you'd like to know, for the error, which argument contained <code>'X</code> (if any)</p>



<a name="133899979"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2352534%20explain%20valid%20for%20static/near/133899979" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2352534.20explain.20valid.20for.20static.html#133899979">(Sep 13 2018 at 17:26)</a>:</h4>
<p>right?</p>



<a name="133900166"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2352534%20explain%20valid%20for%20static/near/133900166" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> davidtwco <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2352534.20explain.20valid.20for.20static.html#133900166">(Sep 13 2018 at 17:29)</a>:</h4>
<p>I'm not sure I'm following.</p>



<a name="133900173"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2352534%20explain%20valid%20for%20static/near/133900173" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2352534.20explain.20valid.20for.20static.html#133900173">(Sep 13 2018 at 17:29)</a>:</h4>
<p>ok so let's talk it through</p>



<a name="133900174"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2352534%20explain%20valid%20for%20static/near/133900174" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2352534.20explain.20valid.20for.20static.html#133900174">(Sep 13 2018 at 17:30)</a>:</h4>
<p>it'll be helpful to me too :)</p>



<a name="133900195"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2352534%20explain%20valid%20for%20static/near/133900195" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> davidtwco <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2352534.20explain.20valid.20for.20static.html#133900195">(Sep 13 2018 at 17:30)</a>:</h4>
<p>At the moment, my handling of this for functions is incredibly naive.</p>



<a name="133900226"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2352534%20explain%20valid%20for%20static/near/133900226" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2352534.20explain.20valid.20for.20static.html#133900226">(Sep 13 2018 at 17:30)</a>:</h4>
<p>right so just ignore that for a second</p>



<a name="133900260"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2352534%20explain%20valid%20for%20static/near/133900260" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2352534.20explain.20valid.20for.20static.html#133900260">(Sep 13 2018 at 17:31)</a>:</h4>
<p>the <code>ClosureRegionRequirements</code> for the closure are:</p>
<div class="codehilite"><pre><span></span>        ClosureRegionRequirements {
            num_external_vids: 2,
            outlives_requirements: [
                ClosureOutlivesRequirement {
                    subject: Region(
                        &#39;_#1r
                    ),
                    outlived_free_region: &#39;_#0r,
                    blame_span: /home/nmatsakis/tmp/davidtwco.rs:6:13: 6:15
                }
            ]
        }
</pre></div>



<a name="133900268"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2352534%20explain%20valid%20for%20static/near/133900268" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2352534.20explain.20valid.20for.20static.html#133900268">(Sep 13 2018 at 17:31)</a>:</h4>
<p>(extracted from the <code>RUST_LOG=rustc_mir::borrow_check</code> output)</p>



<a name="133900279"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2352534%20explain%20valid%20for%20static/near/133900279" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2352534.20explain.20valid.20for.20static.html#133900279">(Sep 13 2018 at 17:31)</a>:</h4>
<p>in particular, the <code>outlived_free_region</code> field is <code>_#0r</code></p>



<a name="133900280"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2352534%20explain%20valid%20for%20static/near/133900280" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2352534.20explain.20valid.20for.20static.html#133900280">(Sep 13 2018 at 17:31)</a>:</h4>
<p>which represents <code>'static</code></p>



<a name="133900283"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2352534%20explain%20valid%20for%20static/near/133900283" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2352534.20explain.20valid.20for.20static.html#133900283">(Sep 13 2018 at 17:31)</a>:</h4>
<p>this is the immediate source of our problems :)</p>



<a name="133900292"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2352534%20explain%20valid%20for%20static/near/133900292" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2352534.20explain.20valid.20for.20static.html#133900292">(Sep 13 2018 at 17:31)</a>:</h4>
<p>but where did that requirement come from?</p>



<a name="133900354"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2352534%20explain%20valid%20for%20static/near/133900354" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2352534.20explain.20valid.20for.20static.html#133900354">(Sep 13 2018 at 17:32)</a>:</h4>
<p>the answer is that, when type-checking the closure, we had to prove that <code>'_#1r: _#2r</code></p>



<a name="133900371"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2352534%20explain%20valid%20for%20static/near/133900371" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2352534.20explain.20valid.20for.20static.html#133900371">(Sep 13 2018 at 17:32)</a>:</h4>
<p>if you skim back in the logs, you'll see that</p>
<div class="codehilite"><pre><span></span>DEBUG 2018-09-13T17:30:31Z: rustc_mir::borrow_check::nll::region_infer: check_universal_region: fr=&#39;_#1r does not outlive shorter_fr=&#39;_#2r
</pre></div>



<a name="133900488"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2352534%20explain%20valid%20for%20static/near/133900488" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2352534.20explain.20valid.20for.20static.html#133900488">(Sep 13 2018 at 17:35)</a>:</h4>
<p>(with me thus far or did I lose you? :)</p>



<a name="133900511"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2352534%20explain%20valid%20for%20static/near/133900511" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> davidtwco <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2352534.20explain.20valid.20for.20static.html#133900511">(Sep 13 2018 at 17:35)</a>:</h4>
<p>Just trying to map what you're saying to the MIR I'm looking at.</p>



<a name="133900520"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2352534%20explain%20valid%20for%20static/near/133900520" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2352534.20explain.20valid.20for.20static.html#133900520">(Sep 13 2018 at 17:35)</a>:</h4>
<p>more concretely, the <code>'_#1r</code> here is part of the type of the upvar <code>x</code></p>



<a name="133900521"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2352534%20explain%20valid%20for%20static/near/133900521" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2352534.20explain.20valid.20for.20static.html#133900521">(Sep 13 2018 at 17:36)</a>:</h4>
<p>which is captured by reference</p>



<a name="133900562"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2352534%20explain%20valid%20for%20static/near/133900562" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2352534.20explain.20valid.20for.20static.html#133900562">(Sep 13 2018 at 17:36)</a>:</h4>
<p>and has a type like <code>&amp;'_#1r X</code> for some <code>X</code></p>



<a name="133900568"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2352534%20explain%20valid%20for%20static/near/133900568" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2352534.20explain.20valid.20for.20static.html#133900568">(Sep 13 2018 at 17:36)</a>:</h4>
<p>the <code>'_#2r</code> is a (local) region from the return type of the closure</p>



<a name="133900579"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2352534%20explain%20valid%20for%20static/near/133900579" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2352534.20explain.20valid.20for.20static.html#133900579">(Sep 13 2018 at 17:36)</a>:</h4>
<p>(you can see those in the mir-dump)</p>



<a name="133900620"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2352534%20explain%20valid%20for%20static/near/133900620" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> davidtwco <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2352534.20explain.20valid.20for.20static.html#133900620">(Sep 13 2018 at 17:37)</a>:</h4>
<p>Why is <code>'_#2r</code> the return type?</p>



<a name="133900767"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2352534%20explain%20valid%20for%20static/near/133900767" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> davidtwco <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2352534.20explain.20valid.20for.20static.html#133900767">(Sep 13 2018 at 17:40)</a>:</h4>
<p>I was under the impression that the <code>'_#2r</code> would have been the argument to the closure?</p>



<a name="133900773"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2352534%20explain%20valid%20for%20static/near/133900773" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> davidtwco <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2352534.20explain.20valid.20for.20static.html#133900773">(Sep 13 2018 at 17:40)</a>:</h4>
<p>Not sure why.</p>



<a name="133901232"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2352534%20explain%20valid%20for%20static/near/133901232" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2352534.20explain.20valid.20for.20static.html#133901232">(Sep 13 2018 at 17:48)</a>:</h4>
<p>I think it is both</p>



<a name="133901239"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2352534%20explain%20valid%20for%20static/near/133901239" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2352534.20explain.20valid.20for.20static.html#133901239">(Sep 13 2018 at 17:48)</a>:</h4>
<p>I think the closure's signature is <code>fn(&amp;'x) -&gt; &amp;'x</code></p>



<a name="133901241"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2352534%20explain%20valid%20for%20static/near/133901241" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2352534.20explain.20valid.20for.20static.html#133901241">(Sep 13 2018 at 17:48)</a>:</h4>
<p>and <code>'_#2r</code> represents this <code>'x</code> here</p>



<a name="133901248"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2352534%20explain%20valid%20for%20static/near/133901248" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> davidtwco <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2352534.20explain.20valid.20for.20static.html#133901248">(Sep 13 2018 at 17:49)</a>:</h4>
<p>I would have expected that because of elision rules but thought the MIR would have separated the two.</p>



<a name="133901333"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2352534%20explain%20valid%20for%20static/near/133901333" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2352534.20explain.20valid.20for.20static.html#133901333">(Sep 13 2018 at 17:50)</a>:</h4>
<p>no</p>



<a name="133901338"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2352534%20explain%20valid%20for%20static/near/133901338" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2352534.20explain.20valid.20for.20static.html#133901338">(Sep 13 2018 at 17:50)</a>:</h4>
<p>in fn signatures, we keep the exact details</p>



<a name="133901347"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2352534%20explain%20valid%20for%20static/near/133901347" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2352534.20explain.20valid.20for.20static.html#133901347">(Sep 13 2018 at 17:50)</a>:</h4>
<p>within the fn body, we introduce variables, because we want max flexibility</p>



<a name="133901360"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2352534%20explain%20valid%20for%20static/near/133901360" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2352534.20explain.20valid.20for.20static.html#133901360">(Sep 13 2018 at 17:50)</a>:</h4>
<p>but we don't want to wind up with requirements that the given fn signature cannot satisfy</p>



<a name="133901845"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2352534%20explain%20valid%20for%20static/near/133901845" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> davidtwco <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2352534.20explain.20valid.20for.20static.html#133901845">(Sep 13 2018 at 17:58)</a>:</h4>
<p>Alright, so I follow.</p>



<a name="133902135"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2352534%20explain%20valid%20for%20static/near/133902135" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2352534.20explain.20valid.20for.20static.html#133902135">(Sep 13 2018 at 18:02)</a>:</h4>
<p>ok, so</p>



<a name="133902288"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2352534%20explain%20valid%20for%20static/near/133902288" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2352534.20explain.20valid.20for.20static.html#133902288">(Sep 13 2018 at 18:04)</a>:</h4>
<p>let me give you a pointer to some code</p>



<a name="133902337"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2352534%20explain%20valid%20for%20static/near/133902337" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2352534.20explain.20valid.20for.20static.html#133902337">(Sep 13 2018 at 18:05)</a>:</h4>
<p>this is <a href="https://github.com/rust-lang/rust/blob/994cdd918589535d705177545bf503cd0c3c5148/src/librustc_mir/borrow_check/nll/region_infer/mod.rs#L984-L991" target="_blank" title="https://github.com/rust-lang/rust/blob/994cdd918589535d705177545bf503cd0c3c5148/src/librustc_mir/borrow_check/nll/region_infer/mod.rs#L984-L991">the <code>check_universal_region</code> function</a>, which is the one generating this constraint</p>



<a name="133902354"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2352534%20explain%20valid%20for%20static/near/133902354" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2352534.20explain.20valid.20for.20static.html#133902354">(Sep 13 2018 at 18:05)</a>:</h4>
<p>er, bad link sort of</p>



<a name="133902357"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2352534%20explain%20valid%20for%20static/near/133902357" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2352534.20explain.20valid.20for.20static.html#133902357">(Sep 13 2018 at 18:05)</a>:</h4>
<p><a href="https://github.com/rust-lang/rust/blob/994cdd918589535d705177545bf503cd0c3c5148/src/librustc_mir/borrow_check/nll/region_infer/mod.rs#L1027-L1035" target="_blank" title="https://github.com/rust-lang/rust/blob/994cdd918589535d705177545bf503cd0c3c5148/src/librustc_mir/borrow_check/nll/region_infer/mod.rs#L1027-L1035">*this* is the function I meant</a></p>



<a name="133902430"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2352534%20explain%20valid%20for%20static/near/133902430" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2352534.20explain.20valid.20for.20static.html#133902430">(Sep 13 2018 at 18:06)</a>:</h4>
<p>this is the point where we've determined that we can't locally prove the thing in question</p>



<a name="133902436"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2352534%20explain%20valid%20for%20static/near/133902436" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2352534.20explain.20valid.20for.20static.html#133902436">(Sep 13 2018 at 18:06)</a>:</h4>
<p>and we try to propagate it out</p>



<a name="133902439"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2352534%20explain%20valid%20for%20static/near/133902439" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2352534.20explain.20valid.20for.20static.html#133902439">(Sep 13 2018 at 18:06)</a>:</h4>
<p><a href="https://github.com/rust-lang/rust/blob/994cdd918589535d705177545bf503cd0c3c5148/src/librustc_mir/borrow_check/nll/region_infer/mod.rs#L1070-L1071" target="_blank" title="https://github.com/rust-lang/rust/blob/994cdd918589535d705177545bf503cd0c3c5148/src/librustc_mir/borrow_check/nll/region_infer/mod.rs#L1070-L1071">link</a></p>



<a name="133902461"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2352534%20explain%20valid%20for%20static/near/133902461" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2352534.20explain.20valid.20for.20static.html#133902461">(Sep 13 2018 at 18:06)</a>:</h4>
<p>and <a href="https://github.com/rust-lang/rust/blob/994cdd918589535d705177545bf503cd0c3c5148/src/librustc_mir/borrow_check/nll/region_infer/mod.rs#L1079-L1080" target="_blank" title="https://github.com/rust-lang/rust/blob/994cdd918589535d705177545bf503cd0c3c5148/src/librustc_mir/borrow_check/nll/region_infer/mod.rs#L1079-L1080">this</a> is the call which will grow from <code>'_#2r</code> to <code>'_#0r</code></p>



<a name="133902635"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2352534%20explain%20valid%20for%20static/near/133902635" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> davidtwco <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2352534.20explain.20valid.20for.20static.html#133902635">(Sep 13 2018 at 18:09)</a>:</h4>
<p>I'm trying to understand what that is doing in terms of the lifetimes we have in this case.</p>



<a name="133902711"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2352534%20explain%20valid%20for%20static/near/133902711" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> davidtwco <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2352534.20explain.20valid.20for.20static.html#133902711">(Sep 13 2018 at 18:10)</a>:</h4>
<p>Our <code>longer_fr</code> in this case would be <code>'_#1r</code> right? And we'd previously have "presumed" that it could live as long as <code>'_#2r</code>? So we try to find a smaller then larger region?</p>



<a name="133902716"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2352534%20explain%20valid%20for%20static/near/133902716" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> davidtwco <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2352534.20explain.20valid.20for.20static.html#133902716">(Sep 13 2018 at 18:10)</a>:</h4>
<p>Or am I getting that mixed up?</p>



<a name="133902825"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2352534%20explain%20valid%20for%20static/near/133902825" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2352534.20explain.20valid.20for.20static.html#133902825">(Sep 13 2018 at 18:12)</a>:</h4>
<p>that is correct</p>



<a name="133902839"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2352534%20explain%20valid%20for%20static/near/133902839" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2352534.20explain.20valid.20for.20static.html#133902839">(Sep 13 2018 at 18:12)</a>:</h4>
<p>I'm not sure what you mean by <em>presumed</em> exactly</p>



<a name="133902847"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2352534%20explain%20valid%20for%20static/near/133902847" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2352534.20explain.20valid.20for.20static.html#133902847">(Sep 13 2018 at 18:12)</a>:</h4>
<p>what happens is that we see you are returning a value of type <code>&amp;'_#1r T</code></p>



<a name="133902854"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2352534%20explain%20valid%20for%20static/near/133902854" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2352534.20explain.20valid.20for.20static.html#133902854">(Sep 13 2018 at 18:12)</a>:</h4>
<p>but your expected return type is <code>&amp;'_#2r T</code></p>



<a name="133902861"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2352534%20explain%20valid%20for%20static/near/133902861" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2352534.20explain.20valid.20for.20static.html#133902861">(Sep 13 2018 at 18:12)</a>:</h4>
<p>therefore, <code>'_#1r: '_#2r</code> must hold or else there is a type error</p>



<a name="133902884"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2352534%20explain%20valid%20for%20static/near/133902884" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2352534.20explain.20valid.20for.20static.html#133902884">(Sep 13 2018 at 18:13)</a>:</h4>
<p>what we do is to propagate those constraints around</p>



<a name="133902893"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2352534%20explain%20valid%20for%20static/near/133902893" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2352534.20explain.20valid.20for.20static.html#133902893">(Sep 13 2018 at 18:13)</a>:</h4>
<p>then we kind of go back over and check that everything can be satisfied</p>



<a name="133902898"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2352534%20explain%20valid%20for%20static/near/133902898" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2352534.20explain.20valid.20for.20static.html#133902898">(Sep 13 2018 at 18:13)</a>:</h4>
<p>sorry, that's sort of confusing</p>



<a name="133902945"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2352534%20explain%20valid%20for%20static/near/133902945" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2352534.20explain.20valid.20for.20static.html#133902945">(Sep 13 2018 at 18:14)</a>:</h4>
<p>basically, we make variables representing the things in the signature and we go back over and check that those variables weren't required to outlive anything that the signature doesn't say they outlive</p>



<a name="133902961"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2352534%20explain%20valid%20for%20static/near/133902961" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> davidtwco <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2352534.20explain.20valid.20for.20static.html#133902961">(Sep 13 2018 at 18:14)</a>:</h4>
<p>And we do that by checking if <code>'_#1r</code> outlives everything that ends within <code>'_#2r</code>?</p>



<a name="133902971"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2352534%20explain%20valid%20for%20static/near/133902971" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2352534.20explain.20valid.20for.20static.html#133902971">(Sep 13 2018 at 18:14)</a>:</h4>
<p>not quite</p>



<a name="133902982"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2352534%20explain%20valid%20for%20static/near/133902982" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2352534.20explain.20valid.20for.20static.html#133902982">(Sep 13 2018 at 18:14)</a>:</h4>
<p>in this case, <code>#_2r</code> would end up "in" the variable for <code>'1</code></p>



<a name="133902995"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2352534%20explain%20valid%20for%20static/near/133902995" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2352534.20explain.20valid.20for.20static.html#133902995">(Sep 13 2018 at 18:14)</a>:</h4>
<p>we go over each such variable (each "universal region")</p>



<a name="133903001"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2352534%20explain%20valid%20for%20static/near/133903001" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2352534.20explain.20valid.20for.20static.html#133903001">(Sep 13 2018 at 18:15)</a>:</h4>
<p>in this case, we are going over <code>'1</code></p>



<a name="133903014"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2352534%20explain%20valid%20for%20static/near/133903014" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2352534.20explain.20valid.20for.20static.html#133903014">(Sep 13 2018 at 18:15)</a>:</h4>
<p>and we look at the things it was ultimately required to outlive (<code>'2</code>)</p>



<a name="133903019"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2352534%20explain%20valid%20for%20static/near/133903019" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2352534.20explain.20valid.20for.20static.html#133903019">(Sep 13 2018 at 18:15)</a>:</h4>
<p>we check that the user declared <code>'1: '2</code></p>



<a name="133903033"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2352534%20explain%20valid%20for%20static/near/133903033" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2352534.20explain.20valid.20for.20static.html#133903033">(Sep 13 2018 at 18:15)</a>:</h4>
<p>if they did not, then we either report an error or — in the case of a closure — we propagate it back to our creator</p>



<a name="133903043"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2352534%20explain%20valid%20for%20static/near/133903043" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2352534.20explain.20valid.20for.20static.html#133903043">(Sep 13 2018 at 18:15)</a>:</h4>
<p>the reason we do that is because closures don't have explicit declarations of this kind</p>



<a name="133903095"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2352534%20explain%20valid%20for%20static/near/133903095" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2352534.20explain.20valid.20for.20static.html#133903095">(Sep 13 2018 at 18:16)</a>:</h4>
<p>we are kind of inferring "what outlives declarations does the closure need to type check"</p>



<a name="133903112"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2352534%20explain%20valid%20for%20static/near/133903112" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2352534.20explain.20valid.20for.20static.html#133903112">(Sep 13 2018 at 18:16)</a>:</h4>
<p>so e.g. consider a <code>fn</code> case:</p>
<div class="codehilite"><pre><span></span><span class="k">fn</span> <span class="nf">foo</span><span class="o">&lt;</span><span class="na">&#39;a</span><span class="p">,</span><span class="w"> </span><span class="na">&#39;b</span><span class="o">&gt;</span><span class="p">(</span><span class="n">a</span>: <span class="kp">&amp;</span><span class="na">&#39;a</span><span class="w"> </span><span class="kt">u32</span><span class="p">)</span><span class="w"> </span>-&gt; <span class="kp">&amp;</span><span class="na">&#39;b</span><span class="w"> </span><span class="kt">u32</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="p">}</span><span class="w"></span>
</pre></div>



<a name="133903121"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2352534%20explain%20valid%20for%20static/near/133903121" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2352534.20explain.20valid.20for.20static.html#133903121">(Sep 13 2018 at 18:16)</a>:</h4>
<p>here the requirement is <code>'a: 'b</code>, and that's an error because we didn't declare that</p>



<a name="133903124"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2352534%20explain%20valid%20for%20static/near/133903124" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> davidtwco <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2352534.20explain.20valid.20for.20static.html#133903124">(Sep 13 2018 at 18:16)</a>:</h4>
<blockquote>
<p>we go over each such variable (each "universal region")<br>
in this case, we are going over '1<br>
and we look at the things it was ultimately required to outlive ('2)</p>
</blockquote>
<p>I'm not following this part, but otherwise it makes sense.</p>



<a name="133903129"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2352534%20explain%20valid%20for%20static/near/133903129" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2352534.20explain.20valid.20for.20static.html#133903129">(Sep 13 2018 at 18:16)</a>:</h4>
<p>but if we had a <code>where 'a: 'b</code></p>



<a name="133903139"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2352534%20explain%20valid%20for%20static/near/133903139" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2352534.20explain.20valid.20for.20static.html#133903139">(Sep 13 2018 at 18:17)</a>:</h4>
<p>in either case, the "value" we compute <code>'a</code> would be <code>{'a, 'b}</code></p>



<a name="133903153"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2352534%20explain%20valid%20for%20static/near/133903153" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2352534.20explain.20valid.20for.20static.html#133903153">(Sep 13 2018 at 18:17)</a>:</h4>
<p>but then afterwards we compare that value against what the where clauses said</p>



<a name="133903154"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2352534%20explain%20valid%20for%20static/near/133903154" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2352534.20explain.20valid.20for.20static.html#133903154">(Sep 13 2018 at 18:17)</a>:</h4>
<p>basically</p>



<a name="133903162"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2352534%20explain%20valid%20for%20static/near/133903162" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2352534.20explain.20valid.20for.20static.html#133903162">(Sep 13 2018 at 18:17)</a>:</h4>
<p>except, for closures, we are inferring the where clauses</p>



<a name="133903257"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2352534%20explain%20valid%20for%20static/near/133903257" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> davidtwco <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2352534.20explain.20valid.20for.20static.html#133903257">(Sep 13 2018 at 18:18)</a>:</h4>
<p>I think what I'm not understanding is the part you mentioned before about how, when we've got a <code>'a</code> and a <code>'b</code> and from the signature know that <code>'a: 'b</code> must hold how we work out (in the case of a closure where we don't just look for where clauses) if it holds or not.</p>



<a name="133903265"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2352534%20explain%20valid%20for%20static/near/133903265" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> davidtwco <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2352534.20explain.20valid.20for.20static.html#133903265">(Sep 13 2018 at 18:18)</a>:</h4>
<p>Essentially, what that function was doing.</p>



<a name="133903272"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2352534%20explain%20valid%20for%20static/near/133903272" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> davidtwco <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2352534.20explain.20valid.20for.20static.html#133903272">(Sep 13 2018 at 18:19)</a>:</h4>
<p>I kinda understood what the comments were trying to say.</p>



<a name="133903617"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2352534%20explain%20valid%20for%20static/near/133903617" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2352534.20explain.20valid.20for.20static.html#133903617">(Sep 13 2018 at 18:23)</a>:</h4>
<p>ok.. I admit I don't quite follow this: "the part you mentioned before ..."</p>



<a name="133903665"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2352534%20explain%20valid%20for%20static/near/133903665" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2352534.20explain.20valid.20for.20static.html#133903665">(Sep 13 2018 at 18:24)</a>:</h4>
<p>it may not be that important, not sure</p>



<a name="133903691"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2352534%20explain%20valid%20for%20static/near/133903691" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2352534.20explain.20valid.20for.20static.html#133903691">(Sep 13 2018 at 18:24)</a>:</h4>
<p>that is, in some sense, the tl;dr is that — at this point in the code — we figured out that the closure requires this relationship between those two region variables</p>



<a name="133903696"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2352534%20explain%20valid%20for%20static/near/133903696" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> davidtwco <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2352534.20explain.20valid.20for.20static.html#133903696">(Sep 13 2018 at 18:24)</a>:</h4>
<p>When you linked to the function, I'm trying to understand what that was doing and how it relates.</p>



<a name="133903704"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2352534%20explain%20valid%20for%20static/near/133903704" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2352534.20explain.20valid.20for.20static.html#133903704">(Sep 13 2018 at 18:24)</a>:</h4>
<p>however, we don't know what values those variables have</p>



<a name="133903710"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2352534%20explain%20valid%20for%20static/near/133903710" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2352534.20explain.20valid.20for.20static.html#133903710">(Sep 13 2018 at 18:24)</a>:</h4>
<p>so we don't know if that relationship is satisfied</p>



<a name="133903714"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2352534%20explain%20valid%20for%20static/near/133903714" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> davidtwco <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2352534.20explain.20valid.20for.20static.html#133903714">(Sep 13 2018 at 18:24)</a>:</h4>
<p>In particular, the shrinking/growing of <code>fr</code> and adding a constraint for that.</p>



<a name="133903740"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2352534%20explain%20valid%20for%20static/near/133903740" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2352534.20explain.20valid.20for.20static.html#133903740">(Sep 13 2018 at 18:25)</a>:</h4>
<p>so we pass the buck to our creator to figure it out by adding this constraint</p>



<a name="133903749"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2352534%20explain%20valid%20for%20static/near/133903749" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2352534.20explain.20valid.20for.20static.html#133903749">(Sep 13 2018 at 18:25)</a>:</h4>
<blockquote>
<p>In particular, the shrinking/growing of <code>fr</code> and adding a constraint for that.</p>
</blockquote>
<p>so the way that this relates</p>



<a name="133903759"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2352534%20explain%20valid%20for%20static/near/133903759" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2352534.20explain.20valid.20for.20static.html#133903759">(Sep 13 2018 at 18:26)</a>:</h4>
<p>is that, in this case, I think we probably want to look and see that the <em>original</em> region (<code>'2</code>) was "local" to the closure</p>



<a name="133903813"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2352534%20explain%20valid%20for%20static/near/133903813" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2352534.20explain.20valid.20for.20static.html#133903813">(Sep 13 2018 at 18:26)</a>:</h4>
<p>it's exactly that case where we have to "grow" the region (to <code>'static</code>, in this case)</p>



<a name="133903835"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2352534%20explain%20valid%20for%20static/near/133903835" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2352534.20explain.20valid.20for.20static.html#133903835">(Sep 13 2018 at 18:26)</a>:</h4>
<p>local regions always appear somewhere in the closure signature, or else represent the closure body</p>



<a name="133903877"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2352534%20explain%20valid%20for%20static/near/133903877" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2352534.20explain.20valid.20for.20static.html#133903877">(Sep 13 2018 at 18:27)</a>:</h4>
<p>so we could map this local region back to a region from the signature, or even to the argument(s) that contain it</p>



<a name="133903882"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2352534%20explain%20valid%20for%20static/near/133903882" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2352534.20explain.20valid.20for.20static.html#133903882">(Sep 13 2018 at 18:27)</a>:</h4>
<p>depending on just what we want to do</p>



<a name="133903895"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2352534%20explain%20valid%20for%20static/near/133903895" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2352534.20explain.20valid.20for.20static.html#133903895">(Sep 13 2018 at 18:27)</a>:</h4>
<p>and then I imagine we'd report back (in the <code>ClosureRegionRequirement</code>) something that carries some spans and info about this argument</p>



<a name="133903944"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2352534%20explain%20valid%20for%20static/near/133903944" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2352534.20explain.20valid.20for.20static.html#133903944">(Sep 13 2018 at 18:28)</a>:</h4>
<p>(or else maybe just the region)</p>



<a name="133903949"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2352534%20explain%20valid%20for%20static/near/133903949" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2352534.20explain.20valid.20for.20static.html#133903949">(Sep 13 2018 at 18:28)</a>:</h4>
<p>so that when we report the error, we can label it properly</p>



<a name="133903984"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2352534%20explain%20valid%20for%20static/near/133903984" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> davidtwco <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2352534.20explain.20valid.20for.20static.html#133903984">(Sep 13 2018 at 18:29)</a>:</h4>
<p>Alright, I think I follow now.</p>



<a name="133904006"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2352534%20explain%20valid%20for%20static/near/133904006" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> davidtwco <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2352534.20explain.20valid.20for.20static.html#133904006">(Sep 13 2018 at 18:29)</a>:</h4>
<p>At the very least, I understand the high-level tl;dr of it sufficiently that I'll stop holding your explanation up <span class="emoji emoji-1f642" title="slight smile">:slight_smile:</span></p>



<a name="133918421"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2352534%20explain%20valid%20for%20static/near/133918421" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> davidtwco <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2352534.20explain.20valid.20for.20static.html#133918421">(Sep 13 2018 at 22:53)</a>:</h4>
<p><span class="user-mention" data-user-id="116009">@nikomatsakis</span> Got it to this - need to get the region naming in again and the span is off a little for the closure:</p>
<div class="codehilite"><pre><span></span>error[E0597]: `x` does not live long enough
  --&gt; src/test/ui/nll/issue-52534-1.rs:19:9
   |
17 |     fn bar(&amp;self, x: &amp;u32) -&gt; &amp;u32 {
   |            -----              ---- has type `&amp;u32`
   |            |
   |            has type `&amp;Test`
18 |         let x = 22;
19 |         &amp;x
   |         ^^ `x` would have to be valid for `XXX`
20 |     }
   |     - but `x` dropped here while still borrowed

error[E0597]: `x` does not live long enough
  --&gt; src/test/ui/nll/issue-52534-1.rs:25:5
   |
23 | fn foo(x: &amp;u32) -&gt; &amp;u32 {
   |           ----     ---- has type `&amp;u32`
   |           |
   |           has type `&amp;u32`
24 |     let x = 22;
25 |     &amp;x
   |     ^^ `x` would have to be valid for `XXX`
26 | }
   | - but `x` dropped here while still borrowed

error: aborting due to 2 previous errors

For more information about this error, try `rustc --explain E0597`.
</pre></div>


<p>and</p>
<div class="codehilite"><pre><span></span>error[E0597]: `x` does not live long enough
  --&gt; src/test/ui/nll/issue-52534.rs:19:14
   |
19 |     foo(|a| &amp;x)
   |           -  ^ `x` would have to be valid for `XXX`
   |           |
   |           has type `&amp;u32`
20 | }
   | - but `x` dropped here while still borrowed

error: aborting due to previous error

For more information about this error, try `rustc --explain E0597`.
</pre></div>



<a name="133953322"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2352534%20explain%20valid%20for%20static/near/133953322" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> davidtwco <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2352534.20explain.20valid.20for.20static.html#133953322">(Sep 14 2018 at 13:49)</a>:</h4>
<p>Other than the closure argument span off-by-one, the errors are now what I wanted them to be: submitted <a href="https://github.com/rust-lang/rust/issues/54229" target="_blank" title="https://github.com/rust-lang/rust/issues/54229">#54229</a>.</p>



<a name="133953489"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2352534%20explain%20valid%20for%20static/near/133953489" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> lqd <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2352534.20explain.20valid.20for.20static.html#133953489">(Sep 14 2018 at 13:51)</a>:</h4>
<p>nice!</p>



<a name="133953742"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2352534%20explain%20valid%20for%20static/near/133953742" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> lqd <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2352534.20explain.20valid.20for.20static.html#133953742">(Sep 14 2018 at 13:54)</a>:</h4>
<p>I hadn't seen cases with <code>'0</code> before</p>



<a name="133953948"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2352534%20explain%20valid%20for%20static/near/133953948" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> davidtwco <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2352534.20explain.20valid.20for.20static.html#133953948">(Sep 14 2018 at 13:57)</a>:</h4>
<p>We do that with the region inference errors, we're trying it here with these errors to see if it is easier to understand.</p>



<a name="133953993"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2352534%20explain%20valid%20for%20static/near/133953993" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> davidtwco <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2352534.20explain.20valid.20for.20static.html#133953993">(Sep 14 2018 at 13:58)</a>:</h4>
<p>Since <code>'0</code> isn't a valid lifetime that users can do.</p>



<a name="133954076"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2352534%20explain%20valid%20for%20static/near/133954076" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> pnkfelix <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2352534.20explain.20valid.20for.20static.html#133954076">(Sep 14 2018 at 13:59)</a>:</h4>
<p><span class="user-mention" data-user-id="116113">@lqd</span> did you mean <code>'0</code> is new, compared to e.g. <code>'a</code>? Or that <code>'0</code> is new compared to e.g <code>'1</code>, <code>'2</code> etc</p>



<a name="133954078"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2352534%20explain%20valid%20for%20static/near/133954078" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> pnkfelix <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2352534.20explain.20valid.20for.20static.html#133954078">(Sep 14 2018 at 13:59)</a>:</h4>
<p>?</p>



<a name="133954090"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2352534%20explain%20valid%20for%20static/near/133954090" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> lqd <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2352534.20explain.20valid.20for.20static.html#133954090">(Sep 14 2018 at 13:59)</a>:</h4>
<p><span class="user-mention" data-user-id="116107">@davidtwco</span> yeah, interesting</p>



<a name="133954184"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2352534%20explain%20valid%20for%20static/near/133954184" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> lqd <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2352534.20explain.20valid.20for.20static.html#133954184">(Sep 14 2018 at 14:00)</a>:</h4>
<p><span class="user-mention" data-user-id="116083">@pnkfelix</span> the '0 in the diffs of these different error messages, compared to '1 and so on yes</p>



<a name="133954208"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2352534%20explain%20valid%20for%20static/near/133954208" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> pnkfelix <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2352534.20explain.20valid.20for.20static.html#133954208">(Sep 14 2018 at 14:00)</a>:</h4>
<p>just checking, okay</p>



<a name="133954216"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2352534%20explain%20valid%20for%20static/near/133954216" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jake Goulding <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2352534.20explain.20valid.20for.20static.html#133954216">(Sep 14 2018 at 14:00)</a>:</h4>
<p>Where's <code>'-1</code> / <code>'USIZE_MAX</code> <span class="emoji emoji-1f609" title="wink">:wink:</span></p>



<a name="133954218"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2352534%20explain%20valid%20for%20static/near/133954218" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> lqd <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2352534.20explain.20valid.20for.20static.html#133954218">(Sep 14 2018 at 14:00)</a>:</h4>
<p>new to me ofc :)</p>



<a name="133954390"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2352534%20explain%20valid%20for%20static/near/133954390" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> pnkfelix <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2352534.20explain.20valid.20for.20static.html#133954390">(Sep 14 2018 at 14:03)</a>:</h4>
<p><span class="user-mention" data-user-id="116107">@davidtwco</span> do you have any tests that spit out both <code>'0</code> and <code>'1</code>, etc? I see that the code references some sort of counter in its generation of the message?</p>



<a name="133954406"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2352534%20explain%20valid%20for%20static/near/133954406" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> pnkfelix <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2352534.20explain.20valid.20for.20static.html#133954406">(Sep 14 2018 at 14:03)</a>:</h4>
<p>in particular, it would be unfortunate if we happened to reuse the same number for both a free lifetime and for one of the "lets call this lifetime <code>'2</code> ..." messages</p>



<a name="133954418"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2352534%20explain%20valid%20for%20static/near/133954418" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> pnkfelix <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2352534.20explain.20valid.20for.20static.html#133954418">(Sep 14 2018 at 14:03)</a>:</h4>
<p>so it'd be good to have a test demonstrating that this doesn't happen...</p>



<a name="133955246"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2352534%20explain%20valid%20for%20static/near/133955246" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> davidtwco <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2352534.20explain.20valid.20for.20static.html#133955246">(Sep 14 2018 at 14:15)</a>:</h4>
<p><span class="user-mention" data-user-id="116083">@pnkfelix</span> I've been unable to think of an example where that would happen. Given we only ever highlight the first argument and the return type, it'll only ever be both <code>'0</code>; or <code>'0</code> and <code>'1</code>. </p>
<p>I can't think of a example where I'm not explicitly naming lifetimes (since it'd spit out those names) and have the lifetime of the first argument and the return type be different (such that one would be <code>'0</code> and one would be <code>'1</code>) - since the elision rules (as I understand it) would make them the same?</p>



<a name="133955334"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2352534%20explain%20valid%20for%20static/near/133955334" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> pnkfelix <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2352534.20explain.20valid.20for.20static.html#133955334">(Sep 14 2018 at 14:16)</a>:</h4>
<p>so you're figuring that in fact it'll only ever be <code>'0</code> ?</p>



<a name="133955353"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2352534%20explain%20valid%20for%20static/near/133955353" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> pnkfelix <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2352534.20explain.20valid.20for.20static.html#133955353">(Sep 14 2018 at 14:16)</a>:</h4>
<p>I don't have a problem with that, though ... we may want to .... assert it.? (!?)</p>



<a name="133955354"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2352534%20explain%20valid%20for%20static/near/133955354" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> davidtwco <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2352534.20explain.20valid.20for.20static.html#133955354">(Sep 14 2018 at 14:16)</a>:</h4>
<p>I think so. Perhaps if there are multiple references in the return type? a tuple of two references? But in that case we won't highlight it with this logic since it explicitly looks for a top-level <code>TyKind::Ref</code>.</p>



<a name="133955389"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2352534%20explain%20valid%20for%20static/near/133955389" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> pnkfelix <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2352534.20explain.20valid.20for.20static.html#133955389">(Sep 14 2018 at 14:17)</a>:</h4>
<p>/me wonders about the trade-offs/risks about an assert firing (and causing an ICE) vs a "name" collision making for a bad diagnostic...</p>



<a name="133955457"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2352534%20explain%20valid%20for%20static/near/133955457" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> davidtwco <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2352534.20explain.20valid.20for.20static.html#133955457">(Sep 14 2018 at 14:18)</a>:</h4>
<p>I guess a reference to a reference might do it.</p>



<a name="133955480"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2352534%20explain%20valid%20for%20static/near/133955480" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> davidtwco <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2352534.20explain.20valid.20for.20static.html#133955480">(Sep 14 2018 at 14:18)</a>:</h4>
<p>In that case though, I'd expect we only add a <code>'0</code> to the outermost reference and then the inner one would have <code>&amp;type</code> without a name.</p>



<a name="133955875"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2352534%20explain%20valid%20for%20static/near/133955875" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> davidtwco <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2352534.20explain.20valid.20for.20static.html#133955875">(Sep 14 2018 at 14:24)</a>:</h4>
<p>So it kind of breaks a little with a reference-to-a-reference as the return type:</p>
<div class="codehilite"><pre><span></span>error[E0597]: `x` does not live long enough
  --&gt; src/test/ui/nll/issue-52534-1.rs:30:6
   |
28 | fn baz(x: &amp;u32) -&gt; &amp;&amp;u32 {
   |           ----     ----- also has type `&amp;&#39;0 u32`
   |           |
   |           has type `&amp;&#39;0 u32`
29 |     let x = 22;
30 |     &amp;&amp;x
   |      ^^ `x` would have to be valid for `&#39;0`
31 | }
| - but `x` dropped here while still borrowed
</pre></div>



<a name="133955882"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2352534%20explain%20valid%20for%20static/near/133955882" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> davidtwco <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2352534.20explain.20valid.20for.20static.html#133955882">(Sep 14 2018 at 14:24)</a>:</h4>
<p>Not really sure why though.</p>



<a name="133956027"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2352534%20explain%20valid%20for%20static/near/133956027" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> davidtwco <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2352534.20explain.20valid.20for.20static.html#133956027">(Sep 14 2018 at 14:26)</a>:</h4>
<p>Oh, I know why.</p>



<a name="133956528"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2352534%20explain%20valid%20for%20static/near/133956528" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2352534.20explain.20valid.20for.20static.html#133956528">(Sep 14 2018 at 14:32)</a>:</h4>
<p><span class="user-mention" data-user-id="116107">@davidtwco</span> that is looking pretty good, did you push latest commits?</p>



<a name="133956535"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2352534%20explain%20valid%20for%20static/near/133956535" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> davidtwco <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2352534.20explain.20valid.20for.20static.html#133956535">(Sep 14 2018 at 14:33)</a>:</h4>
<p>There's a PR linked above.</p>



<a name="133956550"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2352534%20explain%20valid%20for%20static/near/133956550" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> davidtwco <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2352534.20explain.20valid.20for.20static.html#133956550">(Sep 14 2018 at 14:33)</a>:</h4>
<p>Managed to do it without modifying <code>Locations</code> at all.</p>



<a name="133956578"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2352534%20explain%20valid%20for%20static/near/133956578" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> davidtwco <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2352534.20explain.20valid.20for.20static.html#133956578">(Sep 14 2018 at 14:33)</a>:</h4>
<p>Was able to get ahold of the <code>rustc::ty</code> types which had the closure signature whereas the <code>rustc::hir</code> types that I was trying before only had a <code>TyKind::Infer</code> for them.</p>



<a name="133956662"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2352534%20explain%20valid%20for%20static/near/133956662" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> davidtwco <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2352534.20explain.20valid.20for.20static.html#133956662">(Sep 14 2018 at 14:34)</a>:</h4>
<p>Fixing the case I found above just now, just building what should be the fix.</p>



<a name="133957120"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2352534%20explain%20valid%20for%20static/near/133957120" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2352534.20explain.20valid.20for.20static.html#133957120">(Sep 14 2018 at 14:41)</a>:</h4>
<p>yeah just caught up</p>



<a name="133957161"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2352534%20explain%20valid%20for%20static/near/133957161" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2352534.20explain.20valid.20for.20static.html#133957161">(Sep 14 2018 at 14:42)</a>:</h4>
<p>I'll take a look!</p>



<a name="133957166"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2352534%20explain%20valid%20for%20static/near/133957166" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2352534.20explain.20valid.20for.20static.html#133957166">(Sep 14 2018 at 14:42)</a>:</h4>
<p>are you looking now for something else to do? :)</p>



<a name="133957241"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2352534%20explain%20valid%20for%20static/near/133957241" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> davidtwco <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2352534.20explain.20valid.20for.20static.html#133957241">(Sep 14 2018 at 14:43)</a>:</h4>
<p>I guess so yeah. Do we want to tackle the slightly-off span for closures we're seeing in this PR now or is that another issue?</p>



<a name="133957312"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2352534%20explain%20valid%20for%20static/near/133957312" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2352534.20explain.20valid.20for.20static.html#133957312">(Sep 14 2018 at 14:44)</a>:</h4>
<p>we'll probably want to do some changes</p>



<a name="133957317"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2352534%20explain%20valid%20for%20static/near/133957317" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2352534.20explain.20valid.20for.20static.html#133957317">(Sep 14 2018 at 14:44)</a>:</h4>
<p>but I'm not sure yet</p>



<a name="133957321"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2352534%20explain%20valid%20for%20static/near/133957321" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2352534.20explain.20valid.20for.20static.html#133957321">(Sep 14 2018 at 14:44)</a>:</h4>
<p>I probably won't review until the afternoon</p>



<a name="133957328"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2352534%20explain%20valid%20for%20static/near/133957328" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> davidtwco <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2352534.20explain.20valid.20for.20static.html#133957328">(Sep 14 2018 at 14:44)</a>:</h4>
<p>That's fair. Gives me some time where I'm not look at these error messages.</p>



<a name="133957373"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2352534%20explain%20valid%20for%20static/near/133957373" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2352534.20explain.20valid.20for.20static.html#133957373">(Sep 14 2018 at 14:45)</a>:</h4>
<p>I guess most of the issues are assigned</p>



<a name="133957379"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2352534%20explain%20valid%20for%20static/near/133957379" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2352534.20explain.20valid.20for.20static.html#133957379">(Sep 14 2018 at 14:45)</a>:</h4>
<p>for NLL anyway</p>



<a name="133957896"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2352534%20explain%20valid%20for%20static/near/133957896" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> davidtwco <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2352534.20explain.20valid.20for.20static.html#133957896">(Sep 14 2018 at 14:52)</a>:</h4>
<p>Alright, pushed a fix for the case above.</p>



<a name="134177344"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2352534%20explain%20valid%20for%20static/near/134177344" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2352534.20explain.20valid.20for.20static.html#134177344">(Sep 18 2018 at 16:38)</a>:</h4>
<p><span class="user-mention" data-user-id="116107">@davidtwco</span> left some nits...</p>



<a name="134177611"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2352534%20explain%20valid%20for%20static/near/134177611" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2352534.20explain.20valid.20for.20static.html#134177611">(Sep 18 2018 at 16:42)</a>:</h4>
<p>actually I'm stll a bit confused about <a href="https://github.com/rust-lang/rust/pull/54229#discussion_r218503672" target="_blank" title="https://github.com/rust-lang/rust/pull/54229#discussion_r218503672">this bit</a></p>



<a name="134178409"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2352534%20explain%20valid%20for%20static/near/134178409" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> davidtwco <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2352534.20explain.20valid.20for.20static.html#134178409">(Sep 18 2018 at 16:54)</a>:</h4>
<p>Will take a look now.</p>



<a name="134187680"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2352534%20explain%20valid%20for%20static/near/134187680" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> davidtwco <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2352534.20explain.20valid.20for.20static.html#134187680">(Sep 18 2018 at 19:33)</a>:</h4>
<p><span class="user-mention" data-user-id="116009">@nikomatsakis</span> "nits" - I've updated most of the logic to now correctly handle named lifetimes too.</p>



<a name="134187746"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2352534%20explain%20valid%20for%20static/near/134187746" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2352534.20explain.20valid.20for.20static.html#134187746">(Sep 18 2018 at 19:34)</a>:</h4>
<p><span class="user-mention" data-user-id="116107">@davidtwco</span> ok</p>



<a name="134187748"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2352534%20explain%20valid%20for%20static/near/134187748" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> davidtwco <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2352534.20explain.20valid.20for.20static.html#134187748">(Sep 18 2018 at 19:34)</a>:</h4>
<p>(I've resolved some of your comments, the ones that are just listed as outdated are still relevant I think)</p>



<a name="134192881"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2352534%20explain%20valid%20for%20static/near/134192881" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2352534.20explain.20valid.20for.20static.html#134192881">(Sep 18 2018 at 21:00)</a>:</h4>
<p><span class="user-mention" data-user-id="116107">@davidtwco</span> so something i'm puzzling out</p>



<a name="134192890"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2352534%20explain%20valid%20for%20static/near/134192890" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2352534.20explain.20valid.20for.20static.html#134192890">(Sep 18 2018 at 21:00)</a>:</h4>
<p>in your PR</p>



<a name="134192931"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2352534%20explain%20valid%20for%20static/near/134192931" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2352534.20explain.20valid.20for.20static.html#134192931">(Sep 18 2018 at 21:01)</a>:</h4>
<p>the <code>annotate_argument_and_return_for_borrow</code> doesn't really know what region it's looking for, right?</p>



<a name="134192939"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2352534%20explain%20valid%20for%20static/near/134192939" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2352534.20explain.20valid.20for.20static.html#134192939">(Sep 18 2018 at 21:01)</a>:</h4>
<p>that is, it's just kind of assuming that regions in the return type are relevant?</p>



<a name="134192945"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2352534%20explain%20valid%20for%20static/near/134192945" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2352534.20explain.20valid.20for.20static.html#134192945">(Sep 18 2018 at 21:01)</a>:</h4>
<p>I'm wondering if this is always true</p>



<a name="134193053"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2352534%20explain%20valid%20for%20static/near/134193053" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> davidtwco <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2352534.20explain.20valid.20for.20static.html#134193053">(Sep 18 2018 at 21:03)</a>:</h4>
<blockquote>
<p>that is, it's just kind of assuming that regions in the return type are relevant?</p>
</blockquote>
<p>This is correct.</p>



<a name="134193266"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2352534%20explain%20valid%20for%20static/near/134193266" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2352534.20explain.20valid.20for.20static.html#134193266">(Sep 18 2018 at 21:07)</a>:</h4>
<p><span class="user-mention" data-user-id="116107">@davidtwco</span> does that error path trigger for this sort of code?</p>
<div class="codehilite"><pre><span></span><span class="cp">#![feature(nll)]</span><span class="w"></span>

<span class="k">fn</span> <span class="nf">main</span><span class="p">()</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="n">y</span><span class="p">;</span><span class="w"></span>

<span class="w">    </span><span class="p">{</span><span class="w"></span>
<span class="w">        </span><span class="kd">let</span><span class="w"> </span><span class="n">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">22</span><span class="p">;</span><span class="w"></span>
<span class="w">        </span><span class="n">y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">&amp;</span><span class="n">x</span><span class="p">;</span><span class="w"></span>
<span class="w">    </span><span class="p">}</span><span class="w"></span>

<span class="w">    </span><span class="n">println</span><span class="o">!</span><span class="p">(</span><span class="s">&quot;{}&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">y</span><span class="p">);</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>
</pre></div>



<a name="134193275"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2352534%20explain%20valid%20for%20static/near/134193275" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2352534.20explain.20valid.20for.20static.html#134193275">(Sep 18 2018 at 21:07)</a>:</h4>
<p>I currently get</p>
<div class="codehilite"><pre><span></span>error[E0597]: `x` does not live long enough
  --&gt; src/main.rs:8:9
   |
8  |         y = &amp;x;
   |         ^^^^^^ borrowed value does not live long enough
9  |     }
   |     - `x` dropped here while still borrowed
10 |
11 |     println!(&quot;{}&quot;, y);
   |                    - borrow later used here
</pre></div>



<a name="134193335"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2352534%20explain%20valid%20for%20static/near/134193335" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2352534.20explain.20valid.20for.20static.html#134193335">(Sep 18 2018 at 21:08)</a>:</h4>
<p>which looks like it would be generated by <code>report_local_value_does_not_live_long_enough</code></p>



<a name="134193337"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2352534%20explain%20valid%20for%20static/near/134193337" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> davidtwco <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2352534.20explain.20valid.20for.20static.html#134193337">(Sep 18 2018 at 21:08)</a>:</h4>
<p>It wouldn't in that case because there is no return type.</p>



<a name="134193341"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2352534%20explain%20valid%20for%20static/near/134193341" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2352534.20explain.20valid.20for.20static.html#134193341">(Sep 18 2018 at 21:08)</a>:</h4>
<p>yeah but if there were...</p>



<a name="134193345"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2352534%20explain%20valid%20for%20static/near/134193345" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> davidtwco <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2352534.20explain.20valid.20for.20static.html#134193345">(Sep 18 2018 at 21:08)</a>:</h4>
<p>Let me check.</p>



<a name="134193356"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2352534%20explain%20valid%20for%20static/near/134193356" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2352534.20explain.20valid.20for.20static.html#134193356">(Sep 18 2018 at 21:08)</a>:</h4>
<p>e.g.</p>
<div class="codehilite"><pre><span></span><span class="cp">#![feature(nll)]</span><span class="w"></span>

<span class="k">fn</span> <span class="nf">foo</span><span class="p">(</span><span class="n">a</span>: <span class="kp">&amp;</span><span class="kt">u32</span><span class="p">)</span><span class="w"> </span>-&gt; <span class="kp">&amp;</span><span class="kt">u32</span> <span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="n">y</span><span class="p">;</span><span class="w"></span>

<span class="w">    </span><span class="p">{</span><span class="w"></span>
<span class="w">        </span><span class="kd">let</span><span class="w"> </span><span class="n">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">22</span><span class="p">;</span><span class="w"></span>
<span class="w">        </span><span class="n">y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">&amp;</span><span class="n">x</span><span class="p">;</span><span class="w"></span>
<span class="w">    </span><span class="p">}</span><span class="w"></span>

<span class="w">    </span><span class="n">println</span><span class="o">!</span><span class="p">(</span><span class="s">&quot;{}&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">y</span><span class="p">);</span><span class="w"></span>

<span class="w">    </span><span class="n">a</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>

<span class="k">fn</span> <span class="nf">main</span><span class="p">()</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="p">}</span><span class="w"></span>
</pre></div>



<a name="134193394"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2352534%20explain%20valid%20for%20static/near/134193394" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> davidtwco <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2352534.20explain.20valid.20for.20static.html#134193394">(Sep 18 2018 at 21:09)</a>:</h4>
<p>Yeah, that'll break it.</p>



<a name="134193398"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2352534%20explain%20valid%20for%20static/near/134193398" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2352534.20explain.20valid.20for.20static.html#134193398">(Sep 18 2018 at 21:09)</a>:</h4>
<p>ok, I was afraid so</p>



<a name="134193408"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2352534%20explain%20valid%20for%20static/near/134193408" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2352534.20explain.20valid.20for.20static.html#134193408">(Sep 18 2018 at 21:10)</a>:</h4>
<p>I don't know that it'll be so hard to fix, though</p>



<a name="134203226"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2352534%20explain%20valid%20for%20static/near/134203226" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> davidtwco <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2352534.20explain.20valid.20for.20static.html#134203226">(Sep 19 2018 at 00:51)</a>:</h4>
<p><span class="user-mention" data-user-id="116009">@nikomatsakis</span> Fixed that. It wasn't <em>hard</em> per say, but I certainly feel like the code should be simpler than it is.</p>



<a name="134203234"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2352534%20explain%20valid%20for%20static/near/134203234" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> davidtwco <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2352534.20explain.20valid.20for.20static.html#134203234">(Sep 19 2018 at 00:51)</a>:</h4>
<p>I need to sleep now.</p>



<hr><p>Last updated: Apr 12 2022 at 20:01 UTC</p>
</html>