<html>
<head><meta charset="utf-8"><title>#53807 error dedupe · t-compiler/wg-nll · Zulip Chat Archive</title></head>
<h2>Stream: <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/index.html">t-compiler/wg-nll</a></h2>
<h3>Topic: <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353807.20error.20dedupe.html">#53807 error dedupe</a></h3>

<hr>

<base href="https://rust-lang.zulipchat.com">

<head><link href="https://zulip-archive.rust-lang.org/style.css" rel="stylesheet"></head>

<a name="133443852"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353807%20error%20dedupe/near/133443852" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> davidtwco <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353807.20error.20dedupe.html#133443852">(Sep 06 2018 at 13:58)</a>:</h4>
<p>FYI <span class="user-mention" data-user-id="116009">@nikomatsakis</span>. Submitted <a href="https://github.com/rust-lang/rust/issues/53995" target="_blank" title="https://github.com/rust-lang/rust/issues/53995">#53995</a>. Not sure if the approach is fantastic but the result seems to be fairly decent.</p>



<a name="133730807"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353807%20error%20dedupe/near/133730807" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> davidtwco <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353807.20error.20dedupe.html#133730807">(Sep 11 2018 at 13:11)</a>:</h4>
<p><span class="user-mention" data-user-id="116009">@nikomatsakis</span> Do you have any thoughts on the issue reported by kennytm from the merge testing? Wasn't sure whether to <code>r=</code> on it or not.</p>



<a name="133730901"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353807%20error%20dedupe/near/133730901" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353807.20error.20dedupe.html#133730901">(Sep 11 2018 at 13:13)</a>:</h4>
<p>I think <span class="user-mention" data-user-id="125254">@kennytm</span> is probably correct in their analysis</p>



<a name="133730910"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353807%20error%20dedupe/near/133730910" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353807.20error.20dedupe.html#133730910">(Sep 11 2018 at 13:13)</a>:</h4>
<p>I'm not sure <em>why</em> this PR is at fault mind you :P</p>



<a name="133730913"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353807%20error%20dedupe/near/133730913" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353807.20error.20dedupe.html#133730913">(Sep 11 2018 at 13:13)</a>:</h4>
<p>have you tried 32 bit linux by any chance?</p>



<a name="133730922"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353807%20error%20dedupe/near/133730922" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> davidtwco <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353807.20error.20dedupe.html#133730922">(Sep 11 2018 at 13:13)</a>:</h4>
<p>I haven't.</p>



<a name="133730925"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353807%20error%20dedupe/near/133730925" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353807.20error.20dedupe.html#133730925">(Sep 11 2018 at 13:13)</a>:</h4>
<p>often these things are due to use of a <code>FxHashMap</code> or something</p>



<a name="133730931"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353807%20error%20dedupe/near/133730931" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353807.20error.20dedupe.html#133730931">(Sep 11 2018 at 13:13)</a>:</h4>
<p>though I'm not sure why that would be the case</p>



<a name="133730936"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353807%20error%20dedupe/near/133730936" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353807.20error.20dedupe.html#133730936">(Sep 11 2018 at 13:13)</a>:</h4>
<p>(maybe it differs per platform?)</p>



<a name="133730938"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353807%20error%20dedupe/near/133730938" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> davidtwco <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353807.20error.20dedupe.html#133730938">(Sep 11 2018 at 13:13)</a>:</h4>
<p>It does use a <code>FxHashMap</code>.</p>



<a name="133730943"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353807%20error%20dedupe/near/133730943" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353807.20error.20dedupe.html#133730943">(Sep 11 2018 at 13:13)</a>:</h4>
<p>in particular iterating over such a hashmap</p>



<a name="133730990"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353807%20error%20dedupe/near/133730990" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353807.20error.20dedupe.html#133730990">(Sep 11 2018 at 13:14)</a>:</h4>
<p>let me look over the PR again</p>



<a name="133731020"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353807%20error%20dedupe/near/133731020" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> davidtwco <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353807.20error.20dedupe.html#133731020">(Sep 11 2018 at 13:14)</a>:</h4>
<p>Well, we iterate over the hashmap. But the map contains one error per the move out indices which are then buffered and sorted as before when the buffered errors are emitted.</p>



<a name="133731124"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353807%20error%20dedupe/near/133731124" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> pnkfelix <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353807.20error.20dedupe.html#133731124">(Sep 11 2018 at 13:16)</a>:</h4>
<p>but the sort may not be total?</p>



<a name="133731131"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353807%20error%20dedupe/near/133731131" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> pnkfelix <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353807.20error.20dedupe.html#133731131">(Sep 11 2018 at 13:16)</a>:</h4>
<p>(or rather, the order used in the sort might not be total)</p>



<a name="133731351"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353807%20error%20dedupe/near/133731351" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353807.20error.20dedupe.html#133731351">(Sep 11 2018 at 13:20)</a>:</h4>
<p>so we do sort the errors?</p>



<a name="133731356"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353807%20error%20dedupe/near/133731356" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353807.20error.20dedupe.html#133731356">(Sep 11 2018 at 13:20)</a>:</h4>
<p>that are buffered?</p>



<a name="133731357"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353807%20error%20dedupe/near/133731357" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353807.20error.20dedupe.html#133731357">(Sep 11 2018 at 13:20)</a>:</h4>
<p>(I couldn't remember)</p>



<a name="133731367"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353807%20error%20dedupe/near/133731367" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> pnkfelix <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353807.20error.20dedupe.html#133731367">(Sep 11 2018 at 13:21)</a>:</h4>
<p>I thought we did. By line number at least</p>



<a name="133731376"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353807%20error%20dedupe/near/133731376" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> pnkfelix <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353807.20error.20dedupe.html#133731376">(Sep 11 2018 at 13:21)</a>:</h4>
<p>which of course is not a total order</p>



<a name="133731380"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353807%20error%20dedupe/near/133731380" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353807.20error.20dedupe.html#133731380">(Sep 11 2018 at 13:21)</a>:</h4>
<p><span class="user-mention" data-user-id="116107">@davidtwco</span> how do we pick which error to keep? I guess we ought to be producing the errors in the same order</p>



<a name="133731388"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353807%20error%20dedupe/near/133731388" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> pnkfelix <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353807.20error.20dedupe.html#133731388">(Sep 11 2018 at 13:21)</a>:</h4>
<p>but is enough of an order to probably fool most tests</p>



<a name="133732036"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353807%20error%20dedupe/near/133732036" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> davidtwco <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353807.20error.20dedupe.html#133732036">(Sep 11 2018 at 13:31)</a>:</h4>
<p><span class="user-mention" data-user-id="116009">@nikomatsakis</span>  In the order that errors were buffered previously, we check whether or not to keep them based on the last error we saw (in particular, whether the last error is a prefix of the current one), if we opt to keep it, we replace it in the hashmap (against the move out indices), then, before errors are emited, we iterate over the hashmap, adding each error to the error buffer. The error buffer code, as it always has, sorts by primary span.</p>



<a name="133732061"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353807%20error%20dedupe/near/133732061" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353807.20error.20dedupe.html#133732061">(Sep 11 2018 at 13:31)</a>:</h4>
<p><span class="user-mention" data-user-id="116107">@davidtwco</span> you might try a <code>BTreeMap</code> instead of a <code>FxHashMap</code></p>



<a name="133732111"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353807%20error%20dedupe/near/133732111" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353807.20error.20dedupe.html#133732111">(Sep 11 2018 at 13:32)</a>:</h4>
<p>for catching the duplicates</p>



<a name="133732129"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353807%20error%20dedupe/near/133732129" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> davidtwco <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353807.20error.20dedupe.html#133732129">(Sep 11 2018 at 13:32)</a>:</h4>
<p>I don't know how to test it as I can't reproduce a different order.</p>



<a name="133732130"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353807%20error%20dedupe/near/133732130" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353807.20error.20dedupe.html#133732130">(Sep 11 2018 at 13:32)</a>:</h4>
<p>alternatively, you could do some local experiments:</p>



<a name="133732134"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353807%20error%20dedupe/near/133732134" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353807.20error.20dedupe.html#133732134">(Sep 11 2018 at 13:32)</a>:</h4>
<p>e.g., store the hashmap into a vector</p>



<a name="133732138"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353807%20error%20dedupe/near/133732138" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353807.20error.20dedupe.html#133732138">(Sep 11 2018 at 13:32)</a>:</h4>
<p>sort it randomly</p>



<a name="133732148"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353807%20error%20dedupe/near/133732148" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353807.20error.20dedupe.html#133732148">(Sep 11 2018 at 13:32)</a>:</h4>
<p>and see if it affects your local output order :)</p>



<a name="133732207"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353807%20error%20dedupe/near/133732207" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> pnkfelix <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353807.20error.20dedupe.html#133732207">(Sep 11 2018 at 13:33)</a>:</h4>
<p>let me see if the sort is obviously non-total (and "obviously" should have been total)</p>



<a name="133732267"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353807%20error%20dedupe/near/133732267" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> pnkfelix <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353807.20error.20dedupe.html#133732267">(Sep 11 2018 at 13:34)</a>:</h4>
<p>Yeah, this is suspect: <code>mbcx.errors_buffer.sort_by_key(|diag| diag.span.primary_span())</code></p>



<a name="133732278"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353807%20error%20dedupe/near/133732278" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> davidtwco <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353807.20error.20dedupe.html#133732278">(Sep 11 2018 at 13:34)</a>:</h4>
<p>Both errors have the same primary span. So the sort of buffered errors doesn't make a difference in this case.</p>



<a name="133732327"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353807%20error%20dedupe/near/133732327" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> davidtwco <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353807.20error.20dedupe.html#133732327">(Sep 11 2018 at 13:35)</a>:</h4>
<p>What was previously insertion order into the buffer is now the same insertion order as into the map (when they are inserted). So the only point where it can happen is when the map is iterated over to re-add into buffer. I think a <code>BTreeMap</code>'ll do it.</p>



<a name="133732416"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353807%20error%20dedupe/near/133732416" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353807.20error.20dedupe.html#133732416">(Sep 11 2018 at 13:36)</a>:</h4>
<p>another alterantive is to keep a vector</p>



<a name="133732425"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353807%20error%20dedupe/near/133732425" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353807.20error.20dedupe.html#133732425">(Sep 11 2018 at 13:36)</a>:</h4>
<p>that sort of stores the "canonical order"</p>



<a name="133732428"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353807%20error%20dedupe/near/133732428" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353807.20error.20dedupe.html#133732428">(Sep 11 2018 at 13:36)</a>:</h4>
<p>or something</p>



<a name="133732429"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353807%20error%20dedupe/near/133732429" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353807.20error.20dedupe.html#133732429">(Sep 11 2018 at 13:36)</a>:</h4>
<p>anyway, I'm sure it's this somehow</p>



<a name="133732482"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353807%20error%20dedupe/near/133732482" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> davidtwco <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353807.20error.20dedupe.html#133732482">(Sep 11 2018 at 13:37)</a>:</h4>
<p>Yeah, thinking about it with a fresh perspective, it makes sense.</p>



<a name="133734417"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353807%20error%20dedupe/near/133734417" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> davidtwco <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353807.20error.20dedupe.html#133734417">(Sep 11 2018 at 14:03)</a>:</h4>
<p>Pushed a commit for this.</p>



<a name="133734713"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353807%20error%20dedupe/near/133734713" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353807.20error.20dedupe.html#133734713">(Sep 11 2018 at 14:07)</a>:</h4>
<p><span class="user-mention" data-user-id="116107">@davidtwco</span> were you able to observe whether it made a difference locally to alter the "buffer order"?</p>



<a name="133735174"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353807%20error%20dedupe/near/133735174" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> davidtwco <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353807.20error.20dedupe.html#133735174">(Sep 11 2018 at 14:14)</a>:</h4>
<p><span class="user-mention" data-user-id="116009">@nikomatsakis</span> The test that failed that one time changed the output order.</p>



<a name="133735189"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353807%20error%20dedupe/near/133735189" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353807.20error.20dedupe.html#133735189">(Sep 11 2018 at 14:14)</a>:</h4>
<p>cool</p>



<a name="133735203"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353807%20error%20dedupe/near/133735203" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353807.20error.20dedupe.html#133735203">(Sep 11 2018 at 14:14)</a>:</h4>
<p>usually I solve these things by a judicious change from <code>FxHashMap</code> to <code>BTreeMap</code></p>



<a name="133735208"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353807%20error%20dedupe/near/133735208" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353807.20error.20dedupe.html#133735208">(Sep 11 2018 at 14:14)</a>:</h4>
<p>I wish there were a more automatic way to figure it out</p>



<a name="133735217"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353807%20error%20dedupe/near/133735217" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353807.20error.20dedupe.html#133735217">(Sep 11 2018 at 14:15)</a>:</h4>
<p>I would <em>almost</em> say I wish that <code>FxHashMap</code> didn't expose an iterator at all</p>



<a name="133735238"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353807%20error%20dedupe/near/133735238" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353807.20error.20dedupe.html#133735238">(Sep 11 2018 at 14:15)</a>:</h4>
<p>probably what would be better is just if <code>FxHashMap</code> would preserve insertion order</p>



<a name="133735239"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353807%20error%20dedupe/near/133735239" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353807.20error.20dedupe.html#133735239">(Sep 11 2018 at 14:15)</a>:</h4>
<p>oh well</p>



<a name="133735240"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353807%20error%20dedupe/near/133735240" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> davidtwco <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353807.20error.20dedupe.html#133735240">(Sep 11 2018 at 14:15)</a>:</h4>
<p>I just realised I didn't run all the tests, just that one. Let me double check the rest.</p>



<a name="133735806"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353807%20error%20dedupe/near/133735806" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> davidtwco <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353807.20error.20dedupe.html#133735806">(Sep 11 2018 at 14:22)</a>:</h4>
<p>Alright, I've confirmed they all pass.</p>



<a name="133735946"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353807%20error%20dedupe/near/133735946" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353807.20error.20dedupe.html#133735946">(Sep 11 2018 at 14:24)</a>:</h4>
<p>nice</p>



<a name="133735994"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353807%20error%20dedupe/near/133735994" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353807.20error.20dedupe.html#133735994">(Sep 11 2018 at 14:25)</a>:</h4>
<p>left a quick review</p>



<a name="133736216"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353807%20error%20dedupe/near/133736216" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> davidtwco <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353807.20error.20dedupe.html#133736216">(Sep 11 2018 at 14:28)</a>:</h4>
<p>Oops, forgot about that. Fixed.</p>



<hr><p>Last updated: Apr 12 2022 at 20:01 UTC</p>
</html>