<html>
<head><meta charset="utf-8"><title>#53488 closure and disjoint fields · t-compiler/wg-nll · Zulip Chat Archive</title></head>
<h2>Stream: <a href="https://rust-lang.github.io/zulip_archive/stream/122657-t-compiler/wg-nll/index.html">t-compiler/wg-nll</a></h2>
<h3>Topic: <a href="https://rust-lang.github.io/zulip_archive/stream/122657-t-compiler/wg-nll/topic/.2353488.20closure.20and.20disjoint.20fields.html">#53488 closure and disjoint fields</a></h3>

<hr>

<base href="https://rust-lang.zulipchat.com">

<head><link href="https://rust-lang.github.io/zulip_archive/style.css" rel="stylesheet"></head>

<a name="136721466"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353488%20closure%20and%20disjoint%20fields/near/136721466" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://rust-lang.github.io/zulip_archive/stream/122657-t-compiler/wg-nll/topic/.2353488.20closure.20and.20disjoint.20fields.html#136721466">(Oct 29 2018 at 17:27)</a>:</h4>
<p>So <span class="user-mention" data-user-id="128294">@blitzerr</span> regarding <a href="https://github.com/rust-lang/rust/issues/53488" target="_blank" title="https://github.com/rust-lang/rust/issues/53488">#53488</a>, I think maybe the first thing to do is to spend a bit of time looking at how "upvar inference" and closure desugaring works now. Actually, I wonder if you'd be interested in trying to write up some material in the rustc-guide about it? What I can imagine is: you + me do a video call to talk it over (which we can record and post) and you try to distill some of that into a chapter, which we can then edit together. Thoughts? (Feel free to say no if you don't feel comfortable writing -- the video call may be a good idea regardless)</p>



<a name="136721742"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353488%20closure%20and%20disjoint%20fields/near/136721742" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> blitzerr <a href="https://rust-lang.github.io/zulip_archive/stream/122657-t-compiler/wg-nll/topic/.2353488.20closure.20and.20disjoint.20fields.html#136721742">(Oct 29 2018 at 17:31)</a>:</h4>
<p>Absolutely, I will look up the code and pen down my understanding in the rustc guide. <span class="emoji emoji-1f44d" title="+1">:+1:</span></p>



<a name="136721809"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353488%20closure%20and%20disjoint%20fields/near/136721809" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://rust-lang.github.io/zulip_archive/stream/122657-t-compiler/wg-nll/topic/.2353488.20closure.20and.20disjoint.20fields.html#136721809">(Oct 29 2018 at 17:32)</a>:</h4>
<p>Do you want to try and schedule a video call, <span class="user-mention" data-user-id="128294">@blitzerr</span> ?</p>



<a name="136721815"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353488%20closure%20and%20disjoint%20fields/near/136721815" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> blitzerr <a href="https://rust-lang.github.io/zulip_archive/stream/122657-t-compiler/wg-nll/topic/.2353488.20closure.20and.20disjoint.20fields.html#136721815">(Oct 29 2018 at 17:32)</a>:</h4>
<p>Sure, we can definitely do a video call and get started with it.</p>



<a name="136721823"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353488%20closure%20and%20disjoint%20fields/near/136721823" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> blitzerr <a href="https://rust-lang.github.io/zulip_archive/stream/122657-t-compiler/wg-nll/topic/.2353488.20closure.20and.20disjoint.20fields.html#136721823">(Oct 29 2018 at 17:32)</a>:</h4>
<p>Sure, how do I schedule a call?</p>



<a name="136721829"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353488%20closure%20and%20disjoint%20fields/near/136721829" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> blitzerr <a href="https://rust-lang.github.io/zulip_archive/stream/122657-t-compiler/wg-nll/topic/.2353488.20closure.20and.20disjoint.20fields.html#136721829">(Oct 29 2018 at 17:32)</a>:</h4>
<p>Google calendar or something ?</p>



<a name="136721830"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353488%20closure%20and%20disjoint%20fields/near/136721830" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://rust-lang.github.io/zulip_archive/stream/122657-t-compiler/wg-nll/topic/.2353488.20closure.20and.20disjoint.20fields.html#136721830">(Oct 29 2018 at 17:32)</a>:</h4>
<p>I'm not sure what time would work for me this week. I guess the first question is what time zone you are in :)</p>



<a name="136721842"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353488%20closure%20and%20disjoint%20fields/near/136721842" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> blitzerr <a href="https://rust-lang.github.io/zulip_archive/stream/122657-t-compiler/wg-nll/topic/.2353488.20closure.20and.20disjoint.20fields.html#136721842">(Oct 29 2018 at 17:33)</a>:</h4>
<p>Seattle so PST <span class="emoji emoji-1f642" title="slight smile">:slight_smile:</span></p>



<a name="136721847"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353488%20closure%20and%20disjoint%20fields/near/136721847" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://rust-lang.github.io/zulip_archive/stream/122657-t-compiler/wg-nll/topic/.2353488.20closure.20and.20disjoint.20fields.html#136721847">(Oct 29 2018 at 17:33)</a>:</h4>
<p>Ah, ok</p>



<a name="136721853"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353488%20closure%20and%20disjoint%20fields/near/136721853" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> blitzerr <a href="https://rust-lang.github.io/zulip_archive/stream/122657-t-compiler/wg-nll/topic/.2353488.20closure.20and.20disjoint.20fields.html#136721853">(Oct 29 2018 at 17:33)</a>:</h4>
<p>I know you are Boston</p>



<a name="136721857"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353488%20closure%20and%20disjoint%20fields/near/136721857" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://rust-lang.github.io/zulip_archive/stream/122657-t-compiler/wg-nll/topic/.2353488.20closure.20and.20disjoint.20fields.html#136721857">(Oct 29 2018 at 17:33)</a>:</h4>
<p>let me check my calendar and send you a privmsg I guess</p>



<a name="136721864"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353488%20closure%20and%20disjoint%20fields/near/136721864" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> blitzerr <a href="https://rust-lang.github.io/zulip_archive/stream/122657-t-compiler/wg-nll/topic/.2353488.20closure.20and.20disjoint.20fields.html#136721864">(Oct 29 2018 at 17:33)</a>:</h4>
<p>sure</p>



<a name="136793677"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353488%20closure%20and%20disjoint%20fields/near/136793677" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://rust-lang.github.io/zulip_archive/stream/122657-t-compiler/wg-nll/topic/.2353488.20closure.20and.20disjoint.20fields.html#136793677">(Oct 30 2018 at 17:46)</a>:</h4>
<p>in case you are curious, <span class="user-mention" data-user-id="128294">@blitzerr</span> and I did a "pair programming" session discussing how upvar analysis works for closures; you can <a href="https://www.youtube.com/watch?v=fMopdkn5-Xw&amp;index=6&amp;t=1988s&amp;list=PLCQVvhKUrTN9VfaQx2AyOSAstwENaGkYA" target="_blank" title="https://www.youtube.com/watch?v=fMopdkn5-Xw&amp;index=6&amp;t=1988s&amp;list=PLCQVvhKUrTN9VfaQx2AyOSAstwENaGkYA">watch it here</a></p>
<div class="youtube-video message_inline_image"><a data-id="fMopdkn5-Xw" href="https://www.youtube.com/watch?v=fMopdkn5-Xw&amp;index=6&amp;t=1988s&amp;list=PLCQVvhKUrTN9VfaQx2AyOSAstwENaGkYA" target="_blank" title="https://www.youtube.com/watch?v=fMopdkn5-Xw&amp;index=6&amp;t=1988s&amp;list=PLCQVvhKUrTN9VfaQx2AyOSAstwENaGkYA"><img src="https://i.ytimg.com/vi/fMopdkn5-Xw/default.jpg"></a></div>



<a name="136797786"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353488%20closure%20and%20disjoint%20fields/near/136797786" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jake Goulding <a href="https://rust-lang.github.io/zulip_archive/stream/122657-t-compiler/wg-nll/topic/.2353488.20closure.20and.20disjoint.20fields.html#136797786">(Oct 30 2018 at 18:45)</a>:</h4>
<p>I want there to be an "upvar" joke equivalent to "updog"</p>



<a name="137053097"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353488%20closure%20and%20disjoint%20fields/near/137053097" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> blitzerr <a href="https://rust-lang.github.io/zulip_archive/stream/122657-t-compiler/wg-nll/topic/.2353488.20closure.20and.20disjoint.20fields.html#137053097">(Nov 02 2018 at 15:30)</a>:</h4>
<p><span class="user-mention" data-user-id="116009">@nikomatsakis</span> <br>
I posted a PR for rustc guide (just the various modes of closure and their MIR de-sugaring) here<br>
<a href="https://github.com/rust-lang-nursery/rustc-guide/pull/225" target="_blank" title="https://github.com/rust-lang-nursery/rustc-guide/pull/225">https://github.com/rust-lang-nursery/rustc-guide/pull/225</a></p>
<p>The issue is all the de-sugaring looks the same. Everywhere the variable is moved. Should I be looking at a different file ?</p>



<a name="137053491"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353488%20closure%20and%20disjoint%20fields/near/137053491" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> blitzerr <a href="https://rust-lang.github.io/zulip_archive/stream/122657-t-compiler/wg-nll/topic/.2353488.20closure.20and.20disjoint.20fields.html#137053491">(Nov 02 2018 at 15:31)</a>:</h4>
<p>I just put up the PR so that I can start a discussion. I will make it more sane as we go along. <span class="emoji emoji-1f642" title="slight smile">:slight_smile:</span></p>



<a name="137081878"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353488%20closure%20and%20disjoint%20fields/near/137081878" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> blitzerr <a href="https://rust-lang.github.io/zulip_archive/stream/122657-t-compiler/wg-nll/topic/.2353488.20closure.20and.20disjoint.20fields.html#137081878">(Nov 02 2018 at 20:53)</a>:</h4>
<div class="codehilite"><pre><span></span><span class="mf">1.</span><span class="w"></span>
<span class="k">fn</span> <span class="nf">main</span><span class="p">()</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">  </span><span class="kd">let</span><span class="w"> </span><span class="n">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">10</span><span class="p">;</span><span class="w"></span>
<span class="w">  </span><span class="n">foo</span><span class="p">(</span><span class="o">||</span><span class="w"> </span><span class="n">println</span><span class="o">!</span><span class="p">(</span><span class="s">&quot;Hi {}&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">x</span><span class="p">))</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>
<span class="n">_3</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">[</span><span class="n">closure</span><span class="o">@</span><span class="n">test</span><span class="p">.</span><span class="n">rs</span>:<span class="mi">9</span>:<span class="mi">9</span>: <span class="mi">11</span>:<span class="mi">6</span><span class="p">]</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">x</span>: <span class="nc">move</span><span class="w"> </span><span class="n">_4</span><span class="w"> </span><span class="p">};</span><span class="w"></span>

<span class="mf">2.</span><span class="w"></span>
<span class="k">fn</span> <span class="nf">main</span><span class="p">()</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">  </span><span class="kd">let</span><span class="w"> </span><span class="n">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">10</span><span class="p">;</span><span class="w"></span>
<span class="w">  </span><span class="n">foo</span><span class="p">(</span><span class="o">||</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="n">x</span><span class="w"> </span><span class="o">+=</span><span class="w"> </span><span class="mi">1</span><span class="p">;</span><span class="w"></span>
<span class="w">    </span><span class="n">println</span><span class="o">!</span><span class="p">(</span><span class="s">&quot;Hi {}&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">x</span><span class="p">)</span><span class="w"></span>
<span class="w">  </span><span class="p">})</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>
<span class="n">_3</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">[</span><span class="n">closure</span><span class="o">@</span><span class="n">test</span><span class="p">.</span><span class="n">rs</span>:<span class="mi">9</span>:<span class="mi">9</span>: <span class="mi">11</span>:<span class="mi">6</span><span class="p">]</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">x</span>: <span class="nc">move</span><span class="w"> </span><span class="n">_4</span><span class="w"> </span><span class="p">};</span><span class="w"> </span><span class="c1">// bb0[6]: scope 1 at test.rs:9:9: 11:6</span>
</pre></div>


<p>In both the cases, I see that the MIR is exactly the same and the variable is being moved.  I was thinking that in first case it should be an immutable borrow (or whatever the MIR version of it), in the second case it should be a mutable borrow and then in the 3rd case (not shown here but the case of where X is a Vec and the closure calls <code>drop(x)</code>, there it should be a move).</p>



<a name="137081896"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353488%20closure%20and%20disjoint%20fields/near/137081896" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> blitzerr <a href="https://rust-lang.github.io/zulip_archive/stream/122657-t-compiler/wg-nll/topic/.2353488.20closure.20and.20disjoint.20fields.html#137081896">(Nov 02 2018 at 20:53)</a>:</h4>
<p><span class="user-mention" data-user-id="116009">@nikomatsakis</span>  is my understanding incorrect ?</p>



<a name="146917633"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353488%20closure%20and%20disjoint%20fields/near/146917633" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> blitzerr <a href="https://rust-lang.github.io/zulip_archive/stream/122657-t-compiler/wg-nll/topic/.2353488.20closure.20and.20disjoint.20fields.html#146917633">(Nov 07 2018 at 04:36)</a>:</h4>
<p><code>
$ rust-lldb build/x86_64-apple-darwin/stage1/bin/rustc
(lldb) command script import "/Users/blitz/.rustup/toolchains/stable-x86_64-apple-darwin/lib/rustlib/etc/lldb_rust_formatters.py"
(lldb) type summary add --no-value --python-function lldb_rust_formatters.print_val -x ".*" --category Rust
(lldb) type category enable Rust
(lldb) target create "build/x86_64-apple-darwin/stage1/bin/rustc"
Current executable set to 'build/x86_64-apple-darwin/stage1/bin/rustc' (x86_64).
(lldb) b upvar.rs:107
Breakpoint 1: where = librustc_typeck-343623f2c64cba7c.dylib</code>rustc_typeck:<span class="emoji emoji-2705" title="check">:check:</span>:upvar::_$LT$impl$u20$rustc_typeck..check..FnCtxt$LT$$u27$a$C$$u20$$u27$gcx$C$$u20$$u27$tcx$GT$$GT$::analyze_closure::h65ebe12563fafb96 + 225 at upvar.rs:107, address = 0x00000000000f65e1<br>
(lldb) r ../../progs/mut/mut.rs<br>
Process 14184 launched: '/Users/blitz/rustc-dev/rust/build/x86_64-apple-darwin/stage1/bin/rustc' (x86_64)<br>
Process 14184 stopped</p>
<ul>
<li>
<p>thread <a href="https://github.com/rust-lang/rust/issues/2" target="_blank" title="https://github.com/rust-lang/rust/issues/2">#2</a>, stop reason = signal SIGUSR1<br>
    frame <a href="https://github.com/rust-lang/rust/issues/0" target="_blank" title="https://github.com/rust-lang/rust/issues/0">#0</a>: 0x00007fff756cbdf8 libdyld.dylib<code>dyld_stub_binder + 244
libdyld.dylib</code>dyld_stub_binder:<br>
-&gt;  0x7fff756cbdf8 &lt;+244&gt;: addq   $0x8, %r8<br>
    0x7fff756cbdfc &lt;+248&gt;: cmpq   %r8, %r9<br>
    0x7fff756cbdff &lt;+251&gt;: ja     0x7fff756cbdf5            ; &lt;+241&gt;<br>
    0x7fff756cbe01 &lt;+253&gt;: movl   0x32e12b25(%rip), %eax    ; features_lo32<br>
Target 0: (rustc) stopped.<br>
(lldb) bt<br>
error: need to add support for DW_TAG_base_type '()' encoded with DW_ATE = 0x7, bit_size = 0</p>
</li>
<li>
<p>thread <a href="https://github.com/rust-lang/rust/issues/2" target="_blank" title="https://github.com/rust-lang/rust/issues/2">#2</a>, stop reason = signal SIGUSR1</p>
<ul>
<li>frame <a href="https://github.com/rust-lang/rust/issues/0" target="_blank" title="https://github.com/rust-lang/rust/issues/0">#0</a>: 0x00007fff756cbdf8 libdyld.dylib<code>dyld_stub_binder + 244
  frame #1: 0x00000001033bb008 librustc-1c7b4125116510e6.dylib
  frame #2: 0x0000000103198aee librustc-1c7b4125116510e6.dylib</code>_$LT$F$u20$as$u20$alloc..boxed..FnBox$LT$A$GT$$GT$::call_box::h9df08c05f901b603 [inlined] std::panic::catch_unwind::hdd9eeedd8cb255a0 at panic.rs:392 [opt]<br>
  frame <a href="https://github.com/rust-lang/rust/issues/3" target="_blank" title="https://github.com/rust-lang/rust/issues/3">#3</a>: 0x0000000103198a8d librustc-1c7b4125116510e6.dylib<code>_$LT$F$u20$as$u20$alloc..boxed..FnBox$LT$A$GT$$GT$::call_box::h9df08c05f901b603 [inlined] std::thread::Builder::spawn_unchecked::_$u7b$$u7b$closure$u7d$$u7d$::h7d053cb4ec467bbb at mod.rs:476 [opt]
  frame #4: 0x0000000103198a59 librustc-1c7b4125116510e6.dylib</code>_$LT$F$u20$as$u20$alloc..boxed..FnBox$LT$A$GT$$GT$::call_box::h9df08c05f901b603(self=&amp;0x10cee45f0, args=&lt;unavailable&gt;) at boxed.rs:672 [opt]<br>
  frame <a href="https://github.com/rust-lang/rust/issues/5" target="_blank" title="https://github.com/rust-lang/rust/issues/5">#5</a>: 0x00000001052a7d28 libstd-16938f24f5f8fba8.dylib<code>std::sys_common::thread::start_thread::h4664f89b81fe0cd0 [inlined] _$LT$alloc..boxed..Box$LT$$LP$dyn$u20$alloc..boxed..FnBox$LT$A$C$$u20$Output$u3d$R$GT$$u20$$u2b$$u20$$u27$a$RP$$GT$$u20$as$u20$core..ops..function..FnOnce$LT$A$GT$$GT$::call_once::h4317014fdee55c87(self=&lt;unavailable&gt;) at boxed.rs:682 [opt]
  frame #6: 0x00000001052a7d25 libstd-16938f24f5f8fba8.dylib</code>std::sys_common::thread::start_thread::h4664f89b81fe0cd0(main=&amp;0x10cee44f0) at thread.rs:24 [opt]<br>
  frame <a href="https://github.com/rust-lang/rust/issues/7" target="_blank" title="https://github.com/rust-lang/rust/issues/7">#7</a>: 0x00000001052b7cd9 libstd-16938f24f5f8fba8.dylib<code>std::sys::unix::thread::Thread::new::thread_start::h178119c94097229d(main=&lt;unavailable&gt;) at thread.rs:90 [opt]
  frame #8: 0x00007fff758d2339 libsystem_pthread.dylib</code>_pthread_body + 126<br>
  frame <a href="https://github.com/rust-lang/rust/issues/9" target="_blank" title="https://github.com/rust-lang/rust/issues/9">#9</a>: 0x00007fff758d52a7 libsystem_pthread.dylib<code>_pthread_start + 70
  frame #10: 0x00007fff758d1445 libsystem_pthread.dylib</code>thread_start + 13<br>
`</li>
</ul>
</li>
</ul>



<a name="147390046"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353488%20closure%20and%20disjoint%20fields/near/147390046" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> blitzerr <a href="https://rust-lang.github.io/zulip_archive/stream/122657-t-compiler/wg-nll/topic/.2353488.20closure.20and.20disjoint.20fields.html#147390046">(Nov 09 2018 at 18:31)</a>:</h4>
<p>Hi <span class="user-mention" data-user-id="116009">@nikomatsakis</span></p>



<a name="147540594"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353488%20closure%20and%20disjoint%20fields/near/147540594" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://rust-lang.github.io/zulip_archive/stream/122657-t-compiler/wg-nll/topic/.2353488.20closure.20and.20disjoint.20fields.html#147540594">(Nov 12 2018 at 17:51)</a>:</h4>
<p><span class="user-mention" data-user-id="128294">@blitzerr</span> <span class="emoji emoji-1f44b" title="wave">:wave:</span></p>



<a name="147542685"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353488%20closure%20and%20disjoint%20fields/near/147542685" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> blitzerr <a href="https://rust-lang.github.io/zulip_archive/stream/122657-t-compiler/wg-nll/topic/.2353488.20closure.20and.20disjoint.20fields.html#147542685">(Nov 12 2018 at 18:26)</a>:</h4>
<p><span class="user-mention" data-user-id="116009">@nikomatsakis</span>  Welcome back. I read your blog post. Looks like you had a very productive time</p>



<a name="147542727"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353488%20closure%20and%20disjoint%20fields/near/147542727" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> blitzerr <a href="https://rust-lang.github.io/zulip_archive/stream/122657-t-compiler/wg-nll/topic/.2353488.20closure.20and.20disjoint.20fields.html#147542727">(Nov 12 2018 at 18:27)</a>:</h4>
<p>I posted a PR but that's just the first-cut, RustFmt on <a href="http://upvar.rs" target="_blank" title="http://upvar.rs">upvar.rs</a>, before I modify the code as you prefer.</p>



<a name="147543248"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353488%20closure%20and%20disjoint%20fields/near/147543248" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> blitzerr <a href="https://rust-lang.github.io/zulip_archive/stream/122657-t-compiler/wg-nll/topic/.2353488.20closure.20and.20disjoint.20fields.html#147543248">(Nov 12 2018 at 18:35)</a>:</h4>
<div class="codehilite"><pre><span></span><span class="k">pub</span><span class="w"> </span><span class="k">struct</span> <span class="nc">UpvarId</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">     </span><span class="k">pub</span><span class="w"> </span><span class="n">var_id</span>: <span class="nc">hir</span>::<span class="n">HirId</span><span class="p">,</span><span class="w"></span>
<span class="w">     </span><span class="k">pub</span><span class="w"> </span><span class="n">closure_expr_id</span>: <span class="nc">LocalDefId</span><span class="p">,</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>
</pre></div>


<p>I was thinking that instead of wrapping the UpvarId inside another struct, I was thinking how about we wrap <code>pub var_id: hir::HirId</code> inside another called VarPath or something?</p>



<a name="147628630"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353488%20closure%20and%20disjoint%20fields/near/147628630" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> blitzerr <a href="https://rust-lang.github.io/zulip_archive/stream/122657-t-compiler/wg-nll/topic/.2353488.20closure.20and.20disjoint.20fields.html#147628630">(Nov 13 2018 at 21:59)</a>:</h4>
<p><span class="emoji emoji-1f44b" title="wave">:wave:</span> <span class="user-mention" data-user-id="116009">@nikomatsakis</span> <br>
Any inputs ?</p>



<a name="147628705"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353488%20closure%20and%20disjoint%20fields/near/147628705" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://rust-lang.github.io/zulip_archive/stream/122657-t-compiler/wg-nll/topic/.2353488.20closure.20and.20disjoint.20fields.html#147628705">(Nov 13 2018 at 22:00)</a>:</h4>
<p>well, I R+'d your Pr, I think?</p>



<a name="147628717"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353488%20closure%20and%20disjoint%20fields/near/147628717" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://rust-lang.github.io/zulip_archive/stream/122657-t-compiler/wg-nll/topic/.2353488.20closure.20and.20disjoint.20fields.html#147628717">(Nov 13 2018 at 22:00)</a>:</h4>
<p>but on to the next question</p>



<a name="147628724"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353488%20closure%20and%20disjoint%20fields/near/147628724" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://rust-lang.github.io/zulip_archive/stream/122657-t-compiler/wg-nll/topic/.2353488.20closure.20and.20disjoint.20fields.html#147628724">(Nov 13 2018 at 22:00)</a>:</h4>
<p>that sounds reasonable</p>



<a name="147628740"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353488%20closure%20and%20disjoint%20fields/near/147628740" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://rust-lang.github.io/zulip_archive/stream/122657-t-compiler/wg-nll/topic/.2353488.20closure.20and.20disjoint.20fields.html#147628740">(Nov 13 2018 at 22:00)</a>:</h4>
<blockquote>
<p>how about we wrap pub var_id: hir::HirId inside another called VarPath or something</p>
</blockquote>
<p>that in particular</p>



<a name="147721720"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353488%20closure%20and%20disjoint%20fields/near/147721720" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> blitzerr <a href="https://rust-lang.github.io/zulip_archive/stream/122657-t-compiler/wg-nll/topic/.2353488.20closure.20and.20disjoint.20fields.html#147721720">(Nov 15 2018 at 05:21)</a>:</h4>
<p>Another pull: <a href="https://github.com/rust-lang/rust/pull/55953" target="_blank" title="https://github.com/rust-lang/rust/pull/55953">https://github.com/rust-lang/rust/pull/55953</a></p>



<a name="150846493"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353488%20closure%20and%20disjoint%20fields/near/150846493" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> blitzerr <a href="https://rust-lang.github.io/zulip_archive/stream/122657-t-compiler/wg-nll/topic/.2353488.20closure.20and.20disjoint.20fields.html#150846493">(Dec 04 2018 at 13:34)</a>:</h4>
<p>Hi <span class="user-mention" data-user-id="116009">@nikomatsakis</span> . This is the topic thread.</p>



<a name="151007734"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353488%20closure%20and%20disjoint%20fields/near/151007734" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://rust-lang.github.io/zulip_archive/stream/122657-t-compiler/wg-nll/topic/.2353488.20closure.20and.20disjoint.20fields.html#151007734">(Dec 06 2018 at 13:57)</a>:</h4>
<p>ok so picking this up again <span class="user-mention" data-user-id="128294">@blitzerr</span> :)</p>



<a name="151007788"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353488%20closure%20and%20disjoint%20fields/near/151007788" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://rust-lang.github.io/zulip_archive/stream/122657-t-compiler/wg-nll/topic/.2353488.20closure.20and.20disjoint.20fields.html#151007788">(Dec 06 2018 at 13:58)</a>:</h4>
<p>I don't recall, you did land <em>some</em> kind of refactoring PR, right?</p>



<a name="151007817"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353488%20closure%20and%20disjoint%20fields/near/151007817" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> blitzerr <a href="https://rust-lang.github.io/zulip_archive/stream/122657-t-compiler/wg-nll/topic/.2353488.20closure.20and.20disjoint.20fields.html#151007817">(Dec 06 2018 at 13:58)</a>:</h4>
<p><span class="emoji emoji-1f389" title="tada">:tada:</span></p>



<a name="151007972"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353488%20closure%20and%20disjoint%20fields/near/151007972" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> blitzerr <a href="https://rust-lang.github.io/zulip_archive/stream/122657-t-compiler/wg-nll/topic/.2353488.20closure.20and.20disjoint.20fields.html#151007972">(Dec 06 2018 at 13:59)</a>:</h4>
<p><a href="https://github.com/rust-lang/rust/pull/55953/files" target="_blank" title="https://github.com/rust-lang/rust/pull/55953/files">https://github.com/rust-lang/rust/pull/55953/files</a></p>



<a name="151008044"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353488%20closure%20and%20disjoint%20fields/near/151008044" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> blitzerr <a href="https://rust-lang.github.io/zulip_archive/stream/122657-t-compiler/wg-nll/topic/.2353488.20closure.20and.20disjoint.20fields.html#151008044">(Dec 06 2018 at 14:00)</a>:</h4>
<p>So basically separating out hir_id into a struct of it's own</p>



<a name="151008084"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353488%20closure%20and%20disjoint%20fields/near/151008084" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://rust-lang.github.io/zulip_archive/stream/122657-t-compiler/wg-nll/topic/.2353488.20closure.20and.20disjoint.20fields.html#151008084">(Dec 06 2018 at 14:01)</a>:</h4>
<p>right ok</p>



<a name="151008090"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353488%20closure%20and%20disjoint%20fields/near/151008090" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://rust-lang.github.io/zulip_archive/stream/122657-t-compiler/wg-nll/topic/.2353488.20closure.20and.20disjoint.20fields.html#151008090">(Dec 06 2018 at 14:01)</a>:</h4>
<p>so</p>



<a name="151008118"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353488%20closure%20and%20disjoint%20fields/near/151008118" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://rust-lang.github.io/zulip_archive/stream/122657-t-compiler/wg-nll/topic/.2353488.20closure.20and.20disjoint.20fields.html#151008118">(Dec 06 2018 at 14:01)</a>:</h4>
<p>here is a question</p>



<a name="151008141"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353488%20closure%20and%20disjoint%20fields/near/151008141" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://rust-lang.github.io/zulip_archive/stream/122657-t-compiler/wg-nll/topic/.2353488.20closure.20and.20disjoint.20fields.html#151008141">(Dec 06 2018 at 14:01)</a>:</h4>
<p>we should try to identify some cases that are particularly easy basically</p>



<a name="151008143"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353488%20closure%20and%20disjoint%20fields/near/151008143" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://rust-lang.github.io/zulip_archive/stream/122657-t-compiler/wg-nll/topic/.2353488.20closure.20and.20disjoint.20fields.html#151008143">(Dec 06 2018 at 14:01)</a>:</h4>
<p>so we can try to tackle those first</p>



<a name="151008212"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353488%20closure%20and%20disjoint%20fields/near/151008212" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://rust-lang.github.io/zulip_archive/stream/122657-t-compiler/wg-nll/topic/.2353488.20closure.20and.20disjoint.20fields.html#151008212">(Dec 06 2018 at 14:02)</a>:</h4>
<p>really <span class="user-mention" data-user-id="128294">@blitzerr</span> this job is not particularly hard</p>



<a name="151008220"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353488%20closure%20and%20disjoint%20fields/near/151008220" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://rust-lang.github.io/zulip_archive/stream/122657-t-compiler/wg-nll/topic/.2353488.20closure.20and.20disjoint.20fields.html#151008220">(Dec 06 2018 at 14:02)</a>:</h4>
<p>conceptually :P</p>



<a name="151008227"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353488%20closure%20and%20disjoint%20fields/near/151008227" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://rust-lang.github.io/zulip_archive/stream/122657-t-compiler/wg-nll/topic/.2353488.20closure.20and.20disjoint.20fields.html#151008227">(Dec 06 2018 at 14:02)</a>:</h4>
<p>(famous last words)</p>



<a name="151008228"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353488%20closure%20and%20disjoint%20fields/near/151008228" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> blitzerr <a href="https://rust-lang.github.io/zulip_archive/stream/122657-t-compiler/wg-nll/topic/.2353488.20closure.20and.20disjoint.20fields.html#151008228">(Dec 06 2018 at 14:02)</a>:</h4>
<p>Right.<br>
I remember you saying we start with tuples first</p>



<a name="151008241"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353488%20closure%20and%20disjoint%20fields/near/151008241" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://rust-lang.github.io/zulip_archive/stream/122657-t-compiler/wg-nll/topic/.2353488.20closure.20and.20disjoint.20fields.html#151008241">(Dec 06 2018 at 14:02)</a>:</h4>
<p>maybe a good place to start is trying to just <strong>identify the paths</strong> we would capture (but not actually capture them)</p>



<a name="151008242"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353488%20closure%20and%20disjoint%20fields/near/151008242" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://rust-lang.github.io/zulip_archive/stream/122657-t-compiler/wg-nll/topic/.2353488.20closure.20and.20disjoint.20fields.html#151008242">(Dec 06 2018 at 14:02)</a>:</h4>
<p>ah, I was smart</p>



<a name="151008265"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353488%20closure%20and%20disjoint%20fields/near/151008265" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://rust-lang.github.io/zulip_archive/stream/122657-t-compiler/wg-nll/topic/.2353488.20closure.20and.20disjoint.20fields.html#151008265">(Dec 06 2018 at 14:03)</a>:</h4>
<p>but I think trying to identify the paths is good</p>



<a name="151008272"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353488%20closure%20and%20disjoint%20fields/near/151008272" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://rust-lang.github.io/zulip_archive/stream/122657-t-compiler/wg-nll/topic/.2353488.20closure.20and.20disjoint.20fields.html#151008272">(Dec 06 2018 at 14:03)</a>:</h4>
<p>also</p>



<a name="151008285"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353488%20closure%20and%20disjoint%20fields/near/151008285" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://rust-lang.github.io/zulip_archive/stream/122657-t-compiler/wg-nll/topic/.2353488.20closure.20and.20disjoint.20fields.html#151008285">(Dec 06 2018 at 14:03)</a>:</h4>
<p>one technique we sometimes use for this is to add some kind of special, perm-unstable attribute like <code>#[rustc_dump_closure_paths]</code></p>



<a name="151008302"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353488%20closure%20and%20disjoint%20fields/near/151008302" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://rust-lang.github.io/zulip_archive/stream/122657-t-compiler/wg-nll/topic/.2353488.20closure.20and.20disjoint.20fields.html#151008302">(Dec 06 2018 at 14:03)</a>:</h4>
<p>which then causes the tests to emit special errors at each closure containing interesting information</p>



<a name="151008369"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353488%20closure%20and%20disjoint%20fields/near/151008369" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://rust-lang.github.io/zulip_archive/stream/122657-t-compiler/wg-nll/topic/.2353488.20closure.20and.20disjoint.20fields.html#151008369">(Dec 06 2018 at 14:04)</a>:</h4>
<p>I was thinking we could add such an attribute and then make some tests like</p>
<div class="codehilite"><pre><span></span><span class="cp">#[rustc_dump_closure_paths]</span><span class="w"></span>
<span class="k">fn</span> <span class="nf">main</span><span class="p">()</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="n">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="mi">22</span><span class="p">,</span><span class="w"> </span><span class="mi">44</span><span class="p">);</span><span class="w"></span>
<span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="n">y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">||</span><span class="w"> </span><span class="n">x</span><span class="p">.</span><span class="mi">0</span><span class="p">;</span><span class="w"></span>
<span class="w">    </span><span class="n">println</span><span class="o">!</span><span class="p">(</span><span class="s">&quot;{}&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">y</span><span class="p">());</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>
</pre></div>


<p>this would presently emit an error like "capturing <code>x</code>" on the closure</p>



<a name="151008386"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353488%20closure%20and%20disjoint%20fields/near/151008386" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://rust-lang.github.io/zulip_archive/stream/122657-t-compiler/wg-nll/topic/.2353488.20closure.20and.20disjoint.20fields.html#151008386">(Dec 06 2018 at 14:04)</a>:</h4>
<p>then the job is to write the code that will look at the HIR and try to decide that <code>x.0</code> would be a better path to capture :P</p>



<a name="151008415"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353488%20closure%20and%20disjoint%20fields/near/151008415" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://rust-lang.github.io/zulip_archive/stream/122657-t-compiler/wg-nll/topic/.2353488.20closure.20and.20disjoint.20fields.html#151008415">(Dec 06 2018 at 14:04)</a>:</h4>
<p>(sorry, just thinking out loud)</p>



<a name="151008429"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353488%20closure%20and%20disjoint%20fields/near/151008429" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> blitzerr <a href="https://rust-lang.github.io/zulip_archive/stream/122657-t-compiler/wg-nll/topic/.2353488.20closure.20and.20disjoint.20fields.html#151008429">(Dec 06 2018 at 14:05)</a>:</h4>
<p>Makes sense.</p>



<a name="151008433"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353488%20closure%20and%20disjoint%20fields/near/151008433" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://rust-lang.github.io/zulip_archive/stream/122657-t-compiler/wg-nll/topic/.2353488.20closure.20and.20disjoint.20fields.html#151008433">(Dec 06 2018 at 14:05)</a>:</h4>
<p>there is another place that might be a better starting point</p>



<a name="151008436"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353488%20closure%20and%20disjoint%20fields/near/151008436" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> blitzerr <a href="https://rust-lang.github.io/zulip_archive/stream/122657-t-compiler/wg-nll/topic/.2353488.20closure.20and.20disjoint.20fields.html#151008436">(Dec 06 2018 at 14:05)</a>:</h4>
<p>I will try that out</p>



<a name="151008448"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353488%20closure%20and%20disjoint%20fields/near/151008448" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://rust-lang.github.io/zulip_archive/stream/122657-t-compiler/wg-nll/topic/.2353488.20closure.20and.20disjoint.20fields.html#151008448">(Dec 06 2018 at 14:05)</a>:</h4>
<p>right now there is a fair amount of code that is using <code>tcx.with_freevars</code></p>



<a name="151008451"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353488%20closure%20and%20disjoint%20fields/near/151008451" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://rust-lang.github.io/zulip_archive/stream/122657-t-compiler/wg-nll/topic/.2353488.20closure.20and.20disjoint.20fields.html#151008451">(Dec 06 2018 at 14:05)</a>:</h4>
<p>this function is problematic</p>



<a name="151008565"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353488%20closure%20and%20disjoint%20fields/near/151008565" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> blitzerr <a href="https://rust-lang.github.io/zulip_archive/stream/122657-t-compiler/wg-nll/topic/.2353488.20closure.20and.20disjoint.20fields.html#151008565">(Dec 06 2018 at 14:07)</a>:</h4>
<p>Okay.  So we need to change that as well</p>



<a name="151008570"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353488%20closure%20and%20disjoint%20fields/near/151008570" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://rust-lang.github.io/zulip_archive/stream/122657-t-compiler/wg-nll/topic/.2353488.20closure.20and.20disjoint.20fields.html#151008570">(Dec 06 2018 at 14:07)</a>:</h4>
<p><a href="https://doc.rust-lang.org/nightly/nightly-rustc/rustc/ty/struct.TyCtxt.html#method.with_freevars" target="_blank" title="https://doc.rust-lang.org/nightly/nightly-rustc/rustc/ty/struct.TyCtxt.html#method.with_freevars">https://doc.rust-lang.org/nightly/nightly-rustc/rustc/ty/struct.TyCtxt.html#method.with_freevars</a></p>



<a name="151008571"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353488%20closure%20and%20disjoint%20fields/near/151008571" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://rust-lang.github.io/zulip_archive/stream/122657-t-compiler/wg-nll/topic/.2353488.20closure.20and.20disjoint.20fields.html#151008571">(Dec 06 2018 at 14:08)</a>:</h4>
<p>the reason it's problematic is that</p>



<a name="151008811"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353488%20closure%20and%20disjoint%20fields/near/151008811" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://rust-lang.github.io/zulip_archive/stream/122657-t-compiler/wg-nll/topic/.2353488.20closure.20and.20disjoint.20fields.html#151008811">(Dec 06 2018 at 14:11)</a>:</h4>
<p>(sorry, slicing up a few conversations)</p>



<a name="151008815"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353488%20closure%20and%20disjoint%20fields/near/151008815" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://rust-lang.github.io/zulip_archive/stream/122657-t-compiler/wg-nll/topic/.2353488.20closure.20and.20disjoint.20fields.html#151008815">(Dec 06 2018 at 14:11)</a>:</h4>
<p>well basically that it returns a slice of variables</p>



<a name="151008817"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353488%20closure%20and%20disjoint%20fields/near/151008817" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> blitzerr <a href="https://rust-lang.github.io/zulip_archive/stream/122657-t-compiler/wg-nll/topic/.2353488.20closure.20and.20disjoint.20fields.html#151008817">(Dec 06 2018 at 14:11)</a>:</h4>
<p>You mean because it takes the NodeId ?</p>



<a name="151008824"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353488%20closure%20and%20disjoint%20fields/near/151008824" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://rust-lang.github.io/zulip_archive/stream/122657-t-compiler/wg-nll/topic/.2353488.20closure.20and.20disjoint.20fields.html#151008824">(Dec 06 2018 at 14:11)</a>:</h4>
<p>that is also ungreat ;)</p>



<a name="151008842"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353488%20closure%20and%20disjoint%20fields/near/151008842" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://rust-lang.github.io/zulip_archive/stream/122657-t-compiler/wg-nll/topic/.2353488.20closure.20and.20disjoint.20fields.html#151008842">(Dec 06 2018 at 14:11)</a>:</h4>
<p>but basically all code that uses it is implicitly assuming that closures capture entire variables</p>



<a name="151008843"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353488%20closure%20and%20disjoint%20fields/near/151008843" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://rust-lang.github.io/zulip_archive/stream/122657-t-compiler/wg-nll/topic/.2353488.20closure.20and.20disjoint.20fields.html#151008843">(Dec 06 2018 at 14:11)</a>:</h4>
<p>and not paths</p>



<a name="151008906"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353488%20closure%20and%20disjoint%20fields/near/151008906" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://rust-lang.github.io/zulip_archive/stream/122657-t-compiler/wg-nll/topic/.2353488.20closure.20and.20disjoint.20fields.html#151008906">(Dec 06 2018 at 14:12)</a>:</h4>
<p>it's not <em>that</em> much code that uses it:</p>
<div class="codehilite"><pre><span></span>/home/nmatsakis/.cargo/bin/rg --no-heading --color never &#39;\.with_freevars\(&#39;
src/librustc_passes/rvalue_promotion.rs:474:            if v.tcx.with_freevars(e.id, |fv| !fv.is_empty()) {
src/librustc_typeck/collect.rs:1102:        tcx.with_freevars(node_id, |fv| {
src/librustc_mir/build/mod.rs:609:    let upvar_decls: Vec&lt;_&gt; = tcx.with_freevars(fn_id, |freevars| {
src/librustc_mir/borrow_check/error_reporting.rs:1651:                        .with_freevars(node_id, |fv| fv[field.index()]);
src/librustc_mir/borrow_check/error_reporting.rs:2423:            let var_span = self.infcx.tcx.with_freevars(
src/librustc/mir/mod.rs:2371:                            tcx.with_freevars(node_id, |freevars| {
src/librustc/mir/mod.rs:2389:                            tcx.with_freevars(node_id, |freevars| {
src/librustc/util/ppaux.rs:1221:                        tcx.with_freevars(node_id, |freevars| {
src/librustc/util/ppaux.rs:1261:                        tcx.with_freevars(node_id, |freevars| {
src/librustc/middle/liveness.rs:475:        ir.tcx.with_freevars(expr.id, |freevars| {
src/librustc/middle/expr_use_visitor.rs:936:        self.tcx().with_freevars(closure_expr.id, |freevars| {
src/librustc_typeck/check/upvar.rs:134:        self.tcx.with_freevars(closure_node_id, |freevars| {
src/librustc_typeck/check/upvar.rs:244:        tcx.with_freevars(closure_id, |freevars| {
src/librustc_typeck/check/coercion.rs:701:            ty::FnPtr(_) if self.tcx.with_freevars(node_id_a, |v| v.is_empty()) =&gt; {
src/librustc_mir/hair/cx/expr.rs:530:            let upvars = cx.tcx.with_freevars(expr.id, |freevars| {
</pre></div>



<a name="151008932"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353488%20closure%20and%20disjoint%20fields/near/151008932" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://rust-lang.github.io/zulip_archive/stream/122657-t-compiler/wg-nll/topic/.2353488.20closure.20and.20disjoint.20fields.html#151008932">(Dec 06 2018 at 14:12)</a>:</h4>
<p>but e.g. all the code in <code>librustc_mir</code> needs to be generalized, and I'm sure most of the rest</p>



<a name="151008941"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353488%20closure%20and%20disjoint%20fields/near/151008941" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://rust-lang.github.io/zulip_archive/stream/122657-t-compiler/wg-nll/topic/.2353488.20closure.20and.20disjoint.20fields.html#151008941">(Dec 06 2018 at 14:12)</a>:</h4>
<p>it would be kind of good to look at those uses and try to write out what they are doing I guess</p>



<a name="151008949"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353488%20closure%20and%20disjoint%20fields/near/151008949" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://rust-lang.github.io/zulip_archive/stream/122657-t-compiler/wg-nll/topic/.2353488.20closure.20and.20disjoint.20fields.html#151008949">(Dec 06 2018 at 14:13)</a>:</h4>
<p><span class="user-mention" data-user-id="128294">@blitzerr</span> I wonder if the thing for us to do is to schedule another hour-long slot next week or something</p>



<a name="151008961"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353488%20closure%20and%20disjoint%20fields/near/151008961" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://rust-lang.github.io/zulip_archive/stream/122657-t-compiler/wg-nll/topic/.2353488.20closure.20and.20disjoint.20fields.html#151008961">(Dec 06 2018 at 14:13)</a>:</h4>
<p>I'm probably not going to have enough time at this second</p>



<a name="151008963"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353488%20closure%20and%20disjoint%20fields/near/151008963" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://rust-lang.github.io/zulip_archive/stream/122657-t-compiler/wg-nll/topic/.2353488.20closure.20and.20disjoint.20fields.html#151008963">(Dec 06 2018 at 14:13)</a>:</h4>
<p>but clearly we need to carve out a bit of time</p>



<a name="151009082"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353488%20closure%20and%20disjoint%20fields/near/151009082" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> blitzerr <a href="https://rust-lang.github.io/zulip_archive/stream/122657-t-compiler/wg-nll/topic/.2353488.20closure.20and.20disjoint.20fields.html#151009082">(Dec 06 2018 at 14:15)</a>:</h4>
<p>Sure. <br>
We can have another call. Meanwhile I will try to figure out what the other callers use it for</p>



<a name="151009103"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353488%20closure%20and%20disjoint%20fields/near/151009103" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> blitzerr <a href="https://rust-lang.github.io/zulip_archive/stream/122657-t-compiler/wg-nll/topic/.2353488.20closure.20and.20disjoint.20fields.html#151009103">(Dec 06 2018 at 14:15)</a>:</h4>
<p>Thanks for looking into this on a busy all <span class="emoji emoji-270b" title="hand">:hand:</span> week <span class="emoji emoji-1f642" title="slight smile">:slight_smile:</span></p>



<a name="151009792"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353488%20closure%20and%20disjoint%20fields/near/151009792" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> blitzerr <a href="https://rust-lang.github.io/zulip_archive/stream/122657-t-compiler/wg-nll/topic/.2353488.20closure.20and.20disjoint.20fields.html#151009792">(Dec 06 2018 at 14:25)</a>:</h4>
<p>Is this all that uses the entire upvar node  or expects it? We have to get an exhaustive list. I wonder how.</p>



<a name="151010414"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353488%20closure%20and%20disjoint%20fields/near/151010414" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://rust-lang.github.io/zulip_archive/stream/122657-t-compiler/wg-nll/topic/.2353488.20closure.20and.20disjoint.20fields.html#151010414">(Dec 06 2018 at 14:33)</a>:</h4>
<p>I think this is a pretty exhaustive list</p>



<a name="151010417"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353488%20closure%20and%20disjoint%20fields/near/151010417" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://rust-lang.github.io/zulip_archive/stream/122657-t-compiler/wg-nll/topic/.2353488.20closure.20and.20disjoint.20fields.html#151010417">(Dec 06 2018 at 14:33)</a>:</h4>
<p>well</p>



<a name="151010489"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353488%20closure%20and%20disjoint%20fields/near/151010489" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://rust-lang.github.io/zulip_archive/stream/122657-t-compiler/wg-nll/topic/.2353488.20closure.20and.20disjoint.20fields.html#151010489">(Dec 06 2018 at 14:34)</a>:</h4>
<p>the other place you might check would be things that invoke <a href="https://doc.rust-lang.org/nightly/nightly-rustc/rustc/ty/struct.ClosureSubsts.html#method.upvar_tys" target="_blank" title="https://doc.rust-lang.org/nightly/nightly-rustc/rustc/ty/struct.ClosureSubsts.html#method.upvar_tys"><code>upvar_tys</code></a>. I suspect that most of them are also calling freevars in the same vicinity, or else don't really need to be changed, but still.</p>



<a name="151486282"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353488%20closure%20and%20disjoint%20fields/near/151486282" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> blitzerr <a href="https://rust-lang.github.io/zulip_archive/stream/122657-t-compiler/wg-nll/topic/.2353488.20closure.20and.20disjoint.20fields.html#151486282">(Dec 11 2018 at 22:34)</a>:</h4>
<p>@nikomatsakis Let me know when you will have time for a call/ discussion</p>



<a name="151564682"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353488%20closure%20and%20disjoint%20fields/near/151564682" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> blitzerr <a href="https://rust-lang.github.io/zulip_archive/stream/122657-t-compiler/wg-nll/topic/.2353488.20closure.20and.20disjoint.20fields.html#151564682">(Dec 12 2018 at 21:21)</a>:</h4>
<p>@nikomatsakis <span class="emoji emoji-1f44b" title="wave">:wave:</span></p>



<a name="151565808"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353488%20closure%20and%20disjoint%20fields/near/151565808" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://rust-lang.github.io/zulip_archive/stream/122657-t-compiler/wg-nll/topic/.2353488.20closure.20and.20disjoint.20fields.html#151565808">(Dec 12 2018 at 21:40)</a>:</h4>
<p>ok <span class="user-mention" data-user-id="128294">@blitzerr</span> so -- I have a few minutes before my next meeting but not a ton</p>



<a name="151565835"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353488%20closure%20and%20disjoint%20fields/near/151565835" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://rust-lang.github.io/zulip_archive/stream/122657-t-compiler/wg-nll/topic/.2353488.20closure.20and.20disjoint.20fields.html#151565835">(Dec 12 2018 at 21:40)</a>:</h4>
<p>I definitely still think some refactoring around this area is good</p>



<a name="151565864"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353488%20closure%20and%20disjoint%20fields/near/151565864" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://rust-lang.github.io/zulip_archive/stream/122657-t-compiler/wg-nll/topic/.2353488.20closure.20and.20disjoint.20fields.html#151565864">(Dec 12 2018 at 21:41)</a>:</h4>
<p>it seems like we're not quite at the point of knowing what to do</p>



<a name="151565869"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353488%20closure%20and%20disjoint%20fields/near/151565869" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://rust-lang.github.io/zulip_archive/stream/122657-t-compiler/wg-nll/topic/.2353488.20closure.20and.20disjoint.20fields.html#151565869">(Dec 12 2018 at 21:41)</a>:</h4>
<p>let me see if in the next 10 minutes or so I can sketch out a plan</p>



<a name="151566239"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353488%20closure%20and%20disjoint%20fields/near/151566239" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://rust-lang.github.io/zulip_archive/stream/122657-t-compiler/wg-nll/topic/.2353488.20closure.20and.20disjoint.20fields.html#151566239">(Dec 12 2018 at 21:48)</a>:</h4>
<p>digging around I am starting to get some idea of the range of problems we'll have :P</p>



<a name="151566251"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353488%20closure%20and%20disjoint%20fields/near/151566251" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://rust-lang.github.io/zulip_archive/stream/122657-t-compiler/wg-nll/topic/.2353488.20closure.20and.20disjoint.20fields.html#151566251">(Dec 12 2018 at 21:48)</a>:</h4>
<p>but I guess a starting point would be to identify some of the places we use <code>freevars</code> and perhaps convert them to use data withdrawn from <code>TypeckTables</code> instead</p>



<a name="151566267"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353488%20closure%20and%20disjoint%20fields/near/151566267" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://rust-lang.github.io/zulip_archive/stream/122657-t-compiler/wg-nll/topic/.2353488.20closure.20and.20disjoint.20fields.html#151566267">(Dec 12 2018 at 21:49)</a>:</h4>
<p>let's start with exactly one example</p>



<a name="151566287"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353488%20closure%20and%20disjoint%20fields/near/151566287" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://rust-lang.github.io/zulip_archive/stream/122657-t-compiler/wg-nll/topic/.2353488.20closure.20and.20disjoint.20fields.html#151566287">(Dec 12 2018 at 21:49)</a>:</h4>
<p>this code <a href="https://github.com/rust-lang/rust/blob/dd8fc7dc06dea00afbd365468cf4804f68a3531c/src/librustc_mir/build/mod.rs#L667-L668" target="_blank" title="https://github.com/rust-lang/rust/blob/dd8fc7dc06dea00afbd365468cf4804f68a3531c/src/librustc_mir/build/mod.rs#L667-L668">during MIR construction</a> iterates over the freevariables using <code>with_freevars</code></p>



<a name="151566357"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353488%20closure%20and%20disjoint%20fields/near/151566357" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://rust-lang.github.io/zulip_archive/stream/122657-t-compiler/wg-nll/topic/.2353488.20closure.20and.20disjoint.20fields.html#151566357">(Dec 12 2018 at 21:50)</a>:</h4>
<p>for each free variable, it looks up the borrow mode using the <code>upvar_capture</code> method <a href="https://github.com/rust-lang/rust/blob/dd8fc7dc06dea00afbd365468cf4804f68a3531c/src/librustc_mir/build/mod.rs#L670-L676" target="_blank" title="https://github.com/rust-lang/rust/blob/dd8fc7dc06dea00afbd365468cf4804f68a3531c/src/librustc_mir/build/mod.rs#L670-L676">here</a>:</p>
<div class="codehilite"><pre><span></span><span class="w">            </span><span class="kd">let</span><span class="w"> </span><span class="n">var_id</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">fv</span><span class="p">.</span><span class="n">var_id</span><span class="p">();</span><span class="w"></span>
<span class="w">            </span><span class="kd">let</span><span class="w"> </span><span class="n">var_hir_id</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">tcx</span><span class="p">.</span><span class="n">hir</span><span class="p">().</span><span class="n">node_to_hir_id</span><span class="p">(</span><span class="n">var_id</span><span class="p">);</span><span class="w"></span>
<span class="w">            </span><span class="kd">let</span><span class="w"> </span><span class="n">closure_expr_id</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">tcx</span><span class="p">.</span><span class="n">hir</span><span class="p">().</span><span class="n">local_def_id</span><span class="p">(</span><span class="n">fn_id</span><span class="p">);</span><span class="w"></span>
<span class="w">            </span><span class="kd">let</span><span class="w"> </span><span class="n">capture</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">hir</span><span class="p">.</span><span class="n">tables</span><span class="p">().</span><span class="n">upvar_capture</span><span class="p">(</span><span class="n">ty</span>::<span class="n">UpvarId</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">                </span><span class="n">var_path</span>: <span class="nc">ty</span>::<span class="n">UpvarPath</span><span class="w"> </span><span class="p">{</span><span class="n">hir_id</span>: <span class="nc">var_hir_id</span><span class="p">},</span><span class="w"></span>
<span class="w">                </span><span class="n">closure_expr_id</span>: <span class="nc">LocalDefId</span>::<span class="n">from_def_id</span><span class="p">(</span><span class="n">closure_expr_id</span><span class="p">),</span><span class="w"></span>
<span class="p">});</span><span class="w"></span>
</pre></div>



<a name="151566370"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353488%20closure%20and%20disjoint%20fields/near/151566370" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://rust-lang.github.io/zulip_archive/stream/122657-t-compiler/wg-nll/topic/.2353488.20closure.20and.20disjoint.20fields.html#151566370">(Dec 12 2018 at 21:50)</a>:</h4>
<p>it'd be nice if we didn't use <code>with_freevars</code> but instead were able to get the list of free var capture into from <code>hir.tables()</code></p>



<a name="151566401"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353488%20closure%20and%20disjoint%20fields/near/151566401" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://rust-lang.github.io/zulip_archive/stream/122657-t-compiler/wg-nll/topic/.2353488.20closure.20and.20disjoint.20fields.html#151566401">(Dec 12 2018 at 21:51)</a>:</h4>
<p>this might require however adding another field to <code>TypeckTables</code>, something like</p>
<div class="codehilite"><pre><span></span><span class="k">pub</span><span class="w"> </span><span class="n">upvar_list</span>: <span class="nc">ty</span>::<span class="n">UpvarListMap</span><span class="o">&lt;</span><span class="na">&#39;tcx</span><span class="o">&gt;</span><span class="p">,</span><span class="w"></span>
</pre></div>


<p>where</p>
<div class="codehilite"><pre><span></span><span class="k">pub</span><span class="w"> </span><span class="k">type</span> <span class="nc">UpvarListMap</span><span class="o">&lt;</span><span class="na">&#39;tcx</span><span class="o">&gt;</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">FxHashMap</span><span class="o">&lt;</span><span class="n">DefId</span><span class="p">,</span><span class="w"> </span><span class="nb">Vec</span><span class="o">&lt;</span><span class="n">UpvarId</span><span class="o">&gt;&gt;</span><span class="w"></span>
</pre></div>



<a name="151566562"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353488%20closure%20and%20disjoint%20fields/near/151566562" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://rust-lang.github.io/zulip_archive/stream/122657-t-compiler/wg-nll/topic/.2353488.20closure.20and.20disjoint.20fields.html#151566562">(Dec 12 2018 at 21:54)</a>:</h4>
<p>so maybe a good first step is just adding this field to <a href="https://doc.rust-lang.org/nightly/nightly-rustc/rustc/ty/struct.TypeckTables.html" target="_blank" title="https://doc.rust-lang.org/nightly/nightly-rustc/rustc/ty/struct.TypeckTables.html"><code>TypeckTables</code></a>, and populating it. I imagine we would populate it right around <a href="https://github.com/rust-lang/rust/blob/dd8fc7dc06dea00afbd365468cf4804f68a3531c/src/librustc_typeck/check/upvar.rs#L134" target="_blank" title="https://github.com/rust-lang/rust/blob/dd8fc7dc06dea00afbd365468cf4804f68a3531c/src/librustc_typeck/check/upvar.rs#L134">this code</a>. Basically in <a href="https://github.com/rust-lang/rust/blob/dd8fc7dc06dea00afbd365468cf4804f68a3531c/src/librustc_typeck/check/upvar.rs#L135-L162" target="_blank" title="https://github.com/rust-lang/rust/blob/dd8fc7dc06dea00afbd365468cf4804f68a3531c/src/librustc_typeck/check/upvar.rs#L135-L162">this loop</a> we could be pushing <a href="https://github.com/rust-lang/rust/blob/dd8fc7dc06dea00afbd365468cf4804f68a3531c/src/librustc_typeck/check/upvar.rs#L136-L142" target="_blank" title="https://github.com/rust-lang/rust/blob/dd8fc7dc06dea00afbd365468cf4804f68a3531c/src/librustc_typeck/check/upvar.rs#L136-L142">the <code>UpvarId</code> values we create</a> into a vector, so that we can store that vector into the map we added to the tables, <a href="https://github.com/rust-lang/rust/blob/dd8fc7dc06dea00afbd365468cf4804f68a3531c/src/librustc_typeck/check/upvar.rs#L157-L159" target="_blank" title="https://github.com/rust-lang/rust/blob/dd8fc7dc06dea00afbd365468cf4804f68a3531c/src/librustc_typeck/check/upvar.rs#L157-L159">sort of like this</a> -- but after the loop, once the vector is complete.</p>



<a name="151566694"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353488%20closure%20and%20disjoint%20fields/near/151566694" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://rust-lang.github.io/zulip_archive/stream/122657-t-compiler/wg-nll/topic/.2353488.20closure.20and.20disjoint.20fields.html#151566694">(Dec 12 2018 at 21:56)</a>:</h4>
<p>ok, <span class="user-mention" data-user-id="128294">@blitzerr</span>, that's all I have time for for now -- what we should probably do is open an issue and I can move these notes to there. The issue would be something like "refactor uses of <code>freevar</code>" I guess. I can try to file one later.</p>



<a name="151566817"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353488%20closure%20and%20disjoint%20fields/near/151566817" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> blitzerr <a href="https://rust-lang.github.io/zulip_archive/stream/122657-t-compiler/wg-nll/topic/.2353488.20closure.20and.20disjoint.20fields.html#151566817">(Dec 12 2018 at 21:58)</a>:</h4>
<p>@nikomatsakis  Thanks a lot. I will create an issue and add your notes and then you can add more to that. Thanks a lot for your time</p>



<a name="151568388"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353488%20closure%20and%20disjoint%20fields/near/151568388" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://rust-lang.github.io/zulip_archive/stream/122657-t-compiler/wg-nll/topic/.2353488.20closure.20and.20disjoint.20fields.html#151568388">(Dec 12 2018 at 22:26)</a>:</h4>
<p>I hope <span class="user-mention" data-user-id="128294">@blitzerr</span> some of that made sense =)</p>



<a name="151569043"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353488%20closure%20and%20disjoint%20fields/near/151569043" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> blitzerr <a href="https://rust-lang.github.io/zulip_archive/stream/122657-t-compiler/wg-nll/topic/.2353488.20closure.20and.20disjoint.20fields.html#151569043">(Dec 12 2018 at 22:40)</a>:</h4>
<p>@nikomatsakis what you said makes sense in terms of the steps but I don't get why it's bad for the current code to loop over with_freevars ? The only thing I can think of is having it in hir.tables() is cleaner ?</p>



<a name="151584375"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353488%20closure%20and%20disjoint%20fields/near/151584375" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> blitzerr <a href="https://rust-lang.github.io/zulip_archive/stream/122657-t-compiler/wg-nll/topic/.2353488.20closure.20and.20disjoint.20fields.html#151584375">(Dec 13 2018 at 04:20)</a>:</h4>
<p><span class="user-mention" data-user-id="116009">@nikomatsakis</span> <br>
<a href="https://github.com/rust-lang/rust/issues/53553" target="_blank" title="https://github.com/rust-lang/rust/issues/53553">https://github.com/rust-lang/rust/issues/53553</a><br>
Is this similar to what you were thinking ? Can we use this issue or we would like to create our own ?</p>



<a name="151614959"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353488%20closure%20and%20disjoint%20fields/near/151614959" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://rust-lang.github.io/zulip_archive/stream/122657-t-compiler/wg-nll/topic/.2353488.20closure.20and.20disjoint.20fields.html#151614959">(Dec 13 2018 at 15:25)</a>:</h4>
<blockquote>
<p>@nikomatsakis what you said makes sense in terms of the steps but I don't get why it's bad for the current code to loop over with_freevars ? The only thing I can think of is having it in hir.tables() is cleaner ?</p>
</blockquote>
<p>well, in the future, we expect closures to capture not only free variables, but entire paths. Most code using <code>freevars</code> will not be compatible with that assumption.</p>



<a name="151615036"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353488%20closure%20and%20disjoint%20fields/near/151615036" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://rust-lang.github.io/zulip_archive/stream/122657-t-compiler/wg-nll/topic/.2353488.20closure.20and.20disjoint.20fields.html#151615036">(Dec 13 2018 at 15:26)</a>:</h4>
<blockquote>
<p>Is this similar to what you were thinking ? Can we use this issue or we would like to create our own ?</p>
</blockquote>
<p>Similar, yes, though different. Seems like a good place to discuss, at leaset.</p>



<a name="151621438"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353488%20closure%20and%20disjoint%20fields/near/151621438" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> blitzerr <a href="https://rust-lang.github.io/zulip_archive/stream/122657-t-compiler/wg-nll/topic/.2353488.20closure.20and.20disjoint.20fields.html#151621438">(Dec 13 2018 at 16:49)</a>:</h4>
<p><span class="user-mention" data-user-id="116009">@nikomatsakis</span> okay, I will add your words to the issue <a href="https://github.com/rust-lang/rust/issues/53553" target="_blank" title="https://github.com/rust-lang/rust/issues/53553">#53553</a>.</p>



<a name="151621674"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353488%20closure%20and%20disjoint%20fields/near/151621674" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://rust-lang.github.io/zulip_archive/stream/122657-t-compiler/wg-nll/topic/.2353488.20closure.20and.20disjoint.20fields.html#151621674">(Dec 13 2018 at 16:51)</a>:</h4>
<p>This is actually a sort of complication we have to work through — the current setup relies on knowing the types of all captured variables in the closure before type-check runs. I have to go revisit the RFC and see what we discussed there in this regard.</p>



<a name="151621891"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353488%20closure%20and%20disjoint%20fields/near/151621891" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> blitzerr <a href="https://rust-lang.github.io/zulip_archive/stream/122657-t-compiler/wg-nll/topic/.2353488.20closure.20and.20disjoint.20fields.html#151621891">(Dec 13 2018 at 16:55)</a>:</h4>
<p>You mean in working through <a href="https://github.com/rust-lang/rust/issues/53488" target="_blank" title="https://github.com/rust-lang/rust/issues/53488">#53488</a> we will also solve <a href="https://github.com/rust-lang/rust/issues/53553" target="_blank" title="https://github.com/rust-lang/rust/issues/53553">#53553</a> ?</p>



<a name="151904682"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353488%20closure%20and%20disjoint%20fields/near/151904682" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> blitzerr <a href="https://rust-lang.github.io/zulip_archive/stream/122657-t-compiler/wg-nll/topic/.2353488.20closure.20and.20disjoint.20fields.html#151904682">(Dec 17 2018 at 01:00)</a>:</h4>
<p><span class="user-mention" data-user-id="116009">@nikomatsakis</span>  Created a new issue : <a href="https://github.com/rust-lang/rust/issues/56905" target="_blank" title="https://github.com/rust-lang/rust/issues/56905">https://github.com/rust-lang/rust/issues/56905</a>.</p>



<a name="151904984"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353488%20closure%20and%20disjoint%20fields/near/151904984" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> blitzerr <a href="https://rust-lang.github.io/zulip_archive/stream/122657-t-compiler/wg-nll/topic/.2353488.20closure.20and.20disjoint.20fields.html#151904984">(Dec 17 2018 at 01:10)</a>:</h4>
<p><a href="https://github.com/rust-lang/rust/pull/56906/files" target="_blank" title="https://github.com/rust-lang/rust/pull/56906/files">https://github.com/rust-lang/rust/pull/56906/files</a></p>



<a name="152044036"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353488%20closure%20and%20disjoint%20fields/near/152044036" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> blitzerr <a href="https://rust-lang.github.io/zulip_archive/stream/122657-t-compiler/wg-nll/topic/.2353488.20closure.20and.20disjoint.20fields.html#152044036">(Dec 17 2018 at 17:20)</a>:</h4>
<p><span class="user-mention" data-user-id="116009">@nikomatsakis</span> <br>
<span class="emoji emoji-261d" title="wait one second">:wait_one_second:</span>️</p>



<a name="152044194"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353488%20closure%20and%20disjoint%20fields/near/152044194" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://rust-lang.github.io/zulip_archive/stream/122657-t-compiler/wg-nll/topic/.2353488.20closure.20and.20disjoint.20fields.html#152044194">(Dec 17 2018 at 17:22)</a>:</h4>
<p>Saw it, great!</p>



<a name="152044206"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353488%20closure%20and%20disjoint%20fields/near/152044206" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://rust-lang.github.io/zulip_archive/stream/122657-t-compiler/wg-nll/topic/.2353488.20closure.20and.20disjoint.20fields.html#152044206">(Dec 17 2018 at 17:22)</a>:</h4>
<p>I'll try to add some more notes, not sure if I can get to that today, but I've added it to my list</p>



<a name="152083533"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353488%20closure%20and%20disjoint%20fields/near/152083533" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> blitzerr <a href="https://rust-lang.github.io/zulip_archive/stream/122657-t-compiler/wg-nll/topic/.2353488.20closure.20and.20disjoint.20fields.html#152083533">(Dec 18 2018 at 03:48)</a>:</h4>
<p>Thanks a lot <span class="user-mention" data-user-id="116009">@nikomatsakis</span> for reviewing.  I have a question related to your comment :D</p>



<a name="152115086"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353488%20closure%20and%20disjoint%20fields/near/152115086" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://rust-lang.github.io/zulip_archive/stream/122657-t-compiler/wg-nll/topic/.2353488.20closure.20and.20disjoint.20fields.html#152115086">(Dec 18 2018 at 15:23)</a>:</h4>
<p><span class="user-mention" data-user-id="128294">@blitzerr</span> <a href="https://github.com/rust-lang/rust/pull/56906#discussion_r242579794" target="_blank" title="https://github.com/rust-lang/rust/pull/56906#discussion_r242579794">responded</a></p>



<a name="152141756"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353488%20closure%20and%20disjoint%20fields/near/152141756" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> blitzerr <a href="https://rust-lang.github.io/zulip_archive/stream/122657-t-compiler/wg-nll/topic/.2353488.20closure.20and.20disjoint.20fields.html#152141756">(Dec 18 2018 at 21:59)</a>:</h4>
<p>Thanks a lot <span class="user-mention" data-user-id="116009">@nikomatsakis</span></p>



<a name="152141761"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353488%20closure%20and%20disjoint%20fields/near/152141761" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> blitzerr <a href="https://rust-lang.github.io/zulip_archive/stream/122657-t-compiler/wg-nll/topic/.2353488.20closure.20and.20disjoint.20fields.html#152141761">(Dec 18 2018 at 21:59)</a>:</h4>
<p>I will post an update tonight.</p>



<a name="152141862"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353488%20closure%20and%20disjoint%20fields/near/152141862" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://rust-lang.github.io/zulip_archive/stream/122657-t-compiler/wg-nll/topic/.2353488.20closure.20and.20disjoint.20fields.html#152141862">(Dec 18 2018 at 22:00)</a>:</h4>
<p>great, I will try to post some further comments about next steps</p>



<a name="152141902"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353488%20closure%20and%20disjoint%20fields/near/152141902" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> blitzerr <a href="https://rust-lang.github.io/zulip_archive/stream/122657-t-compiler/wg-nll/topic/.2353488.20closure.20and.20disjoint.20fields.html#152141902">(Dec 18 2018 at 22:01)</a>:</h4>
<p><span class="user-mention" data-user-id="116009">@nikomatsakis</span>  When you have a chance if you can look at <a href="https://github.com/rust-lang/rustc-guide/pull/225" target="_blank" title="https://github.com/rust-lang/rustc-guide/pull/225">https://github.com/rust-lang/rustc-guide/pull/225</a>, it would be great or else we can push it after we wrap up the <a href="https://github.com/rust-lang/rust/issues/53488" target="_blank" title="https://github.com/rust-lang/rust/issues/53488">#53488</a> as well. Whatever works.</p>



<a name="152141925"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353488%20closure%20and%20disjoint%20fields/near/152141925" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> blitzerr <a href="https://rust-lang.github.io/zulip_archive/stream/122657-t-compiler/wg-nll/topic/.2353488.20closure.20and.20disjoint.20fields.html#152141925">(Dec 18 2018 at 22:01)</a>:</h4>
<blockquote>
<p>great, I will try to post some further comments about next steps</p>
</blockquote>
<p>That will be awesome.</p>



<a name="152142821"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353488%20closure%20and%20disjoint%20fields/near/152142821" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> blitzerr <a href="https://rust-lang.github.io/zulip_archive/stream/122657-t-compiler/wg-nll/topic/.2353488.20closure.20and.20disjoint.20fields.html#152142821">(Dec 18 2018 at 22:15)</a>:</h4>
<p><span class="user-mention" data-user-id="116009">@nikomatsakis</span>  If we are thinking the same thing, the next step will be to replace the calls to with_freevars with the map we introduced ?</p>



<a name="152143393"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353488%20closure%20and%20disjoint%20fields/near/152143393" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://rust-lang.github.io/zulip_archive/stream/122657-t-compiler/wg-nll/topic/.2353488.20closure.20and.20disjoint.20fields.html#152143393">(Dec 18 2018 at 22:25)</a>:</h4>
<p><span class="user-mention" data-user-id="128294">@blitzerr</span> right -- but not all of them. I think I highlighted one good candidate to start.</p>



<a name="152143439"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353488%20closure%20and%20disjoint%20fields/near/152143439" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://rust-lang.github.io/zulip_archive/stream/122657-t-compiler/wg-nll/topic/.2353488.20closure.20and.20disjoint.20fields.html#152143439">(Dec 18 2018 at 22:26)</a>:</h4>
<p>there are some bigger questions we need to think through though that I've not had time to ponder</p>



<a name="152143502"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353488%20closure%20and%20disjoint%20fields/near/152143502" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> blitzerr <a href="https://rust-lang.github.io/zulip_archive/stream/122657-t-compiler/wg-nll/topic/.2353488.20closure.20and.20disjoint.20fields.html#152143502">(Dec 18 2018 at 22:27)</a>:</h4>
<p><span class="user-mention" data-user-id="116009">@nikomatsakis</span>  Maybe if you tell me what the big questions are, I can think of something and then you can tell me I am wrong <span class="emoji emoji-1f603" title="smiley">:smiley:</span></p>



<a name="152143616"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353488%20closure%20and%20disjoint%20fields/near/152143616" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://rust-lang.github.io/zulip_archive/stream/122657-t-compiler/wg-nll/topic/.2353488.20closure.20and.20disjoint.20fields.html#152143616">(Dec 18 2018 at 22:29)</a>:</h4>
<p>specifically, the problem has to do with the way we handle "closure substs"</p>



<a name="152143630"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353488%20closure%20and%20disjoint%20fields/near/152143630" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://rust-lang.github.io/zulip_archive/stream/122657-t-compiler/wg-nll/topic/.2353488.20closure.20and.20disjoint.20fields.html#152143630">(Dec 18 2018 at 22:29)</a>:</h4>
<p>the current scheme is explained <a href="https://doc.rust-lang.org/nightly/nightly-rustc/rustc/ty/struct.ClosureSubsts.html" target="_blank" title="https://doc.rust-lang.org/nightly/nightly-rustc/rustc/ty/struct.ClosureSubsts.html">here</a>, in the comments</p>



<a name="152143643"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353488%20closure%20and%20disjoint%20fields/near/152143643" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://rust-lang.github.io/zulip_archive/stream/122657-t-compiler/wg-nll/topic/.2353488.20closure.20and.20disjoint.20fields.html#152143643">(Dec 18 2018 at 22:30)</a>:</h4>
<p>the problem is that this scheme relies on knowing the set of captured variables</p>



<a name="152143686"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353488%20closure%20and%20disjoint%20fields/near/152143686" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://rust-lang.github.io/zulip_archive/stream/122657-t-compiler/wg-nll/topic/.2353488.20closure.20and.20disjoint.20fields.html#152143686">(Dec 18 2018 at 22:30)</a>:</h4>
<p>and it creates one generic parameter for each of them</p>



<a name="152143706"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353488%20closure%20and%20disjoint%20fields/near/152143706" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://rust-lang.github.io/zulip_archive/stream/122657-t-compiler/wg-nll/topic/.2353488.20closure.20and.20disjoint.20fields.html#152143706">(Dec 18 2018 at 22:30)</a>:</h4>
<p>but if we are going to be capturing <em>paths</em>, and we don't know those paths until type check...</p>



<a name="152143737"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353488%20closure%20and%20disjoint%20fields/near/152143737" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://rust-lang.github.io/zulip_archive/stream/122657-t-compiler/wg-nll/topic/.2353488.20closure.20and.20disjoint.20fields.html#152143737">(Dec 18 2018 at 22:31)</a>:</h4>
<p>we might need to adjust that scheme</p>



<a name="152143744"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353488%20closure%20and%20disjoint%20fields/near/152143744" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://rust-lang.github.io/zulip_archive/stream/122657-t-compiler/wg-nll/topic/.2353488.20closure.20and.20disjoint.20fields.html#152143744">(Dec 18 2018 at 22:31)</a>:</h4>
<p>since I think we have to know the number of parameters etc before typeck completes</p>



<a name="152143749"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353488%20closure%20and%20disjoint%20fields/near/152143749" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://rust-lang.github.io/zulip_archive/stream/122657-t-compiler/wg-nll/topic/.2353488.20closure.20and.20disjoint.20fields.html#152143749">(Dec 18 2018 at 22:31)</a>:</h4>
<p>but maybe not</p>



<a name="152143759"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353488%20closure%20and%20disjoint%20fields/near/152143759" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://rust-lang.github.io/zulip_archive/stream/122657-t-compiler/wg-nll/topic/.2353488.20closure.20and.20disjoint.20fields.html#152143759">(Dec 18 2018 at 22:31)</a>:</h4>
<p>or maybe we can figure out the set of captured paths <em>syntactically</em> without needing to know typeck results; but I doubt it</p>



<a name="152147669"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353488%20closure%20and%20disjoint%20fields/near/152147669" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> blitzerr <a href="https://rust-lang.github.io/zulip_archive/stream/122657-t-compiler/wg-nll/topic/.2353488.20closure.20and.20disjoint.20fields.html#152147669">(Dec 18 2018 at 23:46)</a>:</h4>
<p><span class="user-mention" data-user-id="116009">@nikomatsakis</span> </p>
<blockquote>
<p>or maybe we can figure out the set of captured paths <em>syntactically</em> without needing to know typeck results; but I doubt it</p>
</blockquote>
<p>Sounds like doing the same thing twice. <br>
But its good to run into problems. I will learn more.  <span class="emoji emoji-1f980" title="crab">:crab:</span></p>



<a name="152159353"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353488%20closure%20and%20disjoint%20fields/near/152159353" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> blitzerr <a href="https://rust-lang.github.io/zulip_archive/stream/122657-t-compiler/wg-nll/topic/.2353488.20closure.20and.20disjoint.20fields.html#152159353">(Dec 19 2018 at 04:57)</a>:</h4>
<p><span class="user-mention" data-user-id="116009">@nikomatsakis</span> <br>
<a href="https://github.com/rust-lang/rust/pull/56906/commits/d7519544694c1866ba4bf32cd307ed6f670e1267" target="_blank" title="https://github.com/rust-lang/rust/pull/56906/commits/d7519544694c1866ba4bf32cd307ed6f670e1267">https://github.com/rust-lang/rust/pull/56906/commits/d7519544694c1866ba4bf32cd307ed6f670e1267</a></p>



<a name="152307163"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353488%20closure%20and%20disjoint%20fields/near/152307163" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> blitzerr <a href="https://rust-lang.github.io/zulip_archive/stream/122657-t-compiler/wg-nll/topic/.2353488.20closure.20and.20disjoint.20fields.html#152307163">(Dec 21 2018 at 04:08)</a>:</h4>
<p>@nikomatsakis Maybe I made a mistake <a href="https://github.com/rust-lang/rust/pull/56906/files#diff-193820a23727493def60049c0b6af47eR172" target="_blank" title="https://github.com/rust-lang/rust/pull/56906/files#diff-193820a23727493def60049c0b6af47eR172">here</a>. I should have used <code>closure_node_id</code> instead of <code>closure_def_id</code> as the key to the <code>uppvar_list</code>. <br>
I say that because, there is a step to get to closure_def_id from closure_hir_id<br>
<code>let (closure_def_id, substs) = match self.node_ty(closure_hir_id).sty {</code></p>
<p><a href="https://github.com/rust-lang/rust/blob/dd8fc7dc06dea00afbd365468cf4804f68a3531c/src/librustc_mir/build/mod.rs#L667-L668" target="_blank" title="https://github.com/rust-lang/rust/blob/dd8fc7dc06dea00afbd365468cf4804f68a3531c/src/librustc_mir/build/mod.rs#L667-L668">This</a> provides ast::NodeId and therefore using closure_node_id as the key to upvar_list we can get the list of upvar directly or else we have to use <br>
<code>tcx.hir().local_def_id(fn_id)</code> to get <strong>closure_def_id</strong> and then use that to arrive at the list of upvars. Do you agree ?</p>



<a name="152406090"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353488%20closure%20and%20disjoint%20fields/near/152406090" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> blitzerr <a href="https://rust-lang.github.io/zulip_archive/stream/122657-t-compiler/wg-nll/topic/.2353488.20closure.20and.20disjoint.20fields.html#152406090">(Dec 22 2018 at 23:14)</a>:</h4>
<p><span class="user-mention" data-user-id="116009">@nikomatsakis</span> <br>
This is my first attempt at using the new data structure we created in the mir creation of a function. I have a question for you, to get unblocked. My question is in the PR as a <a href="https://github.com/rust-lang/rust/pull/56906/commits/239c9ef716574dd0deba2ac38e24dbac8f9035a5#diff-2daa9fd281d82f3fc811f6058691747bR658" target="_blank" title="https://github.com/rust-lang/rust/pull/56906/commits/239c9ef716574dd0deba2ac38e24dbac8f9035a5#diff-2daa9fd281d82f3fc811f6058691747bR658">comment</a></p>



<a name="152406155"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353488%20closure%20and%20disjoint%20fields/near/152406155" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> blitzerr <a href="https://rust-lang.github.io/zulip_archive/stream/122657-t-compiler/wg-nll/topic/.2353488.20closure.20and.20disjoint.20fields.html#152406155">(Dec 22 2018 at 23:16)</a>:</h4>
<p>Also, I think I messed up by commit/git somehow and now I see this being posted as part of the last PR and not as a new PR as I would have hoped. Can someone please educate me on how to solve <a href="https://github.com/rust-lang/rust/pull/56906" target="_blank" title="https://github.com/rust-lang/rust/pull/56906">this</a> ?</p>



<a name="152564281"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353488%20closure%20and%20disjoint%20fields/near/152564281" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://rust-lang.github.io/zulip_archive/stream/122657-t-compiler/wg-nll/topic/.2353488.20closure.20and.20disjoint.20fields.html#152564281">(Dec 26 2018 at 18:10)</a>:</h4>
<p><span class="user-mention" data-user-id="128294">@blitzerr</span> you should definitely <strong>not</strong> use the closure node-id</p>



<a name="152564282"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353488%20closure%20and%20disjoint%20fields/near/152564282" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://rust-lang.github.io/zulip_archive/stream/122657-t-compiler/wg-nll/topic/.2353488.20closure.20and.20disjoint.20fields.html#152564282">(Dec 26 2018 at 18:10)</a>:</h4>
<p>node-ids are kind of deprecated</p>



<a name="152564289"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353488%20closure%20and%20disjoint%20fields/near/152564289" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://rust-lang.github.io/zulip_archive/stream/122657-t-compiler/wg-nll/topic/.2353488.20closure.20and.20disjoint.20fields.html#152564289">(Dec 26 2018 at 18:11)</a>:</h4>
<p>I'll take a look at your comment though</p>



<a name="152564872"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353488%20closure%20and%20disjoint%20fields/near/152564872" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> blitzerr <a href="https://rust-lang.github.io/zulip_archive/stream/122657-t-compiler/wg-nll/topic/.2353488.20closure.20and.20disjoint.20fields.html#152564872">(Dec 26 2018 at 18:22)</a>:</h4>
<p><span class="user-mention" data-user-id="116009">@nikomatsakis</span> <br>
Thanks a lot.</p>



<a name="152564884"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353488%20closure%20and%20disjoint%20fields/near/152564884" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://rust-lang.github.io/zulip_archive/stream/122657-t-compiler/wg-nll/topic/.2353488.20closure.20and.20disjoint.20fields.html#152564884">(Dec 26 2018 at 18:22)</a>:</h4>
<p><span class="user-mention" data-user-id="128294">@blitzerr</span> is <a href="https://github.com/rust-lang/rust/pull/56906/files#diff-2daa9fd281d82f3fc811f6058691747bR658" target="_blank" title="https://github.com/rust-lang/rust/pull/56906/files#diff-2daa9fd281d82f3fc811f6058691747bR658">this</a> the comment you were referring to?</p>



<a name="152564981"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353488%20closure%20and%20disjoint%20fields/near/152564981" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> blitzerr <a href="https://rust-lang.github.io/zulip_archive/stream/122657-t-compiler/wg-nll/topic/.2353488.20closure.20and.20disjoint.20fields.html#152564981">(Dec 26 2018 at 18:24)</a>:</h4>
<p>Yup that's it <span class="user-mention" data-user-id="116009">@nikomatsakis</span></p>



<a name="152565006"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353488%20closure%20and%20disjoint%20fields/near/152565006" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://rust-lang.github.io/zulip_archive/stream/122657-t-compiler/wg-nll/topic/.2353488.20closure.20and.20disjoint.20fields.html#152565006">(Dec 26 2018 at 18:25)</a>:</h4>
<p>ok gimme a sec but I am confused -- which <code>NodeId</code> are you referring to, in that code, that is causing you problems?</p>



<a name="152565050"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353488%20closure%20and%20disjoint%20fields/near/152565050" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://rust-lang.github.io/zulip_archive/stream/122657-t-compiler/wg-nll/topic/.2353488.20closure.20and.20disjoint.20fields.html#152565050">(Dec 26 2018 at 18:26)</a>:</h4>
<p>is it <code>fn_id</code>?</p>



<a name="152565152"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353488%20closure%20and%20disjoint%20fields/near/152565152" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://rust-lang.github.io/zulip_archive/stream/122657-t-compiler/wg-nll/topic/.2353488.20closure.20and.20disjoint.20fields.html#152565152">(Dec 26 2018 at 18:28)</a>:</h4>
<p>oh, I guess you mean this part:</p>
<div class="codehilite"><pre><span></span>var_id is needed because further down, in this
             });
         // closure, it is used to find the Node::Binding to update the UpvarDecl, which will be
             let by_ref = match capture {
         // eventually returned by the closure. So the other way would be, if we can get the
                 ty::UpvarCapture::ByValue =&gt; false,
         // Node::Binding, given an HirId, we can also solve this.
</pre></div>



<a name="152565855"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353488%20closure%20and%20disjoint%20fields/near/152565855" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> blitzerr <a href="https://rust-lang.github.io/zulip_archive/stream/122657-t-compiler/wg-nll/topic/.2353488.20closure.20and.20disjoint.20fields.html#152565855">(Dec 26 2018 at 18:42)</a>:</h4>
<p>Right, that's where I am stuck <span class="user-mention" data-user-id="116009">@nikomatsakis</span></p>



<a name="152572063"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353488%20closure%20and%20disjoint%20fields/near/152572063" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> blitzerr <a href="https://rust-lang.github.io/zulip_archive/stream/122657-t-compiler/wg-nll/topic/.2353488.20closure.20and.20disjoint.20fields.html#152572063">(Dec 26 2018 at 21:32)</a>:</h4>
<p><span class="user-mention" data-user-id="116009">@nikomatsakis</span>  That is one issue and the other one is what should upvar_list's key be ?<br>
Whereever we use with_freevars, I see the code snippets use ast::NodeId and therefore I was suggesting using NodeId as the key but if it is deprecated,  then maybe we should use BodyId or DefId I think. The last PR used DefId as the key, do you think that's better that the BodyId ?</p>



<a name="152572133"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353488%20closure%20and%20disjoint%20fields/near/152572133" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> blitzerr <a href="https://rust-lang.github.io/zulip_archive/stream/122657-t-compiler/wg-nll/topic/.2353488.20closure.20and.20disjoint.20fields.html#152572133">(Dec 26 2018 at 21:35)</a>:</h4>
<p>This brings us the second issue, no matter what we end up with, we will need NodeId to work with as that is what the <code>hir().find()</code> expects <a href="https://github.com/rust-lang/rust/pull/56906/commits/239c9ef716574dd0deba2ac38e24dbac8f9035a5#diff-2daa9fd281d82f3fc811f6058691747bL676" target="_blank" title="https://github.com/rust-lang/rust/pull/56906/commits/239c9ef716574dd0deba2ac38e24dbac8f9035a5#diff-2daa9fd281d82f3fc811f6058691747bL676">here</a><br>
<code>if let Some(Node::Binding(pat)) = tcx.hir().find(var_id)</code></p>



<a name="152599786"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353488%20closure%20and%20disjoint%20fields/near/152599786" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://rust-lang.github.io/zulip_archive/stream/122657-t-compiler/wg-nll/topic/.2353488.20closure.20and.20disjoint.20fields.html#152599786">(Dec 27 2018 at 12:43)</a>:</h4>
<p><span class="user-mention" data-user-id="128294">@blitzerr</span> ok I'll leave some tips today, sorry, got distracted yesterday</p>



<a name="152602583"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353488%20closure%20and%20disjoint%20fields/near/152602583" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://rust-lang.github.io/zulip_archive/stream/122657-t-compiler/wg-nll/topic/.2353488.20closure.20and.20disjoint.20fields.html#152602583">(Dec 27 2018 at 13:54)</a>:</h4>
<p><span class="user-mention" data-user-id="128294">@blitzerr</span> <a href="https://github.com/rust-lang/rust/pull/56906#pullrequestreview-188094562" target="_blank" title="https://github.com/rust-lang/rust/pull/56906#pullrequestreview-188094562">see this comment</a> -- tl;dr you can freely interconvert between node-id and hir-id</p>



<a name="152602587"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353488%20closure%20and%20disjoint%20fields/near/152602587" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://rust-lang.github.io/zulip_archive/stream/122657-t-compiler/wg-nll/topic/.2353488.20closure.20and.20disjoint.20fields.html#152602587">(Dec 27 2018 at 13:54)</a>:</h4>
<p>I was at first going to propose a more extensive refactoring, but it seems fine for now</p>



<a name="152607457"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353488%20closure%20and%20disjoint%20fields/near/152607457" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> blitzerr <a href="https://rust-lang.github.io/zulip_archive/stream/122657-t-compiler/wg-nll/topic/.2353488.20closure.20and.20disjoint.20fields.html#152607457">(Dec 27 2018 at 15:51)</a>:</h4>
<p>Ohh man! I missed that utility function ! Embarrassing</p>



<a name="152607473"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353488%20closure%20and%20disjoint%20fields/near/152607473" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> blitzerr <a href="https://rust-lang.github.io/zulip_archive/stream/122657-t-compiler/wg-nll/topic/.2353488.20closure.20and.20disjoint.20fields.html#152607473">(Dec 27 2018 at 15:51)</a>:</h4>
<p><span class="user-mention" data-user-id="116009">@nikomatsakis</span> <br>
Regarding the second question, what do you think we should use as the key in our upvar_list ?</p>



<a name="152607814"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353488%20closure%20and%20disjoint%20fields/near/152607814" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://rust-lang.github.io/zulip_archive/stream/122657-t-compiler/wg-nll/topic/.2353488.20closure.20and.20disjoint.20fields.html#152607814">(Dec 27 2018 at 15:59)</a>:</h4>
<p><span class="user-mention" data-user-id="128294">@blitzerr</span> I would prefer <code>DefId</code></p>



<a name="152607819"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353488%20closure%20and%20disjoint%20fields/near/152607819" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://rust-lang.github.io/zulip_archive/stream/122657-t-compiler/wg-nll/topic/.2353488.20closure.20and.20disjoint.20fields.html#152607819">(Dec 27 2018 at 15:59)</a>:</h4>
<p>I think we use <code>DefId</code> most places</p>



<a name="152607826"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353488%20closure%20and%20disjoint%20fields/near/152607826" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://rust-lang.github.io/zulip_archive/stream/122657-t-compiler/wg-nll/topic/.2353488.20closure.20and.20disjoint.20fields.html#152607826">(Dec 27 2018 at 15:59)</a>:</h4>
<p>also, a <code>BodyId</code> doesn't work across crates</p>



<a name="152608089"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353488%20closure%20and%20disjoint%20fields/near/152608089" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> blitzerr <a href="https://rust-lang.github.io/zulip_archive/stream/122657-t-compiler/wg-nll/topic/.2353488.20closure.20and.20disjoint.20fields.html#152608089">(Dec 27 2018 at 16:04)</a>:</h4>
<p>Sounds good !</p>



<a name="152608137"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353488%20closure%20and%20disjoint%20fields/near/152608137" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> blitzerr <a href="https://rust-lang.github.io/zulip_archive/stream/122657-t-compiler/wg-nll/topic/.2353488.20closure.20and.20disjoint.20fields.html#152608137">(Dec 27 2018 at 16:05)</a>:</h4>
<p><span class="user-mention" data-user-id="116009">@nikomatsakis</span> <br>
What is the way you start another PR on your fork? <br>
If you see this PR got started on a previous PR that was already merged. How do I clean this up or just add on top of this one ?</p>



<a name="152608219"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353488%20closure%20and%20disjoint%20fields/near/152608219" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://rust-lang.github.io/zulip_archive/stream/122657-t-compiler/wg-nll/topic/.2353488.20closure.20and.20disjoint.20fields.html#152608219">(Dec 27 2018 at 16:07)</a>:</h4>
<p><span class="user-mention" data-user-id="128294">@blitzerr</span> well if that PR was already merged, then just create a new branch</p>



<a name="152608223"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353488%20closure%20and%20disjoint%20fields/near/152608223" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://rust-lang.github.io/zulip_archive/stream/122657-t-compiler/wg-nll/topic/.2353488.20closure.20and.20disjoint.20fields.html#152608223">(Dec 27 2018 at 16:07)</a>:</h4>
<p>e.g., <code>git checkout -b my-new-branch</code></p>



<a name="152608226"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353488%20closure%20and%20disjoint%20fields/near/152608226" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://rust-lang.github.io/zulip_archive/stream/122657-t-compiler/wg-nll/topic/.2353488.20closure.20and.20disjoint.20fields.html#152608226">(Dec 27 2018 at 16:07)</a>:</h4>
<p>and push the new branch to your repository</p>



<a name="152608230"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353488%20closure%20and%20disjoint%20fields/near/152608230" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://rust-lang.github.io/zulip_archive/stream/122657-t-compiler/wg-nll/topic/.2353488.20closure.20and.20disjoint.20fields.html#152608230">(Dec 27 2018 at 16:07)</a>:</h4>
<p>then do a rebase atop <code>rust-lang/master</code></p>



<a name="152608270"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353488%20closure%20and%20disjoint%20fields/near/152608270" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://rust-lang.github.io/zulip_archive/stream/122657-t-compiler/wg-nll/topic/.2353488.20closure.20and.20disjoint.20fields.html#152608270">(Dec 27 2018 at 16:08)</a>:</h4>
<p>leaving just the new commits</p>



<a name="152612673"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353488%20closure%20and%20disjoint%20fields/near/152612673" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> blitzerr <a href="https://rust-lang.github.io/zulip_archive/stream/122657-t-compiler/wg-nll/topic/.2353488.20closure.20and.20disjoint.20fields.html#152612673">(Dec 27 2018 at 17:56)</a>:</h4>
<p>thanks a lot <span class="user-mention" data-user-id="116009">@nikomatsakis</span></p>



<a name="152657851"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353488%20closure%20and%20disjoint%20fields/near/152657851" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> blitzerr <a href="https://rust-lang.github.io/zulip_archive/stream/122657-t-compiler/wg-nll/topic/.2353488.20closure.20and.20disjoint.20fields.html#152657851">(Dec 28 2018 at 15:15)</a>:</h4>
<p><span class="user-mention" data-user-id="116009">@nikomatsakis</span> <br>
I see there are ways to get a local defId from  NodeId but is there a way to get global DefId from the NodeId ?</p>



<a name="152657910"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353488%20closure%20and%20disjoint%20fields/near/152657910" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://rust-lang.github.io/zulip_archive/stream/122657-t-compiler/wg-nll/topic/.2353488.20closure.20and.20disjoint.20fields.html#152657910">(Dec 28 2018 at 15:16)</a>:</h4>
<p><span class="user-mention" data-user-id="128294">@blitzerr</span> not all node-ids have a def-id, but yes you can use <code>opt_local_def_id</code></p>



<a name="152657915"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353488%20closure%20and%20disjoint%20fields/near/152657915" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://rust-lang.github.io/zulip_archive/stream/122657-t-compiler/wg-nll/topic/.2353488.20closure.20and.20disjoint.20fields.html#152657915">(Dec 28 2018 at 15:17)</a>:</h4>
<p><a href="https://doc.rust-lang.org/nightly/nightly-rustc/rustc/hir/map/struct.Map.html#method.opt_local_def_id" target="_blank" title="https://doc.rust-lang.org/nightly/nightly-rustc/rustc/hir/map/struct.Map.html#method.opt_local_def_id">docs</a></p>



<a name="152657917"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353488%20closure%20and%20disjoint%20fields/near/152657917" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://rust-lang.github.io/zulip_archive/stream/122657-t-compiler/wg-nll/topic/.2353488.20closure.20and.20disjoint.20fields.html#152657917">(Dec 28 2018 at 15:17)</a>:</h4>
<p>well, not much docs there :)</p>



<a name="152657925"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353488%20closure%20and%20disjoint%20fields/near/152657925" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> blitzerr <a href="https://rust-lang.github.io/zulip_archive/stream/122657-t-compiler/wg-nll/topic/.2353488.20closure.20and.20disjoint.20fields.html#152657925">(Dec 28 2018 at 15:17)</a>:</h4>
<p>But the upvar_list is keyed on global DefId</p>



<a name="152657977"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353488%20closure%20and%20disjoint%20fields/near/152657977" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://rust-lang.github.io/zulip_archive/stream/122657-t-compiler/wg-nll/topic/.2353488.20closure.20and.20disjoint.20fields.html#152657977">(Dec 28 2018 at 15:18)</a>:</h4>
<p>I'm not sure what you mean</p>



<a name="152657978"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353488%20closure%20and%20disjoint%20fields/near/152657978" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://rust-lang.github.io/zulip_archive/stream/122657-t-compiler/wg-nll/topic/.2353488.20closure.20and.20disjoint.20fields.html#152657978">(Dec 28 2018 at 15:18)</a>:</h4>
<p>a <code>DefId</code> is a <code>DefId</code></p>



<a name="152657986"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353488%20closure%20and%20disjoint%20fields/near/152657986" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://rust-lang.github.io/zulip_archive/stream/122657-t-compiler/wg-nll/topic/.2353488.20closure.20and.20disjoint.20fields.html#152657986">(Dec 28 2018 at 15:18)</a>:</h4>
<p>ah, I guess it's the name "local def-id" that is confusing?</p>



<a name="152657992"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353488%20closure%20and%20disjoint%20fields/near/152657992" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://rust-lang.github.io/zulip_archive/stream/122657-t-compiler/wg-nll/topic/.2353488.20closure.20and.20disjoint.20fields.html#152657992">(Dec 28 2018 at 15:19)</a>:</h4>
<p>in this context, that just means: a <code>DefId</code> where the <code>crate</code> field is <code>LOCAL_CRATE</code></p>



<a name="152658001"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353488%20closure%20and%20disjoint%20fields/near/152658001" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://rust-lang.github.io/zulip_archive/stream/122657-t-compiler/wg-nll/topic/.2353488.20closure.20and.20disjoint.20fields.html#152658001">(Dec 28 2018 at 15:19)</a>:</h4>
<p>but once you have a <code>DefId</code>, it is canonical and can always be compared against other <code>DefId</code> values</p>



<a name="152660403"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353488%20closure%20and%20disjoint%20fields/near/152660403" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> blitzerr <a href="https://rust-lang.github.io/zulip_archive/stream/122657-t-compiler/wg-nll/topic/.2353488.20closure.20and.20disjoint.20fields.html#152660403">(Dec 28 2018 at 16:20)</a>:</h4>
<p>Ahh! Thanks for clarifying <span class="user-mention" data-user-id="116009">@nikomatsakis</span> <br>
I was thinking there are two flavors one local to crate and one global. You got it, the name local_def_id was what lead me there <span class="emoji emoji-1f600" title="grinning">:grinning:</span></p>



<a name="152715440"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353488%20closure%20and%20disjoint%20fields/near/152715440" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> blitzerr <a href="https://rust-lang.github.io/zulip_archive/stream/122657-t-compiler/wg-nll/topic/.2353488.20closure.20and.20disjoint.20fields.html#152715440">(Dec 29 2018 at 19:55)</a>:</h4>
<p><a href="https://github.com/rust-lang/rust/pull/56906/commits/2dd69109e56fbbc366a592cd53d4763d2dc5d7a5#diff-2daa9fd281d82f3fc811f6058691747bR660" target="_blank" title="https://github.com/rust-lang/rust/pull/56906/commits/2dd69109e56fbbc366a592cd53d4763d2dc5d7a5#diff-2daa9fd281d82f3fc811f6058691747bR660">PR</a></p>



<a name="152715500"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353488%20closure%20and%20disjoint%20fields/near/152715500" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> blitzerr <a href="https://rust-lang.github.io/zulip_archive/stream/122657-t-compiler/wg-nll/topic/.2353488.20closure.20and.20disjoint.20fields.html#152715500">(Dec 29 2018 at 19:57)</a>:</h4>
<p>This leads to ice because for some reason, the upvar_List when checked inside librustc_mir is empty.</p>



<a name="152715624"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353488%20closure%20and%20disjoint%20fields/near/152715624" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Matthew Jasper <a href="https://rust-lang.github.io/zulip_archive/stream/122657-t-compiler/wg-nll/topic/.2353488.20closure.20and.20disjoint.20fields.html#152715624">(Dec 29 2018 at 20:00)</a>:</h4>
<p>You might have to modify <code>src/librustc_typeck/check/writeback.rs</code> to handle upvar lists as well.</p>



<a name="152715694"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353488%20closure%20and%20disjoint%20fields/near/152715694" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Matthew Jasper <a href="https://rust-lang.github.io/zulip_archive/stream/122657-t-compiler/wg-nll/topic/.2353488.20closure.20and.20disjoint.20fields.html#152715694">(Dec 29 2018 at 20:03)</a>:</h4>
<p>The only parts of <code>TypeckTables</code> that get persisted are the parts stored there.</p>



<a name="152715757"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353488%20closure%20and%20disjoint%20fields/near/152715757" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> blitzerr <a href="https://rust-lang.github.io/zulip_archive/stream/122657-t-compiler/wg-nll/topic/.2353488.20closure.20and.20disjoint.20fields.html#152715757">(Dec 29 2018 at 20:05)</a>:</h4>
<p>Thank you <span class="user-mention" data-user-id="116118">@Matthew Jasper</span> <br>
I didn't know about that.</p>



<a name="152715811"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353488%20closure%20and%20disjoint%20fields/near/152715811" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> blitzerr <a href="https://rust-lang.github.io/zulip_archive/stream/122657-t-compiler/wg-nll/topic/.2353488.20closure.20and.20disjoint.20fields.html#152715811">(Dec 29 2018 at 20:07)</a>:</h4>
<p>Is that a specific function I need to add this new list to ?</p>



<a name="152715858"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353488%20closure%20and%20disjoint%20fields/near/152715858" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> blitzerr <a href="https://rust-lang.github.io/zulip_archive/stream/122657-t-compiler/wg-nll/topic/.2353488.20closure.20and.20disjoint.20fields.html#152715858">(Dec 29 2018 at 20:08)</a>:</h4>
<p><span class="user-mention" data-user-id="116118">@Matthew Jasper</span> <br>
can you give a brief description about how the writeback struct and friends works ?</p>



<a name="152715988"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353488%20closure%20and%20disjoint%20fields/near/152715988" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Matthew Jasper <a href="https://rust-lang.github.io/zulip_archive/stream/122657-t-compiler/wg-nll/topic/.2353488.20closure.20and.20disjoint.20fields.html#152715988">(Dec 29 2018 at 20:12)</a>:</h4>
<p>OK, so <code>typeck_tables_of</code> takes the def id of an item that is local to the current crate, and has a body (a function, constant or static), type-infers/type-checks the body, and returns the <code>TypeckTables</code> for that item, which contains all of the inferred information.</p>



<a name="152716101"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353488%20closure%20and%20disjoint%20fields/near/152716101" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> blitzerr <a href="https://rust-lang.github.io/zulip_archive/stream/122657-t-compiler/wg-nll/topic/.2353488.20closure.20and.20disjoint.20fields.html#152716101">(Dec 29 2018 at 20:16)</a>:</h4>
<p>Cool. Thank you so much.</p>



<a name="152716155"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353488%20closure%20and%20disjoint%20fields/near/152716155" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Matthew Jasper <a href="https://rust-lang.github.io/zulip_archive/stream/122657-t-compiler/wg-nll/topic/.2353488.20closure.20and.20disjoint.20fields.html#152716155">(Dec 29 2018 at 20:18)</a>:</h4>
<p>During type inference, partially inferred types are represented using Type variables (ty::Infer). These don't appear in the final TypeckTables since all of the types should have been inferred once <code>typeck_tables_of</code> is done.</p>



<a name="152716226"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353488%20closure%20and%20disjoint%20fields/near/152716226" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Matthew Jasper <a href="https://rust-lang.github.io/zulip_archive/stream/122657-t-compiler/wg-nll/topic/.2353488.20closure.20and.20disjoint.20fields.html#152716226">(Dec 29 2018 at 20:21)</a>:</h4>
<p>When type inference is running however, having to update the typeck tables every time a new type is inferred would be unreasonably slow, so instead all of the replacement happens at the end in <code>resolve_type_vars_in_body</code>, which creates a new <code>TypeTables</code> which doesn't contain any inference types.</p>



<a name="152716273"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353488%20closure%20and%20disjoint%20fields/near/152716273" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Matthew Jasper <a href="https://rust-lang.github.io/zulip_archive/stream/122657-t-compiler/wg-nll/topic/.2353488.20closure.20and.20disjoint.20fields.html#152716273">(Dec 29 2018 at 20:23)</a>:</h4>
<p>As <code>UpvarListMap</code> doesn't contain any types, you should be able to copy it to the new table in resolve_type_vars_in_body. As an aside <code>UpvarListMap</code> doesn't appear to use it's lifetime parameter.</p>



<a name="154031144"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353488%20closure%20and%20disjoint%20fields/near/154031144" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> blitzerr <a href="https://rust-lang.github.io/zulip_archive/stream/122657-t-compiler/wg-nll/topic/.2353488.20closure.20and.20disjoint.20fields.html#154031144">(Dec 30 2018 at 05:03)</a>:</h4>
<p>Sorry <span class="user-mention" data-user-id="116118">@Matthew Jasper</span>  I didn't see the last few messages. Thanks a lot for the detailed explanation. Very helpful. <br>
Regarding lifetime parameter, do you think I should remove it then ?</p>



<a name="154040290"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353488%20closure%20and%20disjoint%20fields/near/154040290" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Matthew Jasper <a href="https://rust-lang.github.io/zulip_archive/stream/122657-t-compiler/wg-nll/topic/.2353488.20closure.20and.20disjoint.20fields.html#154040290">(Dec 30 2018 at 10:42)</a>:</h4>
<p>Yes, unless you're going to add a use of it later.</p>



<a name="154201150"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353488%20closure%20and%20disjoint%20fields/near/154201150" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://rust-lang.github.io/zulip_archive/stream/122657-t-compiler/wg-nll/topic/.2353488.20closure.20and.20disjoint.20fields.html#154201150">(Jan 02 2019 at 21:04)</a>:</h4>
<p><span class="user-mention" data-user-id="128294">@blitzerr</span> is the PR updated now?</p>



<a name="154201269"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353488%20closure%20and%20disjoint%20fields/near/154201269" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://rust-lang.github.io/zulip_archive/stream/122657-t-compiler/wg-nll/topic/.2353488.20closure.20and.20disjoint.20fields.html#154201269">(Jan 02 2019 at 21:06)</a>:</h4>
<p>looks like no</p>



<a name="154201278"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353488%20closure%20and%20disjoint%20fields/near/154201278" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> blitzerr <a href="https://rust-lang.github.io/zulip_archive/stream/122657-t-compiler/wg-nll/topic/.2353488.20closure.20and.20disjoint.20fields.html#154201278">(Jan 02 2019 at 21:06)</a>:</h4>
<p><span class="user-mention" data-user-id="116009">@nikomatsakis</span> <br>
Not with the changes to copy the tables inside <code>typeck_tables_of</code></p>



<a name="154201293"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353488%20closure%20and%20disjoint%20fields/near/154201293" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://rust-lang.github.io/zulip_archive/stream/122657-t-compiler/wg-nll/topic/.2353488.20closure.20and.20disjoint.20fields.html#154201293">(Jan 02 2019 at 21:06)</a>:</h4>
<p>ok, should be a small diff</p>



<a name="154201319"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353488%20closure%20and%20disjoint%20fields/near/154201319" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> blitzerr <a href="https://rust-lang.github.io/zulip_archive/stream/122657-t-compiler/wg-nll/topic/.2353488.20closure.20and.20disjoint.20fields.html#154201319">(Jan 02 2019 at 21:07)</a>:</h4>
<p><span class="user-mention" data-user-id="116009">@nikomatsakis</span> ya and I can check if that makes the panic go away.</p>



<a name="154201499"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353488%20closure%20and%20disjoint%20fields/near/154201499" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> blitzerr <a href="https://rust-lang.github.io/zulip_archive/stream/122657-t-compiler/wg-nll/topic/.2353488.20closure.20and.20disjoint.20fields.html#154201499">(Jan 02 2019 at 21:10)</a>:</h4>
<p><span class="user-mention" data-user-id="116009">@nikomatsakis</span>  Also, as an aside, we can add <code>eprintln!</code> in the rustc-guide as a way of debugging rustc. I found it very helpful</p>



<a name="154201615"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353488%20closure%20and%20disjoint%20fields/near/154201615" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://rust-lang.github.io/zulip_archive/stream/122657-t-compiler/wg-nll/topic/.2353488.20closure.20and.20disjoint.20fields.html#154201615">(Jan 02 2019 at 21:12)</a>:</h4>
<p>we...could...I never use it myself</p>



<a name="154201618"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353488%20closure%20and%20disjoint%20fields/near/154201618" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://rust-lang.github.io/zulip_archive/stream/122657-t-compiler/wg-nll/topic/.2353488.20closure.20and.20disjoint.20fields.html#154201618">(Jan 02 2019 at 21:12)</a>:</h4>
<p>I usually just add <code>debug!</code></p>



<a name="154201636"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353488%20closure%20and%20disjoint%20fields/near/154201636" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://rust-lang.github.io/zulip_archive/stream/122657-t-compiler/wg-nll/topic/.2353488.20closure.20and.20disjoint.20fields.html#154201636">(Jan 02 2019 at 21:12)</a>:</h4>
<p>in fact, I would not recommend <code>eprintln!</code></p>



<a name="154201642"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353488%20closure%20and%20disjoint%20fields/near/154201642" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://rust-lang.github.io/zulip_archive/stream/122657-t-compiler/wg-nll/topic/.2353488.20closure.20and.20disjoint.20fields.html#154201642">(Jan 02 2019 at 21:13)</a>:</h4>
<p>because it prints out when you are bootstrapping</p>



<a name="154201662"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353488%20closure%20and%20disjoint%20fields/near/154201662" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://rust-lang.github.io/zulip_archive/stream/122657-t-compiler/wg-nll/topic/.2353488.20closure.20and.20disjoint.20fields.html#154201662">(Jan 02 2019 at 21:13)</a>:</h4>
<p>I find adding <code>debug!</code> or <code>info!</code> is better (the latter can be useful to distinguish the things you've just added from other <code>debug!</code> calls already in the compiler)</p>



<a name="154201677"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353488%20closure%20and%20disjoint%20fields/near/154201677" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://rust-lang.github.io/zulip_archive/stream/122657-t-compiler/wg-nll/topic/.2353488.20closure.20and.20disjoint.20fields.html#154201677">(Jan 02 2019 at 21:13)</a>:</h4>
<p>but either way we should have some "debugging tips", I know we've talked about adding that before</p>



<a name="154201837"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353488%20closure%20and%20disjoint%20fields/near/154201837" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://rust-lang.github.io/zulip_archive/stream/122657-t-compiler/wg-nll/topic/.2353488.20closure.20and.20disjoint.20fields.html#154201837">(Jan 02 2019 at 21:16)</a>:</h4>
<p>(and in said section we could mention <code>eprintln!</code> as an easy way, though it has downsides)</p>



<a name="154201890"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353488%20closure%20and%20disjoint%20fields/near/154201890" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> blitzerr <a href="https://rust-lang.github.io/zulip_archive/stream/122657-t-compiler/wg-nll/topic/.2353488.20closure.20and.20disjoint.20fields.html#154201890">(Jan 02 2019 at 21:17)</a>:</h4>
<p>The debug statements are printed when you use the rustc to compile a new file <br>
<code>RUST_LOG=rustc::traits rustc +local my-file.rs</code><br>
Like here we are using the already built rustc to compile <a href="http://my-file.rs" target="_blank" title="http://my-file.rs">my-file.rs</a> and generating the debug logs. In my case, the compiler would panic, while being built (./x.py build ...). In that case debug won't help right ?</p>



<a name="154202566"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353488%20closure%20and%20disjoint%20fields/near/154202566" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://rust-lang.github.io/zulip_archive/stream/122657-t-compiler/wg-nll/topic/.2353488.20closure.20and.20disjoint.20fields.html#154202566">(Jan 02 2019 at 21:28)</a>:</h4>
<p>ah, that is true, though you can use <code>RUST_LOG</code> when running <code>x.py</code></p>



<a name="154202578"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353488%20closure%20and%20disjoint%20fields/near/154202578" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://rust-lang.github.io/zulip_archive/stream/122657-t-compiler/wg-nll/topic/.2353488.20closure.20and.20disjoint.20fields.html#154202578">(Jan 02 2019 at 21:29)</a>:</h4>
<p>in general tips for dealing with crashes during bootstrapping is a good topic</p>



<a name="154202744"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353488%20closure%20and%20disjoint%20fields/near/154202744" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://rust-lang.github.io/zulip_archive/stream/122657-t-compiler/wg-nll/topic/.2353488.20closure.20and.20disjoint.20fields.html#154202744">(Jan 02 2019 at 21:31)</a>:</h4>
<p>but you are definitely correct that <code>eprintln!</code> may be particularly useful in that scenario</p>



<a name="154202777"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353488%20closure%20and%20disjoint%20fields/near/154202777" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> centril <a href="https://rust-lang.github.io/zulip_archive/stream/122657-t-compiler/wg-nll/topic/.2353488.20closure.20and.20disjoint.20fields.html#154202777">(Jan 02 2019 at 21:32)</a>:</h4>
<p><span class="user-mention" data-user-id="116009">@nikomatsakis</span>  FYI: there's <code>dbg!</code> now, <a href="https://doc.rust-lang.org/nightly/std/macro.dbg.html" target="_blank" title="https://doc.rust-lang.org/nightly/std/macro.dbg.html">https://doc.rust-lang.org/nightly/std/macro.dbg.html</a></p>



<a name="154205864"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353488%20closure%20and%20disjoint%20fields/near/154205864" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://rust-lang.github.io/zulip_archive/stream/122657-t-compiler/wg-nll/topic/.2353488.20closure.20and.20disjoint.20fields.html#154205864">(Jan 02 2019 at 22:29)</a>:</h4>
<p><span class="user-mention" data-user-id="128294">@blitzerr</span> I left a few notes (<a href="https://github.com/rust-lang/rust/issues/56905#issuecomment-451004313" target="_blank" title="https://github.com/rust-lang/rust/issues/56905#issuecomment-451004313">link</a>) regarding some of the steps we will have to do in this closure refactoring. Those weren't more "internal notes to myself", but we should discuss, as I think it suggests a few more refactorings to try out =)</p>



<a name="154205865"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353488%20closure%20and%20disjoint%20fields/near/154205865" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://rust-lang.github.io/zulip_archive/stream/122657-t-compiler/wg-nll/topic/.2353488.20closure.20and.20disjoint.20fields.html#154205865">(Jan 02 2019 at 22:29)</a>:</h4>
<p>the good news is that I think the path is <em>starting</em> to become clear</p>



<a name="154205867"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353488%20closure%20and%20disjoint%20fields/near/154205867" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://rust-lang.github.io/zulip_archive/stream/122657-t-compiler/wg-nll/topic/.2353488.20closure.20and.20disjoint.20fields.html#154205867">(Jan 02 2019 at 22:29)</a>:</h4>
<p>and you will be the world's expert on closures by the time we're done :P</p>



<a name="154206219"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353488%20closure%20and%20disjoint%20fields/near/154206219" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> blitzerr <a href="https://rust-lang.github.io/zulip_archive/stream/122657-t-compiler/wg-nll/topic/.2353488.20closure.20and.20disjoint.20fields.html#154206219">(Jan 02 2019 at 22:36)</a>:</h4>
<blockquote>
<p>ah, that is true, though you can use <code>RUST_LOG</code> when running <code>x.py</code></p>
</blockquote>
<p>Can you tell me how and I can add that to rustc-guide as well</p>



<a name="154207043"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353488%20closure%20and%20disjoint%20fields/near/154207043" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> blitzerr <a href="https://rust-lang.github.io/zulip_archive/stream/122657-t-compiler/wg-nll/topic/.2353488.20closure.20and.20disjoint.20fields.html#154207043">(Jan 02 2019 at 22:53)</a>:</h4>
<p><span class="user-mention" data-user-id="116009">@nikomatsakis</span></p>



<a name="154207426"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353488%20closure%20and%20disjoint%20fields/near/154207426" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> blitzerr <a href="https://rust-lang.github.io/zulip_archive/stream/122657-t-compiler/wg-nll/topic/.2353488.20closure.20and.20disjoint.20fields.html#154207426">(Jan 02 2019 at 23:01)</a>:</h4>
<p>Thanks for the notes ! I will read them tonight</p>



<a name="154207666"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353488%20closure%20and%20disjoint%20fields/near/154207666" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> csmoe <a href="https://rust-lang.github.io/zulip_archive/stream/122657-t-compiler/wg-nll/topic/.2353488.20closure.20and.20disjoint.20fields.html#154207666">(Jan 02 2019 at 23:06)</a>:</h4>
<p><span class="user-mention" data-user-id="128294">@blitzerr</span> debugging chapter from <a href="https://rust-lang.github.io/rustc-guide/compiler-debugging.html" target="_blank" title="https://rust-lang.github.io/rustc-guide/compiler-debugging.html">https://rust-lang.github.io/rustc-guide/compiler-debugging.html</a></p>



<a name="154207924"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353488%20closure%20and%20disjoint%20fields/near/154207924" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> blitzerr <a href="https://rust-lang.github.io/zulip_archive/stream/122657-t-compiler/wg-nll/topic/.2353488.20closure.20and.20disjoint.20fields.html#154207924">(Jan 02 2019 at 23:12)</a>:</h4>
<p><span class="user-mention" data-user-id="116773">@csmoe</span> <br>
I see lines like this <code>$ RUST_LOG=rustc::traits rustc +local my-file.rs</code><br>
which is invoking it after the compiler is built and not while building it using x.py</p>



<a name="154207944"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353488%20closure%20and%20disjoint%20fields/near/154207944" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> blitzerr <a href="https://rust-lang.github.io/zulip_archive/stream/122657-t-compiler/wg-nll/topic/.2353488.20closure.20and.20disjoint.20fields.html#154207944">(Jan 02 2019 at 23:13)</a>:</h4>
<p><span class="user-mention" data-user-id="116773">@csmoe</span>  Let me know if you are seeing something that I missed ?</p>



<a name="154208004"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353488%20closure%20and%20disjoint%20fields/near/154208004" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> csmoe <a href="https://rust-lang.github.io/zulip_archive/stream/122657-t-compiler/wg-nll/topic/.2353488.20closure.20and.20disjoint.20fields.html#154208004">(Jan 02 2019 at 23:14)</a>:</h4>
<p>oops, rust_log only works with built rustc.</p>



<a name="154208083"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353488%20closure%20and%20disjoint%20fields/near/154208083" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> blitzerr <a href="https://rust-lang.github.io/zulip_archive/stream/122657-t-compiler/wg-nll/topic/.2353488.20closure.20and.20disjoint.20fields.html#154208083">(Jan 02 2019 at 23:16)</a>:</h4>
<p>Right but looks like <span class="user-mention" data-user-id="116009">@nikomatsakis</span>  has a trick to make it work while it is being built</p>



<a name="154218938"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353488%20closure%20and%20disjoint%20fields/near/154218938" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> blitzerr <a href="https://rust-lang.github.io/zulip_archive/stream/122657-t-compiler/wg-nll/topic/.2353488.20closure.20and.20disjoint.20fields.html#154218938">(Jan 03 2019 at 04:09)</a>:</h4>
<p><span class="user-mention" data-user-id="116009">@nikomatsakis</span>  <a href="https://github.com/rust-lang/rust/commit/923042e1d9a59edb7fdef579f666299a29103afa" target="_blank" title="https://github.com/rust-lang/rust/commit/923042e1d9a59edb7fdef579f666299a29103afa">New commit</a></p>



<a name="154248542"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353488%20closure%20and%20disjoint%20fields/near/154248542" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://rust-lang.github.io/zulip_archive/stream/122657-t-compiler/wg-nll/topic/.2353488.20closure.20and.20disjoint.20fields.html#154248542">(Jan 03 2019 at 16:08)</a>:</h4>
<p><span class="user-mention" data-user-id="128294">@blitzerr</span> you just need to do <code>RUST_LOG=rustc::traits ./x.py ...</code></p>



<a name="154251212"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353488%20closure%20and%20disjoint%20fields/near/154251212" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> blitzerr <a href="https://rust-lang.github.io/zulip_archive/stream/122657-t-compiler/wg-nll/topic/.2353488.20closure.20and.20disjoint.20fields.html#154251212">(Jan 03 2019 at 16:54)</a>:</h4>
<p>Thanks</p>



<a name="154252231"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353488%20closure%20and%20disjoint%20fields/near/154252231" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> blitzerr <a href="https://rust-lang.github.io/zulip_archive/stream/122657-t-compiler/wg-nll/topic/.2353488.20closure.20and.20disjoint.20fields.html#154252231">(Jan 03 2019 at 17:13)</a>:</h4>
<p><span class="user-mention" data-user-id="116009">@nikomatsakis</span> <br>
I think, one way to remove the usage of Freevars struct will be for the with_freevars function to be able to call the closure provided with the upvar_list and then all callers code can change to accommodate to use the UpvarId instead of Freevar. But that said, it will have to be an all at once change instead of the way we are currently doing it, tackling one with_freevar call at a time.</p>



<a name="154252500"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353488%20closure%20and%20disjoint%20fields/near/154252500" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> blitzerr <a href="https://rust-lang.github.io/zulip_archive/stream/122657-t-compiler/wg-nll/topic/.2353488.20closure.20and.20disjoint.20fields.html#154252500">(Jan 03 2019 at 17:19)</a>:</h4>
<p>Not sure if you reviewed the code, but looking at your comments on the issue, I think we have a direction for the next change. There are two methods you suggest, have you made your mind on which one ? Maybe we want to do the tuples based one ? When you suggest that the closure can keep a list of all the upvars it is referencing, we don't really need to right ? I think we have to extend the UpvarId struct to keep track of which fields in aggregate datatypes are borrowed by the closure ?</p>



<a name="154270218"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353488%20closure%20and%20disjoint%20fields/near/154270218" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> blitzerr <a href="https://rust-lang.github.io/zulip_archive/stream/122657-t-compiler/wg-nll/topic/.2353488.20closure.20and.20disjoint.20fields.html#154270218">(Jan 03 2019 at 22:10)</a>:</h4>
<p><span class="user-mention" data-user-id="116009">@nikomatsakis</span>  <span class="emoji emoji-1f446" title="point up">:point_up:</span></p>



<a name="154429247"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353488%20closure%20and%20disjoint%20fields/near/154429247" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://rust-lang.github.io/zulip_archive/stream/122657-t-compiler/wg-nll/topic/.2353488.20closure.20and.20disjoint.20fields.html#154429247">(Jan 04 2019 at 19:05)</a>:</h4>
<p>I would prefer <span class="user-mention" data-user-id="128294">@blitzerr</span> to migrate callers of the <code>with_freevars</code> code one by one, since then it can be done incrementally — but also because there may be some callers that should not be migrated, I'm not sure</p>



<a name="154429266"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353488%20closure%20and%20disjoint%20fields/near/154429266" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://rust-lang.github.io/zulip_archive/stream/122657-t-compiler/wg-nll/topic/.2353488.20closure.20and.20disjoint.20fields.html#154429266">(Jan 04 2019 at 19:05)</a>:</h4>
<p>I think the next refactoring I would pursue though is indeed to introduce a tuple of type variables for the upvar types</p>



<a name="154429315"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353488%20closure%20and%20disjoint%20fields/near/154429315" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://rust-lang.github.io/zulip_archive/stream/122657-t-compiler/wg-nll/topic/.2353488.20closure.20and.20disjoint.20fields.html#154429315">(Jan 04 2019 at 19:06)</a>:</h4>
<p>I wonder <span class="user-mention" data-user-id="128294">@blitzerr</span> if you want to try to do that one -- or get started on it, anyways -- doing a pair programming session</p>



<a name="154429332"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353488%20closure%20and%20disjoint%20fields/near/154429332" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://rust-lang.github.io/zulip_archive/stream/122657-t-compiler/wg-nll/topic/.2353488.20closure.20and.20disjoint.20fields.html#154429332">(Jan 04 2019 at 19:06)</a>:</h4>
<p>I feel like it looks "not that hard" to me, but I could imagine if you are not that familiar with the code it would be hard to know what to do</p>



<a name="154430941"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353488%20closure%20and%20disjoint%20fields/near/154430941" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> blitzerr <a href="https://rust-lang.github.io/zulip_archive/stream/122657-t-compiler/wg-nll/topic/.2353488.20closure.20and.20disjoint.20fields.html#154430941">(Jan 04 2019 at 19:31)</a>:</h4>
<p><span class="user-mention" data-user-id="116009">@nikomatsakis</span> <br>
Sure we can pick up the tuple introduction part. A pair programming sounds like a great idea. I want to do that ever since I read <a href="https://www.newyorker.com/magazine/2018/12/10/the-friendship-that-made-google-huge" target="_blank" title="https://www.newyorker.com/magazine/2018/12/10/the-friendship-that-made-google-huge">this</a></p>



<a name="154432369"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353488%20closure%20and%20disjoint%20fields/near/154432369" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://rust-lang.github.io/zulip_archive/stream/122657-t-compiler/wg-nll/topic/.2353488.20closure.20and.20disjoint.20fields.html#154432369">(Jan 04 2019 at 19:53)</a>:</h4>
<p><span class="user-mention" data-user-id="128294">@blitzerr</span> then we need to schedule a slot :)</p>



<a name="154432537"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353488%20closure%20and%20disjoint%20fields/near/154432537" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> blitzerr <a href="https://rust-lang.github.io/zulip_archive/stream/122657-t-compiler/wg-nll/topic/.2353488.20closure.20and.20disjoint.20fields.html#154432537">(Jan 04 2019 at 19:55)</a>:</h4>
<p><span class="user-mention" data-user-id="116009">@nikomatsakis</span>  Awesome ! How does your schedule look like next week ?</p>



<a name="154585831"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353488%20closure%20and%20disjoint%20fields/near/154585831" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> blitzerr <a href="https://rust-lang.github.io/zulip_archive/stream/122657-t-compiler/wg-nll/topic/.2353488.20closure.20and.20disjoint.20fields.html#154585831">(Jan 07 2019 at 17:38)</a>:</h4>
<p><span class="user-mention" data-user-id="116009">@nikomatsakis</span>  <a href="https://github.com/rust-lang/rust/commit/923042e1d9a59edb7fdef579f666299a29103afa" target="_blank" title="https://github.com/rust-lang/rust/commit/923042e1d9a59edb7fdef579f666299a29103afa">New commit</a>.  Any chance you can take a look at that ?</p>



<a name="154585861"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353488%20closure%20and%20disjoint%20fields/near/154585861" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> blitzerr <a href="https://rust-lang.github.io/zulip_archive/stream/122657-t-compiler/wg-nll/topic/.2353488.20closure.20and.20disjoint.20fields.html#154585861">(Jan 07 2019 at 17:39)</a>:</h4>
<p>It's the same one from last week, no changes</p>



<a name="154590808"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353488%20closure%20and%20disjoint%20fields/near/154590808" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://rust-lang.github.io/zulip_archive/stream/122657-t-compiler/wg-nll/topic/.2353488.20closure.20and.20disjoint.20fields.html#154590808">(Jan 07 2019 at 18:49)</a>:</h4>
<p>from a brief glance it looks good to me :)</p>



<a name="154668815"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353488%20closure%20and%20disjoint%20fields/near/154668815" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://rust-lang.github.io/zulip_archive/stream/122657-t-compiler/wg-nll/topic/.2353488.20closure.20and.20disjoint.20fields.html#154668815">(Jan 08 2019 at 19:15)</a>:</h4>
<p><span class="user-mention" data-user-id="128294">@blitzerr</span> <a href="https://github.com/rust-lang/rust/pull/56906#pullrequestreview-190396095" target="_blank" title="https://github.com/rust-lang/rust/pull/56906#pullrequestreview-190396095">posted a review</a></p>



<a name="154669575"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353488%20closure%20and%20disjoint%20fields/near/154669575" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> blitzerr <a href="https://rust-lang.github.io/zulip_archive/stream/122657-t-compiler/wg-nll/topic/.2353488.20closure.20and.20disjoint.20fields.html#154669575">(Jan 08 2019 at 19:25)</a>:</h4>
<p>Thank you for your time <span class="user-mention" data-user-id="116009">@nikomatsakis</span> . I will submit an update for this one tonight.</p>



<a name="154696599"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353488%20closure%20and%20disjoint%20fields/near/154696599" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> blitzerr <a href="https://rust-lang.github.io/zulip_archive/stream/122657-t-compiler/wg-nll/topic/.2353488.20closure.20and.20disjoint.20fields.html#154696599">(Jan 09 2019 at 03:26)</a>:</h4>
<p><span class="user-mention" data-user-id="116009">@nikomatsakis</span>  <a href="https://github.com/rust-lang/rust/pull/56906/commits/69e491815d927b3206c8acf88fbdbed8521e5955" target="_blank" title="https://github.com/rust-lang/rust/pull/56906/commits/69e491815d927b3206c8acf88fbdbed8521e5955">update</a></p>



<a name="154696602"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353488%20closure%20and%20disjoint%20fields/near/154696602" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> blitzerr <a href="https://rust-lang.github.io/zulip_archive/stream/122657-t-compiler/wg-nll/topic/.2353488.20closure.20and.20disjoint.20fields.html#154696602">(Jan 09 2019 at 03:26)</a>:</h4>
<p>Addressed your comments and posted another update</p>



<a name="154729319"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353488%20closure%20and%20disjoint%20fields/near/154729319" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://rust-lang.github.io/zulip_archive/stream/122657-t-compiler/wg-nll/topic/.2353488.20closure.20and.20disjoint.20fields.html#154729319">(Jan 09 2019 at 14:55)</a>:</h4>
<p>r+'d</p>



<a name="154862292"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353488%20closure%20and%20disjoint%20fields/near/154862292" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> blitzerr <a href="https://rust-lang.github.io/zulip_archive/stream/122657-t-compiler/wg-nll/topic/.2353488.20closure.20and.20disjoint.20fields.html#154862292">(Jan 10 2019 at 18:56)</a>:</h4>
<p><span class="user-mention" data-user-id="116009">@nikomatsakis</span>  Created <a href="https://github.com/rust-lang/rust/issues/57482" target="_blank" title="https://github.com/rust-lang/rust/issues/57482">New Issue</a> for the work on making the "upvar types" a tuple of the actual upvar types work item</p>



<a name="154864370"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353488%20closure%20and%20disjoint%20fields/near/154864370" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://rust-lang.github.io/zulip_archive/stream/122657-t-compiler/wg-nll/topic/.2353488.20closure.20and.20disjoint.20fields.html#154864370">(Jan 10 2019 at 19:24)</a>:</h4>
<p>great</p>



<a name="155039654"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353488%20closure%20and%20disjoint%20fields/near/155039654" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> blitzerr <a href="https://rust-lang.github.io/zulip_archive/stream/122657-t-compiler/wg-nll/topic/.2353488.20closure.20and.20disjoint.20fields.html#155039654">(Jan 13 2019 at 17:48)</a>:</h4>
<p><span class="user-mention" data-user-id="116009">@nikomatsakis</span> <br>
<a href="https://github.com/rust-lang/rust/compare/master...blitzerr:upvar-tuple" target="_blank" title="https://github.com/rust-lang/rust/compare/master...blitzerr:upvar-tuple">Changes so far</a><br>
What it addresses</p>
<ul>
<li>Make ClosureSubsts return a tuple of the types (I re-did this to understand the code better).</li>
<li>Make GeneratorSubsts return a tuple of the types</li>
<li>Created a helper that returns an option of [Ty] to be used by the ppaux code for both generators and closures.</li>
</ul>
<p>What remains is change the lifetime parameters from <code>tcx: TyCtxt&lt;'_, '_, 'tcx&gt;</code> to<code> tcx: TyCtxt&lt;'_, 'tcx 'tcx&gt;</code><br>
I want to ask that in <a href="https://github.com/rust-lang/rust/blob/1c561d9b55aabc7df484f8faba24430421aee998/src/librustc/ty/sty.rs#L464" target="_blank" title="https://github.com/rust-lang/rust/blob/1c561d9b55aabc7df484f8faba24430421aee998/src/librustc/ty/sty.rs#L464">this</a> case, the generator takes <code>'gcx</code> lifetime and changing that to the <code>'tcx</code> does not look good. Any ideas on how to do it or not do it at all ?</p>



<a name="155091632"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353488%20closure%20and%20disjoint%20fields/near/155091632" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> csmoe <a href="https://rust-lang.github.io/zulip_archive/stream/122657-t-compiler/wg-nll/topic/.2353488.20closure.20and.20disjoint.20fields.html#155091632">(Jan 14 2019 at 15:27)</a>:</h4>
<p><span class="user-mention" data-user-id="116266">@Santiago Pastorino</span> okay <span class="emoji emoji-1f642" title="slight smile">:slight_smile:</span></p>



<a name="155111903"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353488%20closure%20and%20disjoint%20fields/near/155111903" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> blitzerr <a href="https://rust-lang.github.io/zulip_archive/stream/122657-t-compiler/wg-nll/topic/.2353488.20closure.20and.20disjoint.20fields.html#155111903">(Jan 14 2019 at 20:00)</a>:</h4>
<p><span class="user-mention" data-user-id="116009">@nikomatsakis</span>  <span class="emoji emoji-1f446" title="point up">:point_up:</span></p>



<a name="155197109"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353488%20closure%20and%20disjoint%20fields/near/155197109" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://rust-lang.github.io/zulip_archive/stream/122657-t-compiler/wg-nll/topic/.2353488.20closure.20and.20disjoint.20fields.html#155197109">(Jan 15 2019 at 19:30)</a>:</h4>
<p><span class="user-mention" data-user-id="128294">@blitzerr</span> nice! will review shortly</p>



<a name="155203834"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353488%20closure%20and%20disjoint%20fields/near/155203834" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://rust-lang.github.io/zulip_archive/stream/122657-t-compiler/wg-nll/topic/.2353488.20closure.20and.20disjoint.20fields.html#155203834">(Jan 15 2019 at 21:00)</a>:</h4>
<p><span class="user-mention" data-user-id="128294">@blitzerr</span> left various comments on the commits</p>



<a name="155206845"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353488%20closure%20and%20disjoint%20fields/near/155206845" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> blitzerr <a href="https://rust-lang.github.io/zulip_archive/stream/122657-t-compiler/wg-nll/topic/.2353488.20closure.20and.20disjoint.20fields.html#155206845">(Jan 15 2019 at 21:39)</a>:</h4>
<p>Thanks a lot <span class="user-mention" data-user-id="116009">@nikomatsakis</span> <br>
Regarding naming I agree with the inconsistent part. What do you suggest, we adopt the clear naming (by this I mean, refactor the existing code to adopt the new name) or stick to the old convention ?</p>



<a name="155206925"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353488%20closure%20and%20disjoint%20fields/near/155206925" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> blitzerr <a href="https://rust-lang.github.io/zulip_archive/stream/122657-t-compiler/wg-nll/topic/.2353488.20closure.20and.20disjoint.20fields.html#155206925">(Jan 15 2019 at 21:40)</a>:</h4>
<p>(deleted)</p>



<a name="155206960"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353488%20closure%20and%20disjoint%20fields/near/155206960" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> blitzerr <a href="https://rust-lang.github.io/zulip_archive/stream/122657-t-compiler/wg-nll/topic/.2353488.20closure.20and.20disjoint.20fields.html#155206960">(Jan 15 2019 at 21:41)</a>:</h4>
<blockquote>
<p>What remains is change the lifetime parameters from <code>tcx: TyCtxt&lt;'_, '_, 'tcx&gt;</code> to<code> tcx: TyCtxt&lt;'_, 'tcx 'tcx&gt;</code><br>
I want to ask that in <a href="https://github.com/rust-lang/rust/blob/1c561d9b55aabc7df484f8faba24430421aee998/src/librustc/ty/sty.rs#L464" target="_blank" title="https://github.com/rust-lang/rust/blob/1c561d9b55aabc7df484f8faba24430421aee998/src/librustc/ty/sty.rs#L464">this</a> case, the generator takes <code>'gcx</code> lifetime and changing that to the <code>'tcx</code> does not look good. Any ideas on how to do it or not do it at all</p>
</blockquote>



<a name="155207015"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353488%20closure%20and%20disjoint%20fields/near/155207015" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> blitzerr <a href="https://rust-lang.github.io/zulip_archive/stream/122657-t-compiler/wg-nll/topic/.2353488.20closure.20and.20disjoint.20fields.html#155207015">(Jan 15 2019 at 21:42)</a>:</h4>
<p>Any ideas on that one <span class="emoji emoji-1f446" title="point up">:point_up:</span></p>



<a name="155272360"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353488%20closure%20and%20disjoint%20fields/near/155272360" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> blitzerr <a href="https://rust-lang.github.io/zulip_archive/stream/122657-t-compiler/wg-nll/topic/.2353488.20closure.20and.20disjoint.20fields.html#155272360">(Jan 16 2019 at 17:40)</a>:</h4>
<p><span class="user-mention" data-user-id="116009">@nikomatsakis</span> <br>
Addressed your comments <a href="https://github.com/rust-lang/rust/commit/61a1d2c75d?diff=split" target="_blank" title="https://github.com/rust-lang/rust/commit/61a1d2c75d?diff=split">here</a></p>



<a name="155274922"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353488%20closure%20and%20disjoint%20fields/near/155274922" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://rust-lang.github.io/zulip_archive/stream/122657-t-compiler/wg-nll/topic/.2353488.20closure.20and.20disjoint.20fields.html#155274922">(Jan 16 2019 at 18:16)</a>:</h4>
<p><span class="user-mention" data-user-id="128294">@blitzerr</span> <a href="https://github.com/rust-lang/rust/commit/61a1d2c75d?diff=split#r31963272" target="_blank" title="https://github.com/rust-lang/rust/commit/61a1d2c75d?diff=split#r31963272">comment</a> -- the logic in ppaux still doesn't seem quite right to me</p>



<a name="155275734"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353488%20closure%20and%20disjoint%20fields/near/155275734" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> blitzerr <a href="https://rust-lang.github.io/zulip_archive/stream/122657-t-compiler/wg-nll/topic/.2353488.20closure.20and.20disjoint.20fields.html#155275734">(Jan 16 2019 at 18:27)</a>:</h4>
<p>I added a comment and maybe we can iterate here more quickly?<br>
"<br>
Are you saying that we can be in a situation where the type is neither a type or an inference variable ?<br>
In that case we will already panic as the code stands in src/librustc/ty/sty.rs(line 389 of this commit)</p>
<p>And this code will do that right? In case of an inference variable the opt_tuple_tys returns an empty list and so the some branch will do the usual running through an empty list ?<br>
"</p>



<a name="155275758"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353488%20closure%20and%20disjoint%20fields/near/155275758" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> blitzerr <a href="https://rust-lang.github.io/zulip_archive/stream/122657-t-compiler/wg-nll/topic/.2353488.20closure.20and.20disjoint.20fields.html#155275758">(Jan 16 2019 at 18:27)</a>:</h4>
<p><span class="user-mention" data-user-id="116009">@nikomatsakis</span>  <span class="emoji emoji-261d" title="point of information">:point_of_information:</span></p>



<a name="155275833"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353488%20closure%20and%20disjoint%20fields/near/155275833" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://rust-lang.github.io/zulip_archive/stream/122657-t-compiler/wg-nll/topic/.2353488.20closure.20and.20disjoint.20fields.html#155275833">(Jan 16 2019 at 18:28)</a>:</h4>
<blockquote>
<p>Are you saying that we can be in a situation where the type is neither a type or an inference variable ?</p>
</blockquote>
<p>do you mean neither a tuple nor an inference variable? If so, I'm not saying that, it should always be one of those 2 things.</p>



<a name="155275847"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353488%20closure%20and%20disjoint%20fields/near/155275847" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://rust-lang.github.io/zulip_archive/stream/122657-t-compiler/wg-nll/topic/.2353488.20closure.20and.20disjoint.20fields.html#155275847">(Jan 16 2019 at 18:28)</a>:</h4>
<blockquote>
<p>In case of an inference variable the opt_tuple_tys returns an empty list</p>
</blockquote>
<p>ah, I missed that maybe</p>



<a name="155275896"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353488%20closure%20and%20disjoint%20fields/near/155275896" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://rust-lang.github.io/zulip_archive/stream/122657-t-compiler/wg-nll/topic/.2353488.20closure.20and.20disjoint.20fields.html#155275896">(Jan 16 2019 at 18:29)</a>:</h4>
<p>this is the definition of <code>opt_tuple_tys</code> that I see</p>
<div class="codehilite"><pre><span></span><span class="w"> </span><span class="sd">/// This is safe to be called even when the upvar type parameters are not</span>
<span class="w">    </span><span class="sd">/// bound and is exactly called for that same reason.</span>
<span class="w">    </span><span class="k">pub</span><span class="w"> </span><span class="k">fn</span> <span class="nf">opt_tuple_tys</span><span class="p">(</span><span class="w"></span>
<span class="w">        </span><span class="bp">self</span><span class="p">,</span><span class="w"></span>
<span class="w">        </span><span class="n">def_id</span>: <span class="nc">DefId</span><span class="p">,</span><span class="w"></span>
<span class="w">        </span><span class="n">tcx</span>: <span class="nc">TyCtxt</span><span class="o">&lt;</span><span class="na">&#39;_</span><span class="p">,</span><span class="w"> </span><span class="na">&#39;_</span><span class="p">,</span><span class="w"> </span><span class="na">&#39;tcx</span><span class="o">&gt;</span><span class="p">,</span><span class="w"></span>
<span class="w">    </span><span class="p">)</span><span class="w"> </span>-&gt; <span class="nb">Option</span><span class="o">&lt;</span><span class="k">impl</span><span class="w"> </span><span class="nb">Iterator</span><span class="o">&lt;</span><span class="n">Item</span><span class="o">=</span><span class="n">Ty</span><span class="o">&lt;</span><span class="na">&#39;tcx</span><span class="o">&gt;&gt;</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="na">&#39;tcx</span><span class="o">&gt;</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">        </span><span class="k">match</span><span class="w"> </span><span class="bp">self</span><span class="p">.</span><span class="n">upvar_tuple_ty_or_infer_var</span><span class="p">(</span><span class="n">def_id</span><span class="p">,</span><span class="w"> </span><span class="n">tcx</span><span class="p">).</span><span class="n">sty</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">            </span><span class="n">ty</span>::<span class="n">Tuple</span><span class="p">(</span><span class="n">tys</span><span class="p">)</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="nb">Some</span><span class="p">(</span><span class="n">tys</span><span class="p">.</span><span class="n">iter</span><span class="p">().</span><span class="n">cloned</span><span class="p">()),</span><span class="w"></span>
<span class="w">            </span><span class="k">ref</span><span class="w"> </span><span class="n">_t</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="nb">None</span><span class="p">,</span><span class="w"></span>
</pre></div>



<a name="155275906"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353488%20closure%20and%20disjoint%20fields/near/155275906" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://rust-lang.github.io/zulip_archive/stream/122657-t-compiler/wg-nll/topic/.2353488.20closure.20and.20disjoint.20fields.html#155275906">(Jan 16 2019 at 18:29)</a>:</h4>
<p>looks like it returns <code>None</code>, not an empty loop</p>



<a name="155275949"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353488%20closure%20and%20disjoint%20fields/near/155275949" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://rust-lang.github.io/zulip_archive/stream/122657-t-compiler/wg-nll/topic/.2353488.20closure.20and.20disjoint.20fields.html#155275949">(Jan 16 2019 at 18:30)</a>:</h4>
<p>which actually I think is the right thing</p>



<a name="155276132"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353488%20closure%20and%20disjoint%20fields/near/155276132" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> blitzerr <a href="https://rust-lang.github.io/zulip_archive/stream/122657-t-compiler/wg-nll/topic/.2353488.20closure.20and.20disjoint.20fields.html#155276132">(Jan 16 2019 at 18:32)</a>:</h4>
<div class="codehilite"><pre><span></span><span class="k">pub</span><span class="w"> </span><span class="k">fn</span> <span class="nf">opt_tuple_tys</span><span class="p">(</span><span class="w"></span>
<span class="w">        </span><span class="bp">self</span><span class="p">,</span><span class="w"></span>
<span class="w">        </span><span class="bp">self</span><span class="p">,</span><span class="w"></span>
<span class="w">        </span><span class="n">def_id</span>: <span class="nc">DefId</span><span class="p">,</span><span class="w"></span>
<span class="w">        </span><span class="n">def_id</span>: <span class="nc">DefId</span><span class="p">,</span><span class="w"></span>
<span class="w">        </span><span class="n">tcx</span>: <span class="nc">TyCtxt</span><span class="o">&lt;</span><span class="na">&#39;_</span><span class="p">,</span><span class="w"> </span><span class="na">&#39;_</span><span class="p">,</span><span class="w"> </span><span class="na">&#39;tcx</span><span class="o">&gt;</span><span class="p">,</span><span class="w"></span>
<span class="w">        </span><span class="n">tcx</span>: <span class="nc">TyCtxt</span><span class="o">&lt;</span><span class="na">&#39;_</span><span class="p">,</span><span class="w"> </span><span class="na">&#39;_</span><span class="p">,</span><span class="w"> </span><span class="na">&#39;tcx</span><span class="o">&gt;</span><span class="p">,</span><span class="w"></span>
<span class="w">    </span><span class="p">)</span><span class="w"> </span>-&gt; <span class="nb">Option</span><span class="o">&lt;</span><span class="k">impl</span><span class="w"> </span><span class="nb">Iterator</span><span class="o">&lt;</span><span class="n">Item</span><span class="o">=</span><span class="n">Ty</span><span class="o">&lt;</span><span class="na">&#39;tcx</span><span class="o">&gt;&gt;</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="na">&#39;tcx</span><span class="o">&gt;</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="p">)</span><span class="w"> </span>-&gt; <span class="nb">Option</span><span class="o">&lt;</span><span class="k">impl</span><span class="w"> </span><span class="nb">Iterator</span><span class="o">&lt;</span><span class="n">Item</span><span class="o">=</span><span class="n">Ty</span><span class="o">&lt;</span><span class="na">&#39;tcx</span><span class="o">&gt;&gt;</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="na">&#39;tcx</span><span class="o">&gt;</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">        </span><span class="k">match</span><span class="w"> </span><span class="bp">self</span><span class="p">.</span><span class="n">upvar_tuple_ty_or_infer_var</span><span class="p">(</span><span class="n">def_id</span><span class="p">,</span><span class="w"> </span><span class="n">tcx</span><span class="p">).</span><span class="n">sty</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">        </span><span class="k">match</span><span class="w"> </span><span class="bp">self</span><span class="p">.</span><span class="n">upvar_tuple_ty</span><span class="p">(</span><span class="n">def_id</span><span class="p">,</span><span class="w"> </span><span class="n">tcx</span><span class="p">).</span><span class="n">sty</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">            </span><span class="n">ty</span>::<span class="n">Tuple</span><span class="p">(</span><span class="n">tys</span><span class="p">)</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="nb">Some</span><span class="p">(</span><span class="n">tys</span><span class="p">.</span><span class="n">iter</span><span class="p">().</span><span class="n">cloned</span><span class="p">()),</span><span class="w"></span>
<span class="w">            </span><span class="n">ty</span>::<span class="n">Tuple</span><span class="p">(</span><span class="n">tys</span><span class="p">)</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="nb">Some</span><span class="p">(</span><span class="n">tys</span><span class="p">.</span><span class="n">iter</span><span class="p">().</span><span class="n">cloned</span><span class="p">()),</span><span class="w"></span>
<span class="w">            </span><span class="k">ref</span><span class="w"> </span><span class="n">_t</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="nb">None</span><span class="p">,</span><span class="w"></span>
<span class="w">            </span><span class="n">ty</span>::<span class="n">Infer</span><span class="p">(</span><span class="n">_</span><span class="p">)</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="nb">Some</span><span class="p">(</span><span class="n">ty</span>::<span class="n">List</span>::<span class="n">empty</span><span class="p">().</span><span class="n">iter</span><span class="p">().</span><span class="n">cloned</span><span class="p">()),</span><span class="w"></span>
<span class="w">            </span><span class="n">_</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="n">bug</span><span class="o">!</span><span class="p">(</span><span class="s">&quot;unexpected type&quot;</span><span class="p">)</span><span class="w"></span>
<span class="w">        </span><span class="p">}</span><span class="w"></span>
<span class="w">        </span><span class="p">}</span><span class="w"></span>
<span class="w">    </span><span class="p">}</span><span class="w"></span>
<span class="w">    </span><span class="p">}</span><span class="w"></span>
</pre></div>



<a name="155276143"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353488%20closure%20and%20disjoint%20fields/near/155276143" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> blitzerr <a href="https://rust-lang.github.io/zulip_archive/stream/122657-t-compiler/wg-nll/topic/.2353488.20closure.20and.20disjoint.20fields.html#155276143">(Jan 16 2019 at 18:32)</a>:</h4>
<p>This is what I see on the <a href="https://github.com/rust-lang/rust/commit/61a1d2c75d?diff=split" target="_blank" title="https://github.com/rust-lang/rust/commit/61a1d2c75d?diff=split">commit</a></p>



<a name="155276449"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353488%20closure%20and%20disjoint%20fields/near/155276449" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> blitzerr <a href="https://rust-lang.github.io/zulip_archive/stream/122657-t-compiler/wg-nll/topic/.2353488.20closure.20and.20disjoint.20fields.html#155276449">(Jan 16 2019 at 18:36)</a>:</h4>
<p><a href="https://github.com/rust-lang/rust/commit/61a1d2c75d?diff=split#diff-b180e2fcc6ac765371cbd5b1dc95c914R386" target="_blank" title="https://github.com/rust-lang/rust/commit/61a1d2c75d?diff=split#diff-b180e2fcc6ac765371cbd5b1dc95c914R386">here</a><br>
and<br>
<a href="https://github.com/rust-lang/rust/commit/61a1d2c75d?diff=split#diff-b180e2fcc6ac765371cbd5b1dc95c914R491" target="_blank" title="https://github.com/rust-lang/rust/commit/61a1d2c75d?diff=split#diff-b180e2fcc6ac765371cbd5b1dc95c914R491">here</a></p>



<a name="155276466"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353488%20closure%20and%20disjoint%20fields/near/155276466" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> blitzerr <a href="https://rust-lang.github.io/zulip_archive/stream/122657-t-compiler/wg-nll/topic/.2353488.20closure.20and.20disjoint.20fields.html#155276466">(Jan 16 2019 at 18:37)</a>:</h4>
<p><span class="user-mention" data-user-id="116009">@nikomatsakis</span> <span class="emoji emoji-261d" title="point of information">:point_of_information:</span></p>



<a name="155276481"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353488%20closure%20and%20disjoint%20fields/near/155276481" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://rust-lang.github.io/zulip_archive/stream/122657-t-compiler/wg-nll/topic/.2353488.20closure.20and.20disjoint.20fields.html#155276481">(Jan 16 2019 at 18:37)</a>:</h4>
<p>ok</p>



<a name="155276486"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353488%20closure%20and%20disjoint%20fields/near/155276486" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://rust-lang.github.io/zulip_archive/stream/122657-t-compiler/wg-nll/topic/.2353488.20closure.20and.20disjoint.20fields.html#155276486">(Jan 16 2019 at 18:37)</a>:</h4>
<p>I personally thikn I would still return <code>None</code> for infer</p>



<a name="155276496"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353488%20closure%20and%20disjoint%20fields/near/155276496" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://rust-lang.github.io/zulip_archive/stream/122657-t-compiler/wg-nll/topic/.2353488.20closure.20and.20disjoint.20fields.html#155276496">(Jan 16 2019 at 18:37)</a>:</h4>
<p>otherwise, you can't tell the difference between "no upvars"</p>



<a name="155276510"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353488%20closure%20and%20disjoint%20fields/near/155276510" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://rust-lang.github.io/zulip_archive/stream/122657-t-compiler/wg-nll/topic/.2353488.20closure.20and.20disjoint.20fields.html#155276510">(Jan 16 2019 at 18:37)</a>:</h4>
<p>and "upvars not yet known"</p>



<a name="155276515"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353488%20closure%20and%20disjoint%20fields/near/155276515" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://rust-lang.github.io/zulip_archive/stream/122657-t-compiler/wg-nll/topic/.2353488.20closure.20and.20disjoint.20fields.html#155276515">(Jan 16 2019 at 18:38)</a>:</h4>
<p>but at the caller site, if you don't care about that difference (which we probably don't),</p>



<a name="155276566"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353488%20closure%20and%20disjoint%20fields/near/155276566" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://rust-lang.github.io/zulip_archive/stream/122657-t-compiler/wg-nll/topic/.2353488.20closure.20and.20disjoint.20fields.html#155276566">(Jan 16 2019 at 18:38)</a>:</h4>
<p>we can just do <code>opt_tuple_tys().unwrap_or(&amp;[])</code> or something</p>



<a name="155276575"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353488%20closure%20and%20disjoint%20fields/near/155276575" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://rust-lang.github.io/zulip_archive/stream/122657-t-compiler/wg-nll/topic/.2353488.20closure.20and.20disjoint.20fields.html#155276575">(Jan 16 2019 at 18:38)</a>:</h4>
<p>specifically I think I would return <code>Option&lt;&amp;[Ty&lt;'tcx&gt;]&gt;</code></p>



<a name="155276606"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353488%20closure%20and%20disjoint%20fields/near/155276606" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> blitzerr <a href="https://rust-lang.github.io/zulip_archive/stream/122657-t-compiler/wg-nll/topic/.2353488.20closure.20and.20disjoint.20fields.html#155276606">(Jan 16 2019 at 18:39)</a>:</h4>
<p>The upvars tuple vs not inferred yet can be obtained from the list being filled vs empty.</p>



<a name="155276623"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353488%20closure%20and%20disjoint%20fields/near/155276623" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> blitzerr <a href="https://rust-lang.github.io/zulip_archive/stream/122657-t-compiler/wg-nll/topic/.2353488.20closure.20and.20disjoint.20fields.html#155276623">(Jan 16 2019 at 18:39)</a>:</h4>
<p>But I do get your point.</p>



<a name="155276633"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353488%20closure%20and%20disjoint%20fields/near/155276633" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://rust-lang.github.io/zulip_archive/stream/122657-t-compiler/wg-nll/topic/.2353488.20closure.20and.20disjoint.20fields.html#155276633">(Jan 16 2019 at 18:39)</a>:</h4>
<p>I'm not sure how you can tell it is filled if the list is empty</p>



<a name="155276642"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353488%20closure%20and%20disjoint%20fields/near/155276642" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://rust-lang.github.io/zulip_archive/stream/122657-t-compiler/wg-nll/topic/.2353488.20closure.20and.20disjoint.20fields.html#155276642">(Jan 16 2019 at 18:39)</a>:</h4>
<p>also, why return <code>Option</code> if you never return <code>None</code> =)</p>



<a name="155276702"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353488%20closure%20and%20disjoint%20fields/near/155276702" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> blitzerr <a href="https://rust-lang.github.io/zulip_archive/stream/122657-t-compiler/wg-nll/topic/.2353488.20closure.20and.20disjoint.20fields.html#155276702">(Jan 16 2019 at 18:40)</a>:</h4>
<p>That's true <span class="emoji emoji-1f642" title="slight smile">:slight_smile:</span></p>



<a name="155276730"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353488%20closure%20and%20disjoint%20fields/near/155276730" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> blitzerr <a href="https://rust-lang.github.io/zulip_archive/stream/122657-t-compiler/wg-nll/topic/.2353488.20closure.20and.20disjoint.20fields.html#155276730">(Jan 16 2019 at 18:40)</a>:</h4>
<p>So you want it to not return an iterator anymore ?</p>



<a name="155276773"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353488%20closure%20and%20disjoint%20fields/near/155276773" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> blitzerr <a href="https://rust-lang.github.io/zulip_archive/stream/122657-t-compiler/wg-nll/topic/.2353488.20closure.20and.20disjoint.20fields.html#155276773">(Jan 16 2019 at 18:41)</a>:</h4>
<p><span class="user-mention" data-user-id="116009">@nikomatsakis</span>  Is that because it will save us from cloning ?</p>



<a name="155276864"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353488%20closure%20and%20disjoint%20fields/near/155276864" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://rust-lang.github.io/zulip_archive/stream/122657-t-compiler/wg-nll/topic/.2353488.20closure.20and.20disjoint.20fields.html#155276864">(Jan 16 2019 at 18:42)</a>:</h4>
<p>I would return a slice just because it's more convenient for everyone</p>



<a name="155276902"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353488%20closure%20and%20disjoint%20fields/near/155276902" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> blitzerr <a href="https://rust-lang.github.io/zulip_archive/stream/122657-t-compiler/wg-nll/topic/.2353488.20closure.20and.20disjoint.20fields.html#155276902">(Jan 16 2019 at 18:43)</a>:</h4>
<p>I get your suggestions now. Sorry for the confusion. Unfortunately, I can only implement this tonight <span class="emoji emoji-1f641" title="frown">:frown:</span></p>



<a name="155276928"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353488%20closure%20and%20disjoint%20fields/near/155276928" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> blitzerr <a href="https://rust-lang.github.io/zulip_archive/stream/122657-t-compiler/wg-nll/topic/.2353488.20closure.20and.20disjoint.20fields.html#155276928">(Jan 16 2019 at 18:43)</a>:</h4>
<p>I agree with you <span class="user-mention" data-user-id="116009">@nikomatsakis</span>  The syntax is much nicer <span class="emoji emoji-1f642" title="slight smile">:slight_smile:</span></p>



<a name="155277151"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353488%20closure%20and%20disjoint%20fields/near/155277151" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> blitzerr <a href="https://rust-lang.github.io/zulip_archive/stream/122657-t-compiler/wg-nll/topic/.2353488.20closure.20and.20disjoint.20fields.html#155277151">(Jan 16 2019 at 18:46)</a>:</h4>
<p><span class="user-mention" data-user-id="116009">@nikomatsakis</span>  While I have your attention, any thoughts on </p>
<div class="codehilite"><pre><span></span>What remains is change the lifetime parameters from tcx: TyCtxt&amp;lt;&#39;_, &#39;_, &#39;tcx&amp;gt; to tcx: TyCtxt&amp;lt;&#39;_, &#39;tcx &#39;tcx&amp;gt;
I want to ask that in this case, the generator takes &#39;gcx lifetime and changing that to the &#39;tcx does not look good. Any ideas on how to do it or not do it at all ?
</pre></div>



<a name="155278412"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353488%20closure%20and%20disjoint%20fields/near/155278412" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://rust-lang.github.io/zulip_archive/stream/122657-t-compiler/wg-nll/topic/.2353488.20closure.20and.20disjoint.20fields.html#155278412">(Jan 16 2019 at 19:02)</a>:</h4>
<p><span class="user-mention" data-user-id="128294">@blitzerr</span> er that is hard to read</p>



<a name="155278415"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353488%20closure%20and%20disjoint%20fields/near/155278415" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://rust-lang.github.io/zulip_archive/stream/122657-t-compiler/wg-nll/topic/.2353488.20closure.20and.20disjoint.20fields.html#155278415">(Jan 16 2019 at 19:02)</a>:</h4>
<p>what's the question exactly?</p>



<a name="155278429"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353488%20closure%20and%20disjoint%20fields/near/155278429" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://rust-lang.github.io/zulip_archive/stream/122657-t-compiler/wg-nll/topic/.2353488.20closure.20and.20disjoint.20fields.html#155278429">(Jan 16 2019 at 19:03)</a>:</h4>
<p>maybe re-paste it without the "```"</p>



<a name="155307647"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353488%20closure%20and%20disjoint%20fields/near/155307647" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> blitzerr <a href="https://rust-lang.github.io/zulip_archive/stream/122657-t-compiler/wg-nll/topic/.2353488.20closure.20and.20disjoint.20fields.html#155307647">(Jan 17 2019 at 03:14)</a>:</h4>
<p><span class="user-mention" data-user-id="116009">@nikomatsakis</span> <br>
As we <a href="https://github.com/rust-lang/rust/commit/59a6a0c400" target="_blank" title="https://github.com/rust-lang/rust/commit/59a6a0c400">discussed</a></p>



<a name="155311012"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353488%20closure%20and%20disjoint%20fields/near/155311012" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> blitzerr <a href="https://rust-lang.github.io/zulip_archive/stream/122657-t-compiler/wg-nll/topic/.2353488.20closure.20and.20disjoint.20fields.html#155311012">(Jan 17 2019 at 04:46)</a>:</h4>
<div class="codehilite"><pre><span></span><span class="n">error</span><span class="p">[</span><span class="n">E0700</span><span class="p">]</span>: <span class="nc">hidden</span><span class="w"> </span><span class="k">type</span> <span class="nc">for</span><span class="w"> </span><span class="err">`</span><span class="k">impl</span><span class="w"> </span><span class="n">Trait</span><span class="err">`</span><span class="w"> </span><span class="n">captures</span><span class="w"> </span><span class="n">lifetime</span><span class="w"> </span><span class="n">that</span><span class="w"> </span><span class="n">does</span><span class="w"> </span><span class="n">not</span><span class="w"> </span><span class="n">appear</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="n">bounds</span><span class="w"></span>
<span class="w">   </span><span class="o">-</span>-&gt; <span class="nc">src</span><span class="o">/</span><span class="n">librustc</span><span class="o">/</span><span class="n">ty</span><span class="o">/</span><span class="n">sty</span><span class="p">.</span><span class="n">rs</span>:<span class="mi">549</span>:<span class="mi">9</span><span class="w"></span>
<span class="w">    </span><span class="o">|</span><span class="w"></span>
<span class="mi">549</span><span class="w"> </span><span class="o">|</span><span class="w">         </span><span class="k">impl</span><span class="w"> </span><span class="nb">Iterator</span><span class="o">&lt;</span><span class="n">Item</span><span class="o">=</span><span class="n">Ty</span><span class="o">&lt;</span><span class="na">&#39;tcx</span><span class="o">&gt;&gt;</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="na">&#39;a</span><span class="w"></span>
<span class="w">    </span><span class="o">|</span><span class="w">         </span><span class="o">^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^</span><span class="w"></span>
<span class="w">    </span><span class="o">|</span><span class="w"></span>
<span class="n">note</span>: <span class="nc">hidden</span><span class="w"> </span><span class="k">type</span> <span class="err">`</span><span class="n">std</span>::<span class="n">iter</span>::<span class="n">Chain</span><span class="o">&lt;</span><span class="k">impl</span><span class="w"> </span><span class="n">std</span>::<span class="n">iter</span>::<span class="nb">Iterator</span><span class="p">,</span><span class="w"> </span><span class="n">std</span>::<span class="n">iter</span>::<span class="n">Once</span><span class="o">&lt;&amp;</span><span class="na">&#39;gcx</span><span class="w"> </span><span class="n">ty</span>::<span class="n">TyS</span><span class="o">&lt;</span><span class="na">&#39;gcx</span><span class="o">&gt;&gt;&gt;</span><span class="err">`</span><span class="w"> </span><span class="n">captures</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">lifetime</span><span class="w"> </span><span class="na">&#39;gcx</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="n">defined</span><span class="w"> </span><span class="n">on</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="k">impl</span><span class="w"> </span><span class="n">at</span><span class="w"> </span><span class="mi">532</span>:<span class="mi">10</span><span class="w"></span>
<span class="w">   </span><span class="o">-</span>-&gt; <span class="nc">src</span><span class="o">/</span><span class="n">librustc</span><span class="o">/</span><span class="n">ty</span><span class="o">/</span><span class="n">sty</span><span class="p">.</span><span class="n">rs</span>:<span class="mi">532</span>:<span class="mi">10</span><span class="w"></span>
<span class="w">    </span><span class="o">|</span><span class="w"></span>
<span class="mi">532</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="k">impl</span><span class="o">&lt;</span><span class="na">&#39;a</span><span class="p">,</span><span class="w"> </span><span class="na">&#39;gcx</span><span class="p">,</span><span class="w"> </span><span class="na">&#39;tcx</span><span class="o">&gt;</span><span class="w"> </span><span class="n">GeneratorSubsts</span><span class="o">&lt;</span><span class="na">&#39;tcx</span><span class="o">&gt;</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="o">|</span><span class="w">          </span><span class="o">^^^^</span><span class="w"></span>

<span class="n">error</span>: <span class="nc">aborting</span><span class="w"> </span><span class="n">due</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="n">previous</span><span class="w"> </span><span class="n">error</span><span class="w"></span>

<span class="n">For</span><span class="w"> </span><span class="n">more</span><span class="w"> </span><span class="n">information</span><span class="w"> </span><span class="n">about</span><span class="w"> </span><span class="n">this</span><span class="w"> </span><span class="n">error</span><span class="p">,</span><span class="w"> </span><span class="n">try</span><span class="w"> </span><span class="err">`</span><span class="n">rustc</span><span class="w"> </span><span class="o">--</span><span class="n">explain</span><span class="w"> </span><span class="n">E0700</span><span class="err">`</span><span class="p">.</span><span class="w"></span>
<span class="n">error</span>: <span class="nc">Could</span><span class="w"> </span><span class="n">not</span><span class="w"> </span><span class="n">compile</span><span class="w"> </span><span class="err">`</span><span class="n">rustc</span><span class="err">`</span><span class="p">.</span><span class="w"></span>
</pre></div>


<p>I get this error when I make this change </p>
<div class="codehilite"><pre><span></span>-    pub fn upvar_tys(self, def_id: DefId, tcx: TyCtxt&lt;&#39;_, &#39;_, &#39;tcx&gt;) -&gt;
+    pub fn upvar_tys(self, def_id: DefId, tcx: TyCtxt&lt;&#39;_, &#39;tcx, &#39;tcx&gt;) -&gt;
</pre></div>



<a name="155311198"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353488%20closure%20and%20disjoint%20fields/near/155311198" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> blitzerr <a href="https://rust-lang.github.io/zulip_archive/stream/122657-t-compiler/wg-nll/topic/.2353488.20closure.20and.20disjoint.20fields.html#155311198">(Jan 17 2019 at 04:51)</a>:</h4>
<p>This is what I meant. Sorry for the confusion and late response.</p>



<a name="155336199"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353488%20closure%20and%20disjoint%20fields/near/155336199" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://rust-lang.github.io/zulip_archive/stream/122657-t-compiler/wg-nll/topic/.2353488.20closure.20and.20disjoint.20fields.html#155336199">(Jan 17 2019 at 13:54)</a>:</h4>
<p>Yeah so that's one of the least favorite impl Trait limitations :)</p>



<a name="155336204"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353488%20closure%20and%20disjoint%20fields/near/155336204" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://rust-lang.github.io/zulip_archive/stream/122657-t-compiler/wg-nll/topic/.2353488.20closure.20and.20disjoint.20fields.html#155336204">(Jan 17 2019 at 13:54)</a>:</h4>
<p>there are workarounds but...before we go there...</p>



<a name="155336323"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353488%20closure%20and%20disjoint%20fields/near/155336323" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://rust-lang.github.io/zulip_archive/stream/122657-t-compiler/wg-nll/topic/.2353488.20closure.20and.20disjoint.20fields.html#155336323">(Jan 17 2019 at 13:56)</a>:</h4>
<p>maybe we can return a slice?</p>



<a name="155336389"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353488%20closure%20and%20disjoint%20fields/near/155336389" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://rust-lang.github.io/zulip_archive/stream/122657-t-compiler/wg-nll/topic/.2353488.20closure.20and.20disjoint.20fields.html#155336389">(Jan 17 2019 at 13:57)</a>:</h4>
<p>btw <span class="user-mention" data-user-id="128294">@blitzerr</span> what branch are you working from on your fork?</p>



<a name="155336508"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353488%20closure%20and%20disjoint%20fields/near/155336508" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://rust-lang.github.io/zulip_archive/stream/122657-t-compiler/wg-nll/topic/.2353488.20closure.20and.20disjoint.20fields.html#155336508">(Jan 17 2019 at 13:58)</a>:</h4>
<p><code>upvar-tuple</code>, I guess</p>



<a name="155336541"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353488%20closure%20and%20disjoint%20fields/near/155336541" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://rust-lang.github.io/zulip_archive/stream/122657-t-compiler/wg-nll/topic/.2353488.20closure.20and.20disjoint.20fields.html#155336541">(Jan 17 2019 at 13:59)</a>:</h4>
<p>anyway so yeah I suspect we <em>can</em> make this a slice now</p>



<a name="155336542"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353488%20closure%20and%20disjoint%20fields/near/155336542" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://rust-lang.github.io/zulip_archive/stream/122657-t-compiler/wg-nll/topic/.2353488.20closure.20and.20disjoint.20fields.html#155336542">(Jan 17 2019 at 13:59)</a>:</h4>
<p>I would just do that</p>



<a name="155336559"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353488%20closure%20and%20disjoint%20fields/near/155336559" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://rust-lang.github.io/zulip_archive/stream/122657-t-compiler/wg-nll/topic/.2353488.20closure.20and.20disjoint.20fields.html#155336559">(Jan 17 2019 at 13:59)</a>:</h4>
<div class="codehilite"><pre><span></span>pub fn upvar_tys(self, def_id: DefId, tcx: TyCtxt&lt;&#39;_, &#39;tcx, &#39;tcx&gt;)  -&gt; &amp;[Ty&lt;&#39;tcx&gt;]
</pre></div>



<a name="155337236"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353488%20closure%20and%20disjoint%20fields/near/155337236" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> blitzerr <a href="https://rust-lang.github.io/zulip_archive/stream/122657-t-compiler/wg-nll/topic/.2353488.20closure.20and.20disjoint.20fields.html#155337236">(Jan 17 2019 at 14:09)</a>:</h4>
<p><span class="user-mention" data-user-id="116009">@nikomatsakis</span> <br>
You guessed it right, upvar-tuple it is. <span class="emoji emoji-1f642" title="slight smile">:slight_smile:</span></p>



<a name="155337533"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353488%20closure%20and%20disjoint%20fields/near/155337533" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> blitzerr <a href="https://rust-lang.github.io/zulip_archive/stream/122657-t-compiler/wg-nll/topic/.2353488.20closure.20and.20disjoint.20fields.html#155337533">(Jan 17 2019 at 14:13)</a>:</h4>
<p>We are returning a slice in the opt_tuple_ty function now ( latest change). We also want to return slices from upvar_tys ?</p>



<a name="155337543"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353488%20closure%20and%20disjoint%20fields/near/155337543" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> blitzerr <a href="https://rust-lang.github.io/zulip_archive/stream/122657-t-compiler/wg-nll/topic/.2353488.20closure.20and.20disjoint.20fields.html#155337543">(Jan 17 2019 at 14:13)</a>:</h4>
<p><span class="user-mention" data-user-id="116009">@nikomatsakis</span>  <span class="emoji emoji-261d" title="wait one second">:wait_one_second:</span>️</p>



<a name="155340753"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353488%20closure%20and%20disjoint%20fields/near/155340753" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://rust-lang.github.io/zulip_archive/stream/122657-t-compiler/wg-nll/topic/.2353488.20closure.20and.20disjoint.20fields.html#155340753">(Jan 17 2019 at 14:54)</a>:</h4>
<p><span class="user-mention" data-user-id="128294">@blitzerr</span> right</p>



<a name="155342635"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353488%20closure%20and%20disjoint%20fields/near/155342635" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> blitzerr <a href="https://rust-lang.github.io/zulip_archive/stream/122657-t-compiler/wg-nll/topic/.2353488.20closure.20and.20disjoint.20fields.html#155342635">(Jan 17 2019 at 15:15)</a>:</h4>
<p><span class="user-mention" data-user-id="116009">@nikomatsakis</span>  maybe tonight I shall have it <span class="emoji emoji-1f642" title="slight smile">:slight_smile:</span></p>



<a name="156363918"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353488%20closure%20and%20disjoint%20fields/near/156363918" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> blitzerr <a href="https://rust-lang.github.io/zulip_archive/stream/122657-t-compiler/wg-nll/topic/.2353488.20closure.20and.20disjoint.20fields.html#156363918">(Jan 18 2019 at 12:30)</a>:</h4>
<p><span class="user-mention" data-user-id="116009">@nikomatsakis</span>  changing the return type of <code>upvar_tys</code> from <code>impl Iterator&lt;Item=Ty&lt;'tcx&gt;&gt; + 'tcx</code> to <code>&amp;'tcx[Ty&lt;'tcx&gt;]</code>, is it really required to fix the lifetime error? This change will be at quite a few places</p>



<a name="156365274"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353488%20closure%20and%20disjoint%20fields/near/156365274" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> blitzerr <a href="https://rust-lang.github.io/zulip_archive/stream/122657-t-compiler/wg-nll/topic/.2353488.20closure.20and.20disjoint.20fields.html#156365274">(Jan 18 2019 at 12:58)</a>:</h4>
<p>Also a change like </p>
<div class="codehilite"><pre><span></span><span class="w">     </span><span class="k">pub</span><span class="w"> </span><span class="k">fn</span> <span class="nf">upvar_tys</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="w"> </span><span class="n">def_id</span>: <span class="nc">DefId</span><span class="p">,</span><span class="w"> </span><span class="n">tcx</span>: <span class="nc">TyCtxt</span><span class="o">&lt;</span><span class="na">&#39;_</span><span class="p">,</span><span class="w"> </span><span class="na">&#39;_</span><span class="p">,</span><span class="w"> </span><span class="na">&#39;tcx</span><span class="o">&gt;</span><span class="p">)</span><span class="w"> </span>-&gt;
<span class="o">-</span><span class="w">        </span><span class="k">impl</span><span class="w"> </span><span class="nb">Iterator</span><span class="o">&lt;</span><span class="n">Item</span><span class="o">=</span><span class="n">Ty</span><span class="o">&lt;</span><span class="na">&#39;tcx</span><span class="o">&gt;&gt;</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="na">&#39;tcx</span><span class="w"></span>
<span class="o">+</span><span class="w">        </span><span class="o">&amp;</span><span class="na">&#39;tcx</span><span class="p">[</span><span class="n">Ty</span><span class="o">&lt;</span><span class="na">&#39;tcx</span><span class="o">&gt;</span><span class="p">]</span><span class="w"></span>
<span class="w">     </span><span class="p">{</span><span class="w"></span>
<span class="w">         </span><span class="k">match</span><span class="w"> </span><span class="bp">self</span><span class="p">.</span><span class="n">upvar_tuple_ty</span><span class="p">(</span><span class="n">def_id</span><span class="p">,</span><span class="w"> </span><span class="n">tcx</span><span class="p">).</span><span class="n">sty</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="o">-</span><span class="w">            </span><span class="n">ty</span>::<span class="n">Tuple</span><span class="p">(</span><span class="n">tys</span><span class="p">)</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="n">tys</span><span class="p">.</span><span class="n">iter</span><span class="p">().</span><span class="n">cloned</span><span class="p">(),</span><span class="w"></span>
<span class="o">+</span><span class="w">            </span><span class="n">ty</span>::<span class="n">Tuple</span><span class="p">(</span><span class="n">tys</span><span class="p">)</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="n">tys</span><span class="p">,</span><span class="w"></span>
<span class="w">             </span><span class="k">ref</span><span class="w"> </span><span class="n">t</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="n">bug</span><span class="o">!</span><span class="p">(</span><span class="s">&quot;upvar_tuple_ty is not a valid tuple: {:?}&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">t</span><span class="p">),</span><span class="w"></span>
<span class="w">         </span><span class="p">}</span><span class="w"></span>
<span class="w">     </span><span class="p">}</span><span class="w"></span>
</pre></div>


<p>throws errors like </p>
<div class="codehilite"><pre><span></span><span class="n">error</span><span class="p">[</span><span class="n">E0271</span><span class="p">]</span>: <span class="nc">type</span><span class="w"> </span><span class="n">mismatch</span><span class="w"> </span><span class="n">resolving</span><span class="w"> </span><span class="err">`</span><span class="o">&lt;</span><span class="n">std</span>::<span class="n">iter</span>::<span class="n">Once</span><span class="o">&lt;&amp;</span><span class="n">ty</span>::<span class="n">TyS</span><span class="o">&lt;</span><span class="na">&#39;_</span><span class="o">&gt;&gt;</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="n">std</span>::<span class="n">iter</span>::<span class="nb">IntoIterator</span><span class="o">&gt;</span>::<span class="n">Item</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="n">ty</span>::<span class="n">TyS</span><span class="o">&lt;</span><span class="na">&#39;_</span><span class="o">&gt;</span><span class="err">`</span><span class="w"></span>
<span class="w">   </span><span class="o">-</span>-&gt; <span class="nc">src</span><span class="o">/</span><span class="n">librustc</span><span class="o">/</span><span class="n">ty</span><span class="o">/</span><span class="n">sty</span><span class="p">.</span><span class="n">rs</span>:<span class="mi">551</span>:<span class="mi">44</span><span class="w"></span>
<span class="w">    </span><span class="o">|</span><span class="w"></span>
<span class="mi">551</span><span class="w"> </span><span class="o">|</span><span class="w">         </span><span class="bp">self</span><span class="p">.</span><span class="n">upvar_tys</span><span class="p">(</span><span class="n">def_id</span><span class="p">,</span><span class="w"> </span><span class="n">tcx</span><span class="p">).</span><span class="n">iter</span><span class="p">().</span><span class="n">chain</span><span class="p">(</span><span class="n">iter</span>::<span class="n">once</span><span class="p">(</span><span class="n">tcx</span><span class="p">.</span><span class="n">types</span><span class="p">.</span><span class="kt">u32</span><span class="p">))</span><span class="w"></span>
<span class="w">    </span><span class="o">|</span><span class="w">                                            </span><span class="o">^^^^^</span><span class="w"> </span><span class="n">expected</span><span class="w"> </span><span class="k">struct</span> <span class="err">`</span><span class="n">ty</span>::<span class="n">TyS</span><span class="err">`</span><span class="p">,</span><span class="w"> </span><span class="n">found</span><span class="w"> </span><span class="n">reference</span><span class="w"></span>
<span class="w">    </span><span class="o">|</span><span class="w"></span>
<span class="w">    </span><span class="o">=</span><span class="w"> </span><span class="n">note</span>: <span class="nc">expected</span><span class="w"> </span><span class="k">type</span> <span class="err">`</span><span class="o">&amp;</span><span class="n">ty</span>::<span class="n">TyS</span><span class="o">&lt;</span><span class="na">&#39;_</span><span class="o">&gt;</span><span class="err">`</span><span class="w"></span>
<span class="w">               </span><span class="n">found</span><span class="w"> </span><span class="k">type</span> <span class="err">`</span><span class="o">&amp;&amp;</span><span class="n">ty</span>::<span class="n">TyS</span><span class="o">&lt;</span><span class="na">&#39;_</span><span class="o">&gt;</span><span class="err">`</span><span class="w"></span>

<span class="n">error</span><span class="p">[</span><span class="n">E0271</span><span class="p">]</span>: <span class="nc">type</span><span class="w"> </span><span class="n">mismatch</span><span class="w"> </span><span class="n">resolving</span><span class="w"> </span><span class="err">`</span><span class="o">&lt;</span><span class="n">std</span>::<span class="n">iter</span>::<span class="n">Chain</span><span class="o">&lt;</span><span class="n">std</span>::<span class="n">slice</span>::<span class="n">Iter</span><span class="o">&lt;</span><span class="na">&#39;_</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">ty</span>::<span class="n">TyS</span><span class="o">&lt;</span><span class="na">&#39;_</span><span class="o">&gt;&gt;</span><span class="p">,</span><span class="w"> </span><span class="n">std</span>::<span class="n">iter</span>::<span class="n">Once</span><span class="o">&lt;&amp;</span><span class="n">ty</span>::<span class="n">TyS</span><span class="o">&lt;</span><span class="na">&#39;_</span><span class="o">&gt;&gt;&gt;</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="n">std</span>::<span class="n">iter</span>::<span class="nb">Iterator</span><span class="o">&gt;</span>::<span class="n">Item</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="o">&amp;</span><span class="na">&#39;tcx</span><span class="w"> </span><span class="n">ty</span>::<span class="n">TyS</span><span class="o">&lt;</span><span class="na">&#39;tcx</span><span class="o">&gt;</span><span class="err">`</span><span class="w"></span>
<span class="w">   </span><span class="o">-</span>-&gt; <span class="nc">src</span><span class="o">/</span><span class="n">librustc</span><span class="o">/</span><span class="n">ty</span><span class="o">/</span><span class="n">sty</span><span class="p">.</span><span class="n">rs</span>:<span class="mi">549</span>:<span class="mi">9</span><span class="w"></span>
<span class="w">    </span><span class="o">|</span><span class="w"></span>
<span class="mi">549</span><span class="w"> </span><span class="o">|</span><span class="w">         </span><span class="k">impl</span><span class="w"> </span><span class="nb">Iterator</span><span class="o">&lt;</span><span class="n">Item</span><span class="o">=</span><span class="n">Ty</span><span class="o">&lt;</span><span class="na">&#39;tcx</span><span class="o">&gt;&gt;</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="na">&#39;a</span><span class="w"></span>
<span class="w">    </span><span class="o">|</span><span class="w">         </span><span class="o">^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^</span><span class="w"> </span><span class="n">expected</span><span class="w"> </span><span class="n">reference</span><span class="p">,</span><span class="w"> </span><span class="n">found</span><span class="w"> </span><span class="k">struct</span> <span class="err">`</span><span class="n">ty</span>::<span class="n">TyS</span><span class="err">`</span><span class="w"></span>
<span class="w">    </span><span class="o">|</span><span class="w"></span>
<span class="w">    </span><span class="o">=</span><span class="w"> </span><span class="n">note</span>: <span class="nc">expected</span><span class="w"> </span><span class="k">type</span> <span class="err">`</span><span class="o">&amp;&amp;</span><span class="n">ty</span>::<span class="n">TyS</span><span class="o">&lt;</span><span class="na">&#39;_</span><span class="o">&gt;</span><span class="err">`</span><span class="w"></span>
<span class="w">               </span><span class="n">found</span><span class="w"> </span><span class="k">type</span> <span class="err">`</span><span class="o">&amp;</span><span class="na">&#39;tcx</span><span class="w"> </span><span class="n">ty</span>::<span class="n">TyS</span><span class="o">&lt;</span><span class="na">&#39;tcx</span><span class="o">&gt;</span><span class="err">`</span><span class="w"></span>
<span class="w">    </span><span class="o">=</span><span class="w"> </span><span class="n">note</span>: <span class="nc">the</span><span class="w"> </span><span class="k">return</span><span class="w"> </span><span class="k">type</span> <span class="nc">of</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="n">function</span><span class="w"> </span><span class="n">must</span><span class="w"> </span><span class="n">have</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="n">statically</span><span class="w"> </span><span class="n">known</span><span class="w"> </span><span class="n">size</span><span class="w"></span>

<span class="n">error</span><span class="p">[</span><span class="n">E0271</span><span class="p">]</span>: <span class="nc">type</span><span class="w"> </span><span class="n">mismatch</span><span class="w"> </span><span class="n">resolving</span><span class="w"> </span><span class="err">`</span><span class="o">&lt;</span><span class="n">std</span>::<span class="n">iter</span>::<span class="n">Once</span><span class="o">&lt;&amp;</span><span class="n">ty</span>::<span class="n">TyS</span><span class="o">&lt;</span><span class="na">&#39;_</span><span class="o">&gt;&gt;</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="n">std</span>::<span class="n">iter</span>::<span class="nb">Iterator</span><span class="o">&gt;</span>::<span class="n">Item</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="n">ty</span>::<span class="n">TyS</span><span class="o">&lt;</span><span class="na">&#39;_</span><span class="o">&gt;</span><span class="err">`</span><span class="w"></span>
<span class="w">   </span><span class="o">-</span>-&gt; <span class="nc">src</span><span class="o">/</span><span class="n">librustc</span><span class="o">/</span><span class="n">ty</span><span class="o">/</span><span class="n">sty</span><span class="p">.</span><span class="n">rs</span>:<span class="mi">549</span>:<span class="mi">9</span><span class="w"></span>
<span class="w">    </span><span class="o">|</span><span class="w"></span>
<span class="mi">549</span><span class="w"> </span><span class="o">|</span><span class="w">         </span><span class="k">impl</span><span class="w"> </span><span class="nb">Iterator</span><span class="o">&lt;</span><span class="n">Item</span><span class="o">=</span><span class="n">Ty</span><span class="o">&lt;</span><span class="na">&#39;tcx</span><span class="o">&gt;&gt;</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="na">&#39;a</span><span class="w"></span>
<span class="w">    </span><span class="o">|</span><span class="w">         </span><span class="o">^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^</span><span class="w"> </span><span class="n">expected</span><span class="w"> </span><span class="k">struct</span> <span class="err">`</span><span class="n">ty</span>::<span class="n">TyS</span><span class="err">`</span><span class="p">,</span><span class="w"> </span><span class="n">found</span><span class="w"> </span><span class="n">reference</span><span class="w"></span>
<span class="w">    </span><span class="o">|</span><span class="w"></span>
<span class="w">    </span><span class="o">=</span><span class="w"> </span><span class="n">note</span>: <span class="nc">expected</span><span class="w"> </span><span class="k">type</span> <span class="err">`</span><span class="o">&amp;</span><span class="n">ty</span>::<span class="n">TyS</span><span class="o">&lt;</span><span class="na">&#39;_</span><span class="o">&gt;</span><span class="err">`</span><span class="w"></span>
<span class="w">               </span><span class="n">found</span><span class="w"> </span><span class="k">type</span> <span class="err">`</span><span class="o">&amp;&amp;</span><span class="n">ty</span>::<span class="n">TyS</span><span class="o">&lt;</span><span class="na">&#39;_</span><span class="o">&gt;</span><span class="err">`</span><span class="w"></span>
</pre></div>


<p>I can guess why the compiler is unhappy but is there an idiomatic way, it can be re-written with least effort to make the compiler happy ?</p>



<a name="156372449"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353488%20closure%20and%20disjoint%20fields/near/156372449" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://rust-lang.github.io/zulip_archive/stream/122657-t-compiler/wg-nll/topic/.2353488.20closure.20and.20disjoint.20fields.html#156372449">(Jan 18 2019 at 14:42)</a>:</h4>
<p>yeah, you'll need to add <code>.iter()</code> and maybe <code>.iter().cloned()</code> into various places...</p>



<a name="156372453"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353488%20closure%20and%20disjoint%20fields/near/156372453" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://rust-lang.github.io/zulip_archive/stream/122657-t-compiler/wg-nll/topic/.2353488.20closure.20and.20disjoint.20fields.html#156372453">(Jan 18 2019 at 14:42)</a>:</h4>
<p>it's not <em>necessary</em> to fix</p>



<a name="156372456"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353488%20closure%20and%20disjoint%20fields/near/156372456" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://rust-lang.github.io/zulip_archive/stream/122657-t-compiler/wg-nll/topic/.2353488.20closure.20and.20disjoint.20fields.html#156372456">(Jan 18 2019 at 14:42)</a>:</h4>
<p>I just thought it might be nicer to return a slice</p>



<a name="156372458"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353488%20closure%20and%20disjoint%20fields/near/156372458" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://rust-lang.github.io/zulip_archive/stream/122657-t-compiler/wg-nll/topic/.2353488.20closure.20and.20disjoint.20fields.html#156372458">(Jan 18 2019 at 14:42)</a>:</h4>
<p>but maybe not</p>



<a name="156422416"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353488%20closure%20and%20disjoint%20fields/near/156422416" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> blitzerr <a href="https://rust-lang.github.io/zulip_archive/stream/122657-t-compiler/wg-nll/topic/.2353488.20closure.20and.20disjoint.20fields.html#156422416">(Jan 19 2019 at 05:36)</a>:</h4>
<p><span class="user-mention" data-user-id="116009">@nikomatsakis</span>  <a href="https://github.com/rust-lang/rust/commit/8568565465" target="_blank" title="https://github.com/rust-lang/rust/commit/8568565465">here</a> we go.</p>



<a name="156422960"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353488%20closure%20and%20disjoint%20fields/near/156422960" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> blitzerr <a href="https://rust-lang.github.io/zulip_archive/stream/122657-t-compiler/wg-nll/topic/.2353488.20closure.20and.20disjoint.20fields.html#156422960">(Jan 19 2019 at 05:52)</a>:</h4>
<div class="codehilite"><pre><span></span><span class="w">   </span><span class="k">pub</span><span class="w"> </span><span class="k">fn</span> <span class="nf">upvar_tys</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="w"> </span><span class="n">tcx</span>: <span class="nc">TyCtxt</span><span class="o">&lt;</span><span class="na">&#39;_</span><span class="p">,</span><span class="w"> </span><span class="na">&#39;_</span><span class="p">,</span><span class="w"> </span><span class="na">&#39;tcx</span><span class="o">&gt;</span><span class="p">)</span><span class="w"> </span>-&gt; <span class="nc">impl</span><span class="w"> </span><span class="nb">Iterator</span><span class="o">&lt;</span><span class="n">Item</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Ty</span><span class="o">&lt;</span><span class="na">&#39;tcx</span><span class="o">&gt;&gt;</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="na">&#39;tcx</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="err">¦</span><span class="w">   </span><span class="k">match</span><span class="w"> </span><span class="bp">self</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="err">¦</span><span class="w">   </span><span class="err">¦</span><span class="w">   </span><span class="n">DefiningTy</span>::<span class="n">Closure</span><span class="p">(</span><span class="n">def_id</span><span class="p">,</span><span class="w"> </span><span class="n">substs</span><span class="p">)</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="err">¦</span><span class="w">   </span><span class="err">¦</span><span class="w">   </span><span class="err">¦</span><span class="w">   </span><span class="n">Either</span>::<span class="n">Left</span><span class="p">(</span><span class="n">substs</span><span class="p">.</span><span class="n">upvar_tys</span><span class="p">(</span><span class="n">def_id</span><span class="p">,</span><span class="w"> </span><span class="n">tcx</span><span class="p">).</span><span class="n">iter</span><span class="p">().</span><span class="n">cloned</span><span class="p">())</span><span class="w"></span>
<span class="w">    </span><span class="err">¦</span><span class="w">   </span><span class="err">¦</span><span class="w">   </span><span class="p">}</span><span class="w"></span>
<span class="w">    </span><span class="err">¦</span><span class="w">   </span><span class="err">¦</span><span class="w">   </span><span class="n">DefiningTy</span>::<span class="n">Generator</span><span class="p">(</span><span class="n">def_id</span><span class="p">,</span><span class="w"> </span><span class="n">substs</span><span class="p">,</span><span class="w"> </span><span class="n">_</span><span class="p">)</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="err">¦</span><span class="w">   </span><span class="err">¦</span><span class="w">   </span><span class="err">¦</span><span class="w">   </span><span class="n">Either</span>::<span class="n">Right</span><span class="p">(</span><span class="n">Either</span>::<span class="n">Left</span><span class="p">(</span><span class="n">substs</span><span class="p">.</span><span class="n">upvar_tys</span><span class="p">(</span><span class="n">def_id</span><span class="p">,</span><span class="w"> </span><span class="n">tcx</span><span class="p">).</span><span class="n">iter</span><span class="p">().</span><span class="n">cloned</span><span class="p">()))</span><span class="w"></span>
<span class="w">    </span><span class="err">¦</span><span class="w">   </span><span class="err">¦</span><span class="w">   </span><span class="p">}</span><span class="w"></span>
<span class="w">    </span><span class="err">¦</span><span class="w">   </span><span class="err">¦</span><span class="w">   </span><span class="n">DefiningTy</span>::<span class="n">FnDef</span><span class="p">(..)</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">DefiningTy</span>::<span class="n">Const</span><span class="p">(..)</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="err">¦</span><span class="w">   </span><span class="err">¦</span><span class="w">   </span><span class="err">¦</span><span class="w">   </span><span class="n">Either</span>::<span class="n">Right</span><span class="p">(</span><span class="n">Either</span>::<span class="n">Right</span><span class="p">(</span><span class="n">iter</span>::<span class="n">empty</span><span class="p">()))</span><span class="w"></span>
<span class="w">    </span><span class="err">¦</span><span class="w">   </span><span class="err">¦</span><span class="w">   </span><span class="p">}</span><span class="w"></span>
<span class="w">    </span><span class="err">¦</span><span class="w">   </span><span class="p">}</span><span class="w"></span>
<span class="w">    </span><span class="p">}</span><span class="w"></span>
</pre></div>


<p>There is still this function in the <code>nll/universal_regions.rs</code> which returns an iterator. Its the branch returning the<code> iter::empty</code> that's messing things up. Couldn't think of an easy way to address this</p>



<a name="156617346"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353488%20closure%20and%20disjoint%20fields/near/156617346" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://rust-lang.github.io/zulip_archive/stream/122657-t-compiler/wg-nll/topic/.2353488.20closure.20and.20disjoint.20fields.html#156617346">(Jan 22 2019 at 16:21)</a>:</h4>
<p><span class="user-mention" data-user-id="128294">@blitzerr</span> I'm a bit unsure what you are asking :)</p>



<a name="156617366"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353488%20closure%20and%20disjoint%20fields/near/156617366" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://rust-lang.github.io/zulip_archive/stream/122657-t-compiler/wg-nll/topic/.2353488.20closure.20and.20disjoint.20fields.html#156617366">(Jan 22 2019 at 16:21)</a>:</h4>
<p>oh, like, how can that fn be converted to return a slice?</p>



<a name="156617414"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353488%20closure%20and%20disjoint%20fields/near/156617414" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://rust-lang.github.io/zulip_archive/stream/122657-t-compiler/wg-nll/topic/.2353488.20closure.20and.20disjoint.20fields.html#156617414">(Jan 22 2019 at 16:22)</a>:</h4>
<p>you can just return <code>&amp;[]</code> from that final branch</p>



<a name="156617431"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353488%20closure%20and%20disjoint%20fields/near/156617431" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://rust-lang.github.io/zulip_archive/stream/122657-t-compiler/wg-nll/topic/.2353488.20closure.20and.20disjoint.20fields.html#156617431">(Jan 22 2019 at 16:22)</a>:</h4>
<div class="codehilite"><pre><span></span><span class="k">pub</span><span class="w"> </span><span class="k">fn</span> <span class="nf">upvar_tys</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="w"> </span><span class="n">tcx</span>: <span class="nc">TyCtxt</span><span class="o">&lt;</span><span class="na">&#39;_</span><span class="p">,</span><span class="w"> </span><span class="na">&#39;_</span><span class="p">,</span><span class="w"> </span><span class="na">&#39;tcx</span><span class="o">&gt;</span><span class="p">)</span><span class="w"> </span>-&gt; <span class="kp">&amp;</span><span class="p">[</span><span class="n">Ty</span><span class="o">&lt;</span><span class="na">&#39;tcx</span><span class="o">&gt;</span><span class="p">]</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="err">¦</span><span class="w">   </span><span class="k">match</span><span class="w"> </span><span class="bp">self</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="err">¦</span><span class="w">   </span><span class="err">¦</span><span class="w">   </span><span class="n">DefiningTy</span>::<span class="n">Closure</span><span class="p">(</span><span class="n">def_id</span><span class="p">,</span><span class="w"> </span><span class="n">substs</span><span class="p">)</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="n">substs</span><span class="p">.</span><span class="n">upvar_tys</span><span class="p">(</span><span class="n">def_id</span><span class="p">,</span><span class="w"> </span><span class="n">tcx</span><span class="p">),</span><span class="w"></span>
<span class="w">    </span><span class="err">¦</span><span class="w">   </span><span class="err">¦</span><span class="w">   </span><span class="n">DefiningTy</span>::<span class="n">Generator</span><span class="p">(</span><span class="n">def_id</span><span class="p">,</span><span class="w"> </span><span class="n">substs</span><span class="p">,</span><span class="w"> </span><span class="n">_</span><span class="p">)</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="n">substs</span><span class="p">.</span><span class="n">upvar_tys</span><span class="p">(</span><span class="n">def_id</span><span class="p">,</span><span class="w"> </span><span class="n">tcx</span><span class="p">),</span><span class="w"></span>
<span class="w">    </span><span class="err">¦</span><span class="w">   </span><span class="err">¦</span><span class="w">   </span><span class="n">DefiningTy</span>::<span class="n">FnDef</span><span class="p">(..)</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">DefiningTy</span>::<span class="n">Const</span><span class="p">(..)</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="o">&amp;</span><span class="p">[],</span><span class="w"></span>
<span class="w">    </span><span class="err">¦</span><span class="w">   </span><span class="p">}</span><span class="w"></span>
<span class="w">    </span><span class="p">}</span><span class="w"></span>
</pre></div>



<a name="156617448"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353488%20closure%20and%20disjoint%20fields/near/156617448" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://rust-lang.github.io/zulip_archive/stream/122657-t-compiler/wg-nll/topic/.2353488.20closure.20and.20disjoint.20fields.html#156617448">(Jan 22 2019 at 16:23)</a>:</h4>
<p>this works because <code>[]</code> is a constant and hence <code>&amp;[]</code> can be assigned <code>'static</code> lifetime</p>



<a name="156626907"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353488%20closure%20and%20disjoint%20fields/near/156626907" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> blitzerr <a href="https://rust-lang.github.io/zulip_archive/stream/122657-t-compiler/wg-nll/topic/.2353488.20closure.20and.20disjoint.20fields.html#156626907">(Jan 22 2019 at 18:27)</a>:</h4>
<p><span class="user-mention" data-user-id="116009">@nikomatsakis</span>  Awesome. Thank you.</p>



<a name="156627061"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353488%20closure%20and%20disjoint%20fields/near/156627061" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> blitzerr <a href="https://rust-lang.github.io/zulip_archive/stream/122657-t-compiler/wg-nll/topic/.2353488.20closure.20and.20disjoint.20fields.html#156627061">(Jan 22 2019 at 18:29)</a>:</h4>
<blockquote>
<p>Yeah so that's one of the least favorite impl Trait limitations <span class="emoji emoji-1f642" title="slight smile">:slight_smile:</span></p>
</blockquote>
<p>I think we are ready for the next phase. You were talking of a workaround. So, we can do that and move to the next phase of <a href="https://github.com/rust-lang/rust/issues/53488" target="_blank" title="https://github.com/rust-lang/rust/issues/53488">#53488</a></p>



<a name="156627101"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353488%20closure%20and%20disjoint%20fields/near/156627101" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://rust-lang.github.io/zulip_archive/stream/122657-t-compiler/wg-nll/topic/.2353488.20closure.20and.20disjoint.20fields.html#156627101">(Jan 22 2019 at 18:29)</a>:</h4>
<p><span class="user-mention" data-user-id="128294">@blitzerr</span> you'll have to remind me -- workaround for what?</p>



<a name="156627117"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353488%20closure%20and%20disjoint%20fields/near/156627117" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://rust-lang.github.io/zulip_archive/stream/122657-t-compiler/wg-nll/topic/.2353488.20closure.20and.20disjoint.20fields.html#156627117">(Jan 22 2019 at 18:29)</a>:</h4>
<p>iirc, the next phase was going to be changing the closure substs etc to <em>actually</em> have a tuple</p>



<a name="156627178"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353488%20closure%20and%20disjoint%20fields/near/156627178" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://rust-lang.github.io/zulip_archive/stream/122657-t-compiler/wg-nll/topic/.2353488.20closure.20and.20disjoint.20fields.html#156627178">(Jan 22 2019 at 18:30)</a>:</h4>
<p>instead of now, where it has N parameters, and then we <em>synthesize</em> the tuple</p>



<a name="156627179"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353488%20closure%20and%20disjoint%20fields/near/156627179" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://rust-lang.github.io/zulip_archive/stream/122657-t-compiler/wg-nll/topic/.2353488.20closure.20and.20disjoint.20fields.html#156627179">(Jan 22 2019 at 18:30)</a>:</h4>
<p>right?</p>



<a name="156627347"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353488%20closure%20and%20disjoint%20fields/near/156627347" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> blitzerr <a href="https://rust-lang.github.io/zulip_archive/stream/122657-t-compiler/wg-nll/topic/.2353488.20closure.20and.20disjoint.20fields.html#156627347">(Jan 22 2019 at 18:32)</a>:</h4>
<p>That is the logical next step but before that we wanted to make sure (at compilation time) that people don't end up calling upvar_tys from the inference code. So, basically </p>
<div class="codehilite"><pre><span></span><span class="o">-</span><span class="w">    </span><span class="k">pub</span><span class="w"> </span><span class="k">fn</span> <span class="nf">upvar_tys</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="w"> </span><span class="n">def_id</span>: <span class="nc">DefId</span><span class="p">,</span><span class="w"> </span><span class="n">tcx</span>: <span class="nc">TyCtxt</span><span class="o">&lt;</span><span class="na">&#39;_</span><span class="p">,</span><span class="w"> </span><span class="na">&#39;_</span><span class="p">,</span><span class="w"> </span><span class="na">&#39;tcx</span><span class="o">&gt;</span><span class="p">)</span><span class="w"> </span>-&gt;
<span class="o">+</span><span class="w">    </span><span class="k">pub</span><span class="w"> </span><span class="k">fn</span> <span class="nf">upvar_tys</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="w"> </span><span class="n">def_id</span>: <span class="nc">DefId</span><span class="p">,</span><span class="w"> </span><span class="n">tcx</span>: <span class="nc">TyCtxt</span><span class="o">&lt;</span><span class="na">&#39;_</span><span class="p">,</span><span class="w"> </span><span class="na">&#39;tcx</span><span class="p">,</span><span class="w"> </span><span class="na">&#39;tcx</span><span class="o">&gt;</span><span class="p">)</span><span class="w"> </span>-&gt;
</pre></div>



<a name="156627378"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353488%20closure%20and%20disjoint%20fields/near/156627378" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> blitzerr <a href="https://rust-lang.github.io/zulip_archive/stream/122657-t-compiler/wg-nll/topic/.2353488.20closure.20and.20disjoint.20fields.html#156627378">(Jan 22 2019 at 18:32)</a>:</h4>
<div class="codehilite"><pre><span></span><span class="n">error</span><span class="p">[</span><span class="n">E0700</span><span class="p">]</span>: <span class="nc">hidden</span><span class="w"> </span><span class="k">type</span> <span class="nc">for</span><span class="w"> </span><span class="err">`</span><span class="k">impl</span><span class="w"> </span><span class="n">Trait</span><span class="err">`</span><span class="w"> </span><span class="n">captures</span><span class="w"> </span><span class="n">lifetime</span><span class="w"> </span><span class="n">that</span><span class="w"> </span><span class="n">does</span><span class="w"> </span><span class="n">not</span><span class="w"> </span><span class="n">appear</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="n">bounds</span><span class="w"></span>
<span class="w">   </span><span class="o">-</span>-&gt; <span class="nc">src</span><span class="o">/</span><span class="n">librustc</span><span class="o">/</span><span class="n">ty</span><span class="o">/</span><span class="n">sty</span><span class="p">.</span><span class="n">rs</span>:<span class="mi">549</span>:<span class="mi">9</span><span class="w"></span>
<span class="w">    </span><span class="o">|</span><span class="w"></span>
<span class="mi">549</span><span class="w"> </span><span class="o">|</span><span class="w">         </span><span class="k">impl</span><span class="w"> </span><span class="nb">Iterator</span><span class="o">&lt;</span><span class="n">Item</span><span class="o">=</span><span class="n">Ty</span><span class="o">&lt;</span><span class="na">&#39;tcx</span><span class="o">&gt;&gt;</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="na">&#39;a</span><span class="w"></span>
<span class="w">    </span><span class="o">|</span><span class="w">         </span><span class="o">^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^</span><span class="w"></span>
<span class="w">    </span><span class="o">|</span><span class="w"></span>
<span class="n">note</span>: <span class="nc">hidden</span><span class="w"> </span><span class="k">type</span> <span class="err">`</span><span class="n">std</span>::<span class="n">iter</span>::<span class="n">Chain</span><span class="o">&lt;</span><span class="k">impl</span><span class="w"> </span><span class="n">std</span>::<span class="n">iter</span>::<span class="nb">Iterator</span><span class="p">,</span><span class="w"> </span><span class="n">std</span>::<span class="n">iter</span>::<span class="n">Once</span><span class="o">&lt;&amp;</span><span class="na">&#39;gcx</span><span class="w"> </span><span class="n">ty</span>::<span class="n">TyS</span><span class="o">&lt;</span><span class="na">&#39;gcx</span><span class="o">&gt;&gt;&gt;</span><span class="err">`</span><span class="w"> </span><span class="n">captures</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">lifetime</span><span class="w"> </span><span class="na">&#39;gcx</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="n">defined</span><span class="w"> </span><span class="n">on</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="k">impl</span><span class="w"> </span><span class="n">at</span><span class="w"> </span><span class="mi">532</span>:<span class="mi">10</span><span class="w"></span>
<span class="w">   </span><span class="o">-</span>-&gt; <span class="nc">src</span><span class="o">/</span><span class="n">librustc</span><span class="o">/</span><span class="n">ty</span><span class="o">/</span><span class="n">sty</span><span class="p">.</span><span class="n">rs</span>:<span class="mi">532</span>:<span class="mi">10</span><span class="w"></span>
<span class="w">    </span><span class="o">|</span><span class="w"></span>
<span class="mi">532</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="k">impl</span><span class="o">&lt;</span><span class="na">&#39;a</span><span class="p">,</span><span class="w"> </span><span class="na">&#39;gcx</span><span class="p">,</span><span class="w"> </span><span class="na">&#39;tcx</span><span class="o">&gt;</span><span class="w"> </span><span class="n">GeneratorSubsts</span><span class="o">&lt;</span><span class="na">&#39;tcx</span><span class="o">&gt;</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="o">|</span><span class="w">          </span><span class="o">^^^^</span><span class="w"></span>

<span class="n">error</span>: <span class="nc">aborting</span><span class="w"> </span><span class="n">due</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="n">previous</span><span class="w"> </span><span class="n">error</span><span class="w"></span>

<span class="n">For</span><span class="w"> </span><span class="n">more</span><span class="w"> </span><span class="n">information</span><span class="w"> </span><span class="n">about</span><span class="w"> </span><span class="n">this</span><span class="w"> </span><span class="n">error</span><span class="p">,</span><span class="w"> </span><span class="n">try</span><span class="w"> </span><span class="err">`</span><span class="n">rustc</span><span class="w"> </span><span class="o">--</span><span class="n">explain</span><span class="w"> </span><span class="n">E0700</span><span class="err">`</span><span class="p">.</span><span class="w"></span>
<span class="n">error</span>: <span class="nc">Could</span><span class="w"> </span><span class="n">not</span><span class="w"> </span><span class="n">compile</span><span class="w"> </span><span class="err">`</span><span class="n">rustc</span><span class="err">`</span><span class="p">.</span><span class="w"></span>
</pre></div>


<p>Gives me this error</p>



<a name="156627396"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353488%20closure%20and%20disjoint%20fields/near/156627396" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://rust-lang.github.io/zulip_archive/stream/122657-t-compiler/wg-nll/topic/.2353488.20closure.20and.20disjoint.20fields.html#156627396">(Jan 22 2019 at 18:33)</a>:</h4>
<p>ah I see</p>



<a name="156627409"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353488%20closure%20and%20disjoint%20fields/near/156627409" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://rust-lang.github.io/zulip_archive/stream/122657-t-compiler/wg-nll/topic/.2353488.20closure.20and.20disjoint.20fields.html#156627409">(Jan 22 2019 at 18:33)</a>:</h4>
<p>and you don't want to remove the <code>impl Iterator</code>, right?</p>



<a name="156627427"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353488%20closure%20and%20disjoint%20fields/near/156627427" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> blitzerr <a href="https://rust-lang.github.io/zulip_archive/stream/122657-t-compiler/wg-nll/topic/.2353488.20closure.20and.20disjoint.20fields.html#156627427">(Jan 22 2019 at 18:33)</a>:</h4>
<blockquote>
<p>there are workarounds but...before we go there...</p>
</blockquote>
<p>To which you said <span class="emoji emoji-1f446" title="point up">:point_up:</span></p>



<a name="156627493"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353488%20closure%20and%20disjoint%20fields/near/156627493" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://rust-lang.github.io/zulip_archive/stream/122657-t-compiler/wg-nll/topic/.2353488.20closure.20and.20disjoint.20fields.html#156627493">(Jan 22 2019 at 18:34)</a>:</h4>
<p>so the problem here is that the type returned for the <code>impl Trait</code> is only allowed to reference the lifetimes that appear in the <code>impl Iterator&lt;Item=Ty&lt;'tcx&gt;&gt; + 'a</code> type itself -- namely <code>'tcx</code> and <code>'a</code></p>



<a name="156627503"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353488%20closure%20and%20disjoint%20fields/near/156627503" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> blitzerr <a href="https://rust-lang.github.io/zulip_archive/stream/122657-t-compiler/wg-nll/topic/.2353488.20closure.20and.20disjoint.20fields.html#156627503">(Jan 22 2019 at 18:34)</a>:</h4>
<p>Ohh no, I value your opinion <span class="emoji emoji-1f642" title="slight smile">:slight_smile:</span></p>



<a name="156627510"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353488%20closure%20and%20disjoint%20fields/near/156627510" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://rust-lang.github.io/zulip_archive/stream/122657-t-compiler/wg-nll/topic/.2353488.20closure.20and.20disjoint.20fields.html#156627510">(Jan 22 2019 at 18:34)</a>:</h4>
<p>but here we are capturing the <code>TyCtxt&lt;'a, 'gcx, 'tcx&gt;</code>, which includes <code>'gcx</code></p>



<a name="156627518"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353488%20closure%20and%20disjoint%20fields/near/156627518" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> blitzerr <a href="https://rust-lang.github.io/zulip_archive/stream/122657-t-compiler/wg-nll/topic/.2353488.20closure.20and.20disjoint.20fields.html#156627518">(Jan 22 2019 at 18:34)</a>:</h4>
<p>I already removed all the iterator returns</p>



<a name="156627521"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353488%20closure%20and%20disjoint%20fields/near/156627521" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://rust-lang.github.io/zulip_archive/stream/122657-t-compiler/wg-nll/topic/.2353488.20closure.20and.20disjoint.20fields.html#156627521">(Jan 22 2019 at 18:34)</a>:</h4>
<p>there is this weird trait called <code>Captures</code> that can be used as a workaround</p>



<a name="156627531"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353488%20closure%20and%20disjoint%20fields/near/156627531" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://rust-lang.github.io/zulip_archive/stream/122657-t-compiler/wg-nll/topic/.2353488.20closure.20and.20disjoint.20fields.html#156627531">(Jan 22 2019 at 18:34)</a>:</h4>
<p>oh, well, then I don't understand the error</p>



<a name="156627532"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353488%20closure%20and%20disjoint%20fields/near/156627532" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> blitzerr <a href="https://rust-lang.github.io/zulip_archive/stream/122657-t-compiler/wg-nll/topic/.2353488.20closure.20and.20disjoint.20fields.html#156627532">(Jan 22 2019 at 18:35)</a>:</h4>
<p>Except for one, which you just told me how to do</p>



<a name="156627536"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353488%20closure%20and%20disjoint%20fields/near/156627536" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://rust-lang.github.io/zulip_archive/stream/122657-t-compiler/wg-nll/topic/.2353488.20closure.20and.20disjoint.20fields.html#156627536">(Jan 22 2019 at 18:35)</a>:</h4>
<p>ah ok</p>



<a name="156627554"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353488%20closure%20and%20disjoint%20fields/near/156627554" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://rust-lang.github.io/zulip_archive/stream/122657-t-compiler/wg-nll/topic/.2353488.20closure.20and.20disjoint.20fields.html#156627554">(Jan 22 2019 at 18:35)</a>:</h4>
<p>well in any case you can do <code>impl Iterator&lt;...&gt; + Captures&lt;'gcx&gt; + 'a</code></p>



<a name="156627564"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353488%20closure%20and%20disjoint%20fields/near/156627564" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> blitzerr <a href="https://rust-lang.github.io/zulip_archive/stream/122657-t-compiler/wg-nll/topic/.2353488.20closure.20and.20disjoint.20fields.html#156627564">(Jan 22 2019 at 18:35)</a>:</h4>
<p>Tonight, I will  check that again.</p>



<a name="156627570"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353488%20closure%20and%20disjoint%20fields/near/156627570" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://rust-lang.github.io/zulip_archive/stream/122657-t-compiler/wg-nll/topic/.2353488.20closure.20and.20disjoint.20fields.html#156627570">(Jan 22 2019 at 18:35)</a>:</h4>
<p>captures trait: <a href="https://doc.rust-lang.org/nightly/nightly-rustc/rustc/util/captures/trait.Captures.html" target="_blank" title="https://doc.rust-lang.org/nightly/nightly-rustc/rustc/util/captures/trait.Captures.html">https://doc.rust-lang.org/nightly/nightly-rustc/rustc/util/captures/trait.Captures.html</a></p>



<a name="156627582"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353488%20closure%20and%20disjoint%20fields/near/156627582" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://rust-lang.github.io/zulip_archive/stream/122657-t-compiler/wg-nll/topic/.2353488.20closure.20and.20disjoint.20fields.html#156627582">(Jan 22 2019 at 18:35)</a>:</h4>
<p>it's basically a hack -- a "dummy" requirement just to let you mention <code>'gcx</code></p>



<a name="156627588"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353488%20closure%20and%20disjoint%20fields/near/156627588" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> blitzerr <a href="https://rust-lang.github.io/zulip_archive/stream/122657-t-compiler/wg-nll/topic/.2353488.20closure.20and.20disjoint.20fields.html#156627588">(Jan 22 2019 at 18:35)</a>:</h4>
<p>You think, after changing iterator to slice ref, that error should go away ?</p>



<a name="156627591"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353488%20closure%20and%20disjoint%20fields/near/156627591" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://rust-lang.github.io/zulip_archive/stream/122657-t-compiler/wg-nll/topic/.2353488.20closure.20and.20disjoint.20fields.html#156627591">(Jan 22 2019 at 18:35)</a>:</h4>
<p>but I sort of prefer the slice personally</p>



<a name="156627601"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353488%20closure%20and%20disjoint%20fields/near/156627601" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://rust-lang.github.io/zulip_archive/stream/122657-t-compiler/wg-nll/topic/.2353488.20closure.20and.20disjoint.20fields.html#156627601">(Jan 22 2019 at 18:35)</a>:</h4>
<p>at least I think I do</p>



<a name="156627655"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353488%20closure%20and%20disjoint%20fields/near/156627655" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://rust-lang.github.io/zulip_archive/stream/122657-t-compiler/wg-nll/topic/.2353488.20closure.20and.20disjoint.20fields.html#156627655">(Jan 22 2019 at 18:36)</a>:</h4>
<blockquote>
<p>You think, after changing iterator to slice ref, that error should go away ?</p>
</blockquote>
<p>that immediate error yes</p>



<a name="156627658"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353488%20closure%20and%20disjoint%20fields/near/156627658" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://rust-lang.github.io/zulip_archive/stream/122657-t-compiler/wg-nll/topic/.2353488.20closure.20and.20disjoint.20fields.html#156627658">(Jan 22 2019 at 18:36)</a>:</h4>
<p>I would perhaps expect other errors :)</p>



<a name="156627703"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353488%20closure%20and%20disjoint%20fields/near/156627703" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> blitzerr <a href="https://rust-lang.github.io/zulip_archive/stream/122657-t-compiler/wg-nll/topic/.2353488.20closure.20and.20disjoint.20fields.html#156627703">(Jan 22 2019 at 18:36)</a>:</h4>
<p>:D</p>



<a name="156627824"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353488%20closure%20and%20disjoint%20fields/near/156627824" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> blitzerr <a href="https://rust-lang.github.io/zulip_archive/stream/122657-t-compiler/wg-nll/topic/.2353488.20closure.20and.20disjoint.20fields.html#156627824">(Jan 22 2019 at 18:38)</a>:</h4>
<p>Okay. So then I will make the last change you suggest and try changing <code>TyCtxt&lt;'_, '_, 'tcx&gt;) to  TyCtxt&lt;'_, 'tcx, 'tcx&gt;)</code> and see what new errors I get.</p>



<a name="156627992"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353488%20closure%20and%20disjoint%20fields/near/156627992" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> blitzerr <a href="https://rust-lang.github.io/zulip_archive/stream/122657-t-compiler/wg-nll/topic/.2353488.20closure.20and.20disjoint.20fields.html#156627992">(Jan 22 2019 at 18:40)</a>:</h4>
<p><span class="user-mention" data-user-id="116009">@nikomatsakis</span> <br>
Then we might be good for the next steps. We should discuss that soon</p>



<a name="156628427"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353488%20closure%20and%20disjoint%20fields/near/156628427" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> blitzerr <a href="https://rust-lang.github.io/zulip_archive/stream/122657-t-compiler/wg-nll/topic/.2353488.20closure.20and.20disjoint.20fields.html#156628427">(Jan 22 2019 at 18:45)</a>:</h4>
<p>Thanks for explaining the error. I haven't written much Rust other than my compiler contributions which aren't many either. <span class="emoji emoji-1f600" title="grinning">:grinning:</span></p>



<a name="156637991"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353488%20closure%20and%20disjoint%20fields/near/156637991" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://rust-lang.github.io/zulip_archive/stream/122657-t-compiler/wg-nll/topic/.2353488.20closure.20and.20disjoint.20fields.html#156637991">(Jan 22 2019 at 20:46)</a>:</h4>
<p>great, let me know how it goes!</p>



<a name="156663044"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353488%20closure%20and%20disjoint%20fields/near/156663044" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> blitzerr <a href="https://rust-lang.github.io/zulip_archive/stream/122657-t-compiler/wg-nll/topic/.2353488.20closure.20and.20disjoint.20fields.html#156663044">(Jan 23 2019 at 04:24)</a>:</h4>
<p>Making the change</p>
<div class="codehilite"><pre><span></span>-    pub fn upvar_tys(self, def_id: DefId, tcx: TyCtxt&lt;&#39;_, &#39;_, &#39;tcx&gt;) -&gt;
+    pub fn upvar_tys(self, def_id: DefId, tcx: TyCtxt&lt;&#39;_, &#39;tcx, &#39;tcx&gt;) -&gt;
</pre></div>


<p>gives the errors</p>
<div class="codehilite"><pre><span></span><span class="n">error</span>: <span class="nc">unsatisfied</span><span class="w"> </span><span class="n">lifetime</span><span class="w"> </span><span class="n">constraints</span><span class="o">=====================&gt;</span><span class="w">        </span><span class="p">]</span><span class="w"> </span><span class="mi">107</span><span class="o">/</span><span class="mi">125</span>: <span class="nc">rustc</span><span class="w"></span>
<span class="w">   </span><span class="o">-</span>-&gt; <span class="nc">src</span><span class="o">/</span><span class="n">librustc</span><span class="o">/</span><span class="n">ty</span><span class="o">/</span><span class="n">sty</span><span class="p">.</span><span class="n">rs</span>:<span class="mi">550</span>:<span class="mi">9</span><span class="w"></span>
<span class="w">    </span><span class="o">|</span><span class="w"></span>
<span class="mi">531</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="k">impl</span><span class="o">&lt;</span><span class="na">&#39;a</span><span class="p">,</span><span class="w"> </span><span class="na">&#39;gcx</span><span class="p">,</span><span class="w"> </span><span class="na">&#39;tcx</span><span class="o">&gt;</span><span class="w"> </span><span class="n">GeneratorSubsts</span><span class="o">&lt;</span><span class="na">&#39;tcx</span><span class="o">&gt;</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="o">|</span><span class="w">          </span><span class="o">----</span><span class="w">  </span><span class="o">----</span><span class="w"> </span><span class="n">lifetime</span><span class="w"> </span><span class="err">`</span><span class="na">&#39;tcx</span><span class="err">`</span><span class="w"> </span><span class="n">defined</span><span class="w"> </span><span class="n">here</span><span class="w"></span>
<span class="w">    </span><span class="o">|</span><span class="w">          </span><span class="o">|</span><span class="w"></span>
<span class="w">    </span><span class="o">|</span><span class="w">          </span><span class="n">lifetime</span><span class="w"> </span><span class="err">`</span><span class="na">&#39;gcx</span><span class="err">`</span><span class="w"> </span><span class="n">defined</span><span class="w"> </span><span class="n">here</span><span class="w"></span>
<span class="p">...</span><span class="w"></span>
<span class="mi">550</span><span class="w"> </span><span class="o">|</span><span class="w">         </span><span class="bp">self</span><span class="p">.</span><span class="n">upvar_tys</span><span class="p">(</span><span class="n">def_id</span><span class="p">,</span><span class="w"> </span><span class="n">tcx</span><span class="p">).</span><span class="n">iter</span><span class="p">().</span><span class="n">cloned</span><span class="p">().</span><span class="n">chain</span><span class="p">(</span><span class="n">iter</span>::<span class="n">once</span><span class="p">(</span><span class="n">tcx</span><span class="p">.</span><span class="n">types</span><span class="p">.</span><span class="kt">u32</span><span class="p">))</span><span class="w"></span>
<span class="w">    </span><span class="o">|</span><span class="w">         </span><span class="o">^^^^^^^^^^^^^^^^^^^^^^^^^^^</span><span class="w"> </span><span class="n">argument</span><span class="w"> </span><span class="n">requires</span><span class="w"> </span><span class="n">that</span><span class="w"> </span><span class="err">`</span><span class="na">&#39;tcx</span><span class="err">`</span><span class="w"> </span><span class="n">must</span><span class="w"> </span><span class="n">outlive</span><span class="w"> </span><span class="err">`</span><span class="na">&#39;gcx</span><span class="err">`</span><span class="w"></span>
</pre></div>



<a name="156663111"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353488%20closure%20and%20disjoint%20fields/near/156663111" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> blitzerr <a href="https://rust-lang.github.io/zulip_archive/stream/122657-t-compiler/wg-nll/topic/.2353488.20closure.20and.20disjoint.20fields.html#156663111">(Jan 23 2019 at 04:26)</a>:</h4>
<p><span class="user-mention" data-user-id="116009">@nikomatsakis</span>   In this function I think I need to change the argument <br>
<code>tcx: TyCtxt&lt;'a, 'gcx, 'tcx&gt;</code> to <code>tcx: TyCtxt&lt;'a, 'tcx, 'tcx&gt;</code> but not sure if that is the right way</p>
<div class="codehilite"><pre><span></span><span class="k">impl</span><span class="o">&lt;</span><span class="na">&#39;a</span><span class="p">,</span><span class="w"> </span><span class="na">&#39;gcx</span><span class="p">,</span><span class="w"> </span><span class="na">&#39;tcx</span><span class="o">&gt;</span><span class="w"> </span><span class="n">GeneratorSubsts</span><span class="o">&lt;</span><span class="na">&#39;tcx</span><span class="o">&gt;</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="k">pub</span><span class="w"> </span><span class="k">fn</span> <span class="nf">pre_transforms_tys</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="w"> </span><span class="n">def_id</span>: <span class="nc">DefId</span><span class="p">,</span><span class="w"> </span><span class="n">tcx</span>: <span class="nc">TyCtxt</span><span class="o">&lt;</span><span class="na">&#39;a</span><span class="p">,</span><span class="w"> </span><span class="na">&#39;gcx</span><span class="p">,</span><span class="w"> </span><span class="na">&#39;tcx</span><span class="o">&gt;</span><span class="p">)</span><span class="w"> </span>-&gt;
       <span class="nc">impl</span><span class="w"> </span><span class="nb">Iterator</span><span class="o">&lt;</span><span class="n">Item</span><span class="o">=</span><span class="n">Ty</span><span class="o">&lt;</span><span class="na">&#39;tcx</span><span class="o">&gt;&gt;</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="na">&#39;a</span><span class="w"></span>
<span class="w">    </span><span class="p">{</span><span class="w"></span>
<span class="w">       </span><span class="bp">self</span><span class="p">.</span><span class="n">upvar_tys</span><span class="p">(</span><span class="n">def_id</span><span class="p">,</span><span class="w"> </span><span class="n">tcx</span><span class="p">).</span><span class="n">iter</span><span class="p">().</span><span class="n">cloned</span><span class="p">().</span><span class="n">chain</span><span class="p">(</span><span class="n">iter</span>::<span class="n">once</span><span class="p">(</span><span class="n">tcx</span><span class="p">.</span><span class="n">types</span><span class="p">.</span><span class="kt">u32</span><span class="p">))</span><span class="w"></span>
<span class="w">    </span><span class="p">}</span><span class="w"></span>
<span class="p">...</span><span class="w"></span>
</pre></div>



<a name="156704670"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353488%20closure%20and%20disjoint%20fields/near/156704670" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://rust-lang.github.io/zulip_archive/stream/122657-t-compiler/wg-nll/topic/.2353488.20closure.20and.20disjoint.20fields.html#156704670">(Jan 23 2019 at 16:54)</a>:</h4>
<p><span class="user-mention" data-user-id="128294">@blitzerr</span> it looks like changing that signature may cause trouble</p>



<a name="156704675"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353488%20closure%20and%20disjoint%20fields/near/156704675" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://rust-lang.github.io/zulip_archive/stream/122657-t-compiler/wg-nll/topic/.2353488.20closure.20and.20disjoint.20fields.html#156704675">(Jan 23 2019 at 16:54)</a>:</h4>
<p>it may not be necessary to change to <code>'tcx, 'tcx</code></p>



<a name="156704681"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353488%20closure%20and%20disjoint%20fields/near/156704681" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://rust-lang.github.io/zulip_archive/stream/122657-t-compiler/wg-nll/topic/.2353488.20closure.20and.20disjoint.20fields.html#156704681">(Jan 23 2019 at 16:54)</a>:</h4>
<p>that does guarantee that we use this outside of an infernce context</p>



<a name="156704682"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353488%20closure%20and%20disjoint%20fields/near/156704682" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://rust-lang.github.io/zulip_archive/stream/122657-t-compiler/wg-nll/topic/.2353488.20closure.20and.20disjoint.20fields.html#156704682">(Jan 23 2019 at 16:54)</a>:</h4>
<p><em>but</em></p>



<a name="156704690"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353488%20closure%20and%20disjoint%20fields/near/156704690" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://rust-lang.github.io/zulip_archive/stream/122657-t-compiler/wg-nll/topic/.2353488.20closure.20and.20disjoint.20fields.html#156704690">(Jan 23 2019 at 16:54)</a>:</h4>
<p>we could also enforce that dynamically (by asserting)</p>



<a name="156704734"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353488%20closure%20and%20disjoint%20fields/near/156704734" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://rust-lang.github.io/zulip_archive/stream/122657-t-compiler/wg-nll/topic/.2353488.20closure.20and.20disjoint.20fields.html#156704734">(Jan 23 2019 at 16:55)</a>:</h4>
<p>in particular, <code>pre_transforms_ty</code> is used in the NLL type-check (which <em>does</em> have an inference context)</p>



<a name="156704771"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353488%20closure%20and%20disjoint%20fields/near/156704771" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://rust-lang.github.io/zulip_archive/stream/122657-t-compiler/wg-nll/topic/.2353488.20closure.20and.20disjoint.20fields.html#156704771">(Jan 23 2019 at 16:55)</a>:</h4>
<p>however, we could also just rewrite that function -- and perhaps move it into the NLL <code>type_check/mod.rs</code> file, the only place it is invoked -- to match against the tuple and extract the contents</p>



<a name="156704833"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353488%20closure%20and%20disjoint%20fields/near/156704833" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://rust-lang.github.io/zulip_archive/stream/122657-t-compiler/wg-nll/topic/.2353488.20closure.20and.20disjoint.20fields.html#156704833">(Jan 23 2019 at 16:56)</a>:</h4>
<p>the point being that we know that, when we are in the NLL type-check, these types should be fully inferred (we do have an active inference context then, but we are inferring different things)</p>



<a name="156704834"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353488%20closure%20and%20disjoint%20fields/near/156704834" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> blitzerr <a href="https://rust-lang.github.io/zulip_archive/stream/122657-t-compiler/wg-nll/topic/.2353488.20closure.20and.20disjoint.20fields.html#156704834">(Jan 23 2019 at 16:56)</a>:</h4>
<p>We are enforcing it dynamically (as in the latest change)</p>



<a name="156704863"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353488%20closure%20and%20disjoint%20fields/near/156704863" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> blitzerr <a href="https://rust-lang.github.io/zulip_archive/stream/122657-t-compiler/wg-nll/topic/.2353488.20closure.20and.20disjoint.20fields.html#156704863">(Jan 23 2019 at 16:56)</a>:</h4>
<p>So you suggest we don't mess with the signature ?</p>



<a name="156704914"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353488%20closure%20and%20disjoint%20fields/near/156704914" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://rust-lang.github.io/zulip_archive/stream/122657-t-compiler/wg-nll/topic/.2353488.20closure.20and.20disjoint.20fields.html#156704914">(Jan 23 2019 at 16:57)</a>:</h4>
<p>I'm torn -- it might not be worth the trouble</p>



<a name="156704922"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353488%20closure%20and%20disjoint%20fields/near/156704922" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://rust-lang.github.io/zulip_archive/stream/122657-t-compiler/wg-nll/topic/.2353488.20closure.20and.20disjoint.20fields.html#156704922">(Jan 23 2019 at 16:57)</a>:</h4>
<p>we could leave it for a FIXME</p>



<a name="156704930"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353488%20closure%20and%20disjoint%20fields/near/156704930" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> blitzerr <a href="https://rust-lang.github.io/zulip_archive/stream/122657-t-compiler/wg-nll/topic/.2353488.20closure.20and.20disjoint.20fields.html#156704930">(Jan 23 2019 at 16:57)</a>:</h4>
<p><span aria-label="joy" class="emoji emoji-1f602" role="img" title="joy">:joy:</span></p>



<a name="156704931"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353488%20closure%20and%20disjoint%20fields/near/156704931" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://rust-lang.github.io/zulip_archive/stream/122657-t-compiler/wg-nll/topic/.2353488.20closure.20and.20disjoint.20fields.html#156704931">(Jan 23 2019 at 16:57)</a>:</h4>
<p>I think this is what I would actually do :)</p>



<a name="156704946"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353488%20closure%20and%20disjoint%20fields/near/156704946" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://rust-lang.github.io/zulip_archive/stream/122657-t-compiler/wg-nll/topic/.2353488.20closure.20and.20disjoint.20fields.html#156704946">(Jan 23 2019 at 16:57)</a>:</h4>
<p>because i'd like to press on and get to the harder bits</p>



<a name="156704955"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353488%20closure%20and%20disjoint%20fields/near/156704955" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://rust-lang.github.io/zulip_archive/stream/122657-t-compiler/wg-nll/topic/.2353488.20closure.20and.20disjoint.20fields.html#156704955">(Jan 23 2019 at 16:57)</a>:</h4>
<p>and we can come back and clean this part up later</p>



<a name="156704963"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353488%20closure%20and%20disjoint%20fields/near/156704963" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> blitzerr <a href="https://rust-lang.github.io/zulip_archive/stream/122657-t-compiler/wg-nll/topic/.2353488.20closure.20and.20disjoint.20fields.html#156704963">(Jan 23 2019 at 16:57)</a>:</h4>
<p>Sounds good.</p>



<a name="156705008"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353488%20closure%20and%20disjoint%20fields/near/156705008" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://rust-lang.github.io/zulip_archive/stream/122657-t-compiler/wg-nll/topic/.2353488.20closure.20and.20disjoint.20fields.html#156705008">(Jan 23 2019 at 16:58)</a>:</h4>
<p>do you want to try and schedule another pairing session? might be useful to get into the next step</p>



<a name="156705015"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353488%20closure%20and%20disjoint%20fields/near/156705015" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> blitzerr <a href="https://rust-lang.github.io/zulip_archive/stream/122657-t-compiler/wg-nll/topic/.2353488.20closure.20and.20disjoint.20fields.html#156705015">(Jan 23 2019 at 16:58)</a>:</h4>
<p>I will leave a fixme and move to the next steps</p>



<a name="156705019"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353488%20closure%20and%20disjoint%20fields/near/156705019" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> blitzerr <a href="https://rust-lang.github.io/zulip_archive/stream/122657-t-compiler/wg-nll/topic/.2353488.20closure.20and.20disjoint.20fields.html#156705019">(Jan 23 2019 at 16:58)</a>:</h4>
<p>Absolutely</p>



<a name="156705032"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353488%20closure%20and%20disjoint%20fields/near/156705032" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> blitzerr <a href="https://rust-lang.github.io/zulip_archive/stream/122657-t-compiler/wg-nll/topic/.2353488.20closure.20and.20disjoint.20fields.html#156705032">(Jan 23 2019 at 16:58)</a>:</h4>
<p>How does this week look to you ?</p>



<a name="156705047"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353488%20closure%20and%20disjoint%20fields/near/156705047" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> blitzerr <a href="https://rust-lang.github.io/zulip_archive/stream/122657-t-compiler/wg-nll/topic/.2353488.20closure.20and.20disjoint.20fields.html#156705047">(Jan 23 2019 at 16:58)</a>:</h4>
<p>Any particular day you prefer ?</p>



<a name="156705775"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353488%20closure%20and%20disjoint%20fields/near/156705775" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://rust-lang.github.io/zulip_archive/stream/122657-t-compiler/wg-nll/topic/.2353488.20closure.20and.20disjoint.20fields.html#156705775">(Jan 23 2019 at 17:07)</a>:</h4>
<p>good question</p>



<a name="156705928"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353488%20closure%20and%20disjoint%20fields/near/156705928" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://rust-lang.github.io/zulip_archive/stream/122657-t-compiler/wg-nll/topic/.2353488.20closure.20and.20disjoint.20fields.html#156705928">(Jan 23 2019 at 17:08)</a>:</h4>
<p>I could maybe do later today for a bit</p>



<a name="156705933"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353488%20closure%20and%20disjoint%20fields/near/156705933" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://rust-lang.github.io/zulip_archive/stream/122657-t-compiler/wg-nll/topic/.2353488.20closure.20and.20disjoint.20fields.html#156705933">(Jan 23 2019 at 17:08)</a>:</h4>
<p>and/or some time on Friday is prob next best option</p>



<a name="156707081"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353488%20closure%20and%20disjoint%20fields/near/156707081" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> blitzerr <a href="https://rust-lang.github.io/zulip_archive/stream/122657-t-compiler/wg-nll/topic/.2353488.20closure.20and.20disjoint.20fields.html#156707081">(Jan 23 2019 at 17:21)</a>:</h4>
<p>How about Friday 12:30 - 1:30 pm your time ?</p>



<a name="156707539"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353488%20closure%20and%20disjoint%20fields/near/156707539" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> blitzerr <a href="https://rust-lang.github.io/zulip_archive/stream/122657-t-compiler/wg-nll/topic/.2353488.20closure.20and.20disjoint.20fields.html#156707539">(Jan 23 2019 at 17:27)</a>:</h4>
<p><span class="user-mention" data-user-id="116009">@nikomatsakis</span>  <span aria-label="wait one second" class="emoji emoji-261d" role="img" title="wait one second">:wait_one_second:</span>️</p>



<a name="156716108"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353488%20closure%20and%20disjoint%20fields/near/156716108" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://rust-lang.github.io/zulip_archive/stream/122657-t-compiler/wg-nll/topic/.2353488.20closure.20and.20disjoint.20fields.html#156716108">(Jan 23 2019 at 19:18)</a>:</h4>
<p><span class="user-mention" data-user-id="128294">@blitzerr</span> I could do that</p>



<a name="156716141"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353488%20closure%20and%20disjoint%20fields/near/156716141" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> blitzerr <a href="https://rust-lang.github.io/zulip_archive/stream/122657-t-compiler/wg-nll/topic/.2353488.20closure.20and.20disjoint.20fields.html#156716141">(Jan 23 2019 at 19:19)</a>:</h4>
<p>Cool, will set something up</p>



<a name="156716163"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353488%20closure%20and%20disjoint%20fields/near/156716163" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://rust-lang.github.io/zulip_archive/stream/122657-t-compiler/wg-nll/topic/.2353488.20closure.20and.20disjoint.20fields.html#156716163">(Jan 23 2019 at 19:19)</a>:</h4>
<p>ok, if you can send me an invite to <code>nmatsakis@mozilla.com</code> would be appreciated</p>



<a name="156716632"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353488%20closure%20and%20disjoint%20fields/near/156716632" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> blitzerr <a href="https://rust-lang.github.io/zulip_archive/stream/122657-t-compiler/wg-nll/topic/.2353488.20closure.20and.20disjoint.20fields.html#156716632">(Jan 23 2019 at 19:24)</a>:</h4>
<p><span class="user-mention" data-user-id="116009">@nikomatsakis</span>     I just did  :D</p>



<a name="156716689"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353488%20closure%20and%20disjoint%20fields/near/156716689" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> blitzerr <a href="https://rust-lang.github.io/zulip_archive/stream/122657-t-compiler/wg-nll/topic/.2353488.20closure.20and.20disjoint.20fields.html#156716689">(Jan 23 2019 at 19:25)</a>:</h4>
<p>Let me know of you get it and if the video url looks good to you. I used the i-heart-rust extension that you generally use.</p>



<a name="156875541"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353488%20closure%20and%20disjoint%20fields/near/156875541" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://rust-lang.github.io/zulip_archive/stream/122657-t-compiler/wg-nll/topic/.2353488.20closure.20and.20disjoint.20fields.html#156875541">(Jan 25 2019 at 19:03)</a>:</h4>
<p><span class="user-mention" data-user-id="128294">@blitzerr</span> the new video is uploading to YouTube now</p>



<a name="156875674"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353488%20closure%20and%20disjoint%20fields/near/156875674" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> blitzerr <a href="https://rust-lang.github.io/zulip_archive/stream/122657-t-compiler/wg-nll/topic/.2353488.20closure.20and.20disjoint.20fields.html#156875674">(Jan 25 2019 at 19:04)</a>:</h4>
<p><span class="user-mention" data-user-id="116009">@nikomatsakis</span>  Awesome <span aria-label="+1" class="emoji emoji-1f44d" role="img" title="+1">:+1:</span><br>
Thanks a lot for your time. Very grateful <span aria-label="pray" class="emoji emoji-1f64f" role="img" title="pray">:pray:</span></p>



<a name="156875688"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353488%20closure%20and%20disjoint%20fields/near/156875688" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://rust-lang.github.io/zulip_archive/stream/122657-t-compiler/wg-nll/topic/.2353488.20closure.20and.20disjoint.20fields.html#156875688">(Jan 25 2019 at 19:04)</a>:</h4>
<p>Likewise =)</p>



<a name="156878850"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353488%20closure%20and%20disjoint%20fields/near/156878850" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://rust-lang.github.io/zulip_archive/stream/122657-t-compiler/wg-nll/topic/.2353488.20closure.20and.20disjoint.20fields.html#156878850">(Jan 25 2019 at 19:42)</a>:</h4>
<p><span class="user-mention" data-user-id="128294">@blitzerr</span> <a href="https://youtu.be/2QCuNtISoYc" target="_blank" title="https://youtu.be/2QCuNtISoYc">video uploaded</a></p>



<a name="156880370"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353488%20closure%20and%20disjoint%20fields/near/156880370" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> blitzerr <a href="https://rust-lang.github.io/zulip_archive/stream/122657-t-compiler/wg-nll/topic/.2353488.20closure.20and.20disjoint.20fields.html#156880370">(Jan 25 2019 at 20:02)</a>:</h4>
<p>Thank you <span class="user-mention" data-user-id="116009">@nikomatsakis</span></p>



<a name="157361285"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353488%20closure%20and%20disjoint%20fields/near/157361285" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://rust-lang.github.io/zulip_archive/stream/122657-t-compiler/wg-nll/topic/.2353488.20closure.20and.20disjoint.20fields.html#157361285">(Feb 01 2019 at 15:34)</a>:</h4>
<p><span class="user-mention" data-user-id="128294">@blitzerr</span> how is it going with this?</p>



<a name="157362177"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353488%20closure%20and%20disjoint%20fields/near/157362177" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> blitzerr <a href="https://rust-lang.github.io/zulip_archive/stream/122657-t-compiler/wg-nll/topic/.2353488.20closure.20and.20disjoint.20fields.html#157362177">(Feb 01 2019 at 15:47)</a>:</h4>
<p>Sorry <span class="user-mention" data-user-id="116009">@nikomatsakis</span> <br>
It hasn't been going as fast as we would like it to be. Haven't had much time this week at all in the evenings. I am planning to find some time this weekend. Sorry again for not making any progress.</p>



<a name="157362544"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353488%20closure%20and%20disjoint%20fields/near/157362544" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://rust-lang.github.io/zulip_archive/stream/122657-t-compiler/wg-nll/topic/.2353488.20closure.20and.20disjoint.20fields.html#157362544">(Feb 01 2019 at 15:52)</a>:</h4>
<p><span class="user-mention" data-user-id="128294">@blitzerr</span> no pressure, just wanted to check in</p>



<a name="157363300"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353488%20closure%20and%20disjoint%20fields/near/157363300" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> blitzerr <a href="https://rust-lang.github.io/zulip_archive/stream/122657-t-compiler/wg-nll/topic/.2353488.20closure.20and.20disjoint.20fields.html#157363300">(Feb 01 2019 at 16:03)</a>:</h4>
<p>Thanks <span class="user-mention" data-user-id="116009">@nikomatsakis</span></p>



<a name="157481853"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353488%20closure%20and%20disjoint%20fields/near/157481853" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> blitzerr <a href="https://rust-lang.github.io/zulip_archive/stream/122657-t-compiler/wg-nll/topic/.2353488.20closure.20and.20disjoint.20fields.html#157481853">(Feb 03 2019 at 20:11)</a>:</h4>
<p><span class="user-mention" data-user-id="116009">@nikomatsakis</span> </p>
<div class="codehilite"><pre><span></span><span class="n">thread</span><span class="w"> </span><span class="err">&#39;</span><span class="p">[</span><span class="n">ui</span><span class="p">]</span><span class="w"> </span><span class="n">ui</span><span class="o">/</span><span class="n">closures</span><span class="o">/</span><span class="n">closure</span><span class="o">-</span><span class="k">move</span><span class="o">-</span><span class="n">sync</span><span class="p">.</span><span class="n">rs</span><span class="err">&#39;</span><span class="w"> </span><span class="n">panicked</span><span class="w"> </span><span class="n">at</span><span class="w"> </span><span class="na">&#39;explicit</span><span class="w"> </span><span class="n">panic</span><span class="err">&#39;</span><span class="p">,</span><span class="w"> </span><span class="n">src</span><span class="o">/</span><span class="n">tools</span><span class="o">/</span><span class="n">compiletest</span><span class="o">/</span><span class="n">src</span><span class="o">/</span><span class="n">runtest</span><span class="p">.</span><span class="n">rs</span>:<span class="mi">3245</span>:<span class="mi">9</span><span class="w"></span>

<span class="o">----</span><span class="w"> </span><span class="p">[</span><span class="n">ui</span><span class="p">]</span><span class="w"> </span><span class="n">ui</span><span class="o">/</span><span class="n">closures</span><span class="o">/</span><span class="n">closure</span><span class="o">-</span><span class="n">no</span><span class="o">-</span><span class="k">fn</span><span class="o">-</span><span class="mf">1.</span><span class="n">rs</span><span class="w"> </span><span class="n">stdout</span><span class="w"> </span><span class="o">----</span><span class="w"></span>
<span class="n">diff</span><span class="w"> </span><span class="n">of</span><span class="w"> </span><span class="n">stderr</span>:

<span class="mi">5</span><span class="w">      </span><span class="o">|</span><span class="w">                             </span><span class="o">^^^^^^^^^^^^^^^^^^^^^</span><span class="w"> </span><span class="n">expected</span><span class="w"> </span><span class="k">fn</span> <span class="nf">pointer</span><span class="p">,</span><span class="w"> </span><span class="n">found</span><span class="w"> </span><span class="n">closure</span><span class="w"></span>
<span class="mi">6</span><span class="w">      </span><span class="o">|</span><span class="w"></span>
<span class="mi">7</span><span class="w">      </span><span class="o">=</span><span class="w"> </span><span class="n">note</span>: <span class="nc">expected</span><span class="w"> </span><span class="k">type</span> <span class="err">`</span><span class="k">fn</span><span class="p">(</span><span class="kt">u8</span><span class="p">)</span><span class="w"> </span>-&gt; <span class="kt">u8</span><span class="err">`</span><span class="w"></span>
<span class="o">-</span><span class="w">                 </span><span class="n">found</span><span class="w"> </span><span class="k">type</span> <span class="err">`</span><span class="p">[</span><span class="n">closure</span><span class="o">@</span><span class="cp">$DIR</span><span class="o">/</span><span class="n">closure</span><span class="o">-</span><span class="n">no</span><span class="o">-</span><span class="k">fn</span><span class="o">-</span><span class="mf">1.</span><span class="n">rs</span>:<span class="mi">6</span>:<span class="mi">29</span>: <span class="mi">6</span>:<span class="mi">50</span><span class="w"> </span><span class="n">a</span>:<span class="nc">_</span><span class="p">]</span><span class="err">`</span><span class="w"></span>
<span class="o">+</span><span class="w">                 </span><span class="n">found</span><span class="w"> </span><span class="k">type</span> <span class="err">`</span><span class="p">[</span><span class="n">closure</span><span class="o">@</span><span class="cp">$DIR</span><span class="o">/</span><span class="n">closure</span><span class="o">-</span><span class="n">no</span><span class="o">-</span><span class="k">fn</span><span class="o">-</span><span class="mf">1.</span><span class="n">rs</span>:<span class="mi">6</span>:<span class="mi">29</span>: <span class="mi">6</span>:<span class="mi">50</span><span class="p">]</span><span class="err">`</span><span class="w"></span>
<span class="mi">9</span><span class="w"></span>
<span class="mi">10</span><span class="w">  </span><span class="n">error</span>: <span class="nc">aborting</span><span class="w"> </span><span class="n">due</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="n">previous</span><span class="w"> </span><span class="n">error</span><span class="w"></span>
<span class="mi">11</span><span class="w"></span>
</pre></div>


<p>If we look at this error, we somehow removed a variable from the closure name <code>[closure@$DIR/closure-no-fn-1.rs:6:29: 6:50 a:_]</code> to <code>[closure@$DIR/closure-no-fn-1.rs:6:29: 6:50]</code></p>



<a name="157481983"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353488%20closure%20and%20disjoint%20fields/near/157481983" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> blitzerr <a href="https://rust-lang.github.io/zulip_archive/stream/122657-t-compiler/wg-nll/topic/.2353488.20closure.20and.20disjoint.20fields.html#157481983">(Feb 03 2019 at 20:15)</a>:</h4>
<p>generators errors are more wordy, and I don't understand them</p>
<div class="codehilite"><pre><span></span><span class="o">----</span><span class="w"> </span><span class="p">[</span><span class="n">ui</span><span class="p">]</span><span class="w"> </span><span class="n">ui</span><span class="o">/</span><span class="n">generator</span><span class="o">/</span><span class="n">auto</span><span class="o">-</span><span class="k">trait</span><span class="o">-</span><span class="n">regions</span><span class="p">.</span><span class="n">rs</span><span class="w"> </span><span class="n">stdout</span><span class="w"> </span><span class="o">----</span><span class="w"></span>
<span class="n">diff</span><span class="w"> </span><span class="n">of</span><span class="w"> </span><span class="n">stderr</span>:

<span class="o">-</span><span class="w">   </span><span class="n">error</span>: <span class="nc">implementation</span><span class="w"> </span><span class="n">of</span><span class="w"> </span><span class="err">`</span><span class="n">Foo</span><span class="err">`</span><span class="w"> </span><span class="n">is</span><span class="w"> </span><span class="n">not</span><span class="w"> </span><span class="n">general</span><span class="w"> </span><span class="n">enough</span><span class="w"></span>
<span class="o">-</span><span class="w">     </span><span class="o">-</span>-&gt; <span class="cp">$DIR</span><span class="o">/</span><span class="n">auto</span><span class="o">-</span><span class="k">trait</span><span class="o">-</span><span class="n">regions</span><span class="p">.</span><span class="n">rs</span>:<span class="mi">30</span>:<span class="mi">5</span><span class="w"></span>
<span class="o">+</span><span class="w">   </span><span class="n">error</span><span class="p">[</span><span class="n">E0597</span><span class="p">]</span>: <span class="nc">borrowed</span><span class="w"> </span><span class="n">value</span><span class="w"> </span><span class="n">does</span><span class="w"> </span><span class="n">not</span><span class="w"> </span><span class="n">live</span><span class="w"> </span><span class="n">long</span><span class="w"> </span><span class="n">enough</span><span class="w"></span>
<span class="o">+</span><span class="w">     </span><span class="o">-</span>-&gt; <span class="cp">$DIR</span><span class="o">/</span><span class="n">auto</span><span class="o">-</span><span class="k">trait</span><span class="o">-</span><span class="n">regions</span><span class="p">.</span><span class="n">rs</span>:<span class="mi">44</span>:<span class="mi">24</span><span class="w"></span>
<span class="mi">3</span><span class="w">      </span><span class="o">|</span><span class="w"></span>
<span class="o">-</span><span class="w">   </span><span class="n">LL</span><span class="w"> </span><span class="o">|</span><span class="w">     </span><span class="n">assert_foo</span><span class="p">(</span><span class="n">gen</span><span class="p">);</span><span class="w"></span>
<span class="o">-</span><span class="w">      </span><span class="o">|</span><span class="w">     </span><span class="o">^^^^^^^^^^</span><span class="w"></span>
<span class="o">+</span><span class="w">   </span><span class="n">LL</span><span class="w"> </span><span class="o">|</span><span class="w">         </span><span class="kd">let</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">A</span><span class="p">(</span><span class="o">&amp;</span><span class="k">mut</span><span class="w"> </span><span class="kc">true</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="k">mut</span><span class="w"> </span><span class="kc">true</span><span class="p">,</span><span class="w"> </span><span class="n">No</span><span class="p">);</span><span class="w"></span>
<span class="o">+</span><span class="w">      </span><span class="o">|</span><span class="w">                        </span><span class="o">^^^^</span><span class="w">                </span><span class="o">-</span><span class="w"> </span><span class="n">temporary</span><span class="w"> </span><span class="n">value</span><span class="w"> </span><span class="n">dropped</span><span class="w"> </span><span class="n">here</span><span class="w"> </span><span class="k">while</span><span class="w"> </span><span class="n">still</span><span class="w"> </span><span class="n">borrowed</span><span class="w"></span>
<span class="o">+</span><span class="w">      </span><span class="o">|</span><span class="w">                        </span><span class="o">|</span><span class="w"></span>
<span class="o">+</span><span class="w">      </span><span class="o">|</span><span class="w">                        </span><span class="n">temporary</span><span class="w"> </span><span class="n">value</span><span class="w"> </span><span class="n">does</span><span class="w"> </span><span class="n">not</span><span class="w"> </span><span class="n">live</span><span class="w"> </span><span class="n">long</span><span class="w"> </span><span class="n">enough</span><span class="w"></span>
<span class="o">+</span><span class="w">   </span><span class="p">...</span><span class="w"></span>
<span class="o">+</span><span class="w">   </span><span class="n">LL</span><span class="w"> </span><span class="o">|</span><span class="w">     </span><span class="p">};</span><span class="w"></span>
<span class="o">+</span><span class="w">      </span><span class="o">|</span><span class="w">     </span><span class="o">-</span><span class="w"> </span><span class="n">temporary</span><span class="w"> </span><span class="n">value</span><span class="w"> </span><span class="n">needs</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="n">live</span><span class="w"> </span><span class="n">until</span><span class="w"> </span><span class="n">here</span><span class="w"></span>
<span class="mi">6</span><span class="w">      </span><span class="o">|</span><span class="w"></span>
<span class="o">-</span><span class="w">      </span><span class="o">=</span><span class="w"> </span><span class="n">note</span>: <span class="err">`</span><span class="o">&amp;</span><span class="err">&#39;</span><span class="mi">0</span><span class="w"> </span><span class="n">OnlyFooIfStaticRef</span><span class="err">`</span><span class="w"> </span><span class="n">must</span><span class="w"> </span><span class="n">implement</span><span class="w"> </span><span class="err">`</span><span class="n">Foo</span><span class="err">`</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="n">any</span><span class="w"> </span><span class="n">lifetime</span><span class="w"> </span><span class="err">`&#39;</span><span class="mi">0</span><span class="err">`</span><span class="w"></span>
<span class="o">-</span><span class="w">      </span><span class="o">=</span><span class="w"> </span><span class="n">note</span>: <span class="nc">but</span><span class="w"> </span><span class="err">`</span><span class="o">&amp;</span><span class="err">&#39;</span><span class="mi">1</span><span class="w"> </span><span class="n">OnlyFooIfStaticRef</span><span class="err">`</span><span class="w"> </span><span class="n">only</span><span class="w"> </span><span class="n">implements</span><span class="w"> </span><span class="err">`</span><span class="n">Foo</span><span class="err">`</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">lifetime</span><span class="w"> </span><span class="err">`&#39;</span><span class="mi">1</span><span class="err">`</span><span class="w"></span>
<span class="o">+</span><span class="w">      </span><span class="o">=</span><span class="w"> </span><span class="n">note</span>: <span class="nc">consider</span><span class="w"> </span><span class="n">using</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="err">`</span><span class="kd">let</span><span class="err">`</span><span class="w"> </span><span class="n">binding</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="n">increase</span><span class="w"> </span><span class="n">its</span><span class="w"> </span><span class="n">lifetime</span><span class="w"></span>
<span class="mi">9</span><span class="w"></span>
<span class="o">-</span><span class="w">   </span><span class="n">error</span>: <span class="nc">implementation</span><span class="w"> </span><span class="n">of</span><span class="w"> </span><span class="err">`</span><span class="n">Foo</span><span class="err">`</span><span class="w"> </span><span class="n">is</span><span class="w"> </span><span class="n">not</span><span class="w"> </span><span class="n">general</span><span class="w"> </span><span class="n">enough</span><span class="w"></span>
<span class="o">-</span><span class="w">     </span><span class="o">-</span>-&gt; <span class="cp">$DIR</span><span class="o">/</span><span class="n">auto</span><span class="o">-</span><span class="k">trait</span><span class="o">-</span><span class="n">regions</span><span class="p">.</span><span class="n">rs</span>:<span class="mi">48</span>:<span class="mi">5</span><span class="w"></span>
<span class="o">+</span><span class="w">   </span><span class="n">error</span><span class="p">[</span><span class="n">E0597</span><span class="p">]</span>: <span class="nc">borrowed</span><span class="w"> </span><span class="n">value</span><span class="w"> </span><span class="n">does</span><span class="w"> </span><span class="n">not</span><span class="w"> </span><span class="n">live</span><span class="w"> </span><span class="n">long</span><span class="w"> </span><span class="n">enough</span><span class="w"></span>
<span class="o">+</span><span class="w">     </span><span class="o">-</span>-&gt; <span class="cp">$DIR</span><span class="o">/</span><span class="n">auto</span><span class="o">-</span><span class="k">trait</span><span class="o">-</span><span class="n">regions</span><span class="p">.</span><span class="n">rs</span>:<span class="mi">44</span>:<span class="mi">35</span><span class="w"></span>
<span class="mi">12</span><span class="w">     </span><span class="o">|</span><span class="w"></span>
<span class="o">-</span><span class="w">   </span><span class="n">LL</span><span class="w"> </span><span class="o">|</span><span class="w">     </span><span class="n">assert_foo</span><span class="p">(</span><span class="n">gen</span><span class="p">);</span><span class="w"></span>
<span class="o">-</span><span class="w">      </span><span class="o">|</span><span class="w">     </span><span class="o">^^^^^^^^^^</span><span class="w"></span>
<span class="o">+</span><span class="w">   </span><span class="n">LL</span><span class="w"> </span><span class="o">|</span><span class="w">         </span><span class="kd">let</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">A</span><span class="p">(</span><span class="o">&amp;</span><span class="k">mut</span><span class="w"> </span><span class="kc">true</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="k">mut</span><span class="w"> </span><span class="kc">true</span><span class="p">,</span><span class="w"> </span><span class="n">No</span><span class="p">);</span><span class="w"></span>
<span class="o">+</span><span class="w">      </span><span class="o">|</span><span class="w">                                   </span><span class="o">^^^^</span><span class="w">     </span><span class="o">-</span><span class="w"> </span><span class="n">temporary</span><span class="w"> </span><span class="n">value</span><span class="w"> </span><span class="n">dropped</span><span class="w"> </span><span class="n">here</span><span class="w"> </span><span class="k">while</span><span class="w"> </span><span class="n">still</span><span class="w"> </span><span class="n">borrowed</span><span class="w"></span>
<span class="o">+</span><span class="w">      </span><span class="o">|</span><span class="w">                                   </span><span class="o">|</span><span class="w"></span>
<span class="o">+</span><span class="w">      </span><span class="o">|</span><span class="w">                                   </span><span class="n">temporary</span><span class="w"> </span><span class="n">value</span><span class="w"> </span><span class="n">does</span><span class="w"> </span><span class="n">not</span><span class="w"> </span><span class="n">live</span><span class="w"> </span><span class="n">long</span><span class="w"> </span><span class="n">enough</span><span class="w"></span>
<span class="o">+</span><span class="w">   </span><span class="p">...</span><span class="w"></span>
<span class="o">+</span><span class="w">   </span><span class="n">LL</span><span class="w"> </span><span class="o">|</span><span class="w">     </span><span class="p">};</span><span class="w"></span>
<span class="o">+</span><span class="w">      </span><span class="o">|</span><span class="w">     </span><span class="o">-</span><span class="w"> </span><span class="n">temporary</span><span class="w"> </span><span class="n">value</span><span class="w"> </span><span class="n">needs</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="n">live</span><span class="w"> </span><span class="n">until</span><span class="w"> </span><span class="n">here</span><span class="w"></span>
<span class="mi">15</span><span class="w">     </span><span class="o">|</span><span class="w"></span>
<span class="o">-</span><span class="w">      </span><span class="o">=</span><span class="w"> </span><span class="n">note</span>: <span class="err">`</span><span class="n">A</span><span class="o">&lt;</span><span class="err">&#39;</span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="err">&#39;</span><span class="mi">1</span><span class="o">&gt;</span><span class="err">`</span><span class="w"> </span><span class="n">must</span><span class="w"> </span><span class="n">implement</span><span class="w"> </span><span class="err">`</span><span class="n">Foo</span><span class="err">`</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="n">any</span><span class="w"> </span><span class="n">two</span><span class="w"> </span><span class="n">lifetimes</span><span class="w"> </span><span class="err">`&#39;</span><span class="mi">0</span><span class="err">`</span><span class="w"> </span><span class="n">and</span><span class="w"> </span><span class="err">`&#39;</span><span class="mi">1</span><span class="err">`</span><span class="w"></span>
<span class="o">-</span><span class="w">      </span><span class="o">=</span><span class="w"> </span><span class="n">note</span>: <span class="nc">but</span><span class="w"> </span><span class="err">`</span><span class="n">A</span><span class="o">&lt;</span><span class="na">&#39;_</span><span class="p">,</span><span class="w"> </span><span class="err">&#39;</span><span class="mi">2</span><span class="o">&gt;</span><span class="err">`</span><span class="w"> </span><span class="n">only</span><span class="w"> </span><span class="n">implements</span><span class="w"> </span><span class="err">`</span><span class="n">Foo</span><span class="err">`</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">lifetime</span><span class="w"> </span><span class="err">`&#39;</span><span class="mi">2</span><span class="err">`</span><span class="w"></span>
<span class="o">+</span><span class="w">      </span><span class="o">=</span><span class="w"> </span><span class="n">note</span>: <span class="nc">consider</span><span class="w"> </span><span class="n">using</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="err">`</span><span class="kd">let</span><span class="err">`</span><span class="w"> </span><span class="n">binding</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="n">increase</span><span class="w"> </span><span class="n">its</span><span class="w"> </span><span class="n">lifetime</span><span class="w"></span>
<span class="mi">18</span><span class="w"></span>
<span class="o">-</span><span class="w">   </span><span class="n">error</span>: <span class="nc">aborting</span><span class="w"> </span><span class="n">due</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="mi">2</span><span class="w"> </span><span class="n">previous</span><span class="w"> </span><span class="n">errors</span><span class="w"></span>
<span class="o">+</span><span class="w">   </span><span class="n">error</span><span class="p">[</span><span class="n">E0626</span><span class="p">]</span>: <span class="nc">borrow</span><span class="w"> </span><span class="n">may</span><span class="w"> </span><span class="n">still</span><span class="w"> </span><span class="n">be</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="k">use</span><span class="w"> </span><span class="n">when</span><span class="w"> </span><span class="n">generator</span><span class="w"> </span><span class="n">yields</span><span class="w"></span>
<span class="o">+</span><span class="w">     </span><span class="o">-</span>-&gt; <span class="cp">$DIR</span><span class="o">/</span><span class="n">auto</span><span class="o">-</span><span class="k">trait</span><span class="o">-</span><span class="n">regions</span><span class="p">.</span><span class="n">rs</span>:<span class="mi">44</span>:<span class="mi">24</span><span class="w"></span>
<span class="o">+</span><span class="w">      </span><span class="o">|</span><span class="w"></span>
<span class="o">+</span><span class="w">   </span><span class="n">LL</span><span class="w"> </span><span class="o">|</span><span class="w">         </span><span class="kd">let</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">A</span><span class="p">(</span><span class="o">&amp;</span><span class="k">mut</span><span class="w"> </span><span class="kc">true</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="k">mut</span><span class="w"> </span><span class="kc">true</span><span class="p">,</span><span class="w"> </span><span class="n">No</span><span class="p">);</span><span class="w"></span>
<span class="o">+</span><span class="w">      </span><span class="o">|</span><span class="w">                        </span><span class="o">^^^^</span><span class="w"></span>
<span class="o">+</span><span class="w">   </span><span class="n">LL</span><span class="w"> </span><span class="o">|</span><span class="w">         </span><span class="kr">yield</span><span class="p">;</span><span class="w"></span>
<span class="o">+</span><span class="w">      </span><span class="o">|</span><span class="w">         </span><span class="o">-----</span><span class="w"> </span><span class="n">possible</span><span class="w"> </span><span class="kr">yield</span><span class="w"> </span><span class="n">occurs</span><span class="w"> </span><span class="n">here</span><span class="w"></span>
<span class="mi">20</span><span class="w"></span>
<span class="o">+</span><span class="w">   </span><span class="n">error</span><span class="p">[</span><span class="n">E0626</span><span class="p">]</span>: <span class="nc">borrow</span><span class="w"> </span><span class="n">may</span><span class="w"> </span><span class="n">still</span><span class="w"> </span><span class="n">be</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="k">use</span><span class="w"> </span><span class="n">when</span><span class="w"> </span><span class="n">generator</span><span class="w"> </span><span class="n">yields</span><span class="w"></span>
<span class="o">+</span><span class="w">     </span><span class="o">-</span>-&gt; <span class="cp">$DIR</span><span class="o">/</span><span class="n">auto</span><span class="o">-</span><span class="k">trait</span><span class="o">-</span><span class="n">regions</span><span class="p">.</span><span class="n">rs</span>:<span class="mi">44</span>:<span class="mi">35</span><span class="w"></span>
<span class="o">+</span><span class="w">      </span><span class="o">|</span><span class="w"></span>
<span class="o">+</span><span class="w">   </span><span class="n">LL</span><span class="w"> </span><span class="o">|</span><span class="w">         </span><span class="kd">let</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">A</span><span class="p">(</span><span class="o">&amp;</span><span class="k">mut</span><span class="w"> </span><span class="kc">true</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="k">mut</span><span class="w"> </span><span class="kc">true</span><span class="p">,</span><span class="w"> </span><span class="n">No</span><span class="p">);</span><span class="w"></span>
<span class="o">+</span><span class="w">      </span><span class="o">|</span><span class="w">                                   </span><span class="o">^^^^</span><span class="w"></span>
<span class="o">+</span><span class="w">   </span><span class="n">LL</span><span class="w"> </span><span class="o">|</span><span class="w">         </span><span class="kr">yield</span><span class="p">;</span><span class="w"></span>
<span class="o">+</span><span class="w">      </span><span class="o">|</span><span class="w">         </span><span class="o">-----</span><span class="w"> </span><span class="n">possible</span><span class="w"> </span><span class="kr">yield</span><span class="w"> </span><span class="n">occurs</span><span class="w"> </span><span class="n">here</span><span class="w"></span>
<span class="o">+</span><span class="w"></span>
<span class="o">+</span><span class="w">   </span><span class="n">error</span>: <span class="nc">aborting</span><span class="w"> </span><span class="n">due</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="mi">4</span><span class="w"> </span><span class="n">previous</span><span class="w"> </span><span class="n">errors</span><span class="w"></span>
<span class="o">+</span><span class="w"></span>
<span class="o">+</span><span class="w">   </span><span class="nb">Some</span><span class="w"> </span><span class="n">errors</span><span class="w"> </span><span class="n">occurred</span>: <span class="nc">E0597</span><span class="p">,</span><span class="w"> </span><span class="n">E0626</span><span class="p">.</span><span class="w"></span>
<span class="o">+</span><span class="w">   </span><span class="n">For</span><span class="w"> </span><span class="n">more</span><span class="w"> </span><span class="n">information</span><span class="w"> </span><span class="n">about</span><span class="w"> </span><span class="n">an</span><span class="w"> </span><span class="n">error</span><span class="p">,</span><span class="w"> </span><span class="n">try</span><span class="w"> </span><span class="err">`</span><span class="n">rustc</span><span class="w"> </span><span class="o">--</span><span class="n">explain</span><span class="w"> </span><span class="n">E0597</span><span class="err">`</span><span class="p">.</span><span class="w"></span>
<span class="mi">21</span><span class="w"></span>
</pre></div>



<a name="157482990"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353488%20closure%20and%20disjoint%20fields/near/157482990" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> blitzerr <a href="https://rust-lang.github.io/zulip_archive/stream/122657-t-compiler/wg-nll/topic/.2353488.20closure.20and.20disjoint.20fields.html#157482990">(Feb 03 2019 at 20:46)</a>:</h4>
<p>For the closure related failures, looking at the code, looks like it comes from <br>
<code>format!("[closure@{:?}]", tcx.hir().span(node_id))</code> in <code>src/librustc/mir/mod.rs</code>.  So might be that the span no longer gives you that param.</p>



<a name="158574147"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353488%20closure%20and%20disjoint%20fields/near/158574147" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> blitzerr <a href="https://rust-lang.github.io/zulip_archive/stream/122657-t-compiler/wg-nll/topic/.2353488.20closure.20and.20disjoint.20fields.html#158574147">(Feb 14 2019 at 23:13)</a>:</h4>
<p><span class="user-mention" data-user-id="116009">@nikomatsakis</span>  <span aria-label="wave" class="emoji emoji-1f44b" role="img" title="wave">:wave:</span><br>
Based on some of your post after all hands, I assume you are re-organizing things that you had on your plate. What happens to this ? <span aria-label="slight smile" class="emoji emoji-1f642" role="img" title="slight smile">:slight_smile:</span></p>



<a name="158648414"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353488%20closure%20and%20disjoint%20fields/near/158648414" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://rust-lang.github.io/zulip_archive/stream/122657-t-compiler/wg-nll/topic/.2353488.20closure.20and.20disjoint.20fields.html#158648414">(Feb 15 2019 at 20:52)</a>:</h4>
<p><span class="user-mention" data-user-id="128294">@blitzerr</span> heh, a good questionm, I've been wondering about that very question!</p>



<a name="158648455"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353488%20closure%20and%20disjoint%20fields/near/158648455" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://rust-lang.github.io/zulip_archive/stream/122657-t-compiler/wg-nll/topic/.2353488.20closure.20and.20disjoint.20fields.html#158648455">(Feb 15 2019 at 20:53)</a>:</h4>
<p>At the moment, I'm still hoping to work with you on it, but it might be better for both of us if we could find another mentor.</p>



<a name="158649729"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353488%20closure%20and%20disjoint%20fields/near/158649729" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> blitzerr <a href="https://rust-lang.github.io/zulip_archive/stream/122657-t-compiler/wg-nll/topic/.2353488.20closure.20and.20disjoint.20fields.html#158649729">(Feb 15 2019 at 21:10)</a>:</h4>
<p><span class="user-mention" data-user-id="116009">@nikomatsakis</span>  sure, whatever helps you be more efficient.</p>



<a name="158649788"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353488%20closure%20and%20disjoint%20fields/near/158649788" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> blitzerr <a href="https://rust-lang.github.io/zulip_archive/stream/122657-t-compiler/wg-nll/topic/.2353488.20closure.20and.20disjoint.20fields.html#158649788">(Feb 15 2019 at 21:11)</a>:</h4>
<p>I was also wondering if for the less fortunate, who were not invited, will there be a blog post or rust internal post with the big bullet points from the all hands? <span aria-label="grinning" class="emoji emoji-1f600" role="img" title="grinning">:grinning:</span></p>



<a name="159179740"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353488%20closure%20and%20disjoint%20fields/near/159179740" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://rust-lang.github.io/zulip_archive/stream/122657-t-compiler/wg-nll/topic/.2353488.20closure.20and.20disjoint.20fields.html#159179740">(Feb 22 2019 at 18:36)</a>:</h4>
<p><span class="user-mention" data-user-id="128294">@blitzerr</span> yeah I want to make one of those. Also we should try to talk, maybe next week?</p>



<a name="159180027"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353488%20closure%20and%20disjoint%20fields/near/159180027" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> blitzerr <a href="https://rust-lang.github.io/zulip_archive/stream/122657-t-compiler/wg-nll/topic/.2353488.20closure.20and.20disjoint.20fields.html#159180027">(Feb 22 2019 at 18:39)</a>:</h4>
<p><span class="user-mention" data-user-id="116009">@nikomatsakis</span>  My availability will be a little spotty till mid March. I will be travelling. But if we can sync async, then I can try to make some progress on the issue.</p>
<p>If you want a talk today, I will be available.</p>



<a name="159778091"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353488%20closure%20and%20disjoint%20fields/near/159778091" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> blitzerr <a href="https://rust-lang.github.io/zulip_archive/stream/122657-t-compiler/wg-nll/topic/.2353488.20closure.20and.20disjoint.20fields.html#159778091">(Mar 02 2019 at 04:53)</a>:</h4>
<p><span class="user-mention" data-user-id="116009">@nikomatsakis</span> <br>
I think that now you have some time after the region bug fix so I would like to draw your attention to this.  <span aria-label="slight smile" class="emoji emoji-1f642" role="img" title="slight smile">:slight_smile:</span></p>



<a name="159778139"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353488%20closure%20and%20disjoint%20fields/near/159778139" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> blitzerr <a href="https://rust-lang.github.io/zulip_archive/stream/122657-t-compiler/wg-nll/topic/.2353488.20closure.20and.20disjoint.20fields.html#159778139">(Mar 02 2019 at 04:54)</a>:</h4>
<p>One of the ui-tests compiled with rustc with our changes</p>
<div class="codehilite"><pre><span></span><span class="n">rustc</span><span class="w"> </span><span class="o">+</span><span class="n">stage1</span><span class="w"> </span><span class="n">src</span><span class="o">/</span><span class="n">test</span><span class="o">/</span><span class="n">ui</span><span class="o">/</span><span class="n">not</span><span class="o">-</span><span class="n">clone</span><span class="o">-</span><span class="n">closure</span><span class="p">.</span><span class="n">rs</span><span class="w"></span>
<span class="n">error</span><span class="p">[</span><span class="n">E0277</span><span class="p">]</span>: <span class="nc">the</span><span class="w"> </span><span class="k">trait</span><span class="w"> </span><span class="n">bound</span><span class="w"> </span><span class="err">`</span><span class="n">S</span>: <span class="nc">std</span>::<span class="n">clone</span>::<span class="nb">Clone</span><span class="err">`</span><span class="w"> </span><span class="n">is</span><span class="w"> </span><span class="n">not</span><span class="w"> </span><span class="n">satisfied</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="err">`</span><span class="p">[</span><span class="n">closure</span><span class="o">@</span><span class="n">src</span><span class="o">/</span><span class="n">test</span><span class="o">/</span><span class="n">ui</span><span class="o">/</span><span class="n">not</span><span class="o">-</span><span class="n">clone</span><span class="o">-</span><span class="n">closure</span><span class="p">.</span><span class="n">rs</span>:<span class="mi">7</span>:<span class="mi">17</span>: <span class="mi">9</span>:<span class="mi">6</span><span class="w"> </span><span class="n">a</span>:<span class="nc">S</span><span class="p">]</span><span class="err">`</span><span class="w"></span>
<span class="w">  </span><span class="o">-</span>-&gt; <span class="nc">src</span><span class="o">/</span><span class="n">test</span><span class="o">/</span><span class="n">ui</span><span class="o">/</span><span class="n">not</span><span class="o">-</span><span class="n">clone</span><span class="o">-</span><span class="n">closure</span><span class="p">.</span><span class="n">rs</span>:<span class="mi">11</span>:<span class="mi">23</span><span class="w"></span>
<span class="w">   </span><span class="o">|</span><span class="w"></span>
<span class="mi">11</span><span class="w"> </span><span class="o">|</span><span class="w">     </span><span class="kd">let</span><span class="w"> </span><span class="n">hello</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">hello</span><span class="p">.</span><span class="n">clone</span><span class="p">();</span><span class="w"> </span><span class="c1">//~ ERROR the trait bound `S: std::clone::Clone` is not satisfied</span>
<span class="w">   </span><span class="o">|</span><span class="w">                       </span><span class="o">^^^^^</span><span class="w"> </span><span class="n">within</span><span class="w"> </span><span class="err">`</span><span class="p">[</span><span class="n">closure</span><span class="o">@</span><span class="n">src</span><span class="o">/</span><span class="n">test</span><span class="o">/</span><span class="n">ui</span><span class="o">/</span><span class="n">not</span><span class="o">-</span><span class="n">clone</span><span class="o">-</span><span class="n">closure</span><span class="p">.</span><span class="n">rs</span>:<span class="mi">7</span>:<span class="mi">17</span>: <span class="mi">9</span>:<span class="mi">6</span><span class="w"> </span><span class="n">a</span>:<span class="nc">S</span><span class="p">]</span><span class="err">`</span><span class="p">,</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="k">trait</span><span class="w"> </span><span class="err">`</span><span class="n">std</span>::<span class="n">clone</span>::<span class="nb">Clone</span><span class="err">`</span><span class="w"> </span><span class="n">is</span><span class="w"> </span><span class="n">not</span><span class="w"> </span><span class="n">implemented</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="err">`</span><span class="n">S</span><span class="err">`</span><span class="w"></span>
<span class="w">   </span><span class="o">|</span><span class="w"></span>
<span class="w">   </span><span class="o">=</span><span class="w"> </span><span class="n">note</span>: <span class="nc">required</span><span class="w"> </span><span class="n">because</span><span class="w"> </span><span class="n">it</span><span class="w"> </span><span class="n">appears</span><span class="w"> </span><span class="n">within</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="k">type</span> <span class="err">`</span><span class="p">(</span><span class="n">S</span><span class="p">,)</span><span class="err">`</span><span class="w"></span>
<span class="w">   </span><span class="o">=</span><span class="w"> </span><span class="n">note</span>: <span class="nc">required</span><span class="w"> </span><span class="n">because</span><span class="w"> </span><span class="n">it</span><span class="w"> </span><span class="n">appears</span><span class="w"> </span><span class="n">within</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="k">type</span> <span class="err">`</span><span class="p">[</span><span class="n">closure</span><span class="o">@</span><span class="n">src</span><span class="o">/</span><span class="n">test</span><span class="o">/</span><span class="n">ui</span><span class="o">/</span><span class="n">not</span><span class="o">-</span><span class="n">clone</span><span class="o">-</span><span class="n">closure</span><span class="p">.</span><span class="n">rs</span>:<span class="mi">7</span>:<span class="mi">17</span>: <span class="mi">9</span>:<span class="mi">6</span><span class="w"> </span><span class="n">a</span>:<span class="nc">S</span><span class="p">]</span><span class="err">`</span><span class="w"></span>

<span class="n">error</span>: <span class="nc">aborting</span><span class="w"> </span><span class="n">due</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="n">previous</span><span class="w"> </span><span class="n">error</span><span class="w"></span>

<span class="n">For</span><span class="w"> </span><span class="n">more</span><span class="w"> </span><span class="n">information</span><span class="w"> </span><span class="n">about</span><span class="w"> </span><span class="n">this</span><span class="w"> </span><span class="n">error</span><span class="p">,</span><span class="w"> </span><span class="n">try</span><span class="w"> </span><span class="err">`</span><span class="n">rustc</span><span class="w"> </span><span class="o">--</span><span class="n">explain</span><span class="w"> </span><span class="n">E0277</span><span class="err">`</span><span class="p">.</span><span class="w"></span>
</pre></div>



<a name="159778143"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353488%20closure%20and%20disjoint%20fields/near/159778143" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> blitzerr <a href="https://rust-lang.github.io/zulip_archive/stream/122657-t-compiler/wg-nll/topic/.2353488.20closure.20and.20disjoint.20fields.html#159778143">(Mar 02 2019 at 04:54)</a>:</h4>
<p>The same file compiled with nightly rustc</p>
<div class="codehilite"><pre><span></span><span class="n">rustc</span><span class="w"> </span><span class="o">+</span><span class="n">nightly</span><span class="w"> </span><span class="n">src</span><span class="o">/</span><span class="n">test</span><span class="o">/</span><span class="n">ui</span><span class="o">/</span><span class="n">not</span><span class="o">-</span><span class="n">clone</span><span class="o">-</span><span class="n">closure</span><span class="p">.</span><span class="n">rs</span><span class="w"></span>
<span class="n">error</span><span class="p">[</span><span class="n">E0277</span><span class="p">]</span>: <span class="nc">the</span><span class="w"> </span><span class="k">trait</span><span class="w"> </span><span class="n">bound</span><span class="w"> </span><span class="err">`</span><span class="n">S</span>: <span class="nc">std</span>::<span class="n">clone</span>::<span class="nb">Clone</span><span class="err">`</span><span class="w"> </span><span class="n">is</span><span class="w"> </span><span class="n">not</span><span class="w"> </span><span class="n">satisfied</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="err">`</span><span class="p">[</span><span class="n">closure</span><span class="o">@</span><span class="n">src</span><span class="o">/</span><span class="n">test</span><span class="o">/</span><span class="n">ui</span><span class="o">/</span><span class="n">not</span><span class="o">-</span><span class="n">clone</span><span class="o">-</span><span class="n">closure</span><span class="p">.</span><span class="n">rs</span>:<span class="mi">7</span>:<span class="mi">17</span>: <span class="mi">9</span>:<span class="mi">6</span><span class="w"> </span><span class="n">a</span>:<span class="nc">S</span><span class="p">]</span><span class="err">`</span><span class="w"></span>
<span class="w">  </span><span class="o">-</span>-&gt; <span class="nc">src</span><span class="o">/</span><span class="n">test</span><span class="o">/</span><span class="n">ui</span><span class="o">/</span><span class="n">not</span><span class="o">-</span><span class="n">clone</span><span class="o">-</span><span class="n">closure</span><span class="p">.</span><span class="n">rs</span>:<span class="mi">11</span>:<span class="mi">23</span><span class="w"></span>
<span class="w">   </span><span class="o">|</span><span class="w"></span>
<span class="mi">11</span><span class="w"> </span><span class="o">|</span><span class="w">     </span><span class="kd">let</span><span class="w"> </span><span class="n">hello</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">hello</span><span class="p">.</span><span class="n">clone</span><span class="p">();</span><span class="w"> </span><span class="c1">//~ ERROR the trait bound `S: std::clone::Clone` is not satisfied</span>
<span class="w">   </span><span class="o">|</span><span class="w">                       </span><span class="o">^^^^^</span><span class="w"> </span><span class="n">within</span><span class="w"> </span><span class="err">`</span><span class="p">[</span><span class="n">closure</span><span class="o">@</span><span class="n">src</span><span class="o">/</span><span class="n">test</span><span class="o">/</span><span class="n">ui</span><span class="o">/</span><span class="n">not</span><span class="o">-</span><span class="n">clone</span><span class="o">-</span><span class="n">closure</span><span class="p">.</span><span class="n">rs</span>:<span class="mi">7</span>:<span class="mi">17</span>: <span class="mi">9</span>:<span class="mi">6</span><span class="w"> </span><span class="n">a</span>:<span class="nc">S</span><span class="p">]</span><span class="err">`</span><span class="p">,</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="k">trait</span><span class="w"> </span><span class="err">`</span><span class="n">std</span>::<span class="n">clone</span>::<span class="nb">Clone</span><span class="err">`</span><span class="w"> </span><span class="n">is</span><span class="w"> </span><span class="n">not</span><span class="w"> </span><span class="n">implemented</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="err">`</span><span class="n">S</span><span class="err">`</span><span class="w"></span>
<span class="w">   </span><span class="o">|</span><span class="w"></span>
<span class="w">   </span><span class="o">=</span><span class="w"> </span><span class="n">note</span>: <span class="nc">required</span><span class="w"> </span><span class="n">because</span><span class="w"> </span><span class="n">it</span><span class="w"> </span><span class="n">appears</span><span class="w"> </span><span class="n">within</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="k">type</span> <span class="err">`</span><span class="p">[</span><span class="n">closure</span><span class="o">@</span><span class="n">src</span><span class="o">/</span><span class="n">test</span><span class="o">/</span><span class="n">ui</span><span class="o">/</span><span class="n">not</span><span class="o">-</span><span class="n">clone</span><span class="o">-</span><span class="n">closure</span><span class="p">.</span><span class="n">rs</span>:<span class="mi">7</span>:<span class="mi">17</span>: <span class="mi">9</span>:<span class="mi">6</span><span class="w"> </span><span class="n">a</span>:<span class="nc">S</span><span class="p">]</span><span class="err">`</span><span class="w"></span>

<span class="n">error</span>: <span class="nc">aborting</span><span class="w"> </span><span class="n">due</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="n">previous</span><span class="w"> </span><span class="n">error</span><span class="w"></span>

<span class="n">For</span><span class="w"> </span><span class="n">more</span><span class="w"> </span><span class="n">information</span><span class="w"> </span><span class="n">about</span><span class="w"> </span><span class="n">this</span><span class="w"> </span><span class="n">error</span><span class="p">,</span><span class="w"> </span><span class="n">try</span><span class="w"> </span><span class="err">`</span><span class="n">rustc</span><span class="w"> </span><span class="o">--</span><span class="n">explain</span><span class="w"> </span><span class="n">E0277</span><span class="err">`</span><span class="p">.</span><span class="w"></span>
</pre></div>



<a name="159778157"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353488%20closure%20and%20disjoint%20fields/near/159778157" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> blitzerr <a href="https://rust-lang.github.io/zulip_archive/stream/122657-t-compiler/wg-nll/topic/.2353488.20closure.20and.20disjoint.20fields.html#159778157">(Mar 02 2019 at 04:55)</a>:</h4>
<p>The difference is the presence of this extra line <br>
<code>= note: required because it appears within the type </code>(S,)``</p>



<a name="159778564"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353488%20closure%20and%20disjoint%20fields/near/159778564" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> blitzerr <a href="https://rust-lang.github.io/zulip_archive/stream/122657-t-compiler/wg-nll/topic/.2353488.20closure.20and.20disjoint.20fields.html#159778564">(Mar 02 2019 at 05:07)</a>:</h4>
<p>contents of the test file</p>
<div class="codehilite"><pre><span></span><span class="n">cat</span><span class="w"> </span><span class="n">src</span><span class="o">/</span><span class="n">test</span><span class="o">/</span><span class="n">ui</span><span class="o">/</span><span class="n">not</span><span class="o">-</span><span class="n">clone</span><span class="o">-</span><span class="n">closure</span><span class="p">.</span><span class="n">rs</span><span class="w"></span>
<span class="c1">// Check that closures do not implement `Clone` if their environment is not `Clone`.</span>

<span class="k">struct</span> <span class="nc">S</span><span class="p">(</span><span class="kt">i32</span><span class="p">);</span><span class="w"></span>

<span class="k">fn</span> <span class="nf">main</span><span class="p">()</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">S</span><span class="p">(</span><span class="mi">5</span><span class="p">);</span><span class="w"></span>
<span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="n">hello</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">move</span><span class="w"> </span><span class="o">||</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">        </span><span class="n">println</span><span class="o">!</span><span class="p">(</span><span class="s">&quot;Hello {}&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">a</span><span class="p">.</span><span class="mi">0</span><span class="p">);</span><span class="w"></span>
<span class="w">    </span><span class="p">};</span><span class="w"></span>

<span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="n">hello</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">hello</span><span class="p">.</span><span class="n">clone</span><span class="p">();</span><span class="w"> </span><span class="c1">//~ ERROR the trait bound `S: std::clone::Clone` is not satisfied</span>
<span class="p">}</span><span class="w"></span>
</pre></div>



<a name="159778815"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353488%20closure%20and%20disjoint%20fields/near/159778815" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> blitzerr <a href="https://rust-lang.github.io/zulip_archive/stream/122657-t-compiler/wg-nll/topic/.2353488.20closure.20and.20disjoint.20fields.html#159778815">(Mar 02 2019 at 05:14)</a>:</h4>
<p>So I am trying to step through but I might be doing something wrong as instead of stack I am getting assembly </p>
<div class="codehilite"><pre><span></span><span class="nf">Process</span> <span class="mi">11116</span> <span class="no">stopped</span>
<span class="err">*</span> <span class="nf">thread</span> <span class="c">#1, queue = &#39;com.apple.main-thread&#39;, stop reason = instruction step over</span>
    <span class="nf">frame</span> <span class="c">#0: 0x000000010006b8d0 rustc`main + 224</span>
<span class="nf">rustc</span><span class="err">`</span><span class="no">main</span><span class="p">:</span>
<span class="err">-&gt;</span>  <span class="err">0</span><span class="nf">x10006b8d0</span> <span class="err">&lt;+</span><span class="mi">224</span><span class="err">&gt;</span><span class="p">:</span> <span class="no">callq</span>  <span class="mi">0x10042e498</span>               <span class="c">; symbol stub for: mprotect</span>
    <span class="err">0</span><span class="nf">x10006b8d5</span> <span class="err">&lt;+</span><span class="mi">229</span><span class="err">&gt;</span><span class="p">:</span> <span class="no">testl</span>  <span class="nv">%eax</span><span class="p">,</span> <span class="nv">%eax</span>
    <span class="err">0</span><span class="nf">x10006b8d7</span> <span class="err">&lt;+</span><span class="mi">231</span><span class="err">&gt;</span><span class="p">:</span> <span class="no">jne</span>    <span class="mi">0x10006bac3</span>               <span class="c">; &lt;+723&gt;</span>
    <span class="err">0</span><span class="nf">x10006b8dd</span> <span class="err">&lt;+</span><span class="mi">237</span><span class="err">&gt;</span><span class="p">:</span> <span class="no">movq</span>   <span class="mi">0x4ec764</span><span class="p">(</span><span class="nv">%rip</span><span class="p">),</span> <span class="nv">%r15</span>      <span class="c">; std::sys::unix::thread::guard::PAGE_SIZE::h7a87b6bd0741865a (.llvm.14947831840210026976)</span>
<span class="nf">Target</span> <span class="mi">0</span><span class="p">:</span> <span class="p">(</span><span class="no">rustc</span><span class="p">)</span> <span class="no">stopped.</span>
</pre></div>



<a name="159949331"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353488%20closure%20and%20disjoint%20fields/near/159949331" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://rust-lang.github.io/zulip_archive/stream/122657-t-compiler/wg-nll/topic/.2353488.20closure.20and.20disjoint.20fields.html#159949331">(Mar 04 2019 at 20:49)</a>:</h4>
<p><span class="user-mention" data-user-id="128294">@blitzerr</span> it's not clear that this is something you are doing <em>wrong</em></p>



<a name="159949403"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353488%20closure%20and%20disjoint%20fields/near/159949403" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://rust-lang.github.io/zulip_archive/stream/122657-t-compiler/wg-nll/topic/.2353488.20closure.20and.20disjoint.20fields.html#159949403">(Mar 04 2019 at 20:50)</a>:</h4>
<p>Are you saying that your branch <strong>added</strong> the line in question, or removed it?</p>



<a name="159949421"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353488%20closure%20and%20disjoint%20fields/near/159949421" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://rust-lang.github.io/zulip_archive/stream/122657-t-compiler/wg-nll/topic/.2353488.20closure.20and.20disjoint.20fields.html#159949421">(Mar 04 2019 at 20:50)</a>:</h4>
<p>I can certainly imagine how this diff might occur, not sure that I am worried about it, basically</p>



<a name="159949429"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353488%20closure%20and%20disjoint%20fields/near/159949429" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://rust-lang.github.io/zulip_archive/stream/122657-t-compiler/wg-nll/topic/.2353488.20closure.20and.20disjoint.20fields.html#159949429">(Mar 04 2019 at 20:50)</a>:</h4>
<p>I imagine your branch added the new line?</p>



<a name="159949506"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353488%20closure%20and%20disjoint%20fields/near/159949506" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> simulacrum <a href="https://rust-lang.github.io/zulip_archive/stream/122657-t-compiler/wg-nll/topic/.2353488.20closure.20and.20disjoint.20fields.html#159949506">(Mar 04 2019 at 20:51)</a>:</h4>
<p>That does appear to be the case (i.e., nightly does not have the line). Seems like an improvement to me :)</p>



<a name="159949569"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353488%20closure%20and%20disjoint%20fields/near/159949569" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://rust-lang.github.io/zulip_archive/stream/122657-t-compiler/wg-nll/topic/.2353488.20closure.20and.20disjoint.20fields.html#159949569">(Mar 04 2019 at 20:52)</a>:</h4>
<p>debatable, but I think it's ok either way</p>



<a name="159949601"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353488%20closure%20and%20disjoint%20fields/near/159949601" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://rust-lang.github.io/zulip_archive/stream/122657-t-compiler/wg-nll/topic/.2353488.20closure.20and.20disjoint.20fields.html#159949601">(Mar 04 2019 at 20:52)</a>:</h4>
<p>what's happening is that, in the trait selection code, there is this code that enumeates all the "components"</p>



<a name="159949605"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353488%20closure%20and%20disjoint%20fields/near/159949605" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://rust-lang.github.io/zulip_archive/stream/122657-t-compiler/wg-nll/topic/.2353488.20closure.20and.20disjoint.20fields.html#159949605">(Mar 04 2019 at 20:52)</a>:</h4>
<p>of a given typ</p>



<a name="159949623"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353488%20closure%20and%20disjoint%20fields/near/159949623" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://rust-lang.github.io/zulip_archive/stream/122657-t-compiler/wg-nll/topic/.2353488.20closure.20and.20disjoint.20fields.html#159949623">(Mar 04 2019 at 20:53)</a>:</h4>
<p>in the case of closures, it used to produce 1 component per upvar (captured variable)</p>



<a name="159949628"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353488%20closure%20and%20disjoint%20fields/near/159949628" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://rust-lang.github.io/zulip_archive/stream/122657-t-compiler/wg-nll/topic/.2353488.20closure.20and.20disjoint.20fields.html#159949628">(Mar 04 2019 at 20:53)</a>:</h4>
<p>we changed it <span class="user-mention" data-user-id="128294">@blitzerr</span> to produce a tuple of all upvar types</p>



<a name="159949636"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353488%20closure%20and%20disjoint%20fields/near/159949636" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://rust-lang.github.io/zulip_archive/stream/122657-t-compiler/wg-nll/topic/.2353488.20closure.20and.20disjoint.20fields.html#159949636">(Mar 04 2019 at 20:53)</a>:</h4>
<p>and that is the line you are now seeing</p>



<a name="159949675"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353488%20closure%20and%20disjoint%20fields/near/159949675" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://rust-lang.github.io/zulip_archive/stream/122657-t-compiler/wg-nll/topic/.2353488.20closure.20and.20disjoint.20fields.html#159949675">(Mar 04 2019 at 20:53)</a>:</h4>
<p>we <em>could</em> probably make it go away by inspecting the type variable representing the upvar types and -- if it is known to be a tuple -- inlining its contents</p>



<a name="159949680"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353488%20closure%20and%20disjoint%20fields/near/159949680" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://rust-lang.github.io/zulip_archive/stream/122657-t-compiler/wg-nll/topic/.2353488.20closure.20and.20disjoint.20fields.html#159949680">(Mar 04 2019 at 20:54)</a>:</h4>
<p>(it could also be an unresolved type variable)</p>



<a name="159972102"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353488%20closure%20and%20disjoint%20fields/near/159972102" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> blitzerr <a href="https://rust-lang.github.io/zulip_archive/stream/122657-t-compiler/wg-nll/topic/.2353488.20closure.20and.20disjoint.20fields.html#159972102">(Mar 05 2019 at 02:56)</a>:</h4>
<p><span class="user-mention" data-user-id="116009">@nikomatsakis</span> , that makes sense.</p>
<blockquote>
<p>(it could also be an unresolved type variable)</p>
</blockquote>
<p>Do you think we will be error checking before type resolution in some cases ?</p>



<a name="160008545"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353488%20closure%20and%20disjoint%20fields/near/160008545" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://rust-lang.github.io/zulip_archive/stream/122657-t-compiler/wg-nll/topic/.2353488.20closure.20and.20disjoint.20fields.html#160008545">(Mar 05 2019 at 14:47)</a>:</h4>
<p>ps, further convesation on this topic can move to <a class="stream" data-stream-id="189812" href="/#narrow/stream/189812-t-compiler.2Fwg-rfc-2229">#t-compiler/wg-rfc-2229</a></p>



<hr><p>Last updated: Aug 07 2021 at 22:04 UTC</p>
</html>