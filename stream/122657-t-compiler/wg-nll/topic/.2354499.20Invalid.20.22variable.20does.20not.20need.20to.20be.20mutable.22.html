<html>
<head><meta charset="utf-8"><title>#54499 Invalid &quot;variable does not need to be mutable&quot; · t-compiler/wg-nll · Zulip Chat Archive</title></head>
<h2>Stream: <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/index.html">t-compiler/wg-nll</a></h2>
<h3>Topic: <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2354499.20Invalid.20.22variable.20does.20not.20need.20to.20be.20mutable.22.html">#54499 Invalid &quot;variable does not need to be mutable&quot;</a></h3>

<hr>

<base href="https://rust-lang.zulipchat.com">

<head><link href="https://zulip-archive.rust-lang.org/style.css" rel="stylesheet"></head>

<a name="134758182"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2354499%20Invalid%20%22variable%20does%20not%20need%20to%20be%20mutable%22/near/134758182" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2354499.20Invalid.20.22variable.20does.20not.20need.20to.20be.20mutable.22.html#134758182">(Sep 27 2018 at 16:49)</a>:</h4>
<p>opening this for discussion</p>



<a name="134758203"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2354499%20Invalid%20%22variable%20does%20not%20need%20to%20be%20mutable%22/near/134758203" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2354499.20Invalid.20.22variable.20does.20not.20need.20to.20be.20mutable.22.html#134758203">(Sep 27 2018 at 16:49)</a>:</h4>
<p><span class="user-mention" data-user-id="116009">@nikomatsakis</span> don't remember if you've said something but it's all the needed information on the issue?</p>



<a name="134758273"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2354499%20Invalid%20%22variable%20does%20not%20need%20to%20be%20mutable%22/near/134758273" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2354499.20Invalid.20.22variable.20does.20not.20need.20to.20be.20mutable.22.html#134758273">(Sep 27 2018 at 16:50)</a>:</h4>
<p>need to check a bit the issues you mentioned, <a href="https://github.com/rust-lang/rust/issues/21232" target="_blank" title="https://github.com/rust-lang/rust/issues/21232">#21232</a> and <a href="https://github.com/rust-lang/rust/issues/53258" target="_blank" title="https://github.com/rust-lang/rust/issues/53258">#53258</a></p>



<a name="134758390"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2354499%20Invalid%20%22variable%20does%20not%20need%20to%20be%20mutable%22/near/134758390" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2354499.20Invalid.20.22variable.20does.20not.20need.20to.20be.20mutable.22.html#134758390">(Sep 27 2018 at 16:52)</a>:</h4>
<p>I see that the code in AST borrowck fails</p>



<a name="134758393"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2354499%20Invalid%20%22variable%20does%20not%20need%20to%20be%20mutable%22/near/134758393" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2354499.20Invalid.20.22variable.20does.20not.20need.20to.20be.20mutable.22.html#134758393">(Sep 27 2018 at 16:52)</a>:</h4>
<div class="codehilite"><pre><span></span>[santiago@archlinux tmp]$ rustc test.rs
error[E0381]: use of possibly uninitialized variable: `s.0`
 --&gt; test.rs:5:23
  |
5 |     println!(&quot;{} {}&quot;, s.0, s.1);
  |                       ^^^ use of possibly uninitialized `s.0`

error[E0381]: use of possibly uninitialized variable: `s.1`
 --&gt; test.rs:5:28
  |
5 |     println!(&quot;{} {}&quot;, s.0, s.1);
  |                            ^^^ use of possibly uninitialized `s.1`

error: aborting due to 2 previous errors

For more information about this error, try `rustc --explain E0381`.
</pre></div>



<a name="134758408"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2354499%20Invalid%20%22variable%20does%20not%20need%20to%20be%20mutable%22/near/134758408" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2354499.20Invalid.20.22variable.20does.20not.20need.20to.20be.20mutable.22.html#134758408">(Sep 27 2018 at 16:52)</a>:</h4>
<p>and it gives that warning in NLL</p>



<a name="134758410"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2354499%20Invalid%20%22variable%20does%20not%20need%20to%20be%20mutable%22/near/134758410" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2354499.20Invalid.20.22variable.20does.20not.20need.20to.20be.20mutable.22.html#134758410">(Sep 27 2018 at 16:52)</a>:</h4>
<div class="codehilite"><pre><span></span>[santiago@archlinux tmp]$ rustc test.rs
warning: variable does not need to be mutable
 --&gt; test.rs:4:9
  |
4 |     let mut s: (i32, i32);
  |         ----^
  |         |
  |         help: remove this `mut`
  |
  = note: #[warn(unused_mut)] on by default
</pre></div>



<a name="134758450"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2354499%20Invalid%20%22variable%20does%20not%20need%20to%20be%20mutable%22/near/134758450" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2354499.20Invalid.20.22variable.20does.20not.20need.20to.20be.20mutable.22.html#134758450">(Sep 27 2018 at 16:53)</a>:</h4>
<p>you also mention that it would be a good idea to fix <a href="https://github.com/rust-lang/rust/issues/21232" target="_blank" title="https://github.com/rust-lang/rust/issues/21232">#21232</a></p>



<a name="134758465"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2354499%20Invalid%20%22variable%20does%20not%20need%20to%20be%20mutable%22/near/134758465" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2354499.20Invalid.20.22variable.20does.20not.20need.20to.20be.20mutable.22.html#134758465">(Sep 27 2018 at 16:53)</a>:</h4>
<p>so what should I do?</p>



<a name="134758478"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2354499%20Invalid%20%22variable%20does%20not%20need%20to%20be%20mutable%22/near/134758478" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2354499.20Invalid.20.22variable.20does.20not.20need.20to.20be.20mutable.22.html#134758478">(Sep 27 2018 at 16:54)</a>:</h4>
<p>is the idea to fix <a href="https://github.com/rust-lang/rust/issues/21232" target="_blank" title="https://github.com/rust-lang/rust/issues/21232">#21232</a>?</p>



<a name="134758521"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2354499%20Invalid%20%22variable%20does%20not%20need%20to%20be%20mutable%22/near/134758521" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2354499.20Invalid.20.22variable.20does.20not.20need.20to.20be.20mutable.22.html#134758521">(Sep 27 2018 at 16:54)</a>:</h4>
<p>or should we first remove that warning?</p>



<a name="134761846"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2354499%20Invalid%20%22variable%20does%20not%20need%20to%20be%20mutable%22/near/134761846" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2354499.20Invalid.20.22variable.20does.20not.20need.20to.20be.20mutable.22.html#134761846">(Sep 27 2018 at 17:46)</a>:</h4>
<p><span class="user-mention" data-user-id="116266">@Santiago Pastorino</span> let me get back up to speed</p>



<a name="134761894"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2354499%20Invalid%20%22variable%20does%20not%20need%20to%20be%20mutable%22/near/134761894" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2354499.20Invalid.20.22variable.20does.20not.20need.20to.20be.20mutable.22.html#134761894">(Sep 27 2018 at 17:46)</a>:</h4>
<p>ok I see</p>



<a name="134761895"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2354499%20Invalid%20%22variable%20does%20not%20need%20to%20be%20mutable%22/near/134761895" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2354499.20Invalid.20.22variable.20does.20not.20need.20to.20be.20mutable.22.html#134761895">(Sep 27 2018 at 17:46)</a>:</h4>
<p>well</p>



<a name="134761898"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2354499%20Invalid%20%22variable%20does%20not%20need%20to%20be%20mutable%22/near/134761898" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2354499.20Invalid.20.22variable.20does.20not.20need.20to.20be.20mutable.22.html#134761898">(Sep 27 2018 at 17:46)</a>:</h4>
<p>what I meant was "remove the warning"</p>



<a name="134761903"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2354499%20Invalid%20%22variable%20does%20not%20need%20to%20be%20mutable%22/near/134761903" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2354499.20Invalid.20.22variable.20does.20not.20need.20to.20be.20mutable.22.html#134761903">(Sep 27 2018 at 17:46)</a>:</h4>
<p>I'm not 100% sure how to do that :)</p>



<a name="134763032"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2354499%20Invalid%20%22variable%20does%20not%20need%20to%20be%20mutable%22/near/134763032" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2354499.20Invalid.20.22variable.20does.20not.20need.20to.20be.20mutable.22.html#134763032">(Sep 27 2018 at 18:03)</a>:</h4>
<p>but I can get you in the right direction</p>



<a name="134763295"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2354499%20Invalid%20%22variable%20does%20not%20need%20to%20be%20mutable%22/near/134763295" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2354499.20Invalid.20.22variable.20does.20not.20need.20to.20be.20mutable.22.html#134763295">(Sep 27 2018 at 18:07)</a>:</h4>
<p><span class="user-mention" data-user-id="116266">@Santiago Pastorino</span> <a href="https://github.com/rust-lang/rust/issues/54499#issuecomment-425189383" target="_blank" title="https://github.com/rust-lang/rust/issues/54499#issuecomment-425189383">left some preliminary notes here</a>, but you'll have to do a bit of digging</p>



<a name="134763915"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2354499%20Invalid%20%22variable%20does%20not%20need%20to%20be%20mutable%22/near/134763915" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2354499.20Invalid.20.22variable.20does.20not.20need.20to.20be.20mutable.22.html#134763915">(Sep 27 2018 at 18:16)</a>:</h4>
<p>yeah, no worries</p>



<a name="134763926"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2354499%20Invalid%20%22variable%20does%20not%20need%20to%20be%20mutable%22/near/134763926" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2354499.20Invalid.20.22variable.20does.20not.20need.20to.20be.20mutable.22.html#134763926">(Sep 27 2018 at 18:17)</a>:</h4>
<p>I mainly wanted to know what to do</p>



<a name="134763934"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2354499%20Invalid%20%22variable%20does%20not%20need%20to%20be%20mutable%22/near/134763934" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2354499.20Invalid.20.22variable.20does.20not.20need.20to.20be.20mutable.22.html#134763934">(Sep 27 2018 at 18:17)</a>:</h4>
<p>but thanks for the tips :)</p>



<a name="134766470"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2354499%20Invalid%20%22variable%20does%20not%20need%20to%20be%20mutable%22/near/134766470" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2354499.20Invalid.20.22variable.20does.20not.20need.20to.20be.20mutable.22.html#134766470">(Sep 27 2018 at 18:54)</a>:</h4>
<blockquote>
<p>So we probably need to add something to that set when we see a.b = c. That is a MIR assignment, so it winds up invoking mutate_place:</p>
</blockquote>



<a name="134766484"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2354499%20Invalid%20%22variable%20does%20not%20need%20to%20be%20mutable%22/near/134766484" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2354499.20Invalid.20.22variable.20does.20not.20need.20to.20be.20mutable.22.html#134766484">(Sep 27 2018 at 18:54)</a>:</h4>
<p>I'm not sure exactly what you meant there</p>



<a name="134766505"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2354499%20Invalid%20%22variable%20does%20not%20need%20to%20be%20mutable%22/near/134766505" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2354499.20Invalid.20.22variable.20does.20not.20need.20to.20be.20mutable.22.html#134766505">(Sep 27 2018 at 18:55)</a>:</h4>
<p>you meant that I need to fall in that part of the code, line 493?</p>



<a name="134766523"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2354499%20Invalid%20%22variable%20does%20not%20need%20to%20be%20mutable%22/near/134766523" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2354499.20Invalid.20.22variable.20does.20not.20need.20to.20be.20mutable.22.html#134766523">(Sep 27 2018 at 18:55)</a>:</h4>
<p>you meant just that mutate_place needs to be called like in 493?</p>



<a name="134766592"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2354499%20Invalid%20%22variable%20does%20not%20need%20to%20be%20mutable%22/near/134766592" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2354499.20Invalid.20.22variable.20does.20not.20need.20to.20be.20mutable.22.html#134766592">(Sep 27 2018 at 18:56)</a>:</h4>
<p>I am just tracing through what happens</p>



<a name="134766595"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2354499%20Invalid%20%22variable%20does%20not%20need%20to%20be%20mutable%22/near/134766595" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2354499.20Invalid.20.22variable.20does.20not.20need.20to.20be.20mutable.22.html#134766595">(Sep 27 2018 at 18:56)</a>:</h4>
<p>when we borrow check the example</p>



<a name="134766597"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2354499%20Invalid%20%22variable%20does%20not%20need%20to%20be%20mutable%22/near/134766597" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2354499.20Invalid.20.22variable.20does.20not.20need.20to.20be.20mutable.22.html#134766597">(Sep 27 2018 at 18:56)</a>:</h4>
<p>you meant that <code>StatementKind::Assign</code> ...</p>



<a name="134766604"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2354499%20Invalid%20%22variable%20does%20not%20need%20to%20be%20mutable%22/near/134766604" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2354499.20Invalid.20.22variable.20does.20not.20need.20to.20be.20mutable.22.html#134766604">(Sep 27 2018 at 18:56)</a>:</h4>
<p>no worries I can do it</p>



<a name="134766610"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2354499%20Invalid%20%22variable%20does%20not%20need%20to%20be%20mutable%22/near/134766610" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2354499.20Invalid.20.22variable.20does.20not.20need.20to.20be.20mutable.22.html#134766610">(Sep 27 2018 at 18:56)</a>:</h4>
<p>I didn't trace that far, as you can see :)</p>



<a name="134766613"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2354499%20Invalid%20%22variable%20does%20not%20need%20to%20be%20mutable%22/near/134766613" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2354499.20Invalid.20.22variable.20does.20not.20need.20to.20be.20mutable.22.html#134766613">(Sep 27 2018 at 18:56)</a>:</h4>
<p>I didn't want to dismiss your message</p>



<a name="134766617"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2354499%20Invalid%20%22variable%20does%20not%20need%20to%20be%20mutable%22/near/134766617" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2354499.20Invalid.20.22variable.20does.20not.20need.20to.20be.20mutable.22.html#134766617">(Sep 27 2018 at 18:56)</a>:</h4>
<p>yeah, don't worry</p>



<a name="134766638"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2354499%20Invalid%20%22variable%20does%20not%20need%20to%20be%20mutable%22/near/134766638" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2354499.20Invalid.20.22variable.20does.20not.20need.20to.20be.20mutable.22.html#134766638">(Sep 27 2018 at 18:57)</a>:</h4>
<p>was trying to understand that just the used_mut bit is already an important tip</p>



<a name="134766654"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2354499%20Invalid%20%22variable%20does%20not%20need%20to%20be%20mutable%22/near/134766654" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2354499.20Invalid.20.22variable.20does.20not.20need.20to.20be.20mutable.22.html#134766654">(Sep 27 2018 at 18:57)</a>:</h4>
<p>I just wasn't sure what was mutate_place for and why did you mentioned it</p>



<a name="134766794"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2354499%20Invalid%20%22variable%20does%20not%20need%20to%20be%20mutable%22/near/134766794" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2354499.20Invalid.20.22variable.20does.20not.20need.20to.20be.20mutable.22.html#134766794">(Sep 27 2018 at 18:59)</a>:</h4>
<p>from what I've seen it seems like a.b = c is not an <code>StatementKind::Assign</code> ?</p>



<a name="134767125"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2354499%20Invalid%20%22variable%20does%20not%20need%20to%20be%20mutable%22/near/134767125" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2354499.20Invalid.20.22variable.20does.20not.20need.20to.20be.20mutable.22.html#134767125">(Sep 27 2018 at 19:04)</a>:</h4>
<p>it is</p>



<a name="134767130"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2354499%20Invalid%20%22variable%20does%20not%20need%20to%20be%20mutable%22/near/134767130" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2354499.20Invalid.20.22variable.20does.20not.20need.20to.20be.20mutable.22.html#134767130">(Sep 27 2018 at 19:04)</a>:</h4>
<p>was just trying that :)</p>



<a name="134767135"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2354499%20Invalid%20%22variable%20does%20not%20need%20to%20be%20mutable%22/near/134767135" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2354499.20Invalid.20.22variable.20does.20not.20need.20to.20be.20mutable.22.html#134767135">(Sep 27 2018 at 19:04)</a>:</h4>
<p>but yeah <code>used_mut</code> was the key bit</p>



<a name="134767232"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2354499%20Invalid%20%22variable%20does%20not%20need%20to%20be%20mutable%22/near/134767232" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2354499.20Invalid.20.22variable.20does.20not.20need.20to.20be.20mutable.22.html#134767232">(Sep 27 2018 at 19:06)</a>:</h4>
<p>so if it is, weren't you saying that it needs to call mutate_place?</p>



<a name="134767237"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2354499%20Invalid%20%22variable%20does%20not%20need%20to%20be%20mutable%22/near/134767237" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2354499.20Invalid.20.22variable.20does.20not.20need.20to.20be.20mutable.22.html#134767237">(Sep 27 2018 at 19:06)</a>:</h4>
<p>if it is <code>Assign</code> that should be called</p>



<a name="134767282"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2354499%20Invalid%20%22variable%20does%20not%20need%20to%20be%20mutable%22/near/134767282" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2354499.20Invalid.20.22variable.20does.20not.20need.20to.20be.20mutable.22.html#134767282">(Sep 27 2018 at 19:07)</a>:</h4>
<blockquote>
<p>so if it is, weren't you saying that it needs to call mutate_place?</p>
</blockquote>
<p>I'm just saying it already will be called</p>



<a name="134767294"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2354499%20Invalid%20%22variable%20does%20not%20need%20to%20be%20mutable%22/near/134767294" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2354499.20Invalid.20.22variable.20does.20not.20need.20to.20be.20mutable.22.html#134767294">(Sep 27 2018 at 19:08)</a>:</h4>
<p>at least, I <em>think</em> so</p>



<a name="134767296"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2354499%20Invalid%20%22variable%20does%20not%20need%20to%20be%20mutable%22/near/134767296" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2354499.20Invalid.20.22variable.20does.20not.20need.20to.20be.20mutable.22.html#134767296">(Sep 27 2018 at 19:08)</a>:</h4>
<p><span class="emoji emoji-1f44d" title="+1">:+1:</span></p>



<a name="134769740"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2354499%20Invalid%20%22variable%20does%20not%20need%20to%20be%20mutable%22/near/134769740" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2354499.20Invalid.20.22variable.20does.20not.20need.20to.20be.20mutable.22.html#134769740">(Sep 27 2018 at 19:54)</a>:</h4>
<p>so, in this case, is calling <a href="https://github.com/rust-lang/rust/blob/c9865b1c37f8cb8a257591e6ea0b32a5df1f3d41/src/librustc_mir/borrow_check/mod.rs#L1721" target="_blank" title="https://github.com/rust-lang/rust/blob/c9865b1c37f8cb8a257591e6ea0b32a5df1f3d41/src/librustc_mir/borrow_check/mod.rs#L1721">https://github.com/rust-lang/rust/blob/c9865b1c37f8cb8a257591e6ea0b32a5df1f3d41/src/librustc_mir/borrow_check/mod.rs#L1721</a></p>



<a name="134769752"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2354499%20Invalid%20%22variable%20does%20not%20need%20to%20be%20mutable%22/near/134769752" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2354499.20Invalid.20.22variable.20does.20not.20need.20to.20be.20mutable.22.html#134769752">(Sep 27 2018 at 19:54)</a>:</h4>
<p>the root_place being for <code>s</code> in the example</p>



<a name="134769767"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2354499%20Invalid%20%22variable%20does%20not%20need%20to%20be%20mutable%22/near/134769767" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2354499.20Invalid.20.22variable.20does.20not.20need.20to.20be.20mutable.22.html#134769767">(Sep 27 2018 at 19:55)</a>:</h4>
<p>the thing is <code>is_local_mutation_allowed</code> is <code>No</code></p>



<a name="134769786"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2354499%20Invalid%20%22variable%20does%20not%20need%20to%20be%20mutable%22/near/134769786" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2354499.20Invalid.20.22variable.20does.20not.20need.20to.20be.20mutable.22.html#134769786">(Sep 27 2018 at 19:55)</a>:</h4>
<p>I guess it should be <code>Yes</code> for this to work?</p>



<a name="134769793"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2354499%20Invalid%20%22variable%20does%20not%20need%20to%20be%20mutable%22/near/134769793" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2354499.20Invalid.20.22variable.20does.20not.20need.20to.20be.20mutable.22.html#134769793">(Sep 27 2018 at 19:55)</a>:</h4>
<p>taking a look at what the code does</p>



<a name="134771561"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2354499%20Invalid%20%22variable%20does%20not%20need%20to%20be%20mutable%22/near/134771561" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2354499.20Invalid.20.22variable.20does.20not.20need.20to.20be.20mutable.22.html#134771561">(Sep 27 2018 at 20:27)</a>:</h4>
<p>oh dear I hate that flag</p>



<a name="134771569"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2354499%20Invalid%20%22variable%20does%20not%20need%20to%20be%20mutable%22/near/134771569" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2354499.20Invalid.20.22variable.20does.20not.20need.20to.20be.20mutable.22.html#134771569">(Sep 27 2018 at 20:28)</a>:</h4>
<p>so the annoying thing here</p>



<a name="134771609"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2354499%20Invalid%20%22variable%20does%20not%20need%20to%20be%20mutable%22/near/134771609" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2354499.20Invalid.20.22variable.20does.20not.20need.20to.20be.20mutable.22.html#134771609">(Sep 27 2018 at 20:28)</a>:</h4>
<p>is that the logic of the code as is is correct</p>



<a name="134771614"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2354499%20Invalid%20%22variable%20does%20not%20need%20to%20be%20mutable%22/near/134771614" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2354499.20Invalid.20.22variable.20does.20not.20need.20to.20be.20mutable.22.html#134771614">(Sep 27 2018 at 20:28)</a>:</h4>
<p>but we are a bit inconsistent in some sense</p>



<a name="134771638"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2354499%20Invalid%20%22variable%20does%20not%20need%20to%20be%20mutable%22/near/134771638" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2354499.20Invalid.20.22variable.20does.20not.20need.20to.20be.20mutable.22.html#134771638">(Sep 27 2018 at 20:28)</a>:</h4>
<blockquote>
<p>is that the logic of the code as is is correct</p>
</blockquote>
<p>that is, the logic of the <code>used_mut</code> code</p>



<a name="134771669"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2354499%20Invalid%20%22variable%20does%20not%20need%20to%20be%20mutable%22/near/134771669" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2354499.20Invalid.20.22variable.20does.20not.20need.20to.20be.20mutable.22.html#134771669">(Sep 27 2018 at 20:29)</a>:</h4>
<p>inconsistent how?</p>



<a name="134771691"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2354499%20Invalid%20%22variable%20does%20not%20need%20to%20be%20mutable%22/near/134771691" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2354499.20Invalid.20.22variable.20does.20not.20need.20to.20be.20mutable.22.html#134771691">(Sep 27 2018 at 20:30)</a>:</h4>
<p>I was guessing that for some reason in this case that flag was set to No when it should be Yes</p>



<a name="134771711"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2354499%20Invalid%20%22variable%20does%20not%20need%20to%20be%20mutable%22/near/134771711" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2354499.20Invalid.20.22variable.20does.20not.20need.20to.20be.20mutable.22.html#134771711">(Sep 27 2018 at 20:30)</a>:</h4>
<p>well, you are not supposed to need <code>mut</code> unless a given path is assigned more than once</p>



<a name="134771751"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2354499%20Invalid%20%22variable%20does%20not%20need%20to%20be%20mutable%22/near/134771751" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2354499.20Invalid.20.22variable.20does.20not.20need.20to.20be.20mutable.22.html#134771751">(Sep 27 2018 at 20:30)</a>:</h4>
<p>but unsure if that's right</p>



<a name="134771775"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2354499%20Invalid%20%22variable%20does%20not%20need%20to%20be%20mutable%22/near/134771775" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2354499.20Invalid.20.22variable.20does.20not.20need.20to.20be.20mutable.22.html#134771775">(Sep 27 2018 at 20:30)</a>:</h4>
<p>yeah, but in this particular case you want to allow mut regardless of that</p>



<a name="134771829"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2354499%20Invalid%20%22variable%20does%20not%20need%20to%20be%20mutable%22/near/134771829" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2354499.20Invalid.20.22variable.20does.20not.20need.20to.20be.20mutable.22.html#134771829">(Sep 27 2018 at 20:31)</a>:</h4>
<p>hmm</p>



<a name="134771901"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2354499%20Invalid%20%22variable%20does%20not%20need%20to%20be%20mutable%22/near/134771901" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2354499.20Invalid.20.22variable.20does.20not.20need.20to.20be.20mutable.22.html#134771901">(Sep 27 2018 at 20:32)</a>:</h4>
<p>I am looking a bit</p>



<a name="134771903"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2354499%20Invalid%20%22variable%20does%20not%20need%20to%20be%20mutable%22/near/134771903" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2354499.20Invalid.20.22variable.20does.20not.20need.20to.20be.20mutable.22.html#134771903">(Sep 27 2018 at 20:32)</a>:</h4>
<p>I'm actually a bit confused</p>



<a name="134771906"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2354499%20Invalid%20%22variable%20does%20not%20need%20to%20be%20mutable%22/near/134771906" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2354499.20Invalid.20.22variable.20does.20not.20need.20to.20be.20mutable.22.html#134771906">(Sep 27 2018 at 20:32)</a>:</h4>
<p><span class="emoji emoji-1f44d" title="+1">:+1:</span></p>



<a name="134771920"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2354499%20Invalid%20%22variable%20does%20not%20need%20to%20be%20mutable%22/near/134771920" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2354499.20Invalid.20.22variable.20does.20not.20need.20to.20be.20mutable.22.html#134771920">(Sep 27 2018 at 20:33)</a>:</h4>
<p>so if I understood correct from the issue we have two alternatives</p>



<a name="134771930"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2354499%20Invalid%20%22variable%20does%20not%20need%20to%20be%20mutable%22/near/134771930" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2354499.20Invalid.20.22variable.20does.20not.20need.20to.20be.20mutable.22.html#134771930">(Sep 27 2018 at 20:33)</a>:</h4>
<p>well</p>



<a name="134771939"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2354499%20Invalid%20%22variable%20does%20not%20need%20to%20be%20mutable%22/near/134771939" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2354499.20Invalid.20.22variable.20does.20not.20need.20to.20be.20mutable.22.html#134771939">(Sep 27 2018 at 20:33)</a>:</h4>
<p>or we do the right thing and implement <a href="https://github.com/rust-lang/rust/issues/21232" target="_blank" title="https://github.com/rust-lang/rust/issues/21232">https://github.com/rust-lang/rust/issues/21232</a></p>



<a name="134771944"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2354499%20Invalid%20%22variable%20does%20not%20need%20to%20be%20mutable%22/near/134771944" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2354499.20Invalid.20.22variable.20does.20not.20need.20to.20be.20mutable.22.html#134771944">(Sep 27 2018 at 20:33)</a>:</h4>
<p>what debug statements did you add :)</p>



<a name="134771947"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2354499%20Invalid%20%22variable%20does%20not%20need%20to%20be%20mutable%22/near/134771947" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2354499.20Invalid.20.22variable.20does.20not.20need.20to.20be.20mutable.22.html#134771947">(Sep 27 2018 at 20:33)</a>:</h4>
<p>or we just remove the warning for that mut</p>



<a name="134771959"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2354499%20Invalid%20%22variable%20does%20not%20need%20to%20be%20mutable%22/near/134771959" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2354499.20Invalid.20.22variable.20does.20not.20need.20to.20be.20mutable.22.html#134771959">(Sep 27 2018 at 20:33)</a>:</h4>
<p>it looks <code>check_access_permissions</code></p>



<a name="134772010"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2354499%20Invalid%20%22variable%20does%20not%20need%20to%20be%20mutable%22/near/134772010" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2354499.20Invalid.20.22variable.20does.20not.20need.20to.20be.20mutable.22.html#134772010">(Sep 27 2018 at 20:34)</a>:</h4>
<p>is what modifies the set of "used mut" variables</p>



<a name="134772022"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2354499%20Invalid%20%22variable%20does%20not%20need%20to%20be%20mutable%22/near/134772022" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2354499.20Invalid.20.22variable.20does.20not.20need.20to.20be.20mutable.22.html#134772022">(Sep 27 2018 at 20:34)</a>:</h4>
<div class="codehilite"><pre><span></span>[santiago@archlinux rust1 (invalid-no-need-mut)]$ git diff
diff --git a/src/librustc_mir/borrow_check/mod.rs b/src/librustc_mir/borrow_check/mod.rs
index 6ecbc5ee72..2bd4b2d69f 100644
--- a/src/librustc_mir/borrow_check/mod.rs
+++ b/src/librustc_mir/borrow_check/mod.rs
@@ -481,6 +481,10 @@ impl&lt;&#39;cx, &#39;gcx, &#39;tcx&gt; DataflowResultsConsumer&lt;&#39;cx, &#39;tcx&gt; for MirBorrowckCtxt&lt;&#39;cx

         self.check_activations(location, span, flow_state);

+        debug!(
+            &quot;MirBorrowckCtxt::process_statement: stmt.kind= {:?}&quot;,
+            stmt.kind
+        );
         match stmt.kind {
             StatementKind::Assign(ref lhs, ref rhs) =&gt; {
                 self.consume_rvalue(
@@ -850,6 +854,7 @@ enum InitializationRequiringAction {
     Assignment,
 }

+#[derive(Debug)]
 struct RootPlace&lt;&#39;d, &#39;tcx: &#39;d&gt; {
     place: &amp;&#39;d Place&lt;&#39;tcx&gt;,
     is_local_mutation_allowed: LocalMutationIsAllowed,
@@ -1716,8 +1721,16 @@ impl&lt;&#39;cx, &#39;gcx, &#39;tcx&gt; MirBorrowckCtxt&lt;&#39;cx, &#39;gcx, &#39;tcx&gt; {
                 }
             }
             Reservation(WriteKind::Mutate) | Write(WriteKind::Mutate) =&gt; {
+                debug!(
+                    &quot;check_access_permissions: {:?}, {:?}&quot;,
+                    place, is_local_mutation_allowed
+                );
                 match self.is_mutable(place, is_local_mutation_allowed) {
                     Ok(root_place) =&gt; {
+                        debug!(
+                            &quot;check_access_permissions: {:?}&quot;,
+                            root_place
+                        );
                         self.add_used_mut(root_place, flow_state);
                         return false;
                     }
</pre></div>



<a name="134772043"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2354499%20Invalid%20%22variable%20does%20not%20need%20to%20be%20mutable%22/near/134772043" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2354499.20Invalid.20.22variable.20does.20not.20need.20to.20be.20mutable.22.html#134772043">(Sep 27 2018 at 20:34)</a>:</h4>
<p>ok, what was the output from those? :)</p>



<a name="134772051"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2354499%20Invalid%20%22variable%20does%20not%20need%20to%20be%20mutable%22/near/134772051" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2354499.20Invalid.20.22variable.20does.20not.20need.20to.20be.20mutable.22.html#134772051">(Sep 27 2018 at 20:34)</a>:</h4>
<p>(and on what test?)</p>



<a name="134772054"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2354499%20Invalid%20%22variable%20does%20not%20need%20to%20be%20mutable%22/near/134772054" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2354499.20Invalid.20.22variable.20does.20not.20need.20to.20be.20mutable.22.html#134772054">(Sep 27 2018 at 20:35)</a>:</h4>
<p>the test is the one on the issue</p>



<a name="134772070"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2354499%20Invalid%20%22variable%20does%20not%20need%20to%20be%20mutable%22/near/134772070" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2354499.20Invalid.20.22variable.20does.20not.20need.20to.20be.20mutable.22.html#134772070">(Sep 27 2018 at 20:35)</a>:</h4>
<div class="codehilite"><pre><span></span><span class="cp">#![feature(nll)]</span><span class="w"></span>

<span class="k">fn</span> <span class="nf">main</span><span class="p">()</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="k">mut</span><span class="w"> </span><span class="n">s</span>: <span class="p">(</span><span class="kt">i32</span><span class="p">,</span><span class="w"> </span><span class="kt">i32</span><span class="p">);</span><span class="w"></span>
<span class="w">    </span><span class="n">s</span><span class="p">.</span><span class="mi">0</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">3</span><span class="p">;</span><span class="w"></span>
<span class="w">    </span><span class="n">s</span><span class="p">.</span><span class="mi">1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">4</span><span class="p">;</span><span class="w"></span>
<span class="w">    </span><span class="n">println</span><span class="o">!</span><span class="p">(</span><span class="s">&quot;{} {}&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">s</span><span class="p">.</span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="n">s</span><span class="p">.</span><span class="mi">1</span><span class="p">);</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>
</pre></div>



<a name="134772079"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2354499%20Invalid%20%22variable%20does%20not%20need%20to%20be%20mutable%22/near/134772079" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2354499.20Invalid.20.22variable.20does.20not.20need.20to.20be.20mutable.22.html#134772079">(Sep 27 2018 at 20:35)</a>:</h4>
<p>ok</p>



<a name="134772080"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2354499%20Invalid%20%22variable%20does%20not%20need%20to%20be%20mutable%22/near/134772080" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2354499.20Invalid.20.22variable.20does.20not.20need.20to.20be.20mutable.22.html#134772080">(Sep 27 2018 at 20:35)</a>:</h4>
<div class="codehilite"><pre><span></span>DEBUG 2018-09-27T19:48:01Z: rustc_mir::borrow_check::nll::universal_regions: build: global regions = 0..1
DEBUG 2018-09-27T19:48:01Z: rustc_mir::borrow_check::nll::universal_regions: build: extern regions = 1..1
DEBUG 2018-09-27T19:48:01Z: rustc_mir::borrow_check::nll::universal_regions: build: local regions  = 1..2
DEBUG 2018-09-27T19:48:01Z: rustc_mir::borrow_check::nll::renumber: renumber_mir()
DEBUG 2018-09-27T19:48:01Z: rustc_mir::borrow_check::nll::renumber: renumber_mir: mir.arg_count=0
DEBUG 2018-09-27T19:48:01Z: rustc_mir::borrow_check::nll::renumber: visit_ty(ty=i32, ty_context=Location(bb0[1]))
DEBUG 2018-09-27T19:48:01Z: rustc_mir::borrow_check::nll::renumber: renumber_regions(value=i32)
DEBUG 2018-09-27T19:48:01Z: rustc_mir::borrow_check::nll::renumber: visit_ty: ty=i32
DEBUG 2018-09-27T19:48:01Z: rustc_mir::borrow_check::nll::renumber: visit_ty(ty=i32, ty_context=Location(bb0[1]))
DEBUG 2018-09-27T19:48:01Z: rustc_mir::borrow_check::nll::renumber: renumber_regions(value=i32)
DEBUG 2018-09-27T19:48:01Z: rustc_mir::borrow_check::nll::renumber: visit_ty: ty=i32
DEBUG 2018-09-27T19:48:01Z: rustc_mir::borrow_check::nll::renumber: renumber_regions(value=Const { ty: i32, val: Scalar(Bits { size: 4, bits: 3 }) })
DEBUG 2018-09-27T19:48:01Z: rustc_mir::borrow_check::nll::renumber: visit_ty(ty=i32, ty_context=Location(bb0[2]))
DEBUG 2018-09-27T19:48:01Z: rustc_mir::borrow_check::nll::renumber: renumber_regions(value=i32)
DEBUG 2018-09-27T19:48:01Z: rustc_mir::borrow_check::nll::renumber: visit_ty: ty=i32
DEBUG 2018-09-27T19:48:01Z: rustc_mir::borrow_check::nll::renumber: visit_ty(ty=i32, ty_context=Location(bb0[2]))
DEBUG 2018-09-27T19:48:01Z: rustc_mir::borrow_check::nll::renumber: renumber_regions(value=i32)
DEBUG 2018-09-27T19:48:01Z: rustc_mir::borrow_check::nll::renumber: visit_ty: ty=i32
DEBUG 2018-09-27T19:48:01Z: rustc_mir::borrow_check::nll::renumber: renumber_regions(value=Const { ty: i32, val: Scalar(Bits { size: 4, bits: 4 }) })
DEBUG 2018-09-27T19:48:01Z: rustc_mir::borrow_check::nll::renumber: visit_region(region=ReScope(Node(ItemLocalId(88))), location=bb0[7])
DEBUG 2018-09-27T19:48:01Z: rustc_mir::borrow_check::nll::renumber: renumber_regions(value=ReScope(Node(ItemLocalId(88))))
DEBUG 2018-09-27T19:48:01Z: rustc_mir::borrow_check::nll::renumber: visit_region: region=&#39;_#2r
DEBUG 2018-09-27T19:48:01Z: rustc_mir::borrow_check::nll::renumber: visit_ty(ty=[&amp;str; 3], ty_context=Location(bb0[7]))
DEBUG 2018-09-27T19:48:01Z: rustc_mir::borrow_check::nll::renumber: renumber_regions(value=[&amp;str; 3])
DEBUG 2018-09-27T19:48:01Z: rustc_mir::borrow_check::nll::renumber: visit_ty: ty=[&amp;str; 3]
DEBUG 2018-09-27T19:48:01Z: rustc_mir::borrow_check::nll::renumber: visit_region(region=ReScope(Node(ItemLocalId(88))), location=bb0[8])
DEBUG 2018-09-27T19:48:01Z: rustc_mir::borrow_check::nll::renumber: renumber_regions(value=ReScope(Node(ItemLocalId(88))))
DEBUG 2018-09-27T19:48:01Z: rustc_mir::borrow_check::nll::renumber: visit_region: region=&#39;_#4r
DEBUG 2018-09-27T19:48:01Z: rustc_mir::borrow_check::nll::renumber: visit_ty(ty=&amp;[&amp;str], ty_context=Location(bb0[9]))
DEBUG 2018-09-27T19:48:01Z: rustc_mir::borrow_check::nll::renumber: renumber_regions(value=&amp;[&amp;str])
DEBUG 2018-09-27T19:48:01Z: rustc_mir::borrow_check::nll::renumber: visit_ty: ty=&amp;[&amp;str]
DEBUG 2018-09-27T19:48:01Z: rustc_mir::borrow_check::nll::renumber: visit_region(region=ReScope(Node(ItemLocalId(88))), location=bb0[17])
DEBUG 2018-09-27T19:48:01Z: rustc_mir::borrow_check::nll::renumber: renumber_regions(value=ReScope(Node(ItemLocalId(88))))
DEBUG 2018-09-27T19:48:01Z: rustc_mir::borrow_check::nll::renumber: visit_region: region=&#39;_#7r
DEBUG 2018-09-27T19:48:01Z: rustc_mir::borrow_check::nll::renumber: visit_ty(ty=i32, ty_context=Location(bb0[17]))
DEBUG 2018-09-27T19:48:01Z: rustc_mir::borrow_check::nll::renumber: renumber_regions(value=i32)
DEBUG 2018-09-27T19:48:01Z: rustc_mir::borrow_check::nll::renumber: visit_ty: ty=i32
DEBUG 2018-09-27T19:48:01Z: rustc_mir::borrow_check::nll::renumber: visit_region(region=ReScope(Node(ItemLocalId(88))), location=bb0[19])
DEBUG 2018-09-27T19:48:01Z: rustc_mir::borrow_check::nll::renumber: renumber_regions(value=ReScope(Node(ItemLocalId(88))))
DEBUG 2018-09-27T19:48:01Z: rustc_mir::borrow_check::nll::renumber: visit_region: region=&#39;_#8r
DEBUG 2018-09-27T19:48:01Z: rustc_mir::borrow_check::nll::renumber: visit_ty(ty=i32, ty_context=Location(bb0[19]))
DEBUG 2018-09-27T19:48:01Z: rustc_mir::borrow_check::nll::renumber: renumber_regions(value=i32)
DEBUG 2018-09-27T19:48:01Z: rustc_mir::borrow_check::nll::renumber: visit_ty: ty=i32
DEBUG 2018-09-27T19:48:01Z: rustc_mir::borrow_check::nll::renumber: visit_ty(ty=&amp;i32, ty_context=Location(bb3[1]))
DEBUG 2018-09-27T19:48:01Z: rustc_mir::borrow_check::nll::renumber: renumber_regions(value=&amp;i32)
DEBUG 2018-09-27T19:48:01Z: rustc_mir::borrow_check::nll::renumber: visit_ty: ty=&amp;i32
DEBUG 2018-09-27T19:48:01Z: rustc_mir::borrow_check::nll::renumber: visit_ty(ty=&amp;i32, ty_context=Location(bb3[3]))
DEBUG 2018-09-27T19:48:01Z: rustc_mir::borrow_check::nll::renumber: renumber_regions(value=&amp;i32)
DEBUG 2018-09-27T19:48:01Z: rustc_mir::borrow_check::nll::renumber: visit_ty: ty=&amp;i32
DEBUG 2018-09-27T19:48:01Z: rustc_mir::borrow_check::nll::renumber: visit_region(region=ReScope(Node(ItemLocalId(88))), location=bb3[6])
DEBUG 2018-09-27T19:48:01Z: rustc_mir::borrow_check::nll::renumber: renumber_regions(value=ReScope(Node(ItemLocalId(88))))
DEBUG 2018-09-27T19:48:01Z: rustc_mir::borrow_check::nll::renumber: visit_region: region=&#39;_#11r
DEBUG 2018-09-27T19:48:01Z: rustc_mir::borrow_check::nll::renumber: visit_ty(ty=for&lt;&#39;r, &#39;s, &#39;t0&gt; fn(&amp;&#39;r i32, &amp;&#39;s mut std::fmt::Formatter&lt;&#39;t0&gt;) -&gt; std::result::Result&lt;(), std::fmt::Error&gt; {&lt;i32 as std::fmt::Display&gt;::fmt}, ty_context=Location(bb3[8]))
DEBUG 2018-09-27T19:48:01Z: rustc_mir::borrow_check::nll::renumber: renumber_regions(value=for&lt;&#39;r, &#39;s, &#39;t0&gt; fn(&amp;&#39;r i32, &amp;&#39;s mut std::fmt::Formatter&lt;&#39;t0&gt;) -&gt; std::result::Result&lt;(), std::fmt::Error&gt; {&lt;i32 as std::fmt::Display&gt;::fmt})
DEBUG 2018-09-27T19:48:01Z: rustc_mir::borrow_check::nll::renumber: visit_ty: ty=for&lt;&#39;r, &#39;s, &#39;t0&gt; fn(&amp;&#39;r i32, &amp;&#39;s mut std::fmt::Formatter&lt;&#39;t0&gt;) -&gt; std::result::Result&lt;(), std::fmt::Error&gt; {&lt;i32 as std::fmt::Display&gt;::fmt}
DEBUG 2018-09-27T19:48:01Z: rustc_mir::borrow_check::nll::renumber: renumber_regions(value=Const { ty: for&lt;&#39;r, &#39;s, &#39;t0&gt; fn(&amp;&#39;r i32, &amp;&#39;s mut std::fmt::Formatter&lt;&#39;t0&gt;) -&gt; std::result::Result&lt;(), std::fmt::Error&gt; {&lt;i32 as std::fmt::Display&gt;::fmt}, val: Scalar(Bits { size: 0, bits: 0 }) })
DEBUG 2018-09-27T19:48:01Z: rustc_mir::borrow_check::nll::renumber: visit_ty(ty=for&lt;&#39;r, &#39;s, &#39;t0&gt; fn(&amp;&#39;r i32, &amp;&#39;s mut std::fmt::Formatter&lt;&#39;t0&gt;) -&gt; std::result::Result&lt;(), std::fmt::Error&gt;, ty_context=Location(bb3[8]))
DEBUG 2018-09-27T19:48:01Z: rustc_mir::borrow_check::nll::renumber: renumber_regions(value=for&lt;&#39;r, &#39;s, &#39;t0&gt; fn(&amp;&#39;r i32, &amp;&#39;s mut std::fmt::Formatter&lt;&#39;t0&gt;) -&gt; std::result::Result&lt;(), std::fmt::Error&gt;)
DEBUG 2018-09-27T19:48:01Z: rustc_mir::borrow_check::nll::renumber: visit_ty: ty=for&lt;&#39;r, &#39;s, &#39;t0&gt; fn(&amp;&#39;r i32, &amp;&#39;s mut std::fmt::Formatter&lt;&#39;t0&gt;) -&gt; std::result::Result&lt;(), std::fmt::Error&gt;
DEBUG 2018-09-27T19:48:01Z: rustc_mir::borrow_check::nll::renumber: visit_ty(ty=for&lt;&#39;b&gt; fn(&amp;&#39;b i32, for&lt;&#39;r, &#39;s, &#39;t0&gt; fn(&amp;&#39;r i32, &amp;&#39;s mut std::fmt::Formatter&lt;&#39;t0&gt;) -&gt; std::result::Result&lt;(), std::fmt::Error&gt;) -&gt; std::fmt::ArgumentV1&lt;&#39;b&gt; {std::fmt::ArgumentV1&lt;&#39;_&gt;::new::&lt;i32&gt;}, ty_context=Location(bb3[9]))
DEBUG 2018-09-27T19:48:01Z: rustc_mir::borrow_check::nll::renumber: renumber_regions(value=for&lt;&#39;b&gt; fn(&amp;&#39;b i32, for&lt;&#39;r, &#39;s, &#39;t0&gt; fn(&amp;&#39;r i32, &amp;&#39;s mut std::fmt::Formatter&lt;&#39;t0&gt;) -&gt; std::result::Result&lt;(), std::fmt::Error&gt;) -&gt; std::fmt::ArgumentV1&lt;&#39;b&gt; {std::fmt::ArgumentV1&lt;&#39;_&gt;::new::&lt;i32&gt;})
DEBUG 2018-09-27T19:48:01Z: rustc_mir::borrow_check::nll::renumber: visit_ty: ty=for&lt;&#39;b&gt; fn(&amp;&#39;b i32, for&lt;&#39;r, &#39;s, &#39;t0&gt; fn(&amp;&#39;r i32, &amp;&#39;s mut std::fmt::Formatter&lt;&#39;t0&gt;) -&gt; std::result::Result&lt;(), std::fmt::Error&gt;) -&gt; std::fmt::ArgumentV1&lt;&#39;b&gt; {std::fmt::ArgumentV1&lt;&#39;_&gt;::new::&lt;i32&gt;}
DEBUG 2018-09-27T19:48:01Z: rustc_mir::borrow_check::nll::renumber: renumber_regions(value=Const { ty: for&lt;&#39;b&gt; fn(&amp;&#39;b i32, for&lt;&#39;r, &#39;s, &#39;t0&gt; fn(&amp;&#39;r i32, &amp;&#39;s mut std::fmt::Formatter&lt;&#39;t0&gt;) -&gt; std::result::Result&lt;(), std::fmt::Error&gt;) -&gt; std::fmt::ArgumentV1&lt;&#39;b&gt; {std::fmt::ArgumentV1&lt;&#39;_&gt;::new::&lt;i32&gt;}, val: Scalar(Bits { size: 0, bits: 0 }) })
DEBUG 2018-09-27T19:48:01Z: rustc_mir::borrow_check::nll::renumber: visit_region(region=ReScope(Node(ItemLocalId(88))), location=bb4[4])
DEBUG 2018-09-27T19:48:01Z: rustc_mir::borrow_check::nll::renumber: renumber_regions(value=ReScope(Node(ItemLocalId(88))))
DEBUG 2018-09-27T19:48:01Z: rustc_mir::borrow_check::nll::renumber: visit_region: region=&#39;_#14r
DEBUG 2018-09-27T19:48:01Z: rustc_mir::borrow_check::nll::renumber: visit_ty(ty=for&lt;&#39;r, &#39;s, &#39;t0&gt; fn(&amp;&#39;r i32, &amp;&#39;s mut std::fmt::Formatter&lt;&#39;t0&gt;) -&gt; std::result::Result&lt;(), std::fmt::Error&gt; {&lt;i32 as std::fmt::Display&gt;::fmt}, ty_context=Location(bb4[6]))
DEBUG 2018-09-27T19:48:01Z: rustc_mir::borrow_check::nll::renumber: renumber_regions(value=for&lt;&#39;r, &#39;s, &#39;t0&gt; fn(&amp;&#39;r i32, &amp;&#39;s mut std::fmt::Formatter&lt;&#39;t0&gt;) -&gt; std::result::Result&lt;(), std::fmt::Error&gt; {&lt;i32 as std::fmt::Display&gt;::fmt})
DEBUG 2018-09-27T19:48:01Z: rustc_mir::borrow_check::nll::renumber: visit_ty: ty=for&lt;&#39;r, &#39;s, &#39;t0&gt; fn(&amp;&#39;r i32, &amp;&#39;s mut std::fmt::Formatter&lt;&#39;t0&gt;) -&gt; std::result::Result&lt;(), std::fmt::Error&gt; {&lt;i32 as std::fmt::Display&gt;::fmt}
DEBUG 2018-09-27T19:48:01Z: rustc_mir::borrow_check::nll::renumber: renumber_regions(value=Const { ty: for&lt;&#39;r, &#39;s, &#39;t0&gt; fn(&amp;&#39;r i32, &amp;&#39;s mut std::fmt::Formatter&lt;&#39;t0&gt;) -&gt; std::result::Result&lt;(), std::fmt::Error&gt; {&lt;i32 as std::fmt::Display&gt;::fmt}, val: Scalar(Bits { size: 0, bits: 0 }) })
DEBUG 2018-09-27T19:48:01Z: rustc_mir::borrow_check::nll::renumber: visit_ty(ty=for&lt;&#39;r, &#39;s, &#39;t0&gt; fn(&amp;&#39;r i32, &amp;&#39;s mut std::fmt::Formatter&lt;&#39;t0&gt;) -&gt; std::result::Result&lt;(), std::fmt::Error&gt;, ty_context=Location(bb4[6]))
DEBUG 2018-09-27T19:48:01Z: rustc_mir::borrow_check::nll::r
</pre></div>



<a name="134772085"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2354499%20Invalid%20%22variable%20does%20not%20need%20to%20be%20mutable%22/near/134772085" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2354499.20Invalid.20.22variable.20does.20not.20need.20to.20be.20mutable.22.html#134772085">(Sep 27 2018 at 20:35)</a>:</h4>
<p>maybe make a gist?</p>



<a name="134772094"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2354499%20Invalid%20%22variable%20does%20not%20need%20to%20be%20mutable%22/near/134772094" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2354499.20Invalid.20.22variable.20does.20not.20need.20to.20be.20mutable.22.html#134772094">(Sep 27 2018 at 20:35)</a>:</h4>
<p>I don't think Zulip likes so much text :)</p>



<a name="134772151"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2354499%20Invalid%20%22variable%20does%20not%20need%20to%20be%20mutable%22/near/134772151" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2354499.20Invalid.20.22variable.20does.20not.20need.20to.20be.20mutable.22.html#134772151">(Sep 27 2018 at 20:36)</a>:</h4>
<p><a href="https://gist.github.com/spastorino/07a71bb46c425fd3e0d0c3bfc4b8edd0" target="_blank" title="https://gist.github.com/spastorino/07a71bb46c425fd3e0d0c3bfc4b8edd0">https://gist.github.com/spastorino/07a71bb46c425fd3e0d0c3bfc4b8edd0</a></p>



<a name="134772161"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2354499%20Invalid%20%22variable%20does%20not%20need%20to%20be%20mutable%22/near/134772161" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2354499.20Invalid.20.22variable.20does.20not.20need.20to.20be.20mutable.22.html#134772161">(Sep 27 2018 at 20:36)</a>:</h4>
<p>I was exactly looking at those <code>add_used_mut</code> calls</p>



<a name="134772187"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2354499%20Invalid%20%22variable%20does%20not%20need%20to%20be%20mutable%22/near/134772187" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2354499.20Invalid.20.22variable.20does.20not.20need.20to.20be.20mutable.22.html#134772187">(Sep 27 2018 at 20:37)</a>:</h4>
<p>my guess anyway was that root_access contains an is_local_mutation_allowed property with value No</p>



<a name="134772190"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2354499%20Invalid%20%22variable%20does%20not%20need%20to%20be%20mutable%22/near/134772190" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2354499.20Invalid.20.22variable.20does.20not.20need.20to.20be.20mutable.22.html#134772190">(Sep 27 2018 at 20:37)</a>:</h4>
<p>and I guess it should be Yes</p>



<a name="134772204"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2354499%20Invalid%20%22variable%20does%20not%20need%20to%20be%20mutable%22/near/134772204" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2354499.20Invalid.20.22variable.20does.20not.20need.20to.20be.20mutable.22.html#134772204">(Sep 27 2018 at 20:37)</a>:</h4>
<p>I don't think it should be YEs</p>



<a name="134772214"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2354499%20Invalid%20%22variable%20does%20not%20need%20to%20be%20mutable%22/near/134772214" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2354499.20Invalid.20.22variable.20does.20not.20need.20to.20be.20mutable.22.html#134772214">(Sep 27 2018 at 20:37)</a>:</h4>
<p>that would allow you to mutate things that are not declared mut</p>



<a name="134772219"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2354499%20Invalid%20%22variable%20does%20not%20need%20to%20be%20mutable%22/near/134772219" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2354499.20Invalid.20.22variable.20does.20not.20need.20to.20be.20mutable.22.html#134772219">(Sep 27 2018 at 20:37)</a>:</h4>
<p>for .. various annoying reasons .. we sometimes want to permit that</p>



<a name="134772227"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2354499%20Invalid%20%22variable%20does%20not%20need%20to%20be%20mutable%22/near/134772227" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2354499.20Invalid.20.22variable.20does.20not.20need.20to.20be.20mutable.22.html#134772227">(Sep 27 2018 at 20:37)</a>:</h4>
<p>e.g., if you are executing the <code>Drop</code> at the end of scope</p>



<a name="134772229"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2354499%20Invalid%20%22variable%20does%20not%20need%20to%20be%20mutable%22/near/134772229" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2354499.20Invalid.20.22variable.20does.20not.20need.20to.20be.20mutable.22.html#134772229">(Sep 27 2018 at 20:37)</a>:</h4>
<p>that is technically mutation</p>



<a name="134772273"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2354499%20Invalid%20%22variable%20does%20not%20need%20to%20be%20mutable%22/near/134772273" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2354499.20Invalid.20.22variable.20does.20not.20need.20to.20be.20mutable.22.html#134772273">(Sep 27 2018 at 20:38)</a>:</h4>
<p>but not in this case</p>



<a name="134772297"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2354499%20Invalid%20%22variable%20does%20not%20need%20to%20be%20mutable%22/near/134772297" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2354499.20Invalid.20.22variable.20does.20not.20need.20to.20be.20mutable.22.html#134772297">(Sep 27 2018 at 20:38)</a>:</h4>
<p>but don't you want to allow mutating <code>s</code>?</p>



<a name="134772300"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2354499%20Invalid%20%22variable%20does%20not%20need%20to%20be%20mutable%22/near/134772300" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2354499.20Invalid.20.22variable.20does.20not.20need.20to.20be.20mutable.22.html#134772300">(Sep 27 2018 at 20:38)</a>:</h4>
<p>so... here is the thing that is confusing me:</p>



<a name="134772306"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2354499%20Invalid%20%22variable%20does%20not%20need%20to%20be%20mutable%22/near/134772306" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2354499.20Invalid.20.22variable.20does.20not.20need.20to.20be.20mutable.22.html#134772306">(Sep 27 2018 at 20:38)</a>:</h4>
<p>if I udnerstand this log output</p>



<a name="134772308"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2354499%20Invalid%20%22variable%20does%20not%20need%20to%20be%20mutable%22/near/134772308" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2354499.20Invalid.20.22variable.20does.20not.20need.20to.20be.20mutable.22.html#134772308">(Sep 27 2018 at 20:39)</a>:</h4>
<div class="codehilite"><pre><span></span>DEBUG 2018-09-27T19:48:01Z: rustc_mir::borrow_check: check_access_permissions((_1.0: i32), Write(Mutate), No)
DEBUG 2018-09-27T19:48:01Z: rustc_mir::borrow_check: check_access_permissions: (_1.0: i32), No
DEBUG 2018-09-27T19:48:01Z: rustc_mir::borrow_check: check_access_permissions: RootPlace { place: _1, is_local_mutation_allowed: No }
</pre></div>



<a name="134772325"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2354499%20Invalid%20%22variable%20does%20not%20need%20to%20be%20mutable%22/near/134772325" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2354499.20Invalid.20.22variable.20does.20not.20need.20to.20be.20mutable.22.html#134772325">(Sep 27 2018 at 20:39)</a>:</h4>
<p>we <strong>are</strong> adding <code> RootPlace { place: _1, is_local_mutation_allowed: No }</code> into the <code>used_mut</code> set</p>



<a name="134772336"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2354499%20Invalid%20%22variable%20does%20not%20need%20to%20be%20mutable%22/near/134772336" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2354499.20Invalid.20.22variable.20does.20not.20need.20to.20be.20mutable.22.html#134772336">(Sep 27 2018 at 20:39)</a>:</h4>
<p>so I think that means that somewhere — even though it's in the set — we are issuing the warning anyway</p>



<a name="134772349"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2354499%20Invalid%20%22variable%20does%20not%20need%20to%20be%20mutable%22/near/134772349" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2354499.20Invalid.20.22variable.20does.20not.20need.20to.20be.20mutable.22.html#134772349">(Sep 27 2018 at 20:39)</a>:</h4>
<p>yep</p>



<a name="134772352"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2354499%20Invalid%20%22variable%20does%20not%20need%20to%20be%20mutable%22/near/134772352" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2354499.20Invalid.20.22variable.20does.20not.20need.20to.20be.20mutable.22.html#134772352">(Sep 27 2018 at 20:40)</a>:</h4>
<p>I guessed it was because of that flag</p>



<a name="134772394"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2354499%20Invalid%20%22variable%20does%20not%20need%20to%20be%20mutable%22/near/134772394" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2354499.20Invalid.20.22variable.20does.20not.20need.20to.20be.20mutable.22.html#134772394">(Sep 27 2018 at 20:40)</a>:</h4>
<p>that was all my guessing</p>



<a name="134772398"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2354499%20Invalid%20%22variable%20does%20not%20need%20to%20be%20mutable%22/near/134772398" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2354499.20Invalid.20.22variable.20does.20not.20need.20to.20be.20mutable.22.html#134772398">(Sep 27 2018 at 20:40)</a>:</h4>
<p>but I'm not sure</p>



<a name="134772418"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2354499%20Invalid%20%22variable%20does%20not%20need%20to%20be%20mutable%22/near/134772418" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2354499.20Invalid.20.22variable.20does.20not.20need.20to.20be.20mutable.22.html#134772418">(Sep 27 2018 at 20:40)</a>:</h4>
<p>because of <a href="https://github.com/rust-lang/rust/blob/c9865b1c37f8cb8a257591e6ea0b32a5df1f3d41/src/librustc_mir/borrow_check/mod.rs#L1810" target="_blank" title="https://github.com/rust-lang/rust/blob/c9865b1c37f8cb8a257591e6ea0b32a5df1f3d41/src/librustc_mir/borrow_check/mod.rs#L1810">https://github.com/rust-lang/rust/blob/c9865b1c37f8cb8a257591e6ea0b32a5df1f3d41/src/librustc_mir/borrow_check/mod.rs#L1810</a></p>



<a name="134772439"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2354499%20Invalid%20%22variable%20does%20not%20need%20to%20be%20mutable%22/near/134772439" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2354499.20Invalid.20.22variable.20does.20not.20need.20to.20be.20mutable.22.html#134772439">(Sep 27 2018 at 20:41)</a>:</h4>
<p>sorry, changed the line number</p>



<a name="134772443"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2354499%20Invalid%20%22variable%20does%20not%20need%20to%20be%20mutable%22/near/134772443" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2354499.20Invalid.20.22variable.20does.20not.20need.20to.20be.20mutable.22.html#134772443">(Sep 27 2018 at 20:41)</a>:</h4>
<p><code>if is_local_mutation_allowed != LocalMutationIsAllowed::Yes {</code></p>



<a name="134772462"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2354499%20Invalid%20%22variable%20does%20not%20need%20to%20be%20mutable%22/near/134772462" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2354499.20Invalid.20.22variable.20does.20not.20need.20to.20be.20mutable.22.html#134772462">(Sep 27 2018 at 20:41)</a>:</h4>
<p>ah wait</p>



<a name="134772471"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2354499%20Invalid%20%22variable%20does%20not%20need%20to%20be%20mutable%22/near/134772471" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2354499.20Invalid.20.22variable.20does.20not.20need.20to.20be.20mutable.22.html#134772471">(Sep 27 2018 at 20:41)</a>:</h4>
<p>ok, yes,  that's the code I was confused about</p>



<a name="134772526"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2354499%20Invalid%20%22variable%20does%20not%20need%20to%20be%20mutable%22/near/134772526" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2354499.20Invalid.20.22variable.20does.20not.20need.20to.20be.20mutable.22.html#134772526">(Sep 27 2018 at 20:42)</a>:</h4>
<p>I ... suspect  we can just remove that logic</p>



<a name="134772534"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2354499%20Invalid%20%22variable%20does%20not%20need%20to%20be%20mutable%22/near/134772534" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2354499.20Invalid.20.22variable.20does.20not.20need.20to.20be.20mutable.22.html#134772534">(Sep 27 2018 at 20:42)</a>:</h4>
<p>and just <em>always</em> invoke <code>self.used_muts.insert(..)</code></p>



<a name="134772540"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2354499%20Invalid%20%22variable%20does%20not%20need%20to%20be%20mutable%22/near/134772540" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2354499.20Invalid.20.22variable.20does.20not.20need.20to.20be.20mutable.22.html#134772540">(Sep 27 2018 at 20:42)</a>:</h4>
<p>I was trying to change that and make this code run to see what happens</p>



<a name="134772542"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2354499%20Invalid%20%22variable%20does%20not%20need%20to%20be%20mutable%22/near/134772542" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2354499.20Invalid.20.22variable.20does.20not.20need.20to.20be.20mutable.22.html#134772542">(Sep 27 2018 at 20:42)</a>:</h4>
<p>exactly</p>



<a name="134772546"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2354499%20Invalid%20%22variable%20does%20not%20need%20to%20be%20mutable%22/near/134772546" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2354499.20Invalid.20.22variable.20does.20not.20need.20to.20be.20mutable.22.html#134772546">(Sep 27 2018 at 20:42)</a>:</h4>
<p>that logic used to be needed</p>



<a name="134772557"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2354499%20Invalid%20%22variable%20does%20not%20need%20to%20be%20mutable%22/near/134772557" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2354499.20Invalid.20.22variable.20does.20not.20need.20to.20be.20mutable.22.html#134772557">(Sep 27 2018 at 20:43)</a>:</h4>
<p>and will be needed again if we properly fix <a href="https://github.com/rust-lang/rust/issues/21232" target="_blank" title="https://github.com/rust-lang/rust/issues/21232">#21232</a> :)</p>



<a name="134772558"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2354499%20Invalid%20%22variable%20does%20not%20need%20to%20be%20mutable%22/near/134772558" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2354499.20Invalid.20.22variable.20does.20not.20need.20to.20be.20mutable.22.html#134772558">(Sep 27 2018 at 20:43)</a>:</h4>
<p>by remove that logic you meant remove the if?</p>



<a name="134772569"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2354499%20Invalid%20%22variable%20does%20not%20need%20to%20be%20mutable%22/near/134772569" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2354499.20Invalid.20.22variable.20does.20not.20need.20to.20be.20mutable.22.html#134772569">(Sep 27 2018 at 20:43)</a>:</h4>
<p>yeah, I mean replace this:</p>
<div class="codehilite"><pre><span></span><span class="w">                </span><span class="k">if</span><span class="w"> </span><span class="n">is_local_mutation_allowed</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="n">LocalMutationIsAllowed</span>::<span class="n">Yes</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">                    </span><span class="c1">// If the local may be initialized, and it is now currently being</span>
<span class="w">                    </span><span class="c1">// mutated, then it is justified to be annotated with the `mut`</span>
<span class="w">                    </span><span class="c1">// keyword, since the mutation may be a possible reassignment.</span>
<span class="w">                    </span><span class="kd">let</span><span class="w"> </span><span class="n">mpi</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="bp">self</span><span class="p">.</span><span class="n">move_data</span><span class="p">.</span><span class="n">rev_lookup</span><span class="p">.</span><span class="n">find_local</span><span class="p">(</span><span class="o">*</span><span class="n">local</span><span class="p">);</span><span class="w"></span>
<span class="w">                    </span><span class="kd">let</span><span class="w"> </span><span class="n">ii</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">&amp;</span><span class="bp">self</span><span class="p">.</span><span class="n">move_data</span><span class="p">.</span><span class="n">init_path_map</span><span class="p">[</span><span class="n">mpi</span><span class="p">];</span><span class="w"></span>
<span class="w">                    </span><span class="k">for</span><span class="w"> </span><span class="o">&amp;</span><span class="n">index</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="n">ii</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">                        </span><span class="k">if</span><span class="w"> </span><span class="n">flow_state</span><span class="p">.</span><span class="n">ever_inits</span><span class="p">.</span><span class="n">contains</span><span class="p">(</span><span class="n">index</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">                            </span><span class="bp">self</span><span class="p">.</span><span class="n">used_mut</span><span class="p">.</span><span class="n">insert</span><span class="p">(</span><span class="o">*</span><span class="n">local</span><span class="p">);</span><span class="w"></span>
<span class="w">                            </span><span class="k">break</span><span class="p">;</span><span class="w"></span>
<span class="w">                        </span><span class="p">}</span><span class="w"></span>
<span class="w">                    </span><span class="p">}</span><span class="w"></span>
<span class="w">                </span><span class="p">}</span><span class="w"></span>
</pre></div>


<p>with </p>
<div class="codehilite"><pre><span></span><span class="w">                            </span><span class="bp">self</span><span class="p">.</span><span class="n">used_mut</span><span class="p">.</span><span class="n">insert</span><span class="p">(</span><span class="o">*</span><span class="n">local</span><span class="p">);</span><span class="w"></span>
</pre></div>



<a name="134772654"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2354499%20Invalid%20%22variable%20does%20not%20need%20to%20be%20mutable%22/near/134772654" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2354499.20Invalid.20.22variable.20does.20not.20need.20to.20be.20mutable.22.html#134772654">(Sep 27 2018 at 20:44)</a>:</h4>
<p>basically I think the case this thing is looking for — the first initialization of non-mut thing — is handled separately now</p>



<a name="134772680"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2354499%20Invalid%20%22variable%20does%20not%20need%20to%20be%20mutable%22/near/134772680" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2354499.20Invalid.20.22variable.20does.20not.20need.20to.20be.20mutable.22.html#134772680">(Sep 27 2018 at 20:44)</a>:</h4>
<p>ok</p>



<a name="134772712"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2354499%20Invalid%20%22variable%20does%20not%20need%20to%20be%20mutable%22/near/134772712" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2354499.20Invalid.20.22variable.20does.20not.20need.20to.20be.20mutable.22.html#134772712">(Sep 27 2018 at 20:45)</a>:</h4>
<p>(do you see what I mean?)</p>



<a name="134772785"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2354499%20Invalid%20%22variable%20does%20not%20need%20to%20be%20mutable%22/near/134772785" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2354499.20Invalid.20.22variable.20does.20not.20need.20to.20be.20mutable.22.html#134772785">(Sep 27 2018 at 20:46)</a>:</h4>
<p>yes</p>



<a name="134772792"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2354499%20Invalid%20%22variable%20does%20not%20need%20to%20be%20mutable%22/near/134772792" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2354499.20Invalid.20.22variable.20does.20not.20need.20to.20be.20mutable.22.html#134772792">(Sep 27 2018 at 20:46)</a>:</h4>
<p>I mean, no idea where is handled now but yes</p>



<a name="134772793"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2354499%20Invalid%20%22variable%20does%20not%20need%20to%20be%20mutable%22/near/134772793" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2354499.20Invalid.20.22variable.20does.20not.20need.20to.20be.20mutable.22.html#134772793">(Sep 27 2018 at 20:46)</a>:</h4>
<p>I see</p>



<a name="134773004"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2354499%20Invalid%20%22variable%20does%20not%20need%20to%20be%20mutable%22/near/134773004" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2354499.20Invalid.20.22variable.20does.20not.20need.20to.20be.20mutable.22.html#134773004">(Sep 27 2018 at 20:50)</a>:</h4>
<p>basically we special case that code out:</p>
<div class="codehilite"><pre><span></span><span class="w">        </span><span class="c1">// Special case: you can assign a immutable local variable</span>
<span class="w">        </span><span class="c1">// (e.g., `x = ...`) so long as it has never been initialized</span>
<span class="w">        </span><span class="c1">// before (at this point in the flow).</span>
<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="kd">let</span><span class="w"> </span><span class="o">&amp;</span><span class="n">Place</span>::<span class="n">Local</span><span class="p">(</span><span class="n">local</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">place_span</span><span class="p">.</span><span class="mi">0</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">            </span><span class="k">if</span><span class="w"> </span><span class="kd">let</span><span class="w"> </span><span class="n">Mutability</span>::<span class="n">Not</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="bp">self</span><span class="p">.</span><span class="n">mir</span><span class="p">.</span><span class="n">local_decls</span><span class="p">[</span><span class="n">local</span><span class="p">].</span><span class="n">mutability</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">                </span><span class="c1">// check for reassignments to immutable local variables</span>
<span class="w">                </span><span class="bp">self</span><span class="p">.</span><span class="n">check_if_reassignment_to_immutable_state</span><span class="p">(</span><span class="w"></span>
<span class="w">                    </span><span class="n">context</span><span class="p">,</span><span class="w"></span>
<span class="w">                    </span><span class="n">local</span><span class="p">,</span><span class="w"></span>
<span class="w">                    </span><span class="n">place_span</span><span class="p">,</span><span class="w"></span>
<span class="w">                    </span><span class="n">flow_state</span><span class="p">,</span><span class="w"></span>
<span class="w">                </span><span class="p">);</span><span class="w"></span>
<span class="w">                </span><span class="k">return</span><span class="p">;</span><span class="w"></span>
<span class="w">            </span><span class="p">}</span><span class="w"></span>
<span class="w">        </span><span class="p">}</span><span class="w"></span>

<span class="w">        </span><span class="c1">// Otherwise, use the normal access permission rules.</span>
<span class="w">        </span><span class="bp">self</span><span class="p">.</span><span class="n">access_place</span><span class="p">(</span><span class="w"></span>
<span class="w">            </span><span class="n">context</span><span class="p">,</span><span class="w"></span>
<span class="w">            </span><span class="n">place_span</span><span class="p">,</span><span class="w"></span>
<span class="w">            </span><span class="p">(</span><span class="n">kind</span><span class="p">,</span><span class="w"> </span><span class="n">Write</span><span class="p">(</span><span class="n">WriteKind</span>::<span class="n">Mutate</span><span class="p">)),</span><span class="w"></span>
<span class="w">            </span><span class="n">LocalMutationIsAllowed</span>::<span class="n">No</span><span class="p">,</span><span class="w"></span>
<span class="w">            </span><span class="n">flow_state</span><span class="p">,</span><span class="w"></span>
<span class="w">        </span><span class="p">);</span><span class="w"></span>
</pre></div>



<a name="134773017"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2354499%20Invalid%20%22variable%20does%20not%20need%20to%20be%20mutable%22/near/134773017" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2354499.20Invalid.20.22variable.20does.20not.20need.20to.20be.20mutable.22.html#134773017">(Sep 27 2018 at 20:50)</a>:</h4>
<p>we never even invoke <code>check_access_permission</code> in that case</p>



<a name="134773629"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2354499%20Invalid%20%22variable%20does%20not%20need%20to%20be%20mutable%22/near/134773629" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2354499.20Invalid.20.22variable.20does.20not.20need.20to.20be.20mutable.22.html#134773629">(Sep 27 2018 at 21:03)</a>:</h4>
<p><span class="emoji emoji-1f44d" title="+1">:+1:</span></p>



<a name="134773634"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2354499%20Invalid%20%22variable%20does%20not%20need%20to%20be%20mutable%22/near/134773634" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2354499.20Invalid.20.22variable.20does.20not.20need.20to.20be.20mutable.22.html#134773634">(Sep 27 2018 at 21:03)</a>:</h4>
<p>makes sense</p>



<a name="134773691"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2354499%20Invalid%20%22variable%20does%20not%20need%20to%20be%20mutable%22/near/134773691" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2354499.20Invalid.20.22variable.20does.20not.20need.20to.20be.20mutable.22.html#134773691">(Sep 27 2018 at 21:04)</a>:</h4>
<p>it works</p>



<a name="134774032"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2354499%20Invalid%20%22variable%20does%20not%20need%20to%20be%20mutable%22/near/134774032" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2354499.20Invalid.20.22variable.20does.20not.20need.20to.20be.20mutable.22.html#134774032">(Sep 27 2018 at 21:11)</a>:</h4>
<p><span class="user-mention" data-user-id="116009">@nikomatsakis</span> <a href="https://github.com/rust-lang/rust/pull/54621" target="_blank" title="https://github.com/rust-lang/rust/pull/54621">https://github.com/rust-lang/rust/pull/54621</a></p>



<a name="134774081"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2354499%20Invalid%20%22variable%20does%20not%20need%20to%20be%20mutable%22/near/134774081" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2354499.20Invalid.20.22variable.20does.20not.20need.20to.20be.20mutable.22.html#134774081">(Sep 27 2018 at 21:12)</a>:</h4>
<p>after that should we continue with <a href="https://github.com/rust-lang/rust/issues/21232" target="_blank" title="https://github.com/rust-lang/rust/issues/21232">https://github.com/rust-lang/rust/issues/21232</a> ?</p>



<a name="134774086"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2354499%20Invalid%20%22variable%20does%20not%20need%20to%20be%20mutable%22/near/134774086" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2354499.20Invalid.20.22variable.20does.20not.20need.20to.20be.20mutable.22.html#134774086">(Sep 27 2018 at 21:12)</a>:</h4>
<p>unsure how hard it is :)</p>



<a name="134774299"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2354499%20Invalid%20%22variable%20does%20not%20need%20to%20be%20mutable%22/near/134774299" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2354499.20Invalid.20.22variable.20does.20not.20need.20to.20be.20mutable.22.html#134774299">(Sep 27 2018 at 21:16)</a>:</h4>
<p>seems reasonable to continue with</p>



<a name="134774302"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2354499%20Invalid%20%22variable%20does%20not%20need%20to%20be%20mutable%22/near/134774302" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2354499.20Invalid.20.22variable.20does.20not.20need.20to.20be.20mutable.22.html#134774302">(Sep 27 2018 at 21:16)</a>:</h4>
<p>not the highest priority thing <em>ever</em> but it'd be a nice bit of Rust to cleanup</p>



<a name="134774327"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2354499%20Invalid%20%22variable%20does%20not%20need%20to%20be%20mutable%22/near/134774327" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2354499.20Invalid.20.22variable.20does.20not.20need.20to.20be.20mutable.22.html#134774327">(Sep 27 2018 at 21:17)</a>:</h4>
<p>left a few nits</p>



<a name="134774524"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2354499%20Invalid%20%22variable%20does%20not%20need%20to%20be%20mutable%22/near/134774524" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2354499.20Invalid.20.22variable.20does.20not.20need.20to.20be.20mutable.22.html#134774524">(Sep 27 2018 at 21:21)</a>:</h4>
<p>the field was only useful for that?</p>



<a name="134774684"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2354499%20Invalid%20%22variable%20does%20not%20need%20to%20be%20mutable%22/near/134774684" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2354499.20Invalid.20.22variable.20does.20not.20need.20to.20be.20mutable.22.html#134774684">(Sep 27 2018 at 21:24)</a>:</h4>
<p>I <em>think</em> so</p>



<a name="134774686"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2354499%20Invalid%20%22variable%20does%20not%20need%20to%20be%20mutable%22/near/134774686" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2354499.20Invalid.20.22variable.20does.20not.20need.20to.20be.20mutable.22.html#134774686">(Sep 27 2018 at 21:24)</a>:</h4>
<p>but you can check :)</p>



<a name="134774689"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2354499%20Invalid%20%22variable%20does%20not%20need%20to%20be%20mutable%22/near/134774689" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2354499.20Invalid.20.22variable.20does.20not.20need.20to.20be.20mutable.22.html#134774689">(Sep 27 2018 at 21:24)</a>:</h4>
<p>will do</p>



<a name="134774695"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2354499%20Invalid%20%22variable%20does%20not%20need%20to%20be%20mutable%22/near/134774695" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2354499.20Invalid.20.22variable.20does.20not.20need.20to.20be.20mutable.22.html#134774695">(Sep 27 2018 at 21:24)</a>:</h4>
<p>need to leave now</p>



<a name="134774712"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2354499%20Invalid%20%22variable%20does%20not%20need%20to%20be%20mutable%22/near/134774712" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2354499.20Invalid.20.22variable.20does.20not.20need.20to.20be.20mutable.22.html#134774712">(Sep 27 2018 at 21:25)</a>:</h4>
<p>anyway I want to see ci running :)</p>



<a name="134823171"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2354499%20Invalid%20%22variable%20does%20not%20need%20to%20be%20mutable%22/near/134823171" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2354499.20Invalid.20.22variable.20does.20not.20need.20to.20be.20mutable.22.html#134823171">(Sep 28 2018 at 13:16)</a>:</h4>
<p><span class="user-mention" data-user-id="116009">@nikomatsakis</span> have you seen ci errors?</p>



<a name="134828282"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2354499%20Invalid%20%22variable%20does%20not%20need%20to%20be%20mutable%22/near/134828282" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2354499.20Invalid.20.22variable.20does.20not.20need.20to.20be.20mutable.22.html#134828282">(Sep 28 2018 at 14:32)</a>:</h4>
<p><span class="user-mention" data-user-id="116266">@Santiago Pastorino</span> I have not</p>



<a name="134828314"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2354499%20Invalid%20%22variable%20does%20not%20need%20to%20be%20mutable%22/near/134828314" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2354499.20Invalid.20.22variable.20does.20not.20need.20to.20be.20mutable.22.html#134828314">(Sep 28 2018 at 14:33)</a>:</h4>
<p>though it looks like this is affecting mo..oh</p>



<a name="134828326"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2354499%20Invalid%20%22variable%20does%20not%20need%20to%20be%20mutable%22/near/134828326" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2354499.20Invalid.20.22variable.20does.20not.20need.20to.20be.20mutable.22.html#134828326">(Sep 28 2018 at 14:33)</a>:</h4>
<p>I guess I was a bit aggressive</p>



<a name="134829403"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2354499%20Invalid%20%22variable%20does%20not%20need%20to%20be%20mutable%22/near/134829403" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2354499.20Invalid.20.22variable.20does.20not.20need.20to.20be.20mutable.22.html#134829403">(Sep 28 2018 at 14:46)</a>:</h4>
<p>I guess we need some logic like that</p>



<a name="134829406"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2354499%20Invalid%20%22variable%20does%20not%20need%20to%20be%20mutable%22/near/134829406" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2354499.20Invalid.20.22variable.20does.20not.20need.20to.20be.20mutable.22.html#134829406">(Sep 28 2018 at 14:46)</a>:</h4>
<p>just not <em>that</em> logic :P</p>



<a name="134845408"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2354499%20Invalid%20%22variable%20does%20not%20need%20to%20be%20mutable%22/near/134845408" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2354499.20Invalid.20.22variable.20does.20not.20need.20to.20be.20mutable.22.html#134845408">(Sep 28 2018 at 19:15)</a>:</h4>
<p><span class="user-mention" data-user-id="116266">@Santiago Pastorino</span> so do you have some idea what is needed to fix or do you need more tips?</p>



<a name="134845840"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2354499%20Invalid%20%22variable%20does%20not%20need%20to%20be%20mutable%22/near/134845840" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2354499.20Invalid.20.22variable.20does.20not.20need.20to.20be.20mutable.22.html#134845840">(Sep 28 2018 at 19:22)</a>:</h4>
<p>left a review on the PR with some tips</p>



<a name="134851777"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2354499%20Invalid%20%22variable%20does%20not%20need%20to%20be%20mutable%22/near/134851777" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2354499.20Invalid.20.22variable.20does.20not.20need.20to.20be.20mutable.22.html#134851777">(Sep 28 2018 at 21:09)</a>:</h4>
<p><span class="user-mention" data-user-id="116009">@nikomatsakis</span> sorry, couldn’t answer before</p>



<a name="134851780"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2354499%20Invalid%20%22variable%20does%20not%20need%20to%20be%20mutable%22/near/134851780" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2354499.20Invalid.20.22variable.20does.20not.20need.20to.20be.20mutable.22.html#134851780">(Sep 28 2018 at 21:09)</a>:</h4>
<p>I guess I can figure out</p>



<a name="134851786"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2354499%20Invalid%20%22variable%20does%20not%20need%20to%20be%20mutable%22/near/134851786" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2354499.20Invalid.20.22variable.20does.20not.20need.20to.20be.20mutable.22.html#134851786">(Sep 28 2018 at 21:09)</a>:</h4>
<p>it’s just that I’m on vacations <span class="emoji emoji-1f601" title="grinning face with smiling eyes">:grinning_face_with_smiling_eyes:</span></p>



<a name="134854651"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2354499%20Invalid%20%22variable%20does%20not%20need%20to%20be%20mutable%22/near/134854651" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2354499.20Invalid.20.22variable.20does.20not.20need.20to.20be.20mutable.22.html#134854651">(Sep 28 2018 at 22:07)</a>:</h4>
<p><span class="user-mention" data-user-id="116009">@nikomatsakis</span> I see what you mean here <a href="https://github.com/rust-lang/rust/pull/54621#discussion_r221356961" target="_blank" title="https://github.com/rust-lang/rust/pull/54621#discussion_r221356961">https://github.com/rust-lang/rust/pull/54621#discussion_r221356961</a></p>



<a name="134854827"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2354499%20Invalid%20%22variable%20does%20not%20need%20to%20be%20mutable%22/near/134854827" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2354499.20Invalid.20.22variable.20does.20not.20need.20to.20be.20mutable.22.html#134854827">(Sep 28 2018 at 22:09)</a>:</h4>
<p>need to find out how to go from that place to the other one</p>



<a name="134854830"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2354499%20Invalid%20%22variable%20does%20not%20need%20to%20be%20mutable%22/near/134854830" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2354499.20Invalid.20.22variable.20does.20not.20need.20to.20be.20mutable.22.html#134854830">(Sep 28 2018 at 22:09)</a>:</h4>
<p>actually in <code>a.0</code> RootPlace is <code>a</code>, right?</p>



<a name="134856279"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2354499%20Invalid%20%22variable%20does%20not%20need%20to%20be%20mutable%22/near/134856279" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2354499.20Invalid.20.22variable.20does.20not.20need.20to.20be.20mutable.22.html#134856279">(Sep 28 2018 at 22:37)</a>:</h4>
<p>I guess I need to find a <code>Projection</code> or something, I don't remember</p>



<a name="134856280"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2354499%20Invalid%20%22variable%20does%20not%20need%20to%20be%20mutable%22/near/134856280" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2354499.20Invalid.20.22variable.20does.20not.20need.20to.20be.20mutable.22.html#134856280">(Sep 28 2018 at 22:37)</a>:</h4>
<p>need to find that out</p>



<a name="134856282"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2354499%20Invalid%20%22variable%20does%20not%20need%20to%20be%20mutable%22/near/134856282" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2354499.20Invalid.20.22variable.20does.20not.20need.20to.20be.20mutable.22.html#134856282">(Sep 28 2018 at 22:37)</a>:</h4>
<p>but need to leave now :)</p>



<a name="134858783"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2354499%20Invalid%20%22variable%20does%20not%20need%20to%20be%20mutable%22/near/134858783" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2354499.20Invalid.20.22variable.20does.20not.20need.20to.20be.20mutable.22.html#134858783">(Sep 28 2018 at 23:46)</a>:</h4>
<p>had some spare minutes again</p>



<a name="134858791"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2354499%20Invalid%20%22variable%20does%20not%20need%20to%20be%20mutable%22/near/134858791" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2354499.20Invalid.20.22variable.20does.20not.20need.20to.20be.20mutable.22.html#134858791">(Sep 28 2018 at 23:47)</a>:</h4>
<p>I was wondering if I need to do it here</p>



<a name="134858792"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2354499%20Invalid%20%22variable%20does%20not%20need%20to%20be%20mutable%22/near/134858792" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2354499.20Invalid.20.22variable.20does.20not.20need.20to.20be.20mutable.22.html#134858792">(Sep 28 2018 at 23:47)</a>:</h4>
<div class="codehilite"><pre><span></span><span class="w">            </span><span class="n">RootPlace</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">                </span><span class="n">place</span>: <span class="nc">place</span><span class="w"> </span><span class="o">@</span><span class="w"> </span><span class="n">Place</span>::<span class="n">Projection</span><span class="p">(</span><span class="n">_</span><span class="p">),</span><span class="w"></span>
<span class="w">                </span><span class="n">is_local_mutation_allowed</span>: <span class="nc">_</span><span class="p">,</span><span class="w"></span>
<span class="w">            </span><span class="p">}</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
</pre></div>



<a name="134858795"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2354499%20Invalid%20%22variable%20does%20not%20need%20to%20be%20mutable%22/near/134858795" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2354499.20Invalid.20.22variable.20does.20not.20need.20to.20be.20mutable.22.html#134858795">(Sep 28 2018 at 23:47)</a>:</h4>
<p>match the projection, match the field and insert that into used_mut or something</p>



<a name="134858904"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2354499%20Invalid%20%22variable%20does%20not%20need%20to%20be%20mutable%22/near/134858904" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2354499.20Invalid.20.22variable.20does.20not.20need.20to.20be.20mutable.22.html#134858904">(Sep 28 2018 at 23:50)</a>:</h4>
<p>was wondering if this <a href="https://github.com/rust-lang/rust/blob/c9865b1c37f8cb8a257591e6ea0b32a5df1f3d41/src/librustc_mir/borrow_check/mod.rs#L1828-L1835" target="_blank" title="https://github.com/rust-lang/rust/blob/c9865b1c37f8cb8a257591e6ea0b32a5df1f3d41/src/librustc_mir/borrow_check/mod.rs#L1828-L1835">https://github.com/rust-lang/rust/blob/c9865b1c37f8cb8a257591e6ea0b32a5df1f3d41/src/librustc_mir/borrow_check/mod.rs#L1828-L1835</a> wasn't related</p>



<a name="135059869"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2354499%20Invalid%20%22variable%20does%20not%20need%20to%20be%20mutable%22/near/135059869" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2354499.20Invalid.20.22variable.20does.20not.20need.20to.20be.20mutable.22.html#135059869">(Oct 02 2018 at 19:55)</a>:</h4>
<p>ok raising this topic up again <span class="user-mention" data-user-id="116266">@Santiago Pastorino</span></p>



<a name="135060148"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2354499%20Invalid%20%22variable%20does%20not%20need%20to%20be%20mutable%22/near/135060148" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2354499.20Invalid.20.22variable.20does.20not.20need.20to.20be.20mutable.22.html#135060148">(Oct 02 2018 at 20:00)</a>:</h4>
<blockquote>
<p>was wondering if this <a href="https://github.com/rust-lang/rust/blob/c9865b1c37f8cb8a257591e6ea0b32a5df1f3d41/src/librustc_mir/borrow_check/mod.rs#L1828-L1835" target="_blank" title="https://github.com/rust-lang/rust/blob/c9865b1c37f8cb8a257591e6ea0b32a5df1f3d41/src/librustc_mir/borrow_check/mod.rs#L1828-L1835">https://github.com/rust-lang/rust/blob/c9865b1c37f8cb8a257591e6ea0b32a5df1f3d41/src/librustc_mir/borrow_check/mod.rs#L1828-L1835</a> wasn't related</p>
</blockquote>
<p>I don't <em>think</em> that's terribly related. That occurs when you have an assignment in a closure, and it kind of propagates that assignment back out to the parent</p>



<a name="135060186"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2354499%20Invalid%20%22variable%20does%20not%20need%20to%20be%20mutable%22/near/135060186" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2354499.20Invalid.20.22variable.20does.20not.20need.20to.20be.20mutable.22.html#135060186">(Oct 02 2018 at 20:01)</a>:</h4>
<p>if you look at the callees of <code>add_used_mut</code> though, they do have the original <code>place</code> available (<a href="https://github.com/rust-lang/rust/blob/c9865b1c37f8cb8a257591e6ea0b32a5df1f3d41/src/librustc_mir/borrow_check/mod.rs#L1709" target="_blank" title="https://github.com/rust-lang/rust/blob/c9865b1c37f8cb8a257591e6ea0b32a5df1f3d41/src/librustc_mir/borrow_check/mod.rs#L1709">example</a>)</p>



<a name="135060211"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2354499%20Invalid%20%22variable%20does%20not%20need%20to%20be%20mutable%22/near/135060211" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2354499.20Invalid.20.22variable.20does.20not.20need.20to.20be.20mutable.22.html#135060211">(Oct 02 2018 at 20:01)</a>:</h4>
<p>I think the idea would be something like this:</p>
<ul>
<li>extend <code>add_used_mut</code> to take also a <code>accessed_place: Place&lt;'tcx&gt;</code></li>
</ul>



<a name="135060263"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2354499%20Invalid%20%22variable%20does%20not%20need%20to%20be%20mutable%22/near/135060263" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2354499.20Invalid.20.22variable.20does.20not.20need.20to.20be.20mutable.22.html#135060263">(Oct 02 2018 at 20:02)</a>:</h4>
<ul>
<li>if the <code>root_place</code> is a local variable, but the <code>accessed_place</code> is a projection, then add the local variable as a "used mut" with a FIXME(<a href="https://github.com/rust-lang/rust/issues/21232" target="_blank" title="https://github.com/rust-lang/rust/issues/21232">#21232</a>) note</li>
</ul>



<a name="135060283"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2354499%20Invalid%20%22variable%20does%20not%20need%20to%20be%20mutable%22/near/135060283" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2354499.20Invalid.20.22variable.20does.20not.20need.20to.20be.20mutable.22.html#135060283">(Oct 02 2018 at 20:02)</a>:</h4>
<ul>
<li>if the root-place is a local and the accessed-place is also a local, then do the existing logic (check if the local variable was ever initialized, and add as "used mut" in that case, but otherwise not)</li>
</ul>



<a name="135126028"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2354499%20Invalid%20%22variable%20does%20not%20need%20to%20be%20mutable%22/near/135126028" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2354499.20Invalid.20.22variable.20does.20not.20need.20to.20be.20mutable.22.html#135126028">(Oct 03 2018 at 19:02)</a>:</h4>
<p><span class="user-mention" data-user-id="116009">@nikomatsakis</span> I have quickly pushed something to <a href="https://github.com/rust-lang/rust/pull/54621" target="_blank" title="https://github.com/rust-lang/rust/pull/54621">https://github.com/rust-lang/rust/pull/54621</a></p>



<a name="135126036"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2354499%20Invalid%20%22variable%20does%20not%20need%20to%20be%20mutable%22/near/135126036" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2354499.20Invalid.20.22variable.20does.20not.20need.20to.20be.20mutable.22.html#135126036">(Oct 03 2018 at 19:02)</a>:</h4>
<p>I'm waiting for local tests but I already see some failures</p>



<a name="135126049"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2354499%20Invalid%20%22variable%20does%20not%20need%20to%20be%20mutable%22/near/135126049" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2354499.20Invalid.20.22variable.20does.20not.20need.20to.20be.20mutable.22.html#135126049">(Oct 03 2018 at 19:03)</a>:</h4>
<p>anyway, wanted to check if this was more or less what you wanted</p>



<a name="135127754"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2354499%20Invalid%20%22variable%20does%20not%20need%20to%20be%20mutable%22/near/135127754" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2354499.20Invalid.20.22variable.20does.20not.20need.20to.20be.20mutable.22.html#135127754">(Oct 03 2018 at 19:30)</a>:</h4>
<p><span class="user-mention" data-user-id="116266">@Santiago Pastorino</span> looks about right, yes, left a request for a comment</p>



<a name="135127802"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2354499%20Invalid%20%22variable%20does%20not%20need%20to%20be%20mutable%22/near/135127802" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2354499.20Invalid.20.22variable.20does.20not.20need.20to.20be.20mutable.22.html#135127802">(Oct 03 2018 at 19:31)</a>:</h4>
<p>I saw the failures were related to --keep-stage 1</p>



<a name="135127803"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2354499%20Invalid%20%22variable%20does%20not%20need%20to%20be%20mutable%22/near/135127803" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2354499.20Invalid.20.22variable.20does.20not.20need.20to.20be.20mutable.22.html#135127803">(Oct 03 2018 at 19:31)</a>:</h4>
<p>will try again</p>



<a name="135127821"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2354499%20Invalid%20%22variable%20does%20not%20need%20to%20be%20mutable%22/near/135127821" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2354499.20Invalid.20.22variable.20does.20not.20need.20to.20be.20mutable.22.html#135127821">(Oct 03 2018 at 19:32)</a>:</h4>
<p>I still need to address 2 comments :)</p>



<a name="135128254"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2354499%20Invalid%20%22variable%20does%20not%20need%20to%20be%20mutable%22/near/135128254" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2354499.20Invalid.20.22variable.20does.20not.20need.20to.20be.20mutable.22.html#135128254">(Oct 03 2018 at 19:41)</a>:</h4>
<p>ok</p>



<a name="135128988"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2354499%20Invalid%20%22variable%20does%20not%20need%20to%20be%20mutable%22/near/135128988" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2354499.20Invalid.20.22variable.20does.20not.20need.20to.20be.20mutable.22.html#135128988">(Oct 03 2018 at 19:55)</a>:</h4>
<div class="codehilite"><pre><span></span>// We need the local be defined as mut until we fix #21232
// FIXME(#21232)
</pre></div>



<a name="135128990"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2354499%20Invalid%20%22variable%20does%20not%20need%20to%20be%20mutable%22/near/135128990" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2354499.20Invalid.20.22variable.20does.20not.20need.20to.20be.20mutable.22.html#135128990">(Oct 03 2018 at 19:55)</a>:</h4>
<p><span class="user-mention" data-user-id="116009">@nikomatsakis</span> does this works?</p>



<a name="135129000"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2354499%20Invalid%20%22variable%20does%20not%20need%20to%20be%20mutable%22/near/135129000" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2354499.20Invalid.20.22variable.20does.20not.20need.20to.20be.20mutable.22.html#135129000">(Oct 03 2018 at 19:55)</a>:</h4>
<p>or</p>



<a name="135129068"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2354499%20Invalid%20%22variable%20does%20not%20need%20to%20be%20mutable%22/near/135129068" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2354499.20Invalid.20.22variable.20does.20not.20need.20to.20be.20mutable.22.html#135129068">(Oct 03 2018 at 19:56)</a>:</h4>
<div class="codehilite"><pre><span></span>// FIXME(#21232): We need the local be defined as mut until we fix this issue
</pre></div>



<a name="135129629"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2354499%20Invalid%20%22variable%20does%20not%20need%20to%20be%20mutable%22/near/135129629" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2354499.20Invalid.20.22variable.20does.20not.20need.20to.20be.20mutable.22.html#135129629">(Oct 03 2018 at 20:05)</a>:</h4>
<p><span class="user-mention" data-user-id="116266">@Santiago Pastorino</span> I'd probably say:</p>
<hr>
<p>FIXME(<a href="https://github.com/rust-lang/rust/issues/21232" target="_blank" title="https://github.com/rust-lang/rust/issues/21232">#21232</a>): For the time being, you can only have an assignment to a path like <code>a.b.c = x</code> if <code>a</code> is declared as <code>mut</code>, even when <code>a</code> has not been initialized before. So if we see an assignment to such a path, we can always mark the <code>mut</code> on <code>a</code> as being used.</p>



<a name="135133068"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2354499%20Invalid%20%22variable%20does%20not%20need%20to%20be%20mutable%22/near/135133068" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2354499.20Invalid.20.22variable.20does.20not.20need.20to.20be.20mutable.22.html#135133068">(Oct 03 2018 at 20:52)</a>:</h4>
<p><span class="user-mention" data-user-id="116009">@nikomatsakis</span> <a href="https://travis-ci.org/rust-lang/rust/jobs/436807954" target="_blank" title="https://travis-ci.org/rust-lang/rust/jobs/436807954">https://travis-ci.org/rust-lang/rust/jobs/436807954</a></p>



<a name="135133232"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2354499%20Invalid%20%22variable%20does%20not%20need%20to%20be%20mutable%22/near/135133232" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2354499.20Invalid.20.22variable.20does.20not.20need.20to.20be.20mutable.22.html#135133232">(Oct 03 2018 at 20:56)</a>:</h4>
<p>hmm.</p>



<a name="135133250"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2354499%20Invalid%20%22variable%20does%20not%20need%20to%20be%20mutable%22/near/135133250" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2354499.20Invalid.20.22variable.20does.20not.20need.20to.20be.20mutable.22.html#135133250">(Oct 03 2018 at 20:57)</a>:</h4>
<p>seems like the test is wrong somehow... oh, I think <em>maybe</em> I know..?</p>



<a name="135133258"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2354499%20Invalid%20%22variable%20does%20not%20need%20to%20be%20mutable%22/near/135133258" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2354499.20Invalid.20.22variable.20does.20not.20need.20to.20be.20mutable.22.html#135133258">(Oct 03 2018 at 20:57)</a>:</h4>
<p>well, not entirely sure, but I guess I would dump out the projections etc involved</p>



<a name="135133350"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2354499%20Invalid%20%22variable%20does%20not%20need%20to%20be%20mutable%22/near/135133350" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2354499.20Invalid.20.22variable.20does.20not.20need.20to.20be.20mutable.22.html#135133350">(Oct 03 2018 at 20:59)</a>:</h4>
<p><span class="emoji emoji-1f44d" title="+1">:+1:</span></p>



<a name="135133364"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2354499%20Invalid%20%22variable%20does%20not%20need%20to%20be%20mutable%22/near/135133364" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2354499.20Invalid.20.22variable.20does.20not.20need.20to.20be.20mutable.22.html#135133364">(Oct 03 2018 at 20:59)</a>:</h4>
<p>as soon as I can compile this :S</p>



<a name="135133371"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2354499%20Invalid%20%22variable%20does%20not%20need%20to%20be%20mutable%22/near/135133371" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2354499.20Invalid.20.22variable.20does.20not.20need.20to.20be.20mutable.22.html#135133371">(Oct 03 2018 at 20:59)</a>:</h4>
<p>it's failing to compile rustc</p>



<a name="135133373"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2354499%20Invalid%20%22variable%20does%20not%20need%20to%20be%20mutable%22/near/135133373" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2354499.20Invalid.20.22variable.20does.20not.20need.20to.20be.20mutable.22.html#135133373">(Oct 03 2018 at 20:59)</a>:</h4>
<p>I guess are memory issues</p>



<a name="135200758"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2354499%20Invalid%20%22variable%20does%20not%20need%20to%20be%20mutable%22/near/135200758" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2354499.20Invalid.20.22variable.20does.20not.20need.20to.20be.20mutable.22.html#135200758">(Oct 04 2018 at 16:36)</a>:</h4>
<p><span class="user-mention" data-user-id="116009">@nikomatsakis</span> back with this</p>



<a name="135200765"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2354499%20Invalid%20%22variable%20does%20not%20need%20to%20be%20mutable%22/near/135200765" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2354499.20Invalid.20.22variable.20does.20not.20need.20to.20be.20mutable.22.html#135200765">(Oct 04 2018 at 16:37)</a>:</h4>
<p>I've built a sample repro example</p>



<a name="135200773"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2354499%20Invalid%20%22variable%20does%20not%20need%20to%20be%20mutable%22/near/135200773" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2354499.20Invalid.20.22variable.20does.20not.20need.20to.20be.20mutable.22.html#135200773">(Oct 04 2018 at 16:37)</a>:</h4>
<p>and I'm seeing that add_used_mut is not even called :S</p>



<a name="135200793"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2354499%20Invalid%20%22variable%20does%20not%20need%20to%20be%20mutable%22/near/135200793" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2354499.20Invalid.20.22variable.20does.20not.20need.20to.20be.20mutable.22.html#135200793">(Oct 04 2018 at 16:37)</a>:</h4>
<div class="codehilite"><pre><span></span><span class="cp">#![feature(nll)]</span><span class="w"></span>

<span class="k">fn</span> <span class="nf">main</span><span class="p">()</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="k">mut</span><span class="w"> </span><span class="n">v</span><span class="w"> </span>: <span class="kp">&amp;</span><span class="nc">mut</span><span class="w"> </span><span class="nb">Vec</span><span class="o">&lt;</span><span class="p">()</span><span class="o">&gt;</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">&amp;</span><span class="k">mut</span><span class="w"> </span><span class="n">vec</span><span class="o">!</span><span class="p">[];</span><span class="w"> </span><span class="c1">//[lexical]~ ERROR: variable does not need to be mutable</span>
<span class="w">                                            </span><span class="c1">//[nll]~^ ERROR: variable does not need to be mutable</span>
<span class="w">    </span><span class="n">v</span><span class="p">.</span><span class="n">push</span><span class="p">(());</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>
</pre></div>



<a name="135200842"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2354499%20Invalid%20%22variable%20does%20not%20need%20to%20be%20mutable%22/near/135200842" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2354499.20Invalid.20.22variable.20does.20not.20need.20to.20be.20mutable.22.html#135200842">(Oct 04 2018 at 16:38)</a>:</h4>
<p>investigating</p>



<a name="135200888"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2354499%20Invalid%20%22variable%20does%20not%20need%20to%20be%20mutable%22/near/135200888" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2354499.20Invalid.20.22variable.20does.20not.20need.20to.20be.20mutable.22.html#135200888">(Oct 04 2018 at 16:39)</a>:</h4>
<p>hmm</p>



<a name="135200895"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2354499%20Invalid%20%22variable%20does%20not%20need%20to%20be%20mutable%22/near/135200895" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2354499.20Invalid.20.22variable.20does.20not.20need.20to.20be.20mutable.22.html#135200895">(Oct 04 2018 at 16:39)</a>:</h4>
<p>that seems right for it not to be called :)</p>



<a name="135200904"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2354499%20Invalid%20%22variable%20does%20not%20need%20to%20be%20mutable%22/near/135200904" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2354499.20Invalid.20.22variable.20does.20not.20need.20to.20be.20mutable.22.html#135200904">(Oct 04 2018 at 16:39)</a>:</h4>
<p>I guess the question then is why/how <code>v</code> gets added tho</p>



<a name="135200988"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2354499%20Invalid%20%22variable%20does%20not%20need%20to%20be%20mutable%22/near/135200988" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2354499.20Invalid.20.22variable.20does.20not.20need.20to.20be.20mutable.22.html#135200988">(Oct 04 2018 at 16:40)</a>:</h4>
<p>added where?</p>



<a name="135200993"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2354499%20Invalid%20%22variable%20does%20not%20need%20to%20be%20mutable%22/near/135200993" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2354499.20Invalid.20.22variable.20does.20not.20need.20to.20be.20mutable.22.html#135200993">(Oct 04 2018 at 16:40)</a>:</h4>
<p>to the set of muts that are used</p>



<a name="135200995"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2354499%20Invalid%20%22variable%20does%20not%20need%20to%20be%20mutable%22/near/135200995" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2354499.20Invalid.20.22variable.20does.20not.20need.20to.20be.20mutable.22.html#135200995">(Oct 04 2018 at 16:40)</a>:</h4>
<p>i.e., the problem is that we are no longer getting the lint, right?</p>



<a name="135200998"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2354499%20Invalid%20%22variable%20does%20not%20need%20to%20be%20mutable%22/near/135200998" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2354499.20Invalid.20.22variable.20does.20not.20need.20to.20be.20mutable.22.html#135200998">(Oct 04 2018 at 16:40)</a>:</h4>
<p>that means we consider the <code>mut</code> on <code>v</code> to be used</p>



<a name="135201009"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2354499%20Invalid%20%22variable%20does%20not%20need%20to%20be%20mutable%22/near/135201009" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2354499.20Invalid.20.22variable.20does.20not.20need.20to.20be.20mutable.22.html#135201009">(Oct 04 2018 at 16:41)</a>:</h4>
<p>yes</p>



<a name="135201011"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2354499%20Invalid%20%22variable%20does%20not%20need%20to%20be%20mutable%22/near/135201011" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2354499.20Invalid.20.22variable.20does.20not.20need.20to.20be.20mutable.22.html#135201011">(Oct 04 2018 at 16:41)</a>:</h4>
<p>let me investigate a bit more</p>



<a name="135201099"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2354499%20Invalid%20%22variable%20does%20not%20need%20to%20be%20mutable%22/near/135201099" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2354499.20Invalid.20.22variable.20does.20not.20need.20to.20be.20mutable.22.html#135201099">(Oct 04 2018 at 16:42)</a>:</h4>
<p><a href="https://github.com/rust-lang/rust/blob/30101f912b121e5f4185081b616f9b910031fe60/src/librustc_mir/borrow_check/used_muts.rs#L58-L60" target="_blank" title="https://github.com/rust-lang/rust/blob/30101f912b121e5f4185081b616f9b910031fe60/src/librustc_mir/borrow_check/used_muts.rs#L58-L60">https://github.com/rust-lang/rust/blob/30101f912b121e5f4185081b616f9b910031fe60/src/librustc_mir/borrow_check/used_muts.rs#L58-L60</a></p>



<a name="135201106"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2354499%20Invalid%20%22variable%20does%20not%20need%20to%20be%20mutable%22/near/135201106" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2354499.20Invalid.20.22variable.20does.20not.20need.20to.20be.20mutable.22.html#135201106">(Oct 04 2018 at 16:42)</a>:</h4>
<p>probably</p>



<a name="135201294"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2354499%20Invalid%20%22variable%20does%20not%20need%20to%20be%20mutable%22/near/135201294" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2354499.20Invalid.20.22variable.20does.20not.20need.20to.20be.20mutable.22.html#135201294">(Oct 04 2018 at 16:46)</a>:</h4>
<p>actually, why is it changing used_mut in the place I was modofying the code and also there?</p>



<a name="135201304"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2354499%20Invalid%20%22variable%20does%20not%20need%20to%20be%20mutable%22/near/135201304" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2354499.20Invalid.20.22variable.20does.20not.20need.20to.20be.20mutable.22.html#135201304">(Oct 04 2018 at 16:47)</a>:</h4>
<p>I guess it should happen just in one place, right?</p>



<a name="135201309"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2354499%20Invalid%20%22variable%20does%20not%20need%20to%20be%20mutable%22/near/135201309" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2354499.20Invalid.20.22variable.20does.20not.20need.20to.20be.20mutable.22.html#135201309">(Oct 04 2018 at 16:47)</a>:</h4>
<p>that link doesn't work for me</p>



<a name="135201325"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2354499%20Invalid%20%22variable%20does%20not%20need%20to%20be%20mutable%22/near/135201325" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2354499.20Invalid.20.22variable.20does.20not.20need.20to.20be.20mutable.22.html#135201325">(Oct 04 2018 at 16:47)</a>:</h4>
<p><a href="https://github.com/rust-lang/rust/blob/master/src/librustc_mir/borrow_check/used_muts.rs#L58-L60" target="_blank" title="https://github.com/rust-lang/rust/blob/master/src/librustc_mir/borrow_check/used_muts.rs#L58-L60">https://github.com/rust-lang/rust/blob/master/src/librustc_mir/borrow_check/used_muts.rs#L58-L60</a></p>



<a name="135201331"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2354499%20Invalid%20%22variable%20does%20not%20need%20to%20be%20mutable%22/near/135201331" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2354499.20Invalid.20.22variable.20does.20not.20need.20to.20be.20mutable.22.html#135201331">(Oct 04 2018 at 16:47)</a>:</h4>
<p>sorry vim took my local commit :)</p>



<a name="135201383"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2354499%20Invalid%20%22variable%20does%20not%20need%20to%20be%20mutable%22/near/135201383" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2354499.20Invalid.20.22variable.20does.20not.20need.20to.20be.20mutable.22.html#135201383">(Oct 04 2018 at 16:48)</a>:</h4>
<p>does look suspicious</p>



<a name="135201392"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2354499%20Invalid%20%22variable%20does%20not%20need%20to%20be%20mutable%22/near/135201392" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2354499.20Invalid.20.22variable.20does.20not.20need.20to.20be.20mutable.22.html#135201392">(Oct 04 2018 at 16:48)</a>:</h4>
<p>that code...does get called</p>



<a name="135201435"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2354499%20Invalid%20%22variable%20does%20not%20need%20to%20be%20mutable%22/near/135201435" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2354499.20Invalid.20.22variable.20does.20not.20need.20to.20be.20mutable.22.html#135201435">(Oct 04 2018 at 16:49)</a>:</h4>
<p>let me remove it and test for this case :)</p>



<a name="135201446"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2354499%20Invalid%20%22variable%20does%20not%20need%20to%20be%20mutable%22/near/135201446" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2354499.20Invalid.20.22variable.20does.20not.20need.20to.20be.20mutable.22.html#135201446">(Oct 04 2018 at 16:49)</a>:</h4>
<p>I was going to say, try removing it and see what happens...</p>



<a name="135201448"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2354499%20Invalid%20%22variable%20does%20not%20need%20to%20be%20mutable%22/near/135201448" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2354499.20Invalid.20.22variable.20does.20not.20need.20to.20be.20mutable.22.html#135201448">(Oct 04 2018 at 16:49)</a>:</h4>
<p>very weird</p>



<a name="135201456"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2354499%20Invalid%20%22variable%20does%20not%20need%20to%20be%20mutable%22/near/135201456" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2354499.20Invalid.20.22variable.20does.20not.20need.20to.20be.20mutable.22.html#135201456">(Oct 04 2018 at 16:49)</a>:</h4>
<p>yeah first step test this case</p>



<a name="135201461"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2354499%20Invalid%20%22variable%20does%20not%20need%20to%20be%20mutable%22/near/135201461" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2354499.20Invalid.20.22variable.20does.20not.20need.20to.20be.20mutable.22.html#135201461">(Oct 04 2018 at 16:49)</a>:</h4>
<p>second run the whole thing</p>



<a name="135201505"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2354499%20Invalid%20%22variable%20does%20not%20need%20to%20be%20mutable%22/near/135201505" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2354499.20Invalid.20.22variable.20does.20not.20need.20to.20be.20mutable.22.html#135201505">(Oct 04 2018 at 16:50)</a>:</h4>
<p>third hopefully see everything working :D</p>



<a name="135201850"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2354499%20Invalid%20%22variable%20does%20not%20need%20to%20be%20mutable%22/near/135201850" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2354499.20Invalid.20.22variable.20does.20not.20need.20to.20be.20mutable.22.html#135201850">(Oct 04 2018 at 16:55)</a>:</h4>
<p><span class="user-mention" data-user-id="116009">@nikomatsakis</span> removing that doesn't make this return any warning either</p>



<a name="135201851"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2354499%20Invalid%20%22variable%20does%20not%20need%20to%20be%20mutable%22/near/135201851" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2354499.20Invalid.20.22variable.20does.20not.20need.20to.20be.20mutable.22.html#135201851">(Oct 04 2018 at 16:55)</a>:</h4>
<p>:S</p>



<a name="135201908"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2354499%20Invalid%20%22variable%20does%20not%20need%20to%20be%20mutable%22/near/135201908" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2354499.20Invalid.20.22variable.20does.20not.20need.20to.20be.20mutable.22.html#135201908">(Oct 04 2018 at 16:56)</a>:</h4>
<p>seems impossible</p>



<a name="135201921"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2354499%20Invalid%20%22variable%20does%20not%20need%20to%20be%20mutable%22/near/135201921" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2354499.20Invalid.20.22variable.20does.20not.20need.20to.20be.20mutable.22.html#135201921">(Oct 04 2018 at 16:56)</a>:</h4>
<div class="codehilite"><pre><span></span>[santiago@archlinux rust1 (invalid-no-need-mut)]$ rg used_mut | rg insert | rg mir
src/librustc_mir/borrow_check/mod.rs:                                    self.used_mut.insert(local);
src/librustc_mir/borrow_check/mod.rs:                        self.used_mut.insert(*local);
src/librustc_mir/borrow_check/mod.rs:                                self.used_mut.insert(*local);
</pre></div>



<a name="135201926"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2354499%20Invalid%20%22variable%20does%20not%20need%20to%20be%20mutable%22/near/135201926" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2354499.20Invalid.20.22variable.20does.20not.20need.20to.20be.20mutable.22.html#135201926">(Oct 04 2018 at 16:57)</a>:</h4>
<p>two cases are under a debug flag and is not printed</p>



<a name="135201956"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2354499%20Invalid%20%22variable%20does%20not%20need%20to%20be%20mutable%22/near/135201956" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2354499.20Invalid.20.22variable.20does.20not.20need.20to.20be.20mutable.22.html#135201956">(Oct 04 2018 at 16:57)</a>:</h4>
<p>and the other case doesn't have a debug flag but is under <code>Rvalue::Aggregate</code></p>



<a name="135201959"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2354499%20Invalid%20%22variable%20does%20not%20need%20to%20be%20mutable%22/near/135201959" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2354499.20Invalid.20.22variable.20does.20not.20need.20to.20be.20mutable.22.html#135201959">(Oct 04 2018 at 16:57)</a>:</h4>
<p>so shouldn't happen either</p>



<a name="135202053"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2354499%20Invalid%20%22variable%20does%20not%20need%20to%20be%20mutable%22/near/135202053" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2354499.20Invalid.20.22variable.20does.20not.20need.20to.20be.20mutable.22.html#135202053">(Oct 04 2018 at 16:58)</a>:</h4>
<p><span class="emoji emoji-1f937" title="shrug">:shrug:</span></p>



<a name="135202059"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2354499%20Invalid%20%22variable%20does%20not%20need%20to%20be%20mutable%22/near/135202059" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2354499.20Invalid.20.22variable.20does.20not.20need.20to.20be.20mutable.22.html#135202059">(Oct 04 2018 at 16:58)</a>:</h4>
<p>add some more <code>debug!</code> I guess :)</p>



<a name="135202070"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2354499%20Invalid%20%22variable%20does%20not%20need%20to%20be%20mutable%22/near/135202070" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2354499.20Invalid.20.22variable.20does.20not.20need.20to.20be.20mutable.22.html#135202070">(Oct 04 2018 at 16:59)</a>:</h4>
<p>checking if there are other ways of inserting</p>



<a name="135206333"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2354499%20Invalid%20%22variable%20does%20not%20need%20to%20be%20mutable%22/near/135206333" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2354499.20Invalid.20.22variable.20does.20not.20need.20to.20be.20mutable.22.html#135206333">(Oct 04 2018 at 18:05)</a>:</h4>
<div class="codehilite"><pre><span></span>    /// This field keeps track of all the local variables that are declared mut and are mutated.
    /// Used for the warning issued by an unused mutable local variable.
    used_mut: FxHashSet&lt;Local&gt;,
</pre></div>



<a name="135206339"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2354499%20Invalid%20%22variable%20does%20not%20need%20to%20be%20mutable%22/near/135206339" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2354499.20Invalid.20.22variable.20does.20not.20need.20to.20be.20mutable.22.html#135206339">(Oct 04 2018 at 18:05)</a>:</h4>
<p>is it the way you say or the other way around?</p>



<a name="135206405"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2354499%20Invalid%20%22variable%20does%20not%20need%20to%20be%20mutable%22/near/135206405" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2354499.20Invalid.20.22variable.20does.20not.20need.20to.20be.20mutable.22.html#135206405">(Oct 04 2018 at 18:06)</a>:</h4>
<p>I mean, what's the meaning of used_mut actually?</p>



<a name="135206410"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2354499%20Invalid%20%22variable%20does%20not%20need%20to%20be%20mutable%22/near/135206410" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2354499.20Invalid.20.22variable.20does.20not.20need.20to.20be.20mutable.22.html#135206410">(Oct 04 2018 at 18:06)</a>:</h4>
<p>having second thoughts about this</p>



<a name="135206721"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2354499%20Invalid%20%22variable%20does%20not%20need%20to%20be%20mutable%22/near/135206721" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2354499.20Invalid.20.22variable.20does.20not.20need.20to.20be.20mutable.22.html#135206721">(Oct 04 2018 at 18:11)</a>:</h4>
<p>I believe it means:</p>



<a name="135206723"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2354499%20Invalid%20%22variable%20does%20not%20need%20to%20be%20mutable%22/near/135206723" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2354499.20Invalid.20.22variable.20does.20not.20need.20to.20be.20mutable.22.html#135206723">(Oct 04 2018 at 18:11)</a>:</h4>
<p>this local variable <em>must</em> be declared <code>mut</code> or the program would not borrow check</p>



<a name="135206773"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2354499%20Invalid%20%22variable%20does%20not%20need%20to%20be%20mutable%22/near/135206773" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2354499.20Invalid.20.22variable.20does.20not.20need.20to.20be.20mutable.22.html#135206773">(Oct 04 2018 at 18:12)</a>:</h4>
<p>put another way, the <code>mut</code> declaration on this variable was "used"</p>



<a name="135208282"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2354499%20Invalid%20%22variable%20does%20not%20need%20to%20be%20mutable%22/near/135208282" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2354499.20Invalid.20.22variable.20does.20not.20need.20to.20be.20mutable.22.html#135208282">(Oct 04 2018 at 18:36)</a>:</h4>
<p>I understand</p>



<a name="135208283"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2354499%20Invalid%20%22variable%20does%20not%20need%20to%20be%20mutable%22/near/135208283" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2354499.20Invalid.20.22variable.20does.20not.20need.20to.20be.20mutable.22.html#135208283">(Oct 04 2018 at 18:36)</a>:</h4>
<p>weird</p>



<a name="135208298"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2354499%20Invalid%20%22variable%20does%20not%20need%20to%20be%20mutable%22/near/135208298" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2354499.20Invalid.20.22variable.20does.20not.20need.20to.20be.20mutable.22.html#135208298">(Oct 04 2018 at 18:37)</a>:</h4>
<p>I can't find of any insertion into there</p>



<a name="135208320"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2354499%20Invalid%20%22variable%20does%20not%20need%20to%20be%20mutable%22/near/135208320" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2354499.20Invalid.20.22variable.20does.20not.20need.20to.20be.20mutable.22.html#135208320">(Oct 04 2018 at 18:37)</a>:</h4>
<p>what I can do is just look for where the error messages are being displayed and output the context that is there</p>



<a name="135208344"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2354499%20Invalid%20%22variable%20does%20not%20need%20to%20be%20mutable%22/near/135208344" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2354499.20Invalid.20.22variable.20does.20not.20need.20to.20be.20mutable.22.html#135208344">(Oct 04 2018 at 18:38)</a>:</h4>
<p>sigh</p>



<a name="135208393"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2354499%20Invalid%20%22variable%20does%20not%20need%20to%20be%20mutable%22/near/135208393" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2354499.20Invalid.20.22variable.20does.20not.20need.20to.20be.20mutable.22.html#135208393">(Oct 04 2018 at 18:38)</a>:</h4>
<p>makes sense</p>



<a name="135208407"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2354499%20Invalid%20%22variable%20does%20not%20need%20to%20be%20mutable%22/near/135208407" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2354499.20Invalid.20.22variable.20does.20not.20need.20to.20be.20mutable.22.html#135208407">(Oct 04 2018 at 18:38)</a>:</h4>
<p>at this point I would probably just add <code>debug!</code> all over the dang compiler :)</p>



<a name="135208520"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2354499%20Invalid%20%22variable%20does%20not%20need%20to%20be%20mutable%22/near/135208520" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2354499.20Invalid.20.22variable.20does.20not.20need.20to.20be.20mutable.22.html#135208520">(Oct 04 2018 at 18:40)</a>:</h4>
<p>hehehe</p>



<a name="135208534"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2354499%20Invalid%20%22variable%20does%20not%20need%20to%20be%20mutable%22/near/135208534" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2354499.20Invalid.20.22variable.20does.20not.20need.20to.20be.20mutable.22.html#135208534">(Oct 04 2018 at 18:41)</a>:</h4>
<p>couldn't be a part of AST borrowck the one adding to this structure?</p>



<a name="135208923"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2354499%20Invalid%20%22variable%20does%20not%20need%20to%20be%20mutable%22/near/135208923" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2354499.20Invalid.20.22variable.20does.20not.20need.20to.20be.20mutable.22.html#135208923">(Oct 04 2018 at 18:48)</a>:</h4>
<p>not that I know of</p>



<a name="135213534"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2354499%20Invalid%20%22variable%20does%20not%20need%20to%20be%20mutable%22/near/135213534" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2354499.20Invalid.20.22variable.20does.20not.20need.20to.20be.20mutable.22.html#135213534">(Oct 04 2018 at 20:13)</a>:</h4>
<p><span class="user-mention" data-user-id="116266">@Santiago Pastorino</span> so... <span class="user-mention" data-user-id="116083">@pnkfelix</span> and I raised this question with the lang team, and there were a few folks in favor of just ruling out this case altogether as an error (at least until <a href="https://github.com/rust-lang/rust/issues/21232" target="_blank" title="https://github.com/rust-lang/rust/issues/21232">#21232</a> is properly fixed):</p>
<div class="codehilite"><pre><span></span><span class="kd">let</span><span class="w"> </span><span class="k">mut</span><span class="w"> </span><span class="n">x</span>: <span class="p">(</span><span class="kt">u32</span><span class="p">,</span><span class="w"> </span><span class="kt">u32</span><span class="p">);</span><span class="w"></span>
<span class="n">x</span><span class="p">.</span><span class="mi">0</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="p">;</span><span class="w"></span>
</pre></div>


<p>If we did that, then of course the interaction with the "unused mut" lint becomes a moot point... maybe you want to prep a PR to do <em>that</em>, and we can assess the impact? (I wouldn't expect much, given that you get an error if you try to read <code>x.0</code> again.)</p>



<a name="135214209"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2354499%20Invalid%20%22variable%20does%20not%20need%20to%20be%20mutable%22/near/135214209" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2354499.20Invalid.20.22variable.20does.20not.20need.20to.20be.20mutable.22.html#135214209">(Oct 04 2018 at 20:24)</a>:</h4>
<p>ok</p>



<a name="135214211"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2354499%20Invalid%20%22variable%20does%20not%20need%20to%20be%20mutable%22/near/135214211" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2354499.20Invalid.20.22variable.20does.20not.20need.20to.20be.20mutable.22.html#135214211">(Oct 04 2018 at 20:24)</a>:</h4>
<p>so</p>



<a name="135214217"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2354499%20Invalid%20%22variable%20does%20not%20need%20to%20be%20mutable%22/near/135214217" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2354499.20Invalid.20.22variable.20does.20not.20need.20to.20be.20mutable.22.html#135214217">(Oct 04 2018 at 20:24)</a>:</h4>
<p>you meant that in this example <a href="https://github.com/rust-lang/rust/issues/54499" target="_blank" title="https://github.com/rust-lang/rust/issues/54499">https://github.com/rust-lang/rust/issues/54499</a></p>



<a name="135214234"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2354499%20Invalid%20%22variable%20does%20not%20need%20to%20be%20mutable%22/near/135214234" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2354499.20Invalid.20.22variable.20does.20not.20need.20to.20be.20mutable.22.html#135214234">(Oct 04 2018 at 20:25)</a>:</h4>
<p>the original issue was that the warning was suggesting the wrong thing</p>



<a name="135214241"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2354499%20Invalid%20%22variable%20does%20not%20need%20to%20be%20mutable%22/near/135214241" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2354499.20Invalid.20.22variable.20does.20not.20need.20to.20be.20mutable.22.html#135214241">(Oct 04 2018 at 20:25)</a>:</h4>
<p>you meant to stop what I'm doing and convert the warning in an error?</p>



<a name="135214246"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2354499%20Invalid%20%22variable%20does%20not%20need%20to%20be%20mutable%22/near/135214246" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2354499.20Invalid.20.22variable.20does.20not.20need.20to.20be.20mutable.22.html#135214246">(Oct 04 2018 at 20:25)</a>:</h4>
<p>or did I get it wrong?</p>



<a name="135214742"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2354499%20Invalid%20%22variable%20does%20not%20need%20to%20be%20mutable%22/near/135214742" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2354499.20Invalid.20.22variable.20does.20not.20need.20to.20be.20mutable.22.html#135214742">(Oct 04 2018 at 20:34)</a>:</h4>
<p>that's what I was suggesting, yes</p>



<a name="135214750"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2354499%20Invalid%20%22variable%20does%20not%20need%20to%20be%20mutable%22/near/135214750" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2354499.20Invalid.20.22variable.20does.20not.20need.20to.20be.20mutable.22.html#135214750">(Oct 04 2018 at 20:34)</a>:</h4>
<p>that maybe before we invest too much energy into preserving the strange AST behavior</p>



<a name="135214762"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2354499%20Invalid%20%22variable%20does%20not%20need%20to%20be%20mutable%22/near/135214762" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2354499.20Invalid.20.22variable.20does.20not.20need.20to.20be.20mutable.22.html#135214762">(Oct 04 2018 at 20:35)</a>:</h4>
<p>we should consider just making that example an error</p>



<a name="135214765"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2354499%20Invalid%20%22variable%20does%20not%20need%20to%20be%20mutable%22/near/135214765" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2354499.20Invalid.20.22variable.20does.20not.20need.20to.20be.20mutable.22.html#135214765">(Oct 04 2018 at 20:35)</a>:</h4>
<p><em>although</em> the fact that the issue got filed</p>



<a name="135214770"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2354499%20Invalid%20%22variable%20does%20not%20need%20to%20be%20mutable%22/near/135214770" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2354499.20Invalid.20.22variable.20does.20not.20need.20to.20be.20mutable.22.html#135214770">(Oct 04 2018 at 20:35)</a>:</h4>
<p>suggests that <em>somebody</em> is relying on the current behavior...</p>



<a name="135215441"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2354499%20Invalid%20%22variable%20does%20not%20need%20to%20be%20mutable%22/near/135215441" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2354499.20Invalid.20.22variable.20does.20not.20need.20to.20be.20mutable.22.html#135215441">(Oct 04 2018 at 20:47)</a>:</h4>
<p>actually I didn't tell you because I was doing something else already</p>



<a name="135215444"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2354499%20Invalid%20%22variable%20does%20not%20need%20to%20be%20mutable%22/near/135215444" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2354499.20Invalid.20.22variable.20does.20not.20need.20to.20be.20mutable.22.html#135215444">(Oct 04 2018 at 20:47)</a>:</h4>
<p>but I was getting some logs</p>



<a name="135215490"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2354499%20Invalid%20%22variable%20does%20not%20need%20to%20be%20mutable%22/near/135215490" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2354499.20Invalid.20.22variable.20does.20not.20need.20to.20be.20mutable.22.html#135215490">(Oct 04 2018 at 20:48)</a>:</h4>
<p>there was a problem in the command I was running and I didn't see</p>



<a name="135215496"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2354499%20Invalid%20%22variable%20does%20not%20need%20to%20be%20mutable%22/near/135215496" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2354499.20Invalid.20.22variable.20does.20not.20need.20to.20be.20mutable.22.html#135215496">(Oct 04 2018 at 20:48)</a>:</h4>
<p>but yes there's some output :)</p>



<a name="135215522"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2354499%20Invalid%20%22variable%20does%20not%20need%20to%20be%20mutable%22/near/135215522" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2354499.20Invalid.20.22variable.20does.20not.20need.20to.20be.20mutable.22.html#135215522">(Oct 04 2018 at 20:48)</a>:</h4>
<p>so, tell me if you prefer me to stop and forget about this and make an error or just match AST, which I think we should be close to do</p>



<a name="135215553"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2354499%20Invalid%20%22variable%20does%20not%20need%20to%20be%20mutable%22/near/135215553" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2354499.20Invalid.20.22variable.20does.20not.20need.20to.20be.20mutable.22.html#135215553">(Oct 04 2018 at 20:49)</a>:</h4>
<p>or wait until we see what the reporter replies to <a href="https://github.com/rust-lang/rust/issues/54499#issuecomment-427160299" target="_blank" title="https://github.com/rust-lang/rust/issues/54499#issuecomment-427160299">https://github.com/rust-lang/rust/issues/54499#issuecomment-427160299</a></p>



<a name="135215561"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2354499%20Invalid%20%22variable%20does%20not%20need%20to%20be%20mutable%22/near/135215561" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2354499.20Invalid.20.22variable.20does.20not.20need.20to.20be.20mutable.22.html#135215561">(Oct 04 2018 at 20:49)</a>:</h4>
<p>I'm fine with anything :)</p>



<a name="135263177"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2354499%20Invalid%20%22variable%20does%20not%20need%20to%20be%20mutable%22/near/135263177" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2354499.20Invalid.20.22variable.20does.20not.20need.20to.20be.20mutable.22.html#135263177">(Oct 05 2018 at 15:54)</a>:</h4>
<p><span class="user-mention" data-user-id="116009">@nikomatsakis</span> remember to let me know what to do about this :)</p>



<a name="135263884"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2354499%20Invalid%20%22variable%20does%20not%20need%20to%20be%20mutable%22/near/135263884" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2354499.20Invalid.20.22variable.20does.20not.20need.20to.20be.20mutable.22.html#135263884">(Oct 05 2018 at 16:05)</a>:</h4>
<p><span class="user-mention" data-user-id="116266">@Santiago Pastorino</span> well, is <span class="user-mention" data-user-id="116083">@pnkfelix</span> around?</p>



<a name="135263886"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2354499%20Invalid%20%22variable%20does%20not%20need%20to%20be%20mutable%22/near/135263886" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2354499.20Invalid.20.22variable.20does.20not.20need.20to.20be.20mutable.22.html#135263886">(Oct 05 2018 at 16:06)</a>:</h4>
<p>maybe we can all 3 discuss</p>



<a name="135263925"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2354499%20Invalid%20%22variable%20does%20not%20need%20to%20be%20mutable%22/near/135263925" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2354499.20Invalid.20.22variable.20does.20not.20need.20to.20be.20mutable.22.html#135263925">(Oct 05 2018 at 16:06)</a>:</h4>
<p>or did they leave for the day</p>



<a name="135263940"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2354499%20Invalid%20%22variable%20does%20not%20need%20to%20be%20mutable%22/near/135263940" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2354499.20Invalid.20.22variable.20does.20not.20need.20to.20be.20mutable.22.html#135263940">(Oct 05 2018 at 16:06)</a>:</h4>
<p>/me grumbles about lazy europeans and their 9 to 10 hour days</p>



<a name="135264070"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2354499%20Invalid%20%22variable%20does%20not%20need%20to%20be%20mutable%22/near/135264070" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2354499.20Invalid.20.22variable.20does.20not.20need.20to.20be.20mutable.22.html#135264070">(Oct 05 2018 at 16:09)</a>:</h4>
<p>:P</p>



<a name="135264077"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2354499%20Invalid%20%22variable%20does%20not%20need%20to%20be%20mutable%22/near/135264077" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2354499.20Invalid.20.22variable.20does.20not.20need.20to.20be.20mutable.22.html#135264077">(Oct 05 2018 at 16:09)</a>:</h4>
<p>OK well I see three options:</p>
<ul>
<li>Fix the <code>unused_mut</code> lint</li>
<li>Make <code>a.b.c = x</code> an error if <code>a</code> is not initialized</li>
<li>Fix the semantics to work 100%</li>
</ul>
<p>I think that option 3 doesn't make sense in the <em>short term</em>; we'd be better off landing one of the first two and then revisiting the semantics at our leisure.</p>
<p>Option 2 is a "breaking change", in the sense that the old AST borrow checker accepted such code. However, it <em>was</em> fairly useless -- even <em>if</em> <code>a</code> is declared <code>mut</code>, you could assign to such a path, but you couldn't read back from it. This is confusing at best. It is unlikely that a significant body of code is relying on this, and we could just call it an NLL bug fix — initially, anyway, you'll just get warnings, since any new errors that result from NLL (but not the AST checker) are always displayed as warnings during the migration period.</p>
<p>Option 1 is what we had been pursuing, but it seems kind of like an annoying amount of work to reach a "not particularly consistent" state.</p>



<a name="135264078"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2354499%20Invalid%20%22variable%20does%20not%20need%20to%20be%20mutable%22/near/135264078" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2354499.20Invalid.20.22variable.20does.20not.20need.20to.20be.20mutable.22.html#135264078">(Oct 05 2018 at 16:09)</a>:</h4>
<p>I am inclined towards Option 2 right now</p>



<a name="135264173"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2354499%20Invalid%20%22variable%20does%20not%20need%20to%20be%20mutable%22/near/135264173" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2354499.20Invalid.20.22variable.20does.20not.20need.20to.20be.20mutable.22.html#135264173">(Oct 05 2018 at 16:11)</a>:</h4>
<p>ok</p>



<a name="135264180"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2354499%20Invalid%20%22variable%20does%20not%20need%20to%20be%20mutable%22/near/135264180" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2354499.20Invalid.20.22variable.20does.20not.20need.20to.20be.20mutable.22.html#135264180">(Oct 05 2018 at 16:11)</a>:</h4>
<p>let's make that an error</p>



<a name="135264209"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2354499%20Invalid%20%22variable%20does%20not%20need%20to%20be%20mutable%22/near/135264209" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2354499.20Invalid.20.22variable.20does.20not.20need.20to.20be.20mutable.22.html#135264209">(Oct 05 2018 at 16:11)</a>:</h4>
<p>we can also do a crater run to see what happens, though that's a bit .. tricky</p>



<a name="135264250"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2354499%20Invalid%20%22variable%20does%20not%20need%20to%20be%20mutable%22/near/135264250" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2354499.20Invalid.20.22variable.20does.20not.20need.20to.20be.20mutable.22.html#135264250">(Oct 05 2018 at 16:12)</a>:</h4>
<p>because we'd have to do it with NLL enabled, which means we'll see other errors too</p>



<a name="135264254"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2354499%20Invalid%20%22variable%20does%20not%20need%20to%20be%20mutable%22/near/135264254" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2354499.20Invalid.20.22variable.20does.20not.20need.20to.20be.20mutable.22.html#135264254">(Oct 05 2018 at 16:12)</a>:</h4>
<p>so I am kind of inclined not to bother, personally</p>



<a name="135264257"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2354499%20Invalid%20%22variable%20does%20not%20need%20to%20be%20mutable%22/near/135264257" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2354499.20Invalid.20.22variable.20does.20not.20need.20to.20be.20mutable.22.html#135264257">(Oct 05 2018 at 16:12)</a>:</h4>
<p>esp. given the migration mode</p>



<a name="135264291"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2354499%20Invalid%20%22variable%20does%20not%20need%20to%20be%20mutable%22/near/135264291" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2354499.20Invalid.20.22variable.20does.20not.20need.20to.20be.20mutable.22.html#135264291">(Oct 05 2018 at 16:13)</a>:</h4>
<p><span class="emoji emoji-1f44d" title="+1">:+1:</span></p>



<a name="135264508"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2354499%20Invalid%20%22variable%20does%20not%20need%20to%20be%20mutable%22/near/135264508" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> pnkfelix <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2354499.20Invalid.20.22variable.20does.20not.20need.20to.20be.20mutable.22.html#135264508">(Oct 05 2018 at 16:17)</a>:</h4>
<p>Yeah sorry I’m done for the day for now</p>



<a name="135264517"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2354499%20Invalid%20%22variable%20does%20not%20need%20to%20be%20mutable%22/near/135264517" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> pnkfelix <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2354499.20Invalid.20.22variable.20does.20not.20need.20to.20be.20mutable.22.html#135264517">(Oct 05 2018 at 16:17)</a>:</h4>
<p>Going to a water park soonish</p>



<a name="135264532"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2354499%20Invalid%20%22variable%20does%20not%20need%20to%20be%20mutable%22/near/135264532" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> pnkfelix <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2354499.20Invalid.20.22variable.20does.20not.20need.20to.20be.20mutable.22.html#135264532">(Oct 05 2018 at 16:17)</a>:</h4>
<p>Maybe will work more after I get back from waterskiding</p>



<a name="135419880"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2354499%20Invalid%20%22variable%20does%20not%20need%20to%20be%20mutable%22/near/135419880" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2354499.20Invalid.20.22variable.20does.20not.20need.20to.20be.20mutable.22.html#135419880">(Oct 08 2018 at 18:17)</a>:</h4>
<p><span class="user-mention" data-user-id="116009">@nikomatsakis</span> have you seen <a href="https://github.com/rust-lang/rust/issues/54499#issuecomment-427406207" target="_blank" title="https://github.com/rust-lang/rust/issues/54499#issuecomment-427406207">https://github.com/rust-lang/rust/issues/54499#issuecomment-427406207</a> ?</p>



<a name="135422142"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2354499%20Invalid%20%22variable%20does%20not%20need%20to%20be%20mutable%22/near/135422142" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2354499.20Invalid.20.22variable.20does.20not.20need.20to.20be.20mutable.22.html#135422142">(Oct 08 2018 at 19:03)</a>:</h4>
<p>there's no real use case</p>



<a name="135422146"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2354499%20Invalid%20%22variable%20does%20not%20need%20to%20be%20mutable%22/near/135422146" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2354499.20Invalid.20.22variable.20does.20not.20need.20to.20be.20mutable.22.html#135422146">(Oct 08 2018 at 19:03)</a>:</h4>
<p>anyway, I'm going to make this fail</p>



<a name="135422204"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2354499%20Invalid%20%22variable%20does%20not%20need%20to%20be%20mutable%22/near/135422204" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2354499.20Invalid.20.22variable.20does.20not.20need.20to.20be.20mutable.22.html#135422204">(Oct 08 2018 at 19:04)</a>:</h4>
<p>I wonder if we should lay out the code in the way we were doing and handle that case when root_place is local and accessed_place is projection or we want to use the old version of the code?</p>



<a name="135422309"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2354499%20Invalid%20%22variable%20does%20not%20need%20to%20be%20mutable%22/near/135422309" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2354499.20Invalid.20.22variable.20does.20not.20need.20to.20be.20mutable.22.html#135422309">(Oct 08 2018 at 19:07)</a>:</h4>
<p>also what's exactly ever_inits in Flows?</p>



<a name="135422315"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2354499%20Invalid%20%22variable%20does%20not%20need%20to%20be%20mutable%22/near/135422315" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2354499.20Invalid.20.22variable.20does.20not.20need.20to.20be.20mutable.22.html#135422315">(Oct 08 2018 at 19:07)</a>:</h4>
<p>I guess I need to check for uninits?</p>



<a name="135422317"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2354499%20Invalid%20%22variable%20does%20not%20need%20to%20be%20mutable%22/near/135422317" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2354499.20Invalid.20.22variable.20does.20not.20need.20to.20be.20mutable.22.html#135422317">(Oct 08 2018 at 19:07)</a>:</h4>
<p>in order to fail</p>



<a name="135422640"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2354499%20Invalid%20%22variable%20does%20not%20need%20to%20be%20mutable%22/near/135422640" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2354499.20Invalid.20.22variable.20does.20not.20need.20to.20be.20mutable.22.html#135422640">(Oct 08 2018 at 19:14)</a>:</h4>
<p>hmmm maybe the best thing is to check here if we are in the case we should warn or fail <a href="https://github.com/rust-lang/rust/blob/master/src/librustc_mir/borrow_check/mod.rs#L324-L337" target="_blank" title="https://github.com/rust-lang/rust/blob/master/src/librustc_mir/borrow_check/mod.rs#L324-L337">https://github.com/rust-lang/rust/blob/master/src/librustc_mir/borrow_check/mod.rs#L324-L337</a></p>



<a name="135422794"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2354499%20Invalid%20%22variable%20does%20not%20need%20to%20be%20mutable%22/near/135422794" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2354499.20Invalid.20.22variable.20does.20not.20need.20to.20be.20mutable.22.html#135422794">(Oct 08 2018 at 19:18)</a>:</h4>
<p>hmm I guess at that point I have no idea what was accessed anymore</p>



<a name="135422804"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2354499%20Invalid%20%22variable%20does%20not%20need%20to%20be%20mutable%22/near/135422804" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2354499.20Invalid.20.22variable.20does.20not.20need.20to.20be.20mutable.22.html#135422804">(Oct 08 2018 at 19:18)</a>:</h4>
<p>investigating, <span class="user-mention" data-user-id="116009">@nikomatsakis</span> if you have any pointer would be appreciated :)</p>



<a name="135423202"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2354499%20Invalid%20%22variable%20does%20not%20need%20to%20be%20mutable%22/near/135423202" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2354499.20Invalid.20.22variable.20does.20not.20need.20to.20be.20mutable.22.html#135423202">(Oct 08 2018 at 19:28)</a>:</h4>
<p>I'm thinking about something like ...</p>



<a name="135423206"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2354499%20Invalid%20%22variable%20does%20not%20need%20to%20be%20mutable%22/near/135423206" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2354499.20Invalid.20.22variable.20does.20not.20need.20to.20be.20mutable.22.html#135423206">(Oct 08 2018 at 19:28)</a>:</h4>
<div class="codehilite"><pre><span></span><span class="w">                    </span><span class="nb">Ok</span><span class="p">(</span><span class="n">root_place</span><span class="p">)</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">                        </span><span class="k">if</span><span class="w"> </span><span class="kd">let</span><span class="w"> </span><span class="n">Place</span>::<span class="n">Projection</span><span class="p">(</span><span class="n">_</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">root_place</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">                            </span><span class="k">if</span><span class="w"> </span><span class="kd">let</span><span class="w"> </span><span class="n">Place</span>::<span class="n">Local</span><span class="p">(</span><span class="n">local</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">place</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">                                </span><span class="kd">let</span><span class="w"> </span><span class="n">mpi</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="bp">self</span><span class="p">.</span><span class="n">move_data</span><span class="p">.</span><span class="n">rev_lookup</span><span class="p">.</span><span class="n">find_local</span><span class="p">(</span><span class="o">*</span><span class="n">local</span><span class="p">);</span><span class="w"></span>
<span class="w">                                </span><span class="k">if</span><span class="w"> </span><span class="n">flow_state</span><span class="p">.</span><span class="n">uninits</span><span class="p">.</span><span class="n">contains</span><span class="p">(</span><span class="n">mpi</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">                                    </span><span class="c1">// report error</span>
<span class="w">                                    </span><span class="k">return</span><span class="w"> </span><span class="kc">true</span><span class="p">;</span><span class="w"></span>
<span class="w">                                </span><span class="p">}</span><span class="w"></span>
<span class="w">                            </span><span class="p">}</span><span class="w"></span>
<span class="w">                        </span><span class="p">}</span><span class="w"></span>

<span class="w">                        </span><span class="bp">self</span><span class="p">.</span><span class="n">add_used_mut</span><span class="p">(</span><span class="n">place</span><span class="p">,</span><span class="w"> </span><span class="n">root_place</span><span class="p">,</span><span class="w"> </span><span class="n">flow_state</span><span class="p">);</span><span class="w"></span>
<span class="w">                        </span><span class="k">return</span><span class="w"> </span><span class="kc">false</span><span class="p">;</span><span class="w"></span>
<span class="w">                    </span><span class="p">}</span><span class="w"></span>
</pre></div>



<a name="135423818"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2354499%20Invalid%20%22variable%20does%20not%20need%20to%20be%20mutable%22/near/135423818" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2354499.20Invalid.20.22variable.20does.20not.20need.20to.20be.20mutable.22.html#135423818">(Oct 08 2018 at 19:39)</a>:</h4>
<p><span class="user-mention" data-user-id="116266">@Santiago Pastorino</span> where would this diff go?</p>



<a name="135424115"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2354499%20Invalid%20%22variable%20does%20not%20need%20to%20be%20mutable%22/near/135424115" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2354499.20Invalid.20.22variable.20does.20not.20need.20to.20be.20mutable.22.html#135424115">(Oct 08 2018 at 19:44)</a>:</h4>
<p>where we are calling add_used_mut</p>



<a name="135424144"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2354499%20Invalid%20%22variable%20does%20not%20need%20to%20be%20mutable%22/near/135424144" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2354499.20Invalid.20.22variable.20does.20not.20need.20to.20be.20mutable.22.html#135424144">(Oct 08 2018 at 19:45)</a>:</h4>
<p>I would move this logic earlier</p>



<a name="135424217"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2354499%20Invalid%20%22variable%20does%20not%20need%20to%20be%20mutable%22/near/135424217" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2354499.20Invalid.20.22variable.20does.20not.20need.20to.20be.20mutable.22.html#135424217">(Oct 08 2018 at 19:46)</a>:</h4>
<p>maybe <a href="https://github.com/rust-lang/rust/blob/423d8109868c1f926f2cfcc3bff980c3daa515fd/src/librustc_mir/borrow_check/mod.rs#L489-L504" target="_blank" title="https://github.com/rust-lang/rust/blob/423d8109868c1f926f2cfcc3bff980c3daa515fd/src/librustc_mir/borrow_check/mod.rs#L489-L504">somewhere around here</a></p>



<a name="135424225"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2354499%20Invalid%20%22variable%20does%20not%20need%20to%20be%20mutable%22/near/135424225" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2354499.20Invalid.20.22variable.20does.20not.20need.20to.20be.20mutable.22.html#135424225">(Oct 08 2018 at 19:46)</a>:</h4>
<p>basically in place of <a href="https://github.com/rust-lang/rust/blob/423d8109868c1f926f2cfcc3bff980c3daa515fd/src/librustc_mir/borrow_check/mod.rs#L1099-L1113" target="_blank" title="https://github.com/rust-lang/rust/blob/423d8109868c1f926f2cfcc3bff980c3daa515fd/src/librustc_mir/borrow_check/mod.rs#L1099-L1113">this logic</a></p>



<a name="135424236"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2354499%20Invalid%20%22variable%20does%20not%20need%20to%20be%20mutable%22/near/135424236" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2354499.20Invalid.20.22variable.20does.20not.20need.20to.20be.20mutable.22.html#135424236">(Oct 08 2018 at 19:46)</a>:</h4>
<p>hmm</p>



<a name="135424239"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2354499%20Invalid%20%22variable%20does%20not%20need%20to%20be%20mutable%22/near/135424239" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2354499.20Invalid.20.22variable.20does.20not.20need.20to.20be.20mutable.22.html#135424239">(Oct 08 2018 at 19:46)</a>:</h4>
<p>not sure if I what I just said makes sense :)</p>



<a name="135424258"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2354499%20Invalid%20%22variable%20does%20not%20need%20to%20be%20mutable%22/near/135424258" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2354499.20Invalid.20.22variable.20does.20not.20need.20to.20be.20mutable.22.html#135424258">(Oct 08 2018 at 19:47)</a>:</h4>
<p>well, maybe it does</p>



<a name="135424263"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2354499%20Invalid%20%22variable%20does%20not%20need%20to%20be%20mutable%22/near/135424263" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2354499.20Invalid.20.22variable.20does.20not.20need.20to.20be.20mutable.22.html#135424263">(Oct 08 2018 at 19:47)</a>:</h4>
<p>we basically want to say that: if you are assigning to some projection rooted in a local variable <code>x</code></p>



<a name="135424265"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2354499%20Invalid%20%22variable%20does%20not%20need%20to%20be%20mutable%22/near/135424265" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2354499.20Invalid.20.22variable.20does.20not.20need.20to.20be.20mutable.22.html#135424265">(Oct 08 2018 at 19:47)</a>:</h4>
<p>then <code>x</code> must be initialized or else you get an error</p>



<a name="135424274"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2354499%20Invalid%20%22variable%20does%20not%20need%20to%20be%20mutable%22/near/135424274" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2354499.20Invalid.20.22variable.20does.20not.20need.20to.20be.20mutable.22.html#135424274">(Oct 08 2018 at 19:47)</a>:</h4>
<p>though I guess we'll also have to tweak the used-mut set still</p>



<a name="135424347"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2354499%20Invalid%20%22variable%20does%20not%20need%20to%20be%20mutable%22/near/135424347" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2354499.20Invalid.20.22variable.20does.20not.20need.20to.20be.20mutable.22.html#135424347">(Oct 08 2018 at 19:49)</a>:</h4>
<p>will be back in a bit</p>



<a name="135424364"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2354499%20Invalid%20%22variable%20does%20not%20need%20to%20be%20mutable%22/near/135424364" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2354499.20Invalid.20.22variable.20does.20not.20need.20to.20be.20mutable.22.html#135424364">(Oct 08 2018 at 19:49)</a>:</h4>
<p>needed to close Firefox meanwhile I’m compiling librustc</p>



<a name="135424383"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2354499%20Invalid%20%22variable%20does%20not%20need%20to%20be%20mutable%22/near/135424383" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2354499.20Invalid.20.22variable.20does.20not.20need.20to.20be.20mutable.22.html#135424383">(Oct 08 2018 at 19:49)</a>:</h4>
<p>that part uses massive amounts of memory I think and crashes unless I close things</p>



<a name="135424391"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2354499%20Invalid%20%22variable%20does%20not%20need%20to%20be%20mutable%22/near/135424391" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2354499.20Invalid.20.22variable.20does.20not.20need.20to.20be.20mutable.22.html#135424391">(Oct 08 2018 at 19:49)</a>:</h4>
<p>on the cellphone meanwhile</p>



<a name="135424458"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2354499%20Invalid%20%22variable%20does%20not%20need%20to%20be%20mutable%22/near/135424458" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2354499.20Invalid.20.22variable.20does.20not.20need.20to.20be.20mutable.22.html#135424458">(Oct 08 2018 at 19:50)</a>:</h4>
<p>oh dear :)</p>



<a name="135424463"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2354499%20Invalid%20%22variable%20does%20not%20need%20to%20be%20mutable%22/near/135424463" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2354499.20Invalid.20.22variable.20does.20not.20need.20to.20be.20mutable.22.html#135424463">(Oct 08 2018 at 19:50)</a>:</h4>
<p>well, anyway, I think what I showed earlier is the right place to issue the error</p>



<a name="135424470"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2354499%20Invalid%20%22variable%20does%20not%20need%20to%20be%20mutable%22/near/135424470" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2354499.20Invalid.20.22variable.20does.20not.20need.20to.20be.20mutable.22.html#135424470">(Oct 08 2018 at 19:50)</a>:</h4>
<p>not sure what we would need around the "used mut" logic</p>



<a name="135424476"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2354499%20Invalid%20%22variable%20does%20not%20need%20to%20be%20mutable%22/near/135424476" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2354499.20Invalid.20.22variable.20does.20not.20need.20to.20be.20mutable.22.html#135424476">(Oct 08 2018 at 19:50)</a>:</h4>
<p>if any</p>



<a name="135424659"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2354499%20Invalid%20%22variable%20does%20not%20need%20to%20be%20mutable%22/near/135424659" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2354499.20Invalid.20.22variable.20does.20not.20need.20to.20be.20mutable.22.html#135424659">(Oct 08 2018 at 19:55)</a>:</h4>
<p>back</p>



<a name="135424666"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2354499%20Invalid%20%22variable%20does%20not%20need%20to%20be%20mutable%22/near/135424666" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2354499.20Invalid.20.22variable.20does.20not.20need.20to.20be.20mutable.22.html#135424666">(Oct 08 2018 at 19:55)</a>:</h4>
<p>why did you say instead of that logic?</p>



<a name="135424668"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2354499%20Invalid%20%22variable%20does%20not%20need%20to%20be%20mutable%22/near/135424668" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2354499.20Invalid.20.22variable.20does.20not.20need.20to.20be.20mutable.22.html#135424668">(Oct 08 2018 at 19:55)</a>:</h4>
<p>why that would need to be removed?</p>



<a name="135424674"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2354499%20Invalid%20%22variable%20does%20not%20need%20to%20be%20mutable%22/near/135424674" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2354499.20Invalid.20.22variable.20does.20not.20need.20to.20be.20mutable.22.html#135424674">(Oct 08 2018 at 19:56)</a>:</h4>
<p>and also why the used-mut set needs to be tweaked?</p>



<a name="135424709"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2354499%20Invalid%20%22variable%20does%20not%20need%20to%20be%20mutable%22/near/135424709" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2354499.20Invalid.20.22variable.20does.20not.20need.20to.20be.20mutable.22.html#135424709">(Oct 08 2018 at 19:56)</a>:</h4>
<p>I was wrong to say that actually</p>



<a name="135424714"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2354499%20Invalid%20%22variable%20does%20not%20need%20to%20be%20mutable%22/near/135424714" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2354499.20Invalid.20.22variable.20does.20not.20need.20to.20be.20mutable.22.html#135424714">(Oct 08 2018 at 19:56)</a>:</h4>
<p>ahh ok</p>



<a name="135424715"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2354499%20Invalid%20%22variable%20does%20not%20need%20to%20be%20mutable%22/near/135424715" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2354499.20Invalid.20.22variable.20does.20not.20need.20to.20be.20mutable.22.html#135424715">(Oct 08 2018 at 19:56)</a>:</h4>
<p>the existing logic is handling the case <code>a = ...</code></p>



<a name="135424716"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2354499%20Invalid%20%22variable%20does%20not%20need%20to%20be%20mutable%22/near/135424716" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2354499.20Invalid.20.22variable.20does.20not.20need.20to.20be.20mutable.22.html#135424716">(Oct 08 2018 at 19:56)</a>:</h4>
<p>we need to place it there :)</p>



<a name="135424717"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2354499%20Invalid%20%22variable%20does%20not%20need%20to%20be%20mutable%22/near/135424717" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2354499.20Invalid.20.22variable.20does.20not.20need.20to.20be.20mutable.22.html#135424717">(Oct 08 2018 at 19:56)</a>:</h4>
<p>yes</p>



<a name="135424718"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2354499%20Invalid%20%22variable%20does%20not%20need%20to%20be%20mutable%22/near/135424718" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2354499.20Invalid.20.22variable.20does.20not.20need.20to.20be.20mutable.22.html#135424718">(Oct 08 2018 at 19:56)</a>:</h4>
<p>but we are interested in the case of a more complex path</p>



<a name="135424719"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2354499%20Invalid%20%22variable%20does%20not%20need%20to%20be%20mutable%22/near/135424719" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2354499.20Invalid.20.22variable.20does.20not.20need.20to.20be.20mutable.22.html#135424719">(Oct 08 2018 at 19:56)</a>:</h4>
<p>but next to that</p>



<a name="135424720"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2354499%20Invalid%20%22variable%20does%20not%20need%20to%20be%20mutable%22/near/135424720" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2354499.20Invalid.20.22variable.20does.20not.20need.20to.20be.20mutable.22.html#135424720">(Oct 08 2018 at 19:56)</a>:</h4>
<p>right</p>



<a name="135424724"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2354499%20Invalid%20%22variable%20does%20not%20need%20to%20be%20mutable%22/near/135424724" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2354499.20Invalid.20.22variable.20does.20not.20need.20to.20be.20mutable.22.html#135424724">(Oct 08 2018 at 19:56)</a>:</h4>
<p>it's kind of a "first check"</p>



<a name="135424726"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2354499%20Invalid%20%22variable%20does%20not%20need%20to%20be%20mutable%22/near/135424726" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2354499.20Invalid.20.22variable.20does.20not.20need.20to.20be.20mutable.22.html#135424726">(Oct 08 2018 at 19:56)</a>:</h4>
<p>anyway, re: the used mut thing, I'm not sure if it's relevant,</p>



<a name="135424728"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2354499%20Invalid%20%22variable%20does%20not%20need%20to%20be%20mutable%22/near/135424728" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2354499.20Invalid.20.22variable.20does.20not.20need.20to.20be.20mutable.22.html#135424728">(Oct 08 2018 at 19:56)</a>:</h4>
<p>ok</p>



<a name="135424746"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2354499%20Invalid%20%22variable%20does%20not%20need%20to%20be%20mutable%22/near/135424746" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2354499.20Invalid.20.22variable.20does.20not.20need.20to.20be.20mutable.22.html#135424746">(Oct 08 2018 at 19:57)</a>:</h4>
<p>I guess the question is:</p>
<div class="codehilite"><pre><span></span><span class="kd">let</span><span class="w"> </span><span class="k">mut</span><span class="w"> </span><span class="n">x</span>: <span class="p">(</span><span class="kt">u32</span><span class="p">,</span><span class="w"> </span><span class="kt">u32</span><span class="p">);</span><span class="w"></span>
<span class="n">x</span><span class="p">.</span><span class="mi">0</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="p">;</span><span class="w"></span>
</pre></div>


<p>if we do nothing, this will get an error, and then we'll <em>also</em> (I think) warn that the <code>mut</code> flag on <code>x</code> is unused</p>



<a name="135424747"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2354499%20Invalid%20%22variable%20does%20not%20need%20to%20be%20mutable%22/near/135424747" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2354499.20Invalid.20.22variable.20does.20not.20need.20to.20be.20mutable.22.html#135424747">(Oct 08 2018 at 19:57)</a>:</h4>
<p>which seems wrong</p>



<a name="135424756"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2354499%20Invalid%20%22variable%20does%20not%20need%20to%20be%20mutable%22/near/135424756" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2354499.20Invalid.20.22variable.20does.20not.20need.20to.20be.20mutable.22.html#135424756">(Oct 08 2018 at 19:57)</a>:</h4>
<p><span class="emoji emoji-1f44d" title="+1">:+1:</span></p>



<a name="135424757"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2354499%20Invalid%20%22variable%20does%20not%20need%20to%20be%20mutable%22/near/135424757" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2354499.20Invalid.20.22variable.20does.20not.20need.20to.20be.20mutable.22.html#135424757">(Oct 08 2018 at 19:57)</a>:</h4>
<p>we could probably do just throw the base variable into the set of "used muts"</p>



<a name="135424761"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2354499%20Invalid%20%22variable%20does%20not%20need%20to%20be%20mutable%22/near/135424761" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2354499.20Invalid.20.22variable.20does.20not.20need.20to.20be.20mutable.22.html#135424761">(Oct 08 2018 at 19:57)</a>:</h4>
<p>indiscriminantely</p>



<a name="135424762"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2354499%20Invalid%20%22variable%20does%20not%20need%20to%20be%20mutable%22/near/135424762" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2354499.20Invalid.20.22variable.20does.20not.20need.20to.20be.20mutable.22.html#135424762">(Oct 08 2018 at 19:57)</a>:</h4>
<p>just to suppress the lint</p>



<a name="135424806"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2354499%20Invalid%20%22variable%20does%20not%20need%20to%20be%20mutable%22/near/135424806" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2354499.20Invalid.20.22variable.20does.20not.20need.20to.20be.20mutable.22.html#135424806">(Oct 08 2018 at 19:58)</a>:</h4>
<p>let me try all these stuff out</p>



<a name="135424812"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2354499%20Invalid%20%22variable%20does%20not%20need%20to%20be%20mutable%22/near/135424812" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2354499.20Invalid.20.22variable.20does.20not.20need.20to.20be.20mutable.22.html#135424812">(Oct 08 2018 at 19:58)</a>:</h4>
<p>btw: is there a report or something about librustc memory usage or something?</p>



<a name="135424819"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2354499%20Invalid%20%22variable%20does%20not%20need%20to%20be%20mutable%22/near/135424819" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2354499.20Invalid.20.22variable.20does.20not.20need.20to.20be.20mutable.22.html#135424819">(Oct 08 2018 at 19:58)</a>:</h4>
<p>is it a concern? maybe is not a priority</p>



<a name="135424825"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2354499%20Invalid%20%22variable%20does%20not%20need%20to%20be%20mutable%22/near/135424825" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2354499.20Invalid.20.22variable.20does.20not.20need.20to.20be.20mutable.22.html#135424825">(Oct 08 2018 at 19:58)</a>:</h4>
<p>it gives me a lot of headaches :)</p>



<a name="135424849"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2354499%20Invalid%20%22variable%20does%20not%20need%20to%20be%20mutable%22/near/135424849" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2354499.20Invalid.20.22variable.20does.20not.20need.20to.20be.20mutable.22.html#135424849">(Oct 08 2018 at 19:59)</a>:</h4>
<blockquote>
<p>btw: is there a report or something about librustc memory usage or something?</p>
</blockquote>
<p>like, memory usage when building librustc?</p>



<a name="135424851"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2354499%20Invalid%20%22variable%20does%20not%20need%20to%20be%20mutable%22/near/135424851" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2354499.20Invalid.20.22variable.20does.20not.20need.20to.20be.20mutable.22.html#135424851">(Oct 08 2018 at 19:59)</a>:</h4>
<p>I may need to tweak better my swap or something</p>



<a name="135424853"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2354499%20Invalid%20%22variable%20does%20not%20need%20to%20be%20mutable%22/near/135424853" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2354499.20Invalid.20.22variable.20does.20not.20need.20to.20be.20mutable.22.html#135424853">(Oct 08 2018 at 19:59)</a>:</h4>
<p>I'm not sure if there are any bug reports or not</p>



<a name="135424858"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2354499%20Invalid%20%22variable%20does%20not%20need%20to%20be%20mutable%22/near/135424858" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2354499.20Invalid.20.22variable.20does.20not.20need.20to.20be.20mutable.22.html#135424858">(Oct 08 2018 at 19:59)</a>:</h4>
<blockquote>
<blockquote>
<p>btw: is there a report or something about librustc memory usage or something?</p>
</blockquote>
<p>like, memory usage when building librustc?</p>
</blockquote>
<p>yes</p>



<a name="135424861"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2354499%20Invalid%20%22variable%20does%20not%20need%20to%20be%20mutable%22/near/135424861" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2354499.20Invalid.20.22variable.20does.20not.20need.20to.20be.20mutable.22.html#135424861">(Oct 08 2018 at 19:59)</a>:</h4>
<p>might be good to take a look and see if it can be improved</p>



<a name="135424868"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2354499%20Invalid%20%22variable%20does%20not%20need%20to%20be%20mutable%22/near/135424868" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2354499.20Invalid.20.22variable.20does.20not.20need.20to.20be.20mutable.22.html#135424868">(Oct 08 2018 at 19:59)</a>:</h4>
<p>can't be helping bootstrap times</p>



<a name="135424931"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2354499%20Invalid%20%22variable%20does%20not%20need%20to%20be%20mutable%22/near/135424931" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2354499.20Invalid.20.22variable.20does.20not.20need.20to.20be.20mutable.22.html#135424931">(Oct 08 2018 at 20:00)</a>:</h4>
<blockquote>
<p>can't be helping bootstrap times</p>
</blockquote>
<p>unsure what's the meaning of this phrase</p>



<a name="135425180"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2354499%20Invalid%20%22variable%20does%20not%20need%20to%20be%20mutable%22/near/135425180" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2354499.20Invalid.20.22variable.20does.20not.20need.20to.20be.20mutable.22.html#135425180">(Oct 08 2018 at 20:06)</a>:</h4>
<p>I mean "it must be making bootstrap slower than it would otherwise be"</p>



<a name="135425231"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2354499%20Invalid%20%22variable%20does%20not%20need%20to%20be%20mutable%22/near/135425231" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2354499.20Invalid.20.22variable.20does.20not.20need.20to.20be.20mutable.22.html#135425231">(Oct 08 2018 at 20:06)</a>:</h4>
<p>in other words, even if it's not a big blocker — e.g., I have a lot of RAM :P — it still makes things slow</p>



<a name="135425235"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2354499%20Invalid%20%22variable%20does%20not%20need%20to%20be%20mutable%22/near/135425235" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2354499.20Invalid.20.22variable.20does.20not.20need.20to.20be.20mutable.22.html#135425235">(Oct 08 2018 at 20:06)</a>:</h4>
<p>hehe yeah</p>



<a name="135425487"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2354499%20Invalid%20%22variable%20does%20not%20need%20to%20be%20mutable%22/near/135425487" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2354499.20Invalid.20.22variable.20does.20not.20need.20to.20be.20mutable.22.html#135425487">(Oct 08 2018 at 20:11)</a>:</h4>
<p>I need to pass root_place to mutate_place</p>



<a name="135425527"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2354499%20Invalid%20%22variable%20does%20not%20need%20to%20be%20mutable%22/near/135425527" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2354499.20Invalid.20.22variable.20does.20not.20need.20to.20be.20mutable.22.html#135425527">(Oct 08 2018 at 20:12)</a>:</h4>
<p>which doesn't seem to be correct</p>



<a name="135425533"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2354499%20Invalid%20%22variable%20does%20not%20need%20to%20be%20mutable%22/near/135425533" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2354499.20Invalid.20.22variable.20does.20not.20need.20to.20be.20mutable.22.html#135425533">(Oct 08 2018 at 20:12)</a>:</h4>
<p>can I get it from place or something?</p>



<a name="135425636"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2354499%20Invalid%20%22variable%20does%20not%20need%20to%20be%20mutable%22/near/135425636" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2354499.20Invalid.20.22variable.20does.20not.20need.20to.20be.20mutable.22.html#135425636">(Oct 08 2018 at 20:14)</a>:</h4>
<p>I guess I can call the same is_mutable thing</p>



<a name="135425645"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2354499%20Invalid%20%22variable%20does%20not%20need%20to%20be%20mutable%22/near/135425645" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2354499.20Invalid.20.22variable.20does.20not.20need.20to.20be.20mutable.22.html#135425645">(Oct 08 2018 at 20:14)</a>:</h4>
<p>unsure if I have the is_local_mutation_allowed thing neither</p>



<a name="135425812"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2354499%20Invalid%20%22variable%20does%20not%20need%20to%20be%20mutable%22/near/135425812" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2354499.20Invalid.20.22variable.20does.20not.20need.20to.20be.20mutable.22.html#135425812">(Oct 08 2018 at 20:18)</a>:</h4>
<blockquote>
<p>I need to pass root_place to mutate_place</p>
</blockquote>
<p>what is <code>root_place</code>?</p>



<a name="135425817"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2354499%20Invalid%20%22variable%20does%20not%20need%20to%20be%20mutable%22/near/135425817" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2354499.20Invalid.20.22variable.20does.20not.20need.20to.20be.20mutable.22.html#135425817">(Oct 08 2018 at 20:18)</a>:</h4>
<p>what type?</p>



<a name="135425823"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2354499%20Invalid%20%22variable%20does%20not%20need%20to%20be%20mutable%22/near/135425823" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2354499.20Invalid.20.22variable.20does.20not.20need.20to.20be.20mutable.22.html#135425823">(Oct 08 2018 at 20:18)</a>:</h4>
<p>no, what .. value is it?</p>



<a name="135425834"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2354499%20Invalid%20%22variable%20does%20not%20need%20to%20be%20mutable%22/near/135425834" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2354499.20Invalid.20.22variable.20does.20not.20need.20to.20be.20mutable.22.html#135425834">(Oct 08 2018 at 20:19)</a>:</h4>
<p>looking at <a href="https://github.com/rust-lang/rust/blob/423d8109868c1f926f2cfcc3bff980c3daa515fd/src/librustc_mir/borrow_check/mod.rs#L1099-L1113" target="_blank" title="https://github.com/rust-lang/rust/blob/423d8109868c1f926f2cfcc3bff980c3daa515fd/src/librustc_mir/borrow_check/mod.rs#L1099-L1113">this fn</a>, I dont' see anything called <code>root_place</code></p>



<a name="135425845"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2354499%20Invalid%20%22variable%20does%20not%20need%20to%20be%20mutable%22/near/135425845" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2354499.20Invalid.20.22variable.20does.20not.20need.20to.20be.20mutable.22.html#135425845">(Oct 08 2018 at 20:19)</a>:</h4>
<p>yeah, I mean, I need it for my logic</p>



<a name="135425849"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2354499%20Invalid%20%22variable%20does%20not%20need%20to%20be%20mutable%22/near/135425849" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2354499.20Invalid.20.22variable.20does.20not.20need.20to.20be.20mutable.22.html#135425849">(Oct 08 2018 at 20:19)</a>:</h4>
<div class="codehilite"><pre><span></span><span class="w">                </span><span class="k">if</span><span class="w"> </span><span class="kd">let</span><span class="w"> </span><span class="n">Place</span>::<span class="n">Projection</span><span class="p">(</span><span class="n">_</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">root_place</span><span class="p">.</span><span class="n">place</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">                    </span><span class="kd">let</span><span class="w"> </span><span class="n">mpi</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="bp">self</span><span class="p">.</span><span class="n">move_data</span><span class="p">.</span><span class="n">rev_lookup</span><span class="p">.</span><span class="n">find_local</span><span class="p">(</span><span class="o">*</span><span class="n">local</span><span class="p">);</span><span class="w"></span>
<span class="w">                    </span><span class="k">if</span><span class="w"> </span><span class="n">flow_state</span><span class="p">.</span><span class="n">uninits</span><span class="p">.</span><span class="n">contains</span><span class="p">(</span><span class="n">mpi</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">                        </span><span class="bp">self</span><span class="p">.</span><span class="n">infcx</span><span class="p">.</span><span class="n">tcx</span><span class="p">.</span><span class="n">sess</span><span class="p">.</span><span class="n">delay_span_bug</span><span class="p">(</span><span class="w"></span>
<span class="w">                            </span><span class="n">place_span</span><span class="p">.</span><span class="mi">1</span><span class="p">,</span><span class="w"></span>
<span class="w">                            </span><span class="o">&amp;</span><span class="n">format</span><span class="o">!</span><span class="p">(</span><span class="w"></span>
<span class="w">                                </span><span class="s">&quot;ERROR&quot;</span><span class="w"></span>
<span class="w">                            </span><span class="p">),</span><span class="w"></span>
<span class="w">                            </span><span class="p">);</span><span class="w"></span>
<span class="w">                    </span><span class="p">}</span><span class="w"></span>

<span class="w">                    </span><span class="k">return</span><span class="p">;</span><span class="w"></span>
<span class="w">                </span><span class="p">}</span><span class="w"></span>
</pre></div>



<a name="135425858"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2354499%20Invalid%20%22variable%20does%20not%20need%20to%20be%20mutable%22/near/135425858" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2354499.20Invalid.20.22variable.20does.20not.20need.20to.20be.20mutable.22.html#135425858">(Oct 08 2018 at 20:19)</a>:</h4>
<p>what is <code>root_place</code> there?</p>



<a name="135425908"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2354499%20Invalid%20%22variable%20does%20not%20need%20to%20be%20mutable%22/near/135425908" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2354499.20Invalid.20.22variable.20does.20not.20need.20to.20be.20mutable.22.html#135425908">(Oct 08 2018 at 20:20)</a>:</h4>
<p>so I was guessing, when I have a.b.c</p>



<a name="135425917"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2354499%20Invalid%20%22variable%20does%20not%20need%20to%20be%20mutable%22/near/135425917" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2354499.20Invalid.20.22variable.20does.20not.20need.20to.20be.20mutable.22.html#135425917">(Oct 08 2018 at 20:20)</a>:</h4>
<p>place was the place for c</p>



<a name="135425922"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2354499%20Invalid%20%22variable%20does%20not%20need%20to%20be%20mutable%22/near/135425922" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2354499.20Invalid.20.22variable.20does.20not.20need.20to.20be.20mutable.22.html#135425922">(Oct 08 2018 at 20:20)</a>:</h4>
<p>and I need also the place for a</p>



<a name="135425923"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2354499%20Invalid%20%22variable%20does%20not%20need%20to%20be%20mutable%22/near/135425923" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2354499.20Invalid.20.22variable.20does.20not.20need.20to.20be.20mutable.22.html#135425923">(Oct 08 2018 at 20:20)</a>:</h4>
<p>I think you just want <code>place_span.0</code></p>



<a name="135425926"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2354499%20Invalid%20%22variable%20does%20not%20need%20to%20be%20mutable%22/near/135425926" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2354499.20Invalid.20.22variable.20does.20not.20need.20to.20be.20mutable.22.html#135425926">(Oct 08 2018 at 20:20)</a>:</h4>
<p>in the new function</p>



<a name="135425936"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2354499%20Invalid%20%22variable%20does%20not%20need%20to%20be%20mutable%22/near/135425936" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2354499.20Invalid.20.22variable.20does.20not.20need.20to.20be.20mutable.22.html#135425936">(Oct 08 2018 at 20:20)</a>:</h4>
<p>I need both</p>



<a name="135425955"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2354499%20Invalid%20%22variable%20does%20not%20need%20to%20be%20mutable%22/near/135425955" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2354499.20Invalid.20.22variable.20does.20not.20need.20to.20be.20mutable.22.html#135425955">(Oct 08 2018 at 20:20)</a>:</h4>
<p>I need to know that I'm in a projection</p>



<a name="135425965"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2354499%20Invalid%20%22variable%20does%20not%20need%20to%20be%20mutable%22/near/135425965" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2354499.20Invalid.20.22variable.20does.20not.20need.20to.20be.20mutable.22.html#135425965">(Oct 08 2018 at 20:21)</a>:</h4>
<p>I may be understanding this wrong</p>



<a name="135425970"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2354499%20Invalid%20%22variable%20does%20not%20need%20to%20be%20mutable%22/near/135425970" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2354499.20Invalid.20.22variable.20does.20not.20need.20to.20be.20mutable.22.html#135425970">(Oct 08 2018 at 20:21)</a>:</h4>
<p>my thought was</p>



<a name="135425972"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2354499%20Invalid%20%22variable%20does%20not%20need%20to%20be%20mutable%22/near/135425972" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2354499.20Invalid.20.22variable.20does.20not.20need.20to.20be.20mutable.22.html#135425972">(Oct 08 2018 at 20:21)</a>:</h4>
<p>you can invoke <code>place_span.0.local()</code> to get the innermost local variable</p>



<a name="135425988"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2354499%20Invalid%20%22variable%20does%20not%20need%20to%20be%20mutable%22/near/135425988" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2354499.20Invalid.20.22variable.20does.20not.20need.20to.20be.20mutable.22.html#135425988">(Oct 08 2018 at 20:21)</a>:</h4>
<p><a href="https://doc.rust-lang.org/nightly/nightly-rustc/rustc/mir/enum.Place.html#method.local" target="_blank" title="https://doc.rust-lang.org/nightly/nightly-rustc/rustc/mir/enum.Place.html#method.local">local()</a></p>



<a name="135425991"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2354499%20Invalid%20%22variable%20does%20not%20need%20to%20be%20mutable%22/near/135425991" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2354499.20Invalid.20.22variable.20does.20not.20need.20to.20be.20mutable.22.html#135425991">(Oct 08 2018 at 20:21)</a>:</h4>
<p>ahh so place_span would be the root_place here?</p>



<a name="135425996"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2354499%20Invalid%20%22variable%20does%20not%20need%20to%20be%20mutable%22/near/135425996" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2354499.20Invalid.20.22variable.20does.20not.20need.20to.20be.20mutable.22.html#135425996">(Oct 08 2018 at 20:21)</a>:</h4>
<p>like in a.b.c = 1;</p>



<a name="135426001"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2354499%20Invalid%20%22variable%20does%20not%20need%20to%20be%20mutable%22/near/135426001" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2354499.20Invalid.20.22variable.20does.20not.20need.20to.20be.20mutable.22.html#135426001">(Oct 08 2018 at 20:21)</a>:</h4>
<p>place_span would be the place for a ?</p>



<a name="135426138"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2354499%20Invalid%20%22variable%20does%20not%20need%20to%20be%20mutable%22/near/135426138" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2354499.20Invalid.20.22variable.20does.20not.20need.20to.20be.20mutable.22.html#135426138">(Oct 08 2018 at 20:24)</a>:</h4>
<p><code>place_span</code> will be the place for <code>a.b.c</code></p>



<a name="135426140"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2354499%20Invalid%20%22variable%20does%20not%20need%20to%20be%20mutable%22/near/135426140" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2354499.20Invalid.20.22variable.20does.20not.20need.20to.20be.20mutable.22.html#135426140">(Oct 08 2018 at 20:24)</a>:</h4>
<p><code>place_span.0</code>, that is</p>



<a name="135426147"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2354499%20Invalid%20%22variable%20does%20not%20need%20to%20be%20mutable%22/near/135426147" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2354499.20Invalid.20.22variable.20does.20not.20need.20to.20be.20mutable.22.html#135426147">(Oct 08 2018 at 20:24)</a>:</h4>
<p><code>local()</code> would return <code>Some(a)</code></p>



<a name="135428004"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2354499%20Invalid%20%22variable%20does%20not%20need%20to%20be%20mutable%22/near/135428004" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2354499.20Invalid.20.22variable.20does.20not.20need.20to.20be.20mutable.22.html#135428004">(Oct 08 2018 at 21:06)</a>:</h4>
<p>ok</p>



<a name="135428011"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2354499%20Invalid%20%22variable%20does%20not%20need%20to%20be%20mutable%22/near/135428011" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2354499.20Invalid.20.22variable.20does.20not.20need.20to.20be.20mutable.22.html#135428011">(Oct 08 2018 at 21:07)</a>:</h4>
<p>makes sense</p>



<a name="135428068"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2354499%20Invalid%20%22variable%20does%20not%20need%20to%20be%20mutable%22/near/135428068" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2354499.20Invalid.20.22variable.20does.20not.20need.20to.20be.20mutable.22.html#135428068">(Oct 08 2018 at 21:08)</a>:</h4>
<p>so place_span.0 will be Projection in this case</p>



<a name="135428144"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2354499%20Invalid%20%22variable%20does%20not%20need%20to%20be%20mutable%22/near/135428144" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2354499.20Invalid.20.22variable.20does.20not.20need.20to.20be.20mutable.22.html#135428144">(Oct 08 2018 at 21:10)</a>:</h4>
<p>right</p>



<a name="135428154"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2354499%20Invalid%20%22variable%20does%20not%20need%20to%20be%20mutable%22/near/135428154" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2354499.20Invalid.20.22variable.20does.20not.20need.20to.20be.20mutable.22.html#135428154">(Oct 08 2018 at 21:10)</a>:</h4>
<p>how should the error message look like?</p>



<a name="135428186"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2354499%20Invalid%20%22variable%20does%20not%20need%20to%20be%20mutable%22/near/135428186" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2354499.20Invalid.20.22variable.20does.20not.20need.20to.20be.20mutable.22.html#135428186">(Oct 08 2018 at 21:11)</a>:</h4>
<p>btw</p>



<a name="135428193"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2354499%20Invalid%20%22variable%20does%20not%20need%20to%20be%20mutable%22/near/135428193" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2354499.20Invalid.20.22variable.20does.20not.20need.20to.20be.20mutable.22.html#135428193">(Oct 08 2018 at 21:11)</a>:</h4>
<div class="codehilite"><pre><span></span>         match root_place {
             RootPlace {
                 place: Place::Local(local),
-                is_local_mutation_allowed,
+                is_local_mutation_allowed: _,
             } =&gt; {
-                if is_local_mutation_allowed != LocalMutationIsAllowed::Yes {
-                    // If the local may be initialized, and it is now currently being
-                    // mutated, then it is justified to be annotated with the `mut`
-                    // keyword, since the mutation may be a possible reassignment.
-                    let mpi = self.move_data.rev_lookup.find_local(*local);
-                    let ii = &amp;self.move_data.init_path_map[mpi];
-                    for &amp;index in ii {
-                        if flow_state.ever_inits.contains(index) {
-                            self.used_mut.insert(*local);
-                            break;
-                        }
-                    }
-                }
+                self.used_mut.insert(*local);
             }
             RootPlace {
                 place: _,
</pre></div>



<a name="135428201"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2354499%20Invalid%20%22variable%20does%20not%20need%20to%20be%20mutable%22/near/135428201" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2354499.20Invalid.20.22variable.20does.20not.20need.20to.20be.20mutable.22.html#135428201">(Oct 08 2018 at 21:11)</a>:</h4>
<p>this is what you wanted to do with the used_mut set?</p>



<a name="135428290"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2354499%20Invalid%20%22variable%20does%20not%20need%20to%20be%20mutable%22/near/135428290" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2354499.20Invalid.20.22variable.20does.20not.20need.20to.20be.20mutable.22.html#135428290">(Oct 08 2018 at 21:13)</a>:</h4>
<p>where is this code living?</p>



<a name="135428307"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2354499%20Invalid%20%22variable%20does%20not%20need%20to%20be%20mutable%22/near/135428307" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2354499.20Invalid.20.22variable.20does.20not.20need.20to.20be.20mutable.22.html#135428307">(Oct 08 2018 at 21:13)</a>:</h4>
<p>oh</p>



<a name="135428308"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2354499%20Invalid%20%22variable%20does%20not%20need%20to%20be%20mutable%22/near/135428308" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2354499.20Invalid.20.22variable.20does.20not.20need.20to.20be.20mutable.22.html#135428308">(Oct 08 2018 at 21:13)</a>:</h4>
<p>I see</p>



<a name="135428361"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2354499%20Invalid%20%22variable%20does%20not%20need%20to%20be%20mutable%22/near/135428361" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2354499.20Invalid.20.22variable.20does.20not.20need.20to.20be.20mutable.22.html#135428361">(Oct 08 2018 at 21:14)</a>:</h4>
<p><a href="https://github.com/rust-lang/rust/blob/423d8109868c1f926f2cfcc3bff980c3daa515fd/src/librustc_mir/borrow_check/mod.rs#L1815-L1827" target="_blank" title="https://github.com/rust-lang/rust/blob/423d8109868c1f926f2cfcc3bff980c3daa515fd/src/librustc_mir/borrow_check/mod.rs#L1815-L1827">https://github.com/rust-lang/rust/blob/423d8109868c1f926f2cfcc3bff980c3daa515fd/src/librustc_mir/borrow_check/mod.rs#L1815-L1827</a></p>



<a name="135428363"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2354499%20Invalid%20%22variable%20does%20not%20need%20to%20be%20mutable%22/near/135428363" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2354499.20Invalid.20.22variable.20does.20not.20need.20to.20be.20mutable.22.html#135428363">(Oct 08 2018 at 21:14)</a>:</h4>
<blockquote>
<p>how should the error message look like?</p>
</blockquote>
<p>probably something like</p>
<hr>
<p>cannot assign to <code>a.b.c</code> when <code>a</code> is not initialized</p>
<p>?</p>



<a name="135428368"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2354499%20Invalid%20%22variable%20does%20not%20need%20to%20be%20mutable%22/near/135428368" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2354499.20Invalid.20.22variable.20does.20not.20need.20to.20be.20mutable.22.html#135428368">(Oct 08 2018 at 21:14)</a>:</h4>
<p>ok</p>



<a name="135428381"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2354499%20Invalid%20%22variable%20does%20not%20need%20to%20be%20mutable%22/near/135428381" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2354499.20Invalid.20.22variable.20does.20not.20need.20to.20be.20mutable.22.html#135428381">(Oct 08 2018 at 21:15)</a>:</h4>
<p>re: the used-mut code...</p>



<a name="135428386"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2354499%20Invalid%20%22variable%20does%20not%20need%20to%20be%20mutable%22/near/135428386" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2354499.20Invalid.20.22variable.20does.20not.20need.20to.20be.20mutable.22.html#135428386">(Oct 08 2018 at 21:15)</a>:</h4>
<blockquote>
<p>though I guess we'll also have to tweak the used-mut set still</p>
</blockquote>
<p>was talking about this</p>



<a name="135428389"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2354499%20Invalid%20%22variable%20does%20not%20need%20to%20be%20mutable%22/near/135428389" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2354499.20Invalid.20.22variable.20does.20not.20need.20to.20be.20mutable.22.html#135428389">(Oct 08 2018 at 21:15)</a>:</h4>
<p>what was that code looking like before your PR?</p>



<a name="135428396"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2354499%20Invalid%20%22variable%20does%20not%20need%20to%20be%20mutable%22/near/135428396" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2354499.20Invalid.20.22variable.20does.20not.20need.20to.20be.20mutable.22.html#135428396">(Oct 08 2018 at 21:15)</a>:</h4>
<p>anyway I can <a href="https://github.com/rust-lang/rust/blob/423d8109868c1f926f2cfcc3bff980c3daa515fd/src/librustc_mir/borrow_check/mod.rs#L1815-L1827" target="_blank" title="https://github.com/rust-lang/rust/blob/423d8109868c1f926f2cfcc3bff980c3daa515fd/src/librustc_mir/borrow_check/mod.rs#L1815-L1827">https://github.com/rust-lang/rust/blob/423d8109868c1f926f2cfcc3bff980c3daa515fd/src/librustc_mir/borrow_check/mod.rs#L1815-L1827</a></p>



<a name="135428450"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2354499%20Invalid%20%22variable%20does%20not%20need%20to%20be%20mutable%22/near/135428450" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2354499.20Invalid.20.22variable.20does.20not.20need.20to.20be.20mutable.22.html#135428450">(Oct 08 2018 at 21:16)</a>:</h4>
<p>I think it should probably stay that way</p>



<a name="135428459"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2354499%20Invalid%20%22variable%20does%20not%20need%20to%20be%20mutable%22/near/135428459" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2354499.20Invalid.20.22variable.20does.20not.20need.20to.20be.20mutable.22.html#135428459">(Oct 08 2018 at 21:16)</a>:</h4>
<p>but in the code where we are issuing an error</p>



<a name="135428497"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2354499%20Invalid%20%22variable%20does%20not%20need%20to%20be%20mutable%22/near/135428497" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2354499.20Invalid.20.22variable.20does.20not.20need.20to.20be.20mutable.22.html#135428497">(Oct 08 2018 at 21:17)</a>:</h4>
<p>just add to the used mut the thing</p>



<a name="135428551"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2354499%20Invalid%20%22variable%20does%20not%20need%20to%20be%20mutable%22/near/135428551" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2354499.20Invalid.20.22variable.20does.20not.20need.20to.20be.20mutable.22.html#135428551">(Oct 08 2018 at 21:18)</a>:</h4>
<p>right, the idea being — "always consider the <code>mut</code> on this variable used" — since we saw an error related to the variable, we know we can't accurately assess whether <code>mut</code> will be imp't once the error is fixed</p>



<a name="135428649"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2354499%20Invalid%20%22variable%20does%20not%20need%20to%20be%20mutable%22/near/135428649" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2354499.20Invalid.20.22variable.20does.20not.20need.20to.20be.20mutable.22.html#135428649">(Oct 08 2018 at 21:20)</a>:</h4>
<p>but in that code you quoted, that code is to handle the non-error case, and I don't think that has changed</p>



<a name="135428652"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2354499%20Invalid%20%22variable%20does%20not%20need%20to%20be%20mutable%22/near/135428652" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2354499.20Invalid.20.22variable.20does.20not.20need.20to.20be.20mutable.22.html#135428652">(Oct 08 2018 at 21:20)</a>:</h4>
<p>(that is, the <code>used_mut</code> adjustments)</p>



<a name="135428655"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2354499%20Invalid%20%22variable%20does%20not%20need%20to%20be%20mutable%22/near/135428655" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2354499.20Invalid.20.22variable.20does.20not.20need.20to.20be.20mutable.22.html#135428655">(Oct 08 2018 at 21:20)</a>:</h4>
<p>make sense?</p>



<a name="135428737"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2354499%20Invalid%20%22variable%20does%20not%20need%20to%20be%20mutable%22/near/135428737" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2354499.20Invalid.20.22variable.20does.20not.20need.20to.20be.20mutable.22.html#135428737">(Oct 08 2018 at 21:22)</a>:</h4>
<p>yep</p>



<a name="135428738"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2354499%20Invalid%20%22variable%20does%20not%20need%20to%20be%20mutable%22/near/135428738" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2354499.20Invalid.20.22variable.20does.20not.20need.20to.20be.20mutable.22.html#135428738">(Oct 08 2018 at 21:22)</a>:</h4>
<p>makes sense</p>



<a name="135428743"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2354499%20Invalid%20%22variable%20does%20not%20need%20to%20be%20mutable%22/near/135428743" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2354499.20Invalid.20.22variable.20does.20not.20need.20to.20be.20mutable.22.html#135428743">(Oct 08 2018 at 21:22)</a>:</h4>
<p>compiling and will run tests to see what happens</p>



<a name="135428756"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2354499%20Invalid%20%22variable%20does%20not%20need%20to%20be%20mutable%22/near/135428756" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2354499.20Invalid.20.22variable.20does.20not.20need.20to.20be.20mutable.22.html#135428756">(Oct 08 2018 at 21:22)</a>:</h4>
<p>hmmm last thing</p>



<a name="135428759"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2354499%20Invalid%20%22variable%20does%20not%20need%20to%20be%20mutable%22/near/135428759" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2354499.20Invalid.20.22variable.20does.20not.20need.20to.20be.20mutable.22.html#135428759">(Oct 08 2018 at 21:22)</a>:</h4>
<p>how is <code>cannot assign to a.b.c when a is not initialized</code> produced</p>



<a name="135428778"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2354499%20Invalid%20%22variable%20does%20not%20need%20to%20be%20mutable%22/near/135428778" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2354499.20Invalid.20.22variable.20does.20not.20need.20to.20be.20mutable.22.html#135428778">(Oct 08 2018 at 21:23)</a>:</h4>
<p>was doing ...</p>



<a name="135428793"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2354499%20Invalid%20%22variable%20does%20not%20need%20to%20be%20mutable%22/near/135428793" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2354499.20Invalid.20.22variable.20does.20not.20need.20to.20be.20mutable.22.html#135428793">(Oct 08 2018 at 21:23)</a>:</h4>
<div class="codehilite"><pre><span></span><span class="w">                    </span><span class="bp">self</span><span class="p">.</span><span class="n">infcx</span><span class="p">.</span><span class="n">tcx</span><span class="p">.</span><span class="n">sess</span><span class="p">.</span><span class="n">delay_span_bug</span><span class="p">(</span><span class="w"></span>
<span class="w">                        </span><span class="n">place_span</span><span class="p">.</span><span class="mi">1</span><span class="p">,</span><span class="w"></span>
<span class="w">                        </span><span class="o">&amp;</span><span class="n">format</span><span class="o">!</span><span class="p">(</span><span class="w"></span>
<span class="w">                            </span><span class="s">&quot;cannot assign to {} when {} is not initialized&quot;</span><span class="p">,</span><span class="w"></span>
<span class="w">                            </span><span class="n">place</span><span class="p">,</span><span class="w"> </span><span class="n">place</span><span class="w"></span>
<span class="w">                        </span><span class="p">),</span><span class="w"></span>
<span class="w">                    </span><span class="p">);</span><span class="w"></span>
</pre></div>



<a name="135428795"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2354499%20Invalid%20%22variable%20does%20not%20need%20to%20be%20mutable%22/near/135428795" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2354499.20Invalid.20.22variable.20does.20not.20need.20to.20be.20mutable.22.html#135428795">(Oct 08 2018 at 21:23)</a>:</h4>
<p>of course place, place is wrong :)</p>



<a name="135428854"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2354499%20Invalid%20%22variable%20does%20not%20need%20to%20be%20mutable%22/near/135428854" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2354499.20Invalid.20.22variable.20does.20not.20need.20to.20be.20mutable.22.html#135428854">(Oct 08 2018 at 21:24)</a>:</h4>
<p>well</p>



<a name="135428856"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2354499%20Invalid%20%22variable%20does%20not%20need%20to%20be%20mutable%22/near/135428856" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2354499.20Invalid.20.22variable.20does.20not.20need.20to.20be.20mutable.22.html#135428856">(Oct 08 2018 at 21:24)</a>:</h4>
<p>delay_span_bug is also not what we need</p>



<a name="135428869"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2354499%20Invalid%20%22variable%20does%20not%20need%20to%20be%20mutable%22/near/135428869" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2354499.20Invalid.20.22variable.20does.20not.20need.20to.20be.20mutable.22.html#135428869">(Oct 08 2018 at 21:25)</a>:</h4>
<p>you can do a </p>
<div class="codehilite"><pre><span></span><span class="w">                            </span><span class="n">struct_span_err</span><span class="o">!</span><span class="p">(</span><span class="bp">self</span><span class="p">.</span><span class="n">sess</span><span class="p">,</span><span class="w"> </span><span class="n">e</span><span class="p">.</span><span class="n">span</span><span class="p">,</span><span class="w"> </span><span class="n">E0571</span><span class="p">,</span><span class="w"></span>
<span class="w">                                             </span><span class="s">&quot;`break` with value from a `{}` loop&quot;</span><span class="p">,</span><span class="w"></span>
<span class="w">                                             </span><span class="n">kind</span><span class="p">.</span><span class="n">name</span><span class="p">())</span><span class="w"></span>
</pre></div>



<a name="135428870"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2354499%20Invalid%20%22variable%20does%20not%20need%20to%20be%20mutable%22/near/135428870" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2354499.20Invalid.20.22variable.20does.20not.20need.20to.20be.20mutable.22.html#135428870">(Oct 08 2018 at 21:25)</a>:</h4>
<p>something like that</p>



<a name="135428872"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2354499%20Invalid%20%22variable%20does%20not%20need%20to%20be%20mutable%22/near/135428872" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> pnkfelix <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2354499.20Invalid.20.22variable.20does.20not.20need.20to.20be.20mutable.22.html#135428872">(Oct 08 2018 at 21:25)</a>:</h4>
<p>just to be clear, <span class="user-mention" data-user-id="116266">@Santiago Pastorino</span> resolving the thing from <a href="https://github.com/rust-lang/rust/issues/21232" target="_blank" title="https://github.com/rust-lang/rust/issues/21232">#21232</a> ? Should I officially assign <span class="user-mention" data-user-id="116266">@Santiago Pastorino</span> on that issue?</p>



<a name="135428873"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2354499%20Invalid%20%22variable%20does%20not%20need%20to%20be%20mutable%22/near/135428873" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2354499.20Invalid.20.22variable.20does.20not.20need.20to.20be.20mutable.22.html#135428873">(Oct 08 2018 at 21:25)</a>:</h4>
<p>to make a custom error</p>



<a name="135428888"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2354499%20Invalid%20%22variable%20does%20not%20need%20to%20be%20mutable%22/near/135428888" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2354499.20Invalid.20.22variable.20does.20not.20need.20to.20be.20mutable.22.html#135428888">(Oct 08 2018 at 21:25)</a>:</h4>
<p>right now <span class="user-mention" data-user-id="116266">@Santiago Pastorino</span> is working on making it a "clean error"</p>



<a name="135428903"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2354499%20Invalid%20%22variable%20does%20not%20need%20to%20be%20mutable%22/near/135428903" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2354499.20Invalid.20.22variable.20does.20not.20need.20to.20be.20mutable.22.html#135428903">(Oct 08 2018 at 21:25)</a>:</h4>
<p>but I think it might be a logical follow-up to tackle the "correct semantics", if they wanted, though <span class="user-mention" data-user-id="116108">@Keith Yeung</span> had also expressed some interest I think</p>



<a name="135428946"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2354499%20Invalid%20%22variable%20does%20not%20need%20to%20be%20mutable%22/near/135428946" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> pnkfelix <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2354499.20Invalid.20.22variable.20does.20not.20need.20to.20be.20mutable.22.html#135428946">(Oct 08 2018 at 21:26)</a>:</h4>
<p>let me try again. Is <span class="user-mention" data-user-id="116266">@Santiago Pastorino</span> doing this: "we have tentatively decided to attempt, for the short-term, to adopt the semantics that rejects all three cases."</p>



<a name="135428953"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2354499%20Invalid%20%22variable%20does%20not%20need%20to%20be%20mutable%22/near/135428953" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Keith Yeung <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2354499.20Invalid.20.22variable.20does.20not.20need.20to.20be.20mutable.22.html#135428953">(Oct 08 2018 at 21:26)</a>:</h4>
<p>hello</p>



<a name="135428957"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2354499%20Invalid%20%22variable%20does%20not%20need%20to%20be%20mutable%22/near/135428957" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2354499.20Invalid.20.22variable.20does.20not.20need.20to.20be.20mutable.22.html#135428957">(Oct 08 2018 at 21:26)</a>:</h4>
<blockquote>
<p>let me try again. Is <span class="user-mention" data-user-id="116266">@Santiago Pastorino</span> doing this: "we have tentatively decided to attempt, for the short-term, to adopt the semantics that rejects all three cases."</p>
</blockquote>
<p>confirm</p>



<a name="135428958"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2354499%20Invalid%20%22variable%20does%20not%20need%20to%20be%20mutable%22/near/135428958" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2354499.20Invalid.20.22variable.20does.20not.20need.20to.20be.20mutable.22.html#135428958">(Oct 08 2018 at 21:26)</a>:</h4>
<p>I could work on that thing also if needed, unsure if there are other priorities</p>



<a name="135428967"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2354499%20Invalid%20%22variable%20does%20not%20need%20to%20be%20mutable%22/near/135428967" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> pnkfelix <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2354499.20Invalid.20.22variable.20does.20not.20need.20to.20be.20mutable.22.html#135428967">(Oct 08 2018 at 21:26)</a>:</h4>
<p>okay</p>



<a name="135429003"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2354499%20Invalid%20%22variable%20does%20not%20need%20to%20be%20mutable%22/near/135429003" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> pnkfelix <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2354499.20Invalid.20.22variable.20does.20not.20need.20to.20be.20mutable.22.html#135429003">(Oct 08 2018 at 21:27)</a>:</h4>
<p>I ask because I had a branch in another directory that I was playing with as a background task, where I was trying to add the check to <code>fn check_if_assigned_path_is_moved</code></p>



<a name="135429050"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2354499%20Invalid%20%22variable%20does%20not%20need%20to%20be%20mutable%22/near/135429050" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Keith Yeung <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2354499.20Invalid.20.22variable.20does.20not.20need.20to.20be.20mutable.22.html#135429050">(Oct 08 2018 at 21:28)</a>:</h4>
<p>oh, i just said that <a href="https://github.com/rust-lang/rust/issues/21232" target="_blank" title="https://github.com/rust-lang/rust/issues/21232">#21232</a> is a pretty annoying error and it's a real footgun for beginners</p>



<a name="135429054"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2354499%20Invalid%20%22variable%20does%20not%20need%20to%20be%20mutable%22/near/135429054" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Keith Yeung <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2354499.20Invalid.20.22variable.20does.20not.20need.20to.20be.20mutable.22.html#135429054">(Oct 08 2018 at 21:28)</a>:</h4>
<p>that said, i don't exactly know what the correct semantics would be for that particular issue</p>



<a name="135429060"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2354499%20Invalid%20%22variable%20does%20not%20need%20to%20be%20mutable%22/near/135429060" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> pnkfelix <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2354499.20Invalid.20.22variable.20does.20not.20need.20to.20be.20mutable.22.html#135429060">(Oct 08 2018 at 21:28)</a>:</h4>
<p>since we already had this code there: <a href="https://github.com/rust-lang/rust/blob/423d8109868c1f926f2cfcc3bff980c3daa515fd/src/librustc_mir/borrow_check/mod.rs#L1661" target="_blank" title="https://github.com/rust-lang/rust/blob/423d8109868c1f926f2cfcc3bff980c3daa515fd/src/librustc_mir/borrow_check/mod.rs#L1661">https://github.com/rust-lang/rust/blob/423d8109868c1f926f2cfcc3bff980c3daa515fd/src/librustc_mir/borrow_check/mod.rs#L1661</a></p>



<a name="135429084"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2354499%20Invalid%20%22variable%20does%20not%20need%20to%20be%20mutable%22/near/135429084" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Keith Yeung <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2354499.20Invalid.20.22variable.20does.20not.20need.20to.20be.20mutable.22.html#135429084">(Oct 08 2018 at 21:29)</a>:</h4>
<p>my understanding is that we can sort of keep track of the fields that are initialized after it's been moved out, and if any of them are undefined during a use, throw a compile time error</p>



<a name="135429087"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2354499%20Invalid%20%22variable%20does%20not%20need%20to%20be%20mutable%22/near/135429087" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> pnkfelix <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2354499.20Invalid.20.22variable.20does.20not.20need.20to.20be.20mutable.22.html#135429087">(Oct 08 2018 at 21:29)</a>:</h4>
<p>And it seemed "obvious" to me that we might add the "clean error" by using the same logic regardless of whether it was a type with a dtor or not. Of course, the "obvious" thing had totally non-obvious consequences...</p>



<a name="135429128"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2354499%20Invalid%20%22variable%20does%20not%20need%20to%20be%20mutable%22/near/135429128" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Keith Yeung <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2354499.20Invalid.20.22variable.20does.20not.20need.20to.20be.20mutable.22.html#135429128">(Oct 08 2018 at 21:30)</a>:</h4>
<p>but i'm unsure if it's a sound solution</p>



<a name="135429178"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2354499%20Invalid%20%22variable%20does%20not%20need%20to%20be%20mutable%22/near/135429178" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Keith Yeung <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2354499.20Invalid.20.22variable.20does.20not.20need.20to.20be.20mutable.22.html#135429178">(Oct 08 2018 at 21:31)</a>:</h4>
<p>more concretely, i'm not sure if we do anything else special during the construction of an ADT</p>



<a name="135429248"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2354499%20Invalid%20%22variable%20does%20not%20need%20to%20be%20mutable%22/near/135429248" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> pnkfelix <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2354499.20Invalid.20.22variable.20does.20not.20need.20to.20be.20mutable.22.html#135429248">(Oct 08 2018 at 21:33)</a>:</h4>
<p>Anyway, I'm headed to bed now, but <span class="user-mention" data-user-id="116266">@Santiago Pastorino</span> , if you want to compare notes on your approach versus the one I was trying out, we can try to chat sometime tomorrow.</p>



<a name="135443902"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2354499%20Invalid%20%22variable%20does%20not%20need%20to%20be%20mutable%22/near/135443902" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2354499.20Invalid.20.22variable.20does.20not.20need.20to.20be.20mutable.22.html#135443902">(Oct 09 2018 at 04:34)</a>:</h4>
<p><span class="user-mention" data-user-id="116083">@pnkfelix</span> <span class="emoji emoji-1f44d" title="+1">:+1:</span> to everything</p>



<a name="135443908"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2354499%20Invalid%20%22variable%20does%20not%20need%20to%20be%20mutable%22/near/135443908" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2354499.20Invalid.20.22variable.20does.20not.20need.20to.20be.20mutable.22.html#135443908">(Oct 09 2018 at 04:34)</a>:</h4>
<p><span class="user-mention" data-user-id="116009">@nikomatsakis</span> the stuff we've talked about is not working .local() returns None</p>



<a name="135443914"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2354499%20Invalid%20%22variable%20does%20not%20need%20to%20be%20mutable%22/near/135443914" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2354499.20Invalid.20.22variable.20does.20not.20need.20to.20be.20mutable.22.html#135443914">(Oct 09 2018 at 04:34)</a>:</h4>
<p>need to find out</p>



<a name="135444032"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2354499%20Invalid%20%22variable%20does%20not%20need%20to%20be%20mutable%22/near/135444032" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2354499.20Invalid.20.22variable.20does.20not.20need.20to.20be.20mutable.22.html#135444032">(Oct 09 2018 at 04:38)</a>:</h4>
<p>in this case place is a <code>Promoted</code> thing</p>



<a name="135466156"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2354499%20Invalid%20%22variable%20does%20not%20need%20to%20be%20mutable%22/near/135466156" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2354499.20Invalid.20.22variable.20does.20not.20need.20to.20be.20mutable.22.html#135466156">(Oct 09 2018 at 12:45)</a>:</h4>
<p><span class="user-mention" data-user-id="116009">@nikomatsakis</span> ping</p>



<a name="135466172"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2354499%20Invalid%20%22variable%20does%20not%20need%20to%20be%20mutable%22/near/135466172" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2354499.20Invalid.20.22variable.20does.20not.20need.20to.20be.20mutable.22.html#135466172">(Oct 09 2018 at 12:46)</a>:</h4>
<p>I'm getting a <code>Promoted</code> thing instead of <code>Projection</code></p>



<a name="135466240"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2354499%20Invalid%20%22variable%20does%20not%20need%20to%20be%20mutable%22/near/135466240" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2354499.20Invalid.20.22variable.20does.20not.20need.20to.20be.20mutable.22.html#135466240">(Oct 09 2018 at 12:46)</a>:</h4>
<p>for this example ...</p>



<a name="135466257"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2354499%20Invalid%20%22variable%20does%20not%20need%20to%20be%20mutable%22/near/135466257" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2354499.20Invalid.20.22variable.20does.20not.20need.20to.20be.20mutable.22.html#135466257">(Oct 09 2018 at 12:46)</a>:</h4>
<div class="codehilite"><pre><span></span><span class="cp">#![feature(nll)]</span><span class="w"></span>

<span class="k">fn</span> <span class="nf">main</span><span class="p">()</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="k">mut</span><span class="w"> </span><span class="n">s</span>: <span class="p">(</span><span class="kt">i32</span><span class="p">,</span><span class="w"> </span><span class="kt">i32</span><span class="p">);</span><span class="w"></span>
<span class="w">    </span><span class="n">s</span><span class="p">.</span><span class="mi">0</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">3</span><span class="p">;</span><span class="w"></span>
<span class="w">    </span><span class="n">s</span><span class="p">.</span><span class="mi">1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">4</span><span class="p">;</span><span class="w"></span>
<span class="w">    </span><span class="n">println</span><span class="o">!</span><span class="p">(</span><span class="s">&quot;{} {}&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">s</span><span class="p">.</span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="n">s</span><span class="p">.</span><span class="mi">1</span><span class="p">);</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>
</pre></div>



<a name="135466320"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2354499%20Invalid%20%22variable%20does%20not%20need%20to%20be%20mutable%22/near/135466320" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2354499.20Invalid.20.22variable.20does.20not.20need.20to.20be.20mutable.22.html#135466320">(Oct 09 2018 at 12:47)</a>:</h4>
<p>not even sure what <code>Promoted</code> is about</p>



<a name="135466377"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2354499%20Invalid%20%22variable%20does%20not%20need%20to%20be%20mutable%22/near/135466377" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2354499.20Invalid.20.22variable.20does.20not.20need.20to.20be.20mutable.22.html#135466377">(Oct 09 2018 at 12:48)</a>:</h4>
<p>so when I call <code>.local()</code> it returns <code>None</code></p>



<a name="135466417"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2354499%20Invalid%20%22variable%20does%20not%20need%20to%20be%20mutable%22/near/135466417" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2354499.20Invalid.20.22variable.20does.20not.20need.20to.20be.20mutable.22.html#135466417">(Oct 09 2018 at 12:48)</a>:</h4>
<p><a href="https://github.com/rust-lang/rust/blob/425a1debb0de638560d277066231eedfa5c5fbd6/src/librustc/mir/mod.rs#L1978" target="_blank" title="https://github.com/rust-lang/rust/blob/425a1debb0de638560d277066231eedfa5c5fbd6/src/librustc/mir/mod.rs#L1978">https://github.com/rust-lang/rust/blob/425a1debb0de638560d277066231eedfa5c5fbd6/src/librustc/mir/mod.rs#L1978</a></p>



<a name="135466455"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2354499%20Invalid%20%22variable%20does%20not%20need%20to%20be%20mutable%22/near/135466455" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2354499.20Invalid.20.22variable.20does.20not.20need.20to.20be.20mutable.22.html#135466455">(Oct 09 2018 at 12:49)</a>:</h4>
<p>First, why <code>s.0 = 3</code> generates a <code>Promoted</code> thing?</p>



<a name="135466462"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2354499%20Invalid%20%22variable%20does%20not%20need%20to%20be%20mutable%22/near/135466462" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> pnkfelix <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2354499.20Invalid.20.22variable.20does.20not.20need.20to.20be.20mutable.22.html#135466462">(Oct 09 2018 at 12:49)</a>:</h4>
<p><a href="https://github.com/rust-lang/rust/blob/425a1debb0de638560d277066231eedfa5c5fbd6/src/librustc/mir/mod.rs#L1867" target="_blank" title="https://github.com/rust-lang/rust/blob/425a1debb0de638560d277066231eedfa5c5fbd6/src/librustc/mir/mod.rs#L1867">https://github.com/rust-lang/rust/blob/425a1debb0de638560d277066231eedfa5c5fbd6/src/librustc/mir/mod.rs#L1867</a></p>



<a name="135466544"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2354499%20Invalid%20%22variable%20does%20not%20need%20to%20be%20mutable%22/near/135466544" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> pnkfelix <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2354499.20Invalid.20.22variable.20does.20not.20need.20to.20be.20mutable.22.html#135466544">(Oct 09 2018 at 12:50)</a>:</h4>
<p>promoted usually means its some expression that got turned into something that we could evaluate at compile-time and store as static data</p>



<a name="135466577"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2354499%20Invalid%20%22variable%20does%20not%20need%20to%20be%20mutable%22/near/135466577" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> pnkfelix <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2354499.20Invalid.20.22variable.20does.20not.20need.20to.20be.20mutable.22.html#135466577">(Oct 09 2018 at 12:50)</a>:</h4>
<p>I cannot tell from context here whether it is the <code>3</code> that has been promoted, or the whole <code>s</code></p>



<a name="135466585"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2354499%20Invalid%20%22variable%20does%20not%20need%20to%20be%20mutable%22/near/135466585" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2354499.20Invalid.20.22variable.20does.20not.20need.20to.20be.20mutable.22.html#135466585">(Oct 09 2018 at 12:50)</a>:</h4>
<p>yeah that's the <code>3</code> part I guess, what about s.0?</p>



<a name="135466604"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2354499%20Invalid%20%22variable%20does%20not%20need%20to%20be%20mutable%22/near/135466604" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2354499.20Invalid.20.22variable.20does.20not.20need.20to.20be.20mutable.22.html#135466604">(Oct 09 2018 at 12:51)</a>:</h4>
<blockquote>
<p>I cannot tell from context here whether it is the <code>3</code> that has been promoted, or the whole <code>s</code></p>
</blockquote>
<p>ahh ok, that makes sense</p>



<a name="135466621"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2354499%20Invalid%20%22variable%20does%20not%20need%20to%20be%20mutable%22/near/135466621" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> pnkfelix <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2354499.20Invalid.20.22variable.20does.20not.20need.20to.20be.20mutable.22.html#135466621">(Oct 09 2018 at 12:51)</a>:</h4>
<p>well don't take my word for it 100%</p>



<a name="135466622"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2354499%20Invalid%20%22variable%20does%20not%20need%20to%20be%20mutable%22/near/135466622" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2354499.20Invalid.20.22variable.20does.20not.20need.20to.20be.20mutable.22.html#135466622">(Oct 09 2018 at 12:51)</a>:</h4>
<p>but it's <code>s.0</code></p>



<a name="135466631"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2354499%20Invalid%20%22variable%20does%20not%20need%20to%20be%20mutable%22/near/135466631" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2354499.20Invalid.20.22variable.20does.20not.20need.20to.20be.20mutable.22.html#135466631">(Oct 09 2018 at 12:51)</a>:</h4>
<div class="codehilite"><pre><span></span>DEBUG 2018-10-09T04:59:17Z: rustc_mir::borrow_check: mutate_place: place = (_1.0: i32)
DEBUG 2018-10-09T04:59:17Z: rustc_mir::borrow_check: mutate_place: place.local() = None
</pre></div>



<a name="135466708"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2354499%20Invalid%20%22variable%20does%20not%20need%20to%20be%20mutable%22/near/135466708" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2354499.20Invalid.20.22variable.20does.20not.20need.20to.20be.20mutable.22.html#135466708">(Oct 09 2018 at 12:52)</a>:</h4>
<p>printed the <code>Debug</code> version of the <code>Place</code> and it gives (_1.0: i32) which is the <code>s.0</code> part</p>



<a name="135466726"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2354499%20Invalid%20%22variable%20does%20not%20need%20to%20be%20mutable%22/near/135466726" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> pnkfelix <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2354499.20Invalid.20.22variable.20does.20not.20need.20to.20be.20mutable.22.html#135466726">(Oct 09 2018 at 12:52)</a>:</h4>
<p>hmm. but it doesn't say <code>_1</code> as a local?</p>



<a name="135466759"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2354499%20Invalid%20%22variable%20does%20not%20need%20to%20be%20mutable%22/near/135466759" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2354499.20Invalid.20.22variable.20does.20not.20need.20to.20be.20mutable.22.html#135466759">(Oct 09 2018 at 12:53)</a>:</h4>
<p>unsure I got what you meant?</p>



<a name="135466766"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2354499%20Invalid%20%22variable%20does%20not%20need%20to%20be%20mutable%22/near/135466766" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> pnkfelix <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2354499.20Invalid.20.22variable.20does.20not.20need.20to.20be.20mutable.22.html#135466766">(Oct 09 2018 at 12:53)</a>:</h4>
<p>or I guess that's the point, the promoted thing <em>is</em> <code>(_1.0: i32)</code></p>



<a name="135466771"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2354499%20Invalid%20%22variable%20does%20not%20need%20to%20be%20mutable%22/near/135466771" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2354499.20Invalid.20.22variable.20does.20not.20need.20to.20be.20mutable.22.html#135466771">(Oct 09 2018 at 12:53)</a>:</h4>
<p>yes</p>



<a name="135466819"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2354499%20Invalid%20%22variable%20does%20not%20need%20to%20be%20mutable%22/near/135466819" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2354499.20Invalid.20.22variable.20does.20not.20need.20to.20be.20mutable.22.html#135466819">(Oct 09 2018 at 12:54)</a>:</h4>
<p>I was expecting a <code>Projection</code> and apply <code>.local()</code> to get the innermost <code>Local</code> part</p>



<a name="135466827"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2354499%20Invalid%20%22variable%20does%20not%20need%20to%20be%20mutable%22/near/135466827" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> pnkfelix <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2354499.20Invalid.20.22variable.20does.20not.20need.20to.20be.20mutable.22.html#135466827">(Oct 09 2018 at 12:54)</a>:</h4>
<p>it seems weird to me</p>



<a name="135466836"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2354499%20Invalid%20%22variable%20does%20not%20need%20to%20be%20mutable%22/near/135466836" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> pnkfelix <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2354499.20Invalid.20.22variable.20does.20not.20need.20to.20be.20mutable.22.html#135466836">(Oct 09 2018 at 12:54)</a>:</h4>
<p>I just wasn't expecting a <code>Promoted</code> to print as <code>_1.0</code></p>



<a name="135466869"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2354499%20Invalid%20%22variable%20does%20not%20need%20to%20be%20mutable%22/near/135466869" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2354499.20Invalid.20.22variable.20does.20not.20need.20to.20be.20mutable.22.html#135466869">(Oct 09 2018 at 12:55)</a>:</h4>
<p><a href="https://github.com/rust-lang/rust/blob/425a1debb0de638560d277066231eedfa5c5fbd6/src/librustc/mir/mod.rs#L1995" target="_blank" title="https://github.com/rust-lang/rust/blob/425a1debb0de638560d277066231eedfa5c5fbd6/src/librustc/mir/mod.rs#L1995">https://github.com/rust-lang/rust/blob/425a1debb0de638560d277066231eedfa5c5fbd6/src/librustc/mir/mod.rs#L1995</a></p>



<a name="135466881"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2354499%20Invalid%20%22variable%20does%20not%20need%20to%20be%20mutable%22/near/135466881" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> pnkfelix <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2354499.20Invalid.20.22variable.20does.20not.20need.20to.20be.20mutable.22.html#135466881">(Oct 09 2018 at 12:55)</a>:</h4>
<p>right, and look what <code>promoted.0</code> is</p>



<a name="135466885"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2354499%20Invalid%20%22variable%20does%20not%20need%20to%20be%20mutable%22/near/135466885" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> pnkfelix <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2354499.20Invalid.20.22variable.20does.20not.20need.20to.20be.20mutable.22.html#135466885">(Oct 09 2018 at 12:55)</a>:</h4>
<p>since that would explain the <code>_1.0</code></p>



<a name="135466888"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2354499%20Invalid%20%22variable%20does%20not%20need%20to%20be%20mutable%22/near/135466888" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> pnkfelix <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2354499.20Invalid.20.22variable.20does.20not.20need.20to.20be.20mutable.22.html#135466888">(Oct 09 2018 at 12:55)</a>:</h4>
<p><code>promoted.0</code> should be an instance of a <code>struct Promoted</code></p>



<a name="135466945"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2354499%20Invalid%20%22variable%20does%20not%20need%20to%20be%20mutable%22/near/135466945" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2354499.20Invalid.20.22variable.20does.20not.20need.20to.20be.20mutable.22.html#135466945">(Oct 09 2018 at 12:56)</a>:</h4>
<p>ohh</p>



<a name="135466952"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2354499%20Invalid%20%22variable%20does%20not%20need%20to%20be%20mutable%22/near/135466952" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2354499.20Invalid.20.22variable.20does.20not.20need.20to.20be.20mutable.22.html#135466952">(Oct 09 2018 at 12:56)</a>:</h4>
<p>I think I did this yesterday a bit sleepy</p>



<a name="135466953"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2354499%20Invalid%20%22variable%20does%20not%20need%20to%20be%20mutable%22/near/135466953" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> pnkfelix <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2354499.20Invalid.20.22variable.20does.20not.20need.20to.20be.20mutable.22.html#135466953">(Oct 09 2018 at 12:56)</a>:</h4>
<p>but I think those would print as <code>promoted[INDEX]</code></p>



<a name="135466955"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2354499%20Invalid%20%22variable%20does%20not%20need%20to%20be%20mutable%22/near/135466955" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2354499.20Invalid.20.22variable.20does.20not.20need.20to.20be.20mutable.22.html#135466955">(Oct 09 2018 at 12:56)</a>:</h4>
<p>I think it's a <code>Field</code></p>



<a name="135466962"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2354499%20Invalid%20%22variable%20does%20not%20need%20to%20be%20mutable%22/near/135466962" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> pnkfelix <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2354499.20Invalid.20.22variable.20does.20not.20need.20to.20be.20mutable.22.html#135466962">(Oct 09 2018 at 12:56)</a>:</h4>
<p>based on <a href="https://github.com/rust-lang/rust/blob/425a1debb0de638560d277066231eedfa5c5fbd6/src/librustc/mir/mod.rs#L2412" target="_blank" title="https://github.com/rust-lang/rust/blob/425a1debb0de638560d277066231eedfa5c5fbd6/src/librustc/mir/mod.rs#L2412">https://github.com/rust-lang/rust/blob/425a1debb0de638560d277066231eedfa5c5fbd6/src/librustc/mir/mod.rs#L2412</a></p>



<a name="135466983"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2354499%20Invalid%20%22variable%20does%20not%20need%20to%20be%20mutable%22/near/135466983" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2354499.20Invalid.20.22variable.20does.20not.20need.20to.20be.20mutable.22.html#135466983">(Oct 09 2018 at 12:57)</a>:</h4>
<p>well I don't know what it is but I can check out</p>



<a name="135466992"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2354499%20Invalid%20%22variable%20does%20not%20need%20to%20be%20mutable%22/near/135466992" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> pnkfelix <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2354499.20Invalid.20.22variable.20does.20not.20need.20to.20be.20mutable.22.html#135466992">(Oct 09 2018 at 12:57)</a>:</h4>
<blockquote>
<p>I think it's a <code>Field</code></p>
</blockquote>
<p>so you are now doubting whether its an instance of <code>Place::Promoted</code> ?</p>



<a name="135466994"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2354499%20Invalid%20%22variable%20does%20not%20need%20to%20be%20mutable%22/near/135466994" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2354499.20Invalid.20.22variable.20does.20not.20need.20to.20be.20mutable.22.html#135466994">(Oct 09 2018 at 12:57)</a>:</h4>
<p>yes</p>



<a name="135466997"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2354499%20Invalid%20%22variable%20does%20not%20need%20to%20be%20mutable%22/near/135466997" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> pnkfelix <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2354499.20Invalid.20.22variable.20does.20not.20need.20to.20be.20mutable.22.html#135466997">(Oct 09 2018 at 12:57)</a>:</h4>
<p>okay</p>



<a name="135467028"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2354499%20Invalid%20%22variable%20does%20not%20need%20to%20be%20mutable%22/near/135467028" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2354499.20Invalid.20.22variable.20does.20not.20need.20to.20be.20mutable.22.html#135467028">(Oct 09 2018 at 12:57)</a>:</h4>
<p>the problem is that if <code>Local</code> is <code>None</code> I guessed it was because it wasn't a <code>Local</code> nor a <code>Projection</code></p>



<a name="135467060"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2354499%20Invalid%20%22variable%20does%20not%20need%20to%20be%20mutable%22/near/135467060" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2354499.20Invalid.20.22variable.20does.20not.20need.20to.20be.20mutable.22.html#135467060">(Oct 09 2018 at 12:58)</a>:</h4>
<p>and I jumped quickly to that conclusion based on the <code>Debug</code> prints of it</p>



<a name="135467171"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2354499%20Invalid%20%22variable%20does%20not%20need%20to%20be%20mutable%22/near/135467171" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2354499.20Invalid.20.22variable.20does.20not.20need.20to.20be.20mutable.22.html#135467171">(Oct 09 2018 at 12:59)</a>:</h4>
<p><span class="user-mention" data-user-id="116083">@pnkfelix</span> is there an API to print the variant of an enum in Rust?</p>



<a name="135467183"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2354499%20Invalid%20%22variable%20does%20not%20need%20to%20be%20mutable%22/near/135467183" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2354499.20Invalid.20.22variable.20does.20not.20need.20to.20be.20mutable.22.html#135467183">(Oct 09 2018 at 12:59)</a>:</h4>
<p>I mean, some way of introspect</p>



<a name="135467184"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2354499%20Invalid%20%22variable%20does%20not%20need%20to%20be%20mutable%22/near/135467184" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> pnkfelix <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2354499.20Invalid.20.22variable.20does.20not.20need.20to.20be.20mutable.22.html#135467184">(Oct 09 2018 at 12:59)</a>:</h4>
<p>there's a <code>discriminant_value</code> method</p>



<a name="135467190"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2354499%20Invalid%20%22variable%20does%20not%20need%20to%20be%20mutable%22/near/135467190" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2354499.20Invalid.20.22variable.20does.20not.20need.20to.20be.20mutable.22.html#135467190">(Oct 09 2018 at 12:59)</a>:</h4>
<p><span class="emoji emoji-1f44d" title="+1">:+1:</span></p>



<a name="135467267"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2354499%20Invalid%20%22variable%20does%20not%20need%20to%20be%20mutable%22/near/135467267" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> pnkfelix <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2354499.20Invalid.20.22variable.20does.20not.20need.20to.20be.20mutable.22.html#135467267">(Oct 09 2018 at 13:00)</a>:</h4>
<p>or rather, that's an intrinsic</p>



<a name="135467278"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2354499%20Invalid%20%22variable%20does%20not%20need%20to%20be%20mutable%22/near/135467278" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2354499.20Invalid.20.22variable.20does.20not.20need.20to.20be.20mutable.22.html#135467278">(Oct 09 2018 at 13:00)</a>:</h4>
<p><span class="user-mention" data-user-id="116266">@Santiago Pastorino</span> sorry, was afk for a sec, did you resolve your questions?</p>



<a name="135467282"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2354499%20Invalid%20%22variable%20does%20not%20need%20to%20be%20mutable%22/near/135467282" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> pnkfelix <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2354499.20Invalid.20.22variable.20does.20not.20need.20to.20be.20mutable.22.html#135467282">(Oct 09 2018 at 13:00)</a>:</h4>
<p>but you probably want <code>std::mem::discriminant</code></p>



<a name="135467283"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2354499%20Invalid%20%22variable%20does%20not%20need%20to%20be%20mutable%22/near/135467283" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> pnkfelix <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2354499.20Invalid.20.22variable.20does.20not.20need.20to.20be.20mutable.22.html#135467283">(Oct 09 2018 at 13:00)</a>:</h4>
<p><a href="https://doc.rust-lang.org/std/mem/fn.discriminant.html" target="_blank" title="https://doc.rust-lang.org/std/mem/fn.discriminant.html">https://doc.rust-lang.org/std/mem/fn.discriminant.html</a></p>



<a name="135467288"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2354499%20Invalid%20%22variable%20does%20not%20need%20to%20be%20mutable%22/near/135467288" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2354499.20Invalid.20.22variable.20does.20not.20need.20to.20be.20mutable.22.html#135467288">(Oct 09 2018 at 13:00)</a>:</h4>
<p>fwiw I sort of hate how we implement <code>Debug</code> for most things</p>



<a name="135467294"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2354499%20Invalid%20%22variable%20does%20not%20need%20to%20be%20mutable%22/near/135467294" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2354499.20Invalid.20.22variable.20does.20not.20need.20to.20be.20mutable.22.html#135467294">(Oct 09 2018 at 13:00)</a>:</h4>
<p>though I think also having the <em>full</em> Debug output would be pretty tedious most of the time</p>



<a name="135467302"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2354499%20Invalid%20%22variable%20does%20not%20need%20to%20be%20mutable%22/near/135467302" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> pnkfelix <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2354499.20Invalid.20.22variable.20does.20not.20need.20to.20be.20mutable.22.html#135467302">(Oct 09 2018 at 13:00)</a>:</h4>
<p>Didn't at some point we have some way to select</p>



<a name="135467313"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2354499%20Invalid%20%22variable%20does%20not%20need%20to%20be%20mutable%22/near/135467313" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> pnkfelix <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2354499.20Invalid.20.22variable.20does.20not.20need.20to.20be.20mutable.22.html#135467313">(Oct 09 2018 at 13:00)</a>:</h4>
<p>verbose vs non-verbose</p>



<a name="135467315"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2354499%20Invalid%20%22variable%20does%20not%20need%20to%20be%20mutable%22/near/135467315" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2354499.20Invalid.20.22variable.20does.20not.20need.20to.20be.20mutable.22.html#135467315">(Oct 09 2018 at 13:01)</a>:</h4>
<p>we still do</p>



<a name="135467316"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2354499%20Invalid%20%22variable%20does%20not%20need%20to%20be%20mutable%22/near/135467316" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2354499.20Invalid.20.22variable.20does.20not.20need.20to.20be.20mutable.22.html#135467316">(Oct 09 2018 at 13:01)</a>:</h4>
<p><span class="user-mention" data-user-id="116009">@nikomatsakis</span> not yet but I need to find out first what is the variant of this <code>Place</code> that I was expecting to be a <code>Projection</code></p>



<a name="135467317"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2354499%20Invalid%20%22variable%20does%20not%20need%20to%20be%20mutable%22/near/135467317" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> pnkfelix <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2354499.20Invalid.20.22variable.20does.20not.20need.20to.20be.20mutable.22.html#135467317">(Oct 09 2018 at 13:01)</a>:</h4>
<p>in the format string?</p>



<a name="135467319"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2354499%20Invalid%20%22variable%20does%20not%20need%20to%20be%20mutable%22/near/135467319" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2354499.20Invalid.20.22variable.20does.20not.20need.20to.20be.20mutable.22.html#135467319">(Oct 09 2018 at 13:01)</a>:</h4>
<p>but it's not uniform</p>



<a name="135467329"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2354499%20Invalid%20%22variable%20does%20not%20need%20to%20be%20mutable%22/near/135467329" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2354499.20Invalid.20.22variable.20does.20not.20need.20to.20be.20mutable.22.html#135467329">(Oct 09 2018 at 13:01)</a>:</h4>
<p>ah, yes, we have that too</p>



<a name="135467331"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2354499%20Invalid%20%22variable%20does%20not%20need%20to%20be%20mutable%22/near/135467331" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2354499.20Invalid.20.22variable.20does.20not.20need.20to.20be.20mutable.22.html#135467331">(Oct 09 2018 at 13:01)</a>:</h4>
<p><code>{:#?}</code></p>



<a name="135467333"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2354499%20Invalid%20%22variable%20does%20not%20need%20to%20be%20mutable%22/near/135467333" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2354499.20Invalid.20.22variable.20does.20not.20need.20to.20be.20mutable.22.html#135467333">(Oct 09 2018 at 13:01)</a>:</h4>
<p>but I don't think our formatters pay any attention</p>



<a name="135467334"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2354499%20Invalid%20%22variable%20does%20not%20need%20to%20be%20mutable%22/near/135467334" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> pnkfelix <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2354499.20Invalid.20.22variable.20does.20not.20need.20to.20be.20mutable.22.html#135467334">(Oct 09 2018 at 13:01)</a>:</h4>
<p>I didn't mean <code>-Z verbose</code>, though that might be useful too</p>



<a name="135467336"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2354499%20Invalid%20%22variable%20does%20not%20need%20to%20be%20mutable%22/near/135467336" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2354499.20Invalid.20.22variable.20does.20not.20need.20to.20be.20mutable.22.html#135467336">(Oct 09 2018 at 13:01)</a>:</h4>
<p>might be nice if they did, actually</p>



<a name="135467342"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2354499%20Invalid%20%22variable%20does%20not%20need%20to%20be%20mutable%22/near/135467342" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2354499.20Invalid.20.22variable.20does.20not.20need.20to.20be.20mutable.22.html#135467342">(Oct 09 2018 at 13:01)</a>:</h4>
<p><span class="user-mention" data-user-id="116266">@Santiago Pastorino</span> what is the output string?</p>



<a name="135467359"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2354499%20Invalid%20%22variable%20does%20not%20need%20to%20be%20mutable%22/near/135467359" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> pnkfelix <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2354499.20Invalid.20.22variable.20does.20not.20need.20to.20be.20mutable.22.html#135467359">(Oct 09 2018 at 13:01)</a>:</h4>
<p>ah. We should totally leverage <code>{:#?}</code> in our <code>impl Debug</code> for MIR, or at least for Place...</p>



<a name="135467370"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2354499%20Invalid%20%22variable%20does%20not%20need%20to%20be%20mutable%22/near/135467370" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2354499.20Invalid.20.22variable.20does.20not.20need.20to.20be.20mutable.22.html#135467370">(Oct 09 2018 at 13:02)</a>:</h4>
<p>I absolutely HATE how regions print with <code>{:?}</code> by default</p>



<a name="135467416"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2354499%20Invalid%20%22variable%20does%20not%20need%20to%20be%20mutable%22/near/135467416" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2354499.20Invalid.20.22variable.20does.20not.20need.20to.20be.20mutable.22.html#135467416">(Oct 09 2018 at 13:02)</a>:</h4>
<p>that is part of what made it so !@!$! hard to debug that other problem</p>



<a name="135467432"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2354499%20Invalid%20%22variable%20does%20not%20need%20to%20be%20mutable%22/near/135467432" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> pnkfelix <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2354499.20Invalid.20.22variable.20does.20not.20need.20to.20be.20mutable.22.html#135467432">(Oct 09 2018 at 13:02)</a>:</h4>
<p>I have <code>-Z identify-regions</code></p>



<a name="135467455"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2354499%20Invalid%20%22variable%20does%20not%20need%20to%20be%20mutable%22/near/135467455" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> pnkfelix <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2354499.20Invalid.20.22variable.20does.20not.20need.20to.20be.20mutable.22.html#135467455">(Oct 09 2018 at 13:02)</a>:</h4>
<p>it used to help me with this</p>



<a name="135467475"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2354499%20Invalid%20%22variable%20does%20not%20need%20to%20be%20mutable%22/near/135467475" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> pnkfelix <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2354499.20Invalid.20.22variable.20does.20not.20need.20to.20be.20mutable.22.html#135467475">(Oct 09 2018 at 13:02)</a>:</h4>
<p>but I dont' know if it continues to work well with NLL-renumbered regions</p>



<a name="135467481"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2354499%20Invalid%20%22variable%20does%20not%20need%20to%20be%20mutable%22/near/135467481" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> pnkfelix <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2354499.20Invalid.20.22variable.20does.20not.20need.20to.20be.20mutable.22.html#135467481">(Oct 09 2018 at 13:03)</a>:</h4>
<p>it might</p>



<a name="135467513"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2354499%20Invalid%20%22variable%20does%20not%20need%20to%20be%20mutable%22/near/135467513" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2354499.20Invalid.20.22variable.20does.20not.20need.20to.20be.20mutable.22.html#135467513">(Oct 09 2018 at 13:03)</a>:</h4>
<blockquote>
<p><span class="user-mention" data-user-id="116266">@Santiago Pastorino</span> what is the output string?</p>
</blockquote>
<p>DEBUG 2018-10-09T04:59:17Z: rustc_mir::borrow_check: mutate_place: place = (_1.0: i32)</p>



<a name="135467602"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2354499%20Invalid%20%22variable%20does%20not%20need%20to%20be%20mutable%22/near/135467602" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2354499.20Invalid.20.22variable.20does.20not.20need.20to.20be.20mutable.22.html#135467602">(Oct 09 2018 at 13:04)</a>:</h4>
<p>that is (I suspect) a field projection, yes</p>



<a name="135467620"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2354499%20Invalid%20%22variable%20does%20not%20need%20to%20be%20mutable%22/near/135467620" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2354499.20Invalid.20.22variable.20does.20not.20need.20to.20be.20mutable.22.html#135467620">(Oct 09 2018 at 13:04)</a>:</h4>
<div class="codehilite"><pre><span></span><span class="w">                </span><span class="n">ProjectionElem</span>::<span class="n">Field</span><span class="p">(</span><span class="n">field</span><span class="p">,</span><span class="w"> </span><span class="n">ty</span><span class="p">)</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">                    </span><span class="n">write</span><span class="o">!</span><span class="p">(</span><span class="n">fmt</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;({:?}.{:?}: {:?})&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">data</span><span class="p">.</span><span class="n">base</span><span class="p">,</span><span class="w"> </span><span class="n">field</span><span class="p">.</span><span class="n">index</span><span class="p">(),</span><span class="w"> </span><span class="n">ty</span><span class="p">)</span><span class="w"></span>
<span class="w">                </span><span class="p">}</span><span class="w"></span>
</pre></div>



<a name="135467625"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2354499%20Invalid%20%22variable%20does%20not%20need%20to%20be%20mutable%22/near/135467625" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> pnkfelix <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2354499.20Invalid.20.22variable.20does.20not.20need.20to.20be.20mutable.22.html#135467625">(Oct 09 2018 at 13:04)</a>:</h4>
<p>I think <code>local()</code> isn't as general as <span class="user-mention" data-user-id="116266">@Santiago Pastorino</span> thought it was</p>



<a name="135467635"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2354499%20Invalid%20%22variable%20does%20not%20need%20to%20be%20mutable%22/near/135467635" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2354499.20Invalid.20.22variable.20does.20not.20need.20to.20be.20mutable.22.html#135467635">(Oct 09 2018 at 13:04)</a>:</h4>
<p>I think <code>local</code> should be fine</p>



<a name="135467637"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2354499%20Invalid%20%22variable%20does%20not%20need%20to%20be%20mutable%22/near/135467637" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> pnkfelix <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2354499.20Invalid.20.22variable.20does.20not.20need.20to.20be.20mutable.22.html#135467637">(Oct 09 2018 at 13:04)</a>:</h4>
<p>since it doesn't recur</p>



<a name="135467647"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2354499%20Invalid%20%22variable%20does%20not%20need%20to%20be%20mutable%22/near/135467647" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> pnkfelix <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2354499.20Invalid.20.22variable.20does.20not.20need.20to.20be.20mutable.22.html#135467647">(Oct 09 2018 at 13:05)</a>:</h4>
<p>and it only handles Deref projections</p>



<a name="135467648"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2354499%20Invalid%20%22variable%20does%20not%20need%20to%20be%20mutable%22/near/135467648" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2354499.20Invalid.20.22variable.20does.20not.20need.20to.20be.20mutable.22.html#135467648">(Oct 09 2018 at 13:05)</a>:</h4>
<p>wait, or maybe I am wong</p>



<a name="135467654"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2354499%20Invalid%20%22variable%20does%20not%20need%20to%20be%20mutable%22/near/135467654" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2354499.20Invalid.20.22variable.20does.20not.20need.20to.20be.20mutable.22.html#135467654">(Oct 09 2018 at 13:05)</a>:</h4>
<p>I thought it recurred</p>



<a name="135467666"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2354499%20Invalid%20%22variable%20does%20not%20need%20to%20be%20mutable%22/near/135467666" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2354499.20Invalid.20.22variable.20does.20not.20need.20to.20be.20mutable.22.html#135467666">(Oct 09 2018 at 13:05)</a>:</h4>
<p>what on earth</p>



<a name="135467684"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2354499%20Invalid%20%22variable%20does%20not%20need%20to%20be%20mutable%22/near/135467684" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> pnkfelix <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2354499.20Invalid.20.22variable.20does.20not.20need.20to.20be.20mutable.22.html#135467684">(Oct 09 2018 at 13:05)</a>:</h4>
<p><a href="https://github.com/rust-lang/rust/blob/425a1debb0de638560d277066231eedfa5c5fbd6/src/librustc/mir/mod.rs#L1971" target="_blank" title="https://github.com/rust-lang/rust/blob/425a1debb0de638560d277066231eedfa5c5fbd6/src/librustc/mir/mod.rs#L1971">https://github.com/rust-lang/rust/blob/425a1debb0de638560d277066231eedfa5c5fbd6/src/librustc/mir/mod.rs#L1971</a></p>



<a name="135467689"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2354499%20Invalid%20%22variable%20does%20not%20need%20to%20be%20mutable%22/near/135467689" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2354499.20Invalid.20.22variable.20does.20not.20need.20to.20be.20mutable.22.html#135467689">(Oct 09 2018 at 13:05)</a>:</h4>
<p>what is the point of <em>that</em></p>



<a name="135467691"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2354499%20Invalid%20%22variable%20does%20not%20need%20to%20be%20mutable%22/near/135467691" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> pnkfelix <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2354499.20Invalid.20.22variable.20does.20not.20need.20to.20be.20mutable.22.html#135467691">(Oct 09 2018 at 13:05)</a>:</h4>
<p>Don't ask me</p>



<a name="135467696"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2354499%20Invalid%20%22variable%20does%20not%20need%20to%20be%20mutable%22/near/135467696" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2354499.20Invalid.20.22variable.20does.20not.20need.20to.20be.20mutable.22.html#135467696">(Oct 09 2018 at 13:05)</a>:</h4>
<p>ok, so <span class="user-mention" data-user-id="116266">@Santiago Pastorino</span> I was wrong to suggest <code>local</code></p>



<a name="135467702"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2354499%20Invalid%20%22variable%20does%20not%20need%20to%20be%20mutable%22/near/135467702" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2354499.20Invalid.20.22variable.20does.20not.20need.20to.20be.20mutable.22.html#135467702">(Oct 09 2018 at 13:05)</a>:</h4>
<p>which apparently does something a bit strange</p>



<a name="135467707"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2354499%20Invalid%20%22variable%20does%20not%20need%20to%20be%20mutable%22/near/135467707" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> pnkfelix <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2354499.20Invalid.20.22variable.20does.20not.20need.20to.20be.20mutable.22.html#135467707">(Oct 09 2018 at 13:05)</a>:</h4>
<p>/me goes to use git blame to find out if in fact @pnkfelix <em>is</em> to blame for this</p>



<a name="135467748"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2354499%20Invalid%20%22variable%20does%20not%20need%20to%20be%20mutable%22/near/135467748" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2354499.20Invalid.20.22variable.20does.20not.20need.20to.20be.20mutable.22.html#135467748">(Oct 09 2018 at 13:06)</a>:</h4>
<p>and not what it's doc string suggests (to me)</p>



<a name="135467771"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2354499%20Invalid%20%22variable%20does%20not%20need%20to%20be%20mutable%22/near/135467771" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2354499.20Invalid.20.22variable.20does.20not.20need.20to.20be.20mutable.22.html#135467771">(Oct 09 2018 at 13:06)</a>:</h4>
<p>I shouldn't be so harsh :) I'm sure it made sense at the time</p>



<a name="135467780"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2354499%20Invalid%20%22variable%20does%20not%20need%20to%20be%20mutable%22/near/135467780" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2354499.20Invalid.20.22variable.20does.20not.20need.20to.20be.20mutable.22.html#135467780">(Oct 09 2018 at 13:06)</a>:</h4>
<p>it's just not what I anticipated</p>



<a name="135467788"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2354499%20Invalid%20%22variable%20does%20not%20need%20to%20be%20mutable%22/near/135467788" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> pnkfelix <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2354499.20Invalid.20.22variable.20does.20not.20need.20to.20be.20mutable.22.html#135467788">(Oct 09 2018 at 13:06)</a>:</h4>
<p>/me wasn't in the habit of checking <span class="user-mention" data-user-id="116107">@davidtwco</span> 's code for patterns of the form <code>base: Place::Local</code> back at that time. :)</p>



<a name="135467793"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2354499%20Invalid%20%22variable%20does%20not%20need%20to%20be%20mutable%22/near/135467793" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2354499.20Invalid.20.22variable.20does.20not.20need.20to.20be.20mutable.22.html#135467793">(Oct 09 2018 at 13:06)</a>:</h4>
<p>the question is, is it what we actually <em>want</em> for the other callers</p>



<a name="135467812"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2354499%20Invalid%20%22variable%20does%20not%20need%20to%20be%20mutable%22/near/135467812" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2354499.20Invalid.20.22variable.20does.20not.20need.20to.20be.20mutable.22.html#135467812">(Oct 09 2018 at 13:07)</a>:</h4>
<p>looks like it is only used in some debug output</p>



<a name="135467813"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2354499%20Invalid%20%22variable%20does%20not%20need%20to%20be%20mutable%22/near/135467813" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> pnkfelix <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2354499.20Invalid.20.22variable.20does.20not.20need.20to.20be.20mutable.22.html#135467813">(Oct 09 2018 at 13:07)</a>:</h4>
<p>I'm betting that it will be fine to generalize it</p>



<a name="135467815"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2354499%20Invalid%20%22variable%20does%20not%20need%20to%20be%20mutable%22/near/135467815" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2354499.20Invalid.20.22variable.20does.20not.20need.20to.20be.20mutable.22.html#135467815">(Oct 09 2018 at 13:07)</a>:</h4>
<p>I would expect so</p>



<a name="135483572"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2354499%20Invalid%20%22variable%20does%20not%20need%20to%20be%20mutable%22/near/135483572" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2354499.20Invalid.20.22variable.20does.20not.20need.20to.20be.20mutable.22.html#135483572">(Oct 09 2018 at 17:06)</a>:</h4>
<p>hey I'm back</p>



<a name="135483624"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2354499%20Invalid%20%22variable%20does%20not%20need%20to%20be%20mutable%22/near/135483624" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2354499.20Invalid.20.22variable.20does.20not.20need.20to.20be.20mutable.22.html#135483624">(Oct 09 2018 at 17:06)</a>:</h4>
<p><span class="user-mention" data-user-id="116009">@nikomatsakis</span> when you suggested me to use <code>local()</code> I trusted you that was gonna work regardless I saw it wasn't making the recursion</p>



<a name="135483627"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2354499%20Invalid%20%22variable%20does%20not%20need%20to%20be%20mutable%22/near/135483627" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2354499.20Invalid.20.22variable.20does.20not.20need.20to.20be.20mutable.22.html#135483627">(Oct 09 2018 at 17:06)</a>:</h4>
<p>given that this case was just one level deep</p>



<a name="135483654"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2354499%20Invalid%20%22variable%20does%20not%20need%20to%20be%20mutable%22/near/135483654" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2354499.20Invalid.20.22variable.20does.20not.20need.20to.20be.20mutable.22.html#135483654">(Oct 09 2018 at 17:07)</a>:</h4>
<p>but anyway I saved a question which was ... what's the point for RootPlace then? :)</p>



<a name="135483659"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2354499%20Invalid%20%22variable%20does%20not%20need%20to%20be%20mutable%22/near/135483659" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2354499.20Invalid.20.22variable.20does.20not.20need.20to.20be.20mutable.22.html#135483659">(Oct 09 2018 at 17:07)</a>:</h4>
<p>now I see</p>



<a name="135483674"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2354499%20Invalid%20%22variable%20does%20not%20need%20to%20be%20mutable%22/near/135483674" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2354499.20Invalid.20.22variable.20does.20not.20need.20to.20be.20mutable.22.html#135483674">(Oct 09 2018 at 17:07)</a>:</h4>
<p>what if we properly implement <code>local()</code> and maybe even remove RootPlace?</p>



<a name="135483736"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2354499%20Invalid%20%22variable%20does%20not%20need%20to%20be%20mutable%22/near/135483736" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2354499.20Invalid.20.22variable.20does.20not.20need.20to.20be.20mutable.22.html#135483736">(Oct 09 2018 at 17:08)</a>:</h4>
<p>I guess we may need to be careful about performance but I guess it worth checking how RootPlace is generated and if we can generate something like that with same perf</p>



<a name="135483741"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2354499%20Invalid%20%22variable%20does%20not%20need%20to%20be%20mutable%22/near/135483741" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2354499.20Invalid.20.22variable.20does.20not.20need.20to.20be.20mutable.22.html#135483741">(Oct 09 2018 at 17:08)</a>:</h4>
<p>or maybe just implement <code>local()</code> properly?</p>



<a name="135483959"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2354499%20Invalid%20%22variable%20does%20not%20need%20to%20be%20mutable%22/near/135483959" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2354499.20Invalid.20.22variable.20does.20not.20need.20to.20be.20mutable.22.html#135483959">(Oct 09 2018 at 17:12)</a>:</h4>
<p>I believe that <code>RootPlace</code> plays a different role</p>



<a name="135483962"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2354499%20Invalid%20%22variable%20does%20not%20need%20to%20be%20mutable%22/near/135483962" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2354499.20Invalid.20.22variable.20does.20not.20need.20to.20be.20mutable.22.html#135483962">(Oct 09 2018 at 17:12)</a>:</h4>
<p>so I dont' think we can just remove it</p>



<a name="135483971"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2354499%20Invalid%20%22variable%20does%20not%20need%20to%20be%20mutable%22/near/135483971" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2354499.20Invalid.20.22variable.20does.20not.20need.20to.20be.20mutable.22.html#135483971">(Oct 09 2018 at 17:12)</a>:</h4>
<p>it indicates the place <em>from which the mutability comes</em></p>



<a name="135483973"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2354499%20Invalid%20%22variable%20does%20not%20need%20to%20be%20mutable%22/near/135483973" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2354499.20Invalid.20.22variable.20does.20not.20need.20to.20be.20mutable.22.html#135483973">(Oct 09 2018 at 17:12)</a>:</h4>
<p>which isn't always the local variable</p>



<a name="135483985"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2354499%20Invalid%20%22variable%20does%20not%20need%20to%20be%20mutable%22/near/135483985" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2354499.20Invalid.20.22variable.20does.20not.20need.20to.20be.20mutable.22.html#135483985">(Oct 09 2018 at 17:13)</a>:</h4>
<p>e.g., if you have a <code>x: &amp;mut Foo</code>, and you have a place <code>(*x).bar</code></p>



<a name="135483990"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2354499%20Invalid%20%22variable%20does%20not%20need%20to%20be%20mutable%22/near/135483990" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2354499.20Invalid.20.22variable.20does.20not.20need.20to.20be.20mutable.22.html#135483990">(Oct 09 2018 at 17:13)</a>:</h4>
<p>then the mutability of that place is not dependent on whether the local variable <code>x</code> is mutable</p>



<a name="135483992"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2354499%20Invalid%20%22variable%20does%20not%20need%20to%20be%20mutable%22/near/135483992" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2354499.20Invalid.20.22variable.20does.20not.20need.20to.20be.20mutable.22.html#135483992">(Oct 09 2018 at 17:13)</a>:</h4>
<p>I see</p>



<a name="135483994"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2354499%20Invalid%20%22variable%20does%20not%20need%20to%20be%20mutable%22/near/135483994" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2354499.20Invalid.20.22variable.20does.20not.20need.20to.20be.20mutable.22.html#135483994">(Oct 09 2018 at 17:13)</a>:</h4>
<p><em>however</em></p>



<a name="135484000"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2354499%20Invalid%20%22variable%20does%20not%20need%20to%20be%20mutable%22/near/135484000" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2354499.20Invalid.20.22variable.20does.20not.20need.20to.20be.20mutable.22.html#135484000">(Oct 09 2018 at 17:13)</a>:</h4>
<p>the name made me think of a different meaning</p>



<a name="135484001"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2354499%20Invalid%20%22variable%20does%20not%20need%20to%20be%20mutable%22/near/135484001" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2354499.20Invalid.20.22variable.20does.20not.20need.20to.20be.20mutable.22.html#135484001">(Oct 09 2018 at 17:13)</a>:</h4>
<p>for our purposes, we can just look at <code>x</code></p>



<a name="135484005"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2354499%20Invalid%20%22variable%20does%20not%20need%20to%20be%20mutable%22/near/135484005" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2354499.20Invalid.20.22variable.20does.20not.20need.20to.20be.20mutable.22.html#135484005">(Oct 09 2018 at 17:13)</a>:</h4>
<p>because -- in the case above -- <code>x</code> would have to be initialized</p>



<a name="135484006"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2354499%20Invalid%20%22variable%20does%20not%20need%20to%20be%20mutable%22/near/135484006" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2354499.20Invalid.20.22variable.20does.20not.20need.20to.20be.20mutable.22.html#135484006">(Oct 09 2018 at 17:13)</a>:</h4>
<p>or else you would have an error</p>



<a name="135484011"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2354499%20Invalid%20%22variable%20does%20not%20need%20to%20be%20mutable%22/near/135484011" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2354499.20Invalid.20.22variable.20does.20not.20need.20to.20be.20mutable.22.html#135484011">(Oct 09 2018 at 17:13)</a>:</h4>
<p>same as for <code>x.bar = ...</code> (with no deref)</p>



<a name="135484057"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2354499%20Invalid%20%22variable%20does%20not%20need%20to%20be%20mutable%22/near/135484057" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2354499.20Invalid.20.22variable.20does.20not.20need.20to.20be.20mutable.22.html#135484057">(Oct 09 2018 at 17:14)</a>:</h4>
<p>basically, we don't care about derefs, because to make the reference in the first place, the referent must be initialized</p>



<a name="135484062"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2354499%20Invalid%20%22variable%20does%20not%20need%20to%20be%20mutable%22/near/135484062" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2354499.20Invalid.20.22variable.20does.20not.20need.20to.20be.20mutable.22.html#135484062">(Oct 09 2018 at 17:14)</a>:</h4>
<p>yep to derefs :)</p>



<a name="135484083"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2354499%20Invalid%20%22variable%20does%20not%20need%20to%20be%20mutable%22/near/135484083" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2354499.20Invalid.20.22variable.20does.20not.20need.20to.20be.20mutable.22.html#135484083">(Oct 09 2018 at 17:15)</a>:</h4>
<p>so unsure if I follow we need to navigate <code>Projection</code> until we find what?</p>



<a name="135484206"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2354499%20Invalid%20%22variable%20does%20not%20need%20to%20be%20mutable%22/near/135484206" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2354499.20Invalid.20.22variable.20does.20not.20need.20to.20be.20mutable.22.html#135484206">(Oct 09 2018 at 17:16)</a>:</h4>
<p>something that is not a projection :)</p>



<a name="135484236"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2354499%20Invalid%20%22variable%20does%20not%20need%20to%20be%20mutable%22/near/135484236" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2354499.20Invalid.20.22variable.20does.20not.20need.20to.20be.20mutable.22.html#135484236">(Oct 09 2018 at 17:17)</a>:</h4>
<p>my expectation was that <code>local</code> would be something like:</p>
<div class="codehilite"><pre><span></span><span class="k">fn</span> <span class="nf">base_local</span><span class="p">(</span><span class="o">&amp;</span><span class="bp">self</span><span class="p">)</span><span class="w"> </span>-&gt; <span class="nb">Option</span><span class="o">&lt;</span><span class="n">Local</span><span class="o">&gt;</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="k">match</span><span class="w"> </span><span class="bp">self</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">        </span><span class="n">Projection</span><span class="p">(</span><span class="n">base</span><span class="p">,</span><span class="w"> </span><span class="n">_</span><span class="p">)</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="n">base</span><span class="p">.</span><span class="n">base_local</span><span class="p">(),</span><span class="w"></span>
<span class="w">        </span><span class="n">Local</span><span class="p">(</span><span class="n">l</span><span class="p">)</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="nb">Some</span><span class="p">(</span><span class="n">l</span><span class="p">),</span><span class="w"></span>
<span class="w">        </span><span class="n">Static</span><span class="p">(..)</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">Promoted</span><span class="p">(..)</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="nb">None</span><span class="p">,</span><span class="w"></span>
<span class="w">    </span><span class="p">}</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>
</pre></div>


<p>(Note: I would not use <code>_</code> here)</p>



<a name="135484515"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2354499%20Invalid%20%22variable%20does%20not%20need%20to%20be%20mutable%22/near/135484515" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2354499.20Invalid.20.22variable.20does.20not.20need.20to.20be.20mutable.22.html#135484515">(Oct 09 2018 at 17:22)</a>:</h4>
<p>hmm I'm not understanding properly</p>



<a name="135484522"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2354499%20Invalid%20%22variable%20does%20not%20need%20to%20be%20mutable%22/near/135484522" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2354499.20Invalid.20.22variable.20does.20not.20need.20to.20be.20mutable.22.html#135484522">(Oct 09 2018 at 17:22)</a>:</h4>
<p>why just that?</p>



<a name="135484528"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2354499%20Invalid%20%22variable%20does%20not%20need%20to%20be%20mutable%22/near/135484528" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2354499.20Invalid.20.22variable.20does.20not.20need.20to.20be.20mutable.22.html#135484528">(Oct 09 2018 at 17:22)</a>:</h4>
<p>why <code>local()</code> is different?</p>



<a name="135484536"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2354499%20Invalid%20%22variable%20does%20not%20need%20to%20be%20mutable%22/near/135484536" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2354499.20Invalid.20.22variable.20does.20not.20need.20to.20be.20mutable.22.html#135484536">(Oct 09 2018 at 17:22)</a>:</h4>
<p><code>_</code> would be just <code>Static</code> and <code>Promoted</code></p>



<a name="135484586"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2354499%20Invalid%20%22variable%20does%20not%20need%20to%20be%20mutable%22/near/135484586" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2354499.20Invalid.20.22variable.20does.20not.20need.20to.20be.20mutable.22.html#135484586">(Oct 09 2018 at 17:23)</a>:</h4>
<p>why wouldn't it be different?</p>



<a name="135484594"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2354499%20Invalid%20%22variable%20does%20not%20need%20to%20be%20mutable%22/near/135484594" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2354499.20Invalid.20.22variable.20does.20not.20need.20to.20be.20mutable.22.html#135484594">(Oct 09 2018 at 17:23)</a>:</h4>
<p>I'm confused what you mean, I guess</p>



<a name="135484598"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2354499%20Invalid%20%22variable%20does%20not%20need%20to%20be%20mutable%22/near/135484598" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2354499.20Invalid.20.22variable.20does.20not.20need.20to.20be.20mutable.22.html#135484598">(Oct 09 2018 at 17:24)</a>:</h4>
<p>the point of this is to return the "root local variable" (if any)</p>



<a name="135484639"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2354499%20Invalid%20%22variable%20does%20not%20need%20to%20be%20mutable%22/near/135484639" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2354499.20Invalid.20.22variable.20does.20not.20need.20to.20be.20mutable.22.html#135484639">(Oct 09 2018 at 17:24)</a>:</h4>
<p>are you asking, why avoid <code>_</code>?</p>



<a name="135484646"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2354499%20Invalid%20%22variable%20does%20not%20need%20to%20be%20mutable%22/near/135484646" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2354499.20Invalid.20.22variable.20does.20not.20need.20to.20be.20mutable.22.html#135484646">(Oct 09 2018 at 17:24)</a>:</h4>
<p>the answer is: in general I disapprove of <code>_</code></p>



<a name="135484649"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2354499%20Invalid%20%22variable%20does%20not%20need%20to%20be%20mutable%22/near/135484649" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2354499.20Invalid.20.22variable.20does.20not.20need.20to.20be.20mutable.22.html#135484649">(Oct 09 2018 at 17:24)</a>:</h4>
<p>I'm asking 3 things</p>



<a name="135484652"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2354499%20Invalid%20%22variable%20does%20not%20need%20to%20be%20mutable%22/near/135484652" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2354499.20Invalid.20.22variable.20does.20not.20need.20to.20be.20mutable.22.html#135484652">(Oct 09 2018 at 17:24)</a>:</h4>
<p>because it is not "future proof" when the enum changes</p>



<a name="135484662"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2354499%20Invalid%20%22variable%20does%20not%20need%20to%20be%20mutable%22/near/135484662" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2354499.20Invalid.20.22variable.20does.20not.20need.20to.20be.20mutable.22.html#135484662">(Oct 09 2018 at 17:24)</a>:</h4>
<blockquote>
<p>the answer is: in general I disapprove of <code>_</code></p>
</blockquote>
<p>agree with this, just wanted to point out that it was equivalent to what was going on in the <code>local()</code> case</p>



<a name="135484668"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2354499%20Invalid%20%22variable%20does%20not%20need%20to%20be%20mutable%22/near/135484668" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2354499.20Invalid.20.22variable.20does.20not.20need.20to.20be.20mutable.22.html#135484668">(Oct 09 2018 at 17:24)</a>:</h4>
<p>equivalent how?</p>



<a name="135484678"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2354499%20Invalid%20%22variable%20does%20not%20need%20to%20be%20mutable%22/near/135484678" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2354499.20Invalid.20.22variable.20does.20not.20need.20to.20be.20mutable.22.html#135484678">(Oct 09 2018 at 17:25)</a>:</h4>
<p>in the function as it is, it only recurses for one specific kind of projection</p>



<a name="135484680"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2354499%20Invalid%20%22variable%20does%20not%20need%20to%20be%20mutable%22/near/135484680" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2354499.20Invalid.20.22variable.20does.20not.20need.20to.20be.20mutable.22.html#135484680">(Oct 09 2018 at 17:25)</a>:</h4>
<p>a deref</p>



<a name="135484683"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2354499%20Invalid%20%22variable%20does%20not%20need%20to%20be%20mutable%22/near/135484683" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2354499.20Invalid.20.22variable.20does.20not.20need.20to.20be.20mutable.22.html#135484683">(Oct 09 2018 at 17:25)</a>:</h4>
<p>because the rest of the 2 variants are <code>Static</code> and <code>Promoted</code></p>



<a name="135484694"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2354499%20Invalid%20%22variable%20does%20not%20need%20to%20be%20mutable%22/near/135484694" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2354499.20Invalid.20.22variable.20does.20not.20need.20to.20be.20mutable.22.html#135484694">(Oct 09 2018 at 17:25)</a>:</h4>
<p>note that statics / promoted paths are also "root" paths that have no base path, so you can't recurse there</p>



<a name="135484696"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2354499%20Invalid%20%22variable%20does%20not%20need%20to%20be%20mutable%22/near/135484696" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2354499.20Invalid.20.22variable.20does.20not.20need.20to.20be.20mutable.22.html#135484696">(Oct 09 2018 at 17:25)</a>:</h4>
<p>yes, I'm talking about the other part of the match</p>



<a name="135484704"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2354499%20Invalid%20%22variable%20does%20not%20need%20to%20be%20mutable%22/near/135484704" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2354499.20Invalid.20.22variable.20does.20not.20need.20to.20be.20mutable.22.html#135484704">(Oct 09 2018 at 17:25)</a>:</h4>
<p>I see</p>



<a name="135484705"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2354499%20Invalid%20%22variable%20does%20not%20need%20to%20be%20mutable%22/near/135484705" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2354499.20Invalid.20.22variable.20does.20not.20need.20to.20be.20mutable.22.html#135484705">(Oct 09 2018 at 17:25)</a>:</h4>
<p>I was wondering why do not change <code>local()</code></p>



<a name="135484709"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2354499%20Invalid%20%22variable%20does%20not%20need%20to%20be%20mutable%22/near/135484709" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2354499.20Invalid.20.22variable.20does.20not.20need.20to.20be.20mutable.22.html#135484709">(Oct 09 2018 at 17:25)</a>:</h4>
<p>well</p>



<a name="135484715"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2354499%20Invalid%20%22variable%20does%20not%20need%20to%20be%20mutable%22/near/135484715" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2354499.20Invalid.20.22variable.20does.20not.20need.20to.20be.20mutable.22.html#135484715">(Oct 09 2018 at 17:25)</a>:</h4>
<p>so in general I think the setup of <code>Place</code> is ungreat</p>



<a name="135484758"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2354499%20Invalid%20%22variable%20does%20not%20need%20to%20be%20mutable%22/near/135484758" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jake Goulding <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2354499.20Invalid.20.22variable.20does.20not.20need.20to.20be.20mutable.22.html#135484758">(Oct 09 2018 at 17:26)</a>:</h4>
<blockquote>
<p>I disapprove of <code>_</code></p>
</blockquote>
<p>... instead preferring <code>..</code>, right?</p>



<a name="135484765"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2354499%20Invalid%20%22variable%20does%20not%20need%20to%20be%20mutable%22/near/135484765" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2354499.20Invalid.20.22variable.20does.20not.20need.20to.20be.20mutable.22.html#135484765">(Oct 09 2018 at 17:26)</a>:</h4>
<p>but refactoring it has proven slow going (<span class="user-mention" data-user-id="116773">@csmoe</span> has been wokring on it)</p>



<a name="135484772"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2354499%20Invalid%20%22variable%20does%20not%20need%20to%20be%20mutable%22/near/135484772" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2354499.20Invalid.20.22variable.20does.20not.20need.20to.20be.20mutable.22.html#135484772">(Oct 09 2018 at 17:26)</a>:</h4>
<blockquote>
<blockquote>
<p>I disapprove of <code>_</code></p>
</blockquote>
<p>... instead preferring <code>..</code>, right?</p>
</blockquote>
<p>lol</p>



<a name="135484785"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2354499%20Invalid%20%22variable%20does%20not%20need%20to%20be%20mutable%22/near/135484785" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2354499.20Invalid.20.22variable.20does.20not.20need.20to.20be.20mutable.22.html#135484785">(Oct 09 2018 at 17:26)</a>:</h4>
<p>in particular, in this case, I think it'd be nice to have a distinction between "base" and "projection", where base = (Local | Static | Promoted), and to return a <code>Option&lt;Base&gt;</code></p>



<a name="135484791"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2354499%20Invalid%20%22variable%20does%20not%20need%20to%20be%20mutable%22/near/135484791" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2354499.20Invalid.20.22variable.20does.20not.20need.20to.20be.20mutable.22.html#135484791">(Oct 09 2018 at 17:27)</a>:</h4>
<p>but we don't have such a type right now...</p>



<a name="135484814"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2354499%20Invalid%20%22variable%20does%20not%20need%20to%20be%20mutable%22/near/135484814" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2354499.20Invalid.20.22variable.20does.20not.20need.20to.20be.20mutable.22.html#135484814">(Oct 09 2018 at 17:27)</a>:</h4>
<p>and we are returning <code>None</code> for <code>Static</code> and <code>Promoted</code></p>



<a name="135484818"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2354499%20Invalid%20%22variable%20does%20not%20need%20to%20be%20mutable%22/near/135484818" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2354499.20Invalid.20.22variable.20does.20not.20need.20to.20be.20mutable.22.html#135484818">(Oct 09 2018 at 17:27)</a>:</h4>
<p>so is not really base</p>



<a name="135484880"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2354499%20Invalid%20%22variable%20does%20not%20need%20to%20be%20mutable%22/near/135484880" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2354499.20Invalid.20.22variable.20does.20not.20need.20to.20be.20mutable.22.html#135484880">(Oct 09 2018 at 17:28)</a>:</h4>
<p>right, it's just the <em>base local</em></p>



<a name="135484890"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2354499%20Invalid%20%22variable%20does%20not%20need%20to%20be%20mutable%22/near/135484890" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2354499.20Invalid.20.22variable.20does.20not.20need.20to.20be.20mutable.22.html#135484890">(Oct 09 2018 at 17:28)</a>:</h4>
<p>but for our purposes, that suffices</p>



<a name="135484896"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2354499%20Invalid%20%22variable%20does%20not%20need%20to%20be%20mutable%22/near/135484896" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2354499.20Invalid.20.22variable.20does.20not.20need.20to.20be.20mutable.22.html#135484896">(Oct 09 2018 at 17:28)</a>:</h4>
<p><span class="emoji emoji-1f44d" title="+1">:+1:</span></p>



<a name="135484900"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2354499%20Invalid%20%22variable%20does%20not%20need%20to%20be%20mutable%22/near/135484900" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2354499.20Invalid.20.22variable.20does.20not.20need.20to.20be.20mutable.22.html#135484900">(Oct 09 2018 at 17:28)</a>:</h4>
<p>in particular, <code>FOO.bar = ...</code> doesn't have to care whether <code>FOO</code> is initialized</p>



<a name="135484902"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2354499%20Invalid%20%22variable%20does%20not%20need%20to%20be%20mutable%22/near/135484902" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2354499.20Invalid.20.22variable.20does.20not.20need.20to.20be.20mutable.22.html#135484902">(Oct 09 2018 at 17:28)</a>:</h4>
<p>since all statics are always initialized</p>



<a name="135484903"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2354499%20Invalid%20%22variable%20does%20not%20need%20to%20be%20mutable%22/near/135484903" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2354499.20Invalid.20.22variable.20does.20not.20need.20to.20be.20mutable.22.html#135484903">(Oct 09 2018 at 17:28)</a>:</h4>
<p>same for constants</p>



<a name="135484905"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2354499%20Invalid%20%22variable%20does%20not%20need%20to%20be%20mutable%22/near/135484905" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2354499.20Invalid.20.22variable.20does.20not.20need.20to.20be.20mutable.22.html#135484905">(Oct 09 2018 at 17:29)</a>:</h4>
<p>(that will be an error anyway, but for other reasons)</p>



<a name="135484915"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2354499%20Invalid%20%22variable%20does%20not%20need%20to%20be%20mutable%22/near/135484915" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2354499.20Invalid.20.22variable.20does.20not.20need.20to.20be.20mutable.22.html#135484915">(Oct 09 2018 at 17:29)</a>:</h4>
<p>yes</p>



<a name="135486495"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2354499%20Invalid%20%22variable%20does%20not%20need%20to%20be%20mutable%22/near/135486495" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2354499.20Invalid.20.22variable.20does.20not.20need.20to.20be.20mutable.22.html#135486495">(Oct 09 2018 at 17:54)</a>:</h4>
<div class="codehilite"><pre><span></span>[santiago@archlinux rust1 (invalid-no-need-mut)]$ RUST_BACKTRACE=1 rustc +rust-dev test.rs
error: internal compiler error: Error constructed but not emitted

thread &#39;main&#39; panicked at &#39;explicit panic&#39;, librustc_errors/diagnostic_builder.rs:340:13
stack backtrace:
   0: std::sys::unix::backtrace::tracing::imp::unwind_backtrace
             at libstd/sys/unix/backtrace/tracing/gcc_s.rs:49
   1: std::sys_common::backtrace::print
             at libstd/sys_common/backtrace.rs:71
             at libstd/sys_common/backtrace.rs:59
   2: std::panicking::default_hook::{{closure}}
             at libstd/panicking.rs:211
   3: std::panicking::default_hook
             at libstd/panicking.rs:227
   4: rustc::util::common::panic_hook
             at librustc/util/common.rs:51
   5: std::panicking::rust_panic_with_hook
             at libstd/panicking.rs:480
   6: std::panicking::begin_panic
             at libstd/panicking.rs:410
   7: &lt;rustc_errors::diagnostic_builder::DiagnosticBuilder&lt;&#39;a&gt; as core::ops::drop::Drop&gt;::drop
             at librustc_errors/diagnostic_builder.rs:340
   8: rustc_mir::borrow_check::MirBorrowckCtxt::mutate_place
             at ./src/libcore/ptr.rs:194
             at librustc_mir/borrow_check/mod.rs:1132
   9: &lt;rustc_mir::borrow_check::MirBorrowckCtxt&lt;&#39;cx, &#39;gcx, &#39;tcx&gt; as rustc_mir::dataflow::DataflowResultsConsumer&lt;&#39;cx, &#39;tcx&gt;&gt;::visit_statement_entry
             at librustc_mir/borrow_check/mod.rs:0
  10: rustc_mir::dataflow::DataflowResultsConsumer::process_basic_block
             at librustc_mir/dataflow/mod.rs:328
  11: rustc_mir::dataflow::DataflowResultsConsumer::analyze_results
             at librustc_mir/dataflow/mod.rs:318
  12: rustc_mir::borrow_check::do_mir_borrowck
             at librustc_mir/borrow_check/mod.rs:278
  13: rustc::ty::context::tls::set_tlv
             at librustc_mir/borrow_check/mod.rs:124
             at ./src/librustc/infer/mod.rs:508
             at ./src/librustc/ty/context.rs:1676
             at ./src/librustc/ty/context.rs:2022
             at ./src/librustc/ty/context.rs:1961
  14: rustc::ty::context::tls::with_context_opt
             at ./src/librustc/ty/context.rs:2021
             at ./src/librustc/ty/context.rs:1675
             at ./src/librustc/ty/context.rs:2122
             at ./src/librustc/ty/context.rs:2106
             at ./src/librustc/ty/context.rs:2097
  15: rustc::infer::InferCtxtBuilder::enter
             at ./src/librustc/ty/context.rs:2106
             at ./src/librustc/ty/context.rs:2117
             at ./src/librustc/ty/context.rs:1668
             at ./src/librustc/infer/mod.rs:507
  16: rustc_mir::borrow_check::mir_borrowck
             at librustc_mir/borrow_check/mod.rs:122
  17: rustc::ty::query::__query_compute::mir_borrowck
             at librustc/ty/query/plumbing.rs:834
             at librustc/ty/query/plumbing.rs:796
  18: rustc::ty::query::&lt;impl rustc::ty::query::config::QueryAccessors&lt;&#39;tcx&gt; for rustc::ty::query::queries::mir_borrowck&lt;&#39;tcx&gt;&gt;::compute
             at librustc/ty/query/plumbing.rs:826
  19: rustc::dep_graph::graph::DepGraph::with_task_impl
             at librustc/dep_graph/graph.rs:342
  20: rustc::ty::context::tls::set_tlv
             at librustc/dep_graph/graph.rs:208
             at librustc/ty/query/plumbing.rs:550
             at librustc/ty/query/plumbing.rs:208
             at librustc/ty/context.rs:2022
             at librustc/ty/context.rs:1961
  21: rustc::ty::context::tls::with_context_opt
             at librustc/ty/context.rs:2021
             at librustc/ty/query/plumbing.rs:207
             at librustc/ty/context.rs:2122
             at librustc/ty/context.rs:2106
             at librustc/ty/context.rs:2097
  22: &lt;rustc::ty::query::plumbing::JobOwner&lt;&#39;a, &#39;tcx, Q&gt;&gt;::start
             at librustc/ty/context.rs:2106
             at librustc/ty/context.rs:2117
             at librustc/ty/query/plumbing.rs:197
  23: rustc::ty::query::plumbing::&lt;impl rustc::ty::context::TyCtxt&lt;&#39;a, &#39;gcx, &#39;tcx&gt;&gt;::force_query_with_job
             at librustc/ty/query/plumbing.rs:543
  24: rustc::ty::query::plumbing::&lt;impl rustc::ty::context::TyCtxt&lt;&#39;a, &#39;gcx, &#39;tcx&gt;&gt;::get_query
             at librustc/ty/query/plumbing.rs:383
             at librustc/ty/query/plumbing.rs:629
             at librustc/ty/query/plumbing.rs:640
  25: rustc::ty::query::&lt;impl rustc::ty::context::TyCtxt&lt;&#39;a, &#39;tcx, &#39;lcx&gt;&gt;::mir_borrowck
             at librustc/ty/query/plumbing.rs:888
             at librustc/ty/query/plumbing.rs:881
  26: rustc::ty::&lt;impl rustc::ty::context::TyCtxt&lt;&#39;a, &#39;gcx, &#39;tcx&gt;&gt;::par_body_owners
             at librustc_driver/driver.rs:1322
             at ./src/librustc/ty/mod.rs:2576
             at ./src/libcore/iter/iterator.rs:553
             at ./src/libcore/slice/mod.rs:2737
             at ./src/libcore/iter/iterator.rs:553
             at ./src/librustc/ty/mod.rs:2575
  27: rustc::util::common::time_ext
             at librustc_driver/driver.rs:1322
             at ./src/librustc/util/common.rs:163
  28: rustc::ty::context::tls::set_tlv
             at ./src/librustc/util/common.rs:157
             at librustc_driver/driver.rs:1320
             at ./src/librustc/ty/context.rs:2054
             at ./src/librustc/ty/context.rs:2022
             at ./src/librustc/ty/context.rs:1961
  29: &lt;std::thread::local::LocalKey&lt;T&gt;&gt;::try_with
             at ./src/librustc/ty/context.rs:2021
             at ./src/librustc/ty/context.rs:2053
             at ./src/librustc/ty/context.rs:2011
             at ./src/libstd/thread/local.rs:294
  30: &lt;std::thread::local::LocalKey&lt;T&gt;&gt;::try_with
             at ./src/libstd/thread/local.rs:248
             at ./src/librustc/ty/context.rs:2003
             at ./src/libstd/thread/local.rs:294
  31: rustc::ty::context::TyCtxt::create_and_enter
             at ./src/libstd/thread/local.rs:248
             at ./src/librustc/ty/context.rs:1995
             at ./src/librustc/ty/context.rs:2033
             at ./src/librustc/ty/context.rs:1249
  32: rustc_driver::driver::phase_3_run_analysis_passes
             at librustc_driver/driver.rs:1259
  33: rustc_driver::driver::compile_input
             at librustc_driver/driver.rs:287
  34: rustc_driver::run_compiler_with_pool
             at librustc_driver/lib.rs:563
  35: &lt;scoped_tls::ScopedKey&lt;T&gt;&gt;::set
             at librustc_driver/lib.rs:485
             at librustc_driver/driver.rs:76
             at /home/santiago/.cargo/registry/src/github.com-1ecc6299db9ec823/scoped-tls-0.1.2/src/lib.rs:155
  36: rustc_driver::run_compiler
             at librustc_driver/driver.rs:75
             at librustc_driver/lib.rs:484
  37: &lt;scoped_tls::ScopedKey&lt;T&gt;&gt;::set
             at librustc_driver/lib.rs:1746
             at librustc_driver/lib.rs:190
             at /home/santiago/.cargo/registry/src/github.com-1ecc6299db9ec823/scoped-tls-0.1.2/src/lib.rs:155
  38: &lt;scoped_tls::ScopedKey&lt;T&gt;&gt;::set
             at ./src/libsyntax/lib.rs:106
             at /home/santiago/.cargo/registry/src/github.com-1ecc6299db9ec823/scoped-tls-0.1.2/src/lib.rs:155
  39: std::panicking::try::do_call
             at ./src/libsyntax/lib.rs:105
             at librustc_driver/lib.rs:189
             at librustc_driver/lib.rs:1661
             at ./src/libstd/panic.rs:313
             at ./src/libstd/panicking.rs:310
  40: __rust_maybe_catch_panic
             at libpanic_unwind/lib.rs:102
  41: std::panicking::try
             at ./src/libstd/panicking.rs:289
  42: rustc_driver::in_named_rustc_thread
             at ./src/libstd/panic.rs:392
             at librustc_driver/lib.rs:1575
  43: rustc_driver::monitor
             at librustc_driver/lib.rs:1586
             at librustc_driver/lib.rs:1660
  44: rustc_driver::run
             at librustc_driver/lib.rs:188
  45: rustc_driver::main
             at librustc_driver/lib.rs:1739
  46: std::rt::lang_start::{{closure}}
             at ./src/libstd/rt.rs:74
  47: std::panicking::try::do_call
             at libstd/rt.rs:59
             at libstd/panicking.rs:310
  48: __rust_maybe_catch_panic
             at libpanic_unwind/lib.rs:102
  49: std::panicking::try
             at libstd/panicking.rs:289
  50: std::rt::lang_start_internal
             at libstd/panic.rs:392
             at libstd/rt.rs:58
  51: main
  52: __libc_start_main
  53: _start
query stack during panic:
#0 [mir_borrowck] processing `main`
end of query stack
error: aborting due to previous error


error: internal compiler error: unexpected panic

note: the compiler unexpectedly panicked. this is a bug.

note: we would appreciate a bug report: https://github.com/rust-lang/rust/blob/master/CONTRIBUTING.md#bug-reports

note: rustc 1.31.0-dev running on x86_64-unknown-linux-gnu
</pre></div>



<a name="135486509"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2354499%20Invalid%20%22variable%20does%20not%20need%20to%20be%20mutable%22/near/135486509" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2354499.20Invalid.20.22variable.20does.20not.20need.20to.20be.20mutable.22.html#135486509">(Oct 09 2018 at 17:54)</a>:</h4>
<p><span class="user-mention" data-user-id="116009">@nikomatsakis</span> I was expecting the error to be emitted somewhere</p>



<a name="135486514"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2354499%20Invalid%20%22variable%20does%20not%20need%20to%20be%20mutable%22/near/135486514" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2354499.20Invalid.20.22variable.20does.20not.20need.20to.20be.20mutable.22.html#135486514">(Oct 09 2018 at 17:54)</a>:</h4>
<p>you have to invoke <code>.emit()</code> yourself</p>



<a name="135486523"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2354499%20Invalid%20%22variable%20does%20not%20need%20to%20be%20mutable%22/near/135486523" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2354499.20Invalid.20.22variable.20does.20not.20need.20to.20be.20mutable.22.html#135486523">(Oct 09 2018 at 17:55)</a>:</h4>
<p>only we actually want to invoke <code>.buffer</code> I think</p>



<a name="135486534"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2354499%20Invalid%20%22variable%20does%20not%20need%20to%20be%20mutable%22/near/135486534" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2354499.20Invalid.20.22variable.20does.20not.20need.20to.20be.20mutable.22.html#135486534">(Oct 09 2018 at 17:55)</a>:</h4>
<p>because of the whole migration business</p>



<a name="135486566"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2354499%20Invalid%20%22variable%20does%20not%20need%20to%20be%20mutable%22/near/135486566" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2354499.20Invalid.20.22variable.20does.20not.20need.20to.20be.20mutable.22.html#135486566">(Oct 09 2018 at 17:55)</a>:</h4>
<p>I was just doing ...</p>



<a name="135486571"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2354499%20Invalid%20%22variable%20does%20not%20need%20to%20be%20mutable%22/near/135486571" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2354499.20Invalid.20.22variable.20does.20not.20need.20to.20be.20mutable.22.html#135486571">(Oct 09 2018 at 17:55)</a>:</h4>
<div class="codehilite"><pre><span></span>                    struct_span_err!(self.infcx.tcx.sess, place_span.1, E0718,
                                     &quot;cannot assign to `{:?}` when `{:?}` is not initialized&quot;,
                                     place, Place::Local(local)
                    );
                    return;
</pre></div>



<a name="135486581"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2354499%20Invalid%20%22variable%20does%20not%20need%20to%20be%20mutable%22/near/135486581" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2354499.20Invalid.20.22variable.20does.20not.20need.20to.20be.20mutable.22.html#135486581">(Oct 09 2018 at 17:56)</a>:</h4>
<p>yeah, that doesn't work</p>



<a name="135486621"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2354499%20Invalid%20%22variable%20does%20not%20need%20to%20be%20mutable%22/near/135486621" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2354499.20Invalid.20.22variable.20does.20not.20need.20to.20be.20mutable.22.html#135486621">(Oct 09 2018 at 17:56)</a>:</h4>
<p>that just constructs a diagnostic</p>



<a name="135486624"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2354499%20Invalid%20%22variable%20does%20not%20need%20to%20be%20mutable%22/near/135486624" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2354499.20Invalid.20.22variable.20does.20not.20need.20to.20be.20mutable.22.html#135486624">(Oct 09 2018 at 17:56)</a>:</h4>
<p>you meant to call buffer after that?</p>



<a name="135486626"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2354499%20Invalid%20%22variable%20does%20not%20need%20to%20be%20mutable%22/near/135486626" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2354499.20Invalid.20.22variable.20does.20not.20need.20to.20be.20mutable.22.html#135486626">(Oct 09 2018 at 17:56)</a>:</h4>
<p>and drops it on the floor</p>



<a name="135486627"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2354499%20Invalid%20%22variable%20does%20not%20need%20to%20be%20mutable%22/near/135486627" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2354499.20Invalid.20.22variable.20does.20not.20need.20to.20be.20mutable.22.html#135486627">(Oct 09 2018 at 17:56)</a>:</h4>
<p>yes</p>



<a name="135486628"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2354499%20Invalid%20%22variable%20does%20not%20need%20to%20be%20mutable%22/near/135486628" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2354499.20Invalid.20.22variable.20does.20not.20need.20to.20be.20mutable.22.html#135486628">(Oct 09 2018 at 17:56)</a>:</h4>
<p>right</p>



<a name="135486632"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2354499%20Invalid%20%22variable%20does%20not%20need%20to%20be%20mutable%22/near/135486632" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2354499.20Invalid.20.22variable.20does.20not.20need.20to.20be.20mutable.22.html#135486632">(Oct 09 2018 at 17:56)</a>:</h4>
<p>ok</p>



<a name="135486633"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2354499%20Invalid%20%22variable%20does%20not%20need%20to%20be%20mutable%22/near/135486633" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2354499.20Invalid.20.22variable.20does.20not.20need.20to.20be.20mutable.22.html#135486633">(Oct 09 2018 at 17:56)</a>:</h4>
<p>makes sense</p>



<a name="135486639"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2354499%20Invalid%20%22variable%20does%20not%20need%20to%20be%20mutable%22/near/135486639" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2354499.20Invalid.20.22variable.20does.20not.20need.20to.20be.20mutable.22.html#135486639">(Oct 09 2018 at 17:56)</a>:</h4>
<p>you can look around for an example</p>



<a name="135486644"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2354499%20Invalid%20%22variable%20does%20not%20need%20to%20be%20mutable%22/near/135486644" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2354499.20Invalid.20.22variable.20does.20not.20need.20to.20be.20mutable.22.html#135486644">(Oct 09 2018 at 17:56)</a>:</h4>
<p>yep</p>



<a name="135486657"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2354499%20Invalid%20%22variable%20does%20not%20need%20to%20be%20mutable%22/near/135486657" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2354499.20Invalid.20.22variable.20does.20not.20need.20to.20be.20mutable.22.html#135486657">(Oct 09 2018 at 17:56)</a>:</h4>
<p>I remember now</p>



<a name="135486667"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2354499%20Invalid%20%22variable%20does%20not%20need%20to%20be%20mutable%22/near/135486667" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2354499.20Invalid.20.22variable.20does.20not.20need.20to.20be.20mutable.22.html#135486667">(Oct 09 2018 at 17:56)</a>:</h4>
<p>forgot the way of how this did work</p>



<a name="135486689"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2354499%20Invalid%20%22variable%20does%20not%20need%20to%20be%20mutable%22/near/135486689" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2354499.20Invalid.20.22variable.20does.20not.20need.20to.20be.20mutable.22.html#135486689">(Oct 09 2018 at 17:56)</a>:</h4>
<p>for some minute thought you kept calling this and emit was called at the end</p>



<a name="135488481"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2354499%20Invalid%20%22variable%20does%20not%20need%20to%20be%20mutable%22/near/135488481" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2354499.20Invalid.20.22variable.20does.20not.20need.20to.20be.20mutable.22.html#135488481">(Oct 09 2018 at 18:27)</a>:</h4>
<p><span class="user-mention" data-user-id="116009">@nikomatsakis</span> in order to get the name from a place I need to go to the hir level?</p>



<a name="135488491"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2354499%20Invalid%20%22variable%20does%20not%20need%20to%20be%20mutable%22/near/135488491" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2354499.20Invalid.20.22variable.20does.20not.20need.20to.20be.20mutable.22.html#135488491">(Oct 09 2018 at 18:27)</a>:</h4>
<p><code>&amp;self.tcx.hir.name(self.tcx.hir.hir_to_node_id(id)).as_str()</code></p>



<a name="135488493"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2354499%20Invalid%20%22variable%20does%20not%20need%20to%20be%20mutable%22/near/135488493" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2354499.20Invalid.20.22variable.20does.20not.20need.20to.20be.20mutable.22.html#135488493">(Oct 09 2018 at 18:27)</a>:</h4>
<p>something like that?</p>



<a name="135488502"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2354499%20Invalid%20%22variable%20does%20not%20need%20to%20be%20mutable%22/near/135488502" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2354499.20Invalid.20.22variable.20does.20not.20need.20to.20be.20mutable.22.html#135488502">(Oct 09 2018 at 18:27)</a>:</h4>
<p>I guess I need some kind of id first?</p>



<a name="135488549"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2354499%20Invalid%20%22variable%20does%20not%20need%20to%20be%20mutable%22/near/135488549" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2354499.20Invalid.20.22variable.20does.20not.20need.20to.20be.20mutable.22.html#135488549">(Oct 09 2018 at 18:28)</a>:</h4>
<p>you don't want that</p>



<a name="135488559"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2354499%20Invalid%20%22variable%20does%20not%20need%20to%20be%20mutable%22/near/135488559" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2354499.20Invalid.20.22variable.20does.20not.20need.20to.20be.20mutable.22.html#135488559">(Oct 09 2018 at 18:28)</a>:</h4>
<p>you want a user-printable string from a place?</p>



<a name="135488587"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2354499%20Invalid%20%22variable%20does%20not%20need%20to%20be%20mutable%22/near/135488587" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2354499.20Invalid.20.22variable.20does.20not.20need.20to.20be.20mutable.22.html#135488587">(Oct 09 2018 at 18:28)</a>:</h4>
<p>yeah</p>



<a name="135488605"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2354499%20Invalid%20%22variable%20does%20not%20need%20to%20be%20mutable%22/near/135488605" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2354499.20Invalid.20.22variable.20does.20not.20need.20to.20be.20mutable.22.html#135488605">(Oct 09 2018 at 18:29)</a>:</h4>
<p>checked impl Place in several places and there's no such a thing or couldn't find that</p>



<a name="135488612"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2354499%20Invalid%20%22variable%20does%20not%20need%20to%20be%20mutable%22/near/135488612" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2354499.20Invalid.20.22variable.20does.20not.20need.20to.20be.20mutable.22.html#135488612">(Oct 09 2018 at 18:29)</a>:</h4>
<p>there is a method <code>describe_place</code></p>



<a name="135488621"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2354499%20Invalid%20%22variable%20does%20not%20need%20to%20be%20mutable%22/near/135488621" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2354499.20Invalid.20.22variable.20does.20not.20need.20to.20be.20mutable.22.html#135488621">(Oct 09 2018 at 18:29)</a>:</h4>
<div class="codehilite"><pre><span></span><span class="w">    </span><span class="c1">// End-user visible description of `place` if one can be found. If the</span>
<span class="w">    </span><span class="c1">// place is a temporary for instance, None will be returned.</span>
<span class="w">    </span><span class="k">pub</span><span class="p">(</span><span class="k">super</span><span class="p">)</span><span class="w"> </span><span class="k">fn</span> <span class="nf">describe_place</span><span class="p">(</span><span class="o">&amp;</span><span class="bp">self</span><span class="p">,</span><span class="w"> </span><span class="n">place</span>: <span class="kp">&amp;</span><span class="nc">Place</span><span class="o">&lt;</span><span class="na">&#39;tcx</span><span class="o">&gt;</span><span class="p">)</span><span class="w"> </span>-&gt; <span class="nb">Option</span><span class="o">&lt;</span><span class="nb">String</span><span class="o">&gt;</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">        </span><span class="bp">self</span><span class="p">.</span><span class="n">describe_place_with_options</span><span class="p">(</span><span class="n">place</span><span class="p">,</span><span class="w"> </span><span class="n">IncludingDowncast</span><span class="p">(</span><span class="kc">false</span><span class="p">))</span><span class="w"></span>
<span class="w">    </span><span class="p">}</span><span class="w"></span>
</pre></div>



<a name="135488631"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2354499%20Invalid%20%22variable%20does%20not%20need%20to%20be%20mutable%22/near/135488631" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2354499.20Invalid.20.22variable.20does.20not.20need.20to.20be.20mutable.22.html#135488631">(Oct 09 2018 at 18:29)</a>:</h4>
<p>it sometimes returns <code>None</code> because some places cannot be described</p>



<a name="135488639"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2354499%20Invalid%20%22variable%20does%20not%20need%20to%20be%20mutable%22/near/135488639" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2354499.20Invalid.20.22variable.20does.20not.20need.20to.20be.20mutable.22.html#135488639">(Oct 09 2018 at 18:29)</a>:</h4>
<p>I don't think that should apply in this case though</p>



<a name="135488867"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2354499%20Invalid%20%22variable%20does%20not%20need%20to%20be%20mutable%22/near/135488867" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2354499.20Invalid.20.22variable.20does.20not.20need.20to.20be.20mutable.22.html#135488867">(Oct 09 2018 at 18:32)</a>:</h4>
<p>you meant that I should just call unwrap() there?</p>



<a name="135488950"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2354499%20Invalid%20%22variable%20does%20not%20need%20to%20be%20mutable%22/near/135488950" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2354499.20Invalid.20.22variable.20does.20not.20need.20to.20be.20mutable.22.html#135488950">(Oct 09 2018 at 18:33)</a>:</h4>
<p>usually the best is to have some alternate wording</p>



<a name="135488964"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2354499%20Invalid%20%22variable%20does%20not%20need%20to%20be%20mutable%22/near/135488964" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2354499.20Invalid.20.22variable.20does.20not.20need.20to.20be.20mutable.22.html#135488964">(Oct 09 2018 at 18:33)</a>:</h4>
<p>in this particular case though</p>



<a name="135488970"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2354499%20Invalid%20%22variable%20does%20not%20need%20to%20be%20mutable%22/near/135488970" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2354499.20Invalid.20.22variable.20does.20not.20need.20to.20be.20mutable.22.html#135488970">(Oct 09 2018 at 18:33)</a>:</h4>
<p>I am not sure if we have to describe the place at all</p>



<a name="135489018"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2354499%20Invalid%20%22variable%20does%20not%20need%20to%20be%20mutable%22/near/135489018" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2354499.20Invalid.20.22variable.20does.20not.20need.20to.20be.20mutable.22.html#135489018">(Oct 09 2018 at 18:34)</a>:</h4>
<p>or, at least, if <code>describe_place</code> returns <code>None</code></p>



<a name="135489028"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2354499%20Invalid%20%22variable%20does%20not%20need%20to%20be%20mutable%22/near/135489028" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2354499.20Invalid.20.22variable.20does.20not.20need.20to.20be.20mutable.22.html#135489028">(Oct 09 2018 at 18:34)</a>:</h4>
<p>you could say a message like "use of uninitialized variable <code>x</code>"</p>



<a name="135489034"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2354499%20Invalid%20%22variable%20does%20not%20need%20to%20be%20mutable%22/near/135489034" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2354499.20Invalid.20.22variable.20does.20not.20need.20to.20be.20mutable.22.html#135489034">(Oct 09 2018 at 18:34)</a>:</h4>
<p>after all, we always have a local variable here</p>



<a name="135489044"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2354499%20Invalid%20%22variable%20does%20not%20need%20to%20be%20mutable%22/near/135489044" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2354499.20Invalid.20.22variable.20does.20not.20need.20to.20be.20mutable.22.html#135489044">(Oct 09 2018 at 18:34)</a>:</h4>
<p>and we can get its name from <code>mir.local_decls[local].name</code> — and <em>that</em> I think we <em>can</em> unwrap</p>



<a name="135489053"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2354499%20Invalid%20%22variable%20does%20not%20need%20to%20be%20mutable%22/near/135489053" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2354499.20Invalid.20.22variable.20does.20not.20need.20to.20be.20mutable.22.html#135489053">(Oct 09 2018 at 18:34)</a>:</h4>
<p>because the compiler will never generate a use of an uninitialized local</p>



<a name="135489098"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2354499%20Invalid%20%22variable%20does%20not%20need%20to%20be%20mutable%22/near/135489098" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2354499.20Invalid.20.22variable.20does.20not.20need.20to.20be.20mutable.22.html#135489098">(Oct 09 2018 at 18:35)</a>:</h4>
<div class="codehilite"><pre><span></span>error[E0718]: cannot assign to `s.0` when `s` is not initialized
 --&gt; test.rs:5:5
  |
5 |     s.0 = 3;
  |     ^^^^^^^

error[E0718]: cannot assign to `s.1` when `s` is not initialized
 --&gt; test.rs:6:5
  |
6 |     s.1 = 4;
  |     ^^^^^^^

error: aborting due to 2 previous errors

For more information about this error, try `rustc --explain E0718`.
</pre></div>



<a name="135489101"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2354499%20Invalid%20%22variable%20does%20not%20need%20to%20be%20mutable%22/near/135489101" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2354499.20Invalid.20.22variable.20does.20not.20need.20to.20be.20mutable.22.html#135489101">(Oct 09 2018 at 18:35)</a>:</h4>
<p>:)</p>



<a name="135489152"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2354499%20Invalid%20%22variable%20does%20not%20need%20to%20be%20mutable%22/near/135489152" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2354499.20Invalid.20.22variable.20does.20not.20need.20to.20be.20mutable.22.html#135489152">(Oct 09 2018 at 18:36)</a>:</h4>
<p>gonna tweak it a bit with your last tips and push again</p>



<a name="135490105"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2354499%20Invalid%20%22variable%20does%20not%20need%20to%20be%20mutable%22/near/135490105" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2354499.20Invalid.20.22variable.20does.20not.20need.20to.20be.20mutable.22.html#135490105">(Oct 09 2018 at 18:49)</a>:</h4>
<p><span class="user-mention" data-user-id="116009">@nikomatsakis</span> done <a href="https://github.com/rust-lang/rust/pull/54621" target="_blank" title="https://github.com/rust-lang/rust/pull/54621">https://github.com/rust-lang/rust/pull/54621</a></p>



<a name="135490114"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2354499%20Invalid%20%22variable%20does%20not%20need%20to%20be%20mutable%22/near/135490114" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2354499.20Invalid.20.22variable.20does.20not.20need.20to.20be.20mutable.22.html#135490114">(Oct 09 2018 at 18:49)</a>:</h4>
<p>I may end pushing a rustfmt ran or something and would like to see tests running</p>



<a name="135490459"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2354499%20Invalid%20%22variable%20does%20not%20need%20to%20be%20mutable%22/near/135490459" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2354499.20Invalid.20.22variable.20does.20not.20need.20to.20be.20mutable.22.html#135490459">(Oct 09 2018 at 18:54)</a>:</h4>
<p>but anyway it's more or less finished I think :)</p>



<a name="135491805"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2354499%20Invalid%20%22variable%20does%20not%20need%20to%20be%20mutable%22/near/135491805" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2354499.20Invalid.20.22variable.20does.20not.20need.20to.20be.20mutable.22.html#135491805">(Oct 09 2018 at 19:14)</a>:</h4>
<p>I've made a lot of local fixes</p>



<a name="135491806"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2354499%20Invalid%20%22variable%20does%20not%20need%20to%20be%20mutable%22/near/135491806" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2354499.20Invalid.20.22variable.20does.20not.20need.20to.20be.20mutable.22.html#135491806">(Oct 09 2018 at 19:14)</a>:</h4>
<p>pushing a last version</p>



<a name="135491821"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2354499%20Invalid%20%22variable%20does%20not%20need%20to%20be%20mutable%22/near/135491821" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2354499.20Invalid.20.22variable.20does.20not.20need.20to.20be.20mutable.22.html#135491821">(Oct 09 2018 at 19:14)</a>:</h4>
<p>after compiling process finishes</p>



<a name="135492022"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2354499%20Invalid%20%22variable%20does%20not%20need%20to%20be%20mutable%22/near/135492022" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2354499.20Invalid.20.22variable.20does.20not.20need.20to.20be.20mutable.22.html#135492022">(Oct 09 2018 at 19:18)</a>:</h4>
<p>looking good</p>



<a name="135492024"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2354499%20Invalid%20%22variable%20does%20not%20need%20to%20be%20mutable%22/near/135492024" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2354499.20Invalid.20.22variable.20does.20not.20need.20to.20be.20mutable.22.html#135492024">(Oct 09 2018 at 19:18)</a>:</h4>
<p>I left some nits</p>



<a name="135492028"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2354499%20Invalid%20%22variable%20does%20not%20need%20to%20be%20mutable%22/near/135492028" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2354499.20Invalid.20.22variable.20does.20not.20need.20to.20be.20mutable.22.html#135492028">(Oct 09 2018 at 19:18)</a>:</h4>
<p>mosly just requests for more comments</p>



<a name="135492750"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2354499%20Invalid%20%22variable%20does%20not%20need%20to%20be%20mutable%22/near/135492750" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2354499.20Invalid.20.22variable.20does.20not.20need.20to.20be.20mutable.22.html#135492750">(Oct 09 2018 at 19:30)</a>:</h4>
<p>I still didn’t push the fixed version but will check your nits</p>



<a name="135498615"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2354499%20Invalid%20%22variable%20does%20not%20need%20to%20be%20mutable%22/near/135498615" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2354499.20Invalid.20.22variable.20does.20not.20need.20to.20be.20mutable.22.html#135498615">(Oct 09 2018 at 21:00)</a>:</h4>
<p><span class="user-mention" data-user-id="116009">@nikomatsakis</span> your comments were address but I've also made some other tweaks</p>



<a name="135498637"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2354499%20Invalid%20%22variable%20does%20not%20need%20to%20be%20mutable%22/near/135498637" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2354499.20Invalid.20.22variable.20does.20not.20need.20to.20be.20mutable.22.html#135498637">(Oct 09 2018 at 21:01)</a>:</h4>
<p>like changing the two if let's to a match and stuff like that</p>



<a name="135498654"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2354499%20Invalid%20%22variable%20does%20not%20need%20to%20be%20mutable%22/near/135498654" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2354499.20Invalid.20.22variable.20does.20not.20need.20to.20be.20mutable.22.html#135498654">(Oct 09 2018 at 21:01)</a>:</h4>
<p>now if ci says so it's ready to merge</p>



<a name="135498758"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2354499%20Invalid%20%22variable%20does%20not%20need%20to%20be%20mutable%22/near/135498758" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2354499.20Invalid.20.22variable.20does.20not.20need.20to.20be.20mutable.22.html#135498758">(Oct 09 2018 at 21:03)</a>:</h4>
<p>actually having second thoughts about this <a href="https://github.com/rust-lang/rust/pull/54621/commits/b8dbca11db58d62dfbf748377277d74669002fe5#diff-5b4d01d26caf43976125ba0f877e78c0R1123" target="_blank" title="https://github.com/rust-lang/rust/pull/54621/commits/b8dbca11db58d62dfbf748377277d74669002fe5#diff-5b4d01d26caf43976125ba0f877e78c0R1123">https://github.com/rust-lang/rust/pull/54621/commits/b8dbca11db58d62dfbf748377277d74669002fe5#diff-5b4d01d26caf43976125ba0f877e78c0R1123</a></p>



<a name="135498762"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2354499%20Invalid%20%22variable%20does%20not%20need%20to%20be%20mutable%22/near/135498762" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2354499.20Invalid.20.22variable.20does.20not.20need.20to.20be.20mutable.22.html#135498762">(Oct 09 2018 at 21:03)</a>:</h4>
<p>should that wrap everything I guess</p>



<a name="135498801"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2354499%20Invalid%20%22variable%20does%20not%20need%20to%20be%20mutable%22/near/135498801" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2354499.20Invalid.20.22variable.20does.20not.20need.20to.20be.20mutable.22.html#135498801">(Oct 09 2018 at 21:04)</a>:</h4>
<p>if it's not mutable this error <a href="https://github.com/rust-lang/rust/pull/54621/commits/b8dbca11db58d62dfbf748377277d74669002fe5#diff-5b4d01d26caf43976125ba0f877e78c0R1132" target="_blank" title="https://github.com/rust-lang/rust/pull/54621/commits/b8dbca11db58d62dfbf748377277d74669002fe5#diff-5b4d01d26caf43976125ba0f877e78c0R1132">https://github.com/rust-lang/rust/pull/54621/commits/b8dbca11db58d62dfbf748377277d74669002fe5#diff-5b4d01d26caf43976125ba0f877e78c0R1132</a> doesn't make any sense</p>



<a name="135498903"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2354499%20Invalid%20%22variable%20does%20not%20need%20to%20be%20mutable%22/near/135498903" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2354499.20Invalid.20.22variable.20does.20not.20need.20to.20be.20mutable.22.html#135498903">(Oct 09 2018 at 21:05)</a>:</h4>
<p>and if that's the case why all the tests pass?</p>



<a name="135498927"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2354499%20Invalid%20%22variable%20does%20not%20need%20to%20be%20mutable%22/near/135498927" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2354499.20Invalid.20.22variable.20does.20not.20need.20to.20be.20mutable.22.html#135498927">(Oct 09 2018 at 21:05)</a>:</h4>
<p>is it possible that that local has Mutability other than Mut?</p>



<a name="135498932"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2354499%20Invalid%20%22variable%20does%20not%20need%20to%20be%20mutable%22/near/135498932" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2354499.20Invalid.20.22variable.20does.20not.20need.20to.20be.20mutable.22.html#135498932">(Oct 09 2018 at 21:05)</a>:</h4>
<blockquote>
<p>if it's not mutable this error <a href="https://github.com/rust-lang/rust/pull/54621/commits/b8dbca11db58d62dfbf748377277d74669002fe5#diff-5b4d01d26caf43976125ba0f877e78c0R1132" target="_blank" title="https://github.com/rust-lang/rust/pull/54621/commits/b8dbca11db58d62dfbf748377277d74669002fe5#diff-5b4d01d26caf43976125ba0f877e78c0R1132">https://github.com/rust-lang/rust/pull/54621/commits/b8dbca11db58d62dfbf748377277d74669002fe5#diff-5b4d01d26caf43976125ba0f877e78c0R1132</a> doesn't make any sense</p>
</blockquote>
<p>why does that error not make sense?</p>



<a name="135498937"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2354499%20Invalid%20%22variable%20does%20not%20need%20to%20be%20mutable%22/near/135498937" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2354499.20Invalid.20.22variable.20does.20not.20need.20to.20be.20mutable.22.html#135498937">(Oct 09 2018 at 21:06)</a>:</h4>
<p>I think it makes sense</p>



<a name="135498984"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2354499%20Invalid%20%22variable%20does%20not%20need%20to%20be%20mutable%22/near/135498984" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2354499.20Invalid.20.22variable.20does.20not.20need.20to.20be.20mutable.22.html#135498984">(Oct 09 2018 at 21:06)</a>:</h4>
<p>but all tests passing is a bit suspicious, maybe we just weren't testing this scenario?</p>



<a name="135499007"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2354499%20Invalid%20%22variable%20does%20not%20need%20to%20be%20mutable%22/near/135499007" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2354499.20Invalid.20.22variable.20does.20not.20need.20to.20be.20mutable.22.html#135499007">(Oct 09 2018 at 21:06)</a>:</h4>
<p>ok, you're right</p>



<a name="135499010"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2354499%20Invalid%20%22variable%20does%20not%20need%20to%20be%20mutable%22/near/135499010" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2354499.20Invalid.20.22variable.20does.20not.20need.20to.20be.20mutable.22.html#135499010">(Oct 09 2018 at 21:06)</a>:</h4>
<p>makes sense</p>



<a name="135499041"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2354499%20Invalid%20%22variable%20does%20not%20need%20to%20be%20mutable%22/near/135499041" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2354499.20Invalid.20.22variable.20does.20not.20need.20to.20be.20mutable.22.html#135499041">(Oct 09 2018 at 21:07)</a>:</h4>
<p>we are talking about this example ...</p>



<a name="135499054"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2354499%20Invalid%20%22variable%20does%20not%20need%20to%20be%20mutable%22/near/135499054" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2354499.20Invalid.20.22variable.20does.20not.20need.20to.20be.20mutable.22.html#135499054">(Oct 09 2018 at 21:07)</a>:</h4>
<div class="codehilite"><pre><span></span><span class="k">fn</span> <span class="nf">main</span><span class="p">()</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="n">s</span>: <span class="p">(</span><span class="kt">i32</span><span class="p">,</span><span class="w"> </span><span class="kt">i32</span><span class="p">);</span><span class="w"></span>
<span class="w">    </span><span class="n">s</span><span class="p">.</span><span class="mi">0</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">3</span><span class="p">;</span><span class="w"></span>
<span class="w">    </span><span class="n">s</span><span class="p">.</span><span class="mi">1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">4</span><span class="p">;</span><span class="w"></span>
<span class="w">    </span><span class="n">println</span><span class="o">!</span><span class="p">(</span><span class="s">&quot;{} {}&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">s</span><span class="p">.</span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="n">s</span><span class="p">.</span><span class="mi">1</span><span class="p">);</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>
</pre></div>



<a name="135499056"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2354499%20Invalid%20%22variable%20does%20not%20need%20to%20be%20mutable%22/near/135499056" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2354499.20Invalid.20.22variable.20does.20not.20need.20to.20be.20mutable.22.html#135499056">(Oct 09 2018 at 21:07)</a>:</h4>
<p>right?</p>



<a name="135499065"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2354499%20Invalid%20%22variable%20does%20not%20need%20to%20be%20mutable%22/near/135499065" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2354499.20Invalid.20.22variable.20does.20not.20need.20to.20be.20mutable.22.html#135499065">(Oct 09 2018 at 21:07)</a>:</h4>
<p>yes</p>



<a name="135499070"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2354499%20Invalid%20%22variable%20does%20not%20need%20to%20be%20mutable%22/near/135499070" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2354499.20Invalid.20.22variable.20does.20not.20need.20to.20be.20mutable.22.html#135499070">(Oct 09 2018 at 21:07)</a>:</h4>
<p>that should also fail</p>



<a name="135499071"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2354499%20Invalid%20%22variable%20does%20not%20need%20to%20be%20mutable%22/near/135499071" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2354499.20Invalid.20.22variable.20does.20not.20need.20to.20be.20mutable.22.html#135499071">(Oct 09 2018 at 21:07)</a>:</h4>
<p>I just added a review to request you add a test like that</p>



<a name="135499072"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2354499%20Invalid%20%22variable%20does%20not%20need%20to%20be%20mutable%22/near/135499072" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2354499.20Invalid.20.22variable.20does.20not.20need.20to.20be.20mutable.22.html#135499072">(Oct 09 2018 at 21:07)</a>:</h4>
<p>right, it should error in the same way for now</p>



<a name="135499073"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2354499%20Invalid%20%22variable%20does%20not%20need%20to%20be%20mutable%22/near/135499073" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2354499.20Invalid.20.22variable.20does.20not.20need.20to.20be.20mutable.22.html#135499073">(Oct 09 2018 at 21:08)</a>:</h4>
<p>let me check what happens</p>



<a name="135499112"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2354499%20Invalid%20%22variable%20does%20not%20need%20to%20be%20mutable%22/near/135499112" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2354499.20Invalid.20.22variable.20does.20not.20need.20to.20be.20mutable.22.html#135499112">(Oct 09 2018 at 21:08)</a>:</h4>
<p>(eventually, we would like to accept both)</p>



<a name="135499118"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2354499%20Invalid%20%22variable%20does%20not%20need%20to%20be%20mutable%22/near/135499118" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2354499.20Invalid.20.22variable.20does.20not.20need.20to.20be.20mutable.22.html#135499118">(Oct 09 2018 at 21:08)</a>:</h4>
<p>(but that's not our immediate goal)</p>



<a name="135499173"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2354499%20Invalid%20%22variable%20does%20not%20need%20to%20be%20mutable%22/near/135499173" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2354499.20Invalid.20.22variable.20does.20not.20need.20to.20be.20mutable.22.html#135499173">(Oct 09 2018 at 21:09)</a>:</h4>
<p>yep</p>



<a name="135499180"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2354499%20Invalid%20%22variable%20does%20not%20need%20to%20be%20mutable%22/near/135499180" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2354499.20Invalid.20.22variable.20does.20not.20need.20to.20be.20mutable.22.html#135499180">(Oct 09 2018 at 21:09)</a>:</h4>
<p>right now</p>



<a name="135499184"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2354499%20Invalid%20%22variable%20does%20not%20need%20to%20be%20mutable%22/near/135499184" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2354499.20Invalid.20.22variable.20does.20not.20need.20to.20be.20mutable.22.html#135499184">(Oct 09 2018 at 21:09)</a>:</h4>
<div class="codehilite"><pre><span></span>[santiago@archlinux tmp]$ rustc test.rs
error[E0594]: cannot assign to `s.0`, as `s` is not declared as mutable
 --&gt; test.rs:5:5
  |
4 |     let s: (i32, i32);
  |         - help: consider changing this to be mutable: `mut s`
5 |     s.0 = 3;
  |     ^^^^^^^ cannot assign

error[E0594]: cannot assign to `s.1`, as `s` is not declared as mutable
 --&gt; test.rs:6:5
  |
4 |     let s: (i32, i32);
  |         - help: consider changing this to be mutable: `mut s`
5 |     s.0 = 3;
6 |     s.1 = 4;
  |     ^^^^^^^ cannot assign

error: aborting due to 2 previous errors
</pre></div>



<a name="135499190"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2354499%20Invalid%20%22variable%20does%20not%20need%20to%20be%20mutable%22/near/135499190" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2354499.20Invalid.20.22variable.20does.20not.20need.20to.20be.20mutable.22.html#135499190">(Oct 09 2018 at 21:09)</a>:</h4>
<p>with nightly</p>



<a name="135499197"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2354499%20Invalid%20%22variable%20does%20not%20need%20to%20be%20mutable%22/near/135499197" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2354499.20Invalid.20.22variable.20does.20not.20need.20to.20be.20mutable.22.html#135499197">(Oct 09 2018 at 21:09)</a>:</h4>
<p>I'm compiling my thing again</p>



<a name="135499269"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2354499%20Invalid%20%22variable%20does%20not%20need%20to%20be%20mutable%22/near/135499269" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2354499.20Invalid.20.22variable.20does.20not.20need.20to.20be.20mutable.22.html#135499269">(Oct 09 2018 at 21:10)</a>:</h4>
<p>in our case is going to say something like</p>



<a name="135499290"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2354499%20Invalid%20%22variable%20does%20not%20need%20to%20be%20mutable%22/near/135499290" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2354499.20Invalid.20.22variable.20does.20not.20need.20to.20be.20mutable.22.html#135499290">(Oct 09 2018 at 21:10)</a>:</h4>
<div class="codehilite"><pre><span></span>cannot assign to `s.0` when `s` is not initialized
</pre></div>



<a name="135499302"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2354499%20Invalid%20%22variable%20does%20not%20need%20to%20be%20mutable%22/near/135499302" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2354499.20Invalid.20.22variable.20does.20not.20need.20to.20be.20mutable.22.html#135499302">(Oct 09 2018 at 21:10)</a>:</h4>
<p>seems better</p>



<a name="135499310"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2354499%20Invalid%20%22variable%20does%20not%20need%20to%20be%20mutable%22/near/135499310" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2354499.20Invalid.20.22variable.20does.20not.20need.20to.20be.20mutable.22.html#135499310">(Oct 09 2018 at 21:10)</a>:</h4>
<p><span class="emoji emoji-1f44d" title="+1">:+1:</span></p>



<a name="135499318"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2354499%20Invalid%20%22variable%20does%20not%20need%20to%20be%20mutable%22/near/135499318" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2354499.20Invalid.20.22variable.20does.20not.20need.20to.20be.20mutable.22.html#135499318">(Oct 09 2018 at 21:11)</a>:</h4>
<p>particularly since we are currently advising people to add <code>mut</code> — but even if they add <code>mut</code>, it's not going to work well</p>



<a name="135499326"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2354499%20Invalid%20%22variable%20does%20not%20need%20to%20be%20mutable%22/near/135499326" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2354499.20Invalid.20.22variable.20does.20not.20need.20to.20be.20mutable.22.html#135499326">(Oct 09 2018 at 21:11)</a>:</h4>
<p>is not initialized but at the same time is not mutable</p>



<a name="135499355"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2354499%20Invalid%20%22variable%20does%20not%20need%20to%20be%20mutable%22/near/135499355" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2354499.20Invalid.20.22variable.20does.20not.20need.20to.20be.20mutable.22.html#135499355">(Oct 09 2018 at 21:11)</a>:</h4>
<p>what about for this second case, something like ...</p>



<a name="135499449"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2354499%20Invalid%20%22variable%20does%20not%20need%20to%20be%20mutable%22/near/135499449" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2354499.20Invalid.20.22variable.20does.20not.20need.20to.20be.20mutable.22.html#135499449">(Oct 09 2018 at 21:12)</a>:</h4>
<div class="codehilite"><pre><span></span>cannot assign to `s.0` when `s` is not initialized and not mutable either
</pre></div>



<a name="135499456"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2354499%20Invalid%20%22variable%20does%20not%20need%20to%20be%20mutable%22/near/135499456" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2354499.20Invalid.20.22variable.20does.20not.20need.20to.20be.20mutable.22.html#135499456">(Oct 09 2018 at 21:12)</a>:</h4>
<p>or something written better :)</p>



<a name="135499461"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2354499%20Invalid%20%22variable%20does%20not%20need%20to%20be%20mutable%22/near/135499461" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2354499.20Invalid.20.22variable.20does.20not.20need.20to.20be.20mutable.22.html#135499461">(Oct 09 2018 at 21:12)</a>:</h4>
<p>well unsure if it worth</p>



<a name="135499467"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2354499%20Invalid%20%22variable%20does%20not%20need%20to%20be%20mutable%22/near/135499467" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2354499.20Invalid.20.22variable.20does.20not.20need.20to.20be.20mutable.22.html#135499467">(Oct 09 2018 at 21:12)</a>:</h4>
<p>whatever you prefer :)</p>



<a name="135499513"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2354499%20Invalid%20%22variable%20does%20not%20need%20to%20be%20mutable%22/near/135499513" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2354499.20Invalid.20.22variable.20does.20not.20need.20to.20be.20mutable.22.html#135499513">(Oct 09 2018 at 21:13)</a>:</h4>
<p>I do not like it because</p>



<a name="135499520"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2354499%20Invalid%20%22variable%20does%20not%20need%20to%20be%20mutable%22/near/135499520" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2354499.20Invalid.20.22variable.20does.20not.20need.20to.20be.20mutable.22.html#135499520">(Oct 09 2018 at 21:13)</a>:</h4>
<p>s being mutable should have nothing to do with it</p>



<a name="135499566"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2354499%20Invalid%20%22variable%20does%20not%20need%20to%20be%20mutable%22/near/135499566" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2354499.20Invalid.20.22variable.20does.20not.20need.20to.20be.20mutable.22.html#135499566">(Oct 09 2018 at 21:14)</a>:</h4>
<p>I mean</p>



<a name="135499568"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2354499%20Invalid%20%22variable%20does%20not%20need%20to%20be%20mutable%22/near/135499568" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2354499.20Invalid.20.22variable.20does.20not.20need.20to.20be.20mutable.22.html#135499568">(Oct 09 2018 at 21:14)</a>:</h4>
<p>in particular, just because <code>s</code> is not mutable, doesn't mean you can't assign to it — you just can't assign to it more than once along any control-flow path</p>



<a name="135499570"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2354499%20Invalid%20%22variable%20does%20not%20need%20to%20be%20mutable%22/near/135499570" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2354499.20Invalid.20.22variable.20does.20not.20need.20to.20be.20mutable.22.html#135499570">(Oct 09 2018 at 21:14)</a>:</h4>
<p>e.g.</p>



<a name="135499578"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2354499%20Invalid%20%22variable%20does%20not%20need%20to%20be%20mutable%22/near/135499578" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2354499.20Invalid.20.22variable.20does.20not.20need.20to.20be.20mutable.22.html#135499578">(Oct 09 2018 at 21:14)</a>:</h4>
<div class="codehilite"><pre><span></span>fn main() {
    let x: u32;

    x = 22;
}
</pre></div>


<p>is accepted</p>



<a name="135499584"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2354499%20Invalid%20%22variable%20does%20not%20need%20to%20be%20mutable%22/near/135499584" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2354499.20Invalid.20.22variable.20does.20not.20need.20to.20be.20mutable.22.html#135499584">(Oct 09 2018 at 21:14)</a>:</h4>
<p>what I meant is ... in order for s.0 = something to work</p>



<a name="135499587"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2354499%20Invalid%20%22variable%20does%20not%20need%20to%20be%20mutable%22/near/135499587" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2354499.20Invalid.20.22variable.20does.20not.20need.20to.20be.20mutable.22.html#135499587">(Oct 09 2018 at 21:14)</a>:</h4>
<p>in current code</p>



<a name="135499596"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2354499%20Invalid%20%22variable%20does%20not%20need%20to%20be%20mutable%22/near/135499596" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2354499.20Invalid.20.22variable.20does.20not.20need.20to.20be.20mutable.22.html#135499596">(Oct 09 2018 at 21:14)</a>:</h4>
<p>you would need to have s initialized</p>



<a name="135499600"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2354499%20Invalid%20%22variable%20does%20not%20need%20to%20be%20mutable%22/near/135499600" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2354499.20Invalid.20.22variable.20does.20not.20need.20to.20be.20mutable.22.html#135499600">(Oct 09 2018 at 21:14)</a>:</h4>
<p>and s be mutable</p>



<a name="135499604"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2354499%20Invalid%20%22variable%20does%20not%20need%20to%20be%20mutable%22/near/135499604" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2354499.20Invalid.20.22variable.20does.20not.20need.20to.20be.20mutable.22.html#135499604">(Oct 09 2018 at 21:14)</a>:</h4>
<p>and</p>
<div class="codehilite"><pre><span></span><span class="k">fn</span> <span class="nf">main</span><span class="p">()</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="n">x</span>: <span class="p">(</span><span class="kt">u32</span><span class="p">,</span><span class="w"> </span><span class="p">);</span><span class="w"></span>

<span class="w">    </span><span class="n">x</span><span class="p">.</span><span class="mi">0</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">22</span><span class="p">;</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>
</pre></div>


<p>seems analogous to me</p>



<a name="135499619"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2354499%20Invalid%20%22variable%20does%20not%20need%20to%20be%20mutable%22/near/135499619" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2354499.20Invalid.20.22variable.20does.20not.20need.20to.20be.20mutable.22.html#135499619">(Oct 09 2018 at 21:15)</a>:</h4>
<p>hmm</p>



<a name="135499621"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2354499%20Invalid%20%22variable%20does%20not%20need%20to%20be%20mutable%22/near/135499621" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2354499.20Invalid.20.22variable.20does.20not.20need.20to.20be.20mutable.22.html#135499621">(Oct 09 2018 at 21:15)</a>:</h4>
<p>that part is true</p>



<a name="135499623"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2354499%20Invalid%20%22variable%20does%20not%20need%20to%20be%20mutable%22/near/135499623" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2354499.20Invalid.20.22variable.20does.20not.20need.20to.20be.20mutable.22.html#135499623">(Oct 09 2018 at 21:15)</a>:</h4>
<p>because that s.0 = something would mean that you're reassinging</p>



<a name="135499629"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2354499%20Invalid%20%22variable%20does%20not%20need%20to%20be%20mutable%22/near/135499629" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2354499.20Invalid.20.22variable.20does.20not.20need.20to.20be.20mutable.22.html#135499629">(Oct 09 2018 at 21:15)</a>:</h4>
<p>right, by definition, since it must be initialized</p>



<a name="135499636"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2354499%20Invalid%20%22variable%20does%20not%20need%20to%20be%20mutable%22/near/135499636" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2354499.20Invalid.20.22variable.20does.20not.20need.20to.20be.20mutable.22.html#135499636">(Oct 09 2018 at 21:15)</a>:</h4>
<p>well, that's true</p>



<a name="135499649"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2354499%20Invalid%20%22variable%20does%20not%20need%20to%20be%20mutable%22/near/135499649" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2354499.20Invalid.20.22variable.20does.20not.20need.20to.20be.20mutable.22.html#135499649">(Oct 09 2018 at 21:15)</a>:</h4>
<p>I guess I don't have a strong opinion about it</p>



<a name="135499651"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2354499%20Invalid%20%22variable%20does%20not%20need%20to%20be%20mutable%22/near/135499651" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2354499.20Invalid.20.22variable.20does.20not.20need.20to.20be.20mutable.22.html#135499651">(Oct 09 2018 at 21:15)</a>:</h4>
<p>maybe we could add a label instead?</p>



<a name="135499656"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2354499%20Invalid%20%22variable%20does%20not%20need%20to%20be%20mutable%22/near/135499656" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2354499.20Invalid.20.22variable.20does.20not.20need.20to.20be.20mutable.22.html#135499656">(Oct 09 2018 at 21:15)</a>:</h4>
<p>I have less strong opinion :P</p>



<a name="135499661"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2354499%20Invalid%20%22variable%20does%20not%20need%20to%20be%20mutable%22/near/135499661" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2354499.20Invalid.20.22variable.20does.20not.20need.20to.20be.20mutable.22.html#135499661">(Oct 09 2018 at 21:15)</a>:</h4>
<p>e.g., underline the variable with a suggestion like "- will also have to be declared <code>mut</code>"</p>



<a name="135499708"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2354499%20Invalid%20%22variable%20does%20not%20need%20to%20be%20mutable%22/near/135499708" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2354499.20Invalid.20.22variable.20does.20not.20need.20to.20be.20mutable.22.html#135499708">(Oct 09 2018 at 21:16)</a>:</h4>
<p>seems good</p>



<a name="135499710"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2354499%20Invalid%20%22variable%20does%20not%20need%20to%20be%20mutable%22/near/135499710" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2354499.20Invalid.20.22variable.20does.20not.20need.20to.20be.20mutable.22.html#135499710">(Oct 09 2018 at 21:16)</a>:</h4>
<p>/me shrugs</p>



<a name="135500735"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2354499%20Invalid%20%22variable%20does%20not%20need%20to%20be%20mutable%22/near/135500735" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> pnkfelix <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2354499.20Invalid.20.22variable.20does.20not.20need.20to.20be.20mutable.22.html#135500735">(Oct 09 2018 at 21:33)</a>:</h4>
<p><span class="user-mention" data-user-id="116266">@Santiago Pastorino</span> if you want to compare notes, this is how I ended up doing it locally: PR <a href="https://github.com/rust-lang/rust/issues/54941" target="_blank" title="https://github.com/rust-lang/rust/issues/54941">#54941</a></p>



<a name="135500790"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2354499%20Invalid%20%22variable%20does%20not%20need%20to%20be%20mutable%22/near/135500790" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> pnkfelix <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2354499.20Invalid.20.22variable.20does.20not.20need.20to.20be.20mutable.22.html#135500790">(Oct 09 2018 at 21:34)</a>:</h4>
<p>(note that this is <em>just</em> addressing the <a href="https://github.com/rust-lang/rust/issues/21232" target="_blank" title="https://github.com/rust-lang/rust/issues/21232">#21232</a> thing. It doesn't attempt to touch anything about <code>mut</code> tracking.)</p>



<a name="135500801"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2354499%20Invalid%20%22variable%20does%20not%20need%20to%20be%20mutable%22/near/135500801" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> pnkfelix <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2354499.20Invalid.20.22variable.20does.20not.20need.20to.20be.20mutable.22.html#135500801">(Oct 09 2018 at 21:34)</a>:</h4>
<p>but I thought it might be nice for you to see what tests I ended up having to touch</p>



<a name="135500837"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2354499%20Invalid%20%22variable%20does%20not%20need%20to%20be%20mutable%22/near/135500837" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> pnkfelix <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2354499.20Invalid.20.22variable.20does.20not.20need.20to.20be.20mutable.22.html#135500837">(Oct 09 2018 at 21:35)</a>:</h4>
<p>I don't actually disagree with the strategy that <span class="user-mention" data-user-id="116009">@nikomatsakis</span> has advised, of focusing on the <code>local</code> that underlies the <code>Place</code>. But I didn't take that tack myself.</p>



<a name="135500916"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2354499%20Invalid%20%22variable%20does%20not%20need%20to%20be%20mutable%22/near/135500916" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> pnkfelix <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2354499.20Invalid.20.22variable.20does.20not.20need.20to.20be.20mutable.22.html#135500916">(Oct 09 2018 at 21:36)</a>:</h4>
<p>The only place where I could imagine the two strategies diverging would <em>perhaps</em> be in how they would handle a (hypothetical) <code>Box&lt;Struct&gt;</code> where the box itself has been allocated somehow <em>without</em> initializing the struct it carries.</p>



<a name="135504682"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2354499%20Invalid%20%22variable%20does%20not%20need%20to%20be%20mutable%22/near/135504682" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2354499.20Invalid.20.22variable.20does.20not.20need.20to.20be.20mutable.22.html#135504682">(Oct 09 2018 at 22:50)</a>:</h4>
<p><span class="user-mention" data-user-id="116083">@pnkfelix</span> not sure I followed</p>



<a name="135504692"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2354499%20Invalid%20%22variable%20does%20not%20need%20to%20be%20mutable%22/near/135504692" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2354499.20Invalid.20.22variable.20does.20not.20need.20to.20be.20mutable.22.html#135504692">(Oct 09 2018 at 22:51)</a>:</h4>
<p>does your PR do the same as mine or address the <a href="https://github.com/rust-lang/rust/issues/21232" target="_blank" title="https://github.com/rust-lang/rust/issues/21232">#21232</a> thing?</p>



<a name="135504697"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2354499%20Invalid%20%22variable%20does%20not%20need%20to%20be%20mutable%22/near/135504697" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> pnkfelix <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2354499.20Invalid.20.22variable.20does.20not.20need.20to.20be.20mutable.22.html#135504697">(Oct 09 2018 at 22:51)</a>:</h4>
<p>My PR was solely focused on the <a href="https://github.com/rust-lang/rust/issues/21232" target="_blank" title="https://github.com/rust-lang/rust/issues/21232">#21232</a> thing</p>



<a name="135504701"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2354499%20Invalid%20%22variable%20does%20not%20need%20to%20be%20mutable%22/near/135504701" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2354499.20Invalid.20.22variable.20does.20not.20need.20to.20be.20mutable.22.html#135504701">(Oct 09 2018 at 22:51)</a>:</h4>
<p>ok</p>



<a name="135504703"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2354499%20Invalid%20%22variable%20does%20not%20need%20to%20be%20mutable%22/near/135504703" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2354499.20Invalid.20.22variable.20does.20not.20need.20to.20be.20mutable.22.html#135504703">(Oct 09 2018 at 22:51)</a>:</h4>
<p>but not complete I guess?</p>



<a name="135504704"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2354499%20Invalid%20%22variable%20does%20not%20need%20to%20be%20mutable%22/near/135504704" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> pnkfelix <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2354499.20Invalid.20.22variable.20does.20not.20need.20to.20be.20mutable.22.html#135504704">(Oct 09 2018 at 22:51)</a>:</h4>
<p>Yours is much broader</p>



<a name="135504710"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2354499%20Invalid%20%22variable%20does%20not%20need%20to%20be%20mutable%22/near/135504710" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> pnkfelix <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2354499.20Invalid.20.22variable.20does.20not.20need.20to.20be.20mutable.22.html#135504710">(Oct 09 2018 at 22:51)</a>:</h4>
<p>I only put mine up in case you wanted to e.g. look at the tests</p>



<a name="135504716"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2354499%20Invalid%20%22variable%20does%20not%20need%20to%20be%20mutable%22/near/135504716" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2354499.20Invalid.20.22variable.20does.20not.20need.20to.20be.20mutable.22.html#135504716">(Oct 09 2018 at 22:51)</a>:</h4>
<p>gotcha</p>



<a name="135504726"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2354499%20Invalid%20%22variable%20does%20not%20need%20to%20be%20mutable%22/near/135504726" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> pnkfelix <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2354499.20Invalid.20.22variable.20does.20not.20need.20to.20be.20mutable.22.html#135504726">(Oct 09 2018 at 22:52)</a>:</h4>
<p>I'll write a comment making that clear</p>



<a name="135504901"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2354499%20Invalid%20%22variable%20does%20not%20need%20to%20be%20mutable%22/near/135504901" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2354499.20Invalid.20.22variable.20does.20not.20need.20to.20be.20mutable.22.html#135504901">(Oct 09 2018 at 22:54)</a>:</h4>
<p>I've just pushed my stuff</p>



<a name="135504904"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2354499%20Invalid%20%22variable%20does%20not%20need%20to%20be%20mutable%22/near/135504904" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2354499.20Invalid.20.22variable.20does.20not.20need.20to.20be.20mutable.22.html#135504904">(Oct 09 2018 at 22:54)</a>:</h4>
<p>gonna compare the tests</p>



<a name="135504976"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2354499%20Invalid%20%22variable%20does%20not%20need%20to%20be%20mutable%22/near/135504976" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2354499.20Invalid.20.22variable.20does.20not.20need.20to.20be.20mutable.22.html#135504976">(Oct 09 2018 at 22:56)</a>:</h4>
<p><span class="user-mention" data-user-id="116083">@pnkfelix</span> <a href="https://github.com/rust-lang/rust/pull/54621/commits/56011eb2e3bf8450caaf54fb90050a3e0100398f" target="_blank" title="https://github.com/rust-lang/rust/pull/54621/commits/56011eb2e3bf8450caaf54fb90050a3e0100398f">https://github.com/rust-lang/rust/pull/54621/commits/56011eb2e3bf8450caaf54fb90050a3e0100398f</a></p>



<a name="135504982"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2354499%20Invalid%20%22variable%20does%20not%20need%20to%20be%20mutable%22/near/135504982" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2354499.20Invalid.20.22variable.20does.20not.20need.20to.20be.20mutable.22.html#135504982">(Oct 09 2018 at 22:56)</a>:</h4>
<p>if you take a look at that there are some differences I guess</p>



<a name="135504984"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2354499%20Invalid%20%22variable%20does%20not%20need%20to%20be%20mutable%22/near/135504984" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2354499.20Invalid.20.22variable.20does.20not.20need.20to.20be.20mutable.22.html#135504984">(Oct 09 2018 at 22:56)</a>:</h4>
<p>I'm starting to check so unsure yet</p>



<a name="135505076"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2354499%20Invalid%20%22variable%20does%20not%20need%20to%20be%20mutable%22/near/135505076" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> pnkfelix <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2354499.20Invalid.20.22variable.20does.20not.20need.20to.20be.20mutable.22.html#135505076">(Oct 09 2018 at 22:58)</a>:</h4>
<p>so</p>



<a name="135505079"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2354499%20Invalid%20%22variable%20does%20not%20need%20to%20be%20mutable%22/near/135505079" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> pnkfelix <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2354499.20Invalid.20.22variable.20does.20not.20need.20to.20be.20mutable.22.html#135505079">(Oct 09 2018 at 22:58)</a>:</h4>
<p>you have some extra errors injected</p>



<a name="135505080"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2354499%20Invalid%20%22variable%20does%20not%20need%20to%20be%20mutable%22/near/135505080" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> pnkfelix <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2354499.20Invalid.20.22variable.20does.20not.20need.20to.20be.20mutable.22.html#135505080">(Oct 09 2018 at 22:58)</a>:</h4>
<p>that I avoided</p>



<a name="135505088"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2354499%20Invalid%20%22variable%20does%20not%20need%20to%20be%20mutable%22/near/135505088" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2354499.20Invalid.20.22variable.20does.20not.20need.20to.20be.20mutable.22.html#135505088">(Oct 09 2018 at 22:58)</a>:</h4>
<p>yep</p>



<a name="135505093"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2354499%20Invalid%20%22variable%20does%20not%20need%20to%20be%20mutable%22/near/135505093" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2354499.20Invalid.20.22variable.20does.20not.20need.20to.20be.20mutable.22.html#135505093">(Oct 09 2018 at 22:58)</a>:</h4>
<p>we don't want this <a href="https://github.com/rust-lang/rust/pull/54621/commits/56011eb2e3bf8450caaf54fb90050a3e0100398f#diff-27087a37a3701eb55da69c6420fb0fa8R1" target="_blank" title="https://github.com/rust-lang/rust/pull/54621/commits/56011eb2e3bf8450caaf54fb90050a3e0100398f#diff-27087a37a3701eb55da69c6420fb0fa8R1">https://github.com/rust-lang/rust/pull/54621/commits/56011eb2e3bf8450caaf54fb90050a3e0100398f#diff-27087a37a3701eb55da69c6420fb0fa8R1</a></p>



<a name="135505117"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2354499%20Invalid%20%22variable%20does%20not%20need%20to%20be%20mutable%22/near/135505117" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2354499.20Invalid.20.22variable.20does.20not.20need.20to.20be.20mutable.22.html#135505117">(Oct 09 2018 at 22:59)</a>:</h4>
<p>the moved error is good enough</p>



<a name="135505124"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2354499%20Invalid%20%22variable%20does%20not%20need%20to%20be%20mutable%22/near/135505124" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> pnkfelix <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2354499.20Invalid.20.22variable.20does.20not.20need.20to.20be.20mutable.22.html#135505124">(Oct 09 2018 at 22:59)</a>:</h4>
<p>if you look at my patch</p>



<a name="135505134"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2354499%20Invalid%20%22variable%20does%20not%20need%20to%20be%20mutable%22/near/135505134" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> pnkfelix <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2354499.20Invalid.20.22variable.20does.20not.20need.20to.20be.20mutable.22.html#135505134">(Oct 09 2018 at 22:59)</a>:</h4>
<p>you can see I deliberately used PrefixSet::Shallow</p>



<a name="135505199"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2354499%20Invalid%20%22variable%20does%20not%20need%20to%20be%20mutable%22/near/135505199" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> pnkfelix <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2354499.20Invalid.20.22variable.20does.20not.20need.20to.20be.20mutable.22.html#135505199">(Oct 09 2018 at 23:00)</a>:</h4>
<p>That was because I was hitting the same case on borrowck-issue-48962.stderr</p>



<a name="135505213"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2354499%20Invalid%20%22variable%20does%20not%20need%20to%20be%20mutable%22/near/135505213" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> pnkfelix <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2354499.20Invalid.20.22variable.20does.20not.20need.20to.20be.20mutable.22.html#135505213">(Oct 09 2018 at 23:00)</a>:</h4>
<p>until I made that change</p>



<a name="135505232"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2354499%20Invalid%20%22variable%20does%20not%20need%20to%20be%20mutable%22/near/135505232" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> pnkfelix <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2354499.20Invalid.20.22variable.20does.20not.20need.20to.20be.20mutable.22.html#135505232">(Oct 09 2018 at 23:00)</a>:</h4>
<p>Its here on my PR: <a href="https://github.com/rust-lang/rust/pull/54941/commits/e28b889108285ae5307e09ccb3fbd27febfcd44d#diff-5b4d01d26caf43976125ba0f877e78c0R1718" target="_blank" title="https://github.com/rust-lang/rust/pull/54941/commits/e28b889108285ae5307e09ccb3fbd27febfcd44d#diff-5b4d01d26caf43976125ba0f877e78c0R1718">https://github.com/rust-lang/rust/pull/54941/commits/e28b889108285ae5307e09ccb3fbd27febfcd44d#diff-5b4d01d26caf43976125ba0f877e78c0R1718</a></p>



<a name="135505388"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2354499%20Invalid%20%22variable%20does%20not%20need%20to%20be%20mutable%22/near/135505388" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2354499.20Invalid.20.22variable.20does.20not.20need.20to.20be.20mutable.22.html#135505388">(Oct 09 2018 at 23:03)</a>:</h4>
<blockquote>
<p>you can see I deliberately used PrefixSet::Shallow</p>
</blockquote>
<p>what is that?</p>



<a name="135505450"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2354499%20Invalid%20%22variable%20does%20not%20need%20to%20be%20mutable%22/near/135505450" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> pnkfelix <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2354499.20Invalid.20.22variable.20does.20not.20need.20to.20be.20mutable.22.html#135505450">(Oct 09 2018 at 23:04)</a>:</h4>
<p>well</p>



<a name="135505456"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2354499%20Invalid%20%22variable%20does%20not%20need%20to%20be%20mutable%22/near/135505456" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> pnkfelix <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2354499.20Invalid.20.22variable.20does.20not.20need.20to.20be.20mutable.22.html#135505456">(Oct 09 2018 at 23:04)</a>:</h4>
<p>we have a helper for iterating over all the prefixes of a path</p>



<a name="135505465"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2354499%20Invalid%20%22variable%20does%20not%20need%20to%20be%20mutable%22/near/135505465" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> pnkfelix <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2354499.20Invalid.20.22variable.20does.20not.20need.20to.20be.20mutable.22.html#135505465">(Oct 09 2018 at 23:04)</a>:</h4>
<p>i.e., given <code>a.b.c</code>, it gives you  [<code>a.b.c</code>, <code>a.b</code>, <code>a</code>]</p>



<a name="135505483"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2354499%20Invalid%20%22variable%20does%20not%20need%20to%20be%20mutable%22/near/135505483" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> pnkfelix <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2354499.20Invalid.20.22variable.20does.20not.20need.20to.20be.20mutable.22.html#135505483">(Oct 09 2018 at 23:05)</a>:</h4>
<p>But for some common situations , you don't want to traverse over <em>all</em> the kinds of projections</p>



<a name="135505492"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2354499%20Invalid%20%22variable%20does%20not%20need%20to%20be%20mutable%22/near/135505492" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> pnkfelix <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2354499.20Invalid.20.22variable.20does.20not.20need.20to.20be.20mutable.22.html#135505492">(Oct 09 2018 at 23:05)</a>:</h4>
<p>namely, there are times when you want to stop as soon as you hit a Deref</p>



<a name="135505551"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2354499%20Invalid%20%22variable%20does%20not%20need%20to%20be%20mutable%22/near/135505551" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> pnkfelix <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2354499.20Invalid.20.22variable.20does.20not.20need.20to.20be.20mutable.22.html#135505551">(Oct 09 2018 at 23:06)</a>:</h4>
<p>these are documented in rustc_mir::borrow_check::prefixes</p>



<a name="135505569"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2354499%20Invalid%20%22variable%20does%20not%20need%20to%20be%20mutable%22/near/135505569" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2354499.20Invalid.20.22variable.20does.20not.20need.20to.20be.20mutable.22.html#135505569">(Oct 09 2018 at 23:06)</a>:</h4>
<p>I see</p>



<a name="135505596"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2354499%20Invalid%20%22variable%20does%20not%20need%20to%20be%20mutable%22/near/135505596" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> pnkfelix <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2354499.20Invalid.20.22variable.20does.20not.20need.20to.20be.20mutable.22.html#135505596">(Oct 09 2018 at 23:07)</a>:</h4>
<p>I'm betting you can adapt the code I used</p>



<a name="135505598"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2354499%20Invalid%20%22variable%20does%20not%20need%20to%20be%20mutable%22/near/135505598" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> pnkfelix <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2354499.20Invalid.20.22variable.20does.20not.20need.20to.20be.20mutable.22.html#135505598">(Oct 09 2018 at 23:07)</a>:</h4>
<p>but plug it into the context</p>



<a name="135505600"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2354499%20Invalid%20%22variable%20does%20not%20need%20to%20be%20mutable%22/near/135505600" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> pnkfelix <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2354499.20Invalid.20.22variable.20does.20not.20need.20to.20be.20mutable.22.html#135505600">(Oct 09 2018 at 23:07)</a>:</h4>
<p>where you have your change</p>



<a name="135505602"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2354499%20Invalid%20%22variable%20does%20not%20need%20to%20be%20mutable%22/near/135505602" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> pnkfelix <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2354499.20Invalid.20.22variable.20does.20not.20need.20to.20be.20mutable.22.html#135505602">(Oct 09 2018 at 23:07)</a>:</h4>
<p>if you prefer to keep it there</p>



<a name="135505648"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2354499%20Invalid%20%22variable%20does%20not%20need%20to%20be%20mutable%22/near/135505648" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> pnkfelix <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2354499.20Invalid.20.22variable.20does.20not.20need.20to.20be.20mutable.22.html#135505648">(Oct 09 2018 at 23:08)</a>:</h4>
<p>the Only reason I have my code at the spot where I have it</p>



<a name="135505692"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2354499%20Invalid%20%22variable%20does%20not%20need%20to%20be%20mutable%22/near/135505692" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> pnkfelix <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2354499.20Invalid.20.22variable.20does.20not.20need.20to.20be.20mutable.22.html#135505692">(Oct 09 2018 at 23:09)</a>:</h4>
<p>is that it happens to fall near where we handle assignments to fields of structs that implement Drop</p>



<a name="135505699"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2354499%20Invalid%20%22variable%20does%20not%20need%20to%20be%20mutable%22/near/135505699" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> pnkfelix <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2354499.20Invalid.20.22variable.20does.20not.20need.20to.20be.20mutable.22.html#135505699">(Oct 09 2018 at 23:09)</a>:</h4>
<p>and I thought the two code paths would end up being the same</p>



<a name="135505716"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2354499%20Invalid%20%22variable%20does%20not%20need%20to%20be%20mutable%22/near/135505716" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> pnkfelix <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2354499.20Invalid.20.22variable.20does.20not.20need.20to.20be.20mutable.22.html#135505716">(Oct 09 2018 at 23:09)</a>:</h4>
<p>Alas, they didn't end up the same at all.</p>



<a name="135505846"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2354499%20Invalid%20%22variable%20does%20not%20need%20to%20be%20mutable%22/near/135505846" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2354499.20Invalid.20.22variable.20does.20not.20need.20to.20be.20mutable.22.html#135505846">(Oct 09 2018 at 23:11)</a>:</h4>
<p>yeah will try that tomorrow</p>



<a name="135505850"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2354499%20Invalid%20%22variable%20does%20not%20need%20to%20be%20mutable%22/near/135505850" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2354499.20Invalid.20.22variable.20does.20not.20need.20to.20be.20mutable.22.html#135505850">(Oct 09 2018 at 23:11)</a>:</h4>
<p>thanks for your help</p>



<a name="135505856"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2354499%20Invalid%20%22variable%20does%20not%20need%20to%20be%20mutable%22/near/135505856" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> pnkfelix <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2354499.20Invalid.20.22variable.20does.20not.20need.20to.20be.20mutable.22.html#135505856">(Oct 09 2018 at 23:11)</a>:</h4>
<p>no problem</p>



<a name="135505858"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2354499%20Invalid%20%22variable%20does%20not%20need%20to%20be%20mutable%22/near/135505858" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> pnkfelix <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2354499.20Invalid.20.22variable.20does.20not.20need.20to.20be.20mutable.22.html#135505858">(Oct 09 2018 at 23:11)</a>:</h4>
<p>I'm just glad</p>



<a name="135505861"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2354499%20Invalid%20%22variable%20does%20not%20need%20to%20be%20mutable%22/near/135505861" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> pnkfelix <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2354499.20Invalid.20.22variable.20does.20not.20need.20to.20be.20mutable.22.html#135505861">(Oct 09 2018 at 23:11)</a>:</h4>
<p>I'm not the only one</p>



<a name="135505905"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2354499%20Invalid%20%22variable%20does%20not%20need%20to%20be%20mutable%22/near/135505905" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> pnkfelix <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2354499.20Invalid.20.22variable.20does.20not.20need.20to.20be.20mutable.22.html#135505905">(Oct 09 2018 at 23:12)</a>:</h4>
<p>who hit that issue with  borrowck-issue-48962.stderr</p>



<a name="135505924"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2354499%20Invalid%20%22variable%20does%20not%20need%20to%20be%20mutable%22/near/135505924" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2354499.20Invalid.20.22variable.20does.20not.20need.20to.20be.20mutable.22.html#135505924">(Oct 09 2018 at 23:12)</a>:</h4>
<p>:)</p>



<a name="135541369"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2354499%20Invalid%20%22variable%20does%20not%20need%20to%20be%20mutable%22/near/135541369" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2354499.20Invalid.20.22variable.20does.20not.20need.20to.20be.20mutable.22.html#135541369">(Oct 10 2018 at 13:36)</a>:</h4>
<p>hmm, ok, so yeah I can see that the simplistic approach I advocated would lead to redundant errors</p>



<a name="135541408"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2354499%20Invalid%20%22variable%20does%20not%20need%20to%20be%20mutable%22/near/135541408" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2354499.20Invalid.20.22variable.20does.20not.20need.20to.20be.20mutable.22.html#135541408">(Oct 10 2018 at 13:37)</a>:</h4>
<p>I can use the prefixes trick that <span class="user-mention" data-user-id="116083">@pnkfelix</span> used</p>



<a name="135541412"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2354499%20Invalid%20%22variable%20does%20not%20need%20to%20be%20mutable%22/near/135541412" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2354499.20Invalid.20.22variable.20does.20not.20need.20to.20be.20mutable.22.html#135541412">(Oct 10 2018 at 13:37)</a>:</h4>
<p>or we should just go the full <span class="user-mention" data-user-id="116083">@pnkfelix</span> path?</p>



<a name="135541414"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2354499%20Invalid%20%22variable%20does%20not%20need%20to%20be%20mutable%22/near/135541414" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2354499.20Invalid.20.22variable.20does.20not.20need.20to.20be.20mutable.22.html#135541414">(Oct 10 2018 at 13:37)</a>:</h4>
<p>prefixes doesn't .. well, that's ok I guess</p>



<a name="135541423"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2354499%20Invalid%20%22variable%20does%20not%20need%20to%20be%20mutable%22/near/135541423" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2354499.20Invalid.20.22variable.20does.20not.20need.20to.20be.20mutable.22.html#135541423">(Oct 10 2018 at 13:37)</a>:</h4>
<p>but we're not really looking to <em>enumerate</em> the set of prefixes per se</p>



<a name="135541452"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2354499%20Invalid%20%22variable%20does%20not%20need%20to%20be%20mutable%22/near/135541452" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2354499.20Invalid.20.22variable.20does.20not.20need.20to.20be.20mutable.22.html#135541452">(Oct 10 2018 at 13:38)</a>:</h4>
<p>what do you mean?</p>



<a name="135541475"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2354499%20Invalid%20%22variable%20does%20not%20need%20to%20be%20mutable%22/near/135541475" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2354499.20Invalid.20.22variable.20does.20not.20need.20to.20be.20mutable.22.html#135541475">(Oct 10 2018 at 13:38)</a>:</h4>
<p>but I guess we can just look for a local in that set</p>



<a name="135541506"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2354499%20Invalid%20%22variable%20does%20not%20need%20to%20be%20mutable%22/near/135541506" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> pnkfelix <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2354499.20Invalid.20.22variable.20does.20not.20need.20to.20be.20mutable.22.html#135541506">(Oct 10 2018 at 13:38)</a>:</h4>
<p>It’s just a trick to limit oneself to the Shallow set</p>



<a name="135541513"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2354499%20Invalid%20%22variable%20does%20not%20need%20to%20be%20mutable%22/near/135541513" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2354499.20Invalid.20.22variable.20does.20not.20need.20to.20be.20mutable.22.html#135541513">(Oct 10 2018 at 13:38)</a>:</h4>
<p>right, as opposed to rewriting similar-ish logic</p>



<a name="135541525"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2354499%20Invalid%20%22variable%20does%20not%20need%20to%20be%20mutable%22/near/135541525" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2354499.20Invalid.20.22variable.20does.20not.20need.20to.20be.20mutable.22.html#135541525">(Oct 10 2018 at 13:38)</a>:</h4>
<p>I'm just debating</p>



<a name="135541535"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2354499%20Invalid%20%22variable%20does%20not%20need%20to%20be%20mutable%22/near/135541535" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2354499.20Invalid.20.22variable.20does.20not.20need.20to.20be.20mutable.22.html#135541535">(Oct 10 2018 at 13:38)</a>:</h4>
<p>another way to go about it</p>



<a name="135541547"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2354499%20Invalid%20%22variable%20does%20not%20need%20to%20be%20mutable%22/near/135541547" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2354499.20Invalid.20.22variable.20does.20not.20need.20to.20be.20mutable.22.html#135541547">(Oct 10 2018 at 13:38)</a>:</h4>
<p>so basically there are two cases that would get duplicate errors, I think</p>



<a name="135541557"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2354499%20Invalid%20%22variable%20does%20not%20need%20to%20be%20mutable%22/near/135541557" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2354499.20Invalid.20.22variable.20does.20not.20need.20to.20be.20mutable.22.html#135541557">(Oct 10 2018 at 13:39)</a>:</h4>
<p>derefs of references</p>



<a name="135541567"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2354499%20Invalid%20%22variable%20does%20not%20need%20to%20be%20mutable%22/near/135541567" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2354499.20Invalid.20.22variable.20does.20not.20need.20to.20be.20mutable.22.html#135541567">(Oct 10 2018 at 13:39)</a>:</h4>
<p>but also things with drop, maybe?</p>



<a name="135541577"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2354499%20Invalid%20%22variable%20does%20not%20need%20to%20be%20mutable%22/near/135541577" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2354499.20Invalid.20.22variable.20does.20not.20need.20to.20be.20mutable.22.html#135541577">(Oct 10 2018 at 13:39)</a>:</h4>
<p>I think these kind of correspond to cases that have no <code>MovePathIndex</code>?</p>



<a name="135541585"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2354499%20Invalid%20%22variable%20does%20not%20need%20to%20be%20mutable%22/near/135541585" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2354499.20Invalid.20.22variable.20does.20not.20need.20to.20be.20mutable.22.html#135541585">(Oct 10 2018 at 13:39)</a>:</h4>
<p>I imagine indices also count</p>



<a name="135541608"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2354499%20Invalid%20%22variable%20does%20not%20need%20to%20be%20mutable%22/near/135541608" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2354499.20Invalid.20.22variable.20does.20not.20need.20to.20be.20mutable.22.html#135541608">(Oct 10 2018 at 13:39)</a>:</h4>
<p>e.g., <code>foo[3] = 22</code>, will probably never be allowed if <code>foo</code> is not initialized</p>



<a name="135541671"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2354499%20Invalid%20%22variable%20does%20not%20need%20to%20be%20mutable%22/near/135541671" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2354499.20Invalid.20.22variable.20does.20not.20need.20to.20be.20mutable.22.html#135541671">(Oct 10 2018 at 13:40)</a>:</h4>
<p>so maybe we just want to check if the <code>Place</code> has a <code>MovePathIndex</code>?</p>



<a name="135541678"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2354499%20Invalid%20%22variable%20does%20not%20need%20to%20be%20mutable%22/near/135541678" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2354499.20Invalid.20.22variable.20does.20not.20need.20to.20be.20mutable.22.html#135541678">(Oct 10 2018 at 13:40)</a>:</h4>
<p>and, if so, we then look for its base-local?</p>



<a name="135541693"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2354499%20Invalid%20%22variable%20does%20not%20need%20to%20be%20mutable%22/near/135541693" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> pnkfelix <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2354499.20Invalid.20.22variable.20does.20not.20need.20to.20be.20mutable.22.html#135541693">(Oct 10 2018 at 13:40)</a>:</h4>
<p>/me points to their PR</p>



<a name="135541703"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2354499%20Invalid%20%22variable%20does%20not%20need%20to%20be%20mutable%22/near/135541703" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2354499.20Invalid.20.22variable.20does.20not.20need.20to.20be.20mutable.22.html#135541703">(Oct 10 2018 at 13:40)</a>:</h4>
<p>sigh, I'll go read it :P</p>



<a name="135541726"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2354499%20Invalid%20%22variable%20does%20not%20need%20to%20be%20mutable%22/near/135541726" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> pnkfelix <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2354499.20Invalid.20.22variable.20does.20not.20need.20to.20be.20mutable.22.html#135541726">(Oct 10 2018 at 13:41)</a>:</h4>
<p>I’m more laughing</p>



<a name="135541733"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2354499%20Invalid%20%22variable%20does%20not%20need%20to%20be%20mutable%22/near/135541733" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2354499.20Invalid.20.22variable.20does.20not.20need.20to.20be.20mutable.22.html#135541733">(Oct 10 2018 at 13:41)</a>:</h4>
<p>well</p>



<a name="135541750"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2354499%20Invalid%20%22variable%20does%20not%20need%20to%20be%20mutable%22/near/135541750" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> pnkfelix <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2354499.20Invalid.20.22variable.20does.20not.20need.20to.20be.20mutable.22.html#135541750">(Oct 10 2018 at 13:41)</a>:</h4>
<p>Because what you describe overlaps what it does. Except that it doesn’t bother trying to go to the base local</p>



<a name="135541752"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2354499%20Invalid%20%22variable%20does%20not%20need%20to%20be%20mutable%22/near/135541752" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2354499.20Invalid.20.22variable.20does.20not.20need.20to.20be.20mutable.22.html#135541752">(Oct 10 2018 at 13:42)</a>:</h4>
<p>I guess the question is if we hvae to enumerate prefixes, presumably you have examples why we want to :)</p>



<a name="135541812"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2354499%20Invalid%20%22variable%20does%20not%20need%20to%20be%20mutable%22/near/135541812" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2354499.20Invalid.20.22variable.20does.20not.20need.20to.20be.20mutable.22.html#135541812">(Oct 10 2018 at 13:42)</a>:</h4>
<p>I'm confused</p>



<a name="135541825"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2354499%20Invalid%20%22variable%20does%20not%20need%20to%20be%20mutable%22/near/135541825" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2354499.20Invalid.20.22variable.20does.20not.20need.20to.20be.20mutable.22.html#135541825">(Oct 10 2018 at 13:42)</a>:</h4>
<p>isn't Felix's PR, enough?</p>



<a name="135541828"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2354499%20Invalid%20%22variable%20does%20not%20need%20to%20be%20mutable%22/near/135541828" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2354499.20Invalid.20.22variable.20does.20not.20need.20to.20be.20mutable.22.html#135541828">(Oct 10 2018 at 13:42)</a>:</h4>
<p>or a variant of it?</p>



<a name="135541836"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2354499%20Invalid%20%22variable%20does%20not%20need%20to%20be%20mutable%22/near/135541836" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2354499.20Invalid.20.22variable.20does.20not.20need.20to.20be.20mutable.22.html#135541836">(Oct 10 2018 at 13:42)</a>:</h4>
<p>I'm ok with just throwing away my PR and using Felix code</p>



<a name="135541863"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2354499%20Invalid%20%22variable%20does%20not%20need%20to%20be%20mutable%22/near/135541863" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2354499.20Invalid.20.22variable.20does.20not.20need.20to.20be.20mutable.22.html#135541863">(Oct 10 2018 at 13:43)</a>:</h4>
<p>/me shrugs</p>



<a name="135541867"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2354499%20Invalid%20%22variable%20does%20not%20need%20to%20be%20mutable%22/near/135541867" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2354499.20Invalid.20.22variable.20does.20not.20need.20to.20be.20mutable.22.html#135541867">(Oct 10 2018 at 13:43)</a>:</h4>
<p>yeah, maybe we should do that?</p>



<a name="135541871"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2354499%20Invalid%20%22variable%20does%20not%20need%20to%20be%20mutable%22/near/135541871" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2354499.20Invalid.20.22variable.20does.20not.20need.20to.20be.20mutable.22.html#135541871">(Oct 10 2018 at 13:43)</a>:</h4>
<p>it seems like they are sort of doing the same thing</p>



<a name="135541873"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2354499%20Invalid%20%22variable%20does%20not%20need%20to%20be%20mutable%22/near/135541873" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2354499.20Invalid.20.22variable.20does.20not.20need.20to.20be.20mutable.22.html#135541873">(Oct 10 2018 at 13:43)</a>:</h4>
<p>I remember that <span class="user-mention" data-user-id="116083">@pnkfelix</span> said that it was for <a href="https://github.com/rust-lang/rust/issues/21232" target="_blank" title="https://github.com/rust-lang/rust/issues/21232">#21232</a></p>



<a name="135541877"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2354499%20Invalid%20%22variable%20does%20not%20need%20to%20be%20mutable%22/near/135541877" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2354499.20Invalid.20.22variable.20does.20not.20need.20to.20be.20mutable.22.html#135541877">(Oct 10 2018 at 13:43)</a>:</h4>
<p>the place where <span class="user-mention" data-user-id="116083">@pnkfelix</span> put their patch also makes sense</p>



<a name="135541882"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2354499%20Invalid%20%22variable%20does%20not%20need%20to%20be%20mutable%22/near/135541882" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2354499.20Invalid.20.22variable.20does.20not.20need.20to.20be.20mutable.22.html#135541882">(Oct 10 2018 at 13:43)</a>:</h4>
<p>maybe more sense</p>



<a name="135541932"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2354499%20Invalid%20%22variable%20does%20not%20need%20to%20be%20mutable%22/near/135541932" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> pnkfelix <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2354499.20Invalid.20.22variable.20does.20not.20need.20to.20be.20mutable.22.html#135541932">(Oct 10 2018 at 13:44)</a>:</h4>
<p>I assume that <span class="user-mention" data-user-id="116266">@Santiago Pastorino</span> ‘s other changes are worth keeping</p>



<a name="135541959"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2354499%20Invalid%20%22variable%20does%20not%20need%20to%20be%20mutable%22/near/135541959" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2354499.20Invalid.20.22variable.20does.20not.20need.20to.20be.20mutable.22.html#135541959">(Oct 10 2018 at 13:44)</a>:</h4>
<p>what are the other changes you're mentioning?</p>



<a name="135541964"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2354499%20Invalid%20%22variable%20does%20not%20need%20to%20be%20mutable%22/near/135541964" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2354499.20Invalid.20.22variable.20does.20not.20need.20to.20be.20mutable.22.html#135541964">(Oct 10 2018 at 13:45)</a>:</h4>
<p>I think the only thing in <span class="user-mention" data-user-id="116266">@Santiago Pastorino</span>'s PR that's not in yours is the <code>used_mut</code> modification?</p>



<a name="135541980"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2354499%20Invalid%20%22variable%20does%20not%20need%20to%20be%20mutable%22/near/135541980" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> pnkfelix <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2354499.20Invalid.20.22variable.20does.20not.20need.20to.20be.20mutable.22.html#135541980">(Oct 10 2018 at 13:45)</a>:</h4>
<p>Right</p>



<a name="135542273"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2354499%20Invalid%20%22variable%20does%20not%20need%20to%20be%20mutable%22/near/135542273" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2354499.20Invalid.20.22variable.20does.20not.20need.20to.20be.20mutable.22.html#135542273">(Oct 10 2018 at 13:50)</a>:</h4>
<p>what happens if we have </p>
<div class="codehilite"><pre><span></span><span class="k">fn</span> <span class="nf">main</span><span class="p">()</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="k">mut</span><span class="w"> </span><span class="n">a</span>: <span class="p">(</span><span class="kt">u32</span><span class="p">,</span><span class="w"> </span><span class="kt">u32</span><span class="p">);</span><span class="w"></span>
<span class="w">    </span><span class="n">a</span><span class="p">.</span><span class="mi">0</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">22</span><span class="p">;</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>
</pre></div>


<p>in your PR, <span class="user-mention" data-user-id="116083">@pnkfelix</span> ?</p>



<a name="135542277"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2354499%20Invalid%20%22variable%20does%20not%20need%20to%20be%20mutable%22/near/135542277" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2354499.20Invalid.20.22variable.20does.20not.20need.20to.20be.20mutable.22.html#135542277">(Oct 10 2018 at 13:50)</a>:</h4>
<p>(do you happen to a build available to test?)</p>



<a name="135542280"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2354499%20Invalid%20%22variable%20does%20not%20need%20to%20be%20mutable%22/near/135542280" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2354499.20Invalid.20.22variable.20does.20not.20need.20to.20be.20mutable.22.html#135542280">(Oct 10 2018 at 13:50)</a>:</h4>
<p>seems like it'd be easy to modify your PR to add the local variable to the set</p>



<a name="135559749"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2354499%20Invalid%20%22variable%20does%20not%20need%20to%20be%20mutable%22/near/135559749" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2354499.20Invalid.20.22variable.20does.20not.20need.20to.20be.20mutable.22.html#135559749">(Oct 10 2018 at 18:35)</a>:</h4>
<p><span class="user-mention" data-user-id="116083">@pnkfelix</span> just wanted to be sure here</p>



<a name="135559799"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2354499%20Invalid%20%22variable%20does%20not%20need%20to%20be%20mutable%22/near/135559799" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2354499.20Invalid.20.22variable.20does.20not.20need.20to.20be.20mutable.22.html#135559799">(Oct 10 2018 at 18:36)</a>:</h4>
<p>I guess the best thing would be if you continue with your branch and we throw away my PR</p>



<a name="135559829"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2354499%20Invalid%20%22variable%20does%20not%20need%20to%20be%20mutable%22/near/135559829" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2354499.20Invalid.20.22variable.20does.20not.20need.20to.20be.20mutable.22.html#135559829">(Oct 10 2018 at 18:36)</a>:</h4>
<p>anyway, let me know if I can help in some way but given you have 99% of the stuff and you've figured most of the stuff I guess it's better if you continue ... ?</p>



<a name="135560448"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2354499%20Invalid%20%22variable%20does%20not%20need%20to%20be%20mutable%22/near/135560448" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> pnkfelix <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2354499.20Invalid.20.22variable.20does.20not.20need.20to.20be.20mutable.22.html#135560448">(Oct 10 2018 at 18:46)</a>:</h4>
<p>(Sorry I was afk for a couple of hours; my parents are visiting. I’ll try to answer these Q’s tonight or tomorrow AM at the latest)</p>



<a name="135596826"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2354499%20Invalid%20%22variable%20does%20not%20need%20to%20be%20mutable%22/near/135596826" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> pnkfelix <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2354499.20Invalid.20.22variable.20does.20not.20need.20to.20be.20mutable.22.html#135596826">(Oct 11 2018 at 09:29)</a>:</h4>
<blockquote>
<p>what happens if we have </p>
<div class="codehilite"><pre><span></span><span class="k">fn</span> <span class="nf">main</span><span class="p">()</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="k">mut</span><span class="w"> </span><span class="n">a</span>: <span class="p">(</span><span class="kt">u32</span><span class="p">,</span><span class="w"> </span><span class="kt">u32</span><span class="p">);</span><span class="w"></span>
<span class="w">    </span><span class="n">a</span><span class="p">.</span><span class="mi">0</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">22</span><span class="p">;</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>
</pre></div>


<p>in your PR, <span class="user-mention" data-user-id="116083">@pnkfelix</span> ?</p>
</blockquote>
<p>Egad, my PR doesn't handle that!</p>



<a name="135596883"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2354499%20Invalid%20%22variable%20does%20not%20need%20to%20be%20mutable%22/near/135596883" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> pnkfelix <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2354499.20Invalid.20.22variable.20does.20not.20need.20to.20be.20mutable.22.html#135596883">(Oct 11 2018 at 09:30)</a>:</h4>
<p>Will fix</p>



<a name="135597586"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2354499%20Invalid%20%22variable%20does%20not%20need%20to%20be%20mutable%22/near/135597586" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> pnkfelix <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2354499.20Invalid.20.22variable.20does.20not.20need.20to.20be.20mutable.22.html#135597586">(Oct 11 2018 at 09:46)</a>:</h4>
<p>Perhaps we should consider unifying <code>Tuple</code> and <code>Adt</code> ...</p>



<a name="135597787"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2354499%20Invalid%20%22variable%20does%20not%20need%20to%20be%20mutable%22/near/135597787" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2354499.20Invalid.20.22variable.20does.20not.20need.20to.20be.20mutable.22.html#135597787">(Oct 11 2018 at 09:50)</a>:</h4>
<p>In general, I think we have WAY too many type variants. They should basically <em>all</em> be ADT...</p>



<a name="135598924"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2354499%20Invalid%20%22variable%20does%20not%20need%20to%20be%20mutable%22/near/135598924" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> pnkfelix <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2354499.20Invalid.20.22variable.20does.20not.20need.20to.20be.20mutable.22.html#135598924">(Oct 11 2018 at 10:14)</a>:</h4>
<p>Ah! <span class="emoji emoji-1f628" title="scared">:scared:</span> <a href="https://github.com/rust-lang/rust/blob/master/src/test/run-pass/issues/issue-26996.rs" target="_blank" title="https://github.com/rust-lang/rust/blob/master/src/test/run-pass/issues/issue-26996.rs">https://github.com/rust-lang/rust/blob/master/src/test/run-pass/issues/issue-26996.rs</a></p>



<a name="135598976"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2354499%20Invalid%20%22variable%20does%20not%20need%20to%20be%20mutable%22/near/135598976" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> pnkfelix <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2354499.20Invalid.20.22variable.20does.20not.20need.20to.20be.20mutable.22.html#135598976">(Oct 11 2018 at 10:15)</a>:</h4>
<p>I'd say we're in the right for shifting to rejecting this code</p>



<a name="135599079"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2354499%20Invalid%20%22variable%20does%20not%20need%20to%20be%20mutable%22/near/135599079" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> pnkfelix <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2354499.20Invalid.20.22variable.20does.20not.20need.20to.20be.20mutable.22.html#135599079">(Oct 11 2018 at 10:17)</a>:</h4>
<p>Other similar cases: <a href="https://github.com/rust-lang/rust/blob/master/src/test/run-pass/issues/issue-27021.rs" target="_blank" title="https://github.com/rust-lang/rust/blob/master/src/test/run-pass/issues/issue-27021.rs">https://github.com/rust-lang/rust/blob/master/src/test/run-pass/issues/issue-27021.rs</a> and <a href="https://github.com/rust-lang/rust/blob/master/src/test/run-pass/issues/issue-49298.rs" target="_blank" title="https://github.com/rust-lang/rust/blob/master/src/test/run-pass/issues/issue-49298.rs">https://github.com/rust-lang/rust/blob/master/src/test/run-pass/issues/issue-49298.rs</a></p>



<a name="135599087"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2354499%20Invalid%20%22variable%20does%20not%20need%20to%20be%20mutable%22/near/135599087" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> pnkfelix <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2354499.20Invalid.20.22variable.20does.20not.20need.20to.20be.20mutable.22.html#135599087">(Oct 11 2018 at 10:17)</a>:</h4>
<p>I am however also now wondering whether this is simply too risky a change for us to throw in at this late date</p>



<a name="135599143"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2354499%20Invalid%20%22variable%20does%20not%20need%20to%20be%20mutable%22/near/135599143" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> pnkfelix <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2354499.20Invalid.20.22variable.20does.20not.20need.20to.20be.20mutable.22.html#135599143">(Oct 11 2018 at 10:18)</a>:</h4>
<p>The change being  "NLL: Reject partial init of uninitialized record (struct or tuple)" <a href="https://github.com/rust-lang/rust/issues/54986" target="_blank" title="https://github.com/rust-lang/rust/issues/54986">#54986</a>  (I've made two distinct issues so we can stop referring ambiguously to <a href="https://github.com/rust-lang/rust/issues/21232" target="_blank" title="https://github.com/rust-lang/rust/issues/21232">#21232</a>)</p>



<a name="135615530"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2354499%20Invalid%20%22variable%20does%20not%20need%20to%20be%20mutable%22/near/135615530" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> pnkfelix <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2354499.20Invalid.20.22variable.20does.20not.20need.20to.20be.20mutable.22.html#135615530">(Oct 11 2018 at 15:17)</a>:</h4>
<p>okay, I found a place where I guess we should map to the base local rather than doing just the nearest prefix like I did</p>



<a name="135615621"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2354499%20Invalid%20%22variable%20does%20not%20need%20to%20be%20mutable%22/near/135615621" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> pnkfelix <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2354499.20Invalid.20.22variable.20does.20not.20need.20to.20be.20mutable.22.html#135615621">(Oct 11 2018 at 15:18)</a>:</h4>
<p>namely, if you have two levels of struct, like <code>struct R&lt;F&gt; { f: F, ... }</code> and <code>struct S { x: u32, ... }</code>, and you do: <code>let r: R&lt;S&gt;; r.f.x = 10;</code></p>



<a name="135615638"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2354499%20Invalid%20%22variable%20does%20not%20need%20to%20be%20mutable%22/near/135615638" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> pnkfelix <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2354499.20Invalid.20.22variable.20does.20not.20need.20to.20be.20mutable.22.html#135615638">(Oct 11 2018 at 15:18)</a>:</h4>
<p>I <em>think</em> we want the error to point out that <code>r</code> is uninitialized</p>



<a name="135615648"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2354499%20Invalid%20%22variable%20does%20not%20need%20to%20be%20mutable%22/near/135615648" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> pnkfelix <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2354499.20Invalid.20.22variable.20does.20not.20need.20to.20be.20mutable.22.html#135615648">(Oct 11 2018 at 15:18)</a>:</h4>
<p>and not just say that <code>r.f</code> is uninitialized.</p>



<a name="135615728"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2354499%20Invalid%20%22variable%20does%20not%20need%20to%20be%20mutable%22/near/135615728" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> pnkfelix <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2354499.20Invalid.20.22variable.20does.20not.20need.20to.20be.20mutable.22.html#135615728">(Oct 11 2018 at 15:19)</a>:</h4>
<p>(though I should go back and double check how that interacts with moving in and out of parts of the struct. E.g. if <code>r</code> <em>was</em><code> initialized and then we moved *out* of </code>r.f<code>, then we *should* report </code>r.f` as the unintialized thing.</p>



<a name="135620472"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2354499%20Invalid%20%22variable%20does%20not%20need%20to%20be%20mutable%22/near/135620472" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2354499.20Invalid.20.22variable.20does.20not.20need.20to.20be.20mutable.22.html#135620472">(Oct 11 2018 at 16:40)</a>:</h4>
<p><span class="user-mention" data-user-id="116083">@pnkfelix</span> in the case of <code>issue-26996</code>, can you read from those fields again later? (e.g., <code>c.0</code>)</p>



<a name="135620479"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2354499%20Invalid%20%22variable%20does%20not%20need%20to%20be%20mutable%22/near/135620479" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2354499.20Invalid.20.22variable.20does.20not.20need.20to.20be.20mutable.22.html#135620479">(Oct 11 2018 at 16:40)</a>:</h4>
<blockquote>
<p>and not just say that <code>r.f</code> is uninitialized.</p>
</blockquote>
<p>agreed</p>



<a name="135628648"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2354499%20Invalid%20%22variable%20does%20not%20need%20to%20be%20mutable%22/near/135628648" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> pnkfelix <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2354499.20Invalid.20.22variable.20does.20not.20need.20to.20be.20mutable.22.html#135628648">(Oct 11 2018 at 19:03)</a>:</h4>
<blockquote>
<p><span class="user-mention" data-user-id="116083">@pnkfelix</span> in the case of <code>issue-26996</code>, can you read from those fields again later? (e.g., <code>c.0</code>)</p>
</blockquote>
<p>I'll find out</p>



<a name="135636202"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2354499%20Invalid%20%22variable%20does%20not%20need%20to%20be%20mutable%22/near/135636202" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> pnkfelix <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2354499.20Invalid.20.22variable.20does.20not.20need.20to.20be.20mutable.22.html#135636202">(Oct 11 2018 at 21:04)</a>:</h4>
<blockquote>
<blockquote>
<p><span class="user-mention" data-user-id="116083">@pnkfelix</span> in the case of <code>issue-26996</code>, can you read from those fields again later? (e.g., <code>c.0</code>)</p>
</blockquote>
<p>I'll find out</p>
</blockquote>
<p>Hmm. In AST-borrowck, you get a "use of moved value <code>c.0</code></p>



<a name="135636211"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2354499%20Invalid%20%22variable%20does%20not%20need%20to%20be%20mutable%22/near/135636211" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> pnkfelix <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2354499.20Invalid.20.22variable.20does.20not.20need.20to.20be.20mutable.22.html#135636211">(Oct 11 2018 at 21:04)</a>:</h4>
<p>but in NLL, you can read it. <span class="emoji emoji-1f628" title="fear">:fear:</span></p>



<a name="135636228"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2354499%20Invalid%20%22variable%20does%20not%20need%20to%20be%20mutable%22/near/135636228" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> pnkfelix <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2354499.20Invalid.20.22variable.20does.20not.20need.20to.20be.20mutable.22.html#135636228">(Oct 11 2018 at 21:04)</a>:</h4>
<p>So, yeah. Lets get this error landed.</p>



<a name="135636270"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2354499%20Invalid%20%22variable%20does%20not%20need%20to%20be%20mutable%22/near/135636270" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> pnkfelix <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2354499.20Invalid.20.22variable.20does.20not.20need.20to.20be.20mutable.22.html#135636270">(Oct 11 2018 at 21:05)</a>:</h4>
<p>Well, that, or accept that some code is going to be accepted and we're just going to slowly trudge our way towards implementing <a href="https://github.com/rust-lang/rust/issues/54987" target="_blank" title="https://github.com/rust-lang/rust/issues/54987">#54987</a></p>



<a name="135643600"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2354499%20Invalid%20%22variable%20does%20not%20need%20to%20be%20mutable%22/near/135643600" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> pnkfelix <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2354499.20Invalid.20.22variable.20does.20not.20need.20to.20be.20mutable.22.html#135643600">(Oct 11 2018 at 23:36)</a>:</h4>
<p>Anyway I've posted updates to my PR at <a href="https://github.com/rust-lang/rust/issues/54941" target="_blank" title="https://github.com/rust-lang/rust/issues/54941">#54941</a></p>



<a name="135643604"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2354499%20Invalid%20%22variable%20does%20not%20need%20to%20be%20mutable%22/near/135643604" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> pnkfelix <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2354499.20Invalid.20.22variable.20does.20not.20need.20to.20be.20mutable.22.html#135643604">(Oct 11 2018 at 23:36)</a>:</h4>
<p>I <em>still</em> haven't incorporated the <code>used_mut</code> stuff that would actually match the topic here...</p>



<a name="135643607"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2354499%20Invalid%20%22variable%20does%20not%20need%20to%20be%20mutable%22/near/135643607" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> pnkfelix <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2354499.20Invalid.20.22variable.20does.20not.20need.20to.20be.20mutable.22.html#135643607">(Oct 11 2018 at 23:36)</a>:</h4>
<p>(I'll tackle that on Monday)</p>



<a name="135643617"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2354499%20Invalid%20%22variable%20does%20not%20need%20to%20be%20mutable%22/near/135643617" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> pnkfelix <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2354499.20Invalid.20.22variable.20does.20not.20need.20to.20be.20mutable.22.html#135643617">(Oct 11 2018 at 23:37)</a>:</h4>
<p>but in the meantime, it might be a good idea for us to double-check whether we are vaguely okay with the changes to the diagnostics that have resulted from my implementation strategy</p>



<a name="135643670"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2354499%20Invalid%20%22variable%20does%20not%20need%20to%20be%20mutable%22/near/135643670" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> pnkfelix <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2354499.20Invalid.20.22variable.20does.20not.20need.20to.20be.20mutable.22.html#135643670">(Oct 11 2018 at 23:38)</a>:</h4>
<p>namely, when I report the move error, I now pass along <em>two</em> places: the used_place, and a moved_place. (Where moved_place should always be a prefix of used_place, though of course it may be a trivial prefix where the two are actually the same place)</p>



<a name="135643682"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2354499%20Invalid%20%22variable%20does%20not%20need%20to%20be%20mutable%22/near/135643682" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> pnkfelix <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2354499.20Invalid.20.22variable.20does.20not.20need.20to.20be.20mutable.22.html#135643682">(Oct 11 2018 at 23:39)</a>:</h4>
<p>And then the diagnostic distuinguishes in its report when its talking about what was moved vs what was used</p>



<a name="135643762"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2354499%20Invalid%20%22variable%20does%20not%20need%20to%20be%20mutable%22/near/135643762" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> pnkfelix <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2354499.20Invalid.20.22variable.20does.20not.20need.20to.20be.20mutable.22.html#135643762">(Oct 11 2018 at 23:41)</a>:</h4>
<p>(I didn't actually update the diagnostic text very well to reflect this change. But you can see an example of the phenomenon by looking at the places reported for a case like this: <a href="https://github.com/rust-lang/rust/commit/8843c083f69864b63f0de7fa317ecffa09951797#diff-5deea307db35b1f117045b9ea609beac" target="_blank" title="https://github.com/rust-lang/rust/commit/8843c083f69864b63f0de7fa317ecffa09951797#diff-5deea307db35b1f117045b9ea609beac">https://github.com/rust-lang/rust/commit/8843c083f69864b63f0de7fa317ecffa09951797#diff-5deea307db35b1f117045b9ea609beac</a> )</p>



<a name="135643808"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2354499%20Invalid%20%22variable%20does%20not%20need%20to%20be%20mutable%22/near/135643808" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> pnkfelix <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2354499.20Invalid.20.22variable.20does.20not.20need.20to.20be.20mutable.22.html#135643808">(Oct 11 2018 at 23:42)</a>:</h4>
<p>having said that, i'm going to bed.</p>



<hr><p>Last updated: Apr 12 2022 at 20:01 UTC</p>
</html>