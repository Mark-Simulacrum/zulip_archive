<html>
<head><meta charset="utf-8"><title>#53040 `FnMut` return ref to upvar · t-compiler/wg-nll · Zulip Chat Archive</title></head>
<h2>Stream: <a href="https://rust-lang.github.io/zulip_archive/stream/122657-t-compiler/wg-nll/index.html">t-compiler/wg-nll</a></h2>
<h3>Topic: <a href="https://rust-lang.github.io/zulip_archive/stream/122657-t-compiler/wg-nll/topic/.2353040.20.60FnMut.60.20return.20ref.20to.20upvar.html">#53040 `FnMut` return ref to upvar</a></h3>

<hr>

<base href="https://rust-lang.zulipchat.com">

<head><link href="https://rust-lang.github.io/zulip_archive/style.css" rel="stylesheet"></head>

<a name="135141992"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353040%20%60FnMut%60%20return%20ref%20to%20upvar/near/135141992" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> davidtwco <a href="https://rust-lang.github.io/zulip_archive/stream/122657-t-compiler/wg-nll/topic/.2353040.20.60FnMut.60.20return.20ref.20to.20upvar.html#135141992">(Oct 03 2018 at 23:58)</a>:</h4>
<p><span class="user-mention" data-user-id="116009">@nikomatsakis</span> Submitted a WIP <a href="https://github.com/rust-lang/rust/issues/54802" target="_blank" title="https://github.com/rust-lang/rust/issues/54802">#54802</a>. It does what we want (roughly) with the test case but it is affecting other errors and I'm not sure it's better for those.</p>



<a name="135142000"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353040%20%60FnMut%60%20return%20ref%20to%20upvar/near/135142000" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> davidtwco <a href="https://rust-lang.github.io/zulip_archive/stream/122657-t-compiler/wg-nll/topic/.2353040.20.60FnMut.60.20return.20ref.20to.20upvar.html#135142000">(Oct 03 2018 at 23:58)</a>:</h4>
<p>cc <span class="user-mention" data-user-id="116083">@pnkfelix</span></p>



<a name="135190843"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353040%20%60FnMut%60%20return%20ref%20to%20upvar/near/135190843" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://rust-lang.github.io/zulip_archive/stream/122657-t-compiler/wg-nll/topic/.2353040.20.60FnMut.60.20return.20ref.20to.20upvar.html#135190843">(Oct 04 2018 at 14:10)</a>:</h4>
<p><span class="user-mention" data-user-id="116107">@davidtwco</span> cool :)</p>



<a name="135211423"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353040%20%60FnMut%60%20return%20ref%20to%20upvar/near/135211423" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> davidtwco <a href="https://rust-lang.github.io/zulip_archive/stream/122657-t-compiler/wg-nll/topic/.2353040.20.60FnMut.60.20return.20ref.20to.20upvar.html#135211423">(Oct 04 2018 at 19:40)</a>:</h4>
<p><span class="user-mention" data-user-id="116009">@nikomatsakis</span> are you happy with <code>returns a reference to a captured variable which escapes the closure body</code> and <code>returns a closure that contains a reference to a captured variable, therefore escaping the closure body</code> as the error messages for the non-closure and closure case respectively?</p>



<a name="135211438"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353040%20%60FnMut%60%20return%20ref%20to%20upvar/near/135211438" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://rust-lang.github.io/zulip_archive/stream/122657-t-compiler/wg-nll/topic/.2353040.20.60FnMut.60.20return.20ref.20to.20upvar.html#135211438">(Oct 04 2018 at 19:41)</a>:</h4>
<p>I don't love "therefore" :)</p>



<a name="135211455"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353040%20%60FnMut%60%20return%20ref%20to%20upvar/near/135211455" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://rust-lang.github.io/zulip_archive/stream/122657-t-compiler/wg-nll/topic/.2353040.20.60FnMut.60.20return.20ref.20to.20upvar.html#135211455">(Oct 04 2018 at 19:41)</a>:</h4>
<p>it doesn't seem like the correct conjunction..</p>



<a name="135211463"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353040%20%60FnMut%60%20return%20ref%20to%20upvar/near/135211463" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://rust-lang.github.io/zulip_archive/stream/122657-t-compiler/wg-nll/topic/.2353040.20.60FnMut.60.20return.20ref.20to.20upvar.html#135211463">(Oct 04 2018 at 19:41)</a>:</h4>
<p>.."thereby" maybe but that's a bit over the top</p>



<a name="135211533"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353040%20%60FnMut%60%20return%20ref%20to%20upvar/near/135211533" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> davidtwco <a href="https://rust-lang.github.io/zulip_archive/stream/122657-t-compiler/wg-nll/topic/.2353040.20.60FnMut.60.20return.20ref.20to.20upvar.html#135211533">(Oct 04 2018 at 19:42)</a>:</h4>
<p>"which then escapes the closure body"?</p>



<a name="135211541"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353040%20%60FnMut%60%20return%20ref%20to%20upvar/near/135211541" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://rust-lang.github.io/zulip_archive/stream/122657-t-compiler/wg-nll/topic/.2353040.20.60FnMut.60.20return.20ref.20to.20upvar.html#135211541">(Oct 04 2018 at 19:42)</a>:</h4>
<p>/me struggles</p>



<a name="135211545"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353040%20%60FnMut%60%20return%20ref%20to%20upvar/near/135211545" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://rust-lang.github.io/zulip_archive/stream/122657-t-compiler/wg-nll/topic/.2353040.20.60FnMut.60.20return.20ref.20to.20upvar.html#135211545">(Oct 04 2018 at 19:42)</a>:</h4>
<p>it's ambiguous then what is escaping</p>



<a name="135211546"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353040%20%60FnMut%60%20return%20ref%20to%20upvar/near/135211546" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://rust-lang.github.io/zulip_archive/stream/122657-t-compiler/wg-nll/topic/.2353040.20.60FnMut.60.20return.20ref.20to.20upvar.html#135211546">(Oct 04 2018 at 19:42)</a>:</h4>
<p>although in fact it doesn't matter</p>



<a name="135211550"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353040%20%60FnMut%60%20return%20ref%20to%20upvar/near/135211550" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://rust-lang.github.io/zulip_archive/stream/122657-t-compiler/wg-nll/topic/.2353040.20.60FnMut.60.20return.20ref.20to.20upvar.html#135211550">(Oct 04 2018 at 19:42)</a>:</h4>
<p>so maybe that's fine</p>



<a name="135211561"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353040%20%60FnMut%60%20return%20ref%20to%20upvar/near/135211561" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://rust-lang.github.io/zulip_archive/stream/122657-t-compiler/wg-nll/topic/.2353040.20.60FnMut.60.20return.20ref.20to.20upvar.html#135211561">(Oct 04 2018 at 19:43)</a>:</h4>
<p>let's go with that for now :)</p>



<a name="135211572"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353040%20%60FnMut%60%20return%20ref%20to%20upvar/near/135211572" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> davidtwco <a href="https://rust-lang.github.io/zulip_archive/stream/122657-t-compiler/wg-nll/topic/.2353040.20.60FnMut.60.20return.20ref.20to.20upvar.html#135211572">(Oct 04 2018 at 19:43)</a>:</h4>
<p><span class="emoji emoji-1f44d" title="thumbs up">:thumbs_up:</span></p>



<a name="135212215"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353040%20%60FnMut%60%20return%20ref%20to%20upvar/near/135212215" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> davidtwco <a href="https://rust-lang.github.io/zulip_archive/stream/122657-t-compiler/wg-nll/topic/.2353040.20.60FnMut.60.20return.20ref.20to.20upvar.html#135212215">(Oct 04 2018 at 19:54)</a>:</h4>
<p><span class="user-mention" data-user-id="116009">@nikomatsakis</span> Pushed that.</p>



<a name="135409705"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353040%20%60FnMut%60%20return%20ref%20to%20upvar/near/135409705" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> pnkfelix <a href="https://rust-lang.github.io/zulip_archive/stream/122657-t-compiler/wg-nll/topic/.2353040.20.60FnMut.60.20return.20ref.20to.20upvar.html#135409705">(Oct 08 2018 at 15:08)</a>:</h4>
<p>Hey <span class="user-mention" data-user-id="116107">@davidtwco</span> I just made a quick note on something you may have overlooked in <span class="user-mention" data-user-id="116009">@nikomatsakis</span> 's feeddback</p>



<a name="135409712"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353040%20%60FnMut%60%20return%20ref%20to%20upvar/near/135409712" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> pnkfelix <a href="https://rust-lang.github.io/zulip_archive/stream/122657-t-compiler/wg-nll/topic/.2353040.20.60FnMut.60.20return.20ref.20to.20upvar.html#135409712">(Oct 08 2018 at 15:08)</a>:</h4>
<p>personally I'd be fine with r+'ing PR <a href="https://github.com/rust-lang/rust/issues/54802" target="_blank" title="https://github.com/rust-lang/rust/issues/54802">#54802</a> as is</p>



<a name="135409721"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353040%20%60FnMut%60%20return%20ref%20to%20upvar/near/135409721" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> pnkfelix <a href="https://rust-lang.github.io/zulip_archive/stream/122657-t-compiler/wg-nll/topic/.2353040.20.60FnMut.60.20return.20ref.20to.20upvar.html#135409721">(Oct 08 2018 at 15:08)</a>:</h4>
<p>but if you think you'd be able to quickly incorporate the distinction between "inner closure" and "outer closure" when two closures are in play, then I'm happy to wait for that before r+'ing.</p>



<a name="135409732"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353040%20%60FnMut%60%20return%20ref%20to%20upvar/near/135409732" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> pnkfelix <a href="https://rust-lang.github.io/zulip_archive/stream/122657-t-compiler/wg-nll/topic/.2353040.20.60FnMut.60.20return.20ref.20to.20upvar.html#135409732">(Oct 08 2018 at 15:09)</a>:</h4>
<p>Otherwise, I can just r+ and we can refine it further after it lands...</p>



<a name="135409805"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353040%20%60FnMut%60%20return%20ref%20to%20upvar/near/135409805" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> pnkfelix <a href="https://rust-lang.github.io/zulip_archive/stream/122657-t-compiler/wg-nll/topic/.2353040.20.60FnMut.60.20return.20ref.20to.20upvar.html#135409805">(Oct 08 2018 at 15:10)</a>:</h4>
<p>(its also possible that the "inner closure" and "outer closure" distinction is actually unnecessary given the way that things are being phrased in the PR as is, which may be why i'm so inclined to r+ it as is...) <span class="emoji emoji-263a" title="smile">:smile:</span></p>



<a name="135410330"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353040%20%60FnMut%60%20return%20ref%20to%20upvar/near/135410330" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> davidtwco <a href="https://rust-lang.github.io/zulip_archive/stream/122657-t-compiler/wg-nll/topic/.2353040.20.60FnMut.60.20return.20ref.20to.20upvar.html#135410330">(Oct 08 2018 at 15:18)</a>:</h4>
<p>I think the current wording was intended to resolve the inner/outer closure comments.</p>



<a name="135410347"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353040%20%60FnMut%60%20return%20ref%20to%20upvar/near/135410347" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> davidtwco <a href="https://rust-lang.github.io/zulip_archive/stream/122657-t-compiler/wg-nll/topic/.2353040.20.60FnMut.60.20return.20ref.20to.20upvar.html#135410347">(Oct 08 2018 at 15:19)</a>:</h4>
<p>But I’m not sure if there was any feedback on that wording.</p>



<a name="135410785"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353040%20%60FnMut%60%20return%20ref%20to%20upvar/near/135410785" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> davidtwco <a href="https://rust-lang.github.io/zulip_archive/stream/122657-t-compiler/wg-nll/topic/.2353040.20.60FnMut.60.20return.20ref.20to.20upvar.html#135410785">(Oct 08 2018 at 15:26)</a>:</h4>
<p>If you think we could or should make an inner/outer distinction more clear in the wording then I’m happy to do so.</p>



<a name="135428547"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353040%20%60FnMut%60%20return%20ref%20to%20upvar/near/135428547" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> davidtwco <a href="https://rust-lang.github.io/zulip_archive/stream/122657-t-compiler/wg-nll/topic/.2353040.20.60FnMut.60.20return.20ref.20to.20upvar.html#135428547">(Oct 08 2018 at 21:18)</a>:</h4>
<p><span class="user-mention" data-user-id="116009">@nikomatsakis</span> <span class="user-mention" data-user-id="116083">@pnkfelix</span> if either of you could come up with wording that is preferred for this then I'll update the PR as soon as so we can get it landed <span class="emoji emoji-1f642" title="slight smile">:slight_smile:</span></p>



<a name="135428552"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353040%20%60FnMut%60%20return%20ref%20to%20upvar/near/135428552" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> pnkfelix <a href="https://rust-lang.github.io/zulip_archive/stream/122657-t-compiler/wg-nll/topic/.2353040.20.60FnMut.60.20return.20ref.20to.20upvar.html#135428552">(Oct 08 2018 at 21:18)</a>:</h4>
<p>no I think its fine</p>



<hr><p>Last updated: Aug 07 2021 at 22:04 UTC</p>
</html>