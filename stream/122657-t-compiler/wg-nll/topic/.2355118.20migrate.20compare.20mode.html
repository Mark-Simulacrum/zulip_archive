<html>
<head><meta charset="utf-8"><title>#55118 migrate compare mode · t-compiler/wg-nll · Zulip Chat Archive</title></head>
<h2>Stream: <a href="https://rust-lang.github.io/zulip_archive/stream/122657-t-compiler/wg-nll/index.html">t-compiler/wg-nll</a></h2>
<h3>Topic: <a href="https://rust-lang.github.io/zulip_archive/stream/122657-t-compiler/wg-nll/topic/.2355118.20migrate.20compare.20mode.html">#55118 migrate compare mode</a></h3>

<hr>

<base href="https://rust-lang.zulipchat.com">

<head><link href="https://rust-lang.github.io/zulip_archive/style.css" rel="stylesheet"></head>

<a name="135932686"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2355118%20migrate%20compare%20mode/near/135932686" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> davidtwco <a href="https://rust-lang.github.io/zulip_archive/stream/122657-t-compiler/wg-nll/topic/.2355118.20migrate.20compare.20mode.html#135932686">(Oct 16 2018 at 21:58)</a>:</h4>
<p><span class="user-mention" data-user-id="116083">@pnkfelix</span> do we want to replace the <code>nll</code> compare mode? Or do we want to add a new compare mode that is now the default - that way there's still a "pure nll" option available?</p>



<a name="135932703"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2355118%20migrate%20compare%20mode/near/135932703" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> pnkfelix <a href="https://rust-lang.github.io/zulip_archive/stream/122657-t-compiler/wg-nll/topic/.2355118.20migrate.20compare.20mode.html#135932703">(Oct 16 2018 at 21:59)</a>:</h4>
<p>I think we should just replace the current compare mode</p>



<a name="135932716"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2355118%20migrate%20compare%20mode/near/135932716" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> pnkfelix <a href="https://rust-lang.github.io/zulip_archive/stream/122657-t-compiler/wg-nll/topic/.2355118.20migrate.20compare.20mode.html#135932716">(Oct 16 2018 at 21:59)</a>:</h4>
<p>I don't want to take the time for something more invasive</p>



<a name="135932722"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2355118%20migrate%20compare%20mode/near/135932722" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> davidtwco <a href="https://rust-lang.github.io/zulip_archive/stream/122657-t-compiler/wg-nll/topic/.2355118.20migrate.20compare.20mode.html#135932722">(Oct 16 2018 at 21:59)</a>:</h4>
<p>The only downside I can see to keeping the nll option around is that it might mean those <code>.nll.stderr</code> files get out of date.</p>



<a name="135932729"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2355118%20migrate%20compare%20mode/near/135932729" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> davidtwco <a href="https://rust-lang.github.io/zulip_archive/stream/122657-t-compiler/wg-nll/topic/.2355118.20migrate.20compare.20mode.html#135932729">(Oct 16 2018 at 21:59)</a>:</h4>
<p>I have it working locally keeping the <code>nll</code> mode and adding a new default <code>migrate</code> mode.</p>



<a name="135932733"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2355118%20migrate%20compare%20mode/near/135932733" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> davidtwco <a href="https://rust-lang.github.io/zulip_archive/stream/122657-t-compiler/wg-nll/topic/.2355118.20migrate.20compare.20mode.html#135932733">(Oct 16 2018 at 21:59)</a>:</h4>
<p>Just wondering if that's how we want to do it.</p>



<a name="135932735"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2355118%20migrate%20compare%20mode/near/135932735" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> davidtwco <a href="https://rust-lang.github.io/zulip_archive/stream/122657-t-compiler/wg-nll/topic/.2355118.20migrate.20compare.20mode.html#135932735">(Oct 16 2018 at 21:59)</a>:</h4>
<p>Easy enough to change.</p>



<a name="135932754"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2355118%20migrate%20compare%20mode/near/135932754" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> pnkfelix <a href="https://rust-lang.github.io/zulip_archive/stream/122657-t-compiler/wg-nll/topic/.2355118.20migrate.20compare.20mode.html#135932754">(Oct 16 2018 at 22:00)</a>:</h4>
<p>No I wanted to keep the name the same</p>



<a name="135932788"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2355118%20migrate%20compare%20mode/near/135932788" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> davidtwco <a href="https://rust-lang.github.io/zulip_archive/stream/122657-t-compiler/wg-nll/topic/.2355118.20migrate.20compare.20mode.html#135932788">(Oct 16 2018 at 22:00)</a>:</h4>
<p>Alright, I'll change it to that.</p>



<a name="135932800"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2355118%20migrate%20compare%20mode/near/135932800" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> pnkfelix <a href="https://rust-lang.github.io/zulip_archive/stream/122657-t-compiler/wg-nll/topic/.2355118.20migrate.20compare.20mode.html#135932800">(Oct 16 2018 at 22:00)</a>:</h4>
<p>like, literally most of the <code>.nll.stderr</code> files will just get re-used as is, I <em>think</em></p>



<a name="135932804"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2355118%20migrate%20compare%20mode/near/135932804" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> pnkfelix <a href="https://rust-lang.github.io/zulip_archive/stream/122657-t-compiler/wg-nll/topic/.2355118.20migrate.20compare.20mode.html#135932804">(Oct 16 2018 at 22:00)</a>:</h4>
<p>the main exceptions are: 1. cases where the errors are downgraded to warnings</p>



<a name="135932830"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2355118%20migrate%20compare%20mode/near/135932830" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> pnkfelix <a href="https://rust-lang.github.io/zulip_archive/stream/122657-t-compiler/wg-nll/topic/.2355118.20migrate.20compare.20mode.html#135932830">(Oct 16 2018 at 22:01)</a>:</h4>
<p>and 2. cases where the old region code enabled via borrowck=migrate causes new errors to be emitted</p>



<a name="135932863"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2355118%20migrate%20compare%20mode/near/135932863" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> pnkfelix <a href="https://rust-lang.github.io/zulip_archive/stream/122657-t-compiler/wg-nll/topic/.2355118.20migrate.20compare.20mode.html#135932863">(Oct 16 2018 at 22:01)</a>:</h4>
<p>If you encounter a case where the change from error to warning seems really bad</p>



<a name="135932916"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2355118%20migrate%20compare%20mode/near/135932916" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> pnkfelix <a href="https://rust-lang.github.io/zulip_archive/stream/122657-t-compiler/wg-nll/topic/.2355118.20migrate.20compare.20mode.html#135932916">(Oct 16 2018 at 22:02)</a>:</h4>
<p>then I would change that test (or those tests, if there's &gt;1) to use the revision system</p>



<a name="135932952"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2355118%20migrate%20compare%20mode/near/135932952" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> davidtwco <a href="https://rust-lang.github.io/zulip_archive/stream/122657-t-compiler/wg-nll/topic/.2355118.20migrate.20compare.20mode.html#135932952">(Oct 16 2018 at 22:02)</a>:</h4>
<p>So far, the only problematic cases are where there is a <code>forbid</code> attribute making a warning an error - which is downgraded again because there isn't a <code>signal_error</code> call where a lint is emitted. So trying to work out if there is a way to check the lint level for <code>UNUSED_MUT</code> at the emit site so I can conditionally signal the error.</p>



<a name="135932995"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2355118%20migrate%20compare%20mode/near/135932995" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> pnkfelix <a href="https://rust-lang.github.io/zulip_archive/stream/122657-t-compiler/wg-nll/topic/.2355118.20migrate.20compare.20mode.html#135932995">(Oct 16 2018 at 22:03)</a>:</h4>
<blockquote>
<p>then I would change that test (or those tests, if there's &gt;1) to use the revision system</p>
</blockquote>
<p>this test is an example of what I mean by "the revision system": <a href="https://github.com/rust-lang/rust/blob/8a7048b72b7e9499dfae3f946baa92fc9e62a6b8/src/test/ui/borrowck/issue-45983.rs#L19" target="_blank" title="https://github.com/rust-lang/rust/blob/8a7048b72b7e9499dfae3f946baa92fc9e62a6b8/src/test/ui/borrowck/issue-45983.rs#L19">https://github.com/rust-lang/rust/blob/8a7048b72b7e9499dfae3f946baa92fc9e62a6b8/src/test/ui/borrowck/issue-45983.rs#L19</a></p>



<a name="135933055"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2355118%20migrate%20compare%20mode/near/135933055" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> pnkfelix <a href="https://rust-lang.github.io/zulip_archive/stream/122657-t-compiler/wg-nll/topic/.2355118.20migrate.20compare.20mode.html#135933055">(Oct 16 2018 at 22:04)</a>:</h4>
<p>Can you point me to a specific instance where the <code>forbid</code> thing you describe is arising?</p>



<a name="135933066"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2355118%20migrate%20compare%20mode/near/135933066" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> pnkfelix <a href="https://rust-lang.github.io/zulip_archive/stream/122657-t-compiler/wg-nll/topic/.2355118.20migrate.20compare.20mode.html#135933066">(Oct 16 2018 at 22:04)</a>:</h4>
<p>that may be an example of something <em>very wrong</em> in the way I implemented the migration strategy...</p>



<a name="135933089"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2355118%20migrate%20compare%20mode/near/135933089" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> davidtwco <a href="https://rust-lang.github.io/zulip_archive/stream/122657-t-compiler/wg-nll/topic/.2355118.20migrate.20compare.20mode.html#135933089">(Oct 16 2018 at 22:05)</a>:</h4>
<p><a href="https://github.com/rust-lang/rust/blob/master/src/test/ui/lint/lint-unused-mut-self.rs" target="_blank" title="https://github.com/rust-lang/rust/blob/master/src/test/ui/lint/lint-unused-mut-self.rs">This is an example</a>.</p>



<a name="135933098"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2355118%20migrate%20compare%20mode/near/135933098" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> davidtwco <a href="https://rust-lang.github.io/zulip_archive/stream/122657-t-compiler/wg-nll/topic/.2355118.20migrate.20compare.20mode.html#135933098">(Oct 16 2018 at 22:05)</a>:</h4>
<p>There are only three cases.</p>



<a name="135933130"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2355118%20migrate%20compare%20mode/near/135933130" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> pnkfelix <a href="https://rust-lang.github.io/zulip_archive/stream/122657-t-compiler/wg-nll/topic/.2355118.20migrate.20compare.20mode.html#135933130">(Oct 16 2018 at 22:05)</a>:</h4>
<p>give me a second, I want to see how this behaves</p>



<a name="135933200"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2355118%20migrate%20compare%20mode/near/135933200" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> pnkfelix <a href="https://rust-lang.github.io/zulip_archive/stream/122657-t-compiler/wg-nll/topic/.2355118.20migrate.20compare.20mode.html#135933200">(Oct 16 2018 at 22:06)</a>:</h4>
<p>This is bad</p>



<a name="135933205"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2355118%20migrate%20compare%20mode/near/135933205" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> pnkfelix <a href="https://rust-lang.github.io/zulip_archive/stream/122657-t-compiler/wg-nll/topic/.2355118.20migrate.20compare.20mode.html#135933205">(Oct 16 2018 at 22:06)</a>:</h4>
<p>This is like, an example of something we should fix</p>



<a name="135933218"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2355118%20migrate%20compare%20mode/near/135933218" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> pnkfelix <a href="https://rust-lang.github.io/zulip_archive/stream/122657-t-compiler/wg-nll/topic/.2355118.20migrate.20compare.20mode.html#135933218">(Oct 16 2018 at 22:06)</a>:</h4>
<p>since it represents a change of behavior between edition 2015 and edition 2018</p>



<a name="135933222"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2355118%20migrate%20compare%20mode/near/135933222" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> pnkfelix <a href="https://rust-lang.github.io/zulip_archive/stream/122657-t-compiler/wg-nll/topic/.2355118.20migrate.20compare.20mode.html#135933222">(Oct 16 2018 at 22:06)</a>:</h4>
<p><a href="https://play.rust-lang.org/?version=nightly&amp;mode=debug&amp;edition=2018&amp;gist=b2093a7f6781d8cd9e41e9aecedc7c24" target="_blank" title="https://play.rust-lang.org/?version=nightly&amp;mode=debug&amp;edition=2018&amp;gist=b2093a7f6781d8cd9e41e9aecedc7c24">playground</a></p>



<a name="135933228"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2355118%20migrate%20compare%20mode/near/135933228" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> davidtwco <a href="https://rust-lang.github.io/zulip_archive/stream/122657-t-compiler/wg-nll/topic/.2355118.20migrate.20compare.20mode.html#135933228">(Oct 16 2018 at 22:07)</a>:</h4>
<p>Yeah, I'm trying to spot a nice way to fix it.</p>



<a name="135933233"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2355118%20migrate%20compare%20mode/near/135933233" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> pnkfelix <a href="https://rust-lang.github.io/zulip_archive/stream/122657-t-compiler/wg-nll/topic/.2355118.20migrate.20compare.20mode.html#135933233">(Oct 16 2018 at 22:07)</a>:</h4>
<p>I think you should file a separate bug for this</p>



<a name="135933261"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2355118%20migrate%20compare%20mode/near/135933261" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> pnkfelix <a href="https://rust-lang.github.io/zulip_archive/stream/122657-t-compiler/wg-nll/topic/.2355118.20migrate.20compare.20mode.html#135933261">(Oct 16 2018 at 22:07)</a>:</h4>
<p>we don't <em>have</em> to resolve it as part of the PR that changes compare-mode=nll</p>



<a name="135933282"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2355118%20migrate%20compare%20mode/near/135933282" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> davidtwco <a href="https://rust-lang.github.io/zulip_archive/stream/122657-t-compiler/wg-nll/topic/.2355118.20migrate.20compare.20mode.html#135933282">(Oct 16 2018 at 22:08)</a>:</h4>
<p>I won't be able to land this without fixing it as Travis wouldn't pass, and the changes involved in this are relatively minor, I don't think it would be too big a deal to fix it in this.</p>



<a name="135933310"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2355118%20migrate%20compare%20mode/near/135933310" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> pnkfelix <a href="https://rust-lang.github.io/zulip_archive/stream/122657-t-compiler/wg-nll/topic/.2355118.20migrate.20compare.20mode.html#135933310">(Oct 16 2018 at 22:08)</a>:</h4>
<p>we can make this test use the revision system instead (and have it do <code>// ignore-compare-mode-nll</code></p>



<a name="135933331"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2355118%20migrate%20compare%20mode/near/135933331" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> pnkfelix <a href="https://rust-lang.github.io/zulip_archive/stream/122657-t-compiler/wg-nll/topic/.2355118.20migrate.20compare.20mode.html#135933331">(Oct 16 2018 at 22:08)</a>:</h4>
<p>and I still think there's mucho value in separating the two things here</p>



<a name="135933341"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2355118%20migrate%20compare%20mode/near/135933341" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> davidtwco <a href="https://rust-lang.github.io/zulip_archive/stream/122657-t-compiler/wg-nll/topic/.2355118.20migrate.20compare.20mode.html#135933341">(Oct 16 2018 at 22:08)</a>:</h4>
<p>Sure thing, I'll file an issue.</p>



<a name="135933362"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2355118%20migrate%20compare%20mode/near/135933362" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> pnkfelix <a href="https://rust-lang.github.io/zulip_archive/stream/122657-t-compiler/wg-nll/topic/.2355118.20migrate.20compare.20mode.html#135933362">(Oct 16 2018 at 22:09)</a>:</h4>
<p>if the change really is trivial, then okay. But make sure its a totally separate commit from the rest of the commits in the PR</p>



<a name="135933372"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2355118%20migrate%20compare%20mode/near/135933372" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> pnkfelix <a href="https://rust-lang.github.io/zulip_archive/stream/122657-t-compiler/wg-nll/topic/.2355118.20migrate.20compare.20mode.html#135933372">(Oct 16 2018 at 22:09)</a>:</h4>
<p>(and as you can tell, I would be fine with the fix to this being a separate PR entirely)</p>



<a name="135933453"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2355118%20migrate%20compare%20mode/near/135933453" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> pnkfelix <a href="https://rust-lang.github.io/zulip_archive/stream/122657-t-compiler/wg-nll/topic/.2355118.20migrate.20compare.20mode.html#135933453">(Oct 16 2018 at 22:10)</a>:</h4>
<p>Anyway, thanks for looking at this. Issues like this are <em>exactly</em> why I'm happy we are addressing this now, and not a week from now. <span class="emoji emoji-263a" title="smile">:smile:</span></p>



<a name="135933783"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2355118%20migrate%20compare%20mode/near/135933783" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> davidtwco <a href="https://rust-lang.github.io/zulip_archive/stream/122657-t-compiler/wg-nll/topic/.2355118.20migrate.20compare.20mode.html#135933783">(Oct 16 2018 at 22:16)</a>:</h4>
<p>Tons of diagnostics get way worser with this mode <span class="emoji emoji-1f641" title="frown">:frown:</span></p>



<a name="135933942"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2355118%20migrate%20compare%20mode/near/135933942" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> pnkfelix <a href="https://rust-lang.github.io/zulip_archive/stream/122657-t-compiler/wg-nll/topic/.2355118.20migrate.20compare.20mode.html#135933942">(Oct 16 2018 at 22:19)</a>:</h4>
<p>That's useful to know</p>



<a name="135933951"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2355118%20migrate%20compare%20mode/near/135933951" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> pnkfelix <a href="https://rust-lang.github.io/zulip_archive/stream/122657-t-compiler/wg-nll/topic/.2355118.20migrate.20compare.20mode.html#135933951">(Oct 16 2018 at 22:19)</a>:</h4>
<p>does it seem like its due to us running the old region code?</p>



<a name="135933984"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2355118%20migrate%20compare%20mode/near/135933984" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> pnkfelix <a href="https://rust-lang.github.io/zulip_archive/stream/122657-t-compiler/wg-nll/topic/.2355118.20migrate.20compare.20mode.html#135933984">(Oct 16 2018 at 22:20)</a>:</h4>
<p>i.e. did you peek at what the .stderr files look like for the AST-borrowck ?</p>



<a name="135934025"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2355118%20migrate%20compare%20mode/near/135934025" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> pnkfelix <a href="https://rust-lang.github.io/zulip_archive/stream/122657-t-compiler/wg-nll/topic/.2355118.20migrate.20compare.20mode.html#135934025">(Oct 16 2018 at 22:20)</a>:</h4>
<p>or are the regressions in diagnostic quality not immediately attributable to AST-borrowck stufF?</p>



<a name="135934049"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2355118%20migrate%20compare%20mode/near/135934049" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> pnkfelix <a href="https://rust-lang.github.io/zulip_archive/stream/122657-t-compiler/wg-nll/topic/.2355118.20migrate.20compare.20mode.html#135934049">(Oct 16 2018 at 22:20)</a>:</h4>
<p>(also, make sure that you kept <code>-Z two-phase-borrows</code> turned on in whatever you did</p>



<a name="135934056"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2355118%20migrate%20compare%20mode/near/135934056" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> davidtwco <a href="https://rust-lang.github.io/zulip_archive/stream/122657-t-compiler/wg-nll/topic/.2355118.20migrate.20compare.20mode.html#135934056">(Oct 16 2018 at 22:21)</a>:</h4>
<p>It's the old region code.</p>



<a name="135934061"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2355118%20migrate%20compare%20mode/near/135934061" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> davidtwco <a href="https://rust-lang.github.io/zulip_archive/stream/122657-t-compiler/wg-nll/topic/.2355118.20migrate.20compare.20mode.html#135934061">(Oct 16 2018 at 22:21)</a>:</h4>
<p>It still has <code>-Z two-phase-borrows</code>.</p>



<a name="135934073"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2355118%20migrate%20compare%20mode/near/135934073" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> pnkfelix <a href="https://rust-lang.github.io/zulip_archive/stream/122657-t-compiler/wg-nll/topic/.2355118.20migrate.20compare.20mode.html#135934073">(Oct 16 2018 at 22:21)</a>:</h4>
<p>okay. Well the region code is ... at least not a <em>regression</em> from AST-borrowck, right?</p>



<a name="135934134"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2355118%20migrate%20compare%20mode/near/135934134" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> pnkfelix <a href="https://rust-lang.github.io/zulip_archive/stream/122657-t-compiler/wg-nll/topic/.2355118.20migrate.20compare.20mode.html#135934134">(Oct 16 2018 at 22:22)</a>:</h4>
<p>If there's some case where the combination of the old region code with the new MIR-borrowck diagnostics ends up looking <em>worse</em> than either of AST-borrowck or MIR-borrowck alone, then we definitely want to know that ...</p>



<a name="135934146"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2355118%20migrate%20compare%20mode/near/135934146" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> davidtwco <a href="https://rust-lang.github.io/zulip_archive/stream/122657-t-compiler/wg-nll/topic/.2355118.20migrate.20compare.20mode.html#135934146">(Oct 16 2018 at 22:22)</a>:</h4>
<p>No, it's the same as it was with the AST borrow checker. It's just a shame to see the nice NLL errors being removed in the diffs.</p>



<a name="135934151"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2355118%20migrate%20compare%20mode/near/135934151" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> pnkfelix <a href="https://rust-lang.github.io/zulip_archive/stream/122657-t-compiler/wg-nll/topic/.2355118.20migrate.20compare.20mode.html#135934151">(Oct 16 2018 at 22:22)</a>:</h4>
<p>(unfortunately I cannot think of a good way to automatically flag such cases)</p>



<a name="135934172"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2355118%20migrate%20compare%20mode/near/135934172" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> davidtwco <a href="https://rust-lang.github.io/zulip_archive/stream/122657-t-compiler/wg-nll/topic/.2355118.20migrate.20compare.20mode.html#135934172">(Oct 16 2018 at 22:23)</a>:</h4>
<p>This also complicates the diagnostic review since you won't be seeing our actual NLL output.</p>



<a name="135934221"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2355118%20migrate%20compare%20mode/near/135934221" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> pnkfelix <a href="https://rust-lang.github.io/zulip_archive/stream/122657-t-compiler/wg-nll/topic/.2355118.20migrate.20compare.20mode.html#135934221">(Oct 16 2018 at 22:24)</a>:</h4>
<p>well that may be an argument for adopting separate compare-modes eventually. Though I personally suspect the better way to go is to either 1. use <code>#![feature(nll)]</code> on individual tests, or 2. use the revision system to opt into it.</p>



<a name="135934270"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2355118%20migrate%20compare%20mode/near/135934270" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> pnkfelix <a href="https://rust-lang.github.io/zulip_archive/stream/122657-t-compiler/wg-nll/topic/.2355118.20migrate.20compare.20mode.html#135934270">(Oct 16 2018 at 22:24)</a>:</h4>
<p>(By "better", I here mean "less likely to cause non-NLL developers to gnash their teeth at how long tests are taking")</p>



<a name="135934300"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2355118%20migrate%20compare%20mode/near/135934300" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> pnkfelix <a href="https://rust-lang.github.io/zulip_archive/stream/122657-t-compiler/wg-nll/topic/.2355118.20migrate.20compare.20mode.html#135934300">(Oct 16 2018 at 22:25)</a>:</h4>
<p>Do you have an estimate of how many tests seriously regress due to this?</p>



<a name="135934303"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2355118%20migrate%20compare%20mode/near/135934303" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> davidtwco <a href="https://rust-lang.github.io/zulip_archive/stream/122657-t-compiler/wg-nll/topic/.2355118.20migrate.20compare.20mode.html#135934303">(Oct 16 2018 at 22:25)</a>:</h4>
<p>Yeah, there's not a nice solution without making more tests run, which isn't nice.</p>



<a name="135934310"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2355118%20migrate%20compare%20mode/near/135934310" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> pnkfelix <a href="https://rust-lang.github.io/zulip_archive/stream/122657-t-compiler/wg-nll/topic/.2355118.20migrate.20compare.20mode.html#135934310">(Oct 16 2018 at 22:25)</a>:</h4>
<p>Because another option we could consider would be to stop running the old region code</p>



<a name="135934319"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2355118%20migrate%20compare%20mode/near/135934319" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> davidtwco <a href="https://rust-lang.github.io/zulip_archive/stream/122657-t-compiler/wg-nll/topic/.2355118.20migrate.20compare.20mode.html#135934319">(Oct 16 2018 at 22:25)</a>:</h4>
<p>I get 207 failures - three of which are the lint issue.</p>



<a name="135934325"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2355118%20migrate%20compare%20mode/near/135934325" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> pnkfelix <a href="https://rust-lang.github.io/zulip_archive/stream/122657-t-compiler/wg-nll/topic/.2355118.20migrate.20compare.20mode.html#135934325">(Oct 16 2018 at 22:25)</a>:</h4>
<p>I wouldn't want to do that for RC2, its too close. but we could maybe do it for Release.</p>



<a name="135934339"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2355118%20migrate%20compare%20mode/near/135934339" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> davidtwco <a href="https://rust-lang.github.io/zulip_archive/stream/122657-t-compiler/wg-nll/topic/.2355118.20migrate.20compare.20mode.html#135934339">(Oct 16 2018 at 22:26)</a>:</h4>
<p>In fact, there are some cases where there are new errors.</p>



<a name="135934381"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2355118%20migrate%20compare%20mode/near/135934381" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> pnkfelix <a href="https://rust-lang.github.io/zulip_archive/stream/122657-t-compiler/wg-nll/topic/.2355118.20migrate.20compare.20mode.html#135934381">(Oct 16 2018 at 22:26)</a>:</h4>
<p>oh really, only 207 <code>[ui (nll)]</code> tests didn't match after your change?</p>



<a name="135934383"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2355118%20migrate%20compare%20mode/near/135934383" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> davidtwco <a href="https://rust-lang.github.io/zulip_archive/stream/122657-t-compiler/wg-nll/topic/.2355118.20migrate.20compare.20mode.html#135934383">(Oct 16 2018 at 22:26)</a>:</h4>
<p>Yeah.</p>



<a name="135934390"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2355118%20migrate%20compare%20mode/near/135934390" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> pnkfelix <a href="https://rust-lang.github.io/zulip_archive/stream/122657-t-compiler/wg-nll/topic/.2355118.20migrate.20compare.20mode.html#135934390">(Oct 16 2018 at 22:26)</a>:</h4>
<p>That's promising. I had worried it would be more.</p>



<a name="135934393"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2355118%20migrate%20compare%20mode/near/135934393" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> davidtwco <a href="https://rust-lang.github.io/zulip_archive/stream/122657-t-compiler/wg-nll/topic/.2355118.20migrate.20compare.20mode.html#135934393">(Oct 16 2018 at 22:26)</a>:</h4>
<p><a href="https://github.com/rust-lang/rust/blob/master/src/test/ui/lint/lint-unused-mut-self.rs" target="_blank" title="https://github.com/rust-lang/rust/blob/master/src/test/ui/lint/lint-unused-mut-self.rs">https://github.com/rust-lang/rust/blob/master/src/test/ui/lint/lint-unused-mut-self.rs</a> - this test went from three errors to four.</p>



<a name="135934403"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2355118%20migrate%20compare%20mode/near/135934403" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> pnkfelix <a href="https://rust-lang.github.io/zulip_archive/stream/122657-t-compiler/wg-nll/topic/.2355118.20migrate.20compare.20mode.html#135934403">(Oct 16 2018 at 22:27)</a>:</h4>
<p>I think I have an issue about this somewhere</p>



<a name="135934436"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2355118%20migrate%20compare%20mode/near/135934436" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> pnkfelix <a href="https://rust-lang.github.io/zulip_archive/stream/122657-t-compiler/wg-nll/topic/.2355118.20migrate.20compare.20mode.html#135934436">(Oct 16 2018 at 22:27)</a>:</h4>
<p>"NLL migration mode sometimes prints more diagnostics than either AST-borrowck or NLL" <a href="https://github.com/rust-lang/rust/issues/53004" target="_blank" title="https://github.com/rust-lang/rust/issues/53004">#53004</a></p>



<a name="135934441"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2355118%20migrate%20compare%20mode/near/135934441" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> pnkfelix <a href="https://rust-lang.github.io/zulip_archive/stream/122657-t-compiler/wg-nll/topic/.2355118.20migrate.20compare.20mode.html#135934441">(Oct 16 2018 at 22:27)</a>:</h4>
<p>may or may not be related</p>



<a name="135934509"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2355118%20migrate%20compare%20mode/near/135934509" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> davidtwco <a href="https://rust-lang.github.io/zulip_archive/stream/122657-t-compiler/wg-nll/topic/.2355118.20migrate.20compare.20mode.html#135934509">(Oct 16 2018 at 22:28)</a>:</h4>
<p>AST output: <a href="https://gist.github.com/davidtwco/30d5f557c940dc0bfb3546262ca02682" target="_blank" title="https://gist.github.com/davidtwco/30d5f557c940dc0bfb3546262ca02682">https://gist.github.com/davidtwco/30d5f557c940dc0bfb3546262ca02682</a><br>
NLL output: <a href="https://gist.github.com/davidtwco/441bf1fba1372fe022cceb22fa2959d0" target="_blank" title="https://gist.github.com/davidtwco/441bf1fba1372fe022cceb22fa2959d0">https://gist.github.com/davidtwco/441bf1fba1372fe022cceb22fa2959d0</a></p>



<a name="135936284"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2355118%20migrate%20compare%20mode/near/135936284" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> davidtwco <a href="https://rust-lang.github.io/zulip_archive/stream/122657-t-compiler/wg-nll/topic/.2355118.20migrate.20compare.20mode.html#135936284">(Oct 16 2018 at 23:04)</a>:</h4>
<p><span class="user-mention" data-user-id="116083">@pnkfelix</span> Submitted <a href="https://github.com/rust-lang/rust/issues/55134" target="_blank" title="https://github.com/rust-lang/rust/issues/55134">#55134</a>. I fixed the lint issue that we ran into and looked briefly through the test changes and didn't spot any that seemed wrong.</p>



<a name="135936318"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2355118%20migrate%20compare%20mode/near/135936318" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> pnkfelix <a href="https://rust-lang.github.io/zulip_archive/stream/122657-t-compiler/wg-nll/topic/.2355118.20migrate.20compare.20mode.html#135936318">(Oct 16 2018 at 23:05)</a>:</h4>
<p>great!</p>



<a name="135936372"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2355118%20migrate%20compare%20mode/near/135936372" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> pnkfelix <a href="https://rust-lang.github.io/zulip_archive/stream/122657-t-compiler/wg-nll/topic/.2355118.20migrate.20compare.20mode.html#135936372">(Oct 16 2018 at 23:06)</a>:</h4>
<p>hmm, so if we don't buffer lints... do they end up getting emitted <em>before</em> errors in the output now?</p>



<a name="135936399"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2355118%20migrate%20compare%20mode/near/135936399" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> davidtwco <a href="https://rust-lang.github.io/zulip_archive/stream/122657-t-compiler/wg-nll/topic/.2355118.20migrate.20compare.20mode.html#135936399">(Oct 16 2018 at 23:07)</a>:</h4>
<p>We never buffered any of the other lints from NLL. Only that particular one.</p>



<a name="135936400"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2355118%20migrate%20compare%20mode/near/135936400" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> pnkfelix <a href="https://rust-lang.github.io/zulip_archive/stream/122657-t-compiler/wg-nll/topic/.2355118.20migrate.20compare.20mode.html#135936400">(Oct 16 2018 at 23:07)</a>:</h4>
<p>fair enough</p>



<a name="135936402"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2355118%20migrate%20compare%20mode/near/135936402" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> davidtwco <a href="https://rust-lang.github.io/zulip_archive/stream/122657-t-compiler/wg-nll/topic/.2355118.20migrate.20compare.20mode.html#135936402">(Oct 16 2018 at 23:07)</a>:</h4>
<p>(there are only three total, so it's not a huge amount anyway)</p>



<a name="135936454"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2355118%20migrate%20compare%20mode/near/135936454" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> davidtwco <a href="https://rust-lang.github.io/zulip_archive/stream/122657-t-compiler/wg-nll/topic/.2355118.20migrate.20compare.20mode.html#135936454">(Oct 16 2018 at 23:08)</a>:</h4>
<p>Changing that didn't make any test output change though so presumably they always came up before.</p>



<a name="135936468"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2355118%20migrate%20compare%20mode/near/135936468" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> pnkfelix <a href="https://rust-lang.github.io/zulip_archive/stream/122657-t-compiler/wg-nll/topic/.2355118.20migrate.20compare.20mode.html#135936468">(Oct 16 2018 at 23:09)</a>:</h4>
<p>well, one might be able to construct a test that exposes the difference. But its not worth worrying about...</p>



<a name="135936521"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2355118%20migrate%20compare%20mode/near/135936521" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> davidtwco <a href="https://rust-lang.github.io/zulip_archive/stream/122657-t-compiler/wg-nll/topic/.2355118.20migrate.20compare.20mode.html#135936521">(Oct 16 2018 at 23:10)</a>:</h4>
<p>Yeah, probably.</p>



<a name="135936544"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2355118%20migrate%20compare%20mode/near/135936544" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> davidtwco <a href="https://rust-lang.github.io/zulip_archive/stream/122657-t-compiler/wg-nll/topic/.2355118.20migrate.20compare.20mode.html#135936544">(Oct 16 2018 at 23:11)</a>:</h4>
<p>If you'd prefer I do a more involved fix so that AST borrow check is aware when lints it emits become errors then I'd be happy to do so as part of this PR or as a follow-up.</p>



<a name="135936549"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2355118%20migrate%20compare%20mode/near/135936549" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> pnkfelix <a href="https://rust-lang.github.io/zulip_archive/stream/122657-t-compiler/wg-nll/topic/.2355118.20migrate.20compare.20mode.html#135936549">(Oct 16 2018 at 23:11)</a>:</h4>
<p>No its okay</p>



<a name="135936551"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2355118%20migrate%20compare%20mode/near/135936551" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> davidtwco <a href="https://rust-lang.github.io/zulip_archive/stream/122657-t-compiler/wg-nll/topic/.2355118.20migrate.20compare.20mode.html#135936551">(Oct 16 2018 at 23:11)</a>:</h4>
<p>Then lints in MIR could be buffered too.</p>



<a name="135936553"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2355118%20migrate%20compare%20mode/near/135936553" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> pnkfelix <a href="https://rust-lang.github.io/zulip_archive/stream/122657-t-compiler/wg-nll/topic/.2355118.20migrate.20compare.20mode.html#135936553">(Oct 16 2018 at 23:11)</a>:</h4>
<p>I'm currently more wondering how to prioritize this</p>



<a name="135936613"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2355118%20migrate%20compare%20mode/near/135936613" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> pnkfelix <a href="https://rust-lang.github.io/zulip_archive/stream/122657-t-compiler/wg-nll/topic/.2355118.20migrate.20compare.20mode.html#135936613">(Oct 16 2018 at 23:12)</a>:</h4>
<p>since its going to collide with anything that touches most of these files</p>



<a name="135936621"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2355118%20migrate%20compare%20mode/near/135936621" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> davidtwco <a href="https://rust-lang.github.io/zulip_archive/stream/122657-t-compiler/wg-nll/topic/.2355118.20migrate.20compare.20mode.html#135936621">(Oct 16 2018 at 23:12)</a>:</h4>
<p>(I'd like it if you did the diagnostic review before landing this so that we get a more accurate idea of where NLL's diagostics are at, I don't mind rebasing for days on end)</p>



<a name="135936627"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2355118%20migrate%20compare%20mode/near/135936627" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> pnkfelix <a href="https://rust-lang.github.io/zulip_archive/stream/122657-t-compiler/wg-nll/topic/.2355118.20migrate.20compare.20mode.html#135936627">(Oct 16 2018 at 23:12)</a>:</h4>
<p>but no</p>



<a name="135936630"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2355118%20migrate%20compare%20mode/near/135936630" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> pnkfelix <a href="https://rust-lang.github.io/zulip_archive/stream/122657-t-compiler/wg-nll/topic/.2355118.20migrate.20compare.20mode.html#135936630">(Oct 16 2018 at 23:12)</a>:</h4>
<p>that's part of my point</p>



<a name="135936635"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2355118%20migrate%20compare%20mode/near/135936635" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> pnkfelix <a href="https://rust-lang.github.io/zulip_archive/stream/122657-t-compiler/wg-nll/topic/.2355118.20migrate.20compare.20mode.html#135936635">(Oct 16 2018 at 23:13)</a>:</h4>
<p>the diagnostic review should come <em>after</em> this change</p>



<a name="135936639"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2355118%20migrate%20compare%20mode/near/135936639" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> davidtwco <a href="https://rust-lang.github.io/zulip_archive/stream/122657-t-compiler/wg-nll/topic/.2355118.20migrate.20compare.20mode.html#135936639">(Oct 16 2018 at 23:13)</a>:</h4>
<p>(that said, after having rebased this for days on end, I'd probably disagree with current me)</p>



<a name="135936645"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2355118%20migrate%20compare%20mode/near/135936645" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> pnkfelix <a href="https://rust-lang.github.io/zulip_archive/stream/122657-t-compiler/wg-nll/topic/.2355118.20migrate.20compare.20mode.html#135936645">(Oct 16 2018 at 23:13)</a>:</h4>
<p>I mean, why review the diagnostics for the thing we aren't deploying (deploying first, that is)?</p>



<a name="135936652"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2355118%20migrate%20compare%20mode/near/135936652" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> pnkfelix <a href="https://rust-lang.github.io/zulip_archive/stream/122657-t-compiler/wg-nll/topic/.2355118.20migrate.20compare.20mode.html#135936652">(Oct 16 2018 at 23:13)</a>:</h4>
<p>(right?)</p>



<a name="135936706"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2355118%20migrate%20compare%20mode/near/135936706" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> davidtwco <a href="https://rust-lang.github.io/zulip_archive/stream/122657-t-compiler/wg-nll/topic/.2355118.20migrate.20compare.20mode.html#135936706">(Oct 16 2018 at 23:14)</a>:</h4>
<p>I don't think we're going to invest time in improving any of the errors specific to migrate mode though, are we? It's either good NLL errors that can be improved or AST errors that mask the NLL ones that are in some cases better or needing improvement. I mean, it might be worth making some changes so less NLL errors are masked but other than that..?</p>



<a name="135936723"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2355118%20migrate%20compare%20mode/near/135936723" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> pnkfelix <a href="https://rust-lang.github.io/zulip_archive/stream/122657-t-compiler/wg-nll/topic/.2355118.20migrate.20compare.20mode.html#135936723">(Oct 16 2018 at 23:15)</a>:</h4>
<p>My short term goal for the diagnostic review is to identify things that should block RC2</p>



<a name="135936727"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2355118%20migrate%20compare%20mode/near/135936727" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> davidtwco <a href="https://rust-lang.github.io/zulip_archive/stream/122657-t-compiler/wg-nll/topic/.2355118.20migrate.20compare.20mode.html#135936727">(Oct 16 2018 at 23:15)</a>:</h4>
<p>Just my 2c though, I might be way off.</p>



<a name="135936777"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2355118%20migrate%20compare%20mode/near/135936777" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> pnkfelix <a href="https://rust-lang.github.io/zulip_archive/stream/122657-t-compiler/wg-nll/topic/.2355118.20migrate.20compare.20mode.html#135936777">(Oct 16 2018 at 23:16)</a>:</h4>
<p>which, to me, means checking the migrate mode</p>



<a name="135936784"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2355118%20migrate%20compare%20mode/near/135936784" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> pnkfelix <a href="https://rust-lang.github.io/zulip_archive/stream/122657-t-compiler/wg-nll/topic/.2355118.20migrate.20compare.20mode.html#135936784">(Oct 16 2018 at 23:16)</a>:</h4>
<p>but I can understand what you are saying</p>



<a name="135936799"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2355118%20migrate%20compare%20mode/near/135936799" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> pnkfelix <a href="https://rust-lang.github.io/zulip_archive/stream/122657-t-compiler/wg-nll/topic/.2355118.20migrate.20compare.20mode.html#135936799">(Oct 16 2018 at 23:17)</a>:</h4>
<p>... maybe we should try to enlist other voices in this conversation. If nothing else, I'm too tired to really come to a solid conclusion on that matter.</p>



<a name="135936814"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2355118%20migrate%20compare%20mode/near/135936814" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> pnkfelix <a href="https://rust-lang.github.io/zulip_archive/stream/122657-t-compiler/wg-nll/topic/.2355118.20migrate.20compare.20mode.html#135936814">(Oct 16 2018 at 23:17)</a>:</h4>
<p><span class="user-group-mention" data-user-group-id="491">@WG-compiler-nll</span> ^</p>



<a name="135936822"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2355118%20migrate%20compare%20mode/near/135936822" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> davidtwco <a href="https://rust-lang.github.io/zulip_archive/stream/122657-t-compiler/wg-nll/topic/.2355118.20migrate.20compare.20mode.html#135936822">(Oct 16 2018 at 23:17)</a>:</h4>
<p>That makes sense, but that'll either be a review to a NLL error or an AST error? Since migrate mode is one of those two (or a combination of both?). If you identify an improvement to a NLL error, we can improve that. If you identify a improvement to a AST error, we aren't going to improve that - it might mask a NLL error that time was already spent improving?</p>



<a name="135936830"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2355118%20migrate%20compare%20mode/near/135936830" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> davidtwco <a href="https://rust-lang.github.io/zulip_archive/stream/122657-t-compiler/wg-nll/topic/.2355118.20migrate.20compare.20mode.html#135936830">(Oct 16 2018 at 23:18)</a>:</h4>
<p>I'm not sure.</p>



<a name="135936864"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2355118%20migrate%20compare%20mode/near/135936864" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> pnkfelix <a href="https://rust-lang.github.io/zulip_archive/stream/122657-t-compiler/wg-nll/topic/.2355118.20migrate.20compare.20mode.html#135936864">(Oct 16 2018 at 23:18)</a>:</h4>
<p>can you do me a favor and make a separate PR for commit <a href="https://github.com/rust-lang/rust/commit/d8db5299fae13a5ef321fd8f7be7364d735fecbb" target="_blank" title="https://github.com/rust-lang/rust/commit/d8db5299fae13a5ef321fd8f7be7364d735fecbb">d8db5299fae13a5ef321fd8f7be7364d735fecbb</a> ?</p>



<a name="135936868"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2355118%20migrate%20compare%20mode/near/135936868" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> pnkfelix <a href="https://rust-lang.github.io/zulip_archive/stream/122657-t-compiler/wg-nll/topic/.2355118.20migrate.20compare.20mode.html#135936868">(Oct 16 2018 at 23:18)</a>:</h4>
<p>I think we should make sure that lands</p>



<a name="135936870"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2355118%20migrate%20compare%20mode/near/135936870" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> pnkfelix <a href="https://rust-lang.github.io/zulip_archive/stream/122657-t-compiler/wg-nll/topic/.2355118.20migrate.20compare.20mode.html#135936870">(Oct 16 2018 at 23:18)</a>:</h4>
<p>and I'm worried that the rest of this is going to be in rebase hell</p>



<a name="135936873"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2355118%20migrate%20compare%20mode/near/135936873" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> davidtwco <a href="https://rust-lang.github.io/zulip_archive/stream/122657-t-compiler/wg-nll/topic/.2355118.20migrate.20compare.20mode.html#135936873">(Oct 16 2018 at 23:18)</a>:</h4>
<p>Sure thing.</p>



<a name="135936980"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2355118%20migrate%20compare%20mode/near/135936980" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> davidtwco <a href="https://rust-lang.github.io/zulip_archive/stream/122657-t-compiler/wg-nll/topic/.2355118.20migrate.20compare.20mode.html#135936980">(Oct 16 2018 at 23:20)</a>:</h4>
<p><span class="user-mention" data-user-id="116083">@pnkfelix</span> <a href="https://github.com/rust-lang/rust/issues/55135" target="_blank" title="https://github.com/rust-lang/rust/issues/55135">#55135</a></p>



<a name="135937007"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2355118%20migrate%20compare%20mode/near/135937007" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> pnkfelix <a href="https://rust-lang.github.io/zulip_archive/stream/122657-t-compiler/wg-nll/topic/.2355118.20migrate.20compare.20mode.html#135937007">(Oct 16 2018 at 23:21)</a>:</h4>
<blockquote>
<p>That makes sense, but that'll either be a review to a NLL error or an AST error? Since migrate mode is one of those two (or a combination of both?). I</p>
</blockquote>
<p>I guess I'm worried about situations like issue <a href="https://github.com/rust-lang/rust/issues/53004" target="_blank" title="https://github.com/rust-lang/rust/issues/53004">#53004</a> ("NLL migration mode sometimes prints more diagnostics than either AST-borrowck or NLL"). I.e., cases where migrate mode is behaving in non-intuitive ways</p>



<a name="135937059"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2355118%20migrate%20compare%20mode/near/135937059" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> pnkfelix <a href="https://rust-lang.github.io/zulip_archive/stream/122657-t-compiler/wg-nll/topic/.2355118.20migrate.20compare.20mode.html#135937059">(Oct 16 2018 at 23:22)</a>:</h4>
<p>i don't want to do <em>another</em> round of review for migrate mode alone after doing a round on NLL alone</p>



<a name="135937095"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2355118%20migrate%20compare%20mode/near/135937095" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> davidtwco <a href="https://rust-lang.github.io/zulip_archive/stream/122657-t-compiler/wg-nll/topic/.2355118.20migrate.20compare.20mode.html#135937095">(Oct 16 2018 at 23:22)</a>:</h4>
<p>I guess in my mind I hadn't really considered that part of a diagnostic review as it wouldn't really result in any improvements to diagnostics, just improvements to migrate mode?</p>



<a name="135937096"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2355118%20migrate%20compare%20mode/near/135937096" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> pnkfelix <a href="https://rust-lang.github.io/zulip_archive/stream/122657-t-compiler/wg-nll/topic/.2355118.20migrate.20compare.20mode.html#135937096">(Oct 16 2018 at 23:22)</a>:</h4>
<p>Let me sleep on this. And, more importantly, re-read what you wrote above again in the morning</p>



<a name="135937150"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2355118%20migrate%20compare%20mode/near/135937150" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> davidtwco <a href="https://rust-lang.github.io/zulip_archive/stream/122657-t-compiler/wg-nll/topic/.2355118.20migrate.20compare.20mode.html#135937150">(Oct 16 2018 at 23:23)</a>:</h4>
<p>(which are improvements to diagnostics of course, but the errors themselves aren't really changing)</p>



<a name="135937157"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2355118%20migrate%20compare%20mode/near/135937157" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> pnkfelix <a href="https://rust-lang.github.io/zulip_archive/stream/122657-t-compiler/wg-nll/topic/.2355118.20migrate.20compare.20mode.html#135937157">(Oct 16 2018 at 23:23)</a>:</h4>
<p>(I'm still trying to get my head around where doing the review of migrate mode goes <em>wrong</em> ... is it just in the effort involved in trying to tease out whether a given diagnostic is arising from MIR-borrowck vs AST-borrowck? Ah ... good old <code>-Z borrowck=compare</code> ...)</p>



<a name="135937269"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2355118%20migrate%20compare%20mode/near/135937269" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> davidtwco <a href="https://rust-lang.github.io/zulip_archive/stream/122657-t-compiler/wg-nll/topic/.2355118.20migrate.20compare.20mode.html#135937269">(Oct 16 2018 at 23:26)</a>:</h4>
<p>IMO the nicest solution (although, as you've correctly mentioned, infeasible because it'd mean there'd be more tests getting run and output needing kept up to date) would be to have a pure NLL mode and a migrate mode. A migrate review would only need to look at <code>*.migrate.stderr</code> files and would only consider whether migrate is doing something strange. And then a <code>*.nll.stderr</code> review would just be able to look at diagnostic quality.</p>



<a name="135937285"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2355118%20migrate%20compare%20mode/near/135937285" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> davidtwco <a href="https://rust-lang.github.io/zulip_archive/stream/122657-t-compiler/wg-nll/topic/.2355118.20migrate.20compare.20mode.html#135937285">(Oct 16 2018 at 23:27)</a>:</h4>
<p>Though, I'm also going to make the caveat that I might read that tomorrow morning and think it's an awful idea because it's late.</p>



<a name="135972091"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2355118%20migrate%20compare%20mode/near/135972091" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://rust-lang.github.io/zulip_archive/stream/122657-t-compiler/wg-nll/topic/.2355118.20migrate.20compare.20mode.html#135972091">(Oct 17 2018 at 13:20)</a>:</h4>
<p>I don't think I quite follow what is being debated here. I guess option 1 is:</p>
<ul>
<li>land the change to migrate mode and do a comparison of migrate/ast output</li>
<li>do a comparison of nll/ast output and then land change to migrate mode?</li>
</ul>
<p>I see pros/cons to both, but it seems to me that, schedule wise, it is most urgent to ensure migration "seems good", and we can revisit NLL "at our leisure".</p>
<p>To that end, there is a third-way <strong>add the NLL compare mode</strong> but do not run it on the builders. You can then run it <strong>manually</strong> to generate the comparison files for the purposes of comparison.</p>



<a name="135972152"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2355118%20migrate%20compare%20mode/near/135972152" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> pnkfelix <a href="https://rust-lang.github.io/zulip_archive/stream/122657-t-compiler/wg-nll/topic/.2355118.20migrate.20compare.20mode.html#135972152">(Oct 17 2018 at 13:21)</a>:</h4>
<p>Okay then I'm going to see about r+'ing the PR. It probably needs to be rebased already.</p>



<a name="135972201"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2355118%20migrate%20compare%20mode/near/135972201" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> davidtwco <a href="https://rust-lang.github.io/zulip_archive/stream/122657-t-compiler/wg-nll/topic/.2355118.20migrate.20compare.20mode.html#135972201">(Oct 17 2018 at 13:22)</a>:</h4>
<p>I don't think it does.</p>



<a name="135972207"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2355118%20migrate%20compare%20mode/near/135972207" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> davidtwco <a href="https://rust-lang.github.io/zulip_archive/stream/122657-t-compiler/wg-nll/topic/.2355118.20migrate.20compare.20mode.html#135972207">(Oct 17 2018 at 13:22)</a>:</h4>
<p>At least, I've not got the usual ping that tells me it does.</p>



<a name="135972212"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2355118%20migrate%20compare%20mode/near/135972212" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> davidtwco <a href="https://rust-lang.github.io/zulip_archive/stream/122657-t-compiler/wg-nll/topic/.2355118.20migrate.20compare.20mode.html#135972212">(Oct 17 2018 at 13:22)</a>:</h4>
<p>Unless that only happens when r+'d.</p>



<a name="135972443"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2355118%20migrate%20compare%20mode/near/135972443" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> davidtwco <a href="https://rust-lang.github.io/zulip_archive/stream/122657-t-compiler/wg-nll/topic/.2355118.20migrate.20compare.20mode.html#135972443">(Oct 17 2018 at 13:26)</a>:</h4>
<p>I could pretty quickly add a third compare mode just now if we want - I had that implemented yesterday so I know I'd go about it.</p>



<a name="135972470"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2355118%20migrate%20compare%20mode/near/135972470" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> davidtwco <a href="https://rust-lang.github.io/zulip_archive/stream/122657-t-compiler/wg-nll/topic/.2355118.20migrate.20compare.20mode.html#135972470">(Oct 17 2018 at 13:27)</a>:</h4>
<p>Only downside of it is that the tests wouldn't assert that all the third-mode.stderr files are up to date.</p>



<a name="135972487"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2355118%20migrate%20compare%20mode/near/135972487" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> davidtwco <a href="https://rust-lang.github.io/zulip_archive/stream/122657-t-compiler/wg-nll/topic/.2355118.20migrate.20compare.20mode.html#135972487">(Oct 17 2018 at 13:27)</a>:</h4>
<p>So if you ran them on master after waiting a while then it might fail.</p>



<a name="135972729"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2355118%20migrate%20compare%20mode/near/135972729" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://rust-lang.github.io/zulip_archive/stream/122657-t-compiler/wg-nll/topic/.2355118.20migrate.20compare.20mode.html#135972729">(Oct 17 2018 at 13:30)</a>:</h4>
<p>my assumption was that you would not check-in the 3rd mode files</p>



<a name="135972740"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2355118%20migrate%20compare%20mode/near/135972740" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://rust-lang.github.io/zulip_archive/stream/122657-t-compiler/wg-nll/topic/.2355118.20migrate.20compare.20mode.html#135972740">(Oct 17 2018 at 13:30)</a>:</h4>
<p>but rather run with <code>--bless</code></p>



<a name="135972746"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2355118%20migrate%20compare%20mode/near/135972746" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://rust-lang.github.io/zulip_archive/stream/122657-t-compiler/wg-nll/topic/.2355118.20migrate.20compare.20mode.html#135972746">(Oct 17 2018 at 13:30)</a>:</h4>
<p>and then just discard the results</p>



<a name="135972749"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2355118%20migrate%20compare%20mode/near/135972749" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://rust-lang.github.io/zulip_archive/stream/122657-t-compiler/wg-nll/topic/.2355118.20migrate.20compare.20mode.html#135972749">(Oct 17 2018 at 13:30)</a>:</h4>
<p>after doing the review</p>



<a name="135972762"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2355118%20migrate%20compare%20mode/near/135972762" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://rust-lang.github.io/zulip_archive/stream/122657-t-compiler/wg-nll/topic/.2355118.20migrate.20compare.20mode.html#135972762">(Oct 17 2018 at 13:30)</a>:</h4>
<p>I don't think we should check in stuff we don't test with the automated builders</p>



<a name="135972859"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2355118%20migrate%20compare%20mode/near/135972859" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> davidtwco <a href="https://rust-lang.github.io/zulip_archive/stream/122657-t-compiler/wg-nll/topic/.2355118.20migrate.20compare.20mode.html#135972859">(Oct 17 2018 at 13:32)</a>:</h4>
<p>I see, so it would be temporarily enabled just for the review?</p>



<a name="135972877"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2355118%20migrate%20compare%20mode/near/135972877" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://rust-lang.github.io/zulip_archive/stream/122657-t-compiler/wg-nll/topic/.2355118.20migrate.20compare.20mode.html#135972877">(Oct 17 2018 at 13:32)</a>:</h4>
<p>right, you just run it locally; of course maybe that's super annoying</p>



<a name="135972880"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2355118%20migrate%20compare%20mode/near/135972880" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://rust-lang.github.io/zulip_archive/stream/122657-t-compiler/wg-nll/topic/.2355118.20migrate.20compare.20mode.html#135972880">(Oct 17 2018 at 13:32)</a>:</h4>
<p>but that was my thought</p>



<a name="135972890"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2355118%20migrate%20compare%20mode/near/135972890" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://rust-lang.github.io/zulip_archive/stream/122657-t-compiler/wg-nll/topic/.2355118.20migrate.20compare.20mode.html#135972890">(Oct 17 2018 at 13:32)</a>:</h4>
<p>in any case once we ship compare-mode</p>



<a name="135972894"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2355118%20migrate%20compare%20mode/near/135972894" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://rust-lang.github.io/zulip_archive/stream/122657-t-compiler/wg-nll/topic/.2355118.20migrate.20compare.20mode.html#135972894">(Oct 17 2018 at 13:32)</a>:</h4>
<p>er</p>



<a name="135972898"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2355118%20migrate%20compare%20mode/near/135972898" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://rust-lang.github.io/zulip_archive/stream/122657-t-compiler/wg-nll/topic/.2355118.20migrate.20compare.20mode.html#135972898">(Oct 17 2018 at 13:32)</a>:</h4>
<p>once we ship RC2 I mean</p>



<a name="135972903"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2355118%20migrate%20compare%20mode/near/135972903" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://rust-lang.github.io/zulip_archive/stream/122657-t-compiler/wg-nll/topic/.2355118.20migrate.20compare.20mode.html#135972903">(Oct 17 2018 at 13:33)</a>:</h4>
<p>I hope to make migrate-mode the default for all editions fairly soon</p>



<a name="135972929"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2355118%20migrate%20compare%20mode/near/135972929" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://rust-lang.github.io/zulip_archive/stream/122657-t-compiler/wg-nll/topic/.2355118.20migrate.20compare.20mode.html#135972929">(Oct 17 2018 at 13:33)</a>:</h4>
<p>at which point "compare-mode" against migrate doesn't even make sense, and we would presumably start doing compare-mode of migrate vs nll</p>



<a name="135986081"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2355118%20migrate%20compare%20mode/near/135986081" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> davidtwco <a href="https://rust-lang.github.io/zulip_archive/stream/122657-t-compiler/wg-nll/topic/.2355118.20migrate.20compare.20mode.html#135986081">(Oct 17 2018 at 17:06)</a>:</h4>
<p>This PR failed on Travis - it looked spurious but I didn't get a chance to really look at it.</p>



<a name="136002189"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2355118%20migrate%20compare%20mode/near/136002189" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://rust-lang.github.io/zulip_archive/stream/122657-t-compiler/wg-nll/topic/.2355118.20migrate.20compare.20mode.html#136002189">(Oct 17 2018 at 21:30)</a>:</h4>
<p>I moved <a href="https://github.com/rust-lang/rust/issues/54528" target="_blank" title="https://github.com/rust-lang/rust/issues/54528">https://github.com/rust-lang/rust/issues/54528</a> (next round of review) to the Rust 2018 Release milestone btw</p>



<hr><p>Last updated: Aug 07 2021 at 22:04 UTC</p>
</html>