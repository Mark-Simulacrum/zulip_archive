<html>
<head><meta charset="utf-8"><title>#21232 borrow-checker allows partial reinit of struct tha... · t-compiler/wg-nll · Zulip Chat Archive</title></head>
<h2>Stream: <a href="https://rust-lang.github.io/zulip_archive/stream/122657-t-compiler/wg-nll/index.html">t-compiler/wg-nll</a></h2>
<h3>Topic: <a href="https://rust-lang.github.io/zulip_archive/stream/122657-t-compiler/wg-nll/topic/.2321232.20borrow-checker.20allows.20partial.20reinit.20of.20struct.20tha.2E.2E.2E.html">#21232 borrow-checker allows partial reinit of struct tha...</a></h3>

<hr>

<base href="https://rust-lang.zulipchat.com">

<head><link href="https://rust-lang.github.io/zulip_archive/style.css" rel="stylesheet"></head>

<a name="135059424"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2321232%20borrow-checker%20allows%20partial%20reinit%20of%20struct%20tha.../near/135059424" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> pnkfelix <a href="https://rust-lang.github.io/zulip_archive/stream/122657-t-compiler/wg-nll/topic/.2321232.20borrow-checker.20allows.20partial.20reinit.20of.20struct.20tha.2E.2E.2E.html#135059424">(Oct 02 2018 at 19:48)</a>:</h4>
<p>(if people want to voice opinions about the options available to us on <a href="https://github.com/rust-lang/rust/issues/21232" target="_blank" title="https://github.com/rust-lang/rust/issues/21232">#21232</a>, feel free to add comments there)</p>



<a name="135059434"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2321232%20borrow-checker%20allows%20partial%20reinit%20of%20struct%20tha.../near/135059434" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Keith Yeung <a href="https://rust-lang.github.io/zulip_archive/stream/122657-t-compiler/wg-nll/topic/.2321232.20borrow-checker.20allows.20partial.20reinit.20of.20struct.20tha.2E.2E.2E.html#135059434">(Oct 02 2018 at 19:48)</a>:</h4>
<p>ugh, that one is a bit annoying</p>



<a name="135059446"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2321232%20borrow-checker%20allows%20partial%20reinit%20of%20struct%20tha.../near/135059446" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Keith Yeung <a href="https://rust-lang.github.io/zulip_archive/stream/122657-t-compiler/wg-nll/topic/.2321232.20borrow-checker.20allows.20partial.20reinit.20of.20struct.20tha.2E.2E.2E.html#135059446">(Oct 02 2018 at 19:48)</a>:</h4>
<p>i was asked about this on both IRC and rust china before</p>



<a name="135059457"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2321232%20borrow-checker%20allows%20partial%20reinit%20of%20struct%20tha.../near/135059457" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> pnkfelix <a href="https://rust-lang.github.io/zulip_archive/stream/122657-t-compiler/wg-nll/topic/.2321232.20borrow-checker.20allows.20partial.20reinit.20of.20struct.20tha.2E.2E.2E.html#135059457">(Oct 02 2018 at 19:48)</a>:</h4>
<p><span class="user-mention" data-user-id="116108">@Keith Yeung</span> about which, <a href="https://github.com/rust-lang/rust/issues/21232" target="_blank" title="https://github.com/rust-lang/rust/issues/21232">#21232</a>, or <a href="https://github.com/rust-lang/rust/issues/54692" target="_blank" title="https://github.com/rust-lang/rust/issues/54692">#54692</a> ?</p>



<a name="135059462"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2321232%20borrow-checker%20allows%20partial%20reinit%20of%20struct%20tha.../near/135059462" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Keith Yeung <a href="https://rust-lang.github.io/zulip_archive/stream/122657-t-compiler/wg-nll/topic/.2321232.20borrow-checker.20allows.20partial.20reinit.20of.20struct.20tha.2E.2E.2E.html#135059462">(Oct 02 2018 at 19:48)</a>:</h4>
<p><a href="https://github.com/rust-lang/rust/issues/21232" target="_blank" title="https://github.com/rust-lang/rust/issues/21232">#21232</a></p>



<a name="135059480"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2321232%20borrow-checker%20allows%20partial%20reinit%20of%20struct%20tha.../near/135059480" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> pnkfelix <a href="https://rust-lang.github.io/zulip_archive/stream/122657-t-compiler/wg-nll/topic/.2321232.20borrow-checker.20allows.20partial.20reinit.20of.20struct.20tha.2E.2E.2E.html#135059480">(Oct 02 2018 at 19:49)</a>:</h4>
<p>ah. Yeah. Our current state is pretty goofy.</p>



<a name="135059496"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2321232%20borrow-checker%20allows%20partial%20reinit%20of%20struct%20tha.../near/135059496" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> lqd <a href="https://rust-lang.github.io/zulip_archive/stream/122657-t-compiler/wg-nll/topic/.2321232.20borrow-checker.20allows.20partial.20reinit.20of.20struct.20tha.2E.2E.2E.html#135059496">(Oct 02 2018 at 19:49)</a>:</h4>
<p>would <a href="https://github.com/rust-lang/rust/issues/21232" target="_blank" title="https://github.com/rust-lang/rust/issues/21232">#21232</a> be fiddling with our FakeReads ?</p>



<a name="135059507"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2321232%20borrow-checker%20allows%20partial%20reinit%20of%20struct%20tha.../near/135059507" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://rust-lang.github.io/zulip_archive/stream/122657-t-compiler/wg-nll/topic/.2321232.20borrow-checker.20allows.20partial.20reinit.20of.20struct.20tha.2E.2E.2E.html#135059507">(Oct 02 2018 at 19:49)</a>:</h4>
<p>not really related</p>



<a name="135059521"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2321232%20borrow-checker%20allows%20partial%20reinit%20of%20struct%20tha.../near/135059521" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://rust-lang.github.io/zulip_archive/stream/122657-t-compiler/wg-nll/topic/.2321232.20borrow-checker.20allows.20partial.20reinit.20of.20struct.20tha.2E.2E.2E.html#135059521">(Oct 02 2018 at 19:49)</a>:</h4>
<p>(I don't think?)</p>



<a name="135059573"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2321232%20borrow-checker%20allows%20partial%20reinit%20of%20struct%20tha.../near/135059573" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Keith Yeung <a href="https://rust-lang.github.io/zulip_archive/stream/122657-t-compiler/wg-nll/topic/.2321232.20borrow-checker.20allows.20partial.20reinit.20of.20struct.20tha.2E.2E.2E.html#135059573">(Oct 02 2018 at 19:50)</a>:</h4>
<p>it appears to completely violate ownership rules</p>



<a name="135059619"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2321232%20borrow-checker%20allows%20partial%20reinit%20of%20struct%20tha.../near/135059619" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> pnkfelix <a href="https://rust-lang.github.io/zulip_archive/stream/122657-t-compiler/wg-nll/topic/.2321232.20borrow-checker.20allows.20partial.20reinit.20of.20struct.20tha.2E.2E.2E.html#135059619">(Oct 02 2018 at 19:51)</a>:</h4>
<p>lets maybe branch this off into a separate topic</p>



<a name="135059621"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2321232%20borrow-checker%20allows%20partial%20reinit%20of%20struct%20tha.../near/135059621" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> lqd <a href="https://rust-lang.github.io/zulip_archive/stream/122657-t-compiler/wg-nll/topic/.2321232.20borrow-checker.20allows.20partial.20reinit.20of.20struct.20tha.2E.2E.2E.html#135059621">(Oct 02 2018 at 19:51)</a>:</h4>
<p>the lang meeting is thursday ?</p>



<a name="135059625"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2321232%20borrow-checker%20allows%20partial%20reinit%20of%20struct%20tha.../near/135059625" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> pnkfelix <a href="https://rust-lang.github.io/zulip_archive/stream/122657-t-compiler/wg-nll/topic/.2321232.20borrow-checker.20allows.20partial.20reinit.20of.20struct.20tha.2E.2E.2E.html#135059625">(Oct 02 2018 at 19:51)</a>:</h4>
<p>/me will actually do so, right now</p>



<a name="135070038"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2321232%20borrow-checker%20allows%20partial%20reinit%20of%20struct%20tha.../near/135070038" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jake Goulding <a href="https://rust-lang.github.io/zulip_archive/stream/122657-t-compiler/wg-nll/topic/.2321232.20borrow-checker.20allows.20partial.20reinit.20of.20struct.20tha.2E.2E.2E.html#135070038">(Oct 02 2018 at 23:12)</a>:</h4>
<p>Everything else being equal, I'd prefer if structs / enums could be treated as "dumb containers" when I have ownership of them.</p>
<p>If I have a declared but undefined value and add all the fields to it, I'd like for it to work. Likewise, I'd like to be able to move a value out of it and put a new value and have it work.</p>



<a name="135071391"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2321232%20borrow-checker%20allows%20partial%20reinit%20of%20struct%20tha.../near/135071391" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Keith Yeung <a href="https://rust-lang.github.io/zulip_archive/stream/122657-t-compiler/wg-nll/topic/.2321232.20borrow-checker.20allows.20partial.20reinit.20of.20struct.20tha.2E.2E.2E.html#135071391">(Oct 02 2018 at 23:49)</a>:</h4>
<p>we should be able to make a determination of whether all the fields of the struct are properly initialized before a use with our MIR borrowck</p>



<a name="135071394"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2321232%20borrow-checker%20allows%20partial%20reinit%20of%20struct%20tha.../near/135071394" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Keith Yeung <a href="https://rust-lang.github.io/zulip_archive/stream/122657-t-compiler/wg-nll/topic/.2321232.20borrow-checker.20allows.20partial.20reinit.20of.20struct.20tha.2E.2E.2E.html#135071394">(Oct 02 2018 at 23:49)</a>:</h4>
<p>but perhaps the real question here is how efficient can we make this check</p>



<a name="135906469"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2321232%20borrow-checker%20allows%20partial%20reinit%20of%20struct%20tha.../near/135906469" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> pnkfelix <a href="https://rust-lang.github.io/zulip_archive/stream/122657-t-compiler/wg-nll/topic/.2321232.20borrow-checker.20allows.20partial.20reinit.20of.20struct.20tha.2E.2E.2E.html#135906469">(Oct 16 2018 at 15:13)</a>:</h4>
<p>Hey, I have put up an r? <span class="user-mention" data-user-id="116009">@nikomatsakis</span>  for PR <a href="https://github.com/rust-lang/rust/issues/54941" target="_blank" title="https://github.com/rust-lang/rust/issues/54941">#54941</a>, but I suspect that others (e.g. <span class="user-mention" data-user-id="116266">@Santiago Pastorino</span> ) would be reasonable alternative choices for doing the review.</p>



<a name="135906535"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2321232%20borrow-checker%20allows%20partial%20reinit%20of%20struct%20tha.../near/135906535" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> pnkfelix <a href="https://rust-lang.github.io/zulip_archive/stream/122657-t-compiler/wg-nll/topic/.2321232.20borrow-checker.20allows.20partial.20reinit.20of.20struct.20tha.2E.2E.2E.html#135906535">(Oct 16 2018 at 15:14)</a>:</h4>
<blockquote>
<p>If I have a declared but undefined value and add all the fields to it, I'd like for it to work. Likewise, I'd like to be able to move a value out of it and put a new value and have it work.</p>
</blockquote>
<p>I think the lang team agrees that we want to do this. See <a href="https://github.com/rust-lang/rust/issues/54987" target="_blank" title="https://github.com/rust-lang/rust/issues/54987">#54987</a>. Centril told me that they are working on an RFC for it.</p>



<a name="135908367"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2321232%20borrow-checker%20allows%20partial%20reinit%20of%20struct%20tha.../near/135908367" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://rust-lang.github.io/zulip_archive/stream/122657-t-compiler/wg-nll/topic/.2321232.20borrow-checker.20allows.20partial.20reinit.20of.20struct.20tha.2E.2E.2E.html#135908367">(Oct 16 2018 at 15:41)</a>:</h4>
<p>seems obvious (to me) that it should work</p>



<a name="135908786"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2321232%20borrow-checker%20allows%20partial%20reinit%20of%20struct%20tha.../near/135908786" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://rust-lang.github.io/zulip_archive/stream/122657-t-compiler/wg-nll/topic/.2321232.20borrow-checker.20allows.20partial.20reinit.20of.20struct.20tha.2E.2E.2E.html#135908786">(Oct 16 2018 at 15:47)</a>:</h4>
<p><span class="user-mention" data-user-id="116083">@pnkfelix</span> left a few nits but looks great</p>



<a name="135914430"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2321232%20borrow-checker%20allows%20partial%20reinit%20of%20struct%20tha.../near/135914430" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://rust-lang.github.io/zulip_archive/stream/122657-t-compiler/wg-nll/topic/.2321232.20borrow-checker.20allows.20partial.20reinit.20of.20struct.20tha.2E.2E.2E.html#135914430">(Oct 16 2018 at 17:15)</a>:</h4>
<p>I can also help checking this out later</p>



<a name="135914486"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2321232%20borrow-checker%20allows%20partial%20reinit%20of%20struct%20tha.../near/135914486" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://rust-lang.github.io/zulip_archive/stream/122657-t-compiler/wg-nll/topic/.2321232.20borrow-checker.20allows.20partial.20reinit.20of.20struct.20tha.2E.2E.2E.html#135914486">(Oct 16 2018 at 17:16)</a>:</h4>
<p>I'm traveling today though</p>



<a name="135921894"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2321232%20borrow-checker%20allows%20partial%20reinit%20of%20struct%20tha.../near/135921894" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> pnkfelix <a href="https://rust-lang.github.io/zulip_archive/stream/122657-t-compiler/wg-nll/topic/.2321232.20borrow-checker.20allows.20partial.20reinit.20of.20struct.20tha.2E.2E.2E.html#135921894">(Oct 16 2018 at 19:01)</a>:</h4>
<p><span class="user-mention" data-user-id="116266">@Santiago Pastorino</span> okay if you get a chance to glance over it, great. But no big deal if you cannot alllocate time; I know what a bear travel can be</p>



<hr><p>Last updated: Aug 07 2021 at 22:04 UTC</p>
</html>