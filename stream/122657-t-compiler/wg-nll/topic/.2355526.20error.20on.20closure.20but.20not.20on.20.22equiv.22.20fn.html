<html>
<head><meta charset="utf-8"><title>#55526 error on closure but not on &quot;equiv&quot; fn · t-compiler/wg-nll · Zulip Chat Archive</title></head>
<h2>Stream: <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/index.html">t-compiler/wg-nll</a></h2>
<h3>Topic: <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2355526.20error.20on.20closure.20but.20not.20on.20.22equiv.22.20fn.html">#55526 error on closure but not on &quot;equiv&quot; fn</a></h3>

<hr>

<base href="https://rust-lang.zulipchat.com">

<head><link href="https://zulip-archive.rust-lang.org/style.css" rel="stylesheet"></head>

<a name="150836603"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2355526%20error%20on%20closure%20but%20not%20on%20%22equiv%22%20fn/near/150836603" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> pnkfelix <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2355526.20error.20on.20closure.20but.20not.20on.20.22equiv.22.20fn.html#150836603">(Dec 04 2018 at 10:21)</a>:</h4>
<p>I wanted to just jot some thoughts down here rather than continuing to spam the issue with ill-formed ideas</p>



<a name="150836622"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2355526%20error%20on%20closure%20but%20not%20on%20%22equiv%22%20fn/near/150836622" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> pnkfelix <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2355526.20error.20on.20closure.20but.20not.20on.20.22equiv.22.20fn.html#150836622">(Dec 04 2018 at 10:21)</a>:</h4>
<p>So the heart of the problem is in how we are supposed to handle a case like this:</p>
<div class="codehilite"><pre><span></span><span class="k">fn</span> <span class="nf">main</span><span class="p">()</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="n">_v_lambda</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">|</span><span class="n">v</span>: <span class="kp">&amp;</span><span class="kt">str</span><span class="o">|</span><span class="w"> </span>-&gt; <span class="kp">&amp;</span><span class="kt">str</span> <span class="p">{</span><span class="w"> </span><span class="n">v</span><span class="w"> </span><span class="p">};</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>
</pre></div>



<a name="150836814"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2355526%20error%20on%20closure%20but%20not%20on%20%22equiv%22%20fn/near/150836814" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> pnkfelix <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2355526.20error.20on.20closure.20but.20not.20on.20.22equiv.22.20fn.html#150836814">(Dec 04 2018 at 10:24)</a>:</h4>
<p>in particular, from what I can tell, the region on the <em>return type</em> is a FreeRegion (specificially <code>&amp;ReScope(CallSite(10)) str</code>), even though the argument type is BoundRegion (i.e. the type we have, prior to NLL region renumbering, is <code>for&lt;'r&gt; fn(&amp;ReLateBound(DebruinIndex(0)) str) -&gt; &amp;ReScope(CallSite(10)) str</code></p>



<a name="150836894"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2355526%20error%20on%20closure%20but%20not%20on%20%22equiv%22%20fn/near/150836894" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> pnkfelix <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2355526.20error.20on.20closure.20but.20not.20on.20.22equiv.22.20fn.html#150836894">(Dec 04 2018 at 10:25)</a>:</h4>
<p>So here's the question I have: What is region-renumbering <em>supposed</em> to do here to handle this case? In the most general case, I would assume that we would <em>like</em> to be able to infer that the same region (introduced by the <code>for &lt;'r&gt;</code> binding) is used for both the input argument and also the return type.</p>



<a name="150837002"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2355526%20error%20on%20closure%20but%20not%20on%20%22equiv%22%20fn/near/150837002" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> pnkfelix <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2355526.20error.20on.20closure.20but.20not.20on.20.22equiv.22.20fn.html#150837002">(Dec 04 2018 at 10:27)</a>:</h4>
<p>But... am I correct that NLL region inference does not look at the MIR for the closure body and its containing item simultaneously? If we are considering them independently, then I do not see how we could hope to infer a correct usable region from the containing item alone (at least not in the general case where the closure body could return other longer lived stuff; but maybe I should generalize the example to use <code>&amp;mut</code> before I get subregion relations mixed in here)</p>



<a name="150837186"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2355526%20error%20on%20closure%20but%20not%20on%20%22equiv%22%20fn/near/150837186" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> pnkfelix <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2355526.20error.20on.20closure.20but.20not.20on.20.22equiv.22.20fn.html#150837186">(Dec 04 2018 at 10:31)</a>:</h4>
<p>sorry, I realized I left out a step when I was trying to establish the context of the problem: The reason I pointed out that the region on the return type is a free region (and not the BoundRegion from the argument type) is that free regions get renumbered by the NLL region renumbering pass, effectively turning them into inference variables.</p>



<a name="150837205"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2355526%20error%20on%20closure%20but%20not%20on%20%22equiv%22%20fn/near/150837205" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> pnkfelix <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2355526.20error.20on.20closure.20but.20not.20on.20.22equiv.22.20fn.html#150837205">(Dec 04 2018 at 10:31)</a>:</h4>
<p>and so what I am musing about is whether we should be handling region-renumbering of closure types in a more nuanced way.</p>



<a name="150837263"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2355526%20error%20on%20closure%20but%20not%20on%20%22equiv%22%20fn/near/150837263" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> pnkfelix <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2355526.20error.20on.20closure.20but.20not.20on.20.22equiv.22.20fn.html#150837263">(Dec 04 2018 at 10:32)</a>:</h4>
<p>(or if the we need to change the way regions are assigned for the types of closures themselves at the outset, so that the region here would be the bound-region?)</p>



<a name="150842988"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2355526%20error%20on%20closure%20but%20not%20on%20%22equiv%22%20fn/near/150842988" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2355526.20error.20on.20closure.20but.20not.20on.20.22equiv.22.20fn.html#150842988">(Dec 04 2018 at 12:28)</a>:</h4>
<p><span class="user-mention" data-user-id="116083">@pnkfelix</span> yes I figured this would be the problem -- I've not read all your comments yet but this has been an area with a lot of iteration (how to handle user type annot on closure)</p>



<a name="150842992"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2355526%20error%20on%20closure%20but%20not%20on%20%22equiv%22%20fn/near/150842992" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> pnkfelix <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2355526.20error.20on.20closure.20but.20not.20on.20.22equiv.22.20fn.html#150842992">(Dec 04 2018 at 12:28)</a>:</h4>
<p>Note that this problem arises with no type annotation</p>



<a name="150842997"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2355526%20error%20on%20closure%20but%20not%20on%20%22equiv%22%20fn/near/150842997" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> pnkfelix <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2355526.20error.20on.20closure.20but.20not.20on.20.22equiv.22.20fn.html#150842997">(Dec 04 2018 at 12:29)</a>:</h4>
<p>I just added that as a way to try to narrow down the problem</p>



<a name="150843001"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2355526%20error%20on%20closure%20but%20not%20on%20%22equiv%22%20fn/near/150843001" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2355526.20error.20on.20closure.20but.20not.20on.20.22equiv.22.20fn.html#150843001">(Dec 04 2018 at 12:29)</a>:</h4>
<p>MIR does not (and I feel strongly that it should not) look at closure container and closure simultaneously</p>



<a name="150843002"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2355526%20error%20on%20closure%20but%20not%20on%20%22equiv%22%20fn/near/150843002" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2355526.20error.20on.20closure.20but.20not.20on.20.22equiv.22.20fn.html#150843002">(Dec 04 2018 at 12:29)</a>:</h4>
<p>yes I figured that</p>



<a name="150843006"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2355526%20error%20on%20closure%20but%20not%20on%20%22equiv%22%20fn/near/150843006" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2355526.20error.20on.20closure.20but.20not.20on.20.22equiv.22.20fn.html#150843006">(Dec 04 2018 at 12:29)</a>:</h4>
<p>right now, it is "normal" type check's job to define where lifetime binders appear</p>



<a name="150843008"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2355526%20error%20on%20closure%20but%20not%20on%20%22equiv%22%20fn/near/150843008" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2355526.20error.20on.20closure.20but.20not.20on.20.22equiv.22.20fn.html#150843008">(Dec 04 2018 at 12:29)</a>:</h4>
<p>that's it's only lifetime-related job</p>



<a name="150843011"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2355526%20error%20on%20closure%20but%20not%20on%20%22equiv%22%20fn/near/150843011" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> pnkfelix <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2355526.20error.20on.20closure.20but.20not.20on.20.22equiv.22.20fn.html#150843011">(Dec 04 2018 at 12:29)</a>:</h4>
<p>can/should we be analyzing the closure body and then using that to inform the region inference for the container?</p>



<a name="150843013"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2355526%20error%20on%20closure%20but%20not%20on%20%22equiv%22%20fn/near/150843013" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2355526.20error.20on.20closure.20but.20not.20on.20.22equiv.22.20fn.html#150843013">(Dec 04 2018 at 12:29)</a>:</h4>
<p>we do that already</p>



<a name="150843016"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2355526%20error%20on%20closure%20but%20not%20on%20%22equiv%22%20fn/near/150843016" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2355526.20error.20on.20closure.20but.20not.20on.20.22equiv.22.20fn.html#150843016">(Dec 04 2018 at 12:29)</a>:</h4>
<p>the closure passes up constraints to its creator</p>



<a name="150843018"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2355526%20error%20on%20closure%20but%20not%20on%20%22equiv%22%20fn/near/150843018" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> pnkfelix <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2355526.20error.20on.20closure.20but.20not.20on.20.22equiv.22.20fn.html#150843018">(Dec 04 2018 at 12:30)</a>:</h4>
<p>well should we be doing it "better" ?</p>



<a name="150843071"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2355526%20error%20on%20closure%20but%20not%20on%20%22equiv%22%20fn/near/150843071" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2355526.20error.20on.20closure.20but.20not.20on.20.22equiv.22.20fn.html#150843071">(Dec 04 2018 at 12:30)</a>:</h4>
<p>maybe? let me read in a bit more detail.</p>



<a name="150843077"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2355526%20error%20on%20closure%20but%20not%20on%20%22equiv%22%20fn/near/150843077" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> pnkfelix <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2355526.20error.20on.20closure.20but.20not.20on.20.22equiv.22.20fn.html#150843077">(Dec 04 2018 at 12:30)</a>:</h4>
<p>I guess that may be more what I mean: Should I be looking at the format of the constraints and seeing if I can use them to properly infer a region to assign here</p>



<a name="150843089"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2355526%20error%20on%20closure%20but%20not%20on%20%22equiv%22%20fn/near/150843089" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2355526.20error.20on.20closure.20but.20not.20on.20.22equiv.22.20fn.html#150843089">(Dec 04 2018 at 12:31)</a>:</h4>
<p>but if I recall what will happen here is:</p>
<ul>
<li>typeck has no expected type here</li>
<li>so it will infer that there are no bound regions in the arguments</li>
</ul>
<p>the type annotation just enforces the view from "inside the closure", so it wouldn't change that, I don't think.</p>
<p>In which case the error for NLL is just "correct"</p>



<a name="150843097"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2355526%20error%20on%20closure%20but%20not%20on%20%22equiv%22%20fn/near/150843097" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> pnkfelix <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2355526.20error.20on.20closure.20but.20not.20on.20.22equiv.22.20fn.html#150843097">(Dec 04 2018 at 12:31)</a>:</h4>
<p>no bound regions? So you don't expect to see ReEarlyBound ?</p>



<a name="150843140"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2355526%20error%20on%20closure%20but%20not%20on%20%22equiv%22%20fn/near/150843140" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2355526.20error.20on.20closure.20but.20not.20on.20.22equiv.22.20fn.html#150843140">(Dec 04 2018 at 12:32)</a>:</h4>
<p>ReEarlyBound is not a bound region :P</p>



<a name="150843145"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2355526%20error%20on%20closure%20but%20not%20on%20%22equiv%22%20fn/near/150843145" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> pnkfelix <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2355526.20error.20on.20closure.20but.20not.20on.20.22equiv.22.20fn.html#150843145">(Dec 04 2018 at 12:32)</a>:</h4>
<p>oh I misinterpreted</p>



<a name="150843146"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2355526%20error%20on%20closure%20but%20not%20on%20%22equiv%22%20fn/near/150843146" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2355526.20error.20on.20closure.20but.20not.20on.20.22equiv.22.20fn.html#150843146">(Dec 04 2018 at 12:32)</a>:</h4>
<p>what I really meant is no <em>late-bound</em> regions...</p>



<a name="150843147"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2355526%20error%20on%20closure%20but%20not%20on%20%22equiv%22%20fn/near/150843147" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2355526.20error.20on.20closure.20but.20not.20on.20.22equiv.22.20fn.html#150843147">(Dec 04 2018 at 12:32)</a>:</h4>
<p>well</p>



<a name="150843148"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2355526%20error%20on%20closure%20but%20not%20on%20%22equiv%22%20fn/near/150843148" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2355526.20error.20on.20closure.20but.20not.20on.20.22equiv.22.20fn.html#150843148">(Dec 04 2018 at 12:32)</a>:</h4>
<p>sorry what I wrote is probably wrong</p>



<a name="150843150"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2355526%20error%20on%20closure%20but%20not%20on%20%22equiv%22%20fn/near/150843150" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2355526.20error.20on.20closure.20but.20not.20on.20.22equiv.22.20fn.html#150843150">(Dec 04 2018 at 12:32)</a>:</h4>
<p>I mean it's correct</p>



<a name="150843151"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2355526%20error%20on%20closure%20but%20not%20on%20%22equiv%22%20fn/near/150843151" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2355526.20error.20on.20closure.20but.20not.20on.20.22equiv.22.20fn.html#150843151">(Dec 04 2018 at 12:32)</a>:</h4>
<p>there would be no late-bound regions</p>



<a name="150843153"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2355526%20error%20on%20closure%20but%20not%20on%20%22equiv%22%20fn/near/150843153" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2355526.20error.20on.20closure.20but.20not.20on.20.22equiv.22.20fn.html#150843153">(Dec 04 2018 at 12:32)</a>:</h4>
<p>but that's not the only relevant question here</p>



<a name="150843155"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2355526%20error%20on%20closure%20but%20not%20on%20%22equiv%22%20fn/near/150843155" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> pnkfelix <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2355526.20error.20on.20closure.20but.20not.20on.20.22equiv.22.20fn.html#150843155">(Dec 04 2018 at 12:32)</a>:</h4>
<p>actually I might have meant ReLateBound</p>



<a name="150843159"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2355526%20error%20on%20closure%20but%20not%20on%20%22equiv%22%20fn/near/150843159" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2355526.20error.20on.20closure.20but.20not.20on.20.22equiv.22.20fn.html#150843159">(Dec 04 2018 at 12:32)</a>:</h4>
<p>basically the question is whether the input/output have same region, wherever it is bound</p>



<a name="150843170"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2355526%20error%20on%20closure%20but%20not%20on%20%22equiv%22%20fn/near/150843170" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2355526.20error.20on.20closure.20but.20not.20on.20.22equiv.22.20fn.html#150843170">(Dec 04 2018 at 12:33)</a>:</h4>
<p>anyway let me get a local build going</p>



<a name="150843171"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2355526%20error%20on%20closure%20but%20not%20on%20%22equiv%22%20fn/near/150843171" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2355526.20error.20on.20closure.20but.20not.20on.20.22equiv.22.20fn.html#150843171">(Dec 04 2018 at 12:33)</a>:</h4>
<p>with some debuginfo</p>



<a name="150843175"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2355526%20error%20on%20closure%20but%20not%20on%20%22equiv%22%20fn/near/150843175" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2355526.20error.20on.20closure.20but.20not.20on.20.22equiv.22.20fn.html#150843175">(Dec 04 2018 at 12:33)</a>:</h4>
<p>"closure annotations my old friend...I've come to talk with you again..."</p>



<a name="150843187"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2355526%20error%20on%20closure%20but%20not%20on%20%22equiv%22%20fn/near/150843187" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2355526.20error.20on.20closure.20but.20not.20on.20.22equiv.22.20fn.html#150843187">(Dec 04 2018 at 12:33)</a>:</h4>
<p>if I could go back in time and make one change to Rust, sometimes I think it would be to give a hard error if closure signatures did not have an expected type (and not permit user annotation)</p>



<a name="150843233"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2355526%20error%20on%20closure%20but%20not%20on%20%22equiv%22%20fn/near/150843233" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2355526.20error.20on.20closure.20but.20not.20on.20.22equiv.22.20fn.html#150843233">(Dec 04 2018 at 12:34)</a>:</h4>
<p>or at least to make an alternate, full-feature annotation form that must be completely specified</p>



<a name="150843240"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2355526%20error%20on%20closure%20but%20not%20on%20%22equiv%22%20fn/near/150843240" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> pnkfelix <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2355526.20error.20on.20closure.20but.20not.20on.20.22equiv.22.20fn.html#150843240">(Dec 04 2018 at 12:34)</a>:</h4>
<p>...... you would not permit user annotation as the way to provide the expected type?</p>



<a name="150843265"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2355526%20error%20on%20closure%20but%20not%20on%20%22equiv%22%20fn/near/150843265" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> pnkfelix <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2355526.20error.20on.20closure.20but.20not.20on.20.22equiv.22.20fn.html#150843265">(Dec 04 2018 at 12:35)</a>:</h4>
<p>anyway I don't mind continuing to poke at this; I feel like I want to sink my toes more deeply into this code again</p>



<a name="150843266"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2355526%20error%20on%20closure%20but%20not%20on%20%22equiv%22%20fn/near/150843266" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2355526.20error.20on.20closure.20but.20not.20on.20.22equiv.22.20fn.html#150843266">(Dec 04 2018 at 12:35)</a>:</h4>
<p>well if we did I would require complete annotation like a fn</p>



<a name="150843270"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2355526%20error%20on%20closure%20but%20not%20on%20%22equiv%22%20fn/near/150843270" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2355526.20error.20on.20closure.20but.20not.20on.20.22equiv.22.20fn.html#150843270">(Dec 04 2018 at 12:35)</a>:</h4>
<p>ok, I want to investigate a bit too just to have an informed opinion</p>



<a name="150843313"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2355526%20error%20on%20closure%20but%20not%20on%20%22equiv%22%20fn/near/150843313" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2355526.20error.20on.20closure.20but.20not.20on.20.22equiv.22.20fn.html#150843313">(Dec 04 2018 at 12:36)</a>:</h4>
<p>right now we permit things like <code>|x: u32| foo</code> -- return type unannotated</p>



<a name="150843315"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2355526%20error%20on%20closure%20but%20not%20on%20%22equiv%22%20fn/near/150843315" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2355526.20error.20on.20closure.20but.20not.20on.20.22equiv.22.20fn.html#150843315">(Dec 04 2018 at 12:36)</a>:</h4>
<p>etc</p>



<a name="150843318"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2355526%20error%20on%20closure%20but%20not%20on%20%22equiv%22%20fn/near/150843318" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2355526.20error.20on.20closure.20but.20not.20on.20.22equiv.22.20fn.html#150843318">(Dec 04 2018 at 12:36)</a>:</h4>
<p>we also have no way to use named lifetimes</p>



<a name="150843319"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2355526%20error%20on%20closure%20but%20not%20on%20%22equiv%22%20fn/near/150843319" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2355526.20error.20on.20closure.20but.20not.20on.20.22equiv.22.20fn.html#150843319">(Dec 04 2018 at 12:36)</a>:</h4>
<p>it's sort of a mess</p>



<a name="150843323"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2355526%20error%20on%20closure%20but%20not%20on%20%22equiv%22%20fn/near/150843323" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> pnkfelix <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2355526.20error.20on.20closure.20but.20not.20on.20.22equiv.22.20fn.html#150843323">(Dec 04 2018 at 12:36)</a>:</h4>
<p>yes I agree wit hthat</p>



<a name="150843334"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2355526%20error%20on%20closure%20but%20not%20on%20%22equiv%22%20fn/near/150843334" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2355526.20error.20on.20closure.20but.20not.20on.20.22equiv.22.20fn.html#150843334">(Dec 04 2018 at 12:36)</a>:</h4>
<p>I of course want there to be some way to specify types</p>



<a name="150843341"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2355526%20error%20on%20closure%20but%20not%20on%20%22equiv%22%20fn/near/150843341" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> pnkfelix <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2355526.20error.20on.20closure.20but.20not.20on.20.22equiv.22.20fn.html#150843341">(Dec 04 2018 at 12:36)</a>:</h4>
<p>it would be nice to at least allow <code>let f = for &lt;'a&gt; |arg: &amp;'a T| -&gt; &amp;'a Answer { ... };</code></p>



<a name="150843351"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2355526%20error%20on%20closure%20but%20not%20on%20%22equiv%22%20fn/near/150843351" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2355526.20error.20on.20closure.20but.20not.20on.20.22equiv.22.20fn.html#150843351">(Dec 04 2018 at 12:37)</a>:</h4>
<p>yes, presumably we'll ultimately use some syntax like that</p>



<a name="150843360"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2355526%20error%20on%20closure%20but%20not%20on%20%22equiv%22%20fn/near/150843360" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> pnkfelix <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2355526.20error.20on.20closure.20but.20not.20on.20.22equiv.22.20fn.html#150843360">(Dec 04 2018 at 12:37)</a>:</h4>
<p>it is sort of amazing we've gotten this far without adding it as an unstable feature...</p>



<a name="150843362"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2355526%20error%20on%20closure%20but%20not%20on%20%22equiv%22%20fn/near/150843362" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2355526.20error.20on.20closure.20but.20not.20on.20.22equiv.22.20fn.html#150843362">(Dec 04 2018 at 12:37)</a>:</h4>
<p>heh yes</p>



<a name="150845815"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2355526%20error%20on%20closure%20but%20not%20on%20%22equiv%22%20fn/near/150845815" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> pnkfelix <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2355526.20error.20on.20closure.20but.20not.20on.20.22equiv.22.20fn.html#150845815">(Dec 04 2018 at 13:24)</a>:</h4>
<blockquote>
<p>the closure passes up constraints to its creator</p>
</blockquote>



<a name="150845858"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2355526%20error%20on%20closure%20but%20not%20on%20%22equiv%22%20fn/near/150845858" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> pnkfelix <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2355526.20error.20on.20closure.20but.20not.20on.20.22equiv.22.20fn.html#150845858">(Dec 04 2018 at 13:25)</a>:</h4>
<p>So <code>RegionConstraintData</code>, or at least its doc comment, implies that in some places we can encode both conditions that must be verified in addition to assumptions that can be made</p>



<a name="150845923"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2355526%20error%20on%20closure%20but%20not%20on%20%22equiv%22%20fn/near/150845923" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> pnkfelix <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2355526.20error.20on.20closure.20but.20not.20on.20.22equiv.22.20fn.html#150845923">(Dec 04 2018 at 13:26)</a>:</h4>
<p>But AFAICT the <code>QueryRegionConstraint</code> is not expressive enough to encode both kinds of things? I assume it is only passing along conditions that must be verified?</p>



<a name="150846102"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2355526%20error%20on%20closure%20but%20not%20on%20%22equiv%22%20fn/near/150846102" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> pnkfelix <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2355526.20error.20on.20closure.20but.20not.20on.20.22equiv.22.20fn.html#150846102">(Dec 04 2018 at 13:28)</a>:</h4>
<p>(The <code>RegionConstraintData</code> I'm talking about is in <code>rustc::infer::region_constraints</code>, so perhaps it is not the right thing for me to be taking inspiration from. But I nonetheless was wondering whether <code>QueryRegionConstraint</code> should be expanded to allow one to encode assumptions that can be made, so that one might e.g. express "the region on the return type can be assumed to outlive the bound-region attached to the argument type")</p>



<a name="150846338"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2355526%20error%20on%20closure%20but%20not%20on%20%22equiv%22%20fn/near/150846338" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> pnkfelix <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2355526.20error.20on.20closure.20but.20not.20on.20.22equiv.22.20fn.html#150846338">(Dec 04 2018 at 13:32)</a>:</h4>
<p>/me goes off to see if the rustc guide talks about this</p>



<a name="150850360"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2355526%20error%20on%20closure%20but%20not%20on%20%22equiv%22%20fn/near/150850360" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> pnkfelix <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2355526.20error.20on.20closure.20but.20not.20on.20.22equiv.22.20fn.html#150850360">(Dec 04 2018 at 14:24)</a>:</h4>
<p>(its possible that the answer here is that it was an internal bug that AST-borrowck accepted this code in the first place. At least, I'm having difficultly understanding how the region it infers for the return type can make sense; and the code <em>does</em> get rejected if you start trying to call the closure...)</p>



<a name="150855221"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2355526%20error%20on%20closure%20but%20not%20on%20%22equiv%22%20fn/near/150855221" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2355526.20error.20on.20closure.20but.20not.20on.20.22equiv.22.20fn.html#150855221">(Dec 04 2018 at 15:33)</a>:</h4>
<blockquote>
<p>So <code>RegionConstraintData</code>, or at least its doc comment, implies that in some places we can encode both conditions that must be verified in addition to assumptions that can be made</p>
</blockquote>
<p>I don't think we can presently encode that</p>



<a name="150855234"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2355526%20error%20on%20closure%20but%20not%20on%20%22equiv%22%20fn/near/150855234" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2355526.20error.20on.20closure.20but.20not.20on.20.22equiv.22.20fn.html#150855234">(Dec 04 2018 at 15:33)</a>:</h4>
<p>I don't quite get why you want to yet but I'm in plenary so it's hard to concentrate</p>



<a name="150855332"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2355526%20error%20on%20closure%20but%20not%20on%20%22equiv%22%20fn/near/150855332" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> pnkfelix <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2355526.20error.20on.20closure.20but.20not.20on.20.22equiv.22.20fn.html#150855332">(Dec 04 2018 at 15:35)</a>:</h4>
<p>Well its possible that all of this is arising from a different bug that matthewjasper identified</p>



<a name="150855345"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2355526%20error%20on%20closure%20but%20not%20on%20%22equiv%22%20fn/near/150855345" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> pnkfelix <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2355526.20error.20on.20closure.20but.20not.20on.20.22equiv.22.20fn.html#150855345">(Dec 04 2018 at 15:35)</a>:</h4>
<p>see PR <a href="https://github.com/rust-lang/rust/issues/56486" target="_blank" title="https://github.com/rust-lang/rust/issues/56486">#56486</a></p>



<a name="150855479"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2355526%20error%20on%20closure%20but%20not%20on%20%22equiv%22%20fn/near/150855479" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> pnkfelix <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2355526.20error.20on.20closure.20but.20not.20on.20.22equiv.22.20fn.html#150855479">(Dec 04 2018 at 15:37)</a>:</h4>
<p>(the reason I was thinking we'd want to encode Assumptions, in addition to constraints, is that I figured that when you are starting with <code>for &lt;'r&gt; (&amp;'r T1) -&gt; &amp;'_#1r T2</code> , that you might want to allow '_#1r to be unified with <code>'r</code></p>



<a name="150855503"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2355526%20error%20on%20closure%20but%20not%20on%20%22equiv%22%20fn/near/150855503" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> pnkfelix <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2355526.20error.20on.20closure.20but.20not.20on.20.22equiv.22.20fn.html#150855503">(Dec 04 2018 at 15:37)</a>:</h4>
<p>but I figure in order to do that, you would need to propagate knowledge that the closure body actually allows that unification.</p>



<a name="150856045"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2355526%20error%20on%20closure%20but%20not%20on%20%22equiv%22%20fn/near/150856045" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> pnkfelix <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2355526.20error.20on.20closure.20but.20not.20on.20.22equiv.22.20fn.html#150856045">(Dec 04 2018 at 15:45)</a>:</h4>
<p>(okay, no, PR <a href="https://github.com/rust-lang/rust/issues/56486" target="_blank" title="https://github.com/rust-lang/rust/issues/56486">#56486</a> alone will not fix this)</p>



<a name="150922362"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2355526%20error%20on%20closure%20but%20not%20on%20%22equiv%22%20fn/near/150922362" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> pnkfelix <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2355526.20error.20on.20closure.20but.20not.20on.20.22equiv.22.20fn.html#150922362">(Dec 05 2018 at 12:02)</a>:</h4>
<p>more investigation: I've started looking at the nll.0.mir for the closure</p>



<a name="150922379"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2355526%20error%20on%20closure%20but%20not%20on%20%22equiv%22%20fn/near/150922379" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> pnkfelix <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2355526.20error.20on.20closure.20but.20not.20on.20.22equiv.22.20fn.html#150922379">(Dec 05 2018 at 12:02)</a>:</h4>
<p>which, once I started understanding the equivalences, helps illuminate some things, I think</p>



<a name="150922423"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2355526%20error%20on%20closure%20but%20not%20on%20%22equiv%22%20fn/near/150922423" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> pnkfelix <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2355526.20error.20on.20closure.20but.20not.20on.20.22equiv.22.20fn.html#150922423">(Dec 05 2018 at 12:03)</a>:</h4>
<p>in particular, the "Free Region Mapping" has two relevant entries for the running example <code>let _v_lambda = |v: &amp;str| { v };</code></p>



<a name="150922448"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2355526%20error%20on%20closure%20but%20not%20on%20%22equiv%22%20fn/near/150922448" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> pnkfelix <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2355526.20error.20on.20closure.20but.20not.20on.20.22equiv.22.20fn.html#150922448">(Dec 05 2018 at 12:03)</a>:</h4>
<p>the relevant entries are: </p>
<div class="codehilite"><pre><span></span>| Free Region Mapping
| &#39;_#0r | Global | [&#39;_#0r, &#39;_#4r, &#39;_#1r, &#39;_#2r, &#39;_#3r]
| &#39;_#1r | External | [&#39;_#4r, &#39;_#1r]
| &#39;_#2r | Local | [&#39;_#4r, &#39;_#2r]
| &#39;_#3r | Local | [&#39;_#4r, &#39;_#3r]
</pre></div>



<a name="150922677"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2355526%20error%20on%20closure%20but%20not%20on%20%22equiv%22%20fn/near/150922677" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> pnkfelix <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2355526.20error.20on.20closure.20but.20not.20on.20.22equiv.22.20fn.html#150922677">(Dec 05 2018 at 12:07)</a>:</h4>
<p>and the type for the closure, when we start checking it (and after substituting in inferred-to-be equivalent regions to simplify presentation here): <code>fn main::{{closure}}(_1: &amp;'_#2r [closure-env], _2: &amp;'_#3r str) -&gt; &amp;'_#1r str</code></p>



<a name="150922770"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2355526%20error%20on%20closure%20but%20not%20on%20%22equiv%22%20fn/near/150922770" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2355526.20error.20on.20closure.20but.20not.20on.20.22equiv.22.20fn.html#150922770">(Dec 05 2018 at 12:08)</a>:</h4>
<p>argh I've failed to follow up on this</p>



<a name="150922777"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2355526%20error%20on%20closure%20but%20not%20on%20%22equiv%22%20fn/near/150922777" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> pnkfelix <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2355526.20error.20on.20closure.20but.20not.20on.20.22equiv.22.20fn.html#150922777">(Dec 05 2018 at 12:08)</a>:</h4>
<p>so, okay, that means the closure gets the input <code>_2: &amp;'_#3r str</code> and will just pass it back as the result <code>'_#1r str</code></p>



<a name="150922780"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2355526%20error%20on%20closure%20but%20not%20on%20%22equiv%22%20fn/near/150922780" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2355526.20error.20on.20closure.20but.20not.20on.20.22equiv.22.20fn.html#150922780">(Dec 05 2018 at 12:08)</a>:</h4>
<p>I can prob do that this morning once I find some more coffee</p>



<a name="150922801"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2355526%20error%20on%20closure%20but%20not%20on%20%22equiv%22%20fn/near/150922801" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> pnkfelix <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2355526.20error.20on.20closure.20but.20not.20on.20.22equiv.22.20fn.html#150922801">(Dec 05 2018 at 12:08)</a>:</h4>
<p>so clearly that would mean <code>_#3r</code> needs to outlive <code>'_#1r</code></p>



<a name="150922810"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2355526%20error%20on%20closure%20but%20not%20on%20%22equiv%22%20fn/near/150922810" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2355526.20error.20on.20closure.20but.20not.20on.20.22equiv.22.20fn.html#150922810">(Dec 05 2018 at 12:09)</a>:</h4>
<p>(this damn hotel room only gives enough for 1 cup of <span class="emoji emoji-2615" title="coffee">:coffee:</span> , but 2 cups of decaf... what's up with that...)</p>



<a name="150922829"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2355526%20error%20on%20closure%20but%20not%20on%20%22equiv%22%20fn/near/150922829" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> pnkfelix <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2355526.20error.20on.20closure.20but.20not.20on.20.22equiv.22.20fn.html#150922829">(Dec 05 2018 at 12:09)</a>:</h4>
<p>but the thing I'm now trying to understand: the Free Region Mapping says that <code>'_#1r</code> is an External region</p>



<a name="150922898"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2355526%20error%20on%20closure%20but%20not%20on%20%22equiv%22%20fn/near/150922898" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> pnkfelix <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2355526.20error.20on.20closure.20but.20not.20on.20.22equiv.22.20fn.html#150922898">(Dec 05 2018 at 12:10)</a>:</h4>
<p>which is meant to denote a region that is defined externally to the closure itself. E.g. if the containing item had a region param <code>'a</code> or some such.</p>



<a name="150922957"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2355526%20error%20on%20closure%20but%20not%20on%20%22equiv%22%20fn/near/150922957" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> pnkfelix <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2355526.20error.20on.20closure.20but.20not.20on.20.22equiv.22.20fn.html#150922957">(Dec 05 2018 at 12:11)</a>:</h4>
<p>I <em>think</em> that the Free Region Mapping is tagging <code>'_#1r</code> as an external region because prior to the remapping, it was initially region-inferred to be <code>ReScope(CallSite(10))</code></p>



<a name="150922974"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2355526%20error%20on%20closure%20but%20not%20on%20%22equiv%22%20fn/near/150922974" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> pnkfelix <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2355526.20error.20on.20closure.20but.20not.20on.20.22equiv.22.20fn.html#150922974">(Dec 05 2018 at 12:11)</a>:</h4>
<p>(I could be wrong about that hypothesis though)</p>



<a name="150923023"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2355526%20error%20on%20closure%20but%20not%20on%20%22equiv%22%20fn/near/150923023" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> pnkfelix <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2355526.20error.20on.20closure.20but.20not.20on.20.22equiv.22.20fn.html#150923023">(Dec 05 2018 at 12:12)</a>:</h4>
<p>In any case, it doesn't seem <em>right</em> to tag the region here as External</p>



<a name="150923055"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2355526%20error%20on%20closure%20but%20not%20on%20%22equiv%22%20fn/near/150923055" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> pnkfelix <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2355526.20error.20on.20closure.20but.20not.20on.20.22equiv.22.20fn.html#150923055">(Dec 05 2018 at 12:13)</a>:</h4>
<p>I think Bill Gates-Foldgers once famously said 8 oz of caffeinated coffee should be enough for anyone.</p>



<a name="150923433"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2355526%20error%20on%20closure%20but%20not%20on%20%22equiv%22%20fn/near/150923433" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> pnkfelix <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2355526.20error.20on.20closure.20but.20not.20on.20.22equiv.22.20fn.html#150923433">(Dec 05 2018 at 12:18)</a>:</h4>
<blockquote>
<p>In any case, it doesn't seem <em>right</em> to tag the region here as External</p>
</blockquote>
<p>at least, not in <em>this</em> instance. There are straight-forward modifications to the closure body where it wouldn't be <em>wrong</em> to have an External region there (e.g. returning a <code>&amp;'static str</code> or similarly sufficiently-long-lived reference)</p>



<a name="150925419"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2355526%20error%20on%20closure%20but%20not%20on%20%22equiv%22%20fn/near/150925419" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2355526.20error.20on.20closure.20but.20not.20on.20.22equiv.22.20fn.html#150925419">(Dec 05 2018 at 12:57)</a>:</h4>
<blockquote>
<p>In any case, it doesn't seem <em>right</em> to tag the region here as External</p>
</blockquote>
<p>I think it is right</p>



<a name="150925425"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2355526%20error%20on%20closure%20but%20not%20on%20%22equiv%22%20fn/near/150925425" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2355526.20error.20on.20closure.20but.20not.20on.20.22equiv.22.20fn.html#150925425">(Dec 05 2018 at 12:58)</a>:</h4>
<p>at least, according to the setup</p>



<a name="150925474"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2355526%20error%20on%20closure%20but%20not%20on%20%22equiv%22%20fn/near/150925474" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2355526.20error.20on.20closure.20but.20not.20on.20.22equiv.22.20fn.html#150925474">(Dec 05 2018 at 12:58)</a>:</h4>
<p>in particular, given that we have no expected type, I think we will infer the types to be type variables</p>



<a name="150925477"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2355526%20error%20on%20closure%20but%20not%20on%20%22equiv%22%20fn/near/150925477" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2355526.20error.20on.20closure.20but.20not.20on.20.22equiv.22.20fn.html#150925477">(Dec 05 2018 at 12:58)</a>:</h4>
<p>but let me review the logic...</p>



<a name="150925490"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2355526%20error%20on%20closure%20but%20not%20on%20%22equiv%22%20fn/near/150925490" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2355526.20error.20on.20closure.20but.20not.20on.20.22equiv.22.20fn.html#150925490">(Dec 05 2018 at 12:58)</a>:</h4>
<p>(and that implies that the region is not late-bound, and therefore it is external)</p>



<a name="150925525"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2355526%20error%20on%20closure%20but%20not%20on%20%22equiv%22%20fn/near/150925525" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2355526.20error.20on.20closure.20but.20not.20on.20.22equiv.22.20fn.html#150925525">(Dec 05 2018 at 12:59)</a>:</h4>
<p>well, we <em>should</em> respect the user given annotations</p>



<a name="150925544"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2355526%20error%20on%20closure%20but%20not%20on%20%22equiv%22%20fn/near/150925544" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> pnkfelix <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2355526.20error.20on.20closure.20but.20not.20on.20.22equiv.22.20fn.html#150925544">(Dec 05 2018 at 12:59)</a>:</h4>
<p>let me rephrase</p>



<a name="150925586"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2355526%20error%20on%20closure%20but%20not%20on%20%22equiv%22%20fn/near/150925586" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> pnkfelix <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2355526.20error.20on.20closure.20but.20not.20on.20.22equiv.22.20fn.html#150925586">(Dec 05 2018 at 13:00)</a>:</h4>
<p>if the region is treated as external</p>



<a name="150925613"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2355526%20error%20on%20closure%20but%20not%20on%20%22equiv%22%20fn/near/150925613" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> pnkfelix <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2355526.20error.20on.20closure.20but.20not.20on.20.22equiv.22.20fn.html#150925613">(Dec 05 2018 at 13:00)</a>:</h4>
<p>then there's no way we can accept the code</p>



<a name="150925616"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2355526%20error%20on%20closure%20but%20not%20on%20%22equiv%22%20fn/near/150925616" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> pnkfelix <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2355526.20error.20on.20closure.20but.20not.20on.20.22equiv.22.20fn.html#150925616">(Dec 05 2018 at 13:00)</a>:</h4>
<p>right?</p>



<a name="150925689"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2355526%20error%20on%20closure%20but%20not%20on%20%22equiv%22%20fn/near/150925689" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> pnkfelix <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2355526.20error.20on.20closure.20but.20not.20on.20.22equiv.22.20fn.html#150925689">(Dec 05 2018 at 13:01)</a>:</h4>
<p>the closure has type <code>for &lt;'_3r&gt; fn(&amp;'_3r str) -&gt; '_#1r str</code>. If <code>'_#1r</code> is external (i.e., if we are assuming that it is some region that is defined by the container), then we cannot generally let <code>'_3r</code> be equated with <code>'_#1r</code>, and therefore we will be forced to reject the code.</p>



<a name="150925715"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2355526%20error%20on%20closure%20but%20not%20on%20%22equiv%22%20fn/near/150925715" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> pnkfelix <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2355526.20error.20on.20closure.20but.20not.20on.20.22equiv.22.20fn.html#150925715">(Dec 05 2018 at 13:02)</a>:</h4>
<p>(which is what we do today.)</p>



<a name="150925788"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2355526%20error%20on%20closure%20but%20not%20on%20%22equiv%22%20fn/near/150925788" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> pnkfelix <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2355526.20error.20on.20closure.20but.20not.20on.20.22equiv.22.20fn.html#150925788">(Dec 05 2018 at 13:03)</a>:</h4>
<p>My claim is that it would be better, if possible, for us to accept the code, by <em>some</em> means. I don't know if the right means would be to provide some way for <code>'_#1r</code> to be unified with <code>_3r</code> above, or if it is to avoid introducing <code>'_#1r</code> in the first place, or some other change.</p>



<a name="150926016"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2355526%20error%20on%20closure%20but%20not%20on%20%22equiv%22%20fn/near/150926016" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> pnkfelix <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2355526.20error.20on.20closure.20but.20not.20on.20.22equiv.22.20fn.html#150926016">(Dec 05 2018 at 13:06)</a>:</h4>
<p>I agree that the return type of the closure is a type variable (not provided by the user). And the compiler manages to figure out that it has type <code>&amp;str</code>. The debug output includes the line </p>
<div class="codehilite"><pre><span></span>DEBUG 2018-12-05T11:34:17Z: rustc_typeck::check::regionck: constrain_regions_in_type_of_node(ty=&amp;&#39;_#0r str, ty0=&amp;&#39;_#0r str, id=HirId { owner: DefIndex(0:3), local_id: 10 }, minimum_lifetime=ReScope(CallSite(10)))
</pre></div>



<a name="150926044"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2355526%20error%20on%20closure%20but%20not%20on%20%22equiv%22%20fn/near/150926044" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> pnkfelix <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2355526.20error.20on.20closure.20but.20not.20on.20.22equiv.22.20fn.html#150926044">(Dec 05 2018 at 13:07)</a>:</h4>
<p>and I infer that that <code>minimum_lifetime=ReScope(CallSite(10))</code> is what causes the compiler to eventually assign the closure the return type <code>&amp;ReScope(CallSite(10)) str</code></p>



<a name="150926094"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2355526%20error%20on%20closure%20but%20not%20on%20%22equiv%22%20fn/near/150926094" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> pnkfelix <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2355526.20error.20on.20closure.20but.20not.20on.20.22equiv.22.20fn.html#150926094">(Dec 05 2018 at 13:08)</a>:</h4>
<p>my claim, however, is that the region <code>ReScope(CallSite(10))</code> is an unusual ReScope</p>



<a name="150926120"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2355526%20error%20on%20closure%20but%20not%20on%20%22equiv%22%20fn/near/150926120" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> pnkfelix <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2355526.20error.20on.20closure.20but.20not.20on.20.22equiv.22.20fn.html#150926120">(Dec 05 2018 at 13:09)</a>:</h4>
<p>in that it is, in my head at least, kind of an <em>existential</em> scope. It just represents some region that is a bit longer than the scope(s) for the closure arguments.</p>



<a name="150926196"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2355526%20error%20on%20closure%20but%20not%20on%20%22equiv%22%20fn/near/150926196" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> pnkfelix <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2355526.20error.20on.20closure.20but.20not.20on.20.22equiv.22.20fn.html#150926196">(Dec 05 2018 at 13:10)</a>:</h4>
<p>to be clear, I meant that it is existential from the viewpoint while we are checking the body of the closure</p>



<a name="150926213"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2355526%20error%20on%20closure%20but%20not%20on%20%22equiv%22%20fn/near/150926213" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> pnkfelix <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2355526.20error.20on.20closure.20but.20not.20on.20.22equiv.22.20fn.html#150926213">(Dec 05 2018 at 13:11)</a>:</h4>
<p>In some ways, I would like it if we could somehow treat such an <code>ReScope(CallSite(10))</code> (assuming <code>10</code> is the ID for the closure we are currently checking) as if it were bound by the <code>for &lt;'r, ...&gt;</code></p>



<a name="150926239"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2355526%20error%20on%20closure%20but%20not%20on%20%22equiv%22%20fn/near/150926239" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> pnkfelix <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2355526.20error.20on.20closure.20but.20not.20on.20.22equiv.22.20fn.html#150926239">(Dec 05 2018 at 13:11)</a>:</h4>
<p>or something where every bound region introduced by that <code>for &lt;..&gt;</code> is known to outlive the <code>ReScope(CallSite(10))</code></p>



<a name="150926406"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2355526%20error%20on%20closure%20but%20not%20on%20%22equiv%22%20fn/near/150926406" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2355526.20error.20on.20closure.20but.20not.20on.20.22equiv.22.20fn.html#150926406">(Dec 05 2018 at 13:14)</a>:</h4>
<blockquote>
<p>my claim, however, is that the region <code>ReScope(CallSite(10))</code> is an unusual ReScope</p>
</blockquote>
<p>I think this is irrelevant</p>



<a name="150926414"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2355526%20error%20on%20closure%20but%20not%20on%20%22equiv%22%20fn/near/150926414" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> pnkfelix <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2355526.20error.20on.20closure.20but.20not.20on.20.22equiv.22.20fn.html#150926414">(Dec 05 2018 at 13:15)</a>:</h4>
<p>Ah okay lets discuss that then</p>



<a name="150926424"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2355526%20error%20on%20closure%20but%20not%20on%20%22equiv%22%20fn/near/150926424" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2355526.20error.20on.20closure.20but.20not.20on.20.22equiv.22.20fn.html#150926424">(Dec 05 2018 at 13:15)</a>:</h4>
<p>this is not to disagree with any of your other claims</p>



<a name="150926434"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2355526%20error%20on%20closure%20but%20not%20on%20%22equiv%22%20fn/near/150926434" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2355526.20error.20on.20closure.20but.20not.20on.20.22equiv.22.20fn.html#150926434">(Dec 05 2018 at 13:15)</a>:</h4>
<p>well let me back up</p>



<a name="150926442"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2355526%20error%20on%20closure%20but%20not%20on%20%22equiv%22%20fn/near/150926442" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2355526.20error.20on.20closure.20but.20not.20on.20.22equiv.22.20fn.html#150926442">(Dec 05 2018 at 13:15)</a>:</h4>
<p>first off, I want to be clear about what code we are talking about</p>



<a name="150926492"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2355526%20error%20on%20closure%20but%20not%20on%20%22equiv%22%20fn/near/150926492" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2355526.20error.20on.20closure.20but.20not.20on.20.22equiv.22.20fn.html#150926492">(Dec 05 2018 at 13:16)</a>:</h4>
<p>is it this example, or another one?</p>



<a name="150926495"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2355526%20error%20on%20closure%20but%20not%20on%20%22equiv%22%20fn/near/150926495" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2355526.20error.20on.20closure.20but.20not.20on.20.22equiv.22.20fn.html#150926495">(Dec 05 2018 at 13:16)</a>:</h4>
<div class="codehilite"><pre><span></span><span class="k">fn</span> <span class="nf">main</span><span class="p">()</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="n">_v_lambda</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">|</span><span class="n">v</span>: <span class="kp">&amp;</span><span class="kt">str</span><span class="o">|</span><span class="w"> </span>-&gt; <span class="kp">&amp;</span><span class="kt">str</span> <span class="p">{</span><span class="w"> </span><span class="n">v</span><span class="w"> </span><span class="p">};</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>
</pre></div>



<a name="150926508"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2355526%20error%20on%20closure%20but%20not%20on%20%22equiv%22%20fn/near/150926508" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2355526.20error.20on.20closure.20but.20not.20on.20.22equiv.22.20fn.html#150926508">(Dec 05 2018 at 13:16)</a>:</h4>
<p>I guess we are most interested in the original example:</p>



<a name="150926509"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2355526%20error%20on%20closure%20but%20not%20on%20%22equiv%22%20fn/near/150926509" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2355526.20error.20on.20closure.20but.20not.20on.20.22equiv.22.20fn.html#150926509">(Dec 05 2018 at 13:16)</a>:</h4>
<div class="codehilite"><pre><span></span><span class="k">fn</span> <span class="nf">main</span><span class="p">()</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="n">_v_lambda</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">|</span><span class="n">v</span>: <span class="kp">&amp;</span><span class="nb">Vec</span><span class="o">&lt;</span><span class="nb">String</span><span class="o">&gt;|</span><span class="w"> </span><span class="n">v</span><span class="p">.</span><span class="n">iter</span><span class="p">().</span><span class="n">chain</span><span class="p">(</span><span class="n">v</span><span class="p">.</span><span class="n">iter</span><span class="p">()).</span><span class="n">collect</span>::<span class="o">&lt;</span><span class="nb">Vec</span><span class="o">&lt;&amp;</span><span class="nb">String</span><span class="o">&gt;&gt;</span><span class="p">();</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>

<span class="k">fn</span> <span class="nf">_v_fn</span><span class="p">(</span><span class="n">v</span>: <span class="kp">&amp;</span><span class="nb">Vec</span><span class="o">&lt;</span><span class="nb">String</span><span class="o">&gt;</span><span class="p">)</span><span class="w"> </span>-&gt; <span class="nb">Vec</span><span class="o">&lt;&amp;</span><span class="nb">String</span><span class="o">&gt;</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="n">v</span><span class="p">.</span><span class="n">iter</span><span class="p">().</span><span class="n">chain</span><span class="p">(</span><span class="n">v</span><span class="p">.</span><span class="n">iter</span><span class="p">()).</span><span class="n">collect</span>::<span class="o">&lt;</span><span class="nb">Vec</span><span class="o">&lt;&amp;</span><span class="nb">String</span><span class="o">&gt;&gt;</span><span class="p">()</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>
</pre></div>



<a name="150926515"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2355526%20error%20on%20closure%20but%20not%20on%20%22equiv%22%20fn/near/150926515" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> pnkfelix <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2355526.20error.20on.20closure.20but.20not.20on.20.22equiv.22.20fn.html#150926515">(Dec 05 2018 at 13:16)</a>:</h4>
<p>okay. My running example is: </p>
<div class="codehilite"><pre><span></span><span class="k">fn</span> <span class="nf">main</span><span class="p">()</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="n">_v_lambda</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">|</span><span class="n">v</span>: <span class="kp">&amp;</span><span class="kt">str</span><span class="o">|</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">v</span><span class="w"> </span><span class="p">};</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>
</pre></div>



<a name="150926528"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2355526%20error%20on%20closure%20but%20not%20on%20%22equiv%22%20fn/near/150926528" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> pnkfelix <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2355526.20error.20on.20closure.20but.20not.20on.20.22equiv.22.20fn.html#150926528">(Dec 05 2018 at 13:17)</a>:</h4>
<p>which is very similar to the reduced case that I posted in a comment</p>



<a name="150926536"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2355526%20error%20on%20closure%20but%20not%20on%20%22equiv%22%20fn/near/150926536" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> pnkfelix <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2355526.20error.20on.20closure.20but.20not.20on.20.22equiv.22.20fn.html#150926536">(Dec 05 2018 at 13:17)</a>:</h4>
<p>I think we should <em>eventually</em> discuss the original example</p>



<a name="150926562"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2355526%20error%20on%20closure%20but%20not%20on%20%22equiv%22%20fn/near/150926562" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2355526.20error.20on.20closure.20but.20not.20on.20.22equiv.22.20fn.html#150926562">(Dec 05 2018 at 13:17)</a>:</h4>
<p>I think for the purposes of this discussion</p>



<a name="150926566"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2355526%20error%20on%20closure%20but%20not%20on%20%22equiv%22%20fn/near/150926566" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2355526.20error.20on.20closure.20but.20not.20on.20.22equiv.22.20fn.html#150926566">(Dec 05 2018 at 13:17)</a>:</h4>
<p>your reduced example is probably equivalent</p>



<a name="150926610"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2355526%20error%20on%20closure%20but%20not%20on%20%22equiv%22%20fn/near/150926610" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2355526.20error.20on.20closure.20but.20not.20on.20.22equiv.22.20fn.html#150926610">(Dec 05 2018 at 13:18)</a>:</h4>
<p>key point is: it has no return type annotation</p>



<a name="150926613"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2355526%20error%20on%20closure%20but%20not%20on%20%22equiv%22%20fn/near/150926613" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> pnkfelix <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2355526.20error.20on.20closure.20but.20not.20on.20.22equiv.22.20fn.html#150926613">(Dec 05 2018 at 13:18)</a>:</h4>
<p>but in the interest of keeping the example minimal, I would like to focus on either <code>|v: &amp;str| -&gt; &amp;str { v }</code> or <code>|v: &amp;str| { v }</code></p>



<a name="150926621"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2355526%20error%20on%20closure%20but%20not%20on%20%22equiv%22%20fn/near/150926621" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> pnkfelix <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2355526.20error.20on.20closure.20but.20not.20on.20.22equiv.22.20fn.html#150926621">(Dec 05 2018 at 13:18)</a>:</h4>
<p>right. Lets assume no return type annotation.</p>



<a name="150926625"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2355526%20error%20on%20closure%20but%20not%20on%20%22equiv%22%20fn/near/150926625" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2355526.20error.20on.20closure.20but.20not.20on.20.22equiv.22.20fn.html#150926625">(Dec 05 2018 at 13:18)</a>:</h4>
<p>it's a bit strange to me that the former doesn't work</p>



<a name="150926632"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2355526%20error%20on%20closure%20but%20not%20on%20%22equiv%22%20fn/near/150926632" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2355526.20error.20on.20closure.20but.20not.20on.20.22equiv.22.20fn.html#150926632">(Dec 05 2018 at 13:18)</a>:</h4>
<p>but the only reason I expect it to work is by leaning on the return type annot</p>



<a name="150926635"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2355526%20error%20on%20closure%20but%20not%20on%20%22equiv%22%20fn/near/150926635" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> pnkfelix <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2355526.20error.20on.20closure.20but.20not.20on.20.22equiv.22.20fn.html#150926635">(Dec 05 2018 at 13:18)</a>:</h4>
<p>neither works. They both infer <code>&amp;str</code></p>



<a name="150926638"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2355526%20error%20on%20closure%20but%20not%20on%20%22equiv%22%20fn/near/150926638" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2355526.20error.20on.20closure.20but.20not.20on.20.22equiv.22.20fn.html#150926638">(Dec 05 2018 at 13:18)</a>:</h4>
<p>it might be worth investigating why that doesn't happen but sort of neither here nor there</p>



<a name="150926652"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2355526%20error%20on%20closure%20but%20not%20on%20%22equiv%22%20fn/near/150926652" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> pnkfelix <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2355526.20error.20on.20closure.20but.20not.20on.20.22equiv.22.20fn.html#150926652">(Dec 05 2018 at 13:19)</a>:</h4>
<p>but they have no information to use for the region</p>



<a name="150926669"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2355526%20error%20on%20closure%20but%20not%20on%20%22equiv%22%20fn/near/150926669" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2355526.20error.20on.20closure.20but.20not.20on.20.22equiv.22.20fn.html#150926669">(Dec 05 2018 at 13:19)</a>:</h4>
<p>I think the flaw with the first one, perhaps, is that for some reason it is not using lifetime elision rules</p>



<a name="150926676"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2355526%20error%20on%20closure%20but%20not%20on%20%22equiv%22%20fn/near/150926676" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> pnkfelix <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2355526.20error.20on.20closure.20but.20not.20on.20.22equiv.22.20fn.html#150926676">(Dec 05 2018 at 13:19)</a>:</h4>
<p>and so regionck plugs in <code>ReScope(CallSite(10))</code>, which is subsequently replaced with <code>_#1</code> in defining_ty</p>



<a name="150926681"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2355526%20error%20on%20closure%20but%20not%20on%20%22equiv%22%20fn/near/150926681" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2355526.20error.20on.20closure.20but.20not.20on.20.22equiv.22.20fn.html#150926681">(Dec 05 2018 at 13:19)</a>:</h4>
<p>right</p>



<a name="150926689"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2355526%20error%20on%20closure%20but%20not%20on%20%22equiv%22%20fn/near/150926689" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2355526.20error.20on.20closure.20but.20not.20on.20.22equiv.22.20fn.html#150926689">(Dec 05 2018 at 13:19)</a>:</h4>
<p>so the question is, how would we fix it?</p>



<a name="150926738"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2355526%20error%20on%20closure%20but%20not%20on%20%22equiv%22%20fn/near/150926738" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> pnkfelix <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2355526.20error.20on.20closure.20but.20not.20on.20.22equiv.22.20fn.html#150926738">(Dec 05 2018 at 13:20)</a>:</h4>
<p>I wholeheartedly agree that we should explore whether the lifetime elision rules are supposed to be applied in the former case.</p>



<a name="150926740"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2355526%20error%20on%20closure%20but%20not%20on%20%22equiv%22%20fn/near/150926740" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2355526.20error.20on.20closure.20but.20not.20on.20.22equiv.22.20fn.html#150926740">(Dec 05 2018 at 13:20)</a>:</h4>
<p>the reason that I said that <code>ReScope</code> was "irrelevant" is that those regions are erased</p>



<a name="150926746"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2355526%20error%20on%20closure%20but%20not%20on%20%22equiv%22%20fn/near/150926746" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2355526.20error.20on.20closure.20but.20not.20on.20.22equiv.22.20fn.html#150926746">(Dec 05 2018 at 13:20)</a>:</h4>
<p>but it's not <em>totally</em> irrelevant</p>



<a name="150926747"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2355526%20error%20on%20closure%20but%20not%20on%20%22equiv%22%20fn/near/150926747" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> pnkfelix <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2355526.20error.20on.20closure.20but.20not.20on.20.22equiv.22.20fn.html#150926747">(Dec 05 2018 at 13:20)</a>:</h4>
<p>(but again, we don't need to immediately explore that Q)</p>



<a name="150926756"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2355526%20error%20on%20closure%20but%20not%20on%20%22equiv%22%20fn/near/150926756" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2355526.20error.20on.20closure.20but.20not.20on.20.22equiv.22.20fn.html#150926756">(Dec 05 2018 at 13:20)</a>:</h4>
<blockquote>
<p>I wholeheartedly agree that we should explore whether the lifetime elision rules are supposed to be applied in the former case.</p>
</blockquote>
<p>I think they should be, it's prob a bug I introduced when I reworked this stuff the last time</p>



<a name="150926764"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2355526%20error%20on%20closure%20but%20not%20on%20%22equiv%22%20fn/near/150926764" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2355526.20error.20on.20closure.20but.20not.20on.20.22equiv.22.20fn.html#150926764">(Dec 05 2018 at 13:20)</a>:</h4>
<p>but yeah separate problem</p>



<a name="150926771"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2355526%20error%20on%20closure%20but%20not%20on%20%22equiv%22%20fn/near/150926771" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2355526.20error.20on.20closure.20but.20not.20on.20.22equiv.22.20fn.html#150926771">(Dec 05 2018 at 13:20)</a>:</h4>
<p>right now, typeck has the job of determining bound vs free and that's it</p>



<a name="150926773"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2355526%20error%20on%20closure%20but%20not%20on%20%22equiv%22%20fn/near/150926773" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> pnkfelix <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2355526.20error.20on.20closure.20but.20not.20on.20.22equiv.22.20fn.html#150926773">(Dec 05 2018 at 13:20)</a>:</h4>
<p>Yes, they are erased. But that erasing process plugs in an external-tagged region varaible <code>'_#1r</code></p>



<a name="150926782"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2355526%20error%20on%20closure%20but%20not%20on%20%22equiv%22%20fn/near/150926782" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2355526.20error.20on.20closure.20but.20not.20on.20.22equiv.22.20fn.html#150926782">(Dec 05 2018 at 13:21)</a>:</h4>
<p>and I think according to that scheme, NLL is giving a "proper" error here</p>



<a name="150926790"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2355526%20error%20on%20closure%20but%20not%20on%20%22equiv%22%20fn/near/150926790" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2355526.20error.20on.20closure.20but.20not.20on.20.22equiv.22.20fn.html#150926790">(Dec 05 2018 at 13:21)</a>:</h4>
<p>so I could see two routes to fix this:</p>



<a name="150926798"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2355526%20error%20on%20closure%20but%20not%20on%20%22equiv%22%20fn/near/150926798" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2355526.20error.20on.20closure.20but.20not.20on.20.22equiv.22.20fn.html#150926798">(Dec 05 2018 at 13:21)</a>:</h4>
<ul>
<li>modify typeck to infer a different result</li>
</ul>



<a name="150926807"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2355526%20error%20on%20closure%20but%20not%20on%20%22equiv%22%20fn/near/150926807" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2355526.20error.20on.20closure.20but.20not.20on.20.22equiv.22.20fn.html#150926807">(Dec 05 2018 at 13:21)</a>:</h4>
<ul>
<li>give NLL the job of inferring bound vs free too (possibly informed by typeck to some degree)</li>
</ul>



<a name="150926814"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2355526%20error%20on%20closure%20but%20not%20on%20%22equiv%22%20fn/near/150926814" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2355526.20error.20on.20closure.20but.20not.20on.20.22equiv.22.20fn.html#150926814">(Dec 05 2018 at 13:21)</a>:</h4>
<p>the latter is what I always hoped we'd find a way to do</p>



<a name="150926818"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2355526%20error%20on%20closure%20but%20not%20on%20%22equiv%22%20fn/near/150926818" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2355526.20error.20on.20closure.20but.20not.20on.20.22equiv.22.20fn.html#150926818">(Dec 05 2018 at 13:21)</a>:</h4>
<p>but I also hoped not to think about it yet :)</p>



<a name="150926821"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2355526%20error%20on%20closure%20but%20not%20on%20%22equiv%22%20fn/near/150926821" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2355526.20error.20on.20closure.20but.20not.20on.20.22equiv.22.20fn.html#150926821">(Dec 05 2018 at 13:21)</a>:</h4>
<blockquote>
<p>Yes, they are erased. But that erasing process plugs in an external-tagged region varaible <code>'_#1r</code></p>
</blockquote>
<p>right, and correctly so (I claim)</p>



<a name="150926867"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2355526%20error%20on%20closure%20but%20not%20on%20%22equiv%22%20fn/near/150926867" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> pnkfelix <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2355526.20error.20on.20closure.20but.20not.20on.20.22equiv.22.20fn.html#150926867">(Dec 05 2018 at 13:22)</a>:</h4>
<p>See that brings us back to my Q about CallSite's nature</p>



<a name="150926880"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2355526%20error%20on%20closure%20but%20not%20on%20%22equiv%22%20fn/near/150926880" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> pnkfelix <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2355526.20error.20on.20closure.20but.20not.20on.20.22equiv.22.20fn.html#150926880">(Dec 05 2018 at 13:22)</a>:</h4>
<p>If the ReScope were describing a region statically defined by the containing item</p>



<a name="150926886"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2355526%20error%20on%20closure%20but%20not%20on%20%22equiv%22%20fn/near/150926886" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> pnkfelix <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2355526.20error.20on.20closure.20but.20not.20on.20.22equiv.22.20fn.html#150926886">(Dec 05 2018 at 13:22)</a>:</h4>
<p>then I would agree that external would make sense</p>



<a name="150926902"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2355526%20error%20on%20closure%20but%20not%20on%20%22equiv%22%20fn/near/150926902" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2355526.20error.20on.20closure.20but.20not.20on.20.22equiv.22.20fn.html#150926902">(Dec 05 2018 at 13:22)</a>:</h4>
<p>I don't think NLL should consider rescope at all</p>



<a name="150926905"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2355526%20error%20on%20closure%20but%20not%20on%20%22equiv%22%20fn/near/150926905" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2355526.20error.20on.20closure.20but.20not.20on.20.22equiv.22.20fn.html#150926905">(Dec 05 2018 at 13:23)</a>:</h4>
<p>as something special</p>



<a name="150926913"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2355526%20error%20on%20closure%20but%20not%20on%20%22equiv%22%20fn/near/150926913" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2355526.20error.20on.20closure.20but.20not.20on.20.22equiv.22.20fn.html#150926913">(Dec 05 2018 at 13:23)</a>:</h4>
<p>one could imagine though</p>



<a name="150926916"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2355526%20error%20on%20closure%20but%20not%20on%20%22equiv%22%20fn/near/150926916" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> pnkfelix <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2355526.20error.20on.20closure.20but.20not.20on.20.22equiv.22.20fn.html#150926916">(Dec 05 2018 at 13:23)</a>:</h4>
<p>but that's not how I interpret the <code>ReScope</code> being used here. Its not an <code>ReScope</code> that is meaningful to the container; it is an ReScope that is meaningful to teh closure body alone</p>



<a name="150926923"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2355526%20error%20on%20closure%20but%20not%20on%20%22equiv%22%20fn/near/150926923" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2355526.20error.20on.20closure.20but.20not.20on.20.22equiv.22.20fn.html#150926923">(Dec 05 2018 at 13:23)</a>:</h4>
<p><em>typeck</em> concluding that a smaller scope can lead to a bound region</p>



<a name="150926933"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2355526%20error%20on%20closure%20but%20not%20on%20%22equiv%22%20fn/near/150926933" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2355526.20error.20on.20closure.20but.20not.20on.20.22equiv.22.20fn.html#150926933">(Dec 05 2018 at 13:23)</a>:</h4>
<p>but this .. I don't like it, doesn't feel like it's moving in the right direction</p>



<a name="150926942"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2355526%20error%20on%20closure%20but%20not%20on%20%22equiv%22%20fn/near/150926942" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2355526.20error.20on.20closure.20but.20not.20on.20.22equiv.22.20fn.html#150926942">(Dec 05 2018 at 13:23)</a>:</h4>
<p>since it still requires typeck to have complete constraints</p>



<a name="150926946"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2355526%20error%20on%20closure%20but%20not%20on%20%22equiv%22%20fn/near/150926946" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> pnkfelix <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2355526.20error.20on.20closure.20but.20not.20on.20.22equiv.22.20fn.html#150926946">(Dec 05 2018 at 13:23)</a>:</h4>
<p>I agree that it doesn't feel right to have NLL inspect the ReScope</p>



<a name="150926988"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2355526%20error%20on%20closure%20but%20not%20on%20%22equiv%22%20fn/near/150926988" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> pnkfelix <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2355526.20error.20on.20closure.20but.20not.20on.20.22equiv.22.20fn.html#150926988">(Dec 05 2018 at 13:24)</a>:</h4>
<p>in terms of the mechanics of it</p>



<a name="150926997"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2355526%20error%20on%20closure%20but%20not%20on%20%22equiv%22%20fn/near/150926997" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> pnkfelix <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2355526.20error.20on.20closure.20but.20not.20on.20.22equiv.22.20fn.html#150926997">(Dec 05 2018 at 13:24)</a>:</h4>
<p>but in terms of the abstract semantics</p>



<a name="150927015"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2355526%20error%20on%20closure%20but%20not%20on%20%22equiv%22%20fn/near/150927015" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> pnkfelix <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2355526.20error.20on.20closure.20but.20not.20on.20.22equiv.22.20fn.html#150927015">(Dec 05 2018 at 13:24)</a>:</h4>
<p>it just seems to me like the enum variant <code>ReScope</code> is being used to mean "this is a scope that had meaning within the container"</p>



<a name="150927036"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2355526%20error%20on%20closure%20but%20not%20on%20%22equiv%22%20fn/near/150927036" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2355526.20error.20on.20closure.20but.20not.20on.20.22equiv.22.20fn.html#150927036">(Dec 05 2018 at 13:25)</a>:</h4>
<p>note that if the closure were actually invoked</p>



<a name="150927039"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2355526%20error%20on%20closure%20but%20not%20on%20%22equiv%22%20fn/near/150927039" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> pnkfelix <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2355526.20error.20on.20closure.20but.20not.20on.20.22equiv.22.20fn.html#150927039">(Dec 05 2018 at 13:25)</a>:</h4>
<p>and that doesn't match my understanding of what it means in this case</p>



<a name="150927040"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2355526%20error%20on%20closure%20but%20not%20on%20%22equiv%22%20fn/near/150927040" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2355526.20error.20on.20closure.20but.20not.20on.20.22equiv.22.20fn.html#150927040">(Dec 05 2018 at 13:25)</a>:</h4>
<p>I think you would no longer get that result</p>



<a name="150927051"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2355526%20error%20on%20closure%20but%20not%20on%20%22equiv%22%20fn/near/150927051" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> pnkfelix <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2355526.20error.20on.20closure.20but.20not.20on.20.22equiv.22.20fn.html#150927051">(Dec 05 2018 at 13:25)</a>:</h4>
<p>I agree with that</p>



<a name="150927068"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2355526%20error%20on%20closure%20but%20not%20on%20%22equiv%22%20fn/near/150927068" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2355526.20error.20on.20closure.20but.20not.20on.20.22equiv.22.20fn.html#150927068">(Dec 05 2018 at 13:25)</a>:</h4>
<p>it's basically just a bug of AST borrowck imo</p>



<a name="150927077"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2355526%20error%20on%20closure%20but%20not%20on%20%22equiv%22%20fn/near/150927077" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> pnkfelix <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2355526.20error.20on.20closure.20but.20not.20on.20.22equiv.22.20fn.html#150927077">(Dec 05 2018 at 13:25)</a>:</h4>
<p>you get totally different results when you try to invoke the closure. Both AST-borrowck and NLL start rejecting the code then</p>



<a name="150927147"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2355526%20error%20on%20closure%20but%20not%20on%20%22equiv%22%20fn/near/150927147" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2355526.20error.20on.20closure.20but.20not.20on.20.22equiv.22.20fn.html#150927147">(Dec 05 2018 at 13:26)</a>:</h4>
<p>(though it's perhaps debatable; depends I suppose on the specifics of how we lower things)</p>



<a name="150927171"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2355526%20error%20on%20closure%20but%20not%20on%20%22equiv%22%20fn/near/150927171" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2355526.20error.20on.20closure.20but.20not.20on.20.22equiv.22.20fn.html#150927171">(Dec 05 2018 at 13:27)</a>:</h4>
<p>so, if we wanted to fix this failure of our inference</p>



<a name="150927179"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2355526%20error%20on%20closure%20but%20not%20on%20%22equiv%22%20fn/near/150927179" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2355526.20error.20on.20closure.20but.20not.20on.20.22equiv.22.20fn.html#150927179">(Dec 05 2018 at 13:27)</a>:</h4>
<p>we're basically talking about adding a kind of "generalization" step</p>



<a name="150927184"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2355526%20error%20on%20closure%20but%20not%20on%20%22equiv%22%20fn/near/150927184" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> pnkfelix <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2355526.20error.20on.20closure.20but.20not.20on.20.22equiv.22.20fn.html#150927184">(Dec 05 2018 at 13:27)</a>:</h4>
<p>the tail comments on <a href="https://github.com/rust-lang/rust/issues/55526" target="_blank" title="https://github.com/rust-lang/rust/issues/55526">#55526</a> have some back-and-forth between me and the issue filer where I was trying to find out whether they were starting from a code base where they were defining a closure and successfully calling it.</p>



<a name="150927199"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2355526%20error%20on%20closure%20but%20not%20on%20%22equiv%22%20fn/near/150927199" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2355526.20error.20on.20closure.20but.20not.20on.20.22equiv.22.20fn.html#150927199">(Dec 05 2018 at 13:27)</a>:</h4>
<p>(did you figure that out?)</p>



<a name="150927252"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2355526%20error%20on%20closure%20but%20not%20on%20%22equiv%22%20fn/near/150927252" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> pnkfelix <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2355526.20error.20on.20closure.20but.20not.20on.20.22equiv.22.20fn.html#150927252">(Dec 05 2018 at 13:28)</a>:</h4>
<p>(and AFAICT, they do not have such an example. The path they took to this bug was that they were not happy with the signature on a locally defined fn and so they tried replacing it with a closure.)</p>



<a name="150927258"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2355526%20error%20on%20closure%20but%20not%20on%20%22equiv%22%20fn/near/150927258" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> pnkfelix <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2355526.20error.20on.20closure.20but.20not.20on.20.22equiv.22.20fn.html#150927258">(Dec 05 2018 at 13:28)</a>:</h4>
<p>and then they were surprised to see the closure get rejected.</p>



<a name="150927296"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2355526%20error%20on%20closure%20but%20not%20on%20%22equiv%22%20fn/near/150927296" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> pnkfelix <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2355526.20error.20on.20closure.20but.20not.20on.20.22equiv.22.20fn.html#150927296">(Dec 05 2018 at 13:28)</a>:</h4>
<p>But I haven't gotten final confirmation on that version of the events</p>



<a name="150927324"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2355526%20error%20on%20closure%20but%20not%20on%20%22equiv%22%20fn/near/150927324" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2355526.20error.20on.20closure.20but.20not.20on.20.22equiv.22.20fn.html#150927324">(Dec 05 2018 at 13:29)</a>:</h4>
<p>ok</p>



<a name="150927329"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2355526%20error%20on%20closure%20but%20not%20on%20%22equiv%22%20fn/near/150927329" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> pnkfelix <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2355526.20error.20on.20closure.20but.20not.20on.20.22equiv.22.20fn.html#150927329">(Dec 05 2018 at 13:29)</a>:</h4>
<p>So</p>



<a name="150927336"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2355526%20error%20on%20closure%20but%20not%20on%20%22equiv%22%20fn/near/150927336" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> pnkfelix <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2355526.20error.20on.20closure.20but.20not.20on.20.22equiv.22.20fn.html#150927336">(Dec 05 2018 at 13:29)</a>:</h4>
<p>in terms of potential fixes</p>



<a name="150927339"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2355526%20error%20on%20closure%20but%20not%20on%20%22equiv%22%20fn/near/150927339" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> pnkfelix <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2355526.20error.20on.20closure.20but.20not.20on.20.22equiv.22.20fn.html#150927339">(Dec 05 2018 at 13:29)</a>:</h4>
<p>there are two very different paths I could imagine</p>



<a name="150927344"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2355526%20error%20on%20closure%20but%20not%20on%20%22equiv%22%20fn/near/150927344" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2355526.20error.20on.20closure.20but.20not.20on.20.22equiv.22.20fn.html#150927344">(Dec 05 2018 at 13:30)</a>:</h4>
<p>that's somewhat relevant in that it suggests we can be more liesurely about things</p>



<a name="150927396"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2355526%20error%20on%20closure%20but%20not%20on%20%22equiv%22%20fn/near/150927396" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2355526.20error.20on.20closure.20but.20not.20on.20.22equiv.22.20fn.html#150927396">(Dec 05 2018 at 13:30)</a>:</h4>
<p>and potentially aim to fix things "the right way"</p>



<a name="150927406"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2355526%20error%20on%20closure%20but%20not%20on%20%22equiv%22%20fn/near/150927406" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2355526.20error.20on.20closure.20but.20not.20on.20.22equiv.22.20fn.html#150927406">(Dec 05 2018 at 13:30)</a>:</h4>
<p>whatever we decide that is</p>



<a name="150927409"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2355526%20error%20on%20closure%20but%20not%20on%20%22equiv%22%20fn/near/150927409" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> pnkfelix <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2355526.20error.20on.20closure.20but.20not.20on.20.22equiv.22.20fn.html#150927409">(Dec 05 2018 at 13:30)</a>:</h4>
<p>one path would be focused on <em>just</em> trying to make us accept the code where the closure is not called</p>



<a name="150927421"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2355526%20error%20on%20closure%20but%20not%20on%20%22equiv%22%20fn/near/150927421" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2355526.20error.20on.20closure.20but.20not.20on.20.22equiv.22.20fn.html#150927421">(Dec 05 2018 at 13:30)</a>:</h4>
<p>sounds not good :)</p>



<a name="150927426"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2355526%20error%20on%20closure%20but%20not%20on%20%22equiv%22%20fn/near/150927426" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> pnkfelix <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2355526.20error.20on.20closure.20but.20not.20on.20.22equiv.22.20fn.html#150927426">(Dec 05 2018 at 13:30)</a>:</h4>
<p>right, I only mention it</p>



<a name="150927432"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2355526%20error%20on%20closure%20but%20not%20on%20%22equiv%22%20fn/near/150927432" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> pnkfelix <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2355526.20error.20on.20closure.20but.20not.20on.20.22equiv.22.20fn.html#150927432">(Dec 05 2018 at 13:30)</a>:</h4>
<p>because, well</p>



<a name="150927437"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2355526%20error%20on%20closure%20but%20not%20on%20%22equiv%22%20fn/near/150927437" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> pnkfelix <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2355526.20error.20on.20closure.20but.20not.20on.20.22equiv.22.20fn.html#150927437">(Dec 05 2018 at 13:30)</a>:</h4>
<p>I was wondering why, when a closure isn't called here</p>



<a name="150927443"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2355526%20error%20on%20closure%20but%20not%20on%20%22equiv%22%20fn/near/150927443" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> pnkfelix <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2355526.20error.20on.20closure.20but.20not.20on.20.22equiv.22.20fn.html#150927443">(Dec 05 2018 at 13:30)</a>:</h4>
<p>why we don't infer that the return type has <code>&amp;'ReEmpty str</code></p>



<a name="150927456"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2355526%20error%20on%20closure%20but%20not%20on%20%22equiv%22%20fn/near/150927456" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> pnkfelix <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2355526.20error.20on.20closure.20but.20not.20on.20.22equiv.22.20fn.html#150927456">(Dec 05 2018 at 13:31)</a>:</h4>
<p>since no one ever tries to read from it</p>



<a name="150927471"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2355526%20error%20on%20closure%20but%20not%20on%20%22equiv%22%20fn/near/150927471" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2355526.20error.20on.20closure.20but.20not.20on.20.22equiv.22.20fn.html#150927471">(Dec 05 2018 at 13:31)</a>:</h4>
<p>well we have a constraint from the closure body</p>



<a name="150927476"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2355526%20error%20on%20closure%20but%20not%20on%20%22equiv%22%20fn/near/150927476" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2355526.20error.20on.20closure.20but.20not.20on.20.22equiv.22.20fn.html#150927476">(Dec 05 2018 at 13:31)</a>:</h4>
<p>(in lexical inference)</p>



<a name="150927487"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2355526%20error%20on%20closure%20but%20not%20on%20%22equiv%22%20fn/near/150927487" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2355526.20error.20on.20closure.20but.20not.20on.20.22equiv.22.20fn.html#150927487">(Dec 05 2018 at 13:31)</a>:</h4>
<p>that the return type must be in scope where the return occurs</p>



<a name="150927490"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2355526%20error%20on%20closure%20but%20not%20on%20%22equiv%22%20fn/near/150927490" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2355526.20error.20on.20closure.20but.20not.20on.20.22equiv.22.20fn.html#150927490">(Dec 05 2018 at 13:31)</a>:</h4>
<p>something like that</p>



<a name="150927491"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2355526%20error%20on%20closure%20but%20not%20on%20%22equiv%22%20fn/near/150927491" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> pnkfelix <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2355526.20error.20on.20closure.20but.20not.20on.20.22equiv.22.20fn.html#150927491">(Dec 05 2018 at 13:31)</a>:</h4>
<p>(and then the <code>for &lt;'r&gt; fn(v: &amp;'r str) -&gt; &amp;ReEmpty str { v }</code> would pass, I assume, since `'r  outlives ReEmpty)</p>



<a name="150927497"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2355526%20error%20on%20closure%20but%20not%20on%20%22equiv%22%20fn/near/150927497" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> pnkfelix <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2355526.20error.20on.20closure.20but.20not.20on.20.22equiv.22.20fn.html#150927497">(Dec 05 2018 at 13:31)</a>:</h4>
<p>ah okya</p>



<a name="150927498"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2355526%20error%20on%20closure%20but%20not%20on%20%22equiv%22%20fn/near/150927498" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2355526.20error.20on.20closure.20but.20not.20on.20.22equiv.22.20fn.html#150927498">(Dec 05 2018 at 13:31)</a>:</h4>
<p>I think we actually require that the return type outlives the fn body</p>



<a name="150927502"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2355526%20error%20on%20closure%20but%20not%20on%20%22equiv%22%20fn/near/150927502" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2355526.20error.20on.20closure.20but.20not.20on.20.22equiv.22.20fn.html#150927502">(Dec 05 2018 at 13:31)</a>:</h4>
<p>I think you added that, even</p>



<a name="150927504"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2355526%20error%20on%20closure%20but%20not%20on%20%22equiv%22%20fn/near/150927504" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> pnkfelix <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2355526.20error.20on.20closure.20but.20not.20on.20.22equiv.22.20fn.html#150927504">(Dec 05 2018 at 13:31)</a>:</h4>
<p>Never mind that then. :)</p>



<a name="150927505"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2355526%20error%20on%20closure%20but%20not%20on%20%22equiv%22%20fn/near/150927505" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2355526.20error.20on.20closure.20but.20not.20on.20.22equiv.22.20fn.html#150927505">(Dec 05 2018 at 13:31)</a>:</h4>
<p>some time ago</p>



<a name="150927556"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2355526%20error%20on%20closure%20but%20not%20on%20%22equiv%22%20fn/near/150927556" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> pnkfelix <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2355526.20error.20on.20closure.20but.20not.20on.20.22equiv.22.20fn.html#150927556">(Dec 05 2018 at 13:32)</a>:</h4>
<p>It was a shower thought.</p>



<a name="150927561"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2355526%20error%20on%20closure%20but%20not%20on%20%22equiv%22%20fn/near/150927561" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2355526.20error.20on.20closure.20but.20not.20on.20.22equiv.22.20fn.html#150927561">(Dec 05 2018 at 13:32)</a>:</h4>
<p>in my ideal world</p>



<a name="150927564"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2355526%20error%20on%20closure%20but%20not%20on%20%22equiv%22%20fn/near/150927564" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> pnkfelix <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2355526.20error.20on.20closure.20but.20not.20on.20.22equiv.22.20fn.html#150927564">(Dec 05 2018 at 13:32)</a>:</h4>
<p>A hypothetical "quick, minimal, ill-thought out fix"</p>



<a name="150927572"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2355526%20error%20on%20closure%20but%20not%20on%20%22equiv%22%20fn/near/150927572" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2355526.20error.20on.20closure.20but.20not.20on.20.22equiv.22.20fn.html#150927572">(Dec 05 2018 at 13:32)</a>:</h4>
<p>we would have NLL borrowck take charge of inferring the binding sites for the regions</p>



<a name="150927575"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2355526%20error%20on%20closure%20but%20not%20on%20%22equiv%22%20fn/near/150927575" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2355526.20error.20on.20closure.20but.20not.20on.20.22equiv.22.20fn.html#150927575">(Dec 05 2018 at 13:32)</a>:</h4>
<p>but I'm not sure how feasible that is</p>



<a name="150927590"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2355526%20error%20on%20closure%20but%20not%20on%20%22equiv%22%20fn/near/150927590" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2355526.20error.20on.20closure.20but.20not.20on.20.22equiv.22.20fn.html#150927590">(Dec 05 2018 at 13:33)</a>:</h4>
<p>it depends at minimum on my universes PR landing</p>



<a name="150927606"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2355526%20error%20on%20closure%20but%20not%20on%20%22equiv%22%20fn/near/150927606" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2355526.20error.20on.20closure.20but.20not.20on.20.22equiv.22.20fn.html#150927606">(Dec 05 2018 at 13:33)</a>:</h4>
<p>we need to be able to solve traits, in particular, without knowing the answer</p>



<a name="150927609"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2355526%20error%20on%20closure%20but%20not%20on%20%22equiv%22%20fn/near/150927609" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> pnkfelix <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2355526.20error.20on.20closure.20but.20not.20on.20.22equiv.22.20fn.html#150927609">(Dec 05 2018 at 13:33)</a>:</h4>
<p>Here's another Q I have, before we get into long term solutions</p>



<a name="150927616"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2355526%20error%20on%20closure%20but%20not%20on%20%22equiv%22%20fn/near/150927616" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2355526.20error.20on.20closure.20but.20not.20on.20.22equiv.22.20fn.html#150927616">(Dec 05 2018 at 13:33)</a>:</h4>
<p>go for it</p>



<a name="150927628"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2355526%20error%20on%20closure%20but%20not%20on%20%22equiv%22%20fn/near/150927628" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> pnkfelix <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2355526.20error.20on.20closure.20but.20not.20on.20.22equiv.22.20fn.html#150927628">(Dec 05 2018 at 13:33)</a>:</h4>
<p>given that the closure's return type is inferred to be <code>&amp;'ReScope(CallSite(10)) str</code></p>



<a name="150927634"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2355526%20error%20on%20closure%20but%20not%20on%20%22equiv%22%20fn/near/150927634" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> pnkfelix <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2355526.20error.20on.20closure.20but.20not.20on.20.22equiv.22.20fn.html#150927634">(Dec 05 2018 at 13:33)</a>:</h4>
<p>why is AST-borrowck accepting the body?</p>



<a name="150927676"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2355526%20error%20on%20closure%20but%20not%20on%20%22equiv%22%20fn/near/150927676" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> pnkfelix <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2355526.20error.20on.20closure.20but.20not.20on.20.22equiv.22.20fn.html#150927676">(Dec 05 2018 at 13:34)</a>:</h4>
<p>oh</p>



<a name="150927685"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2355526%20error%20on%20closure%20but%20not%20on%20%22equiv%22%20fn/near/150927685" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> pnkfelix <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2355526.20error.20on.20closure.20but.20not.20on.20.22equiv.22.20fn.html#150927685">(Dec 05 2018 at 13:34)</a>:</h4>
<p>wait that's a silly question. beucase the argument outlives CallSite(10)</p>



<a name="150927686"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2355526%20error%20on%20closure%20but%20not%20on%20%22equiv%22%20fn/near/150927686" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2355526.20error.20on.20closure.20but.20not.20on.20.22equiv.22.20fn.html#150927686">(Dec 05 2018 at 13:34)</a>:</h4>
<p>it's because of a quirk of the definition of the WF relation for clsoures</p>



<a name="150927690"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2355526%20error%20on%20closure%20but%20not%20on%20%22equiv%22%20fn/near/150927690" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2355526.20error.20on.20closure.20but.20not.20on.20.22equiv.22.20fn.html#150927690">(Dec 05 2018 at 13:34)</a>:</h4>
<p>also</p>



<a name="150927700"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2355526%20error%20on%20closure%20but%20not%20on%20%22equiv%22%20fn/near/150927700" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2355526.20error.20on.20closure.20but.20not.20on.20.22equiv.22.20fn.html#150927700">(Dec 05 2018 at 13:34)</a>:</h4>
<p>which is debatably a bug</p>



<a name="150927712"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2355526%20error%20on%20closure%20but%20not%20on%20%22equiv%22%20fn/near/150927712" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> pnkfelix <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2355526.20error.20on.20closure.20but.20not.20on.20.22equiv.22.20fn.html#150927712">(Dec 05 2018 at 13:34)</a>:</h4>
<p>hmm can you say more about this quirk?</p>



<a name="150927744"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2355526%20error%20on%20closure%20but%20not%20on%20%22equiv%22%20fn/near/150927744" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2355526.20error.20on.20closure.20but.20not.20on.20.22equiv.22.20fn.html#150927744">(Dec 05 2018 at 13:35)</a>:</h4>
<p>note that this PR of mine <a href="https://github.com/rust-lang/rust/pull/55988" target="_blank" title="https://github.com/rust-lang/rust/pull/55988">https://github.com/rust-lang/rust/pull/55988</a> would make the ast borrowck reject just like NLL</p>



<a name="150927754"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2355526%20error%20on%20closure%20but%20not%20on%20%22equiv%22%20fn/near/150927754" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2355526.20error.20on.20closure.20but.20not.20on.20.22equiv.22.20fn.html#150927754">(Dec 05 2018 at 13:35)</a>:</h4>
<blockquote>
<p>hmm can you say more about this quirk?</p>
</blockquote>
<p>why yes I can</p>



<a name="150927833"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2355526%20error%20on%20closure%20but%20not%20on%20%22equiv%22%20fn/near/150927833" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2355526.20error.20on.20closure.20but.20not.20on.20.22equiv.22.20fn.html#150927833">(Dec 05 2018 at 13:36)</a>:</h4>
<p>in particular, the closure outlives rules here:</p>
<p><a href="https://github.com/rust-lang/rust/blob/21cb46a6e94906c2fdfda4df33c822ba28422b7f/src/librustc/ty/outlives.rs#L74-L78" target="_blank" title="https://github.com/rust-lang/rust/blob/21cb46a6e94906c2fdfda4df33c822ba28422b7f/src/librustc/ty/outlives.rs#L74-L78">https://github.com/rust-lang/rust/blob/21cb46a6e94906c2fdfda4df33c822ba28422b7f/src/librustc/ty/outlives.rs#L74-L78</a></p>



<a name="150927840"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2355526%20error%20on%20closure%20but%20not%20on%20%22equiv%22%20fn/near/150927840" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2355526.20error.20on.20closure.20but.20not.20on.20.22equiv.22.20fn.html#150927840">(Dec 05 2018 at 13:36)</a>:</h4>
<p>just look at the "upvar types" from the closure</p>



<a name="150927844"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2355526%20error%20on%20closure%20but%20not%20on%20%22equiv%22%20fn/near/150927844" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2355526.20error.20on.20closure.20but.20not.20on.20.22equiv.22.20fn.html#150927844">(Dec 05 2018 at 13:36)</a>:</h4>
<p>ignoring the regions on the closure signature</p>



<a name="150927848"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2355526%20error%20on%20closure%20but%20not%20on%20%22equiv%22%20fn/near/150927848" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2355526.20error.20on.20closure.20but.20not.20on.20.22equiv.22.20fn.html#150927848">(Dec 05 2018 at 13:36)</a>:</h4>
<p>I think...this is probably just a bug</p>



<a name="150927850"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2355526%20error%20on%20closure%20but%20not%20on%20%22equiv%22%20fn/near/150927850" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2355526.20error.20on.20closure.20but.20not.20on.20.22equiv.22.20fn.html#150927850">(Dec 05 2018 at 13:36)</a>:</h4>
<p>the more I think about it</p>



<a name="150927876"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2355526%20error%20on%20closure%20but%20not%20on%20%22equiv%22%20fn/near/150927876" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> pnkfelix <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2355526.20error.20on.20closure.20but.20not.20on.20.22equiv.22.20fn.html#150927876">(Dec 05 2018 at 13:37)</a>:</h4>
<p>okay</p>



<a name="150927877"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2355526%20error%20on%20closure%20but%20not%20on%20%22equiv%22%20fn/near/150927877" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2355526.20error.20on.20closure.20but.20not.20on.20.22equiv.22.20fn.html#150927877">(Dec 05 2018 at 13:37)</a>:</h4>
<p><a href="https://github.com/rust-lang/rust/blob/master/src/librustc/ty/sty.rs#L221-L227" target="_blank" title="https://github.com/rust-lang/rust/blob/master/src/librustc/ty/sty.rs#L221-L227">possibly relevant refresher on <code>ClosureSubsts</code></a></p>



<a name="150927880"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2355526%20error%20on%20closure%20but%20not%20on%20%22equiv%22%20fn/near/150927880" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2355526.20error.20on.20closure.20but.20not.20on.20.22equiv.22.20fn.html#150927880">(Dec 05 2018 at 13:37)</a>:</h4>
<p>so anyway the reason this matters is</p>



<a name="150927885"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2355526%20error%20on%20closure%20but%20not%20on%20%22equiv%22%20fn/near/150927885" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> pnkfelix <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2355526.20error.20on.20closure.20but.20not.20on.20.22equiv.22.20fn.html#150927885">(Dec 05 2018 at 13:37)</a>:</h4>
<p>if it is likely that we are going to move to a world where AST-borrowck rejects this code</p>



<a name="150927895"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2355526%20error%20on%20closure%20but%20not%20on%20%22equiv%22%20fn/near/150927895" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2355526.20error.20on.20closure.20but.20not.20on.20.22equiv.22.20fn.html#150927895">(Dec 05 2018 at 13:37)</a>:</h4>
<p>the closure creator requires its type to outlive the local variable in which it is stored</p>



<a name="150927900"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2355526%20error%20on%20closure%20but%20not%20on%20%22equiv%22%20fn/near/150927900" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2355526.20error.20on.20closure.20but.20not.20on.20.22equiv.22.20fn.html#150927900">(Dec 05 2018 at 13:37)</a>:</h4>
<p>but that does not affect the return type</p>



<a name="150927903"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2355526%20error%20on%20closure%20but%20not%20on%20%22equiv%22%20fn/near/150927903" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> pnkfelix <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2355526.20error.20on.20closure.20but.20not.20on.20.22equiv.22.20fn.html#150927903">(Dec 05 2018 at 13:37)</a>:</h4>
<p>(and justify it by saying "this is a soundness fix")</p>



<a name="150927905"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2355526%20error%20on%20closure%20but%20not%20on%20%22equiv%22%20fn/near/150927905" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2355526.20error.20on.20closure.20but.20not.20on.20.22equiv.22.20fn.html#150927905">(Dec 05 2018 at 13:37)</a>:</h4>
<p>because of this def'n of "outlives"</p>



<a name="150927906"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2355526%20error%20on%20closure%20but%20not%20on%20%22equiv%22%20fn/near/150927906" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> pnkfelix <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2355526.20error.20on.20closure.20but.20not.20on.20.22equiv.22.20fn.html#150927906">(Dec 05 2018 at 13:37)</a>:</h4>
<p>I'm super-inclined to run with that.</p>



<a name="150927912"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2355526%20error%20on%20closure%20but%20not%20on%20%22equiv%22%20fn/near/150927912" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2355526.20error.20on.20closure.20but.20not.20on.20.22equiv.22.20fn.html#150927912">(Dec 05 2018 at 13:37)</a>:</h4>
<p>yes</p>



<a name="150927918"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2355526%20error%20on%20closure%20but%20not%20on%20%22equiv%22%20fn/near/150927918" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2355526.20error.20on.20closure.20but.20not.20on.20.22equiv.22.20fn.html#150927918">(Dec 05 2018 at 13:37)</a>:</h4>
<p>basically my take is:</p>



<a name="150927929"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2355526%20error%20on%20closure%20but%20not%20on%20%22equiv%22%20fn/near/150927929" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2355526.20error.20on.20closure.20but.20not.20on.20.22equiv.22.20fn.html#150927929">(Dec 05 2018 at 13:37)</a>:</h4>
<p>given the existing limitations of the system</p>



<a name="150927932"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2355526%20error%20on%20closure%20but%20not%20on%20%22equiv%22%20fn/near/150927932" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2355526.20error.20on.20closure.20but.20not.20on.20.22equiv.22.20fn.html#150927932">(Dec 05 2018 at 13:37)</a>:</h4>
<p>this code <em>ought</em> to be rejected</p>



<a name="150927937"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2355526%20error%20on%20closure%20but%20not%20on%20%22equiv%22%20fn/near/150927937" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2355526.20error.20on.20closure.20but.20not.20on.20.22equiv.22.20fn.html#150927937">(Dec 05 2018 at 13:37)</a>:</h4>
<p>but those limitations are unfortunate</p>



<a name="150927982"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2355526%20error%20on%20closure%20but%20not%20on%20%22equiv%22%20fn/near/150927982" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2355526.20error.20on.20closure.20but.20not.20on.20.22equiv.22.20fn.html#150927982">(Dec 05 2018 at 13:38)</a>:</h4>
<p>and -- at some point -- it would be nice to do better</p>



<a name="150927985"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2355526%20error%20on%20closure%20but%20not%20on%20%22equiv%22%20fn/near/150927985" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> pnkfelix <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2355526.20error.20on.20closure.20but.20not.20on.20.22equiv.22.20fn.html#150927985">(Dec 05 2018 at 13:38)</a>:</h4>
<p>okay.</p>



<a name="150927987"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2355526%20error%20on%20closure%20but%20not%20on%20%22equiv%22%20fn/near/150927987" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2355526.20error.20on.20closure.20but.20not.20on.20.22equiv.22.20fn.html#150927987">(Dec 05 2018 at 13:38)</a>:</h4>
<p>that said, I think that the <code>|x: &amp;str| -&gt; &amp;str</code> should work</p>



<a name="150927989"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2355526%20error%20on%20closure%20but%20not%20on%20%22equiv%22%20fn/near/150927989" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2355526.20error.20on.20closure.20but.20not.20on.20.22equiv.22.20fn.html#150927989">(Dec 05 2018 at 13:38)</a>:</h4>
<p>and <em>that</em> I think is a bug</p>



<a name="150927990"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2355526%20error%20on%20closure%20but%20not%20on%20%22equiv%22%20fn/near/150927990" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> pnkfelix <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2355526.20error.20on.20closure.20but.20not.20on.20.22equiv.22.20fn.html#150927990">(Dec 05 2018 at 13:38)</a>:</h4>
<p>So that would be part 1: reject the code when no return tyep annotation is provided</p>



<a name="150927996"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2355526%20error%20on%20closure%20but%20not%20on%20%22equiv%22%20fn/near/150927996" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> pnkfelix <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2355526.20error.20on.20closure.20but.20not.20on.20.22equiv.22.20fn.html#150927996">(Dec 05 2018 at 13:38)</a>:</h4>
<p>and then, yes, part 2 is get us to accept <code>|x: &amp;str| -&gt; &amp;str</code></p>



<a name="150927999"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2355526%20error%20on%20closure%20but%20not%20on%20%22equiv%22%20fn/near/150927999" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> pnkfelix <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2355526.20error.20on.20closure.20but.20not.20on.20.22equiv.22.20fn.html#150927999">(Dec 05 2018 at 13:38)</a>:</h4>
<p>I think</p>



<a name="150928026"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2355526%20error%20on%20closure%20but%20not%20on%20%22equiv%22%20fn/near/150928026" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2355526.20error.20on.20closure.20but.20not.20on.20.22equiv.22.20fn.html#150928026">(Dec 05 2018 at 13:39)</a>:</h4>
<p>seems right</p>



<a name="150928034"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2355526%20error%20on%20closure%20but%20not%20on%20%22equiv%22%20fn/near/150928034" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2355526.20error.20on.20closure.20but.20not.20on.20.22equiv.22.20fn.html#150928034">(Dec 05 2018 at 13:39)</a>:</h4>
<p>the code for handling closure signatures is a bit separate I guess I forgot about elision or something</p>



<a name="150928043"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2355526%20error%20on%20closure%20but%20not%20on%20%22equiv%22%20fn/near/150928043" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2355526.20error.20on.20closure.20but.20not.20on.20.22equiv.22.20fn.html#150928043">(Dec 05 2018 at 13:39)</a>:</h4>
<p>it took a while to figure out how to reconcile expected types + user-supplied signatures</p>



<a name="150928051"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2355526%20error%20on%20closure%20but%20not%20on%20%22equiv%22%20fn/near/150928051" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2355526.20error.20on.20closure.20but.20not.20on.20.22equiv.22.20fn.html#150928051">(Dec 05 2018 at 13:39)</a>:</h4>
<p>we used to do some really ridiculously bogus stuff :)</p>



<a name="150928059"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2355526%20error%20on%20closure%20but%20not%20on%20%22equiv%22%20fn/near/150928059" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> pnkfelix <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2355526.20error.20on.20closure.20but.20not.20on.20.22equiv.22.20fn.html#150928059">(Dec 05 2018 at 13:40)</a>:</h4>
<p>(though it continues to be a little odd that we would take that approach, at least to me ... since, if we can apply lifetime elision rules  and get a usable result ... why not use those same rules for an inferred <code>-&gt; &amp;str</code> ?)</p>



<a name="150928068"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2355526%20error%20on%20closure%20but%20not%20on%20%22equiv%22%20fn/near/150928068" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2355526.20error.20on.20closure.20but.20not.20on.20.22equiv.22.20fn.html#150928068">(Dec 05 2018 at 13:40)</a>:</h4>
<p>(in this case, of course, there is no expected signature)</p>



<a name="150928116"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2355526%20error%20on%20closure%20but%20not%20on%20%22equiv%22%20fn/near/150928116" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2355526.20error.20on.20closure.20but.20not.20on.20.22equiv.22.20fn.html#150928116">(Dec 05 2018 at 13:40)</a>:</h4>
<blockquote>
<p>(though it continues to be a little odd that we would take that approach, at least to me ... since, if we can apply lifetime elision rules  and get a usable result ... why not use those same rules for an inferred <code>-&gt; &amp;str</code> ?)</p>
</blockquote>
<p>well note that <code>|x: &amp;str| -&gt; _ { .. }</code> would still error</p>



<a name="150928123"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2355526%20error%20on%20closure%20but%20not%20on%20%22equiv%22%20fn/near/150928123" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2355526.20error.20on.20closure.20but.20not.20on.20.22equiv.22.20fn.html#150928123">(Dec 05 2018 at 13:40)</a>:</h4>
<p>and this is what <code>|x: &amp;str| ...</code> is equivalent to</p>



<a name="150928142"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2355526%20error%20on%20closure%20but%20not%20on%20%22equiv%22%20fn/near/150928142" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> pnkfelix <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2355526.20error.20on.20closure.20but.20not.20on.20.22equiv.22.20fn.html#150928142">(Dec 05 2018 at 13:40)</a>:</h4>
<p>yes, but I guess it still feels strange, since the error you get will tend to make it clear that the compiler managed to plug in <code>-&gt; &amp;str</code></p>



<a name="150928155"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2355526%20error%20on%20closure%20but%20not%20on%20%22equiv%22%20fn/near/150928155" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2355526.20error.20on.20closure.20but.20not.20on.20.22equiv.22.20fn.html#150928155">(Dec 05 2018 at 13:41)</a>:</h4>
<p>I did say it was unfortunate</p>



<a name="150928170"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2355526%20error%20on%20closure%20but%20not%20on%20%22equiv%22%20fn/near/150928170" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2355526.20error.20on.20closure.20but.20not.20on.20.22equiv.22.20fn.html#150928170">(Dec 05 2018 at 13:41)</a>:</h4>
<p>it comes down to the order of the <code>exists</code> and <code>forall</code> binders, of course</p>



<a name="150928180"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2355526%20error%20on%20closure%20but%20not%20on%20%22equiv%22%20fn/near/150928180" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> pnkfelix <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2355526.20error.20on.20closure.20but.20not.20on.20.22equiv.22.20fn.html#150928180">(Dec 05 2018 at 13:41)</a>:</h4>
<p>is the justification essentiallythat the lifetime elision rules are meant to be syntactic in some sense ?</p>



<a name="150928191"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2355526%20error%20on%20closure%20but%20not%20on%20%22equiv%22%20fn/near/150928191" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2355526.20error.20on.20closure.20but.20not.20on.20.22equiv.22.20fn.html#150928191">(Dec 05 2018 at 13:41)</a>:</h4>
<p>yes</p>



<a name="150928212"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2355526%20error%20on%20closure%20but%20not%20on%20%22equiv%22%20fn/near/150928212" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> pnkfelix <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2355526.20error.20on.20closure.20but.20not.20on.20.22equiv.22.20fn.html#150928212">(Dec 05 2018 at 13:41)</a>:</h4>
<p>and that if there is no surface syntax showing the <code>&amp;T</code>, then we're going to pretend like we couldn't have done better?</p>



<a name="150928272"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2355526%20error%20on%20closure%20but%20not%20on%20%22equiv%22%20fn/near/150928272" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2355526.20error.20on.20closure.20but.20not.20on.20.22equiv.22.20fn.html#150928272">(Dec 05 2018 at 13:42)</a>:</h4>
<p>I don't consider it pretending, but yes</p>



<a name="150928278"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2355526%20error%20on%20closure%20but%20not%20on%20%22equiv%22%20fn/near/150928278" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2355526.20error.20on.20closure.20but.20not.20on.20.22equiv.22.20fn.html#150928278">(Dec 05 2018 at 13:42)</a>:</h4>
<p>I guess I would explain like this:</p>



<a name="150928288"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2355526%20error%20on%20closure%20but%20not%20on%20%22equiv%22%20fn/near/150928288" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2355526.20error.20on.20closure.20but.20not.20on.20.22equiv.22.20fn.html#150928288">(Dec 05 2018 at 13:42)</a>:</h4>
<ul>
<li>in closures with no expected signature, if anything is missing, it is equivalent to <code>_</code></li>
</ul>



<a name="150928299"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2355526%20error%20on%20closure%20but%20not%20on%20%22equiv%22%20fn/near/150928299" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2355526.20error.20on.20closure.20but.20not.20on.20.22equiv.22.20fn.html#150928299">(Dec 05 2018 at 13:42)</a>:</h4>
<ul>
<li><code>_</code> (in the closure signature) creates a type variable that is in the scope of the <strong>enclosing fn</strong> (not just the closure)</li>
</ul>



<a name="150928313"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2355526%20error%20on%20closure%20but%20not%20on%20%22equiv%22%20fn/near/150928313" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2355526.20error.20on.20closure.20but.20not.20on.20.22equiv.22.20fn.html#150928313">(Dec 05 2018 at 13:43)</a>:</h4>
<ul>
<li>in this case, the <code>_</code> would need to name a region that is in scope only for the closure</li>
</ul>



<a name="150928335"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2355526%20error%20on%20closure%20but%20not%20on%20%22equiv%22%20fn/near/150928335" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2355526.20error.20on.20closure.20but.20not.20on.20.22equiv.22.20fn.html#150928335">(Dec 05 2018 at 13:43)</a>:</h4>
<p>it would be nice to lift the second restriction, but it's a "feature request" basically</p>



<a name="150928338"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2355526%20error%20on%20closure%20but%20not%20on%20%22equiv%22%20fn/near/150928338" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> pnkfelix <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2355526.20error.20on.20closure.20but.20not.20on.20.22equiv.22.20fn.html#150928338">(Dec 05 2018 at 13:43)</a>:</h4>
<p>do we have <code>'_</code> at this point? What would <code>let v_lambda: |x: &amp;str| -&gt; &amp;'_ str { x }</code> do?</p>



<a name="150928359"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2355526%20error%20on%20closure%20but%20not%20on%20%22equiv%22%20fn/near/150928359" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2355526.20error.20on.20closure.20but.20not.20on.20.22equiv.22.20fn.html#150928359">(Dec 05 2018 at 13:43)</a>:</h4>
<p>that would be equivalent to <code>&amp;str</code></p>



<a name="150928407"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2355526%20error%20on%20closure%20but%20not%20on%20%22equiv%22%20fn/near/150928407" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2355526.20error.20on.20closure.20but.20not.20on.20.22equiv.22.20fn.html#150928407">(Dec 05 2018 at 13:44)</a>:</h4>
<p><code>'_</code> in a closure signature does not create a variable</p>



<a name="150928413"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2355526%20error%20on%20closure%20but%20not%20on%20%22equiv%22%20fn/near/150928413" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2355526.20error.20on.20closure.20but.20not.20on.20.22equiv.22.20fn.html#150928413">(Dec 05 2018 at 13:44)</a>:</h4>
<p>but rather applies elision rules</p>



<a name="150928449"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2355526%20error%20on%20closure%20but%20not%20on%20%22equiv%22%20fn/near/150928449" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> pnkfelix <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2355526.20error.20on.20closure.20but.20not.20on.20.22equiv.22.20fn.html#150928449">(Dec 05 2018 at 13:44)</a>:</h4>
<p>okay.</p>



<a name="150928462"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2355526%20error%20on%20closure%20but%20not%20on%20%22equiv%22%20fn/near/150928462" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2355526.20error.20on.20closure.20but.20not.20on.20.22equiv.22.20fn.html#150928462">(Dec 05 2018 at 13:45)</a>:</h4>
<p>one "flaw" in my explanation is that <code>_</code> in a closure body <em>can</em> refer to late-bound things</p>



<a name="150928482"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2355526%20error%20on%20closure%20but%20not%20on%20%22equiv%22%20fn/near/150928482" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2355526.20error.20on.20closure.20but.20not.20on.20.22equiv.22.20fn.html#150928482">(Dec 05 2018 at 13:45)</a>:</h4>
<p>I put "flaw" in quotes because my explanation is not wrong</p>



<a name="150928498"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2355526%20error%20on%20closure%20but%20not%20on%20%22equiv%22%20fn/near/150928498" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2355526.20error.20on.20closure.20but.20not.20on.20.22equiv.22.20fn.html#150928498">(Dec 05 2018 at 13:45)</a>:</h4>
<p>just that the current behavior is not especially intuitive nor useful</p>



<a name="150928505"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2355526%20error%20on%20closure%20but%20not%20on%20%22equiv%22%20fn/near/150928505" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> pnkfelix <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2355526.20error.20on.20closure.20but.20not.20on.20.22equiv.22.20fn.html#150928505">(Dec 05 2018 at 13:45)</a>:</h4>
<p>right, its just a subtle distinction between closure signature and closure body?</p>



<a name="150928509"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2355526%20error%20on%20closure%20but%20not%20on%20%22equiv%22%20fn/near/150928509" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2355526.20error.20on.20closure.20but.20not.20on.20.22equiv.22.20fn.html#150928509">(Dec 05 2018 at 13:46)</a>:</h4>
<p>yeah</p>



<a name="150928551"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2355526%20error%20on%20closure%20but%20not%20on%20%22equiv%22%20fn/near/150928551" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2355526.20error.20on.20closure.20but.20not.20on.20.22equiv.22.20fn.html#150928551">(Dec 05 2018 at 13:46)</a>:</h4>
<p>though also <code>'_</code> behaves differently etc</p>



<a name="150928554"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2355526%20error%20on%20closure%20but%20not%20on%20%22equiv%22%20fn/near/150928554" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2355526.20error.20on.20closure.20but.20not.20on.20.22equiv.22.20fn.html#150928554">(Dec 05 2018 at 13:46)</a>:</h4>
<p>so the fact that signature vs body have a distinction doesn't seem <em>itself</em> bad</p>



<a name="150928569"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2355526%20error%20on%20closure%20but%20not%20on%20%22equiv%22%20fn/near/150928569" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> pnkfelix <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2355526.20error.20on.20closure.20but.20not.20on.20.22equiv.22.20fn.html#150928569">(Dec 05 2018 at 13:46)</a>:</h4>
<p>Okay. So it sounds like we have identified two work items here</p>



<a name="150928615"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2355526%20error%20on%20closure%20but%20not%20on%20%22equiv%22%20fn/near/150928615" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> pnkfelix <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2355526.20error.20on.20closure.20but.20not.20on.20.22equiv.22.20fn.html#150928615">(Dec 05 2018 at 13:47)</a>:</h4>
<p>1. For the <code>|v: &amp;str| { v }</code> case, we'll let NLL continue to break. And (maybe? hopefully?) we'll also break AST-borrowck in that case, for consistency?</p>



<a name="150928642"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2355526%20error%20on%20closure%20but%20not%20on%20%22equiv%22%20fn/near/150928642" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> pnkfelix <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2355526.20error.20on.20closure.20but.20not.20on.20.22equiv.22.20fn.html#150928642">(Dec 05 2018 at 13:47)</a>:</h4>
<p>2. For the <code>|v: &amp;str| -&gt; &amp;str { v }</code> case, I'll start trying to identify why the lifetime elision rules aren't making it work out of the box.</p>



<a name="150928722"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2355526%20error%20on%20closure%20but%20not%20on%20%22equiv%22%20fn/near/150928722" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> pnkfelix <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2355526.20error.20on.20closure.20but.20not.20on.20.22equiv.22.20fn.html#150928722">(Dec 05 2018 at 13:48)</a>:</h4>
<p>(regarding 2., I hypothesized <a href="https://github.com/rust-lang/rust/issues/55526#issuecomment-435411440" target="_blank" title="https://github.com/rust-lang/rust/issues/55526#issuecomment-435411440">a month ago</a> that lifetime elision might be related to this...)</p>



<a name="150928799"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2355526%20error%20on%20closure%20but%20not%20on%20%22equiv%22%20fn/near/150928799" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> pnkfelix <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2355526.20error.20on.20closure.20but.20not.20on.20.22equiv.22.20fn.html#150928799">(Dec 05 2018 at 13:49)</a>:</h4>
<p>Do the above two points sound right to you? And since you already have a PR that you say breaks AST-borrowck on case 1., we'll just let the debate carry on in PR <a href="https://github.com/rust-lang/rust/issues/55988" target="_blank" title="https://github.com/rust-lang/rust/issues/55988">#55988</a> ?</p>



<a name="150928971"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2355526%20error%20on%20closure%20but%20not%20on%20%22equiv%22%20fn/near/150928971" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2355526.20error.20on.20closure.20but.20not.20on.20.22equiv.22.20fn.html#150928971">(Dec 05 2018 at 13:51)</a>:</h4>
<p>that sounds correct to me</p>



<a name="150930634"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2355526%20error%20on%20closure%20but%20not%20on%20%22equiv%22%20fn/near/150930634" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> pnkfelix <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2355526.20error.20on.20closure.20but.20not.20on.20.22equiv.22.20fn.html#150930634">(Dec 05 2018 at 14:13)</a>:</h4>
<p>Hmm there's this comment that may contradict our hypothesis about the <code>-&gt; &amp;str</code> case: <a href="https://github.com/rust-lang/rust/blob/master/src/librustc/middle/resolve_lifetime.rs#L2112" target="_blank" title="https://github.com/rust-lang/rust/blob/master/src/librustc/middle/resolve_lifetime.rs#L2112">https://github.com/rust-lang/rust/blob/master/src/librustc/middle/resolve_lifetime.rs#L2112</a></p>



<a name="150930659"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2355526%20error%20on%20closure%20but%20not%20on%20%22equiv%22%20fn/near/150930659" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> pnkfelix <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2355526.20error.20on.20closure.20but.20not.20on.20.22equiv.22.20fn.html#150930659">(Dec 05 2018 at 14:13)</a>:</h4>
<div class="codehilite"><pre><span></span><span class="c1">// Everything else (only closures?) doesn&#39;t</span>
<span class="c1">// actually enjoy elision in return types.</span>
</pre></div>



<a name="150930727"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2355526%20error%20on%20closure%20but%20not%20on%20%22equiv%22%20fn/near/150930727" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2355526.20error.20on.20closure.20but.20not.20on.20.22equiv.22.20fn.html#150930727">(Dec 05 2018 at 14:14)</a>:</h4>
<p>we certainly <em>used</em> to use elision</p>



<a name="150930738"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2355526%20error%20on%20closure%20but%20not%20on%20%22equiv%22%20fn/near/150930738" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> pnkfelix <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2355526.20error.20on.20closure.20but.20not.20on.20.22equiv.22.20fn.html#150930738">(Dec 05 2018 at 14:14)</a>:</h4>
<p>time to go read the lifetime elision RFC(s).</p>



<a name="150930741"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2355526%20error%20on%20closure%20but%20not%20on%20%22equiv%22%20fn/near/150930741" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2355526.20error.20on.20closure.20but.20not.20on.20.22equiv.22.20fn.html#150930741">(Dec 05 2018 at 14:14)</a>:</h4>
<p>I'm not sure what that "only closures?" would mean</p>



<a name="150930750"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2355526%20error%20on%20closure%20but%20not%20on%20%22equiv%22%20fn/near/150930750" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> pnkfelix <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2355526.20error.20on.20closure.20but.20not.20on.20.22equiv.22.20fn.html#150930750">(Dec 05 2018 at 14:14)</a>:</h4>
<p>oh</p>



<a name="150930758"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2355526%20error%20on%20closure%20but%20not%20on%20%22equiv%22%20fn/near/150930758" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> pnkfelix <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2355526.20error.20on.20closure.20but.20not.20on.20.22equiv.22.20fn.html#150930758">(Dec 05 2018 at 14:14)</a>:</h4>
<p>its right before a catch-all</p>



<a name="150930767"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2355526%20error%20on%20closure%20but%20not%20on%20%22equiv%22%20fn/near/150930767" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2355526.20error.20on.20closure.20but.20not.20on.20.22equiv.22.20fn.html#150930767">(Dec 05 2018 at 14:14)</a>:</h4>
<p>but I think it means "also closures" =)</p>



<a name="150930778"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2355526%20error%20on%20closure%20but%20not%20on%20%22equiv%22%20fn/near/150930778" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2355526.20error.20on.20closure.20but.20not.20on.20.22equiv.22.20fn.html#150930778">(Dec 05 2018 at 14:15)</a>:</h4>
<p>regardless I think that all fn sigs currently use elision</p>



<a name="150930782"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2355526%20error%20on%20closure%20but%20not%20on%20%22equiv%22%20fn/near/150930782" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> pnkfelix <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2355526.20error.20on.20closure.20but.20not.20on.20.22equiv.22.20fn.html#150930782">(Dec 05 2018 at 14:15)</a>:</h4>
<p>as in, I think the author thought the only remaining case that could occur in the catch-all was closures.</p>



<a name="150930784"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2355526%20error%20on%20closure%20but%20not%20on%20%22equiv%22%20fn/near/150930784" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2355526.20error.20on.20closure.20but.20not.20on.20.22equiv.22.20fn.html#150930784">(Dec 05 2018 at 14:15)</a>:</h4>
<p>and I cannot imagine why closures would be exempted</p>



<a name="150930804"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2355526%20error%20on%20closure%20but%20not%20on%20%22equiv%22%20fn/near/150930804" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2355526.20error.20on.20closure.20but.20not.20on.20.22equiv.22.20fn.html#150930804">(Dec 05 2018 at 14:15)</a>:</h4>
<p>I see</p>



<a name="150930810"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2355526%20error%20on%20closure%20but%20not%20on%20%22equiv%22%20fn/near/150930810" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2355526.20error.20on.20closure.20but.20not.20on.20.22equiv.22.20fn.html#150930810">(Dec 05 2018 at 14:15)</a>:</h4>
<p>well, I consider that comment wrong, but it's worth digging a bit more</p>



<a name="150930901"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2355526%20error%20on%20closure%20but%20not%20on%20%22equiv%22%20fn/near/150930901" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> pnkfelix <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2355526.20error.20on.20closure.20but.20not.20on.20.22equiv.22.20fn.html#150930901">(Dec 05 2018 at 14:16)</a>:</h4>
<p>the comment seems to correctly reflect what the code does.</p>



<a name="150930904"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2355526%20error%20on%20closure%20but%20not%20on%20%22equiv%22%20fn/near/150930904" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> pnkfelix <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2355526.20error.20on.20closure.20but.20not.20on.20.22equiv.22.20fn.html#150930904">(Dec 05 2018 at 14:16)</a>:</h4>
<p>but it may be trivial to fix this. :)</p>



<a name="150930922"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2355526%20error%20on%20closure%20but%20not%20on%20%22equiv%22%20fn/near/150930922" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> pnkfelix <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2355526.20error.20on.20closure.20but.20not.20on.20.22equiv.22.20fn.html#150930922">(Dec 05 2018 at 14:16)</a>:</h4>
<p>(as in, change the code and bring comment in sync with revised expectations)</p>



<a name="150993462"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2355526%20error%20on%20closure%20but%20not%20on%20%22equiv%22%20fn/near/150993462" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> pnkfelix <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2355526.20error.20on.20closure.20but.20not.20on.20.22equiv.22.20fn.html#150993462">(Dec 06 2018 at 09:28)</a>:</h4>
<p><a href="https://github.com/rust-lang/rust/issues/56537#issuecomment-444805972" target="_blank" title="https://github.com/rust-lang/rust/issues/56537#issuecomment-444805972">This</a> is a bummer: applying lifetime elision to <code>-&gt; &amp;T</code> on closure expressions might break code. (But maybe I can make my patch a bit smarter here, and only try to handle the return type if the closure expressions also had argument types...?)</p>



<a name="151007301"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2355526%20error%20on%20closure%20but%20not%20on%20%22equiv%22%20fn/near/151007301" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2355526.20error.20on.20closure.20but.20not.20on.20.22equiv.22.20fn.html#151007301">(Dec 06 2018 at 13:51)</a>:</h4>
<p>I was wondering about those examples</p>



<a name="151007314"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2355526%20error%20on%20closure%20but%20not%20on%20%22equiv%22%20fn/near/151007314" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2355526.20error.20on.20closure.20but.20not.20on.20.22equiv.22.20fn.html#151007314">(Dec 06 2018 at 13:51)</a>:</h4>
<p>er, about examples like that</p>



<a name="151007326"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2355526%20error%20on%20closure%20but%20not%20on%20%22equiv%22%20fn/near/151007326" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2355526.20error.20on.20closure.20but.20not.20on.20.22equiv.22.20fn.html#151007326">(Dec 06 2018 at 13:51)</a>:</h4>
<p>that is, after signing off yesterday I got to thinking about all the edge cases</p>



<a name="151007346"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2355526%20error%20on%20closure%20but%20not%20on%20%22equiv%22%20fn/near/151007346" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2355526.20error.20on.20closure.20but.20not.20on.20.22equiv.22.20fn.html#151007346">(Dec 06 2018 at 13:52)</a>:</h4>
<p>right now, <em>if we have an expected type</em>, something like <code>|x: &amp;str, y: &amp;str|</code> is setup so that the regions kind of 'don't matter'</p>



<a name="151007396"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2355526%20error%20on%20closure%20but%20not%20on%20%22equiv%22%20fn/near/151007396" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2355526.20error.20on.20closure.20but.20not.20on.20.22equiv.22.20fn.html#151007396">(Dec 06 2018 at 13:52)</a>:</h4>
<p>e.g., the expected signature might be <code>fn(&amp;'a str, &amp;'a str)</code></p>



<a name="151007412"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2355526%20error%20on%20closure%20but%20not%20on%20%22equiv%22%20fn/near/151007412" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2355526.20error.20on.20closure.20but.20not.20on.20.22equiv.22.20fn.html#151007412">(Dec 06 2018 at 13:52)</a>:</h4>
<p>but <code>x: &amp;str, y: &amp;str</code> is "short for" <code>&amp;'a str, &amp;'b str</code>, in some sense</p>



<a name="151007424"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2355526%20error%20on%20closure%20but%20not%20on%20%22equiv%22%20fn/near/151007424" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2355526.20error.20on.20closure.20but.20not.20on.20.22equiv.22.20fn.html#151007424">(Dec 06 2018 at 13:53)</a>:</h4>
<p>basically we are saying something like: there exists a subst S such that <code>S[provided-signature] = expected-signature</code></p>



<a name="151007428"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2355526%20error%20on%20closure%20but%20not%20on%20%22equiv%22%20fn/near/151007428" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2355526.20error.20on.20closure.20but.20not.20on.20.22equiv.22.20fn.html#151007428">(Dec 06 2018 at 13:53)</a>:</h4>
<p>applying elision makes this break in some cases</p>



<a name="151007432"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2355526%20error%20on%20closure%20but%20not%20on%20%22equiv%22%20fn/near/151007432" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2355526.20error.20on.20closure.20but.20not.20on.20.22equiv.22.20fn.html#151007432">(Dec 06 2018 at 13:53)</a>:</h4>
<p>e.g., <code>|&amp;str| -&gt; &amp;str</code> -- or the example you gave, of course</p>



<a name="151007444"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2355526%20error%20on%20closure%20but%20not%20on%20%22equiv%22%20fn/near/151007444" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2355526.20error.20on.20closure.20but.20not.20on.20.22equiv.22.20fn.html#151007444">(Dec 06 2018 at 13:53)</a>:</h4>
<p>I am trying to reason in my head if there is an interpretation that is compatible with both</p>



<a name="151007454"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2355526%20error%20on%20closure%20but%20not%20on%20%22equiv%22%20fn/near/151007454" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2355526.20error.20on.20closure.20but.20not.20on.20.22equiv.22.20fn.html#151007454">(Dec 06 2018 at 13:53)</a>:</h4>
<p>e.g., applying elision -- but <em>only</em> if there is no expected type? feels like a mess</p>



<a name="151007466"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2355526%20error%20on%20closure%20but%20not%20on%20%22equiv%22%20fn/near/151007466" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2355526.20error.20on.20closure.20but.20not.20on.20.22equiv.22.20fn.html#151007466">(Dec 06 2018 at 13:54)</a>:</h4>
<p>so maybe this answers my question? it still feels sort of wrong that elision doesn't trigger though</p>



<a name="151007693"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2355526%20error%20on%20closure%20but%20not%20on%20%22equiv%22%20fn/near/151007693" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2355526.20error.20on.20closure.20but.20not.20on.20.22equiv.22.20fn.html#151007693">(Dec 06 2018 at 13:56)</a>:</h4>
<p>(<a href="https://github.com/rust-lang/rust/issues/56537#issuecomment-444878591" target="_blank" title="https://github.com/rust-lang/rust/issues/56537#issuecomment-444878591">just summarized this in the issue</a>)</p>



<a name="151007951"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2355526%20error%20on%20closure%20but%20not%20on%20%22equiv%22%20fn/near/151007951" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> pnkfelix <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2355526.20error.20on.20closure.20but.20not.20on.20.22equiv.22.20fn.html#151007951">(Dec 06 2018 at 13:59)</a>:</h4>
<p>In any case this is definitely starting to feel like "any change here will need an RFC" ...</p>



<a name="151007965"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2355526%20error%20on%20closure%20but%20not%20on%20%22equiv%22%20fn/near/151007965" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> pnkfelix <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2355526.20error.20on.20closure.20but.20not.20on.20.22equiv.22.20fn.html#151007965">(Dec 06 2018 at 13:59)</a>:</h4>
<p>well, not <em>any</em> change</p>



<a name="151008042"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2355526%20error%20on%20closure%20but%20not%20on%20%22equiv%22%20fn/near/151008042" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> pnkfelix <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2355526.20error.20on.20closure.20but.20not.20on.20.22equiv.22.20fn.html#151008042">(Dec 06 2018 at 14:00)</a>:</h4>
<p>e.g. if we can hold off on fixing this and instead push on having NLL infer when to put references to bound regions (right? that's what you had mused about yesterday I think?)</p>



<a name="151008071"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2355526%20error%20on%20closure%20but%20not%20on%20%22equiv%22%20fn/near/151008071" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> pnkfelix <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2355526.20error.20on.20closure.20but.20not.20on.20.22equiv.22.20fn.html#151008071">(Dec 06 2018 at 14:00)</a>:</h4>
<p>then that has potential to be very much a DWIM solution that <em>might</em> bypass an RFC. Or it might be even <em>more</em> in need of an RFC. :)</p>



<a name="151008510"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2355526%20error%20on%20closure%20but%20not%20on%20%22equiv%22%20fn/near/151008510" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> pnkfelix <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2355526.20error.20on.20closure.20but.20not.20on.20.22equiv.22.20fn.html#151008510">(Dec 06 2018 at 14:06)</a>:</h4>
<blockquote>
<p>(<a href="https://github.com/rust-lang/rust/issues/56537#issuecomment-444878591" target="_blank" title="https://github.com/rust-lang/rust/issues/56537#issuecomment-444878591">just summarized this in the issue</a>)</p>
</blockquote>
<p>In that comment, you meant to write <code>for &lt;'a, 'b&gt; fn (&amp;'a str, &amp;'b str)</code>, not <code>for &lt;'a&gt; fn (&amp;'a str, &amp;'b str)</code>, right?</p>



<a name="151008511"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2355526%20error%20on%20closure%20but%20not%20on%20%22equiv%22%20fn/near/151008511" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> pnkfelix <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2355526.20error.20on.20closure.20but.20not.20on.20.22equiv.22.20fn.html#151008511">(Dec 06 2018 at 14:06)</a>:</h4>
<p><span class="user-mention" data-user-id="116009">@nikomatsakis</span> ^</p>



<a name="151008522"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2355526%20error%20on%20closure%20but%20not%20on%20%22equiv%22%20fn/near/151008522" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2355526.20error.20on.20closure.20but.20not.20on.20.22equiv.22.20fn.html#151008522">(Dec 06 2018 at 14:06)</a>:</h4>
<p>probably</p>



<a name="151008523"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2355526%20error%20on%20closure%20but%20not%20on%20%22equiv%22%20fn/near/151008523" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2355526.20error.20on.20closure.20but.20not.20on.20.22equiv.22.20fn.html#151008523">(Dec 06 2018 at 14:06)</a>:</h4>
<p>yes</p>



<a name="151008536"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2355526%20error%20on%20closure%20but%20not%20on%20%22equiv%22%20fn/near/151008536" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2355526.20error.20on.20closure.20but.20not.20on.20.22equiv.22.20fn.html#151008536">(Dec 06 2018 at 14:07)</a>:</h4>
<blockquote>
<p>In any case this is definitely starting to feel like "any change here will need an RFC" ...</p>
</blockquote>
<p>it does feel like an area where a "quasi-retroactive" RFC might be nice</p>



<a name="151008547"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2355526%20error%20on%20closure%20but%20not%20on%20%22equiv%22%20fn/near/151008547" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2355526.20error.20on.20closure.20but.20not.20on.20.22equiv.22.20fn.html#151008547">(Dec 06 2018 at 14:07)</a>:</h4>
<p>i.e., let's lay out a proposed design, document how it aligns with current behavior, document where it diverges and the expected impact</p>



<a name="151008555"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2355526%20error%20on%20closure%20but%20not%20on%20%22equiv%22%20fn/near/151008555" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2355526.20error.20on.20closure.20but.20not.20on.20.22equiv.22.20fn.html#151008555">(Dec 06 2018 at 14:07)</a>:</h4>
<p>I feel like we should be doing this gradually for lots of parts of the language</p>



<a name="151008561"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2355526%20error%20on%20closure%20but%20not%20on%20%22equiv%22%20fn/near/151008561" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2355526.20error.20on.20closure.20but.20not.20on.20.22equiv.22.20fn.html#151008561">(Dec 06 2018 at 14:07)</a>:</h4>
<p>might be a good "proving ground" for such a concept</p>



<a name="151008616"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2355526%20error%20on%20closure%20but%20not%20on%20%22equiv%22%20fn/near/151008616" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> pnkfelix <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2355526.20error.20on.20closure.20but.20not.20on.20.22equiv.22.20fn.html#151008616">(Dec 06 2018 at 14:08)</a>:</h4>
<p>I do wonder whether closures are sufficiently different from <code>fn</code> items that the standard arguments for the existing lifetime elision rules simply don't hold up</p>



<a name="151008621"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2355526%20error%20on%20closure%20but%20not%20on%20%22equiv%22%20fn/near/151008621" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> pnkfelix <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2355526.20error.20on.20closure.20but.20not.20on.20.22equiv.22.20fn.html#151008621">(Dec 06 2018 at 14:08)</a>:</h4>
<p>i.e the ability to return free variables that use free regions</p>



<a name="151008739"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2355526%20error%20on%20closure%20but%20not%20on%20%22equiv%22%20fn/near/151008739" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2355526.20error.20on.20closure.20but.20not.20on.20.22equiv.22.20fn.html#151008739">(Dec 06 2018 at 14:10)</a>:</h4>
<p>so</p>



<a name="151008751"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2355526%20error%20on%20closure%20but%20not%20on%20%22equiv%22%20fn/near/151008751" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2355526.20error.20on.20closure.20but.20not.20on.20.22equiv.22.20fn.html#151008751">(Dec 06 2018 at 14:10)</a>:</h4>
<p>another nice thing we should address</p>



<a name="151008764"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2355526%20error%20on%20closure%20but%20not%20on%20%22equiv%22%20fn/near/151008764" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2355526.20error.20on.20closure.20but.20not.20on.20.22equiv.22.20fn.html#151008764">(Dec 06 2018 at 14:10)</a>:</h4>
<p>is the ability to specify explicit signatures</p>



<a name="151008767"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2355526%20error%20on%20closure%20but%20not%20on%20%22equiv%22%20fn/near/151008767" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2355526.20error.20on.20closure.20but.20not.20on.20.22equiv.22.20fn.html#151008767">(Dec 06 2018 at 14:10)</a>:</h4>
<p>with named lifetimes</p>



<a name="151008773"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2355526%20error%20on%20closure%20but%20not%20on%20%22equiv%22%20fn/near/151008773" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2355526.20error.20on.20closure.20but.20not.20on.20.22equiv.22.20fn.html#151008773">(Dec 06 2018 at 14:10)</a>:</h4>
<p>maybe the answer would then be that elision applies in that case</p>



<a name="151008778"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2355526%20error%20on%20closure%20but%20not%20on%20%22equiv%22%20fn/near/151008778" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2355526.20error.20on.20closure.20but.20not.20on.20.22equiv.22.20fn.html#151008778">(Dec 06 2018 at 14:10)</a>:</h4>
<p>where you are using the "fully explicit form"</p>



<a name="151008782"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2355526%20error%20on%20closure%20but%20not%20on%20%22equiv%22%20fn/near/151008782" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2355526.20error.20on.20closure.20but.20not.20on.20.22equiv.22.20fn.html#151008782">(Dec 06 2018 at 14:10)</a>:</h4>
<p>and maybe we just deprecate return type annotations outside of that form</p>



<a name="151008787"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2355526%20error%20on%20closure%20but%20not%20on%20%22equiv%22%20fn/near/151008787" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2355526.20error.20on.20closure.20but.20not.20on.20.22equiv.22.20fn.html#151008787">(Dec 06 2018 at 14:10)</a>:</h4>
<p>and hence sidestep the issue</p>



<a name="151008788"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2355526%20error%20on%20closure%20but%20not%20on%20%22equiv%22%20fn/near/151008788" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2355526.20error.20on.20closure.20but.20not.20on.20.22equiv.22.20fn.html#151008788">(Dec 06 2018 at 14:10)</a>:</h4>
<p>something like that</p>



<a name="151008805"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2355526%20error%20on%20closure%20but%20not%20on%20%22equiv%22%20fn/near/151008805" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2355526.20error.20on.20closure.20but.20not.20on.20.22equiv.22.20fn.html#151008805">(Dec 06 2018 at 14:11)</a>:</h4>
<p>I don't know what this form would <em>look like</em></p>



<a name="151008819"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2355526%20error%20on%20closure%20but%20not%20on%20%22equiv%22%20fn/near/151008819" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> pnkfelix <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2355526.20error.20on.20closure.20but.20not.20on.20.22equiv.22.20fn.html#151008819">(Dec 06 2018 at 14:11)</a>:</h4>
<blockquote>
<p>with named lifetimes</p>
</blockquote>
<p>is this the same as what I <a href="https://github.com/rust-lang/rust/issues/56537#issuecomment-444880648" target="_blank" title="https://github.com/rust-lang/rust/issues/56537#issuecomment-444880648">recently wrote</a>?</p>



<a name="151008850"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2355526%20error%20on%20closure%20but%20not%20on%20%22equiv%22%20fn/near/151008850" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> pnkfelix <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2355526.20error.20on.20closure.20but.20not.20on.20.22equiv.22.20fn.html#151008850">(Dec 06 2018 at 14:11)</a>:</h4>
<p>no, I think you mean something more subtle.</p>



<a name="151008982"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2355526%20error%20on%20closure%20but%20not%20on%20%22equiv%22%20fn/near/151008982" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2355526.20error.20on.20closure.20but.20not.20on.20.22equiv.22.20fn.html#151008982">(Dec 06 2018 at 14:13)</a>:</h4>
<p>well what you wrote is along similar lines</p>



<a name="151009060"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2355526%20error%20on%20closure%20but%20not%20on%20%22equiv%22%20fn/near/151009060" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2355526.20error.20on.20closure.20but.20not.20on.20.22equiv.22.20fn.html#151009060">(Dec 06 2018 at 14:14)</a>:</h4>
<blockquote>
<p>I do wonder whether closures are sufficiently different from <code>fn</code> items that the standard arguments for the existing lifetime elision rules simply don't hold up</p>
</blockquote>
<p>it may be true, but there is a strong sort of 'consistency argument' going on too. I don't know how to square those things.</p>



<a name="151009081"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2355526%20error%20on%20closure%20but%20not%20on%20%22equiv%22%20fn/near/151009081" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2355526.20error.20on.20closure.20but.20not.20on.20.22equiv.22.20fn.html#151009081">(Dec 06 2018 at 14:15)</a>:</h4>
<p><span class="user-mention" data-user-id="116083">@pnkfelix</span> if I understood what you wrote, you're saying "maybe we should just give people the ability to use named lifetimes and then have them use it instead of elision"</p>



<a name="151009085"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2355526%20error%20on%20closure%20but%20not%20on%20%22equiv%22%20fn/near/151009085" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2355526.20error.20on.20closure.20but.20not.20on.20.22equiv.22.20fn.html#151009085">(Dec 06 2018 at 14:15)</a>:</h4>
<p>right?</p>



<a name="151009102"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2355526%20error%20on%20closure%20but%20not%20on%20%22equiv%22%20fn/near/151009102" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> pnkfelix <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2355526.20error.20on.20closure.20but.20not.20on.20.22equiv.22.20fn.html#151009102">(Dec 06 2018 at 14:15)</a>:</h4>
<p>yes, the ability to name the lifetime parameters on a closure</p>



<a name="151009105"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2355526%20error%20on%20closure%20but%20not%20on%20%22equiv%22%20fn/near/151009105" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2355526.20error.20on.20closure.20but.20not.20on.20.22equiv.22.20fn.html#151009105">(Dec 06 2018 at 14:15)</a>:</h4>
<p>I could imagine e.g. deprecating closure return type annotations that elide lifetimes</p>



<a name="151009108"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2355526%20error%20on%20closure%20but%20not%20on%20%22equiv%22%20fn/near/151009108" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2355526.20error.20on.20closure.20but.20not.20on.20.22equiv.22.20fn.html#151009108">(Dec 06 2018 at 14:15)</a>:</h4>
<p>(if they don't follow elision)</p>



<a name="151009158"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2355526%20error%20on%20closure%20but%20not%20on%20%22equiv%22%20fn/near/151009158" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2355526.20error.20on.20closure.20but.20not.20on.20.22equiv.22.20fn.html#151009158">(Dec 06 2018 at 14:16)</a>:</h4>
<p>and thus guiding people towards explicit named lifetimes, as you suggested</p>



<a name="151009174"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2355526%20error%20on%20closure%20but%20not%20on%20%22equiv%22%20fn/near/151009174" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> pnkfelix <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2355526.20error.20on.20closure.20but.20not.20on.20.22equiv.22.20fn.html#151009174">(Dec 06 2018 at 14:16)</a>:</h4>
<p>Right. I don't know what we'd do about elision after that point.</p>



<a name="151009175"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2355526%20error%20on%20closure%20but%20not%20on%20%22equiv%22%20fn/near/151009175" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2355526.20error.20on.20closure.20but.20not.20on.20.22equiv.22.20fn.html#151009175">(Dec 06 2018 at 14:16)</a>:</h4>
<p>I was hoping for some syntax that would also give you explicit, but I have no idea what that would be</p>



<a name="151009197"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2355526%20error%20on%20closure%20but%20not%20on%20%22equiv%22%20fn/near/151009197" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> pnkfelix <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2355526.20error.20on.20closure.20but.20not.20on.20.22equiv.22.20fn.html#151009197">(Dec 06 2018 at 14:16)</a>:</h4>
<p>I don't understand what you mean by "would also give you explicit"</p>



<a name="151009332"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2355526%20error%20on%20closure%20but%20not%20on%20%22equiv%22%20fn/near/151009332" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> pnkfelix <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2355526.20error.20on.20closure.20but.20not.20on.20.22equiv.22.20fn.html#151009332">(Dec 06 2018 at 14:18)</a>:</h4>
<p>maybe I need to rephrase: where does <code>for &lt;'r1, 'r2&gt; |a1: &amp;'r1 _, a2: TyCtor&lt;'r2, _&gt;| -&gt; &amp;'r2 _ { ... }</code> fall down?</p>



<a name="151009362"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2355526%20error%20on%20closure%20but%20not%20on%20%22equiv%22%20fn/near/151009362" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> pnkfelix <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2355526.20error.20on.20closure.20but.20not.20on.20.22equiv.22.20fn.html#151009362">(Dec 06 2018 at 14:18)</a>:</h4>
<p>because i have been assuming that gives you all the explicitness you might need</p>



<a name="151009389"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2355526%20error%20on%20closure%20but%20not%20on%20%22equiv%22%20fn/near/151009389" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> pnkfelix <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2355526.20error.20on.20closure.20but.20not.20on.20.22equiv.22.20fn.html#151009389">(Dec 06 2018 at 14:19)</a>:</h4>
<p>(modulo potentially having to plug in more concrete type information into the <code>_</code>'s that I put into that example.)</p>



<a name="151009525"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2355526%20error%20on%20closure%20but%20not%20on%20%22equiv%22%20fn/near/151009525" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2355526.20error.20on.20closure.20but.20not.20on.20.22equiv.22.20fn.html#151009525">(Dec 06 2018 at 14:21)</a>:</h4>
<blockquote>
<p>because i have been assuming that gives you all the explicitness you might need</p>
</blockquote>
<p>it does</p>



<a name="151009539"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2355526%20error%20on%20closure%20but%20not%20on%20%22equiv%22%20fn/near/151009539" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2355526.20error.20on.20closure.20but.20not.20on.20.22equiv.22.20fn.html#151009539">(Dec 06 2018 at 14:21)</a>:</h4>
<p>my concern is just that <code>&amp;str -&gt; &amp;str</code> in closures behaves differently than <strong>everywhere else</strong></p>



<a name="151009545"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2355526%20error%20on%20closure%20but%20not%20on%20%22equiv%22%20fn/near/151009545" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2355526.20error.20on.20closure.20but.20not.20on.20.22equiv.22.20fn.html#151009545">(Dec 06 2018 at 14:21)</a>:</h4>
<p>like, any other place that a <code>-&gt;</code> appears</p>



<a name="151009599"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2355526%20error%20on%20closure%20but%20not%20on%20%22equiv%22%20fn/near/151009599" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2355526.20error.20on.20closure.20but.20not.20on.20.22equiv.22.20fn.html#151009599">(Dec 06 2018 at 14:22)</a>:</h4>
<p>so I would like that to be deprecated, if it's not going to mean the same thing</p>



<a name="151009604"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2355526%20error%20on%20closure%20but%20not%20on%20%22equiv%22%20fn/near/151009604" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> pnkfelix <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2355526.20error.20on.20closure.20but.20not.20on.20.22equiv.22.20fn.html#151009604">(Dec 06 2018 at 14:22)</a>:</h4>
<p>right. But my claim is that closures are the only place where the <code>-&gt; &amp;str</code> can have a useful lifetime attached to it that <em>isn't</em> the argument's</p>



<a name="151009609"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2355526%20error%20on%20closure%20but%20not%20on%20%22equiv%22%20fn/near/151009609" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> pnkfelix <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2355526.20error.20on.20closure.20but.20not.20on.20.22equiv.22.20fn.html#151009609">(Dec 06 2018 at 14:22)</a>:</h4>
<p>Ah okay</p>



<a name="151009611"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2355526%20error%20on%20closure%20but%20not%20on%20%22equiv%22%20fn/near/151009611" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2355526.20error.20on.20closure.20but.20not.20on.20.22equiv.22.20fn.html#151009611">(Dec 06 2018 at 14:22)</a>:</h4>
<p>that's not true</p>



<a name="151009623"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2355526%20error%20on%20closure%20but%20not%20on%20%22equiv%22%20fn/near/151009623" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2355526.20error.20on.20closure.20but.20not.20on.20.22equiv.22.20fn.html#151009623">(Dec 06 2018 at 14:22)</a>:</h4>
<p>e.g., </p>
<div class="codehilite"><pre><span></span><span class="k">trait</span><span class="w"> </span><span class="n">Foo</span><span class="o">&lt;</span><span class="na">&#39;a</span><span class="o">&gt;</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">  </span><span class="k">fn</span> <span class="nf">bar</span><span class="p">(</span><span class="o">&amp;</span><span class="bp">self</span><span class="p">)</span><span class="w"> </span>-&gt; <span class="kp">&amp;</span><span class="na">&#39;a</span><span class="w"> </span><span class="kt">u32</span><span class="p">;</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>
</pre></div>



<a name="151009629"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2355526%20error%20on%20closure%20but%20not%20on%20%22equiv%22%20fn/near/151009629" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> pnkfelix <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2355526.20error.20on.20closure.20but.20not.20on.20.22equiv.22.20fn.html#151009629">(Dec 06 2018 at 14:22)</a>:</h4>
<p>okay yes methods are the counter example.</p>



<a name="151009642"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2355526%20error%20on%20closure%20but%20not%20on%20%22equiv%22%20fn/near/151009642" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2355526.20error.20on.20closure.20but.20not.20on.20.22equiv.22.20fn.html#151009642">(Dec 06 2018 at 14:23)</a>:</h4>
<p>this is of course what closures are desugaring to</p>



<a name="151009651"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2355526%20error%20on%20closure%20but%20not%20on%20%22equiv%22%20fn/near/151009651" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2355526.20error.20on.20closure.20but.20not.20on.20.22equiv.22.20fn.html#151009651">(Dec 06 2018 at 14:23)</a>:</h4>
<p>in some sense</p>



<a name="151009668"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2355526%20error%20on%20closure%20but%20not%20on%20%22equiv%22%20fn/near/151009668" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2355526.20error.20on.20closure.20but.20not.20on.20.22equiv.22.20fn.html#151009668">(Dec 06 2018 at 14:23)</a>:</h4>
<p>not <em>literally</em> that, I just mean "methods"</p>



<a name="151009674"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2355526%20error%20on%20closure%20but%20not%20on%20%22equiv%22%20fn/near/151009674" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> pnkfelix <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2355526.20error.20on.20closure.20but.20not.20on.20.22equiv.22.20fn.html#151009674">(Dec 06 2018 at 14:23)</a>:</h4>
<p>right</p>



<a name="151009677"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2355526%20error%20on%20closure%20but%20not%20on%20%22equiv%22%20fn/near/151009677" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2355526.20error.20on.20closure.20but.20not.20on.20.22equiv.22.20fn.html#151009677">(Dec 06 2018 at 14:23)</a>:</h4>
<p>"that refer to lifetimes found in the input types of the trait" :)</p>



<a name="151009741"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2355526%20error%20on%20closure%20but%20not%20on%20%22equiv%22%20fn/near/151009741" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2355526.20error.20on.20closure.20but.20not.20on.20.22equiv.22.20fn.html#151009741">(Dec 06 2018 at 14:24)</a>:</h4>
<p>anyway what I was imaging ws something like this:</p>



<a name="151009745"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2355526%20error%20on%20closure%20but%20not%20on%20%22equiv%22%20fn/near/151009745" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2355526.20error.20on.20closure.20but.20not.20on.20.22equiv.22.20fn.html#151009745">(Dec 06 2018 at 14:24)</a>:</h4>
<p>you could <em>imagine</em> saying</p>



<a name="151009768"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2355526%20error%20on%20closure%20but%20not%20on%20%22equiv%22%20fn/near/151009768" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2355526.20error.20on.20closure.20but.20not.20on.20.22equiv.22.20fn.html#151009768">(Dec 06 2018 at 14:24)</a>:</h4>
<p>well hold up</p>



<a name="151009772"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2355526%20error%20on%20closure%20but%20not%20on%20%22equiv%22%20fn/near/151009772" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2355526.20error.20on.20closure.20but.20not.20on.20.22equiv.22.20fn.html#151009772">(Dec 06 2018 at 14:24)</a>:</h4>
<p>so</p>



<a name="151009788"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2355526%20error%20on%20closure%20but%20not%20on%20%22equiv%22%20fn/near/151009788" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2355526.20error.20on.20closure.20but.20not.20on.20.22equiv.22.20fn.html#151009788">(Dec 06 2018 at 14:24)</a>:</h4>
<p>one bit of complexity -- as I wrote -- is that right now</p>



<a name="151009789"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2355526%20error%20on%20closure%20but%20not%20on%20%22equiv%22%20fn/near/151009789" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2355526.20error.20on.20closure.20but.20not.20on.20.22equiv.22.20fn.html#151009789">(Dec 06 2018 at 14:24)</a>:</h4>
<p>we have to reconcile the "expected signature" and the "provided signature"</p>



<a name="151009803"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2355526%20error%20on%20closure%20but%20not%20on%20%22equiv%22%20fn/near/151009803" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2355526.20error.20on.20closure.20but.20not.20on.20.22equiv.22.20fn.html#151009803">(Dec 06 2018 at 14:25)</a>:</h4>
<p>and we currently give "primacy" to the expected signature if it is available</p>



<a name="151009807"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2355526%20error%20on%20closure%20but%20not%20on%20%22equiv%22%20fn/near/151009807" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2355526.20error.20on.20closure.20but.20not.20on.20.22equiv.22.20fn.html#151009807">(Dec 06 2018 at 14:25)</a>:</h4>
<p>(make sense?)</p>



<a name="151009820"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2355526%20error%20on%20closure%20but%20not%20on%20%22equiv%22%20fn/near/151009820" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2355526.20error.20on.20closure.20but.20not.20on.20.22equiv.22.20fn.html#151009820">(Dec 06 2018 at 14:25)</a>:</h4>
<p>what I was imagining was: maybe there is some syntax that lets you provide the full, explicit signature of the closure (no <code>_</code> or inference)</p>



<a name="151009825"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2355526%20error%20on%20closure%20but%20not%20on%20%22equiv%22%20fn/near/151009825" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2355526.20error.20on.20closure.20but.20not.20on.20.22equiv.22.20fn.html#151009825">(Dec 06 2018 at 14:25)</a>:</h4>
<p>and that if you use <em>this</em> syntax, you get elision</p>



<a name="151009830"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2355526%20error%20on%20closure%20but%20not%20on%20%22equiv%22%20fn/near/151009830" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2355526.20error.20on.20closure.20but.20not.20on.20.22equiv.22.20fn.html#151009830">(Dec 06 2018 at 14:25)</a>:</h4>
<p>but I don't know what that syntax is</p>



<a name="151009831"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2355526%20error%20on%20closure%20but%20not%20on%20%22equiv%22%20fn/near/151009831" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> pnkfelix <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2355526.20error.20on.20closure.20but.20not.20on.20.22equiv.22.20fn.html#151009831">(Dec 06 2018 at 14:25)</a>:</h4>
<p>i think so... though I had been assuming that we still enforce some notion of compatibility between the expected sig and the provided sig</p>



<a name="151009841"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2355526%20error%20on%20closure%20but%20not%20on%20%22equiv%22%20fn/near/151009841" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2355526.20error.20on.20closure.20but.20not.20on.20.22equiv.22.20fn.html#151009841">(Dec 06 2018 at 14:26)</a>:</h4>
<p>yes we enforce that the provided sig is an "instance" of the expected sig</p>



<a name="151009888"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2355526%20error%20on%20closure%20but%20not%20on%20%22equiv%22%20fn/near/151009888" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> pnkfelix <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2355526.20error.20on.20closure.20but.20not.20on.20.22equiv.22.20fn.html#151009888">(Dec 06 2018 at 14:26)</a>:</h4>
<p>okay yes that the substitution you had talked about, okay</p>



<a name="151009913"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2355526%20error%20on%20closure%20but%20not%20on%20%22equiv%22%20fn/near/151009913" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2355526.20error.20on.20closure.20but.20not.20on.20.22equiv.22.20fn.html#151009913">(Dec 06 2018 at 14:26)</a>:</h4>
<p>as a (horrible) strawperson, imagine</p>
<div class="codehilite"><pre><span></span>|x| as fn(&amp;str) -&gt; &amp;str { x }
</pre></div>



<a name="151009935"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2355526%20error%20on%20closure%20but%20not%20on%20%22equiv%22%20fn/near/151009935" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> pnkfelix <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2355526.20error.20on.20closure.20but.20not.20on.20.22equiv.22.20fn.html#151009935">(Dec 06 2018 at 14:27)</a>:</h4>
<blockquote>
<p>what I was imagining was: maybe there is some syntax that lets you provide the full, explicit signature of the closure (no _ or inference)</p>
</blockquote>
<p>this phrasing continues to be confusing. the crucial word its missing, I think, is you want some <strong>new</strong> syntax.</p>



<a name="151009942"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2355526%20error%20on%20closure%20but%20not%20on%20%22equiv%22%20fn/near/151009942" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2355526.20error.20on.20closure.20but.20not.20on.20.22equiv.22.20fn.html#151009942">(Dec 06 2018 at 14:27)</a>:</h4>
<p>anyway what you suggested (plus maybe deprecation) maybe ultimately a better plan</p>



<a name="151009952"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2355526%20error%20on%20closure%20but%20not%20on%20%22equiv%22%20fn/near/151009952" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2355526.20error.20on.20closure.20but.20not.20on.20.22equiv.22.20fn.html#151009952">(Dec 06 2018 at 14:27)</a>:</h4>
<p>ah, yes, some <strong>new</strong> syntax :)</p>



<a name="151009963"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2355526%20error%20on%20closure%20but%20not%20on%20%22equiv%22%20fn/near/151009963" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> pnkfelix <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2355526.20error.20on.20closure.20but.20not.20on.20.22equiv.22.20fn.html#151009963">(Dec 06 2018 at 14:27)</a>:</h4>
<p>i.e. one can encode explicit signature using existing syntax, but our whole problem is that we have a given semantics for how elision operates on (or rather, ignores) that syntax.</p>



<a name="151009969"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2355526%20error%20on%20closure%20but%20not%20on%20%22equiv%22%20fn/near/151009969" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2355526.20error.20on.20closure.20but.20not.20on.20.22equiv.22.20fn.html#151009969">(Dec 06 2018 at 14:27)</a>:</h4>
<p>well that and</p>



<a name="151010015"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2355526%20error%20on%20closure%20but%20not%20on%20%22equiv%22%20fn/near/151010015" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2355526.20error.20on.20closure.20but.20not.20on.20.22equiv.22.20fn.html#151010015">(Dec 06 2018 at 14:28)</a>:</h4>
<p>the current syntax can be incomplete</p>



<a name="151010023"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2355526%20error%20on%20closure%20but%20not%20on%20%22equiv%22%20fn/near/151010023" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2355526.20error.20on.20closure.20but.20not.20on.20.22equiv.22.20fn.html#151010023">(Dec 06 2018 at 14:28)</a>:</h4>
<p>it permits you to annotate one parameter and not the other, etc</p>



<a name="151010040"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2355526%20error%20on%20closure%20but%20not%20on%20%22equiv%22%20fn/near/151010040" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2355526.20error.20on.20closure.20but.20not.20on.20.22equiv.22.20fn.html#151010040">(Dec 06 2018 at 14:28)</a>:</h4>
<p>which gets us into trouble and makes it hard to see how to apply elision</p>



<a name="151010053"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2355526%20error%20on%20closure%20but%20not%20on%20%22equiv%22%20fn/near/151010053" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> pnkfelix <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2355526.20error.20on.20closure.20but.20not.20on.20.22equiv.22.20fn.html#151010053">(Dec 06 2018 at 14:28)</a>:</h4>
<p>yes, but I figured it was "obvious" that one could restrict one's attention to only when all annotations are provided.</p>



<a name="151010055"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2355526%20error%20on%20closure%20but%20not%20on%20%22equiv%22%20fn/near/151010055" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2355526.20error.20on.20closure.20but.20not.20on.20.22equiv.22.20fn.html#151010055">(Dec 06 2018 at 14:28)</a>:</h4>
<p>e.g., your example of <code>|x| -&gt; &amp;str { .. }</code></p>



<a name="151010066"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2355526%20error%20on%20closure%20but%20not%20on%20%22equiv%22%20fn/near/151010066" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2355526.20error.20on.20closure.20but.20not.20on.20.22equiv.22.20fn.html#151010066">(Dec 06 2018 at 14:28)</a>:</h4>
<p>well, that's not obvious to me :)</p>



<a name="151010084"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2355526%20error%20on%20closure%20but%20not%20on%20%22equiv%22%20fn/near/151010084" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2355526.20error.20on.20closure.20but.20not.20on.20.22equiv.22.20fn.html#151010084">(Dec 06 2018 at 14:29)</a>:</h4>
<p>i.e., does elision start to apply when "all annotations" are provided?</p>



<a name="151010085"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2355526%20error%20on%20closure%20but%20not%20on%20%22equiv%22%20fn/near/151010085" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> pnkfelix <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2355526.20error.20on.20closure.20but.20not.20on.20.22equiv.22.20fn.html#151010085">(Dec 06 2018 at 14:29)</a>:</h4>
<p>i.e. <code>|x: _| -&gt; &amp;str { ... }</code> would not have elision applied</p>



<a name="151010101"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2355526%20error%20on%20closure%20but%20not%20on%20%22equiv%22%20fn/near/151010101" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> pnkfelix <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2355526.20error.20on.20closure.20but.20not.20on.20.22equiv.22.20fn.html#151010101">(Dec 06 2018 at 14:29)</a>:</h4>
<p>but <code>|x: &amp;'_ str| -&gt; &amp;str { ... }</code> would.</p>



<a name="151010104"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2355526%20error%20on%20closure%20but%20not%20on%20%22equiv%22%20fn/near/151010104" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2355526.20error.20on.20closure.20but.20not.20on.20.22equiv.22.20fn.html#151010104">(Dec 06 2018 at 14:29)</a>:</h4>
<p>right, we could go that way</p>



<a name="151010107"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2355526%20error%20on%20closure%20but%20not%20on%20%22equiv%22%20fn/near/151010107" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2355526.20error.20on.20closure.20but.20not.20on.20.22equiv.22.20fn.html#151010107">(Dec 06 2018 at 14:29)</a>:</h4>
<p>it seems a bit surprising</p>



<a name="151010120"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2355526%20error%20on%20closure%20but%20not%20on%20%22equiv%22%20fn/near/151010120" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2355526.20error.20on.20closure.20but.20not.20on.20.22equiv.22.20fn.html#151010120">(Dec 06 2018 at 14:29)</a>:</h4>
<p>but I don't know that there's a perfect answer here</p>



<a name="151010126"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2355526%20error%20on%20closure%20but%20not%20on%20%22equiv%22%20fn/near/151010126" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> pnkfelix <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2355526.20error.20on.20closure.20but.20not.20on.20.22equiv.22.20fn.html#151010126">(Dec 06 2018 at 14:29)</a>:</h4>
<p>yes, it would be surprising</p>



<a name="151010128"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2355526%20error%20on%20closure%20but%20not%20on%20%22equiv%22%20fn/near/151010128" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> pnkfelix <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2355526.20error.20on.20closure.20but.20not.20on.20.22equiv.22.20fn.html#151010128">(Dec 06 2018 at 14:29)</a>:</h4>
<p>but then again</p>



<a name="151010136"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2355526%20error%20on%20closure%20but%20not%20on%20%22equiv%22%20fn/near/151010136" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2355526.20error.20on.20closure.20but.20not.20on.20.22equiv.22.20fn.html#151010136">(Dec 06 2018 at 14:29)</a>:</h4>
<p>that said, I think that explicit return type annot are unusual</p>



<a name="151010190"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2355526%20error%20on%20closure%20but%20not%20on%20%22equiv%22%20fn/near/151010190" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> pnkfelix <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2355526.20error.20on.20closure.20but.20not.20on.20.22equiv.22.20fn.html#151010190">(Dec 06 2018 at 14:30)</a>:</h4>
<p>I was surprised that you expected the introduction of <code>-&gt; &amp;str</code> to make a difference.</p>



<a name="151010201"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2355526%20error%20on%20closure%20but%20not%20on%20%22equiv%22%20fn/near/151010201" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2355526.20error.20on.20closure.20but.20not.20on.20.22equiv.22.20fn.html#151010201">(Dec 06 2018 at 14:30)</a>:</h4>
<p>hence my thought "maybe we can just deprecate elision in that position"</p>



<a name="151010215"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2355526%20error%20on%20closure%20but%20not%20on%20%22equiv%22%20fn/near/151010215" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2355526.20error.20on.20closure.20but.20not.20on.20.22equiv.22.20fn.html#151010215">(Dec 06 2018 at 14:30)</a>:</h4>
<p>and instead require you to use an explicit syntax</p>



<a name="151010236"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2355526%20error%20on%20closure%20but%20not%20on%20%22equiv%22%20fn/near/151010236" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2355526.20error.20on.20closure.20but.20not.20on.20.22equiv.22.20fn.html#151010236">(Dec 06 2018 at 14:30)</a>:</h4>
<blockquote>
<p>I was surprised that you expected the introduction of <code>-&gt; &amp;str</code> to make a difference.</p>
</blockquote>
<p>you mean way back in the original example?</p>



<a name="151010237"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2355526%20error%20on%20closure%20but%20not%20on%20%22equiv%22%20fn/near/151010237" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> pnkfelix <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2355526.20error.20on.20closure.20but.20not.20on.20.22equiv.22.20fn.html#151010237">(Dec 06 2018 at 14:30)</a>:</h4>
<p>as in, if you have a return type, <code>'_</code> (explicit or implicit) is unacceptable?</p>



<a name="151010242"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2355526%20error%20on%20closure%20but%20not%20on%20%22equiv%22%20fn/near/151010242" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2355526.20error.20on.20closure.20but.20not.20on.20.22equiv.22.20fn.html#151010242">(Dec 06 2018 at 14:30)</a>:</h4>
<p>right</p>



<a name="151010260"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2355526%20error%20on%20closure%20but%20not%20on%20%22equiv%22%20fn/near/151010260" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2355526.20error.20on.20closure.20but.20not.20on.20.22equiv.22.20fn.html#151010260">(Dec 06 2018 at 14:31)</a>:</h4>
<p>I mean it returns its current meaning, presumably, but since that is different from any other return type</p>



<a name="151010262"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2355526%20error%20on%20closure%20but%20not%20on%20%22equiv%22%20fn/near/151010262" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> pnkfelix <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2355526.20error.20on.20closure.20but.20not.20on.20.22equiv.22.20fn.html#151010262">(Dec 06 2018 at 14:31)</a>:</h4>
<blockquote>
<blockquote>
<p>I was surprised that you expected the introduction of <code>-&gt; &amp;str</code> to make a difference.</p>
</blockquote>
<p>you mean way back in the original example?</p>
</blockquote>
<p>yes. That is my way of just saying we already have a "surprise budget"</p>



<a name="151010266"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2355526%20error%20on%20closure%20but%20not%20on%20%22equiv%22%20fn/near/151010266" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2355526.20error.20on.20closure.20but.20not.20on.20.22equiv.22.20fn.html#151010266">(Dec 06 2018 at 14:31)</a>:</h4>
<p>well</p>



<a name="151010268"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2355526%20error%20on%20closure%20but%20not%20on%20%22equiv%22%20fn/near/151010268" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2355526.20error.20on.20closure.20but.20not.20on.20.22equiv.22.20fn.html#151010268">(Dec 06 2018 at 14:31)</a>:</h4>
<p>I view that as a "quasi-bug"</p>



<a name="151010284"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2355526%20error%20on%20closure%20but%20not%20on%20%22equiv%22%20fn/near/151010284" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2355526.20error.20on.20closure.20but.20not.20on.20.22equiv.22.20fn.html#151010284">(Dec 06 2018 at 14:31)</a>:</h4>
<p>i.e., when you have <code>-&gt; _</code> in a closure, we presently require a type that is "early bound"</p>



<a name="151010295"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2355526%20error%20on%20closure%20but%20not%20on%20%22equiv%22%20fn/near/151010295" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2355526.20error.20on.20closure.20but.20not.20on.20.22equiv.22.20fn.html#151010295">(Dec 06 2018 at 14:32)</a>:</h4>
<p>but I think it would be better if we could infer a type that may refer to argument lifetimes</p>



<a name="151010347"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2355526%20error%20on%20closure%20but%20not%20on%20%22equiv%22%20fn/near/151010347" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2355526.20error.20on.20closure.20but.20not.20on.20.22equiv.22.20fn.html#151010347">(Dec 06 2018 at 14:32)</a>:</h4>
<p>(in which case maybe <code>-&gt; &amp;str</code> <em>would</em> be ok?)</p>



<a name="151010353"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2355526%20error%20on%20closure%20but%20not%20on%20%22equiv%22%20fn/near/151010353" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> pnkfelix <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2355526.20error.20on.20closure.20but.20not.20on.20.22equiv.22.20fn.html#151010353">(Dec 06 2018 at 14:32)</a>:</h4>
<p>.... okay and that would bring us back to the POV that I was trying to espouse</p>



<a name="151010356"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2355526%20error%20on%20closure%20but%20not%20on%20%22equiv%22%20fn/near/151010356" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> pnkfelix <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2355526.20error.20on.20closure.20but.20not.20on.20.22equiv.22.20fn.html#151010356">(Dec 06 2018 at 14:32)</a>:</h4>
<p>when we were speaking yesterday...</p>



<a name="151010390"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2355526%20error%20on%20closure%20but%20not%20on%20%22equiv%22%20fn/near/151010390" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2355526.20error.20on.20closure.20but.20not.20on.20.22equiv.22.20fn.html#151010390">(Dec 06 2018 at 14:33)</a>:</h4>
<p>er by which I mean: maybe <code>-&gt; &amp;str</code> would no longer be surprising, because it works "sort of like" elision, even though in fact it's more general. By "sort of like" I mean that: we are checking that the signature you gave is "an instance" of what was needed, and so if elision (<code>&amp;'a str -&gt; &amp;'a str</code>) was needed, it would be an instance of that</p>



<a name="151010480"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2355526%20error%20on%20closure%20but%20not%20on%20%22equiv%22%20fn/near/151010480" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> pnkfelix <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2355526.20error.20on.20closure.20but.20not.20on.20.22equiv.22.20fn.html#151010480">(Dec 06 2018 at 14:34)</a>:</h4>
<p>huh</p>



<a name="151010498"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2355526%20error%20on%20closure%20but%20not%20on%20%22equiv%22%20fn/near/151010498" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> pnkfelix <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2355526.20error.20on.20closure.20but.20not.20on.20.22equiv.22.20fn.html#151010498">(Dec 06 2018 at 14:34)</a>:</h4>
<p>so rather than uniformly applying elision in ... syntactic (?) manner ...</p>



<a name="151010534"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2355526%20error%20on%20closure%20but%20not%20on%20%22equiv%22%20fn/near/151010534" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> pnkfelix <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2355526.20error.20on.20closure.20but.20not.20on.20.22equiv.22.20fn.html#151010534">(Dec 06 2018 at 14:35)</a>:</h4>
<p>we would potentially check different instantiations of the generalized signature, until we found something that worked?</p>



<a name="151010556"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2355526%20error%20on%20closure%20but%20not%20on%20%22equiv%22%20fn/near/151010556" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2355526.20error.20on.20closure.20but.20not.20on.20.22equiv.22.20fn.html#151010556">(Dec 06 2018 at 14:35)</a>:</h4>
<p>no</p>



<a name="151010605"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2355526%20error%20on%20closure%20but%20not%20on%20%22equiv%22%20fn/near/151010605" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2355526.20error.20on.20closure.20but.20not.20on.20.22equiv.22.20fn.html#151010605">(Dec 06 2018 at 14:36)</a>:</h4>
<p>I mean maybe yes but that mechanism suggests some sort of "search"</p>



<a name="151010609"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2355526%20error%20on%20closure%20but%20not%20on%20%22equiv%22%20fn/near/151010609" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> pnkfelix <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2355526.20error.20on.20closure.20but.20not.20on.20.22equiv.22.20fn.html#151010609">(Dec 06 2018 at 14:36)</a>:</h4>
<p>That's why I said "huh"</p>



<a name="151010622"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2355526%20error%20on%20closure%20but%20not%20on%20%22equiv%22%20fn/near/151010622" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> pnkfelix <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2355526.20error.20on.20closure.20but.20not.20on.20.22equiv.22.20fn.html#151010622">(Dec 06 2018 at 14:36)</a>:</h4>
<p>Adding "more" search to rustc seems bad. :)</p>



<a name="151010637"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2355526%20error%20on%20closure%20but%20not%20on%20%22equiv%22%20fn/near/151010637" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2355526.20error.20on.20closure.20but.20not.20on.20.22equiv.22.20fn.html#151010637">(Dec 06 2018 at 14:36)</a>:</h4>
<p>I am just saying that if our inference was able to do (the equivalent of) "let generalization"</p>



<a name="151010666"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2355526%20error%20on%20closure%20but%20not%20on%20%22equiv%22%20fn/near/151010666" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2355526.20error.20on.20closure.20but.20not.20on.20.22equiv.22.20fn.html#151010666">(Dec 06 2018 at 14:37)</a>:</h4>
<p>it would make <code>|x: &amp;str| -&gt; &amp;str { x }</code> infer to an elision signature</p>



<a name="151010668"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2355526%20error%20on%20closure%20but%20not%20on%20%22equiv%22%20fn/near/151010668" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> pnkfelix <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2355526.20error.20on.20closure.20but.20not.20on.20.22equiv.22.20fn.html#151010668">(Dec 06 2018 at 14:37)</a>:</h4>
<p>okay that might be an analogy I could understand</p>



<a name="151010687"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2355526%20error%20on%20closure%20but%20not%20on%20%22equiv%22%20fn/near/151010687" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2355526.20error.20on.20closure.20but.20not.20on.20.22equiv.22.20fn.html#151010687">(Dec 06 2018 at 14:37)</a>:</h4>
<p>even though it would <em>also</em> accept <code>|x: &amp;str, y: &amp;str| -&gt; &amp;str { x }</code></p>



<a name="151010690"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2355526%20error%20on%20closure%20but%20not%20on%20%22equiv%22%20fn/near/151010690" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2355526.20error.20on.20closure.20but.20not.20on.20.22equiv.22.20fn.html#151010690">(Dec 06 2018 at 14:37)</a>:</h4>
<p>which elision would not</p>



<a name="151010701"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2355526%20error%20on%20closure%20but%20not%20on%20%22equiv%22%20fn/near/151010701" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2355526.20error.20on.20closure.20but.20not.20on.20.22equiv.22.20fn.html#151010701">(Dec 06 2018 at 14:37)</a>:</h4>
<p>(that would be an error outside of a closure)</p>



<a name="151010757"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2355526%20error%20on%20closure%20but%20not%20on%20%22equiv%22%20fn/near/151010757" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> pnkfelix <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2355526.20error.20on.20closure.20but.20not.20on.20.22equiv.22.20fn.html#151010757">(Dec 06 2018 at 14:38)</a>:</h4>
<p>mmm</p>



<a name="151010761"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2355526%20error%20on%20closure%20but%20not%20on%20%22equiv%22%20fn/near/151010761" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2355526.20error.20on.20closure.20but.20not.20on.20.22equiv.22.20fn.html#151010761">(Dec 06 2018 at 14:38)</a>:</h4>
<p>(all of this is assuming no "expected signature" of course)</p>



<a name="151010763"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2355526%20error%20on%20closure%20but%20not%20on%20%22equiv%22%20fn/near/151010763" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> pnkfelix <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2355526.20error.20on.20closure.20but.20not.20on.20.22equiv.22.20fn.html#151010763">(Dec 06 2018 at 14:38)</a>:</h4>
<p>maybe revise those examples to put <code>...</code> in the body</p>



<a name="151010766"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2355526%20error%20on%20closure%20but%20not%20on%20%22equiv%22%20fn/near/151010766" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2355526.20error.20on.20closure.20but.20not.20on.20.22equiv.22.20fn.html#151010766">(Dec 06 2018 at 14:38)</a>:</h4>
<p>no</p>



<a name="151010768"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2355526%20error%20on%20closure%20but%20not%20on%20%22equiv%22%20fn/near/151010768" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2355526.20error.20on.20closure.20but.20not.20on.20.22equiv.22.20fn.html#151010768">(Dec 06 2018 at 14:38)</a>:</h4>
<p>the bdoy is important</p>



<a name="151010772"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2355526%20error%20on%20closure%20but%20not%20on%20%22equiv%22%20fn/near/151010772" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> pnkfelix <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2355526.20error.20on.20closure.20but.20not.20on.20.22equiv.22.20fn.html#151010772">(Dec 06 2018 at 14:38)</a>:</h4>
<p>that is, I want to be clear about when our rules use the body text</p>



<a name="151010777"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2355526%20error%20on%20closure%20but%20not%20on%20%22equiv%22%20fn/near/151010777" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2355526.20error.20on.20closure.20but.20not.20on.20.22equiv.22.20fn.html#151010777">(Dec 06 2018 at 14:38)</a>:</h4>
<p>the point is</p>



<a name="151010782"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2355526%20error%20on%20closure%20but%20not%20on%20%22equiv%22%20fn/near/151010782" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2355526.20error.20on.20closure.20but.20not.20on.20.22equiv.22.20fn.html#151010782">(Dec 06 2018 at 14:38)</a>:</h4>
<p>we would type-check the body</p>



<a name="151010783"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2355526%20error%20on%20closure%20but%20not%20on%20%22equiv%22%20fn/near/151010783" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> pnkfelix <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2355526.20error.20on.20closure.20but.20not.20on.20.22equiv.22.20fn.html#151010783">(Dec 06 2018 at 14:38)</a>:</h4>
<p>Okay so then you are willing to use the body text in this case</p>



<a name="151010784"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2355526%20error%20on%20closure%20but%20not%20on%20%22equiv%22%20fn/near/151010784" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2355526.20error.20on.20closure.20but.20not.20on.20.22equiv.22.20fn.html#151010784">(Dec 06 2018 at 14:38)</a>:</h4>
<p>we would observe the resulting constraints</p>



<a name="151010792"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2355526%20error%20on%20closure%20but%20not%20on%20%22equiv%22%20fn/near/151010792" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2355526.20error.20on.20closure.20but.20not.20on.20.22equiv.22.20fn.html#151010792">(Dec 06 2018 at 14:38)</a>:</h4>
<p>we would observe that the return type lifetime only flows from the input <code>x</code></p>



<a name="151010804"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2355526%20error%20on%20closure%20but%20not%20on%20%22equiv%22%20fn/near/151010804" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2355526.20error.20on.20closure.20but.20not.20on.20.22equiv.22.20fn.html#151010804">(Dec 06 2018 at 14:39)</a>:</h4>
<p>and hence infer <code>for&lt;'a&gt; (&amp;'a u32, &amp;'b u32) -&gt; &amp;'a u32</code> as the signature of the closure</p>



<a name="151010812"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2355526%20error%20on%20closure%20but%20not%20on%20%22equiv%22%20fn/near/151010812" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2355526.20error.20on.20closure.20but.20not.20on.20.22equiv.22.20fn.html#151010812">(Dec 06 2018 at 14:39)</a>:</h4>
<p>(this is how "let generalization" works)</p>



<a name="151010818"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2355526%20error%20on%20closure%20but%20not%20on%20%22equiv%22%20fn/near/151010818" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2355526.20error.20on.20closure.20but.20not.20on.20.22equiv.22.20fn.html#151010818">(Dec 06 2018 at 14:39)</a>:</h4>
<p>essentially once you've type-checked the closure body, you examine the constraints that arose from that</p>



<a name="151010834"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2355526%20error%20on%20closure%20but%20not%20on%20%22equiv%22%20fn/near/151010834" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2355526.20error.20on.20closure.20but.20not.20on.20.22equiv.22.20fn.html#151010834">(Dec 06 2018 at 14:39)</a>:</h4>
<p>(in the case of ML, you do it at the point of <code>let func arg = body</code>, hence the term "let generalization")</p>



<a name="151010883"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2355526%20error%20on%20closure%20but%20not%20on%20%22equiv%22%20fn/near/151010883" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> pnkfelix <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2355526.20error.20on.20closure.20but.20not.20on.20.22equiv.22.20fn.html#151010883">(Dec 06 2018 at 14:40)</a>:</h4>
<p>but how far does this go? what does <code>|x: &amp;str, y: &amp;str| -&gt; &amp;str { if TEST { x } else { y } }</code> do in your scheme?</p>



<a name="151010893"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2355526%20error%20on%20closure%20but%20not%20on%20%22equiv%22%20fn/near/151010893" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2355526.20error.20on.20closure.20but.20not.20on.20.22equiv.22.20fn.html#151010893">(Dec 06 2018 at 14:40)</a>:</h4>
<p>it infers <code>x: &amp;'a str, y: &amp;'a str -&gt; &amp;'a str</code></p>



<a name="151010896"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2355526%20error%20on%20closure%20but%20not%20on%20%22equiv%22%20fn/near/151010896" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2355526.20error.20on.20closure.20but.20not.20on.20.22equiv.22.20fn.html#151010896">(Dec 06 2018 at 14:40)</a>:</h4>
<p>presumably</p>



<a name="151010904"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2355526%20error%20on%20closure%20but%20not%20on%20%22equiv%22%20fn/near/151010904" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2355526.20error.20on.20closure.20but.20not.20on.20.22equiv.22.20fn.html#151010904">(Dec 06 2018 at 14:40)</a>:</h4>
<p>I don't know how to do this, mind you, I just feel like we "should" be able to do it, at least some of the time</p>



<a name="151010920"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2355526%20error%20on%20closure%20but%20not%20on%20%22equiv%22%20fn/near/151010920" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2355526.20error.20on.20closure.20but.20not.20on.20.22equiv.22.20fn.html#151010920">(Dec 06 2018 at 14:40)</a>:</h4>
<p>that is what we would need to accept the original code I think</p>



<a name="151010927"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2355526%20error%20on%20closure%20but%20not%20on%20%22equiv%22%20fn/near/151010927" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> pnkfelix <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2355526.20error.20on.20closure.20but.20not.20on.20.22equiv.22.20fn.html#151010927">(Dec 06 2018 at 14:41)</a>:</h4>
<p>okay</p>



<a name="151010941"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2355526%20error%20on%20closure%20but%20not%20on%20%22equiv%22%20fn/near/151010941" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2355526.20error.20on.20closure.20but.20not.20on.20.22equiv.22.20fn.html#151010941">(Dec 06 2018 at 14:41)</a>:</h4>
<p>the only reason it's complicated is subtyping I guess</p>



<a name="151010951"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2355526%20error%20on%20closure%20but%20not%20on%20%22equiv%22%20fn/near/151010951" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2355526.20error.20on.20closure.20but.20not.20on.20.22equiv.22.20fn.html#151010951">(Dec 06 2018 at 14:41)</a>:</h4>
<p>so e.g. your example probably <em>really</em> infers</p>



<a name="151010976"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2355526%20error%20on%20closure%20but%20not%20on%20%22equiv%22%20fn/near/151010976" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2355526.20error.20on.20closure.20but.20not.20on.20.22equiv.22.20fn.html#151010976">(Dec 06 2018 at 14:41)</a>:</h4>
<p><code>for&lt;'a, 'b, 'c&gt; (x: &amp;'a str, y: &amp;'b str) -&gt; &amp;'c str where 'a: 'c, 'b: 'c</code></p>



<a name="151010978"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2355526%20error%20on%20closure%20but%20not%20on%20%22equiv%22%20fn/near/151010978" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2355526.20error.20on.20closure.20but.20not.20on.20.22equiv.22.20fn.html#151010978">(Dec 06 2018 at 14:41)</a>:</h4>
<p>or at least <em>wants to</em></p>



<a name="151011022"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2355526%20error%20on%20closure%20but%20not%20on%20%22equiv%22%20fn/near/151011022" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2355526.20error.20on.20closure.20but.20not.20on.20.22equiv.22.20fn.html#151011022">(Dec 06 2018 at 14:42)</a>:</h4>
<p>but I don't know if it can because of how the closure trait is setup...</p>



<a name="151011048"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2355526%20error%20on%20closure%20but%20not%20on%20%22equiv%22%20fn/near/151011048" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2355526.20error.20on.20closure.20but.20not.20on.20.22equiv.22.20fn.html#151011048">(Dec 06 2018 at 14:42)</a>:</h4>
<p>er, I think we could</p>



<a name="151011071"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2355526%20error%20on%20closure%20but%20not%20on%20%22equiv%22%20fn/near/151011071" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2355526.20error.20on.20closure.20but.20not.20on.20.22equiv.22.20fn.html#151011071">(Dec 06 2018 at 14:42)</a>:</h4>
<p>those where clauses conceptually go on the <code>impl&lt;'a, 'b&gt; Fn&lt;(&amp;'a str, &amp;'b str)&gt; for ClosureType</code></p>



<a name="151011084"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2355526%20error%20on%20closure%20but%20not%20on%20%22equiv%22%20fn/near/151011084" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2355526.20error.20on.20closure.20but.20not.20on.20.22equiv.22.20fn.html#151011084">(Dec 06 2018 at 14:43)</a>:</h4>
<p>well, the challenge is that <code>'c</code> can't appear in the <code>type Output</code> since it does not appear in an input type</p>



<a name="151011101"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2355526%20error%20on%20closure%20but%20not%20on%20%22equiv%22%20fn/near/151011101" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2355526.20error.20on.20closure.20but.20not.20on.20.22equiv.22.20fn.html#151011101">(Dec 06 2018 at 14:43)</a>:</h4>
<p>anyway, this is non-trivial, clearly :)</p>



<a name="151011198"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2355526%20error%20on%20closure%20but%20not%20on%20%22equiv%22%20fn/near/151011198" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> pnkfelix <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2355526.20error.20on.20closure.20but.20not.20on.20.22equiv.22.20fn.html#151011198">(Dec 06 2018 at 14:44)</a>:</h4>
<p><code>for &lt;'a, 'b&gt; (x: &amp;'a str, y: &amp;'b str) -&gt; &amp;'(a \isect b) str</code></p>



<a name="151011232"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2355526%20error%20on%20closure%20but%20not%20on%20%22equiv%22%20fn/near/151011232" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> pnkfelix <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2355526.20error.20on.20closure.20but.20not.20on.20.22equiv.22.20fn.html#151011232">(Dec 06 2018 at 14:45)</a>:</h4>
<p>because, you know, Intersection types are so simple</p>



<a name="151011328"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2355526%20error%20on%20closure%20but%20not%20on%20%22equiv%22%20fn/near/151011328" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2355526.20error.20on.20closure.20but.20not.20on.20.22equiv.22.20fn.html#151011328">(Dec 06 2018 at 14:46)</a>:</h4>
<p>right..</p>



<a name="151011370"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2355526%20error%20on%20closure%20but%20not%20on%20%22equiv%22%20fn/near/151011370" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2355526.20error.20on.20closure.20but.20not.20on.20.22equiv.22.20fn.html#151011370">(Dec 06 2018 at 14:46)</a>:</h4>
<p>I was thinking about that cool paper, I forget the authors, where they extended HM inference with subtyping by tracking upper/lower bounds, then modeled types as finite state machines and applied finite state machine minimization techniques to try and keep the type size under control</p>



<a name="151011385"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2355526%20error%20on%20closure%20but%20not%20on%20%22equiv%22%20fn/near/151011385" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2355526.20error.20on.20closure.20but.20not.20on.20.22equiv.22.20fn.html#151011385">(Dec 06 2018 at 14:46)</a>:</h4>
<p>I've been meaning to re-implement that scheme in my spare time at some point</p>



<a name="151011389"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2355526%20error%20on%20closure%20but%20not%20on%20%22equiv%22%20fn/near/151011389" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2355526.20error.20on.20closure.20but.20not.20on.20.22equiv.22.20fn.html#151011389">(Dec 06 2018 at 14:46)</a>:</h4>
<p>so I can actually understand it</p>



<a name="151011394"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2355526%20error%20on%20closure%20but%20not%20on%20%22equiv%22%20fn/near/151011394" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2355526.20error.20on.20closure.20but.20not.20on.20.22equiv.22.20fn.html#151011394">(Dec 06 2018 at 14:46)</a>:</h4>
<p>"copious spare time" is perhaps the right phrase :P</p>



<hr><p>Last updated: Apr 12 2022 at 20:01 UTC</p>
</html>