<html>
<head><meta charset="utf-8"><title>#53228 IndexMut note · t-compiler/wg-nll · Zulip Chat Archive</title></head>
<h2>Stream: <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/index.html">t-compiler/wg-nll</a></h2>
<h3>Topic: <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353228.20IndexMut.20note.html">#53228 IndexMut note</a></h3>

<hr>

<base href="https://rust-lang.zulipchat.com">

<head><link href="https://zulip-archive.rust-lang.org/style.css" rel="stylesheet"></head>

<a name="133025197"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353228%20IndexMut%20note/near/133025197" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> davidtwco <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353228.20IndexMut.20note.html#133025197">(Aug 29 2018 at 22:14)</a>:</h4>
<p><span class="user-mention" data-user-id="116009">@nikomatsakis</span> Taking a look at this issue. Looking at the MIR, we've got the location <code>bb10[0]</code> where the mutability error is being reported, I can see where the <code>index</code> call is happening (where <code>_9</code> is assigned, <code>bb9[11]</code>, in <code>index-mut-help.rs</code>), what's the best way for me to get the location that assigned <code>_9</code> - so I can check the rvalue?</p>



<a name="133060363"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353228%20IndexMut%20note/near/133060363" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> davidtwco <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353228.20IndexMut.20note.html#133060363">(Aug 30 2018 at 13:36)</a>:</h4>
<p>ping <span class="user-mention" data-user-id="116009">@nikomatsakis</span></p>



<a name="133060703"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353228%20IndexMut%20note/near/133060703" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353228.20IndexMut.20note.html#133060703">(Aug 30 2018 at 13:42)</a>:</h4>
<p>hey</p>



<a name="133060717"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353228%20IndexMut%20note/near/133060717" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353228.20IndexMut.20note.html#133060717">(Aug 30 2018 at 13:42)</a>:</h4>
<p>is the MIR listed somewhere?</p>



<a name="133060726"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353228%20IndexMut%20note/near/133060726" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353228.20IndexMut.20note.html#133060726">(Aug 30 2018 at 13:42)</a>:</h4>
<p>anyway, finding out where <code>_9</code> is assigned... I think we have a visitor for it .. but it's not like mega cheap</p>



<a name="133060731"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353228%20IndexMut%20note/near/133060731" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353228.20IndexMut.20note.html#133060731">(Aug 30 2018 at 13:42)</a>:</h4>
<p>I guess that's ok if it's just when an error is reported</p>



<a name="133060851"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353228%20IndexMut%20note/near/133060851" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> davidtwco <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353228.20IndexMut.20note.html#133060851">(Aug 30 2018 at 13:44)</a>:</h4>
<p><span class="user-mention" data-user-id="116009">@nikomatsakis</span> <a href="https://gist.github.com/davidtwco/3c75a8d83682e689b57ba84be267f76d" target="_blank" title="https://gist.github.com/davidtwco/3c75a8d83682e689b57ba84be267f76d">https://gist.github.com/davidtwco/3c75a8d83682e689b57ba84be267f76d</a></p>



<a name="133060885"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353228%20IndexMut%20note/near/133060885" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353228.20IndexMut.20note.html#133060885">(Aug 30 2018 at 13:44)</a>:</h4>
<p>ok I see so the error is here:</p>
<div class="codehilite"><pre><span></span>_8 = &amp;mut (*_9);
</pre></div>



<a name="133060914"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353228%20IndexMut%20note/near/133060914" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> davidtwco <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353228.20IndexMut.20note.html#133060914">(Aug 30 2018 at 13:45)</a>:</h4>
<p>Yeah, and then <code>_9</code> is assigned above, here: <code>_9 = const std::ops::Index::index(move _10, move _11)</code>.</p>



<a name="133060928"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353228%20IndexMut%20note/near/133060928" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353228.20IndexMut.20note.html#133060928">(Aug 30 2018 at 13:45)</a>:</h4>
<p>actually</p>



<a name="133060933"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353228%20IndexMut%20note/near/133060933" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353228.20IndexMut.20note.html#133060933">(Aug 30 2018 at 13:45)</a>:</h4>
<p>you can probably use the <code>MoveData</code> to answer this question</p>



<a name="133060940"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353228%20IndexMut%20note/near/133060940" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353228.20IndexMut.20note.html#133060940">(Aug 30 2018 at 13:45)</a>:</h4>
<p>sec</p>



<a name="133060995"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353228%20IndexMut%20note/near/133060995" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> davidtwco <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353228.20IndexMut.20note.html#133060995">(Aug 30 2018 at 13:46)</a>:</h4>
<p>I spent a while yesterday messing with <code>MoveData</code> to try get it to give me that - I've not interacted with <code>MoveData</code> at all so I wasn't really getting much of anywhere.</p>



<a name="133060999"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353228%20IndexMut%20note/near/133060999" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353228.20IndexMut.20note.html#133060999">(Aug 30 2018 at 13:46)</a>:</h4>
<p>I feel like there was some visitor for finding writes before</p>



<a name="133061006"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353228%20IndexMut%20note/near/133061006" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353228.20IndexMut.20note.html#133061006">(Aug 30 2018 at 13:46)</a>:</h4>
<p>I keep meaning to try and document <code>MoveData</code> more</p>



<a name="133061008"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353228%20IndexMut%20note/near/133061008" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353228.20IndexMut.20note.html#133061008">(Aug 30 2018 at 13:46)</a>:</h4>
<p>it's a bit opaque</p>



<a name="133061012"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353228%20IndexMut%20note/near/133061012" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353228.20IndexMut.20note.html#133061012">(Aug 30 2018 at 13:46)</a>:</h4>
<p>and/or refactor it</p>



<a name="133061019"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353228%20IndexMut%20note/near/133061019" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> davidtwco <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353228.20IndexMut.20note.html#133061019">(Aug 30 2018 at 13:46)</a>:</h4>
<p>I did notice that above some of the logging statements for the error, there was the <code>MirBorrowckCtxt::process_statement</code> logging statement, that listed the <code>move_outs</code> vec.</p>



<a name="133061026"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353228%20IndexMut%20note/near/133061026" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> davidtwco <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353228.20IndexMut.20note.html#133061026">(Aug 30 2018 at 13:46)</a>:</h4>
<p>In that vec, there was the location that I was hoping to get.</p>



<a name="133061031"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353228%20IndexMut%20note/near/133061031" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353228.20IndexMut.20note.html#133061031">(Aug 30 2018 at 13:47)</a>:</h4>
<p>that said, you can use the <code>init_path_map</code></p>



<a name="133061033"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353228%20IndexMut%20note/near/133061033" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> davidtwco <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353228.20IndexMut.20note.html#133061033">(Aug 30 2018 at 13:47)</a>:</h4>
<p>Which led me down a rabbit hole of trying to figure out how to access it.</p>



<a name="133061044"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353228%20IndexMut%20note/near/133061044" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353228.20IndexMut.20note.html#133061044">(Aug 30 2018 at 13:47)</a>:</h4>
<p>to find all the initializations of a given <code>MovePathIndex</code></p>



<a name="133061050"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353228%20IndexMut%20note/near/133061050" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353228.20IndexMut.20note.html#133061050">(Aug 30 2018 at 13:47)</a>:</h4>
<p>you can convert a <code>Local</code> to an MPI</p>



<a name="133061062"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353228%20IndexMut%20note/near/133061062" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> davidtwco <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353228.20IndexMut.20note.html#133061062">(Aug 30 2018 at 13:47)</a>:</h4>
<p>Is that with <code>closest_move_path_to</code> (or something like that)?</p>



<a name="133061167"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353228%20IndexMut%20note/near/133061167" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> davidtwco <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353228.20IndexMut.20note.html#133061167">(Aug 30 2018 at 13:48)</a>:</h4>
<p>Yesterday when experimenting, I tried with that function (whatever it is actually called), then I looked up a <code>MoveOutIndex</code> and then tried to index the <code>moves</code>  - it worked but got me an entirely different location.</p>



<a name="133061175"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353228%20IndexMut%20note/near/133061175" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353228.20IndexMut.20note.html#133061175">(Aug 30 2018 at 13:49)</a>:</h4>
<p>basically something like this should work:</p>
<div class="codehilite"><pre><span></span><span class="kd">let</span><span class="w"> </span><span class="n">mpi</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">move_data</span><span class="p">.</span><span class="n">rev_lookup</span><span class="p">.</span><span class="n">find_local</span><span class="p">(</span><span class="n">local_variable</span><span class="p">);</span><span class="w"></span>
<span class="k">for</span><span class="w"> </span><span class="n">init</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="n">move_data</span><span class="p">.</span><span class="n">init_path_map</span><span class="p">[</span><span class="n">mpi</span><span class="p">].</span><span class="n">map</span><span class="p">(</span><span class="o">|</span><span class="n">i</span><span class="o">|</span><span class="w"> </span><span class="o">&amp;</span><span class="n">move_data</span><span class="p">.</span><span class="n">inits</span><span class="p">[</span><span class="n">i</span><span class="p">])</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">   </span><span class="p">...</span><span class="w"> </span><span class="c1">// here `init` is a `Init`</span>
<span class="p">}</span><span class="w"></span>
</pre></div>



<a name="133061180"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353228%20IndexMut%20note/near/133061180" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> davidtwco <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353228.20IndexMut.20note.html#133061180">(Aug 30 2018 at 13:49)</a>:</h4>
<p><code>init_path_map</code> might be worth looking into.</p>



<a name="133061190"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353228%20IndexMut%20note/near/133061190" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353228.20IndexMut.20note.html#133061190">(Aug 30 2018 at 13:49)</a>:</h4>
<p>at least in the case where you have a single local</p>



<a name="133061198"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353228%20IndexMut%20note/near/133061198" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> davidtwco <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353228.20IndexMut.20note.html#133061198">(Aug 30 2018 at 13:49)</a>:</h4>
<p>Yeah, I think that'd do it.</p>



<a name="133061274"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353228%20IndexMut%20note/near/133061274" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353228.20IndexMut.20note.html#133061274">(Aug 30 2018 at 13:50)</a>:</h4>
<p>the <code>Init</code> structure has the things you need: <a href="https://doc.rust-lang.org/nightly/nightly-rustc/rustc_mir/dataflow/move_paths/struct.Init.html" target="_blank" title="https://doc.rust-lang.org/nightly/nightly-rustc/rustc_mir/dataflow/move_paths/struct.Init.html">rustdoc</a></p>



<a name="133061288"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353228%20IndexMut%20note/near/133061288" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353228.20IndexMut.20note.html#133061288">(Aug 30 2018 at 13:50)</a>:</h4>
<p>if you want to handle things that are not single locals, then "closest to" is probably good</p>



<a name="133061309"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353228%20IndexMut%20note/near/133061309" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353228.20IndexMut.20note.html#133061309">(Aug 30 2018 at 13:51)</a>:</h4>
<p>if you have a path like <code>a.b.c.d</code>, then closest-to would give you the MPI for that path, or for some prefix is that path does not have an MPI -- really though once you get into that, you have to be concerned about all kinds of complications</p>



<a name="133061314"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353228%20IndexMut%20note/near/133061314" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353228.20IndexMut.20note.html#133061314">(Aug 30 2018 at 13:51)</a>:</h4>
<p>and I suspect that for the purposes of this diagnostic</p>



<a name="133061322"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353228%20IndexMut%20note/near/133061322" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353228.20IndexMut.20note.html#133061322">(Aug 30 2018 at 13:51)</a>:</h4>
<p>we can just ignore cases where it's not a local</p>



<a name="133061335"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353228%20IndexMut%20note/near/133061335" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353228.20IndexMut.20note.html#133061335">(Aug 30 2018 at 13:51)</a>:</h4>
<blockquote>
<p>if you have a path like <code>a.b.c.d</code>, then closest-to would give you the MPI for that path, or for some prefix is that path does not have an MPI -- really though once you get into that, you have to be concerned about all kinds of complications</p>
</blockquote>
<p>e.g., you really want all prefixes, since <code>a.b = ...</code> also "reassigns" <code>a.b.c.d</code></p>



<a name="133061543"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353228%20IndexMut%20note/near/133061543" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> davidtwco <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353228.20IndexMut.20note.html#133061543">(Aug 30 2018 at 13:54)</a>:</h4>
<p><span class="emoji emoji-1f44d" title="+1">:+1:</span></p>



<a name="133062924"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353228%20IndexMut%20note/near/133062924" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> davidtwco <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353228.20IndexMut.20note.html#133062924">(Aug 30 2018 at 14:17)</a>:</h4>
<p><span class="user-mention" data-user-id="116009">@nikomatsakis</span> I'm not sure that works for this. If I'm not mistaken, I'll need a <code>Location</code> so I can access the terminator (<code>bb9[11]</code>) which is what will mention the call to <code>index</code>. However, your approach wouldn't give me a <code>Location</code>? Changing it slightly to do:</p>
<div class="codehilite"><pre><span></span><span class="kd">let</span><span class="w"> </span><span class="n">mpi</span><span class="w">  </span><span class="o">=</span><span class="w"> </span><span class="bp">self</span><span class="p">.</span><span class="n">move_data</span><span class="p">.</span><span class="n">rev_lookup</span><span class="p">.</span><span class="n">find_local</span><span class="p">(</span><span class="o">*</span><span class="n">local</span><span class="p">);</span><span class="w"></span>
<span class="kd">let</span><span class="w"> </span><span class="n">moi</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="bp">self</span><span class="p">.</span><span class="n">move_data</span><span class="p">.</span><span class="n">path_map</span><span class="p">[</span><span class="n">mpi</span><span class="p">].</span><span class="n">first</span><span class="p">().</span><span class="n">unwrap</span><span class="p">();</span><span class="w"> </span><span class="c1">// Only one item.</span>
<span class="n">debug</span><span class="o">!</span><span class="p">(</span><span class="s">&quot;{}&quot;</span><span class="p">,</span><span class="w"> </span><span class="bp">self</span><span class="p">.</span><span class="n">move_data</span><span class="p">.</span><span class="n">moves</span><span class="p">[</span><span class="n">moi</span><span class="p">].</span><span class="n">source</span><span class="p">);</span><span class="w"> </span><span class="c1">// gives bb13[2]</span>
</pre></div>


<p>That's the same location I got yesterday with however I managed to do it then - it isn't the <code>bb9[11]</code> that I'd like to access, <code>bb13[2]</code> is the upcoming <code>StorageDead(_9)</code> that follows from the error location <code>bb10[0]</code>.</p>



<a name="133062947"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353228%20IndexMut%20note/near/133062947" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353228.20IndexMut.20note.html#133062947">(Aug 30 2018 at 14:18)</a>:</h4>
<p>not path-map</p>



<a name="133062985"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353228%20IndexMut%20note/near/133062985" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353228.20IndexMut.20note.html#133062985">(Aug 30 2018 at 14:18)</a>:</h4>
<p><code>init_path_map</code></p>



<a name="133063000"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353228%20IndexMut%20note/near/133063000" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> davidtwco <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353228.20IndexMut.20note.html#133063000">(Aug 30 2018 at 14:18)</a>:</h4>
<p>Yeah, I tried it with that, getting an <code>Init</code> - but I don't know how that helps me find the <code>Location</code>?</p>



<a name="133063008"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353228%20IndexMut%20note/near/133063008" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353228.20IndexMut.20note.html#133063008">(Aug 30 2018 at 14:18)</a>:</h4>
<p>oh, I see, <code>Init</code> doesn't have a location</p>



<a name="133063012"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353228%20IndexMut%20note/near/133063012" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353228.20IndexMut.20note.html#133063012">(Aug 30 2018 at 14:18)</a>:</h4>
<p>well, maybe we should add one to <code>Init</code></p>



<a name="133063196"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353228%20IndexMut%20note/near/133063196" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> davidtwco <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353228.20IndexMut.20note.html#133063196">(Aug 30 2018 at 14:21)</a>:</h4>
<p>It seems like <code>Init</code> is made at <code>src/librustc_mir/dataflow/move_paths/builder.rs:430</code> and <code>src/librustc_mir/dataflow/move_paths/builder.rs:243</code>.</p>



<a name="133063472"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353228%20IndexMut%20note/near/133063472" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353228.20IndexMut.20note.html#133063472">(Aug 30 2018 at 14:25)</a>:</h4>
<p>sounds about right</p>



<a name="133063489"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353228%20IndexMut%20note/near/133063489" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353228.20IndexMut.20note.html#133063489">(Aug 30 2018 at 14:25)</a>:</h4>
<p>I would probably remove the <code>span</code> field</p>



<a name="133063495"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353228%20IndexMut%20note/near/133063495" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353228.20IndexMut.20note.html#133063495">(Aug 30 2018 at 14:25)</a>:</h4>
<p>and replace it with a <code>location</code></p>



<a name="133063502"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353228%20IndexMut%20note/near/133063502" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353228.20IndexMut.20note.html#133063502">(Aug 30 2018 at 14:25)</a>:</h4>
<p>oh hmm</p>



<a name="133063512"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353228%20IndexMut%20note/near/133063512" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353228.20IndexMut.20note.html#133063512">(Aug 30 2018 at 14:25)</a>:</h4>
<p>in the case of arguments, I guess, there is no "location"</p>



<a name="133063518"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353228%20IndexMut%20note/near/133063518" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> davidtwco <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353228.20IndexMut.20note.html#133063518">(Aug 30 2018 at 14:25)</a>:</h4>
<p>It isn't obvious to me how to get the location for the first of those cases.</p>



<a name="133063558"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353228%20IndexMut%20note/near/133063558" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353228.20IndexMut.20note.html#133063558">(Aug 30 2018 at 14:26)</a>:</h4>
<p>there is none</p>



<a name="133063563"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353228%20IndexMut%20note/near/133063563" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> davidtwco <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353228.20IndexMut.20note.html#133063563">(Aug 30 2018 at 14:26)</a>:</h4>
<p>Yeah, what you said.</p>



<a name="133063577"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353228%20IndexMut%20note/near/133063577" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353228.20IndexMut.20note.html#133063577">(Aug 30 2018 at 14:26)</a>:</h4>
<p>so perhaps it has to be an <code>Option&lt;Location&gt;</code></p>



<a name="133063622"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353228%20IndexMut%20note/near/133063622" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> davidtwco <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353228.20IndexMut.20note.html#133063622">(Aug 30 2018 at 14:26)</a>:</h4>
<p>Should I still keep the span - since in some cases that won't be computable by the location?</p>



<a name="133063652"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353228%20IndexMut%20note/near/133063652" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353228.20IndexMut.20note.html#133063652">(Aug 30 2018 at 14:27)</a>:</h4>
<p>yes</p>



<a name="133063664"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353228%20IndexMut%20note/near/133063664" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353228.20IndexMut.20note.html#133063664">(Aug 30 2018 at 14:27)</a>:</h4>
<p>/me thinks</p>



<a name="133063668"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353228%20IndexMut%20note/near/133063668" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353228.20IndexMut.20note.html#133063668">(Aug 30 2018 at 14:27)</a>:</h4>
<p>I mean it's fine</p>



<a name="133063679"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353228%20IndexMut%20note/near/133063679" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353228.20IndexMut.20note.html#133063679">(Aug 30 2018 at 14:27)</a>:</h4>
<p>the most concise representation would be to have some method that gets the span given the mir</p>



<a name="133063747"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353228%20IndexMut%20note/near/133063747" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353228.20IndexMut.20note.html#133063747">(Aug 30 2018 at 14:28)</a>:</h4>
<p>and perhaps not use <code>Option&lt;Location&gt;</code> but a more meaningful custom enum, like</p>
<div class="codehilite"><pre><span></span><span class="k">enum</span> <span class="nc">InitLocation</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="n">Argument</span><span class="p">(</span><span class="n">Local</span><span class="p">),</span><span class="w"></span>
<span class="w">    </span><span class="n">Statement</span><span class="p">(</span><span class="n">Location</span><span class="p">),</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>
</pre></div>


<p>or something</p>



<a name="133063763"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353228%20IndexMut%20note/near/133063763" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353228.20IndexMut.20note.html#133063763">(Aug 30 2018 at 14:28)</a>:</h4>
<p>but I think it's fine to just add an <code>opt_location</code> field and explain why it is sometimes <code>None</code></p>



<a name="133066399"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353228%20IndexMut%20note/near/133066399" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> davidtwco <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353228.20IndexMut.20note.html#133066399">(Aug 30 2018 at 15:16)</a>:</h4>
<p><span class="user-mention" data-user-id="116009">@nikomatsakis</span> What's the best way to check if the <code>rustc::ty::Const</code> I have is <code>std::ops::Index::index</code>?</p>



<a name="133066471"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353228%20IndexMut%20note/near/133066471" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353228.20IndexMut.20note.html#133066471">(Aug 30 2018 at 15:17)</a>:</h4>
<p>that's not really a well-formed question</p>



<a name="133066479"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353228%20IndexMut%20note/near/133066479" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353228.20IndexMut.20note.html#133066479">(Aug 30 2018 at 15:18)</a>:</h4>
<p>what is this "const"?</p>



<a name="133066522"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353228%20IndexMut%20note/near/133066522" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353228.20IndexMut.20note.html#133066522">(Aug 30 2018 at 15:18)</a>:</h4>
<p>what I mean is: a <em>type</em> can implement <code>Index&lt;T&gt;</code></p>



<a name="133066526"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353228%20IndexMut%20note/near/133066526" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353228.20IndexMut.20note.html#133066526">(Aug 30 2018 at 15:18)</a>:</h4>
<p>i'm not sure what it means for a <em>constant</em> to be <code>Index</code></p>



<a name="133066538"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353228%20IndexMut%20note/near/133066538" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353228.20IndexMut.20note.html#133066538">(Aug 30 2018 at 15:18)</a>:</h4>
<p>what is the role that the constant plays? :)</p>



<a name="133066570"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353228%20IndexMut%20note/near/133066570" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> davidtwco <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353228.20IndexMut.20note.html#133066570">(Aug 30 2018 at 15:19)</a>:</h4>
<p>Well, the terminator is <code>TerminatorKind::Call</code>, the <code>func</code> of that is a <code>Operand::Constant</code>, which contains a <code>ty::Const</code>, which when you print in a debug log, says <code>const std::ops::index::Index</code>.</p>



<a name="133066652"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353228%20IndexMut%20note/near/133066652" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> davidtwco <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353228.20IndexMut.20note.html#133066652">(Aug 30 2018 at 15:20)</a>:</h4>
<p>I figure if we find out we called <code>index(..)</code> on a value and have a <code>AccessKind::MutableBorrow</code> then we should add the help message - I've got the function we called, I just don't know what to compare that against to confirm it is in fact <code>std::ops::index::Index</code>.</p>



<a name="133066707"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353228%20IndexMut%20note/near/133066707" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> davidtwco <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353228.20IndexMut.20note.html#133066707">(Aug 30 2018 at 15:21)</a>:</h4>
<p>The terminator is what I got from the location <code>bb9[11]</code> that I was previously looking for, where <code>_9</code> was assigned.</p>



<a name="133066910"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353228%20IndexMut%20note/near/133066910" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353228.20IndexMut.20note.html#133066910">(Aug 30 2018 at 15:24)</a>:</h4>
<blockquote>
<p>Well, the terminator is <code>TerminatorKind::Call</code>, the <code>func</code> of that is a <code>Operand::Constant</code>, which contains a <code>ty::Const</code>, which when you print in a debug log, says <code>const std::ops::index::Index</code>.</p>
</blockquote>
<p>ah I misunderstood your question</p>



<a name="133066919"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353228%20IndexMut%20note/near/133066919" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353228.20IndexMut.20note.html#133066919">(Aug 30 2018 at 15:25)</a>:</h4>
<p>yes, ok, so...</p>



<a name="133067038"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353228%20IndexMut%20note/near/133067038" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353228.20IndexMut.20note.html#133067038">(Aug 30 2018 at 15:27)</a>:</h4>
<p>I think you want to check if the const is a <code>ConstVal::Unevaluated</code></p>



<a name="133067040"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353228%20IndexMut%20note/near/133067040" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353228.20IndexMut.20note.html#133067040">(Aug 30 2018 at 15:27)</a>:</h4>
<p>we probably want some helpers for this</p>



<a name="133067041"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353228%20IndexMut%20note/near/133067041" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353228.20IndexMut.20note.html#133067041">(Aug 30 2018 at 15:27)</a>:</h4>
<p>the def-id you can get from the lang items</p>



<a name="133067054"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353228%20IndexMut%20note/near/133067054" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353228.20IndexMut.20note.html#133067054">(Aug 30 2018 at 15:27)</a>:</h4>
<p><code>self.tcx.lang_items().index_trait()</code></p>



<a name="133069356"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353228%20IndexMut%20note/near/133069356" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> davidtwco <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353228.20IndexMut.20note.html#133069356">(Aug 30 2018 at 16:07)</a>:</h4>
<p>Annoyingly, this is the <code>DefId</code> I'm getting (it ended up not being a <code>ConstVal::Unevaluated</code>): </p>
<p><code>DefId(2/0:990 ~ core[177e]::ops[0]::index[0]::Index[0]::index[0])</code></p>
<p>...and this is the <code>DefId</code> I expect (from lang items):</p>
<p><code>DefId(2/0:988 ~ core[177e]::ops[0]::index[0]::Index[0]</code></p>



<a name="133069413"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353228%20IndexMut%20note/near/133069413" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> davidtwco <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353228.20IndexMut.20note.html#133069413">(Aug 30 2018 at 16:08)</a>:</h4>
<p>Actually, pasting it out like that helped spot the difference I didn't see.</p>



<a name="133071394"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353228%20IndexMut%20note/near/133071394" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> davidtwco <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353228.20IndexMut.20note.html#133071394">(Aug 30 2018 at 16:49)</a>:</h4>
<p>I feel like I know this stuff but I'm struggling to remember: what's the best way to get the not-a-compiler-temporary type from a place? Is there a helper function that'll work out the original type that the user was using?</p>



<a name="133071931"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353228%20IndexMut%20note/near/133071931" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353228.20IndexMut.20note.html#133071931">(Aug 30 2018 at 16:59)</a>:</h4>
<p>do you mean <code>place.ty(tcx).to_ty()</code> ?</p>



<a name="133071939"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353228%20IndexMut%20note/near/133071939" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353228.20IndexMut.20note.html#133071939">(Aug 30 2018 at 16:59)</a>:</h4>
<p><a href="https://doc.rust-lang.org/nightly/nightly-rustc/rustc/mir/tcx/enum.PlaceTy.html#method.to_ty" target="_blank" title="https://doc.rust-lang.org/nightly/nightly-rustc/rustc/mir/tcx/enum.PlaceTy.html#method.to_ty">https://doc.rust-lang.org/nightly/nightly-rustc/rustc/mir/tcx/enum.PlaceTy.html#method.to_ty</a></p>



<a name="133072463"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353228%20IndexMut%20note/near/133072463" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> davidtwco <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353228.20IndexMut.20note.html#133072463">(Aug 30 2018 at 17:08)</a>:</h4>
<p>It isn't that - it gives me a type to print, but it returns <code>std::string::String</code> rather than <code>std::collections::HashMap&lt;&amp;str, std::string::String&gt;</code> that I'd expect. <code>_9</code> has the value of <code>std::string::String</code> - it's correct; but that's a compiler temporary, the actual type that the user would expect is the hashmap.</p>



<a name="133072646"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353228%20IndexMut%20note/near/133072646" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353228.20IndexMut.20note.html#133072646">(Aug 30 2018 at 17:12)</a>:</h4>
<p>what type are you looking for exactly?</p>



<a name="133072674"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353228%20IndexMut%20note/near/133072674" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353228.20IndexMut.20note.html#133072674">(Aug 30 2018 at 17:13)</a>:</h4>
<p>you want to find the type that failed to implement <code>IndexMut</code>?</p>



<a name="133072688"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353228%20IndexMut%20note/near/133072688" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353228.20IndexMut.20note.html#133072688">(Aug 30 2018 at 17:13)</a>:</h4>
<p>if so, you can extract it from the "substs" applied to <code>Index</code></p>



<a name="133072697"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353228%20IndexMut%20note/near/133072697" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353228.20IndexMut.20note.html#133072697">(Aug 30 2018 at 17:13)</a>:</h4>
<p>you should be able to extract the "self type" out of the constant</p>



<a name="133072748"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353228%20IndexMut%20note/near/133072748" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353228.20IndexMut.20note.html#133072748">(Aug 30 2018 at 17:14)</a>:</h4>
<p>and/or extract the type of the receiver (but I guess that will be a <code>&amp;HashMap&lt;...&gt;</code>)</p>



<a name="133072778"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353228%20IndexMut%20note/near/133072778" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> davidtwco <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353228.20IndexMut.20note.html#133072778">(Aug 30 2018 at 17:15)</a>:</h4>
<blockquote>
<p>you want to find the type that failed to implement <code>IndexMut</code>?</p>
</blockquote>
<p>Sorry, I wasn't clear, this is the type I'm looking for, yeah.</p>



<a name="133074681"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353228%20IndexMut%20note/near/133074681" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> davidtwco <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353228.20IndexMut.20note.html#133074681">(Aug 30 2018 at 17:47)</a>:</h4>
<p>Submitted <a href="https://github.com/rust-lang/rust/issues/53830" target="_blank" title="https://github.com/rust-lang/rust/issues/53830">#53830</a> - sorry about all the questions.</p>



<a name="133074734"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353228%20IndexMut%20note/near/133074734" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353228.20IndexMut.20note.html#133074734">(Aug 30 2018 at 17:48)</a>:</h4>
<p>heh no worries!</p>



<a name="133074754"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353228%20IndexMut%20note/near/133074754" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> davidtwco <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353228.20IndexMut.20note.html#133074754">(Aug 30 2018 at 17:48)</a>:</h4>
<p>I'm clearly out of practice for having a lazy week or two.</p>



<a name="133126801"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353228%20IndexMut%20note/near/133126801" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> davidtwco <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353228.20IndexMut.20note.html#133126801">(Aug 31 2018 at 14:17)</a>:</h4>
<p>I updated this to address your suggestion <span class="user-mention" data-user-id="116009">@nikomatsakis</span>.</p>



<a name="133126861"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353228%20IndexMut%20note/near/133126861" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353228.20IndexMut.20note.html#133126861">(Aug 31 2018 at 14:18)</a>:</h4>
<p>ah, great</p>



<a name="133126874"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353228%20IndexMut%20note/near/133126874" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> davidtwco <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353228.20IndexMut.20note.html#133126874">(Aug 31 2018 at 14:18)</a>:</h4>
<p>Well, I guess I updated it with my suggestion regarding your question.</p>



<a name="133127325"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353228%20IndexMut%20note/near/133127325" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353228.20IndexMut.20note.html#133127325">(Aug 31 2018 at 14:27)</a>:</h4>
<p>I like your suggestion</p>



<a name="133127407"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353228%20IndexMut%20note/near/133127407" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353228.20IndexMut.20note.html#133127407">(Aug 31 2018 at 14:29)</a>:</h4>
<p>if you'll forgive me, I have some ideas for how to "go for the gold" here =)</p>



<a name="133127413"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353228%20IndexMut%20note/near/133127413" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353228.20IndexMut.20note.html#133127413">(Aug 31 2018 at 14:29)</a>:</h4>
<p>that is, some further tweaks we could do</p>



<a name="133127416"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353228%20IndexMut%20note/near/133127416" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353228.20IndexMut.20note.html#133127416">(Aug 31 2018 at 14:29)</a>:</h4>
<p>will leave a comment</p>



<a name="133127425"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353228%20IndexMut%20note/near/133127425" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353228.20IndexMut.20note.html#133127425">(Aug 31 2018 at 14:29)</a>:</h4>
<p>actually hmm</p>



<a name="133127429"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353228%20IndexMut%20note/near/133127429" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353228.20IndexMut.20note.html#133127429">(Aug 31 2018 at 14:29)</a>:</h4>
<p>this may not be the right place to do what I was going to suggest :)</p>



<a name="133127433"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353228%20IndexMut%20note/near/133127433" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353228.20IndexMut.20note.html#133127433">(Aug 31 2018 at 14:29)</a>:</h4>
<p>nm, I'll leave a more limited comment</p>



<a name="133129784"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353228%20IndexMut%20note/near/133129784" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> davidtwco <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353228.20IndexMut.20note.html#133129784">(Aug 31 2018 at 15:12)</a>:</h4>
<p>Do you want me to attempt making that change to use a predicate?</p>



<a name="133129826"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353228%20IndexMut%20note/near/133129826" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353228.20IndexMut.20note.html#133129826">(Aug 31 2018 at 15:13)</a>:</h4>
<p>I've been debating. I guess I think it'd be better</p>



<a name="133129829"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353228%20IndexMut%20note/near/133129829" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353228.20IndexMut.20note.html#133129829">(Aug 31 2018 at 15:13)</a>:</h4>
<p>I wanted to go and search and see where we do similar tings</p>



<a name="133129833"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353228%20IndexMut%20note/near/133129833" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353228.20IndexMut.20note.html#133129833">(Aug 31 2018 at 15:13)</a>:</h4>
<p>see if we could make a helper</p>



<a name="133129863"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353228%20IndexMut%20note/near/133129863" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353228.20IndexMut.20note.html#133129863">(Aug 31 2018 at 15:14)</a>:</h4>
<p>now that we have a proper rustc query this is <em>relatively</em> painless</p>



<a name="133129930"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353228%20IndexMut%20note/near/133129930" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> davidtwco <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353228.20IndexMut.20note.html#133129930">(Aug 31 2018 at 15:15)</a>:</h4>
<p>I <a href="https://github.com/rust-lang/rust/blob/b75b0471a8b87c44e0bd953d2a5c36d896128723/src/librustc/traits/mod.rs#L589" target="_blank" title="https://github.com/rust-lang/rust/blob/b75b0471a8b87c44e0bd953d2a5c36d896128723/src/librustc/traits/mod.rs#L589">found this</a> which as far as I could tell looked similar to what we'd want.</p>



<a name="133312758"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353228%20IndexMut%20note/near/133312758" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> davidtwco <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353228.20IndexMut.20note.html#133312758">(Sep 04 2018 at 14:10)</a>:</h4>
<p><span class="user-mention" data-user-id="116009">@nikomatsakis</span> Did you get a chance to work out if I should attempt to use a predicate here?</p>



<a name="133328319"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353228%20IndexMut%20note/near/133328319" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353228.20IndexMut.20note.html#133328319">(Sep 04 2018 at 18:38)</a>:</h4>
<p><span class="user-mention" data-user-id="116107">@davidtwco</span> I think it'd be better, but what I did not do was go and find the best example of doing so</p>



<a name="133363628"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353228%20IndexMut%20note/near/133363628" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> davidtwco <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353228.20IndexMut.20note.html#133363628">(Sep 05 2018 at 09:04)</a>:</h4>
<p><span class="user-mention" data-user-id="116009">@nikomatsakis</span> What's the best way for me to get access to <code>infcx</code> in order to call <code>predicate_{must|may}_hold</code> in <code>librustc_mir/borrow_check/mutability_errors.rs</code>?</p>



<a name="133367672"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353228%20IndexMut%20note/near/133367672" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> davidtwco <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353228.20IndexMut.20note.html#133367672">(Sep 05 2018 at 10:48)</a>:</h4>
<p>I've mangled things around such that I can call <a href="https://doc.rust-lang.org/nightly/nightly-rustc/rustc/traits/fn.type_known_to_meet_bound.html" target="_blank" title="https://doc.rust-lang.org/nightly/nightly-rustc/rustc/traits/fn.type_known_to_meet_bound.html">type_known_to_meet_bound</a>. </p>
<p>However, this thinks that <code>IndexMut</code> is not implemented. I can see in the logs that it is looking at <code>std::string::String</code> (which is the type I'm indexing in my "has IndexMut" test case) against all the implementations of <code>IndexMut</code> - however, I think it is because I've not specified what <code>T</code> I'm looking for in <code>IndexMut&lt;T&gt;</code> that it never finds it. Just guessing though. </p>
<p>It also causes the other test case to panic with a "region constraints already solved" error - I've not bothered to look into that given that it isn't working on the primary case I'd like it to solve.</p>



<a name="133367746"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353228%20IndexMut%20note/near/133367746" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> davidtwco <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353228.20IndexMut.20note.html#133367746">(Sep 05 2018 at 10:51)</a>:</h4>
<p>At least with the current implementation, if it incorrectly assumes <code>IndexMut</code> is implemented for the type then it only becomes less helpful rather than making a wrong suggestion.</p>



<a name="133377071"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353228%20IndexMut%20note/near/133377071" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353228.20IndexMut.20note.html#133377071">(Sep 05 2018 at 13:55)</a>:</h4>
<p><span class="user-mention" data-user-id="116107">@davidtwco</span> did you push your commit?</p>



<a name="133377176"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353228%20IndexMut%20note/near/133377176" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> davidtwco <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353228.20IndexMut.20note.html#133377176">(Sep 05 2018 at 13:57)</a>:</h4>
<p>I haven't because it wasn't quite working.</p>



<a name="133377284"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353228%20IndexMut%20note/near/133377284" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> davidtwco <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353228.20IndexMut.20note.html#133377284">(Sep 05 2018 at 13:58)</a>:</h4>
<p>I'll make another branch with it so I don't waste Travis time and include it in the PR, for now here's the diff: <a href="https://gist.github.com/davidtwco/399f769051d890af9aedbdf022ad6097" target="_blank" title="https://gist.github.com/davidtwco/399f769051d890af9aedbdf022ad6097">https://gist.github.com/davidtwco/399f769051d890af9aedbdf022ad6097</a></p>



<a name="133377572"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353228%20IndexMut%20note/near/133377572" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> davidtwco <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353228.20IndexMut.20note.html#133377572">(Sep 05 2018 at 14:02)</a>:</h4>
<p>Here's it on a branch: <a href="https://github.com/davidtwco/rust/commit/f053d19716ce11f82fbb15356afe5eb9ad2cddbf" target="_blank" title="https://github.com/davidtwco/rust/commit/f053d19716ce11f82fbb15356afe5eb9ad2cddbf">https://github.com/davidtwco/rust/commit/f053d19716ce11f82fbb15356afe5eb9ad2cddbf</a></p>



<a name="133385457"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353228%20IndexMut%20note/near/133385457" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> davidtwco <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353228.20IndexMut.20note.html#133385457">(Sep 05 2018 at 16:05)</a>:</h4>
<p>If it is easier for you <span class="user-mention" data-user-id="116009">@nikomatsakis</span> (if you're intending to do a build) then I could give you access to the box I have a build on. Could save some time. It's just some (relatively) beefy dedicated box I rent for faster compilations on Rust contributions and saving me rebuilding between machines - so there's nothing else on it.</p>



<a name="133385717"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353228%20IndexMut%20note/near/133385717" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353228.20IndexMut.20note.html#133385717">(Sep 05 2018 at 16:09)</a>:</h4>
<p><span class="user-mention" data-user-id="116107">@davidtwco</span> ok lemme look now..</p>



<a name="133398427"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353228%20IndexMut%20note/near/133398427" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> davidtwco <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353228.20IndexMut.20note.html#133398427">(Sep 05 2018 at 19:55)</a>:</h4>
<p><em>cough</em></p>



<a name="133399278"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353228%20IndexMut%20note/near/133399278" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353228.20IndexMut.20note.html#133399278">(Sep 05 2018 at 20:10)</a>:</h4>
<p>sorry :)</p>



<a name="133401528"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353228%20IndexMut%20note/near/133401528" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353228.20IndexMut.20note.html#133401528">(Sep 05 2018 at 20:45)</a>:</h4>
<p>ok, so, I looked a bit more at <code>type_known_to_meet_bound</code>. It's not really what you are looking for. Among other things, it is designed for queries like <code>T: Copy</code> that have only one type involved. But in this case, we want to check <code>T: IndexMut&lt;U&gt;</code> -- two types.</p>
<p>However, we do have access to the substs from the call, which is convenient.</p>



<a name="133402904"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353228%20IndexMut%20note/near/133402904" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353228.20IndexMut.20note.html#133402904">(Sep 05 2018 at 21:09)</a>:</h4>
<p>ok so I think that the <code>substs</code> we have is for the method call; this actually <em>extends</em> the substs from the trait with those of the method. In this case, though, that is probably equal.</p>



<a name="133402964"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353228%20IndexMut%20note/near/133402964" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353228.20IndexMut.20note.html#133402964">(Sep 05 2018 at 21:10)</a>:</h4>
<p>(yes)</p>



<a name="133403100"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353228%20IndexMut%20note/near/133403100" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353228.20IndexMut.20note.html#133403100">(Sep 05 2018 at 21:12)</a>:</h4>
<div class="codehilite"><pre><span></span><span class="kd">let</span><span class="w"> </span><span class="n">index_trait</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="bp">self</span><span class="p">.</span><span class="n">infcx</span><span class="p">.</span><span class="n">tcx</span><span class="p">.</span><span class="n">lang_items</span><span class="p">().</span><span class="n">index_trait</span><span class="p">();</span><span class="w"></span>
<span class="k">if</span><span class="w"> </span><span class="bp">self</span><span class="p">.</span><span class="n">infcx</span><span class="p">.</span><span class="n">tcx</span><span class="p">.</span><span class="n">parent</span><span class="p">(</span><span class="n">id</span><span class="p">)</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">index_trait</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="n">trait_ref</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">ty</span>::<span class="n">TraitRef</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">        </span><span class="n">def_id</span>: <span class="cm">/* DefId of IndexMut */</span><span class="p">,</span><span class="w"></span>
<span class="w">        </span><span class="n">substs</span><span class="p">,</span><span class="w"></span>
<span class="w">    </span><span class="p">};</span><span class="w"></span>
<span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="n">obligation</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Obligation</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">        </span><span class="n">param_env</span><span class="p">,</span><span class="w"></span>
<span class="w">        </span><span class="n">cause</span>: <span class="nc">ObligationCause</span>::<span class="n">misc</span><span class="p">(</span><span class="n">span</span><span class="p">,</span><span class="w"> </span><span class="n">ast</span>::<span class="n">DUMMY_NODE_ID</span><span class="p">),</span><span class="w"></span>
<span class="w">        </span><span class="n">recursion_depth</span>: <span class="mi">0</span><span class="p">,</span><span class="w"></span>
<span class="w">        </span><span class="n">predicate</span>: <span class="nc">trait_ref</span><span class="p">.</span><span class="n">to_predicate</span><span class="p">(),</span><span class="w"></span>
<span class="w">    </span><span class="p">};</span><span class="w"></span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="bp">self</span><span class="p">.</span><span class="n">infcx</span><span class="p">.</span><span class="n">predicate_may_hold</span><span class="p">(</span><span class="o">&amp;</span><span class="n">obligation</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="p">...</span><span class="w"> </span><span class="p">}</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>
</pre></div>



<a name="133403103"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353228%20IndexMut%20note/near/133403103" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353228.20IndexMut.20note.html#133403103">(Sep 05 2018 at 21:12)</a>:</h4>
<p>cc <span class="user-mention" data-user-id="116107">@davidtwco</span>  <span class="emoji emoji-1f446" title="point up">:point_up:</span></p>



<a name="133403118"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353228%20IndexMut%20note/near/133403118" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353228.20IndexMut.20note.html#133403118">(Sep 05 2018 at 21:13)</a>:</h4>
<p>I could also imagine adding a few <code>assert!</code> in there</p>



<a name="133403148"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353228%20IndexMut%20note/near/133403148" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353228.20IndexMut.20note.html#133403148">(Sep 05 2018 at 21:13)</a>:</h4>
<p>in particular, asserting that the <code>generics.len()</code> for index-mut trait and index trait are equal, and that the method has an empty set of generics on its own</p>



<a name="133403152"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353228%20IndexMut%20note/near/133403152" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> davidtwco <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353228.20IndexMut.20note.html#133403152">(Sep 05 2018 at 21:13)</a>:</h4>
<p>I assume <code>param_env</code> is <code>self.param_env</code>?</p>



<a name="133403162"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353228%20IndexMut%20note/near/133403162" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> davidtwco <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353228.20IndexMut.20note.html#133403162">(Sep 05 2018 at 21:13)</a>:</h4>
<p>I've tried almost essentially that.</p>



<a name="133403174"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353228%20IndexMut%20note/near/133403174" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353228.20IndexMut.20note.html#133403174">(Sep 05 2018 at 21:14)</a>:</h4>
<p>yes, param-env is <code>self.param_env</code></p>



<a name="133403175"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353228%20IndexMut%20note/near/133403175" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> davidtwco <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353228.20IndexMut.20note.html#133403175">(Sep 05 2018 at 21:14)</a>:</h4>
<p>Except I used must hold rather than may hold.</p>



<a name="133403216"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353228%20IndexMut%20note/near/133403216" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353228.20IndexMut.20note.html#133403216">(Sep 05 2018 at 21:14)</a>:</h4>
<p>that is ok too</p>



<a name="133403221"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353228%20IndexMut%20note/near/133403221" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> davidtwco <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353228.20IndexMut.20note.html#133403221">(Sep 05 2018 at 21:14)</a>:</h4>
<p>So perhaps that will make the difference.</p>



<a name="133403229"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353228%20IndexMut%20note/near/133403229" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353228.20IndexMut.20note.html#133403229">(Sep 05 2018 at 21:14)</a>:</h4>
<p>well, it may be ok let's say ;)</p>



<a name="133403240"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353228%20IndexMut%20note/near/133403240" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353228.20IndexMut.20note.html#133403240">(Sep 05 2018 at 21:14)</a>:</h4>
<p>ok, if you hit problems, let me see that version?</p>



<a name="133403374"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353228%20IndexMut%20note/near/133403374" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> davidtwco <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353228.20IndexMut.20note.html#133403374">(Sep 05 2018 at 21:16)</a>:</h4>
<p>Sure thing. I tried a handful of things so I'll give what you suggested a go and then let you know.</p>



<a name="133404165"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353228%20IndexMut%20note/near/133404165" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> davidtwco <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353228.20IndexMut.20note.html#133404165">(Sep 05 2018 at 21:28)</a>:</h4>
<p>Apparently if I had tried <code>predicate_may_hold</code> rather than <code>predicate_must_hold</code> then I'd have had it this morning.</p>



<a name="133404173"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353228%20IndexMut%20note/near/133404173" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> davidtwco <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353228.20IndexMut.20note.html#133404173">(Sep 05 2018 at 21:29)</a>:</h4>
<p>But it does ICE with the non-IndexMut-implementing case still.</p>



<a name="133404184"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353228%20IndexMut%20note/near/133404184" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> davidtwco <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353228.20IndexMut.20note.html#133404184">(Sep 05 2018 at 21:29)</a>:</h4>
<p>With "region constraints already solved".</p>



<a name="133404189"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353228%20IndexMut%20note/near/133404189" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353228.20IndexMut.20note.html#133404189">(Sep 05 2018 at 21:29)</a>:</h4>
<p>oh bother</p>



<a name="133404191"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353228%20IndexMut%20note/near/133404191" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353228.20IndexMut.20note.html#133404191">(Sep 05 2018 at 21:29)</a>:</h4>
<p>hmm</p>



<a name="133404194"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353228%20IndexMut%20note/near/133404194" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> davidtwco <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353228.20IndexMut.20note.html#133404194">(Sep 05 2018 at 21:29)</a>:</h4>
<p>Updated that temp branch.</p>



<a name="133404280"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353228%20IndexMut%20note/near/133404280" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353228.20IndexMut.20note.html#133404280">(Sep 05 2018 at 21:31)</a>:</h4>
<p>can you run with <code>RUST_BACKTRACE=1</code></p>



<a name="133404322"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353228%20IndexMut%20note/near/133404322" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> davidtwco <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353228.20IndexMut.20note.html#133404322">(Sep 05 2018 at 21:32)</a>:</h4>
<p><a href="https://gist.github.com/davidtwco/f1d5bfc80c8bb95708524930706e6a8c" target="_blank" title="https://gist.github.com/davidtwco/f1d5bfc80c8bb95708524930706e6a8c">https://gist.github.com/davidtwco/f1d5bfc80c8bb95708524930706e6a8c</a></p>



<a name="133404358"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353228%20IndexMut%20note/near/133404358" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353228.20IndexMut.20note.html#133404358">(Sep 05 2018 at 21:32)</a>:</h4>
<p>oh, interesting</p>



<a name="133404801"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353228%20IndexMut%20note/near/133404801" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353228.20IndexMut.20note.html#133404801">(Sep 05 2018 at 21:41)</a>:</h4>
<p>well that's annoying</p>



<a name="133404803"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353228%20IndexMut%20note/near/133404803" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353228.20IndexMut.20note.html#133404803">(Sep 05 2018 at 21:41)</a>:</h4>
<p>there's not really a <em>good</em> reason for that code to fail</p>



<a name="133404815"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353228%20IndexMut%20note/near/133404815" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353228.20IndexMut.20note.html#133404815">(Sep 05 2018 at 21:41)</a>:</h4>
<p><em>actually</em></p>



<a name="133404856"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353228%20IndexMut%20note/near/133404856" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353228.20IndexMut.20note.html#133404856">(Sep 05 2018 at 21:42)</a>:</h4>
<p>that .. is kind of a bug in canonicalization, now that I think about it</p>



<a name="133404873"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353228%20IndexMut%20note/near/133404873" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353228.20IndexMut.20note.html#133404873">(Sep 05 2018 at 21:42)</a>:</h4>
<p>in particular, if you have the various "replace all free regions" flags set...we still track if you have the same region variable appearing twice..which I think we didn't want to do</p>



<a name="133405303"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353228%20IndexMut%20note/near/133405303" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> davidtwco <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353228.20IndexMut.20note.html#133405303">(Sep 05 2018 at 21:51)</a>:</h4>
<p>I'm not sure how I'd go about fixing that?</p>



<a name="133405394"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353228%20IndexMut%20note/near/133405394" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353228.20IndexMut.20note.html#133405394">(Sep 05 2018 at 21:53)</a>:</h4>
<p>yeah, I wasn't suggesting you should</p>



<a name="133405397"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353228%20IndexMut%20note/near/133405397" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353228.20IndexMut.20note.html#133405397">(Sep 05 2018 at 21:53)</a>:</h4>
<p>maybe we should land your PR as is</p>



<a name="133405403"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353228%20IndexMut%20note/near/133405403" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353228.20IndexMut.20note.html#133405403">(Sep 05 2018 at 21:53)</a>:</h4>
<p>and file a follow-up issue</p>



<a name="133405413"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353228%20IndexMut%20note/near/133405413" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353228.20IndexMut.20note.html#133405413">(Sep 05 2018 at 21:54)</a>:</h4>
<p>with your diff here in the issue</p>



<a name="133405448"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353228%20IndexMut%20note/near/133405448" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353228.20IndexMut.20note.html#133405448">(Sep 05 2018 at 21:54)</a>:</h4>
<p>I can try to patch canonicalization in the meantime</p>



<a name="133405455"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/122657-t-compiler/wg-nll/topic/%2353228%20IndexMut%20note/near/133405455" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> davidtwco <a href="https://zulip-archive.rust-lang.org/stream/122657-t-compiler/wg-nll/topic/.2353228.20IndexMut.20note.html#133405455">(Sep 05 2018 at 21:54)</a>:</h4>
<p>I can keep the branch around that I've been doing the experimentation on.</p>



<hr><p>Last updated: Apr 12 2022 at 20:01 UTC</p>
</html>