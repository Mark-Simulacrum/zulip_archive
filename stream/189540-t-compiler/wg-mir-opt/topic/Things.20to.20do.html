<html>
<head><meta charset="utf-8"><title>Things to do · t-compiler/wg-mir-opt · Zulip Chat Archive</title></head>
<h2>Stream: <a href="https://zulip-archive.rust-lang.org/stream/189540-t-compiler/wg-mir-opt/index.html">t-compiler/wg-mir-opt</a></h2>
<h3>Topic: <a href="https://zulip-archive.rust-lang.org/stream/189540-t-compiler/wg-mir-opt/topic/Things.20to.20do.html">Things to do</a></h3>

<hr>

<base href="https://rust-lang.zulipchat.com">

<head><link href="https://zulip-archive.rust-lang.org/style.css" rel="stylesheet"></head>

<a name="274187279"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/189540-t-compiler/wg-mir-opt/topic/Things%20to%20do/near/274187279" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jake <a href="https://zulip-archive.rust-lang.org/stream/189540-t-compiler/wg-mir-opt/topic/Things.20to.20do.html#274187279">(Mar 04 2022 at 20:58)</a>:</h4>
<p>Are there any particularly pressing tasks that stand out as things to do in the mir-opt area? I've been working on fixing broken passes recently (dest prop is next, although that is currently blocked), and am wondering if this is the best way I can help. One thing I do want to do is write a new pass manager in the not so distant future (I have some ideas here already). Is that blocked on anything? Are there more important things that need doing?</p>



<a name="274187735"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/189540-t-compiler/wg-mir-opt/topic/Things%20to%20do/near/274187735" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> bjorn3 <a href="https://zulip-archive.rust-lang.org/stream/189540-t-compiler/wg-mir-opt/topic/Things.20to.20do.html#274187735">(Mar 04 2022 at 21:00)</a>:</h4>
<p>We recently got a new pass manager already in <a href="https://github.com/rust-lang/rust/pull/91475">https://github.com/rust-lang/rust/pull/91475</a></p>



<a name="274188324"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/189540-t-compiler/wg-mir-opt/topic/Things%20to%20do/near/274188324" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jake <a href="https://zulip-archive.rust-lang.org/stream/189540-t-compiler/wg-mir-opt/topic/Things.20to.20do.html#274188324">(Mar 04 2022 at 21:06)</a>:</h4>
<p>Ah, well, "new" might be the wrong word, but there are at least things I'm looking to add. <span class="user-mention" data-user-id="124288">@oli</span> also mentioned a need for the ability to run only some passes, and I'd like to be able to harness that particularly for <code>src/test/mir-opt</code></p>



<a name="274188482"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/189540-t-compiler/wg-mir-opt/topic/Things%20to%20do/near/274188482" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jake <a href="https://zulip-archive.rust-lang.org/stream/189540-t-compiler/wg-mir-opt/topic/Things.20to.20do.html#274188482">(Mar 04 2022 at 21:08)</a>:</h4>
<p>The other thing that I think makes sense is letting passes report whether they need a <code>SimplifyCFG</code>/<code>SimplifyLocals</code> to run before/after them (and then possibly extending this to more general analyses that might get invalidated)</p>



<a name="274189880"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/189540-t-compiler/wg-mir-opt/topic/Things%20to%20do/near/274189880" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> cjgillot <a href="https://zulip-archive.rust-lang.org/stream/189540-t-compiler/wg-mir-opt/topic/Things.20to.20do.html#274189880">(Mar 04 2022 at 21:20)</a>:</h4>
<p>On the theoretical side, we probably need to better document the semantics of MIR, so our optimizations and codegen are composable.</p>



<a name="274189929"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/189540-t-compiler/wg-mir-opt/topic/Things%20to%20do/near/274189929" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> cjgillot <a href="https://zulip-archive.rust-lang.org/stream/189540-t-compiler/wg-mir-opt/topic/Things.20to.20do.html#274189929">(Mar 04 2022 at 21:21)</a>:</h4>
<p>On the practical side, we may need so have a definition of clean-ish MIR.</p>



<a name="274189987"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/189540-t-compiler/wg-mir-opt/topic/Things%20to%20do/near/274189987" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> cjgillot <a href="https://zulip-archive.rust-lang.org/stream/189540-t-compiler/wg-mir-opt/topic/Things.20to.20do.html#274189987">(Mar 04 2022 at 21:21)</a>:</h4>
<p>ie. on which we don't need to run SimplifyLocals/SimplifyCFG to have subsequent optimizations trigger.</p>



<a name="274190290"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/189540-t-compiler/wg-mir-opt/topic/Things%20to%20do/near/274190290" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> cjgillot <a href="https://zulip-archive.rust-lang.org/stream/189540-t-compiler/wg-mir-opt/topic/Things.20to.20do.html#274190290">(Mar 04 2022 at 21:24)</a>:</h4>
<p>About specific opts: inlining is almost ready, but it triggers weird type normalization ICEs.</p>



<a name="274192563"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/189540-t-compiler/wg-mir-opt/topic/Things%20to%20do/near/274192563" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> cjgillot <a href="https://zulip-archive.rust-lang.org/stream/189540-t-compiler/wg-mir-opt/topic/Things.20to.20do.html#274192563">(Mar 04 2022 at 21:43)</a>:</h4>
<p>Having an SROA pass may be helpful too.</p>



<a name="274193160"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/189540-t-compiler/wg-mir-opt/topic/Things%20to%20do/near/274193160" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jubilee <a href="https://zulip-archive.rust-lang.org/stream/189540-t-compiler/wg-mir-opt/topic/Things.20to.20do.html#274193160">(Mar 04 2022 at 21:49)</a>:</h4>
<p>I've linked this at a few different people today so I'll do it again: <a href="https://github.com/rust-lang/rust/issues/86299">https://github.com/rust-lang/rust/issues/86299</a></p>
<blockquote>
<p><strong>Better documentation of our MIR dialects</strong><br>
We like to pretend that MIR is a single language, but that is not actually true. There are at least two different languages represented by MIR; I will call them MIR "dialects" in the following:</p>
</blockquote>



<a name="274195741"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/189540-t-compiler/wg-mir-opt/topic/Things%20to%20do/near/274195741" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jake <a href="https://zulip-archive.rust-lang.org/stream/189540-t-compiler/wg-mir-opt/topic/Things.20to.20do.html#274195741">(Mar 04 2022 at 22:14)</a>:</h4>
<p>Regarding the MIR semantics (both in general and with respect to dialects), this is absolutely something I'd be super willing to contribute to. Unfortunately, it doesn't seem like it's the kind of thing that a single person can drive (especially not someone like me with absolutely no standing to ask others to allocate resources). If there are things that a single person can do in this area (or a wider initiative to be a part of), I'd be super happy to help though.</p>



<a name="274195788"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/189540-t-compiler/wg-mir-opt/topic/Things%20to%20do/near/274195788" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jake <a href="https://zulip-archive.rust-lang.org/stream/189540-t-compiler/wg-mir-opt/topic/Things.20to.20do.html#274195788">(Mar 04 2022 at 22:14)</a>:</h4>
<p>One thing I've noticed is that there is no documentation (that I've found anyway) regarding which <code>StatementKind</code>s we can expect at which phases of MIR. I can try putting up a PR that makes this explicit in the <code>StatementKind</code> documentation</p>



<a name="274196814"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/189540-t-compiler/wg-mir-opt/topic/Things%20to%20do/near/274196814" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> matthiaskrgr <a href="https://zulip-archive.rust-lang.org/stream/189540-t-compiler/wg-mir-opt/topic/Things.20to.20do.html#274196814">(Mar 04 2022 at 22:25)</a>:</h4>
<p>we also have around 50 issues tagged with ICE that might be related to mir opts (just search for the tag + mir-opt-level) <span aria-label="thinking" class="emoji emoji-1f914" role="img" title="thinking">:thinking:</span></p>



<a name="274197159"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/189540-t-compiler/wg-mir-opt/topic/Things%20to%20do/near/274197159" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jubilee <a href="https://zulip-archive.rust-lang.org/stream/189540-t-compiler/wg-mir-opt/topic/Things.20to.20do.html#274197159">(Mar 04 2022 at 22:28)</a>:</h4>
<p><span class="user-mention silent" data-user-id="310518">Jake</span> <a href="#narrow/stream/189540-t-compiler.2Fwg-mir-opt/topic/Things.20to.20do/near/274195788">said</a>:</p>
<blockquote>
<p>One thing I've noticed is that there is no documentation (that I've found anyway) regarding which <code>StatementKind</code>s we can expect at which phases of MIR. I can try putting up a PR that makes this explicit in the <code>StatementKind</code> documentation</p>
</blockquote>
<p>yeah I disagree (somewhat, gently) with the "(not) the kind of thing that a single person can drive" because that kind of PR clearly is exactly the kind of thing that is needed and is within scope for 1 person to do. It might just kick off a big discussion tho'.</p>



<a name="274197223"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/189540-t-compiler/wg-mir-opt/topic/Things%20to%20do/near/274197223" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jubilee <a href="https://zulip-archive.rust-lang.org/stream/189540-t-compiler/wg-mir-opt/topic/Things.20to.20do.html#274197223">(Mar 04 2022 at 22:29)</a>:</h4>
<p>but like<br>
sometimes what you do is do a bunch of things which kick off big discussions</p>



<a name="274202430"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/189540-t-compiler/wg-mir-opt/topic/Things%20to%20do/near/274202430" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jake <a href="https://zulip-archive.rust-lang.org/stream/189540-t-compiler/wg-mir-opt/topic/Things.20to.20do.html#274202430">(Mar 04 2022 at 23:21)</a>:</h4>
<p><span class="user-mention silent" data-user-id="281757">Jubilee</span> <a href="#narrow/stream/189540-t-compiler.2Fwg-mir-opt/topic/Things.20to.20do/near/274197159">said</a>:</p>
<blockquote>
<p><span class="user-mention silent" data-user-id="310518">Jake</span> <a href="#narrow/stream/189540-t-compiler.2Fwg-mir-opt/topic/Things.20to.20do/near/274195788">said</a>:</p>
<blockquote>
<p>One thing I've noticed is that there is no documentation (that I've found anyway) regarding which <code>StatementKind</code>s we can expect at which phases of MIR. I can try putting up a PR that makes this explicit in the <code>StatementKind</code> documentation</p>
</blockquote>
<p>yeah I disagree (somewhat, gently) with the "(not) the kind of thing that a single person can drive" because that kind of PR clearly is exactly the kind of thing that is needed and is within scope for 1 person to do. It might just kick off a big discussion tho'.</p>
</blockquote>
<p>Sorry, I should have been more clear. I meant that clarifying MIR semantics requires input from a lot of people, and I don't want to assign these people work. If it's just a matter of having someone start writing documentation or whatever, I can do that. Maybe I'm overestimating the amount of design work there is to do here</p>



<a name="274267970"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/189540-t-compiler/wg-mir-opt/topic/Things%20to%20do/near/274267970" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> cjgillot <a href="https://zulip-archive.rust-lang.org/stream/189540-t-compiler/wg-mir-opt/topic/Things.20to.20do.html#274267970">(Mar 05 2022 at 22:17)</a>:</h4>
<blockquote>
<p>I don't want to assign these people work.</p>
</blockquote>
<p>I recommend you don't worry about it.  Just continue the good work you've been doing, and people will follow your lead.  Some may even be happy somebody is taking the lead in that subject <span aria-label="smile" class="emoji emoji-1f642" role="img" title="smile">:smile:</span>.</p>



<a name="274269499"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/189540-t-compiler/wg-mir-opt/topic/Things%20to%20do/near/274269499" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jubilee <a href="https://zulip-archive.rust-lang.org/stream/189540-t-compiler/wg-mir-opt/topic/Things.20to.20do.html#274269499">(Mar 05 2022 at 22:38)</a>:</h4>
<p><span class="user-mention silent" data-user-id="310518">Jake</span> <a href="#narrow/stream/189540-t-compiler.2Fwg-mir-opt/topic/Things.20to.20do/near/274202430">said</a>:</p>
<blockquote>
<p>If it's just a matter of having someone start writing documentation or whatever, I can do that. Maybe I'm overestimating the amount of design work there is to do here</p>
</blockquote>
<p>It is definitely not going to happen <strong>before</strong> someone starts extensively documenting how things are.</p>



<a name="274277558"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/189540-t-compiler/wg-mir-opt/topic/Things%20to%20do/near/274277558" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jake <a href="https://zulip-archive.rust-lang.org/stream/189540-t-compiler/wg-mir-opt/topic/Things.20to.20do.html#274277558">(Mar 06 2022 at 01:49)</a>:</h4>
<p><a href="https://github.com/rust-lang/rust/issues/94655">#94655</a> is up <span aria-label="smile" class="emoji emoji-1f642" role="img" title="smile">:smile:</span></p>



<hr><p>Last updated: Apr 12 2022 at 20:01 UTC</p>
</html>