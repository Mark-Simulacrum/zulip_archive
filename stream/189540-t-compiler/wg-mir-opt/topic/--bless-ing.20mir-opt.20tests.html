<html>
<head><meta charset="utf-8"><title>--bless-ing mir-opt tests · t-compiler/wg-mir-opt · Zulip Chat Archive</title></head>
<h2>Stream: <a href="https://rust-lang.github.io/zulip_archive/stream/189540-t-compiler/wg-mir-opt/index.html">t-compiler/wg-mir-opt</a></h2>
<h3>Topic: <a href="https://rust-lang.github.io/zulip_archive/stream/189540-t-compiler/wg-mir-opt/topic/--bless-ing.20mir-opt.20tests.html">--bless-ing mir-opt tests</a></h3>

<hr>

<base href="https://rust-lang.zulipchat.com">

<head><link href="https://rust-lang.github.io/zulip_archive/style.css" rel="stylesheet"></head>

<a name="193416225"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/189540-t-compiler/wg-mir-opt/topic/--bless-ing%20mir-opt%20tests/near/193416225" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> eddyb <a href="https://rust-lang.github.io/zulip_archive/stream/189540-t-compiler/wg-mir-opt/topic/--bless-ing.20mir-opt.20tests.html#193416225">(Apr 09 2020 at 07:41)</a>:</h4>
<p>so the command we have been using to handle re-blessing all mir-opt tests is:<br>
<code>rm src/test/mir-opt/**.{diff,mir};
touch src/test/mir-opt/**.rs; 
./x.py test --stage 1 src/tools/tidy src/test/mir-opt --bless --target x86_64-unknown-linux-gnu --target i686-unknown-linux-gnu</code></p>



<a name="193416366"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/189540-t-compiler/wg-mir-opt/topic/--bless-ing%20mir-opt%20tests/near/193416366" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> eddyb <a href="https://rust-lang.github.io/zulip_archive/stream/189540-t-compiler/wg-mir-opt/topic/--bless-ing.20mir-opt.20tests.html#193416366">(Apr 09 2020 at 07:43)</a>:</h4>
<p><span class="user-mention" data-user-id="124288">@oli</span> and the thing I'm scared about is PR CI not catching "output changed but only 64bit output was blessed, not 32bit"</p>



<a name="193416427"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/189540-t-compiler/wg-mir-opt/topic/--bless-ing%20mir-opt%20tests/near/193416427" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> eddyb <a href="https://rust-lang.github.io/zulip_archive/stream/189540-t-compiler/wg-mir-opt/topic/--bless-ing.20mir-opt.20tests.html#193416427">(Apr 09 2020 at 07:44)</a>:</h4>
<p>I wonder if we could run <em>just</em> <code>mir-opt</code> tests with a 32-bit target on CI</p>



<a name="193416449"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/189540-t-compiler/wg-mir-opt/topic/--bless-ing%20mir-opt%20tests/near/193416449" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> eddyb <a href="https://rust-lang.github.io/zulip_archive/stream/189540-t-compiler/wg-mir-opt/topic/--bless-ing.20mir-opt.20tests.html#193416449">(Apr 09 2020 at 07:44)</a>:</h4>
<p>we don't need a 32-bit host which should make it almost free, since it's just stdlib+this test suite</p>



<a name="193416473"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/189540-t-compiler/wg-mir-opt/topic/--bless-ing%20mir-opt%20tests/near/193416473" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> eddyb <a href="https://rust-lang.github.io/zulip_archive/stream/189540-t-compiler/wg-mir-opt/topic/--bless-ing.20mir-opt.20tests.html#193416473">(Apr 09 2020 at 07:44)</a>:</h4>
<p><span class="user-mention" data-user-id="116122">@simulacrum</span> <span class="user-mention" data-user-id="121055">@Pietro Albini</span> ^^ wdyt?</p>



<a name="193416583"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/189540-t-compiler/wg-mir-opt/topic/--bless-ing%20mir-opt%20tests/near/193416583" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> eddyb <a href="https://rust-lang.github.io/zulip_archive/stream/189540-t-compiler/wg-mir-opt/topic/--bless-ing.20mir-opt.20tests.html#193416583">(Apr 09 2020 at 07:46)</a>:</h4>
<p>or we could error if you use <code>--bless</code> with the <code>mir-opt</code> test suite and a 64bit file changes but you don't have a 32bit target <em>as well</em> (or the other way around I suppose) but compiletest doesn't know the targets, only the build system does</p>



<a name="193427732"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/189540-t-compiler/wg-mir-opt/topic/--bless-ing%20mir-opt%20tests/near/193427732" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Pietro Albini <a href="https://rust-lang.github.io/zulip_archive/stream/189540-t-compiler/wg-mir-opt/topic/--bless-ing.20mir-opt.20tests.html#193427732">(Apr 09 2020 at 09:45)</a>:</h4>
<p><span class="user-mention" data-user-id="119009">@eddyb</span> could you send a PR adding it to a builder so we can measure the impact?</p>



<a name="193435001"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/189540-t-compiler/wg-mir-opt/topic/--bless-ing%20mir-opt%20tests/near/193435001" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> eddyb <a href="https://rust-lang.github.io/zulip_archive/stream/189540-t-compiler/wg-mir-opt/topic/--bless-ing.20mir-opt.20tests.html#193435001">(Apr 09 2020 at 11:04)</a>:</h4>
<p><span class="user-mention" data-user-id="121055">@Pietro Albini</span> does the linux x64 PR CI builder have the multilib stuff installed? I mean for linking, even though running these tests doesn't really need a linkable libstd heh</p>



<a name="193435028"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/189540-t-compiler/wg-mir-opt/topic/--bless-ing%20mir-opt%20tests/near/193435028" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Pietro Albini <a href="https://rust-lang.github.io/zulip_archive/stream/189540-t-compiler/wg-mir-opt/topic/--bless-ing.20mir-opt.20tests.html#193435028">(Apr 09 2020 at 11:04)</a>:</h4>
<p>hmm I can't recall off the top of my head</p>



<a name="193435050"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/189540-t-compiler/wg-mir-opt/topic/--bless-ing%20mir-opt%20tests/near/193435050" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> eddyb <a href="https://rust-lang.github.io/zulip_archive/stream/189540-t-compiler/wg-mir-opt/topic/--bless-ing.20mir-opt.20tests.html#193435050">(Apr 09 2020 at 11:04)</a>:</h4>
<p>eh I guess I'll try</p>



<a name="193440299"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/189540-t-compiler/wg-mir-opt/topic/--bless-ing%20mir-opt%20tests/near/193440299" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> simulacrum <a href="https://rust-lang.github.io/zulip_archive/stream/189540-t-compiler/wg-mir-opt/topic/--bless-ing.20mir-opt.20tests.html#193440299">(Apr 09 2020 at 12:03)</a>:</h4>
<p>we can always add it, that should be not too hard I think</p>



<a name="193440300"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/189540-t-compiler/wg-mir-opt/topic/--bless-ing%20mir-opt%20tests/near/193440300" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> simulacrum <a href="https://rust-lang.github.io/zulip_archive/stream/189540-t-compiler/wg-mir-opt/topic/--bless-ing.20mir-opt.20tests.html#193440300">(Apr 09 2020 at 12:03)</a>:</h4>
<p>so long as it's just more apt things</p>



<a name="193562413"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/189540-t-compiler/wg-mir-opt/topic/--bless-ing%20mir-opt%20tests/near/193562413" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> eddyb <a href="https://rust-lang.github.io/zulip_archive/stream/189540-t-compiler/wg-mir-opt/topic/--bless-ing.20mir-opt.20tests.html#193562413">(Apr 10 2020 at 12:10)</a>:</h4>
<p>heh we already have two test runs on CI (the second one is for tidy)</p>



<a name="193574208"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/189540-t-compiler/wg-mir-opt/topic/--bless-ing%20mir-opt%20tests/near/193574208" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> eddyb <a href="https://rust-lang.github.io/zulip_archive/stream/189540-t-compiler/wg-mir-opt/topic/--bless-ing.20mir-opt.20tests.html#193574208">(Apr 10 2020 at 14:25)</a>:</h4>
<p>so the PR is opened: <a href="https://github.com/rust-lang/rust/issues/70989" title="https://github.com/rust-lang/rust/issues/70989">#70989</a></p>



<a name="193574277"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/189540-t-compiler/wg-mir-opt/topic/--bless-ing%20mir-opt%20tests/near/193574277" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> eddyb <a href="https://rust-lang.github.io/zulip_archive/stream/189540-t-compiler/wg-mir-opt/topic/--bless-ing.20mir-opt.20tests.html#193574277">(Apr 10 2020 at 14:26)</a>:</h4>
<p><span class="user-mention" data-user-id="116122">@simulacrum</span> for testing (I plan to add a commit that will create an intentional failure), do you think it's okay to rely on GHA or should I wait for Azure as well?</p>



<a name="193574336"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/189540-t-compiler/wg-mir-opt/topic/--bless-ing%20mir-opt%20tests/near/193574336" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> simulacrum <a href="https://rust-lang.github.io/zulip_archive/stream/189540-t-compiler/wg-mir-opt/topic/--bless-ing.20mir-opt.20tests.html#193574336">(Apr 10 2020 at 14:26)</a>:</h4>
<p>nah, gha should be fine for this</p>



<a name="193587223"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/189540-t-compiler/wg-mir-opt/topic/--bless-ing%20mir-opt%20tests/near/193587223" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> eddyb <a href="https://rust-lang.github.io/zulip_archive/stream/189540-t-compiler/wg-mir-opt/topic/--bless-ing.20mir-opt.20tests.html#193587223">(Apr 10 2020 at 16:18)</a>:</h4>
<p><span class="user-mention" data-user-id="116122">@simulacrum</span> <strong>c u r s e d</strong> <a href="https://github.com/rust-lang/rust/pull/70989#issuecomment-612103573" title="https://github.com/rust-lang/rust/pull/70989#issuecomment-612103573">https://github.com/rust-lang/rust/pull/70989#issuecomment-612103573</a></p>



<a name="193587399"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/189540-t-compiler/wg-mir-opt/topic/--bless-ing%20mir-opt%20tests/near/193587399" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> simulacrum <a href="https://rust-lang.github.io/zulip_archive/stream/189540-t-compiler/wg-mir-opt/topic/--bless-ing.20mir-opt.20tests.html#193587399">(Apr 10 2020 at 16:20)</a>:</h4>
<p>uh no you cannot really get a coredump from CI unfortunately</p>



<a name="193587405"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/189540-t-compiler/wg-mir-opt/topic/--bless-ing%20mir-opt%20tests/near/193587405" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> simulacrum <a href="https://rust-lang.github.io/zulip_archive/stream/189540-t-compiler/wg-mir-opt/topic/--bless-ing.20mir-opt.20tests.html#193587405">(Apr 10 2020 at 16:20)</a>:</h4>
<p>I guess retry?</p>



<a name="193587418"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/189540-t-compiler/wg-mir-opt/topic/--bless-ing%20mir-opt%20tests/near/193587418" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> simulacrum <a href="https://rust-lang.github.io/zulip_archive/stream/189540-t-compiler/wg-mir-opt/topic/--bless-ing.20mir-opt.20tests.html#193587418">(Apr 10 2020 at 16:20)</a>:</h4>
<p>or we can run locally...</p>



<a name="193587471"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/189540-t-compiler/wg-mir-opt/topic/--bless-ing%20mir-opt%20tests/near/193587471" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> eddyb <a href="https://rust-lang.github.io/zulip_archive/stream/189540-t-compiler/wg-mir-opt/topic/--bless-ing.20mir-opt.20tests.html#193587471">(Apr 10 2020 at 16:20)</a>:</h4>
<p>yeah I can bite the bullet and try to use Docker</p>



<a name="193597654"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/189540-t-compiler/wg-mir-opt/topic/--bless-ing%20mir-opt%20tests/near/193597654" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> eddyb <a href="https://rust-lang.github.io/zulip_archive/stream/189540-t-compiler/wg-mir-opt/topic/--bless-ing.20mir-opt.20tests.html#193597654">(Apr 10 2020 at 17:51)</a>:</h4>
<p><span class="user-mention" data-user-id="116122">@simulacrum</span> I missed this <a href="https://github.com/rust-lang/rust/pull/70989#issuecomment-612133962" title="https://github.com/rust-lang/rust/pull/70989#issuecomment-612133962">https://github.com/rust-lang/rust/pull/70989#issuecomment-612133962</a></p>



<a name="193597663"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/189540-t-compiler/wg-mir-opt/topic/--bless-ing%20mir-opt%20tests/near/193597663" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> eddyb <a href="https://rust-lang.github.io/zulip_archive/stream/189540-t-compiler/wg-mir-opt/topic/--bless-ing.20mir-opt.20tests.html#193597663">(Apr 10 2020 at 17:51)</a>:</h4>
<p>what's the goal here?</p>



<a name="193597756"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/189540-t-compiler/wg-mir-opt/topic/--bless-ing%20mir-opt%20tests/near/193597756" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> eddyb <a href="https://rust-lang.github.io/zulip_archive/stream/189540-t-compiler/wg-mir-opt/topic/--bless-ing.20mir-opt.20tests.html#193597756">(Apr 10 2020 at 17:52)</a>:</h4>
<p>I didn't change the Dockerfile that <code>@bors try</code> will use, AFAIK</p>



<a name="193597809"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/189540-t-compiler/wg-mir-opt/topic/--bless-ing%20mir-opt%20tests/near/193597809" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> eddyb <a href="https://rust-lang.github.io/zulip_archive/stream/189540-t-compiler/wg-mir-opt/topic/--bless-ing.20mir-opt.20tests.html#193597809">(Apr 10 2020 at 17:53)</a>:</h4>
<p>this is a noop PR modulo <code>src/ci/docker/x86_64-gnu-llvm-7/Dockerfile</code></p>



<a name="193597823"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/189540-t-compiler/wg-mir-opt/topic/--bless-ing%20mir-opt%20tests/near/193597823" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> simulacrum <a href="https://rust-lang.github.io/zulip_archive/stream/189540-t-compiler/wg-mir-opt/topic/--bless-ing.20mir-opt.20tests.html#193597823">(Apr 10 2020 at 17:53)</a>:</h4>
<p>Did I miss a try build?</p>



<a name="193597872"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/189540-t-compiler/wg-mir-opt/topic/--bless-ing%20mir-opt%20tests/near/193597872" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> simulacrum <a href="https://rust-lang.github.io/zulip_archive/stream/189540-t-compiler/wg-mir-opt/topic/--bless-ing.20mir-opt.20tests.html#193597872">(Apr 10 2020 at 17:53)</a>:</h4>
<p>oh I see</p>



<a name="193597885"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/189540-t-compiler/wg-mir-opt/topic/--bless-ing%20mir-opt%20tests/near/193597885" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> simulacrum <a href="https://rust-lang.github.io/zulip_archive/stream/189540-t-compiler/wg-mir-opt/topic/--bless-ing.20mir-opt.20tests.html#193597885">(Apr 10 2020 at 17:53)</a>:</h4>
<p>yeah I see what you mean</p>



<a name="193597907"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/189540-t-compiler/wg-mir-opt/topic/--bless-ing%20mir-opt%20tests/near/193597907" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> eddyb <a href="https://rust-lang.github.io/zulip_archive/stream/189540-t-compiler/wg-mir-opt/topic/--bless-ing.20mir-opt.20tests.html#193597907">(Apr 10 2020 at 17:53)</a>:</h4>
<p>feel free to cancel the try build if it's pointless :P</p>



<a name="193597949"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/189540-t-compiler/wg-mir-opt/topic/--bless-ing%20mir-opt%20tests/near/193597949" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> simulacrum <a href="https://rust-lang.github.io/zulip_archive/stream/189540-t-compiler/wg-mir-opt/topic/--bless-ing.20mir-opt.20tests.html#193597949">(Apr 10 2020 at 17:54)</a>:</h4>
<p>I forget how to do that</p>



<a name="193597993"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/189540-t-compiler/wg-mir-opt/topic/--bless-ing%20mir-opt%20tests/near/193597993" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> simulacrum <a href="https://rust-lang.github.io/zulip_archive/stream/189540-t-compiler/wg-mir-opt/topic/--bless-ing.20mir-opt.20tests.html#193597993">(Apr 10 2020 at 17:54)</a>:</h4>
<p>g++-multilib vs. gcc may be causing the linker trouble?</p>



<a name="193598014"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/189540-t-compiler/wg-mir-opt/topic/--bless-ing%20mir-opt%20tests/near/193598014" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> eddyb <a href="https://rust-lang.github.io/zulip_archive/stream/189540-t-compiler/wg-mir-opt/topic/--bless-ing.20mir-opt.20tests.html#193598014">(Apr 10 2020 at 17:54)</a>:</h4>
<p>what linker trouble?</p>



<a name="193598016"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/189540-t-compiler/wg-mir-opt/topic/--bless-ing%20mir-opt%20tests/near/193598016" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> simulacrum <a href="https://rust-lang.github.io/zulip_archive/stream/189540-t-compiler/wg-mir-opt/topic/--bless-ing.20mir-opt.20tests.html#193598016">(Apr 10 2020 at 17:54)</a>:</h4>
<p>but it looks like we're specifically having problems with rustc segfaulting, not the linker</p>



<a name="193598036"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/189540-t-compiler/wg-mir-opt/topic/--bless-ing%20mir-opt%20tests/near/193598036" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> eddyb <a href="https://rust-lang.github.io/zulip_archive/stream/189540-t-compiler/wg-mir-opt/topic/--bless-ing.20mir-opt.20tests.html#193598036">(Apr 10 2020 at 17:54)</a>:</h4>
<p>I fixed the first failure by switching to <code>-multilib</code></p>



<a name="193598050"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/189540-t-compiler/wg-mir-opt/topic/--bless-ing%20mir-opt%20tests/near/193598050" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> simulacrum <a href="https://rust-lang.github.io/zulip_archive/stream/189540-t-compiler/wg-mir-opt/topic/--bless-ing.20mir-opt.20tests.html#193598050">(Apr 10 2020 at 17:54)</a>:</h4>
<p>well, I mean that g++-multilib could be giving us a broken compiler somehow</p>



<a name="193598052"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/189540-t-compiler/wg-mir-opt/topic/--bless-ing%20mir-opt%20tests/near/193598052" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> eddyb <a href="https://rust-lang.github.io/zulip_archive/stream/189540-t-compiler/wg-mir-opt/topic/--bless-ing.20mir-opt.20tests.html#193598052">(Apr 10 2020 at 17:54)</a>:</h4>
<p>which started segfaulting :D</p>



<a name="193598061"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/189540-t-compiler/wg-mir-opt/topic/--bless-ing%20mir-opt%20tests/near/193598061" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> eddyb <a href="https://rust-lang.github.io/zulip_archive/stream/189540-t-compiler/wg-mir-opt/topic/--bless-ing.20mir-opt.20tests.html#193598061">(Apr 10 2020 at 17:54)</a>:</h4>
<p>ah okay</p>



<a name="193598133"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/189540-t-compiler/wg-mir-opt/topic/--bless-ing%20mir-opt%20tests/near/193598133" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> eddyb <a href="https://rust-lang.github.io/zulip_archive/stream/189540-t-compiler/wg-mir-opt/topic/--bless-ing.20mir-opt.20tests.html#193598133">(Apr 10 2020 at 17:55)</a>:</h4>
<p><span class="user-mention" data-user-id="116122">@simulacrum</span> I can make the <code>@bors try</code> Dockerfile pass <code>--target=i686-...</code> if you want to test that</p>



<a name="193598149"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/189540-t-compiler/wg-mir-opt/topic/--bless-ing%20mir-opt%20tests/near/193598149" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> simulacrum <a href="https://rust-lang.github.io/zulip_archive/stream/189540-t-compiler/wg-mir-opt/topic/--bless-ing.20mir-opt.20tests.html#193598149">(Apr 10 2020 at 17:55)</a>:</h4>
<p>yeah let's do that I guess</p>



<a name="193598152"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/189540-t-compiler/wg-mir-opt/topic/--bless-ing%20mir-opt%20tests/near/193598152" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> eddyb <a href="https://rust-lang.github.io/zulip_archive/stream/189540-t-compiler/wg-mir-opt/topic/--bless-ing.20mir-opt.20tests.html#193598152">(Apr 10 2020 at 17:55)</a>:</h4>
<p>and even run the mir-opt tests actually, that should be easy</p>



<a name="193598469"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/189540-t-compiler/wg-mir-opt/topic/--bless-ing%20mir-opt%20tests/near/193598469" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> eddyb <a href="https://rust-lang.github.io/zulip_archive/stream/189540-t-compiler/wg-mir-opt/topic/--bless-ing.20mir-opt.20tests.html#193598469">(Apr 10 2020 at 17:58)</a>:</h4>
<p><span class="user-mention" data-user-id="116122">@simulacrum</span> ugh <code>dist-x86_64-linux</code> is CentOS</p>



<a name="193598526"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/189540-t-compiler/wg-mir-opt/topic/--bless-ing%20mir-opt%20tests/near/193598526" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> eddyb <a href="https://rust-lang.github.io/zulip_archive/stream/189540-t-compiler/wg-mir-opt/topic/--bless-ing.20mir-opt.20tests.html#193598526">(Apr 10 2020 at 17:58)</a>:</h4>
<p>let me try to bump the LLVM version instead</p>



<a name="193598557"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/189540-t-compiler/wg-mir-opt/topic/--bless-ing%20mir-opt%20tests/near/193598557" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> simulacrum <a href="https://rust-lang.github.io/zulip_archive/stream/189540-t-compiler/wg-mir-opt/topic/--bless-ing.20mir-opt.20tests.html#193598557">(Apr 10 2020 at 17:58)</a>:</h4>
<p>alternatively we can use the normal x86 tests builder probably</p>



<a name="193598591"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/189540-t-compiler/wg-mir-opt/topic/--bless-ing%20mir-opt%20tests/near/193598591" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> eddyb <a href="https://rust-lang.github.io/zulip_archive/stream/189540-t-compiler/wg-mir-opt/topic/--bless-ing.20mir-opt.20tests.html#193598591">(Apr 10 2020 at 17:59)</a>:</h4>
<p>we're on LLVM9 nowadays right?</p>



<a name="193598611"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/189540-t-compiler/wg-mir-opt/topic/--bless-ing%20mir-opt%20tests/near/193598611" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> simulacrum <a href="https://rust-lang.github.io/zulip_archive/stream/189540-t-compiler/wg-mir-opt/topic/--bless-ing.20mir-opt.20tests.html#193598611">(Apr 10 2020 at 17:59)</a>:</h4>
<p>that sounds correct</p>



<a name="193608343"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/189540-t-compiler/wg-mir-opt/topic/--bless-ing%20mir-opt%20tests/near/193608343" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> eddyb <a href="https://rust-lang.github.io/zulip_archive/stream/189540-t-compiler/wg-mir-opt/topic/--bless-ing.20mir-opt.20tests.html#193608343">(Apr 10 2020 at 19:31)</a>:</h4>
<p>ugh where does <a href="https://packages.ubuntu.com/bionic/devel/llvm-9-tools" title="https://packages.ubuntu.com/bionic/devel/llvm-9-tools">https://packages.ubuntu.com/bionic/devel/llvm-9-tools</a> place LLVM</p>



<a name="193608490"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/189540-t-compiler/wg-mir-opt/topic/--bless-ing%20mir-opt%20tests/near/193608490" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> eddyb <a href="https://rust-lang.github.io/zulip_archive/stream/189540-t-compiler/wg-mir-opt/topic/--bless-ing.20mir-opt.20tests.html#193608490">(Apr 10 2020 at 19:32)</a>:</h4>
<p>oh <a href="https://salsa.debian.org/pkg-llvm-team/llvm-toolchain/-/blob/9/debian/llvm-X.Y-tools.install.in" title="https://salsa.debian.org/pkg-llvm-team/llvm-toolchain/-/blob/9/debian/llvm-X.Y-tools.install.in">https://salsa.debian.org/pkg-llvm-team/llvm-toolchain/-/blob/9/debian/llvm-X.Y-tools.install.in</a></p>



<a name="193608610"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/189540-t-compiler/wg-mir-opt/topic/--bless-ing%20mir-opt%20tests/near/193608610" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> eddyb <a href="https://rust-lang.github.io/zulip_archive/stream/189540-t-compiler/wg-mir-opt/topic/--bless-ing.20mir-opt.20tests.html#193608610">(Apr 10 2020 at 19:34)</a>:</h4>
<p>wait why didn't usr/bin/llvm-9 work :/</p>



<a name="193608850"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/189540-t-compiler/wg-mir-opt/topic/--bless-ing%20mir-opt%20tests/near/193608850" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> eddyb <a href="https://rust-lang.github.io/zulip_archive/stream/189540-t-compiler/wg-mir-opt/topic/--bless-ing.20mir-opt.20tests.html#193608850">(Apr 10 2020 at 19:37)</a>:</h4>
<p>oh lol you just run <code>llvm-config-9</code></p>



<a name="193608856"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/189540-t-compiler/wg-mir-opt/topic/--bless-ing%20mir-opt%20tests/near/193608856" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> eddyb <a href="https://rust-lang.github.io/zulip_archive/stream/189540-t-compiler/wg-mir-opt/topic/--bless-ing.20mir-opt.20tests.html#193608856">(Apr 10 2020 at 19:37)</a>:</h4>
<p>at least their scripts do</p>



<a name="193615375"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/189540-t-compiler/wg-mir-opt/topic/--bless-ing%20mir-opt%20tests/near/193615375" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> eddyb <a href="https://rust-lang.github.io/zulip_archive/stream/189540-t-compiler/wg-mir-opt/topic/--bless-ing.20mir-opt.20tests.html#193615375">(Apr 10 2020 at 20:40)</a>:</h4>
<p>what the hell, that doesn't exist</p>



<a name="193615401"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/189540-t-compiler/wg-mir-opt/topic/--bless-ing%20mir-opt%20tests/near/193615401" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> eddyb <a href="https://rust-lang.github.io/zulip_archive/stream/189540-t-compiler/wg-mir-opt/topic/--bless-ing.20mir-opt.20tests.html#193615401">(Apr 10 2020 at 20:41)</a>:</h4>
<p>is it just lies or is llvm-9-tools the wrong package?!</p>



<a name="193616488"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/189540-t-compiler/wg-mir-opt/topic/--bless-ing%20mir-opt%20tests/near/193616488" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> eddyb <a href="https://rust-lang.github.io/zulip_archive/stream/189540-t-compiler/wg-mir-opt/topic/--bless-ing.20mir-opt.20tests.html#193616488">(Apr 10 2020 at 20:52)</a>:</h4>
<blockquote>
<p>failed to execute command: "/usr/bin/llvm-config" "--bindir"<br>
error: No such file or directory (os error 2)</p>
</blockquote>



<a name="193616491"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/189540-t-compiler/wg-mir-opt/topic/--bless-ing%20mir-opt%20tests/near/193616491" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> eddyb <a href="https://rust-lang.github.io/zulip_archive/stream/189540-t-compiler/wg-mir-opt/topic/--bless-ing.20mir-opt.20tests.html#193616491">(Apr 10 2020 at 20:52)</a>:</h4>
<p>ughhhh</p>



<a name="193617480"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/189540-t-compiler/wg-mir-opt/topic/--bless-ing%20mir-opt%20tests/near/193617480" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> eddyb <a href="https://rust-lang.github.io/zulip_archive/stream/189540-t-compiler/wg-mir-opt/topic/--bless-ing.20mir-opt.20tests.html#193617480">(Apr 10 2020 at 21:03)</a>:</h4>
<p>okay found something <a href="https://packages.ubuntu.com/search?suite=bionic-updates&amp;arch=any&amp;mode=filename&amp;searchon=contents&amp;keywords=llvm-config" title="https://packages.ubuntu.com/search?suite=bionic-updates&amp;arch=any&amp;mode=filename&amp;searchon=contents&amp;keywords=llvm-config">https://packages.ubuntu.com/search?suite=bionic-updates&amp;arch=any&amp;mode=filename&amp;searchon=contents&amp;keywords=llvm-config</a></p>



<a name="193617602"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/189540-t-compiler/wg-mir-opt/topic/--bless-ing%20mir-opt%20tests/near/193617602" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> eddyb <a href="https://rust-lang.github.io/zulip_archive/stream/189540-t-compiler/wg-mir-opt/topic/--bless-ing.20mir-opt.20tests.html#193617602">(Apr 10 2020 at 21:05)</a>:</h4>
<p>why were we using <code>llvm-7-tools</code>? only <code>llvm-7-dev</code> looks correct :|</p>



<a name="193617731"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/189540-t-compiler/wg-mir-opt/topic/--bless-ing%20mir-opt%20tests/near/193617731" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> eddyb <a href="https://rust-lang.github.io/zulip_archive/stream/189540-t-compiler/wg-mir-opt/topic/--bless-ing.20mir-opt.20tests.html#193617731">(Apr 10 2020 at 21:07)</a>:</h4>
<p><span class="user-mention" data-user-id="116122">@simulacrum</span> goddammit I figured it out:</p>
<ul>
<li><a href="https://packages.ubuntu.com/bionic-updates/llvm-7-tools" title="https://packages.ubuntu.com/bionic-updates/llvm-7-tools"><code>llvm-7-tools</code></a> depends on <code>llvm-7-dev</code> (and <code>llvm-8-*</code> is the same)</li>
<li><a href="https://packages.ubuntu.com/bionic-updates/llvm-9-dev" title="https://packages.ubuntu.com/bionic-updates/llvm-9-dev"><code>llvm-9-dev</code></a> depends on <code>llvm-9-tools</code></li>
</ul>



<a name="193619539"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/189540-t-compiler/wg-mir-opt/topic/--bless-ing%20mir-opt%20tests/near/193619539" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> eddyb <a href="https://rust-lang.github.io/zulip_archive/stream/189540-t-compiler/wg-mir-opt/topic/--bless-ing.20mir-opt.20tests.html#193619539">(Apr 10 2020 at 21:26)</a>:</h4>
<p><span class="user-mention" data-user-id="116122">@simulacrum</span> nailed it :)</p>



<a name="193619553"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/189540-t-compiler/wg-mir-opt/topic/--bless-ing%20mir-opt%20tests/near/193619553" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> eddyb <a href="https://rust-lang.github.io/zulip_archive/stream/189540-t-compiler/wg-mir-opt/topic/--bless-ing.20mir-opt.20tests.html#193619553">(Apr 10 2020 at 21:26)</a>:</h4>
<p>now to see if this fixes the segfault lol</p>



<a name="193622344"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/189540-t-compiler/wg-mir-opt/topic/--bless-ing%20mir-opt%20tests/near/193622344" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> eddyb <a href="https://rust-lang.github.io/zulip_archive/stream/189540-t-compiler/wg-mir-opt/topic/--bless-ing.20mir-opt.20tests.html#193622344">(Apr 10 2020 at 21:54)</a>:</h4>
<p>lol I found a bug in the tests</p>



<a name="193622349"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/189540-t-compiler/wg-mir-opt/topic/--bless-ing%20mir-opt%20tests/near/193622349" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> eddyb <a href="https://rust-lang.github.io/zulip_archive/stream/189540-t-compiler/wg-mir-opt/topic/--bless-ing.20mir-opt.20tests.html#193622349">(Apr 10 2020 at 21:55)</a>:</h4>
<p><em>siiiiigh</em></p>



<a name="193627338"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/189540-t-compiler/wg-mir-opt/topic/--bless-ing%20mir-opt%20tests/near/193627338" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> eddyb <a href="https://rust-lang.github.io/zulip_archive/stream/189540-t-compiler/wg-mir-opt/topic/--bless-ing.20mir-opt.20tests.html#193627338">(Apr 10 2020 at 22:54)</a>:</h4>
<p><span class="user-mention" data-user-id="116122">@simulacrum</span> progress! <a href="https://github.com/rust-lang/rust/pull/70989#issuecomment-612254495" title="https://github.com/rust-lang/rust/pull/70989#issuecomment-612254495">https://github.com/rust-lang/rust/pull/70989#issuecomment-612254495</a></p>



<a name="193627927"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/189540-t-compiler/wg-mir-opt/topic/--bless-ing%20mir-opt%20tests/near/193627927" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> simulacrum <a href="https://rust-lang.github.io/zulip_archive/stream/189540-t-compiler/wg-mir-opt/topic/--bless-ing.20mir-opt.20tests.html#193627927">(Apr 10 2020 at 23:03)</a>:</h4>
<p>I'm a bit confused how your PR managed to trigger this</p>



<a name="193628014"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/189540-t-compiler/wg-mir-opt/topic/--bless-ing%20mir-opt%20tests/near/193628014" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> eddyb <a href="https://rust-lang.github.io/zulip_archive/stream/189540-t-compiler/wg-mir-opt/topic/--bless-ing.20mir-opt.20tests.html#193628014">(Apr 10 2020 at 23:04)</a>:</h4>
<p><span class="user-mention" data-user-id="116122">@simulacrum</span> we don't really use LLVM 7 nowadays :P</p>



<a name="193628036"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/189540-t-compiler/wg-mir-opt/topic/--bless-ing%20mir-opt%20tests/near/193628036" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> simulacrum <a href="https://rust-lang.github.io/zulip_archive/stream/189540-t-compiler/wg-mir-opt/topic/--bless-ing.20mir-opt.20tests.html#193628036">(Apr 10 2020 at 23:05)</a>:</h4>
<p>Well I mean that you didn't change anything in built-ins</p>



<a name="193628038"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/189540-t-compiler/wg-mir-opt/topic/--bless-ing%20mir-opt%20tests/near/193628038" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> eddyb <a href="https://rust-lang.github.io/zulip_archive/stream/189540-t-compiler/wg-mir-opt/topic/--bless-ing.20mir-opt.20tests.html#193628038">(Apr 10 2020 at 23:05)</a>:</h4>
<p>and it's system LLVM so it could have old bugs we're hitting with new compiler code</p>



<a name="193628054"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/189540-t-compiler/wg-mir-opt/topic/--bless-ing%20mir-opt%20tests/near/193628054" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> eddyb <a href="https://rust-lang.github.io/zulip_archive/stream/189540-t-compiler/wg-mir-opt/topic/--bless-ing.20mir-opt.20tests.html#193628054">(Apr 10 2020 at 23:05)</a>:</h4>
<p><span class="user-mention" data-user-id="116122">@simulacrum</span> I think we've been running miscompiled rustc for a while :)</p>



<a name="193628110"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/189540-t-compiler/wg-mir-opt/topic/--bless-ing%20mir-opt%20tests/near/193628110" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> eddyb <a href="https://rust-lang.github.io/zulip_archive/stream/189540-t-compiler/wg-mir-opt/topic/--bless-ing.20mir-opt.20tests.html#193628110">(Apr 10 2020 at 23:06)</a>:</h4>
<p>it just doesn't affect 64-bit builds</p>



<a name="193628114"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/189540-t-compiler/wg-mir-opt/topic/--bless-ing%20mir-opt%20tests/near/193628114" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> eddyb <a href="https://rust-lang.github.io/zulip_archive/stream/189540-t-compiler/wg-mir-opt/topic/--bless-ing.20mir-opt.20tests.html#193628114">(Apr 10 2020 at 23:06)</a>:</h4>
<p>I will take a simpler explanation but idk</p>



<a name="193628126"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/189540-t-compiler/wg-mir-opt/topic/--bless-ing%20mir-opt%20tests/near/193628126" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> simulacrum <a href="https://rust-lang.github.io/zulip_archive/stream/189540-t-compiler/wg-mir-opt/topic/--bless-ing.20mir-opt.20tests.html#193628126">(Apr 10 2020 at 23:06)</a>:</h4>
<p>Hm alright</p>



<a name="193628130"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/189540-t-compiler/wg-mir-opt/topic/--bless-ing%20mir-opt%20tests/near/193628130" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> eddyb <a href="https://rust-lang.github.io/zulip_archive/stream/189540-t-compiler/wg-mir-opt/topic/--bless-ing.20mir-opt.20tests.html#193628130">(Apr 10 2020 at 23:06)</a>:</h4>
<p><span class="user-mention" data-user-id="116122">@simulacrum</span> oh oh I know how to bypass this: run the tests at stage1 :D</p>



<a name="193628142"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/189540-t-compiler/wg-mir-opt/topic/--bless-ing%20mir-opt%20tests/near/193628142" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> eddyb <a href="https://rust-lang.github.io/zulip_archive/stream/189540-t-compiler/wg-mir-opt/topic/--bless-ing.20mir-opt.20tests.html#193628142">(Apr 10 2020 at 23:06)</a>:</h4>
<p>we have no ignore-stage1 mir-opt tests</p>



<a name="193628254"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/189540-t-compiler/wg-mir-opt/topic/--bless-ing%20mir-opt%20tests/near/193628254" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> simulacrum <a href="https://rust-lang.github.io/zulip_archive/stream/189540-t-compiler/wg-mir-opt/topic/--bless-ing.20mir-opt.20tests.html#193628254">(Apr 10 2020 at 23:08)</a>:</h4>
<p>Seems intriguing</p>



<a name="193628283"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/189540-t-compiler/wg-mir-opt/topic/--bless-ing%20mir-opt%20tests/near/193628283" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> simulacrum <a href="https://rust-lang.github.io/zulip_archive/stream/189540-t-compiler/wg-mir-opt/topic/--bless-ing.20mir-opt.20tests.html#193628283">(Apr 10 2020 at 23:09)</a>:</h4>
<p>I don't really care :)</p>



<a name="193628414"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/189540-t-compiler/wg-mir-opt/topic/--bless-ing%20mir-opt%20tests/near/193628414" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> eddyb <a href="https://rust-lang.github.io/zulip_archive/stream/189540-t-compiler/wg-mir-opt/topic/--bless-ing.20mir-opt.20tests.html#193628414">(Apr 10 2020 at 23:11)</a>:</h4>
<p><span class="user-mention" data-user-id="116122">@simulacrum</span> do you want me to open an issue or should we treat this as a LLVM7 WONTFIX?</p>



<a name="193628489"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/189540-t-compiler/wg-mir-opt/topic/--bless-ing%20mir-opt%20tests/near/193628489" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> eddyb <a href="https://rust-lang.github.io/zulip_archive/stream/189540-t-compiler/wg-mir-opt/topic/--bless-ing.20mir-opt.20tests.html#193628489">(Apr 10 2020 at 23:12)</a>:</h4>
<p>the easiest thing I can offer is a tiny diff for the PR CI <code>Dockerfile</code></p>



<a name="193628575"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/189540-t-compiler/wg-mir-opt/topic/--bless-ing%20mir-opt%20tests/near/193628575" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> simulacrum <a href="https://rust-lang.github.io/zulip_archive/stream/189540-t-compiler/wg-mir-opt/topic/--bless-ing.20mir-opt.20tests.html#193628575">(Apr 10 2020 at 23:13)</a>:</h4>
<p>Let's treat as won't fix</p>



<a name="193630519"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/189540-t-compiler/wg-mir-opt/topic/--bless-ing%20mir-opt%20tests/near/193630519" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> eddyb <a href="https://rust-lang.github.io/zulip_archive/stream/189540-t-compiler/wg-mir-opt/topic/--bless-ing.20mir-opt.20tests.html#193630519">(Apr 10 2020 at 23:43)</a>:</h4>
<p><span class="user-mention" data-user-id="116122">@simulacrum</span> welp, workaround wouldn't work <a href="https://github.com/rust-lang/rust/pull/70989#issuecomment-612267971" title="https://github.com/rust-lang/rust/pull/70989#issuecomment-612267971">https://github.com/rust-lang/rust/pull/70989#issuecomment-612267971</a></p>



<a name="193630577"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/189540-t-compiler/wg-mir-opt/topic/--bless-ing%20mir-opt%20tests/near/193630577" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> eddyb <a href="https://rust-lang.github.io/zulip_archive/stream/189540-t-compiler/wg-mir-opt/topic/--bless-ing.20mir-opt.20tests.html#193630577">(Apr 10 2020 at 23:44)</a>:</h4>
<p>I'm guessing <code>not_atomic</code> is too new?</p>



<a name="193630585"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/189540-t-compiler/wg-mir-opt/topic/--bless-ing%20mir-opt%20tests/near/193630585" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> eddyb <a href="https://rust-lang.github.io/zulip_archive/stream/189540-t-compiler/wg-mir-opt/topic/--bless-ing.20mir-opt.20tests.html#193630585">(Apr 10 2020 at 23:44)</a>:</h4>
<p>and the connection is that 32-bit targets need some atomic emulation or something</p>



<a name="193630597"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/189540-t-compiler/wg-mir-opt/topic/--bless-ing%20mir-opt%20tests/near/193630597" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> simulacrum <a href="https://rust-lang.github.io/zulip_archive/stream/189540-t-compiler/wg-mir-opt/topic/--bless-ing.20mir-opt.20tests.html#193630597">(Apr 10 2020 at 23:44)</a>:</h4>
<p>Hm yeah seems plausible</p>



<a name="193630627"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/189540-t-compiler/wg-mir-opt/topic/--bless-ing%20mir-opt%20tests/near/193630627" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> simulacrum <a href="https://rust-lang.github.io/zulip_archive/stream/189540-t-compiler/wg-mir-opt/topic/--bless-ing.20mir-opt.20tests.html#193630627">(Apr 10 2020 at 23:45)</a>:</h4>
<p>I guess we'll have to just not test this on a PR builder?</p>



<a name="193630642"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/189540-t-compiler/wg-mir-opt/topic/--bless-ing%20mir-opt%20tests/near/193630642" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> simulacrum <a href="https://rust-lang.github.io/zulip_archive/stream/189540-t-compiler/wg-mir-opt/topic/--bless-ing.20mir-opt.20tests.html#193630642">(Apr 10 2020 at 23:45)</a>:</h4>
<p>I'd rather not bump llvm version for this</p>



<a name="193630696"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/189540-t-compiler/wg-mir-opt/topic/--bless-ing%20mir-opt%20tests/near/193630696" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> simulacrum <a href="https://rust-lang.github.io/zulip_archive/stream/189540-t-compiler/wg-mir-opt/topic/--bless-ing.20mir-opt.20tests.html#193630696">(Apr 10 2020 at 23:46)</a>:</h4>
<p>(even if I guess it's broken for 32 bit anyway)</p>



<a name="193630748"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/189540-t-compiler/wg-mir-opt/topic/--bless-ing%20mir-opt%20tests/near/193630748" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> eddyb <a href="https://rust-lang.github.io/zulip_archive/stream/189540-t-compiler/wg-mir-opt/topic/--bless-ing.20mir-opt.20tests.html#193630748">(Apr 10 2020 at 23:47)</a>:</h4>
<p>likely caused by <a href="https://github.com/rust-lang/compiler-builtins/pull/311" title="https://github.com/rust-lang/compiler-builtins/pull/311">https://github.com/rust-lang/compiler-builtins/pull/311</a></p>



<a name="193631076"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/189540-t-compiler/wg-mir-opt/topic/--bless-ing%20mir-opt%20tests/near/193631076" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> eddyb <a href="https://rust-lang.github.io/zulip_archive/stream/189540-t-compiler/wg-mir-opt/topic/--bless-ing.20mir-opt.20tests.html#193631076">(Apr 10 2020 at 23:51)</a>:</h4>
<p>left <a href="https://github.com/rust-lang/compiler-builtins/pull/311#issuecomment-612270089" title="https://github.com/rust-lang/compiler-builtins/pull/311#issuecomment-612270089">https://github.com/rust-lang/compiler-builtins/pull/311#issuecomment-612270089</a></p>



<a name="193631159"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/189540-t-compiler/wg-mir-opt/topic/--bless-ing%20mir-opt%20tests/near/193631159" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> eddyb <a href="https://rust-lang.github.io/zulip_archive/stream/189540-t-compiler/wg-mir-opt/topic/--bless-ing.20mir-opt.20tests.html#193631159">(Apr 10 2020 at 23:53)</a>:</h4>
<p>it's gated by <code>#[cfg(target_has_atomic_load_store = "64")]</code></p>



<a name="193631249"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/189540-t-compiler/wg-mir-opt/topic/--bless-ing%20mir-opt%20tests/near/193631249" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> eddyb <a href="https://rust-lang.github.io/zulip_archive/stream/189540-t-compiler/wg-mir-opt/topic/--bless-ing.20mir-opt.20tests.html#193631249">(Apr 10 2020 at 23:54)</a>:</h4>
<p>shot: <a href="https://github.com/rust-lang/rust/blob/master/src/librustc_target/spec/i686_unknown_linux_gnu.rs#L6" title="https://github.com/rust-lang/rust/blob/master/src/librustc_target/spec/i686_unknown_linux_gnu.rs#L6">https://github.com/rust-lang/rust/blob/master/src/librustc_target/spec/i686_unknown_linux_gnu.rs#L6</a><br>
chaser: <a href="https://github.com/rust-lang/rust/blob/master/src/librustc_target/spec/i586_unknown_linux_gnu.rs" title="https://github.com/rust-lang/rust/blob/master/src/librustc_target/spec/i586_unknown_linux_gnu.rs">https://github.com/rust-lang/rust/blob/master/src/librustc_target/spec/i586_unknown_linux_gnu.rs</a></p>



<a name="193637757"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/189540-t-compiler/wg-mir-opt/topic/--bless-ing%20mir-opt%20tests/near/193637757" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> eddyb <a href="https://rust-lang.github.io/zulip_archive/stream/189540-t-compiler/wg-mir-opt/topic/--bless-ing.20mir-opt.20tests.html#193637757">(Apr 11 2020 at 02:18)</a>:</h4>
<p>aaaand it still segfaults :/ <a href="https://github.com/rust-lang/rust/pull/70989#issuecomment-612292682" title="https://github.com/rust-lang/rust/pull/70989#issuecomment-612292682">https://github.com/rust-lang/rust/pull/70989#issuecomment-612292682</a></p>



<a name="193637766"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/189540-t-compiler/wg-mir-opt/topic/--bless-ing%20mir-opt%20tests/near/193637766" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> eddyb <a href="https://rust-lang.github.io/zulip_archive/stream/189540-t-compiler/wg-mir-opt/topic/--bless-ing.20mir-opt.20tests.html#193637766">(Apr 11 2020 at 02:18)</a>:</h4>
<p>time to go back to LLVM 8 to diagnose <em>sigh</em></p>



<a name="193638060"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/189540-t-compiler/wg-mir-opt/topic/--bless-ing%20mir-opt%20tests/near/193638060" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> eddyb <a href="https://rust-lang.github.io/zulip_archive/stream/189540-t-compiler/wg-mir-opt/topic/--bless-ing.20mir-opt.20tests.html#193638060">(Apr 11 2020 at 02:24)</a>:</h4>
<p><a href="/user_uploads/4715/e95uZcdZJLvO9LzgtUA95BP_/image.png" title="image.png">image.png</a></p>
<div class="message_inline_image"><a href="/user_uploads/4715/e95uZcdZJLvO9LzgtUA95BP_/image.png" title="image.png"><img src="/user_uploads/4715/e95uZcdZJLvO9LzgtUA95BP_/image.png"></a></div>



<a name="193638063"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/189540-t-compiler/wg-mir-opt/topic/--bless-ing%20mir-opt%20tests/near/193638063" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> eddyb <a href="https://rust-lang.github.io/zulip_archive/stream/189540-t-compiler/wg-mir-opt/topic/--bless-ing.20mir-opt.20tests.html#193638063">(Apr 11 2020 at 02:24)</a>:</h4>
<p>this may be the GitHub extension. just noticed this, seems handy heh</p>



<a name="193639589"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/189540-t-compiler/wg-mir-opt/topic/--bless-ing%20mir-opt%20tests/near/193639589" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> eddyb <a href="https://rust-lang.github.io/zulip_archive/stream/189540-t-compiler/wg-mir-opt/topic/--bless-ing.20mir-opt.20tests.html#193639589">(Apr 11 2020 at 03:17)</a>:</h4>
<p><span class="user-mention" data-user-id="116122">@simulacrum</span> okay <code>armv5te-unknown-linux-gnueabi</code> works lmao</p>



<hr><p>Last updated: Aug 07 2021 at 22:04 UTC</p>
</html>