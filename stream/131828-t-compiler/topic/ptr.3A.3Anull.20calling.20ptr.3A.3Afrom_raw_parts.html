<html>
<head><meta charset="utf-8"><title>ptr::null calling ptr::from_raw_parts · t-compiler · Zulip Chat Archive</title></head>
<h2>Stream: <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/index.html">t-compiler</a></h2>
<h3>Topic: <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/ptr.3A.3Anull.20calling.20ptr.3A.3Afrom_raw_parts.html">ptr::null calling ptr::from_raw_parts</a></h3>

<hr>

<base href="https://rust-lang.zulipchat.com">

<head><link href="https://zulip-archive.rust-lang.org/style.css" rel="stylesheet"></head>

<a name="271869904"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/ptr%3A%3Anull%20calling%20ptr%3A%3Afrom_raw_parts/near/271869904" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Simon Sapin <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/ptr.3A.3Anull.20calling.20ptr.3A.3Afrom_raw_parts.html#271869904">(Feb 14 2022 at 18:45)</a>:</h4>
<p>For implementing <a href="https://github.com/rust-lang/rust/issues/93959">https://github.com/rust-lang/rust/issues/93959</a> I’m changing <code>ptr::null</code> from <code>0 as *const T</code> (which only works for <code>T: Sized</code>) to <code>ptr::from_raw_parts(0 as *const (), ())</code> and get this error:</p>
<div class="codehilite"><pre><span></span><code>error: `ptr::metadata::from_raw_parts` is not yet stable as a const fn
help: const-stable functions can only call other const-stable functions
</code></pre></div>



<a name="271870117"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/ptr%3A%3Anull%20calling%20ptr%3A%3Afrom_raw_parts/near/271870117" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Simon Sapin <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/ptr.3A.3Anull.20calling.20ptr.3A.3Afrom_raw_parts.html#271870117">(Feb 14 2022 at 18:46)</a>:</h4>
<p>What do you recommend here? Is there an escape hatch? I could copy and inline the body of <code>from_raw_parts</code> in order to follow the letter of this rule but that doesn’t seem like a beneficial change</p>



<a name="271870333"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/ptr%3A%3Anull%20calling%20ptr%3A%3Afrom_raw_parts/near/271870333" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Simon Sapin <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/ptr.3A.3Anull.20calling.20ptr.3A.3Afrom_raw_parts.html#271870333">(Feb 14 2022 at 18:48)</a>:</h4>
<p>Or would <code>#[unstable]</code> without <code>#[rustc_const_unstable]</code> make sense for <code>from_raw_parts</code>?</p>



<a name="271870462"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/ptr%3A%3Anull%20calling%20ptr%3A%3Afrom_raw_parts/near/271870462" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Simon Sapin <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/ptr.3A.3Anull.20calling.20ptr.3A.3Afrom_raw_parts.html#271870462">(Feb 14 2022 at 18:49)</a>:</h4>
<p>(Note that I also needed <code>#[rustc_allow_const_fn_unstable(const_fn_trait_bound)]</code> to get this far)</p>



<a name="271871057"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/ptr%3A%3Anull%20calling%20ptr%3A%3Afrom_raw_parts/near/271871057" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Urgau <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/ptr.3A.3Anull.20calling.20ptr.3A.3Afrom_raw_parts.html#271871057">(Feb 14 2022 at 18:54)</a>:</h4>
<p>You can also allow <code>ptr_metadata</code>: <code>#[rustc_allow_const_fn_unstable(const_fn_trait_bound, ptr_metadata)]</code></p>



<hr><p>Last updated: Apr 12 2022 at 20:01 UTC</p>
</html>