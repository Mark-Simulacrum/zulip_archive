<html>
<head><meta charset="utf-8"><title>feedback on PR changing target ABIs · t-compiler · Zulip Chat Archive</title></head>
<h2>Stream: <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/index.html">t-compiler</a></h2>
<h3>Topic: <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/feedback.20on.20PR.20changing.20target.20ABIs.html">feedback on PR changing target ABIs</a></h3>

<hr>

<base href="https://rust-lang.zulipchat.com">

<head><link href="https://zulip-archive.rust-lang.org/style.css" rel="stylesheet"></head>

<a name="249144975"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/feedback%20on%20PR%20changing%20target%20ABIs/near/249144975" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Manish Goregaokar <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/feedback.20on.20PR.20changing.20target.20ABIs.html#249144975">(Aug 11 2021 at 17:59)</a>:</h4>
<p>So I've made this PR (<a href="https://github.com/rust-lang/rust/pull/87922">https://github.com/rust-lang/rust/pull/87922</a>) which changes a lot of targets to fix an inconsistency between Rust and GCC. I've tagged <span class="user-mention" data-user-id="123586">@nagisa</span> as a reviewer but i wanted to know if that's the right person to ask and if there's some process for changing targets this way. <span class="user-mention" data-user-id="119009">@eddyb</span> helped with the PR itself but i wanted to check if there was additional process</p>



<a name="249145267"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/feedback%20on%20PR%20changing%20target%20ABIs/near/249145267" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Manish Goregaokar <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/feedback.20on.20PR.20changing.20target.20ABIs.html#249145267">(Aug 11 2021 at 18:01)</a>:</h4>
<p>This is a major bug that breaks FFI on a platform we are actively working on, so I would like to get this landed sooner rather than later (rustup-toolchain-install-master is insufficient without additional symlinking for -Zbuild-std), and i want to make sure i do everything that needs to be done.</p>



<a name="249145296"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/feedback%20on%20PR%20changing%20target%20ABIs/near/249145296" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Manish Goregaokar <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/feedback.20on.20PR.20changing.20target.20ABIs.html#249145296">(Aug 11 2021 at 18:01)</a>:</h4>
<p>cc <span class="user-mention" data-user-id="239881">@Josh Triplett</span> and <span class="user-mention" data-user-id="138448">@cuviper</span> who tend to care about targets</p>



<a name="249148334"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/feedback%20on%20PR%20changing%20target%20ABIs/near/249148334" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Triplett <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/feedback.20on.20PR.20changing.20target.20ABIs.html#249148334">(Aug 11 2021 at 18:23)</a>:</h4>
<p>Looking...</p>



<a name="249148403"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/feedback%20on%20PR%20changing%20target%20ABIs/near/249148403" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Triplett <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/feedback.20on.20PR.20changing.20target.20ABIs.html#249148403">(Aug 11 2021 at 18:24)</a>:</h4>
<p>And yes, this is the kind of issue I'd like to help review in general.</p>



<a name="249148733"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/feedback%20on%20PR%20changing%20target%20ABIs/near/249148733" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Triplett <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/feedback.20on.20PR.20changing.20target.20ABIs.html#249148733">(Aug 11 2021 at 18:26)</a>:</h4>
<p>It looks like in some cases you're using the <code>Integer</code> type and in others you're initializing the same field with a number like 8.</p>



<a name="249149039"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/feedback%20on%20PR%20changing%20target%20ABIs/near/249149039" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Triplett <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/feedback.20on.20PR.20changing.20target.20ABIs.html#249149039">(Aug 11 2021 at 18:29)</a>:</h4>
<p>Oh, two different fields with the same name.</p>



<a name="249149072"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/feedback%20on%20PR%20changing%20target%20ABIs/near/249149072" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Triplett <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/feedback.20on.20PR.20changing.20target.20ABIs.html#249149072">(Aug 11 2021 at 18:29)</a>:</h4>
<p>Is there any reason not to use the same type for both fields, rather than having to translate?</p>



<a name="249149133"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/feedback%20on%20PR%20changing%20target%20ABIs/near/249149133" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Triplett <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/feedback.20on.20PR.20changing.20target.20ABIs.html#249149133">(Aug 11 2021 at 18:29)</a>:</h4>
<p>Also, I don't see any reason to make it a u64; a u8 would suffice.</p>



<a name="249149225"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/feedback%20on%20PR%20changing%20target%20ABIs/near/249149225" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Triplett <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/feedback.20on.20PR.20changing.20target.20ABIs.html#249149225">(Aug 11 2021 at 18:30)</a>:</h4>
<p>(Or use the enum, which I'd expect to have a small discriminant.)</p>



<a name="249167538"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/feedback%20on%20PR%20changing%20target%20ABIs/near/249167538" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Triplett <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/feedback.20on.20PR.20changing.20target.20ABIs.html#249167538">(Aug 11 2021 at 20:52)</a>:</h4>
<p>Otherwise, this looks perfectly reasonable.</p>



<a name="249183684"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/feedback%20on%20PR%20changing%20target%20ABIs/near/249183684" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Manish Goregaokar <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/feedback.20on.20PR.20changing.20target.20ABIs.html#249183684">(Aug 11 2021 at 23:41)</a>:</h4>
<p><span class="user-mention silent" data-user-id="239881">Josh Triplett</span> <a href="#narrow/stream/131828-t-compiler/topic/feedback.20on.20PR.20changing.20target.20ABIs/near/249149072">said</a>:</p>
<blockquote>
<p>Is there any reason not to use the same type for both fields, rather than having to translate?</p>
</blockquote>
<p>I did what <span class="user-mention" data-user-id="119009">@eddyb</span> suggested I do <span aria-label="smile" class="emoji emoji-1f642" role="img" title="smile">:smile:</span></p>



<a name="249183700"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/feedback%20on%20PR%20changing%20target%20ABIs/near/249183700" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Manish Goregaokar <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/feedback.20on.20PR.20changing.20target.20ABIs.html#249183700">(Aug 11 2021 at 23:41)</a>:</h4>
<p>and i kept it simple on the def side because there's parsing/etc logic</p>



<hr><p>Last updated: Apr 12 2022 at 20:01 UTC</p>
</html>