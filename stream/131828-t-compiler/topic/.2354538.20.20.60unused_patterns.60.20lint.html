<html>
<head><meta charset="utf-8"><title>#54538  `unused_patterns` lint · t-compiler · Zulip Chat Archive</title></head>
<h2>Stream: <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/index.html">t-compiler</a></h2>
<h3>Topic: <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/.2354538.20.20.60unused_patterns.60.20lint.html">#54538  `unused_patterns` lint</a></h3>

<hr>

<base href="https://rust-lang.zulipchat.com">

<head><link href="https://rust-lang.github.io/zulip_archive/style.css" rel="stylesheet"></head>

<a name="134981309"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/%2354538%20%20%60unused_patterns%60%20lint/near/134981309" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/.2354538.20.20.60unused_patterns.60.20lint.html#134981309">(Oct 01 2018 at 16:33)</a>:</h4>
<p><span class="user-mention" data-user-id="119335">@Kevin Leimkuhler</span> hey =)</p>



<a name="134981392"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/%2354538%20%20%60unused_patterns%60%20lint/near/134981392" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/.2354538.20.20.60unused_patterns.60.20lint.html#134981392">(Oct 01 2018 at 16:35)</a>:</h4>
<p>So you asked:</p>
<blockquote>
<p>Do you have any pointers on how to get a value: &amp;ast::Expr from this situation that I can pass on to check_unused_parens_core to indicate that a PatKind::Wild should not need parens?</p>
</blockquote>
<p>I think the answer is that you cannot =) patterns are not expressions, at least in Rust's HIR, and you can't readily interconvert. We'll have to make the logic in <code>check_unused_parens_core</code> either generic over both patterns and types or else make a distinct copy</p>



<a name="134981396"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/%2354538%20%20%60unused_patterns%60%20lint/near/134981396" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/.2354538.20.20.60unused_patterns.60.20lint.html#134981396">(Oct 01 2018 at 16:35)</a>:</h4>
<p>I don't really remember how general that logic is, tbh</p>



<a name="134981398"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/%2354538%20%20%60unused_patterns%60%20lint/near/134981398" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/.2354538.20.20.60unused_patterns.60.20lint.html#134981398">(Oct 01 2018 at 16:35)</a>:</h4>
<p>a lot of times we can make logic generic over things by making it just operate on a <code>NodeId</code> or <code>HirId</code></p>



<a name="134989077"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/%2354538%20%20%60unused_patterns%60%20lint/near/134989077" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> kleimkuhler <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/.2354538.20.20.60unused_patterns.60.20lint.html#134989077">(Oct 01 2018 at 18:46)</a>:</h4>
<p>Ok that makes sense. So I think it could be reasonable to make <code>check_unused_parens_core</code> generic over both patterns and types, since the fields that it uses from <code>ast::Expr</code> already exist in <code>ast::Pat</code> (<code>node</code> and <code>span</code>)</p>



<a name="134989381"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/%2354538%20%20%60unused_patterns%60%20lint/near/134989381" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> kleimkuhler <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/.2354538.20.20.60unused_patterns.60.20lint.html#134989381">(Oct 01 2018 at 18:52)</a>:</h4>
<p>Since this is my first time really digging into the Rust source code, I think I may work towards a distinct copy that works with the specific case pointed out in the issue. I was able to speak about other patterns with <span class="user-mention" data-user-id="125270">@scottmcm</span> over Discord, and think that as I make the check more robust I can look into generalizing <code>check_unused_parens_core</code>.</p>



<a name="134989602"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/%2354538%20%20%60unused_patterns%60%20lint/near/134989602" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/.2354538.20.20.60unused_patterns.60.20lint.html#134989602">(Oct 01 2018 at 18:56)</a>:</h4>
<p><span class="user-mention" data-user-id="119335">@Kevin Leimkuhler</span> sounds reasonable</p>



<a name="135053657"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/%2354538%20%20%60unused_patterns%60%20lint/near/135053657" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> kleimkuhler <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/.2354538.20.20.60unused_patterns.60.20lint.html#135053657">(Oct 02 2018 at 18:20)</a>:</h4>
<p><span class="user-mention" data-user-id="116009">@nikomatsakis</span> I have a minimal working implementation that properly warns on the example in the issue: <a href="https://github.com/rust-lang/rust/issues/51087#issuecomment-397918200" target="_blank" title="https://github.com/rust-lang/rust/issues/51087#issuecomment-397918200">https://github.com/rust-lang/rust/issues/51087#issuecomment-397918200</a>.</p>
<p>I have essentially copied <code>check_unused_parens_core</code> into <code>check_unused_parens_expr</code> and <code>check_unused_parens_pat</code>; the differ only in how they handle <code>value</code> (either <code>ast::Expr</code> or <code>ast::Pat</code>).</p>
<p>I'd like to ideally make <code>check_unused_parens_core</code> generic of the type of <code>value</code>, but <code>ast::Expr</code> and <code>ast::Pat</code> don't share an obvious parent struct to match on.</p>



<a name="135053688"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/%2354538%20%20%60unused_patterns%60%20lint/near/135053688" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> kleimkuhler <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/.2354538.20.20.60unused_patterns.60.20lint.html#135053688">(Oct 02 2018 at 18:21)</a>:</h4>
<p>Would it make sense to consider making <code>check_unused_parens_core</code> generic of a <code>value</code> type <code>T</code> where <code>T</code> implements <code>Clone</code>, <code>RustEncodable</code>, and <code>RustDecodable</code> (the traits that <code>ast</code> structs implement) and match from there?</p>



<a name="135053799"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/%2354538%20%20%60unused_patterns%60%20lint/near/135053799" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> kleimkuhler <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/.2354538.20.20.60unused_patterns.60.20lint.html#135053799">(Oct 02 2018 at 18:22)</a>:</h4>
<p>If it helps clarify, here is the commit I'm currently working off of: <a href="https://github.com/kleimkuhler/rust/commit/9229b025b993bcc6892c0afa1a0ac834005cecea" target="_blank" title="https://github.com/kleimkuhler/rust/commit/9229b025b993bcc6892c0afa1a0ac834005cecea">https://github.com/kleimkuhler/rust/commit/9229b025b993bcc6892c0afa1a0ac834005cecea</a></p>



<a name="135054330"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/%2354538%20%20%60unused_patterns%60%20lint/near/135054330" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/.2354538.20.20.60unused_patterns.60.20lint.html#135054330">(Oct 02 2018 at 18:30)</a>:</h4>
<p>I don't think <code>RustEncodable</code> and <code>RustDecodable</code> makes much sense; it might not be worth trying to collapse it</p>



<a name="135054374"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/%2354538%20%20%60unused_patterns%60%20lint/near/135054374" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/.2354538.20.20.60unused_patterns.60.20lint.html#135054374">(Oct 02 2018 at 18:31)</a>:</h4>
<p><span class="user-mention" data-user-id="119335">@kleimkuhler</span> it seems like we could extract most of the logic from that fn into a helper anyway</p>



<a name="135054394"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/%2354538%20%20%60unused_patterns%60%20lint/near/135054394" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/.2354538.20.20.60unused_patterns.60.20lint.html#135054394">(Oct 02 2018 at 18:31)</a>:</h4>
<p>we could certainly make this generic in various ways</p>



<a name="135054404"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/%2354538%20%20%60unused_patterns%60%20lint/near/135054404" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/.2354538.20.20.60unused_patterns.60.20lint.html#135054404">(Oct 02 2018 at 18:31)</a>:</h4>
<p>one would be to supply closures -- there are basically only two things we do: "check if this is parens" and "pretty print"</p>



<a name="135054410"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/%2354538%20%20%60unused_patterns%60%20lint/near/135054410" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/.2354538.20.20.60unused_patterns.60.20lint.html#135054410">(Oct 02 2018 at 18:31)</a>:</h4>
<p>or we could make a little one-off trait and implement it for <code>hir::Expr</code> and <code>hir::Pat</code></p>



<a name="135054453"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/%2354538%20%20%60unused_patterns%60%20lint/near/135054453" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/.2354538.20.20.60unused_patterns.60.20lint.html#135054453">(Oct 02 2018 at 18:32)</a>:</h4>
<p>(with those two methods)</p>



<a name="135054464"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/%2354538%20%20%60unused_patterns%60%20lint/near/135054464" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/.2354538.20.20.60unused_patterns.60.20lint.html#135054464">(Oct 02 2018 at 18:32)</a>:</h4>
<p>or we could just have two functions but share the "guts" — basically starting from the point where we pretty-print</p>



<a name="135054469"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/%2354538%20%20%60unused_patterns%60%20lint/near/135054469" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/.2354538.20.20.60unused_patterns.60.20lint.html#135054469">(Oct 02 2018 at 18:32)</a>:</h4>
<p>at which point, the function seems to just be operating over spans and strings</p>



<a name="135081153"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/%2354538%20%20%60unused_patterns%60%20lint/near/135081153" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> kleimkuhler <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/.2354538.20.20.60unused_patterns.60.20lint.html#135081153">(Oct 03 2018 at 04:50)</a>:</h4>
<p><span class="user-mention" data-user-id="116009">@nikomatsakis</span> Great, those are definitely all good starting points I can work from. I think there may need to be three things covered - the two you mentioned plus a <code>necessary</code> check (<code>ast::Pat</code> does not have an equivalent <code>parser::contains_exterior_struct_lit(&amp;inner)</code> so I just simplified it to <code>if !struct_lit_needs_parens</code>?</p>
<p>Either way for the issue this is solving I lean towards just sharing the "guts". A generic solution seems like an interesting path I can explore after it's ready to go, but seems maybe a little unnecessary right now. Do you agree or would you a generic solution put in place for this?</p>



<a name="135115481"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/%2354538%20%20%60unused_patterns%60%20lint/near/135115481" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/.2354538.20.20.60unused_patterns.60.20lint.html#135115481">(Oct 03 2018 at 16:35)</a>:</h4>
<p>I'd prefer to share the guts</p>



<a name="135115485"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/%2354538%20%20%60unused_patterns%60%20lint/near/135115485" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/.2354538.20.20.60unused_patterns.60.20lint.html#135115485">(Oct 03 2018 at 16:35)</a>:</h4>
<p>if that works out</p>



<a name="135115488"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/%2354538%20%20%60unused_patterns%60%20lint/near/135115488" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/.2354538.20.20.60unused_patterns.60.20lint.html#135115488">(Oct 03 2018 at 16:35)</a>:</h4>
<p>generics are great sometimes but other times kind of obfuscating</p>



<a name="135115494"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/%2354538%20%20%60unused_patterns%60%20lint/near/135115494" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/.2354538.20.20.60unused_patterns.60.20lint.html#135115494">(Oct 03 2018 at 16:35)</a>:</h4>
<p>to me, this feels like it will be the latter</p>



<a name="135200393"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/%2354538%20%20%60unused_patterns%60%20lint/near/135200393" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> kleimkuhler <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/.2354538.20.20.60unused_patterns.60.20lint.html#135200393">(Oct 04 2018 at 16:30)</a>:</h4>
<p><span class="user-mention" data-user-id="116009">@nikomatsakis</span> I am trying to get the match arms in <code>check_pat</code> to all have the same type and I'm having an issue in handling the <code>Paren</code> case. In the <code>Paren</code> case, it should pass along the entire <code>&amp;ast::Pat</code> (to indicate the entire pattern does not need to be surrounded by parentheses). In the other cases, it should pass along a <code>ref</code>.</p>
<p>For example, the last two currently are:</p>
<div class="codehilite"><pre><span></span>Slice(_, Some(ref pat), _) =&gt; (pat, &quot;optional position pattern&quot;, false),
Paren(_) =&gt; (p, &quot;pattern&quot;, false),
</pre></div>


<p>which produce the following types:</p>
<div class="codehilite"><pre><span></span>(&amp;syntax::ptr::P&lt;syntax::ast::Pat&gt;, &amp;str, bool)
(&amp;syntax::ast::Pat, &amp;&#39;static str, bool)
</pre></div>



<a name="135200496"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/%2354538%20%20%60unused_patterns%60%20lint/near/135200496" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> kleimkuhler <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/.2354538.20.20.60unused_patterns.60.20lint.html#135200496">(Oct 04 2018 at 16:32)</a>:</h4>
<p>I've tried wrapping the <code>p</code> in the <code>Paren</code> case with <code>&amp;P::new(p)</code> and a few variants of it (supplying the type it should be and all), but can't seem to get things to align.</p>
<p>Is there a different way to go about handling the case that does not involve the fiddling with wrapping it in a new <code>syntax::ptr::P</code>?</p>



<a name="135200528"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/%2354538%20%20%60unused_patterns%60%20lint/near/135200528" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/.2354538.20.20.60unused_patterns.60.20lint.html#135200528">(Oct 04 2018 at 16:32)</a>:</h4>
<p>if you have a <code>&amp;P&lt;Pat&gt;</code>, you can deref that to a <code>&amp;Pat</code></p>



<a name="135200530"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/%2354538%20%20%60unused_patterns%60%20lint/near/135200530" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/.2354538.20.20.60unused_patterns.60.20lint.html#135200530">(Oct 04 2018 at 16:32)</a>:</h4>
<p>is that what you need?</p>



<a name="135200537"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/%2354538%20%20%60unused_patterns%60%20lint/near/135200537" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/.2354538.20.20.60unused_patterns.60.20lint.html#135200537">(Oct 04 2018 at 16:33)</a>:</h4>
<p>maybe you can send along the code that doesn't build + the errors?</p>



<a name="135200622"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/%2354538%20%20%60unused_patterns%60%20lint/near/135200622" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> kleimkuhler <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/.2354538.20.20.60unused_patterns.60.20lint.html#135200622">(Oct 04 2018 at 16:34)</a>:</h4>
<p>The other arms all produce values of <code>&amp;P&lt;Pat&gt;</code>, it's the <code>Paren</code> case that just produces a <code>Pat</code> is the issue.</p>



<a name="135200643"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/%2354538%20%20%60unused_patterns%60%20lint/near/135200643" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> kleimkuhler <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/.2354538.20.20.60unused_patterns.60.20lint.html#135200643">(Oct 04 2018 at 16:35)</a>:</h4>
<p>Sure that may be more helpful. How do you prefer that usually - just push up what I have to a branch or a different way?</p>



<a name="135200653"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/%2354538%20%20%60unused_patterns%60%20lint/near/135200653" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/.2354538.20.20.60unused_patterns.60.20lint.html#135200653">(Oct 04 2018 at 16:35)</a>:</h4>
<p>I usually prefer a <code>[WIP]</code> PR</p>



<a name="135200658"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/%2354538%20%20%60unused_patterns%60%20lint/near/135200658" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/.2354538.20.20.60unused_patterns.60.20lint.html#135200658">(Oct 04 2018 at 16:35)</a>:</h4>
<p>but pushing to a branch and sending a link to the branch is also ok</p>



<a name="135200660"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/%2354538%20%20%60unused_patterns%60%20lint/near/135200660" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/.2354538.20.20.60unused_patterns.60.20lint.html#135200660">(Oct 04 2018 at 16:35)</a>:</h4>
<p>it's just that it's easier to comment on PRs</p>



<a name="135201718"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/%2354538%20%20%60unused_patterns%60%20lint/near/135201718" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> kleimkuhler <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/.2354538.20.20.60unused_patterns.60.20lint.html#135201718">(Oct 04 2018 at 16:53)</a>:</h4>
<p>Ok here is a comment: <a href="https://github.com/rust-lang/rust/pull/54820/files#r222748510" target="_blank" title="https://github.com/rust-lang/rust/pull/54820/files#r222748510">https://github.com/rust-lang/rust/pull/54820/files#r222748510</a></p>



<a name="135201952"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/%2354538%20%20%60unused_patterns%60%20lint/near/135201952" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> kleimkuhler <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/.2354538.20.20.60unused_patterns.60.20lint.html#135201952">(Oct 04 2018 at 16:57)</a>:</h4>
<p>And the reason I want to pass <code>p</code> and not what <code>Paren</code> matches on, is because it then strips the <code>Paren</code> and will not lint on a case like <code>(_) =&gt; {},</code></p>



<a name="135202171"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/%2354538%20%20%60unused_patterns%60%20lint/near/135202171" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/.2354538.20.20.60unused_patterns.60.20lint.html#135202171">(Oct 04 2018 at 17:00)</a>:</h4>
<p><span class="user-mention" data-user-id="119335">@kleimkuhler</span> try one of two things:</p>
<div class="codehilite"><pre><span></span><span class="w"> </span><span class="kd">let</span><span class="w"> </span><span class="p">(</span><span class="n">value</span><span class="p">,</span><span class="w"> </span><span class="n">msg</span><span class="p">,</span><span class="w"> </span><span class="n">struct_lit_needs_parens</span><span class="p">)</span>: <span class="p">(</span><span class="o">&amp;</span><span class="n">ast</span>::<span class="n">Pat</span><span class="p">,</span><span class="w"> </span><span class="n">_</span><span class="p">,</span><span class="w"> </span><span class="n">_</span><span class="p">,</span><span class="w"> </span><span class="n">_</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"></span>
</pre></div>


<p>or </p>
<div class="codehilite"><pre><span></span><span class="w"> </span><span class="n">Ident</span><span class="p">(..,</span><span class="w"> </span><span class="nb">Some</span><span class="p">(</span><span class="k">ref</span><span class="w"> </span><span class="n">pat</span><span class="p">))</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="p">(</span><span class="o">&amp;*</span><span class="n">pat</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;optional subpattern&quot;</span><span class="p">,</span><span class="w"> </span><span class="kc">false</span><span class="p">),</span><span class="w"></span>
</pre></div>



<a name="135202184"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/%2354538%20%20%60unused_patterns%60%20lint/near/135202184" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/.2354538.20.20.60unused_patterns.60.20lint.html#135202184">(Oct 04 2018 at 17:01)</a>:</h4>
<p>the former will force a coercion, the latter does the coercion explicitly</p>



<a name="135202191"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/%2354538%20%20%60unused_patterns%60%20lint/near/135202191" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/.2354538.20.20.60unused_patterns.60.20lint.html#135202191">(Oct 04 2018 at 17:01)</a>:</h4>
<p>you'll have to change all the arms to match, in the second case</p>



<a name="135202197"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/%2354538%20%20%60unused_patterns%60%20lint/near/135202197" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/.2354538.20.20.60unused_patterns.60.20lint.html#135202197">(Oct 04 2018 at 17:01)</a>:</h4>
<p><code>P</code> is a "smart pointer", much like <code>Box</code>, so it can be deref'd</p>



<a name="135202202"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/%2354538%20%20%60unused_patterns%60%20lint/near/135202202" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/.2354538.20.20.60unused_patterns.60.20lint.html#135202202">(Oct 04 2018 at 17:01)</a>:</h4>
<p>you might need <code>&amp;**pat</code> though (ugh..)</p>



<a name="135202264"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/%2354538%20%20%60unused_patterns%60%20lint/near/135202264" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> kleimkuhler <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/.2354538.20.20.60unused_patterns.60.20lint.html#135202264">(Oct 04 2018 at 17:02)</a>:</h4>
<p>Hm yea that's what I was trying to avoid (changing all the arms to match)... I'll try the coercion explicitly and hopefully can get somewhere with that.</p>



<a name="135202299"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/%2354538%20%20%60unused_patterns%60%20lint/near/135202299" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> kleimkuhler <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/.2354538.20.20.60unused_patterns.60.20lint.html#135202299">(Oct 04 2018 at 17:03)</a>:</h4>
<p>Does it make sense though in trying to make a new <code>syntax::ptr::P</code> with <code>p</code>? That way I don't need to be explicit about the coercion and I just handle the <code>Paren</code> case?</p>



<a name="135202481"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/%2354538%20%20%60unused_patterns%60%20lint/near/135202481" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> kleimkuhler <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/.2354538.20.20.60unused_patterns.60.20lint.html#135202481">(Oct 04 2018 at 17:06)</a>:</h4>
<p>And quick unrelated question... how should <code>[WIP]</code> PRs be handled once they've served the purpose of sharing progress? Should I close and reopen a new one when it's ready, or keep it open and just edit the title when it's ready?</p>



<a name="135202609"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/%2354538%20%20%60unused_patterns%60%20lint/near/135202609" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/.2354538.20.20.60unused_patterns.60.20lint.html#135202609">(Oct 04 2018 at 17:09)</a>:</h4>
<blockquote>
<p>Does it make sense though in trying to make a new <code>syntax::ptr::P</code> with <code>p</code>? That way I don't need to be explicit about the coercion and I just handle the <code>Paren</code> case?</p>
</blockquote>
<p>That does not make sense</p>



<a name="135202621"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/%2354538%20%20%60unused_patterns%60%20lint/near/135202621" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/.2354538.20.20.60unused_patterns.60.20lint.html#135202621">(Oct 04 2018 at 17:09)</a>:</h4>
<blockquote>
<p>And quick unrelated question... how should <code>[WIP]</code> PRs be handled once they've served the purpose of sharing progress? Should I close and reopen a new one when it's ready, or keep it open and just edit the title when it's ready?</p>
</blockquote>
<p>I would say just keep it open — then I can come along and make quick comments</p>



<a name="135202623"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/%2354538%20%20%60unused_patterns%60%20lint/near/135202623" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/.2354538.20.20.60unused_patterns.60.20lint.html#135202623">(Oct 04 2018 at 17:09)</a>:</h4>
<p>depends how actively you are working on it, I think</p>



<a name="135202631"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/%2354538%20%20%60unused_patterns%60%20lint/near/135202631" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/.2354538.20.20.60unused_patterns.60.20lint.html#135202631">(Oct 04 2018 at 17:09)</a>:</h4>
<p>to elaborate: <code>P</code> is an "owning" pointer, like <code>Box</code></p>



<a name="135202701"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/%2354538%20%20%60unused_patterns%60%20lint/near/135202701" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/.2354538.20.20.60unused_patterns.60.20lint.html#135202701">(Oct 04 2018 at 17:10)</a>:</h4>
<p>so you never convert things <em>into</em> a <code>P</code>, you only convert from <code>&amp;P&lt;T&gt;</code> into <code>&amp;T</code>; otherwise, you'd be deep-cloning a piece of the tree</p>



<a name="135203114"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/%2354538%20%20%60unused_patterns%60%20lint/near/135203114" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> kleimkuhler <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/.2354538.20.20.60unused_patterns.60.20lint.html#135203114">(Oct 04 2018 at 17:16)</a>:</h4>
<p>I’ll keep it open; I plan to wrap it up soon.</p>
<p>Thanks for the elaboration on that!</p>



<a name="135203760"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/%2354538%20%20%60unused_patterns%60%20lint/near/135203760" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/.2354538.20.20.60unused_patterns.60.20lint.html#135203760">(Oct 04 2018 at 17:27)</a>:</h4>
<p><span class="user-mention" data-user-id="119335">@kleimkuhler</span> send me a link to the PR</p>



<a name="135203767"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/%2354538%20%20%60unused_patterns%60%20lint/near/135203767" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/.2354538.20.20.60unused_patterns.60.20lint.html#135203767">(Oct 04 2018 at 17:27)</a>:</h4>
<p>when it's open..</p>



<a name="135294379"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/%2354538%20%20%60unused_patterns%60%20lint/near/135294379" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> kleimkuhler <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/.2354538.20.20.60unused_patterns.60.20lint.html#135294379">(Oct 06 2018 at 02:18)</a>:</h4>
<p><span class="user-mention" data-user-id="116009">@nikomatsakis</span>  It is ready for a review! <a href="https://github.com/rust-lang/rust/pull/54820" target="_blank" title="https://github.com/rust-lang/rust/pull/54820">https://github.com/rust-lang/rust/pull/54820</a>. The <code>Paren</code> check ended up being a lot simpler in the end.</p>



<a name="135409342"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/%2354538%20%20%60unused_patterns%60%20lint/near/135409342" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/.2354538.20.20.60unused_patterns.60.20lint.html#135409342">(Oct 08 2018 at 15:01)</a>:</h4>
<p><span class="user-mention" data-user-id="119335">@kleimkuhler</span> nice! I <a href="https://github.com/rust-lang/rust/pull/54820#pullrequestreview-162511830" target="_blank" title="https://github.com/rust-lang/rust/pull/54820#pullrequestreview-162511830">left a review</a> describing how we could make it more precise, if we wanted. What do you think?</p>



<a name="135412990"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/%2354538%20%20%60unused_patterns%60%20lint/near/135412990" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> kleimkuhler <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/.2354538.20.20.60unused_patterns.60.20lint.html#135412990">(Oct 08 2018 at 16:02)</a>:</h4>
<p><span class="user-mention" data-user-id="116009">@nikomatsakis</span> I like your suggestion! My reply points out that the paren usage in expressions does also seem to specifically look for <code>&amp;pat</code> and <code>box pat</code>, so while I agree it seems a little hacky, it is a sure way to warn when necessary.</p>
<p>I'll work on implementing those changes and leave a comment when it's good to go again. Thanks for the review!</p>



<a name="135432767"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/%2354538%20%20%60unused_patterns%60%20lint/near/135432767" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> kleimkuhler <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/.2354538.20.20.60unused_patterns.60.20lint.html#135432767">(Oct 08 2018 at 22:56)</a>:</h4>
<p><span class="user-mention" data-user-id="116009">@nikomatsakis</span> I have a working implementation based off your review. I'd like to add at least an additional test to make sure the "more cases" part of these additions is covered.</p>
<p>A <code>ast::PatKind::Range</code> deconstructs into an <code>a: ast::Expr</code> and <code>b: ast::Expr</code> (so a little different than your review where you mentioned it would deconstruct into <code>Pat</code>s). This means at the very least, a match arm should have the form <code>&amp;(expr ..= expr) =&gt; {}</code></p>
<p>What I'm struggling on is finding <code>expr: ast::Expr</code>s that fit into those slots (as in it compiles). I thought something like <code>&amp;((1+1)..=(1+2)) =&gt; {}</code> would be a simple case, but it does not seem to parse correctly.</p>



<a name="135432856"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/%2354538%20%20%60unused_patterns%60%20lint/near/135432856" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> kleimkuhler <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/.2354538.20.20.60unused_patterns.60.20lint.html#135432856">(Oct 08 2018 at 22:58)</a>:</h4>
<p>Looking at: <a href="https://doc.rust-lang.org/beta/reference/expressions/range-expr.html" target="_blank" title="https://doc.rust-lang.org/beta/reference/expressions/range-expr.html">https://doc.rust-lang.org/beta/reference/expressions/range-expr.html</a>, it seems like <code>Expression ..= Expression</code> should be Ok, but I may be interpreting or assuming something incorrectly about that.</p>



<a name="135442941"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/%2354538%20%20%60unused_patterns%60%20lint/near/135442941" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> kleimkuhler <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/.2354538.20.20.60unused_patterns.60.20lint.html#135442941">(Oct 09 2018 at 04:07)</a>:</h4>
<p>So it looks like right here: <a href="https://github.com/rust-lang/rust/blob/master/src/libsyntax/parse/parser.rs#L4065-L4066" target="_blank" title="https://github.com/rust-lang/rust/blob/master/src/libsyntax/parse/parser.rs#L4065-L4066">https://github.com/rust-lang/rust/blob/master/src/libsyntax/parse/parser.rs#L4065-L4066</a>, a pattern the starts similar to the one above <code>&amp;(...</code> will be parsed to be a <code>token::OpenDelim</code> and only expect a <code>(pat, ..)</code> tuple pattern. However, what I really want to happen is the surround the <code>&amp;(...)</code> to be dropped, and it be parsed as a <code>token::DotDotEq</code>.</p>



<a name="135468631"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/%2354538%20%20%60unused_patterns%60%20lint/near/135468631" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/.2354538.20.20.60unused_patterns.60.20lint.html#135468631">(Oct 09 2018 at 13:18)</a>:</h4>
<p><span class="user-mention" data-user-id="119335">@kleimkuhler</span> ok so you are correct about the ranges -- that's ok, it can return a <code>Vec&lt;&amp;Expr&gt;</code> I suppose, though even better might be to return something like a trait object — but that's a bit of "premature generalization" I suppose</p>



<a name="135468639"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/%2354538%20%20%60unused_patterns%60%20lint/near/135468639" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/.2354538.20.20.60unused_patterns.60.20lint.html#135468639">(Oct 09 2018 at 13:18)</a>:</h4>
<p>ultimately it just needs to return something "visitable"</p>



<a name="135468660"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/%2354538%20%20%60unused_patterns%60%20lint/near/135468660" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/.2354538.20.20.60unused_patterns.60.20lint.html#135468660">(Oct 09 2018 at 13:19)</a>:</h4>
<p>I don't really understand why you are looking at the parser though :)</p>



<a name="135471726"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/%2354538%20%20%60unused_patterns%60%20lint/near/135471726" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> kleimkuhler <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/.2354538.20.20.60unused_patterns.60.20lint.html#135471726">(Oct 09 2018 at 14:04)</a>:</h4>
<p><span class="user-mention" data-user-id="116009">@nikomatsakis</span> So you can see here the commit where I've added what you recommended in your review: <a href="https://github.com/rust-lang/rust/pull/54820/commits/2cb37eaea52c8ab3e97a7d536686c78ffe5e9c29#diff-d85eb66bc4756598e30d93a5d07d3d7fR401" target="_blank" title="https://github.com/rust-lang/rust/pull/54820/commits/2cb37eaea52c8ab3e97a7d536686c78ffe5e9c29#diff-d85eb66bc4756598e30d93a5d07d3d7fR401">https://github.com/rust-lang/rust/pull/54820/commits/2cb37eaea52c8ab3e97a7d536686c78ffe5e9c29#diff-d85eb66bc4756598e30d93a5d07d3d7fR401</a></p>
<p>I'm trying to add an additional test case where a match arm matches that additional block: <code>&amp;(expr ..= expr) =&gt; {}</code></p>



<a name="135471841"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/%2354538%20%20%60unused_patterns%60%20lint/near/135471841" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/.2354538.20.20.60unused_patterns.60.20lint.html#135471841">(Oct 09 2018 at 14:06)</a>:</h4>
<p><span class="user-mention" data-user-id="119335">@kleimkuhler</span> great, I'll take a look in a bit :)</p>



<a name="135471889"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/%2354538%20%20%60unused_patterns%60%20lint/near/135471889" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> kleimkuhler <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/.2354538.20.20.60unused_patterns.60.20lint.html#135471889">(Oct 09 2018 at 14:07)</a>:</h4>
<p>I was looking at the parser because I was having a hard time writing a test case that properly fits that format. I tried things like <code>&amp;(&amp;1 ..= &amp;2) =&gt; {}</code> and variations of surround the <code>expr</code>s with parentheses, as well as different <code>expr</code>s like <code>(1+1)</code>, but I was getting parsing errors... so I trying to figure out why</p>



<a name="135471900"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/%2354538%20%20%60unused_patterns%60%20lint/near/135471900" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> kleimkuhler <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/.2354538.20.20.60unused_patterns.60.20lint.html#135471900">(Oct 09 2018 at 14:07)</a>:</h4>
<p><span class="user-mention" data-user-id="116009">@nikomatsakis</span> Ah great appreciate it! <span class="emoji emoji-1f642" title="slight smile">:slight_smile:</span></p>



<a name="135482937"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/%2354538%20%20%60unused_patterns%60%20lint/near/135482937" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/.2354538.20.20.60unused_patterns.60.20lint.html#135482937">(Oct 09 2018 at 16:54)</a>:</h4>
<p><span class="user-mention" data-user-id="119335">@kleimkuhler</span> I just realized that I was confused about something</p>



<a name="135482947"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/%2354538%20%20%60unused_patterns%60%20lint/near/135482947" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/.2354538.20.20.60unused_patterns.60.20lint.html#135482947">(Oct 09 2018 at 16:54)</a>:</h4>
<p>somewhat annoyingly, the lint visitor (I believe) always walks <em>all</em> the patterns</p>



<a name="135482971"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/%2354538%20%20%60unused_patterns%60%20lint/near/135482971" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/.2354538.20.20.60unused_patterns.60.20lint.html#135482971">(Oct 09 2018 at 16:55)</a>:</h4>
<p>this means that the scheme I had in mind doesn't quite work</p>



<a name="135482975"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/%2354538%20%20%60unused_patterns%60%20lint/near/135482975" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/.2354538.20.20.60unused_patterns.60.20lint.html#135482975">(Oct 09 2018 at 16:55)</a>:</h4>
<p>since it relied on "skipping over" parens that were necessary during the walk</p>



<a name="135485878"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/%2354538%20%20%60unused_patterns%60%20lint/near/135485878" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> kleimkuhler <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/.2354538.20.20.60unused_patterns.60.20lint.html#135485878">(Oct 09 2018 at 17:44)</a>:</h4>
<p><span class="user-mention" data-user-id="116009">@nikomatsakis</span>  I'm not sure where you'd like to carry out conversation on this since it's split half/half between here and GH. I'll plan on getting a better idea of the mutable state here and then reply on GH if thats Ok</p>



<a name="135486070"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/%2354538%20%20%60unused_patterns%60%20lint/near/135486070" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> kleimkuhler <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/.2354538.20.20.60unused_patterns.60.20lint.html#135486070">(Oct 09 2018 at 17:47)</a>:</h4>
<blockquote>
<p>One option would be to keep a little mutable state in the UnusedParens lint itself; we could for example add the ids for 'necessary' parens into a set stored in the lint. Then when we reach the paren node, we can check if it is present in that set</p>
</blockquote>
<p>I'm not sure I completely follow what the <em>ids</em> part of this would hold. Is it the patterns that should be surrounded by parens in the match arm? Since the lint visitor visits all the subpatterns, is it checking something in <em>ids</em> each time to see if that subpattern needs to be surrounded by parens?</p>



<a name="135486390"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/%2354538%20%20%60unused_patterns%60%20lint/near/135486390" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/.2354538.20.20.60unused_patterns.60.20lint.html#135486390">(Oct 09 2018 at 17:53)</a>:</h4>
<p>each pattern has a <code>NodeId</code></p>



<a name="135486395"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/%2354538%20%20%60unused_patterns%60%20lint/near/135486395" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/.2354538.20.20.60unused_patterns.60.20lint.html#135486395">(Oct 09 2018 at 17:53)</a>:</h4>
<p>(I think)</p>



<a name="135486402"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/%2354538%20%20%60unused_patterns%60%20lint/near/135486402" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/.2354538.20.20.60unused_patterns.60.20lint.html#135486402">(Oct 09 2018 at 17:53)</a>:</h4>
<p>so the lint would store a set of these ids</p>



<a name="135486410"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/%2354538%20%20%60unused_patterns%60%20lint/near/135486410" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/.2354538.20.20.60unused_patterns.60.20lint.html#135486410">(Oct 09 2018 at 17:53)</a>:</h4>
<p>we would add "necessary parens" into the set</p>



<a name="135486413"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/%2354538%20%20%60unused_patterns%60%20lint/near/135486413" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/.2354538.20.20.60unused_patterns.60.20lint.html#135486413">(Oct 09 2018 at 17:53)</a>:</h4>
<p>e.g., the paren in <code>&amp;(a ..= b)</code></p>



<a name="135486421"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/%2354538%20%20%60unused_patterns%60%20lint/near/135486421" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/.2354538.20.20.60unused_patterns.60.20lint.html#135486421">(Oct 09 2018 at 17:53)</a>:</h4>
<p>then, when we reach a paren, we could check if it is in the set (and, probably, remove it if it is)</p>



<a name="135486423"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/%2354538%20%20%60unused_patterns%60%20lint/near/135486423" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/.2354538.20.20.60unused_patterns.60.20lint.html#135486423">(Oct 09 2018 at 17:53)</a>:</h4>
<p>if it was <em>not</em> in the set, we can lint</p>



<a name="135486493"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/%2354538%20%20%60unused_patterns%60%20lint/near/135486493" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/.2354538.20.20.60unused_patterns.60.20lint.html#135486493">(Oct 09 2018 at 17:54)</a>:</h4>
<p>so basically when visiting the <code>&amp;</code>, we would see that it has a child which is a paren, and this paren has a "low priority" pat as its child</p>



<a name="135486494"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/%2354538%20%20%60unused_patterns%60%20lint/near/135486494" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/.2354538.20.20.60unused_patterns.60.20lint.html#135486494">(Oct 09 2018 at 17:54)</a>:</h4>
<p>this makes the pat necessary</p>



<a name="135486496"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/%2354538%20%20%60unused_patterns%60%20lint/near/135486496" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/.2354538.20.20.60unused_patterns.60.20lint.html#135486496">(Oct 09 2018 at 17:54)</a>:</h4>
<p>so we could add its id to the set</p>



<a name="135486507"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/%2354538%20%20%60unused_patterns%60%20lint/near/135486507" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/.2354538.20.20.60unused_patterns.60.20lint.html#135486507">(Oct 09 2018 at 17:54)</a>:</h4>
<p>then when we visit the paren node (which we will do next), we can remove it from the set</p>



<a name="135488334"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/%2354538%20%20%60unused_patterns%60%20lint/near/135488334" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> kleimkuhler <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/.2354538.20.20.60unused_patterns.60.20lint.html#135488334">(Oct 09 2018 at 18:24)</a>:</h4>
<p>Replying to acknowledge I've read the above, but I think I may need to familiarize myself more with the pattern visitor before understanding the distinction in adding "necessary parens" into the set, and then reaching a paren to check if it's there.</p>
<p>Am I correct in understanding that the visitor adds all the <code>NodeId</code>s for patterns <em>and</em> expressions (e.g. <code>PatKind::Range(Expr, Expr, _)</code>) and then <code>check_pat</code> is where it actually determines if a paren should be present?</p>



<a name="135488467"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/%2354538%20%20%60unused_patterns%60%20lint/near/135488467" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> kleimkuhler <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/.2354538.20.20.60unused_patterns.60.20lint.html#135488467">(Oct 09 2018 at 18:26)</a>:</h4>
<p>In order to understand the responsibilities of the lint visitor and <code>check_pat</code> for implementing the above, is starting from here a good place to work from? <a href="https://github.com/rust-lang/rust/blob/master/src/librustc/lint/context.rs#L972-L973" target="_blank" title="https://github.com/rust-lang/rust/blob/master/src/librustc/lint/context.rs#L972-L973">https://github.com/rust-lang/rust/blob/master/src/librustc/lint/context.rs#L972-L973</a></p>



<a name="135488781"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/%2354538%20%20%60unused_patterns%60%20lint/near/135488781" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/.2354538.20.20.60unused_patterns.60.20lint.html#135488781">(Oct 09 2018 at 18:31)</a>:</h4>
<p>that does not sound correct</p>



<a name="135488795"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/%2354538%20%20%60unused_patterns%60%20lint/near/135488795" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/.2354538.20.20.60unused_patterns.60.20lint.html#135488795">(Oct 09 2018 at 18:31)</a>:</h4>
<p>when you write a lint and implement the <code>EarlyLintPass</code> trait</p>



<a name="135488803"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/%2354538%20%20%60unused_patterns%60%20lint/near/135488803" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/.2354538.20.20.60unused_patterns.60.20lint.html#135488803">(Oct 09 2018 at 18:31)</a>:</h4>
<p>there is some <em>outside</em> code that is walking over the AST</p>



<a name="135488809"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/%2354538%20%20%60unused_patterns%60%20lint/near/135488809" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/.2354538.20.20.60unused_patterns.60.20lint.html#135488809">(Oct 09 2018 at 18:31)</a>:</h4>
<p>and invoking <code>check_pattern</code> and <code>check_expr</code> on what it finds</p>



<a name="135488819"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/%2354538%20%20%60unused_patterns%60%20lint/near/135488819" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/.2354538.20.20.60unused_patterns.60.20lint.html#135488819">(Oct 09 2018 at 18:31)</a>:</h4>
<p>so that is just going to happen regardless</p>



<a name="135488823"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/%2354538%20%20%60unused_patterns%60%20lint/near/135488823" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/.2354538.20.20.60unused_patterns.60.20lint.html#135488823">(Oct 09 2018 at 18:31)</a>:</h4>
<p>our job is to implement those callbacks and figure out what to do</p>



<a name="135488870"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/%2354538%20%20%60unused_patterns%60%20lint/near/135488870" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/.2354538.20.20.60unused_patterns.60.20lint.html#135488870">(Oct 09 2018 at 18:32)</a>:</h4>
<p>so if you have e.g. a pattern like <code>&amp;(a ..= b)</code></p>



<a name="135488877"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/%2354538%20%20%60unused_patterns%60%20lint/near/135488877" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/.2354538.20.20.60unused_patterns.60.20lint.html#135488877">(Oct 09 2018 at 18:32)</a>:</h4>
<p>you will get a callback at the <code>&amp;</code> pattern</p>



<a name="135488886"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/%2354538%20%20%60unused_patterns%60%20lint/near/135488886" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/.2354538.20.20.60unused_patterns.60.20lint.html#135488886">(Oct 09 2018 at 18:32)</a>:</h4>
<p>then it will desend and you will get a callback on the <code>(..)</code> pattern</p>



<a name="135488891"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/%2354538%20%20%60unused_patterns%60%20lint/near/135488891" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/.2354538.20.20.60unused_patterns.60.20lint.html#135488891">(Oct 09 2018 at 18:32)</a>:</h4>
<p>then you will get a callback on the <code>a ..= b</code> pattern</p>



<a name="135488897"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/%2354538%20%20%60unused_patterns%60%20lint/near/135488897" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/.2354538.20.20.60unused_patterns.60.20lint.html#135488897">(Oct 09 2018 at 18:32)</a>:</h4>
<p>and then you will get callbacks for the <code>a</code> and <code>b</code> expressions</p>



<a name="135488923"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/%2354538%20%20%60unused_patterns%60%20lint/near/135488923" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/.2354538.20.20.60unused_patterns.60.20lint.html#135488923">(Oct 09 2018 at 18:33)</a>:</h4>
<p>I am saying that when we get the callback for the outermost <code>&amp;</code> pattern, we can add the id for the <code>(..)</code> pattern into a set; the reason we would do this is that — once we reach the <code>(..)</code> pattern – we have lost the context of <em>where</em> it appears</p>



<a name="135488931"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/%2354538%20%20%60unused_patterns%60%20lint/near/135488931" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/.2354538.20.20.60unused_patterns.60.20lint.html#135488931">(Oct 09 2018 at 18:33)</a>:</h4>
<p>you can only look "down" the tree, in other words</p>



<a name="135495153"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/%2354538%20%20%60unused_patterns%60%20lint/near/135495153" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/.2354538.20.20.60unused_patterns.60.20lint.html#135495153">(Oct 09 2018 at 20:10)</a>:</h4>
<p>did that help <span class="user-mention" data-user-id="119335">@kleimkuhler</span> at all?</p>



<a name="135496865"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/%2354538%20%20%60unused_patterns%60%20lint/near/135496865" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> kleimkuhler <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/.2354538.20.20.60unused_patterns.60.20lint.html#135496865">(Oct 09 2018 at 20:32)</a>:</h4>
<p><span class="user-mention" data-user-id="116009">@nikomatsakis</span> Trying not to follow-up with another question, but my best point of reference right now is when <code>check_pat</code>/<code>check_expr</code> gets called for <code>UnusedParens</code>. I'm trying to understand where the "add id for the <code>(..)</code> pattern into a set" differs from "once we reach the <code>(..)</code> pattern" because I currently think that would occur at the same time.</p>
<p>I understand about how the pattern is deconstructed down the tree, but I also don't really know why we can assume that a "lower priority" paren is always necessary. That may be solved with the <code>is_high_precedence_pat</code>/<code>is_low_precedence_pat</code> methods?</p>



<a name="135496906"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/%2354538%20%20%60unused_patterns%60%20lint/near/135496906" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> kleimkuhler <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/.2354538.20.20.60unused_patterns.60.20lint.html#135496906">(Oct 09 2018 at 20:32)</a>:</h4>
<p>So I just need to familiarize myself more with the code before I have a better reply I think.</p>



<a name="135496929"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/%2354538%20%20%60unused_patterns%60%20lint/near/135496929" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/.2354538.20.20.60unused_patterns.60.20lint.html#135496929">(Oct 09 2018 at 20:33)</a>:</h4>
<p>a paren is necessary if it is (a) a child of a high-precedence pattern and (b) contains a low-precedence pattern</p>



<a name="135496939"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/%2354538%20%20%60unused_patterns%60%20lint/near/135496939" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/.2354538.20.20.60unused_patterns.60.20lint.html#135496939">(Oct 09 2018 at 20:33)</a>:</h4>
<p>that is, parentheses are basically the way you get low-precedence things <em>into</em> high-precedence ones</p>



<a name="135497436"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/%2354538%20%20%60unused_patterns%60%20lint/near/135497436" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> kleimkuhler <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/.2354538.20.20.60unused_patterns.60.20lint.html#135497436">(Oct 09 2018 at 20:41)</a>:</h4>
<p>Ok so when (a) and (b) are satisfied the paren <code>NodeId</code> is considered necessary and should be added to the mutable set</p>



<a name="135497493"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/%2354538%20%20%60unused_patterns%60%20lint/near/135497493" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> kleimkuhler <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/.2354538.20.20.60unused_patterns.60.20lint.html#135497493">(Oct 09 2018 at 20:42)</a>:</h4>
<p>And when we arrive at a paren outside the context of (a) and (b), we need to check if that paren <code>NodeId</code> is considered required</p>



<a name="135497532"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/%2354538%20%20%60unused_patterns%60%20lint/near/135497532" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> kleimkuhler <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/.2354538.20.20.60unused_patterns.60.20lint.html#135497532">(Oct 09 2018 at 20:43)</a>:</h4>
<p>(and do the removal or lint if it is in the set or not)</p>



<a name="135497631"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/%2354538%20%20%60unused_patterns%60%20lint/near/135497631" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/.2354538.20.20.60unused_patterns.60.20lint.html#135497631">(Oct 09 2018 at 20:45)</a>:</h4>
<p>right</p>



<a name="135497650"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/%2354538%20%20%60unused_patterns%60%20lint/near/135497650" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/.2354538.20.20.60unused_patterns.60.20lint.html#135497650">(Oct 09 2018 at 20:45)</a>:</h4>
<blockquote>
<p>I'm trying to understand where the "add id for the (..) pattern into a set" differs from "once we reach the (..) pattern" because I currently think that would occur at the same time.</p>
</blockquote>



<a name="135497659"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/%2354538%20%20%60unused_patterns%60%20lint/near/135497659" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/.2354538.20.20.60unused_patterns.60.20lint.html#135497659">(Oct 09 2018 at 20:45)</a>:</h4>
<p>the first one ("add to set") would occur while we are visiting the high-precedence pattern</p>



<a name="135497716"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/%2354538%20%20%60unused_patterns%60%20lint/near/135497716" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/.2354538.20.20.60unused_patterns.60.20lint.html#135497716">(Oct 09 2018 at 20:46)</a>:</h4>
<p>the problem is that when we are visiting the paren (the child of the high-precedence pattern) we don't know anymore what its parent was</p>



<a name="135497730"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/%2354538%20%20%60unused_patterns%60%20lint/near/135497730" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/.2354538.20.20.60unused_patterns.60.20lint.html#135497730">(Oct 09 2018 at 20:46)</a>:</h4>
<p>also, the helpers we introducd are fine, but since we don't need to control the walk anymore, the "is low-precedence" helper can just return a boolean</p>



<a name="135498236"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/%2354538%20%20%60unused_patterns%60%20lint/near/135498236" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> kleimkuhler <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/.2354538.20.20.60unused_patterns.60.20lint.html#135498236">(Oct 09 2018 at 20:54)</a>:</h4>
<p>Great I'll work on those adjustments. Thank you for the clarifications in this.</p>
<p>I can work towards this so that there is a working implementation, but is the other option you mentioned in the PR after discussion with @manishearth something you'd like to still consider?</p>



<a name="135498261"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/%2354538%20%20%60unused_patterns%60%20lint/near/135498261" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> kleimkuhler <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/.2354538.20.20.60unused_patterns.60.20lint.html#135498261">(Oct 09 2018 at 20:54)</a>:</h4>
<p>I see the appeal if that allows a solution to to be implemented without adding a mutable set to <code>struct UnusedParens</code></p>



<a name="135498439"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/%2354538%20%20%60unused_patterns%60%20lint/near/135498439" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> kleimkuhler <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/.2354538.20.20.60unused_patterns.60.20lint.html#135498439">(Oct 09 2018 at 20:58)</a>:</h4>
<p>Also... to bring up an old point I was trying to explain earlier, I'm having a hard time making a test case that actually compiles. Essentially it would be a pattern of the form <code>&amp;(expr ..= expr) =&gt; {}</code> in a match.</p>
<p><code>expr</code> should be something like <code>&amp;1</code> or <code>(1+1)</code></p>



<a name="135498460"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/%2354538%20%20%60unused_patterns%60%20lint/near/135498460" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> kleimkuhler <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/.2354538.20.20.60unused_patterns.60.20lint.html#135498460">(Oct 09 2018 at 20:58)</a>:</h4>
<p>I'll make a playground link one moment</p>



<a name="135498585"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/%2354538%20%20%60unused_patterns%60%20lint/near/135498585" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/.2354538.20.20.60unused_patterns.60.20lint.html#135498585">(Oct 09 2018 at 21:00)</a>:</h4>
<blockquote>
<p>I see the appeal if that allows a solution to to be implemented without adding a mutable set to <code>struct UnusedParens</code></p>
</blockquote>
<p>@manishearth felt that the mutable set was superior</p>



<a name="135498595"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/%2354538%20%20%60unused_patterns%60%20lint/near/135498595" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/.2354538.20.20.60unused_patterns.60.20lint.html#135498595">(Oct 09 2018 at 21:00)</a>:</h4>
<p>it's more performant, for one thing, since it allows us to have all active lints visit each node as we walk</p>



<a name="135498600"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/%2354538%20%20%60unused_patterns%60%20lint/near/135498600" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/.2354538.20.20.60unused_patterns.60.20lint.html#135498600">(Oct 09 2018 at 21:00)</a>:</h4>
<p>versus walking many times, once per lint</p>



<a name="135498603"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/%2354538%20%20%60unused_patterns%60%20lint/near/135498603" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/.2354538.20.20.60unused_patterns.60.20lint.html#135498603">(Oct 09 2018 at 21:00)</a>:</h4>
<p>I'm not sure how much that matters, really</p>



<a name="135498631"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/%2354538%20%20%60unused_patterns%60%20lint/near/135498631" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/.2354538.20.20.60unused_patterns.60.20lint.html#135498631">(Oct 09 2018 at 21:01)</a>:</h4>
<p>one question I guess is "what does the expr code do here"</p>



<a name="135498635"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/%2354538%20%20%60unused_patterns%60%20lint/near/135498635" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/.2354538.20.20.60unused_patterns.60.20lint.html#135498635">(Oct 09 2018 at 21:01)</a>:</h4>
<p>my guess is that it is simply not as precise as it could be</p>



<a name="135498643"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/%2354538%20%20%60unused_patterns%60%20lint/near/135498643" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/.2354538.20.20.60unused_patterns.60.20lint.html#135498643">(Oct 09 2018 at 21:01)</a>:</h4>
<p>b/c I don't see how you could get the right answers</p>



<a name="135498646"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/%2354538%20%20%60unused_patterns%60%20lint/near/135498646" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/.2354538.20.20.60unused_patterns.60.20lint.html#135498646">(Oct 09 2018 at 21:01)</a>:</h4>
<p>without doing a similar scheme</p>



<a name="135498662"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/%2354538%20%20%60unused_patterns%60%20lint/near/135498662" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/.2354538.20.20.60unused_patterns.60.20lint.html#135498662">(Oct 09 2018 at 21:01)</a>:</h4>
<p>hypothesis confirmed:</p>
<div class="codehilite"><pre><span></span><span class="k">fn</span> <span class="nf">main</span><span class="p">()</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="n">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="mi">1</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="mi">2</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">3</span><span class="p">;</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>
</pre></div>


<p>gets no warnings</p>



<a name="135498667"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/%2354538%20%20%60unused_patterns%60%20lint/near/135498667" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/.2354538.20.20.60unused_patterns.60.20lint.html#135498667">(Oct 09 2018 at 21:02)</a>:</h4>
<p>I am not convinced this is bad</p>



<a name="135498711"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/%2354538%20%20%60unused_patterns%60%20lint/near/135498711" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/.2354538.20.20.60unused_patterns.60.20lint.html#135498711">(Oct 09 2018 at 21:02)</a>:</h4>
<p>that is, another option would be for us to just give less lints :)</p>



<a name="135498728"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/%2354538%20%20%60unused_patterns%60%20lint/near/135498728" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/.2354538.20.20.60unused_patterns.60.20lint.html#135498728">(Oct 09 2018 at 21:02)</a>:</h4>
<p>I guess I don't remember what the real motivation was here</p>



<a name="135498737"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/%2354538%20%20%60unused_patterns%60%20lint/near/135498737" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/.2354538.20.20.60unused_patterns.60.20lint.html#135498737">(Oct 09 2018 at 21:02)</a>:</h4>
<p>:)</p>



<a name="135498754"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/%2354538%20%20%60unused_patterns%60%20lint/near/135498754" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/.2354538.20.20.60unused_patterns.60.20lint.html#135498754">(Oct 09 2018 at 21:03)</a>:</h4>
<p>that is, I don't know whether it is the "mission statement" of unused parens to be as precise as possible, or just capture certain silly patterns</p>



<a name="135498779"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/%2354538%20%20%60unused_patterns%60%20lint/near/135498779" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/.2354538.20.20.60unused_patterns.60.20lint.html#135498779">(Oct 09 2018 at 21:03)</a>:</h4>
<blockquote>
<p>I am not convinced this is bad</p>
</blockquote>
<p>in particular, I know that many people add extra parens to things like <code>(A &amp;&amp; B) || C</code> because they don't care to memorize the precedence</p>



<a name="135498784"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/%2354538%20%20%60unused_patterns%60%20lint/near/135498784" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/.2354538.20.20.60unused_patterns.60.20lint.html#135498784">(Oct 09 2018 at 21:03)</a>:</h4>
<p>and it's hard to argue with that...</p>



<a name="135499011"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/%2354538%20%20%60unused_patterns%60%20lint/near/135499011" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> kleimkuhler <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/.2354538.20.20.60unused_patterns.60.20lint.html#135499011">(Oct 09 2018 at 21:06)</a>:</h4>
<p>Yes I agree the additional paren linting would be issuing warnings on patterns that are already complicated looking based off the predicates that have to be satisfied for <code>paren</code> to be necessary</p>



<a name="135499034"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/%2354538%20%20%60unused_patterns%60%20lint/near/135499034" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> kleimkuhler <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/.2354538.20.20.60unused_patterns.60.20lint.html#135499034">(Oct 09 2018 at 21:07)</a>:</h4>
<p>(The parsing stuff I was talking about earlier is demonstrated here: <a href="https://play.rust-lang.org/?gist=4e7a62b619c2f8bdd8c4ddac6898561f&amp;version=stable&amp;mode=debug&amp;edition=2015" target="_blank" title="https://play.rust-lang.org/?gist=4e7a62b619c2f8bdd8c4ddac6898561f&amp;version=stable&amp;mode=debug&amp;edition=2015">https://play.rust-lang.org/?gist=4e7a62b619c2f8bdd8c4ddac6898561f&amp;version=stable&amp;mode=debug&amp;edition=2015</a>)</p>



<a name="135499142"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/%2354538%20%20%60unused_patterns%60%20lint/near/135499142" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> kleimkuhler <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/.2354538.20.20.60unused_patterns.60.20lint.html#135499142">(Oct 09 2018 at 21:08)</a>:</h4>
<p>I'm happy to take this as far as linting should be. I picked this up as my first issue and have learned a lot from it already</p>



<a name="135499148"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/%2354538%20%20%60unused_patterns%60%20lint/near/135499148" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/.2354538.20.20.60unused_patterns.60.20lint.html#135499148">(Oct 09 2018 at 21:09)</a>:</h4>
<p>:)</p>



<a name="135499159"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/%2354538%20%20%60unused_patterns%60%20lint/near/135499159" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/.2354538.20.20.60unused_patterns.60.20lint.html#135499159">(Oct 09 2018 at 21:09)</a>:</h4>
<p>maybe we should leave some comments on the issue</p>



<a name="135499177"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/%2354538%20%20%60unused_patterns%60%20lint/near/135499177" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/.2354538.20.20.60unused_patterns.60.20lint.html#135499177">(Oct 09 2018 at 21:09)</a>:</h4>
<p>I think that to be most analogous to the existing lint</p>



<a name="135499185"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/%2354538%20%20%60unused_patterns%60%20lint/near/135499185" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> kleimkuhler <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/.2354538.20.20.60unused_patterns.60.20lint.html#135499185">(Oct 09 2018 at 21:09)</a>:</h4>
<p>If you want to see how aggressive the paren lints seem with the above implemented, I can do that. I also think the original implementation is just helpful enough as well.</p>



<a name="135499187"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/%2354538%20%20%60unused_patterns%60%20lint/near/135499187" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/.2354538.20.20.60unused_patterns.60.20lint.html#135499187">(Oct 09 2018 at 21:09)</a>:</h4>
<p>we might <em>only</em> warn in the case where the <em>outermost</em> pattern has parens</p>



<a name="135499193"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/%2354538%20%20%60unused_patterns%60%20lint/near/135499193" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/.2354538.20.20.60unused_patterns.60.20lint.html#135499193">(Oct 09 2018 at 21:09)</a>:</h4>
<p>that I think is how expressions work</p>



<a name="135499200"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/%2354538%20%20%60unused_patterns%60%20lint/near/135499200" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/.2354538.20.20.60unused_patterns.60.20lint.html#135499200">(Oct 09 2018 at 21:09)</a>:</h4>
<p>e.g. <code>if (expr) { .. }</code> warns</p>



<a name="135499213"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/%2354538%20%20%60unused_patterns%60%20lint/near/135499213" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/.2354538.20.20.60unused_patterns.60.20lint.html#135499213">(Oct 09 2018 at 21:09)</a>:</h4>
<p>but <code>if (1 * 2) + 3 { .. }</code> does not, even though the parens are equally unnecessary</p>



<a name="135499262"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/%2354538%20%20%60unused_patterns%60%20lint/near/135499262" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/.2354538.20.20.60unused_patterns.60.20lint.html#135499262">(Oct 09 2018 at 21:10)</a>:</h4>
<p>honestly I think this was more about nudging people away from C/Java style</p>



<a name="135499286"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/%2354538%20%20%60unused_patterns%60%20lint/near/135499286" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> kleimkuhler <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/.2354538.20.20.60unused_patterns.60.20lint.html#135499286">(Oct 09 2018 at 21:10)</a>:</h4>
<p>It incorrectly warns though as well in expressions</p>



<a name="135499303"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/%2354538%20%20%60unused_patterns%60%20lint/near/135499303" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> kleimkuhler <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/.2354538.20.20.60unused_patterns.60.20lint.html#135499303">(Oct 09 2018 at 21:10)</a>:</h4>
<p>I believe there is an open issue on that</p>



<a name="135499341"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/%2354538%20%20%60unused_patterns%60%20lint/near/135499341" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/.2354538.20.20.60unused_patterns.60.20lint.html#135499341">(Oct 09 2018 at 21:11)</a>:</h4>
<p>define incorrect?</p>



<a name="135499349"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/%2354538%20%20%60unused_patterns%60%20lint/near/135499349" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/.2354538.20.20.60unused_patterns.60.20lint.html#135499349">(Oct 09 2018 at 21:11)</a>:</h4>
<p>there is a pending PR I saw about changing how expressions work in at least some cases</p>



<a name="135499352"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/%2354538%20%20%60unused_patterns%60%20lint/near/135499352" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/.2354538.20.20.60unused_patterns.60.20lint.html#135499352">(Oct 09 2018 at 21:11)</a>:</h4>
<p>maybe related</p>



<a name="135499359"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/%2354538%20%20%60unused_patterns%60%20lint/near/135499359" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> kleimkuhler <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/.2354538.20.20.60unused_patterns.60.20lint.html#135499359">(Oct 09 2018 at 21:11)</a>:</h4>
<p>Looks like it's currently being worked on: <a href="https://github.com/rust-lang/rust/issues/54704" target="_blank" title="https://github.com/rust-lang/rust/issues/54704">https://github.com/rust-lang/rust/issues/54704</a></p>



<a name="135499443"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/%2354538%20%20%60unused_patterns%60%20lint/near/135499443" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/.2354538.20.20.60unused_patterns.60.20lint.html#135499443">(Oct 09 2018 at 21:12)</a>:</h4>
<p>ah yes</p>



<a name="135499454"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/%2354538%20%20%60unused_patterns%60%20lint/near/135499454" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/.2354538.20.20.60unused_patterns.60.20lint.html#135499454">(Oct 09 2018 at 21:12)</a>:</h4>
<p>(there is a pending attempt to fix this that I was supposed to review)</p>



<a name="135499608"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/%2354538%20%20%60unused_patterns%60%20lint/near/135499608" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> kleimkuhler <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/.2354538.20.20.60unused_patterns.60.20lint.html#135499608">(Oct 09 2018 at 21:14)</a>:</h4>
<p>If you look at the test cases I originally added, I do think the cases that are covered are generally what I would expect from a lint. It covers outer parens, but inner parens as well in a not very obtrusive way (mostly just by avoiding the <code>Range</code> cases)</p>



<a name="135499746"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/%2354538%20%20%60unused_patterns%60%20lint/near/135499746" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/.2354538.20.20.60unused_patterns.60.20lint.html#135499746">(Oct 09 2018 at 21:17)</a>:</h4>
<p>yeah, I guess that's reasonable</p>



<a name="135499752"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/%2354538%20%20%60unused_patterns%60%20lint/near/135499752" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/.2354538.20.20.60unused_patterns.60.20lint.html#135499752">(Oct 09 2018 at 21:17)</a>:</h4>
<p>maybe we should just go back to that :)</p>



<a name="135499754"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/%2354538%20%20%60unused_patterns%60%20lint/near/135499754" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/.2354538.20.20.60unused_patterns.60.20lint.html#135499754">(Oct 09 2018 at 21:17)</a>:</h4>
<p>and consider this little diversion a "learning exercise"</p>



<a name="135499757"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/%2354538%20%20%60unused_patterns%60%20lint/near/135499757" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> kleimkuhler <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/.2354538.20.20.60unused_patterns.60.20lint.html#135499757">(Oct 09 2018 at 21:17)</a>:</h4>
<p>I can add some of this conversation back to GH, but I also don't know where we stand exactly. I can add the mutable state and see what it looks like? I can keep it how it is. Or I can make it even less and just warn on the outer parens (which still may require then knowing <em>where</em> we are at in the pattern)</p>



<a name="135499851"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/%2354538%20%20%60unused_patterns%60%20lint/near/135499851" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/.2354538.20.20.60unused_patterns.60.20lint.html#135499851">(Oct 09 2018 at 21:18)</a>:</h4>
<p>I think I would add a note to the GH issue like:</p>
<p>We decided not to try and get more precise (maybe give an example where we don't warn but parens are not needed) since it would complicate the lint and expressions are also not this precise.</p>



<a name="135499858"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/%2354538%20%20%60unused_patterns%60%20lint/near/135499858" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/.2354538.20.20.60unused_patterns.60.20lint.html#135499858">(Oct 09 2018 at 21:18)</a>:</h4>
<p>I think the old behavior was just not to warn on parens that wrap a range?</p>



<a name="135499867"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/%2354538%20%20%60unused_patterns%60%20lint/near/135499867" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/.2354538.20.20.60unused_patterns.60.20lint.html#135499867">(Oct 09 2018 at 21:19)</a>:</h4>
<p>(unless they are at the top-level, perhaps?)</p>



<a name="135499881"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/%2354538%20%20%60unused_patterns%60%20lint/near/135499881" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/.2354538.20.20.60unused_patterns.60.20lint.html#135499881">(Oct 09 2018 at 21:19)</a>:</h4>
<p>in that case, you could give an example like <code>((a ..= b), (a ..= b))</code> as a pattern that "could warn" but doesn't</p>



<a name="135499884"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/%2354538%20%20%60unused_patterns%60%20lint/near/135499884" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/.2354538.20.20.60unused_patterns.60.20lint.html#135499884">(Oct 09 2018 at 21:19)</a>:</h4>
<p>seems pretty obscure</p>



<a name="135500053"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/%2354538%20%20%60unused_patterns%60%20lint/near/135500053" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> kleimkuhler <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/.2354538.20.20.60unused_patterns.60.20lint.html#135500053">(Oct 09 2018 at 21:22)</a>:</h4>
<p>Yes correct. How it was before adding the high/low precedence stuff it would not warn on the pattern above.</p>



<a name="135500072"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/%2354538%20%20%60unused_patterns%60%20lint/near/135500072" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> kleimkuhler <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/.2354538.20.20.60unused_patterns.60.20lint.html#135500072">(Oct 09 2018 at 21:23)</a>:</h4>
<p>I think this set of my test cases is a pretty reasonable expectation of lints</p>
<div class="codehilite"><pre><span></span>match &amp;1 {
        (e @ &amp;(1...2)) =&gt; {} //~ WARNING: unnecessary parentheses around outer pattern
        &amp;(_) =&gt; {}           //~ WARNING: unnecessary parentheses around pattern
        e @ &amp;(1...2) =&gt; {}   // Ambiguous range pattern should not warn
        &amp;(1..=2) =&gt; {}       // Ambiguous range pattern should not warn
    }
</pre></div>



<a name="135500375"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/%2354538%20%20%60unused_patterns%60%20lint/near/135500375" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/.2354538.20.20.60unused_patterns.60.20lint.html#135500375">(Oct 09 2018 at 21:27)</a>:</h4>
<p>ok, let's go back to the old way :)</p>



<a name="135500418"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/%2354538%20%20%60unused_patterns%60%20lint/near/135500418" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/.2354538.20.20.60unused_patterns.60.20lint.html#135500418">(Oct 09 2018 at 21:28)</a>:</h4>
<p>and just add some notes on the uncovered cases</p>



<a name="135500582"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/%2354538%20%20%60unused_patterns%60%20lint/near/135500582" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> kleimkuhler <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/.2354538.20.20.60unused_patterns.60.20lint.html#135500582">(Oct 09 2018 at 21:30)</a>:</h4>
<p>Ok sounds good. I'll remove the most recent commit and add some comments for uncovered cases in the <code>check_pat</code> method. I won't be able to make those changes until I'm home tonight. I'll make sure it's good to go for a final review by end of day though!</p>



<a name="135500718"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/%2354538%20%20%60unused_patterns%60%20lint/near/135500718" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/.2354538.20.20.60unused_patterns.60.20lint.html#135500718">(Oct 09 2018 at 21:33)</a>:</h4>
<p>great! :)</p>



<a name="135504066"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/%2354538%20%20%60unused_patterns%60%20lint/near/135504066" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> kleimkuhler <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/.2354538.20.20.60unused_patterns.60.20lint.html#135504066">(Oct 09 2018 at 22:39)</a>:</h4>
<p><span class="user-mention" data-user-id="116009">@nikomatsakis</span> Knowing my next commit will most likely be the final one for this PR, the PR will contain 5 (4 after I remove the last, +1 with adding comments for uncovered cases). Is there a preference that I squash them or will that be covered upon a merge/approval by you?</p>



<a name="135504093"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/%2354538%20%20%60unused_patterns%60%20lint/near/135504093" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> kleimkuhler <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/.2354538.20.20.60unused_patterns.60.20lint.html#135504093">(Oct 09 2018 at 22:39)</a>:</h4>
<p>Can't really find any preference for that noted in contributing guidelines.</p>



<a name="135504382"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/%2354538%20%20%60unused_patterns%60%20lint/near/135504382" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> varkor <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/.2354538.20.20.60unused_patterns.60.20lint.html#135504382">(Oct 09 2018 at 22:45)</a>:</h4>
<p><span class="user-mention" data-user-id="119335">@kleimkuhler</span>: generally, reviewers tend not to be too fussy, but if each commit is approximately a unit, that's preferable</p>



<a name="135504407"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/%2354538%20%20%60unused_patterns%60%20lint/near/135504407" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> kleimkuhler <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/.2354538.20.20.60unused_patterns.60.20lint.html#135504407">(Oct 09 2018 at 22:45)</a>:</h4>
<p>Great sounds good, thanks!</p>



<a name="135504414"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/%2354538%20%20%60unused_patterns%60%20lint/near/135504414" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> varkor <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/.2354538.20.20.60unused_patterns.60.20lint.html#135504414">(Oct 09 2018 at 22:45)</a>:</h4>
<p>it's mainly the long chains of "fix typo"-style commits that get annoying if they're left unsquashed <span class="emoji emoji-1f601" title="grinning face with smiling eyes">:grinning_face_with_smiling_eyes:</span></p>



<a name="135844612"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/%2354538%20%20%60unused_patterns%60%20lint/near/135844612" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> kleimkuhler <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/.2354538.20.20.60unused_patterns.60.20lint.html#135844612">(Oct 15 2018 at 17:06)</a>:</h4>
<p><span class="user-mention" data-user-id="116009">@nikomatsakis</span> Hey since you picked this up more as a mentor issue and it's good to go, want me to switch the reviewer to anyone else? It's been ready to go for a few days, but I can take it off your plate since it's small if you'd prefer that.</p>



<a name="135844741"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/%2354538%20%20%60unused_patterns%60%20lint/near/135844741" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/.2354538.20.20.60unused_patterns.60.20lint.html#135844741">(Oct 15 2018 at 17:09)</a>:</h4>
<p>no problem, I'll r+, I haven't done my "PR sweep" for the day though</p>



<hr><p>Last updated: Aug 07 2021 at 22:04 UTC</p>
</html>