<html>
<head><meta charset="utf-8"><title>#64252 arbitrary self type suggestions · t-compiler · Zulip Chat Archive</title></head>
<h2>Stream: <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/index.html">t-compiler</a></h2>
<h3>Topic: <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/.2364252.20arbitrary.20self.20type.20suggestions.html">#64252 arbitrary self type suggestions</a></h3>

<hr>

<base href="https://rust-lang.zulipchat.com">

<head><link href="https://zulip-archive.rust-lang.org/style.css" rel="stylesheet"></head>

<a name="177061350"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/%2364252%20arbitrary%20self%20type%20suggestions/near/177061350" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> davidtwco <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/.2364252.20arbitrary.20self.20type.20suggestions.html#177061350">(Oct 01 2019 at 14:36)</a>:</h4>
<p><span class="user-mention" data-user-id="126931">@centril</span> just wanted to confirm that you aren't working on this?</p>



<a name="177061389"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/%2364252%20arbitrary%20self%20type%20suggestions/near/177061389" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> centril <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/.2364252.20arbitrary.20self.20type.20suggestions.html#177061389">(Oct 01 2019 at 14:37)</a>:</h4>
<p><span class="user-mention" data-user-id="116107">@davidtwco</span> I gave it a look at decided it was becoming too complicated at the time</p>



<a name="177061419"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/%2364252%20arbitrary%20self%20type%20suggestions/near/177061419" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> centril <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/.2364252.20arbitrary.20self.20type.20suggestions.html#177061419">(Oct 01 2019 at 14:37)</a>:</h4>
<p>but we can talk if you want about it</p>



<a name="177061430"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/%2364252%20arbitrary%20self%20type%20suggestions/near/177061430" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> centril <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/.2364252.20arbitrary.20self.20type.20suggestions.html#177061430">(Oct 01 2019 at 14:37)</a>:</h4>
<p>not working on it tho</p>



<a name="177061437"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/%2364252%20arbitrary%20self%20type%20suggestions/near/177061437" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> centril <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/.2364252.20arbitrary.20self.20type.20suggestions.html#177061437">(Oct 01 2019 at 14:37)</a>:</h4>
<p>(<a href="https://github.com/rust-lang/rust/pull/64910" target="_blank" title="https://github.com/rust-lang/rust/pull/64910">https://github.com/rust-lang/rust/pull/64910</a> should land first)</p>



<a name="177061487"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/%2364252%20arbitrary%20self%20type%20suggestions/near/177061487" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> davidtwco <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/.2364252.20arbitrary.20self.20type.20suggestions.html#177061487">(Oct 01 2019 at 14:38)</a>:</h4>
<p>I threw something together locally if you don't mind me working on it.</p>



<a name="177061558"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/%2364252%20arbitrary%20self%20type%20suggestions/near/177061558" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> centril <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/.2364252.20arbitrary.20self.20type.20suggestions.html#177061558">(Oct 01 2019 at 14:39)</a>:</h4>
<p>oh, already? interesting</p>



<a name="177061562"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/%2364252%20arbitrary%20self%20type%20suggestions/near/177061562" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> centril <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/.2364252.20arbitrary.20self.20type.20suggestions.html#177061562">(Oct 01 2019 at 14:39)</a>:</h4>
<p>r? me if you want</p>



<a name="177061574"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/%2364252%20arbitrary%20self%20type%20suggestions/near/177061574" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> davidtwco <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/.2364252.20arbitrary.20self.20type.20suggestions.html#177061574">(Oct 01 2019 at 14:39)</a>:</h4>
<p>Sure.</p>



<a name="177061610"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/%2364252%20arbitrary%20self%20type%20suggestions/near/177061610" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> centril <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/.2364252.20arbitrary.20self.20type.20suggestions.html#177061610">(Oct 01 2019 at 14:39)</a>:</h4>
<p>Are you just making changes in <code>fn parse_self_param</code>?</p>



<a name="177061698"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/%2364252%20arbitrary%20self%20type%20suggestions/near/177061698" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> davidtwco <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/.2364252.20arbitrary.20self.20type.20suggestions.html#177061698">(Oct 01 2019 at 14:40)</a>:</h4>
<p><span class="user-mention" data-user-id="126931">@centril</span> <a href="https://github.com/rust-lang/rust/pull/64959" target="_blank" title="https://github.com/rust-lang/rust/pull/64959">https://github.com/rust-lang/rust/pull/64959</a></p>



<a name="177062041"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/%2364252%20arbitrary%20self%20type%20suggestions/near/177062041" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> centril <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/.2364252.20arbitrary.20self.20type.20suggestions.html#177062041">(Oct 01 2019 at 14:44)</a>:</h4>
<p>that was quick :D -- will have a look later tonight</p>



<a name="177062061"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/%2364252%20arbitrary%20self%20type%20suggestions/near/177062061" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> centril <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/.2364252.20arbitrary.20self.20type.20suggestions.html#177062061">(Oct 01 2019 at 14:44)</a>:</h4>
<p>from the outset it seems a much cleaner approach than the throw-away stuff I had</p>



<a name="177062316"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/%2364252%20arbitrary%20self%20type%20suggestions/near/177062316" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> centril <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/.2364252.20arbitrary.20self.20type.20suggestions.html#177062316">(Oct 01 2019 at 14:47)</a>:</h4>
<p><span class="user-mention" data-user-id="116107">@davidtwco</span> looking at <code>self: i32</code>... did you consider a more semantic approach with <code>.parse_ty()</code> and then checking whether the type would be applicable as a <code>self: SelfTy</code> parameter?</p>



<a name="177062387"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/%2364252%20arbitrary%20self%20type%20suggestions/near/177062387" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> davidtwco <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/.2364252.20arbitrary.20self.20type.20suggestions.html#177062387">(Oct 01 2019 at 14:48)</a>:</h4>
<p>I thought about it, but wasn't sure that it made sense for the parser to do that - would just have added a lot of complexity.</p>



<a name="177062402"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/%2364252%20arbitrary%20self%20type%20suggestions/near/177062402" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> davidtwco <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/.2364252.20arbitrary.20self.20type.20suggestions.html#177062402">(Oct 01 2019 at 14:48)</a>:</h4>
<p>I made the suggestion <code>MaybeIncorrect</code> for cases like that.</p>



<a name="177062474"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/%2364252%20arbitrary%20self%20type%20suggestions/near/177062474" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> centril <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/.2364252.20arbitrary.20self.20type.20suggestions.html#177062474">(Oct 01 2019 at 14:49)</a>:</h4>
<p>it's OK in the parser in recovery branches if it is reasonably hidden away from main happy-path logic but I think you're right that even so it would be a lot of complexity (you'd need a visitor and such)</p>



<a name="177062481"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/%2364252%20arbitrary%20self%20type%20suggestions/near/177062481" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> davidtwco <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/.2364252.20arbitrary.20self.20type.20suggestions.html#177062481">(Oct 01 2019 at 14:49)</a>:</h4>
<p>I don't know if it's required for the arbitrary self type to contain <code>Self</code> - could there be some trait implementation on <code>i32</code> that takes a <code>self: i32</code> correctly?</p>



<a name="177062596"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/%2364252%20arbitrary%20self%20type%20suggestions/near/177062596" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> centril <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/.2364252.20arbitrary.20self.20type.20suggestions.html#177062596">(Oct 01 2019 at 14:50)</a>:</h4>
<p>The stable subset requires <code>Box&lt;Self&gt;</code>, <code>Rc&lt;Self&gt;</code>, <code>Arc&lt;Self&gt;</code>,  <code>Self</code>, <code>&amp;Self</code>, <code>&amp;mut Self</code> and some stuff about <code>Pin</code></p>



<a name="177062610"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/%2364252%20arbitrary%20self%20type%20suggestions/near/177062610" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> centril <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/.2364252.20arbitrary.20self.20type.20suggestions.html#177062610">(Oct 01 2019 at 14:50)</a>:</h4>
<p>but notably <code>Self</code> need not syntactically occur</p>



<a name="177062621"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/%2364252%20arbitrary%20self%20type%20suggestions/near/177062621" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> centril <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/.2364252.20arbitrary.20self.20type.20suggestions.html#177062621">(Oct 01 2019 at 14:50)</a>:</h4>
<p>it could be a type alias to the type, iirc</p>



<a name="177062638"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/%2364252%20arbitrary%20self%20type%20suggestions/near/177062638" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> centril <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/.2364252.20arbitrary.20self.20type.20suggestions.html#177062638">(Oct 01 2019 at 14:50)</a>:</h4>
<p>but as a heuristic it works</p>



<a name="177062730"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/%2364252%20arbitrary%20self%20type%20suggestions/near/177062730" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> davidtwco <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/.2364252.20arbitrary.20self.20type.20suggestions.html#177062730">(Oct 01 2019 at 14:52)</a>:</h4>
<p>Sure. It's an improvement we could do in a follow-up if we really wanted, I think this is a reasonable improvement to land first.</p>



<a name="177062801"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/%2364252%20arbitrary%20self%20type%20suggestions/near/177062801" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> centril <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/.2364252.20arbitrary.20self.20type.20suggestions.html#177062801">(Oct 01 2019 at 14:52)</a>:</h4>
<p>One could do something dumber tho: Use a visitor that looks for <code>Path</code> with <code>kw::SelfUpper</code> as the identifier</p>



<a name="177062812"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/%2364252%20arbitrary%20self%20type%20suggestions/near/177062812" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> centril <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/.2364252.20arbitrary.20self.20type.20suggestions.html#177062812">(Oct 01 2019 at 14:52)</a>:</h4>
<p><span class="user-mention" data-user-id="116107">@davidtwco</span>  yeah agreed on that</p>



<hr><p>Last updated: Apr 12 2022 at 20:01 UTC</p>
</html>