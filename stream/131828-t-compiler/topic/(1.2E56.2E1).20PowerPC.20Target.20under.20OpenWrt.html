<html>
<head><meta charset="utf-8"><title>(1.56.1) PowerPC Target under OpenWrt · t-compiler · Zulip Chat Archive</title></head>
<h2>Stream: <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/index.html">t-compiler</a></h2>
<h3>Topic: <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/(1.2E56.2E1).20PowerPC.20Target.20under.20OpenWrt.html">(1.56.1) PowerPC Target under OpenWrt</a></h3>

<hr>

<base href="https://rust-lang.zulipchat.com">

<head><link href="https://zulip-archive.rust-lang.org/style.css" rel="stylesheet"></head>

<a name="262783076"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/%281.56.1%29%20PowerPC%20Target%20under%20OpenWrt/near/262783076" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grommish <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/(1.2E56.2E1).20PowerPC.20Target.20under.20OpenWrt.html#262783076">(Nov 26 2021 at 10:49)</a>:</h4>
<p>I am just now able to come back to rust-lang, but this will be a tremendous help for the PPC target if it works :)  Then, it's just figuring out arm and it should be good to go.  I think I've found a better way to handle the toolchains, as well.</p>
<p>I am splitting the <code>dist</code> into a HOST installers and a TARGET installers.</p>
<div class="codehilite"><pre><span></span><code>20M Nov 26 05:37 dl/rust-1.56.1-mips64-unknown-linux-muslabi64-install.tar.xz
666M Nov 26 05:42 dl/rust-1.56.1-x86_64-unknown-linux-gnu-install.tar.xz
</code></pre></div>
<p>Question, is there a reason to keep <code>rust-nightly-dev</code>in the <code>dist</code> package I create?<br>
Or rather, of the below packages, which can I get rid of as non-essential?  </p>
<div class="codehilite"><pre><span></span><code>cargo-nightly-x86_64-unknown-linux-gnu.tar.xz                rust-dev-nightly-x86_64-unknown-linux-gnu.tar.xz
clippy-nightly-x86_64-unknown-linux-gnu.tar.xz               rust-nightly-x86_64-unknown-linux-gnu.tar.xz
llvm-tools-nightly-x86_64-unknown-linux-gnu.tar.xz           rust-src-nightly.tar.xz
miri-nightly-x86_64-unknown-linux-gnu.tar.xz                 rust-std-nightly-mips64-unknown-linux-muslabi64.tar.xz
rls-nightly-x86_64-unknown-linux-gnu.tar.xz                  rust-std-nightly-x86_64-unknown-linux-gnu.tar.xz
rust-analysis-nightly-mips64-unknown-linux-muslabi64.tar.xz  rustc-dev-nightly-x86_64-unknown-linux-gnu.tar.xz
rust-analysis-nightly-x86_64-unknown-linux-gnu.tar.xz        rustc-nightly-src.tar.xz
rust-analyzer-nightly-x86_64-unknown-linux-gnu.tar.xz        rustc-nightly-x86_64-unknown-linux-gnu.tar.xz
rust-demangler-nightly-x86_64-unknown-linux-gnu.tar.xz       rustfmt-nightly-x86_64-unknown-linux-gnu.tar.xz
</code></pre></div>



<a name="262795630"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/%281.56.1%29%20PowerPC%20Target%20under%20OpenWrt/near/262795630" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joshua Nelson <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/(1.2E56.2E1).20PowerPC.20Target.20under.20OpenWrt.html#262795630">(Nov 26 2021 at 13:12)</a>:</h4>
<p><code>rust-analysis</code> is not useful unless you want to support RLS</p>



<a name="262795659"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/%281.56.1%29%20PowerPC%20Target%20under%20OpenWrt/near/262795659" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joshua Nelson <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/(1.2E56.2E1).20PowerPC.20Target.20under.20OpenWrt.html#262795659">(Nov 26 2021 at 13:12)</a>:</h4>
<p><code>rustc-dev</code> is only useful if you want to write your own compiler tools (like an out-of-tree version of clippy)</p>



<a name="262795672"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/%281.56.1%29%20PowerPC%20Target%20under%20OpenWrt/near/262795672" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joshua Nelson <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/(1.2E56.2E1).20PowerPC.20Target.20under.20OpenWrt.html#262795672">(Nov 26 2021 at 13:12)</a>:</h4>
<p>rust-dev is not useful</p>



<a name="262795742"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/%281.56.1%29%20PowerPC%20Target%20under%20OpenWrt/near/262795742" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joshua Nelson <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/(1.2E56.2E1).20PowerPC.20Target.20under.20OpenWrt.html#262795742">(Nov 26 2021 at 13:13)</a>:</h4>
<p>I think the rest could be theoretically useful; it depends what you want to do with these</p>



<a name="262795848"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/%281.56.1%29%20PowerPC%20Target%20under%20OpenWrt/near/262795848" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joshua Nelson <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/(1.2E56.2E1).20PowerPC.20Target.20under.20OpenWrt.html#262795848">(Nov 26 2021 at 13:14)</a>:</h4>
<p>(although there's not really a reason to use <code>rust-analyzer-nightly</code> over just building rust-analyzer from source IMO)</p>



<a name="262805903"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/%281.56.1%29%20PowerPC%20Target%20under%20OpenWrt/near/262805903" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grommish <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/(1.2E56.2E1).20PowerPC.20Target.20under.20OpenWrt.html#262805903">(Nov 26 2021 at 14:57)</a>:</h4>
<p>I use <code>x.py dist</code> and just grab the <code>.xz</code> files from <code>build/dist</code> and archive them up.   I may just remove <code>rust-dev</code> and be done with it, since that's the big stall spot and leave the rest in case, somewhere down the line, someone wants to use the rust tools inside the build system.</p>



<a name="262847490"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/%281.56.1%29%20PowerPC%20Target%20under%20OpenWrt/near/262847490" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grommish <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/(1.2E56.2E1).20PowerPC.20Target.20under.20OpenWrt.html#262847490">(Nov 27 2021 at 01:46)</a>:</h4>
<p>What about <code>rust-src</code>? (disregard: I saw someone answer about <code>rust-src</code>).. I think I'll just keep everything, because I have no idea what they might be using it for.</p>



<a name="262890492"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/%281.56.1%29%20PowerPC%20Target%20under%20OpenWrt/near/262890492" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grommish <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/(1.2E56.2E1).20PowerPC.20Target.20under.20OpenWrt.html#262890492">(Nov 27 2021 at 20:05)</a>:</h4>
<p>Adding the below to my <code>configure</code> call resolved the issue, however now it appears LLVM is tossing errors.</p>
<div class="codehilite"><pre><span></span><code>  --set=llvm.cflags=-D__ppc__ \
  --set=llvm.cxxflags=-D__ppc__
</code></pre></div>
<p>This is outside the scope of <code>rust-lang</code> for certain, but any help anyone would like to give would be amazing..</p>
<div class="codehilite"><pre><span></span><code>FAILED: lib/Support/CMakeFiles/LLVMSupport.dir/Memory.cpp.o
ccache /usr/bin/c++ -DGTEST_HAS_RTTI=0 -D_GNU_SOURCE -D__STDC_CONSTANT_MACROS -D__STDC_FORMAT_MACROS -D__STDC_LIMIT_MACROS -I/home/grommish/openwrt/build_dir/hostpkg/rust-1.56.1/build/x86_64-unknown-linux-gnu/llvm/build/lib/Support -I/home/grommish/openwrt/build_dir/hostpkg/rust-1.56.1/src/llvm-project/llvm/lib/Support -I/home/grommish/openwrt/build_dir/hostpkg/rust-1.56.1/build/x86_64-unknown-linux-gnu/llvm/build/include -I/home/grommish/openwrt/build_dir/hostpkg/rust-1.56.1/src/llvm-project/llvm/include -ffunction-sections -fdata-sections -fPIC -m64 -D__ppc__ -fPIC -fno-semantic-interposition -fvisibility-inlines-hidden -Werror=date-time -Wall -Wextra -Wno-unused-parameter -Wwrite-strings -Wcast-qual -Wno-missing-field-initializers -pedantic -Wno-long-long -Wimplicit-fallthrough -Wno-maybe-uninitialized -Wno-class-memaccess -Wno-redundant-move -Wno-pessimizing-move -Wno-noexcept-type -Wdelete-non-virtual-dtor -Wsuggest-override -Wno-comment -Wmisleading-indentation -fdiagnostics-color -ffunction-sections -fdata-sections -O3 -DNDEBUG -std=c++14  -fno-exceptions -fno-rtti -MD -MT lib/Support/CMakeFiles/LLVMSupport.dir/Memory.cpp.o -MF lib/Support/CMakeFiles/LLVMSupport.dir/Memory.cpp.o.d -o lib/Support/CMakeFiles/LLVMSupport.dir/Memory.cpp.o -c /home/grommish/openwrt/build_dir/hostpkg/rust-1.56.1/src/llvm-project/llvm/lib/Support/Memory.cpp
/home/grommish/openwrt/build_dir/hostpkg/rust-1.56.1/src/llvm-project/llvm/lib/Support/Unix/Memory.inc: Assembler messages:
/home/grommish/openwrt/build_dir/hostpkg/rust-1.56.1/src/llvm-project/llvm/lib/Support/Unix/Memory.inc:245: Error: no such instruction: `dcbf 0,%rdx&#39;
/home/grommish/openwrt/build_dir/hostpkg/rust-1.56.1/src/llvm-project/llvm/lib/Support/Unix/Memory.inc:246: Error: no such instruction: `sync&#39;
/home/grommish/openwrt/build_dir/hostpkg/rust-1.56.1/src/llvm-project/llvm/lib/Support/Unix/Memory.inc:249: Error: no such instruction: `icbi 0,%rax&#39;
/home/grommish/openwrt/build_dir/hostpkg/rust-1.56.1/src/llvm-project/llvm/lib/Support/Unix/Memory.inc:250: Error: no such instruction: `isync&#39;
/home/grommish/openwrt/build_dir/hostpkg/rust-1.56.1/src/llvm-project/llvm/lib/Support/Unix/Memory.inc:245: Error: no such instruction: `dcbf 0,%rdx&#39;
/home/grommish/openwrt/build_dir/hostpkg/rust-1.56.1/src/llvm-project/llvm/lib/Support/Unix/Memory.inc:246: Error: no such instruction: `sync&#39;
/home/grommish/openwrt/build_dir/hostpkg/rust-1.56.1/src/llvm-project/llvm/lib/Support/Unix/Memory.inc:249: Error: no such instruction: `icbi 0,%rax&#39;
/home/grommish/openwrt/build_dir/hostpkg/rust-1.56.1/src/llvm-project/llvm/lib/Support/Unix/Memory.inc:250: Error: no such instruction: `isync&#39;
[180/2804] Building CXX object utils/TableGen/CMakeFiles/llvm-tblgen.dir/FastISelEmitter.cpp.o
ninja: build stopped: subcommand failed.
thread &#39;main&#39; panicked at &#39;
command did not execute successfully, got: exit status: 1

build script failed, must exit now&#39;, /home/grommish/.cargo/registry/src/github.com-1ecc6299db9ec823/cmake-0.1.44/src/lib.rs:885:5
</code></pre></div>
<p>Pg24 <a href="https://www.nxp.com/docs/en/white-paper/POWRPCARCPRMRM.pdf">https://www.nxp.com/docs/en/white-paper/POWRPCARCPRMRM.pdf</a> shows those to be valid PPC Memory Registers..  Should I just go pester LLVM?</p>



<a name="262893580"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/%281.56.1%29%20PowerPC%20Target%20under%20OpenWrt/near/262893580" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jubilee <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/(1.2E56.2E1).20PowerPC.20Target.20under.20OpenWrt.html#262893580">(Nov 27 2021 at 21:21)</a>:</h4>
<p>Yeah that looks like an LLVM problem. Their PPC target certainly has given us Some Flak before.</p>



<hr><p>Last updated: Apr 12 2022 at 20:01 UTC</p>
</html>