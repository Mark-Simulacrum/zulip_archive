<html>
<head><meta charset="utf-8"><title>Failures in testsuite on M1 Mac · t-compiler · Zulip Chat Archive</title></head>
<h2>Stream: <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/index.html">t-compiler</a></h2>
<h3>Topic: <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/Failures.20in.20testsuite.20on.20M1.20Mac.html">Failures in testsuite on M1 Mac</a></h3>

<hr>

<base href="https://rust-lang.zulipchat.com">

<head><link href="https://rust-lang.github.io/zulip_archive/style.css" rel="stylesheet"></head>

<a name="241737369"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/Failures%20in%20testsuite%20on%20M1%20Mac/near/241737369" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Hameer Abbasi <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/Failures.20in.20testsuite.20on.20M1.20Mac.html#241737369">(Jun 07 2021 at 07:13)</a>:</h4>
<p>Hello, everyone. I have some failures in the testsuite on an M1 Mac, the first failures <code>./x.py test</code> hits are in <code>rustdoc-ui</code>. What would be the best way to report these, as separate issues, or another way?</p>



<a name="241741845"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/Failures%20in%20testsuite%20on%20M1%20Mac/near/241741845" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> bjorn3 <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/Failures.20in.20testsuite.20on.20M1.20Mac.html#241741845">(Jun 07 2021 at 08:05)</a>:</h4>
<p>The testsuite should pass on M1. Bors doesn't merge PR's until they passed CI. What are the errors?</p>



<a name="241748762"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/Failures%20in%20testsuite%20on%20M1%20Mac/near/241748762" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Hameer Abbasi <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/Failures.20in.20testsuite.20on.20M1.20Mac.html#241748762">(Jun 07 2021 at 09:16)</a>:</h4>
<p>Is M1 tier 1 already? Interesting. I closed the tab, let me run everything again and post it here.</p>



<a name="241748796"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/Failures%20in%20testsuite%20on%20M1%20Mac/near/241748796" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> bjorn3 <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/Failures.20in.20testsuite.20on.20M1.20Mac.html#241748796">(Jun 07 2021 at 09:17)</a>:</h4>
<p>Oh, I am not sure if it is tier 1 already.</p>



<a name="241748934"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/Failures%20in%20testsuite%20on%20M1%20Mac/near/241748934" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> bjorn3 <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/Failures.20in.20testsuite.20on.20M1.20Mac.html#241748934">(Jun 07 2021 at 09:18)</a>:</h4>
<p>Looks like it is tier 2. My bad.</p>



<a name="241748942"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/Failures%20in%20testsuite%20on%20M1%20Mac/near/241748942" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> bjorn3 <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/Failures.20in.20testsuite.20on.20M1.20Mac.html#241748942">(Jun 07 2021 at 09:18)</a>:</h4>
<p><a href="https://doc.rust-lang.org/nightly/rustc/platform-support.html">https://doc.rust-lang.org/nightly/rustc/platform-support.html</a></p>



<a name="241749141"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/Failures%20in%20testsuite%20on%20M1%20Mac/near/241749141" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Hameer Abbasi <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/Failures.20in.20testsuite.20on.20M1.20Mac.html#241749141">(Jun 07 2021 at 09:20)</a>:</h4>
<p><a href="https://github.com/rust-lang/rust/issues/73908">https://github.com/rust-lang/rust/issues/73908</a></p>



<a name="241749963"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/Failures%20in%20testsuite%20on%20M1%20Mac/near/241749963" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Hameer Abbasi <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/Failures.20in.20testsuite.20on.20M1.20Mac.html#241749963">(Jun 07 2021 at 09:28)</a>:</h4>
<p>Here are the failures:</p>
<div class="codehilite"><pre><span></span><code>failures:
    [ui] rustdoc-ui/failed-doctest-compile-fail.rs
    [ui] rustdoc-ui/failed-doctest-missing-codes.rs
    [ui] rustdoc-ui/issue-80992.rs
    [ui] rustdoc-ui/no-run-flag.rs
    [ui] rustdoc-ui/test-type.rs
</code></pre></div>



<a name="241751234"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/Failures%20in%20testsuite%20on%20M1%20Mac/near/241751234" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joshua Nelson <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/Failures.20in.20testsuite.20on.20M1.20Mac.html#241751234">(Jun 07 2021 at 09:41)</a>:</h4>
<p><span class="user-mention" data-user-id="256313">@Hameer Abbasi</span> can you post the full output? That just shows the test name, not what went wrong</p>



<a name="241755490"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/Failures%20in%20testsuite%20on%20M1%20Mac/near/241755490" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Hameer Abbasi <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/Failures.20in.20testsuite.20on.20M1.20Mac.html#241755490">(Jun 07 2021 at 10:24)</a>:</h4>
<p>Here it is. <a href="/user_uploads/4715/EEignli6833n0_zGGc_ZAuac/rust-fail.log">rust-fail.log</a></p>



<a name="241769623"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/Failures%20in%20testsuite%20on%20M1%20Mac/near/241769623" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joshua Nelson <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/Failures.20in.20testsuite.20on.20M1.20Mac.html#241769623">(Jun 07 2021 at 12:38)</a>:</h4>
<p>Those are very strange errors, it looks like compile-fail doctests are unconditionally succeeding instead? No idea what could cause that</p>



<a name="241794164"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/Failures%20in%20testsuite%20on%20M1%20Mac/near/241794164" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Hameer Abbasi <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/Failures.20in.20testsuite.20on.20M1.20Mac.html#241794164">(Jun 07 2021 at 15:28)</a>:</h4>
<p>Yes, that's what it looked like to me too. And indeed, it seemed weird. That means invalid code is being accepted.</p>
<p>I'm using a different C++ compiler than the system one for LLVM. Maybe that would cause it? Let me try the system one.</p>



<a name="241796055"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/Failures%20in%20testsuite%20on%20M1%20Mac/near/241796055" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Hameer Abbasi <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/Failures.20in.20testsuite.20on.20M1.20Mac.html#241796055">(Jun 07 2021 at 15:39)</a>:</h4>
<p>Hmm, weird. It doesn't even accept the system (Xcode) compilers:</p>
<div class="codehilite"><pre><span></span><code>❯ which clang
/usr/bin/clang
❯ which clang++
/usr/bin/clang++
❯ ./x.py test
Updating only changed submodules
Submodules updated in 0.04 seconds
    Finished dev [unoptimized + debuginfo] target(s) in 0.08s
thread &#39;main&#39; panicked at &#39;

couldn&#39;t find required command: &quot;arm64-apple-darwin20.0.0-clang&quot;

&#39;, src/bootstrap/sanity.rs:60:13
note: run with `RUST_BACKTRACE=1` environment variable to display a backtrace
failed to run: /Users/hameerabbasi/Code/rust/build/bootstrap/debug/bootstrap test
Build completed unsuccessfully in 0:00:00
</code></pre></div>



<a name="241798106"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/Failures%20in%20testsuite%20on%20M1%20Mac/near/241798106" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Hameer Abbasi <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/Failures.20in.20testsuite.20on.20M1.20Mac.html#241798106">(Jun 07 2021 at 15:53)</a>:</h4>
<p>Ah, <code>CXX=clang++ CC=clang AR=ar ./x.py ...</code> works.</p>



<a name="241805503"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/Failures%20in%20testsuite%20on%20M1%20Mac/near/241805503" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Hameer Abbasi <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/Failures.20in.20testsuite.20on.20M1.20Mac.html#241805503">(Jun 07 2021 at 16:45)</a>:</h4>
<p>... But produces the same failures in the testsuite. :&lt;</p>



<a name="241874172"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/Failures%20in%20testsuite%20on%20M1%20Mac/near/241874172" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> hyd-dev <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/Failures.20in.20testsuite.20on.20M1.20Mac.html#241874172">(Jun 08 2021 at 06:07)</a>:</h4>
<div class="codehilite"><pre><span></span><code>---- [ui] rustdoc-ui/issue-80992.rs stdout ----
diff of stdout:

1
2   running 1 test
-   test $DIR/issue-80992.rs - test (line 7) - compile fail ... ok
+   test $DIR/issue-80992.rs - test (line 7) ... ok
4
5   test result: ok. 1 passed; 0 failed; 0 ignored; 0 measured; 0 filtered out; finished in $TIME
6


The actual stdout differed from the expected stdout.
</code></pre></div>
<p>The "compile fail" string was added in <a href="https://github.com/rust-lang/rust/issues/84863">#84863</a>, but it disappeared...?</p>



<a name="242335046"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/Failures%20in%20testsuite%20on%20M1%20Mac/near/242335046" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Hameer Abbasi <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/Failures.20in.20testsuite.20on.20M1.20Mac.html#242335046">(Jun 11 2021 at 12:03)</a>:</h4>
<p>Good point, I'll do a <code>git pull</code> and run the testsuite again.</p>



<a name="242337513"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/Failures%20in%20testsuite%20on%20M1%20Mac/near/242337513" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joshua Nelson <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/Failures.20in.20testsuite.20on.20M1.20Mac.html#242337513">(Jun 11 2021 at 12:28)</a>:</h4>
<p>Seems weird it could be out of sync like that, the UI tests were updated in the same commit as the output change</p>



<a name="242337530"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/Failures%20in%20testsuite%20on%20M1%20Mac/near/242337530" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joshua Nelson <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/Failures.20in.20testsuite.20on.20M1.20Mac.html#242337530">(Jun 11 2021 at 12:28)</a>:</h4>
<p><span class="user-mention" data-user-id="256313">@Hameer Abbasi</span> do you have download-rustc set by any chance?</p>



<a name="242337734"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/Failures%20in%20testsuite%20on%20M1%20Mac/near/242337734" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Hameer Abbasi <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/Failures.20in.20testsuite.20on.20M1.20Mac.html#242337734">(Jun 11 2021 at 12:30)</a>:</h4>
<p>It's commented out, I assume that means <code>false</code>.</p>



<a name="242337951"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/Failures%20in%20testsuite%20on%20M1%20Mac/near/242337951" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Hameer Abbasi <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/Failures.20in.20testsuite.20on.20M1.20Mac.html#242337951">(Jun 11 2021 at 12:32)</a>:</h4>
<p>(It does build the compiler, maybe it doesn't use it though).</p>



<a name="242337985"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/Failures%20in%20testsuite%20on%20M1%20Mac/near/242337985" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joshua Nelson <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/Failures.20in.20testsuite.20on.20M1.20Mac.html#242337985">(Jun 11 2021 at 12:32)</a>:</h4>
<p>Hmm ok that's not the issue then</p>



<a name="242338030"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/Failures%20in%20testsuite%20on%20M1%20Mac/near/242338030" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joshua Nelson <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/Failures.20in.20testsuite.20on.20M1.20Mac.html#242338030">(Jun 11 2021 at 12:32)</a>:</h4>
<p>(the default depends on the profile, but if it built it then it's using it)</p>



<a name="242348842"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/Failures%20in%20testsuite%20on%20M1%20Mac/near/242348842" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Hameer Abbasi <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/Failures.20in.20testsuite.20on.20M1.20Mac.html#242348842">(Jun 11 2021 at 14:00)</a>:</h4>
<p>It still fails with the newest pull.</p>



<a name="242909302"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/Failures%20in%20testsuite%20on%20M1%20Mac/near/242909302" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> pnkfelix <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/Failures.20in.20testsuite.20on.20M1.20Mac.html#242909302">(Jun 16 2021 at 16:52)</a>:</h4>
<p>As noted in <a class="stream-topic" data-stream-id="131828" href="/#narrow/stream/131828-t-compiler/topic/Test.20meta-coverage">#t-compiler &gt; Test meta-coverage</a> , I am seeing the same failure on non-M1 (Tier1) systems. I’m looking into it now.</p>



<a name="242925387"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/Failures%20in%20testsuite%20on%20M1%20Mac/near/242925387" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> pnkfelix <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/Failures.20in.20testsuite.20on.20M1.20Mac.html#242925387">(Jun 16 2021 at 18:53)</a>:</h4>
<p>(filed an issue and renamed aforemented topic to <a class="stream-topic" data-stream-id="131828" href="/#narrow/stream/131828-t-compiler/topic/Test.20meta-coverage.20.2386366">#t-compiler &gt; Test meta-coverage #86366</a> )</p>



<hr><p>Last updated: Aug 07 2021 at 22:04 UTC</p>
</html>