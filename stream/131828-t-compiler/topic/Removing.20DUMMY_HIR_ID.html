<html>
<head><meta charset="utf-8"><title>Removing DUMMY_HIR_ID · t-compiler · Zulip Chat Archive</title></head>
<h2>Stream: <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/index.html">t-compiler</a></h2>
<h3>Topic: <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/Removing.20DUMMY_HIR_ID.html">Removing DUMMY_HIR_ID</a></h3>

<hr>

<base href="https://rust-lang.zulipchat.com">

<head><link href="https://rust-lang.github.io/zulip_archive/style.css" rel="stylesheet"></head>

<a name="193722651"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/Removing%20DUMMY_HIR_ID/near/193722651" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> marmeladema <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/Removing.20DUMMY_HIR_ID.html#193722651">(Apr 12 2020 at 17:49)</a>:</h4>
<p>I made a first attempt at removing small usage of DUMMY_HIR_ID: <a href="https://github.com/rust-lang/rust/pull/71069" title="https://github.com/rust-lang/rust/pull/71069">https://github.com/rust-lang/rust/pull/71069</a></p>



<a name="193722669"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/Removing%20DUMMY_HIR_ID/near/193722669" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> marmeladema <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/Removing.20DUMMY_HIR_ID.html#193722669">(Apr 12 2020 at 17:49)</a>:</h4>
<p>(tests are compiling locally right now, so i don't know if they pass yet)</p>



<a name="193724377"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/Removing%20DUMMY_HIR_ID/near/193724377" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> eddyb <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/Removing.20DUMMY_HIR_ID.html#193724377">(Apr 12 2020 at 18:32)</a>:</h4>
<p>heh you got there before me</p>



<a name="193724384"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/Removing%20DUMMY_HIR_ID/near/193724384" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> eddyb <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/Removing.20DUMMY_HIR_ID.html#193724384">(Apr 12 2020 at 18:32)</a>:</h4>
<p><span aria-label="+1" class="emoji emoji-1f44d" role="img" title="+1">:+1:</span> on <code>ObligationCause::dummy()</code></p>



<a name="193724531"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/Removing%20DUMMY_HIR_ID/near/193724531" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> eddyb <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/Removing.20DUMMY_HIR_ID.html#193724531">(Apr 12 2020 at 18:36)</a>:</h4>
<p>idk if I should do a PSA but "CI / PR (x86_64-gnu-llvm-7) (pull_request) Successful in 41m " is the thing to look for in general</p>



<a name="193724546"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/Removing%20DUMMY_HIR_ID/near/193724546" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> eddyb <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/Removing.20DUMMY_HIR_ID.html#193724546">(Apr 12 2020 at 18:37)</a>:</h4>
<p>it's faster than the same checks running on the older Azure</p>



<a name="193724555"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/Removing%20DUMMY_HIR_ID/near/193724555" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> marmeladema <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/Removing.20DUMMY_HIR_ID.html#193724555">(Apr 12 2020 at 18:37)</a>:</h4>
<p>Yep, i looked at it and all the tests pass. Azure build takes 120m <span aria-label="fear" class="emoji emoji-1f628" role="img" title="fear">:fear:</span></p>



<a name="193724618"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/Removing%20DUMMY_HIR_ID/near/193724618" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> marmeladema <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/Removing.20DUMMY_HIR_ID.html#193724618">(Apr 12 2020 at 18:38)</a>:</h4>
<p>There is also this other quick one: <a href="https://github.com/rust-lang/rust/pull/71071" title="https://github.com/rust-lang/rust/pull/71071">https://github.com/rust-lang/rust/pull/71071</a></p>



<a name="193724639"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/Removing%20DUMMY_HIR_ID/near/193724639" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> eddyb <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/Removing.20DUMMY_HIR_ID.html#193724639">(Apr 12 2020 at 18:39)</a>:</h4>
<p>3x speedup for 4x the cores I guess :D</p>



<a name="193724660"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/Removing%20DUMMY_HIR_ID/near/193724660" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> eddyb <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/Removing.20DUMMY_HIR_ID.html#193724660">(Apr 12 2020 at 18:39)</a>:</h4>
<p><span class="user-mention" data-user-id="281572">@marmeladema</span> ping me when this second one passes too :P</p>



<a name="193724709"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/Removing%20DUMMY_HIR_ID/near/193724709" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> eddyb <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/Removing.20DUMMY_HIR_ID.html#193724709">(Apr 12 2020 at 18:40)</a>:</h4>
<p>actually in general, ping me here because I'll see it faster than in GH notifications</p>



<a name="193724727"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/Removing%20DUMMY_HIR_ID/near/193724727" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> marmeladema <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/Removing.20DUMMY_HIR_ID.html#193724727">(Apr 12 2020 at 18:41)</a>:</h4>
<p>Will do, thanks! I might have one or two other small ones</p>



<a name="193724732"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/Removing%20DUMMY_HIR_ID/near/193724732" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> eddyb <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/Removing.20DUMMY_HIR_ID.html#193724732">(Apr 12 2020 at 18:41)</a>:</h4>
<p>it might be worth combining them into one PR?</p>



<a name="193724737"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/Removing%20DUMMY_HIR_ID/near/193724737" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> eddyb <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/Removing.20DUMMY_HIR_ID.html#193724737">(Apr 12 2020 at 18:41)</a>:</h4>
<p>since they share in common the removal of DUMMY_HIR_ID uses</p>



<a name="193724748"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/Removing%20DUMMY_HIR_ID/near/193724748" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> marmeladema <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/Removing.20DUMMY_HIR_ID.html#193724748">(Apr 12 2020 at 18:41)</a>:</h4>
<p>yep, sorry. I split the one for <code>ObligationCause</code> because i was not sure</p>



<a name="193724795"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/Removing%20DUMMY_HIR_ID/near/193724795" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> marmeladema <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/Removing.20DUMMY_HIR_ID.html#193724795">(Apr 12 2020 at 18:42)</a>:</h4>
<p>But yes, i will merge all the subsequent ones if they are straightforward</p>



<a name="193725208"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/Removing%20DUMMY_HIR_ID/near/193725208" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> eddyb <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/Removing.20DUMMY_HIR_ID.html#193725208">(Apr 12 2020 at 18:52)</a>:</h4>
<p>you can even combine them into the PR I approved and I can just reapprove</p>



<a name="193727986"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/Removing%20DUMMY_HIR_ID/near/193727986" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> marmeladema <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/Removing.20DUMMY_HIR_ID.html#193727986">(Apr 12 2020 at 20:06)</a>:</h4>
<p>I added more commits to <a href="https://github.com/rust-lang/rust/pull/71069" title="https://github.com/rust-lang/rust/pull/71069">https://github.com/rust-lang/rust/pull/71069</a></p>



<a name="193728594"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/Removing%20DUMMY_HIR_ID/near/193728594" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> eddyb <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/Removing.20DUMMY_HIR_ID.html#193728594">(Apr 12 2020 at 20:21)</a>:</h4>
<p>I'm still awake so I'll review now</p>



<a name="193728827"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/Removing%20DUMMY_HIR_ID/near/193728827" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> marmeladema <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/Removing.20DUMMY_HIR_ID.html#193728827">(Apr 12 2020 at 20:28)</a>:</h4>
<p>Thanks</p>



<a name="193728857"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/Removing%20DUMMY_HIR_ID/near/193728857" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> eddyb <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/Removing.20DUMMY_HIR_ID.html#193728857">(Apr 12 2020 at 20:29)</a>:</h4>
<p><span class="user-mention" data-user-id="281572">@marmeladema</span> do you have more commits coming?</p>



<a name="193728926"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/Removing%20DUMMY_HIR_ID/near/193728926" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> marmeladema <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/Removing.20DUMMY_HIR_ID.html#193728926">(Apr 12 2020 at 20:31)</a>:</h4>
<p>Not right now</p>



<a name="193728929"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/Removing%20DUMMY_HIR_ID/near/193728929" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> eddyb <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/Removing.20DUMMY_HIR_ID.html#193728929">(Apr 12 2020 at 20:31)</a>:</h4>
<p>I'll r+ once it passes</p>



<a name="193728935"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/Removing%20DUMMY_HIR_ID/near/193728935" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> marmeladema <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/Removing.20DUMMY_HIR_ID.html#193728935">(Apr 12 2020 at 20:31)</a>:</h4>
<p>I hope it passes :/</p>



<a name="193728998"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/Removing%20DUMMY_HIR_ID/near/193728998" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> eddyb <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/Removing.20DUMMY_HIR_ID.html#193728998">(Apr 12 2020 at 20:33)</a>:</h4>
<p>I don't see anything problematic</p>



<a name="193729369"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/Removing%20DUMMY_HIR_ID/near/193729369" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> marmeladema <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/Removing.20DUMMY_HIR_ID.html#193729369">(Apr 12 2020 at 20:44)</a>:</h4>
<p>it passes <span aria-label="tada" class="emoji emoji-1f389" role="img" title="tada">:tada:</span></p>



<a name="193758646"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/Removing%20DUMMY_HIR_ID/near/193758646" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> marmeladema <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/Removing.20DUMMY_HIR_ID.html#193758646">(Apr 13 2020 at 10:03)</a>:</h4>
<p>Thanks! It got merged pretty quickly! I am king a now blocked on removing it from <code>librustc_ast_lowering</code>. A table that maps node id to hir id is pre allocated in <code>lower_node_id_generic</code>. I tried to change to type of that <code>IndexVec</code> to store <code>Option&lt;HirId&gt;</code> instead of bare <code>HirId</code> and then filter out unused value when calling <code>init_node_id_to_hir_id_mapping</code> but that breaks because there is another table <code>node_id_to_def_id</code> that maps node id to def id and because i removed unused entries in the first table, the indexes do not match anymore in this second table</p>



<a name="193758737"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/Removing%20DUMMY_HIR_ID/near/193758737" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> marmeladema <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/Removing.20DUMMY_HIR_ID.html#193758737">(Apr 13 2020 at 10:05)</a>:</h4>
<p>I could just store Option's too in <code>librustc_hir</code> but that would mean either returning Option everywhere or calling unwrap() before returning which might impact perf</p>



<a name="193758852"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/Removing%20DUMMY_HIR_ID/near/193758852" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> marmeladema <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/Removing.20DUMMY_HIR_ID.html#193758852">(Apr 13 2020 at 10:07)</a>:</h4>
<p>Or I could change the <code>IndexVec</code> to <code>FxHashMap</code>? Dunno if thats a good idea either</p>



<a name="193759660"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/Removing%20DUMMY_HIR_ID/near/193759660" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> eddyb <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/Removing.20DUMMY_HIR_ID.html#193759660">(Apr 13 2020 at 10:22)</a>:</h4>
<p><span class="user-mention" data-user-id="281572">@marmeladema</span> hmm what if you move <code>DUMMY_HIR_ID</code> inside the function that it's used in? unless it's used in more than one file?</p>



<a name="193759766"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/Removing%20DUMMY_HIR_ID/near/193759766" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> marmeladema <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/Removing.20DUMMY_HIR_ID.html#193759766">(Apr 13 2020 at 10:24)</a>:</h4>
<p>well, i could but it means that it will be really stored as value in the table and that it can be "leaked" to other module that access the table using <code>node_id_to_hir_id</code> or <code>local_def_id_to_hir_id</code></p>



<a name="193759789"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/Removing%20DUMMY_HIR_ID/near/193759789" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> eddyb <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/Removing.20DUMMY_HIR_ID.html#193759789">(Apr 13 2020 at 10:25)</a>:</h4>
<p>okay now that your PR is merged I can refresh my search and see if I can understand what is going on</p>



<a name="193759887"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/Removing%20DUMMY_HIR_ID/near/193759887" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> marmeladema <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/Removing.20DUMMY_HIR_ID.html#193759887">(Apr 13 2020 at 10:27)</a>:</h4>
<p>So from what i understand, during lowering DUMMY_HIR_ID is used to pre-allocate hir ids because <code>lower_node_id_generic</code> is not called with consecutive <code>ast_node_id</code> but it is used as an index in that table, so it fills the table to "empty entries" and use the DUMMY_HIR_ID as value</p>



<a name="193759952"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/Removing%20DUMMY_HIR_ID/near/193759952" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> eddyb <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/Removing.20DUMMY_HIR_ID.html#193759952">(Apr 13 2020 at 10:28)</a>:</h4>
<p>and then the <code>hir_id_validator</code> ensures there are no dummy entries left</p>



<a name="193759959"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/Removing%20DUMMY_HIR_ID/near/193759959" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> marmeladema <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/Removing.20DUMMY_HIR_ID.html#193759959">(Apr 13 2020 at 10:28)</a>:</h4>
<p>Oh i'll look to that one, i have missed it</p>



<a name="193759962"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/Removing%20DUMMY_HIR_ID/near/193759962" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> eddyb <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/Removing.20DUMMY_HIR_ID.html#193759962">(Apr 13 2020 at 10:28)</a>:</h4>
<p><span class="user-mention" data-user-id="281572">@marmeladema</span> so I think you can use <code>Option</code></p>



<a name="193759973"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/Removing%20DUMMY_HIR_ID/near/193759973" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> eddyb <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/Removing.20DUMMY_HIR_ID.html#193759973">(Apr 13 2020 at 10:29)</a>:</h4>
<p><code>Option&lt;HirId&gt;</code> will be the same size as <code>HirId</code></p>



<a name="193759978"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/Removing%20DUMMY_HIR_ID/near/193759978" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> eddyb <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/Removing.20DUMMY_HIR_ID.html#193759978">(Apr 13 2020 at 10:29)</a>:</h4>
<p>(thanks to some niche tricks we do with index types)</p>



<a name="193759981"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/Removing%20DUMMY_HIR_ID/near/193759981" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> marmeladema <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/Removing.20DUMMY_HIR_ID.html#193759981">(Apr 13 2020 at 10:29)</a>:</h4>
<p>i did try the Option&lt;&gt; but it failed miserably because there are some empty entries somehow</p>



<a name="193759998"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/Removing%20DUMMY_HIR_ID/near/193759998" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> eddyb <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/Removing.20DUMMY_HIR_ID.html#193759998">(Apr 13 2020 at 10:29)</a>:</h4>
<p>oh!</p>



<a name="193760042"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/Removing%20DUMMY_HIR_ID/near/193760042" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> eddyb <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/Removing.20DUMMY_HIR_ID.html#193760042">(Apr 13 2020 at 10:30)</a>:</h4>
<p>but how does <code>hir_id_validator</code> not see them later?</p>



<a name="193760061"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/Removing%20DUMMY_HIR_ID/near/193760061" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> marmeladema <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/Removing.20DUMMY_HIR_ID.html#193760061">(Apr 13 2020 at 10:30)</a>:</h4>
<p>thats what i want to look at because either my branch was broken or something is wrong somewhere. I did not know about <code>hir_id_validator</code> last night, i am taking a look</p>



<a name="193764097"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/Removing%20DUMMY_HIR_ID/near/193764097" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> marmeladema <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/Removing.20DUMMY_HIR_ID.html#193764097">(Apr 13 2020 at 11:39)</a>:</h4>
<p>So, i am not sure of anything, but reading the hir_id_validator code, i believe that it iterates over all the modules and look at the hir tree of those modules. But if we look at the flat list of hir ids, i think there are still empty entries in it even if they <em>might</em> not be reachable from any module tree.</p>



<a name="193764333"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/Removing%20DUMMY_HIR_ID/near/193764333" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> marmeladema <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/Removing.20DUMMY_HIR_ID.html#193764333">(Apr 13 2020 at 11:43)</a>:</h4>
<p>Also, I found this comment:</p>
<div class="codehilite"><pre><span></span>    // FIXME(eddyb) don&#39;t go through `ast::NodeId` to convert between `HirId`
    // and `LocalDefId` - ideally all `LocalDefId`s would be HIR owners.
    node_id_to_def_id: FxHashMap&lt;ast::NodeId, LocalDefId&gt;,
</pre></div>



<a name="193764530"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/Removing%20DUMMY_HIR_ID/near/193764530" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> eddyb <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/Removing.20DUMMY_HIR_ID.html#193764530">(Apr 13 2020 at 11:47)</a>:</h4>
<p>oh yeah I still need to work on that <em>sigh</em></p>



<a name="193764589"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/Removing%20DUMMY_HIR_ID/near/193764589" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> eddyb <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/Removing.20DUMMY_HIR_ID.html#193764589">(Apr 13 2020 at 11:48)</a>:</h4>
<p><span class="user-mention" data-user-id="281572">@marmeladema</span> unreachable entries may explain it, hmpf. but still, it's kind of reckless of us to even have those</p>



<a name="193764639"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/Removing%20DUMMY_HIR_ID/near/193764639" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> marmeladema <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/Removing.20DUMMY_HIR_ID.html#193764639">(Apr 13 2020 at 11:49)</a>:</h4>
<p>yep, but that would explain when i removed that it broke badly because I basically "re-numbered" node id and the node id to def id table was out of sync</p>



<a name="193764963"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/Removing%20DUMMY_HIR_ID/near/193764963" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> eddyb <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/Removing.20DUMMY_HIR_ID.html#193764963">(Apr 13 2020 at 11:54)</a>:</h4>
<p>what do you mean "removed"?</p>



<a name="193764971"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/Removing%20DUMMY_HIR_ID/near/193764971" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> eddyb <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/Removing.20DUMMY_HIR_ID.html#193764971">(Apr 13 2020 at 11:54)</a>:</h4>
<p>the <code>resize</code> call?</p>



<a name="193764975"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/Removing%20DUMMY_HIR_ID/near/193764975" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> marmeladema <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/Removing.20DUMMY_HIR_ID.html#193764975">(Apr 13 2020 at 11:54)</a>:</h4>
<p>I found the code a bit convoluted because some lookup table are stored globally in the <code>(dyn Resolver).definitions()</code> and some locally in the current <code>LoweringContext</code></p>



<a name="193764999"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/Removing%20DUMMY_HIR_ID/near/193764999" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> eddyb <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/Removing.20DUMMY_HIR_ID.html#193764999">(Apr 13 2020 at 11:55)</a>:</h4>
<p>I am pretty sure this can use <code>Option</code> <a href="https://github.com/rust-lang/rust/blob/0c835b0cca83fe21090562603e4bda77c183ace3/src/librustc_ast_lowering/lib.rs#L581-L586" title="https://github.com/rust-lang/rust/blob/0c835b0cca83fe21090562603e4bda77c183ace3/src/librustc_ast_lowering/lib.rs#L581-L586">https://github.com/rust-lang/rust/blob/0c835b0cca83fe21090562603e4bda77c183ace3/src/librustc_ast_lowering/lib.rs#L581-L586</a></p>



<a name="193765008"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/Removing%20DUMMY_HIR_ID/near/193765008" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> marmeladema <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/Removing.20DUMMY_HIR_ID.html#193765008">(Apr 13 2020 at 11:55)</a>:</h4>
<p>So what i did is to change the type of <code>node_id_to_hir_id</code> in <code>LoweringContext</code> to an indexvec of <code>Option&lt;HirId&gt;</code> instead of bare <code>HirId</code></p>



<a name="193765017"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/Removing%20DUMMY_HIR_ID/near/193765017" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> eddyb <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/Removing.20DUMMY_HIR_ID.html#193765017">(Apr 13 2020 at 11:55)</a>:</h4>
<p>oh wait it's passed to <code>init_node_id_to_hir_id_mapping</code> hmpf</p>



<a name="193765057"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/Removing%20DUMMY_HIR_ID/near/193765057" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> marmeladema <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/Removing.20DUMMY_HIR_ID.html#193765057">(Apr 13 2020 at 11:56)</a>:</h4>
<p>then in the call of <code>init_node_id_to_hir_id_mapping</code> i filter_map to remove the "unused entries"</p>



<a name="193765066"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/Removing%20DUMMY_HIR_ID/near/193765066" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> eddyb <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/Removing.20DUMMY_HIR_ID.html#193765066">(Apr 13 2020 at 11:56)</a>:</h4>
<p>aaaaaah</p>



<a name="193765071"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/Removing%20DUMMY_HIR_ID/near/193765071" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> eddyb <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/Removing.20DUMMY_HIR_ID.html#193765071">(Apr 13 2020 at 11:56)</a>:</h4>
<p>yeah no it's a map</p>



<a name="193765079"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/Removing%20DUMMY_HIR_ID/near/193765079" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> eddyb <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/Removing.20DUMMY_HIR_ID.html#193765079">(Apr 13 2020 at 11:56)</a>:</h4>
<p>the indices are "keys"</p>



<a name="193765083"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/Removing%20DUMMY_HIR_ID/near/193765083" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> marmeladema <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/Removing.20DUMMY_HIR_ID.html#193765083">(Apr 13 2020 at 11:56)</a>:</h4>
<p>yeah i figured that</p>



<a name="193765092"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/Removing%20DUMMY_HIR_ID/near/193765092" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> eddyb <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/Removing.20DUMMY_HIR_ID.html#193765092">(Apr 13 2020 at 11:56)</a>:</h4>
<p>okay so this is the problem <a href="https://github.com/rust-lang/rust/blob/0c835b0cca83fe21090562603e4bda77c183ace3/src/librustc_hir/definitions.rs#L478" title="https://github.com/rust-lang/rust/blob/0c835b0cca83fe21090562603e4bda77c183ace3/src/librustc_hir/definitions.rs#L478">https://github.com/rust-lang/rust/blob/0c835b0cca83fe21090562603e4bda77c183ace3/src/librustc_hir/definitions.rs#L478</a></p>



<a name="193765094"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/Removing%20DUMMY_HIR_ID/near/193765094" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> marmeladema <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/Removing.20DUMMY_HIR_ID.html#193765094">(Apr 13 2020 at 11:56)</a>:</h4>
<p>but in the hir, i don't want Optio&lt;HirId&gt; anymore, do i?</p>



<a name="193765097"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/Removing%20DUMMY_HIR_ID/near/193765097" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> eddyb <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/Removing.20DUMMY_HIR_ID.html#193765097">(Apr 13 2020 at 11:57)</a>:</h4>
<p>now I think I'm caught up</p>



<a name="193765132"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/Removing%20DUMMY_HIR_ID/near/193765132" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> marmeladema <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/Removing.20DUMMY_HIR_ID.html#193765132">(Apr 13 2020 at 11:57)</a>:</h4>
<p>yeah I replaced this line to something like <code>self.node_id_to_hir_id = mapping.into_iter().filter_map(|hir_id| hir_id).collect();</code></p>



<a name="193765193"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/Removing%20DUMMY_HIR_ID/near/193765193" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> marmeladema <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/Removing.20DUMMY_HIR_ID.html#193765193">(Apr 13 2020 at 11:58)</a>:</h4>
<p>to remove the unused entry and avoid changing the type of <code>self.node_id_to_hir_id</code> in the hir</p>



<a name="193765224"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/Removing%20DUMMY_HIR_ID/near/193765224" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> eddyb <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/Removing.20DUMMY_HIR_ID.html#193765224">(Apr 13 2020 at 11:59)</a>:</h4>
<p>have you tried <code>.map(Option::unwrap)</code> :D?</p>



<a name="193765233"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/Removing%20DUMMY_HIR_ID/near/193765233" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> eddyb <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/Removing.20DUMMY_HIR_ID.html#193765233">(Apr 13 2020 at 11:59)</a>:</h4>
<p>since that's what I thought broke</p>



<a name="193765245"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/Removing%20DUMMY_HIR_ID/near/193765245" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> eddyb <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/Removing.20DUMMY_HIR_ID.html#193765245">(Apr 13 2020 at 11:59)</a>:</h4>
<p>oh wait that's the same failure condition <em>facepalm</em></p>



<a name="193765250"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/Removing%20DUMMY_HIR_ID/near/193765250" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> eddyb <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/Removing.20DUMMY_HIR_ID.html#193765250">(Apr 13 2020 at 11:59)</a>:</h4>
<p>just detected earlier</p>



<a name="193765251"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/Removing%20DUMMY_HIR_ID/near/193765251" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> marmeladema <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/Removing.20DUMMY_HIR_ID.html#193765251">(Apr 13 2020 at 11:59)</a>:</h4>
<p>I haven't but because it broke with filter_map it means i removed some entries and re number the ast node id</p>



<a name="193765254"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/Removing%20DUMMY_HIR_ID/near/193765254" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> eddyb <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/Removing.20DUMMY_HIR_ID.html#193765254">(Apr 13 2020 at 11:59)</a>:</h4>
<p>right right</p>



<a name="193765255"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/Removing%20DUMMY_HIR_ID/near/193765255" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> marmeladema <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/Removing.20DUMMY_HIR_ID.html#193765255">(Apr 13 2020 at 11:59)</a>:</h4>
<p>yep</p>



<a name="193765258"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/Removing%20DUMMY_HIR_ID/near/193765258" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> eddyb <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/Removing.20DUMMY_HIR_ID.html#193765258">(Apr 13 2020 at 11:59)</a>:</h4>
<p>did it broke during building libstd?</p>



<a name="193765337"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/Removing%20DUMMY_HIR_ID/near/193765337" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> eddyb <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/Removing.20DUMMY_HIR_ID.html#193765337">(Apr 13 2020 at 12:00)</a>:</h4>
<p>wait hang on this just means there are <code>NodeId</code>s with no corresponding <code>HirId</code></p>



<a name="193765338"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/Removing%20DUMMY_HIR_ID/near/193765338" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> marmeladema <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/Removing.20DUMMY_HIR_ID.html#193765338">(Apr 13 2020 at 12:00)</a>:</h4>
<p>it broke early during stage1 iirc</p>



<a name="193765340"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/Removing%20DUMMY_HIR_ID/near/193765340" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> eddyb <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/Removing.20DUMMY_HIR_ID.html#193765340">(Apr 13 2020 at 12:00)</a>:</h4>
<p>this is normal</p>



<a name="193765343"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/Removing%20DUMMY_HIR_ID/near/193765343" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> eddyb <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/Removing.20DUMMY_HIR_ID.html#193765343">(Apr 13 2020 at 12:00)</a>:</h4>
<p>AST-&gt;HIR lowering replaces some constructs</p>



<a name="193765352"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/Removing%20DUMMY_HIR_ID/near/193765352" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> eddyb <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/Removing.20DUMMY_HIR_ID.html#193765352">(Apr 13 2020 at 12:00)</a>:</h4>
<p>like <code>(a+b)</code> is just <code>a+b</code> after AST-&gt;HIR lowering</p>



<a name="193765381"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/Removing%20DUMMY_HIR_ID/near/193765381" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> eddyb <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/Removing.20DUMMY_HIR_ID.html#193765381">(Apr 13 2020 at 12:01)</a>:</h4>
<p>so yeah you have to change <a href="https://github.com/rust-lang/rust/blob/0c835b0cca83fe21090562603e4bda77c183ace3/src/librustc_hir/definitions.rs#L90" title="https://github.com/rust-lang/rust/blob/0c835b0cca83fe21090562603e4bda77c183ace3/src/librustc_hir/definitions.rs#L90">https://github.com/rust-lang/rust/blob/0c835b0cca83fe21090562603e4bda77c183ace3/src/librustc_hir/definitions.rs#L90</a></p>



<a name="193765389"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/Removing%20DUMMY_HIR_ID/near/193765389" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> marmeladema <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/Removing.20DUMMY_HIR_ID.html#193765389">(Apr 13 2020 at 12:01)</a>:</h4>
<p>Yes, that makes sense, but maybe we should not use an indexvec but really a fxhashmap?</p>



<a name="193765400"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/Removing%20DUMMY_HIR_ID/near/193765400" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> eddyb <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/Removing.20DUMMY_HIR_ID.html#193765400">(Apr 13 2020 at 12:01)</a>:</h4>
<p>every place where you can use a flat array with decent occupancy is a perf win</p>



<a name="193765430"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/Removing%20DUMMY_HIR_ID/near/193765430" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> eddyb <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/Removing.20DUMMY_HIR_ID.html#193765430">(Apr 13 2020 at 12:02)</a>:</h4>
<p>and <code>Option&lt;HirId&gt;</code> is the same size as <code>HirId</code></p>



<a name="193765458"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/Removing%20DUMMY_HIR_ID/near/193765458" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> marmeladema <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/Removing.20DUMMY_HIR_ID.html#193765458">(Apr 13 2020 at 12:02)</a>:</h4>
<p>I figured thats why it was used for yes, perf</p>



<a name="193765497"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/Removing%20DUMMY_HIR_ID/near/193765497" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> eddyb <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/Removing.20DUMMY_HIR_ID.html#193765497">(Apr 13 2020 at 12:02)</a>:</h4>
<p>anyway, eventually this will be used less and less and will matter less and less</p>



<a name="193765511"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/Removing%20DUMMY_HIR_ID/near/193765511" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> marmeladema <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/Removing.20DUMMY_HIR_ID.html#193765511">(Apr 13 2020 at 12:03)</a>:</h4>
<p>But if i replace that with Option&lt;HirId&gt;, then i need to either return Options in the related functions<br>
or unwrap() before returning</p>



<a name="193765519"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/Removing%20DUMMY_HIR_ID/near/193765519" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> eddyb <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/Removing.20DUMMY_HIR_ID.html#193765519">(Apr 13 2020 at 12:03)</a>:</h4>
<p>the latter is correct</p>



<a name="193765522"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/Removing%20DUMMY_HIR_ID/near/193765522" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> eddyb <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/Removing.20DUMMY_HIR_ID.html#193765522">(Apr 13 2020 at 12:03)</a>:</h4>
<p>and see what breaks</p>



<a name="193765536"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/Removing%20DUMMY_HIR_ID/near/193765536" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> marmeladema <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/Removing.20DUMMY_HIR_ID.html#193765536">(Apr 13 2020 at 12:03)</a>:</h4>
<p>and i suspect calling unwrap() in each call might impact perf?</p>



<a name="193765537"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/Removing%20DUMMY_HIR_ID/near/193765537" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> eddyb <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/Removing.20DUMMY_HIR_ID.html#193765537">(Apr 13 2020 at 12:03)</a>:</h4>
<p>anything that breaks will want <code>opt_</code> versions of the regular methods</p>



<a name="193765546"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/Removing%20DUMMY_HIR_ID/near/193765546" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> marmeladema <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/Removing.20DUMMY_HIR_ID.html#193765546">(Apr 13 2020 at 12:03)</a>:</h4>
<p>ok</p>



<a name="193765553"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/Removing%20DUMMY_HIR_ID/near/193765553" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> eddyb <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/Removing.20DUMMY_HIR_ID.html#193765553">(Apr 13 2020 at 12:03)</a>:</h4>
<p>it might, but that's why we'll check</p>



<a name="193765558"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/Removing%20DUMMY_HIR_ID/near/193765558" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> eddyb <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/Removing.20DUMMY_HIR_ID.html#193765558">(Apr 13 2020 at 12:03)</a>:</h4>
<p>first priority is to get something that compiles</p>



<a name="193765619"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/Removing%20DUMMY_HIR_ID/near/193765619" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> marmeladema <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/Removing.20DUMMY_HIR_ID.html#193765619">(Apr 13 2020 at 12:04)</a>:</h4>
<p>Ok</p>



<a name="193765639"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/Removing%20DUMMY_HIR_ID/near/193765639" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> eddyb <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/Removing.20DUMMY_HIR_ID.html#193765639">(Apr 13 2020 at 12:04)</a>:</h4>
<p>ideally nothing uses <code>NodeId</code>s although I know that's not exactly true :P</p>



<a name="193765753"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/Removing%20DUMMY_HIR_ID/near/193765753" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> marmeladema <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/Removing.20DUMMY_HIR_ID.html#193765753">(Apr 13 2020 at 12:06)</a>:</h4>
<p>I'll try that then!</p>



<a name="193771956"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/Removing%20DUMMY_HIR_ID/near/193771956" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> marmeladema <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/Removing.20DUMMY_HIR_ID.html#193771956">(Apr 13 2020 at 13:32)</a>:</h4>
<p>On a similar topic, i made to remove some usage of DUMMY_HIR_ID again: <a href="https://github.com/rust-lang/rust/pull/71092" title="https://github.com/rust-lang/rust/pull/71092">https://github.com/rust-lang/rust/pull/71092</a></p>



<a name="193771962"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/Removing%20DUMMY_HIR_ID/near/193771962" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> marmeladema <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/Removing.20DUMMY_HIR_ID.html#193771962">(Apr 13 2020 at 13:32)</a>:</h4>
<p>test pass on CI, but locally, rustdoc tests are failing</p>



<a name="193771980"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/Removing%20DUMMY_HIR_ID/near/193771980" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> marmeladema <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/Removing.20DUMMY_HIR_ID.html#193771980">(Apr 13 2020 at 13:32)</a>:</h4>
<p>How is that possible? oO</p>



<a name="193772041"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/Removing%20DUMMY_HIR_ID/near/193772041" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> eddyb <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/Removing.20DUMMY_HIR_ID.html#193772041">(Apr 13 2020 at 13:33)</a>:</h4>
<p><span class="user-mention" data-user-id="281572">@marmeladema</span> can you share your local failures?</p>



<a name="193772095"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/Removing%20DUMMY_HIR_ID/near/193772095" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> eddyb <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/Removing.20DUMMY_HIR_ID.html#193772095">(Apr 13 2020 at 13:34)</a>:</h4>
<p>also you can put <code>r? @eddyb</code> in the PR description</p>



<a name="193772161"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/Removing%20DUMMY_HIR_ID/near/193772161" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> marmeladema <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/Removing.20DUMMY_HIR_ID.html#193772161">(Apr 13 2020 at 13:35)</a>:</h4>
<p>I have another commit that i removed because i thought it was responsible for rustdoc test failures, but i reran locally without it and its still failing</p>



<a name="193772227"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/Removing%20DUMMY_HIR_ID/near/193772227" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> marmeladema <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/Removing.20DUMMY_HIR_ID.html#193772227">(Apr 13 2020 at 13:36)</a>:</h4>
<p><a href="https://paste.ee/p/PaE4g" title="https://paste.ee/p/PaE4g">https://paste.ee/p/PaE4g</a></p>



<a name="193772278"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/Removing%20DUMMY_HIR_ID/near/193772278" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> eddyb <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/Removing.20DUMMY_HIR_ID.html#193772278">(Apr 13 2020 at 13:37)</a>:</h4>
<p>that's.... weird</p>



<a name="193772289"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/Removing%20DUMMY_HIR_ID/near/193772289" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> eddyb <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/Removing.20DUMMY_HIR_ID.html#193772289">(Apr 13 2020 at 13:37)</a>:</h4>
<p>what was the commit?</p>



<a name="193772306"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/Removing%20DUMMY_HIR_ID/near/193772306" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> marmeladema <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/Removing.20DUMMY_HIR_ID.html#193772306">(Apr 13 2020 at 13:37)</a>:</h4>
<p>I just added it back to the PR</p>



<a name="193772387"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/Removing%20DUMMY_HIR_ID/near/193772387" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> eddyb <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/Removing.20DUMMY_HIR_ID.html#193772387">(Apr 13 2020 at 13:38)</a>:</h4>
<p>this one? <a href="https://github.com/rust-lang/rust/pull/71092/commits/23da8057990355291235b8b8eaf164806111f20f" title="https://github.com/rust-lang/rust/pull/71092/commits/23da8057990355291235b8b8eaf164806111f20f">https://github.com/rust-lang/rust/pull/71092/commits/23da8057990355291235b8b8eaf164806111f20f</a></p>



<a name="193772429"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/Removing%20DUMMY_HIR_ID/near/193772429" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> marmeladema <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/Removing.20DUMMY_HIR_ID.html#193772429">(Apr 13 2020 at 13:39)</a>:</h4>
<p>Yes, but in fact, no matter what commit I add, i feel like my rustdoc tests are failing</p>



<a name="193772440"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/Removing%20DUMMY_HIR_ID/near/193772440" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> marmeladema <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/Removing.20DUMMY_HIR_ID.html#193772440">(Apr 13 2020 at 13:39)</a>:</h4>
<p>I'll try to run them from master and see what happens</p>



<a name="193772643"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/Removing%20DUMMY_HIR_ID/near/193772643" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> marmeladema <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/Removing.20DUMMY_HIR_ID.html#193772643">(Apr 13 2020 at 13:41)</a>:</h4>
<p>azure tests are failing because of some error getting python-setuptools</p>



<a name="193772652"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/Removing%20DUMMY_HIR_ID/near/193772652" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> marmeladema <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/Removing.20DUMMY_HIR_ID.html#193772652">(Apr 13 2020 at 13:41)</a>:</h4>
<div class="codehilite"><pre><span></span>E: Failed to fetch http://azure.archive.ubuntu.com/ubuntu/pool/main/p/python-setuptools/python3-setuptools_20.7.0-1_all.deb  503  Service Unavailable
</pre></div>



<a name="193772654"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/Removing%20DUMMY_HIR_ID/near/193772654" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> eddyb <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/Removing.20DUMMY_HIR_ID.html#193772654">(Apr 13 2020 at 13:41)</a>:</h4>
<p>lol</p>



<a name="193772701"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/Removing%20DUMMY_HIR_ID/near/193772701" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> eddyb <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/Removing.20DUMMY_HIR_ID.html#193772701">(Apr 13 2020 at 13:42)</a>:</h4>
<p>I still don't understand how "CI network errors" are still a thing</p>



<a name="193772883"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/Removing%20DUMMY_HIR_ID/near/193772883" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> marmeladema <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/Removing.20DUMMY_HIR_ID.html#193772883">(Apr 13 2020 at 13:44)</a>:</h4>
<p>Can they be rerun?</p>



<a name="193772896"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/Removing%20DUMMY_HIR_ID/near/193772896" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> eddyb <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/Removing.20DUMMY_HIR_ID.html#193772896">(Apr 13 2020 at 13:44)</a>:</h4>
<p>cc <span class="user-mention" data-user-id="116122">@simulacrum</span> <span class="user-mention" data-user-id="121055">@Pietro Albini</span></p>



<a name="193772941"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/Removing%20DUMMY_HIR_ID/near/193772941" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> simulacrum <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/Removing.20DUMMY_HIR_ID.html#193772941">(Apr 13 2020 at 13:44)</a>:</h4>
<p>generally those errors mean we just have to wait unfortunately</p>



<a name="193777416"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/Removing%20DUMMY_HIR_ID/near/193777416" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> marmeladema <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/Removing.20DUMMY_HIR_ID.html#193777416">(Apr 13 2020 at 14:31)</a>:</h4>
<p>Ok, tests are failing locally on master also. Very weird, but expect for the azure tests, everything looks good for my PR</p>



<a name="193777473"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/Removing%20DUMMY_HIR_ID/near/193777473" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> eddyb <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/Removing.20DUMMY_HIR_ID.html#193777473">(Apr 13 2020 at 14:32)</a>:</h4>
<p>yeah so something broke locally</p>



<a name="193777483"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/Removing%20DUMMY_HIR_ID/near/193777483" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> eddyb <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/Removing.20DUMMY_HIR_ID.html#193777483">(Apr 13 2020 at 14:32)</a>:</h4>
<p>maybe Python?</p>



<a name="193777579"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/Removing%20DUMMY_HIR_ID/near/193777579" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> marmeladema <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/Removing.20DUMMY_HIR_ID.html#193777579">(Apr 13 2020 at 14:33)</a>:</h4>
<p>yeah i'll dig into the <code>htmldocck.py</code> script</p>



<a name="193777638"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/Removing%20DUMMY_HIR_ID/near/193777638" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> eddyb <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/Removing.20DUMMY_HIR_ID.html#193777638">(Apr 13 2020 at 14:34)</a>:</h4>
<p>I think we changed something about which Python we support</p>



<a name="193777670"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/Removing%20DUMMY_HIR_ID/near/193777670" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> marmeladema <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/Removing.20DUMMY_HIR_ID.html#193777670">(Apr 13 2020 at 14:34)</a>:</h4>
<p>Whats funny is that i started to remove DUMMY_HIR_ID because of those failing test. I assumed my code for LocalDefId was responsible about those failures lol</p>



<a name="193777732"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/Removing%20DUMMY_HIR_ID/near/193777732" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> marmeladema <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/Removing.20DUMMY_HIR_ID.html#193777732">(Apr 13 2020 at 14:34)</a>:</h4>
<p>oh right! I saw that!</p>



<a name="193777760"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/Removing%20DUMMY_HIR_ID/near/193777760" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> marmeladema <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/Removing.20DUMMY_HIR_ID.html#193777760">(Apr 13 2020 at 14:35)</a>:</h4>
<p>You are right, if i force running the tests using python3 it works fine</p>



<a name="193777766"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/Removing%20DUMMY_HIR_ID/near/193777766" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> marmeladema <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/Removing.20DUMMY_HIR_ID.html#193777766">(Apr 13 2020 at 14:35)</a>:</h4>
<p>silly me</p>



<a name="193777852"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/Removing%20DUMMY_HIR_ID/near/193777852" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> eddyb <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/Removing.20DUMMY_HIR_ID.html#193777852">(Apr 13 2020 at 14:36)</a>:</h4>
<p>haha</p>



<a name="193777898"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/Removing%20DUMMY_HIR_ID/near/193777898" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> marmeladema <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/Removing.20DUMMY_HIR_ID.html#193777898">(Apr 13 2020 at 14:36)</a>:</h4>
<p>is there some kind of python venv to remove?</p>



<a name="193777918"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/Removing%20DUMMY_HIR_ID/near/193777918" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> eddyb <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/Removing.20DUMMY_HIR_ID.html#193777918">(Apr 13 2020 at 14:36)</a>:</h4>
<p><span class="user-mention silent" data-user-id="281572">marmeladema</span> <a href="#narrow/stream/131828-t-compiler/topic/Removing.20DUMMY_HIR_ID/near/193777670" title="#narrow/stream/131828-t-compiler/topic/Removing.20DUMMY_HIR_ID/near/193777670">said</a>:</p>
<blockquote>
<p>Whats funny is that i started to remove DUMMY_HIR_ID because of those failing test. I assumed my code for LocalDefId was responsible about those failures lol</p>
</blockquote>
<p>oh I thought it was ICE-ing!</p>



<a name="193778059"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/Removing%20DUMMY_HIR_ID/near/193778059" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> marmeladema <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/Removing.20DUMMY_HIR_ID.html#193778059">(Apr 13 2020 at 14:37)</a>:</h4>
<p>No, just tests failing in rustdoc ... But anyway, removing DUMMY_HIR_ID is a good thing no?</p>



<a name="193778073"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/Removing%20DUMMY_HIR_ID/near/193778073" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> eddyb <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/Removing.20DUMMY_HIR_ID.html#193778073">(Apr 13 2020 at 14:38)</a>:</h4>
<p>yeah</p>



<a name="193778133"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/Removing%20DUMMY_HIR_ID/near/193778133" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> eddyb <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/Removing.20DUMMY_HIR_ID.html#193778133">(Apr 13 2020 at 14:38)</a>:</h4>
<p>just unfortunate about the test failure reason confusion</p>



<a name="193778264"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/Removing%20DUMMY_HIR_ID/near/193778264" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> marmeladema <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/Removing.20DUMMY_HIR_ID.html#193778264">(Apr 13 2020 at 14:39)</a>:</h4>
<p>I'll do a separate PR for the change in ast_lowering+hir just in case it impacts performance</p>



<a name="193787812"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/Removing%20DUMMY_HIR_ID/near/193787812" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> marmeladema <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/Removing.20DUMMY_HIR_ID.html#193787812">(Apr 13 2020 at 16:08)</a>:</h4>
<p>So ... I changed the <code>node_id_to_hir_id</code> to a vec of <code>Option&lt;HirId&gt;</code> and unwrap-ing in <code>local_def_id_to_hir_id</code>leads to the following <a href="https://paste.ee/p/py82b" title="https://paste.ee/p/py82b">https://paste.ee/p/py82b</a></p>



<a name="193787879"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/Removing%20DUMMY_HIR_ID/near/193787879" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> marmeladema <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/Removing.20DUMMY_HIR_ID.html#193787879">(Apr 13 2020 at 16:08)</a>:</h4>
<p>It means that some DUMMY_HIR_ID are leaked somehow</p>



<a name="193788112"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/Removing%20DUMMY_HIR_ID/near/193788112" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> marmeladema <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/Removing.20DUMMY_HIR_ID.html#193788112">(Apr 13 2020 at 16:10)</a>:</h4>
<p>Well actually i think its <code>self.def_id_to_node_id[id]</code> that returns a node_id that does not have a corresponding hir id</p>



<a name="193788605"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/Removing%20DUMMY_HIR_ID/near/193788605" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> eddyb <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/Removing.20DUMMY_HIR_ID.html#193788605">(Apr 13 2020 at 16:14)</a>:</h4>
<p><span class="user-mention" data-user-id="281572">@marmeladema</span> no, that's perfect!</p>



<a name="193788626"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/Removing%20DUMMY_HIR_ID/near/193788626" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> eddyb <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/Removing.20DUMMY_HIR_ID.html#193788626">(Apr 13 2020 at 16:15)</a>:</h4>
<p>we want <em>only</em> save-analysis to fail, if anything fails</p>



<a name="193788679"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/Removing%20DUMMY_HIR_ID/near/193788679" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> eddyb <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/Removing.20DUMMY_HIR_ID.html#193788679">(Apr 13 2020 at 16:15)</a>:</h4>
<p><span class="user-mention" data-user-id="281572">@marmeladema</span> because it does this weird thing where it looks things up by <code>NodeId</code>s</p>



<a name="193788737"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/Removing%20DUMMY_HIR_ID/near/193788737" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> marmeladema <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/Removing.20DUMMY_HIR_ID.html#193788737">(Apr 13 2020 at 16:15)</a>:</h4>
<p>Here are the 4 tests that fail:</p>
<div class="codehilite"><pre><span></span>failures:
    [ui] ui/generator/async-generator-issue-67158.rs
    [ui] ui/save-analysis/issue-68621.rs
    [ui] ui/type-alias-impl-trait/issue-63279.rs
    [ui] ui/type-alias-impl-trait/issue-65679-inst-opaque-ty-from-val-twice.rs
</pre></div>



<a name="193788837"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/Removing%20DUMMY_HIR_ID/near/193788837" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> marmeladema <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/Removing.20DUMMY_HIR_ID.html#193788837">(Apr 13 2020 at 16:16)</a>:</h4>
<p>its not only save-analysis unfortunately</p>



<a name="193789203"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/Removing%20DUMMY_HIR_ID/near/193789203" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> eddyb <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/Removing.20DUMMY_HIR_ID.html#193789203">(Apr 13 2020 at 16:19)</a>:</h4>
<div class="codehilite"><pre><span></span>#0 [has_typeck_tables] processing `&lt;Struct as Service&gt;::Future::{{opaque}}#0`
</pre></div>



<a name="193789337"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/Removing%20DUMMY_HIR_ID/near/193789337" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> eddyb <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/Removing.20DUMMY_HIR_ID.html#193789337">(Apr 13 2020 at 16:20)</a>:</h4>
<p>heh <a href="https://github.com/rust-lang/rust/blob/master/src/librustc_typeck/check/mod.rs#L842" title="https://github.com/rust-lang/rust/blob/master/src/librustc_typeck/check/mod.rs#L842">https://github.com/rust-lang/rust/blob/master/src/librustc_typeck/check/mod.rs#L842</a></p>



<a name="193789356"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/Removing%20DUMMY_HIR_ID/near/193789356" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> marmeladema <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/Removing.20DUMMY_HIR_ID.html#193789356">(Apr 13 2020 at 16:21)</a>:</h4>
<p>For <code>ui/type-alias-impl-trait/issue-63279.rs</code>I get</p>
<div class="codehilite"><pre><span></span>#0 [has_typeck_tables] processing `Closure::{{opaque}}#0`
</pre></div>



<a name="193789377"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/Removing%20DUMMY_HIR_ID/near/193789377" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> eddyb <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/Removing.20DUMMY_HIR_ID.html#193789377">(Apr 13 2020 at 16:21)</a>:</h4>
<p>okay this is suspicious</p>



<a name="193789505"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/Removing%20DUMMY_HIR_ID/near/193789505" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> eddyb <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/Removing.20DUMMY_HIR_ID.html#193789505">(Apr 13 2020 at 16:22)</a>:</h4>
<p>anyway, you can add a variant of <code>as_local_hir_id</code> that has an <code>opt_</code> prefix or <code>_opt</code> suffix</p>



<a name="193789511"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/Removing%20DUMMY_HIR_ID/near/193789511" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> eddyb <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/Removing.20DUMMY_HIR_ID.html#193789511">(Apr 13 2020 at 16:22)</a>:</h4>
<p>that returns <code>Option</code></p>



<a name="193789520"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/Removing%20DUMMY_HIR_ID/near/193789520" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> eddyb <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/Removing.20DUMMY_HIR_ID.html#193789520">(Apr 13 2020 at 16:22)</a>:</h4>
<p>and only a few places use</p>



<a name="193789560"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/Removing%20DUMMY_HIR_ID/near/193789560" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> marmeladema <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/Removing.20DUMMY_HIR_ID.html#193789560">(Apr 13 2020 at 16:23)</a>:</h4>
<p>I can but from what i understand such function would return None, if the def_id is not a local one. Not if the def_id as no hir_id associated</p>



<a name="193789582"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/Removing%20DUMMY_HIR_ID/near/193789582" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> eddyb <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/Removing.20DUMMY_HIR_ID.html#193789582">(Apr 13 2020 at 16:23)</a>:</h4>
<p>hmm</p>



<a name="193789661"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/Removing%20DUMMY_HIR_ID/near/193789661" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> eddyb <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/Removing.20DUMMY_HIR_ID.html#193789661">(Apr 13 2020 at 16:24)</a>:</h4>
<p><span class="user-mention" data-user-id="281572">@marmeladema</span> okay we can manufacture a <code>HirId</code> :P</p>



<a name="193789666"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/Removing%20DUMMY_HIR_ID/near/193789666" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> eddyb <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/Removing.20DUMMY_HIR_ID.html#193789666">(Apr 13 2020 at 16:24)</a>:</h4>
<p>and hopefully nothing breaks</p>



<a name="193789729"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/Removing%20DUMMY_HIR_ID/near/193789729" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> marmeladema <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/Removing.20DUMMY_HIR_ID.html#193789729">(Apr 13 2020 at 16:25)</a>:</h4>
<p>lol okay^^</p>



<a name="193789755"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/Removing%20DUMMY_HIR_ID/near/193789755" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> eddyb <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/Removing.20DUMMY_HIR_ID.html#193789755">(Apr 13 2020 at 16:25)</a>:</h4>
<div class="codehilite"><pre><span></span><span class="n">HirId</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="n">owner</span>: <span class="nc">def_id</span><span class="p">,</span><span class="w"></span>
<span class="w">    </span><span class="n">local_id</span>: <span class="nc">ItemLocalId</span>::<span class="n">from_u32</span><span class="p">(</span><span class="mi">0</span><span class="p">),</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>
</pre></div>



<a name="193789758"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/Removing%20DUMMY_HIR_ID/near/193789758" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> marmeladema <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/Removing.20DUMMY_HIR_ID.html#193789758">(Apr 13 2020 at 16:25)</a>:</h4>
<p>I just dont want to be responsible for hiding an underlying bug somewhere^^</p>



<a name="193789867"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/Removing%20DUMMY_HIR_ID/near/193789867" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> eddyb <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/Removing.20DUMMY_HIR_ID.html#193789867">(Apr 13 2020 at 16:26)</a>:</h4>
<p>eventually all <code>LocalDefId</code> -&gt; <code>HirId</code> conversions will be just this</p>



<a name="193789885"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/Removing%20DUMMY_HIR_ID/near/193789885" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> eddyb <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/Removing.20DUMMY_HIR_ID.html#193789885">(Apr 13 2020 at 16:26)</a>:</h4>
<p>I even have a branch somewhere that does this for everything except closures because those are a bit of a pain</p>



<a name="193790057"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/Removing%20DUMMY_HIR_ID/near/193790057" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> eddyb <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/Removing.20DUMMY_HIR_ID.html#193790057">(Apr 13 2020 at 16:28)</a>:</h4>
<p><span class="user-mention" data-user-id="281572">@marmeladema</span> we can open an issue about a <code>LocalDefId</code> existing that doesn't have any <code>HirId</code></p>



<a name="193790072"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/Removing%20DUMMY_HIR_ID/near/193790072" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> eddyb <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/Removing.20DUMMY_HIR_ID.html#193790072">(Apr 13 2020 at 16:28)</a>:</h4>
<p>and mention it in a comment on the hack</p>



<a name="193790093"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/Removing%20DUMMY_HIR_ID/near/193790093" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> marmeladema <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/Removing.20DUMMY_HIR_ID.html#193790093">(Apr 13 2020 at 16:28)</a>:</h4>
<p>Ok, i am fine with that</p>



<a name="193790453"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/Removing%20DUMMY_HIR_ID/near/193790453" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> marmeladema <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/Removing.20DUMMY_HIR_ID.html#193790453">(Apr 13 2020 at 16:32)</a>:</h4>
<p>Are you already creating the issue or shall I do it?</p>



<a name="193790773"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/Removing%20DUMMY_HIR_ID/near/193790773" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> eddyb <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/Removing.20DUMMY_HIR_ID.html#193790773">(Apr 13 2020 at 16:34)</a>:</h4>
<p>you can do it if you want</p>



<a name="193790870"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/Removing%20DUMMY_HIR_ID/near/193790870" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> marmeladema <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/Removing.20DUMMY_HIR_ID.html#193790870">(Apr 13 2020 at 16:35)</a>:</h4>
<p>Ok I'll try then :)</p>



<a name="193791043"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/Removing%20DUMMY_HIR_ID/near/193791043" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> marmeladema <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/Removing.20DUMMY_HIR_ID.html#193791043">(Apr 13 2020 at 16:37)</a>:</h4>
<p>About <a href="https://github.com/rust-lang/rust/pull/71092" title="https://github.com/rust-lang/rust/pull/71092">https://github.com/rust-lang/rust/pull/71092</a>, is this good to go?</p>



<a name="193791078"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/Removing%20DUMMY_HIR_ID/near/193791078" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> eddyb <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/Removing.20DUMMY_HIR_ID.html#193791078">(Apr 13 2020 at 16:37)</a>:</h4>
<p>oh yeah okay just r+'d it</p>



<a name="193791208"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/Removing%20DUMMY_HIR_ID/near/193791208" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> marmeladema <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/Removing.20DUMMY_HIR_ID.html#193791208">(Apr 13 2020 at 16:38)</a>:</h4>
<p>Cool thanks!</p>



<a name="193794179"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/Removing%20DUMMY_HIR_ID/near/193794179" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> marmeladema <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/Removing.20DUMMY_HIR_ID.html#193794179">(Apr 13 2020 at 17:07)</a>:</h4>
<p>I've removed DUMMY_HIR_ID locally entirely, lets see how many things break :D</p>



<a name="193800445"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/Removing%20DUMMY_HIR_ID/near/193800445" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> marmeladema <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/Removing.20DUMMY_HIR_ID.html#193800445">(Apr 13 2020 at 17:58)</a>:</h4>
<p>Hum only one failure for:</p>
<div class="codehilite"><pre><span></span>failures:
    [ui] ui/generator/async-generator-issue-67158.rs
</pre></div>



<a name="193800489"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/Removing%20DUMMY_HIR_ID/near/193800489" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> marmeladema <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/Removing.20DUMMY_HIR_ID.html#193800489">(Apr 13 2020 at 17:59)</a>:</h4>
<p>But it was already broken with the change to the node_id_to_hir_id</p>



<a name="193800563"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/Removing%20DUMMY_HIR_ID/near/193800563" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> marmeladema <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/Removing.20DUMMY_HIR_ID.html#193800563">(Apr 13 2020 at 17:59)</a>:</h4>
<p><a href="https://paste.ee/p/0cGzW" title="https://paste.ee/p/0cGzW">https://paste.ee/p/0cGzW</a></p>



<a name="193800860"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/Removing%20DUMMY_HIR_ID/near/193800860" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> marmeladema <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/Removing.20DUMMY_HIR_ID.html#193800860">(Apr 13 2020 at 18:02)</a>:</h4>
<p>Its failing here: <a href="https://github.com/rust-lang/rust/blob/master/src/librustc_middle/ty/context.rs#L1129" title="https://github.com/rust-lang/rust/blob/master/src/librustc_middle/ty/context.rs#L1129">https://github.com/rust-lang/rust/blob/master/src/librustc_middle/ty/context.rs#L1129</a></p>



<a name="193800943"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/Removing%20DUMMY_HIR_ID/near/193800943" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> marmeladema <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/Removing.20DUMMY_HIR_ID.html#193800943">(Apr 13 2020 at 18:02)</a>:</h4>
<p>Some node_id don't have a corresponding hir_id</p>



<a name="193801348"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/Removing%20DUMMY_HIR_ID/near/193801348" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> marmeladema <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/Removing.20DUMMY_HIR_ID.html#193801348">(Apr 13 2020 at 18:06)</a>:</h4>
<p>Maybe the <code>trait_map</code> is wrong/corrupted somehow?</p>



<a name="193801965"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/Removing%20DUMMY_HIR_ID/near/193801965" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> eddyb <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/Removing.20DUMMY_HIR_ID.html#193801965">(Apr 13 2020 at 18:11)</a>:</h4>
<p>huh that's really suspicious</p>



<a name="193802091"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/Removing%20DUMMY_HIR_ID/near/193802091" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> eddyb <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/Removing.20DUMMY_HIR_ID.html#193802091">(Apr 13 2020 at 18:12)</a>:</h4>
<p><span class="user-mention" data-user-id="281572">@marmeladema</span> I think you can just ignore <code>NodeId</code>s w/o a <code>HirId</code></p>



<a name="193802096"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/Removing%20DUMMY_HIR_ID/near/193802096" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> eddyb <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/Removing.20DUMMY_HIR_ID.html#193802096">(Apr 13 2020 at 18:12)</a>:</h4>
<p>that just means they weren't lowered</p>



<a name="193802146"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/Removing%20DUMMY_HIR_ID/near/193802146" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> eddyb <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/Removing.20DUMMY_HIR_ID.html#193802146">(Apr 13 2020 at 18:13)</a>:</h4>
<p>it's possibly a bug, but it didn't do anything before anyway</p>



<a name="193802181"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/Removing%20DUMMY_HIR_ID/near/193802181" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> marmeladema <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/Removing.20DUMMY_HIR_ID.html#193802181">(Apr 13 2020 at 18:13)</a>:</h4>
<p>Ok</p>



<a name="193802342"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/Removing%20DUMMY_HIR_ID/near/193802342" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> marmeladema <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/Removing.20DUMMY_HIR_ID.html#193802342">(Apr 13 2020 at 18:15)</a>:</h4>
<p>By the way, I just added one last commit in <a href="https://github.com/rust-lang/rust/pull/71092" title="https://github.com/rust-lang/rust/pull/71092">https://github.com/rust-lang/rust/pull/71092</a></p>



<a name="193802550"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/Removing%20DUMMY_HIR_ID/near/193802550" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> marmeladema <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/Removing.20DUMMY_HIR_ID.html#193802550">(Apr 13 2020 at 18:17)</a>:</h4>
<p><span class="user-mention" data-user-id="119009">@eddyb</span> do you need to approve again in this case? I don't know if how bors work in this case</p>



<a name="193802934"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/Removing%20DUMMY_HIR_ID/near/193802934" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> eddyb <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/Removing.20DUMMY_HIR_ID.html#193802934">(Apr 13 2020 at 18:20)</a>:</h4>
<p>yupp, thanks for the ping</p>



<a name="193804688"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/Removing%20DUMMY_HIR_ID/near/193804688" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> marmeladema <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/Removing.20DUMMY_HIR_ID.html#193804688">(Apr 13 2020 at 18:37)</a>:</h4>
<p>Do i have to wait for stage2 to be built to run some tests? It really takes a long time on my laptop.</p>



<a name="193804774"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/Removing%20DUMMY_HIR_ID/near/193804774" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> eddyb <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/Removing.20DUMMY_HIR_ID.html#193804774">(Apr 13 2020 at 18:38)</a>:</h4>
<p>oh drat I should've asked</p>



<a name="193804790"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/Removing%20DUMMY_HIR_ID/near/193804790" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> eddyb <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/Removing.20DUMMY_HIR_ID.html#193804790">(Apr 13 2020 at 18:38)</a>:</h4>
<p><span class="user-mention" data-user-id="281572">@marmeladema</span> <code>./x.py test --stage 1 src/test/ui</code></p>



<a name="193804806"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/Removing%20DUMMY_HIR_ID/near/193804806" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> eddyb <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/Removing.20DUMMY_HIR_ID.html#193804806">(Apr 13 2020 at 18:38)</a>:</h4>
<p>this should cover most of the testing</p>



<a name="193804830"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/Removing%20DUMMY_HIR_ID/near/193804830" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> eddyb <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/Removing.20DUMMY_HIR_ID.html#193804830">(Apr 13 2020 at 18:39)</a>:</h4>
<p>and set <code>incremental = true</code> in <code>config.toml</code></p>



<a name="193805016"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/Removing%20DUMMY_HIR_ID/near/193805016" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> marmeladema <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/Removing.20DUMMY_HIR_ID.html#193805016">(Apr 13 2020 at 18:41)</a>:</h4>
<p>hu ok lets try that</p>



<a name="193807433"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/Removing%20DUMMY_HIR_ID/near/193807433" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> marmeladema <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/Removing.20DUMMY_HIR_ID.html#193807433">(Apr 13 2020 at 18:59)</a>:</h4>
<p>GHA tests passed</p>



<a name="193825136"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/Removing%20DUMMY_HIR_ID/near/193825136" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> marmeladema <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/Removing.20DUMMY_HIR_ID.html#193825136">(Apr 13 2020 at 21:42)</a>:</h4>
<p>Thank you so much for the advise for --stage 1 and incremental, its way faster</p>



<a name="193825166"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/Removing%20DUMMY_HIR_ID/near/193825166" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> marmeladema <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/Removing.20DUMMY_HIR_ID.html#193825166">(Apr 13 2020 at 21:42)</a>:</h4>
<p>And I have a branch passing all tests without <code>DUMMY_HIR_ID</code></p>



<a name="193825369"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/Removing%20DUMMY_HIR_ID/near/193825369" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> eddyb <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/Removing.20DUMMY_HIR_ID.html#193825369">(Apr 13 2020 at 21:44)</a>:</h4>
<p>nice :D</p>



<a name="193825592"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/Removing%20DUMMY_HIR_ID/near/193825592" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> marmeladema <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/Removing.20DUMMY_HIR_ID.html#193825592">(Apr 13 2020 at 21:47)</a>:</h4>
<p>there are actually 3 places where either a <code>DefId</code> or a <code>NodeId</code> does not have a corresponding <code>HirId</code>. There must a bug somewhere for sure, but i am unable to find/fix it with my current understanding of the codebase. In the meantime, I created <a href="https://github.com/rust-lang/rust/issues/71104" title="https://github.com/rust-lang/rust/issues/71104">https://github.com/rust-lang/rust/issues/71104</a> and i'll update the tickets once I have opened the PR.</p>



<a name="193866911"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/Removing%20DUMMY_HIR_ID/near/193866911" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> marmeladema <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/Removing.20DUMMY_HIR_ID.html#193866911">(Apr 14 2020 at 08:52)</a>:</h4>
<p><span class="user-mention" data-user-id="119009">@eddyb</span> this is it: <a href="https://github.com/rust-lang/rust/pull/71116" title="https://github.com/rust-lang/rust/pull/71116">https://github.com/rust-lang/rust/pull/71116</a></p>



<a name="193866931"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/Removing%20DUMMY_HIR_ID/near/193866931" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> marmeladema <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/Removing.20DUMMY_HIR_ID.html#193866931">(Apr 14 2020 at 08:52)</a>:</h4>
<p>I don't know if a perf run is worth it?</p>



<a name="193867323"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/Removing%20DUMMY_HIR_ID/near/193867323" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> eddyb <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/Removing.20DUMMY_HIR_ID.html#193867323">(Apr 14 2020 at 08:56)</a>:</h4>
<p>eh let's just do it</p>



<a name="193884233"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/Removing%20DUMMY_HIR_ID/near/193884233" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> marmeladema <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/Removing.20DUMMY_HIR_ID.html#193884233">(Apr 14 2020 at 11:42)</a>:</h4>
<p><span aria-label="fingers crossed" class="emoji emoji-1f91e" role="img" title="fingers crossed">:fingers_crossed:</span></p>



<a name="193908228"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/Removing%20DUMMY_HIR_ID/near/193908228" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> marmeladema <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/Removing.20DUMMY_HIR_ID.html#193908228">(Apr 14 2020 at 14:45)</a>:</h4>
<p><a href="https://perf.rust-lang.org/compare.html?start=513a6473d69b3af34e6cdaa4efb288fe5283c3e9&amp;end=433e90a8704a6c96d2560173ac41b079b0e58442" title="https://perf.rust-lang.org/compare.html?start=513a6473d69b3af34e6cdaa4efb288fe5283c3e9&amp;end=433e90a8704a6c96d2560173ac41b079b0e58442">https://perf.rust-lang.org/compare.html?start=513a6473d69b3af34e6cdaa4efb288fe5283c3e9&amp;end=433e90a8704a6c96d2560173ac41b079b0e58442</a></p>



<a name="193908263"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/Removing%20DUMMY_HIR_ID/near/193908263" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> marmeladema <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/Removing.20DUMMY_HIR_ID.html#193908263">(Apr 14 2020 at 14:46)</a>:</h4>
<p>Does not seem very good? <span aria-label="thinking" class="emoji emoji-1f914" role="img" title="thinking">:thinking:</span></p>



<a name="193910276"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/Removing%20DUMMY_HIR_ID/near/193910276" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> marmeladema <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/Removing.20DUMMY_HIR_ID.html#193910276">(Apr 14 2020 at 14:59)</a>:</h4>
<p><span class="user-mention" data-user-id="119009">@eddyb</span> actually i don't really know how to read the results and what is acceptable</p>



<a name="193910678"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/Removing%20DUMMY_HIR_ID/near/193910678" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> eddyb <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/Removing.20DUMMY_HIR_ID.html#193910678">(Apr 14 2020 at 15:01)</a>:</h4>
<p><span class="user-mention" data-user-id="281572">@marmeladema</span> there's no change I don't think</p>



<a name="193910769"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/Removing%20DUMMY_HIR_ID/near/193910769" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> eddyb <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/Removing.20DUMMY_HIR_ID.html#193910769">(Apr 14 2020 at 15:02)</a>:</h4>
<p>the two at the top are just noise</p>



<a name="193910886"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/Removing%20DUMMY_HIR_ID/near/193910886" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> eddyb <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/Removing.20DUMMY_HIR_ID.html#193910886">(Apr 14 2020 at 15:02)</a>:</h4>
<p>okay the rest have a slight slowdown too, but it's like 0.5%, I think it's acceptable</p>



<a name="193911100"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/Removing%20DUMMY_HIR_ID/near/193911100" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> marmeladema <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/Removing.20DUMMY_HIR_ID.html#193911100">(Apr 14 2020 at 15:04)</a>:</h4>
<p>Cool! And hopefully the perf will be back with the LocalDefId work</p>



<a name="194010231"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/Removing%20DUMMY_HIR_ID/near/194010231" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> marmeladema <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/Removing.20DUMMY_HIR_ID.html#194010231">(Apr 15 2020 at 10:25)</a>:</h4>
<p>Merged <span aria-label="tada" class="emoji emoji-1f389" role="img" title="tada">:tada:</span></p>



<a name="194014885"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/Removing%20DUMMY_HIR_ID/near/194014885" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> DPC <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/Removing.20DUMMY_HIR_ID.html#194014885">(Apr 15 2020 at 11:21)</a>:</h4>
<p>if you want more issues to work on, feel free to ping me <span aria-label="slight smile" class="emoji emoji-1f642" role="img" title="slight smile">:slight_smile:</span></p>



<a name="194015683"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/Removing%20DUMMY_HIR_ID/near/194015683" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> marmeladema <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/Removing.20DUMMY_HIR_ID.html#194015683">(Apr 15 2020 at 11:31)</a>:</h4>
<p>I can come back to the first one^^ removing DUMMY_HIR_ID was a side project to better finish the original one</p>



<a name="194277533"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/Removing%20DUMMY_HIR_ID/near/194277533" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> marmeladema <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/Removing.20DUMMY_HIR_ID.html#194277533">(Apr 16 2020 at 09:28)</a>:</h4>
<p>I polished a bit the description for <a href="https://github.com/rust-lang/rust/issues/71104" title="https://github.com/rust-lang/rust/issues/71104">https://github.com/rust-lang/rust/issues/71104</a> and removed the <code>[DRAFT]</code> tag.</p>



<hr><p>Last updated: Aug 07 2021 at 22:04 UTC</p>
</html>