<html>
<head><meta charset="utf-8"><title>Do unions have active fields? · t-compiler · Zulip Chat Archive</title></head>
<h2>Stream: <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/index.html">t-compiler</a></h2>
<h3>Topic: <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/Do.20unions.20have.20active.20fields.3F.html">Do unions have active fields?</a></h3>

<hr>

<base href="https://rust-lang.zulipchat.com">

<head><link href="https://zulip-archive.rust-lang.org/style.css" rel="stylesheet"></head>

<a name="272810652"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/Do%20unions%20have%20active%20fields%3F/near/272810652" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jake <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/Do.20unions.20have.20active.20fields.3F.html#272810652">(Feb 22 2022 at 14:34)</a>:</h4>
<p>Not sure what channel to put this into, so using this as a fallback. The dest prop MIR opt has this comment:</p>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="sd">//!   Subtle case: If `dest` is a, or projects through a union, then we have to make sure that there</span>
<span class="sd">//!   remains an assignment to it, since that sets the "active field" of the union. But if `src` is</span>
<span class="sd">//!   a ZST, it might not be initialized, so there might not be any use of it before the assignment,</span>
<span class="sd">//!   and performing the optimization would simply delete the assignment, leaving `dest`</span>
<span class="sd">//!   uninitialized.</span>
</code></pre></div>
<p>In particular, the claim seems to be that we can't take</p>
<div class="codehilite"><pre><span></span><code>x = ();
y.field = x;
</code></pre></div>
<p>where <code>y</code> is a union having <code>field: ()</code> as one of its variants, and optimize the entire thing away (assuming <code>x</code> is unused otherwise). As far as I know though, Rust unions don't have active fields. Is this comment correct and am I missing something? Is there a worry about this interacting poorly with FFI code/C unions/LTO or something?</p>



<hr><p>Last updated: Apr 12 2022 at 20:01 UTC</p>
</html>