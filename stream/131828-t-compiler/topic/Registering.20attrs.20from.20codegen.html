<html>
<head><meta charset="utf-8"><title>Registering attrs from codegen · t-compiler · Zulip Chat Archive</title></head>
<h2>Stream: <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/index.html">t-compiler</a></h2>
<h3>Topic: <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/Registering.20attrs.20from.20codegen.html">Registering attrs from codegen</a></h3>

<hr>

<base href="https://rust-lang.zulipchat.com">

<head><link href="https://zulip-archive.rust-lang.org/style.css" rel="stylesheet"></head>

<a name="263963655"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/Registering%20attrs%20from%20codegen/near/263963655" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Riccardo D&#x27;Ambrosio <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/Registering.20attrs.20from.20codegen.html#263963655">(Dec 07 2021 at 06:30)</a>:</h4>
<p>I was wondering if maybe we should querify the process of registering tools/attrs? that way a codegen can internally register its own attribute without requiring the user to explicitly declare it in their own library, which is clunky and weird. This would make the boilerplate for using rust-cuda and rust-gpu a bit less. cc <span class="user-mention" data-user-id="119009">@eddyb</span> </p>
<p>Or otherwise provide some way for a codegen to register an attribute, or make it possible for attributes to be registered cross-crate, i.e. spirv-std and cuda-std would define it for the user.</p>



<a name="263965142"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/Registering%20attrs%20from%20codegen/near/263965142" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> bjorn3 <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/Registering.20attrs.20from.20codegen.html#263965142">(Dec 07 2021 at 06:58)</a>:</h4>
<p>I believe the reason that it is registered in the source code is because it allows the attribute to be used even if the tool isn't currently used. I think the best way would be if there was a way to re-export a registered tool attribute from a crate.</p>



<a name="263965320"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/Registering%20attrs%20from%20codegen/near/263965320" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Riccardo D&#x27;Ambrosio <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/Registering.20attrs.20from.20codegen.html#263965320">(Dec 07 2021 at 07:01)</a>:</h4>
<p>Yeah, although im not sure how that could be done, it would probably need to be added to rlib metadata, right?</p>



<a name="263965337"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/Registering%20attrs%20from%20codegen/near/263965337" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Riccardo D&#x27;Ambrosio <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/Registering.20attrs.20from.20codegen.html#263965337">(Dec 07 2021 at 07:01)</a>:</h4>
<p>Hmm yeah that makes sense, it would error if not using the codegen, bringing us back to step one <span aria-label="upside down" class="emoji emoji-1f643" role="img" title="upside down">:upside_down:</span></p>



<a name="263965386"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/Registering%20attrs%20from%20codegen/near/263965386" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Riccardo D&#x27;Ambrosio <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/Registering.20attrs.20from.20codegen.html#263965386">(Dec 07 2021 at 07:02)</a>:</h4>
<p>Although no attributes are actually emitted if not using the codegen, since the crates cfg them for the specific targets</p>



<a name="263965534"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/Registering%20attrs%20from%20codegen/near/263965534" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Riccardo D&#x27;Ambrosio <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/Registering.20attrs.20from.20codegen.html#263965534">(Dec 07 2021 at 07:04)</a>:</h4>
<p>Yeah that would not actually be a problem since crates already cfg-gate away all the no_std and register_attr stuff</p>



<hr><p>Last updated: Apr 12 2022 at 20:01 UTC</p>
</html>