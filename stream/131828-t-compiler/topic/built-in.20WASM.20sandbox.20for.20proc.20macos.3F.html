<html>
<head><meta charset="utf-8"><title>built-in WASM sandbox for proc macos? · t-compiler · Zulip Chat Archive</title></head>
<h2>Stream: <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/index.html">t-compiler</a></h2>
<h3>Topic: <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/built-in.20WASM.20sandbox.20for.20proc.20macos.3F.html">built-in WASM sandbox for proc macos?</a></h3>

<hr>

<base href="https://rust-lang.zulipchat.com">

<head><link href="https://zulip-archive.rust-lang.org/style.css" rel="stylesheet"></head>

<a name="249650897"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/built-in%20WASM%20sandbox%20for%20proc%20macos%3F/near/249650897" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> bstrie <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/built-in.20WASM.20sandbox.20for.20proc.20macos.3F.html#249650897">(Aug 16 2021 at 21:35)</a>:</h4>
<p>I'm unclear about the exact relationship between Cranelift and wasmtime, but does shipping Cranelift by default also mean shipping a wasm interpreter by default? If so, then it would be interesting to investigate built-in functionality like watt (<a href="https://docs.rs/watt/0.4.0/watt/">https://docs.rs/watt/0.4.0/watt/</a>) where proc macros are compiled to wasm and run in a sandbox</p>



<a name="249651171"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/built-in%20WASM%20sandbox%20for%20proc%20macos%3F/near/249651171" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> bjorn3 <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/built-in.20WASM.20sandbox.20for.20proc.20macos.3F.html#249651171">(Aug 16 2021 at 21:37)</a>:</h4>
<p>No, cranelift itself doesn't really know anything about wasm. You need a wasm runtime like wasmtime (which uses cranelift to compile clif ir generated from wasm using the cranelift_wasm crate) to run wasm.</p>



<a name="249651372"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/built-in%20WASM%20sandbox%20for%20proc%20macos%3F/near/249651372" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> bjorn3 <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/built-in.20WASM.20sandbox.20for.20proc.20macos.3F.html#249651372">(Aug 16 2021 at 21:38)</a>:</h4>
<p>Cranelift does have features useful for wasm runtimes, but it doesn't know about wasm itself.</p>



<a name="249652614"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/built-in%20WASM%20sandbox%20for%20proc%20macos%3F/near/249652614" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> bstrie <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/built-in.20WASM.20sandbox.20for.20proc.20macos.3F.html#249652614">(Aug 16 2021 at 21:49)</a>:</h4>
<p>good to know, just an idle thought :)</p>



<a name="249681824"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/built-in%20WASM%20sandbox%20for%20proc%20macos%3F/near/249681824" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Triplett <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/built-in.20WASM.20sandbox.20for.20proc.20macos.3F.html#249681824">(Aug 17 2021 at 06:05)</a>:</h4>
<p>Embedding wasmtime wouldn't be hard; the main issue would be defining an appropriate sandbox.</p>



<a name="249683808"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/built-in%20WASM%20sandbox%20for%20proc%20macos%3F/near/249683808" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> bjorn3 <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/built-in.20WASM.20sandbox.20for.20proc.20macos.3F.html#249683808">(Aug 17 2021 at 06:43)</a>:</h4>
<p>Embedding wasmtime will have to wait until it has an interpreter in addition to the jit I think. Cranelift can currently only compile for x86_64, aarch64 and s390x. Rustc supports many more host platforms.</p>



<a name="249691850"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/built-in%20WASM%20sandbox%20for%20proc%20macos%3F/near/249691850" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> The 8472 <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/built-in.20WASM.20sandbox.20for.20proc.20macos.3F.html#249691850">(Aug 17 2021 at 08:42)</a>:</h4>
<p>it could start as a best-effort thing and fall back to native execution where it's not available</p>



<a name="249731107"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/built-in%20WASM%20sandbox%20for%20proc%20macos%3F/near/249731107" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> bjorn3 <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/built-in.20WASM.20sandbox.20for.20proc.20macos.3F.html#249731107">(Aug 17 2021 at 14:57)</a>:</h4>
<p>That won't easily be possible. Dependencies would have to be compiled by cargo (or any other build system) for a different target depending on if wasm or native execution should be used. This build system can't easily tell which target it should choose as rustc decides it.</p>



<a name="249732675"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/built-in%20WASM%20sandbox%20for%20proc%20macos%3F/near/249732675" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nagisa <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/built-in.20WASM.20sandbox.20for.20proc.20macos.3F.html#249732675">(Aug 17 2021 at 15:08)</a>:</h4>
<p>I dont see why falling back to an interpreter is not good enough for procmacros.</p>



<hr><p>Last updated: Apr 12 2022 at 20:01 UTC</p>
</html>