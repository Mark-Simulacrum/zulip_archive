<html>
<head><meta charset="utf-8"><title>Perf run for #76814 · t-compiler · Zulip Chat Archive</title></head>
<h2>Stream: <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/index.html">t-compiler</a></h2>
<h3>Topic: <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/Perf.20run.20for.20.2376814.html">Perf run for #76814</a></h3>

<hr>

<base href="https://rust-lang.zulipchat.com">

<head><link href="https://zulip-archive.rust-lang.org/style.css" rel="stylesheet"></head>

<a name="210333878"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/Perf%20run%20for%20%2376814/near/210333878" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/Perf.20run.20for.20.2376814.html#210333878">(Sep 16 2020 at 23:51)</a>:</h4>
<p>Can someone start a perf run for me on <a href="https://github.com/rust-lang/rust/issues/76814">#76814</a>?</p>



<a name="210334058"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/Perf%20run%20for%20%2376814/near/210334058" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joshua Nelson <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/Perf.20run.20for.20.2376814.html#210334058">(Sep 16 2020 at 23:53)</a>:</h4>
<p>done</p>



<a name="210334298"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/Perf%20run%20for%20%2376814/near/210334298" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/Perf.20run.20for.20.2376814.html#210334298">(Sep 16 2020 at 23:56)</a>:</h4>
<p>Thanks :)</p>



<a name="213685550"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/Perf%20run%20for%20%2376814/near/213685550" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/Perf.20run.20for.20.2376814.html#213685550">(Oct 18 2020 at 03:28)</a>:</h4>
<p>I rebase <a href="https://github.com/rust-lang/rust/issues/76814">#76814</a>, can someone restart a perf run?</p>



<a name="213685574"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/Perf%20run%20for%20%2376814/near/213685574" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/Perf.20run.20for.20.2376814.html#213685574">(Oct 18 2020 at 03:29)</a>:</h4>
<p><span class="user-mention" data-user-id="232545">@Joshua Nelson</span> I see you're around :P</p>



<a name="213685627"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/Perf%20run%20for%20%2376814/near/213685627" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joshua Nelson <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/Perf.20run.20for.20.2376814.html#213685627">(Oct 18 2020 at 03:30)</a>:</h4>
<p><span class="user-mention" data-user-id="232957">@Jack Huey</span> did you change the implementation? Or just rebase?</p>



<a name="213685630"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/Perf%20run%20for%20%2376814/near/213685630" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joshua Nelson <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/Perf.20run.20for.20.2376814.html#213685630">(Oct 18 2020 at 03:30)</a>:</h4>
<p>if you just rebased I wouldn't expect perf to be much different</p>



<a name="213685654"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/Perf%20run%20for%20%2376814/near/213685654" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/Perf.20run.20for.20.2376814.html#213685654">(Oct 18 2020 at 03:31)</a>:</h4>
<p>Rebased, <em>but</em> importantly, <code>rebind</code> was added that should significantly reduce the work we do</p>



<a name="213685661"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/Perf%20run%20for%20%2376814/near/213685661" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joshua Nelson <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/Perf.20run.20for.20.2376814.html#213685661">(Oct 18 2020 at 03:31)</a>:</h4>
<p>nice, I'll start a run then</p>



<a name="213685664"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/Perf%20run%20for%20%2376814/near/213685664" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/Perf.20run.20for.20.2376814.html#213685664">(Oct 18 2020 at 03:31)</a>:</h4>
<p>Thank you <span aria-label="hearts" class="emoji emoji-2665" role="img" title="hearts">:hearts:</span></p>



<a name="213685868"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/Perf%20run%20for%20%2376814/near/213685868" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/Perf.20run.20for.20.2376814.html#213685868">(Oct 18 2020 at 03:36)</a>:</h4>
<p>(just some rambling:) If this doesn't fix those ~700% increase numbers for  deeply nested closures test, then I imagine we're only going to get that back by using <code>rebind</code> when folding/relating in <code>binders</code> (which I had removed when adding <code>rebind</code> since we can't debug assert that it's doing what we expect it to yet, which was brought up by <span class="user-mention" data-user-id="116009">@nikomatsakis</span>). But, if this <em>does</em> fix that, then I'll be elated.</p>



<a name="213726832"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/Perf%20run%20for%20%2376814/near/213726832" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/Perf.20run.20for.20.2376814.html#213726832">(Oct 18 2020 at 21:26)</a>:</h4>
<p>Okay pushed a change that should help perf. This last run was <em>really</em> bad. Can someone start perf run? <a href="https://github.com/rust-lang/rust/issues/76814">#76814</a></p>



<a name="213726867"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/Perf%20run%20for%20%2376814/near/213726867" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/Perf.20run.20for.20.2376814.html#213726867">(Oct 18 2020 at 21:27)</a>:</h4>
<p><span class="user-mention" data-user-id="116118">@Matthew Jasper</span> btw might have found a bug in min specialization. Or I'm doing something wrong. I can't add this impl: <a href="https://github.com/rust-lang/rust/pull/76814/files#diff-79cd877dd2dfb44945f291684ef33b7d715853b694fcaa153e0d849712e9439cR943">https://github.com/rust-lang/rust/pull/76814/files#diff-79cd877dd2dfb44945f291684ef33b7d715853b694fcaa153e0d849712e9439cR943</a></p>



<a name="213728913"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/Perf%20run%20for%20%2376814/near/213728913" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Matthew Jasper <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/Perf.20run.20for.20.2376814.html#213728913">(Oct 18 2020 at 22:15)</a>:</h4>
<p>That looks expected, I can check if there's a work around for this.</p>



<a name="213731376"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/Perf%20run%20for%20%2376814/near/213731376" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/Perf.20run.20for.20.2376814.html#213731376">(Oct 18 2020 at 23:22)</a>:</h4>
<p>But...where's the specialization here?</p>



<a name="213749770"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/Perf%20run%20for%20%2376814/near/213749770" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Matthew Jasper <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/Perf.20run.20for.20.2376814.html#213749770">(Oct 19 2020 at 07:13)</a>:</h4>
<p>It's specializing this: <a href="https://github.com/rust-lang/rust/blob/3172ff568d95d27daa25e4d3c20ae3a7ea412358/compiler/rustc_middle/src/ty/structural_impls.rs#L1064">https://github.com/rust-lang/rust/blob/3172ff568d95d27daa25e4d3c20ae3a7ea412358/compiler/rustc_middle/src/ty/structural_impls.rs#L1064</a></p>



<a name="213750159"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/Perf%20run%20for%20%2376814/near/213750159" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Matthew Jasper <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/Perf.20run.20for.20.2376814.html#213750159">(Oct 19 2020 at 07:18)</a>:</h4>
<p>This works:</p>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="k">impl</span><span class="o">&lt;'</span><span class="na">tcx</span><span class="p">,</span><span class="w"> </span><span class="o">'</span><span class="na">t</span><span class="o">&gt;</span><span class="w"> </span><span class="n">PredicateVisitor</span><span class="o">&lt;'</span><span class="na">tcx</span><span class="o">&gt;</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="n">CountBoundVars</span><span class="o">&lt;'</span><span class="na">t</span><span class="o">&gt;</span><span class="w"></span>
<span class="k">where</span><span class="w"></span>
<span class="w">    </span><span class="bp">Self</span>: <span class="nc">TypeVisitor</span><span class="o">&lt;'</span><span class="na">tcx</span><span class="o">&gt;</span><span class="p">,</span><span class="w"></span>
<span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="k">fn</span> <span class="nf">visit_predicate</span><span class="p">(</span><span class="o">&amp;</span><span class="k">mut</span><span class="w"> </span><span class="bp">self</span><span class="p">,</span><span class="w"> </span><span class="n">predicate</span>: <span class="nc">ty</span>::<span class="n">Predicate</span><span class="o">&lt;'</span><span class="na">tcx</span><span class="o">&gt;</span><span class="p">)</span><span class="w"> </span>-&gt; <span class="kt">bool</span> <span class="p">{</span><span class="w"></span>
<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="n">predicate</span><span class="p">.</span><span class="n">inner</span><span class="p">.</span><span class="n">outer_exclusive_binder</span><span class="w"> </span><span class="o">&gt;=</span><span class="w"> </span><span class="bp">self</span><span class="p">.</span><span class="n">outer_index</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">            </span><span class="k">return</span><span class="w"> </span><span class="kc">false</span><span class="p">;</span><span class="w"></span>
<span class="w">        </span><span class="p">}</span><span class="w"></span>
<span class="w">        </span><span class="n">predicate</span><span class="p">.</span><span class="n">super_visit_with</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span><span class="w"></span>
<span class="w">    </span><span class="p">}</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>
</code></pre></div>



<a name="213850805"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/Perf%20run%20for%20%2376814/near/213850805" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/Perf.20run.20for.20.2376814.html#213850805">(Oct 19 2020 at 21:49)</a>:</h4>
<p><span class="user-mention" data-user-id="116118">@Matthew Jasper</span> thanks!</p>



<a name="219426301"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/Perf%20run%20for%20%2376814/near/219426301" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/Perf.20run.20for.20.2376814.html#219426301">(Dec 10 2020 at 02:39)</a>:</h4>
<p>Anyone around that can start another perf run for this? (<a href="https://github.com/rust-lang/rust/issues/76814">#76814</a>)</p>



<a name="219428435"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/Perf%20run%20for%20%2376814/near/219428435" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joshua Nelson <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/Perf.20run.20for.20.2376814.html#219428435">(Dec 10 2020 at 03:30)</a>:</h4>
<p><span class="user-mention" data-user-id="232957">@Jack Huey</span> <span class="user-mention" data-user-id="248906">@cjgillot</span> <span class="user-mention" data-user-id="306073">@Tyson Nottingham</span> you might want to consider adding yourself to the perf list, I notice you need perf runs a lot</p>



<a name="219428465"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/Perf%20run%20for%20%2376814/near/219428465" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joshua Nelson <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/Perf.20run.20for.20.2376814.html#219428465">(Dec 10 2020 at 03:31)</a>:</h4>
<p>e.g. <a href="https://github.com/rust-lang/team/pull/381">https://github.com/rust-lang/team/pull/381</a></p>



<a name="219429350"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/Perf%20run%20for%20%2376814/near/219429350" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Tyson Nottingham <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/Perf.20run.20for.20.2376814.html#219429350">(Dec 10 2020 at 03:52)</a>:</h4>
<p>That would be awesome, thanks for the suggestion :)</p>



<a name="219445015"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/Perf%20run%20for%20%2376814/near/219445015" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> lqd <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/Perf.20run.20for.20.2376814.html#219445015">(Dec 10 2020 at 08:51)</a>:</h4>
<p>I've started one in the meantime</p>



<hr><p>Last updated: Apr 12 2022 at 20:01 UTC</p>
</html>