<html>
<head><meta charset="utf-8"><title>LLVM error for built rustc · t-compiler · Zulip Chat Archive</title></head>
<h2>Stream: <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/index.html">t-compiler</a></h2>
<h3>Topic: <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/LLVM.20error.20for.20built.20rustc.html">LLVM error for built rustc</a></h3>

<hr>

<base href="https://rust-lang.zulipchat.com">

<head><link href="https://zulip-archive.rust-lang.org/style.css" rel="stylesheet"></head>

<a name="277437020"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/LLVM%20error%20for%20built%20rustc/near/277437020" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> bstrie <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/LLVM.20error.20for.20built.20rustc.html#277437020">(Apr 01 2022 at 15:40)</a>:</h4>
<p>I'm building a custom rustc with support for x86_64-unknown-none. No code changes other than config.toml. currently to build crates for this target I need to use -Z build-std. I have a crate that builds fine with <code>cargo build -Z build-std --target x86_64-unknown-none</code>, but with my custom rustc the command <code>cargo +stage1 build --target x86_64-unknown-none</code> fails with the following error: <code>rustc: /home/ben/code/rust/src/llvm-project/llvm/lib/Target/X86/MCTargetDesc/X86AsmBackend.cpp:796: virtual void {anonymous}::X86AsmBackend::applyFixup(const llvm::MCAssembler&amp;, const llvm::MCFixup&amp;, const llvm::MCValue&amp;, llvm::MutableArrayRef&lt;char&gt;, uint64_t, bool, const llvm::MCSubtargetInfo*) const: Assertion </code>(Size == 0 || isIntN(Size * 8 + 1, SignedValue)) &amp;&amp; "Value does not fit in the Fixup field"' failed.` Any suggestions as to where to begin looking to fix this?</p>



<a name="277437300"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/LLVM%20error%20for%20built%20rustc/near/277437300" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> bstrie <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/LLVM.20error.20for.20built.20rustc.html#277437300">(Apr 01 2022 at 15:42)</a>:</h4>
<p>should I just, uh, turn off assertions and try compiling again? :P</p>



<a name="277478894"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/LLVM%20error%20for%20built%20rustc/near/277478894" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Nikita Popov <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/LLVM.20error.20for.20built.20rustc.html#277478894">(Apr 01 2022 at 21:18)</a>:</h4>
<p>Run cargo with <code>-v</code>, rerun the crashing rustc command with <code>-C save-temps</code>. Loops through the saved <code>.bc</code> files and pass them to <code>llc</code> from LLVM (possibly with <code>-filetype=obj</code>, given this is an MC assert). Though if you open an issue with attached bitcode someone else can probably figure this out.</p>



<hr><p>Last updated: Apr 12 2022 at 20:01 UTC</p>
</html>