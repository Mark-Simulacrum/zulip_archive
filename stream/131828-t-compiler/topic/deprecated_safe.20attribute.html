<html>
<head><meta charset="utf-8"><title>deprecated_safe attribute · t-compiler · Zulip Chat Archive</title></head>
<h2>Stream: <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/index.html">t-compiler</a></h2>
<h3>Topic: <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/deprecated_safe.20attribute.html">deprecated_safe attribute</a></h3>

<hr>

<base href="https://rust-lang.zulipchat.com">

<head><link href="https://zulip-archive.rust-lang.org/style.css" rel="stylesheet"></head>

<a name="274251697"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/deprecated_safe%20attribute/near/274251697" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> skippy <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/deprecated_safe.20attribute.html#274251697">(Mar 05 2022 at 16:20)</a>:</h4>
<p>Hi, I saw that a new deprecated_safe attribute may end up being used for the env unsoundness issues here: <a href="https://github.com/rust-lang/rust/pull/92365#issuecomment-1057456247">https://github.com/rust-lang/rust/pull/92365#issuecomment-1057456247</a> , and then asked if I could work on it: <a href="https://github.com/rust-lang/rust/pull/92365#issuecomment-1058726600">https://github.com/rust-lang/rust/pull/92365#issuecomment-1058726600</a></p>
<p>I got a basic dev environment setup last night, and now I have some questions about next steps. (A special thank you to whoever included this in the dev guide: "Please ask questions! A lot of people report feeling that they are "wasting expert time", but nobody on t-compiler feels this way. Contributors are important to us.")</p>
<p>I've started exploring the code around the unsafety checking, but I also have a lot of procedural questions. Like if this would need an RFC (I suspect not), but there are still questions that need to be tracked like whether this would be just a rustc attribute, or if it would be available outside of rustc, etc. etc.</p>



<a name="274251783"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/deprecated_safe%20attribute/near/274251783" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> skippy <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/deprecated_safe.20attribute.html#274251783">(Mar 05 2022 at 16:23)</a>:</h4>
<p>Just for some background, this will be my first time contributing to open source, or working on a compiler, or even working on Rust. I have been following Rust quite closely for several years though.</p>



<a name="274252603"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/deprecated_safe%20attribute/near/274252603" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> bstrie <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/deprecated_safe.20attribute.html#274252603">(Mar 05 2022 at 16:40)</a>:</h4>
<p>Welcome! Whether or not this would require an RFC would be up for the libs team to decide: <a class="stream" data-stream-id="219381" href="/#narrow/stream/219381-t-libs">#t-libs</a>. On the one hand this is a fairly minor change, but on the other hand it's something without precedent, so it's worth asking. In particular you can make things easier by keeping the discussion focused on the ability to deprecate only the ability to call <code>env::set_var</code> in safe code. The actual attribute itself would be an unstable implementation detail, probably called <code>rustc_deprecated_safe</code> (the <code>rustc_</code> on the front indicates a rustc implementation detail).</p>



<a name="274252928"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/deprecated_safe%20attribute/near/274252928" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> bstrie <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/deprecated_safe.20attribute.html#274252928">(Mar 05 2022 at 16:47)</a>:</h4>
<p>I'm not completely familiar with the code in question but I have done some work on the deprecation machinery before and my first impression is that this doesn't sound <em>too</em> difficult to implement, but if this is your first time contributing to Rust, or a compiler, or to open source, then you may want to tackle one or two smaller issues just to get familiar with the process. There's a tag for "easy" issues on the issue tracker: <a href="https://github.com/rust-lang/rust/labels/E-easy">https://github.com/rust-lang/rust/labels/E-easy</a> , and in particular if you were to try one of the ones that only deal with adjusting documentation then that would let you get acquainted with the contribution process without asking you to learn too much at once.</p>



<a name="274253009"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/deprecated_safe%20attribute/near/274253009" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> bstrie <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/deprecated_safe.20attribute.html#274253009">(Mar 05 2022 at 16:49)</a>:</h4>
<p>(Also, any of the ones labeled with "E-mentor" indicate that someone might be willing to mentor anyone who wants to work on those issues.)</p>



<a name="274253257"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/deprecated_safe%20attribute/near/274253257" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> skippy <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/deprecated_safe.20attribute.html#274253257">(Mar 05 2022 at 16:54)</a>:</h4>
<p>Thanks! The main reason I chose this issue is because I suggested something like this a few months back on IRLO: <a href="https://internals.rust-lang.org/t/synchronized-ffi-access-to-posix-environment-variable-functions/15475/56">https://internals.rust-lang.org/t/synchronized-ffi-access-to-posix-environment-variable-functions/15475/56</a> It's the perfect motivation for me to finally contribute to rustc. <span aria-label="blush" class="emoji emoji-1f60a" role="img" title="blush">:blush:</span></p>
<p>I am fairly confident this is something I can implement, especially if it's just a rustc_ attribute which would cut out a lot of questions.</p>



<a name="274253542"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/deprecated_safe%20attribute/near/274253542" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> skippy <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/deprecated_safe.20attribute.html#274253542">(Mar 05 2022 at 16:59)</a>:</h4>
<p>I'm just starting to dig into things, but in particular this comment on the UnsafeFn variant stood out to me:</p>
<p>pub enum UnsafetyViolationKind {<br>
    /// Unsafe operation outside <code>unsafe</code>.<br>
    General,<br>
    /// Unsafe operation in an <code>unsafe fn</code> but outside an <code>unsafe</code> block.<br>
    /// Has to be handled as a lint for backwards compatibility.<br>
    UnsafeFn,<br>
}</p>
<p>It seems like this is a very similar backwards compatibility situation so I'm wondering if a new variant here would make sense, and then I can use the UnsafeFn variant as an example to build off of.</p>



<a name="274253708"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/deprecated_safe%20attribute/near/274253708" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> skippy <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/deprecated_safe.20attribute.html#274253708">(Mar 05 2022 at 17:01)</a>:</h4>
<p>And should I move this topic over to t-libs? I wasn't sure where a new attribute would fall.</p>



<a name="274253932"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/deprecated_safe%20attribute/near/274253932" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Urgau <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/deprecated_safe.20attribute.html#274253932">(Mar 05 2022 at 17:04)</a>:</h4>
<p>Just be aware that there are <strong>two</strong> unsafety checker in <code>rustc</code>, one that operate on <code>thir</code>(the new one) and one that operate on <code>mir</code> (the old one, still the default).</p>



<a name="274254052"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/deprecated_safe%20attribute/near/274254052" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> skippy <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/deprecated_safe.20attribute.html#274254052">(Mar 05 2022 at 17:06)</a>:</h4>
<p>I did notice that when I was exploring, would the implementation need go to in both places? I'm not sure if both are simultaneously operational.</p>



<a name="274254148"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/deprecated_safe%20attribute/near/274254148" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> bjorn3 <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/deprecated_safe.20attribute.html#274254148">(Mar 05 2022 at 17:08)</a>:</h4>
<p>They are not used at the same time. Currently the mir one is the only one used by default. We want to migrate to the thir one in the future, so they should be kept in sync.</p>



<a name="274254455"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/deprecated_safe%20attribute/near/274254455" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> skippy <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/deprecated_safe.20attribute.html#274254455">(Mar 05 2022 at 17:14)</a>:</h4>
<p>Do you happen to know the flag to run with the new thir checker? That was actually the first place I tried modifying (just error strings to see a changed output).</p>



<a name="274254482"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/deprecated_safe%20attribute/near/274254482" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> bjorn3 <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/deprecated_safe.20attribute.html#274254482">(Mar 05 2022 at 17:15)</a>:</h4>
<p><code>-Zthir-unsafeck=yes</code></p>



<a name="274254651"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/deprecated_safe%20attribute/near/274254651" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> skippy <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/deprecated_safe.20attribute.html#274254651">(Mar 05 2022 at 17:18)</a>:</h4>
<p>Is that something I should be able to use with stage1? I did <code>cargo +stage1 -Zthir-unsafeck=yes build</code> and got <code>error: the `-Z` flag is only accepted on the nightly channel of Cargo, but this is the `stable` channel</code>.</p>
<p>I did a horrible <code>export RUSTC_BOOTSTRAP=1</code> and then got <code>error: unknown `-Z` flag specified: thir-unsafeck</code> instead.</p>
<p>This is on a dummy project where I call an unsafe fn from a safe fn to test things out.</p>



<a name="274254810"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/deprecated_safe%20attribute/near/274254810" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Urgau <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/deprecated_safe.20attribute.html#274254810">(Mar 05 2022 at 17:22)</a>:</h4>
<p>It's a <code>rustc</code> flag not a <code>cargo</code> one, you should put it in <code>RUSTFLAGS</code> like this <code>RUSTFLAGS='-Zthir-unsafeck=yes' cargo +stage1 build</code>.</p>



<a name="274254926"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/deprecated_safe%20attribute/near/274254926" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> skippy <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/deprecated_safe.20attribute.html#274254926">(Mar 05 2022 at 17:24)</a>:</h4>
<p>awesome!!! thank you, i can get errors from both versions of the unsafety checker now</p>



<a name="274254929"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/deprecated_safe%20attribute/near/274254929" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Urgau <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/deprecated_safe.20attribute.html#274254929">(Mar 05 2022 at 17:24)</a>:</h4>
<p>I would also highly recommend to directly use <code>rustc</code> with a test file: <code>rustc +stage1 -Zthir-unsafeck=yes a.rs</code>.<br>
This will simplify the debugging and also improve the quality of your development process by not having cargo in the way.</p>



<a name="274254937"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/deprecated_safe%20attribute/near/274254937" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> skippy <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/deprecated_safe.20attribute.html#274254937">(Mar 05 2022 at 17:25)</a>:</h4>
<p>nice, thanks for the additional tip</p>



<a name="274254974"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/deprecated_safe%20attribute/near/274254974" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> skippy <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/deprecated_safe.20attribute.html#274254974">(Mar 05 2022 at 17:25)</a>:</h4>
<p>yeah, that is way more convenient :)</p>



<a name="274260098"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/deprecated_safe%20attribute/near/274260098" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> skippy <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/deprecated_safe.20attribute.html#274260098">(Mar 05 2022 at 19:15)</a>:</h4>
<p>i figured out how to add a new rustc attribute and created a new set_var2 unsafe fn using it for testing, i'll see about getting both unsafety checkers to spit out a warning on using it now:</p>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="sd">///</span>
<span class="cp">#[cfg(not(bootstrap))]</span><span class="w"></span>
<span class="cp">#[stable(feature = </span><span class="s">"env"</span><span class="cp">, since = </span><span class="s">"1.0.0"</span><span class="cp">)]</span><span class="w"></span>
<span class="cp">#[rustc_deprecated_safe(since = </span><span class="s">"1.99.0"</span><span class="cp">, reason = </span><span class="s">"bla"</span><span class="cp">)]</span><span class="w"></span>
<span class="k">pub</span><span class="w"> </span><span class="k">unsafe</span><span class="w"> </span><span class="k">fn</span> <span class="nf">set_var2</span><span class="o">&lt;</span><span class="n">K</span>: <span class="nb">AsRef</span><span class="o">&lt;</span><span class="n">OsStr</span><span class="o">&gt;</span><span class="p">,</span><span class="w"> </span><span class="n">V</span>: <span class="nb">AsRef</span><span class="o">&lt;</span><span class="n">OsStr</span><span class="o">&gt;&gt;</span><span class="p">(</span><span class="n">key</span>: <span class="nc">K</span><span class="p">,</span><span class="w"> </span><span class="n">value</span>: <span class="nc">V</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="n">_set_var</span><span class="p">(</span><span class="n">key</span><span class="p">.</span><span class="n">as_ref</span><span class="p">(),</span><span class="w"> </span><span class="n">value</span><span class="p">.</span><span class="n">as_ref</span><span class="p">())</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>
</code></pre></div>



<a name="274264152"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/deprecated_safe%20attribute/near/274264152" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> scottmcm <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/deprecated_safe.20attribute.html#274264152">(Mar 05 2022 at 20:45)</a>:</h4>
<p>The new one was already brought up, but I'll add a mention to <a class="stream" data-stream-id="278509" href="/#narrow/stream/278509-project-thir-unsafeck">#project-thir-unsafeck</a> in case you haven't seen it.  (The question is completely fine here; no need to move it.  It's just easy to miss streams so wanted to share.)</p>



<a name="274264884"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/deprecated_safe%20attribute/near/274264884" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> skippy <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/deprecated_safe.20attribute.html#274264884">(Mar 05 2022 at 21:01)</a>:</h4>
<p>Thanks! I'm working on understanding the old one currently, as least the part dealing with calls to unsafe functions. I'll take a look at the new THIR one next.</p>
<p>I'm also just focusing on calls to unsafe functions first. I know there'll be other places that need handling like function pointers, but I'm not sure what the full list would be.</p>
<p>Btw, I asked if t-libs would be a more appropriate channel earlier, but I think t-compiler is probably correct? The only libs change would be just slapping the new #[rustc_deprecated_safe] attribute on set_env when it works. (assuming that this solution ends up being used)</p>
<p>Would it be appropriate for me to open a tracking issue for this new attribute? I don't know if the concept is already being tracked anywhere, and as mentioned it may not end up being what's used.</p>



<a name="274269286"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/deprecated_safe%20attribute/near/274269286" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> skippy <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/deprecated_safe.20attribute.html#274269286">(Mar 05 2022 at 22:32)</a>:</h4>
<p>This is on the old unsafety checker (not THIR), and I'm not at all confident in the quality of the change yet, but it's a start!</p>
<p><a href="/user_uploads/4715/NZT1xwkXR-IyQuiGh-4-uhNd/image.png">image.png</a></p>
<div class="message_inline_image"><a href="/user_uploads/4715/NZT1xwkXR-IyQuiGh-4-uhNd/image.png" title="image.png"><img src="/user_uploads/4715/NZT1xwkXR-IyQuiGh-4-uhNd/image.png"></a></div>



<a name="274270117"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/deprecated_safe%20attribute/near/274270117" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> skippy <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/deprecated_safe.20attribute.html#274270117">(Mar 05 2022 at 22:54)</a>:</h4>
<p>This is enough to get a successful <code>./x.py build</code> with the real <code>set_var</code> (not <code>set_var2</code>) marked as unsafe now too.</p>



<a name="274305247"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/deprecated_safe%20attribute/near/274305247" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> skippy <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/deprecated_safe.20attribute.html#274305247">(Mar 06 2022 at 13:12)</a>:</h4>
<p>Given this signature:</p>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="k">pub</span><span class="w"> </span><span class="k">fn</span> <span class="nf">set_var</span><span class="o">&lt;</span><span class="n">K</span>: <span class="nb">AsRef</span><span class="o">&lt;</span><span class="n">OsStr</span><span class="o">&gt;</span><span class="p">,</span><span class="w"> </span><span class="n">V</span>: <span class="nb">AsRef</span><span class="o">&lt;</span><span class="n">OsStr</span><span class="o">&gt;&gt;</span><span class="p">(</span><span class="n">key</span>: <span class="nc">K</span><span class="p">,</span><span class="w"> </span><span class="n">value</span>: <span class="nc">V</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="o">..</span><span class="w"> </span><span class="p">}</span><span class="w"></span>
</code></pre></div>
<p>Is it possible to cast this to fn() and Fn()? I'm struggling on how to fill in the _ in these two lines that I want to use for testing:</p>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="kd">let</span><span class="w"> </span><span class="n">_</span>: <span class="nc">fn</span><span class="p">(</span><span class="n">_</span><span class="p">,</span><span class="w"> </span><span class="n">_</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">std</span>::<span class="n">env</span>::<span class="n">set_var</span><span class="p">;</span><span class="w"></span>
<span class="kd">let</span><span class="w"> </span><span class="n">_</span>: <span class="nb">Box</span><span class="o">&lt;</span><span class="k">dyn</span><span class="w"> </span><span class="nb">Fn</span><span class="p">(</span><span class="n">_</span><span class="p">,</span><span class="w"> </span><span class="n">_</span><span class="p">)</span><span class="o">&gt;</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">Box</span>::<span class="n">new</span><span class="p">(</span><span class="n">std</span>::<span class="n">env</span>::<span class="n">set_var</span><span class="p">);</span><span class="w"></span>
</code></pre></div>
<p>In the meantime I just created a dummy, argumentless set_var3 and have the <code>Box&lt;dyn Fn()&gt;</code> sorta kinda working with #[rustc_deprecated_safe].</p>
<p>I'm also not sure what the full list of places that would need to be backwards compatible when a function becomes unsafe is. I know about calling the function, and the fn() and Fn() casts, but I don't know what else there might be.</p>



<a name="274305613"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/deprecated_safe%20attribute/near/274305613" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> bjorn3 <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/deprecated_safe.20attribute.html#274305613">(Mar 06 2022 at 13:22)</a>:</h4>
<p>You have to specify a specific type in the place of _. For example &amp;OsStr or OsString both implement AsRef&lt;OsStr&gt;.</p>



<a name="274305727"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/deprecated_safe%20attribute/near/274305727" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> skippy <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/deprecated_safe.20attribute.html#274305727">(Mar 06 2022 at 13:25)</a>:</h4>
<p>That was the first thing I tried, but I got this error:</p>
<div class="codehilite"><pre><span></span><code>error[E0308]: mismatched types
  --&gt; /home/skippy/rust_deprecated_safe/src/main.rs:10:33
   |
10 |     let _: fn(&amp;OsStr, &amp;OsStr) = std::env::set_var;
   |                                 ^^^^^^^^^^^^^^^^^ one type is more general than the other
   |
   = note: expected fn pointer `for&lt;&#39;r, &#39;s&gt; fn(&amp;&#39;r OsStr, &amp;&#39;s OsStr)`
              found fn pointer `fn(&amp;OsStr, &amp;OsStr)`
</code></pre></div>
<p>Everything I tried to do after that kept making the errors worse. :)</p>



<a name="274305798"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/deprecated_safe%20attribute/near/274305798" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> skippy <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/deprecated_safe.20attribute.html#274305798">(Mar 06 2022 at 13:27)</a>:</h4>
<p>Oh, nevermind, you mentioned OsString also and that does work! Thanks. :)</p>



<a name="274321003"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/deprecated_safe%20attribute/near/274321003" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> skippy <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/deprecated_safe.20attribute.html#274321003">(Mar 06 2022 at 18:34)</a>:</h4>
<p>I was able to get something very basic (and hokey) working to cast an unsafe fn() to a safe fn() when annotated with #[rustc_deprecated_safe], although it doesn't lint at all currently.</p>



<a name="274321932"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/deprecated_safe%20attribute/near/274321932" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> skippy <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/deprecated_safe.20attribute.html#274321932">(Mar 06 2022 at 18:54)</a>:</h4>
<p>There should only be 3 warnings emitted here, not 4, but here's where I'm currently at:</p>
<p><a href="/user_uploads/4715/nrT50BYaV1CEXPfgHug9Lt6C/image.png">image.png</a></p>
<div class="message_inline_image"><a href="/user_uploads/4715/nrT50BYaV1CEXPfgHug9Lt6C/image.png" title="image.png"><img src="/user_uploads/4715/nrT50BYaV1CEXPfgHug9Lt6C/image.png"></a></div>



<a name="274329088"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/deprecated_safe%20attribute/near/274329088" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> skippy <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/deprecated_safe.20attribute.html#274329088">(Mar 06 2022 at 21:27)</a>:</h4>
<p>I have no idea if I'm remotely on the right track with the changes I've been trying, but I pushed them up here: <a href="https://github.com/skippy10110/rust/commit/a2c9fc6a22d5783b172692e6dd212541fb7b1740">https://github.com/skippy10110/rust/commit/a2c9fc6a22d5783b172692e6dd212541fb7b1740</a></p>
<p>These certainly aren't "reviewable" quality, but I wanted to push them in case my computer spontaneously combusts. <span aria-label="blush" class="emoji emoji-1f60a" role="img" title="blush">:blush:</span></p>
<p>This is what I've been using as a testbed:</p>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="k">use</span><span class="w"> </span><span class="n">std</span>::<span class="n">env</span><span class="p">;</span><span class="w"></span>
<span class="k">use</span><span class="w"> </span><span class="n">std</span>::<span class="n">ffi</span>::<span class="n">OsString</span><span class="p">;</span><span class="w"></span>

<span class="k">fn</span> <span class="nf">main</span><span class="p">()</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="n">print_env</span><span class="p">(</span><span class="mi">1</span><span class="p">);</span><span class="w"></span>

<span class="w">    </span><span class="c1">// usage without unsafe should lint</span>
<span class="w">    </span><span class="n">env</span>::<span class="n">set_var</span><span class="p">(</span><span class="s">"TEST"</span><span class="p">,</span><span class="w"> </span><span class="s">"set_var_safe"</span><span class="p">);</span><span class="w"></span>
<span class="w">    </span><span class="n">print_env</span><span class="p">(</span><span class="mi">2</span><span class="p">);</span><span class="w"></span>

<span class="w">    </span><span class="c1">// all of these coercions should lint</span>
<span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="n">set_var_fn_ptr</span>: <span class="nc">fn</span><span class="p">(</span><span class="n">OsString</span><span class="p">,</span><span class="w"> </span><span class="n">OsString</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">env</span>::<span class="n">set_var</span><span class="p">;</span><span class="w"></span>
<span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="n">set_var_fn_impl</span>: <span class="nb">Box</span><span class="o">&lt;</span><span class="k">dyn</span><span class="w"> </span><span class="nb">Fn</span><span class="p">(</span><span class="n">OsString</span><span class="p">,</span><span class="w"> </span><span class="n">OsString</span><span class="p">)</span><span class="o">&gt;</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">Box</span>::<span class="n">new</span><span class="p">(</span><span class="n">env</span>::<span class="n">set_var</span><span class="p">);</span><span class="w"></span>
<span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="k">mut</span><span class="w"> </span><span class="n">set_var_fnmut_impl</span>: <span class="nb">Box</span><span class="o">&lt;</span><span class="k">dyn</span><span class="w"> </span><span class="nb">FnMut</span><span class="p">(</span><span class="n">OsString</span><span class="p">,</span><span class="w"> </span><span class="n">OsString</span><span class="p">)</span><span class="o">&gt;</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">Box</span>::<span class="n">new</span><span class="p">(</span><span class="n">env</span>::<span class="n">set_var</span><span class="p">);</span><span class="w"></span>
<span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="n">set_var_fnonce_impl</span>: <span class="nb">Box</span><span class="o">&lt;</span><span class="k">dyn</span><span class="w"> </span><span class="nb">FnOnce</span><span class="p">(</span><span class="n">OsString</span><span class="p">,</span><span class="w"> </span><span class="n">OsString</span><span class="p">)</span><span class="o">&gt;</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">Box</span>::<span class="n">new</span><span class="p">(</span><span class="n">env</span>::<span class="n">set_var</span><span class="p">);</span><span class="w"></span>

<span class="w">    </span><span class="n">set_var_fn_ptr</span><span class="p">(</span><span class="s">"TEST"</span><span class="p">.</span><span class="n">into</span><span class="p">(),</span><span class="w"> </span><span class="s">"set_var_fn_ptr"</span><span class="p">.</span><span class="n">into</span><span class="p">());</span><span class="w"></span>
<span class="w">    </span><span class="n">print_env</span><span class="p">(</span><span class="mi">3</span><span class="p">);</span><span class="w"></span>

<span class="w">    </span><span class="n">set_var_fn_impl</span><span class="p">(</span><span class="s">"TEST"</span><span class="p">.</span><span class="n">into</span><span class="p">(),</span><span class="w"> </span><span class="s">"set_var_fn_impl"</span><span class="p">.</span><span class="n">into</span><span class="p">());</span><span class="w"></span>
<span class="w">    </span><span class="n">print_env</span><span class="p">(</span><span class="mi">4</span><span class="p">);</span><span class="w"></span>

<span class="w">    </span><span class="n">set_var_fnmut_impl</span><span class="p">(</span><span class="s">"TEST"</span><span class="p">.</span><span class="n">into</span><span class="p">(),</span><span class="w"> </span><span class="s">"set_var_fnmut_impl"</span><span class="p">.</span><span class="n">into</span><span class="p">());</span><span class="w"></span>
<span class="w">    </span><span class="n">print_env</span><span class="p">(</span><span class="mi">5</span><span class="p">);</span><span class="w"></span>

<span class="w">    </span><span class="n">set_var_fnonce_impl</span><span class="p">(</span><span class="s">"TEST"</span><span class="p">.</span><span class="n">into</span><span class="p">(),</span><span class="w"> </span><span class="s">"set_var_fnonce_impl"</span><span class="p">.</span><span class="n">into</span><span class="p">());</span><span class="w"></span>
<span class="w">    </span><span class="n">print_env</span><span class="p">(</span><span class="mi">6</span><span class="p">);</span><span class="w"></span>

<span class="w">    </span><span class="c1">// these shouldn't lint, appropriate unsafe usage</span>
<span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="n">_unsafe_set_var_fn_ptr</span>: <span class="nc">unsafe</span><span class="w"> </span><span class="k">fn</span><span class="p">(</span><span class="n">OsString</span><span class="p">,</span><span class="w"> </span><span class="n">OsString</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">env</span>::<span class="n">set_var</span><span class="p">;</span><span class="w"></span>
<span class="w">    </span><span class="k">unsafe</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">        </span><span class="n">env</span>::<span class="n">set_var</span><span class="p">(</span><span class="s">"TEST"</span><span class="p">,</span><span class="w"> </span><span class="s">"set_var_unsafe"</span><span class="p">);</span><span class="w"></span>
<span class="w">    </span><span class="p">}</span><span class="w"></span>
<span class="w">    </span><span class="n">print_env</span><span class="p">(</span><span class="mi">7</span><span class="p">);</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>

<span class="k">fn</span> <span class="nf">print_env</span><span class="p">(</span><span class="n">i</span>: <span class="kt">u32</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="fm">println!</span><span class="p">(</span><span class="s">"{}: {}"</span><span class="p">,</span><span class="w"> </span><span class="n">i</span><span class="p">,</span><span class="w"> </span><span class="n">env</span>::<span class="n">var</span><span class="p">(</span><span class="s">"TEST"</span><span class="p">).</span><span class="n">unwrap_or</span><span class="p">(</span><span class="s">"missing"</span><span class="p">.</span><span class="n">to_string</span><span class="p">()));</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>
</code></pre></div>



<a name="274329815"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/deprecated_safe%20attribute/near/274329815" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> skippy <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/deprecated_safe.20attribute.html#274329815">(Mar 06 2022 at 21:43)</a>:</h4>
<p>Example output also:</p>
<p><a href="/user_uploads/4715/uzt2heo8ne6jhxjYgT5UjoNr/image.png">image.png</a></p>
<div class="message_inline_image"><a href="/user_uploads/4715/uzt2heo8ne6jhxjYgT5UjoNr/image.png" title="image.png"><img src="/user_uploads/4715/uzt2heo8ne6jhxjYgT5UjoNr/image.png"></a></div>



<a name="274330973"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/deprecated_safe%20attribute/near/274330973" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> bjorn3 <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/deprecated_safe.20attribute.html#274330973">(Mar 06 2022 at 22:08)</a>:</h4>
<p>Left a couple of comments on that commit.</p>



<a name="274331111"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/deprecated_safe%20attribute/near/274331111" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> skippy <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/deprecated_safe.20attribute.html#274331111">(Mar 06 2022 at 22:11)</a>:</h4>
<p>Thanks so much!</p>



<a name="274338578"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/deprecated_safe%20attribute/near/274338578" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> skippy <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/deprecated_safe.20attribute.html#274338578">(Mar 07 2022 at 00:57)</a>:</h4>
<p>I found at least one example that my currently committed code fails to lint for:</p>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="k">fn</span> <span class="nf">fn_taking_fn_impl</span><span class="p">(</span><span class="n">_x</span>: <span class="nb">Box</span><span class="o">&lt;</span><span class="k">dyn</span><span class="w"> </span><span class="nb">Fn</span><span class="p">(</span><span class="n">OsString</span><span class="p">,</span><span class="w"> </span><span class="n">OsString</span><span class="p">)</span><span class="o">&gt;</span><span class="p">)</span><span class="w"> </span><span class="p">{}</span><span class="w"></span>
<span class="n">fn_taking_fn_impl</span><span class="p">(</span><span class="nb">Box</span>::<span class="n">new</span><span class="p">(</span><span class="n">env</span>::<span class="n">set_var</span><span class="p">));</span><span class="w"></span>
</code></pre></div>
<p>(same with FnMut and FnOnce)</p>
<p>This does properly lint at least:</p>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="k">fn</span> <span class="nf">fn_taking_fn_ptr</span><span class="p">(</span><span class="n">_x</span>: <span class="nc">fn</span><span class="p">(</span><span class="n">OsString</span><span class="p">,</span><span class="w"> </span><span class="n">OsString</span><span class="p">))</span><span class="w"> </span><span class="p">{}</span><span class="w"></span>
<span class="n">fn_taking_fn_ptr</span><span class="p">(</span><span class="n">env</span>::<span class="n">set_var</span><span class="p">);</span><span class="w"></span>
</code></pre></div>



<a name="274339152"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/deprecated_safe%20attribute/near/274339152" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> skippy <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/deprecated_safe.20attribute.html#274339152">(Mar 07 2022 at 01:09)</a>:</h4>
<p>Oh, my code does actually lint for that, but only for the very first line that does <code>Box::new(env::set_var)</code>, not subsequent lines. I was already pretty suspicious that I was linting from a really weird place by linting in <code>candidate_assembly.rs</code>. :)</p>



<a name="274437259"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/deprecated_safe%20attribute/near/274437259" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> skippy <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/deprecated_safe.20attribute.html#274437259">(Mar 07 2022 at 18:34)</a>:</h4>
<p>I was able to fix the lint not firing on subsequent usages of <code>Box::new(env::set_var)</code>, the candidate was being cached. I guess it's also fine to lint from <code>candidate_assembly.rs</code> since there is already pre-existing code doing so.</p>



<a name="274437364"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/deprecated_safe%20attribute/near/274437364" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> skippy <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/deprecated_safe.20attribute.html#274437364">(Mar 07 2022 at 18:35)</a>:</h4>
<p>I'm not sure what my next step for #[rustc_deprecated_safe] should be, the approach I've taken to implement this may be all wrong for all I know, so I don't want to get the code all done up "properly" just yet.</p>



<a name="274612511"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/deprecated_safe%20attribute/near/274612511" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> skippy <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/deprecated_safe.20attribute.html#274612511">(Mar 08 2022 at 21:50)</a>:</h4>
<p>Hi, is there a way for me to run my changes by someone to see if I'm on the right track? I'm not sure what the appropriate process is. The code isn't really review ready yet as I want to validate the approach I'm taking first.</p>
<p>The changes to support <code>Box::new(env::set_var)</code> specifically are the ones I'm least confident/have the most questions about.</p>



<a name="274614175"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/deprecated_safe%20attribute/near/274614175" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Triplett <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/deprecated_safe.20attribute.html#274614175">(Mar 08 2022 at 22:03)</a>:</h4>
<p>Do you have a sketch of the design? Not exactly an RFC, but, what the attribute is and how it works?</p>



<a name="274614200"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/deprecated_safe%20attribute/near/274614200" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Triplett <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/deprecated_safe.20attribute.html#274614200">(Mar 08 2022 at 22:03)</a>:</h4>
<p>If you haven't already, a lang MCP seems like it might be the right approach for that?</p>



<a name="274614544"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/deprecated_safe%20attribute/near/274614544" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> skippy <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/deprecated_safe.20attribute.html#274614544">(Mar 08 2022 at 22:06)</a>:</h4>
<p>Thanks! I wondered if an MCP might be right thing to do here. Would it be appropriate for me to write up a sketch of the design on the MCP itself?</p>



<a name="274614778"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/deprecated_safe%20attribute/near/274614778" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> skippy <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/deprecated_safe.20attribute.html#274614778">(Mar 08 2022 at 22:08)</a>:</h4>
<p>Oh, I think you were saying exactly that in your reply, put the design in the MCP. :) I'll get started!!</p>



<a name="274769661"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/deprecated_safe%20attribute/near/274769661" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> skippy <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/deprecated_safe.20attribute.html#274769661">(Mar 09 2022 at 23:48)</a>:</h4>
<p>I have another noobie process question. <span aria-label="blush" class="emoji emoji-1f60a" role="img" title="blush">:blush:</span> When are new MCPs usually looked at? I only ask because I've been making edits to the proposal as I think of them.</p>



<a name="274773955"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/deprecated_safe%20attribute/near/274773955" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Triplett <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/deprecated_safe.20attribute.html#274773955">(Mar 10 2022 at 00:33)</a>:</h4>
<p>Typically in the relevant team's weekly meeting.</p>



<a name="274773982"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/deprecated_safe%20attribute/near/274773982" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Triplett <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/deprecated_safe.20attribute.html#274773982">(Mar 10 2022 at 00:33)</a>:</h4>
<p>In terms of process, I'm not sure if this should be compiler or lang.</p>



<a name="274774240"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/deprecated_safe%20attribute/near/274774240" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> skippy <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/deprecated_safe.20attribute.html#274774240">(Mar 10 2022 at 00:37)</a>:</h4>
<p>Oh, is that something I should be marking/tagging appropriately on the MCP somehow?</p>



<a name="274777851"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/deprecated_safe%20attribute/near/274777851" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> simulacrum <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/deprecated_safe.20attribute.html#274777851">(Mar 10 2022 at 01:19)</a>:</h4>
<p>Different repositories, either on lang-team or compiler-team. I think in this case it's probably a lang proposal more so than compiler.</p>



<a name="274779049"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/deprecated_safe%20attribute/near/274779049" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> skippy <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/deprecated_safe.20attribute.html#274779049">(Mar 10 2022 at 01:37)</a>:</h4>
<p>Ahh, my bad. I just clicked on the "major change template" link here: <a href="https://forge.rust-lang.org/compiler/mcp.html#major-change-proposals-1">https://forge.rust-lang.org/compiler/mcp.html#major-change-proposals-1</a> and filed away.</p>
<p>It sounds like I should close &amp; refile my issue here: <a href="https://github.com/rust-lang/lang-team">https://github.com/rust-lang/lang-team</a> ?</p>



<a name="274779180"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/deprecated_safe%20attribute/near/274779180" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> skippy <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/deprecated_safe.20attribute.html#274779180">(Mar 10 2022 at 01:39)</a>:</h4>
<p>I don't see MCP as an issue option here either: <a href="https://github.com/rust-lang/compiler-team/issues/new/choose">https://github.com/rust-lang/compiler-team/issues/new/choose</a> ,  vs. <a href="https://github.com/rust-lang/compiler-team/issues/new/choose">https://github.com/rust-lang/compiler-team/issues/new/choose</a></p>
<p>If I refile my issue under lang-team with identical text, will it still get picked up as an MCP on that repo? I just don't want to do it wrong and spam a bunch of incorrect issues in there. :)</p>



<a name="274779659"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/deprecated_safe%20attribute/near/274779659" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> skippy <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/deprecated_safe.20attribute.html#274779659">(Mar 10 2022 at 01:47)</a>:</h4>
<p>Looks like initiative proposal is what I want, that template has the "major-change" label on it.</p>



<a name="274780207"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/deprecated_safe%20attribute/near/274780207" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> skippy <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/deprecated_safe.20attribute.html#274780207">(Mar 10 2022 at 01:56)</a>:</h4>
<p>Ok, I have it in the right place now on lang-team. Thanks for your help everyone and sorry for the extra noise!</p>



<hr><p>Last updated: Apr 12 2022 at 20:01 UTC</p>
</html>