<html>
<head><meta charset="utf-8"><title>Core float intrinsics for custom codegens · t-compiler · Zulip Chat Archive</title></head>
<h2>Stream: <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/index.html">t-compiler</a></h2>
<h3>Topic: <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/Core.20float.20intrinsics.20for.20custom.20codegens.html">Core float intrinsics for custom codegens</a></h3>

<hr>

<base href="https://rust-lang.zulipchat.com">

<head><link href="https://zulip-archive.rust-lang.org/style.css" rel="stylesheet"></head>

<a name="258140511"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/Core%20float%20intrinsics%20for%20custom%20codegens/near/258140511" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Riccardo D&#x27;Ambrosio <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/Core.20float.20intrinsics.20for.20custom.20codegens.html#258140511">(Oct 19 2021 at 04:43)</a>:</h4>
<p>Hello!<br>
I am currently working on a custom codegen that targets CUDA, CUDA has special libdevice intrinsics for float things, but i was wondering, why does core or build-std not have an option to expose float intrinsics that are usually only in std if the backend can generate the intrinsics? I can generate the intrinsics like powf_32 just fine, but core does not expose them (because it doesnt want to rely on libm i presume). It would be great if i could tell build-std to just expose those intrinsics because the codegen is able to generate them, maybe like `-Z build-std-features=float-intrinsics</p>



<a name="258140733"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/Core%20float%20intrinsics%20for%20custom%20codegens/near/258140733" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Riccardo D&#x27;Ambrosio <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/Core.20float.20intrinsics.20for.20custom.20codegens.html#258140733">(Oct 19 2021 at 04:47)</a>:</h4>
<p>Not having this meant i had to make a wrapper trait in my cuda_std crate which used std stuff on std and linked to raw intrinsics on non-std, which is a bit of a hack and kind of painful to write</p>



<a name="258151910"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/Core%20float%20intrinsics%20for%20custom%20codegens/near/258151910" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> bjorn3 <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/Core.20float.20intrinsics.20for.20custom.20codegens.html#258151910">(Oct 19 2021 at 07:17)</a>:</h4>
<p>These intrinsics are defined in compiler-builtins. They are only defined on some targets. For most it uses the libm from the libc implementation. There was recently a PR to enable them for an extra PR, so you may want to look at the list of merged PR's of compiler-builtins.</p>



<a name="258153579"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/Core%20float%20intrinsics%20for%20custom%20codegens/near/258153579" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Riccardo D&#x27;Ambrosio <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/Core.20float.20intrinsics.20for.20custom.20codegens.html#258153579">(Oct 19 2021 at 07:33)</a>:</h4>
<p>Hmm, i think i will  stick with this approach for now, i realized that cuda actually has some intrinsics that arent mapped directly to intrinsics, like sincos, so it may be better to directly codegen to libdevice intrinsics instead of going through the stdlib's impl, because libdevice is optimized for the GPU</p>



<hr><p>Last updated: Apr 12 2022 at 20:01 UTC</p>
</html>