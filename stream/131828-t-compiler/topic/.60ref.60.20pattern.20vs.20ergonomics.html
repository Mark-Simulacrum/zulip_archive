<html>
<head><meta charset="utf-8"><title>`ref` pattern vs ergonomics · t-compiler · Zulip Chat Archive</title></head>
<h2>Stream: <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/index.html">t-compiler</a></h2>
<h3>Topic: <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/.60ref.60.20pattern.20vs.20ergonomics.html">`ref` pattern vs ergonomics</a></h3>

<hr>

<base href="https://rust-lang.zulipchat.com">

<head><link href="https://zulip-archive.rust-lang.org/style.css" rel="stylesheet"></head>

<a name="271828924"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/%60ref%60%20pattern%20vs%20ergonomics/near/271828924" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> lcnr <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/.60ref.60.20pattern.20vs.20ergonomics.html#271828924">(Feb 14 2022 at 13:57)</a>:</h4>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="cp">#[derive(Debug)]</span><span class="w"></span>
<span class="k">struct</span> <span class="nc">Data</span><span class="p">;</span><span class="w"></span>

<span class="k">enum</span> <span class="nc">Maybe</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="n">Ref</span><span class="p">(</span><span class="o">&amp;'</span><span class="nb">static</span><span class="w"> </span><span class="n">Data</span><span class="p">),</span><span class="w"></span>
<span class="w">    </span><span class="n">Owned</span><span class="p">(</span><span class="n">Data</span><span class="p">),</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>

<span class="k">fn</span> <span class="nf">err</span><span class="p">(</span><span class="n">x</span>: <span class="nc">Maybe</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="k">match</span><span class="w"> </span><span class="n">x</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">        </span><span class="n">Maybe</span>::<span class="n">Ref</span><span class="p">(</span><span class="n">data</span><span class="p">)</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">Maybe</span>::<span class="n">Owned</span><span class="p">(</span><span class="k">ref</span><span class="w"> </span><span class="n">data</span><span class="p">)</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="fm">println!</span><span class="p">(</span><span class="s">"{:?}"</span><span class="p">,</span><span class="w"> </span><span class="n">data</span><span class="p">),</span><span class="w"></span>
<span class="w">    </span><span class="p">}</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>

<span class="k">fn</span> <span class="nf">ok</span><span class="p">(</span><span class="n">x</span>: <span class="nc">Maybe</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="k">match</span><span class="w"> </span><span class="o">&amp;</span><span class="n">x</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">        </span><span class="o">&amp;</span><span class="n">Maybe</span>::<span class="n">Ref</span><span class="p">(</span><span class="n">data</span><span class="p">)</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">Maybe</span>::<span class="n">Owned</span><span class="p">(</span><span class="n">data</span><span class="p">)</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="fm">println!</span><span class="p">(</span><span class="s">"{:?}"</span><span class="p">,</span><span class="w"> </span><span class="n">data</span><span class="p">),</span><span class="w"></span>
<span class="w">    </span><span class="p">}</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>
</code></pre></div>



<a name="271829022"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/%60ref%60%20pattern%20vs%20ergonomics/near/271829022" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> lcnr <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/.60ref.60.20pattern.20vs.20ergonomics.html#271829022">(Feb 14 2022 at 13:58)</a>:</h4>
<p>encountered this when matching on <code>hir::ExprKind::Path(ref path) | hir::ExprKind::Struct(path, _, _)</code></p>



<a name="271829096"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/%60ref%60%20pattern%20vs%20ergonomics/near/271829096" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> lcnr <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/.60ref.60.20pattern.20vs.20ergonomics.html#271829096">(Feb 14 2022 at 13:58)</a>:</h4>
<p>considering that the implicit "ref" works when using match ergonomics, is there a reason why the explicit ref is in error?</p>



<a name="271878064"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/%60ref%60%20pattern%20vs%20ergonomics/near/271878064" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Triplett <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/.60ref.60.20pattern.20vs.20ergonomics.html#271878064">(Feb 14 2022 at 19:40)</a>:</h4>
<p>Different lifetimes?</p>



<a name="271878697"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/%60ref%60%20pattern%20vs%20ergonomics/near/271878697" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> pnkfelix <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/.60ref.60.20pattern.20vs.20ergonomics.html#271878697">(Feb 14 2022 at 19:45)</a>:</h4>
<p>Hmm, I wonder if its just not allowed at all to do that. I.e. if compiler is just assuming "you couldn't possibly have meant to include a <code>ref</code> for one binding and a non-<code>ref </code> for another, even if that's <em>exactly</em> what you meant to do...</p>



<a name="271878929"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/%60ref%60%20pattern%20vs%20ergonomics/near/271878929" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> pnkfelix <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/.60ref.60.20pattern.20vs.20ergonomics.html#271878929">(Feb 14 2022 at 19:47)</a>:</h4>
<p>the fact it works when using match ergonomics probably lends some amount of credibility to my hypothesis. (To be clear: I'm saying we're looking at an insufficiently smart compiler here.)</p>



<hr><p>Last updated: Apr 12 2022 at 20:01 UTC</p>
</html>