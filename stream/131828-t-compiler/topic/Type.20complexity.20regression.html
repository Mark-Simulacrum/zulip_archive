<html>
<head><meta charset="utf-8"><title>Type complexity regression · t-compiler · Zulip Chat Archive</title></head>
<h2>Stream: <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/index.html">t-compiler</a></h2>
<h3>Topic: <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/Type.20complexity.20regression.html">Type complexity regression</a></h3>

<hr>

<base href="https://rust-lang.zulipchat.com">

<head><link href="https://zulip-archive.rust-lang.org/style.css" rel="stylesheet"></head>

<a name="249126680"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/Type%20complexity%20regression/near/249126680" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Mara <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/Type.20complexity.20regression.html#249126680">(Aug 11 2021 at 15:48)</a>:</h4>
<p>Hey compiler team!</p>
<p>We've had this issue open for a  while now: <a href="https://github.com/rust-lang/rust/issues/71359">https://github.com/rust-lang/rust/issues/71359</a></p>
<p>It's about how changes in the complexity of standard library types can cause a <code>overflow representing the type</code> error for users. This isn't really a part of the stable public api we watch for, but it does affect end users. Any ideas on what to do with this? Breaking people is not  great, but increasing the default limit every time is also not a great solution.</p>



<a name="249133574"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/Type%20complexity%20regression/near/249133574" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joshua Nelson <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/Type.20complexity.20regression.html#249133574">(Aug 11 2021 at 16:36)</a>:</h4>
<p>I don't see how there's any way to fix this, really :/ at least not without completely removing the recursion limit</p>



<a name="249133629"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/Type%20complexity%20regression/near/249133629" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joshua Nelson <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/Type.20complexity.20regression.html#249133629">(Aug 11 2021 at 16:37)</a>:</h4>
<p>I guess the compiler could special-case certain types in libstd to raise the limit just for them? but that seems hacky and prone to error</p>



<a name="249134645"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/Type%20complexity%20regression/near/249134645" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> simulacrum <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/Type.20complexity.20regression.html#249134645">(Aug 11 2021 at 16:45)</a>:</h4>
<p>A recursion limit that is per-crate - types from that crate contribute to a counter which fires at that crate's recursion limit - (with a minimum set by the currently compiling crate) may allow us to bump the limit locally to std, at least.</p>



<a name="249134796"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/Type%20complexity%20regression/near/249134796" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> simulacrum <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/Type.20complexity.20regression.html#249134796">(Aug 11 2021 at 16:46)</a>:</h4>
<p>A harder solution is to try to redesign the code to avoid a hard limit and instead try to detect progress somehow. Not possible in general, but seems like it could eliminate common cases.</p>



<a name="249138003"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/Type%20complexity%20regression/near/249138003" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> The 8472 <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/Type.20complexity.20regression.html#249138003">(Aug 11 2021 at 17:10)</a>:</h4>
<p>What about a dynamic limit? You get extra budget for each method call that's processed. That allows n + c type length growth but prevents n^c or worse</p>



<hr><p>Last updated: Apr 12 2022 at 20:01 UTC</p>
</html>