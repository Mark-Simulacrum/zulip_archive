<html>
<head><meta charset="utf-8"><title>information requested! · t-compiler · Zulip Chat Archive</title></head>
<h2>Stream: <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/index.html">t-compiler</a></h2>
<h3>Topic: <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/information.20requested!.html">information requested!</a></h3>

<hr>

<base href="https://rust-lang.zulipchat.com">

<head><link href="https://zulip-archive.rust-lang.org/style.css" rel="stylesheet"></head>

<a name="214903741"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/information%20requested%21/near/214903741" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Noah Lev <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/information.20requested!.html#214903741">(Oct 28 2020 at 22:08)</a>:</h4>
<p>If you have knowledge of the organization of the compiler crates, I would appreciate if you could comment on issue <a href="https://github.com/rust-lang/rust/issues/78503">#78503</a> "What's the difference between <code>rustc_middle::{something}</code> and <code>rustc_{something}</code>?". Thanks!</p>



<a name="214904084"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/information%20requested%21/near/214904084" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joshua Nelson <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/information.20requested!.html#214904084">(Oct 28 2020 at 22:12)</a>:</h4>
<p>There was a lot of this info in the 'making rustc_middle faster' thread</p>



<a name="214904168"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/information%20requested%21/near/214904168" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joshua Nelson <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/information.20requested!.html#214904168">(Oct 28 2020 at 22:13)</a>:</h4>
<p><a href="https://zulip-archive.rust-lang.org/131828tcompiler/54376Makingrustcmiddlefastertocompile.html">https://zulip-archive.rust-lang.org/131828tcompiler/54376Makingrustcmiddlefastertocompile.html</a></p>



<a name="214904190"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/information%20requested%21/near/214904190" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joshua Nelson <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/information.20requested!.html#214904190">(Oct 28 2020 at 22:13)</a>:</h4>
<p>But also one of the things that thread convinced me of is that splitting the crate is not sufficient and not really helpful</p>



<a name="214904210"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/information%20requested%21/near/214904210" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joshua Nelson <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/information.20requested!.html#214904210">(Oct 28 2020 at 22:13)</a>:</h4>
<p>The queries alone are 140 seconds out of the 160 second compile time</p>



<a name="214904355"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/information%20requested%21/near/214904355" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joshua Nelson <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/information.20requested!.html#214904355">(Oct 28 2020 at 22:15)</a>:</h4>
<p>I tagged some issues I thought might help on GitHub: <a href="https://github.com/rust-lang/rust/issues?q=label%3AA-query-system">https://github.com/rust-lang/rust/issues?q=label%3AA-query-system</a></p>



<a name="214904455"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/information%20requested%21/near/214904455" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Noah Lev <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/information.20requested!.html#214904455">(Oct 28 2020 at 22:16)</a>:</h4>
<p>It will help in situations where you changed <code>rustc_middle</code> but not the query system though</p>



<a name="214904463"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/information%20requested%21/near/214904463" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joshua Nelson <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/information.20requested!.html#214904463">(Oct 28 2020 at 22:16)</a>:</h4>
<p>If you want to help with compile times I think rebasing and fixing up <a href="https://github.com/rust-lang/rust/pull/78275">https://github.com/rust-lang/rust/pull/78275</a> would be a good start</p>



<a name="214904480"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/information%20requested%21/near/214904480" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joshua Nelson <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/information.20requested!.html#214904480">(Oct 28 2020 at 22:16)</a>:</h4>
<p><span class="user-mention" data-user-id="307537">@Camelid</span> there's no such thing, the query system is part of rustc middle</p>



<a name="214904501"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/information%20requested%21/near/214904501" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joshua Nelson <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/information.20requested!.html#214904501">(Oct 28 2020 at 22:16)</a>:</h4>
<p>Or rather I should say, the queries are part of rustc middle, and the queries are what take time to compile</p>



<a name="214904518"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/information%20requested%21/near/214904518" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joshua Nelson <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/information.20requested!.html#214904518">(Oct 28 2020 at 22:17)</a>:</h4>
<p><code>rustc_query_system</code> is not particularly slow</p>



<a name="214904549"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/information%20requested%21/near/214904549" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Noah Lev <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/information.20requested!.html#214904549">(Oct 28 2020 at 22:17)</a>:</h4>
<p>I'm saying if you change a part of <code>rustc_middle</code> that doesn't touch the query system, it will currently have to recompile the query system too, right?</p>



<a name="214904589"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/information%20requested%21/near/214904589" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joshua Nelson <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/information.20requested!.html#214904589">(Oct 28 2020 at 22:18)</a>:</h4>
<p>Ok, in that sense it will help.</p>



<a name="214904595"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/information%20requested%21/near/214904595" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Noah Lev <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/information.20requested!.html#214904595">(Oct 28 2020 at 22:18)</a>:</h4>
<p><span class="user-mention silent" data-user-id="232545">Joshua Nelson</span> <a href="#narrow/stream/131828-t-compiler/topic/information.20requested!/near/214904463">said</a>:</p>
<blockquote>
<p>If you want to help with compile times I think rebasing and fixing up <a href="https://github.com/rust-lang/rust/pull/78275">https://github.com/rust-lang/rust/pull/78275</a> would be a good start</p>
</blockquote>
<p>Hmm, not sure if I have enough knowledge of the query system yet to do that though</p>



<a name="214904701"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/information%20requested%21/near/214904701" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Noah Lev <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/information.20requested!.html#214904701">(Oct 28 2020 at 22:19)</a>:</h4>
<p>It does seem like <code>Ty</code> needs to be moved out first, since so much depends on it</p>



<a name="214904843"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/information%20requested%21/near/214904843" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joshua Nelson <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/information.20requested!.html#214904843">(Oct 28 2020 at 22:20)</a>:</h4>
<p>Well that's the issue, everything depends on everything else</p>



<a name="214904870"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/information%20requested%21/near/214904870" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joshua Nelson <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/information.20requested!.html#214904870">(Oct 28 2020 at 22:21)</a>:</h4>
<p>Ty depends on Depkind depends on TyCtxt depends on CrateData depends on Ty</p>



<a name="214904957"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/information%20requested%21/near/214904957" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joshua Nelson <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/information.20requested!.html#214904957">(Oct 28 2020 at 22:22)</a>:</h4>
<p>And for the amount of work it would be I'd rather reduce compile times than shuffle them around</p>



<a name="214909410"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/information%20requested%21/near/214909410" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Noah Lev <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/information.20requested!.html#214909410">(Oct 28 2020 at 23:17)</a>:</h4>
<p>Well a big reason to split them out is <em>to</em> reduce compile times</p>



<a name="214909448"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/information%20requested%21/near/214909448" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Noah Lev <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/information.20requested!.html#214909448">(Oct 28 2020 at 23:17)</a>:</h4>
<p>It would make the build more parallel and thus should improve compile times</p>



<a name="215248227"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/information%20requested%21/near/215248227" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Julian-Wollersberger <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/information.20requested!.html#215248227">(Nov 01 2020 at 15:12)</a>:</h4>
<p><span class="user-mention silent" data-user-id="232545">Joshua Nelson</span> <a href="#narrow/stream/131828-t-compiler/topic/information.20requested!/near/214904463">said</a>:</p>
<blockquote>
<p>If you want to help with compile times I think rebasing and fixing up <a href="https://github.com/rust-lang/rust/pull/78275">https://github.com/rust-lang/rust/pull/78275</a> would be a good start</p>
</blockquote>
<p>FWIW, part of the reason I closed it was that I'm not shure if the approach is even desireable.<br>
The simplification of <code>DepKind</code> that motivated it also didn't really work out.</p>



<hr><p>Last updated: Apr 12 2022 at 20:01 UTC</p>
</html>