<html>
<head><meta charset="utf-8"><title>CGU Scheduling Optimization · t-compiler · Zulip Chat Archive</title></head>
<h2>Stream: <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/index.html">t-compiler</a></h2>
<h3>Topic: <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/CGU.20Scheduling.20Optimization.html">CGU Scheduling Optimization</a></h3>

<hr>

<base href="https://rust-lang.zulipchat.com">

<head><link href="https://zulip-archive.rust-lang.org/style.css" rel="stylesheet"></head>

<a name="254953399"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/CGU%20Scheduling%20Optimization/near/254953399" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Timothy Maloney <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/CGU.20Scheduling.20Optimization.html#254953399">(Sep 26 2021 at 18:58)</a>:</h4>
<p>Hey everyone I posted this <a href="https://github.com/rust-lang/rust/issues/89281">issue</a>, I am hoping that people can leave their thoughts, questions, feedback, etc. </p>
<p>The issue provides most of the description, so I'll keep it short: There is a general solution we can use to further optimize CGU scheduling, but there are other relevant issues that need to be addressed before that can happen. I am quite green in general, so if I got something wrong or missed something please point it out so I can add it. Thanks!</p>



<a name="254954959"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/CGU%20Scheduling%20Optimization/near/254954959" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> simulacrum <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/CGU.20Scheduling.20Optimization.html#254954959">(Sep 26 2021 at 19:21)</a>:</h4>
<p>This looks pretty good. I think before we invest significantly in changes to algorithms etc, it'd be good to figure out a way to track the metrics we're aiming to optimize in <a href="http://perf.rust-lang.org">perf.rust-lang.org</a>.</p>
<p>I think, for example, we should:</p>
<ul>
<li>Encode CGU ids into the self-profile metadata so that perf can associate those with the <a href="https://perf.rust-lang.org/perf/processed-self-profile?commit=ac8dd1b2f24dc62c962172b27433106b4e84dc62&amp;base_commit=d5cd3205fd6c0817fd46c036d0f3194b7deaca93&amp;benchmark=coercions-opt&amp;run_name=full&amp;type=codegen-schedule">codegen schedules</a> and track other related metrics on a per-CGU basis</li>
<li>Encode the estimated size of each CGU into self profile (or otherwise emit it), so that we can report on how well we're doing across the perf.r-l.o metrics (e.g., is it a good estimator compared to time taken to codegen that module? Time taken to optimize that module?)<ul>
<li>I think there's also a scheduling "size" based on the <em>time</em> it takes for codegen, which may be good to include similarly here.</li>
</ul>
</li>
<li>CGU merging display (e.g., as a graph or something) on perf.r-l.o -- at the very least, we should know whether the "big" CGUs are big because of merging or because they started out so.</li>
</ul>
<p>I don't think this necessarily blocks algorithmic improvements, but I worry that without the above at least partially done we'll be a little bit walking in a forest without a map :)</p>



<a name="254959197"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/CGU%20Scheduling%20Optimization/near/254959197" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Timothy Maloney <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/CGU.20Scheduling.20Optimization.html#254959197">(Sep 26 2021 at 20:23)</a>:</h4>
<p>This is exactly the kind of response I was hoping for. I'm guessing the self-profile metadata will contain a map of CGU's to CGU ID's and per-CGU metrics can be tracked using those ID's. Do you have any suggestions/advice for tackling this or should it be pretty straightforward? I am unfamiliar with self-profile.</p>



<hr><p>Last updated: Apr 12 2022 at 20:01 UTC</p>
</html>