<html>
<head><meta charset="utf-8"><title>roadmap for 2022 discussion · t-compiler · Zulip Chat Archive</title></head>
<h2>Stream: <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/index.html">t-compiler</a></h2>
<h3>Topic: <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/roadmap.20for.202022.20discussion.html">roadmap for 2022 discussion</a></h3>

<hr>

<base href="https://rust-lang.zulipchat.com">

<head><link href="https://zulip-archive.rust-lang.org/style.css" rel="stylesheet"></head>

<a name="268705238"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/roadmap%20for%202022%20discussion/near/268705238" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> pnkfelix <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/roadmap.20for.202022.20discussion.html#268705238">(Jan 20 2022 at 15:05)</a>:</h4>
<p>this topic is for spitballing areas that we want to put on a 2022 roadmap</p>



<a name="268713379"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/roadmap%20for%202022%20discussion/near/268713379" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> pnkfelix <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/roadmap.20for.202022.20discussion.html#268713379">(Jan 20 2022 at 15:54)</a>:</h4>
<p>As usual, I’d like to see investment in our debugging support.</p>



<a name="268713431"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/roadmap%20for%202022%20discussion/near/268713431" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> pnkfelix <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/roadmap.20for.202022.20discussion.html#268713431">(Jan 20 2022 at 15:55)</a>:</h4>
<p>we don’t have enough local expertise in debuginfo formats nor in integration options with lldb/gdb.</p>



<a name="268713660"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/roadmap%20for%202022%20discussion/near/268713660" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> lcnr <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/roadmap.20for.202022.20discussion.html#268713660">(Jan 20 2022 at 15:56)</a>:</h4>
<p>"finish" large trait system features: gats, const generics, potentially marker traits</p>



<a name="268713749"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/roadmap%20for%202022%20discussion/near/268713749" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/roadmap.20for.202022.20discussion.html#268713749">(Jan 20 2022 at 15:56)</a>:</h4>
<p>Chalk things: Chalk itself (there's a list, but it's been a bit), more Chalk integration into rustc</p>



<a name="268713870"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/roadmap%20for%202022%20discussion/near/268713870" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Xavier Denis <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/roadmap.20for.202022.20discussion.html#268713870">(Jan 20 2022 at 15:57)</a>:</h4>
<p>this is somwhat selfish: open up more of the typechecker &amp; borrow checker through the rustc api. could be summarized as 'continue librarification'</p>



<a name="268713946"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/roadmap%20for%202022%20discussion/near/268713946" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> pnkfelix <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/roadmap.20for.202022.20discussion.html#268713946">(Jan 20 2022 at 15:58)</a>:</h4>
<p>I’ve definitely heard that landing Chalk would unblock a lot of things. Am I correct that it some of the things that Chalk opens up will lead to us closing some long-standing I-unsound issues, <span class="user-mention" data-user-id="232957">@Jack Huey</span> ?</p>



<a name="268713968"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/roadmap%20for%202022%20discussion/near/268713968" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> lcnr <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/roadmap.20for.202022.20discussion.html#268713968">(Jan 20 2022 at 15:58)</a>:</h4>
<p>incremental perf + stability feel fairly important to me</p>



<a name="268714026"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/roadmap%20for%202022%20discussion/near/268714026" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Aaron Hill <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/roadmap.20for.202022.20discussion.html#268714026">(Jan 20 2022 at 15:58)</a>:</h4>
<p>Related: better testing for incremental compilation</p>



<a name="268714084"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/roadmap%20for%202022%20discussion/near/268714084" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Aaron Hill <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/roadmap.20for.202022.20discussion.html#268714084">(Jan 20 2022 at 15:58)</a>:</h4>
<p>some version of 'apply to sequence of commits', and verify that the result is the same as compiling the final commit</p>



<a name="268714214"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/roadmap%20for%202022%20discussion/near/268714214" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Aaron Hill <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/roadmap.20for.202022.20discussion.html#268714214">(Jan 20 2022 at 15:59)</a>:</h4>
<p>Move NLL towards stabilization (this is blocked on review of some of my diagnostic PRs, and some unspecified change related to the leak check)</p>



<a name="268714443"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/roadmap%20for%202022%20discussion/near/268714443" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Aaron Hill <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/roadmap.20for.202022.20discussion.html#268714443">(Jan 20 2022 at 16:00)</a>:</h4>
<p>Specifically, I'm talking about turning off migration mode</p>



<a name="268714579"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/roadmap%20for%202022%20discussion/near/268714579" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> pnkfelix <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/roadmap.20for.202022.20discussion.html#268714579">(Jan 20 2022 at 16:01)</a>:</h4>
<p><span class="user-mention silent" data-user-id="125294">Aaron Hill</span> <a href="#narrow/stream/131828-t-compiler/topic/roadmap.20for.202022.20discussion/near/268714084">said</a>:</p>
<blockquote>
<p>some version of 'apply to sequence of commits', and verify that the result is the same as compiling the final commit</p>
</blockquote>
<p>My understanding is that <span class="user-mention" data-user-id="124287">@mw</span> ’s original implementation used github repos of existing rust projects to do such testing. I.e., checking that for each commit, the from-scratch build was binary identical to an incremental build against the previous commit</p>



<a name="268714732"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/roadmap%20for%202022%20discussion/near/268714732" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> pnkfelix <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/roadmap.20for.202022.20discussion.html#268714732">(Jan 20 2022 at 16:02)</a>:</h4>
<p><span class="user-mention silent" data-user-id="312719">Xavier Denis</span> <a href="#narrow/stream/131828-t-compiler/topic/roadmap.20for.202022.20discussion/near/268713870">said</a>:</p>
<blockquote>
<p>this is somwhat selfish: open up more of the typechecker &amp; borrow checker through the rustc api. could be summarized as 'continue librarification'</p>
</blockquote>
<p>I <em>think</em> leveraging Chalk more aligns with this. Unless I misunderstand what you are asking for? (And Chalk admittedly doesn’t cover borrowck)</p>



<a name="268714733"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/roadmap%20for%202022%20discussion/near/268714733" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/roadmap.20for.202022.20discussion.html#268714733">(Jan 20 2022 at 16:02)</a>:</h4>
<p><span class="user-mention silent" data-user-id="116083">pnkfelix</span> <a href="#narrow/stream/131828-t-compiler/topic/roadmap.20for.202022.20discussion/near/268713946">said</a>:</p>
<blockquote>
<p>I’ve definitely heard that landing Chalk would unblock a lot of things. Am I correct that it some of the things that Chalk opens up will lead to us closing some long-standing I-unsound issues, <span class="user-mention silent" data-user-id="232957">Jack Huey</span> ?</p>
</blockquote>
<p>Uh, in theory and in a perfect world, yes. In practice, I imagine there will be some backwards-compatibility things that will make some things tricky. There are still big "feature" holes - like specialization and const eval - that need design work. There's also more practical things to think about e.g. performance and diagnostics that haven't had much thought into them at all. So, I don't think Chalk landing as default trait solver is anywhere close. But it <em>is</em> (still) at the point that integration works. And I'd like to get more and more tests passing (that don't use unimplemented features)</p>



<a name="268714749"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/roadmap%20for%202022%20discussion/near/268714749" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Aaron Hill <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/roadmap.20for.202022.20discussion.html#268714749">(Jan 20 2022 at 16:02)</a>:</h4>
<p>Does that implementation still work with current rustc?</p>



<a name="268714762"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/roadmap%20for%202022%20discussion/near/268714762" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> pnkfelix <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/roadmap.20for.202022.20discussion.html#268714762">(Jan 20 2022 at 16:02)</a>:</h4>
<p><span class="user-mention silent" data-user-id="125294">Aaron Hill</span> <a href="#narrow/stream/131828-t-compiler/topic/roadmap.20for.202022.20discussion/near/268714749">said</a>:</p>
<blockquote>
<p>Does that implementation still work with current rustc?</p>
</blockquote>
<p>This I do not know.</p>



<a name="268714775"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/roadmap%20for%202022%20discussion/near/268714775" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/roadmap.20for.202022.20discussion.html#268714775">(Jan 20 2022 at 16:02)</a>:</h4>
<p>Yes</p>



<a name="268714820"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/roadmap%20for%202022%20discussion/near/268714820" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> pnkfelix <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/roadmap.20for.202022.20discussion.html#268714820">(Jan 20 2022 at 16:02)</a>:</h4>
<p><span class="user-mention silent" data-user-id="125294">Aaron Hill</span> <a href="#narrow/stream/131828-t-compiler/topic/roadmap.20for.202022.20discussion/near/268714749">said</a>:</p>
<blockquote>
<p>Does that implementation still work with current rustc?</p>
</blockquote>
<p><span class="user-mention" data-user-id="124287">@mw</span> ^ ? (was asking about test infra described <a href="#narrow/stream/131828-t-compiler/topic/roadmap.20for.202022.20discussion/near/268714579">here</a>)</p>



<a name="268714881"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/roadmap%20for%202022%20discussion/near/268714881" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/roadmap.20for.202022.20discussion.html#268714881">(Jan 20 2022 at 16:03)</a>:</h4>
<p><span class="user-mention silent" data-user-id="125294">Aaron Hill</span> <a href="#narrow/stream/131828-t-compiler/topic/roadmap.20for.202022.20discussion/near/268714749">said</a>:</p>
<blockquote>
<p>Does that implementation still work with current rustc?</p>
</blockquote>
<p>oh that was to a separate thing</p>



<a name="268715063"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/roadmap%20for%202022%20discussion/near/268715063" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/roadmap.20for.202022.20discussion.html#268715063">(Jan 20 2022 at 16:04)</a>:</h4>
<p><span class="user-mention silent" data-user-id="116083">pnkfelix</span> <a href="#narrow/stream/131828-t-compiler/topic/roadmap.20for.202022.20discussion/near/268714732">said</a>:</p>
<blockquote>
<p><span class="user-mention silent" data-user-id="312719">Xavier Denis</span> <a href="#narrow/stream/131828-t-compiler/topic/roadmap.20for.202022.20discussion/near/268713870">said</a>:</p>
<blockquote>
<p>this is somwhat selfish: open up more of the typechecker &amp; borrow checker through the rustc api. could be summarized as 'continue librarification'</p>
</blockquote>
<p>I <em>think</em> leveraging Chalk more aligns with this. Unless I misunderstand what you are asking for? (And Chalk admittedly doesn’t cover borrowck)</p>
</blockquote>
<p>Yes! rustc-type-ir/chalk-ir! The big blocking thing here (at least from when I've tried to move things forward) is variance of associated types</p>



<a name="268715226"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/roadmap%20for%202022%20discussion/near/268715226" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/roadmap.20for.202022.20discussion.html#268715226">(Jan 20 2022 at 16:05)</a>:</h4>
<p>In theory, Chalk can work without merging the APIs (as it does currently), but the translation layer is unfortunate</p>



<a name="268716808"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/roadmap%20for%202022%20discussion/near/268716808" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wesley Wiser <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/roadmap.20for.202022.20discussion.html#268716808">(Jan 20 2022 at 16:14)</a>:</h4>
<p><span class="user-mention silent" data-user-id="116083">pnkfelix</span> <a href="#narrow/stream/131828-t-compiler/topic/roadmap.20for.202022.20discussion/near/268713379">said</a>:</p>
<blockquote>
<p>As usual, I’d like to see investment in our debugging support.</p>
</blockquote>
<p>This is on the MS team roadmap for 2022 so it will likely be a significant focus for <span class="user-mention" data-user-id="124287">@mw</span> and I's efforts this year.</p>



<a name="268721250"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/roadmap%20for%202022%20discussion/near/268721250" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wesley Wiser <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/roadmap.20for.202022.20discussion.html#268721250">(Jan 20 2022 at 16:45)</a>:</h4>
<p>Faster compilation is a perennial favorite roadmap item as well. <span aria-label="smile" class="emoji emoji-1f642" role="img" title="smile">:smile:</span></p>



<a name="268721837"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/roadmap%20for%202022%20discussion/near/268721837" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wesley Wiser <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/roadmap.20for.202022.20discussion.html#268721837">(Jan 20 2022 at 16:49)</a>:</h4>
<p>Overall, I think I'm less concerned with <em>what</em> goes on the roadmap than on how we think that work will be accomplished. </p>
<p>I would love to see if we can find groups of people interested in working on the same things. Even if it's just two people, knowing that someone else is interested in the same thing you are makes it easier to have discussions about the feature, issues, etc and also gives you an obvious reviewer. </p>
<p>At that point, maybe we can find some "themes" in what people want to work on and put together a coherent roadmap that way.</p>



<a name="268726272"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/roadmap%20for%202022%20discussion/near/268726272" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> pnkfelix <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/roadmap.20for.202022.20discussion.html#268726272">(Jan 20 2022 at 17:18)</a>:</h4>
<p>well, the claim from <span class="user-mention" data-user-id="239881">@Josh Triplett</span> was that <em>if</em> we say “we need help with X”, we will get some amount of human resources on X</p>



<a name="268726342"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/roadmap%20for%202022%20discussion/near/268726342" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> pnkfelix <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/roadmap.20for.202022.20discussion.html#268726342">(Jan 20 2022 at 17:19)</a>:</h4>
<p>which is what drives my interesting in <em>what</em> rather than how. Or rather, the two are intertwined.</p>



<a name="268726371"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/roadmap%20for%202022%20discussion/near/268726371" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> pnkfelix <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/roadmap.20for.202022.20discussion.html#268726371">(Jan 20 2022 at 17:19)</a>:</h4>
<p>since obviously the things that would rely on newcomers need to be tasks that we can effectively mentor with low overhead</p>



<a name="268726583"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/roadmap%20for%202022%20discussion/near/268726583" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> cuviper <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/roadmap.20for.202022.20discussion.html#268726583">(Jan 20 2022 at 17:20)</a>:</h4>
<p>the foundation may have some muscle too in the grants program, if specific tasks are identified</p>



<a name="268727757"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/roadmap%20for%202022%20discussion/near/268727757" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> apiraino <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/roadmap.20for.202022.20discussion.html#268727757">(Jan 20 2022 at 17:28)</a>:</h4>
<p><span class="user-mention silent" data-user-id="125250">Wesley Wiser</span> <a href="#narrow/stream/131828-t-compiler/topic/roadmap.20for.202022.20discussion/near/268721837">said</a>:</p>
<blockquote>
<p>At that point, maybe we can find some "themes" in what people want to work on and put together a coherent roadmap that way.</p>
</blockquote>
<p>I don't know if that qualifies as a theme, but sometimes I look at the list of <a href="https://github.com/rust-lang/rust/issues?q=is%3Aopen+is%3Aissue+label%3AI-compiletime">issues labeled <code>I-compiletime</code></a> and wonder if there are "themes" that can be identified and tackled to improve on this topic. Improving compile times is maybe implicit in some of the previous comments (e.g. <span class="user-mention silent" data-user-id="216206">lcnr</span> comments).<br>
(my point of view being from someone that scrolls weekly the issue tracker)</p>



<a name="268740104"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/roadmap%20for%202022%20discussion/near/268740104" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> The 8472 <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/roadmap.20for.202022.20discussion.html#268740104">(Jan 20 2022 at 18:53)</a>:</h4>
<p>parallel compiler?</p>



<a name="268740510"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/roadmap%20for%202022%20discussion/near/268740510" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Triplett <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/roadmap.20for.202022.20discussion.html#268740510">(Jan 20 2022 at 18:56)</a>:</h4>
<p><span class="user-mention" data-user-id="116083">@pnkfelix</span> More precisely, if we say "these are our top priorities that would have substantial impact (or would be if we had enough bandwidth)", some companies looking to have a major impact in Rust will align their roadmaps accordingly.</p>



<a name="268745537"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/roadmap%20for%202022%20discussion/near/268745537" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> scottmcm <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/roadmap.20for.202022.20discussion.html#268745537">(Jan 20 2022 at 19:33)</a>:</h4>
<p>I don't know if this is "big enough", but it would be great if someone could tackle having a MIR fallback for intrinsics.  Without something like that we're going to have huge process complexity in a multiple-backend world, since every intrinsic would need to get implemented for every backend immediately.</p>



<a name="268752547"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/roadmap%20for%202022%20discussion/near/268752547" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> lqd <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/roadmap.20for.202022.20discussion.html#268752547">(Jan 20 2022 at 20:28)</a>:</h4>
<p><span class="user-mention silent" data-user-id="116083">pnkfelix</span> <a href="#narrow/stream/131828-t-compiler/topic/roadmap.20for.202022.20discussion/near/268714579">said</a>:</p>
<blockquote>
<p><span class="user-mention silent" data-user-id="125294">Aaron Hill</span> <a href="#narrow/stream/131828-t-compiler/topic/roadmap.20for.202022.20discussion/near/268714084">said</a>:</p>
<blockquote>
<p>some version of 'apply to sequence of commits', and verify that the result is the same as compiling the final commit</p>
</blockquote>
<p>My understanding is that <span class="user-mention silent" data-user-id="124287">mw</span> ’s original implementation used github repos of existing rust projects to do such testing. I.e., checking that for each commit, the from-scratch build was binary identical to an incremental build against the previous commit</p>
</blockquote>
<p>I think that was <a href="https://github.com/nikomatsakis/cargo-incremental/">https://github.com/nikomatsakis/cargo-incremental/</a> right ? I recall seeing talk about it having issues, but maybe they can fixed to help improve testing and reliability of incremental compilation</p>



<a name="268787751"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/roadmap%20for%202022%20discussion/near/268787751" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> pnkfelix <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/roadmap.20for.202022.20discussion.html#268787751">(Jan 21 2022 at 02:23)</a>:</h4>
<p><span class="user-mention silent" data-user-id="125270">scottmcm</span> <a href="#narrow/stream/131828-t-compiler/topic/roadmap.20for.202022.20discussion/near/268745537">said</a>:</p>
<blockquote>
<p>I don't know if this is "big enough", but it would be great if someone could tackle having a MIR fallback for intrinsics.  Without something like that we're going to have huge process complexity in a multiple-backend world, since every intrinsic would need to get implemented for every backend immediately.</p>
</blockquote>
<p>Is there an issue associated with this request on rust repo?</p>



<a name="268790827"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/roadmap%20for%202022%20discussion/near/268790827" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> scottmcm <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/roadmap.20for.202022.20discussion.html#268790827">(Jan 21 2022 at 03:14)</a>:</h4>
<p>I don't know of one, <span class="user-mention" data-user-id="116083">@pnkfelix</span>, so I just wrote up <a href="https://github.com/rust-lang/rust/issues/93145">https://github.com/rust-lang/rust/issues/93145</a></p>



<a name="268790958"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/roadmap%20for%202022%20discussion/near/268790958" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> pnkfelix <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/roadmap.20for.202022.20discussion.html#268790958">(Jan 21 2022 at 03:17)</a>:</h4>
<p>(I just realized it probably belongs in MCP process. But I can port it over there.)</p>



<a name="268792765"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/roadmap%20for%202022%20discussion/near/268792765" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> scottmcm <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/roadmap.20for.202022.20discussion.html#268792765">(Jan 21 2022 at 03:53)</a>:</h4>
<p>Agree, but I can't commit to working on it so it didn't seem like something I should put in MCP, since AFAIK those get announced immediately, no?</p>



<a name="268827308"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/roadmap%20for%202022%20discussion/near/268827308" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> rylev <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/roadmap.20for.202022.20discussion.html#268827308">(Jan 21 2022 at 11:11)</a>:</h4>
<p>FYI: we also have some survey data that could potentially be useful for this discussion. We likely won't have time to make a well formed report in time to help with this discussion, but perhaps <span class="user-mention" data-user-id="256841">@Nick Cameron</span> and I can work finding data that would be useful for this discussion.</p>



<a name="268827372"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/roadmap%20for%202022%20discussion/near/268827372" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> rylev <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/roadmap.20for.202022.20discussion.html#268827372">(Jan 21 2022 at 11:11)</a>:</h4>
<p>(unfortunately, we don't currently have a way to give folks access to raw aggregate data as it's mixed with PII which would require signing an NDA and which we naturally want to limit)</p>



<a name="269378667"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/roadmap%20for%202022%20discussion/near/269378667" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> mw <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/roadmap.20for.202022.20discussion.html#269378667">(Jan 26 2022 at 08:53)</a>:</h4>
<p><span class="user-mention silent" data-user-id="116083">pnkfelix</span> <a href="#narrow/stream/131828-t-compiler/topic/roadmap.20for.202022.20discussion/near/268714820">said</a>:</p>
<blockquote>
<p><span class="user-mention silent" data-user-id="125294">Aaron Hill</span> <a href="#narrow/stream/131828-t-compiler/topic/roadmap.20for.202022.20discussion/near/268714749">said</a>:</p>
<blockquote>
<p>Does that implementation still work with current rustc?</p>
</blockquote>
<p><span class="user-mention silent" data-user-id="124287">mw</span> ^ ? (was asking about test infra described <a href="#narrow/stream/131828-t-compiler/topic/roadmap.20for.202022.20discussion/near/268714579">here</a>)</p>
</blockquote>
<p>We'd need to try. IIRC, we added some knobs to rustc to allow generating the exact same object files in incremental and non-incremental mode. Since the tool (<a href="https://github.com/nikomatsakis/cargo-incremental">https://github.com/nikomatsakis/cargo-incremental</a>) has not been used for a few years now, it's quite possible that those knobs have been removed.</p>



<a name="269379622"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/roadmap%20for%202022%20discussion/near/269379622" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> davidtwco <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/roadmap.20for.202022.20discussion.html#269379622">(Jan 26 2022 at 09:01)</a>:</h4>
<p><span class="user-mention silent" data-user-id="125250">Wesley Wiser</span> <a href="#narrow/stream/131828-t-compiler/topic/roadmap.20for.202022.20discussion/near/268716808">said</a>:</p>
<blockquote>
<p><span class="user-mention silent" data-user-id="116083">pnkfelix</span> <a href="#narrow/stream/131828-t-compiler/topic/roadmap.20for.202022.20discussion/near/268713379">said</a>:</p>
<blockquote>
<p>As usual, I’d like to see investment in our debugging support.</p>
</blockquote>
<p>This is on the MS team roadmap for 2022 so it will likely be a significant focus for <span class="user-mention silent" data-user-id="124287">mw</span> and I's efforts this year.</p>
</blockquote>
<p>This is something I'm hoping to spend some time on this year too, I enjoyed working on Split DWARF so will likely be picking up tasks in this area.</p>



<a name="269417360"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/roadmap%20for%202022%20discussion/near/269417360" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> mw <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/roadmap.20for.202022.20discussion.html#269417360">(Jan 26 2022 at 14:14)</a>:</h4>
<p><span class="user-mention silent" data-user-id="116107">davidtwco</span> <a href="#narrow/stream/131828-t-compiler/topic/roadmap.20for.202022.20discussion/near/269379622">said</a>:</p>
<blockquote>
<p>This is something I'm hoping to spend some time on this year too, I enjoyed working on Split DWARF so will likely be picking up tasks in this area.</p>
</blockquote>
<p>Nice! :)</p>



<a name="269423015"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/roadmap%20for%202022%20discussion/near/269423015" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wesley Wiser <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/roadmap.20for.202022.20discussion.html#269423015">(Jan 26 2022 at 14:50)</a>:</h4>
<p>Awesome! Sounds like there is a fair amount of interest in debugging so perhaps we should try to spin up a working group and coordinate our efforts?</p>



<a name="269441454"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/roadmap%20for%202022%20discussion/near/269441454" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> pnkfelix <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/roadmap.20for.202022.20discussion.html#269441454">(Jan 26 2022 at 16:39)</a>:</h4>
<p>I think it sounds like we have a number of people who have both time and interest in driving debugging efforts forward, yes!</p>



<a name="269441649"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/roadmap%20for%202022%20discussion/near/269441649" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> pnkfelix <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/roadmap.20for.202022.20discussion.html#269441649">(Jan 26 2022 at 16:40)</a>:</h4>
<p>And I’ve been in conversations with <span class="user-mention" data-user-id="473134">@Greg Clayton</span> , one of the original authors of LLDB. They have a lot of interest in making the Rust+lldb experience better</p>



<a name="269441796"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/roadmap%20for%202022%20discussion/near/269441796" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> pnkfelix <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/roadmap.20for.202022.20discussion.html#269441796">(Jan 26 2022 at 16:41)</a>:</h4>
<p>(it also seems like a wg-debugging may mesh well with certain other efforts, such as the <a href="https://github.com/rust-lang/async-crashdump-debugging-initiative">async crashdump initiative</a> that <span class="user-mention" data-user-id="124287">@mw</span> is driving.)</p>



<a name="269462325"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/roadmap%20for%202022%20discussion/near/269462325" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> pnkfelix <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/roadmap.20for.202022.20discussion.html#269462325">(Jan 26 2022 at 18:53)</a>:</h4>
<p><span class="user-mention silent" data-user-id="125294">Aaron Hill</span> <a href="#narrow/stream/131828-t-compiler/topic/roadmap.20for.202022.20discussion/near/268714214">said</a>:</p>
<blockquote>
<p>Move NLL towards stabilization (this is blocked on review of some of my diagnostic PRs, and some unspecified change related to the leak check)</p>
</blockquote>
<p>by the way, <span class="user-mention" data-user-id="125294">@Aaron Hill</span> , would you be willing to summarize the status here at the top of <a href="https://github.com/rust-lang/rust/issues/43234">#43234</a> (the NLL tracking issue) ? I think its fair to say that people who are not currently in the weeds of NLL find it hard to determine what the open remaining problems are.</p>



<a name="269517652"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/roadmap%20for%202022%20discussion/near/269517652" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> davidtwco <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/roadmap.20for.202022.20discussion.html#269517652">(Jan 27 2022 at 02:21)</a>:</h4>
<p><span class="user-mention silent" data-user-id="125250">Wesley Wiser</span> <a href="#narrow/stream/131828-t-compiler/topic/roadmap.20for.202022.20discussion/near/269423015">said</a>:</p>
<blockquote>
<p>Awesome! Sounds like there is a fair amount of interest in debugging so perhaps we should try to spin up a working group and coordinate our efforts?</p>
</blockquote>
<p>That sounds like a great idea.</p>



<a name="269682208"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/roadmap%20for%202022%20discussion/near/269682208" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> f-87 <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/roadmap.20for.202022.20discussion.html#269682208">(Jan 28 2022 at 03:34)</a>:</h4>
<p><span class="user-mention silent" data-user-id="116107">davidtwco</span> <a href="#narrow/stream/131828-t-compiler/topic/roadmap.20for.202022.20discussion/near/269517652">said</a>:</p>
<blockquote>
<p><span class="user-mention silent" data-user-id="125250">Wesley Wiser</span> <a href="#narrow/stream/131828-t-compiler/topic/roadmap.20for.202022.20discussion/near/269423015">said</a>:</p>
<blockquote>
<p>Awesome! Sounds like there is a fair amount of interest in debugging so perhaps we should try to spin up a working group and coordinate our efforts?</p>
</blockquote>
<p>That sounds like a great idea.</p>
</blockquote>
<p>I am new to Rust, and love to help with debugging and testing as well : )</p>



<a name="269713118"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/roadmap%20for%202022%20discussion/near/269713118" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> mw <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/roadmap.20for.202022.20discussion.html#269713118">(Jan 28 2022 at 10:10)</a>:</h4>
<p>I think a wg-debuginfo would be great for improving a number of things:</p>
<ul>
<li>Coordination with debuginfo consumers (debuggers and other tooling), especially around changes to what the compiler emits</li>
<li>More stable testing of various debuggers in CI</li>
<li>Direct testing of the DWARF debuginfo we generate (in a format that serves as actual documentation)</li>
<li>Discussion of what debuginfo should ideally look like at some point (i.e. what updates we would want to propose to DWARF at some point)</li>
<li>Discussion of debugging support beyond classic debuginfo</li>
</ul>



<a name="269956408"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/roadmap%20for%202022%20discussion/near/269956408" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nnethercote <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/roadmap.20for.202022.20discussion.html#269956408">(Jan 30 2022 at 20:48)</a>:</h4>
<p>A fix for <a href="https://github.com/rust-lang/rust/issues/65487">#65487</a> would be wonderful, along these lines <span aria-label="smile" class="emoji emoji-1f642" role="img" title="smile">:smile:</span></p>



<a name="269956490"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/roadmap%20for%202022%20discussion/near/269956490" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> bjorn3 <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/roadmap.20for.202022.20discussion.html#269956490">(Jan 30 2022 at 20:50)</a>:</h4>
<p>Could those be DUMMY_SPAN?</p>



<a name="269956518"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/roadmap%20for%202022%20discussion/near/269956518" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nnethercote <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/roadmap.20for.202022.20discussion.html#269956518">(Jan 30 2022 at 20:51)</a>:</h4>
<p>I don't know what DUMMY_SPAN is</p>



<a name="269956604"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/roadmap%20for%202022%20discussion/near/269956604" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> bjorn3 <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/roadmap.20for.202022.20discussion.html#269956604">(Jan 30 2022 at 20:52)</a>:</h4>
<p>Never mind. Just read the issue discussion and it seems to not be coming from rustc, but from llvm.</p>



<a name="269956629"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/roadmap%20for%202022%20discussion/near/269956629" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> bjorn3 <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/roadmap.20for.202022.20discussion.html#269956629">(Jan 30 2022 at 20:53)</a>:</h4>
<p>DUMMY_SPAN is a <code>rustc_span::Span</code> that can be used when there is no sensible <code>Span</code> for something.</p>



<a name="269958232"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/roadmap%20for%202022%20discussion/near/269958232" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nnethercote <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/roadmap.20for.202022.20discussion.html#269958232">(Jan 30 2022 at 21:20)</a>:</h4>
<p>Oh right, I thought it was a DWARF thing</p>



<a name="270249777"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/roadmap%20for%202022%20discussion/near/270249777" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> pnkfelix <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/roadmap.20for.202022.20discussion.html#270249777">(Feb 01 2022 at 17:20)</a>:</h4>
<p><span class="user-mention silent" data-user-id="125270">scottmcm</span> <a href="#narrow/stream/131828-t-compiler/topic/roadmap.20for.202022.20discussion/near/268792765">said</a>:</p>
<blockquote>
<p>Agree, but I can't commit to working on it so it didn't seem like something I should put in MCP, since AFAIK those get announced immediately, no?</p>
</blockquote>
<p>Well, much like RFC’s, the proposal gets announced and then spends some time in limbo while people discuss it (or fail to discuss it). Its not something that would need to be rushed. And furthermore, the act of proposing it and getting it seconded might encourage a contributor to try their hand at implementing it, <em>especially</em> if you volunteered to mentor someone on it, rather than try to implement it yourself.</p>



<a name="270256909"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/roadmap%20for%202022%20discussion/near/270256909" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Riccardo D&#x27;Ambrosio <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/roadmap.20for.202022.20discussion.html#270256909">(Feb 01 2022 at 18:01)</a>:</h4>
<p>Support in rustc for switching to a specific built-in codegen backend with a simple flag, better ways to pass args to codegen backends (llvm-args, pain), overall just better custom codegen backend support. And naturally my own personal goal of upstreaming cg_cuda :)</p>



<a name="270257738"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/roadmap%20for%202022%20discussion/near/270257738" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> bjorn3 <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/roadmap.20for.202022.20discussion.html#270257738">(Feb 01 2022 at 18:05)</a>:</h4>
<blockquote>
<p>Support in rustc for switching to a specific built-in codegen backend with a simple flag</p>
</blockquote>
<p>That is <code>-Zcodegen-backend</code> already. Even has cargo support for builtin backends. (external backends aren't allowed)</p>



<a name="270257952"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/roadmap%20for%202022%20discussion/near/270257952" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Riccardo D&#x27;Ambrosio <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/roadmap.20for.202022.20discussion.html#270257952">(Feb 01 2022 at 18:06)</a>:</h4>
<p>ah since when does cargo have support for that? i didnt notice</p>



<a name="270258080"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/roadmap%20for%202022%20discussion/near/270258080" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> bjorn3 <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/roadmap.20for.202022.20discussion.html#270258080">(Feb 01 2022 at 18:07)</a>:</h4>
<p><a href="https://github.com/rust-lang/cargo/pull/9118">https://github.com/rust-lang/cargo/pull/9118</a></p>



<a name="270258231"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/roadmap%20for%202022%20discussion/near/270258231" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> bjorn3 <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/roadmap.20for.202022.20discussion.html#270258231">(Feb 01 2022 at 18:08)</a>:</h4>
<p>It is per-profile though as I wanted for cg_clif, and not per-target like you would probably want for cg_cuda.</p>



<a name="270258331"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/roadmap%20for%202022%20discussion/near/270258331" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Riccardo D&#x27;Ambrosio <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/roadmap.20for.202022.20discussion.html#270258331">(Feb 01 2022 at 18:08)</a>:</h4>
<p>Yeah eventually we'd want per-target codegen support, but initially making it opt-in is fine</p>



<a name="271223491"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/roadmap%20for%202022%20discussion/near/271223491" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Aaron Hill <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/roadmap.20for.202022.20discussion.html#271223491">(Feb 09 2022 at 02:41)</a>:</h4>
<p>It looks like NLL stabilization didn't make it into the hackmd - was that intentional?</p>



<a name="271225296"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/roadmap%20for%202022%20discussion/near/271225296" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> pnkfelix <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/roadmap.20for.202022.20discussion.html#271225296">(Feb 09 2022 at 03:12)</a>:</h4>
<p>I think I took it out because I wasn't sure how best to describe it, in terms of how to get people to understand what value it will provide</p>



<a name="271225356"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/roadmap%20for%202022%20discussion/near/271225356" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> pnkfelix <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/roadmap.20for.202022.20discussion.html#271225356">(Feb 09 2022 at 03:13)</a>:</h4>
<p>but oh I now see you say you've started filling in the status on <a href="https://github.com/rust-lang/rust/issues/43234">#43234</a> ?</p>



<a name="271225474"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/roadmap%20for%202022%20discussion/near/271225474" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> pnkfelix <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/roadmap.20for.202022.20discussion.html#271225474">(Feb 09 2022 at 03:14)</a>:</h4>
<p>(I have to admit, I'm also not sure whether it ends up being a cross-cutting issue with lang-team. I don't remember off hand where we landed on two-phase borrows.)</p>



<a name="271225528"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/roadmap%20for%202022%20discussion/near/271225528" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> pnkfelix <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/roadmap.20for.202022.20discussion.html#271225528">(Feb 09 2022 at 03:15)</a>:</h4>
<p>Ah, are there still crates relying on <code>#[feature(nll)]</code> ?</p>



<a name="271225533"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/roadmap%20for%202022%20discussion/near/271225533" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> pnkfelix <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/roadmap.20for.202022.20discussion.html#271225533">(Feb 09 2022 at 03:15)</a>:</h4>
<p>that would be a way to sell it</p>



<a name="271225633"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/roadmap%20for%202022%20discussion/near/271225633" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> pnkfelix <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/roadmap.20for.202022.20discussion.html#271225633">(Feb 09 2022 at 03:16)</a>:</h4>
<p>okay, I see much dialogue from end of last year in issue <a href="https://github.com/rust-lang/rust/issues/58781">#58781</a></p>



<a name="271225664"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/roadmap%20for%202022%20discussion/near/271225664" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> pnkfelix <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/roadmap.20for.202022.20discussion.html#271225664">(Feb 09 2022 at 03:17)</a>:</h4>
<p><span class="user-mention" data-user-id="125294">@Aaron Hill</span> would you call this an Aspirational goal, or one that you think we have resources already allocated to land this year? I'm currently thinking its Aspirational.</p>



<a name="271226080"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/roadmap%20for%202022%20discussion/near/271226080" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Aaron Hill <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/roadmap.20for.202022.20discussion.html#271226080">(Feb 09 2022 at 03:26)</a>:</h4>
<p>The major unknown is 'the leak check'</p>



<a name="271226100"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/roadmap%20for%202022%20discussion/near/271226100" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Aaron Hill <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/roadmap.20for.202022.20discussion.html#271226100">(Feb 09 2022 at 03:26)</a>:</h4>
<p>I believe <span class="user-mention" data-user-id="116009">@nikomatsakis</span> said that there needs to be further integration of the leak check into NLL, but I'm not really sure what that means :)</p>



<a name="271226113"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/roadmap%20for%202022%20discussion/near/271226113" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Aaron Hill <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/roadmap.20for.202022.20discussion.html#271226113">(Feb 09 2022 at 03:27)</a>:</h4>
<p>Other than that, I think things are looking pretty good</p>



<a name="271226124"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/roadmap%20for%202022%20discussion/near/271226124" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Aaron Hill <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/roadmap.20for.202022.20discussion.html#271226124">(Feb 09 2022 at 03:27)</a>:</h4>
<p>My opaque type diag PR is in the merge queue</p>



<a name="271226151"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/roadmap%20for%202022%20discussion/near/271226151" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Aaron Hill <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/roadmap.20for.202022.20discussion.html#271226151">(Feb 09 2022 at 03:27)</a>:</h4>
<p>which should eliminate the last of the 'higher-ranked subtype' error messages in favor of more descriptive errors on par with migrate mode</p>



<a name="271248995"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/roadmap%20for%202022%20discussion/near/271248995" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> lqd <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/roadmap.20for.202022.20discussion.html#271248995">(Feb 09 2022 at 09:22)</a>:</h4>
<p><span class="user-mention silent" data-user-id="116083">pnkfelix</span> <a href="#narrow/stream/131828-t-compiler/topic/roadmap.20for.202022.20discussion/near/271225474">said</a>:</p>
<blockquote>
<p>(I have to admit, I'm also not sure whether it ends up being a cross-cutting issue with lang-team. I don't remember off hand where we landed on two-phase borrows.)</p>
</blockquote>
<p>the 2PB and <code>mutable_borrow_reservation_conflict</code> lint don't seem to be a blocker for turning off the migrate mode indeed. So there's probably still some diagnostics to check (and the worse case of that was the higher-ranked subtype error blocker, and that's fixed thanks to aaron &amp; matthew) that would be blockers for esteban, and the leak check + <a href="https://github.com/rust-lang/rust/issues/73154">#73154</a> area that could need some clarification from Niko.</p>



<a name="271286294"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/roadmap%20for%202022%20discussion/near/271286294" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/roadmap.20for.202022.20discussion.html#271286294">(Feb 09 2022 at 14:33)</a>:</h4>
<p>I'd also really like to push to get NLL fully stabilized. I think probably the best way to move forward is to schedule a meeting with <span class="user-mention" data-user-id="116009">@nikomatsakis</span> to ensure some sync time to talk about this :)</p>



<a name="271294685"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/roadmap%20for%202022%20discussion/near/271294685" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> pnkfelix <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/roadmap.20for.202022.20discussion.html#271294685">(Feb 09 2022 at 15:28)</a>:</h4>
<p>okay. Lets make sure NLL gets back on the roadmap then. The decision about whether its an Initiative or Aspirational will need to be resolved via a conversation with <span class="user-mention" data-user-id="116009">@nikomatsakis</span></p>



<a name="271488480"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/roadmap%20for%202022%20discussion/near/271488480" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nnethercote <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/roadmap.20for.202022.20discussion.html#271488480">(Feb 10 2022 at 20:18)</a>:</h4>
<p>NLL isn't fully stabilized?</p>



<a name="271488716"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/roadmap%20for%202022%20discussion/near/271488716" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> bstrie <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/roadmap.20for.202022.20discussion.html#271488716">(Feb 10 2022 at 20:20)</a>:</h4>
<p>I believe that's referring to <a href="https://github.com/rust-lang/rust/issues/57895">https://github.com/rust-lang/rust/issues/57895</a></p>



<a name="271490954"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/roadmap%20for%202022%20discussion/near/271490954" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wesley Wiser <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/roadmap.20for.202022.20discussion.html#271490954">(Feb 10 2022 at 20:39)</a>:</h4>
<p>Cross posting for visibility:</p>
<p><span class="user-mention silent" data-user-id="116083">pnkfelix</span> <a href="#narrow/stream/238009-t-compiler.2Fmeetings/topic/.5Bweekly.5D.202022-02-10.20.2354818/near/271452969">said</a>:</p>
<blockquote>
<blockquote>
<p>Hi y'all, T-compiler and T-compiler-contributors!</p>
<p>As mentioned in Zulip recently, Wesley and I have been trying to put together a document laying out the team's thoughts on initiatives for this year.</p>
<p>Here's the draft:</p>
<p><a href="https://hackmd.io/Hrl30lX9Q0mbLIT4VkR_UA?view">https://hackmd.io/Hrl30lX9Q0mbLIT4VkR_UA?view</a></p>
<p>As noted in the doc, our intent is to post this on the Inside Rust blog in the near future, circa February 18th. You can consider it an early preview; we want feedback from the members of T-compiler and T-compiler-contributors before we circulate it more broadly.</p>
<p>You can post feedback as a hackmd margin comment, or or send us an email, or write in a Zulip thread ( <a class="stream-topic" data-stream-id="131828" href="/#narrow/stream/131828-t-compiler/topic/roadmap.20for.202022.20discussion">#t-compiler &gt; roadmap for 2022 discussion</a> )</p>
<p>Looking forward to what you all think!</p>
<p>Cheers,<br>
Felix and Wesley</p>
</blockquote>
</blockquote>
<p><span class="user-group-mention" data-user-group-id="492">@T-compiler</span> and compiler-contributors should have received an email from Felix.</p>



<a name="271491064"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/roadmap%20for%202022%20discussion/near/271491064" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wesley Wiser <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/roadmap.20for.202022.20discussion.html#271491064">(Feb 10 2022 at 20:40)</a>:</h4>
<p>Please give the HackMD a read. We're happy to take suggestions and feedback on this proposed roadmap!</p>



<a name="271491152"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/roadmap%20for%202022%20discussion/near/271491152" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wesley Wiser <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/roadmap.20for.202022.20discussion.html#271491152">(Feb 10 2022 at 20:41)</a>:</h4>
<p>Especially if there is something important you know is being worked on and isn't mentioned, we should make sure it's been considered for inclusion.</p>



<a name="271501814"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/roadmap%20for%202022%20discussion/near/271501814" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Triplett <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/roadmap.20for.202022.20discussion.html#271501814">(Feb 10 2022 at 22:03)</a>:</h4>
<p><span class="user-mention" data-user-id="120989">@nnethercote</span> AIUI, NLL is stable and shipped and the default, but the non-NLL mode is still in the compiler for a few reasons.</p>



<a name="271502032"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/roadmap%20for%202022%20discussion/near/271502032" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> pnkfelix <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/roadmap.20for.202022.20discussion.html#271502032">(Feb 10 2022 at 22:05)</a>:</h4>
<p>For more details, see: <a href="https://github.com/rust-lang/rust/issues/58781">https://github.com/rust-lang/rust/issues/58781</a></p>



<a name="271502399"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/roadmap%20for%202022%20discussion/near/271502399" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Triplett <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/roadmap.20for.202022.20discussion.html#271502399">(Feb 10 2022 at 22:08)</a>:</h4>
<p><span class="user-mention" data-user-id="116083">@pnkfelix</span> Is that "unsettled question" still unsettled, or is it just that we need to figure out what to do as a result?</p>



<a name="271502458"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/roadmap%20for%202022%20discussion/near/271502458" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> pnkfelix <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/roadmap.20for.202022.20discussion.html#271502458">(Feb 10 2022 at 22:09)</a>:</h4>
<p><span class="user-mention silent" data-user-id="116113">lqd</span> <a href="#narrow/stream/131828-t-compiler/topic/roadmap.20for.202022.20discussion/near/271248995">said</a>:</p>
<blockquote>
<p><span class="user-mention silent" data-user-id="116083">pnkfelix</span> <a href="#narrow/stream/131828-t-compiler/topic/roadmap.20for.202022.20discussion/near/271225474">said</a>:</p>
<blockquote>
<p>(I have to admit, I'm also not sure whether it ends up being a cross-cutting issue with lang-team. I don't remember off hand where we landed on two-phase borrows.)</p>
</blockquote>
<p>the 2PB and <code>mutable_borrow_reservation_conflict</code> lint don't seem to be a blocker for turning off the migrate mode indeed. [...]</p>
</blockquote>
<p>^ <span class="user-mention" data-user-id="239881">@Josh Triplett</span></p>



<a name="271502518"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/roadmap%20for%202022%20discussion/near/271502518" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> pnkfelix <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/roadmap.20for.202022.20discussion.html#271502518">(Feb 10 2022 at 22:09)</a>:</h4>
<p>i.e., my <em>understanding</em> is that two-phase borrows are not settled, but also do not block turning off migrate mode</p>



<a name="271502710"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/roadmap%20for%202022%20discussion/near/271502710" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> pnkfelix <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/roadmap.20for.202022.20discussion.html#271502710">(Feb 10 2022 at 22:11)</a>:</h4>
<p>the comment thread for <a href="https://github.com/rust-lang/rust/issues/56254">#56254</a> has pretty good discussion of the issues around two-phase borrows.</p>



<a name="271537449"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/roadmap%20for%202022%20discussion/near/271537449" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Heisenberg <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/roadmap.20for.202022.20discussion.html#271537449">(Feb 11 2022 at 06:46)</a>:</h4>
<p><span class="user-mention silent" data-user-id="116083">pnkfelix</span> <a href="#narrow/stream/131828-t-compiler/topic/roadmap.20for.202022.20discussion/near/268713431">said</a>:</p>
<blockquote>
<p>we don’t have enough local expertise in debuginfo formats nor in integration options with lldb/gdb.</p>
</blockquote>
<p><span class="user-mention silent" data-user-id="124287">mw</span> <a href="#narrow/stream/131828-t-compiler/topic/roadmap.20for.202022.20discussion/near/269713118">said</a>:</p>
<blockquote>
<p>I think a wg-debuginfo would be great for improving a number of things:</p>
<ul>
<li>Coordination with debuginfo consumers (debuggers and other tooling), especially around changes to what the compiler emits</li>
<li>More stable testing of various debuggers in CI</li>
<li>Direct testing of the DWARF debuginfo we generate (in a format that serves as actual documentation)</li>
<li>Discussion of what debuginfo should ideally look like at some point (i.e. what updates we would want to propose to DWARF at some point)</li>
<li>Discussion of debugging support beyond classic debuginfo</li>
</ul>
</blockquote>
<p>Recently I was learning <code>gdb</code> debugging. Seeing how the new working group is being discussed, I would like to offer a few suggestions.</p>
<ol>
<li>
<p>I think <code>RUSTFLAGS='-C link-arg=-s' cargo build --release</code> should preserve symbol information for subsequent debugging. <code>https://github.com/rust-lang/rust/issues/93406</code></p>
</li>
<li>
<p>In my work, I sometimes need to debug a process when the process is uninterrupted (release mode). But it doesn't seem to be possible to debug the release mode right now, as I asked here: <code>https://users.rust-lang.org/t/how-do-i-use-the-gdb-to-debug-the-release-service-process/71617</code></p>
</li>
</ol>



<a name="271855887"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/roadmap%20for%202022%20discussion/near/271855887" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> pnkfelix <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/roadmap.20for.202022.20discussion.html#271855887">(Feb 14 2022 at 17:00)</a>:</h4>
<p>by the way, I'll be reaching out to people 1:1 about this, but as a general note: Some contributors who are mentioned by username in the doc are given time by their employer to work on Rust. And some subset of those contributors (and their employer) would <em>like it</em> if the employer's name were mentioned in tandem with the contributor.</p>



<a name="271856315"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/roadmap%20for%202022%20discussion/near/271856315" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> pnkfelix <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/roadmap.20for.202022.20discussion.html#271856315">(Feb 14 2022 at 17:03)</a>:</h4>
<p>So, like I said: I'll be reaching out 1:1 to each person mentioned to ask them if they want their employer's name written next to where they are mentioned, potentially under specific initiatives. (E.g. something like "improving Rust's debuginfo quality (mw, wesleywiser, both at Microsoft)")</p>



<a name="271856785"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/roadmap%20for%202022%20discussion/near/271856785" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> pnkfelix <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/roadmap.20for.202022.20discussion.html#271856785">(Feb 14 2022 at 17:07)</a>:</h4>
<p>(linking to a sponsorship page is another obvious thing I can do for those who have one.)</p>



<a name="271997774"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/roadmap%20for%202022%20discussion/near/271997774" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> bstrie <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/roadmap.20for.202022.20discussion.html#271997774">(Feb 15 2022 at 16:17)</a>:</h4>
<p><span class="user-mention silent" data-user-id="116083">pnkfelix</span> <a href="#narrow/stream/131828-t-compiler/topic/roadmap.20for.202022.20discussion/near/271855887">said</a>:</p>
<blockquote>
<p>by the way, I'll be reaching out to people 1:1 about this, but as a general note: Some contributors who are mentioned by username in the doc are given time by their employer to work on Rust. And some subset of those contributors (and their employer) would <em>like it</em> if the employer's name were mentioned in tandem with the contributor.</p>
</blockquote>
<p>To what degree is this document only for people on T-compiler? Because my boss is highly motivated to allot some of my time to polishing certain Rust features, is that something that you want to note or would that be noise? Maybe that would be better for a broader "Rust in 2022" document that isn't tightly-scoped to T-compiler?</p>



<a name="272162588"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/roadmap%20for%202022%20discussion/near/272162588" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> pnkfelix <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/roadmap.20for.202022.20discussion.html#272162588">(Feb 16 2022 at 19:04)</a>:</h4>
<p>The audience is going to be anyone interested in what's happening in the compiler, especially people who can help with that.</p>



<a name="272162627"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/roadmap%20for%202022%20discussion/near/272162627" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> pnkfelix <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/roadmap.20for.202022.20discussion.html#272162627">(Feb 16 2022 at 19:05)</a>:</h4>
<p>but I deliberately did not want to try to tackle questions in T-lang nor T-libs</p>



<a name="272162652"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/roadmap%20for%202022%20discussion/near/272162652" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> pnkfelix <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/roadmap.20for.202022.20discussion.html#272162652">(Feb 16 2022 at 19:05)</a>:</h4>
<p>because it took long enough to make this doc with the "narrow" scope that it already has</p>



<a name="272162965"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/roadmap%20for%202022%20discussion/near/272162965" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> simulacrum <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/roadmap.20for.202022.20discussion.html#272162965">(Feb 16 2022 at 19:07)</a>:</h4>
<p>Just a note -- <span class="user-mention" data-user-id="120989">@nnethercote</span> has started throwing together a roadmap doc for perf wg (<a href="https://hackmd.io/YJQSj_nLSZWl2sbI84R1qA">https://hackmd.io/YJQSj_nLSZWl2sbI84R1qA</a>), might be interesting for folks to take a look at</p>



<a name="272162966"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/roadmap%20for%202022%20discussion/near/272162966" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> pnkfelix <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/roadmap.20for.202022.20discussion.html#272162966">(Feb 16 2022 at 19:07)</a>:</h4>
<p><span class="user-mention" data-user-id="256342">@bstrie</span> the "polishing certain Rust features", I assume you're talking about features that are not covered on this list somewhere? Are we talking about language design stuff that really belongs with T-lang? Or are you just saying "there's a feature that's been approved to be implemented, and I'd like to work on it, and I'll have an easier time getting support to work on it if it is included in a document like this" ?</p>



<a name="272722040"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/roadmap%20for%202022%20discussion/near/272722040" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> simulacrum <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/roadmap.20for.202022.20discussion.html#272722040">(Feb 21 2022 at 18:31)</a>:</h4>
<p><span class="user-mention" data-user-id="116083">@pnkfelix</span> <span class="user-mention" data-user-id="125250">@Wesley Wiser</span> I am looking at the draft here in light of today's discussion on disabling incremental for 1.59 and I feel like we might need/should say something about the stability of incremental</p>



<a name="272722119"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/roadmap%20for%202022%20discussion/near/272722119" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> simulacrum <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/roadmap.20for.202022.20discussion.html#272722119">(Feb 21 2022 at 18:32)</a>:</h4>
<p>There's an aspirations section on <em>improving</em> (e.g., perf) but not on making it less buggy which seems flawed - maybe that should be a larger priority or we should signal that help really is needed?</p>



<a name="272722160"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/roadmap%20for%202022%20discussion/near/272722160" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> simulacrum <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/roadmap.20for.202022.20discussion.html#272722160">(Feb 21 2022 at 18:33)</a>:</h4>
<p>(the section focuses on performance more so than stability, anyway)</p>



<a name="272734431"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/roadmap%20for%202022%20discussion/near/272734431" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> pnkfelix <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/roadmap.20for.202022.20discussion.html#272734431">(Feb 21 2022 at 20:58)</a>:</h4>
<p>hmm</p>



<a name="272734671"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/roadmap%20for%202022%20discussion/near/272734671" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nnethercote <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/roadmap.20for.202022.20discussion.html#272734671">(Feb 21 2022 at 21:01)</a>:</h4>
<p>There's a devil on one of my shoulders that suggests incremental should just be removed entirely <span aria-label="confused" class="emoji emoji-1f615" role="img" title="confused">:confused:</span></p>



<a name="272734710"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/roadmap%20for%202022%20discussion/near/272734710" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> simulacrum <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/roadmap.20for.202022.20discussion.html#272734710">(Feb 21 2022 at 21:01)</a>:</h4>
<p>(it may be that the current section is fine, but I could well imagine a comment on Thursday's release post saying "why did the compiler team not prioritize this", which maybe we can try to head off a little with some slight language for tomorrow)</p>



<a name="272734809"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/roadmap%20for%202022%20discussion/near/272734809" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> pnkfelix <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/roadmap.20for.202022.20discussion.html#272734809">(Feb 21 2022 at 21:02)</a>:</h4>
<p>we could augment this text: </p>
<blockquote>
<p>In addition, there is a significant amount of work that could be done to improve our testing infrastructure for incremental compiliation which does not require deep knowledge of the compiler.</p>
</blockquote>
<p>to say</p>
<blockquote>
<p>In addition, there is a significant amount of work that could be done to improve our testing infrastructure for incremental compiliation which does not require deep knowledge of the compiler. We have had to disable and subsequently reenable incremental compilation on the stable release; we want to expand our validation strategies so that we know about problems in incremental compilation well before they come close to the stable channel.</p>
</blockquote>



<a name="272734972"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/roadmap%20for%202022%20discussion/near/272734972" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> pnkfelix <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/roadmap.20for.202022.20discussion.html#272734972">(Feb 21 2022 at 21:04)</a>:</h4>
<p>That phrasing would have worked last week before we were talking about disabling incr-comp, and it still would work this week, I think.</p>



<a name="272734973"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/roadmap%20for%202022%20discussion/near/272734973" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> pnkfelix <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/roadmap.20for.202022.20discussion.html#272734973">(Feb 21 2022 at 21:04)</a>:</h4>
<p><span class="user-mention" data-user-id="125250">@Wesley Wiser</span> ^ ?</p>



<a name="272734995"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/roadmap%20for%202022%20discussion/near/272734995" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> simulacrum <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/roadmap.20for.202022.20discussion.html#272734995">(Feb 21 2022 at 21:05)</a>:</h4>
<p>Seems good to me</p>



<a name="272735016"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/roadmap%20for%202022%20discussion/near/272735016" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wesley Wiser <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/roadmap.20for.202022.20discussion.html#272735016">(Feb 21 2022 at 21:05)</a>:</h4>
<p><span aria-label="+1" class="emoji emoji-1f44d" role="img" title="+1">:+1:</span> from me</p>



<a name="272735023"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/roadmap%20for%202022%20discussion/near/272735023" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> simulacrum <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/roadmap.20for.202022.20discussion.html#272735023">(Feb 21 2022 at 21:05)</a>:</h4>
<p>I think it might be good to say a little more about 'well before'</p>



<a name="272735066"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/roadmap%20for%202022%20discussion/near/272735066" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> simulacrum <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/roadmap.20for.202022.20discussion.html#272735066">(Feb 21 2022 at 21:06)</a>:</h4>
<p>in some sense, we want to not just detect problems before they hit stable, but eliminate the class of bugs (or at least detect it immediately)</p>



<a name="272735087"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/roadmap%20for%202022%20discussion/near/272735087" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> simulacrum <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/roadmap.20for.202022.20discussion.html#272735087">(Feb 21 2022 at 21:06)</a>:</h4>
<p>but that's harder to phrase.</p>



<a name="272735110"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/roadmap%20for%202022%20discussion/near/272735110" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> pnkfelix <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/roadmap.20for.202022.20discussion.html#272735110">(Feb 21 2022 at 21:06)</a>:</h4>
<p>Well that's certainly a higher aspiration</p>



<a name="272735177"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/roadmap%20for%202022%20discussion/near/272735177" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> pnkfelix <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/roadmap.20for.202022.20discussion.html#272735177">(Feb 21 2022 at 21:07)</a>:</h4>
<p>Anyway I'm hesitant to try to give too much detail in this post on "What to do about incr-comp". Its something we need to talk about, not commit to guesswork here.</p>



<a name="272735237"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/roadmap%20for%202022%20discussion/near/272735237" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> simulacrum <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/roadmap.20for.202022.20discussion.html#272735237">(Feb 21 2022 at 21:08)</a>:</h4>
<p>yeah, sure</p>



<a name="272735275"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/roadmap%20for%202022%20discussion/near/272735275" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> pnkfelix <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/roadmap.20for.202022.20discussion.html#272735275">(Feb 21 2022 at 21:09)</a>:</h4>
<p>I'll go add this text to the PR, but I also welcome other suggestions</p>



<a name="272737946"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/roadmap%20for%202022%20discussion/near/272737946" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> simulacrum <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/roadmap.20for.202022.20discussion.html#272737946">(Feb 21 2022 at 21:45)</a>:</h4>
<p><span class="user-mention silent" data-user-id="120989">nnethercote</span> <a href="#narrow/stream/131828-t-compiler/topic/roadmap.20for.202022.20discussion/near/272734671">said</a>:</p>
<blockquote>
<p>There's a devil on one of my shoulders that suggests incremental should just be removed entirely :/</p>
</blockquote>
<p>heh :) I have wanted to experiment with dropping all the incremental-related code and seeing how much of a win that is for non-incr builds, not so much to land it, but to at least get a sense of the trade off at this point</p>



<a name="272739173"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/roadmap%20for%202022%20discussion/near/272739173" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jubilee <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/roadmap.20for.202022.20discussion.html#272739173">(Feb 21 2022 at 22:03)</a>:</h4>
<p>It seems reasonable to suggest, even if incr comp is not removed, that it, err, seems to need some structural redesign.</p>



<a name="272741694"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/roadmap%20for%202022%20discussion/near/272741694" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> lqd <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/roadmap.20for.202022.20discussion.html#272741694">(Feb 21 2022 at 22:42)</a>:</h4>
<p>don’t we somewhat see the tradeoff in the full vs incr-full benchmarks, or are you talking about testing without memoization or without the query system altogether ?</p>



<a name="272741718"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/roadmap%20for%202022%20discussion/near/272741718" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Triplett <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/roadmap.20for.202022.20discussion.html#272741718">(Feb 21 2022 at 22:43)</a>:</h4>
<p><span class="user-mention silent" data-user-id="116122">simulacrum</span> <a href="#narrow/stream/131828-t-compiler/topic/roadmap.20for.202022.20discussion/near/272737946">said</a>:</p>
<blockquote>
<p><span class="user-mention silent" data-user-id="120989">nnethercote</span> <a href="#narrow/stream/131828-t-compiler/topic/roadmap.20for.202022.20discussion/near/272734671">said</a>:</p>
<blockquote>
<p>There's a devil on one of my shoulders that suggests incremental should just be removed entirely :/</p>
</blockquote>
<p>heh :) I have wanted to experiment with dropping all the incremental-related code and seeing how much of a win that is for non-incr builds, not so much to land it, but to at least get a sense of the trade off at this point</p>
</blockquote>
<p>I'd love to see the numbers.</p>



<a name="272741759"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/roadmap%20for%202022%20discussion/near/272741759" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/roadmap.20for.202022.20discussion.html#272741759">(Feb 21 2022 at 22:43)</a>:</h4>
<p>Maybe the "automatically clean and retry" idea should be reconsidered?</p>



<a name="272742692"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/roadmap%20for%202022%20discussion/near/272742692" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nnethercote <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/roadmap.20for.202022.20discussion.html#272742692">(Feb 21 2022 at 22:58)</a>:</h4>
<p><span class="user-mention silent" data-user-id="116122">simulacrum</span> <a href="#narrow/stream/131828-t-compiler/topic/roadmap.20for.202022.20discussion/near/272737946">said</a>:</p>
<blockquote>
<p>heh <span aria-label="smile" class="emoji emoji-1f642" role="img" title="smile">:smile:</span> I have wanted to experiment with dropping all the incremental-related code</p>
</blockquote>
<p>It would simplify perf analysis a lot too -- four scenarios would drop down to one scenario.</p>



<a name="272742747"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/roadmap%20for%202022%20discussion/near/272742747" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Aaron Hill <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/roadmap.20for.202022.20discussion.html#272742747">(Feb 21 2022 at 22:59)</a>:</h4>
<blockquote>
<p>There's a devil on one of my shoulders that suggests incremental should just be removed entirely</p>
</blockquote>
<p>I've had the same thought at times - the current system is just so complicated, and 'infects' so much of the compiler</p>



<a name="272742885"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/roadmap%20for%202022%20discussion/near/272742885" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nnethercote <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/roadmap.20for.202022.20discussion.html#272742885">(Feb 21 2022 at 23:00)</a>:</h4>
<p>And problems like "insert a line at the top of the file and all the spans get changed" have never been properly solved, right?</p>



<a name="272742968"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/roadmap%20for%202022%20discussion/near/272742968" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Aaron Hill <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/roadmap.20for.202022.20discussion.html#272742968">(Feb 21 2022 at 23:02)</a>:</h4>
<p>cjgillot has done some work on that with 'relative span' encoding</p>



<a name="272742970"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/roadmap%20for%202022%20discussion/near/272742970" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nnethercote <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/roadmap.20for.202022.20discussion.html#272742970">(Feb 21 2022 at 23:02)</a>:</h4>
<p>While we're thinking heretical thoughts: is the query system only for incremental?</p>



<a name="272742972"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/roadmap%20for%202022%20discussion/near/272742972" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Aaron Hill <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/roadmap.20for.202022.20discussion.html#272742972">(Feb 21 2022 at 23:02)</a>:</h4>
<p>It's not enabled by default at the moment</p>



<a name="272742991"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/roadmap%20for%202022%20discussion/near/272742991" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Aaron Hill <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/roadmap.20for.202022.20discussion.html#272742991">(Feb 21 2022 at 23:02)</a>:</h4>
<p>Yes, but incremental includes LLVM module re-use tracking</p>



<a name="272742998"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/roadmap%20for%202022%20discussion/near/272742998" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Triplett <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/roadmap.20for.202022.20discussion.html#272742998">(Feb 21 2022 at 23:02)</a>:</h4>
<p>So, I've had an idea for a while that seems like it might speed up Rust compilation, and I wonder to what extent it would use the same infrastructure that incremental does.<br>
With a "pull-oriented"/query-based compiler, we can only compile what's actually needed. If we extend that past the crate boundary, we could do as little work as possible in a first pass, then start compiling depending crates, and only compile the bits of each crate that are actually <em>used</em>.</p>



<a name="272743008"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/roadmap%20for%202022%20discussion/near/272743008" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Aaron Hill <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/roadmap.20for.202022.20discussion.html#272743008">(Feb 21 2022 at 23:03)</a>:</h4>
<p>which is incredibly important for performance when LTO is involved</p>



<a name="272743028"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/roadmap%20for%202022%20discussion/near/272743028" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Triplett <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/roadmap.20for.202022.20discussion.html#272743028">(Feb 21 2022 at 23:03)</a>:</h4>
<p>For instance, suppose you have a crate A with ten-thousand functions, and a crate B depending on A but only calling one function; in theory we could <em>just</em> compile the one function.</p>



<a name="272743694"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/roadmap%20for%202022%20discussion/near/272743694" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> scottmcm <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/roadmap.20for.202022.20discussion.html#272743694">(Feb 21 2022 at 23:12)</a>:</h4>
<p><span class="user-mention silent" data-user-id="120989">nnethercote</span> <a href="#narrow/stream/131828-t-compiler/topic/roadmap.20for.202022.20discussion/near/272742885">said</a>:</p>
<blockquote>
<p>And problems like "insert a line at the top of the file and all the spans get changed" have never been properly solved, right?</p>
</blockquote>
<p>Curiosity: Does debug info have good solutions for this?  Or is a newline always cursed to re-emit line info for the rest of the file?</p>



<a name="272743975"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/roadmap%20for%202022%20discussion/near/272743975" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> bjorn3 <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/roadmap.20for.202022.20discussion.html#272743975">(Feb 21 2022 at 23:16)</a>:</h4>
<blockquote>
<p>If we extend that past the crate boundary, we could do as little work as possible in a first pass, then start compiling depending crates, and only compile the bits of each crate that are actually <em>used</em>.</p>
</blockquote>
<p>Isn't that basically mir only rlibs? It has been benchmarked before and found to regress performance a lot in some cases. It also needs incr comp to avoid compiling everything every time. In addition it breaks <code>--emit obj</code>.</p>



<a name="272744001"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/roadmap%20for%202022%20discussion/near/272744001" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/roadmap.20for.202022.20discussion.html#272744001">(Feb 21 2022 at 23:17)</a>:</h4>
<p>Should this be moved to its own topic</p>



<a name="272744010"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/roadmap%20for%202022%20discussion/near/272744010" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> bjorn3 <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/roadmap.20for.202022.20discussion.html#272744010">(Feb 21 2022 at 23:17)</a>:</h4>
<p>Debuginfo could theoretically be handled by patching the object files.</p>



<a name="272745463"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/roadmap%20for%202022%20discussion/near/272745463" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Triplett <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/roadmap.20for.202022.20discussion.html#272745463">(Feb 21 2022 at 23:42)</a>:</h4>
<p><span class="user-mention silent" data-user-id="133247">bjorn3</span> <a href="#narrow/stream/131828-t-compiler/topic/roadmap.20for.202022.20discussion/near/272743975">said</a>:</p>
<blockquote>
<blockquote>
<p>If we extend that past the crate boundary, we could do as little work as possible in a first pass, then start compiling depending crates, and only compile the bits of each crate that are actually <em>used</em>.</p>
</blockquote>
<p>Isn't that basically mir only rlibs? It has been benchmarked before and found to regress performance a lot in some cases. It also needs incr comp to avoid compiling everything every time. In addition it breaks <code>--emit obj</code>.</p>
</blockquote>
<p>No, this would go a step further, and not even emit MIR for things that aren't needed. Just figure out potentially visible items, feed that list forward, and don't do anything more until one of those items is asked for.</p>



<a name="272750535"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/roadmap%20for%202022%20discussion/near/272750535" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jubilee <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/roadmap.20for.202022.20discussion.html#272750535">(Feb 22 2022 at 01:18)</a>:</h4>
<p><span class="user-mention silent" data-user-id="125270">scottmcm</span> <a href="#narrow/stream/131828-t-compiler/topic/roadmap.20for.202022.20discussion/near/272743694">said</a>:</p>
<blockquote>
<p><span class="user-mention silent" data-user-id="120989">nnethercote</span> <a href="#narrow/stream/131828-t-compiler/topic/roadmap.20for.202022.20discussion/near/272742885">said</a>:</p>
<blockquote>
<p>And problems like "insert a line at the top of the file and all the spans get changed" have never been properly solved, right?</p>
</blockquote>
<p>Curiosity: Does debug info have good solutions for this?  Or is a newline always cursed to re-emit line info for the rest of the file?</p>
</blockquote>
<p>One answer for how to handle this that is used by some compilers is to not have a specific index into the actual source file string, but rather have each span have a length and a position relative to <strong>other</strong> spans, so that, like with most more "linked list" style data structures, changing one span only means rewriting 3 items at most (prev, self, next).</p>



<a name="272750853"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/roadmap%20for%202022%20discussion/near/272750853" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jubilee <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/roadmap.20for.202022.20discussion.html#272750853">(Feb 22 2022 at 01:25)</a>:</h4>
<p>I learned about this while reading about how Roslyn, the C# compiler/code analysis/refactoring toolchain, handles things. So as you might imagine it's an approach that strongly pays off in incremental modes... at the cost of having to potentially build up significantly more upkeep in the first place, but</p>



<a name="272751043"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/roadmap%20for%202022%20discussion/near/272751043" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jubilee <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/roadmap.20for.202022.20discussion.html#272751043">(Feb 22 2022 at 01:29)</a>:</h4>
<p>&lt;sillymode&gt;what if rustc was two compilers, a slow one and a fast one, and if the fast one catches up with the slow one that's how you know it's a circular compilation&lt;/sillymode&gt;</p>



<a name="272777093"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/roadmap%20for%202022%20discussion/near/272777093" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> mw <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/roadmap.20for.202022.20discussion.html#272777093">(Feb 22 2022 at 09:16)</a>:</h4>
<p><span class="user-mention silent" data-user-id="120989">nnethercote</span> <a href="#narrow/stream/131828-t-compiler/topic/roadmap.20for.202022.20discussion/near/272734671">said</a>:</p>
<blockquote>
<p>There's a devil on one of my shoulders that suggests incremental should just be removed entirely :/</p>
</blockquote>
<p>Incr. comp. certainly seems to be the biggest maintenance burden we have. The query system is mostly there for incremental and doesn't carry its weight on its own, I'd say. <br>
I've been dreaming about rewriting the compiler to be much simpler and geared more towards taking advantage of multicore machines. Rust as a language helps us a lot with parallel programming but it doesn't help us much with upholding the invariants that incr. comp. requires.</p>
<p>Also, there might be ways to get some incrementality that are much simpler (albeit less fine-grained), like making the compiler emit self-contained intermediate files (like we already do for LLVM bitcode) and then hashing them verbatim (like LLVM's incremental ThinLTO does). That is, we might want to have some incrementality, but only if it is impossible to break accidentally and doesn't creep into every aspect of the compiler. </p>
<p>What also might be interesting: Could we have a compiler based on rust-analyzer that only supports debug builds (rust-analyzer was built with the Salsa model from the get-go and I suspect it has much fewer incr. comp. related problems).</p>
<p>Maybe we should indeed think about re-architecting the compiler in the medium term.</p>



<a name="272777782"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/roadmap%20for%202022%20discussion/near/272777782" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> bjorn3 <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/roadmap.20for.202022.20discussion.html#272777782">(Feb 22 2022 at 09:24)</a>:</h4>
<p>The query system is also necessary for handling cycles between compilation phases for as long as here are no cycles between individual queries. This is essential for allowing a const fn to be used during typeck of another function.</p>



<a name="272778079"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/roadmap%20for%202022%20discussion/near/272778079" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> bjorn3 <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/roadmap.20for.202022.20discussion.html#272778079">(Feb 22 2022 at 09:27)</a>:</h4>
<p>Also I believe rust-analyzer has had incremental issues before too. For example it assumed proc macros are deterministic at some point and evict macro evaluations from the cache if not used for a while. To fix this macro evaluations are now only evicted if the input changes, which increases memory usage.</p>



<a name="272778712"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/roadmap%20for%202022%20discussion/near/272778712" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> mw <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/roadmap.20for.202022.20discussion.html#272778712">(Feb 22 2022 at 09:33)</a>:</h4>
<p><span class="user-mention silent" data-user-id="133247">bjorn3</span> <a href="#narrow/stream/131828-t-compiler/topic/roadmap.20for.202022.20discussion/near/272777782">said</a>:</p>
<blockquote>
<p>The query system is also necessary for handling cycles between compilation phases for as long as here are no cycles between individual queries. This is essential for allowing a const fn to be used during typeck of another function.</p>
</blockquote>
<p>Yeah, I think some kind of on-demand evaluation will always be necessary -- and doing that in an ad-hoc fashion for each individual case sounds like a recipe for disaster :)</p>



<a name="272778906"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/roadmap%20for%202022%20discussion/near/272778906" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> mw <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/roadmap.20for.202022.20discussion.html#272778906">(Feb 22 2022 at 09:35)</a>:</h4>
<p>But doing on-demand evaluation with caching still should be a lot easier to maintain when the system only has to work for the current compilation session.</p>



<a name="272779505"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/roadmap%20for%202022%20discussion/near/272779505" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> bjorn3 <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/roadmap.20for.202022.20discussion.html#272779505">(Feb 22 2022 at 09:40)</a>:</h4>
<p>Sure. I just wouldn't like incr comp gone. It helps a lot with compile time for me.</p>



<a name="272782545"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/roadmap%20for%202022%20discussion/near/272782545" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> mw <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/roadmap.20for.202022.20discussion.html#272782545">(Feb 22 2022 at 10:09)</a>:</h4>
<p>Yes, I agree we'd need to have a replacement that performs at least roughly the same.</p>



<a name="272787448"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/roadmap%20for%202022%20discussion/near/272787448" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> cjgillot <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/roadmap.20for.202022.20discussion.html#272787448">(Feb 22 2022 at 11:01)</a>:</h4>
<p>I agree that the current setup for on-demand incr comp is incredibly complicated, and that dropping the on-demand scheme should be investigated. That does not mean we have to completely drop incr comp: we could find a way to still reuse past typechecking and LLVM.<br>
One benefit would be the high simplification potential. Instead of intertwined queries accessing information all over, we could go (back?) to a stage-based compilation: AST (fragments) -&gt; macro expansion + resolution -&gt; AST (full crate) -&gt; late resolution -&gt; HIR (per item-like) -&gt; type collection (per module) -&gt; typechecking (per body) -&gt; THIR (per body) -&gt; MIR (per body) -&gt; borrowck + optimization -&gt; LLVM.<br>
This stage-based compilation is still compatible with the recursion required by const-generics, with a priori definition of the dependency edges. It may even be simpler than the current scheme (no need for WithOptConstParam?).<br>
As said earlier, we may keep an incr-comp potential by strictly identifying which information can be accessed by which stage. For LLVM cgu reuse, we pretty much need to track which optimized MIR has been monomorphized and what it looked like. For typechecking, we will still have the hard problem of identifying dependencies inside of trait selection.</p>



<a name="272788972"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/roadmap%20for%202022%20discussion/near/272788972" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> lqd <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/roadmap.20for.202022.20discussion.html#272788972">(Feb 22 2022 at 11:16)</a>:</h4>
<p>would you say we should hold off the existing work on end-to-end queries, e.g. the in-progress AST to HIR lowering incrementalization, for a while until we have a plan for the future of incremental compilation and the query system ?</p>
<p>that being said, we'll also need a plan for the <em>present</em> of incremental compilation and the query system: to better test it, reproduce and fix existing issues, and prevent new ones (a lot of work seems in-progress here IIRC, like making the non-hashstable data inaccessible).</p>



<a name="272835983"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/roadmap%20for%202022%20discussion/near/272835983" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> pnkfelix <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/roadmap.20for.202022.20discussion.html#272835983">(Feb 22 2022 at 17:17)</a>:</h4>
<p>post is up, thanks <span class="user-mention" data-user-id="116122">@simulacrum</span> ! and I've tweeted about it: <a href="https://twitter.com/pnkfelix/status/1496172078940176392">https://twitter.com/pnkfelix/status/1496172078940176392</a></p>
<div class="inline-preview-twitter"><div class="twitter-tweet"><a href="https://twitter.com/pnkfelix/status/1496172078940176392"><img class="twitter-avatar" src="https://uploads.zulipusercontent.net/d481cd182b8f1b51780eee2728ea0a624dbecbcd/68747470733a2f2f7062732e7477696d672e636f6d2f70726f66696c655f696d616765732f3337383830303030303334393736343032352f62396537363762326535656263363331383738323633623732613832313631655f6e6f726d616c2e706e67"></a><p>The Rust compiler team wants you to know what its working on this year, and how you can help us make Rust better! #rustlang 
<a href="https://t.co/kiuXDWOTJw">https://blog.rust-lang.org/inside-rust/2022/02/22/compiler-team-ambitions-2022.html</a></p><span>- Felix S K II (@pnkfelix)</span></div></div>



<hr><p>Last updated: Apr 12 2022 at 20:01 UTC</p>
</html>