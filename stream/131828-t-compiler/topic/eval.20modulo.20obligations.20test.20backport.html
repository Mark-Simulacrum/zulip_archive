<html>
<head><meta charset="utf-8"><title>eval modulo obligations test backport · t-compiler · Zulip Chat Archive</title></head>
<h2>Stream: <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/index.html">t-compiler</a></h2>
<h3>Topic: <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/eval.20modulo.20obligations.20test.20backport.html">eval modulo obligations test backport</a></h3>

<hr>

<base href="https://rust-lang.zulipchat.com">

<head><link href="https://zulip-archive.rust-lang.org/style.css" rel="stylesheet"></head>

<a name="266997480"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/eval%20modulo%20obligations%20test%20backport/near/266997480" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> simulacrum <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/eval.20modulo.20obligations.20test.20backport.html#266997480">(Jan 05 2022 at 22:00)</a>:</h4>
<p>In <a href="https://github.com/rust-lang/rust/pull/92592#issuecomment-1006103840">https://github.com/rust-lang/rust/pull/92592#issuecomment-1006103840</a> I'm seeing a failure to backport <a href="https://github.com/rust-lang/rust/pull/91065">https://github.com/rust-lang/rust/pull/91065</a>, with the following diff to the stderr for <a href="https://github.com/Mark-Simulacrum/rust/blob/beta-next/src/test/ui/traits/issue-85360-eval-obligation-ice.rs">https://github.com/Mark-Simulacrum/rust/blob/beta-next/src/test/ui/traits/issue-85360-eval-obligation-ice.rs</a>:</p>
<div class="codehilite" data-code-language="Diff"><pre><span></span><code>16  LL | fn test&lt;T: Sized&gt;(_: T) {}
17     |            ----- predicate
18
<span class="gd">-   error: evaluate(Binder(TraitPredicate(&lt;MaskedStorage&lt;GenericComp2&lt;Pos&gt;&gt; as std::marker::Sized&gt;, polarity:Positive), [])) = Ok(EvaluatedToOkModuloRegions)</span>
<span class="gi">+   error: evaluate(Binder(TraitPredicate(&lt;MaskedStorage&lt;GenericComp2&lt;Pos&gt;&gt; as std::marker::Sized&gt;, polarity:Positive), [])) = Ok(EvaluatedToOk)</span>
20    --&gt; $DIR/issue-85360-eval-obligation-ice.rs:13:5
21     |
22  LL |     test::&lt;MaskedStorage&lt;GenericComp2&lt;Pos&gt;&gt;&gt;(make());

25  LL | fn test&lt;T: Sized&gt;(_: T) {}
26     |         - predicate
27
<span class="gd">-   error: evaluate(Binder(TraitPredicate(&lt;MaskedStorage&lt;GenericComp2&lt;Pos&gt;&gt; as std::marker::Sized&gt;, polarity:Positive), [])) = Ok(EvaluatedToOkModuloRegions)</span>
<span class="gi">+   error: evaluate(Binder(TraitPredicate(&lt;MaskedStorage&lt;GenericComp2&lt;Pos&gt;&gt; as std::marker::Sized&gt;, polarity:Positive), [])) = Ok(EvaluatedToOk)</span>
29    --&gt; $DIR/issue-85360-eval-obligation-ice.rs:13:5
</code></pre></div>
<p>Can I get someone to take a look at this and either say "yeah seems ok" or "no, we need another backport"?</p>
<p>cc <span class="user-mention" data-user-id="125294">@Aaron Hill</span> <span class="user-mention" data-user-id="125250">@Wesley Wiser</span> <span class="user-mention" data-user-id="232957">@Jack Huey</span></p>



<a name="266997502"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/eval%20modulo%20obligations%20test%20backport/near/266997502" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> simulacrum <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/eval.20modulo.20obligations.20test.20backport.html#266997502">(Jan 05 2022 at 22:01)</a>:</h4>
<p>(The release is next week, so this is somewhat urgent).</p>



<a name="266997709"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/eval%20modulo%20obligations%20test%20backport/near/266997709" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Aaron Hill <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/eval.20modulo.20obligations.20test.20backport.html#266997709">(Jan 05 2022 at 22:02)</a>:</h4>
<p>That's concerning - the test is supposed to check that we're actually getting EvaluatedToOkModuloRegions</p>



<a name="266997720"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/eval%20modulo%20obligations%20test%20backport/near/266997720" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wesley Wiser <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/eval.20modulo.20obligations.20test.20backport.html#266997720">(Jan 05 2022 at 22:03)</a>:</h4>
<p>We might need <a href="https://github.com/rust-lang/rust/issues/91329">#91329</a> as well</p>



<a name="266997743"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/eval%20modulo%20obligations%20test%20backport/near/266997743" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wesley Wiser <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/eval.20modulo.20obligations.20test.20backport.html#266997743">(Jan 05 2022 at 22:03)</a>:</h4>
<p>(to backport the test as is)</p>



<a name="266997764"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/eval%20modulo%20obligations%20test%20backport/near/266997764" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Aaron Hill <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/eval.20modulo.20obligations.20test.20backport.html#266997764">(Jan 05 2022 at 22:03)</a>:</h4>
<p>Oh, this is just the test addition PR being backported</p>



<a name="266997783"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/eval%20modulo%20obligations%20test%20backport/near/266997783" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wesley Wiser <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/eval.20modulo.20obligations.20test.20backport.html#266997783">(Jan 05 2022 at 22:03)</a>:</h4>
<p>(on mobile currently so it's difficult for me to check)</p>



<a name="266997799"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/eval%20modulo%20obligations%20test%20backport/near/266997799" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> simulacrum <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/eval.20modulo.20obligations.20test.20backport.html#266997799">(Jan 05 2022 at 22:03)</a>:</h4>
<p>Well, we're also backporting <a href="https://github.com/rust-lang/rust/issues/90423">#90423</a></p>



<a name="266997834"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/eval%20modulo%20obligations%20test%20backport/near/266997834" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Aaron Hill <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/eval.20modulo.20obligations.20test.20backport.html#266997834">(Jan 05 2022 at 22:04)</a>:</h4>
<p>I don't think there's any reason to backport the test if it fails</p>



<a name="266997891"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/eval%20modulo%20obligations%20test%20backport/near/266997891" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Aaron Hill <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/eval.20modulo.20obligations.20test.20backport.html#266997891">(Jan 05 2022 at 22:04)</a>:</h4>
<p>That other PR is purely for performance</p>



<a name="266997926"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/eval%20modulo%20obligations%20test%20backport/near/266997926" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Aaron Hill <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/eval.20modulo.20obligations.20test.20backport.html#266997926">(Jan 05 2022 at 22:04)</a>:</h4>
<p>I remember us deciding <em>not</em> to backport some of the PRs that actually changed caching behavior</p>



<a name="266997945"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/eval%20modulo%20obligations%20test%20backport/near/266997945" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Aaron Hill <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/eval.20modulo.20obligations.20test.20backport.html#266997945">(Jan 05 2022 at 22:04)</a>:</h4>
<p>so that they had more time to bake</p>



<a name="266997976"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/eval%20modulo%20obligations%20test%20backport/near/266997976" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wesley Wiser <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/eval.20modulo.20obligations.20test.20backport.html#266997976">(Jan 05 2022 at 22:05)</a>:</h4>
<p>If the test is failing on backport, should we be concerned that we've reintroduced the regression?</p>



<a name="266997985"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/eval%20modulo%20obligations%20test%20backport/near/266997985" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Aaron Hill <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/eval.20modulo.20obligations.20test.20backport.html#266997985">(Jan 05 2022 at 22:05)</a>:</h4>
<p>If that test addition PR doesn't pass, then it shouldn't be backported - the failure means that we didn't backport some other pr</p>



<a name="266997991"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/eval%20modulo%20obligations%20test%20backport/near/266997991" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Aaron Hill <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/eval.20modulo.20obligations.20test.20backport.html#266997991">(Jan 05 2022 at 22:05)</a>:</h4>
<p>I don't think so</p>



<a name="266998001"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/eval%20modulo%20obligations%20test%20backport/near/266998001" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wesley Wiser <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/eval.20modulo.20obligations.20test.20backport.html#266998001">(Jan 05 2022 at 22:05)</a>:</h4>
<p>Ok</p>



<a name="266998011"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/eval%20modulo%20obligations%20test%20backport/near/266998011" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Aaron Hill <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/eval.20modulo.20obligations.20test.20backport.html#266998011">(Jan 05 2022 at 22:05)</a>:</h4>
<p>I think beta doesn't contain all the fixes that nightly does</p>



<a name="266998042"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/eval%20modulo%20obligations%20test%20backport/near/266998042" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> simulacrum <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/eval.20modulo.20obligations.20test.20backport.html#266998042">(Jan 05 2022 at 22:05)</a>:</h4>
<p>OK, I'll drop the backport of the test PR for now then</p>



<a name="266998049"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/eval%20modulo%20obligations%20test%20backport/near/266998049" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Aaron Hill <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/eval.20modulo.20obligations.20test.20backport.html#266998049">(Jan 05 2022 at 22:05)</a>:</h4>
<p>Because we landed that PR before changing the projection caching, iirc</p>



<a name="266998095"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/eval%20modulo%20obligations%20test%20backport/near/266998095" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Aaron Hill <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/eval.20modulo.20obligations.20test.20backport.html#266998095">(Jan 05 2022 at 22:06)</a>:</h4>
<p>To make sure that we wouldn't break anything</p>



<a name="266998105"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/eval%20modulo%20obligations%20test%20backport/near/266998105" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> simulacrum <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/eval.20modulo.20obligations.20test.20backport.html#266998105">(Jan 05 2022 at 22:06)</a>:</h4>
<p>(We can also continue the discussion, of course, just want to get most things landed)</p>



<a name="266998122"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/eval%20modulo%20obligations%20test%20backport/near/266998122" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wesley Wiser <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/eval.20modulo.20obligations.20test.20backport.html#266998122">(Jan 05 2022 at 22:06)</a>:</h4>
<p>I think <span class="user-mention" data-user-id="125294">@Aaron Hill</span> asked me to include a test that exercises the behavior of <a href="https://github.com/rust-lang/rust/issues/91329">#91329</a> so that might be the part of the regression test which is failing.</p>



<a name="266998143"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/eval%20modulo%20obligations%20test%20backport/near/266998143" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Aaron Hill <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/eval.20modulo.20obligations.20test.20backport.html#266998143">(Jan 05 2022 at 22:06)</a>:</h4>
<p>Wait, never mind</p>



<a name="266998195"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/eval%20modulo%20obligations%20test%20backport/near/266998195" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Aaron Hill <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/eval.20modulo.20obligations.20test.20backport.html#266998195">(Jan 05 2022 at 22:07)</a>:</h4>
<p>That PR was merged after some <em>other</em> earlier fix related to projection caching</p>



<a name="266998197"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/eval%20modulo%20obligations%20test%20backport/near/266998197" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wesley Wiser <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/eval.20modulo.20obligations.20test.20backport.html#266998197">(Jan 05 2022 at 22:07)</a>:</h4>
<p><a href="https://github.com/rust-lang/rust/pull/91065#discussion_r757944631">https://github.com/rust-lang/rust/pull/91065#discussion_r757944631</a></p>



<a name="266998228"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/eval%20modulo%20obligations%20test%20backport/near/266998228" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Aaron Hill <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/eval.20modulo.20obligations.20test.20backport.html#266998228">(Jan 05 2022 at 22:07)</a>:</h4>
<p>Oh, that would do it</p>



<a name="266998378"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/eval%20modulo%20obligations%20test%20backport/near/266998378" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Aaron Hill <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/eval.20modulo.20obligations.20test.20backport.html#266998378">(Jan 05 2022 at 22:08)</a>:</h4>
<p>So, I think I was right (but for the wrong reasons) - the test addition PR depends on another non-trivial non-backported PR</p>



<a name="266998414"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/eval%20modulo%20obligations%20test%20backport/near/266998414" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wesley Wiser <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/eval.20modulo.20obligations.20test.20backport.html#266998414">(Jan 05 2022 at 22:09)</a>:</h4>
<p>That makes sense to me</p>



<a name="266998433"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/eval%20modulo%20obligations%20test%20backport/near/266998433" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wesley Wiser <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/eval.20modulo.20obligations.20test.20backport.html#266998433">(Jan 05 2022 at 22:09)</a>:</h4>
<p>So we should not backport the test</p>



<a name="266999087"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/eval%20modulo%20obligations%20test%20backport/near/266999087" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wesley Wiser <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/eval.20modulo.20obligations.20test.20backport.html#266999087">(Jan 05 2022 at 22:13)</a>:</h4>
<p>Or, I guess the test could be adjusted to accept the output shown above. Either seems reasonable to me.</p>



<a name="266999232"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/eval%20modulo%20obligations%20test%20backport/near/266999232" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> simulacrum <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/eval.20modulo.20obligations.20test.20backport.html#266999232">(Jan 05 2022 at 22:14)</a>:</h4>
<p>I left the other 2 tests and dropped this one</p>



<hr><p>Last updated: Apr 12 2022 at 20:01 UTC</p>
</html>