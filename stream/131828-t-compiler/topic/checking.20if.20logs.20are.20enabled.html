<html>
<head><meta charset="utf-8"><title>checking if logs are enabled · t-compiler · Zulip Chat Archive</title></head>
<h2>Stream: <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/index.html">t-compiler</a></h2>
<h3>Topic: <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/checking.20if.20logs.20are.20enabled.html">checking if logs are enabled</a></h3>

<hr>

<base href="https://rust-lang.zulipchat.com">

<head><link href="https://zulip-archive.rust-lang.org/style.css" rel="stylesheet"></head>

<a name="250396811"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/checking%20if%20logs%20are%20enabled/near/250396811" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/checking.20if.20logs.20are.20enabled.html#250396811">(Aug 23 2021 at 19:04)</a>:</h4>
<p>How do you check if logs are enabled again?</p>



<a name="250396820"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/checking%20if%20logs%20are%20enabled/near/250396820" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/checking.20if.20logs.20are.20enabled.html#250396820">(Aug 23 2021 at 19:04)</a>:</h4>
<p>e.g., I want something like</p>



<a name="250396846"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/checking%20if%20logs%20are%20enabled/near/250396846" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/checking.20if.20logs.20are.20enabled.html#250396846">(Aug 23 2021 at 19:04)</a>:</h4>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="k">if</span><span class="w"> </span><span class="n">logs_enabld_in</span><span class="o">-</span><span class="n">this_module</span><span class="p">()</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="o">..</span><span class="p">.</span><span class="w"> </span><span class="cm">/* some debug that are kind of expensive */</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>
</code></pre></div>



<a name="250397182"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/checking%20if%20logs%20are%20enabled/near/250397182" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nagisa <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/checking.20if.20logs.20are.20enabled.html#250397182">(Aug 23 2021 at 19:06)</a>:</h4>
<p>You'd go through Dispatch::is_enabled i think.</p>



<a name="250397291"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/checking%20if%20logs%20are%20enabled/near/250397291" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nagisa <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/checking.20if.20logs.20are.20enabled.html#250397291">(Aug 23 2021 at 19:07)</a>:</h4>
<p><a href="https://docs.rs/tracing/0.1.5/tracing/dispatcher/struct.Dispatch.html#method.enabled">https://docs.rs/tracing/0.1.5/tracing/dispatcher/struct.Dispatch.html#method.enabled</a></p>



<a name="250397499"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/checking%20if%20logs%20are%20enabled/near/250397499" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nagisa <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/checking.20if.20logs.20are.20enabled.html#250397499">(Aug 23 2021 at 19:08)</a>:</h4>
<p>Possibly with some fake span that you don't enter to obtain metadata to test with?</p>



<a name="250397524"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/checking%20if%20logs%20are%20enabled/near/250397524" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/checking.20if.20logs.20are.20enabled.html#250397524">(Aug 23 2021 at 19:08)</a>:</h4>
<p>bah</p>



<a name="250397535"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/checking%20if%20logs%20are%20enabled/near/250397535" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/checking.20if.20logs.20are.20enabled.html#250397535">(Aug 23 2021 at 19:09)</a>:</h4>
<p>that sounds hard and annoying :)</p>



<a name="250397561"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/checking%20if%20logs%20are%20enabled/near/250397561" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/checking.20if.20logs.20are.20enabled.html#250397561">(Aug 23 2021 at 19:09)</a>:</h4>
<p>I don't see any examples using it, more to the point</p>



<a name="250397615"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/checking%20if%20logs%20are%20enabled/near/250397615" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/checking.20if.20logs.20are.20enabled.html#250397615">(Aug 23 2021 at 19:09)</a>:</h4>
<p>lol I guess I could write an evil helper function like <code>debug!("{}", { is_enabled = true; () })</code></p>



<a name="250397716"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/checking%20if%20logs%20are%20enabled/near/250397716" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/checking.20if.20logs.20are.20enabled.html#250397716">(Aug 23 2021 at 19:10)</a>:</h4>
<p>maybe I'll cheat and make it conditional on <code>-Zverbose</code></p>



<a name="250397761"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/checking%20if%20logs%20are%20enabled/near/250397761" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nagisa <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/checking.20if.20logs.20are.20enabled.html#250397761">(Aug 23 2021 at 19:10)</a>:</h4>
<p>Not sure if that would work in general case. There are a couple ways logs can be disabled. Your case would only cover compile time i think.</p>



<a name="250397786"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/checking%20if%20logs%20are%20enabled/near/250397786" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/checking.20if.20logs.20are.20enabled.html#250397786">(Aug 23 2021 at 19:11)</a>:</h4>
<p>yeah. that might be enough.</p>



<a name="250397792"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/checking%20if%20logs%20are%20enabled/near/250397792" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nagisa <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/checking.20if.20logs.20are.20enabled.html#250397792">(Aug 23 2021 at 19:11)</a>:</h4>
<p>Or maybe I'm wrong idk.</p>



<a name="250397797"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/checking%20if%20logs%20are%20enabled/near/250397797" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/checking.20if.20logs.20are.20enabled.html#250397797">(Aug 23 2021 at 19:11)</a>:</h4>
<p>I'm using verbose anyway</p>



<a name="250397811"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/checking%20if%20logs%20are%20enabled/near/250397811" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/checking.20if.20logs.20are.20enabled.html#250397811">(Aug 23 2021 at 19:11)</a>:</h4>
<p><span class="user-mention silent" data-user-id="123586">nagisa</span> <a href="#narrow/stream/131828-t-compiler/topic/checking.20if.20logs.20are.20enabled/near/250397792">said</a>:</p>
<blockquote>
<p>Or maybe I'm wrong idk.</p>
</blockquote>
<p>well, I think you're wrong</p>



<a name="250397820"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/checking%20if%20logs%20are%20enabled/near/250397820" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/checking.20if.20logs.20are.20enabled.html#250397820">(Aug 23 2021 at 19:11)</a>:</h4>
<p>I don't think that the arguments to <code>debug!</code> are evaluated</p>



<a name="250397824"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/checking%20if%20logs%20are%20enabled/near/250397824" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/checking.20if.20logs.20are.20enabled.html#250397824">(Aug 23 2021 at 19:11)</a>:</h4>
<p>if logs are not enabled</p>



<a name="250397840"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/checking%20if%20logs%20are%20enabled/near/250397840" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/checking.20if.20logs.20are.20enabled.html#250397840">(Aug 23 2021 at 19:11)</a>:</h4>
<p>but regardless, <code>-Zverbose</code> is probably "good enough"</p>



<a name="250397880"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/checking%20if%20logs%20are%20enabled/near/250397880" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/checking.20if.20logs.20are.20enabled.html#250397880">(Aug 23 2021 at 19:11)</a>:</h4>
<p>I'm adding some code that dumps out the text of expressions during type-checking</p>



<a name="250397892"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/checking%20if%20logs%20are%20enabled/near/250397892" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/checking.20if.20logs.20are.20enabled.html#250397892">(Aug 23 2021 at 19:12)</a>:</h4>
<p>dont' want to slow down bootstrap time</p>



<a name="250398284"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/checking%20if%20logs%20are%20enabled/near/250398284" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nagisa <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/checking.20if.20logs.20are.20enabled.html#250398284">(Aug 23 2021 at 19:15)</a>:</h4>
<p>So this is what I would do. <code>tracing::dispatch::get_default(|d| d.enabled(debug_span!("enable_check").metadata()))</code></p>



<a name="250398315"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/checking%20if%20logs%20are%20enabled/near/250398315" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nagisa <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/checking.20if.20logs.20are.20enabled.html#250398315">(Aug 23 2021 at 19:15)</a>:</h4>
<p>Typing code on phone is haaard</p>



<a name="250398502"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/checking%20if%20logs%20are%20enabled/near/250398502" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nagisa <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/checking.20if.20logs.20are.20enabled.html#250398502">(Aug 23 2021 at 19:16)</a>:</h4>
<p>You could also use event! macro to construct test metadata but i don't think we ever filter on span vs. Event distinction.</p>



<a name="250398698"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/checking%20if%20logs%20are%20enabled/near/250398698" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nagisa <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/checking.20if.20logs.20are.20enabled.html#250398698">(Aug 23 2021 at 19:18)</a>:</h4>
<p>Or you could also construct event with empty fields, test for enableness and record the fields after. I can write that down once I'm back at computer.</p>



<a name="250398965"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/checking%20if%20logs%20are%20enabled/near/250398965" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nagisa <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/checking.20if.20logs.20are.20enabled.html#250398965">(Aug 23 2021 at 19:20)</a>:</h4>
<p>Ah hm not sure you can do that with events actually. Might be specific to spans.</p>



<hr><p>Last updated: Apr 12 2022 at 20:01 UTC</p>
</html>