<html>
<head><meta charset="utf-8"><title>#[rustc_deprecated] Â· t-compiler Â· Zulip Chat Archive</title></head>
<h2>Stream: <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/index.html">t-compiler</a></h2>
<h3>Topic: <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/.23.5Brustc_deprecated.5D.html">#[rustc_deprecated]</a></h3>

<hr>

<base href="https://rust-lang.zulipchat.com">

<head><link href="https://zulip-archive.rust-lang.org/style.css" rel="stylesheet"></head>

<a name="270503749"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/%23%5Brustc_deprecated%5D/near/270503749" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Notification Bot <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/.23.5Brustc_deprecated.5D.html#270503749">(Feb 03 2022 at 05:45)</a>:</h4>
<p>This topic was moved here from <a class="stream-topic" data-stream-id="213817" href="/#narrow/stream/213817-t-lang/topic/.23.5Brustc_deprecated.5D">#t-lang &gt; #[rustc_deprecated]</a> by <span class="user-mention silent" data-user-id="239881">Josh Triplett</span></p>



<a name="270508128"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/%23%5Brustc_deprecated%5D/near/270508128" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> oli <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/.23.5Brustc_deprecated.5D.html#270508128">(Feb 03 2022 at 07:00)</a>:</h4>
<p>Iirc the rustc_deprecated attribute has a flag for the compiler version. There may be further differences</p>



<a name="270517880"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/%23%5Brustc_deprecated%5D/near/270517880" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jacob Pratt <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/.23.5Brustc_deprecated.5D.html#270517880">(Feb 03 2022 at 09:04)</a>:</h4>
<p>But <code>#[deprecated(since = "1.59.0", note = "foo")]</code> is valid in crates. The only thing that would need to be done, as I noted, was to enforce that the optional bits ("since" and "note") are present in stdlib.</p>



<a name="270517920"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/%23%5Brustc_deprecated%5D/near/270517920" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jacob Pratt <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/.23.5Brustc_deprecated.5D.html#270517920">(Feb 03 2022 at 09:05)</a>:</h4>
<p>(<a href="https://doc.rust-lang.org/reference/attributes/diagnostics.html#the-deprecated-attribute">Rust reference</a>)</p>



<a name="270539178"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/%23%5Brustc_deprecated%5D/near/270539178" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> cjgillot <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/.23.5Brustc_deprecated.5D.html#270539178">(Feb 03 2022 at 12:16)</a>:</h4>
<p>Syntactically, the difference is that rustc_deprecated uses <code>reason</code> where deprecated uses <code>note</code>, and that rustc_deprecated allows for suggestions.  Otherwise, the code paths for both attributes are the same, so I don't see any reason not to merge both attributes.  The user-visible <code>deprecated</code> attribute may even benefit from getting suggestions.</p>



<a name="270541912"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/%23%5Brustc_deprecated%5D/near/270541912" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> oli <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/.23.5Brustc_deprecated.5D.html#270541912">(Feb 03 2022 at 12:44)</a>:</h4>
<p>As long as the suggestions field is gated, that merge seems fine to me from what y'all wrote</p>



<a name="270613280"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/%23%5Brustc_deprecated%5D/near/270613280" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Noah Lev <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/.23.5Brustc_deprecated.5D.html#270613280">(Feb 03 2022 at 20:32)</a>:</h4>
<p>I've been wondering about this for a while myself, so I'd be glad to see them merged</p>



<a name="270625906"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/%23%5Brustc_deprecated%5D/near/270625906" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jacob Pratt <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/.23.5Brustc_deprecated.5D.html#270625906">(Feb 03 2022 at 22:09)</a>:</h4>
<p>I'll tentatively put this on my list of things to look in to. It's growing increasing longer, so we'll see haha</p>



<a name="270661240"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/%23%5Brustc_deprecated%5D/near/270661240" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Vadim Petrochenkov <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/.23.5Brustc_deprecated.5D.html#270661240">(Feb 04 2022 at 02:54)</a>:</h4>
<p>The merge of <code>deprecated</code> and <code>rustc_deprecated</code> was started last year but not finished - <a href="https://github.com/rust-lang/rust/pull/74572">https://github.com/rust-lang/rust/pull/74572</a></p>



<a name="270661261"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/%23%5Brustc_deprecated%5D/near/270661261" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Vadim Petrochenkov <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/.23.5Brustc_deprecated.5D.html#270661261">(Feb 04 2022 at 02:55)</a>:</h4>
<p>I think we can merge them, just keep the extra functionality of <code>rustc_deprecated</code> unstable for a start.</p>



<a name="270672777"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/%23%5Brustc_deprecated%5D/near/270672777" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jacob Pratt <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/.23.5Brustc_deprecated.5D.html#270672777">(Feb 04 2022 at 06:20)</a>:</h4>
<p>That was my intent. Once I get around to it, it'll probably be best to keep <code>#[rustc_deprecated]</code> as an alias to <code>#[deprecated]</code> until a bootstrap occurs. Otherwise every instance of it would have to have <code>#[cfg_attr(bootstrap, â€¦)]</code>, which is unnecessary noise.</p>



<a name="274217995"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/%23%5Brustc_deprecated%5D/near/274217995" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jacob Pratt ðŸ‡ºðŸ‡¦ <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/.23.5Brustc_deprecated.5D.html#274217995">(Mar 05 2022 at 04:03)</a>:</h4>
<p>Just created a PR merging the two fully. <a href="https://github.com/rust-lang/rust/issues/94635">#94635</a></p>



<a name="278254783"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/%23%5Brustc_deprecated%5D/near/278254783" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jacob Pratt <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/.23.5Brustc_deprecated.5D.html#278254783">(Apr 08 2022 at 04:05)</a>:</h4>
<p>Now that a bootstrap has occurred, I'm going ahead with removing all usages of <code>#[rustc_deprecated]</code>. Submodules have to come first. I've just opened <a href="https://github.com/rust-lang/stdarch/pull/1301">rust-lang/stdarch#1301</a> for the first of these.</p>
<p>I have commits for the main change already complete, but won't be creating a PR until the previous ones are merged (as I know they'll fail). With that said, I am moving straight to a hard error on <code>#[rustc_deprecated]</code> and/or <code>reason</code> as an item in it. The latter has an automated fix to <code>note</code>, but I couldn't find a nice way to implement a diagnostic to rename <code>rustc_deprecated</code> to <code>deprecated</code> while keeping everything else the same. This would require getting the stringified value of the macro argument, for which an API does not appear to exist.</p>
<p>These diagnostics can (and should) be removed in the future. I believe there's value in having them in the short-term so people don't get unnecessarily confused.</p>



<hr><p>Last updated: Apr 12 2022 at 20:01 UTC</p>
</html>