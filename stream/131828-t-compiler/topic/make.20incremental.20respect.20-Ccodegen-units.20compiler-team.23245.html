<html>
<head><meta charset="utf-8"><title>make incremental respect -Ccodegen-units compiler-team#245 · t-compiler · Zulip Chat Archive</title></head>
<h2>Stream: <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/index.html">t-compiler</a></h2>
<h3>Topic: <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/make.20incremental.20respect.20-Ccodegen-units.20compiler-team.23245.html">make incremental respect -Ccodegen-units compiler-team#245</a></h3>

<hr>

<base href="https://rust-lang.zulipchat.com">

<head><link href="https://zulip-archive.rust-lang.org/style.css" rel="stylesheet"></head>

<a name="187469089"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/make%20incremental%20respect%20-Ccodegen-units%20compiler-team%23245/near/187469089" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> pnkfelix <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/make.20incremental.20respect.20-Ccodegen-units.20compiler-team.23245.html#187469089">(Feb 05 2020 at 16:26)</a>:</h4>
<p><a href="https://github.com/rust-lang/compiler-team/issues/245" target="_blank" title="https://github.com/rust-lang/compiler-team/issues/245">compiler-team#245</a></p>



<a name="187469133"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/make%20incremental%20respect%20-Ccodegen-units%20compiler-team%23245/near/187469133" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> pnkfelix <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/make.20incremental.20respect.20-Ccodegen-units.20compiler-team.23245.html#187469133">(Feb 05 2020 at 16:26)</a>:</h4>
<p>hey <span class="user-mention" data-user-id="124287">@mw</span> regarding this change proposal</p>



<a name="187469163"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/make%20incremental%20respect%20-Ccodegen-units%20compiler-team%23245/near/187469163" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> pnkfelix <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/make.20incremental.20respect.20-Ccodegen-units.20compiler-team.23245.html#187469163">(Feb 05 2020 at 16:27)</a>:</h4>
<p>did you notice any impact when bootstrapping <code>rustc</code> itself with incremental turned on?</p>



<a name="187469214"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/make%20incremental%20respect%20-Ccodegen-units%20compiler-team%23245/near/187469214" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> pnkfelix <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/make.20incremental.20respect.20-Ccodegen-units.20compiler-team.23245.html#187469214">(Feb 05 2020 at 16:27)</a>:</h4>
<p>or wait, we don't <em>set</em> <code>-Ccodegen-units</code> anyway in the default config.toml , do we?</p>



<a name="187469299"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/make%20incremental%20respect%20-Ccodegen-units%20compiler-team%23245/near/187469299" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> pnkfelix <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/make.20incremental.20respect.20-Ccodegen-units.20compiler-team.23245.html#187469299">(Feb 05 2020 at 16:28)</a>:</h4>
<p>oh but the point still stands nonetheless, even without an explicit setting...</p>



<a name="187479739"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/make%20incremental%20respect%20-Ccodegen-units%20compiler-team%23245/near/187479739" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> simulacrum <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/make.20incremental.20respect.20-Ccodegen-units.20compiler-team.23245.html#187479739">(Feb 05 2020 at 18:18)</a>:</h4>
<p><span class="user-mention" data-user-id="116083">@pnkfelix</span> we do not set it explicitly, and the config.toml.example lies about the default (it's just the "regular" compiler default, so 16 w/o incremental and 2*modules it sounds like with)</p>



<a name="187479821"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/make%20incremental%20respect%20-Ccodegen-units%20compiler-team%23245/near/187479821" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> pnkfelix <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/make.20incremental.20respect.20-Ccodegen-units.20compiler-team.23245.html#187479821">(Feb 05 2020 at 18:19)</a>:</h4>
<p>Right. So with this change, it will go from being 2*modules to 256 when incremental is on, right?</p>



<a name="187479987"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/make%20incremental%20respect%20-Ccodegen-units%20compiler-team%23245/near/187479987" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> simulacrum <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/make.20incremental.20respect.20-Ccodegen-units.20compiler-team.23245.html#187479987">(Feb 05 2020 at 18:21)</a>:</h4>
<p>Well, 2*modules I think but capped at 256?</p>



<a name="187483266"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/make%20incremental%20respect%20-Ccodegen-units%20compiler-team%23245/near/187483266" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> pnkfelix <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/make.20incremental.20respect.20-Ccodegen-units.20compiler-team.23245.html#187483266">(Feb 05 2020 at 18:57)</a>:</h4>
<p>okay yes; the main point is that the max (of 16) was not respected before, and now the new max (of 256) will be respected. Does that sound right?</p>



<a name="187483578"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/make%20incremental%20respect%20-Ccodegen-units%20compiler-team%23245/near/187483578" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> simulacrum <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/make.20incremental.20respect.20-Ccodegen-units.20compiler-team.23245.html#187483578">(Feb 05 2020 at 19:00)</a>:</h4>
<p>Yes. I personally am not sure if <span class="user-mention" data-user-id="124287">@mw</span> has done much experimentation around the exact number.</p>



<a name="187535579"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/make%20incremental%20respect%20-Ccodegen-units%20compiler-team%23245/near/187535579" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> mw <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/make.20incremental.20respect.20-Ccodegen-units.20compiler-team.23245.html#187535579">(Feb 06 2020 at 10:18)</a>:</h4>
<p><a href="https://github.com/rust-lang/rust/pull/67834" target="_blank" title="https://github.com/rust-lang/rust/pull/67834">https://github.com/rust-lang/rust/pull/67834</a> has a number of perf runs with different default values. 256 seemed to be a good compromise between granularity and overhead.</p>



<a name="187535681"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/make%20incremental%20respect%20-Ccodegen-units%20compiler-team%23245/near/187535681" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> mw <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/make.20incremental.20respect.20-Ccodegen-units.20compiler-team.23245.html#187535681">(Feb 06 2020 at 10:20)</a>:</h4>
<p>I did not do any measurements on bootstrap time with this. I expect that <code>librustc</code> exceeds the default and would profit from the change.</p>



<a name="187545473"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/make%20incremental%20respect%20-Ccodegen-units%20compiler-team%23245/near/187545473" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> simulacrum <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/make.20incremental.20respect.20-Ccodegen-units.20compiler-team.23245.html#187545473">(Feb 06 2020 at 13:01)</a>:</h4>
<p>Sounds good.</p>



<a name="187545735"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/make%20incremental%20respect%20-Ccodegen-units%20compiler-team%23245/near/187545735" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> mw <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/make.20incremental.20respect.20-Ccodegen-units.20compiler-team.23245.html#187545735">(Feb 06 2020 at 13:05)</a>:</h4>
<p>Also, the default can be tweaked in the future. The more important change is that the user now has control over something that could not be influenced before.</p>



<hr><p>Last updated: Apr 12 2022 at 20:01 UTC</p>
</html>