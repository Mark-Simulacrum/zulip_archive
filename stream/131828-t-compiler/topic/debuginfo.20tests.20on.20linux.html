<html>
<head><meta charset="utf-8"><title>debuginfo tests on linux · t-compiler · Zulip Chat Archive</title></head>
<h2>Stream: <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/index.html">t-compiler</a></h2>
<h3>Topic: <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/debuginfo.20tests.20on.20linux.html">debuginfo tests on linux</a></h3>

<hr>

<base href="https://rust-lang.zulipchat.com">

<head><link href="https://zulip-archive.rust-lang.org/style.css" rel="stylesheet"></head>

<a name="253812195"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/debuginfo%20tests%20on%20linux/near/253812195" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/debuginfo.20tests.20on.20linux.html#253812195">(Sep 17 2021 at 21:49)</a>:</h4>
<p>I see failures here:</p>
<div class="codehilite"><pre><span></span><code>failures:
    [debuginfo-gdb] debuginfo/function-names.rs
</code></pre></div>
<p>Any idea what's going on, dear rustc world?</p>



<a name="253812250"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/debuginfo%20tests%20on%20linux/near/253812250" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/debuginfo.20tests.20on.20linux.html#253812250">(Sep 17 2021 at 21:50)</a>:</h4>
<div class="codehilite"><pre><span></span><code>---- [debuginfo-gdb] debuginfo/function-names.rs stdout ----
NOTE: compiletest thinks it is using GDB with native rust support
NOTE: compiletest thinks it is using GDB version 10001090

error: line not found in debugger output: [...]static fn function_names::generic_func(i32) -&gt; i32;
status: exit status: 0
command: &quot;/usr/bin/gdb&quot; &quot;-quiet&quot; &quot;-batch&quot; &quot;-nx&quot; &quot;-command=/home/nmatsakis/versioned/rust-5/build/x86_64-unknown-linux-gnu/test/debuginfo/function-names.gdb/function-names.debugger.script&quot;
stdout:
------------------------------------------
GNU gdb (Debian 10.1-1.7) 10.1.90.20210103-git
Copyright (C) 2021 Free Software Foundation, Inc.
License GPLv3+: GNU GPL version 3 or later &lt;http://gnu.org/licenses/gpl.html&gt;
This is free software: you are free to change and redistribute it.
There is NO WARRANTY, to the extent permitted by law.
Type &quot;show copying&quot; and &quot;show warranty&quot; for details.
This GDB was configured as &quot;x86_64-linux-gnu&quot;.
Type &quot;show configuration&quot; for configuration details.
For bug reporting instructions, please see:
&lt;https://www.gnu.org/software/gdb/bugs/&gt;.
Find the GDB manual and other documentation resources online at:
    &lt;http://www.gnu.org/software/gdb/documentation/&gt;.

For help, type &quot;help&quot;.
Type &quot;apropos word&quot; to search for commands related to &quot;word&quot;.

File /home/nmatsakis/versioned/rust-5/src/test/debuginfo/function-names.rs:
92:     static fn function_names::main();
109:    static fn function_names::main::{closure#0}(*mut function_names::main::{closure#0});
113:    static fn function_names::main::{generator#1}(core::pin::Pin&lt;&amp;mut function_names::main::{generator#1}&gt;, ()) -&gt; core::ops::generator::GeneratorState;

File /home/nmatsakis/versioned/rust-5/src/test/debuginfo/function-names.rs:
192:    static fn function_names::generic_func::{closure#0}&lt;i32&gt;(*mut function_names::generic_func::{closure#0});
190:    static fn function_names::generic_func&lt;i32&gt;(i32) -&gt; i32;

File /home/nmatsakis/versioned/rust-5/src/test/debuginfo/function-names.rs:
158:    static fn function_names::GenericStruct&lt;i32, i32&gt;::impl_function&lt;i32, i32&gt;();
146:    static fn function_names::Mod1::TestStruct2::impl_function();
130:    static fn function_names::TestStruct1::impl_function();
160:    static fn function_names::{impl#2}::impl_function::{closure#0}&lt;i32, i32&gt;(*mut function_names::{impl#2}::impl_function::{closure#0});

File /home/nmatsakis/versioned/rust-5/src/test/debuginfo/function-names.rs:
150:    static fn function_names::Mod1::{impl#1}::trait_function();
135:    static fn function_names::{impl#1}::trait_function();
167:    static fn function_names::{impl#3}::trait_function&lt;i32&gt;();
181:    static fn function_names::{impl#5}::trait_function3&lt;function_names::TestStruct1&gt;();
186:    static fn function_names::{impl#6}::trait_function&lt;i32, 1&gt;();

File /home/nmatsakis/versioned/rust-5/src/test/debuginfo/function-names.rs:
198:    static fn function_names::const_generic_fn_bool&lt;false&gt;();
199:    static fn function_names::const_generic_fn_non_int&lt;{CONST#fe3cfa0214ac55c7}&gt;();
200:    static fn function_names::const_generic_fn_signed_int&lt;-7&gt;();
201:    static fn function_names::const_generic_fn_unsigned_int&lt;14&gt;();

------------------------------------------
stderr:
------------------------------------------

------------------------------------------



failures:
    [debuginfo-gdb] debuginfo/function-names.rs

test result: FAILED. 102 passed; 1 failed; 30 ignored; 0 measured; 0 filtered out; finished in 3.07s

Some tests failed in compiletest suite=debuginfo mode=debuginfo host=x86_64-unknown-linux-gnu target=x86_64-unknown-linux-gnu
</code></pre></div>



<a name="253812273"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/debuginfo%20tests%20on%20linux/near/253812273" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/debuginfo.20tests.20on.20linux.html#253812273">(Sep 17 2021 at 21:50)</a>:</h4>
<p>Highly doubt it's my patch :)</p>



<a name="253813389"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/debuginfo%20tests%20on%20linux/near/253813389" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> The 8472 <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/debuginfo.20tests.20on.20linux.html#253813389">(Sep 17 2021 at 22:01)</a>:</h4>
<p>locally or in CI?</p>



<a name="253813574"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/debuginfo%20tests%20on%20linux/near/253813574" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> The 8472 <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/debuginfo.20tests.20on.20linux.html#253813574">(Sep 17 2021 at 22:03)</a>:</h4>
<p>oh yeah, paths imply locally.</p>



<a name="253813602"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/debuginfo%20tests%20on%20linux/near/253813602" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> The 8472 <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/debuginfo.20tests.20on.20linux.html#253813602">(Sep 17 2021 at 22:03)</a>:</h4>
<p>In that case I guess you turned on debuginfo? that breaks a few tests.</p>



<a name="253813791"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/debuginfo%20tests%20on%20linux/near/253813791" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> The 8472 <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/debuginfo.20tests.20on.20linux.html#253813791">(Sep 17 2021 at 22:05)</a>:</h4>
<p>or it could be a wrong gdb version. you could try using the docker scripts for testing instead, those should have the right ones</p>



<a name="253813941"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/debuginfo%20tests%20on%20linux/near/253813941" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joshua Nelson <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/debuginfo.20tests.20on.20linux.html#253813941">(Sep 17 2021 at 22:06)</a>:</h4>
<p><span class="user-mention silent" data-user-id="330154">The 8472</span> <a href="#narrow/stream/131828-t-compiler/topic/debuginfo.20tests.20on.20linux/near/253813602">said</a>:</p>
<blockquote>
<p>In that case I guess you turned on debuginfo? that breaks a few tests.</p>
</blockquote>
<p>(probably turned _off_ debuginfo given the other zulip thread)</p>



<a name="253814000"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/debuginfo%20tests%20on%20linux/near/253814000" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> simulacrum <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/debuginfo.20tests.20on.20linux.html#253814000">(Sep 17 2021 at 22:07)</a>:</h4>
<p>Do you have new-symbol-mangling turned on perhaps?</p>



<a name="253814016"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/debuginfo%20tests%20on%20linux/near/253814016" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> simulacrum <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/debuginfo.20tests.20on.20linux.html#253814016">(Sep 17 2021 at 22:07)</a>:</h4>
<p>190:    static fn function_names::generic_func&lt;i32&gt;(i32) -&gt; i32; is the line corresponding to the one we're looking for, I think</p>



<a name="253814211"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/debuginfo%20tests%20on%20linux/near/253814211" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> simulacrum <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/debuginfo.20tests.20on.20linux.html#253814211">(Sep 17 2021 at 22:09)</a>:</h4>
<blockquote>
<p>2021-09-17T19:14:22.9895426Z test [debuginfo-gdb] debuginfo/function-names.rs ... [33mignored(B[m</p>
</blockquote>



<a name="253814235"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/debuginfo%20tests%20on%20linux/near/253814235" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> simulacrum <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/debuginfo.20tests.20on.20linux.html#253814235">(Sep 17 2021 at 22:09)</a>:</h4>
<p>hm. we might just not even be checking that test in CI</p>



<a name="253814493"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/debuginfo%20tests%20on%20linux/near/253814493" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> simulacrum <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/debuginfo.20tests.20on.20linux.html#253814493">(Sep 17 2021 at 22:11)</a>:</h4>
<p>yeah, spot checking a few builders, I don't think we have gdb &gt;= 10.1 anywhere</p>



<a name="253814507"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/debuginfo%20tests%20on%20linux/near/253814507" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> simulacrum <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/debuginfo.20tests.20on.20linux.html#253814507">(Sep 17 2021 at 22:11)</a>:</h4>
<p>So <span class="user-mention" data-user-id="116009">@nikomatsakis</span> that test is just broken, probably</p>



<a name="253814661"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/debuginfo%20tests%20on%20linux/near/253814661" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> simulacrum <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/debuginfo.20tests.20on.20linux.html#253814661">(Sep 17 2021 at 22:13)</a>:</h4>
<p>and indeed probably <a href="https://github.com/rust-lang/rust/commit/f60d333affb62b5aaec52efddc54db46ead9cf5e">f60d333affb62b5aaec52efddc54db46ead9cf5e</a> just "fixed" function-names and <a href="http://function-call.rs">function-call.rs</a> by no longer testing them in CI</p>



<a name="253814781"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/debuginfo%20tests%20on%20linux/near/253814781" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joshua Nelson <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/debuginfo.20tests.20on.20linux.html#253814781">(Sep 17 2021 at 22:14)</a>:</h4>
<p>it would be nice to have a tidy check that tests get run in at least <em>one</em> CI builder</p>



<a name="253814819"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/debuginfo%20tests%20on%20linux/near/253814819" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joshua Nelson <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/debuginfo.20tests.20on.20linux.html#253814819">(Sep 17 2021 at 22:14)</a>:</h4>
<p>not sure how you could implement it though, it would have to have pretty deep knowledge of what's installed</p>



<a name="253814832"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/debuginfo%20tests%20on%20linux/near/253814832" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> simulacrum <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/debuginfo.20tests.20on.20linux.html#253814832">(Sep 17 2021 at 22:14)</a>:</h4>
<p>it's not really tidy that would check that</p>



<a name="253814856"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/debuginfo%20tests%20on%20linux/near/253814856" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> simulacrum <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/debuginfo.20tests.20on.20linux.html#253814856">(Sep 17 2021 at 22:14)</a>:</h4>
<p>we've long wanted to collect which tests/steps were run on each builder precisely for this kind of testing</p>



<a name="253814885"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/debuginfo%20tests%20on%20linux/near/253814885" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> simulacrum <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/debuginfo.20tests.20on.20linux.html#253814885">(Sep 17 2021 at 22:15)</a>:</h4>
<p>but it's a pretty big task and there's not much infra bandwidth these days</p>



<a name="253820969"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/debuginfo%20tests%20on%20linux/near/253820969" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> cuviper <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/debuginfo.20tests.20on.20linux.html#253820969">(Sep 17 2021 at 23:31)</a>:</h4>
<p>FWIW that test fails in Fedora rpm builds too</p>



<a name="253821000"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/debuginfo%20tests%20on%20linux/near/253821000" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> cuviper <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/debuginfo.20tests.20on.20linux.html#253821000">(Sep 17 2021 at 23:32)</a>:</h4>
<p>(<code>GNU gdb (GDB) Fedora 10.2-6.fc35</code>)</p>



<a name="253821293"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/debuginfo%20tests%20on%20linux/near/253821293" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> cuviper <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/debuginfo.20tests.20on.20linux.html#253821293">(Sep 17 2021 at 23:34)</a>:</h4>
<p>Oh I see what you mean now, <code>min-gdb-version: 10.1</code> has been gating it on older CI configs</p>



<hr><p>Last updated: Apr 12 2022 at 20:01 UTC</p>
</html>