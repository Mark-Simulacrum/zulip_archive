<html>
<head><meta charset="utf-8"><title>Add -C dlltool for raw-dylibs? · t-compiler · Zulip Chat Archive</title></head>
<h2>Stream: <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/index.html">t-compiler</a></h2>
<h3>Topic: <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/Add.20-C.20dlltool.20for.20raw-dylibs.3F.html">Add -C dlltool for raw-dylibs?</a></h3>

<hr>

<base href="https://rust-lang.zulipchat.com">

<head><link href="https://zulip-archive.rust-lang.org/style.css" rel="stylesheet"></head>

<a name="266927404"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/Add%20-C%20dlltool%20for%20raw-dylibs%3F/near/266927404" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> mw <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/Add.20-C.20dlltool.20for.20raw-dylibs.3F.html#266927404">(Jan 05 2022 at 12:11)</a>:</h4>
<p>tl;dr: How to add a stable <code>-C dlltool</code> flag that is not mentioned in the original <a href="https://github.com/rust-lang/rfcs/blob/master/text/2627-raw-dylib-kind.md">raw-dylib RFC</a>? Are there alternatives?</p>
<p>Hey everyone! I've been reviewing <span class="user-mention" data-user-id="379933">@Richard Cobbe</span>'s PR that implements raw-dylibs for MinGW. The PR makes <code>rustc</code> invoke <code>dlltool</code> for creating the required DLL import library instead of letting LLVM do that. This is necessary because the MinGW toolchain apparently cannot handle the import libraries generated via LLVM.</p>
<p>The PR makes the compiler attempt to find the right <code>dlltool</code> automatically. But, as <span class="user-mention" data-user-id="123586">@nagisa</span> pointed out, it is problematic to make the compiler rely on automatic detection exclusively -- in case the system is in a state that the compiler cannot handle. Therefore the PR adds a <code>-Z dlltool</code> flag to the compiler that enables overriding the automated selection.</p>
<p>The problem is that the flag is not mentioned in the raw-dylib RFC -- but we need the flag to become stable eventually. So my question is: <em>What's  the process here?</em> Do we just mentioned the additional flag in the stabilization PR for the entire raw-dylib feature and thus make it part of the FCP vote? Do we amend the RFC? Do we create a major change proposal (which is kind of weird for a flag that hasn't even been merged yet)?</p>
<p>Even better would be to find a way of enabling explicit <code>dlltool</code> selection without a new stable flag -- but so far no one on the PR thread had a good idea about how to do that.</p>



<a name="266927528"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/Add%20-C%20dlltool%20for%20raw-dylibs%3F/near/266927528" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nagisa <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/Add.20-C.20dlltool.20for.20raw-dylibs.3F.html#266927528">(Jan 05 2022 at 12:12)</a>:</h4>
<p>Tracking issue and FCP are sufficient for flags of this sort.</p>



<a name="266927607"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/Add%20-C%20dlltool%20for%20raw-dylibs%3F/near/266927607" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nagisa <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/Add.20-C.20dlltool.20for.20raw-dylibs.3F.html#266927607">(Jan 05 2022 at 12:13)</a>:</h4>
<p>whether its a new one or a part of an existing one really depends on conceptual relationships between features. <code>dlltool</code> flag seems closely related to <code>raw-dylib</code> feature, so rolling it up into the raw-dylib tracking issue seems reasonable to me.</p>



<a name="267038031"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/Add%20-C%20dlltool%20for%20raw-dylibs%3F/near/267038031" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> mw <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/Add.20-C.20dlltool.20for.20raw-dylibs.3F.html#267038031">(Jan 06 2022 at 08:57)</a>:</h4>
<p>Thanks for the quick reply, <span class="user-mention" data-user-id="123586">@nagisa</span>! Sounds good to me then.</p>



<hr><p>Last updated: Apr 12 2022 at 20:01 UTC</p>
</html>