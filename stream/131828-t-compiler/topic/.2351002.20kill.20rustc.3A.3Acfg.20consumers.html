<html>
<head><meta charset="utf-8"><title>#51002 kill rustc::cfg consumers · t-compiler · Zulip Chat Archive</title></head>
<h2>Stream: <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/index.html">t-compiler</a></h2>
<h3>Topic: <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/.2351002.20kill.20rustc.3A.3Acfg.20consumers.html">#51002 kill rustc::cfg consumers</a></h3>

<hr>

<base href="https://rust-lang.zulipchat.com">

<head><link href="https://rust-lang.github.io/zulip_archive/style.css" rel="stylesheet"></head>

<a name="133801741"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/%2351002%20kill%20rustc%3A%3Acfg%20consumers/near/133801741" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wesley Wiser <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/.2351002.20kill.20rustc.3A.3Acfg.20consumers.html#133801741">(Sep 12 2018 at 14:19)</a>:</h4>
<p>So I took a stab at rewriting the <code>UnconditionalRecursion</code> lint to operate on MIR instead of the <code>CFG</code>. I've got something that basically works but I want to make sure my approach is reasonable. </p>
<p>To get the mir for a function, I'm using the <code>optimized_mir()</code> query. I've tried using some of the other queries such as <code>mir_built()</code>but since <code>UnconditionalRecursion</code> is a late lint, those other MIR queries' values have already been stolen and are unavailable.  I tried making <code>UnconditionalRecursion</code> an early lint instead but I can't find any <code>TyCtxt</code>s available to early lints and so I don't know how to get the MIR at all in an early lint context.</p>
<p>Is using the optimized MIR ok or is there something else I should be using?</p>



<a name="133810389"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/%2351002%20kill%20rustc%3A%3Acfg%20consumers/near/133810389" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/.2351002.20kill.20rustc.3A.3Acfg.20consumers.html#133810389">(Sep 12 2018 at 16:28)</a>:</h4>
<p>I .. huh</p>



<a name="133810401"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/%2351002%20kill%20rustc%3A%3Acfg%20consumers/near/133810401" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/.2351002.20kill.20rustc.3A.3Acfg.20consumers.html#133810401">(Sep 12 2018 at 16:28)</a>:</h4>
<p>this feels like something that should use unoptimized MIR to me</p>



<a name="133810409"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/%2351002%20kill%20rustc%3A%3Acfg%20consumers/near/133810409" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/.2351002.20kill.20rustc.3A.3Acfg.20consumers.html#133810409">(Sep 12 2018 at 16:28)</a>:</h4>
<p>I think we should rework the way lints are setup anyway</p>



<a name="133810420"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/%2351002%20kill%20rustc%3A%3Acfg%20consumers/near/133810420" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wesley Wiser <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/.2351002.20kill.20rustc.3A.3Acfg.20consumers.html#133810420">(Sep 12 2018 at 16:28)</a>:</h4>
<p>So, having thought it about some more, we shouldn't use optimized mir at all since that means the warning may or may not fire depending on optimization levels</p>



<a name="133810421"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/%2351002%20kill%20rustc%3A%3Acfg%20consumers/near/133810421" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/.2351002.20kill.20rustc.3A.3Acfg.20consumers.html#133810421">(Sep 12 2018 at 16:28)</a>:</h4>
<p>right</p>



<a name="133810434"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/%2351002%20kill%20rustc%3A%3Acfg%20consumers/near/133810434" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/.2351002.20kill.20rustc.3A.3Acfg.20consumers.html#133810434">(Sep 12 2018 at 16:29)</a>:</h4>
<p>I think what you would want to do is to have the MIR thief invoke the lint setup run</p>



<a name="133810435"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/%2351002%20kill%20rustc%3A%3Acfg%20consumers/near/133810435" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/.2351002.20kill.20rustc.3A.3Acfg.20consumers.html#133810435">(Sep 12 2018 at 16:29)</a>:</h4>
<p>and not use any "lint runner" thing</p>



<a name="133810440"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/%2351002%20kill%20rustc%3A%3Acfg%20consumers/near/133810440" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/.2351002.20kill.20rustc.3A.3Acfg.20consumers.html#133810440">(Sep 12 2018 at 16:29)</a>:</h4>
<p>probably we want to have some meta-query that is like "analyze"</p>



<a name="133810443"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/%2351002%20kill%20rustc%3A%3Acfg%20consumers/near/133810443" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/.2351002.20kill.20rustc.3A.3Acfg.20consumers.html#133810443">(Sep 12 2018 at 16:29)</a>:</h4>
<p>alternatively, make MIR borrowck do it</p>



<a name="133810446"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/%2351002%20kill%20rustc%3A%3Acfg%20consumers/near/133810446" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/.2351002.20kill.20rustc.3A.3Acfg.20consumers.html#133810446">(Sep 12 2018 at 16:29)</a>:</h4>
<p>same idea</p>



<a name="133810450"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/%2351002%20kill%20rustc%3A%3Acfg%20consumers/near/133810450" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/.2351002.20kill.20rustc.3A.3Acfg.20consumers.html#133810450">(Sep 12 2018 at 16:29)</a>:</h4>
<p>(just that MIR borrowck is that meta-query)</p>



<a name="133810456"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/%2351002%20kill%20rustc%3A%3Acfg%20consumers/near/133810456" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wesley Wiser <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/.2351002.20kill.20rustc.3A.3Acfg.20consumers.html#133810456">(Sep 12 2018 at 16:29)</a>:</h4>
<p>Hmm. So turn this lint into a query essentially?</p>



<a name="133810523"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/%2351002%20kill%20rustc%3A%3Acfg%20consumers/near/133810523" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/.2351002.20kill.20rustc.3A.3Acfg.20consumers.html#133810523">(Sep 12 2018 at 16:30)</a>:</h4>
<p>yeah</p>



<a name="133810529"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/%2351002%20kill%20rustc%3A%3Acfg%20consumers/near/133810529" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/.2351002.20kill.20rustc.3A.3Acfg.20consumers.html#133810529">(Sep 12 2018 at 16:30)</a>:</h4>
<p>it doesn't have to actually be a query</p>



<a name="133810535"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/%2351002%20kill%20rustc%3A%3Acfg%20consumers/near/133810535" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/.2351002.20kill.20rustc.3A.3Acfg.20consumers.html#133810535">(Sep 12 2018 at 16:30)</a>:</h4>
<p>it can just be a fn that <code>mir_borrowck</code> calls</p>



<a name="133810538"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/%2351002%20kill%20rustc%3A%3Acfg%20consumers/near/133810538" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wesley Wiser <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/.2351002.20kill.20rustc.3A.3Acfg.20consumers.html#133810538">(Sep 12 2018 at 16:30)</a>:</h4>
<p>Right</p>



<a name="133810557"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/%2351002%20kill%20rustc%3A%3Acfg%20consumers/near/133810557" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wesley Wiser <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/.2351002.20kill.20rustc.3A.3Acfg.20consumers.html#133810557">(Sep 12 2018 at 16:31)</a>:</h4>
<p>But it also needs to run from the old borrow checker right?</p>



<a name="133810595"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/%2351002%20kill%20rustc%3A%3Acfg%20consumers/near/133810595" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/.2351002.20kill.20rustc.3A.3Acfg.20consumers.html#133810595">(Sep 12 2018 at 16:31)</a>:</h4>
<p>no</p>



<a name="133810601"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/%2351002%20kill%20rustc%3A%3Acfg%20consumers/near/133810601" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/.2351002.20kill.20rustc.3A.3Acfg.20consumers.html#133810601">(Sep 12 2018 at 16:31)</a>:</h4>
<p>I don't think so</p>



<a name="133810605"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/%2351002%20kill%20rustc%3A%3Acfg%20consumers/near/133810605" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/.2351002.20kill.20rustc.3A.3Acfg.20consumers.html#133810605">(Sep 12 2018 at 16:31)</a>:</h4>
<p>I mean, we always invoke the MIR borrow check query</p>



<a name="133810608"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/%2351002%20kill%20rustc%3A%3Acfg%20consumers/near/133810608" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/.2351002.20kill.20rustc.3A.3Acfg.20consumers.html#133810608">(Sep 12 2018 at 16:31)</a>:</h4>
<p>sometimes it does nothing</p>



<a name="133810615"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/%2351002%20kill%20rustc%3A%3Acfg%20consumers/near/133810615" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/.2351002.20kill.20rustc.3A.3Acfg.20consumers.html#133810615">(Sep 12 2018 at 16:31)</a>:</h4>
<p>at least I think this is true</p>



<a name="133810616"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/%2351002%20kill%20rustc%3A%3Acfg%20consumers/near/133810616" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/.2351002.20kill.20rustc.3A.3Acfg.20consumers.html#133810616">(Sep 12 2018 at 16:31)</a>:</h4>
<p>one second</p>



<a name="133810661"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/%2351002%20kill%20rustc%3A%3Acfg%20consumers/near/133810661" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wesley Wiser <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/.2351002.20kill.20rustc.3A.3Acfg.20consumers.html#133810661">(Sep 12 2018 at 16:32)</a>:</h4>
<p>Even without <code>-Zborrowck=mir</code>?</p>



<a name="133810673"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/%2351002%20kill%20rustc%3A%3Acfg%20consumers/near/133810673" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/.2351002.20kill.20rustc.3A.3Acfg.20consumers.html#133810673">(Sep 12 2018 at 16:32)</a>:</h4>
<p>right, we check that <a href="https://github.com/rust-lang/rust/blob/6810f5286b6b91daab06fc3dccb27d8c46f14349/src/librustc_mir/borrow_check/mod.rs#L87" target="_blank" title="https://github.com/rust-lang/rust/blob/6810f5286b6b91daab06fc3dccb27d8c46f14349/src/librustc_mir/borrow_check/mod.rs#L87">right here</a></p>



<a name="133810679"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/%2351002%20kill%20rustc%3A%3Acfg%20consumers/near/133810679" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/.2351002.20kill.20rustc.3A.3Acfg.20consumers.html#133810679">(Sep 12 2018 at 16:32)</a>:</h4>
<p>so we could just invoke the lint before that :)</p>



<a name="133810690"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/%2351002%20kill%20rustc%3A%3Acfg%20consumers/near/133810690" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wesley Wiser <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/.2351002.20kill.20rustc.3A.3Acfg.20consumers.html#133810690">(Sep 12 2018 at 16:32)</a>:</h4>
<p>Oh alright</p>



<a name="133810691"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/%2351002%20kill%20rustc%3A%3Acfg%20consumers/near/133810691" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/.2351002.20kill.20rustc.3A.3Acfg.20consumers.html#133810691">(Sep 12 2018 at 16:32)</a>:</h4>
<p>one problem (maybe?) is that you'll get these lint messages before borrowck</p>



<a name="133810695"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/%2351002%20kill%20rustc%3A%3Acfg%20consumers/near/133810695" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wesley Wiser <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/.2351002.20kill.20rustc.3A.3Acfg.20consumers.html#133810695">(Sep 12 2018 at 16:32)</a>:</h4>
<p>Makes sense</p>



<a name="133810699"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/%2351002%20kill%20rustc%3A%3Acfg%20consumers/near/133810699" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/.2351002.20kill.20rustc.3A.3Acfg.20consumers.html#133810699">(Sep 12 2018 at 16:32)</a>:</h4>
<p>you can rejigger to run in whatever order...</p>



<a name="133810717"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/%2351002%20kill%20rustc%3A%3Acfg%20consumers/near/133810717" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wesley Wiser <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/.2351002.20kill.20rustc.3A.3Acfg.20consumers.html#133810717">(Sep 12 2018 at 16:33)</a>:</h4>
<p>Are we going to want additional "mir lints" in the future?</p>



<a name="133810725"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/%2351002%20kill%20rustc%3A%3Acfg%20consumers/near/133810725" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/.2351002.20kill.20rustc.3A.3Acfg.20consumers.html#133810725">(Sep 12 2018 at 16:33)</a>:</h4>
<p>probably?</p>



<a name="133810733"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/%2351002%20kill%20rustc%3A%3Acfg%20consumers/near/133810733" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/.2351002.20kill.20rustc.3A.3Acfg.20consumers.html#133810733">(Sep 12 2018 at 16:33)</a>:</h4>
<p>I can think of a few ...</p>



<a name="133810741"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/%2351002%20kill%20rustc%3A%3Acfg%20consumers/near/133810741" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wesley Wiser <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/.2351002.20kill.20rustc.3A.3Acfg.20consumers.html#133810741">(Sep 12 2018 at 16:33)</a>:</h4>
<p>Would it be worth adding a <code>MirLint</code> trait in addition to our <code>EarlyLint</code> and <code>LateLint</code>?</p>



<a name="133810793"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/%2351002%20kill%20rustc%3A%3Acfg%20consumers/near/133810793" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wesley Wiser <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/.2351002.20kill.20rustc.3A.3Acfg.20consumers.html#133810793">(Sep 12 2018 at 16:34)</a>:</h4>
<p>I think there's an open issue about <code>Copy</code>ing large types... that's probably a good candidate for a mir lint too</p>



<a name="133810828"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/%2351002%20kill%20rustc%3A%3Acfg%20consumers/near/133810828" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/.2351002.20kill.20rustc.3A.3Acfg.20consumers.html#133810828">(Sep 12 2018 at 16:34)</a>:</h4>
<p>that's the one I was thinking of. <span class="user-mention" data-user-id="116013">@qmx</span> has a sort of working version of it, even</p>



<a name="133810847"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/%2351002%20kill%20rustc%3A%3Acfg%20consumers/near/133810847" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/.2351002.20kill.20rustc.3A.3Acfg.20consumers.html#133810847">(Sep 12 2018 at 16:35)</a>:</h4>
<blockquote>
<p>Would it be worth adding a <code>MirLint</code> trait in addition to our <code>EarlyLint</code> and <code>LateLint</code>?</p>
</blockquote>
<p>I... maybe? I mean it's just a function that takes a MIR, basically?</p>



<a name="133810857"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/%2351002%20kill%20rustc%3A%3Acfg%20consumers/near/133810857" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/.2351002.20kill.20rustc.3A.3Acfg.20consumers.html#133810857">(Sep 12 2018 at 16:35)</a>:</h4>
<p>I'm not a big fan of the current "register lint" system because it's shared mutable state</p>



<a name="133810861"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/%2351002%20kill%20rustc%3A%3Acfg%20consumers/near/133810861" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/.2351002.20kill.20rustc.3A.3Acfg.20consumers.html#133810861">(Sep 12 2018 at 16:35)</a>:</h4>
<p>bad mojo</p>



<a name="133810870"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/%2351002%20kill%20rustc%3A%3Acfg%20consumers/near/133810870" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/.2351002.20kill.20rustc.3A.3Acfg.20consumers.html#133810870">(Sep 12 2018 at 16:35)</a>:</h4>
<p>I think I'd rather we just invoke the lints by hand as we add them</p>



<a name="133810871"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/%2351002%20kill%20rustc%3A%3Acfg%20consumers/near/133810871" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wesley Wiser <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/.2351002.20kill.20rustc.3A.3Acfg.20consumers.html#133810871">(Sep 12 2018 at 16:35)</a>:</h4>
<p>Yeah, I was thinking more about the registration infrastructure around the existing lints system</p>



<a name="133810874"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/%2351002%20kill%20rustc%3A%3Acfg%20consumers/near/133810874" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wesley Wiser <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/.2351002.20kill.20rustc.3A.3Acfg.20consumers.html#133810874">(Sep 12 2018 at 16:35)</a>:</h4>
<p>Ah ok :)</p>



<a name="133810882"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/%2351002%20kill%20rustc%3A%3Acfg%20consumers/near/133810882" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/.2351002.20kill.20rustc.3A.3Acfg.20consumers.html#133810882">(Sep 12 2018 at 16:35)</a>:</h4>
<p>I guess I don't have a strong opinion</p>



<a name="133810884"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/%2351002%20kill%20rustc%3A%3Acfg%20consumers/near/133810884" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/.2351002.20kill.20rustc.3A.3Acfg.20consumers.html#133810884">(Sep 12 2018 at 16:36)</a>:</h4>
<p>but I think the lint infrastructure has to be changed to really fit the query model</p>



<a name="133810940"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/%2351002%20kill%20rustc%3A%3Acfg%20consumers/near/133810940" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> qmx <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/.2351002.20kill.20rustc.3A.3Acfg.20consumers.html#133810940">(Sep 12 2018 at 16:36)</a>:</h4>
<p>I might have that branch laying around in my github</p>



<a name="133810945"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/%2351002%20kill%20rustc%3A%3Acfg%20consumers/near/133810945" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/.2351002.20kill.20rustc.3A.3Acfg.20consumers.html#133810945">(Sep 12 2018 at 16:36)</a>:</h4>
<p>I think <span class="user-mention" data-user-id="119009">@eddyb</span> had the idea of having people patch the query providers to insert themselves</p>



<a name="133810949"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/%2351002%20kill%20rustc%3A%3Acfg%20consumers/near/133810949" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/.2351002.20kill.20rustc.3A.3Acfg.20consumers.html#133810949">(Sep 12 2018 at 16:36)</a>:</h4>
<p>so there'd be like a <code>mir_lint</code> query</p>



<a name="133810963"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/%2351002%20kill%20rustc%3A%3Acfg%20consumers/near/133810963" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/.2351002.20kill.20rustc.3A.3Acfg.20consumers.html#133810963">(Sep 12 2018 at 16:36)</a>:</h4>
<p>by default, it does nothing</p>



<a name="133810975"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/%2351002%20kill%20rustc%3A%3Acfg%20consumers/near/133810975" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/.2351002.20kill.20rustc.3A.3Acfg.20consumers.html#133810975">(Sep 12 2018 at 16:37)</a>:</h4>
<p>to add a <code>mir_lint</code>, you overwrite the provider with our own, and it invokes what was previously there somehow</p>



<a name="133810979"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/%2351002%20kill%20rustc%3A%3Acfg%20consumers/near/133810979" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/.2351002.20kill.20rustc.3A.3Acfg.20consumers.html#133810979">(Sep 12 2018 at 16:37)</a>:</h4>
<p>not sure how that should work though</p>



<a name="133810988"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/%2351002%20kill%20rustc%3A%3Acfg%20consumers/near/133810988" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/.2351002.20kill.20rustc.3A.3Acfg.20consumers.html#133810988">(Sep 12 2018 at 16:37)</a>:</h4>
<p>maybe it wants to be another kind of provider, a sort of "multi-provider"</p>



<a name="133810992"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/%2351002%20kill%20rustc%3A%3Acfg%20consumers/near/133810992" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/.2351002.20kill.20rustc.3A.3Acfg.20consumers.html#133810992">(Sep 12 2018 at 16:37)</a>:</h4>
<p>(I think I prefer that idea)</p>



<a name="133811108"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/%2351002%20kill%20rustc%3A%3Acfg%20consumers/near/133811108" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wesley Wiser <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/.2351002.20kill.20rustc.3A.3Acfg.20consumers.html#133811108">(Sep 12 2018 at 16:39)</a>:</h4>
<p>Could just be a helper query that demands lints for every item in the crate. Then we'd get caching from the query system and not rerun lints that don't need to be</p>



<a name="133811121"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/%2351002%20kill%20rustc%3A%3Acfg%20consumers/near/133811121" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wesley Wiser <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/.2351002.20kill.20rustc.3A.3Acfg.20consumers.html#133811121">(Sep 12 2018 at 16:39)</a>:</h4>
<p>We'd have to cache the lint output though which I think we don't currently do</p>



<a name="133811192"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/%2351002%20kill%20rustc%3A%3Acfg%20consumers/near/133811192" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/.2351002.20kill.20rustc.3A.3Acfg.20consumers.html#133811192">(Sep 12 2018 at 16:40)</a>:</h4>
<blockquote>
<p>Could just be a helper query that demands lints for every item in the crate. Then we'd get caching from the query system and not rerun lints that don't need to be</p>
</blockquote>
<p>the point is, how do you know what the set of lints to run is</p>



<a name="133811197"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/%2351002%20kill%20rustc%3A%3Acfg%20consumers/near/133811197" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/.2351002.20kill.20rustc.3A.3Acfg.20consumers.html#133811197">(Sep 12 2018 at 16:40)</a>:</h4>
<p>if we just want a non-extensible set, seems fine, but we also need a way to support things like clippy</p>



<a name="133811203"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/%2351002%20kill%20rustc%3A%3Acfg%20consumers/near/133811203" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/.2351002.20kill.20rustc.3A.3Acfg.20consumers.html#133811203">(Sep 12 2018 at 16:40)</a>:</h4>
<blockquote>
<p>We'd have to cache the lint output though which I think we don't currently do</p>
</blockquote>
<p>we do</p>



<a name="133811205"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/%2351002%20kill%20rustc%3A%3Acfg%20consumers/near/133811205" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/.2351002.20kill.20rustc.3A.3Acfg.20consumers.html#133811205">(Sep 12 2018 at 16:40)</a>:</h4>
<p>at least, I belive we do</p>



<a name="133811211"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/%2351002%20kill%20rustc%3A%3Acfg%20consumers/near/133811211" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/.2351002.20kill.20rustc.3A.3Acfg.20consumers.html#133811211">(Sep 12 2018 at 16:40)</a>:</h4>
<p>anyway, that is the basic idea, regardless</p>



<a name="133811214"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/%2351002%20kill%20rustc%3A%3Acfg%20consumers/near/133811214" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wesley Wiser <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/.2351002.20kill.20rustc.3A.3Acfg.20consumers.html#133811214">(Sep 12 2018 at 16:40)</a>:</h4>
<p>Oh yes, I see</p>



<a name="133811267"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/%2351002%20kill%20rustc%3A%3Acfg%20consumers/near/133811267" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wesley Wiser <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/.2351002.20kill.20rustc.3A.3Acfg.20consumers.html#133811267">(Sep 12 2018 at 16:42)</a>:</h4>
<p>I don't really know anything about Clippy...</p>



<a name="133811320"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/%2351002%20kill%20rustc%3A%3Acfg%20consumers/near/133811320" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wesley Wiser <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/.2351002.20kill.20rustc.3A.3Acfg.20consumers.html#133811320">(Sep 12 2018 at 16:42)</a>:</h4>
<p>Regardless, it sounds like the right thing to do for now is to just call the function directly from <code>mir_borrowck()</code></p>



<a name="133811329"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/%2351002%20kill%20rustc%3A%3Acfg%20consumers/near/133811329" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wesley Wiser <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/.2351002.20kill.20rustc.3A.3Acfg.20consumers.html#133811329">(Sep 12 2018 at 16:42)</a>:</h4>
<p>That certainly resolves my issue.</p>



<a name="133811363"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/%2351002%20kill%20rustc%3A%3Acfg%20consumers/near/133811363" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> simulacrum <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/.2351002.20kill.20rustc.3A.3Acfg.20consumers.html#133811363">(Sep 12 2018 at 16:43)</a>:</h4>
<blockquote>
<p>to add a <code>mir_lint</code>, you overwrite the provider with our own, and it invokes what was previously there somehow</p>
</blockquote>
<p>The way providers work today it's just a struct of function points so that would be fairly easy to do -- we'd just want the default to be an empty function for that provider instead of a function that panics (like today)</p>



<a name="133811369"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/%2351002%20kill%20rustc%3A%3Acfg%20consumers/near/133811369" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wesley Wiser <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/.2351002.20kill.20rustc.3A.3Acfg.20consumers.html#133811369">(Sep 12 2018 at 16:43)</a>:</h4>
<p>Should I move the function out of <code>librustc_lints</code> then and into <code>librustc_mir::borrow_check</code>or leave it where it is?</p>



<a name="133811435"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/%2351002%20kill%20rustc%3A%3Acfg%20consumers/near/133811435" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/.2351002.20kill.20rustc.3A.3Acfg.20consumers.html#133811435">(Sep 12 2018 at 16:44)</a>:</h4>
<blockquote>
<p>The way providers work today it's just a struct of function points so that would be fairly easy to do -- we'd just want the default to be an empty function for that provider instead of a function that panics (like today)</p>
</blockquote>
<p>it's not that easy. You have to keep the old pointer.</p>



<a name="133811441"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/%2351002%20kill%20rustc%3A%3Acfg%20consumers/near/133811441" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/.2351002.20kill.20rustc.3A.3Acfg.20consumers.html#133811441">(Sep 12 2018 at 16:44)</a>:</h4>
<p>this is why I would rather have a "multi-provider" opton</p>



<a name="133811444"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/%2351002%20kill%20rustc%3A%3Acfg%20consumers/near/133811444" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/.2351002.20kill.20rustc.3A.3Acfg.20consumers.html#133811444">(Sep 12 2018 at 16:44)</a>:</h4>
<p>where the struct itself has a <code>Vec</code> or something</p>



<a name="133811448"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/%2351002%20kill%20rustc%3A%3Acfg%20consumers/near/133811448" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/.2351002.20kill.20rustc.3A.3Acfg.20consumers.html#133811448">(Sep 12 2018 at 16:44)</a>:</h4>
<p>it also feels more declarative</p>



<a name="133811452"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/%2351002%20kill%20rustc%3A%3Acfg%20consumers/near/133811452" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wesley Wiser <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/.2351002.20kill.20rustc.3A.3Acfg.20consumers.html#133811452">(Sep 12 2018 at 16:44)</a>:</h4>
<p>Is Clippy interested in running the built-in lints too?</p>



<a name="133811459"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/%2351002%20kill%20rustc%3A%3Acfg%20consumers/near/133811459" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/.2351002.20kill.20rustc.3A.3Acfg.20consumers.html#133811459">(Sep 12 2018 at 16:44)</a>:</h4>
<p>(one question is whether we want to hash this set, too, we've not really .. figured out how that works with incremental)</p>



<a name="133811532"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/%2351002%20kill%20rustc%3A%3Acfg%20consumers/near/133811532" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wesley Wiser <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/.2351002.20kill.20rustc.3A.3Acfg.20consumers.html#133811532">(Sep 12 2018 at 16:46)</a>:</h4>
<p>You could also have a query for <code>additional_lints()</code> and then <code>mir_lint()</code> just unions the built-in ones with anything returned from <code>additional_lints()</code>. rustc would return an empty set for <code>additional_lints()</code> but Clippy would return their lints.</p>



<a name="133811587"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/%2351002%20kill%20rustc%3A%3Acfg%20consumers/near/133811587" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/.2351002.20kill.20rustc.3A.3Acfg.20consumers.html#133811587">(Sep 12 2018 at 16:47)</a>:</h4>
<p>what kind of value is that?</p>



<a name="133811588"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/%2351002%20kill%20rustc%3A%3Acfg%20consumers/near/133811588" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/.2351002.20kill.20rustc.3A.3Acfg.20consumers.html#133811588">(Sep 12 2018 at 16:47)</a>:</h4>
<p>how do we hash it?</p>



<a name="133811642"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/%2351002%20kill%20rustc%3A%3Acfg%20consumers/near/133811642" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/.2351002.20kill.20rustc.3A.3Acfg.20consumers.html#133811642">(Sep 12 2018 at 16:48)</a>:</h4>
<p>it sounds like you would be returning fn ptrs or trait objects</p>



<a name="133811645"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/%2351002%20kill%20rustc%3A%3Acfg%20consumers/near/133811645" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/.2351002.20kill.20rustc.3A.3Acfg.20consumers.html#133811645">(Sep 12 2018 at 16:48)</a>:</h4>
<p>... we'd have to work that out</p>



<a name="133811650"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/%2351002%20kill%20rustc%3A%3Acfg%20consumers/near/133811650" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/.2351002.20kill.20rustc.3A.3Acfg.20consumers.html#133811650">(Sep 12 2018 at 16:48)</a>:</h4>
<p>this is why I was pushing it into the providers, which is where fn poitners currently live</p>



<a name="133811652"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/%2351002%20kill%20rustc%3A%3Acfg%20consumers/near/133811652" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/.2351002.20kill.20rustc.3A.3Acfg.20consumers.html#133811652">(Sep 12 2018 at 16:48)</a>:</h4>
<p>it doesn't exactly dodge the question</p>



<a name="133811656"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/%2351002%20kill%20rustc%3A%3Acfg%20consumers/near/133811656" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/.2351002.20kill.20rustc.3A.3Acfg.20consumers.html#133811656">(Sep 12 2018 at 16:48)</a>:</h4>
<p>but it sort of does</p>



<a name="133811661"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/%2351002%20kill%20rustc%3A%3Acfg%20consumers/near/133811661" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/.2351002.20kill.20rustc.3A.3Acfg.20consumers.html#133811661">(Sep 12 2018 at 16:48)</a>:</h4>
<p>because we can say that the "provider setup" routine</p>



<a name="133811666"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/%2351002%20kill%20rustc%3A%3Acfg%20consumers/near/133811666" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/.2351002.20kill.20rustc.3A.3Acfg.20consumers.html#133811666">(Sep 12 2018 at 16:49)</a>:</h4>
<p>is kind of "hashed" somehow (e.g., with the names + versions of the plugins we run)</p>



<a name="133811667"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/%2351002%20kill%20rustc%3A%3Acfg%20consumers/near/133811667" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wesley Wiser <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/.2351002.20kill.20rustc.3A.3Acfg.20consumers.html#133811667">(Sep 12 2018 at 16:49)</a>:</h4>
<p>You could always have a tuple of <code>(metadata id, fn ptr)</code> and just hash the metadata</p>



<a name="133811681"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/%2351002%20kill%20rustc%3A%3Acfg%20consumers/near/133811681" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/.2351002.20kill.20rustc.3A.3Acfg.20consumers.html#133811681">(Sep 12 2018 at 16:49)</a>:</h4>
<p>yes, you could also do that</p>



<a name="133811684"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/%2351002%20kill%20rustc%3A%3Acfg%20consumers/near/133811684" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/.2351002.20kill.20rustc.3A.3Acfg.20consumers.html#133811684">(Sep 12 2018 at 16:49)</a>:</h4>
<p>personally, I'd rather we not pass around random trait objects</p>



<a name="133811687"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/%2351002%20kill%20rustc%3A%3Acfg%20consumers/near/133811687" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wesley Wiser <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/.2351002.20kill.20rustc.3A.3Acfg.20consumers.html#133811687">(Sep 12 2018 at 16:49)</a>:</h4>
<p>That's fair</p>



<a name="133811690"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/%2351002%20kill%20rustc%3A%3Acfg%20consumers/near/133811690" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/.2351002.20kill.20rustc.3A.3Acfg.20consumers.html#133811690">(Sep 12 2018 at 16:49)</a>:</h4>
<p>(though I guess fn ptrs might be ok)</p>



<a name="133811692"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/%2351002%20kill%20rustc%3A%3Acfg%20consumers/near/133811692" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/.2351002.20kill.20rustc.3A.3Acfg.20consumers.html#133811692">(Sep 12 2018 at 16:49)</a>:</h4>
<p>it just feels cleaner to push that into a setup phase</p>



<a name="133811695"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/%2351002%20kill%20rustc%3A%3Acfg%20consumers/near/133811695" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/.2351002.20kill.20rustc.3A.3Acfg.20consumers.html#133811695">(Sep 12 2018 at 16:50)</a>:</h4>
<p>less room for error</p>



<a name="133811743"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/%2351002%20kill%20rustc%3A%3Acfg%20consumers/near/133811743" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wesley Wiser <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/.2351002.20kill.20rustc.3A.3Acfg.20consumers.html#133811743">(Sep 12 2018 at 16:50)</a>:</h4>
<p>Regardless, I've got my answer for the <code>UnconditionalRecursion</code> lint question :)</p>



<a name="133811744"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/%2351002%20kill%20rustc%3A%3Acfg%20consumers/near/133811744" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/.2351002.20kill.20rustc.3A.3Acfg.20consumers.html#133811744">(Sep 12 2018 at 16:50)</a>:</h4>
<p>:)</p>



<a name="133811765"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/%2351002%20kill%20rustc%3A%3Acfg%20consumers/near/133811765" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wesley Wiser <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/.2351002.20kill.20rustc.3A.3Acfg.20consumers.html#133811765">(Sep 12 2018 at 16:50)</a>:</h4>
<p>Should I move that code out of <code>librust_lints</code> since it's not used there anymore or leave it since it is a lint?</p>



<a name="133811799"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/%2351002%20kill%20rustc%3A%3Acfg%20consumers/near/133811799" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/.2351002.20kill.20rustc.3A.3Acfg.20consumers.html#133811799">(Sep 12 2018 at 16:51)</a>:</h4>
<p>I think you should move it out, maybe make <code>librustc_mir/lints</code>?</p>



<a name="133811800"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/%2351002%20kill%20rustc%3A%3Acfg%20consumers/near/133811800" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wesley Wiser <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/.2351002.20kill.20rustc.3A.3Acfg.20consumers.html#133811800">(Sep 12 2018 at 16:51)</a>:</h4>
<p>Not super important I suppose but I don't know what the desired architecture is here</p>



<a name="133811804"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/%2351002%20kill%20rustc%3A%3Acfg%20consumers/near/133811804" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/.2351002.20kill.20rustc.3A.3Acfg.20consumers.html#133811804">(Sep 12 2018 at 16:51)</a>:</h4>
<p>yeah, who knows :)</p>



<a name="133811811"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/%2351002%20kill%20rustc%3A%3Acfg%20consumers/near/133811811" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wesley Wiser <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/.2351002.20kill.20rustc.3A.3Acfg.20consumers.html#133811811">(Sep 12 2018 at 16:52)</a>:</h4>
<p>Ok, will do!</p>



<a name="133811849"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/%2351002%20kill%20rustc%3A%3Acfg%20consumers/near/133811849" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/.2351002.20kill.20rustc.3A.3Acfg.20consumers.html#133811849">(Sep 12 2018 at 16:52)</a>:</h4>
<p>I'm opinionated but others may also be</p>



<a name="133811865"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/%2351002%20kill%20rustc%3A%3Acfg%20consumers/near/133811865" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/.2351002.20kill.20rustc.3A.3Acfg.20consumers.html#133811865">(Sep 12 2018 at 16:52)</a>:</h4>
<p>but I'd rather not make <code>librustc_mir</code> depend <code>librustc_lints</code></p>



<a name="133811867"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/%2351002%20kill%20rustc%3A%3Acfg%20consumers/near/133811867" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/.2351002.20kill.20rustc.3A.3Acfg.20consumers.html#133811867">(Sep 12 2018 at 16:52)</a>:</h4>
<p>so .. :)</p>



<a name="133811871"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/%2351002%20kill%20rustc%3A%3Acfg%20consumers/near/133811871" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wesley Wiser <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/.2351002.20kill.20rustc.3A.3Acfg.20consumers.html#133811871">(Sep 12 2018 at 16:52)</a>:</h4>
<p>Good point</p>



<a name="133811877"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/%2351002%20kill%20rustc%3A%3Acfg%20consumers/near/133811877" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wesley Wiser <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/.2351002.20kill.20rustc.3A.3Acfg.20consumers.html#133811877">(Sep 12 2018 at 16:53)</a>:</h4>
<p>Thanks <span class="user-mention" data-user-id="116009">@nikomatsakis</span>!</p>



<a name="133838445"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/%2351002%20kill%20rustc%3A%3Acfg%20consumers/near/133838445" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> simulacrum <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/.2351002.20kill.20rustc.3A.3Acfg.20consumers.html#133838445">(Sep 12 2018 at 19:26)</a>:</h4>
<p><span class="user-mention" data-user-id="116009">@nikomatsakis</span> Hm, yeah, but in theory you're only going to register providers once so you could stash it in a static oncecell (not great though)</p>



<a name="133839043"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/%2351002%20kill%20rustc%3A%3Acfg%20consumers/near/133839043" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/.2351002.20kill.20rustc.3A.3Acfg.20consumers.html#133839043">(Sep 12 2018 at 19:39)</a>:</h4>
<p>seems messier than supporting multi-providers or something</p>



<a name="133839083"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/%2351002%20kill%20rustc%3A%3Acfg%20consumers/near/133839083" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> simulacrum <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/.2351002.20kill.20rustc.3A.3Acfg.20consumers.html#133839083">(Sep 12 2018 at 19:39)</a>:</h4>
<p>Sure, yeah, I agree -- was just saying that if we want to avoid overhauling that (it feels like a somewhat non trivial change) there is a way</p>



<a name="133839134"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/%2351002%20kill%20rustc%3A%3Acfg%20consumers/near/133839134" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/.2351002.20kill.20rustc.3A.3Acfg.20consumers.html#133839134">(Sep 12 2018 at 19:40)</a>:</h4>
<p>yes, ok. I actually think it'd be a fairly small change but I may be overlooking stuff</p>



<a name="133839152"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/%2351002%20kill%20rustc%3A%3Acfg%20consumers/near/133839152" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/.2351002.20kill.20rustc.3A.3Acfg.20consumers.html#133839152">(Sep 12 2018 at 19:40)</a>:</h4>
<p>I bet <span class="user-mention" data-user-id="119009">@eddyb</span> has a better idea anyway :)</p>



<a name="133839158"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/%2351002%20kill%20rustc%3A%3Acfg%20consumers/near/133839158" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/.2351002.20kill.20rustc.3A.3Acfg.20consumers.html#133839158">(Sep 12 2018 at 19:40)</a>:</h4>
<p>they're usually 2 steps ahead  on this sort of thing</p>



<a name="133839236"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/%2351002%20kill%20rustc%3A%3Acfg%20consumers/near/133839236" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> simulacrum <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/.2351002.20kill.20rustc.3A.3Acfg.20consumers.html#133839236">(Sep 12 2018 at 19:42)</a>:</h4>
<p>well the query stuff is macros all the way down last I looked which makes me think individual changes could be quite painful</p>



<a name="133839251"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/%2351002%20kill%20rustc%3A%3Acfg%20consumers/near/133839251" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/.2351002.20kill.20rustc.3A.3Acfg.20consumers.html#133839251">(Sep 12 2018 at 19:42)</a>:</h4>
<p>yeah, it is macros all the way down...</p>



<a name="133839258"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/%2351002%20kill%20rustc%3A%3Acfg%20consumers/near/133839258" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/.2351002.20kill.20rustc.3A.3Acfg.20consumers.html#133839258">(Sep 12 2018 at 19:43)</a>:</h4>
<p>/me shrugs</p>



<a name="133839263"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/%2351002%20kill%20rustc%3A%3Acfg%20consumers/near/133839263" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wesley Wiser <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/.2351002.20kill.20rustc.3A.3Acfg.20consumers.html#133839263">(Sep 12 2018 at 19:43)</a>:</h4>
<p>/me shudders</p>



<a name="133839265"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/%2351002%20kill%20rustc%3A%3Acfg%20consumers/near/133839265" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/.2351002.20kill.20rustc.3A.3Acfg.20consumers.html#133839265">(Sep 12 2018 at 19:43)</a>:</h4>
<p>I've been wondering about trying to factor it out into a crate. It's hard to do</p>



<a name="133839356"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/%2351002%20kill%20rustc%3A%3Acfg%20consumers/near/133839356" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> simulacrum <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/.2351002.20kill.20rustc.3A.3Acfg.20consumers.html#133839356">(Sep 12 2018 at 19:44)</a>:</h4>
<p>I think the main blocker there is that it is used by rustc itself and uses types defined in it (e.g., DefId)</p>



<a name="133839378"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/%2351002%20kill%20rustc%3A%3Acfg%20consumers/near/133839378" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> simulacrum <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/.2351002.20kill.20rustc.3A.3Acfg.20consumers.html#133839378">(Sep 12 2018 at 19:45)</a>:</h4>
<p>I think moving the HIR declarations into a crate that librustc depends on might help but not sure</p>



<a name="133839400"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/%2351002%20kill%20rustc%3A%3Acfg%20consumers/near/133839400" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> simulacrum <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/.2351002.20kill.20rustc.3A.3Acfg.20consumers.html#133839400">(Sep 12 2018 at 19:45)</a>:</h4>
<p>Generally I think the query providers could use a refactor to be less downwardly structured but not sure</p>



<a name="133839477"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/%2351002%20kill%20rustc%3A%3Acfg%20consumers/near/133839477" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/.2351002.20kill.20rustc.3A.3Acfg.20consumers.html#133839477">(Sep 12 2018 at 19:47)</a>:</h4>
<p>sorry, I meant something more drastic, like a <a href="http://crates.io" target="_blank" title="http://crates.io">crates.io</a> crate :)</p>



<a name="133839491"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/%2351002%20kill%20rustc%3A%3Acfg%20consumers/near/133839491" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/.2351002.20kill.20rustc.3A.3Acfg.20consumers.html#133839491">(Sep 12 2018 at 19:47)</a>:</h4>
<p>but it is related; it'd be nice, for example, to have the set of queries be dynamically extensible</p>



<a name="133839499"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/%2351002%20kill%20rustc%3A%3Acfg%20consumers/near/133839499" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> simulacrum <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/.2351002.20kill.20rustc.3A.3Acfg.20consumers.html#133839499">(Sep 12 2018 at 19:47)</a>:</h4>
<p>Well, yeah - I meant that even decoupling inside the compiler is hard today</p>



<a name="133839503"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/%2351002%20kill%20rustc%3A%3Acfg%20consumers/near/133839503" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> simulacrum <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/.2351002.20kill.20rustc.3A.3Acfg.20consumers.html#133839503">(Sep 12 2018 at 19:47)</a>:</h4>
<p>Much less moving out to <a href="http://crates.io" target="_blank" title="http://crates.io">crates.io</a> :)</p>



<a name="133839594"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/%2351002%20kill%20rustc%3A%3Acfg%20consumers/near/133839594" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/.2351002.20kill.20rustc.3A.3Acfg.20consumers.html#133839594">(Sep 12 2018 at 19:49)</a>:</h4>
<p>:)</p>



<a name="133841910"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/%2351002%20kill%20rustc%3A%3Acfg%20consumers/near/133841910" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> eddyb <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/.2351002.20kill.20rustc.3A.3Acfg.20consumers.html#133841910">(Sep 12 2018 at 20:31)</a>:</h4>
<p>uhhh this is a long discussion</p>



<a name="133841917"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/%2351002%20kill%20rustc%3A%3Acfg%20consumers/near/133841917" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> eddyb <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/.2351002.20kill.20rustc.3A.3Acfg.20consumers.html#133841917">(Sep 12 2018 at 20:31)</a>:</h4>
<p>please do not complicate providers</p>



<a name="133841993"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/%2351002%20kill%20rustc%3A%3Acfg%20consumers/near/133841993" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> eddyb <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/.2351002.20kill.20rustc.3A.3Acfg.20consumers.html#133841993">(Sep 12 2018 at 20:33)</a>:</h4>
<p>IMO hardwired lints should be implemented in the place where they have all the information they need. this is partly why we moved to the "lint scopes" approach where you don't need the messy "lint runner" at all</p>



<a name="133842002"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/%2351002%20kill%20rustc%3A%3Acfg%20consumers/near/133842002" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> eddyb <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/.2351002.20kill.20rustc.3A.3Acfg.20consumers.html#133842002">(Sep 12 2018 at 20:33)</a>:</h4>
<p>so we don't really need any queries for these</p>



<a name="133842005"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/%2351002%20kill%20rustc%3A%3Acfg%20consumers/near/133842005" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> eddyb <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/.2351002.20kill.20rustc.3A.3Acfg.20consumers.html#133842005">(Sep 12 2018 at 20:33)</a>:</h4>
<p>just move the code to rustc_mir</p>



<a name="133842066"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/%2351002%20kill%20rustc%3A%3Acfg%20consumers/near/133842066" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> eddyb <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/.2351002.20kill.20rustc.3A.3Acfg.20consumers.html#133842066">(Sep 12 2018 at 20:34)</a>:</h4>
<p>making them hookable is interesting but I had a different idea than <span class="user-mention" data-user-id="116009">@nikomatsakis</span> seems to have discussed - or maybe I missed a part of the discussion</p>



<a name="133842111"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/%2351002%20kill%20rustc%3A%3Acfg%20consumers/near/133842111" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> eddyb <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/.2351002.20kill.20rustc.3A.3Acfg.20consumers.html#133842111">(Sep 12 2018 at 20:35)</a>:</h4>
<p>that is, I imagined one of the things we could do is read-only hooks for queries. but this is not enough for unconditional recursion (really excited that's moving to MIR :D), unless we get rid of stealing</p>



<a name="133842159"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/%2351002%20kill%20rustc%3A%3Acfg%20consumers/near/133842159" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> eddyb <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/.2351002.20kill.20rustc.3A.3Acfg.20consumers.html#133842159">(Sep 12 2018 at 20:36)</a>:</h4>
<p>or, wait, is unconditional recursion a local analysis or not?</p>



<a name="133842166"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/%2351002%20kill%20rustc%3A%3Acfg%20consumers/near/133842166" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> eddyb <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/.2351002.20kill.20rustc.3A.3Acfg.20consumers.html#133842166">(Sep 12 2018 at 20:36)</a>:</h4>
<p>if it's local then it doesn't need anything special</p>



<a name="133842217"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/%2351002%20kill%20rustc%3A%3Acfg%20consumers/near/133842217" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> eddyb <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/.2351002.20kill.20rustc.3A.3Acfg.20consumers.html#133842217">(Sep 12 2018 at 20:37)</a>:</h4>
<p>anyway we have to be really careful with the design of any sort of additional hooks, so they don't introduce performance or architectural overhead</p>



<a name="133842291"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/%2351002%20kill%20rustc%3A%3Acfg%20consumers/near/133842291" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> eddyb <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/.2351002.20kill.20rustc.3A.3Acfg.20consumers.html#133842291">(Sep 12 2018 at 20:38)</a>:</h4>
<p>(e.g. incremental interactions wrt diagnostics produced by hooks)</p>



<a name="133842394"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/%2351002%20kill%20rustc%3A%3Acfg%20consumers/near/133842394" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> eddyb <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/.2351002.20kill.20rustc.3A.3Acfg.20consumers.html#133842394">(Sep 12 2018 at 20:40)</a>:</h4>
<p>I want open-world queries but it's an even harder problem. we'll eventually need something for incremental parsing and macro expansion</p>



<a name="133842425"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/%2351002%20kill%20rustc%3A%3Acfg%20consumers/near/133842425" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> eddyb <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/.2351002.20kill.20rustc.3A.3Acfg.20consumers.html#133842425">(Sep 12 2018 at 20:41)</a>:</h4>
<p>it's almost an ECS problem, where open-world implementations typically add some overhead</p>



<a name="133842458"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/%2351002%20kill%20rustc%3A%3Acfg%20consumers/near/133842458" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> eddyb <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/.2351002.20kill.20rustc.3A.3Acfg.20consumers.html#133842458">(Sep 12 2018 at 20:41)</a>:</h4>
<p>what we need is similar to dynamic linking support for TLS</p>



<a name="133842525"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/%2351002%20kill%20rustc%3A%3Acfg%20consumers/near/133842525" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wesley Wiser <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/.2351002.20kill.20rustc.3A.3Acfg.20consumers.html#133842525">(Sep 12 2018 at 20:42)</a>:</h4>
<p><span class="user-mention" data-user-id="119009">@eddyb</span> By local do you mean "only looks at the function body"?</p>



<a name="133842528"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/%2351002%20kill%20rustc%3A%3Acfg%20consumers/near/133842528" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> eddyb <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/.2351002.20kill.20rustc.3A.3Acfg.20consumers.html#133842528">(Sep 12 2018 at 20:42)</a>:</h4>
<p>where each crate can add their own queries and they're "concatenated" in the engine, with statics adjusted to indicate offsets</p>



<a name="133842532"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/%2351002%20kill%20rustc%3A%3Acfg%20consumers/near/133842532" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> eddyb <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/.2351002.20kill.20rustc.3A.3Acfg.20consumers.html#133842532">(Sep 12 2018 at 20:43)</a>:</h4>
<p><span class="user-mention" data-user-id="125250">@Wesley Wiser</span> yeah</p>



<a name="133842536"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/%2351002%20kill%20rustc%3A%3Acfg%20consumers/near/133842536" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wesley Wiser <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/.2351002.20kill.20rustc.3A.3Acfg.20consumers.html#133842536">(Sep 12 2018 at 20:43)</a>:</h4>
<p>Yeah, it's local</p>



<a name="133842550"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/%2351002%20kill%20rustc%3A%3Acfg%20consumers/near/133842550" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> eddyb <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/.2351002.20kill.20rustc.3A.3Acfg.20consumers.html#133842550">(Sep 12 2018 at 20:43)</a>:</h4>
<p>then we should be able to run it post-MIR-building</p>



<a name="133842558"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/%2351002%20kill%20rustc%3A%3Acfg%20consumers/near/133842558" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> eddyb <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/.2351002.20kill.20rustc.3A.3Acfg.20consumers.html#133842558">(Sep 12 2018 at 20:43)</a>:</h4>
<p>or somewhere in there</p>



<a name="133842621"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/%2351002%20kill%20rustc%3A%3Acfg%20consumers/near/133842621" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> eddyb <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/.2351002.20kill.20rustc.3A.3Acfg.20consumers.html#133842621">(Sep 12 2018 at 20:44)</a>:</h4>
<p>all it needs is "call dominates return" and <code>Instance</code>, really</p>



<a name="133842786"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/%2351002%20kill%20rustc%3A%3Acfg%20consumers/near/133842786" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> eddyb <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/.2351002.20kill.20rustc.3A.3Acfg.20consumers.html#133842786">(Sep 12 2018 at 20:47)</a>:</h4>
<p>so, domtree after building MIR, should be a tiny lint</p>



<a name="133842843"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/%2351002%20kill%20rustc%3A%3Acfg%20consumers/near/133842843" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> eddyb <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/.2351002.20kill.20rustc.3A.3Acfg.20consumers.html#133842843">(Sep 12 2018 at 20:48)</a>:</h4>
<p>(sorry, I was on my phone, and I'm a bit sleepy)</p>



<a name="133842872"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/%2351002%20kill%20rustc%3A%3Acfg%20consumers/near/133842872" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> eddyb <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/.2351002.20kill.20rustc.3A.3Acfg.20consumers.html#133842872">(Sep 12 2018 at 20:49)</a>:</h4>
<p>I want a redesign of <code>rustc</code> but I'm worried that if we don't organize properly we'll be left with a bunch of suboptimal ideas, and even worse, implement some of them</p>



<a name="133843298"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/%2351002%20kill%20rustc%3A%3Acfg%20consumers/near/133843298" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/.2351002.20kill.20rustc.3A.3Acfg.20consumers.html#133843298">(Sep 12 2018 at 20:56)</a>:</h4>
<blockquote>
<p>just move the code to rustc_mir</p>
</blockquote>
<p>to be clear <span class="user-mention" data-user-id="119009">@eddyb</span>, this is precisely what I advised <span class="user-mention" data-user-id="125250">@Wesley Wiser</span> to do...</p>



<a name="133843306"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/%2351002%20kill%20rustc%3A%3Acfg%20consumers/near/133843306" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/.2351002.20kill.20rustc.3A.3Acfg.20consumers.html#133843306">(Sep 12 2018 at 20:56)</a>:</h4>
<p>the rest was just random, non-actionable chatter</p>



<a name="133843321"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/%2351002%20kill%20rustc%3A%3Acfg%20consumers/near/133843321" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/.2351002.20kill.20rustc.3A.3Acfg.20consumers.html#133843321">(Sep 12 2018 at 20:57)</a>:</h4>
<p>no need to panic :)</p>



<a name="133843322"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/%2351002%20kill%20rustc%3A%3Acfg%20consumers/near/133843322" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> eddyb <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/.2351002.20kill.20rustc.3A.3Acfg.20consumers.html#133843322">(Sep 12 2018 at 20:57)</a>:</h4>
<p>heh</p>



<a name="133843324"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/%2351002%20kill%20rustc%3A%3Acfg%20consumers/near/133843324" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wesley Wiser <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/.2351002.20kill.20rustc.3A.3Acfg.20consumers.html#133843324">(Sep 12 2018 at 20:57)</a>:</h4>
<p>and that's my current plan :)</p>



<a name="133843334"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/%2351002%20kill%20rustc%3A%3Acfg%20consumers/near/133843334" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> eddyb <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/.2351002.20kill.20rustc.3A.3Acfg.20consumers.html#133843334">(Sep 12 2018 at 20:57)</a>:</h4>
<p>since I got pinged and the conversation was long, I wanted to state my position</p>



<a name="133843339"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/%2351002%20kill%20rustc%3A%3Acfg%20consumers/near/133843339" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/.2351002.20kill.20rustc.3A.3Acfg.20consumers.html#133843339">(Sep 12 2018 at 20:57)</a>:</h4>
<p>makes sense</p>



<a name="133843385"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/%2351002%20kill%20rustc%3A%3Acfg%20consumers/near/133843385" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/.2351002.20kill.20rustc.3A.3Acfg.20consumers.html#133843385">(Sep 12 2018 at 20:58)</a>:</h4>
<p>I figured you'd have a plan, I'm not sure I fully understood it, but it's not imp't right now :)</p>



<a name="133843454"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/%2351002%20kill%20rustc%3A%3Acfg%20consumers/near/133843454" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> eddyb <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/.2351002.20kill.20rustc.3A.3Acfg.20consumers.html#133843454">(Sep 12 2018 at 20:59)</a>:</h4>
<p>I never have a plan</p>



<a name="133843461"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/%2351002%20kill%20rustc%3A%3Acfg%20consumers/near/133843461" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> eddyb <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/.2351002.20kill.20rustc.3A.3Acfg.20consumers.html#133843461">(Sep 12 2018 at 20:59)</a>:</h4>
<p>only a loose set of ideas</p>



<a name="133843549"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/%2351002%20kill%20rustc%3A%3Acfg%20consumers/near/133843549" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> eddyb <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/.2351002.20kill.20rustc.3A.3Acfg.20consumers.html#133843549">(Sep 12 2018 at 21:00)</a>:</h4>
<p>like <a href="https://github.com/rust-lang/rust/issues/53590" target="_blank" title="https://github.com/rust-lang/rust/issues/53590">https://github.com/rust-lang/rust/issues/53590</a></p>



<a name="133843776"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/%2351002%20kill%20rustc%3A%3Acfg%20consumers/near/133843776" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wesley Wiser <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/.2351002.20kill.20rustc.3A.3Acfg.20consumers.html#133843776">(Sep 12 2018 at 21:04)</a>:</h4>
<p><span class="user-mention" data-user-id="119009">@eddyb</span> That looks really interesting!</p>



<a name="133843784"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/%2351002%20kill%20rustc%3A%3Acfg%20consumers/near/133843784" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> eddyb <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/.2351002.20kill.20rustc.3A.3Acfg.20consumers.html#133843784">(Sep 12 2018 at 21:04)</a>:</h4>
<p>the hard part is having enough time to experiment with all of the ideas</p>



<a name="133843800"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/%2351002%20kill%20rustc%3A%3Acfg%20consumers/near/133843800" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wesley Wiser <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/.2351002.20kill.20rustc.3A.3Acfg.20consumers.html#133843800">(Sep 12 2018 at 21:05)</a>:</h4>
<p>Yeah</p>



<a name="133843832"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/%2351002%20kill%20rustc%3A%3Acfg%20consumers/near/133843832" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wesley Wiser <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/.2351002.20kill.20rustc.3A.3Acfg.20consumers.html#133843832">(Sep 12 2018 at 21:06)</a>:</h4>
<p>Completely off topic: Is there a list of "desired" MIR optimization passes that have yet to be implemented?</p>



<a name="133843880"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/%2351002%20kill%20rustc%3A%3Acfg%20consumers/near/133843880" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wesley Wiser <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/.2351002.20kill.20rustc.3A.3Acfg.20consumers.html#133843880">(Sep 12 2018 at 21:06)</a>:</h4>
<p>I've seen comments about such things but nothing concrete</p>



<a name="133843891"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/%2351002%20kill%20rustc%3A%3Acfg%20consumers/near/133843891" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wesley Wiser <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/.2351002.20kill.20rustc.3A.3Acfg.20consumers.html#133843891">(Sep 12 2018 at 21:06)</a>:</h4>
<p>And it sounds like something I'd love to work on :)</p>



<a name="133843916"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/%2351002%20kill%20rustc%3A%3Acfg%20consumers/near/133843916" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> eddyb <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/.2351002.20kill.20rustc.3A.3Acfg.20consumers.html#133843916">(Sep 12 2018 at 21:06)</a>:</h4>
<p>I have a few unfinished passes</p>



<a name="133843928"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/%2351002%20kill%20rustc%3A%3Acfg%20consumers/near/133843928" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> eddyb <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/.2351002.20kill.20rustc.3A.3Acfg.20consumers.html#133843928">(Sep 12 2018 at 21:07)</a>:</h4>
<p>partly blocked on an unfinished branch to redo debuginfo wrt MIR</p>



<a name="133843937"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/%2351002%20kill%20rustc%3A%3Acfg%20consumers/near/133843937" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> eddyb <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/.2351002.20kill.20rustc.3A.3Acfg.20consumers.html#133843937">(Sep 12 2018 at 21:07)</a>:</h4>
<p>I almost forgot about all of that stuff <em>shudder</em></p>



<a name="133844064"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/%2351002%20kill%20rustc%3A%3Acfg%20consumers/near/133844064" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> eddyb <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/.2351002.20kill.20rustc.3A.3Acfg.20consumers.html#133844064">(Sep 12 2018 at 21:09)</a>:</h4>
<p>but there's lint(-like) stuff that we could probably move to the MIR</p>



<a name="133844074"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/%2351002%20kill%20rustc%3A%3Acfg%20consumers/near/133844074" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> eddyb <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/.2351002.20kill.20rustc.3A.3Acfg.20consumers.html#133844074">(Sep 12 2018 at 21:09)</a>:</h4>
<p>like some unreachable code warnings might belong there instead of typeck?</p>



<a name="133844079"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/%2351002%20kill%20rustc%3A%3Acfg%20consumers/near/133844079" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> eddyb <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/.2351002.20kill.20rustc.3A.3Acfg.20consumers.html#133844079">(Sep 12 2018 at 21:09)</a>:</h4>
<p>OH OH</p>



<a name="133844086"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/%2351002%20kill%20rustc%3A%3Acfg%20consumers/near/133844086" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> eddyb <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/.2351002.20kill.20rustc.3A.3Acfg.20consumers.html#133844086">(Sep 12 2018 at 21:09)</a>:</h4>
<p><span class="user-mention" data-user-id="125250">@Wesley Wiser</span> <code>liveness</code></p>



<a name="133844101"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/%2351002%20kill%20rustc%3A%3Acfg%20consumers/near/133844101" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> eddyb <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/.2351002.20kill.20rustc.3A.3Acfg.20consumers.html#133844101">(Sep 12 2018 at 21:09)</a>:</h4>
<p>(unless the MIR borrowck already warns about unused assignments and stuff)</p>



<a name="133844151"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/%2351002%20kill%20rustc%3A%3Acfg%20consumers/near/133844151" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wesley Wiser <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/.2351002.20kill.20rustc.3A.3Acfg.20consumers.html#133844151">(Sep 12 2018 at 21:10)</a>:</h4>
<p><span class="user-mention" data-user-id="119009">@eddyb</span> Is that <a href="https://github.com/rust-lang/rust/issues/51003" target="_blank" title="https://github.com/rust-lang/rust/issues/51003">https://github.com/rust-lang/rust/issues/51003</a> ?</p>



<a name="133844157"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/%2351002%20kill%20rustc%3A%3Acfg%20consumers/near/133844157" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> eddyb <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/.2351002.20kill.20rustc.3A.3Acfg.20consumers.html#133844157">(Sep 12 2018 at 21:10)</a>:</h4>
<p>yupp</p>



<a name="133844163"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/%2351002%20kill%20rustc%3A%3Acfg%20consumers/near/133844163" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wesley Wiser <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/.2351002.20kill.20rustc.3A.3Acfg.20consumers.html#133844163">(Sep 12 2018 at 21:10)</a>:</h4>
<p>Interesting...</p>



<a name="133844189"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/%2351002%20kill%20rustc%3A%3Acfg%20consumers/near/133844189" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> eddyb <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/.2351002.20kill.20rustc.3A.3Acfg.20consumers.html#133844189">(Sep 12 2018 at 21:10)</a>:</h4>
<p>I'm not sure how good the <code>rustc_mir::util::liveness</code> thing is</p>



<a name="133844208"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/%2351002%20kill%20rustc%3A%3Acfg%20consumers/near/133844208" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> eddyb <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/.2351002.20kill.20rustc.3A.3Acfg.20consumers.html#133844208">(Sep 12 2018 at 21:11)</a>:</h4>
<p>like, it's potentially too specific to the generator state transform to be generally usable</p>



<a name="133844220"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/%2351002%20kill%20rustc%3A%3Acfg%20consumers/near/133844220" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> eddyb <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/.2351002.20kill.20rustc.3A.3Acfg.20consumers.html#133844220">(Sep 12 2018 at 21:11)</a>:</h4>
<p>but if it <em>is</em> usable, then it should make the analysis pretty straight-forward</p>



<a name="133844226"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/%2351002%20kill%20rustc%3A%3Acfg%20consumers/near/133844226" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wesley Wiser <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/.2351002.20kill.20rustc.3A.3Acfg.20consumers.html#133844226">(Sep 12 2018 at 21:11)</a>:</h4>
<p>Gotcha</p>



<a name="133844229"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/%2351002%20kill%20rustc%3A%3Acfg%20consumers/near/133844229" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> eddyb <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/.2351002.20kill.20rustc.3A.3Acfg.20consumers.html#133844229">(Sep 12 2018 at 21:11)</a>:</h4>
<p>compared to the huge mess of HIR-matching code that the old <code>liveness</code> pass is</p>



<a name="133844284"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/%2351002%20kill%20rustc%3A%3Acfg%20consumers/near/133844284" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/.2351002.20kill.20rustc.3A.3Acfg.20consumers.html#133844284">(Sep 12 2018 at 21:12)</a>:</h4>
<p>it's reasonable general, but it doesn't do some of the stuff the old analysis did</p>



<a name="133844291"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/%2351002%20kill%20rustc%3A%3Acfg%20consumers/near/133844291" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wesley Wiser <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/.2351002.20kill.20rustc.3A.3Acfg.20consumers.html#133844291">(Sep 12 2018 at 21:12)</a>:</h4>
<p>I'll take a look at that after I finish porting <code>UnconditionalRecursion</code></p>



<a name="133844301"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/%2351002%20kill%20rustc%3A%3Acfg%20consumers/near/133844301" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/.2351002.20kill.20rustc.3A.3Acfg.20consumers.html#133844301">(Sep 12 2018 at 21:12)</a>:</h4>
<p>e.g., unused assignment</p>



<a name="133844310"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/%2351002%20kill%20rustc%3A%3Acfg%20consumers/near/133844310" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/.2351002.20kill.20rustc.3A.3Acfg.20consumers.html#133844310">(Sep 12 2018 at 21:12)</a>:</h4>
<p>well, I forget, maybe you can get that particular thing</p>



<a name="133844317"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/%2351002%20kill%20rustc%3A%3Acfg%20consumers/near/133844317" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/.2351002.20kill.20rustc.3A.3Acfg.20consumers.html#133844317">(Sep 12 2018 at 21:12)</a>:</h4>
<p>but I remember there were some extra variations on liveness</p>



<a name="133844346"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/%2351002%20kill%20rustc%3A%3Acfg%20consumers/near/133844346" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/.2351002.20kill.20rustc.3A.3Acfg.20consumers.html#133844346">(Sep 12 2018 at 21:13)</a>:</h4>
<p>the dataflow stuff may or may not be relevant</p>



<a name="133844349"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/%2351002%20kill%20rustc%3A%3Acfg%20consumers/near/133844349" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/.2351002.20kill.20rustc.3A.3Acfg.20consumers.html#133844349">(Sep 12 2018 at 21:13)</a>:</h4>
<p>it only does fwd dataflow</p>



<a name="133892739"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/%2351002%20kill%20rustc%3A%3Acfg%20consumers/near/133892739" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wesley Wiser <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/.2351002.20kill.20rustc.3A.3Acfg.20consumers.html#133892739">(Sep 13 2018 at 15:21)</a>:</h4>
<p>Ok, so this is going pretty well. I moved the code around and I've got it being called from the MIR borrow check entry point as discussed. That's all working but the <code>src/test/ui/lints/lint-unconditional-recursion.rs</code> test is failing in a few cases. It looks like the issue is around calling trait methods. For example:</p>
<div class="codehilite"><pre><span></span>trait Foo {
    fn bar(&amp;self) {
        self.bar()
    }
}

impl Foo for i32 {
    fn bar(&amp;self) { //~ ERROR function cannot return without recursing
        0.bar()
    }
}
</pre></div>


<p>Isn't triggering the error.</p>



<a name="133892866"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/%2351002%20kill%20rustc%3A%3Acfg%20consumers/near/133892866" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wesley Wiser <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/.2351002.20kill.20rustc.3A.3Acfg.20consumers.html#133892866">(Sep 13 2018 at 15:22)</a>:</h4>
<p>Right now, the lint is just checking for <code>TerminatorKind::Call(fn)</code> where <code>fn</code>'s <code>DefId</code> <code>==</code> our function's <code>DefId</code>. Which obviously doesn't work in this case because the function we're calling is <code>Foo::bar</code> but our function is the impl's function</p>



<a name="133892912"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/%2351002%20kill%20rustc%3A%3Acfg%20consumers/near/133892912" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wesley Wiser <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/.2351002.20kill.20rustc.3A.3Acfg.20consumers.html#133892912">(Sep 13 2018 at 15:23)</a>:</h4>
<p>I think I need to actually calculate the real method we're calling on the trait. Which, I think, is what the <code>rustc::ty::instance::Instance::resolve()</code> function does, right?</p>



<a name="133892913"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/%2351002%20kill%20rustc%3A%3Acfg%20consumers/near/133892913" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wesley Wiser <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/.2351002.20kill.20rustc.3A.3Acfg.20consumers.html#133892913">(Sep 13 2018 at 15:23)</a>:</h4>
<p><a href="https://doc.rust-lang.org/nightly/nightly-rustc/rustc/ty/instance/struct.Instance.html#method.resolve" target="_blank" title="https://doc.rust-lang.org/nightly/nightly-rustc/rustc/ty/instance/struct.Instance.html#method.resolve">https://doc.rust-lang.org/nightly/nightly-rustc/rustc/ty/instance/struct.Instance.html#method.resolve</a></p>



<a name="133901247"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/%2351002%20kill%20rustc%3A%3Acfg%20consumers/near/133901247" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> eddyb <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/.2351002.20kill.20rustc.3A.3Acfg.20consumers.html#133901247">(Sep 13 2018 at 17:49)</a>:</h4>
<p>yeah! doesn't the old code already use <code>Instance</code>? or is it resolving things manually?</p>



<a name="133901366"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/%2351002%20kill%20rustc%3A%3Acfg%20consumers/near/133901366" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wesley Wiser <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/.2351002.20kill.20rustc.3A.3Acfg.20consumers.html#133901366">(Sep 13 2018 at 17:50)</a>:</h4>
<p>No, it re-invents the wheel I think</p>



<a name="133901371"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/%2351002%20kill%20rustc%3A%3Acfg%20consumers/near/133901371" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wesley Wiser <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/.2351002.20kill.20rustc.3A.3Acfg.20consumers.html#133901371">(Sep 13 2018 at 17:51)</a>:</h4>
<p>/me looking</p>



<a name="133901403"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/%2351002%20kill%20rustc%3A%3Acfg%20consumers/near/133901403" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wesley Wiser <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/.2351002.20kill.20rustc.3A.3Acfg.20consumers.html#133901403">(Sep 13 2018 at 17:51)</a>:</h4>
<p><a href="https://github.com/rust-lang/rust/blob/master/src/librustc_lint/builtin.rs#L998" target="_blank" title="https://github.com/rust-lang/rust/blob/master/src/librustc_lint/builtin.rs#L998">https://github.com/rust-lang/rust/blob/master/src/librustc_lint/builtin.rs#L998</a></p>



<a name="133901469"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/%2351002%20kill%20rustc%3A%3Acfg%20consumers/near/133901469" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> eddyb <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/.2351002.20kill.20rustc.3A.3Acfg.20consumers.html#133901469">(Sep 13 2018 at 17:52)</a>:</h4>
<p><code>traits::SelectionContext::new</code> oh jeez indeed it does</p>



<a name="133901588"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/%2351002%20kill%20rustc%3A%3Acfg%20consumers/near/133901588" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wesley Wiser <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/.2351002.20kill.20rustc.3A.3Acfg.20consumers.html#133901588">(Sep 13 2018 at 17:54)</a>:</h4>
<p>Should I use that instead of <code>Instance</code>?</p>



<a name="133901592"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/%2351002%20kill%20rustc%3A%3Acfg%20consumers/near/133901592" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wesley Wiser <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/.2351002.20kill.20rustc.3A.3Acfg.20consumers.html#133901592">(Sep 13 2018 at 17:54)</a>:</h4>
<p>(not quite sure what I'm looking at)</p>



<a name="133901599"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/%2351002%20kill%20rustc%3A%3Acfg%20consumers/near/133901599" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> eddyb <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/.2351002.20kill.20rustc.3A.3Acfg.20consumers.html#133901599">(Sep 13 2018 at 17:55)</a>:</h4>
<p>you want <code>Instance</code></p>



<a name="133901691"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/%2351002%20kill%20rustc%3A%3Acfg%20consumers/near/133901691" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wesley Wiser <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/.2351002.20kill.20rustc.3A.3Acfg.20consumers.html#133901691">(Sep 13 2018 at 17:56)</a>:</h4>
<p>Ok :)</p>



<a name="133901716"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/%2351002%20kill%20rustc%3A%3Acfg%20consumers/near/133901716" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> eddyb <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/.2351002.20kill.20rustc.3A.3Acfg.20consumers.html#133901716">(Sep 13 2018 at 17:56)</a>:</h4>
<p>(btw, feel free to ping me about compiler minutia - oh and discord works better, notification-wise, I think)</p>



<a name="133901753"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/%2351002%20kill%20rustc%3A%3Acfg%20consumers/near/133901753" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wesley Wiser <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/.2351002.20kill.20rustc.3A.3Acfg.20consumers.html#133901753">(Sep 13 2018 at 17:57)</a>:</h4>
<p>I also looked at <code>tcx.subst_and_normalize_erasing_regions()</code> but I couldn't really figure out what that did <span class="emoji emoji-1f606" title="laughing">:laughing:</span></p>



<a name="133901770"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/%2351002%20kill%20rustc%3A%3Acfg%20consumers/near/133901770" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wesley Wiser <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/.2351002.20kill.20rustc.3A.3Acfg.20consumers.html#133901770">(Sep 13 2018 at 17:57)</a>:</h4>
<p>Absolutely. Thanks <span class="user-mention" data-user-id="119009">@eddyb</span>!</p>



<a name="133902068"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/%2351002%20kill%20rustc%3A%3Acfg%20consumers/near/133902068" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/.2351002.20kill.20rustc.3A.3Acfg.20consumers.html#133902068">(Sep 13 2018 at 18:01)</a>:</h4>
<p><span class="user-mention" data-user-id="125250">@Wesley Wiser</span> (are you rewriting it to use <code>Instance</code>?)</p>



<a name="133902118"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/%2351002%20kill%20rustc%3A%3Acfg%20consumers/near/133902118" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/.2351002.20kill.20rustc.3A.3Acfg.20consumers.html#133902118">(Sep 13 2018 at 18:02)</a>:</h4>
<p>I forgot about these messages, sorry, meant to follow up with you</p>



<a name="133902125"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/%2351002%20kill%20rustc%3A%3Acfg%20consumers/near/133902125" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wesley Wiser <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/.2351002.20kill.20rustc.3A.3Acfg.20consumers.html#133902125">(Sep 13 2018 at 18:02)</a>:</h4>
<p>Yeah, that's what I was going to try to do</p>



<a name="133902127"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/%2351002%20kill%20rustc%3A%3Acfg%20consumers/near/133902127" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/.2351002.20kill.20rustc.3A.3Acfg.20consumers.html#133902127">(Sep 13 2018 at 18:02)</a>:</h4>
<p>I can also explain what <code>subst_and_normalize_erasing_regions</code> does if you want :)</p>



<a name="133902131"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/%2351002%20kill%20rustc%3A%3Acfg%20consumers/near/133902131" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/.2351002.20kill.20rustc.3A.3Acfg.20consumers.html#133902131">(Sep 13 2018 at 18:02)</a>:</h4>
<p>ok</p>



<a name="133902144"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/%2351002%20kill%20rustc%3A%3Acfg%20consumers/near/133902144" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wesley Wiser <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/.2351002.20kill.20rustc.3A.3Acfg.20consumers.html#133902144">(Sep 13 2018 at 18:02)</a>:</h4>
<p>I was trying to avoid porting those helper functions</p>



<a name="133902190"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/%2351002%20kill%20rustc%3A%3Acfg%20consumers/near/133902190" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wesley Wiser <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/.2351002.20kill.20rustc.3A.3Acfg.20consumers.html#133902190">(Sep 13 2018 at 18:03)</a>:</h4>
<p>In particular, I wasn't sure how to get a <code>NodeId</code> for the call expression from the <code>Mir</code></p>



<a name="133902264"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/%2351002%20kill%20rustc%3A%3Acfg%20consumers/near/133902264" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wesley Wiser <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/.2351002.20kill.20rustc.3A.3Acfg.20consumers.html#133902264">(Sep 13 2018 at 18:04)</a>:</h4>
<blockquote>
<p>I can also explain what <code>subst_and_normalize_erasing_regions</code> does if you want :)</p>
</blockquote>
<p>Absolutely! I'm kind of just curious</p>



<a name="133902488"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/%2351002%20kill%20rustc%3A%3Acfg%20consumers/near/133902488" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/.2351002.20kill.20rustc.3A.3Acfg.20consumers.html#133902488">(Sep 13 2018 at 18:07)</a>:</h4>
<blockquote>
<p>In particular, I wasn't sure how to get a <code>NodeId</code> for the call expression from the <code>Mir</code></p>
</blockquote>
<p>why do you need that?</p>



<a name="133902505"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/%2351002%20kill%20rustc%3A%3Acfg%20consumers/near/133902505" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/.2351002.20kill.20rustc.3A.3Acfg.20consumers.html#133902505">(Sep 13 2018 at 18:07)</a>:</h4>
<blockquote>
<p>Absolutely! I'm kind of just curious</p>
</blockquote>
<p>well the "subst" part means replace the generic types with their values</p>



<a name="133902511"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/%2351002%20kill%20rustc%3A%3Acfg%20consumers/near/133902511" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/.2351002.20kill.20rustc.3A.3Acfg.20consumers.html#133902511">(Sep 13 2018 at 18:07)</a>:</h4>
<p>the "normalize" part means to look for associated types that may now be resolveable</p>



<a name="133902519"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/%2351002%20kill%20rustc%3A%3Acfg%20consumers/near/133902519" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/.2351002.20kill.20rustc.3A.3Acfg.20consumers.html#133902519">(Sep 13 2018 at 18:07)</a>:</h4>
<p>e.g., if you had a generic type like <code>Vec&lt;&lt;T as Iterator&gt;::Item&gt;</code></p>



<a name="133902561"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/%2351002%20kill%20rustc%3A%3Acfg%20consumers/near/133902561" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/.2351002.20kill.20rustc.3A.3Acfg.20consumers.html#133902561">(Sep 13 2018 at 18:08)</a>:</h4>
<p>and you replace <code>T</code> with <code>vec::Iter&lt;'x, u32&gt;</code> or something</p>



<a name="133902571"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/%2351002%20kill%20rustc%3A%3Acfg%20consumers/near/133902571" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/.2351002.20kill.20rustc.3A.3Acfg.20consumers.html#133902571">(Sep 13 2018 at 18:08)</a>:</h4>
<p>then you can normalize <code>Vec&lt;&lt;vec::Iter&lt;'x, u32&gt; as Iterator&gt;::Item&gt;</code> to <code>Vec&lt;&amp;'x u32&gt;</code></p>



<a name="133902587"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/%2351002%20kill%20rustc%3A%3Acfg%20consumers/near/133902587" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/.2351002.20kill.20rustc.3A.3Acfg.20consumers.html#133902587">(Sep 13 2018 at 18:08)</a>:</h4>
<p>the "erasing regions" part takes <em>that</em> result and replaces all the (free) regions with a special <code>'erased</code>; we do this a lot when generating code or in some phases of the compiler where we don't care about the regions</p>



<a name="133902592"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/%2351002%20kill%20rustc%3A%3Acfg%20consumers/near/133902592" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/.2351002.20kill.20rustc.3A.3Acfg.20consumers.html#133902592">(Sep 13 2018 at 18:08)</a>:</h4>
<p>so you get <code>Vec&lt;&amp;'erased u32&gt;</code></p>



<a name="133902593"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/%2351002%20kill%20rustc%3A%3Acfg%20consumers/near/133902593" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/.2351002.20kill.20rustc.3A.3Acfg.20consumers.html#133902593">(Sep 13 2018 at 18:08)</a>:</h4>
<p>or just <code>Vec&lt;&amp;u32&gt;</code>, if you prefer</p>



<a name="133902606"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/%2351002%20kill%20rustc%3A%3Acfg%20consumers/near/133902606" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/.2351002.20kill.20rustc.3A.3Acfg.20consumers.html#133902606">(Sep 13 2018 at 18:09)</a>:</h4>
<p>(note: "region" is a synonym with "lifetime")</p>



<a name="133902617"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/%2351002%20kill%20rustc%3A%3Acfg%20consumers/near/133902617" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wesley Wiser <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/.2351002.20kill.20rustc.3A.3Acfg.20consumers.html#133902617">(Sep 13 2018 at 18:09)</a>:</h4>
<p>The helper functions in the lint right now are all expr based and they need the <code>NodeId</code> of the call expression. For example: <a href="https://github.com/rust-lang/rust/blob/994cdd918589535d705177545bf503cd0c3c5148/src/librustc_lint/builtin.rs#L1011" target="_blank" title="https://github.com/rust-lang/rust/blob/994cdd918589535d705177545bf503cd0c3c5148/src/librustc_lint/builtin.rs#L1011">https://github.com/rust-lang/rust/blob/994cdd918589535d705177545bf503cd0c3c5148/src/librustc_lint/builtin.rs#L1011</a></p>



<a name="133902721"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/%2351002%20kill%20rustc%3A%3Acfg%20consumers/near/133902721" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/.2351002.20kill.20rustc.3A.3Acfg.20consumers.html#133902721">(Sep 13 2018 at 18:10)</a>:</h4>
<p>oh, in the lint, I see</p>



<a name="133902723"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/%2351002%20kill%20rustc%3A%3Acfg%20consumers/near/133902723" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/.2351002.20kill.20rustc.3A.3Acfg.20consumers.html#133902723">(Sep 13 2018 at 18:10)</a>:</h4>
<p>yeah ugh</p>



<a name="133902726"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/%2351002%20kill%20rustc%3A%3Acfg%20consumers/near/133902726" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/.2351002.20kill.20rustc.3A.3Acfg.20consumers.html#133902726">(Sep 13 2018 at 18:10)</a>:</h4>
<p>:)</p>



<a name="133902745"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/%2351002%20kill%20rustc%3A%3Acfg%20consumers/near/133902745" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/.2351002.20kill.20rustc.3A.3Acfg.20consumers.html#133902745">(Sep 13 2018 at 18:11)</a>:</h4>
<p>these should be expressable in MIR but I guess they have to be rewritten from scratch</p>



<a name="133902751"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/%2351002%20kill%20rustc%3A%3Acfg%20consumers/near/133902751" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wesley Wiser <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/.2351002.20kill.20rustc.3A.3Acfg.20consumers.html#133902751">(Sep 13 2018 at 18:11)</a>:</h4>
<blockquote>
<p>the "erasing regions" part takes <em>that</em> result and replaces all the (free) regions with a special <code>'erased</code>; we do this a lot when generating code or in some phases of the compiler where we don't care about the regions</p>
</blockquote>
<p>And this is because after we've done borrow checking, we know the lifetimes are valid and since you can't specialize on lifetimes, they have no effect to the rest of the compiler?</p>



<a name="133902841"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/%2351002%20kill%20rustc%3A%3Acfg%20consumers/near/133902841" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wesley Wiser <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/.2351002.20kill.20rustc.3A.3Acfg.20consumers.html#133902841">(Sep 13 2018 at 18:12)</a>:</h4>
<blockquote>
<p>these should be expressable in MIR but I guess they have to be rewritten from scratch</p>
</blockquote>
<p>Yeah. In my original version that used <code>optimized_mir()</code> this seemed to "just work". Ie, this test was passing. I guess optimized mir has already selected the correct functions for trait methods calls?</p>



<a name="133902984"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/%2351002%20kill%20rustc%3A%3Acfg%20consumers/near/133902984" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wesley Wiser <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/.2351002.20kill.20rustc.3A.3Acfg.20consumers.html#133902984">(Sep 13 2018 at 18:14)</a>:</h4>
<blockquote>
<p>subst_and_normalize_erasing_regions()</p>
</blockquote>
<p>So I guess my confusion was the <code>T</code> parameter. I see there's a bound on that to make it work but I just wasn't sure what to pass there. I've got a <code>DefId</code> for the trait method I'm calling. I've got an <code>Operand</code> for the call. Also a <code>Const</code> that wraps the function. I think all of those could be passed but I wasn't sure that what I'd get back is what I want</p>



<a name="133903050"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/%2351002%20kill%20rustc%3A%3Acfg%20consumers/near/133903050" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wesley Wiser <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/.2351002.20kill.20rustc.3A.3Acfg.20consumers.html#133903050">(Sep 13 2018 at 18:15)</a>:</h4>
<p>Is there a difference between <code>Instance::resolve()</code> and <code>subst_and_normalize_erasing_regions&lt;DefId&gt;()</code>?</p>



<a name="133903269"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/%2351002%20kill%20rustc%3A%3Acfg%20consumers/near/133903269" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/.2351002.20kill.20rustc.3A.3Acfg.20consumers.html#133903269">(Sep 13 2018 at 18:18)</a>:</h4>
<blockquote>
<p>Yeah. In my original version that used <code>optimized_mir()</code> this seemed to "just work". Ie, this test was passing. I guess optimized mir has already selected the correct functions for trait methods calls?</p>
</blockquote>
<p>I don't really understand this at all</p>



<a name="133903292"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/%2351002%20kill%20rustc%3A%3Acfg%20consumers/near/133903292" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/.2351002.20kill.20rustc.3A.3Acfg.20consumers.html#133903292">(Sep 13 2018 at 18:19)</a>:</h4>
<p>there is no difference between optimized-mir and non-optimized MIR in this respect</p>



<a name="133903318"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/%2351002%20kill%20rustc%3A%3Acfg%20consumers/near/133903318" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wesley Wiser <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/.2351002.20kill.20rustc.3A.3Acfg.20consumers.html#133903318">(Sep 13 2018 at 18:19)</a>:</h4>
<p>Hmm....</p>



<a name="133903321"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/%2351002%20kill%20rustc%3A%3Acfg%20consumers/near/133903321" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/.2351002.20kill.20rustc.3A.3Acfg.20consumers.html#133903321">(Sep 13 2018 at 18:19)</a>:</h4>
<blockquote>
<p>Is there a difference between <code>Instance::resolve()</code> and <code>subst_and_normalize_erasing_regions&lt;DefId&gt;()</code>?</p>
</blockquote>
<p>let me go read the source; in my head they are not particularly related to one another :)</p>



<a name="133903383"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/%2351002%20kill%20rustc%3A%3Acfg%20consumers/near/133903383" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wesley Wiser <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/.2351002.20kill.20rustc.3A.3Acfg.20consumers.html#133903383">(Sep 13 2018 at 18:20)</a>:</h4>
<p>That was a few days ago. Perhaps I'm just misremembering which tests were broken?</p>



<a name="133903393"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/%2351002%20kill%20rustc%3A%3Acfg%20consumers/near/133903393" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wesley Wiser <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/.2351002.20kill.20rustc.3A.3Acfg.20consumers.html#133903393">(Sep 13 2018 at 18:20)</a>:</h4>
<p>It's not really important</p>



<a name="133903403"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/%2351002%20kill%20rustc%3A%3Acfg%20consumers/near/133903403" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> qmx <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/.2351002.20kill.20rustc.3A.3Acfg.20consumers.html#133903403">(Sep 13 2018 at 18:20)</a>:</h4>
<p>/me vaguely remembers fiddling with <code>Instance::resolve()</code></p>



<a name="133903431"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/%2351002%20kill%20rustc%3A%3Acfg%20consumers/near/133903431" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/.2351002.20kill.20rustc.3A.3Acfg.20consumers.html#133903431">(Sep 13 2018 at 18:21)</a>:</h4>
<p>I guess they are related, in that <code>subst_and_normalize_erasing_regions</code> is sort of maybe a building block for <code>Instance::resolve</code></p>



<a name="133903436"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/%2351002%20kill%20rustc%3A%3Acfg%20consumers/near/133903436" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/.2351002.20kill.20rustc.3A.3Acfg.20consumers.html#133903436">(Sep 13 2018 at 18:21)</a>:</h4>
<p>in any case, the MIR just records the trait + types</p>



<a name="133903443"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/%2351002%20kill%20rustc%3A%3Acfg%20consumers/near/133903443" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/.2351002.20kill.20rustc.3A.3Acfg.20consumers.html#133903443">(Sep 13 2018 at 18:21)</a>:</h4>
<p>(when you are invoking a trait method)</p>



<a name="133903449"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/%2351002%20kill%20rustc%3A%3Acfg%20consumers/near/133903449" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wesley Wiser <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/.2351002.20kill.20rustc.3A.3Acfg.20consumers.html#133903449">(Sep 13 2018 at 18:21)</a>:</h4>
<blockquote>
<blockquote>
<p>Is there a difference between <code>Instance::resolve()</code> and <code>subst_and_normalize_erasing_regions&lt;DefId&gt;()</code>?</p>
</blockquote>
<p>let me go read the source; in my head they are not particularly related to one another :)</p>
</blockquote>
<p>They only seemed related to me in that they have, what I would expect, is the right function signature for what I want. They both take a <code>DefId</code>, <code>ParamEnv</code>, and <code>Substs</code> which is what I was thinking you'd need to resolve the trait method call</p>



<a name="133903456"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/%2351002%20kill%20rustc%3A%3Acfg%20consumers/near/133903456" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/.2351002.20kill.20rustc.3A.3Acfg.20consumers.html#133903456">(Sep 13 2018 at 18:21)</a>:</h4>
<p>the job of <code>Instance::resolve</code> is to try to match that up with a specific impl or other thing</p>



<a name="133903508"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/%2351002%20kill%20rustc%3A%3Acfg%20consumers/near/133903508" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> eddyb <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/.2351002.20kill.20rustc.3A.3Acfg.20consumers.html#133903508">(Sep 13 2018 at 18:22)</a>:</h4>
<p><span class="user-mention" data-user-id="125250">@Wesley Wiser</span> what do you have already? the lint helpers are useless because they're for the AST. what I think you need is to look at <code>TerminatorKind::Call</code> and the type of the function to call from it, if it's <code>ty::FnDef(def_id, substs)</code> you can feed those <code>def_id</code> and <code>substs</code> to <code>Instance::resolve</code></p>



<a name="133903513"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/%2351002%20kill%20rustc%3A%3Acfg%20consumers/near/133903513" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/.2351002.20kill.20rustc.3A.3Acfg.20consumers.html#133903513">(Sep 13 2018 at 18:22)</a>:</h4>
<p>ah well <code>subst_and_normalize_erasing_regions</code> would not normally be invoked on a <code>DefId</code></p>



<a name="133903518"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/%2351002%20kill%20rustc%3A%3Acfg%20consumers/near/133903518" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/.2351002.20kill.20rustc.3A.3Acfg.20consumers.html#133903518">(Sep 13 2018 at 18:22)</a>:</h4>
<p>that is a no-op</p>



<a name="133903524"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/%2351002%20kill%20rustc%3A%3Acfg%20consumers/near/133903524" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/.2351002.20kill.20rustc.3A.3Acfg.20consumers.html#133903524">(Sep 13 2018 at 18:22)</a>:</h4>
<p>it would be invoked on someting with types in it, usually</p>



<a name="133903538"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/%2351002%20kill%20rustc%3A%3Acfg%20consumers/near/133903538" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/.2351002.20kill.20rustc.3A.3Acfg.20consumers.html#133903538">(Sep 13 2018 at 18:22)</a>:</h4>
<p>looking at the inline code may be helpful</p>



<a name="133903547"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/%2351002%20kill%20rustc%3A%3Acfg%20consumers/near/133903547" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> eddyb <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/.2351002.20kill.20rustc.3A.3Acfg.20consumers.html#133903547">(Sep 13 2018 at 18:22)</a>:</h4>
<p>heh I should've suggested inline</p>



<a name="133903561"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/%2351002%20kill%20rustc%3A%3Acfg%20consumers/near/133903561" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/.2351002.20kill.20rustc.3A.3Acfg.20consumers.html#133903561">(Sep 13 2018 at 18:23)</a>:</h4>
<p>e.g., <a href="https://github.com/rust-lang/rust/blob/994cdd918589535d705177545bf503cd0c3c5148/src/librustc_mir/transform/inline.rs#L96-L111" target="_blank" title="https://github.com/rust-lang/rust/blob/994cdd918589535d705177545bf503cd0c3c5148/src/librustc_mir/transform/inline.rs#L96-L111">this part</a></p>



<a name="133903569"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/%2351002%20kill%20rustc%3A%3Acfg%20consumers/near/133903569" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wesley Wiser <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/.2351002.20kill.20rustc.3A.3Acfg.20consumers.html#133903569">(Sep 13 2018 at 18:23)</a>:</h4>
<p><span class="user-mention" data-user-id="119009">@eddyb</span>  Yep, that's what I've got. I should have pushed a branch last night to my repo so I could just link it</p>
<p>I've got a <code>DefId</code> for the function being called, its <code>Substs</code> and I can get access to the <code>ParamEnv</code> via the <code>tcx.param_env()</code> query</p>



<a name="133903591"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/%2351002%20kill%20rustc%3A%3Acfg%20consumers/near/133903591" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> eddyb <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/.2351002.20kill.20rustc.3A.3Acfg.20consumers.html#133903591">(Sep 13 2018 at 18:23)</a>:</h4>
<p>note that the param_env is that of the <em>caller</em>, not callee</p>



<a name="133903608"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/%2351002%20kill%20rustc%3A%3Acfg%20consumers/near/133903608" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> eddyb <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/.2351002.20kill.20rustc.3A.3Acfg.20consumers.html#133903608">(Sep 13 2018 at 18:23)</a>:</h4>
<p><span class="user-mention" data-user-id="116009">@nikomatsakis</span> oh that's wrong</p>



<a name="133903613"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/%2351002%20kill%20rustc%3A%3Acfg%20consumers/near/133903613" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> eddyb <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/.2351002.20kill.20rustc.3A.3Acfg.20consumers.html#133903613">(Sep 13 2018 at 18:23)</a>:</h4>
<p>/me opens issue</p>



<a name="133903615"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/%2351002%20kill%20rustc%3A%3Acfg%20consumers/near/133903615" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wesley Wiser <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/.2351002.20kill.20rustc.3A.3Acfg.20consumers.html#133903615">(Sep 13 2018 at 18:23)</a>:</h4>
<p>I want the <code>param_env(fn_being_linted)</code> right?</p>



<a name="133903621"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/%2351002%20kill%20rustc%3A%3Acfg%20consumers/near/133903621" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> eddyb <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/.2351002.20kill.20rustc.3A.3Acfg.20consumers.html#133903621">(Sep 13 2018 at 18:24)</a>:</h4>
<p>yeah</p>



<a name="133903660"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/%2351002%20kill%20rustc%3A%3Acfg%20consumers/near/133903660" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wesley Wiser <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/.2351002.20kill.20rustc.3A.3Acfg.20consumers.html#133903660">(Sep 13 2018 at 18:24)</a>:</h4>
<p>Ok, cool</p>



<a name="133903670"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/%2351002%20kill%20rustc%3A%3Acfg%20consumers/near/133903670" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> eddyb <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/.2351002.20kill.20rustc.3A.3Acfg.20consumers.html#133903670">(Sep 13 2018 at 18:24)</a>:</h4>
<p>you'd query it only once and use it later</p>



<a name="133903683"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/%2351002%20kill%20rustc%3A%3Acfg%20consumers/near/133903683" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wesley Wiser <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/.2351002.20kill.20rustc.3A.3Acfg.20consumers.html#133903683">(Sep 13 2018 at 18:24)</a>:</h4>
<p>Gotcha</p>



<a name="133903739"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/%2351002%20kill%20rustc%3A%3Acfg%20consumers/near/133903739" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wesley Wiser <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/.2351002.20kill.20rustc.3A.3Acfg.20consumers.html#133903739">(Sep 13 2018 at 18:25)</a>:</h4>
<p><span class="user-mention" data-user-id="116009">@nikomatsakis</span>  Oh, that's helpful. Thanks! I thought maybe there was code that did what I wanted in the codegen layer but I couldn't find it</p>



<a name="133903746"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/%2351002%20kill%20rustc%3A%3Acfg%20consumers/near/133903746" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> eddyb <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/.2351002.20kill.20rustc.3A.3Acfg.20consumers.html#133903746">(Sep 13 2018 at 18:25)</a>:</h4>
<p>it's in <code>rustc_codegen_llvm/mir/block.rs</code></p>



<a name="133903747"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/%2351002%20kill%20rustc%3A%3Acfg%20consumers/near/133903747" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> eddyb <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/.2351002.20kill.20rustc.3A.3Acfg.20consumers.html#133903747">(Sep 13 2018 at 18:25)</a>:</h4>
<p>but it's uglier</p>



<a name="133903843"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/%2351002%20kill%20rustc%3A%3Acfg%20consumers/near/133903843" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> eddyb <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/.2351002.20kill.20rustc.3A.3Acfg.20consumers.html#133903843">(Sep 13 2018 at 18:26)</a>:</h4>
<p><a href="https://github.com/rust-lang/rust/issues/54193" target="_blank" title="https://github.com/rust-lang/rust/issues/54193">https://github.com/rust-lang/rust/issues/54193</a></p>



<a name="133903863"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/%2351002%20kill%20rustc%3A%3Acfg%20consumers/near/133903863" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> eddyb <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/.2351002.20kill.20rustc.3A.3Acfg.20consumers.html#133903863">(Sep 13 2018 at 18:27)</a>:</h4>
<p>make sure you don't make the same mistake the inline code does</p>



<a name="133903968"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/%2351002%20kill%20rustc%3A%3Acfg%20consumers/near/133903968" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/.2351002.20kill.20rustc.3A.3Acfg.20consumers.html#133903968">(Sep 13 2018 at 18:28)</a>:</h4>
<p><span class="user-mention" data-user-id="119009">@eddyb</span> wait, what's wrong exactly?</p>



<a name="133903973"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/%2351002%20kill%20rustc%3A%3Acfg%20consumers/near/133903973" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/.2351002.20kill.20rustc.3A.3Acfg.20consumers.html#133903973">(Sep 13 2018 at 18:28)</a>:</h4>
<p>/me looks at the inline code again</p>



<a name="133903979"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/%2351002%20kill%20rustc%3A%3Acfg%20consumers/near/133903979" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/.2351002.20kill.20rustc.3A.3Acfg.20consumers.html#133903979">(Sep 13 2018 at 18:29)</a>:</h4>
<p>I remember there was some ICE, maybe it's related?</p>



<a name="133903996"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/%2351002%20kill%20rustc%3A%3Acfg%20consumers/near/133903996" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wesley Wiser <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/.2351002.20kill.20rustc.3A.3Acfg.20consumers.html#133903996">(Sep 13 2018 at 18:29)</a>:</h4>
<p><span class="user-mention" data-user-id="119009">@eddyb</span> I have a pattern match that looks just like that right now. I should just call <code>Operand::ty(mir, tcx)</code> instead?</p>



<a name="133904122"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/%2351002%20kill%20rustc%3A%3Acfg%20consumers/near/133904122" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/.2351002.20kill.20rustc.3A.3Acfg.20consumers.html#133904122">(Sep 13 2018 at 18:31)</a>:</h4>
<p>I don't see what's wrong about the inline code yet :)</p>



<a name="133904933"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/%2351002%20kill%20rustc%3A%3Acfg%20consumers/near/133904933" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> eddyb <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/.2351002.20kill.20rustc.3A.3Acfg.20consumers.html#133904933">(Sep 13 2018 at 18:43)</a>:</h4>
<p>yeah you should call the method</p>



<a name="133904938"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/%2351002%20kill%20rustc%3A%3Acfg%20consumers/near/133904938" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> eddyb <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/.2351002.20kill.20rustc.3A.3Acfg.20consumers.html#133904938">(Sep 13 2018 at 18:43)</a>:</h4>
<p>and change the inline code while you're at it</p>



<a name="133904942"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/%2351002%20kill%20rustc%3A%3Acfg%20consumers/near/133904942" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> eddyb <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/.2351002.20kill.20rustc.3A.3Acfg.20consumers.html#133904942">(Sep 13 2018 at 18:44)</a>:</h4>
<p><span class="user-mention" data-user-id="116009">@nikomatsakis</span> I linked an issue</p>



<a name="133904995"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/%2351002%20kill%20rustc%3A%3Acfg%20consumers/near/133904995" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> eddyb <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/.2351002.20kill.20rustc.3A.3Acfg.20consumers.html#133904995">(Sep 13 2018 at 18:44)</a>:</h4>
<p>or are you saying the issue isn't clear enough?</p>



<a name="133904999"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/%2351002%20kill%20rustc%3A%3Acfg%20consumers/near/133904999" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/.2351002.20kill.20rustc.3A.3Acfg.20consumers.html#133904999">(Sep 13 2018 at 18:44)</a>:</h4>
<p>oh</p>



<a name="133905002"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/%2351002%20kill%20rustc%3A%3Acfg%20consumers/near/133905002" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/.2351002.20kill.20rustc.3A.3Acfg.20consumers.html#133905002">(Sep 13 2018 at 18:44)</a>:</h4>
<p>I didn't see that</p>



<a name="133905011"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/%2351002%20kill%20rustc%3A%3Acfg%20consumers/near/133905011" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/.2351002.20kill.20rustc.3A.3Acfg.20consumers.html#133905011">(Sep 13 2018 at 18:44)</a>:</h4>
<p>I see it now</p>



<a name="133905015"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/%2351002%20kill%20rustc%3A%3Acfg%20consumers/near/133905015" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/.2351002.20kill.20rustc.3A.3Acfg.20consumers.html#133905015">(Sep 13 2018 at 18:44)</a>:</h4>
<p>so you're saying it is insufficiently general</p>



<a name="133905021"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/%2351002%20kill%20rustc%3A%3Acfg%20consumers/near/133905021" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/.2351002.20kill.20rustc.3A.3Acfg.20consumers.html#133905021">(Sep 13 2018 at 18:44)</a>:</h4>
<p>but not that it's using the wrong <code>param_env</code> or something</p>



<a name="133905024"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/%2351002%20kill%20rustc%3A%3Acfg%20consumers/near/133905024" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/.2351002.20kill.20rustc.3A.3Acfg.20consumers.html#133905024">(Sep 13 2018 at 18:44)</a>:</h4>
<p>I thought you meant the latter</p>



<a name="133905088"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/%2351002%20kill%20rustc%3A%3Acfg%20consumers/near/133905088" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> eddyb <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/.2351002.20kill.20rustc.3A.3Acfg.20consumers.html#133905088">(Sep 13 2018 at 18:46)</a>:</h4>
<p>right, it's only a mistake in the sense of missing the more general approach, not incorrectness</p>



<a name="133905463"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/%2351002%20kill%20rustc%3A%3Acfg%20consumers/near/133905463" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wesley Wiser <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/.2351002.20kill.20rustc.3A.3Acfg.20consumers.html#133905463">(Sep 13 2018 at 18:51)</a>:</h4>
<p><span class="user-mention" data-user-id="119009">@eddyb</span> Got it <span class="emoji emoji-1f44d" title="thumbs up">:thumbs_up:</span></p>



<hr><p>Last updated: Aug 07 2021 at 22:04 UTC</p>
</html>