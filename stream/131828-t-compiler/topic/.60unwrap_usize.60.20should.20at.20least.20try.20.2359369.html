<html>
<head><meta charset="utf-8"><title>`unwrap_usize` should at least try #59369 · t-compiler · Zulip Chat Archive</title></head>
<h2>Stream: <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/index.html">t-compiler</a></h2>
<h3>Topic: <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/.60unwrap_usize.60.20should.20at.20least.20try.20.2359369.html">`unwrap_usize` should at least try #59369</a></h3>

<hr>

<base href="https://rust-lang.zulipchat.com">

<head><link href="https://zulip-archive.rust-lang.org/style.css" rel="stylesheet"></head>

<a name="170711854"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/%60unwrap_usize%60%20should%20at%20least%20try%20%2359369/near/170711854" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/.60unwrap_usize.60.20should.20at.20least.20try.20.2359369.html#170711854">(Jul 12 2019 at 10:41)</a>:</h4>
<p>Ugh <span class="user-mention" data-user-id="124288">@oli</span> how did we not land this PR yet. (I'm going through review queue)</p>



<a name="170711914"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/%60unwrap_usize%60%20should%20at%20least%20try%20%2359369/near/170711914" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/.60unwrap_usize.60.20should.20at.20least.20try.20.2359369.html#170711914">(Jul 12 2019 at 10:42)</a>:</h4>
<p>I remember we looked at it together...</p>



<a name="170712117"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/%60unwrap_usize%60%20should%20at%20least%20try%20%2359369/near/170712117" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> eddyb <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/.60unwrap_usize.60.20should.20at.20least.20try.20.2359369.html#170712117">(Jul 12 2019 at 10:45)</a>:</h4>
<p>should I try to look at it again today and see if there's anything that I could help with?</p>



<a name="170712195"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/%60unwrap_usize%60%20should%20at%20least%20try%20%2359369/near/170712195" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/.60unwrap_usize.60.20should.20at.20least.20try.20.2359369.html#170712195">(Jul 12 2019 at 10:46)</a>:</h4>
<p>my memory is that the PR itself was fairly harmless but that we needed (separately) to do a review of how normalization/canonicalization played into constants</p>



<a name="170712200"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/%60unwrap_usize%60%20should%20at%20least%20try%20%2359369/near/170712200" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/.60unwrap_usize.60.20should.20at.20least.20try.20.2359369.html#170712200">(Jul 12 2019 at 10:46)</a>:</h4>
<p>I'm lokoing over again to try and jog my memory</p>



<a name="170712363"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/%60unwrap_usize%60%20should%20at%20least%20try%20%2359369/near/170712363" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> eddyb <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/.60unwrap_usize.60.20should.20at.20least.20try.20.2359369.html#170712363">(Jul 12 2019 at 10:48)</a>:</h4>
<p>ah I see</p>



<a name="170712367"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/%60unwrap_usize%60%20should%20at%20least%20try%20%2359369/near/170712367" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> eddyb <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/.60unwrap_usize.60.20should.20at.20least.20try.20.2359369.html#170712367">(Jul 12 2019 at 10:48)</a>:</h4>
<p>I had left some comments that oli didn't resolve</p>



<a name="170712378"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/%60unwrap_usize%60%20should%20at%20least%20try%20%2359369/near/170712378" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> eddyb <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/.60unwrap_usize.60.20should.20at.20least.20try.20.2359369.html#170712378">(Jul 12 2019 at 10:48)</a>:</h4>
<p>like this <a href="https://github.com/rust-lang/rust/pull/59369/files#r285040505" target="_blank" title="https://github.com/rust-lang/rust/pull/59369/files#r285040505">https://github.com/rust-lang/rust/pull/59369/files#r285040505</a></p>



<a name="170712396"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/%60unwrap_usize%60%20should%20at%20least%20try%20%2359369/near/170712396" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> eddyb <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/.60unwrap_usize.60.20should.20at.20least.20try.20.2359369.html#170712396">(Jul 12 2019 at 10:49)</a>:</h4>
<p>we need to fail gracefully <em>everywhere</em>, we can't ICE in any of this</p>



<a name="170712449"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/%60unwrap_usize%60%20should%20at%20least%20try%20%2359369/near/170712449" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> eddyb <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/.60unwrap_usize.60.20should.20at.20least.20try.20.2359369.html#170712449">(Jul 12 2019 at 10:50)</a>:</h4>
<p>(well, we can ICE in codegen, I guess. but not in inference)</p>



<a name="170712475"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/%60unwrap_usize%60%20should%20at%20least%20try%20%2359369/near/170712475" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> eddyb <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/.60unwrap_usize.60.20should.20at.20least.20try.20.2359369.html#170712475">(Jul 12 2019 at 10:50)</a>:</h4>
<p><span class="user-mention" data-user-id="116009">@nikomatsakis</span> should I wait for <span class="user-mention" data-user-id="124288">@oli</span> or try to rebase the PR myself and make the changes I suggested?</p>



<a name="170712593"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/%60unwrap_usize%60%20should%20at%20least%20try%20%2359369/near/170712593" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/.60unwrap_usize.60.20should.20at.20least.20try.20.2359369.html#170712593">(Jul 12 2019 at 10:53)</a>:</h4>
<p>I don't know. I'm having trouble remembering the details of this now.</p>



<a name="170712594"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/%60unwrap_usize%60%20should%20at%20least%20try%20%2359369/near/170712594" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/.60unwrap_usize.60.20should.20at.20least.20try.20.2359369.html#170712594">(Jul 12 2019 at 10:53)</a>:</h4>
<p><span class="user-mention" data-user-id="119009">@eddyb</span> hmm I wonder if it makes sense to try and do an impromptu discussion this morning (perhaps in ~3 hours?) to talk about the overall strategy around normalization, constants, etc?</p>



<a name="170712605"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/%60unwrap_usize%60%20should%20at%20least%20try%20%2359369/near/170712605" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> eddyb <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/.60unwrap_usize.60.20should.20at.20least.20try.20.2359369.html#170712605">(Jul 12 2019 at 10:53)</a>:</h4>
<p>sure</p>



<a name="170733408"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/%60unwrap_usize%60%20should%20at%20least%20try%20%2359369/near/170733408" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> oli <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/.60unwrap_usize.60.20should.20at.20least.20try.20.2359369.html#170733408">(Jul 12 2019 at 15:55)</a>:</h4>
<p>Failing to lift would intern?</p>



<a name="170733474"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/%60unwrap_usize%60%20should%20at%20least%20try%20%2359369/near/170733474" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> oli <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/.60unwrap_usize.60.20should.20at.20least.20try.20.2359369.html#170733474">(Jul 12 2019 at 15:56)</a>:</h4>
<p>Or we should never lift something that isn't already interned?</p>



<a name="170789306"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/%60unwrap_usize%60%20should%20at%20least%20try%20%2359369/near/170789306" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> eddyb <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/.60unwrap_usize.60.20should.20at.20least.20try.20.2359369.html#170789306">(Jul 13 2019 at 13:10)</a>:</h4>
<p><code>lift_to_global</code> doesn't even exist anymore, now you have to check it some other way. but it was about inference variables, all along</p>



<a name="170789312"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/%60unwrap_usize%60%20should%20at%20least%20try%20%2359369/near/170789312" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> eddyb <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/.60unwrap_usize.60.20should.20at.20least.20try.20.2359369.html#170789312">(Jul 13 2019 at 13:11)</a>:</h4>
<p>if you have infer vars, you can't pass them to a query (we should maybe enforce this in the query engine, if we can do it cheaply, idk)</p>



<hr><p>Last updated: Apr 12 2022 at 20:01 UTC</p>
</html>