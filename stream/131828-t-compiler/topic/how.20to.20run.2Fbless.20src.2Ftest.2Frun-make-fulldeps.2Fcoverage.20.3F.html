<html>
<head><meta charset="utf-8"><title>how to run/bless src/test/run-make-fulldeps/coverage ? · t-compiler · Zulip Chat Archive</title></head>
<h2>Stream: <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/index.html">t-compiler</a></h2>
<h3>Topic: <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/how.20to.20run.2Fbless.20src.2Ftest.2Frun-make-fulldeps.2Fcoverage.20.3F.html">how to run/bless src/test/run-make-fulldeps/coverage ?</a></h3>

<hr>

<base href="https://rust-lang.zulipchat.com">

<head><link href="https://zulip-archive.rust-lang.org/style.css" rel="stylesheet"></head>

<a name="224109381"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/how%20to%20run/bless%20src/test/run-make-fulldeps/coverage%20%3F/near/224109381" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> pnkfelix <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/how.20to.20run.2Fbless.20src.2Ftest.2Frun-make-fulldeps.2Fcoverage.20.3F.html#224109381">(Jan 26 2021 at 21:53)</a>:</h4>
<p>While working on PR <a href="https://github.com/rust-lang/rust/issues/81257">#81257</a>, I have discovered that we have a bunch of generated html files from coverage tools in the repo. What is the right invocation to <code>x.py test --bless</code> to actually regenerate them?</p>



<a name="224109897"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/how%20to%20run/bless%20src/test/run-make-fulldeps/coverage%20%3F/near/224109897" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> pnkfelix <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/how.20to.20run.2Fbless.20src.2Ftest.2Frun-make-fulldeps.2Fcoverage.20.3F.html#224109897">(Jan 26 2021 at 21:57)</a>:</h4>
<p>^ <span class="user-mention" data-user-id="296355">@Rich Kadel</span> ?</p>



<a name="224114434"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/how%20to%20run/bless%20src/test/run-make-fulldeps/coverage%20%3F/near/224114434" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Rich Kadel <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/how.20to.20run.2Fbless.20src.2Ftest.2Frun-make-fulldeps.2Fcoverage.20.3F.html#224114434">(Jan 26 2021 at 22:31)</a>:</h4>
<p>./x.py test src/test/run-make-fulldeps/coverage --bless</p>



<a name="224130947"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/how%20to%20run/bless%20src/test/run-make-fulldeps/coverage%20%3F/near/224130947" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> pnkfelix <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/how.20to.20run.2Fbless.20src.2Ftest.2Frun-make-fulldeps.2Fcoverage.20.3F.html#224130947">(Jan 27 2021 at 01:54)</a>:</h4>
<p>That would imply that <code>./x.py test src/test/run-make-fulldeps/coverage</code> does something. Are the generated html files ... not checked as part of the testing...?</p>



<a name="224130984"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/how%20to%20run/bless%20src/test/run-make-fulldeps/coverage%20%3F/near/224130984" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> pnkfelix <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/how.20to.20run.2Fbless.20src.2Ftest.2Frun-make-fulldeps.2Fcoverage.20.3F.html#224130984">(Jan 27 2021 at 01:55)</a>:</h4>
<p>In other words: I did the above, without <code>--bless</code>, and did not observe a test failure, despite having made an obviously broken change to the .html file for one of the coverage tests.</p>



<a name="224826522"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/how%20to%20run/bless%20src/test/run-make-fulldeps/coverage%20%3F/near/224826522" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> pnkfelix <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/how.20to.20run.2Fbless.20src.2Ftest.2Frun-make-fulldeps.2Fcoverage.20.3F.html#224826522">(Feb 02 2021 at 04:03)</a>:</h4>
<p><del>It seems to me like my problem is somehow arising because of how the bootstrap system is trying to communicate to <code>compiletest</code> that profiler support is enabled. At least, for me, I am seeing that bootstrap is <em>trying</em> to set env var RUSTC_PROFILER_SUPPORT to 1, but <code>compiletest</code>, when reading that env var, is saying that its <code>None</code>. <span aria-label="sad" class="emoji emoji-2639" role="img" title="sad">:sad:</span></del> No, maybe its not this. argh I do hate how hard it is to treat <code>compiletest</code> as its own entity.</p>



<a name="224828832"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/how%20to%20run/bless%20src/test/run-make-fulldeps/coverage%20%3F/near/224828832" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> pnkfelix <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/how.20to.20run.2Fbless.20src.2Ftest.2Frun-make-fulldeps.2Fcoverage.20.3F.html#224828832">(Feb 02 2021 at 04:51)</a>:</h4>
<p>whelp, its gotten to the point where I am now running invoking <code>compiletest</code> under <code>rr</code> so that I can go back through its execution and figure out how its actually invoking these tests and why its accepting my bogus coverage files.</p>



<a name="224829267"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/how%20to%20run/bless%20src/test/run-make-fulldeps/coverage%20%3F/near/224829267" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> pnkfelix <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/how.20to.20run.2Fbless.20src.2Ftest.2Frun-make-fulldeps.2Fcoverage.20.3F.html#224829267">(Feb 02 2021 at 05:00)</a>:</h4>
<p>(I'll tell you one thing: the fact that I was able to accidentally delete the <code>tools.mk</code> file, run <code>x.py test</code> for the run-make-fulldeps, and have everything <em>but</em> the coverage tests fail, leads me to wonder if the coverage tests makefile has something wrong with it where its a little too eager to pass...)</p>



<a name="224847357"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/how%20to%20run/bless%20src/test/run-make-fulldeps/coverage%20%3F/near/224847357" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joshua Nelson <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/how.20to.20run.2Fbless.20src.2Ftest.2Frun-make-fulldeps.2Fcoverage.20.3F.html#224847357">(Feb 02 2021 at 09:37)</a>:</h4>
<p>If you pass -v it should show you what command line it passes</p>



<a name="224881075"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/how%20to%20run/bless%20src/test/run-make-fulldeps/coverage%20%3F/near/224881075" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> pnkfelix <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/how.20to.20run.2Fbless.20src.2Ftest.2Frun-make-fulldeps.2Fcoverage.20.3F.html#224881075">(Feb 02 2021 at 14:51)</a>:</h4>
<p>In my experience so far, the verbosity levels available via <code>config.toml</code> do not trigger sufficient exposure of info from the <code>compiletest</code> runs</p>



<a name="224881151"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/how%20to%20run/bless%20src/test/run-make-fulldeps/coverage%20%3F/near/224881151" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> pnkfelix <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/how.20to.20run.2Fbless.20src.2Ftest.2Frun-make-fulldeps.2Fcoverage.20.3F.html#224881151">(Feb 02 2021 at 14:51)</a>:</h4>
<p>(and trying to run <code>compiletest</code> directly works in some contexts, but not in others, because we do not make it sufficiently clear what environment variables are being set/cleared by <code>x.py</code>)</p>



<a name="224881246"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/how%20to%20run/bless%20src/test/run-make-fulldeps/coverage%20%3F/near/224881246" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> pnkfelix <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/how.20to.20run.2Fbless.20src.2Ftest.2Frun-make-fulldeps.2Fcoverage.20.3F.html#224881246">(Feb 02 2021 at 14:52)</a>:</h4>
<p>This has been a long standing point of frustration for me with our infrastructure. In some ways I’m shocked its taken me this long to consider running <code>compiletest</code> under <code>rr</code> to sidestep these issues.</p>



<a name="224881494"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/how%20to%20run/bless%20src/test/run-make-fulldeps/coverage%20%3F/near/224881494" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> simulacrum <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/how.20to.20run.2Fbless.20src.2Ftest.2Frun-make-fulldeps.2Fcoverage.20.3F.html#224881494">(Feb 02 2021 at 14:54)</a>:</h4>
<p>hm, I thought we threaded through arbitrary levels of verbosity, so this is a surprise to me</p>



<a name="224881569"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/how%20to%20run/bless%20src/test/run-make-fulldeps/coverage%20%3F/near/224881569" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> pnkfelix <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/how.20to.20run.2Fbless.20src.2Ftest.2Frun-make-fulldeps.2Fcoverage.20.3F.html#224881569">(Feb 02 2021 at 14:54)</a>:</h4>
<p>I’d love to be proven wrong here</p>



<a name="224881659"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/how%20to%20run/bless%20src/test/run-make-fulldeps/coverage%20%3F/near/224881659" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> pnkfelix <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/how.20to.20run.2Fbless.20src.2Ftest.2Frun-make-fulldeps.2Fcoverage.20.3F.html#224881659">(Feb 02 2021 at 14:55)</a>:</h4>
<p>Of course its obvous that <em>something</em> is different about my setup, so maybe all these issues are linkied.</p>



<a name="224881765"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/how%20to%20run/bless%20src/test/run-make-fulldeps/coverage%20%3F/near/224881765" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> simulacrum <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/how.20to.20run.2Fbless.20src.2Ftest.2Frun-make-fulldeps.2Fcoverage.20.3F.html#224881765">(Feb 02 2021 at 14:56)</a>:</h4>
<p><a href="https://github.com/rust-lang/rust/blob/master/src/bootstrap/test.rs#L1168">https://github.com/rust-lang/rust/blob/master/src/bootstrap/test.rs#L1168</a> - I guess not, but, you <em>could</em> presumably do <code>--test-args --verbose</code>?</p>



<a name="224881802"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/how%20to%20run/bless%20src/test/run-make-fulldeps/coverage%20%3F/near/224881802" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> pnkfelix <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/how.20to.20run.2Fbless.20src.2Ftest.2Frun-make-fulldeps.2Fcoverage.20.3F.html#224881802">(Feb 02 2021 at 14:56)</a>:</h4>
<p>I’ll try that</p>



<a name="224881809"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/how%20to%20run/bless%20src/test/run-make-fulldeps/coverage%20%3F/near/224881809" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> simulacrum <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/how.20to.20run.2Fbless.20src.2Ftest.2Frun-make-fulldeps.2Fcoverage.20.3F.html#224881809">(Feb 02 2021 at 14:56)</a>:</h4>
<p>not sure if that actually works. I would be happy to support arbitrary levels of -v getting threaded</p>



<a name="224894158"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/how%20to%20run/bless%20src/test/run-make-fulldeps/coverage%20%3F/near/224894158" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> tm <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/how.20to.20run.2Fbless.20src.2Ftest.2Frun-make-fulldeps.2Fcoverage.20.3F.html#224894158">(Feb 02 2021 at 16:17)</a>:</h4>
<p>FYI: there is also logging in compiletest <code>env RUST_LOG=compiletest=debug</code></p>



<a name="224962140"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/how%20to%20run/bless%20src/test/run-make-fulldeps/coverage%20%3F/near/224962140" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> pnkfelix <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/how.20to.20run.2Fbless.20src.2Ftest.2Frun-make-fulldeps.2Fcoverage.20.3F.html#224962140">(Feb 03 2021 at 01:22)</a>:</h4>
<p><em>finally</em> got an answer to my issue. I added <code>debug!</code> lines to <code>fn run_rmake_test</code>  to emit the <code>stdout</code> and <code>stderr</code> outputs even on test "success", and it is absolutely clear that I am skipping the coverage generation because it "requires LLVM 11 or higher."</p>



<a name="224962385"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/how%20to%20run/bless%20src/test/run-make-fulldeps/coverage%20%3F/near/224962385" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> pnkfelix <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/how.20to.20run.2Fbless.20src.2Ftest.2Frun-make-fulldeps.2Fcoverage.20.3F.html#224962385">(Feb 03 2021 at 01:26)</a>:</h4>
<p>I suspect there are other problems going on in addition to that. The LLVM version message is sent to stdout, but I see ominous output on stderr as well: </p>
<div class="codehilite"><pre><span></span><code>compiletest::runtest: stdout
Rust option `-Z instrument-coverage` requires LLVM 11 or higher. Test skipped.
make: Nothing to be done for &#39;all&#39;.

stderr
/bin/sh: 1: Bad substitution
</code></pre></div>



<a name="224962530"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/how%20to%20run/bless%20src/test/run-make-fulldeps/coverage%20%3F/near/224962530" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> pnkfelix <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/how.20to.20run.2Fbless.20src.2Ftest.2Frun-make-fulldeps.2Fcoverage.20.3F.html#224962530">(Feb 03 2021 at 01:27)</a>:</h4>
<p>I suspect we should consider, at least in verbose mode, that we should include the outputs for ignored tests. That, and/or we should increase the feedback so that ignored tests include a <em>reason</em> that they were ignored in the line-per-test output.</p>



<a name="224962594"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/how%20to%20run/bless%20src/test/run-make-fulldeps/coverage%20%3F/near/224962594" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> pnkfelix <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/how.20to.20run.2Fbless.20src.2Ftest.2Frun-make-fulldeps.2Fcoverage.20.3F.html#224962594">(Feb 03 2021 at 01:28)</a>:</h4>
<p>Now my next question: Why am I not detecting LLVM &gt;= 11? I would have assumed that I must have it, given that I'm using the LLVM that we get by default...</p>



<a name="224962607"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/how%20to%20run/bless%20src/test/run-make-fulldeps/coverage%20%3F/near/224962607" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> simulacrum <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/how.20to.20run.2Fbless.20src.2Ftest.2Frun-make-fulldeps.2Fcoverage.20.3F.html#224962607">(Feb 03 2021 at 01:28)</a>:</h4>
<p>Are you using the download from CI support?</p>



<a name="224962635"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/how%20to%20run/bless%20src/test/run-make-fulldeps/coverage%20%3F/near/224962635" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> pnkfelix <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/how.20to.20run.2Fbless.20src.2Ftest.2Frun-make-fulldeps.2Fcoverage.20.3F.html#224962635">(Feb 03 2021 at 01:29)</a>:</h4>
<p>i wasn't at the start, but I might have switched to using that in my desparation</p>



<a name="224962672"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/how%20to%20run/bless%20src/test/run-make-fulldeps/coverage%20%3F/near/224962672" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> pnkfelix <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/how.20to.20run.2Fbless.20src.2Ftest.2Frun-make-fulldeps.2Fcoverage.20.3F.html#224962672">(Feb 03 2021 at 01:30)</a>:</h4>
<p>no, this config.toml uses the default (download-ci-llvm=false)</p>



<a name="224962731"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/how%20to%20run/bless%20src/test/run-make-fulldeps/coverage%20%3F/near/224962731" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> simulacrum <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/how.20to.20run.2Fbless.20src.2Ftest.2Frun-make-fulldeps.2Fcoverage.20.3F.html#224962731">(Feb 03 2021 at 01:30)</a>:</h4>
<p>Hm, then I presume you are building it locally if you don't have llvm-config set...</p>



<a name="224962736"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/how%20to%20run/bless%20src/test/run-make-fulldeps/coverage%20%3F/near/224962736" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> pnkfelix <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/how.20to.20run.2Fbless.20src.2Ftest.2Frun-make-fulldeps.2Fcoverage.20.3F.html#224962736">(Feb 03 2021 at 01:30)</a>:</h4>
<p>yes I believe so</p>



<a name="224962750"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/how%20to%20run/bless%20src/test/run-make-fulldeps/coverage%20%3F/near/224962750" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> pnkfelix <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/how.20to.20run.2Fbless.20src.2Ftest.2Frun-make-fulldeps.2Fcoverage.20.3F.html#224962750">(Feb 03 2021 at 01:30)</a>:</h4>
<p>I wonder if the LLVM version detection is broken?</p>



<a name="224962754"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/how%20to%20run/bless%20src/test/run-make-fulldeps/coverage%20%3F/near/224962754" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> pnkfelix <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/how.20to.20run.2Fbless.20src.2Ftest.2Frun-make-fulldeps.2Fcoverage.20.3F.html#224962754">(Feb 03 2021 at 01:30)</a>:</h4>
<p>this is in the makefile itself, if I understand correclty</p>



<a name="224962757"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/how%20to%20run/bless%20src/test/run-make-fulldeps/coverage%20%3F/near/224962757" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> pnkfelix <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/how.20to.20run.2Fbless.20src.2Ftest.2Frun-make-fulldeps.2Fcoverage.20.3F.html#224962757">(Feb 03 2021 at 01:31)</a>:</h4>
<p>or... oh ...</p>



<a name="224962770"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/how%20to%20run/bless%20src/test/run-make-fulldeps/coverage%20%3F/near/224962770" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> pnkfelix <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/how.20to.20run.2Fbless.20src.2Ftest.2Frun-make-fulldeps.2Fcoverage.20.3F.html#224962770">(Feb 03 2021 at 01:31)</a>:</h4>
<p>I think I know what might be wrong</p>



<a name="224962856"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/how%20to%20run/bless%20src/test/run-make-fulldeps/coverage%20%3F/near/224962856" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> pnkfelix <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/how.20to.20run.2Fbless.20src.2Ftest.2Frun-make-fulldeps.2Fcoverage.20.3F.html#224962856">(Feb 03 2021 at 01:32)</a>:</h4>
<p>I have, as a historical artifact, a ton of symlinks in my personal $HOME/bin directory that are symlinks from llvm-utility (e.g. <code>llvm-prof</code>) to a single <code>llvm-opt-redirect.sh</code> script</p>



<a name="224962866"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/how%20to%20run/bless%20src/test/run-make-fulldeps/coverage%20%3F/near/224962866" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> pnkfelix <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/how.20to.20run.2Fbless.20src.2Ftest.2Frun-make-fulldeps.2Fcoverage.20.3F.html#224962866">(Feb 03 2021 at 01:32)</a>:</h4>
<p>I wonder if that's confusing the Makefile in some way</p>



<a name="224962869"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/how%20to%20run/bless%20src/test/run-make-fulldeps/coverage%20%3F/near/224962869" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> simulacrum <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/how.20to.20run.2Fbless.20src.2Ftest.2Frun-make-fulldeps.2Fcoverage.20.3F.html#224962869">(Feb 03 2021 at 01:32)</a>:</h4>
<p>Huh</p>



<a name="224962879"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/how%20to%20run/bless%20src/test/run-make-fulldeps/coverage%20%3F/near/224962879" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> simulacrum <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/how.20to.20run.2Fbless.20src.2Ftest.2Frun-make-fulldeps.2Fcoverage.20.3F.html#224962879">(Feb 03 2021 at 01:32)</a>:</h4>
<p>We shouldn't be relying on PATH...</p>



<a name="224962891"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/how%20to%20run/bless%20src/test/run-make-fulldeps/coverage%20%3F/near/224962891" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> pnkfelix <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/how.20to.20run.2Fbless.20src.2Ftest.2Frun-make-fulldeps.2Fcoverage.20.3F.html#224962891">(Feb 03 2021 at 01:32)</a>:</h4>
<p>as in, we should be using our own checkouts?</p>



<a name="224962901"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/how%20to%20run/bless%20src/test/run-make-fulldeps/coverage%20%3F/near/224962901" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> pnkfelix <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/how.20to.20run.2Fbless.20src.2Ftest.2Frun-make-fulldeps.2Fcoverage.20.3F.html#224962901">(Feb 03 2021 at 01:33)</a>:</h4>
<p>I wouldn't be surprised if the Makefile relies on PATH</p>



<a name="224962939"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/how%20to%20run/bless%20src/test/run-make-fulldeps/coverage%20%3F/near/224962939" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> pnkfelix <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/how.20to.20run.2Fbless.20src.2Ftest.2Frun-make-fulldeps.2Fcoverage.20.3F.html#224962939">(Feb 03 2021 at 01:33)</a>:</h4>
<p>I can check this quickly, I'll just move those symlinks elsewhere</p>



<a name="224962973"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/how%20to%20run/bless%20src/test/run-make-fulldeps/coverage%20%3F/near/224962973" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> simulacrum <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/how.20to.20run.2Fbless.20src.2Ftest.2Frun-make-fulldeps.2Fcoverage.20.3F.html#224962973">(Feb 03 2021 at 01:33)</a>:</h4>
<p>Yeah, I would expect everything to go through our built LLVM, and I'd be surprised if path would find anything on CI since we don't install an LLVM there...</p>



<a name="224963026"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/how%20to%20run/bless%20src/test/run-make-fulldeps/coverage%20%3F/near/224963026" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> pnkfelix <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/how.20to.20run.2Fbless.20src.2Ftest.2Frun-make-fulldeps.2Fcoverage.20.3F.html#224963026">(Feb 03 2021 at 01:34)</a>:</h4>
<p>okay moving my whole <code>~/bin</code> out of the way didn't resolve the rpoblem</p>



<a name="224963027"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/how%20to%20run/bless%20src/test/run-make-fulldeps/coverage%20%3F/near/224963027" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> simulacrum <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/how.20to.20run.2Fbless.20src.2Ftest.2Frun-make-fulldeps.2Fcoverage.20.3F.html#224963027">(Feb 03 2021 at 01:34)</a>:</h4>
<p>Maybe we're just not testing on CI? At least on some builders?</p>



<a name="224963042"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/how%20to%20run/bless%20src/test/run-make-fulldeps/coverage%20%3F/near/224963042" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> pnkfelix <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/how.20to.20run.2Fbless.20src.2Ftest.2Frun-make-fulldeps.2Fcoverage.20.3F.html#224963042">(Feb 03 2021 at 01:34)</a>:</h4>
<p>We might only be testing on the Windows builder</p>



<a name="224963050"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/how%20to%20run/bless%20src/test/run-make-fulldeps/coverage%20%3F/near/224963050" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> pnkfelix <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/how.20to.20run.2Fbless.20src.2Ftest.2Frun-make-fulldeps.2Fcoverage.20.3F.html#224963050">(Feb 03 2021 at 01:34)</a>:</h4>
<p>I think I have noticed that I only get these errors on Windows CI builds</p>



<a name="224963056"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/how%20to%20run/bless%20src/test/run-make-fulldeps/coverage%20%3F/near/224963056" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> simulacrum <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/how.20to.20run.2Fbless.20src.2Ftest.2Frun-make-fulldeps.2Fcoverage.20.3F.html#224963056">(Feb 03 2021 at 01:35)</a>:</h4>
<p>Have you had someone else try to reproduce? (e.g. maybe I should try a check out)</p>



<a name="224963061"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/how%20to%20run/bless%20src/test/run-make-fulldeps/coverage%20%3F/near/224963061" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> pnkfelix <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/how.20to.20run.2Fbless.20src.2Ftest.2Frun-make-fulldeps.2Fcoverage.20.3F.html#224963061">(Feb 03 2021 at 01:35)</a>:</h4>
<p>(but other Linux developers are seeing these tests run properly on their setups)</p>



<a name="224963075"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/how%20to%20run/bless%20src/test/run-make-fulldeps/coverage%20%3F/near/224963075" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> pnkfelix <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/how.20to.20run.2Fbless.20src.2Ftest.2Frun-make-fulldeps.2Fcoverage.20.3F.html#224963075">(Feb 03 2021 at 01:35)</a>:</h4>
<p>(that is, <code>--bless</code> works for them, in terms of modifying the files)</p>



<a name="224963078"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/how%20to%20run/bless%20src/test/run-make-fulldeps/coverage%20%3F/near/224963078" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> simulacrum <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/how.20to.20run.2Fbless.20src.2Ftest.2Frun-make-fulldeps.2Fcoverage.20.3F.html#224963078">(Feb 03 2021 at 01:35)</a>:</h4>
<p>Hm interesting</p>



<a name="224963081"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/how%20to%20run/bless%20src/test/run-make-fulldeps/coverage%20%3F/near/224963081" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> pnkfelix <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/how.20to.20run.2Fbless.20src.2Ftest.2Frun-make-fulldeps.2Fcoverage.20.3F.html#224963081">(Feb 03 2021 at 01:35)</a>:</h4>
<p>So I'm still pretty sure there's <em>something</em> goofy with my setup</p>



<a name="224963086"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/how%20to%20run/bless%20src/test/run-make-fulldeps/coverage%20%3F/near/224963086" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> simulacrum <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/how.20to.20run.2Fbless.20src.2Ftest.2Frun-make-fulldeps.2Fcoverage.20.3F.html#224963086">(Feb 03 2021 at 01:35)</a>:</h4>
<p>I wouldn't be surprised if our makefiles are broken</p>



<a name="224963087"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/how%20to%20run/bless%20src/test/run-make-fulldeps/coverage%20%3F/near/224963087" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> pnkfelix <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/how.20to.20run.2Fbless.20src.2Ftest.2Frun-make-fulldeps.2Fcoverage.20.3F.html#224963087">(Feb 03 2021 at 01:35)</a>:</h4>
<p>still investigating. Just feeling good now that I'm seeing <em>something</em> in terms of output</p>



<a name="224963093"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/how%20to%20run/bless%20src/test/run-make-fulldeps/coverage%20%3F/near/224963093" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wesley Wiser <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/how.20to.20run.2Fbless.20src.2Ftest.2Frun-make-fulldeps.2Fcoverage.20.3F.html#224963093">(Feb 03 2021 at 01:35)</a>:</h4>
<p>Yeah, I'm able to repro the failure and <code>--bless</code> on my Linux machine.</p>



<a name="224963098"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/how%20to%20run/bless%20src/test/run-make-fulldeps/coverage%20%3F/near/224963098" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> pnkfelix <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/how.20to.20run.2Fbless.20src.2Ftest.2Frun-make-fulldeps.2Fcoverage.20.3F.html#224963098">(Feb 03 2021 at 01:35)</a>:</h4>
<p>I'm certain our makefiles are broken in someway</p>



<a name="224963143"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/how%20to%20run/bless%20src/test/run-make-fulldeps/coverage%20%3F/near/224963143" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> pnkfelix <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/how.20to.20run.2Fbless.20src.2Ftest.2Frun-make-fulldeps.2Fcoverage.20.3F.html#224963143">(Feb 03 2021 at 01:36)</a>:</h4>
<p>like much tech, I have a love/hate relationship with Make</p>



<a name="224963148"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/how%20to%20run/bless%20src/test/run-make-fulldeps/coverage%20%3F/near/224963148" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> simulacrum <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/how.20to.20run.2Fbless.20src.2Ftest.2Frun-make-fulldeps.2Fcoverage.20.3F.html#224963148">(Feb 03 2021 at 01:36)</a>:</h4>
<p>I'm worried the llvm version detection sounds like it's broken</p>



<a name="224963163"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/how%20to%20run/bless%20src/test/run-make-fulldeps/coverage%20%3F/near/224963163" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> simulacrum <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/how.20to.20run.2Fbless.20src.2Ftest.2Frun-make-fulldeps.2Fcoverage.20.3F.html#224963163">(Feb 03 2021 at 01:36)</a>:</h4>
<p>That seems like the root cause to me, or at least something to look at first. We did recently land some refactoring there too - well, 2 months now probably</p>



<a name="224963175"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/how%20to%20run/bless%20src/test/run-make-fulldeps/coverage%20%3F/near/224963175" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> pnkfelix <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/how.20to.20run.2Fbless.20src.2Ftest.2Frun-make-fulldeps.2Fcoverage.20.3F.html#224963175">(Feb 03 2021 at 01:37)</a>:</h4>
<p><span class="user-mention silent" data-user-id="116083">pnkfelix</span> <a href="#narrow/stream/131828-t-compiler/topic/how.20to.20run.2Fbless.20src.2Ftest.2Frun-make-fulldeps.2Fcoverage.20.3F/near/224963143">said</a>:</p>
<blockquote>
<p>like much tech, I have a love/hate relationship with Make</p>
</blockquote>
<p>(I <em>can</em> highly recommend this tool for debugging makefiles: <a href="https://github.com/rocky/remake">https://github.com/rocky/remake</a> )</p>



<a name="224963184"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/how%20to%20run/bless%20src/test/run-make-fulldeps/coverage%20%3F/near/224963184" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> pnkfelix <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/how.20to.20run.2Fbless.20src.2Ftest.2Frun-make-fulldeps.2Fcoverage.20.3F.html#224963184">(Feb 03 2021 at 01:37)</a>:</h4>
<p>I have been out of the loop making PRs for about 2 months</p>



<a name="224963189"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/how%20to%20run/bless%20src/test/run-make-fulldeps/coverage%20%3F/near/224963189" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> pnkfelix <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/how.20to.20run.2Fbless.20src.2Ftest.2Frun-make-fulldeps.2Fcoverage.20.3F.html#224963189">(Feb 03 2021 at 01:37)</a>:</h4>
<p>so I can believe that I'm getting burned by that refactoring, and just haven't noticed until now</p>



<a name="224963292"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/how%20to%20run/bless%20src/test/run-make-fulldeps/coverage%20%3F/near/224963292" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> simulacrum <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/how.20to.20run.2Fbless.20src.2Ftest.2Frun-make-fulldeps.2Fcoverage.20.3F.html#224963292">(Feb 03 2021 at 01:39)</a>:</h4>
<p><code>./build/x86_64-unknown-linux-gnu/llvm/bin/llvm-config --version</code> -- can you try that for me?</p>



<a name="224963361"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/how%20to%20run/bless%20src/test/run-make-fulldeps/coverage%20%3F/near/224963361" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> pnkfelix <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/how.20to.20run.2Fbless.20src.2Ftest.2Frun-make-fulldeps.2Fcoverage.20.3F.html#224963361">(Feb 03 2021 at 01:40)</a>:</h4>
<div class="codehilite"><pre><span></span><code>% ./build/x86_64-unknown-linux-gnu/llvm/bin/llvm-config --version
11.0.1-rust-dev
</code></pre></div>



<a name="224963372"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/how%20to%20run/bless%20src/test/run-make-fulldeps/coverage%20%3F/near/224963372" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> simulacrum <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/how.20to.20run.2Fbless.20src.2Ftest.2Frun-make-fulldeps.2Fcoverage.20.3F.html#224963372">(Feb 03 2021 at 01:40)</a>:</h4>
<p>hm, that's what I would expect</p>



<a name="224963386"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/how%20to%20run/bless%20src/test/run-make-fulldeps/coverage%20%3F/near/224963386" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> simulacrum <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/how.20to.20run.2Fbless.20src.2Ftest.2Frun-make-fulldeps.2Fcoverage.20.3F.html#224963386">(Feb 03 2021 at 01:40)</a>:</h4>
<p>and we do seem to pretty directly pipe that into compiletest</p>



<a name="224963389"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/how%20to%20run/bless%20src/test/run-make-fulldeps/coverage%20%3F/near/224963389" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> pnkfelix <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/how.20to.20run.2Fbless.20src.2Ftest.2Frun-make-fulldeps.2Fcoverage.20.3F.html#224963389">(Feb 03 2021 at 01:40)</a>:</h4>
<p>let me make the Makefile tell me what its saying/seeing</p>



<a name="224963399"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/how%20to%20run/bless%20src/test/run-make-fulldeps/coverage%20%3F/near/224963399" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> simulacrum <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/how.20to.20run.2Fbless.20src.2Ftest.2Frun-make-fulldeps.2Fcoverage.20.3F.html#224963399">(Feb 03 2021 at 01:40)</a>:</h4>
<p>(you should see --llvm-version 11.0.1-rust-dev in compiletest args, fwiw)</p>



<a name="224963430"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/how%20to%20run/bless%20src/test/run-make-fulldeps/coverage%20%3F/near/224963430" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> pnkfelix <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/how.20to.20run.2Fbless.20src.2Ftest.2Frun-make-fulldeps.2Fcoverage.20.3F.html#224963430">(Feb 03 2021 at 01:41)</a>:</h4>
<p>yes I see that</p>



<a name="224963437"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/how%20to%20run/bless%20src/test/run-make-fulldeps/coverage%20%3F/near/224963437" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> pnkfelix <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/how.20to.20run.2Fbless.20src.2Ftest.2Frun-make-fulldeps.2Fcoverage.20.3F.html#224963437">(Feb 03 2021 at 01:41)</a>:</h4>
<p>but the Makefile does its own call</p>



<a name="224963445"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/how%20to%20run/bless%20src/test/run-make-fulldeps/coverage%20%3F/near/224963445" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> simulacrum <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/how.20to.20run.2Fbless.20src.2Ftest.2Frun-make-fulldeps.2Fcoverage.20.3F.html#224963445">(Feb 03 2021 at 01:41)</a>:</h4>
<p>oh that seems really wrong</p>



<a name="224963454"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/how%20to%20run/bless%20src/test/run-make-fulldeps/coverage%20%3F/near/224963454" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> pnkfelix <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/how.20to.20run.2Fbless.20src.2Ftest.2Frun-make-fulldeps.2Fcoverage.20.3F.html#224963454">(Feb 03 2021 at 01:41)</a>:</h4>
<p>in src/test/run-make-fulldeps/coverage/coverage_tools.mk</p>



<a name="224963457"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/how%20to%20run/bless%20src/test/run-make-fulldeps/coverage%20%3F/near/224963457" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> simulacrum <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/how.20to.20run.2Fbless.20src.2Ftest.2Frun-make-fulldeps.2Fcoverage.20.3F.html#224963457">(Feb 03 2021 at 01:41)</a>:</h4>
<p>it should be using <code># min-llvm-version</code> I'd expect?</p>



<a name="224963503"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/how%20to%20run/bless%20src/test/run-make-fulldeps/coverage%20%3F/near/224963503" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> pnkfelix <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/how.20to.20run.2Fbless.20src.2Ftest.2Frun-make-fulldeps.2Fcoverage.20.3F.html#224963503">(Feb 03 2021 at 01:42)</a>:</h4>
<p>looks pretty home grown to me</p>



<a name="224963535"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/how%20to%20run/bless%20src/test/run-make-fulldeps/coverage%20%3F/near/224963535" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> simulacrum <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/how.20to.20run.2Fbless.20src.2Ftest.2Frun-make-fulldeps.2Fcoverage.20.3F.html#224963535">(Feb 03 2021 at 01:42)</a>:</h4>
<p>interesting</p>



<a name="224963567"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/how%20to%20run/bless%20src/test/run-make-fulldeps/coverage%20%3F/near/224963567" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> simulacrum <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/how.20to.20run.2Fbless.20src.2Ftest.2Frun-make-fulldeps.2Fcoverage.20.3F.html#224963567">(Feb 03 2021 at 01:43)</a>:</h4>
<p>maybe we don't handle those for run-make tests for some reason</p>



<a name="224963568"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/how%20to%20run/bless%20src/test/run-make-fulldeps/coverage%20%3F/near/224963568" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> pnkfelix <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/how.20to.20run.2Fbless.20src.2Ftest.2Frun-make-fulldeps.2Fcoverage.20.3F.html#224963568">(Feb 03 2021 at 01:43)</a>:</h4>
<p>I'll admit, I'm not sure what this does: </p>
<div class="codehilite"><pre><span></span><code>LLVM_VERSION_11_PLUS := $(shell \
        LLVM_VERSION=$$(&quot;$(LLVM_BIN_DIR)&quot;/llvm-config --version) &amp;&amp; \
        LLVM_VERSION_MAJOR=$${LLVM_VERSION/.*/} &amp;&amp; \
        [ $$LLVM_VERSION_MAJOR -ge 11 ] &amp;&amp; echo true || echo false)
</code></pre></div>



<a name="224963578"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/how%20to%20run/bless%20src/test/run-make-fulldeps/coverage%20%3F/near/224963578" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> pnkfelix <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/how.20to.20run.2Fbless.20src.2Ftest.2Frun-make-fulldeps.2Fcoverage.20.3F.html#224963578">(Feb 03 2021 at 01:43)</a>:</h4>
<p>namely the definition of <code>LLVM_VERSION_MAJOR=$${LLVM_VERSION/.*/}</code></p>



<a name="224963587"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/how%20to%20run/bless%20src/test/run-make-fulldeps/coverage%20%3F/near/224963587" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> simulacrum <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/how.20to.20run.2Fbless.20src.2Ftest.2Frun-make-fulldeps.2Fcoverage.20.3F.html#224963587">(Feb 03 2021 at 01:43)</a>:</h4>
<p>that's shell regex replacement</p>



<a name="224963649"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/how%20to%20run/bless%20src/test/run-make-fulldeps/coverage%20%3F/near/224963649" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> pnkfelix <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/how.20to.20run.2Fbless.20src.2Ftest.2Frun-make-fulldeps.2Fcoverage.20.3F.html#224963649">(Feb 03 2021 at 01:44)</a>:</h4>
<p>oh, its looking for the .</p>



<a name="224963659"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/how%20to%20run/bless%20src/test/run-make-fulldeps/coverage%20%3F/near/224963659" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> pnkfelix <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/how.20to.20run.2Fbless.20src.2Ftest.2Frun-make-fulldeps.2Fcoverage.20.3F.html#224963659">(Feb 03 2021 at 01:44)</a>:</h4>
<p>I was thinking the . was a wildcard, i.e. Kleene-star on wildcard</p>



<a name="224963665"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/how%20to%20run/bless%20src/test/run-make-fulldeps/coverage%20%3F/near/224963665" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> simulacrum <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/how.20to.20run.2Fbless.20src.2Ftest.2Frun-make-fulldeps.2Fcoverage.20.3F.html#224963665">(Feb 03 2021 at 01:44)</a>:</h4>
<p><code>LLVM_VERSION="11.0.1-rust-dev" LLVM_VERSION_MAJOR=${LLVM_VERSION/.*/}; echo $LLVM_VERSION_MAJOR</code> gives me 11 as expected in bash at least</p>



<a name="224963668"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/how%20to%20run/bless%20src/test/run-make-fulldeps/coverage%20%3F/near/224963668" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> pnkfelix <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/how.20to.20run.2Fbless.20src.2Ftest.2Frun-make-fulldeps.2Fcoverage.20.3F.html#224963668">(Feb 03 2021 at 01:44)</a>:</h4>
<p>but this is just trying to extract everything before the period,r ight?</p>



<a name="224963679"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/how%20to%20run/bless%20src/test/run-make-fulldeps/coverage%20%3F/near/224963679" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> simulacrum <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/how.20to.20run.2Fbless.20src.2Ftest.2Frun-make-fulldeps.2Fcoverage.20.3F.html#224963679">(Feb 03 2021 at 01:45)</a>:</h4>
<p>I think so</p>



<a name="224963690"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/how%20to%20run/bless%20src/test/run-make-fulldeps/coverage%20%3F/near/224963690" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> pnkfelix <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/how.20to.20run.2Fbless.20src.2Ftest.2Frun-make-fulldeps.2Fcoverage.20.3F.html#224963690">(Feb 03 2021 at 01:45)</a>:</h4>
<p>Let me go ahead and do what I said I would do: Get it to print out the values of these variables.</p>



<a name="224963766"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/how%20to%20run/bless%20src/test/run-make-fulldeps/coverage%20%3F/near/224963766" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wesley Wiser <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/how.20to.20run.2Fbless.20src.2Ftest.2Frun-make-fulldeps.2Fcoverage.20.3F.html#224963766">(Feb 03 2021 at 01:46)</a>:</h4>
<p>Is there a chance your <code>shell</code> isn't bash and it's behaving differently?</p>



<a name="224963776"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/how%20to%20run/bless%20src/test/run-make-fulldeps/coverage%20%3F/near/224963776" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> pnkfelix <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/how.20to.20run.2Fbless.20src.2Ftest.2Frun-make-fulldeps.2Fcoverage.20.3F.html#224963776">(Feb 03 2021 at 01:46)</a>:</h4>
<p>shell is bash</p>



<a name="224963781"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/how%20to%20run/bless%20src/test/run-make-fulldeps/coverage%20%3F/near/224963781" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> pnkfelix <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/how.20to.20run.2Fbless.20src.2Ftest.2Frun-make-fulldeps.2Fcoverage.20.3F.html#224963781">(Feb 03 2021 at 01:46)</a>:</h4>
<p>good guess though</p>



<a name="224963894"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/how%20to%20run/bless%20src/test/run-make-fulldeps/coverage%20%3F/near/224963894" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> simulacrum <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/how.20to.20run.2Fbless.20src.2Ftest.2Frun-make-fulldeps.2Fcoverage.20.3F.html#224963894">(Feb 03 2021 at 01:48)</a>:</h4>
<p>/me wishes we had used run-pass tests for these instead, which should in theory not be that hard even...</p>



<a name="224963901"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/how%20to%20run/bless%20src/test/run-make-fulldeps/coverage%20%3F/near/224963901" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> pnkfelix <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/how.20to.20run.2Fbless.20src.2Ftest.2Frun-make-fulldeps.2Fcoverage.20.3F.html#224963901">(Feb 03 2021 at 01:48)</a>:</h4>
<p>/me realized: Why are they setting these variables in the SHELL? Why not make them Make variables? Argh.</p>



<a name="224964029"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/how%20to%20run/bless%20src/test/run-make-fulldeps/coverage%20%3F/near/224964029" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> pnkfelix <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/how.20to.20run.2Fbless.20src.2Ftest.2Frun-make-fulldeps.2Fcoverage.20.3F.html#224964029">(Feb 03 2021 at 01:50)</a>:</h4>
<p>the complaint about "bad substitution" probably <em>is</em> complaining about that shell substitution though</p>



<a name="224964043"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/how%20to%20run/bless%20src/test/run-make-fulldeps/coverage%20%3F/near/224964043" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> pnkfelix <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/how.20to.20run.2Fbless.20src.2Ftest.2Frun-make-fulldeps.2Fcoverage.20.3F.html#224964043">(Feb 03 2021 at 01:50)</a>:</h4>
<p>which means I can/should just replace this with one done via Make text replacement</p>



<a name="224964080"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/how%20to%20run/bless%20src/test/run-make-fulldeps/coverage%20%3F/near/224964080" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> simulacrum <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/how.20to.20run.2Fbless.20src.2Ftest.2Frun-make-fulldeps.2Fcoverage.20.3F.html#224964080">(Feb 03 2021 at 01:51)</a>:</h4>
<p>I still am of the opinion that a <code># min-llvm-version 11.0.0</code> probably will just work on the individual Makefiles, but that seems reasonable as a first step</p>



<a name="224964175"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/how%20to%20run/bless%20src/test/run-make-fulldeps/coverage%20%3F/near/224964175" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> pnkfelix <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/how.20to.20run.2Fbless.20src.2Ftest.2Frun-make-fulldeps.2Fcoverage.20.3F.html#224964175">(Feb 03 2021 at 01:53)</a>:</h4>
<p>Do <em>any</em> of the makefiles use a rule encoded like that?</p>



<a name="224964206"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/how%20to%20run/bless%20src/test/run-make-fulldeps/coverage%20%3F/near/224964206" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> pnkfelix <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/how.20to.20run.2Fbless.20src.2Ftest.2Frun-make-fulldeps.2Fcoverage.20.3F.html#224964206">(Feb 03 2021 at 01:53)</a>:</h4>
<p>I guess there's stuff like <code># only-wasm-bare</code></p>



<a name="224964285"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/how%20to%20run/bless%20src/test/run-make-fulldeps/coverage%20%3F/near/224964285" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> simulacrum <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/how.20to.20run.2Fbless.20src.2Ftest.2Frun-make-fulldeps.2Fcoverage.20.3F.html#224964285">(Feb 03 2021 at 01:54)</a>:</h4>
<p>they don't</p>



<a name="224964290"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/how%20to%20run/bless%20src/test/run-make-fulldeps/coverage%20%3F/near/224964290" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> simulacrum <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/how.20to.20run.2Fbless.20src.2Ftest.2Frun-make-fulldeps.2Fcoverage.20.3F.html#224964290">(Feb 03 2021 at 01:54)</a>:</h4>
<p>but they do use other similar compiletest-based declarations</p>



<a name="224964297"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/how%20to%20run/bless%20src/test/run-make-fulldeps/coverage%20%3F/near/224964297" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> simulacrum <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/how.20to.20run.2Fbless.20src.2Ftest.2Frun-make-fulldeps.2Fcoverage.20.3F.html#224964297">(Feb 03 2021 at 01:54)</a>:</h4>
<p>so I.. don't know why this wouldn't work</p>



<a name="224964304"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/how%20to%20run/bless%20src/test/run-make-fulldeps/coverage%20%3F/near/224964304" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> pnkfelix <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/how.20to.20run.2Fbless.20src.2Ftest.2Frun-make-fulldeps.2Fcoverage.20.3F.html#224964304">(Feb 03 2021 at 01:55)</a>:</h4>
<p>right, so I think it will probably work. Or should.</p>



<a name="224964351"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/how%20to%20run/bless%20src/test/run-make-fulldeps/coverage%20%3F/near/224964351" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> tm <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/how.20to.20run.2Fbless.20src.2Ftest.2Frun-make-fulldeps.2Fcoverage.20.3F.html#224964351">(Feb 03 2021 at 01:55)</a>:</h4>
<p>If there is any doubt, you can add a test case to <code>src/tools/compiletest/src/header/tests.rs</code> and see.</p>



<a name="224964366"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/how%20to%20run/bless%20src/test/run-make-fulldeps/coverage%20%3F/near/224964366" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> pnkfelix <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/how.20to.20run.2Fbless.20src.2Ftest.2Frun-make-fulldeps.2Fcoverage.20.3F.html#224964366">(Feb 03 2021 at 01:55)</a>:</h4>
<p>I'm debating if I should <em>also</em> try to include improvements to the printouts for these failure cases</p>



<a name="224964381"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/how%20to%20run/bless%20src/test/run-make-fulldeps/coverage%20%3F/near/224964381" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> pnkfelix <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/how.20to.20run.2Fbless.20src.2Ftest.2Frun-make-fulldeps.2Fcoverage.20.3F.html#224964381">(Feb 03 2021 at 01:55)</a>:</h4>
<p>it was truly frustrating that I kept just getting no output</p>



<a name="224964430"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/how%20to%20run/bless%20src/test/run-make-fulldeps/coverage%20%3F/near/224964430" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> tm <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/how.20to.20run.2Fbless.20src.2Ftest.2Frun-make-fulldeps.2Fcoverage.20.3F.html#224964430">(Feb 03 2021 at 01:56)</a>:</h4>
<p>But I would expect that <code>min-llvm-version</code> will just work.</p>



<a name="224964433"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/how%20to%20run/bless%20src/test/run-make-fulldeps/coverage%20%3F/near/224964433" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> pnkfelix <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/how.20to.20run.2Fbless.20src.2Ftest.2Frun-make-fulldeps.2Fcoverage.20.3F.html#224964433">(Feb 03 2021 at 01:56)</a>:</h4>
<p>(and in this case, using <code>rr</code> didn't really illuminate all that much, and probably would never have illuminated)</p>



<a name="224964451"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/how%20to%20run/bless%20src/test/run-make-fulldeps/coverage%20%3F/near/224964451" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> tm <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/how.20to.20run.2Fbless.20src.2Ftest.2Frun-make-fulldeps.2Fcoverage.20.3F.html#224964451">(Feb 03 2021 at 01:57)</a>:</h4>
<p>Since the header parse code is the same.</p>



<a name="224964471"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/how%20to%20run/bless%20src/test/run-make-fulldeps/coverage%20%3F/near/224964471" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> simulacrum <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/how.20to.20run.2Fbless.20src.2Ftest.2Frun-make-fulldeps.2Fcoverage.20.3F.html#224964471">(Feb 03 2021 at 01:57)</a>:</h4>
<p>I was going to suggest strace -e %process or something</p>



<a name="224964524"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/how%20to%20run/bless%20src/test/run-make-fulldeps/coverage%20%3F/near/224964524" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> pnkfelix <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/how.20to.20run.2Fbless.20src.2Ftest.2Frun-make-fulldeps.2Fcoverage.20.3F.html#224964524">(Feb 03 2021 at 01:58)</a>:</h4>
<p>yeah I was about to try to figure out how to get strace involved</p>



<a name="224964535"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/how%20to%20run/bless%20src/test/run-make-fulldeps/coverage%20%3F/near/224964535" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> pnkfelix <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/how.20to.20run.2Fbless.20src.2Ftest.2Frun-make-fulldeps.2Fcoverage.20.3F.html#224964535">(Feb 03 2021 at 01:58)</a>:</h4>
<p>but: Will strace apply itself recursively?</p>



<a name="224964540"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/how%20to%20run/bless%20src/test/run-make-fulldeps/coverage%20%3F/near/224964540" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> simulacrum <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/how.20to.20run.2Fbless.20src.2Ftest.2Frun-make-fulldeps.2Fcoverage.20.3F.html#224964540">(Feb 03 2021 at 01:58)</a>:</h4>
<p>with -f, yes</p>



<a name="224964549"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/how%20to%20run/bless%20src/test/run-make-fulldeps/coverage%20%3F/near/224964549" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> pnkfelix <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/how.20to.20run.2Fbless.20src.2Ftest.2Frun-make-fulldeps.2Fcoverage.20.3F.html#224964549">(Feb 03 2021 at 01:58)</a>:</h4>
<p>I see, that presumably follows forks</p>



<a name="224964551"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/how%20to%20run/bless%20src/test/run-make-fulldeps/coverage%20%3F/near/224964551" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> pnkfelix <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/how.20to.20run.2Fbless.20src.2Ftest.2Frun-make-fulldeps.2Fcoverage.20.3F.html#224964551">(Feb 03 2021 at 01:58)</a>:</h4>
<p>probably should have done that</p>



<a name="224964552"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/how%20to%20run/bless%20src/test/run-make-fulldeps/coverage%20%3F/near/224964552" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> simulacrum <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/how.20to.20run.2Fbless.20src.2Ftest.2Frun-make-fulldeps.2Fcoverage.20.3F.html#224964552">(Feb 03 2021 at 01:58)</a>:</h4>
<p>now, you'll likely get a wall of output</p>



<a name="224964578"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/how%20to%20run/bless%20src/test/run-make-fulldeps/coverage%20%3F/near/224964578" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> simulacrum <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/how.20to.20run.2Fbless.20src.2Ftest.2Frun-make-fulldeps.2Fcoverage.20.3F.html#224964578">(Feb 03 2021 at 01:59)</a>:</h4>
<p>and I've historically had.. trouble getting useful results, particularly in cases of shell expansion and such where there's potentially not a distinct process running</p>



<a name="224964595"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/how%20to%20run/bless%20src/test/run-make-fulldeps/coverage%20%3F/near/224964595" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> pnkfelix <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/how.20to.20run.2Fbless.20src.2Ftest.2Frun-make-fulldeps.2Fcoverage.20.3F.html#224964595">(Feb 03 2021 at 01:59)</a>:</h4>
<p>now, currently, the test does emit <code>$(info Rust option </code>-Z instrument-coverage<code> requires LLVM 11 or higher. Test skipped.)</code></p>



<a name="224964606"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/how%20to%20run/bless%20src/test/run-make-fulldeps/coverage%20%3F/near/224964606" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> pnkfelix <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/how.20to.20run.2Fbless.20src.2Ftest.2Frun-make-fulldeps.2Fcoverage.20.3F.html#224964606">(Feb 03 2021 at 01:59)</a>:</h4>
<p>we never see it from <code>compiletest</code></p>



<a name="224964615"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/how%20to%20run/bless%20src/test/run-make-fulldeps/coverage%20%3F/near/224964615" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> pnkfelix <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/how.20to.20run.2Fbless.20src.2Ftest.2Frun-make-fulldeps.2Fcoverage.20.3F.html#224964615">(Feb 03 2021 at 01:59)</a>:</h4>
<p>and I don't think we ever <em>would</em> see it from <code>compiletest</code>, unless I've overlooked something</p>



<a name="224964664"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/how%20to%20run/bless%20src/test/run-make-fulldeps/coverage%20%3F/near/224964664" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> pnkfelix <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/how.20to.20run.2Fbless.20src.2Ftest.2Frun-make-fulldeps.2Fcoverage.20.3F.html#224964664">(Feb 03 2021 at 02:00)</a>:</h4>
<p>but if I switch to <code># min-llvm-version: 11.0</code>, what feedback will user get about the test in that case?</p>



<a name="224964700"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/how%20to%20run/bless%20src/test/run-make-fulldeps/coverage%20%3F/near/224964700" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> simulacrum <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/how.20to.20run.2Fbless.20src.2Ftest.2Frun-make-fulldeps.2Fcoverage.20.3F.html#224964700">(Feb 03 2021 at 02:01)</a>:</h4>
<p>None, currently, but I've long wanted at least a local opt-in to explicitly listing allowed reasons for tests to get ignored</p>



<a name="224964714"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/how%20to%20run/bless%20src/test/run-make-fulldeps/coverage%20%3F/near/224964714" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> pnkfelix <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/how.20to.20run.2Fbless.20src.2Ftest.2Frun-make-fulldeps.2Fcoverage.20.3F.html#224964714">(Feb 03 2021 at 02:01)</a>:</h4>
<p>hmm</p>



<a name="224964748"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/how%20to%20run/bless%20src/test/run-make-fulldeps/coverage%20%3F/near/224964748" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> simulacrum <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/how.20to.20run.2Fbless.20src.2Ftest.2Frun-make-fulldeps.2Fcoverage.20.3F.html#224964748">(Feb 03 2021 at 02:01)</a>:</h4>
<p>And at least I trust our compiletest rust-based detection more, personally, than the shell or makefile expansion; at least we have unit tests there</p>



<a name="224964822"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/how%20to%20run/bless%20src/test/run-make-fulldeps/coverage%20%3F/near/224964822" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> pnkfelix <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/how.20to.20run.2Fbless.20src.2Ftest.2Frun-make-fulldeps.2Fcoverage.20.3F.html#224964822">(Feb 03 2021 at 02:02)</a>:</h4>
<p>I still want to figure out what's wrong</p>



<a name="224964845"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/how%20to%20run/bless%20src/test/run-make-fulldeps/coverage%20%3F/near/224964845" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> pnkfelix <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/how.20to.20run.2Fbless.20src.2Ftest.2Frun-make-fulldeps.2Fcoverage.20.3F.html#224964845">(Feb 03 2021 at 02:03)</a>:</h4>
<p>as in, why my shell expansion is breaking but others are not</p>



<a name="224964967"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/how%20to%20run/bless%20src/test/run-make-fulldeps/coverage%20%3F/near/224964967" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> simulacrum <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/how.20to.20run.2Fbless.20src.2Ftest.2Frun-make-fulldeps.2Fcoverage.20.3F.html#224964967">(Feb 03 2021 at 02:04)</a>:</h4>
<p>Yeah, for sure.</p>



<a name="224964982"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/how%20to%20run/bless%20src/test/run-make-fulldeps/coverage%20%3F/near/224964982" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> simulacrum <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/how.20to.20run.2Fbless.20src.2Ftest.2Frun-make-fulldeps.2Fcoverage.20.3F.html#224964982">(Feb 03 2021 at 02:04)</a>:</h4>
<p>One thing to check might be your make version</p>



<a name="224965005"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/how%20to%20run/bless%20src/test/run-make-fulldeps/coverage%20%3F/near/224965005" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> pnkfelix <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/how.20to.20run.2Fbless.20src.2Ftest.2Frun-make-fulldeps.2Fcoverage.20.3F.html#224965005">(Feb 03 2021 at 02:04)</a>:</h4>
<p>4.3</p>



<a name="224965019"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/how%20to%20run/bless%20src/test/run-make-fulldeps/coverage%20%3F/near/224965019" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> pnkfelix <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/how.20to.20run.2Fbless.20src.2Ftest.2Frun-make-fulldeps.2Fcoverage.20.3F.html#224965019">(Feb 03 2021 at 02:04)</a>:</h4>
<p>Copyright 1988-2020</p>



<a name="224965040"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/how%20to%20run/bless%20src/test/run-make-fulldeps/coverage%20%3F/near/224965040" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wesley Wiser <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/how.20to.20run.2Fbless.20src.2Ftest.2Frun-make-fulldeps.2Fcoverage.20.3F.html#224965040">(Feb 03 2021 at 02:05)</a>:</h4>
<p>That's the version I have as well</p>



<a name="224965066"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/how%20to%20run/bless%20src/test/run-make-fulldeps/coverage%20%3F/near/224965066" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> pnkfelix <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/how.20to.20run.2Fbless.20src.2Ftest.2Frun-make-fulldeps.2Fcoverage.20.3F.html#224965066">(Feb 03 2021 at 02:05)</a>:</h4>
<p>bash is 5.0.17(1)</p>



<a name="224965070"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/how%20to%20run/bless%20src/test/run-make-fulldeps/coverage%20%3F/near/224965070" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> pnkfelix <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/how.20to.20run.2Fbless.20src.2Ftest.2Frun-make-fulldeps.2Fcoverage.20.3F.html#224965070">(Feb 03 2021 at 02:05)</a>:</h4>
<p>Copyright 2019</p>



<a name="224965091"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/how%20to%20run/bless%20src/test/run-make-fulldeps/coverage%20%3F/near/224965091" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wesley Wiser <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/how.20to.20run.2Fbless.20src.2Ftest.2Frun-make-fulldeps.2Fcoverage.20.3F.html#224965091">(Feb 03 2021 at 02:06)</a>:</h4>
<p>I have bash 5.0.18(1)</p>



<a name="224965193"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/how%20to%20run/bless%20src/test/run-make-fulldeps/coverage%20%3F/near/224965193" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> simulacrum <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/how.20to.20run.2Fbless.20src.2Ftest.2Frun-make-fulldeps.2Fcoverage.20.3F.html#224965193">(Feb 03 2021 at 02:07)</a>:</h4>
<p>Have we determined that llvm-config is getting run correctly and outputting what's expected? You could also replace it in the bin directory with a shell script which does echo $@ &gt;&gt; /tmp/t or something</p>



<a name="224966585"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/how%20to%20run/bless%20src/test/run-make-fulldeps/coverage%20%3F/near/224966585" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> pnkfelix <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/how.20to.20run.2Fbless.20src.2Ftest.2Frun-make-fulldeps.2Fcoverage.20.3F.html#224966585">(Feb 03 2021 at 02:32)</a>:</h4>
<p>omg</p>



<a name="224966589"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/how%20to%20run/bless%20src/test/run-make-fulldeps/coverage%20%3F/near/224966589" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> pnkfelix <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/how.20to.20run.2Fbless.20src.2Ftest.2Frun-make-fulldeps.2Fcoverage.20.3F.html#224966589">(Feb 03 2021 at 02:32)</a>:</h4>
<p>Makefile is using <code>/bin/sh</code></p>



<a name="224966597"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/how%20to%20run/bless%20src/test/run-make-fulldeps/coverage%20%3F/near/224966597" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> pnkfelix <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/how.20to.20run.2Fbless.20src.2Ftest.2Frun-make-fulldeps.2Fcoverage.20.3F.html#224966597">(Feb 03 2021 at 02:32)</a>:</h4>
<p>for <code>$(shell ...)</code> invocation</p>



<a name="224966646"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/how%20to%20run/bless%20src/test/run-make-fulldeps/coverage%20%3F/near/224966646" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> pnkfelix <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/how.20to.20run.2Fbless.20src.2Ftest.2Frun-make-fulldeps.2Fcoverage.20.3F.html#224966646">(Feb 03 2021 at 02:33)</a>:</h4>
<p>and thus, is reporting <code>/bin/sh: Bad substitution</code> when <code>/bin/sh</code> sees syntax that is not compatible with old school <code>/bin/sh</code></p>



<a name="224966747"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/how%20to%20run/bless%20src/test/run-make-fulldeps/coverage%20%3F/near/224966747" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> simulacrum <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/how.20to.20run.2Fbless.20src.2Ftest.2Frun-make-fulldeps.2Fcoverage.20.3F.html#224966747">(Feb 03 2021 at 02:34)</a>:</h4>
<p>Huh, I guess I am confused... why that's special for you</p>



<a name="224966750"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/how%20to%20run/bless%20src/test/run-make-fulldeps/coverage%20%3F/near/224966750" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> pnkfelix <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/how.20to.20run.2Fbless.20src.2Ftest.2Frun-make-fulldeps.2Fcoverage.20.3F.html#224966750">(Feb 03 2021 at 02:34)</a>:</h4>
<p>you can use <code>make SHELL=bash</code> to override its choice, but it won't just look at the value of <code>$SHELL</code> in the process environment</p>



<a name="224966755"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/how%20to%20run/bless%20src/test/run-make-fulldeps/coverage%20%3F/near/224966755" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> pnkfelix <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/how.20to.20run.2Fbless.20src.2Ftest.2Frun-make-fulldeps.2Fcoverage.20.3F.html#224966755">(Feb 03 2021 at 02:35)</a>:</h4>
<p><span class="user-mention silent" data-user-id="116122">simulacrum</span> <a href="#narrow/stream/131828-t-compiler/topic/how.20to.20run.2Fbless.20src.2Ftest.2Frun-make-fulldeps.2Fcoverage.20.3F/near/224966747">said</a>:</p>
<blockquote>
<p>Huh, I guess I am confused... why that's special for you</p>
</blockquote>
<p>I am definitely confused about that detail</p>



<a name="224966774"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/how%20to%20run/bless%20src/test/run-make-fulldeps/coverage%20%3F/near/224966774" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> simulacrum <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/how.20to.20run.2Fbless.20src.2Ftest.2Frun-make-fulldeps.2Fcoverage.20.3F.html#224966774">(Feb 03 2021 at 02:35)</a>:</h4>
<p>Maybe your system shell is sh for some reason? I'm not sure how to check, though</p>



<a name="224966785"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/how%20to%20run/bless%20src/test/run-make-fulldeps/coverage%20%3F/near/224966785" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> pnkfelix <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/how.20to.20run.2Fbless.20src.2Ftest.2Frun-make-fulldeps.2Fcoverage.20.3F.html#224966785">(Feb 03 2021 at 02:36)</a>:</h4>
<p>GNU make claims it will use <code>/bin/sh</code> if you don't have SHELL set in makefile</p>



<a name="224966829"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/how%20to%20run/bless%20src/test/run-make-fulldeps/coverage%20%3F/near/224966829" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> pnkfelix <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/how.20to.20run.2Fbless.20src.2Ftest.2Frun-make-fulldeps.2Fcoverage.20.3F.html#224966829">(Feb 03 2021 at 02:36)</a>:</h4>
<p><a href="https://www.gnu.org/software/make/manual/html_node/Choosing-the-Shell.html">https://www.gnu.org/software/make/manual/html_node/Choosing-the-Shell.html</a></p>



<a name="224966845"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/how%20to%20run/bless%20src/test/run-make-fulldeps/coverage%20%3F/near/224966845" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> pnkfelix <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/how.20to.20run.2Fbless.20src.2Ftest.2Frun-make-fulldeps.2Fcoverage.20.3F.html#224966845">(Feb 03 2021 at 02:36)</a>:</h4>
<blockquote>
<p>However, on MS-DOS and MS-Windows the value of SHELL in the environment is used, since on those systems most users do not set this variable, and therefore it is most likely set specifically to be used by make.</p>
</blockquote>



<a name="224966873"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/how%20to%20run/bless%20src/test/run-make-fulldeps/coverage%20%3F/near/224966873" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> pnkfelix <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/how.20to.20run.2Fbless.20src.2Ftest.2Frun-make-fulldeps.2Fcoverage.20.3F.html#224966873">(Feb 03 2021 at 02:37)</a>:</h4>
<p>I am now back to wondering if this has been silently been ignored on CI for Linux, but <em>has</em> been exercised on WIndows, due to the above detail</p>



<a name="224966879"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/how%20to%20run/bless%20src/test/run-make-fulldeps/coverage%20%3F/near/224966879" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> pnkfelix <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/how.20to.20run.2Fbless.20src.2Ftest.2Frun-make-fulldeps.2Fcoverage.20.3F.html#224966879">(Feb 03 2021 at 02:37)</a>:</h4>
<p>But this doesn't explain <span class="user-mention" data-user-id="125250">@Wesley Wiser</span> 's observations</p>



<a name="224967025"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/how%20to%20run/bless%20src/test/run-make-fulldeps/coverage%20%3F/near/224967025" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> simulacrum <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/how.20to.20run.2Fbless.20src.2Ftest.2Frun-make-fulldeps.2Fcoverage.20.3F.html#224967025">(Feb 03 2021 at 02:39)</a>:</h4>
<p>interesting, so running make directly on the src/test/run-make-fulldeps/coverage/coverage_tools.mk file with a</p>
<p>foo:<br>
    echo $(LLVM_VERSION_11_PLUS)</p>
<p>appended does give me false</p>



<a name="224967042"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/how%20to%20run/bless%20src/test/run-make-fulldeps/coverage%20%3F/near/224967042" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> simulacrum <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/how.20to.20run.2Fbless.20src.2Ftest.2Frun-make-fulldeps.2Fcoverage.20.3F.html#224967042">(Feb 03 2021 at 02:39)</a>:</h4>
<p>ah, but that's because /bin/sh: 1: /llvm-config: not found</p>



<a name="224967046"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/how%20to%20run/bless%20src/test/run-make-fulldeps/coverage%20%3F/near/224967046" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wesley Wiser <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/how.20to.20run.2Fbless.20src.2Ftest.2Frun-make-fulldeps.2Fcoverage.20.3F.html#224967046">(Feb 03 2021 at 02:39)</a>:</h4>
<p>I wonder if on my distro, /bin/sh is symlinked to bash or something</p>



<a name="224967067"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/how%20to%20run/bless%20src/test/run-make-fulldeps/coverage%20%3F/near/224967067" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> pnkfelix <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/how.20to.20run.2Fbless.20src.2Ftest.2Frun-make-fulldeps.2Fcoverage.20.3F.html#224967067">(Feb 03 2021 at 02:40)</a>:</h4>
<p>yeah you'll need to set that variable</p>



<a name="224967105"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/how%20to%20run/bless%20src/test/run-make-fulldeps/coverage%20%3F/near/224967105" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> pnkfelix <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/how.20to.20run.2Fbless.20src.2Ftest.2Frun-make-fulldeps.2Fcoverage.20.3F.html#224967105">(Feb 03 2021 at 02:40)</a>:</h4>
<p>Oh!</p>



<a name="224967126"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/how%20to%20run/bless%20src/test/run-make-fulldeps/coverage%20%3F/near/224967126" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> pnkfelix <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/how.20to.20run.2Fbless.20src.2Ftest.2Frun-make-fulldeps.2Fcoverage.20.3F.html#224967126">(Feb 03 2021 at 02:40)</a>:</h4>
<p>I had figured a symlinked <code>/bin/sh</code> wouldn't matter, because I assumed that <code>/bin/bash</code> adopts different behavior based on arg0</p>



<a name="224967129"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/how%20to%20run/bless%20src/test/run-make-fulldeps/coverage%20%3F/near/224967129" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> pnkfelix <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/how.20to.20run.2Fbless.20src.2Ftest.2Frun-make-fulldeps.2Fcoverage.20.3F.html#224967129">(Feb 03 2021 at 02:40)</a>:</h4>
<p>but check this out!</p>



<a name="224967134"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/how%20to%20run/bless%20src/test/run-make-fulldeps/coverage%20%3F/near/224967134" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wesley Wiser <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/how.20to.20run.2Fbless.20src.2Ftest.2Frun-make-fulldeps.2Fcoverage.20.3F.html#224967134">(Feb 03 2021 at 02:40)</a>:</h4>
<p>(on my phone about to go to bed)</p>



<a name="224967139"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/how%20to%20run/bless%20src/test/run-make-fulldeps/coverage%20%3F/near/224967139" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> pnkfelix <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/how.20to.20run.2Fbless.20src.2Ftest.2Frun-make-fulldeps.2Fcoverage.20.3F.html#224967139">(Feb 03 2021 at 02:40)</a>:</h4>
<div class="codehilite"><pre><span></span><code>% ls -l /bin/sh
lrwxrwxrwx 1 root root 4 Mar 30  2020 /bin/sh -&gt; dash
</code></pre></div>



<a name="224967145"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/how%20to%20run/bless%20src/test/run-make-fulldeps/coverage%20%3F/near/224967145" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> pnkfelix <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/how.20to.20run.2Fbless.20src.2Ftest.2Frun-make-fulldeps.2Fcoverage.20.3F.html#224967145">(Feb 03 2021 at 02:41)</a>:</h4>
<p>so, there you have it</p>



<a name="224967150"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/how%20to%20run/bless%20src/test/run-make-fulldeps/coverage%20%3F/near/224967150" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> pnkfelix <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/how.20to.20run.2Fbless.20src.2Ftest.2Frun-make-fulldeps.2Fcoverage.20.3F.html#224967150">(Feb 03 2021 at 02:41)</a>:</h4>
<p>that's what's different about <em>my</em> setup</p>



<a name="224967152"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/how%20to%20run/bless%20src/test/run-make-fulldeps/coverage%20%3F/near/224967152" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> simulacrum <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/how.20to.20run.2Fbless.20src.2Ftest.2Frun-make-fulldeps.2Fcoverage.20.3F.html#224967152">(Feb 03 2021 at 02:41)</a>:</h4>
<p>I have the same</p>



<a name="224967158"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/how%20to%20run/bless%20src/test/run-make-fulldeps/coverage%20%3F/near/224967158" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> simulacrum <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/how.20to.20run.2Fbless.20src.2Ftest.2Frun-make-fulldeps.2Fcoverage.20.3F.html#224967158">(Feb 03 2021 at 02:41)</a>:</h4>
<p>though I've not tested blessing</p>



<a name="224967162"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/how%20to%20run/bless%20src/test/run-make-fulldeps/coverage%20%3F/near/224967162" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> pnkfelix <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/how.20to.20run.2Fbless.20src.2Ftest.2Frun-make-fulldeps.2Fcoverage.20.3F.html#224967162">(Feb 03 2021 at 02:41)</a>:</h4>
<p>so much for GNU thinking that defaulting to <code>/bin/sh</code> helping keep things portable</p>



<a name="224967163"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/how%20to%20run/bless%20src/test/run-make-fulldeps/coverage%20%3F/near/224967163" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wesley Wiser <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/how.20to.20run.2Fbless.20src.2Ftest.2Frun-make-fulldeps.2Fcoverage.20.3F.html#224967163">(Feb 03 2021 at 02:41)</a>:</h4>
<p>Now I'm curious. Let me get my laptop</p>



<a name="224967239"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/how%20to%20run/bless%20src/test/run-make-fulldeps/coverage%20%3F/near/224967239" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> simulacrum <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/how.20to.20run.2Fbless.20src.2Ftest.2Frun-make-fulldeps.2Fcoverage.20.3F.html#224967239">(Feb 03 2021 at 02:42)</a>:</h4>
<p>aha I can reproduce with</p>
<p>LLVM_BIN_DIR=./build/x86_64-unknown-linux-gnu/ci-llvm/bin make  -f src/test/run-make-fulldeps/coverage/coverage_tools.mk foo</p>
<p>which gets me /bin/sh: 1: Bad substitution</p>



<a name="224967262"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/how%20to%20run/bless%20src/test/run-make-fulldeps/coverage%20%3F/near/224967262" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> pnkfelix <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/how.20to.20run.2Fbless.20src.2Ftest.2Frun-make-fulldeps.2Fcoverage.20.3F.html#224967262">(Feb 03 2021 at 02:43)</a>:</h4>
<p>bam</p>



<a name="224967269"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/how%20to%20run/bless%20src/test/run-make-fulldeps/coverage%20%3F/near/224967269" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> simulacrum <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/how.20to.20run.2Fbless.20src.2Ftest.2Frun-make-fulldeps.2Fcoverage.20.3F.html#224967269">(Feb 03 2021 at 02:43)</a>:</h4>
<p>now mind you I have no idea if I can reproduce with compiletest</p>



<a name="224967277"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/how%20to%20run/bless%20src/test/run-make-fulldeps/coverage%20%3F/near/224967277" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wesley Wiser <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/how.20to.20run.2Fbless.20src.2Ftest.2Frun-make-fulldeps.2Fcoverage.20.3F.html#224967277">(Feb 03 2021 at 02:43)</a>:</h4>
<div class="codehilite" data-code-language="Bash"><pre><span></span><code>wesley@endurance:~/code/rust/rust&gt; ls -l /bin/sh
lrwxrwxrwx <span class="m">1</span> root root <span class="m">13</span> Aug  <span class="m">2</span>  <span class="m">2020</span> /bin/sh -&gt; ../usr/bin/sh
wesley@endurance:~/code/rust/rust&gt; ls -l /usr/bin/sh
lrwxrwxrwx <span class="m">1</span> root root <span class="m">20</span> Aug  <span class="m">6</span> <span class="m">09</span>:05 /usr/bin/sh -&gt; /etc/alternatives/sh
wesley@endurance:~/code/rust/rust&gt; ls -l /etc/alternatives/sh
lrwxrwxrwx <span class="m">1</span> root root <span class="m">13</span> Aug  <span class="m">6</span> <span class="m">09</span>:05 /etc/alternatives/sh -&gt; /usr/bin/bash
</code></pre></div>



<a name="224967293"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/how%20to%20run/bless%20src/test/run-make-fulldeps/coverage%20%3F/near/224967293" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> pnkfelix <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/how.20to.20run.2Fbless.20src.2Ftest.2Frun-make-fulldeps.2Fcoverage.20.3F.html#224967293">(Feb 03 2021 at 02:43)</a>:</h4>
<p>I guess we've just gotten lucky that everyone who's done anything that altered MIR output has been symlinking /bin/sh to /bin/bash ?</p>



<a name="224967349"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/how%20to%20run/bless%20src/test/run-make-fulldeps/coverage%20%3F/near/224967349" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> pnkfelix <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/how.20to.20run.2Fbless.20src.2Ftest.2Frun-make-fulldeps.2Fcoverage.20.3F.html#224967349">(Feb 03 2021 at 02:44)</a>:</h4>
<p>this bash-dependent code has only been in there for a few months, as <span class="user-mention" data-user-id="116122">@simulacrum</span> noted.</p>



<a name="224967356"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/how%20to%20run/bless%20src/test/run-make-fulldeps/coverage%20%3F/near/224967356" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> simulacrum <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/how.20to.20run.2Fbless.20src.2Ftest.2Frun-make-fulldeps.2Fcoverage.20.3F.html#224967356">(Feb 03 2021 at 02:44)</a>:</h4>
<p>that looks like a system link though, I'm confused why <span class="user-mention" data-user-id="125250">@Wesley Wiser</span>'s setup is so different from ours, I have pretty stock ubuntu 20.10</p>



<a name="224967365"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/how%20to%20run/bless%20src/test/run-make-fulldeps/coverage%20%3F/near/224967365" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> pnkfelix <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/how.20to.20run.2Fbless.20src.2Ftest.2Frun-make-fulldeps.2Fcoverage.20.3F.html#224967365">(Feb 03 2021 at 02:44)</a>:</h4>
<p>wesley's looks like Redhat to me</p>



<a name="224967368"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/how%20to%20run/bless%20src/test/run-make-fulldeps/coverage%20%3F/near/224967368" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wesley Wiser <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/how.20to.20run.2Fbless.20src.2Ftest.2Frun-make-fulldeps.2Fcoverage.20.3F.html#224967368">(Feb 03 2021 at 02:44)</a>:</h4>
<p>Well, I'm on openSUSE Tumbleweed</p>



<a name="224967370"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/how%20to%20run/bless%20src/test/run-make-fulldeps/coverage%20%3F/near/224967370" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> pnkfelix <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/how.20to.20run.2Fbless.20src.2Ftest.2Frun-make-fulldeps.2Fcoverage.20.3F.html#224967370">(Feb 03 2021 at 02:44)</a>:</h4>
<p>or Arch</p>



<a name="224967371"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/how%20to%20run/bless%20src/test/run-make-fulldeps/coverage%20%3F/near/224967371" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> pnkfelix <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/how.20to.20run.2Fbless.20src.2Ftest.2Frun-make-fulldeps.2Fcoverage.20.3F.html#224967371">(Feb 03 2021 at 02:44)</a>:</h4>
<p>can't remember</p>



<a name="224967373"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/how%20to%20run/bless%20src/test/run-make-fulldeps/coverage%20%3F/near/224967373" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> pnkfelix <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/how.20to.20run.2Fbless.20src.2Ftest.2Frun-make-fulldeps.2Fcoverage.20.3F.html#224967373">(Feb 03 2021 at 02:44)</a>:</h4>
<p>oh well</p>



<a name="224967374"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/how%20to%20run/bless%20src/test/run-make-fulldeps/coverage%20%3F/near/224967374" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> simulacrum <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/how.20to.20run.2Fbless.20src.2Ftest.2Frun-make-fulldeps.2Fcoverage.20.3F.html#224967374">(Feb 03 2021 at 02:44)</a>:</h4>
<p>heh</p>



<a name="224967375"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/how%20to%20run/bless%20src/test/run-make-fulldeps/coverage%20%3F/near/224967375" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> pnkfelix <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/how.20to.20run.2Fbless.20src.2Ftest.2Frun-make-fulldeps.2Fcoverage.20.3F.html#224967375">(Feb 03 2021 at 02:44)</a>:</h4>
<p>:)</p>



<a name="224967393"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/how%20to%20run/bless%20src/test/run-make-fulldeps/coverage%20%3F/near/224967393" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> simulacrum <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/how.20to.20run.2Fbless.20src.2Ftest.2Frun-make-fulldeps.2Fcoverage.20.3F.html#224967393">(Feb 03 2021 at 02:45)</a>:</h4>
<p>I guess presumably CI on linux is indeed skipping these</p>



<a name="224967401"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/how%20to%20run/bless%20src/test/run-make-fulldeps/coverage%20%3F/near/224967401" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> simulacrum <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/how.20to.20run.2Fbless.20src.2Ftest.2Frun-make-fulldeps.2Fcoverage.20.3F.html#224967401">(Feb 03 2021 at 02:45)</a>:</h4>
<p>since we universally have ubuntu afaik</p>



<a name="224967415"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/how%20to%20run/bless%20src/test/run-make-fulldeps/coverage%20%3F/near/224967415" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> simulacrum <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/how.20to.20run.2Fbless.20src.2Ftest.2Frun-make-fulldeps.2Fcoverage.20.3F.html#224967415">(Feb 03 2021 at 02:45)</a>:</h4>
<p>and on windows I could believe bash is the only shell</p>



<a name="224967419"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/how%20to%20run/bless%20src/test/run-make-fulldeps/coverage%20%3F/near/224967419" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> pnkfelix <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/how.20to.20run.2Fbless.20src.2Ftest.2Frun-make-fulldeps.2Fcoverage.20.3F.html#224967419">(Feb 03 2021 at 02:45)</a>:</h4>
<p>maybe</p>



<a name="224967428"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/how%20to%20run/bless%20src/test/run-make-fulldeps/coverage%20%3F/near/224967428" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> pnkfelix <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/how.20to.20run.2Fbless.20src.2Ftest.2Frun-make-fulldeps.2Fcoverage.20.3F.html#224967428">(Feb 03 2021 at 02:45)</a>:</h4>
<p>(maybe re the CI)</p>



<a name="224967510"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/how%20to%20run/bless%20src/test/run-make-fulldeps/coverage%20%3F/near/224967510" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> simulacrum <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/how.20to.20run.2Fbless.20src.2Ftest.2Frun-make-fulldeps.2Fcoverage.20.3F.html#224967510">(Feb 03 2021 at 02:46)</a>:</h4>
<p>yeah testing given current state seems annoying</p>



<a name="224967529"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/how%20to%20run/bless%20src/test/run-make-fulldeps/coverage%20%3F/near/224967529" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> simulacrum <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/how.20to.20run.2Fbless.20src.2Ftest.2Frun-make-fulldeps.2Fcoverage.20.3F.html#224967529">(Feb 03 2021 at 02:47)</a>:</h4>
<p>anyway, I should also head to bed</p>



<a name="224967552"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/how%20to%20run/bless%20src/test/run-make-fulldeps/coverage%20%3F/near/224967552" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wesley Wiser <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/how.20to.20run.2Fbless.20src.2Ftest.2Frun-make-fulldeps.2Fcoverage.20.3F.html#224967552">(Feb 03 2021 at 02:47)</a>:</h4>
<p>same</p>



<a name="224967558"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/how%20to%20run/bless%20src/test/run-make-fulldeps/coverage%20%3F/near/224967558" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wesley Wiser <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/how.20to.20run.2Fbless.20src.2Ftest.2Frun-make-fulldeps.2Fcoverage.20.3F.html#224967558">(Feb 03 2021 at 02:47)</a>:</h4>
<p>Night! <span aria-label="wave" class="emoji emoji-1f44b" role="img" title="wave">:wave:</span></p>



<a name="224967879"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/how%20to%20run/bless%20src/test/run-make-fulldeps/coverage%20%3F/near/224967879" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> pnkfelix <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/how.20to.20run.2Fbless.20src.2Ftest.2Frun-make-fulldeps.2Fcoverage.20.3F.html#224967879">(Feb 03 2021 at 02:54)</a>:</h4>
<p>You actually asleep yet <span class="user-mention" data-user-id="116122">@simulacrum</span> ?</p>



<a name="224967970"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/how%20to%20run/bless%20src/test/run-make-fulldeps/coverage%20%3F/near/224967970" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> pnkfelix <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/how.20to.20run.2Fbless.20src.2Ftest.2Frun-make-fulldeps.2Fcoverage.20.3F.html#224967970">(Feb 03 2021 at 02:56)</a>:</h4>
<p>I guess I should go to bed too. Or at least do the dishes. <span aria-label="sleepy" class="emoji emoji-1f62a" role="img" title="sleepy">:sleepy:</span></p>



<a name="224967999"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/how%20to%20run/bless%20src/test/run-make-fulldeps/coverage%20%3F/near/224967999" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> pnkfelix <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/how.20to.20run.2Fbless.20src.2Ftest.2Frun-make-fulldeps.2Fcoverage.20.3F.html#224967999">(Feb 03 2021 at 02:56)</a>:</h4>
<p>(Put up PR; not locally tested yet): Use <code># min-llvm-version: 11.0</code> to force a minimum LLVM version <a href="https://github.com/rust-lang/rust/issues/81688">#81688</a></p>



<a name="224968243"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/how%20to%20run/bless%20src/test/run-make-fulldeps/coverage%20%3F/near/224968243" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> simulacrum <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/how.20to.20run.2Fbless.20src.2Ftest.2Frun-make-fulldeps.2Fcoverage.20.3F.html#224968243">(Feb 03 2021 at 03:01)</a>:</h4>
<p>Not quite :) PR seems good to me.</p>



<a name="224969202"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/how%20to%20run/bless%20src/test/run-make-fulldeps/coverage%20%3F/near/224969202" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> pnkfelix <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/how.20to.20run.2Fbless.20src.2Ftest.2Frun-make-fulldeps.2Fcoverage.20.3F.html#224969202">(Feb 03 2021 at 03:16)</a>:</h4>
<p>Hmm I now wonder/worry if fixing this is going to expose other brokenness in these tests</p>



<a name="224969223"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/how%20to%20run/bless%20src/test/run-make-fulldeps/coverage%20%3F/near/224969223" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> pnkfelix <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/how.20to.20run.2Fbless.20src.2Ftest.2Frun-make-fulldeps.2Fcoverage.20.3F.html#224969223">(Feb 03 2021 at 03:17)</a>:</h4>
<p>(at least, the <code>--bless</code> option for them sounds like it might <em>depend</em> on one having set <code>llvm.assertions = true</code> in the config.toml ?)</p>



<a name="224969941"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/how%20to%20run/bless%20src/test/run-make-fulldeps/coverage%20%3F/near/224969941" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> pnkfelix <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/how.20to.20run.2Fbless.20src.2Ftest.2Frun-make-fulldeps.2Fcoverage.20.3F.html#224969941">(Feb 03 2021 at 03:31)</a>:</h4>
<p>(I'm just ranting now because my <code>--bless</code> run caused a bunch of .txt files in run-make-fulldeps to be cleared out of all their content, and so I'm very suspicious of all of this infrastructure for the coverage tests now.)</p>



<a name="225011376"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/how%20to%20run/bless%20src/test/run-make-fulldeps/coverage%20%3F/near/225011376" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> pnkfelix <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/how.20to.20run.2Fbless.20src.2Ftest.2Frun-make-fulldeps.2Fcoverage.20.3F.html#225011376">(Feb 03 2021 at 13:05)</a>:</h4>
<p><span class="user-mention silent" data-user-id="116083">pnkfelix</span> <a href="#narrow/stream/131828-t-compiler/topic/how.20to.20run.2Fbless.20src.2Ftest.2Frun-make-fulldeps.2Fcoverage.20.3F/near/224969202">said</a>:</p>
<blockquote>
<p>Hmm I now wonder/worry if fixing this is going to expose other brokenness in these tests</p>
</blockquote>
<p>Yeah, <a href="https://github.com/rust-lang/rust/blob/d6a28a97e697bd4af5870a9b9f72c53e979c1fe2/src/test/run-make-fulldeps/coverage-reports/Makefile#L134">run-make-full-deps/coverage-reports</a> also makes use of <code>[[</code> syntax.</p>



<a name="225091449"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/how%20to%20run/bless%20src/test/run-make-fulldeps/coverage%20%3F/near/225091449" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Rich Kadel <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/how.20to.20run.2Fbless.20src.2Ftest.2Frun-make-fulldeps.2Fcoverage.20.3F.html#225091449">(Feb 03 2021 at 22:17)</a>:</h4>
<p>Hey guys. So sorry to be late to the party... I haven't been on Zulip, and got only the notification when pnkfelix @mentioned me in the beginning. I had no idea the dialog continued until checking after being cc'ed on the PR today.</p>



<a name="225091690"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/how%20to%20run/bless%20src/test/run-make-fulldeps/coverage%20%3F/near/225091690" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Rich Kadel <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/how.20to.20run.2Fbless.20src.2Ftest.2Frun-make-fulldeps.2Fcoverage.20.3F.html#225091690">(Feb 03 2021 at 22:18)</a>:</h4>
<p>These tests were confirmed to work on the primary Linux, Mac, and Windows CI builds at least through December. (I haven't been doing much on the compiler since then.)</p>



<a name="225091808"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/how%20to%20run/bless%20src/test/run-make-fulldeps/coverage%20%3F/near/225091808" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Rich Kadel <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/how.20to.20run.2Fbless.20src.2Ftest.2Frun-make-fulldeps.2Fcoverage.20.3F.html#225091808">(Feb 03 2021 at 22:18)</a>:</h4>
<p>My primary development is on Linux but I've also tested locally on Mac and Windows (mainly MSVC, but others did some testing with Windows gnu)</p>



<a name="225091865"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/how%20to%20run/bless%20src/test/run-make-fulldeps/coverage%20%3F/near/225091865" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Rich Kadel <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/how.20to.20run.2Fbless.20src.2Ftest.2Frun-make-fulldeps.2Fcoverage.20.3F.html#225091865">(Feb 03 2021 at 22:19)</a>:</h4>
<p>So if the Makefiles aren't working now, then something changed outside of these coverage scripts/makefiles.</p>



<a name="225091962"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/how%20to%20run/bless%20src/test/run-make-fulldeps/coverage%20%3F/near/225091962" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> pnkfelix <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/how.20to.20run.2Fbless.20src.2Ftest.2Frun-make-fulldeps.2Fcoverage.20.3F.html#225091962">(Feb 03 2021 at 22:20)</a>:</h4>
<p>What does "confirmed to work" mean?</p>



<a name="225092016"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/how%20to%20run/bless%20src/test/run-make-fulldeps/coverage%20%3F/near/225092016" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> pnkfelix <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/how.20to.20run.2Fbless.20src.2Ftest.2Frun-make-fulldeps.2Fcoverage.20.3F.html#225092016">(Feb 03 2021 at 22:20)</a>:</h4>
<p>If "work" means "the CI does not signal an error when the code is correct", then yes, they worked.</p>



<a name="225092024"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/how%20to%20run/bless%20src/test/run-make-fulldeps/coverage%20%3F/near/225092024" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Rich Kadel <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/how.20to.20run.2Fbless.20src.2Ftest.2Frun-make-fulldeps.2Fcoverage.20.3F.html#225092024">(Feb 03 2021 at 22:20)</a>:</h4>
<p>I confirmed both locally and viewing CI scripts (and many times fixing CI errors) on all three main platform types that the tests ran.</p>



<a name="225092098"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/how%20to%20run/bless%20src/test/run-make-fulldeps/coverage%20%3F/near/225092098" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Rich Kadel <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/how.20to.20run.2Fbless.20src.2Ftest.2Frun-make-fulldeps.2Fcoverage.20.3F.html#225092098">(Feb 03 2021 at 22:21)</a>:</h4>
<p>So CI did fail when there were errors and did not fail when errors were fixed</p>



<a name="225092175"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/how%20to%20run/bless%20src/test/run-make-fulldeps/coverage%20%3F/near/225092175" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Rich Kadel <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/how.20to.20run.2Fbless.20src.2Ftest.2Frun-make-fulldeps.2Fcoverage.20.3F.html#225092175">(Feb 03 2021 at 22:22)</a>:</h4>
<p>--bless also worked for all three</p>



<a name="225092202"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/how%20to%20run/bless%20src/test/run-make-fulldeps/coverage%20%3F/near/225092202" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> pnkfelix <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/how.20to.20run.2Fbless.20src.2Ftest.2Frun-make-fulldeps.2Fcoverage.20.3F.html#225092202">(Feb 03 2021 at 22:22)</a>:</h4>
<p>Okay. The main observation I have made is that the nature of these errors is that its dependent on two things</p>



<a name="225092244"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/how%20to%20run/bless%20src/test/run-make-fulldeps/coverage%20%3F/near/225092244" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> pnkfelix <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/how.20to.20run.2Fbless.20src.2Ftest.2Frun-make-fulldeps.2Fcoverage.20.3F.html#225092244">(Feb 03 2021 at 22:22)</a>:</h4>
<ol>
<li>the use of bash specific syntax in the <code>$(shell ...)</code> invocations, and 2. a platform that has <code>/bin/sh</code> linked to <code>/bin/dash</code> instead of <code>/bin/bash</code></li>
</ol>



<a name="225092298"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/how%20to%20run/bless%20src/test/run-make-fulldeps/coverage%20%3F/near/225092298" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> pnkfelix <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/how.20to.20run.2Fbless.20src.2Ftest.2Frun-make-fulldeps.2Fcoverage.20.3F.html#225092298">(Feb 03 2021 at 22:23)</a>:</h4>
<p>and when those two things combined, what we observe is the tests being silently ignored</p>



<a name="225092306"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/how%20to%20run/bless%20src/test/run-make-fulldeps/coverage%20%3F/near/225092306" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Rich Kadel <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/how.20to.20run.2Fbless.20src.2Ftest.2Frun-make-fulldeps.2Fcoverage.20.3F.html#225092306">(Feb 03 2021 at 22:23)</a>:</h4>
<p>It does seem unlikely they would work with dash</p>



<a name="225092322"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/how%20to%20run/bless%20src/test/run-make-fulldeps/coverage%20%3F/near/225092322" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> pnkfelix <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/how.20to.20run.2Fbless.20src.2Ftest.2Frun-make-fulldeps.2Fcoverage.20.3F.html#225092322">(Feb 03 2021 at 22:23)</a>:</h4>
<p>so its possible that the CI switched to /bin/dash sometime recently</p>



<a name="225092349"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/how%20to%20run/bless%20src/test/run-make-fulldeps/coverage%20%3F/near/225092349" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> pnkfelix <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/how.20to.20run.2Fbless.20src.2Ftest.2Frun-make-fulldeps.2Fcoverage.20.3F.html#225092349">(Feb 03 2021 at 22:23)</a>:</h4>
<p>but I suspect its more likely that the use of bash-specific syntax was injected only very recently</p>



<a name="225092366"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/how%20to%20run/bless%20src/test/run-make-fulldeps/coverage%20%3F/near/225092366" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Rich Kadel <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/how.20to.20run.2Fbless.20src.2Ftest.2Frun-make-fulldeps.2Fcoverage.20.3F.html#225092366">(Feb 03 2021 at 22:24)</a>:</h4>
<p>yikes... Is it dash now, for sure?</p>



<a name="225092425"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/how%20to%20run/bless%20src/test/run-make-fulldeps/coverage%20%3F/near/225092425" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> pnkfelix <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/how.20to.20run.2Fbless.20src.2Ftest.2Frun-make-fulldeps.2Fcoverage.20.3F.html#225092425">(Feb 03 2021 at 22:24)</a>:</h4>
<p>Well, <span class="user-mention" data-user-id="116122">@simulacrum</span> said that they observed the same thing on their stock ubuntu system</p>



<a name="225092464"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/how%20to%20run/bless%20src/test/run-make-fulldeps/coverage%20%3F/near/225092464" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> pnkfelix <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/how.20to.20run.2Fbless.20src.2Ftest.2Frun-make-fulldeps.2Fcoverage.20.3F.html#225092464">(Feb 03 2021 at 22:24)</a>:</h4>
<p><span class="user-mention silent" data-user-id="116122">simulacrum</span> <a href="#narrow/stream/131828-t-compiler/topic/how.20to.20run.2Fbless.20src.2Ftest.2Frun-make-fulldeps.2Fcoverage.20.3F/near/224967239">said</a>:</p>
<blockquote>
<p>aha I can reproduce with</p>
<p>LLVM_BIN_DIR=./build/x86_64-unknown-linux-gnu/ci-llvm/bin make  -f src/test/run-make-fulldeps/coverage/coverage_tools.mk foo</p>
<p>which gets me /bin/sh: 1: Bad substitution</p>
</blockquote>
<p><span aria-label="point up" class="emoji emoji-1f446" role="img" title="point up">:point_up:</span></p>



<a name="225092501"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/how%20to%20run/bless%20src/test/run-make-fulldeps/coverage%20%3F/near/225092501" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> pnkfelix <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/how.20to.20run.2Fbless.20src.2Ftest.2Frun-make-fulldeps.2Fcoverage.20.3F.html#225092501">(Feb 03 2021 at 22:25)</a>:</h4>
<p>and asserted that the CI uses something similar</p>



<a name="225092689"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/how%20to%20run/bless%20src/test/run-make-fulldeps/coverage%20%3F/near/225092689" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Rich Kadel <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/how.20to.20run.2Fbless.20src.2Ftest.2Frun-make-fulldeps.2Fcoverage.20.3F.html#225092689">(Feb 03 2021 at 22:26)</a>:</h4>
<p>I can look at the <code>blame</code> for those files, but would be surprised if someone else changed them to use different syntax "very recently"</p>



<a name="225092782"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/how%20to%20run/bless%20src/test/run-make-fulldeps/coverage%20%3F/near/225092782" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> pnkfelix <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/how.20to.20run.2Fbless.20src.2Ftest.2Frun-make-fulldeps.2Fcoverage.20.3F.html#225092782">(Feb 03 2021 at 22:27)</a>:</h4>
<p><span class="user-mention silent" data-user-id="116083">pnkfelix</span> <a href="#narrow/stream/131828-t-compiler/topic/how.20to.20run.2Fbless.20src.2Ftest.2Frun-make-fulldeps.2Fcoverage.20.3F/near/225092349">said</a>:</p>
<blockquote>
<p>but I suspect its more likely that the use of bash-specific syntax was injected only very recently</p>
</blockquote>
<p><a href="https://github.com/rust-lang/rust/blob/120b2a704a60d4341286bd82f6e638c65ca169b6/src/test/run-make-fulldeps/coverage-reports/Makefile#L134">this bit</a>  using <code>[[</code> came in on December 19, 2020, in PR <a href="https://github.com/rust-lang/rust/issues/79762">#79762</a></p>



<a name="225093000"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/how%20to%20run/bless%20src/test/run-make-fulldeps/coverage%20%3F/near/225093000" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> pnkfelix <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/how.20to.20run.2Fbless.20src.2Ftest.2Frun-make-fulldeps.2Fcoverage.20.3F.html#225093000">(Feb 03 2021 at 22:29)</a>:</h4>
<p>but I think the core problem (the one that caused the silent ignore) was <a href="https://github.com/rust-lang/rust/blob/120b2a704a60d4341286bd82f6e638c65ca169b6/src/test/run-make-fulldeps/coverage/coverage_tools.mk#L22">this bit</a> which came in on PR <a href="https://github.com/rust-lang/rust/issues/79441">#79441</a>, on November 24th 2020</p>



<a name="225093060"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/how%20to%20run/bless%20src/test/run-make-fulldeps/coverage%20%3F/near/225093060" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> pnkfelix <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/how.20to.20run.2Fbless.20src.2Ftest.2Frun-make-fulldeps.2Fcoverage.20.3F.html#225093060">(Feb 03 2021 at 22:29)</a>:</h4>
<p>so I suspect <span class="user-mention" data-user-id="296355">@Rich Kadel</span> that you did indeed test it, and got it working, and then unknowingly "broke" it (in the form of the silent ignores) at the end of November.</p>



<a name="225093194"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/how%20to%20run/bless%20src/test/run-make-fulldeps/coverage%20%3F/near/225093194" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> pnkfelix <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/how.20to.20run.2Fbless.20src.2Ftest.2Frun-make-fulldeps.2Fcoverage.20.3F.html#225093194">(Feb 03 2021 at 22:30)</a>:</h4>
<p>Or, maybe the CI's switched to <code>/bin/dash</code> after November 24th. It doesn't really matter at this point.</p>



<a name="225093235"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/how%20to%20run/bless%20src/test/run-make-fulldeps/coverage%20%3F/near/225093235" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Rich Kadel <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/how.20to.20run.2Fbless.20src.2Ftest.2Frun-make-fulldeps.2Fcoverage.20.3F.html#225093235">(Feb 03 2021 at 22:31)</a>:</h4>
<p>agreed ... It doesn't matter</p>



<a name="225093503"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/how%20to%20run/bless%20src/test/run-make-fulldeps/coverage%20%3F/near/225093503" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Rich Kadel <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/how.20to.20run.2Fbless.20src.2Ftest.2Frun-make-fulldeps.2Fcoverage.20.3F.html#225093503">(Feb 03 2021 at 22:33)</a>:</h4>
<p>So can you summarize what's needed to fix it? Your PR appears to remove the need for the LLVM check (and removes the check). What is still not working?</p>



<a name="225093569"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/how%20to%20run/bless%20src/test/run-make-fulldeps/coverage%20%3F/near/225093569" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> pnkfelix <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/how.20to.20run.2Fbless.20src.2Ftest.2Frun-make-fulldeps.2Fcoverage.20.3F.html#225093569">(Feb 03 2021 at 22:34)</a>:</h4>
<p>The thing that's not working now is the <code>[[</code> thing from PR <a href="https://github.com/rust-lang/rust/issues/79762">#79762</a></p>



<a name="225093608"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/how%20to%20run/bless%20src/test/run-make-fulldeps/coverage%20%3F/near/225093608" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> pnkfelix <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/how.20to.20run.2Fbless.20src.2Ftest.2Frun-make-fulldeps.2Fcoverage.20.3F.html#225093608">(Feb 03 2021 at 22:34)</a>:</h4>
<p>The CI didn't catch that because of the silent ignore problem.</p>



<a name="225093621"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/how%20to%20run/bless%20src/test/run-make-fulldeps/coverage%20%3F/near/225093621" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> pnkfelix <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/how.20to.20run.2Fbless.20src.2Ftest.2Frun-make-fulldeps.2Fcoverage.20.3F.html#225093621">(Feb 03 2021 at 22:34)</a>:</h4>
<p>but its fine; I'm ignoring the test for now</p>



<a name="225093630"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/how%20to%20run/bless%20src/test/run-make-fulldeps/coverage%20%3F/near/225093630" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> pnkfelix <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/how.20to.20run.2Fbless.20src.2Ftest.2Frun-make-fulldeps.2Fcoverage.20.3F.html#225093630">(Feb 03 2021 at 22:34)</a>:</h4>
<p>and we can fix the <code>[[</code> afterward</p>



<a name="225093657"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/how%20to%20run/bless%20src/test/run-make-fulldeps/coverage%20%3F/near/225093657" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Rich Kadel <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/how.20to.20run.2Fbless.20src.2Ftest.2Frun-make-fulldeps.2Fcoverage.20.3F.html#225093657">(Feb 03 2021 at 22:35)</a>:</h4>
<p>yeah, that's no problem to make it a separate PR, just wondering if I can help</p>



<a name="225093764"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/how%20to%20run/bless%20src/test/run-make-fulldeps/coverage%20%3F/near/225093764" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> pnkfelix <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/how.20to.20run.2Fbless.20src.2Ftest.2Frun-make-fulldeps.2Fcoverage.20.3F.html#225093764">(Feb 03 2021 at 22:36)</a>:</h4>
<p>Well, if you can figure out the correct (<code>/bin/sh</code>-compatible) way to</p>



<a name="225093777"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/how%20to%20run/bless%20src/test/run-make-fulldeps/coverage%20%3F/near/225093777" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Rich Kadel <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/how.20to.20run.2Fbless.20src.2Ftest.2Frun-make-fulldeps.2Fcoverage.20.3F.html#225093777">(Feb 03 2021 at 22:36)</a>:</h4>
<p>We should be able to replace <code>[[ -x $$file ]]</code> with <code>[ -x "$$file" ]</code></p>



<a name="225093783"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/how%20to%20run/bless%20src/test/run-make-fulldeps/coverage%20%3F/near/225093783" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> pnkfelix <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/how.20to.20run.2Fbless.20src.2Ftest.2Frun-make-fulldeps.2Fcoverage.20.3F.html#225093783">(Feb 03 2021 at 22:36)</a>:</h4>
<p>to do the <code>[[</code> thing <a href="https://github.com/Swatinem/rust/blob/087101e285895b8bce94a16a90f7e7a3d938c3da/src/test/run-make-fulldeps/coverage-reports/Makefile#L134">here</a></p>



<a name="225093785"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/how%20to%20run/bless%20src/test/run-make-fulldeps/coverage%20%3F/near/225093785" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> pnkfelix <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/how.20to.20run.2Fbless.20src.2Ftest.2Frun-make-fulldeps.2Fcoverage.20.3F.html#225093785">(Feb 03 2021 at 22:36)</a>:</h4>
<p>then that would be great</p>



<a name="225093797"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/how%20to%20run/bless%20src/test/run-make-fulldeps/coverage%20%3F/near/225093797" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> pnkfelix <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/how.20to.20run.2Fbless.20src.2Ftest.2Frun-make-fulldeps.2Fcoverage.20.3F.html#225093797">(Feb 03 2021 at 22:36)</a>:</h4>
<p>okay perfect</p>



<a name="225093858"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/how%20to%20run/bless%20src/test/run-make-fulldeps/coverage%20%3F/near/225093858" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> pnkfelix <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/how.20to.20run.2Fbless.20src.2Ftest.2Frun-make-fulldeps.2Fcoverage.20.3F.html#225093858">(Feb 03 2021 at 22:37)</a>:</h4>
<p>To test your change, I'm guessing it would suffice to do <code>SHELL=/bin/dash</code> in the Makefile itself.</p>



<a name="225093921"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/how%20to%20run/bless%20src/test/run-make-fulldeps/coverage%20%3F/near/225093921" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> pnkfelix <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/how.20to.20run.2Fbless.20src.2Ftest.2Frun-make-fulldeps.2Fcoverage.20.3F.html#225093921">(Feb 03 2021 at 22:38)</a>:</h4>
<p>(that, or change the link for your system's <code>/bin/sh</code>, but that sounds more invasive than I really want to suggest.)</p>



<a name="225093965"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/how%20to%20run/bless%20src/test/run-make-fulldeps/coverage%20%3F/near/225093965" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Rich Kadel <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/how.20to.20run.2Fbless.20src.2Ftest.2Frun-make-fulldeps.2Fcoverage.20.3F.html#225093965">(Feb 03 2021 at 22:38)</a>:</h4>
<p>Not 100% sure but sounds right... I can double-check the gnumake docs</p>



<a name="225094232"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/how%20to%20run/bless%20src/test/run-make-fulldeps/coverage%20%3F/near/225094232" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> pnkfelix <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/how.20to.20run.2Fbless.20src.2Ftest.2Frun-make-fulldeps.2Fcoverage.20.3F.html#225094232">(Feb 03 2021 at 22:41)</a>:</h4>
<p>This special case handling of SHELL is so amazingly representative of the kind of weirdness one encounters when writing Makefiles</p>



<a name="225094327"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/how%20to%20run/bless%20src/test/run-make-fulldeps/coverage%20%3F/near/225094327" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> pnkfelix <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/how.20to.20run.2Fbless.20src.2Ftest.2Frun-make-fulldeps.2Fcoverage.20.3F.html#225094327">(Feb 03 2021 at 22:42)</a>:</h4>
<p>the justification makes perfect sense, but the outcome... I guess the outcome would be fine if bash went into a "strict mode" when invoked as <code>/bin/sh</code></p>



<a name="225094339"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/how%20to%20run/bless%20src/test/run-make-fulldeps/coverage%20%3F/near/225094339" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Rich Kadel <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/how.20to.20run.2Fbless.20src.2Ftest.2Frun-make-fulldeps.2Fcoverage.20.3F.html#225094339">(Feb 03 2021 at 22:42)</a>:</h4>
<p>I and others would like to move this to a rust-based test, but it's effort, and I my work priorities have shifted now that coverage is working</p>



<a name="225094377"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/how%20to%20run/bless%20src/test/run-make-fulldeps/coverage%20%3F/near/225094377" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> pnkfelix <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/how.20to.20run.2Fbless.20src.2Ftest.2Frun-make-fulldeps.2Fcoverage.20.3F.html#225094377">(Feb 03 2021 at 22:43)</a>:</h4>
<p>yeah I understand that. I think <span class="user-mention" data-user-id="116122">@simulacrum</span> had some thoughts about how to convert this into a <code>run-pass</code> test. We can talk about that separately.</p>



<a name="225094506"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/how%20to%20run/bless%20src/test/run-make-fulldeps/coverage%20%3F/near/225094506" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Rich Kadel <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/how.20to.20run.2Fbless.20src.2Ftest.2Frun-make-fulldeps.2Fcoverage.20.3F.html#225094506">(Feb 03 2021 at 22:44)</a>:</h4>
<p>I'm fetching and making a clean build now to test without the change and then make it and we'll see if that both repros and fixes it, respectively</p>



<a name="225096150"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/how%20to%20run/bless%20src/test/run-make-fulldeps/coverage%20%3F/near/225096150" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Rich Kadel <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/how.20to.20run.2Fbless.20src.2Ftest.2Frun-make-fulldeps.2Fcoverage.20.3F.html#225096150">(Feb 03 2021 at 23:00)</a>:</h4>
<p>I'm thinking we should explicitly set <code>SHELL=/bin/dash</code> (or something like that) in <code>tools.mk</code> so when people test in other environments (e.g., locally) they are not picking up <code>bash</code> if <code>/bin/sh</code> is configured differently.</p>



<a name="225096392"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/how%20to%20run/bless%20src/test/run-make-fulldeps/coverage%20%3F/near/225096392" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Rich Kadel <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/how.20to.20run.2Fbless.20src.2Ftest.2Frun-make-fulldeps.2Fcoverage.20.3F.html#225096392">(Feb 03 2021 at 23:03)</a>:</h4>
<p>I confirmed <code>/bin/dash</code> is valid on my Mac and Linux machines... My Windows VM is shut down right now, but I assume Ming also has <code>/bin/dash</code> ... Can anyone confirm?</p>



<a name="225097441"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/how%20to%20run/bless%20src/test/run-make-fulldeps/coverage%20%3F/near/225097441" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Rich Kadel <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/how.20to.20run.2Fbless.20src.2Ftest.2Frun-make-fulldeps.2Fcoverage.20.3F.html#225097441">(Feb 03 2021 at 23:14)</a>:</h4>
<p>If there is no disagreement, I'm planning to include this addition to <code>tools.mk</code>, in the PR that also fixes the <code>[[</code> (assuming the repo and fix work as expected):</p>
<div class="codehilite" data-code-language="Makefile"><pre><span></span><code><span class="c"># CI platforms use `/bin/dash`. When compiling in other environments, the</span>
<span class="c"># default may be different (for example, may default to `/bin/bash`), and syntax</span>
<span class="c"># and results could be different. Ensure Makefile `$(shell ...)` invocations</span>
<span class="c"># always run in `dash`.</span>
<span class="nv">SHELL</span> <span class="o">:=</span> /bin/dash
</code></pre></div>



<a name="225103843"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/how%20to%20run/bless%20src/test/run-make-fulldeps/coverage%20%3F/near/225103843" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> pnkfelix <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/how.20to.20run.2Fbless.20src.2Ftest.2Frun-make-fulldeps.2Fcoverage.20.3F.html#225103843">(Feb 04 2021 at 00:27)</a>:</h4>
<p>I don't think we can rely on <code>/bin/dash</code> being present</p>



<a name="225103968"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/how%20to%20run/bless%20src/test/run-make-fulldeps/coverage%20%3F/near/225103968" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> pnkfelix <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/how.20to.20run.2Fbless.20src.2Ftest.2Frun-make-fulldeps.2Fcoverage.20.3F.html#225103968">(Feb 04 2021 at 00:28)</a>:</h4>
<p>We can consider setting it conditionally, based on whether the file exists, but I suspect there's a broader policy issue we probably should be discussing with the team.</p>



<a name="225105178"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/how%20to%20run/bless%20src/test/run-make-fulldeps/coverage%20%3F/near/225105178" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nagisa <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/how.20to.20run.2Fbless.20src.2Ftest.2Frun-make-fulldeps.2Fcoverage.20.3F.html#225105178">(Feb 04 2021 at 00:43)</a>:</h4>
<div class="codehilite"><pre><span></span><code>$ ls /bin
sh
</code></pre></div>



<a name="225105453"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/how%20to%20run/bless%20src/test/run-make-fulldeps/coverage%20%3F/near/225105453" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nagisa <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/how.20to.20run.2Fbless.20src.2Ftest.2Frun-make-fulldeps.2Fcoverage.20.3F.html#225105453">(Feb 04 2021 at 00:47)</a>:</h4>
<p><code>/usr/bin/env bash</code> (or whatever other shell we want to use) could be significantly more reliable.</p>



<a name="225106696"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/how%20to%20run/bless%20src/test/run-make-fulldeps/coverage%20%3F/near/225106696" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Rich Kadel <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/how.20to.20run.2Fbless.20src.2Ftest.2Frun-make-fulldeps.2Fcoverage.20.3F.html#225106696">(Feb 04 2021 at 01:03)</a>:</h4>
<p>OK, well, I'm not sure what the best solution is, but I uploaded a PR with the change as originally suggested, and I can change it before we submit it to bors:  <a href="https://github.com/rust-lang/rust/issues/81734">#81734</a></p>



<a name="225106772"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/how%20to%20run/bless%20src/test/run-make-fulldeps/coverage%20%3F/near/225106772" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Rich Kadel <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/how.20to.20run.2Fbless.20src.2Ftest.2Frun-make-fulldeps.2Fcoverage.20.3F.html#225106772">(Feb 04 2021 at 01:04)</a>:</h4>
<p>Is there anyone else that you think we should ping, who might have an opinion?</p>



<a name="225113237"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/how%20to%20run/bless%20src/test/run-make-fulldeps/coverage%20%3F/near/225113237" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Rich Kadel <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/how.20to.20run.2Fbless.20src.2Ftest.2Frun-make-fulldeps.2Fcoverage.20.3F.html#225113237">(Feb 04 2021 at 02:52)</a>:</h4>
<p>FYI,  I have a pretty vanilla setup of Windows, set up specifically to test rustc and llvm, using the recommended steps on the rust-lang/rust README.md, and my msys2 setup has <code>/bin/dash</code>. I didn't install it specifically.</p>



<a name="225113326"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/how%20to%20run/bless%20src/test/run-make-fulldeps/coverage%20%3F/near/225113326" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Rich Kadel <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/how.20to.20run.2Fbless.20src.2Ftest.2Frun-make-fulldeps.2Fcoverage.20.3F.html#225113326">(Feb 04 2021 at 02:55)</a>:</h4>
<p>@nagisa Can you clarify what you are showing in your example? I didn't understand your comment.</p>



<a name="225116090"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/how%20to%20run/bless%20src/test/run-make-fulldeps/coverage%20%3F/near/225116090" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joshua Nelson <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/how.20to.20run.2Fbless.20src.2Ftest.2Frun-make-fulldeps.2Fcoverage.20.3F.html#225116090">(Feb 04 2021 at 03:53)</a>:</h4>
<p>They're showing that they only have sh and not dash I think</p>



<a name="225116131"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/how%20to%20run/bless%20src/test/run-make-fulldeps/coverage%20%3F/near/225116131" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joshua Nelson <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/how.20to.20run.2Fbless.20src.2Ftest.2Frun-make-fulldeps.2Fcoverage.20.3F.html#225116131">(Feb 04 2021 at 03:54)</a>:</h4>
<p>(probably NixOS)</p>



<a name="225146280"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/how%20to%20run/bless%20src/test/run-make-fulldeps/coverage%20%3F/near/225146280" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nagisa <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/how.20to.20run.2Fbless.20src.2Ftest.2Frun-make-fulldeps.2Fcoverage.20.3F.html#225146280">(Feb 04 2021 at 11:18)</a>:</h4>
<p>It was a confirmation of @pnkfelix's message in that you cannot rely on /bin containing dash (or anything much at all), yeah.</p>



<a name="225166705"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/how%20to%20run/bless%20src/test/run-make-fulldeps/coverage%20%3F/near/225166705" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Rich Kadel <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/how.20to.20run.2Fbless.20src.2Ftest.2Frun-make-fulldeps.2Fcoverage.20.3F.html#225166705">(Feb 04 2021 at 14:34)</a>:</h4>
<p>Got it, ty</p>



<a name="225168009"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/how%20to%20run/bless%20src/test/run-make-fulldeps/coverage%20%3F/near/225168009" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Rich Kadel <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/how.20to.20run.2Fbless.20src.2Ftest.2Frun-make-fulldeps.2Fcoverage.20.3F.html#225168009">(Feb 04 2021 at 14:45)</a>:</h4>
<p>So what if there was a new rustc build requirement for <code>/bin/dash</code> to exist? Prefer the actual <code>dash</code>, but it could be satisfied by symbolic link (or worst case, by copy) from another dash-compatible shell (link <code>/bin/sh</code> in your case)? Installing <code>dash</code> as one of the minimum build requirements (in the same category as <code>python</code>, <code>git</code>, etc.) is preferred so developers are not able to break the build by adding scripts that don't work in <code>dash</code>, but we could document that providing a <code>/bin/dash</code> by symbolic link to <code>bash</code> or whatever <code>make</code> is currently using is a possible workaround, if taken with caution to test any <code>shell</code> script changes with <code>dash</code> on some platform.</p>



<a name="225168162"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/how%20to%20run/bless%20src/test/run-make-fulldeps/coverage%20%3F/near/225168162" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Rich Kadel <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/how.20to.20run.2Fbless.20src.2Ftest.2Frun-make-fulldeps.2Fcoverage.20.3F.html#225168162">(Feb 04 2021 at 14:46)</a>:</h4>
<p>Since we know <code>dash</code> (the real one) is available in most developer Linux distros, MacOs, and msys2, this requirement isn't going to impact very many developers (I assume).</p>



<a name="225170323"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/how%20to%20run/bless%20src/test/run-make-fulldeps/coverage%20%3F/near/225170323" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joshua Nelson <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/how.20to.20run.2Fbless.20src.2Ftest.2Frun-make-fulldeps.2Fcoverage.20.3F.html#225170323">(Feb 04 2021 at 15:02)</a>:</h4>
<p>dash is a weird shell to require. If we're going to require a specific shell I think we should require bash: it's more flexible and I expect it to be easier to install on platforms like BSD and Solaris</p>



<a name="225187600"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/how%20to%20run/bless%20src/test/run-make-fulldeps/coverage%20%3F/near/225187600" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Rich Kadel <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/how.20to.20run.2Fbless.20src.2Ftest.2Frun-make-fulldeps.2Fcoverage.20.3F.html#225187600">(Feb 04 2021 at 16:48)</a>:</h4>
<p>I'd prefer <code>bash</code> myself, but it surprised me that the CI systems are defaulting to <code>dash</code>, so (today) dash-compatibility is a requirement for the Makefile shell scripts in our build, and it's just not enforced. Because of that, developers can have working builds on their machine that are not working in CI, and that can cause a lot of frustration and time (as <span class="user-mention" data-user-id="116083">@pnkfelix</span>'s experience showed).</p>



<a name="225187667"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/how%20to%20run/bless%20src/test/run-make-fulldeps/coverage%20%3F/near/225187667" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Rich Kadel <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/how.20to.20run.2Fbless.20src.2Ftest.2Frun-make-fulldeps.2Fcoverage.20.3F.html#225187667">(Feb 04 2021 at 16:49)</a>:</h4>
<p>But the other option is to update CI or rustc to force using bash always.</p>



<a name="225187746"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/how%20to%20run/bless%20src/test/run-make-fulldeps/coverage%20%3F/near/225187746" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Rich Kadel <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/how.20to.20run.2Fbless.20src.2Ftest.2Frun-make-fulldeps.2Fcoverage.20.3F.html#225187746">(Feb 04 2021 at 16:49)</a>:</h4>
<p>(Then the other issue is going to be, which version. GPL becomes an issue.)</p>



<a name="225207401"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/how%20to%20run/bless%20src/test/run-make-fulldeps/coverage%20%3F/near/225207401" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> pnkfelix <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/how.20to.20run.2Fbless.20src.2Ftest.2Frun-make-fulldeps.2Fcoverage.20.3F.html#225207401">(Feb 04 2021 at 19:11)</a>:</h4>
<p>I think we should leave the SHELL unset. Let it keep going to <code>/bin/sh</code></p>



<a name="225207459"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/how%20to%20run/bless%20src/test/run-make-fulldeps/coverage%20%3F/near/225207459" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> pnkfelix <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/how.20to.20run.2Fbless.20src.2Ftest.2Frun-make-fulldeps.2Fcoverage.20.3F.html#225207459">(Feb 04 2021 at 19:11)</a>:</h4>
<p>Yes, it does mean that we risk future issues where shell-implementation-specific code leaks in</p>



<a name="225207491"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/how%20to%20run/bless%20src/test/run-make-fulldeps/coverage%20%3F/near/225207491" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> pnkfelix <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/how.20to.20run.2Fbless.20src.2Ftest.2Frun-make-fulldeps.2Fcoverage.20.3F.html#225207491">(Feb 04 2021 at 19:12)</a>:</h4>
<p>But my understanding is that the Linux CI <em>is</em> using /bin/dash</p>



<a name="225207540"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/how%20to%20run/bless%20src/test/run-make-fulldeps/coverage%20%3F/near/225207540" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> pnkfelix <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/how.20to.20run.2Fbless.20src.2Ftest.2Frun-make-fulldeps.2Fcoverage.20.3F.html#225207540">(Feb 04 2021 at 19:12)</a>:</h4>
<p>while the Windows CI is using <code>/bin/bash</code></p>



<a name="225207582"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/how%20to%20run/bless%20src/test/run-make-fulldeps/coverage%20%3F/near/225207582" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> pnkfelix <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/how.20to.20run.2Fbless.20src.2Ftest.2Frun-make-fulldeps.2Fcoverage.20.3F.html#225207582">(Feb 04 2021 at 19:12)</a>:</h4>
<p>and so, in the <em>common case</em>, one of the CI's should catch problems here</p>



<a name="225207607"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/how%20to%20run/bless%20src/test/run-make-fulldeps/coverage%20%3F/near/225207607" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> pnkfelix <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/how.20to.20run.2Fbless.20src.2Ftest.2Frun-make-fulldeps.2Fcoverage.20.3F.html#225207607">(Feb 04 2021 at 19:12)</a>:</h4>
<p>The one thing I will point out</p>



<a name="225207630"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/how%20to%20run/bless%20src/test/run-make-fulldeps/coverage%20%3F/near/225207630" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> pnkfelix <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/how.20to.20run.2Fbless.20src.2Ftest.2Frun-make-fulldeps.2Fcoverage.20.3F.html#225207630">(Feb 04 2021 at 19:12)</a>:</h4>
<p>is that our test infrastructure's silently discarding the stdout/stderr output for ignored tests</p>



<a name="225207640"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/how%20to%20run/bless%20src/test/run-make-fulldeps/coverage%20%3F/near/225207640" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> pnkfelix <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/how.20to.20run.2Fbless.20src.2Ftest.2Frun-make-fulldeps.2Fcoverage.20.3F.html#225207640">(Feb 04 2021 at 19:13)</a>:</h4>
<p>was a huge part of why I couldn't figure this out</p>



<a name="225207652"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/how%20to%20run/bless%20src/test/run-make-fulldeps/coverage%20%3F/near/225207652" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> pnkfelix <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/how.20to.20run.2Fbless.20src.2Ftest.2Frun-make-fulldeps.2Fcoverage.20.3F.html#225207652">(Feb 04 2021 at 19:13)</a>:</h4>
<p>for so long</p>



<a name="225207708"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/how%20to%20run/bless%20src/test/run-make-fulldeps/coverage%20%3F/near/225207708" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> pnkfelix <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/how.20to.20run.2Fbless.20src.2Ftest.2Frun-make-fulldeps.2Fcoverage.20.3F.html#225207708">(Feb 04 2021 at 19:13)</a>:</h4>
<p>So personally, my plan is to try to tackle <em>that</em> problem</p>



<a name="225215659"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/how%20to%20run/bless%20src/test/run-make-fulldeps/coverage%20%3F/near/225215659" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Rich Kadel <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/how.20to.20run.2Fbless.20src.2Ftest.2Frun-make-fulldeps.2Fcoverage.20.3F.html#225215659">(Feb 04 2021 at 20:11)</a>:</h4>
<p>I hear you. But <code>dash</code> is still the lowest common denominator and all scripts MUST conform to <code>dash</code>. Developers building locally will not be fully testing their changes until they push to CI, and best case, a lot of time is lost waiting for a potential failure during a CI run. Worst case, CI isn't going to catch some things. For instance, when I made my changes to check for LLVM 11, I went through some specific steps to validate that the LLVM 11 check worked, sometimes by making temporary changes to the script to simulate having a lower version installed. Plus I might turn on test output or force an error status, to see some <code>echo</code> results to verify things. But it was always using <code>bash</code>, and I had no idea it would not work on <code>dash</code> hosts. If I was forced to use <code>dash</code>, I would have caught the problem in November, and you would never have had to deal with it.</p>



<a name="225215999"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/how%20to%20run/bless%20src/test/run-make-fulldeps/coverage%20%3F/near/225215999" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Rich Kadel <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/how.20to.20run.2Fbless.20src.2Ftest.2Frun-make-fulldeps.2Fcoverage.20.3F.html#225215999">(Feb 04 2021 at 20:13)</a>:</h4>
<p>So if forcing <code>SHELL = /bin/dash</code> is not acceptable, I would at least strongly encourage what you suggested earlier, that is, making it conditional on whether <code>/bin/dash</code> is available or not.<br>
And adding some documentation and/or comments somewhere to hopefully get the attention of developers that might not have <code>/bin/dash</code> locally, to know that <code>/bin/dash</code> (or similar non-bash but bourne-sh-like shell) is a constraint they may need to consider.</p>



<a name="225380145"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/how%20to%20run/bless%20src/test/run-make-fulldeps/coverage%20%3F/near/225380145" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Rich Kadel <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/how.20to.20run.2Fbless.20src.2Ftest.2Frun-make-fulldeps.2Fcoverage.20.3F.html#225380145">(Feb 06 2021 at 02:00)</a>:</h4>
<p>Hey <span class="user-mention" data-user-id="116083">@pnkfelix</span> <br>
Thanks for your patience.<br>
I updated the PR with a conditional check. This should have no visible side effects since <code>dash</code> is already used on some platforms, but if anyone introduces a <code>bash-compliant</code> but not <code>dash-compliant</code> change, and if that developer has <code>/bin/dash</code> installed (which should be most developers), they will get predictable failures at development time now.</p>



<a name="225380171"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/how%20to%20run/bless%20src/test/run-make-fulldeps/coverage%20%3F/near/225380171" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> pnkfelix <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/how.20to.20run.2Fbless.20src.2Ftest.2Frun-make-fulldeps.2Fcoverage.20.3F.html#225380171">(Feb 06 2021 at 02:01)</a>:</h4>
<p>sounds reasonable to me</p>



<a name="225380200"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/how%20to%20run/bless%20src/test/run-make-fulldeps/coverage%20%3F/near/225380200" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> pnkfelix <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/how.20to.20run.2Fbless.20src.2Ftest.2Frun-make-fulldeps.2Fcoverage.20.3F.html#225380200">(Feb 06 2021 at 02:01)</a>:</h4>
<p>only question is at what level in the makefile hierarchy to put the rule. I assume you put it at the highest <a href="http://tools.mk">tools.mk</a> level?</p>



<a name="225380246"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/how%20to%20run/bless%20src/test/run-make-fulldeps/coverage%20%3F/near/225380246" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> pnkfelix <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/how.20to.20run.2Fbless.20src.2Ftest.2Frun-make-fulldeps.2Fcoverage.20.3F.html#225380246">(Feb 06 2021 at 02:02)</a>:</h4>
<p>(not rule. Defiinition of SHELL, I guess.)</p>



<a name="225380254"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/how%20to%20run/bless%20src/test/run-make-fulldeps/coverage%20%3F/near/225380254" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> pnkfelix <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/how.20to.20run.2Fbless.20src.2Ftest.2Frun-make-fulldeps.2Fcoverage.20.3F.html#225380254">(Feb 06 2021 at 02:02)</a>:</h4>
<p>I guess I can go look at the PR to find out</p>



<a name="225380302"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/how%20to%20run/bless%20src/test/run-make-fulldeps/coverage%20%3F/near/225380302" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Rich Kadel <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/how.20to.20run.2Fbless.20src.2Ftest.2Frun-make-fulldeps.2Fcoverage.20.3F.html#225380302">(Feb 06 2021 at 02:03)</a>:</h4>
<p>Yes, <code>tools.mk</code> seemed like the right place.<br>
As a side note, even if stdout/stderr was working better, it's not uncommon for a script to capture both of them, and also catch the error status, and treat that error as a failure of some invoked binary, not realizing the actual reason for the error was a script syntax error. So things can still fail silently if the wrong shell is used to test.</p>



<a name="225380562"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/how%20to%20run/bless%20src/test/run-make-fulldeps/coverage%20%3F/near/225380562" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> pnkfelix <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/how.20to.20run.2Fbless.20src.2Ftest.2Frun-make-fulldeps.2Fcoverage.20.3F.html#225380562">(Feb 06 2021 at 02:08)</a>:</h4>
<p>another way to look at this though is that we should look into how to express these tests without using run-make infrastructure</p>



<a name="225380594"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/how%20to%20run/bless%20src/test/run-make-fulldeps/coverage%20%3F/near/225380594" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> pnkfelix <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/how.20to.20run.2Fbless.20src.2Ftest.2Frun-make-fulldeps.2Fcoverage.20.3F.html#225380594">(Feb 06 2021 at 02:09)</a>:</h4>
<p>at least, I think <span class="user-mention" data-user-id="116122">@simulacrum</span> was indicating that they though there may be opportunity to port them to run-pass infrastructure. I haven't looked into it deeply..</p>



<a name="225380705"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/how%20to%20run/bless%20src/test/run-make-fulldeps/coverage%20%3F/near/225380705" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> simulacrum <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/how.20to.20run.2Fbless.20src.2Ftest.2Frun-make-fulldeps.2Fcoverage.20.3F.html#225380705">(Feb 06 2021 at 02:11)</a>:</h4>
<p>Sure, at least fundamentally, there's no reason they can't be - run-pass has roughly the same set of available tools as run-make (and likewise for fulldeps)</p>



<a name="225381397"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/how%20to%20run/bless%20src/test/run-make-fulldeps/coverage%20%3F/near/225381397" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Rich Kadel <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/how.20to.20run.2Fbless.20src.2Ftest.2Frun-make-fulldeps.2Fcoverage.20.3F.html#225381397">(Feb 06 2021 at 02:26)</a>:</h4>
<p>Yeah, I agree, as we discussed earlier in this thread. It's not something I have time for right now though. But I'm all for it <span aria-label="smile" class="emoji emoji-1f642" role="img" title="smile">:smile:</span></p>



<a name="225613763"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/how%20to%20run/bless%20src/test/run-make-fulldeps/coverage%20%3F/near/225613763" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Rich Kadel <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/how.20to.20run.2Fbless.20src.2Ftest.2Frun-make-fulldeps.2Fcoverage.20.3F.html#225613763">(Feb 08 2021 at 21:49)</a>:</h4>
<p><span class="user-mention" data-user-id="116083">@pnkfelix</span> - Let me know if you have any other questions/concerns about <a href="https://github.com/rust-lang/rust/issues/81734">#81734</a>, if you are not ready to push to bors. Thanks.</p>



<hr><p>Last updated: Apr 12 2022 at 20:01 UTC</p>
</html>