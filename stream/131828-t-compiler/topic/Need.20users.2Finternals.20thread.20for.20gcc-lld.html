<html>
<head><meta charset="utf-8"><title>Need users/internals thread for gcc-lld · t-compiler · Zulip Chat Archive</title></head>
<h2>Stream: <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/index.html">t-compiler</a></h2>
<h3>Topic: <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/Need.20users.2Finternals.20thread.20for.20gcc-lld.html">Need users/internals thread for gcc-lld</a></h3>

<hr>

<base href="https://rust-lang.zulipchat.com">

<head><link href="https://zulip-archive.rust-lang.org/style.css" rel="stylesheet"></head>

<a name="245177775"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/Need%20users/internals%20thread%20for%20gcc-lld/near/245177775" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Gankra <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/Need.20users.2Finternals.20thread.20for.20gcc-lld.html#245177775">(Jul 07 2021 at 13:19)</a>:</h4>
<p>Using rust-lld through gcc/clang on linux has finally been implemented, someone needs to make the usual thread on internals/users asking users to test it out and provide feedback on how it affects build times in various configurations (and then we can all spread that thread around). I'm a bit too out of the loop to write up good instructions for what configs to test and how to measure the perf, so ideally someone else here can?</p>
<p>context here: <a href="https://github.com/rust-lang/rust/issues/71515#issuecomment-875257289">https://github.com/rust-lang/rust/issues/71515#issuecomment-875257289</a></p>



<a name="245178266"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/Need%20users/internals%20thread%20for%20gcc-lld/near/245178266" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Laurențiu <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/Need.20users.2Finternals.20thread.20for.20gcc-lld.html#245178266">(Jul 07 2021 at 13:23)</a>:</h4>
<p><del>Is there any way to check that the flag is working?</del> Welp, <code>-Z gcc-ld=lld</code> works and <code>-Z gcc-ld=lld2</code> fails for me on Arch when building <code>rust-analyzer</code> (which is arguably an easy case).</p>



<a name="245184015"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/Need%20users/internals%20thread%20for%20gcc-lld/near/245184015" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Gankra <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/Need.20users.2Finternals.20thread.20for.20gcc-lld.html#245184015">(Jul 07 2021 at 13:58)</a>:</h4>
<p>oh i suppose you'd also want to include instructions for printing what linker rust is defaulting to for the non-lld path</p>



<a name="245196001"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/Need%20users/internals%20thread%20for%20gcc-lld/near/245196001" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Triplett <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/Need.20users.2Finternals.20thread.20for.20gcc-lld.html#245196001">(Jul 07 2021 at 15:11)</a>:</h4>
<p><span class="user-mention" data-user-id="137587">@Gankra</span> Thank you so much for working on that! I'm excited that we're one step closer to being able to use lld out-of-the-box, and hopefully eventually by default.</p>



<a name="245198794"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/Need%20users/internals%20thread%20for%20gcc-lld/near/245198794" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Gankra <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/Need.20users.2Finternals.20thread.20for.20gcc-lld.html#245198794">(Jul 07 2021 at 15:30)</a>:</h4>
<p><span class="user-mention" data-user-id="239881">@Josh Triplett</span> is that you volunteering? :)</p>



<a name="245199029"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/Need%20users/internals%20thread%20for%20gcc-lld/near/245199029" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Triplett <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/Need.20users.2Finternals.20thread.20for.20gcc-lld.html#245199029">(Jul 07 2021 at 15:31)</a>:</h4>
<p>Based on this thread I'd thought that <span class="user-mention" data-user-id="203546">@Laurențiu</span> was working on it.</p>



<a name="245200616"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/Need%20users/internals%20thread%20for%20gcc-lld/near/245200616" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Laurențiu <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/Need.20users.2Finternals.20thread.20for.20gcc-lld.html#245200616">(Jul 07 2021 at 15:41)</a>:</h4>
<p>Nope, I just gave it a spin. But I was confused myself about that remark.</p>



<a name="245204229"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/Need%20users/internals%20thread%20for%20gcc-lld/near/245204229" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Triplett <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/Need.20users.2Finternals.20thread.20for.20gcc-lld.html#245204229">(Jul 07 2021 at 16:06)</a>:</h4>
<p>I'm interested, but I don't have the bandwidth at the moment.</p>



<a name="245206699"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/Need%20users/internals%20thread%20for%20gcc-lld/near/245206699" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Gankra <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/Need.20users.2Finternals.20thread.20for.20gcc-lld.html#245206699">(Jul 07 2021 at 16:26)</a>:</h4>
<p><span class="user-mention" data-user-id="256342">@bstrie</span> is this something you'd be interested in? i seem to recall you being an early champion of this effort.</p>



<a name="245217356"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/Need%20users/internals%20thread%20for%20gcc-lld/near/245217356" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> bstrie <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/Need.20users.2Finternals.20thread.20for.20gcc-lld.html#245217356">(Jul 07 2021 at 17:48)</a>:</h4>
<p>I'm very willing to put out the call for broader testing, but I need to figure out the exact steps that we should ask people to try. and it looks like from the issues thread that there might be some remaining issues</p>



<a name="245217599"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/Need%20users/internals%20thread%20for%20gcc-lld/near/245217599" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> bstrie <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/Need.20users.2Finternals.20thread.20for.20gcc-lld.html#245217599">(Jul 07 2021 at 17:50)</a>:</h4>
<p>Are we currently shipping LLD in any capacity, or will users need to get it themselves?</p>



<a name="245217777"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/Need%20users/internals%20thread%20for%20gcc-lld/near/245217777" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Triplett <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/Need.20users.2Finternals.20thread.20for.20gcc-lld.html#245217777">(Jul 07 2021 at 17:52)</a>:</h4>
<p>We're shipping an lld as rust-lld, and the thing that was recently implemented was the way to use that.</p>



<a name="245217824"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/Need%20users/internals%20thread%20for%20gcc-lld/near/245217824" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Gankra <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/Need.20users.2Finternals.20thread.20for.20gcc-lld.html#245217824">(Jul 07 2021 at 17:52)</a>:</h4>
<p>Last I recall, we ship a rust-lld binary by default, although if you're using a rustc from your distro it will be a symlink to the system lld -- but only nightlies from ~this week have all the relevant patches</p>



<a name="245217898"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/Need%20users/internals%20thread%20for%20gcc-lld/near/245217898" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Gankra <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/Need.20users.2Finternals.20thread.20for.20gcc-lld.html#245217898">(Jul 07 2021 at 17:52)</a>:</h4>
<p>still fuzzy on what's up with macos -- focus on linux for now</p>



<a name="245218118"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/Need%20users/internals%20thread%20for%20gcc-lld/near/245218118" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> bstrie <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/Need.20users.2Finternals.20thread.20for.20gcc-lld.html#245218118">(Jul 07 2021 at 17:54)</a>:</h4>
<p>I'm fine with forcing testers to use nightly, I just don't want to force them to build rustc or LLVM, and I also would prefer to have a single source for them to grab LLD from to minimize version differences</p>



<a name="245218156"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/Need%20users/internals%20thread%20for%20gcc-lld/near/245218156" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> bstrie <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/Need.20users.2Finternals.20thread.20for.20gcc-lld.html#245218156">(Jul 07 2021 at 17:54)</a>:</h4>
<p>is rust-lld a rustup component or does every nightly build already have it?</p>



<a name="245218186"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/Need%20users/internals%20thread%20for%20gcc-lld/near/245218186" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Gankra <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/Need.20users.2Finternals.20thread.20for.20gcc-lld.html#245218186">(Jul 07 2021 at 17:55)</a>:</h4>
<p>shipped by default, no extra steps</p>



<a name="245218326"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/Need%20users/internals%20thread%20for%20gcc-lld/near/245218326" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Kevin Tran <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/Need.20users.2Finternals.20thread.20for.20gcc-lld.html#245218326">(Jul 07 2021 at 17:56)</a>:</h4>
<p>Hi, <span class="user-mention" data-user-id="256342">@bstrie</span> linked me here from github.</p>



<a name="245218422"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/Need%20users/internals%20thread%20for%20gcc-lld/near/245218422" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> bstrie <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/Need.20users.2Finternals.20thread.20for.20gcc-lld.html#245218422">(Jul 07 2021 at 17:57)</a>:</h4>
<p><span class="user-mention" data-user-id="351526">@Kevin Tran</span> thanks for coming! I'm trying to figure out a concrete set of steps that we can have users follow in order to give feedback about the implementation</p>



<a name="245218681"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/Need%20users/internals%20thread%20for%20gcc-lld/near/245218681" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Kevin Tran <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/Need.20users.2Finternals.20thread.20for.20gcc-lld.html#245218681">(Jul 07 2021 at 17:59)</a>:</h4>
<p>I tried compiling with a stage1 toolchain on a pure-Rust project with using the rustflags <code>-Z gcc-ld=lld</code>, which compiled successfully (a bit hard to tell if it's really using lld though). Currently, <code>-Z gcc-ld</code> only supports the option <code>lld</code>, which uses the provided <code>rust-lld</code>, copied into its own path. I built my stage1 toolchain using the "codegen" profile, because otherwise, <code>rust-lld</code> was missing (I think that builds LLVM on my own machine instead of gettiing it from CI?).</p>



<a name="245219595"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/Need%20users/internals%20thread%20for%20gcc-lld/near/245219595" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> bstrie <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/Need.20users.2Finternals.20thread.20for.20gcc-lld.html#245219595">(Jul 07 2021 at 18:06)</a>:</h4>
<p>I want to avoid asking anyone to build rustc themselves. I can confirm that <code>rustc +nightly -Z gcc-ld=lld linktest.rs</code> produces a functioning executable. let me poke around to figure out if I can get confidence that it's actually invoking lld and not ld</p>



<a name="245220043"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/Need%20users/internals%20thread%20for%20gcc-lld/near/245220043" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Gankra <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/Need.20users.2Finternals.20thread.20for.20gcc-lld.html#245220043">(Jul 07 2021 at 18:09)</a>:</h4>
<p>obviously instructions that would work with cargo are ideal -- on macos i seem to get better results using <code>cargo rustc</code> and not <code>RUSTFLAGS</code>, but again, don't have link</p>



<a name="245220051"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/Need%20users/internals%20thread%20for%20gcc-lld/near/245220051" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> simulacrum <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/Need.20users.2Finternals.20thread.20for.20gcc-lld.html#245220051">(Jul 07 2021 at 18:09)</a>:</h4>
<p>I think the official dist builds ship rust-lld in at least some configurations and it should be easy enough to do so in more configurations</p>



<a name="245220053"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/Need%20users/internals%20thread%20for%20gcc-lld/near/245220053" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Gankra <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/Need.20users.2Finternals.20thread.20for.20gcc-lld.html#245220053">(Jul 07 2021 at 18:09)</a>:</h4>
<p>*don't have linux</p>



<a name="245220285"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/Need%20users/internals%20thread%20for%20gcc-lld/near/245220285" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> bstrie <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/Need.20users.2Finternals.20thread.20for.20gcc-lld.html#245220285">(Jul 07 2021 at 18:11)</a>:</h4>
<p>for a hello world I don't mind using rustc directly, less to get in the way. I expect we'll give people a few commands of increasing complexity to run</p>



<a name="245220366"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/Need%20users/internals%20thread%20for%20gcc-lld/near/245220366" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> bstrie <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/Need.20users.2Finternals.20thread.20for.20gcc-lld.html#245220366">(Jul 07 2021 at 18:12)</a>:</h4>
<p>also I only have a debian box right now, but hopefully that's mostly the same as ubuntu</p>



<a name="245220375"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/Need%20users/internals%20thread%20for%20gcc-lld/near/245220375" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Gankra <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/Need.20users.2Finternals.20thread.20for.20gcc-lld.html#245220375">(Jul 07 2021 at 18:12)</a>:</h4>
<p>i was assuming this was solid enough that we'd be more interested in perf numbers for real projects, but fair enough</p>



<a name="245220405"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/Need%20users/internals%20thread%20for%20gcc-lld/near/245220405" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Gankra <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/Need.20users.2Finternals.20thread.20for.20gcc-lld.html#245220405">(Jul 07 2021 at 18:12)</a>:</h4>
<p>yeah probably</p>



<a name="245220473"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/Need%20users/internals%20thread%20for%20gcc-lld/near/245220473" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> bstrie <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/Need.20users.2Finternals.20thread.20for.20gcc-lld.html#245220473">(Jul 07 2021 at 18:13)</a>:</h4>
<p>I know the issues specifies ubuntu but I have no idea what part of this would actually be ubuntu-specific</p>



<a name="245220633"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/Need%20users/internals%20thread%20for%20gcc-lld/near/245220633" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Gankra <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/Need.20users.2Finternals.20thread.20for.20gcc-lld.html#245220633">(Jul 07 2021 at 18:14)</a>:</h4>
<p>the ubuntu constraint is just to give a focus, obviously we want it to work everywhere ultimately</p>



<a name="245220675"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/Need%20users/internals%20thread%20for%20gcc-lld/near/245220675" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Gankra <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/Need.20users.2Finternals.20thread.20for.20gcc-lld.html#245220675">(Jul 07 2021 at 18:14)</a>:</h4>
<p>it's good to see if we work on other distros For Free</p>



<a name="245220690"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/Need%20users/internals%20thread%20for%20gcc-lld/near/245220690" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Kevin Tran <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/Need.20users.2Finternals.20thread.20for.20gcc-lld.html#245220690">(Jul 07 2021 at 18:15)</a>:</h4>
<p><span class="user-mention" data-user-id="256342">@bstrie</span> Testing the nightly toolchain is annoying, since I have to wait for my PR to get merged and the nightly to come out. Is there a way to get a shorter feedback loop?</p>



<a name="245220762"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/Need%20users/internals%20thread%20for%20gcc-lld/near/245220762" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Gankra <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/Need.20users.2Finternals.20thread.20for.20gcc-lld.html#245220762">(Jul 07 2021 at 18:15)</a>:</h4>
<p><span class="user-mention" data-user-id="351526">@Kevin Tran</span> it's fine to test locally like that, but by now that latest nightly should have all your changes</p>



<a name="245220797"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/Need%20users/internals%20thread%20for%20gcc-lld/near/245220797" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> bstrie <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/Need.20users.2Finternals.20thread.20for.20gcc-lld.html#245220797">(Jul 07 2021 at 18:15)</a>:</h4>
<p>Ideally I wouldn't put out a call for testing until we were confident that people would have success using it</p>



<a name="245220867"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/Need%20users/internals%20thread%20for%20gcc-lld/near/245220867" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> bstrie <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/Need.20users.2Finternals.20thread.20for.20gcc-lld.html#245220867">(Jul 07 2021 at 18:16)</a>:</h4>
<p>or if not success, at least interesting failures :)</p>



<a name="245221129"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/Need%20users/internals%20thread%20for%20gcc-lld/near/245221129" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Gankra <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/Need.20users.2Finternals.20thread.20for.20gcc-lld.html#245221129">(Jul 07 2021 at 18:18)</a>:</h4>
<p><span class="user-mention" data-user-id="256342">@bstrie</span> basically the constraint to Ubuntu is for:<br>
A) allowing ourselves to not care about someone with an ancient gcc/clang<br>
B) allowing ourselves to not care about some deeply cursed custom environment<br>
(to start)</p>



<a name="245221274"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/Need%20users/internals%20thread%20for%20gcc-lld/near/245221274" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> bstrie <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/Need.20users.2Finternals.20thread.20for.20gcc-lld.html#245221274">(Jul 07 2021 at 18:19)</a>:</h4>
<p>that's a good point, we should have a predetermined list of questions to ask people who might hit failures, and their gcc version is one of those</p>



<a name="245221371"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/Need%20users/internals%20thread%20for%20gcc-lld/near/245221371" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Gankra <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/Need.20users.2Finternals.20thread.20for.20gcc-lld.html#245221371">(Jul 07 2021 at 18:20)</a>:</h4>
<p>i recommend some kind of list of commands to run upfront -- cargo -V, cc -V, etc</p>



<a name="245223853"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/Need%20users/internals%20thread%20for%20gcc-lld/near/245223853" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Kevin Tran <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/Need.20users.2Finternals.20thread.20for.20gcc-lld.html#245223853">(Jul 07 2021 at 18:37)</a>:</h4>
<p>Unfortunately it seems <code>-Z gcc-ld=lld</code> doesn't work on my machine when I use the current nightly rustup toolchain. A problem is that I'm not actually using Ubuntu, but rather "some deeply cursed custom environment", so it is a bit hard to tell if what I'm doing would actually work on Ubuntu. This effort is my first dive into the guts of rustc, so I'm feeling a bit out of my depth.</p>



<a name="245228007"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/Need%20users/internals%20thread%20for%20gcc-lld/near/245228007" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> bstrie <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/Need.20users.2Finternals.20thread.20for.20gcc-lld.html#245228007">(Jul 07 2021 at 19:08)</a>:</h4>
<p>what's a good way to isolate the link phase for cleaner timing data? have people run <code>cargo check</code> first, then <code>cargo build</code> after?</p>



<a name="245228162"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/Need%20users/internals%20thread%20for%20gcc-lld/near/245228162" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> bjorn3 <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/Need.20users.2Finternals.20thread.20for.20gcc-lld.html#245228162">(Jul 07 2021 at 19:09)</a>:</h4>
<p><code>cargo rustc -- -Ztime-passes | grep run_linker</code> should work.</p>



<a name="245228248"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/Need%20users/internals%20thread%20for%20gcc-lld/near/245228248" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> bjorn3 <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/Need.20users.2Finternals.20thread.20for.20gcc-lld.html#245228248">(Jul 07 2021 at 19:10)</a>:</h4>
<p>with maybe a <code>touch src/main.rs</code> first, so it can be run in a loop.</p>



<a name="245228456"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/Need%20users/internals%20thread%20for%20gcc-lld/near/245228456" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> bjorn3 <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/Need.20users.2Finternals.20thread.20for.20gcc-lld.html#245228456">(Jul 07 2021 at 19:12)</a>:</h4>
<p><code>for i in $(seq 0 10); do touch src/main.rs; cargo rustc -- -Ztime-passes 2&gt;/dev/null | grep run_linker; done</code></p>



<a name="245228900"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/Need%20users/internals%20thread%20for%20gcc-lld/near/245228900" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> bstrie <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/Need.20users.2Finternals.20thread.20for.20gcc-lld.html#245228900">(Jul 07 2021 at 19:16)</a>:</h4>
<p>presumably I can use <code>cargo rustc -- -Z gcc-ld=lld</code>, rather than RUSTFLAGS? I.e. there's no reason that the choice of linker would affect compiling the deps</p>



<a name="245229311"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/Need%20users/internals%20thread%20for%20gcc-lld/near/245229311" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> bstrie <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/Need.20users.2Finternals.20thread.20for.20gcc-lld.html#245229311">(Jul 07 2021 at 19:20)</a>:</h4>
<p>ooh time-passes has fancier output these days</p>



<a name="245231113"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/Need%20users/internals%20thread%20for%20gcc-lld/near/245231113" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> bjorn3 <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/Need.20users.2Finternals.20thread.20for.20gcc-lld.html#245231113">(Jul 07 2021 at 19:33)</a>:</h4>
<p>It would affect build scripts, dylibs and proc-macros, but those aren't measured by my command either.</p>



<a name="245232474"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/Need%20users/internals%20thread%20for%20gcc-lld/near/245232474" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> bstrie <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/Need.20users.2Finternals.20thread.20for.20gcc-lld.html#245232474">(Jul 07 2021 at 19:44)</a>:</h4>
<p>good point, I'd like to make sure we see the impact of e.g. serde usage with lld</p>



<a name="245436084"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/Need%20users/internals%20thread%20for%20gcc-lld/near/245436084" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Kevin Tran <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/Need.20users.2Finternals.20thread.20for.20gcc-lld.html#245436084">(Jul 09 2021 at 12:28)</a>:</h4>
<p>Ok, I've managed to run it on nightly, albeit from a distro package and not from rustup, and compiling a pure-Rust project using cargo works. It's probably just my distro being deeply cursed.</p>
<p>Edit: I made a docker container running debian, and compiling a pure-Rust project seems to work.<br>
Edit: I used inotifywait to check that the bundled lld was being opened during compilation.</p>



<a name="245561718"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/Need%20users/internals%20thread%20for%20gcc-lld/near/245561718" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Kevin Tran <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/Need.20users.2Finternals.20thread.20for.20gcc-lld.html#245561718">(Jul 10 2021 at 17:16)</a>:</h4>
<p>I'm pretty sure it should work, it was just my distro. <span class="user-mention" data-user-id="256342">@bstrie</span> <span class="user-mention" data-user-id="137587">@Gankra</span></p>



<a name="245561740"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/Need%20users/internals%20thread%20for%20gcc-lld/near/245561740" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> bstrie <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/Need.20users.2Finternals.20thread.20for.20gcc-lld.html#245561740">(Jul 10 2021 at 17:17)</a>:</h4>
<p>cool, my goal today is to have a draft of a call to action. I'll post it here for feedback before I actually make the internals/users threads</p>



<a name="246384406"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/Need%20users/internals%20thread%20for%20gcc-lld/near/246384406" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Kevin Tran <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/Need.20users.2Finternals.20thread.20for.20gcc-lld.html#246384406">(Jul 18 2021 at 15:28)</a>:</h4>
<p><span class="user-mention" data-user-id="256342">@bstrie</span> how's the call to action going?</p>



<a name="247812796"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/Need%20users/internals%20thread%20for%20gcc-lld/near/247812796" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Kevin Tran <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/Need.20users.2Finternals.20thread.20for.20gcc-lld.html#247812796">(Jul 31 2021 at 16:24)</a>:</h4>
<p><span class="user-mention" data-user-id="256342">@bstrie</span> Any updates? I've been using <code>-Z gcc-ld=lld</code> on my pure-Rust projects for a bit and everything seems fine.</p>



<a name="247812880"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/Need%20users/internals%20thread%20for%20gcc-lld/near/247812880" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> bstrie <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/Need.20users.2Finternals.20thread.20for.20gcc-lld.html#247812880">(Jul 31 2021 at 16:26)</a>:</h4>
<p>oh sorry yes, this completely fell of my radar! I've been crushed for work, I'm still interested in posting the announcement although I might not get to it for a few days</p>



<a name="250228706"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/Need%20users/internals%20thread%20for%20gcc-lld/near/250228706" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> bstrie <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/Need.20users.2Finternals.20thread.20for.20gcc-lld.html#250228706">(Aug 21 2021 at 17:39)</a>:</h4>
<p><span class="user-mention" data-user-id="351526">@Kevin Tran</span> update: I've been waiting to pursue this until LLVM 13 support landed, and it's just been merged: <a href="https://github.com/rust-lang/rust/pull/87570#issuecomment-903112799">https://github.com/rust-lang/rust/pull/87570#issuecomment-903112799</a> , so as soon as it hits nightly I'll finish up my call to action</p>



<hr><p>Last updated: Apr 12 2022 at 20:01 UTC</p>
</html>