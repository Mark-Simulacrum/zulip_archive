<html>
<head><meta charset="utf-8"><title>RIIR contributor entry point · t-compiler · Zulip Chat Archive</title></head>
<h2>Stream: <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/index.html">t-compiler</a></h2>
<h3>Topic: <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/RIIR.20contributor.20entry.20point.html">RIIR contributor entry point</a></h3>

<hr>

<base href="https://rust-lang.zulipchat.com">

<head><link href="https://zulip-archive.rust-lang.org/style.css" rel="stylesheet"></head>

<a name="209247624"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/RIIR%20contributor%20entry%20point/near/209247624" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jubilee <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/RIIR.20contributor.20entry.20point.html#209247624">(Sep 07 2020 at 00:06)</a>:</h4>
<p>The usual Rust entry point is <code>cargo {build,run,check,test}</code>. rustc's entry point is a Python script. Many Rust devs will already be familiar with Rust workflows, this is not one. People have mentioned removing bootstrap.py entirely as implausible, but if at all possible, the degree to which rustc's entry point can be turned into mostly a Rust workflow would still simplify things, especially for newer contributors.</p>
<p>Splitting out this conversation from the other related threads because it's a specific ergonomics point.</p>



<a name="209247641"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/RIIR%20contributor%20entry%20point/near/209247641" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> simulacrum <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/RIIR.20contributor.20entry.20point.html#209247641">(Sep 07 2020 at 00:07)</a>:</h4>
<p>I am looking into this now.</p>



<a name="209247707"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/RIIR%20contributor%20entry%20point/near/209247707" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jubilee <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/RIIR.20contributor.20entry.20point.html#209247707">(Sep 07 2020 at 00:09)</a>:</h4>
<p>If you need any help lmk~ I'm not exactly a LLVM/CMake specialist but Python is something I can read. <span aria-label="eyes" class="emoji emoji-1f440" role="img" title="eyes">:eyes:</span></p>



<a name="209247877"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/RIIR%20contributor%20entry%20point/near/209247877" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joshua Nelson <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/RIIR.20contributor.20entry.20point.html#209247877">(Sep 07 2020 at 00:15)</a>:</h4>
<p><span class="user-mention silent" data-user-id="116122">simulacrum</span>  is already working on the first step for this <span aria-label="heart" class="emoji emoji-2764" role="img" title="heart">:heart:</span> <a href="https://github.com/rust-lang/rust/pull/76423">https://github.com/rust-lang/rust/pull/76423</a></p>



<a name="209772723"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/RIIR%20contributor%20entry%20point/near/209772723" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> matklad <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/RIIR.20contributor.20entry.20point.html#209772723">(Sep 11 2020 at 12:18)</a>:</h4>
<p><span aria-label="heart eyes" class="emoji emoji-1f60d" role="img" title="heart eyes">:heart_eyes:</span> <span aria-label="heart eyes" class="emoji emoji-1f60d" role="img" title="heart eyes">:heart_eyes:</span> <span aria-label="heart eyes" class="emoji emoji-1f60d" role="img" title="heart eyes">:heart_eyes:</span> </p>
<p>You probably are aware of this, but, just in case, we've been using <a href="https://github.com/matklad/cargo-xtask">https://github.com/matklad/cargo-xtask</a> with great success to manage "custom" bits of build process in rust-analyzer.</p>



<a name="209774184"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/RIIR%20contributor%20entry%20point/near/209774184" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> simulacrum <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/RIIR.20contributor.20entry.20point.html#209774184">(Sep 11 2020 at 12:33)</a>:</h4>
<p>yeah I think something like xtask is feasible for rustbuild to use, or at least the pattern</p>



<a name="275223500"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/RIIR%20contributor%20entry%20point/near/275223500" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joshua Nelson <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/RIIR.20contributor.20entry.20point.html#275223500">(Mar 14 2022 at 11:34)</a>:</h4>
<p>I am working on this: <a href="https://github.com/rust-lang/rust/issues/94829">https://github.com/rust-lang/rust/issues/94829</a></p>



<a name="275223762"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/RIIR%20contributor%20entry%20point/near/275223762" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joshua Nelson <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/RIIR.20contributor.20entry.20point.html#275223762">(Mar 14 2022 at 11:37)</a>:</h4>
<p>one thing <span class="user-mention silent" data-user-id="116015">Alex Crichton</span> mentioned in the original PR is that this leads to duplicate code between <code>bootstrap.py</code> and rustbuild. I wonder if eventually, we can remove the <code>config.toml</code> autodetection from bootstrap.py and require you to pass <code>--config</code> and <code>--build</code> explicitly</p>



<a name="275223866"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/RIIR%20contributor%20entry%20point/near/275223866" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joshua Nelson <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/RIIR.20contributor.20entry.20point.html#275223866">(Mar 14 2022 at 11:38)</a>:</h4>
<p>I don't think there should be much other shared code other than the logic to download a rust toolchain, which is kind of already contorted in bootstrap.py because it handles both the beta / bootstrap compiler and <code>download-rustc</code></p>



<a name="275223906"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/RIIR%20contributor%20entry%20point/near/275223906" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joshua Nelson <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/RIIR.20contributor.20entry.20point.html#275223906">(Mar 14 2022 at 11:39)</a>:</h4>
<p><span class="user-mention silent" data-user-id="232545">Joshua Nelson</span> <a href="#narrow/stream/131828-t-compiler/topic/RIIR.20contributor.20entry.20point/near/275223762">said</a>:</p>
<blockquote>
<p>one thing <span class="user-mention silent" data-user-id="116015">Alex Crichton</span> mentioned in the original PR is that this leads to duplicate code between <code>bootstrap.py</code> and rustbuild. I wonder if eventually, we can remove the <code>config.toml</code> autodetection from bootstrap.py and require you to pass <code>--config</code> and <code>--build</code> explicitly</p>
</blockquote>
<p>another <em>very</em> long-term goal I have is to remove x.py altogether and have distros go through <code>bootstrap.py</code> directly</p>



<a name="275236817"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/RIIR%20contributor%20entry%20point/near/275236817" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> simulacrum <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/RIIR.20contributor.20entry.20point.html#275236817">(Mar 14 2022 at 13:43)</a>:</h4>
<p>I am not too worried about duplicate code fwiw</p>



<a name="275236950"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/RIIR%20contributor%20entry%20point/near/275236950" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> simulacrum <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/RIIR.20contributor.20entry.20point.html#275236950">(Mar 14 2022 at 13:44)</a>:</h4>
<p>I think in the long term my expectation is that we will ship the bootstrap binary prebuilt, which is not itself really in need of configuration, which means that bootstrap.py will just be build triple detection + download of that binary and then immediate execution; perhaps ignoring any configured build triple at that point (just --build perhaps).</p>



<a name="275237047"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/RIIR%20contributor%20entry%20point/near/275237047" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> bstrie <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/RIIR.20contributor.20entry.20point.html#275237047">(Mar 14 2022 at 13:45)</a>:</h4>
<p>I thought the whole point of using a non-Rust language for bootstrapping was to make it easier to bootstrap Rust to a brand-new platform for the first time?</p>



<a name="275237644"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/RIIR%20contributor%20entry%20point/near/275237644" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> bjorn3 <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/RIIR.20contributor.20entry.20point.html#275237644">(Mar 14 2022 at 13:49)</a>:</h4>
<p>Rustbuild is useless without a rustc for the same triple. If you manage to get rustc work you probably have also implemented enough of libstd for rustbuild to work. (except maybe the code in rustbuild to set mtime)</p>



<a name="275241918"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/RIIR%20contributor%20entry%20point/near/275241918" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joshua Nelson <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/RIIR.20contributor.20entry.20point.html#275241918">(Mar 14 2022 at 14:19)</a>:</h4>
<p><span class="user-mention silent" data-user-id="256342">bstrie</span> <a href="#narrow/stream/131828-t-compiler/topic/RIIR.20contributor.20entry.20point/near/275237047">said</a>:</p>
<blockquote>
<p>I thought the whole point of using a non-Rust language for bootstrapping was to make it easier to bootstrap Rust to a brand-new platform for the first time?</p>
</blockquote>
<p>The point is to make it possible for distros to build rust without a pre-existing host toolchain. Like <span class="user-mention silent" data-user-id="133247">bjorn3</span> said, rustbuild depends on libstd and you can't build it unless you already have a working cross-compile toolchain.</p>



<a name="275242505"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/RIIR%20contributor%20entry%20point/near/275242505" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joshua Nelson <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/RIIR.20contributor.20entry.20point.html#275242505">(Mar 14 2022 at 14:23)</a>:</h4>
<p>CI also needs the same logic I think</p>



<a name="275254141"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/RIIR%20contributor%20entry%20point/near/275254141" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Triplett <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/RIIR.20contributor.20entry.20point.html#275254141">(Mar 14 2022 at 15:40)</a>:</h4>
<p><span class="user-mention" data-user-id="232545">@Joshua Nelson</span> I saw that PR and I'm really excited for this work! Thank you for working on it.</p>



<a name="275972232"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/RIIR%20contributor%20entry%20point/near/275972232" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joshua Nelson <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/RIIR.20contributor.20entry.20point.html#275972232">(Mar 20 2022 at 15:26)</a>:</h4>
<p>if anyone wants to help, I mentioned some easily parallelizable issues on <a href="#narrow/stream/122652-new-members/topic/Help.20with.20RRIR.20bootstrap.20entrypoint">https://rust-lang.zulipchat.com/#narrow/stream/122652-new-members/topic/Help.20with.20RRIR.20bootstrap.20entrypoint</a>. Not all are <em>easy</em> but most shouldn't require too much background knowledge of bootstrap.</p>



<a name="275972364"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/RIIR%20contributor%20entry%20point/near/275972364" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joshua Nelson <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/RIIR.20contributor.20entry.20point.html#275972364">(Mar 20 2022 at 15:28)</a>:</h4>
<p>the "file locking" bit especially is very much domain knowledge unrelated to rust and I would <em>love</em> if someone were willing to help out</p>



<hr><p>Last updated: Apr 12 2022 at 20:01 UTC</p>
</html>