<html>
<head><meta charset="utf-8"><title>(1.54.0) PowerPC Target under OpenWrt · t-compiler · Zulip Chat Archive</title></head>
<h2>Stream: <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/index.html">t-compiler</a></h2>
<h3>Topic: <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/(1.2E54.2E0).20PowerPC.20Target.20under.20OpenWrt.html">(1.54.0) PowerPC Target under OpenWrt</a></h3>

<hr>

<base href="https://rust-lang.zulipchat.com">

<head><link href="https://zulip-archive.rust-lang.org/style.css" rel="stylesheet"></head>

<a name="251679459"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/%281.54.0%29%20PowerPC%20Target%20under%20OpenWrt/near/251679459" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grommish <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/(1.2E54.2E0).20PowerPC.20Target.20under.20OpenWrt.html#251679459">(Sep 02 2021 at 08:02)</a>:</h4>
<p>I'm receiving error while building  a custom <code>powerpc-openwrt-linux-musl</code> target, defined by duplicating the existing <code>powerpc-unknown-linux-musl</code> and adding the choice to <code>mod.rs</code></p>
<div class="codehilite"><pre><span></span><code>running: &quot;powerpc-openwrt-linux-musl-gcc-ar&quot; &quot;s&quot; &quot;/home/grommish/openwrt/build_dir/hostpkg/rust-1.54.0/build/powerpc-openwrt-linux-musl/native/crt/libcrt.a&quot;
exit status: 0
Building stage2 std artifacts (x86_64-unknown-linux-gnu -&gt; powerpc-openwrt-linux-musl)
   Compiling cc v1.0.68
   Compiling core v0.0.0 (/home/grommish/openwrt/build_dir/hostpkg/rust-1.54.0/library/core)
   Compiling libc v0.2.93
   Compiling std v0.0.0 (/home/grommish/openwrt/build_dir/hostpkg/rust-1.54.0/library/std)
   Compiling compiler_builtins v0.1.45
   Compiling unwind v0.0.0 (/home/grommish/openwrt/build_dir/hostpkg/rust-1.54.0/library/unwind)
The following warnings were emitted during compilation:

warning: /home/grommish/openwrt/build_dir/hostpkg/rust-1.54.0/src/llvm-project/libunwind/src/libunwind.cpp:68:3: error: #error Architecture not supported
warning:    68 | # error Architecture not supported
warning:       |   ^~~~~
warning: /home/grommish/openwrt/build_dir/hostpkg/rust-1.54.0/src/llvm-project/libunwind/src/libunwind.cpp: In function &#39;int __unw_init_local(unw_cursor_t*, unw_context_t*)&#39;:
warning: /home/grommish/openwrt/build_dir/hostpkg/rust-1.54.0/src/llvm-project/libunwind/src/libunwind.cpp:71:57: error: &#39;REGISTER_KIND&#39; was not declared in this scope
warning:    71 |   new (reinterpret_cast&lt;UnwindCursor&lt;LocalAddressSpace, REGISTER_KIND&gt; *&gt;(cursor))
warning:       |                                                         ^~~~~~~~~~~~~
warning: /home/grommish/openwrt/build_dir/hostpkg/rust-1.54.0/src/llvm-project/libunwind/src/libunwind.cpp:71:70: error: template argument 2 is invalid
warning:    71 |   new (reinterpret_cast&lt;UnwindCursor&lt;LocalAddressSpace, REGISTER_KIND&gt; *&gt;(cursor))
warning:       |                                                                      ^
warning: /home/grommish/openwrt/build_dir/hostpkg/rust-1.54.0/src/llvm-project/libunwind/src/libunwind.cpp:71:8: error: expected type-specifier before &#39;reinterpret_cast&#39;
warning:    71 |   new (reinterpret_cast&lt;UnwindCursor&lt;LocalAddressSpace, REGISTER_KIND&gt; *&gt;(cursor))
warning:       |        ^~~~~~~~~~~~~~~~
warning: /home/grommish/openwrt/build_dir/hostpkg/rust-1.54.0/src/llvm-project/libunwind/src/libunwind.cpp:71:8: error: expected &#39;)&#39; before &#39;reinterpret_cast&#39;
warning:    71 |   new (reinterpret_cast&lt;UnwindCursor&lt;LocalAddressSpace, REGISTER_KIND&gt; *&gt;(cursor))
warning:       |       ~^~~~~~~~~~~~~~~~
warning:       |        )

error: failed to run custom build command for `unwind v0.0.0 (/home/grommish/openwrt/build_dir/hostpkg/rust-1.54.0/library/unwind)`

Caused by:
  process didn&#39;t exit successfully: `/home/grommish/openwrt/build_dir/hostpkg/rust-1.54.0/build/x86_64-unknown-linux-gnu/stage2-std/release/build/unwind-17b01f67d6d12a0e/build-script-build` (exit status: 1)
  --- stdout
  cargo:rerun-if-changed=build.rs
  OPT_LEVEL = Some(&quot;3&quot;)
  TARGET = Some(&quot;powerpc-openwrt-linux-musl&quot;)
  HOST = Some(&quot;x86_64-unknown-linux-gnu&quot;)
  CXX_powerpc-openwrt-linux-musl = Some(&quot;ccache powerpc-openwrt-linux-musl-g++&quot;)
  CXXFLAGS_powerpc-openwrt-linux-musl = Some(&quot;-ffunction-sections -fdata-sections -fPIC -static&quot;)
  CRATE_CC_NO_DEFAULTS = None
  DEBUG = Some(&quot;false&quot;)
  CARGO_CFG_TARGET_FEATURE = None
  CXX_powerpc-openwrt-linux-musl = Some(&quot;ccache powerpc-openwrt-linux-musl-g++&quot;)
  CXXFLAGS_powerpc-openwrt-linux-musl = Some(&quot;-ffunction-sections -fdata-sections -fPIC -static&quot;)
  CRATE_CC_NO_DEFAULTS = None
  CARGO_CFG_TARGET_FEATURE = None
  cargo:rustc-link-search=native=/home/grommish/openwrt/build_dir/hostpkg/rust-1.54.0/build/x86_64-unknown-linux-gnu/stage2-std/powerpc-openwrt-linux-musl/release/build/unwind-0ce7447c01c4f530/out
  running: &quot;ccache&quot; &quot;powerpc-openwrt-linux-musl-gcc&quot; &quot;-O3&quot; &quot;-ffunction-sections&quot; &quot;-fdata-sections&quot; &quot;-fPIC&quot; &quot;-ffunction-sections&quot; &quot;-fdata-sections&quot; &quot;-fPIC&quot; &quot;-static&quot; &quot;-I&quot; &quot;../../src/llvm-project/libunwind/include&quot; &quot;-nostdinc++&quot; &quot;-fno-exceptions&quot; &quot;-fno-rtti&quot; &quot;-std=c++11&quot; &quot;-fstrict-aliasing&quot; &quot;-funwind-tables&quot; &quot;-fvisibility=hidden&quot; &quot;-D_LIBUNWIND_DISABLE_VISIBILITY_ANNOTATIONS&quot; &quot;-o&quot; &quot;/home/grommish/openwrt/build_dir/hostpkg/rust-1.54.0/build/x86_64-unknown-linux-gnu/stage2-std/powerpc-openwrt-linux-musl/release/build/unwind-0ce7447c01c4f530/out/Unwind-EHABI.o&quot; &quot;-c&quot; &quot;/home/grommish/openwrt/build_dir/hostpkg/rust-1.54.0/src/llvm-project/libunwind/src/Unwind-EHABI.cpp&quot;
  exit status: 0
</code></pre></div>
<p>The last time <code>powerpc-unknown-linux-musl.rs</code> was changed was in March (prior to the 1.54 versioning) to remove unwrap (<a href="https://github.com/rust-lang/rust/commit/049a49b91151a88c95fa0d62a53fd0a0ac2c3af9">https://github.com/rust-lang/rust/commit/049a49b91151a88c95fa0d62a53fd0a0ac2c3af9</a>) but I've not seen anything since.</p>
<p>Any hints?</p>



<a name="251689540"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/%281.54.0%29%20PowerPC%20Target%20under%20OpenWrt/near/251689540" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nagisa <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/(1.2E54.2E0).20PowerPC.20Target.20under.20OpenWrt.html#251689540">(Sep 02 2021 at 09:36)</a>:</h4>
<p><a href="https://github.com/llvm-mirror/libunwind/blob/3e6ec2ae9afaa3683269b690612f84d907943ea2/src/libunwind.cpp#L39-L63">https://github.com/llvm-mirror/libunwind/blob/3e6ec2ae9afaa3683269b690612f84d907943ea2/src/libunwind.cpp#L39-L63</a></p>



<a name="251689590"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/%281.54.0%29%20PowerPC%20Target%20under%20OpenWrt/near/251689590" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nagisa <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/(1.2E54.2E0).20PowerPC.20Target.20under.20OpenWrt.html#251689590">(Sep 02 2021 at 09:37)</a>:</h4>
<p>looks like your C/C++ toolchain may be failing to define one of these?</p>



<a name="251954727"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/%281.54.0%29%20PowerPC%20Target%20under%20OpenWrt/near/251954727" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grommish <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/(1.2E54.2E0).20PowerPC.20Target.20under.20OpenWrt.html#251954727">(Sep 03 2021 at 23:28)</a>:</h4>
<p>It's possible, but OpenWrt doesn't use LLVM.  That's pulled in by the repo, and x.py kicks off the entire thing (including the cmake calls).  I need to pass a <code>-D__ppc__</code> it seems, but it needs to go to rust's invoke of cmake.  Is there a place to put that either on the CLI invoke of configure/x.py or in the config.toml?  I'm logging out the entire thing so i'll have that when it's finished.  I never expected PowerPC to be an issue when the other ones have gone so well.  I'll check back in shortly</p>



<a name="251955727"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/%281.54.0%29%20PowerPC%20Target%20under%20OpenWrt/near/251955727" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joshua Nelson <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/(1.2E54.2E0).20PowerPC.20Target.20under.20OpenWrt.html#251955727">(Sep 03 2021 at 23:42)</a>:</h4>
<p>it will be annoying, but you could set <code>cc</code> to a shell script that defines <code>-D__ppc__</code> and then invokes gcc/clang</p>



<a name="251955888"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/%281.54.0%29%20PowerPC%20Target%20under%20OpenWrt/near/251955888" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grommish <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/(1.2E54.2E0).20PowerPC.20Target.20under.20OpenWrt.html#251955888">(Sep 03 2021 at 23:45)</a>:</h4>
<p>I'm not sure I can inside the build environment, because I'm already trying to add the <code>-D__ppc__</code> with the mechanisms it has <code>TARGET_CFLAGS/TARGET_CXX_FLAGS/CMAKE_HOST_OPTIONS/CMAKE_OPTIONS</code> and it doesn't get passed to the cmake call rust uses internally</p>



<a name="251961458"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/%281.54.0%29%20PowerPC%20Target%20under%20OpenWrt/near/251961458" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grommish <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/(1.2E54.2E0).20PowerPC.20Target.20under.20OpenWrt.html#251961458">(Sep 04 2021 at 01:14)</a>:</h4>
<p>Ah, so, it it's a known issue, or was.. <span class="user-mention" data-user-id="232545">@Joshua Nelson</span> Is there anyway to tell if this was ever fixed? <a href="https://github.com/rust-lang/rust/pull/45422">https://github.com/rust-lang/rust/pull/45422</a></p>



<a name="251961571"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/%281.54.0%29%20PowerPC%20Target%20under%20OpenWrt/near/251961571" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joshua Nelson <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/(1.2E54.2E0).20PowerPC.20Target.20under.20OpenWrt.html#251961571">(Sep 04 2021 at 01:16)</a>:</h4>
<p>I don't know what specifically you're asking about, but I found this gem:</p>
<blockquote>
<p>GCC and clang both seem to define __PPC__ here; the uncapital ones typically vary between version and compiler.</p>
</blockquote>
<p>I think it would be reasonable to change libunwind to check for the caps version</p>



<a name="251961591"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/%281.54.0%29%20PowerPC%20Target%20under%20OpenWrt/near/251961591" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grommish <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/(1.2E54.2E0).20PowerPC.20Target.20under.20OpenWrt.html#251961591">(Sep 04 2021 at 01:17)</a>:</h4>
<p>The issue is I can't just change the LLVM repo that Rust is pulling and call it good :(</p>



<a name="251961655"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/%281.54.0%29%20PowerPC%20Target%20under%20OpenWrt/near/251961655" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grommish <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/(1.2E54.2E0).20PowerPC.20Target.20under.20OpenWrt.html#251961655">(Sep 04 2021 at 01:18)</a>:</h4>
<p>I need to be able to have repeatable builds across the OpenWrt build-set.. Altering the source for the LLVM that gets pulled in when the rust-lang repo is cloned isn't going to work</p>



<a name="251961675"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/%281.54.0%29%20PowerPC%20Target%20under%20OpenWrt/near/251961675" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joshua Nelson <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/(1.2E54.2E0).20PowerPC.20Target.20under.20OpenWrt.html#251961675">(Sep 04 2021 at 01:18)</a>:</h4>
<p>Does openwrt not already have llvm packaged?</p>



<a name="251961683"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/%281.54.0%29%20PowerPC%20Target%20under%20OpenWrt/near/251961683" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joshua Nelson <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/(1.2E54.2E0).20PowerPC.20Target.20under.20OpenWrt.html#251961683">(Sep 04 2021 at 01:18)</a>:</h4>
<p>Most distros use system llvm instead of building it again from source</p>



<a name="251961715"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/%281.54.0%29%20PowerPC%20Target%20under%20OpenWrt/near/251961715" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grommish <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/(1.2E54.2E0).20PowerPC.20Target.20under.20OpenWrt.html#251961715">(Sep 04 2021 at 01:19)</a>:</h4>
<p>No, it doesn't (GCC MUSL toolchain).  I have to incorporate everything into the build system without relying on the build host :(</p>



<a name="251961790"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/%281.54.0%29%20PowerPC%20Target%20under%20OpenWrt/near/251961790" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joshua Nelson <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/(1.2E54.2E0).20PowerPC.20Target.20under.20OpenWrt.html#251961790">(Sep 04 2021 at 01:20)</a>:</h4>
<p>Seems like an odd requirement, but sure. I think passing CMAKE_OPTIONS through to cmake would also be a reasonable fix</p>



<a name="251961806"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/%281.54.0%29%20PowerPC%20Target%20under%20OpenWrt/near/251961806" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grommish <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/(1.2E54.2E0).20PowerPC.20Target.20under.20OpenWrt.html#251961806">(Sep 04 2021 at 01:21)</a>:</h4>
<p>I may just not be able to support PPC Rust-lang.  There aren't too many targets.  I've got mips, mipsel, mips64, armv7, aarch, x86_64 working so far</p>



<a name="251961821"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/%281.54.0%29%20PowerPC%20Target%20under%20OpenWrt/near/251961821" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grommish <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/(1.2E54.2E0).20PowerPC.20Target.20under.20OpenWrt.html#251961821">(Sep 04 2021 at 01:21)</a>:</h4>
<p>I tried that, didn't work.. whatever x.py is doing to call the build also controls the cmake options</p>



<a name="251961830"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/%281.54.0%29%20PowerPC%20Target%20under%20OpenWrt/near/251961830" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joshua Nelson <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/(1.2E54.2E0).20PowerPC.20Target.20under.20OpenWrt.html#251961830">(Sep 04 2021 at 01:21)</a>:</h4>
<p><span aria-label="shrug" class="emoji emoji-1f937" role="img" title="shrug">:shrug:</span> I don't think it would be hard to change x.py</p>



<a name="251961884"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/%281.54.0%29%20PowerPC%20Target%20under%20OpenWrt/near/251961884" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joshua Nelson <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/(1.2E54.2E0).20PowerPC.20Target.20under.20OpenWrt.html#251961884">(Sep 04 2021 at 01:22)</a>:</h4>
<p>The code would be somewhere in src/bootstrap/native.rs</p>



<a name="251961897"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/%281.54.0%29%20PowerPC%20Target%20under%20OpenWrt/near/251961897" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grommish <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/(1.2E54.2E0).20PowerPC.20Target.20under.20OpenWrt.html#251961897">(Sep 04 2021 at 01:22)</a>:</h4>
<p>Oh, I don't program/code in rust or any other language..  :D</p>



<a name="251961913"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/%281.54.0%29%20PowerPC%20Target%20under%20OpenWrt/near/251961913" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grommish <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/(1.2E54.2E0).20PowerPC.20Target.20under.20OpenWrt.html#251961913">(Sep 04 2021 at 01:23)</a>:</h4>
<p>Is there a way to pass it at the command line?</p>



<a name="251961933"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/%281.54.0%29%20PowerPC%20Target%20under%20OpenWrt/near/251961933" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grommish <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/(1.2E54.2E0).20PowerPC.20Target.20under.20OpenWrt.html#251961933">(Sep 04 2021 at 01:23)</a>:</h4>
<p>can I do a <code>CMAKE_OPTIONS=-D__ppc__ x..py ...</code>?</p>



<a name="251961941"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/%281.54.0%29%20PowerPC%20Target%20under%20OpenWrt/near/251961941" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joshua Nelson <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/(1.2E54.2E0).20PowerPC.20Target.20under.20OpenWrt.html#251961941">(Sep 04 2021 at 01:23)</a>:</h4>
<p>You could try</p>



<a name="251962105"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/%281.54.0%29%20PowerPC%20Target%20under%20OpenWrt/near/251962105" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grommish <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/(1.2E54.2E0).20PowerPC.20Target.20under.20OpenWrt.html#251962105">(Sep 04 2021 at 01:26)</a>:</h4>
<div class="codehilite"><pre><span></span><code>CMAKE_OPTIONS=&quot;-D__ppc__&quot; $(PYTHON) x.py --config ./config.toml dist cargo extended \
          library/std llvm-tools miri
</code></pre></div>
<p>?</p>



<a name="251962153"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/%281.54.0%29%20PowerPC%20Target%20under%20OpenWrt/near/251962153" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grommish <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/(1.2E54.2E0).20PowerPC.20Target.20under.20OpenWrt.html#251962153">(Sep 04 2021 at 01:27)</a>:</h4>
<div class="codehilite"><pre><span></span><code>  error occurred: Command &quot;ccache&quot; &quot;powerpc-openwrt-linux-musl-gcc&quot; &quot;-O3&quot; &quot;-ffunction-sections&quot; &quot;-fdata-sections&quot; &quot;-fPIC&quot; &quot;-ffunction-sections&quot; &quot;-fdata-sections&quot; &quot;-fPIC&quot; &quot;-static&quot; &quot;-I&quot; &quot;../../src/llvm-project/libunwind/include&quot; &quot;-nostdinc++&quot; &quot;-fno-exceptions&quot; &quot;-fno-rtti&quot; &quot;-std=c++11&quot; &quot;-fstrict-aliasing&quot; &quot;-funwind-tables&quot; &quot;-fvisibility=hidden&quot; &quot;-D_LIBUNWIND_DISABLE_VISIBILITY_ANNOTATIONS&quot; &quot;-o&quot; &quot;/home/grommish/openwrt/build_dir/hostpkg/rust-1.54.0/build/x86_64-unknown-linux-gnu/stage2-std/powerpc-openwrt-linux-musl/release/build/unwind-0ce7447c01c4f530/out/libunwind.o&quot; &quot;-c&quot; &quot;/home/grommish/openwrt/build_dir/hostpkg/rust-1.54.0/src/llvm-project/libunwind/src/libunwind.cpp&quot; with args &quot;powerpc-openwrt-linux-musl-gcc&quot; did not execute successfully (status code exit status: 1).
</code></pre></div>
<p>See, Those Cmake Invokes are internal.  Was waiting for it to fail :) I'll try the above</p>



<a name="252068811"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/%281.54.0%29%20PowerPC%20Target%20under%20OpenWrt/near/252068811" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grommish <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/(1.2E54.2E0).20PowerPC.20Target.20under.20OpenWrt.html#252068811">(Sep 05 2021 at 11:03)</a>:</h4>
<p>Well.. That didn't work.. I really don't want to have to edit the LLVM source to make this work properly.. That will add a level of patching on top of everything else.  Is there a way to set something like an EXTRA_CFLAGS in ./configure --options?</p>



<a name="252079942"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/%281.54.0%29%20PowerPC%20Target%20under%20OpenWrt/near/252079942" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joshua Nelson <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/(1.2E54.2E0).20PowerPC.20Target.20under.20OpenWrt.html#252079942">(Sep 05 2021 at 14:24)</a>:</h4>
<p>uhhh looks like yes actually</p>
<div class="codehilite"><pre><span></span><code>$ grep -i cflags src/bootstrap/configure.py
v(&quot;llvm-cflags&quot;, &quot;llvm.cflags&quot;, &quot;build LLVM with these extra compiler flags&quot;)
</code></pre></div>



<a name="262838996"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/%281.54.0%29%20PowerPC%20Target%20under%20OpenWrt/near/262838996" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jubilee <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/(1.2E54.2E0).20PowerPC.20Target.20under.20OpenWrt.html#262838996">(Nov 26 2021 at 22:24)</a>:</h4>
<p><code>rustc-dev</code> is for the compiler libraries, I believe.<br>
You should probably distribute at least what rustup considers the default profile:<br>
<a href="https://rust-lang.github.io/rustup/concepts/profiles.html">https://rust-lang.github.io/rustup/concepts/profiles.html</a></p>



<a name="262840721"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/%281.54.0%29%20PowerPC%20Target%20under%20OpenWrt/near/262840721" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> The 8472 <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/(1.2E54.2E0).20PowerPC.20Target.20under.20OpenWrt.html#262840721">(Nov 26 2021 at 22:59)</a>:</h4>
<p>In addition to minimal/default profiles rust-src may also be relevant for embedded so that the nightly <code>build-std</code>feature works.</p>



<a name="262847562"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/%281.54.0%29%20PowerPC%20Target%20under%20OpenWrt/near/262847562" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grommish <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/(1.2E54.2E0).20PowerPC.20Target.20under.20OpenWrt.html#262847562">(Nov 27 2021 at 01:49)</a>:</h4>
<p>For now, this is for Cross-compiling only.  Most of the SOCs on embedded devices are considered, at minimum, limited because of LLVM support not being available or just not being supported by rust-lang.  At this point, I'm not looking to put <code>rustc</code> or <code>cargo</code> on device to allow them to natively compile rust programs on a router.  That might come later if the support becomes available.  Although I tend to treat Openwrt as an Embedded OS rather than just router firmware, so I do have provisions for installing those artifacts down the line</p>



<hr><p>Last updated: Apr 12 2022 at 20:01 UTC</p>
</html>