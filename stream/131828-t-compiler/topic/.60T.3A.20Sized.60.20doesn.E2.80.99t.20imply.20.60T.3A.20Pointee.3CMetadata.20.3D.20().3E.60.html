<html>
<head><meta charset="utf-8"><title>`T: Sized` doesn’t imply `T: Pointee&lt;Metadata = ()&gt;` · t-compiler · Zulip Chat Archive</title></head>
<h2>Stream: <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/index.html">t-compiler</a></h2>
<h3>Topic: <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/.60T.3A.20Sized.60.20doesn.E2.80.99t.20imply.20.60T.3A.20Pointee.3CMetadata.20.3D.20().3E.60.html">`T: Sized` doesn’t imply `T: Pointee&lt;Metadata = ()&gt;`</a></h3>

<hr>

<base href="https://rust-lang.zulipchat.com">

<head><link href="https://zulip-archive.rust-lang.org/style.css" rel="stylesheet"></head>

<a name="271761557"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/%60T%3A%20Sized%60%20doesn%E2%80%99t%20imply%20%60T%3A%20Pointee%3CMetadata%20%3D%20%28%29%3E%60/near/271761557" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Simon Sapin <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/.60T.3A.20Sized.60.20doesn.E2.80.99t.20imply.20.60T.3A.20Pointee.3CMetadata.20.3D.20().3E.60.html#271761557">(Feb 13 2022 at 19:38)</a>:</h4>
<p>Hello. <a href="https://github.com/rust-lang/rust/pull/81172">https://github.com/rust-lang/rust/pull/81172</a> implemented the pointer metadata RFC so that the <code>Pointee</code>trait is always implemented for all types (similar to <code>DiscriminantKind</code>). When asked for <code>&lt;T as Pointee&gt;::Metadata</code>, there’s compiler code that resolves it to <code>()</code> if <code>T: Sized</code>. However a <code>T: Pointee&lt;Metadata=()&gt;</code> bound (a.k.a. <code>T: Thin</code>) does not seem to hold automatically in generic contexts that have <code>T: Sized</code> <a href="https://github.com/rust-lang/rust/issues/93959#issuecomment-1038374128">https://github.com/rust-lang/rust/issues/93959#issuecomment-1038374128</a> Could/should that be changed with more compiler magic?</p>



<a name="271761576"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/%60T%3A%20Sized%60%20doesn%E2%80%99t%20imply%20%60T%3A%20Pointee%3CMetadata%20%3D%20%28%29%3E%60/near/271761576" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Simon Sapin <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/.60T.3A.20Sized.60.20doesn.E2.80.99t.20imply.20.60T.3A.20Pointee.3CMetadata.20.3D.20().3E.60.html#271761576">(Feb 13 2022 at 19:39)</a>:</h4>
<p>Should we even have <code>pub trait Sized: Thin {}</code> ?</p>



<a name="271761736"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/%60T%3A%20Sized%60%20doesn%E2%80%99t%20imply%20%60T%3A%20Pointee%3CMetadata%20%3D%20%28%29%3E%60/near/271761736" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Simon Sapin <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/.60T.3A.20Sized.60.20doesn.E2.80.99t.20imply.20.60T.3A.20Pointee.3CMetadata.20.3D.20().3E.60.html#271761736">(Feb 13 2022 at 19:43)</a>:</h4>
<p>(Simply adding that in <code>core</code> is not enough: <a href="https://github.com/rust-lang/rust/issues/93959#issuecomment-1038374128">https://github.com/rust-lang/rust/issues/93959#issuecomment-1038374128</a>)</p>



<a name="271764567"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/%60T%3A%20Sized%60%20doesn%E2%80%99t%20imply%20%60T%3A%20Pointee%3CMetadata%20%3D%20%28%29%3E%60/near/271764567" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Michael Goulet (compiler-errors) <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/.60T.3A.20Sized.60.20doesn.E2.80.99t.20imply.20.60T.3A.20Pointee.3CMetadata.20.3D.20().3E.60.html#271764567">(Feb 13 2022 at 20:45)</a>:</h4>
<blockquote>
<p>does not seem to hold automatically in generic contexts that have <code>T: Sized</code></p>
</blockquote>
<p>Might be fixed by adding some more logic to <code>confirm_pointee_candidate</code> in <code>rustc_trait_selection::traits::project</code>.</p>



<a name="271768109"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/%60T%3A%20Sized%60%20doesn%E2%80%99t%20imply%20%60T%3A%20Pointee%3CMetadata%20%3D%20%28%29%3E%60/near/271768109" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Michael Goulet (compiler-errors) <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/.60T.3A.20Sized.60.20doesn.E2.80.99t.20imply.20.60T.3A.20Pointee.3CMetadata.20.3D.20().3E.60.html#271768109">(Feb 13 2022 at 22:07)</a>:</h4>
<p><span class="user-mention" data-user-id="219747">@Simon Sapin</span> I think I have a working branch that satisfies <code>T: Pointee&lt;Metadata = ()&gt;</code> if <code>T: Sized</code>. Let me put up a PR.</p>



<a name="271768163"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/%60T%3A%20Sized%60%20doesn%E2%80%99t%20imply%20%60T%3A%20Pointee%3CMetadata%20%3D%20%28%29%3E%60/near/271768163" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Simon Sapin <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/.60T.3A.20Sized.60.20doesn.E2.80.99t.20imply.20.60T.3A.20Pointee.3CMetadata.20.3D.20().3E.60.html#271768163">(Feb 13 2022 at 22:08)</a>:</h4>
<p>Nice, thanks!</p>



<hr><p>Last updated: Apr 12 2022 at 20:01 UTC</p>
</html>