<html>
<head><meta charset="utf-8"><title>excessive disk usage · t-compiler · Zulip Chat Archive</title></head>
<h2>Stream: <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/index.html">t-compiler</a></h2>
<h3>Topic: <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/excessive.20disk.20usage.html">excessive disk usage</a></h3>

<hr>

<base href="https://rust-lang.zulipchat.com">

<head><link href="https://zulip-archive.rust-lang.org/style.css" rel="stylesheet"></head>

<a name="191661450"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/excessive%20disk%20usage/near/191661450" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/excessive.20disk.20usage.html#191661450">(Mar 24 2020 at 19:32)</a>:</h4>
<p>Has anybody looked into what exactly causes us to use <em>so much disk space</em> when building rustc?</p>
<div class="codehilite"><pre><span></span>&gt; du -h -s rust-*
25G     rust-0
12G     rust-1
29G     rust-2
57G     rust-3
46G     rust-4
21G     rust-5
15G     rust-6
</pre></div>



<a name="191661481"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/excessive%20disk%20usage/near/191661481" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/excessive.20disk.20usage.html#191661481">(Mar 24 2020 at 19:33)</a>:</h4>
<p>it seems a bit wild that I regularly run out of disk space on my linux desktop, even though it is quite old and the disk admittedly "only" 512GB or something</p>



<a name="191661544"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/excessive%20disk%20usage/near/191661544" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/excessive.20disk.20usage.html#191661544">(Mar 24 2020 at 19:33)</a>:</h4>
<p>/me tempted to talk about the days of floppy disks and "kids today not appreciated what they have"</p>



<a name="191661629"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/excessive%20disk%20usage/near/191661629" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jonas Schievink  [he/him] <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/excessive.20disk.20usage.html#191661629">(Mar 24 2020 at 19:34)</a>:</h4>
<p>Is that with debuginfo enabled? That tends to take a lot of space</p>



<a name="191661638"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/excessive%20disk%20usage/near/191661638" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/excessive.20disk.20usage.html#191661638">(Mar 24 2020 at 19:34)</a>:</h4>
<p>I don't <em>think</em> so, but I should check</p>



<a name="191661654"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/excessive%20disk%20usage/near/191661654" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/excessive.20disk.20usage.html#191661654">(Mar 24 2020 at 19:34)</a>:</h4>
<p>in some cases it is doing an incremental build</p>



<a name="191661663"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/excessive%20disk%20usage/near/191661663" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/excessive.20disk.20usage.html#191661663">(Mar 24 2020 at 19:34)</a>:</h4>
<p>it might be debuginfo-lines or something</p>



<a name="191661685"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/excessive%20disk%20usage/near/191661685" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/excessive.20disk.20usage.html#191661685">(Mar 24 2020 at 19:35)</a>:</h4>
<p>ok I guess <code>debuginfo-level=1</code></p>



<a name="191661754"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/excessive%20disk%20usage/near/191661754" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jonas Schievink  [he/him] <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/excessive.20disk.20usage.html#191661754">(Mar 24 2020 at 19:36)</a>:</h4>
<p>Ah, line tables only still generates heaps of type descriptions according to <span class="user-mention" data-user-id="119009">@eddyb</span></p>



<a name="191661809"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/excessive%20disk%20usage/near/191661809" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/excessive.20disk.20usage.html#191661809">(Mar 24 2020 at 19:36)</a>:</h4>
<p>hmm ok</p>



<a name="191661840"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/excessive%20disk%20usage/near/191661840" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/excessive.20disk.20usage.html#191661840">(Mar 24 2020 at 19:36)</a>:</h4>
<p>interesting</p>



<a name="191661889"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/excessive%20disk%20usage/near/191661889" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jonas Schievink  [he/him] <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/excessive.20disk.20usage.html#191661889">(Mar 24 2020 at 19:36)</a>:</h4>
<p><a href="https://github.com/rust-lang/rust/issues/69074" target="_blank" title="https://github.com/rust-lang/rust/issues/69074">https://github.com/rust-lang/rust/issues/69074</a></p>



<a name="191661951"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/excessive%20disk%20usage/near/191661951" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/excessive.20disk.20usage.html#191661951">(Mar 24 2020 at 19:37)</a>:</h4>
<p>I guess I could do some experiments and turn off debuginfo</p>



<a name="191661960"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/excessive%20disk%20usage/near/191661960" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/excessive.20disk.20usage.html#191661960">(Mar 24 2020 at 19:37)</a>:</h4>
<p>though that'd be pretty useless</p>



<a name="191661963"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/excessive%20disk%20usage/near/191661963" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/excessive.20disk.20usage.html#191661963">(Mar 24 2020 at 19:37)</a>:</h4>
<p>from an actual "debug the compiler" POV</p>



<a name="191662020"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/excessive%20disk%20usage/near/191662020" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/excessive.20disk.20usage.html#191662020">(Mar 24 2020 at 19:38)</a>:</h4>
<p><span class="user-mention silent" data-user-id="116009">nikomatsakis</span> <a href="#narrow/stream/131828-t-compiler/topic/excessive.20disk.20usage/near/191661951" title="#narrow/stream/131828-t-compiler/topic/excessive.20disk.20usage/near/191661951">said</a>:</p>
<blockquote>
<p>I guess I could do some experiments and turn off debuginfo</p>
</blockquote>
<p>in order to verify the hypothesis, I mean</p>



<a name="191662123"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/excessive%20disk%20usage/near/191662123" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> davidtwco <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/excessive.20disk.20usage.html#191662123">(Mar 24 2020 at 19:39)</a>:</h4>
<p>Most of the space in my experience is stuff from old builds - if I delete a directory and re-build, it isn't <em>that</em> large. It's when I've been rebuilding in a directory for a while that there's a build-up.</p>



<a name="191662612"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/excessive%20disk%20usage/near/191662612" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/excessive.20disk.20usage.html#191662612">(Mar 24 2020 at 19:44)</a>:</h4>
<p>I was wondering about that, <span class="user-mention" data-user-id="116107">@davidtwco</span></p>



<a name="191662634"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/excessive%20disk%20usage/near/191662634" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/excessive.20disk.20usage.html#191662634">(Mar 24 2020 at 19:44)</a>:</h4>
<p>if we were leaking space</p>



<a name="191662845"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/excessive%20disk%20usage/near/191662845" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> bjorn3 <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/excessive.20disk.20usage.html#191662845">(Mar 24 2020 at 19:46)</a>:</h4>
<p>Cargo doesn't cleanup artifacts compiled using an older compiler, so every time there is a bootstrap bump, disk usage will increase if rustbuild doesn't remove all target dirs.</p>



<a name="191662961"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/excessive%20disk%20usage/near/191662961" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> simulacrum <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/excessive.20disk.20usage.html#191662961">(Mar 24 2020 at 19:47)</a>:</h4>
<p>(and we indeed do not)</p>



<a name="191663035"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/excessive%20disk%20usage/near/191663035" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> simulacrum <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/excessive.20disk.20usage.html#191663035">(Mar 24 2020 at 19:48)</a>:</h4>
<p>mostly because people complain when we delete their caches, and we don't know if it's really old (really same reason why cargo doesn't in some sense)</p>



<a name="191663136"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/excessive%20disk%20usage/near/191663136" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> eddyb <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/excessive.20disk.20usage.html#191663136">(Mar 24 2020 at 19:49)</a>:</h4>
<p><span class="user-mention" data-user-id="211727">@Jonas Schievink</span> <span class="user-mention" data-user-id="116009">@nikomatsakis</span> FWIW <a href="https://github.com/rust-lang/rust/issues/69080" target="_blank" title="https://github.com/rust-lang/rust/issues/69080">#69080</a> landed</p>



<a name="191663225"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/excessive%20disk%20usage/near/191663225" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jonas Schievink  [he/him] <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/excessive.20disk.20usage.html#191663225">(Mar 24 2020 at 19:50)</a>:</h4>
<p>ah, nice</p>



<a name="191663236"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/excessive%20disk%20usage/near/191663236" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> eddyb <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/excessive.20disk.20usage.html#191663236">(Mar 24 2020 at 19:50)</a>:</h4>
<blockquote>
<p>went from just over 1GiB (1019MiB) down to 402MiB</p>
</blockquote>



<a name="191663249"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/excessive%20disk%20usage/near/191663249" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> eddyb <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/excessive.20disk.20usage.html#191663249">(Mar 24 2020 at 19:50)</a>:</h4>
<p>(this is one file specifically :P)</p>



<a name="191803663"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/excessive%20disk%20usage/near/191803663" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/excessive.20disk.20usage.html#191803663">(Mar 25 2020 at 20:01)</a>:</h4>
<p><span class="user-mention silent" data-user-id="116122">simulacrum</span> <a href="#narrow/stream/131828-t-compiler/topic/excessive.20disk.20usage/near/191663035" title="#narrow/stream/131828-t-compiler/topic/excessive.20disk.20usage/near/191663035">said</a>:</p>
<blockquote>
<p>mostly because people complain when we delete their caches, and we don't know if it's really old (really same reason why cargo doesn't in some sense)</p>
</blockquote>
<p>I'm unconvinced by this argument :P</p>



<a name="191803735"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/excessive%20disk%20usage/near/191803735" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/excessive.20disk.20usage.html#191803735">(Mar 25 2020 at 20:02)</a>:</h4>
<p>is the idea that people might rebase their working directory to some older branch, basically?</p>



<a name="191803748"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/excessive%20disk%20usage/near/191803748" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/excessive.20disk.20usage.html#191803748">(Mar 25 2020 at 20:02)</a>:</h4>
<p>it'd be nice to at least have an option in config.toml</p>



<a name="191804139"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/excessive%20disk%20usage/near/191804139" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> davidtwco <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/excessive.20disk.20usage.html#191804139">(Mar 25 2020 at 20:05)</a>:</h4>
<p><span class="user-mention silent" data-user-id="116009">nikomatsakis</span> <a href="#narrow/stream/131828-t-compiler/topic/excessive.20disk.20usage/near/191803748" title="#narrow/stream/131828-t-compiler/topic/excessive.20disk.20usage/near/191803748">said</a>:</p>
<blockquote>
<p>it'd be nice to at least have an option in config.toml</p>
</blockquote>
<p>or a <code>./x.py give-me-my-disk-space-back</code> command that could be run when it's a issue.</p>



<a name="191804340"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/excessive%20disk%20usage/near/191804340" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> simulacrum <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/excessive.20disk.20usage.html#191804340">(Mar 25 2020 at 20:07)</a>:</h4>
<p><span class="user-mention" data-user-id="116009">@nikomatsakis</span> I'm also unconvinced -- but I would strongly prefer that the disk space clearing on compiler change was implemented in cargo, not rustbuild</p>



<a name="191804381"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/excessive%20disk%20usage/near/191804381" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> simulacrum <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/excessive.20disk.20usage.html#191804381">(Mar 25 2020 at 20:07)</a>:</h4>
<p>i.e. if we feel that it should have different behavior, then that seems like a change for cargo</p>



<a name="191804436"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/excessive%20disk%20usage/near/191804436" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/excessive.20disk.20usage.html#191804436">(Mar 25 2020 at 20:08)</a>:</h4>
<p>it seems equally important there</p>



<a name="191804441"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/excessive%20disk%20usage/near/191804441" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/excessive.20disk.20usage.html#191804441">(Mar 25 2020 at 20:08)</a>:</h4>
<p>I agree</p>



<a name="191804451"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/excessive%20disk%20usage/near/191804451" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/excessive.20disk.20usage.html#191804451">(Mar 25 2020 at 20:08)</a>:</h4>
<p>like, if we expect people to keep up with our releases, we're ..</p>



<a name="191804454"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/excessive%20disk%20usage/near/191804454" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/excessive.20disk.20usage.html#191804454">(Mar 25 2020 at 20:08)</a>:</h4>
<p>it feels like we can just have an LRU cache</p>



<a name="191804466"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/excessive%20disk%20usage/near/191804466" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/excessive.20disk.20usage.html#191804466">(Mar 25 2020 at 20:08)</a>:</h4>
<p>something like "keep the last N toolchains"</p>



<a name="191804490"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/excessive%20disk%20usage/near/191804490" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/excessive.20disk.20usage.html#191804490">(Mar 25 2020 at 20:08)</a>:</h4>
<p>and people can configure N</p>



<a name="191804509"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/excessive%20disk%20usage/near/191804509" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/excessive.20disk.20usage.html#191804509">(Mar 25 2020 at 20:08)</a>:</h4>
<p>maybe it is 3 by default or something, idk</p>



<a name="191804511"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/excessive%20disk%20usage/near/191804511" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> simulacrum <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/excessive.20disk.20usage.html#191804511">(Mar 25 2020 at 20:08)</a>:</h4>
<p>Sure. I think most people would be happy if we even just said N=1</p>



<a name="191804521"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/excessive%20disk%20usage/near/191804521" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/excessive.20disk.20usage.html#191804521">(Mar 25 2020 at 20:08)</a>:</h4>
<p>yes, I suspect so</p>



<a name="191804535"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/excessive%20disk%20usage/near/191804535" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/excessive.20disk.20usage.html#191804535">(Mar 25 2020 at 20:09)</a>:</h4>
<p>it's got to be the minority that are pinging around between toolchains</p>



<a name="191804541"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/excessive%20disk%20usage/near/191804541" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/excessive.20disk.20usage.html#191804541">(Mar 25 2020 at 20:09)</a>:</h4>
<p>but I can imagine that people want stable/nightly</p>



<a name="191804546"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/excessive%20disk%20usage/near/191804546" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/excessive.20disk.20usage.html#191804546">(Mar 25 2020 at 20:09)</a>:</h4>
<p>at minimum</p>



<a name="191804550"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/excessive%20disk%20usage/near/191804550" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> simulacrum <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/excessive.20disk.20usage.html#191804550">(Mar 25 2020 at 20:09)</a>:</h4>
<p>(or perhaps N=1 but within a "channel" i.e. you could share beta/stable/nightly)</p>



<a name="191804552"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/excessive%20disk%20usage/near/191804552" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/excessive.20disk.20usage.html#191804552">(Mar 25 2020 at 20:09)</a>:</h4>
<p>so maybe N=2 :)</p>



<a name="191804565"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/excessive%20disk%20usage/near/191804565" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/excessive.20disk.20usage.html#191804565">(Mar 25 2020 at 20:09)</a>:</h4>
<p><span class="user-mention silent" data-user-id="116122">simulacrum</span> <a href="#narrow/stream/131828-t-compiler/topic/excessive.20disk.20usage/near/191804550" title="#narrow/stream/131828-t-compiler/topic/excessive.20disk.20usage/near/191804550">said</a>:</p>
<blockquote>
<p>(or perhaps N=1 but within a "channel" i.e. you could share beta/stable/nightly)</p>
</blockquote>
<p>yeah, that</p>



<a name="191805412"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/excessive%20disk%20usage/near/191805412" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> centril <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/excessive.20disk.20usage.html#191805412">(Mar 25 2020 at 20:16)</a>:</h4>
<p>N=2 seems eminently reasonable</p>



<a name="192041050"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/excessive%20disk%20usage/near/192041050" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Triplett <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/excessive.20disk.20usage.html#192041050">(Mar 27 2020 at 16:12)</a>:</h4>
<p>How about "keep everything that corresponds to a toolchain still available by rustup or system path"?</p>



<a name="192041096"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/excessive%20disk%20usage/near/192041096" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Triplett <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/excessive.20disk.20usage.html#192041096">(Mar 27 2020 at 16:12)</a>:</h4>
<p>If you no longer have the toolchain you're unlikely to want the cache.</p>



<a name="192052712"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/excessive%20disk%20usage/near/192052712" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> simulacrum <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/excessive.20disk.20usage.html#192052712">(Mar 27 2020 at 17:29)</a>:</h4>
<p>I imagine that would be quite costly for cargo -- you'd need to run all possible toolchains on each "run"</p>



<a name="192052740"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/excessive%20disk%20usage/near/192052740" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> simulacrum <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/excessive.20disk.20usage.html#192052740">(Mar 27 2020 at 17:29)</a>:</h4>
<p>otherwise e.g. nightly is never going to get cleared out because it's always at the same on-disk location</p>



<a name="192057574"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/excessive%20disk%20usage/near/192057574" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> pnkfelix <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/excessive.20disk.20usage.html#192057574">(Mar 27 2020 at 18:07)</a>:</h4>
<p><span class="user-mention silent" data-user-id="116122">simulacrum</span> <a href="#narrow/stream/131828-t-compiler/topic/excessive.20disk.20usage/near/192052712" title="#narrow/stream/131828-t-compiler/topic/excessive.20disk.20usage/near/192052712">said</a>:</p>
<blockquote>
<p>I imagine that would be quite costly for cargo -- you'd need to run all possible toolchains on each "run"</p>
</blockquote>
<p>by "run all possible toolchains", do you mean invoke them with <code>--version</code> to observe what version of the compiler they correspond to (which sounds lightweight to me, at least for <code>cargo</code>'s purposes)?</p>



<a name="192057599"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/excessive%20disk%20usage/near/192057599" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> pnkfelix <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/excessive.20disk.20usage.html#192057599">(Mar 27 2020 at 18:07)</a>:</h4>
<p>or do you mean actually feed the crate source into each of the toolchain, which does sound absurdly expensive.</p>



<a name="192060124"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/excessive%20disk%20usage/near/192060124" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> simulacrum <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/excessive.20disk.20usage.html#192060124">(Mar 27 2020 at 18:25)</a>:</h4>
<p>no, I mean just --version</p>



<a name="192060154"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/excessive%20disk%20usage/near/192060154" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> simulacrum <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/excessive.20disk.20usage.html#192060154">(Mar 27 2020 at 18:25)</a>:</h4>
<p>that takes around 100ms -- very noticeable on no-op builds</p>



<a name="192060164"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/excessive%20disk%20usage/near/192060164" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> simulacrum <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/excessive.20disk.20usage.html#192060164">(Mar 27 2020 at 18:25)</a>:</h4>
<p>cargo does a lot to try to avoid that</p>



<a name="192060493"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/excessive%20disk%20usage/near/192060493" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> simulacrum <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/excessive.20disk.20usage.html#192060493">(Mar 27 2020 at 18:28)</a>:</h4>
<p>well okay locally I'm seeing 25ms, but that's still quite costly</p>



<a name="192061032"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/excessive%20disk%20usage/near/192061032" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> pnkfelix <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/excessive.20disk.20usage.html#192061032">(Mar 27 2020 at 18:32)</a>:</h4>
<p>/me wonders if <code>rustup</code> could keep this info in a separate file, locally</p>



<a name="192061062"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/excessive%20disk%20usage/near/192061062" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> pnkfelix <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/excessive.20disk.20usage.html#192061062">(Mar 27 2020 at 18:33)</a>:</h4>
<p>then you'd just pay to read from one file, rather than invoking a bunch of commands.</p>



<a name="192061099"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/excessive%20disk%20usage/near/192061099" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> pnkfelix <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/excessive.20disk.20usage.html#192061099">(Mar 27 2020 at 18:33)</a>:</h4>
<p>(but it would also be an extra source of complexity and potential inconsistency within <code>rustup</code>...)</p>



<a name="192063179"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/excessive%20disk%20usage/near/192063179" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> simulacrum <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/excessive.20disk.20usage.html#192063179">(Mar 27 2020 at 18:47)</a>:</h4>
<p>yeah, I guess, though it wouldn't help in rustbuild (where we constantly swap out e.g. stage1 compilers)</p>



<a name="192063262"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/excessive%20disk%20usage/near/192063262" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> simulacrum <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/excessive.20disk.20usage.html#192063262">(Mar 27 2020 at 18:48)</a>:</h4>
<p>and relatively frequently -- every 6 weeks at least -- get a new bootstrap compiler</p>



<a name="192077762"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/excessive%20disk%20usage/near/192077762" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> mark-i-m <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/excessive.20disk.20usage.html#192077762">(Mar 27 2020 at 20:48)</a>:</h4>
<p>Personally, I would be fine with some sort of <code>cargo clean --cache</code> that just does whatever the expensive thing and agressively clears out things it doesn't think we will need later</p>



<a name="192133885"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/excessive%20disk%20usage/near/192133885" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Eric Huss <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/excessive.20disk.20usage.html#192133885">(Mar 28 2020 at 17:45)</a>:</h4>
<p>We have an issue for this, and I sketched a solution here: <a href="https://github.com/rust-lang/cargo/issues/5026#issuecomment-444967785" title="https://github.com/rust-lang/cargo/issues/5026#issuecomment-444967785">https://github.com/rust-lang/cargo/issues/5026#issuecomment-444967785</a>.  The idea is to use a single hash for the "nightly" channel (and "beta"), so there wouldn't need to be any cleanup when you switch nightly versions, and Cargo would keep the full version in the fingerprint so it would get recompiled when you get a new nightly.  I was concerned mostly that this would disrupt some workflows, but I can't think of any specific problems (not sure if people swap between different nightlies).  I could try it out if you'd like (maybe a -Z flag)?  I also wasn't sure if rustc's incremental files somehow know which version they are for, or if that directory would also grow without bounds. (maybe one of the smart people here can answer that)</p>



<a name="192142900"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/excessive%20disk%20usage/near/192142900" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> simulacrum <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/excessive.20disk.20usage.html#192142900">(Mar 28 2020 at 21:43)</a>:</h4>
<p><span class="user-mention" data-user-id="120518">@Eric Huss</span> IIRC, I've been historically told that incremental is not guaranteed to work, but should be able to auto-detect itself being stale. I imagine if it's just a -Z flag then I think we can shake out problems as we go.</p>



<a name="192323509"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/excessive%20disk%20usage/near/192323509" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/excessive.20disk.20usage.html#192323509">(Mar 30 2020 at 22:07)</a>:</h4>
<p>I <em>believe</em> the toolchain info is in the hash</p>



<a name="192323514"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/excessive%20disk%20usage/near/192323514" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/excessive.20disk.20usage.html#192323514">(Mar 30 2020 at 22:07)</a>:</h4>
<p>but if not, we ought to be able to fix that</p>



<a name="192330766"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/excessive%20disk%20usage/near/192330766" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Russell Cohen <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/excessive.20disk.20usage.html#192330766">(Mar 30 2020 at 23:41)</a>:</h4>
<p>off topic ish, but as newish person contributing to rustc, it wasn't super fun when I ran out of disk space and my computer stopped working. Incremental builds seemed to massively magnify the issue -- it's called out in forge, but I at least didn't expect "a lot of disk space" to be &gt;35GB</p>



<a name="192330811"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/excessive%20disk%20usage/near/192330811" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Russell Cohen <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/excessive.20disk.20usage.html#192330811">(Mar 30 2020 at 23:42)</a>:</h4>
<p>could be worth calling it out louder in the docs, or even having x.py monitor how much disk space you've used and warn / abort if you're running out</p>



<a name="192345031"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/excessive%20disk%20usage/near/192345031" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> eddyb <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/excessive.20disk.20usage.html#192345031">(Mar 31 2020 at 04:46)</a>:</h4>
<p>on Linux at least, my desktop environment does that, and I think recent Windows versions have started doing it too</p>



<a name="192345037"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/excessive%20disk%20usage/near/192345037" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> eddyb <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/excessive.20disk.20usage.html#192345037">(Mar 31 2020 at 04:46)</a>:</h4>
<p>it's worse on servers, and I have had that happen</p>



<a name="192345104"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/excessive%20disk%20usage/near/192345104" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> eddyb <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/excessive.20disk.20usage.html#192345104">(Mar 31 2020 at 04:48)</a>:</h4>
<p>my non-incremental build dirs are 4GB</p>



<a name="192345130"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/excessive%20disk%20usage/near/192345130" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> eddyb <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/excessive.20disk.20usage.html#192345130">(Mar 31 2020 at 04:49)</a>:</h4>
<p>my incremental ones... lol the worst one is 76GB</p>



<a name="192345215"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/excessive%20disk%20usage/near/192345215" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> eddyb <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/excessive.20disk.20usage.html#192345215">(Mar 31 2020 at 04:50)</a>:</h4>
<p>oh wait no there's another difference: the non-incremental ones also don't have debuginfo or debug-assertions (they're basically nightly-like)</p>



<a name="192345294"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/excessive%20disk%20usage/near/192345294" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> eddyb <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/excessive.20disk.20usage.html#192345294">(Mar 31 2020 at 04:52)</a>:</h4>
<p>hmm debuginfo+debug-assertions build seems to have 20GB in stage0-rustc <em>outside</em> of the incremental dir</p>



<a name="192345332"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/excessive%20disk%20usage/near/192345332" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> eddyb <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/excessive.20disk.20usage.html#192345332">(Mar 31 2020 at 04:53)</a>:</h4>
<p>it's gonna be a while before <a href="https://github.com/rust-lang/rust/pull/69080" title="https://github.com/rust-lang/rust/pull/69080">https://github.com/rust-lang/rust/pull/69080</a> reaches beta</p>



<a name="192345340"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/excessive%20disk%20usage/near/192345340" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> eddyb <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/excessive.20disk.20usage.html#192345340">(Mar 31 2020 at 04:53)</a>:</h4>
<p>kind of sad, I should've gotten it merged when I opened it</p>



<a name="192345589"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/excessive%20disk%20usage/near/192345589" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> eddyb <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/excessive.20disk.20usage.html#192345589">(Mar 31 2020 at 04:59)</a>:</h4>
<p>hmm looking in the incremental dir, I have up to 4 copies for some crates</p>



<a name="192345724"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/excessive%20disk%20usage/near/192345724" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> eddyb <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/excessive.20disk.20usage.html#192345724">(Mar 31 2020 at 05:02)</a>:</h4>
<p><span class="user-mention" data-user-id="116009">@nikomatsakis</span> oh this is that silly thing where incremental keeps a duplicate of the <code>.o</code> files in the <code>rlib</code>...</p>



<a name="192345727"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/excessive%20disk%20usage/near/192345727" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> eddyb <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/excessive.20disk.20usage.html#192345727">(Mar 31 2020 at 05:02)</a>:</h4>
<p>we should've stopped doing that years ago</p>



<a name="192345734"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/excessive%20disk%20usage/near/192345734" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> eddyb <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/excessive.20disk.20usage.html#192345734">(Mar 31 2020 at 05:03)</a>:</h4>
<p>and here I was thinking there was 1GB of <code>librustc_middle</code> and 1GB of <code>librustc_mir</code> cached query data..</p>



<a name="192345795"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/excessive%20disk%20usage/near/192345795" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> eddyb <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/excessive.20disk.20usage.html#192345795">(Mar 31 2020 at 05:05)</a>:</h4>
<p><code>rust-1/build/x86_64-unknown-linux-gnu/stage0-rustc/x86_64-unknown-linux-gnu/release/incremental/rustc_middle-vbnouhhfsdso/s-fm1o95587b-13ujuvc-tq0tgxcz60na/*.bin</code>:</p>
<div class="codehilite"><pre><span></span>134M    dep-graph.bin
116M    query-cache.bin
49K     thin-lto-past-imports.bin
25K     work-products.bin
</pre></div>



<a name="192345863"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/excessive%20disk%20usage/near/192345863" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> eddyb <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/excessive.20disk.20usage.html#192345863">(Mar 31 2020 at 05:06)</a>:</h4>
<p>so only about 1/5 of the directory is actually not duplicated</p>



<a name="192346003"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/excessive%20disk%20usage/near/192346003" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> eddyb <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/excessive.20disk.20usage.html#192346003">(Mar 31 2020 at 05:10)</a>:</h4>
<p>across the entire incremental dir, which has up to 4 stale copies by the looks of it, only 4.5G of 29G are .bin files</p>



<a name="192346165"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/excessive%20disk%20usage/near/192346165" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> eddyb <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/excessive.20disk.20usage.html#192346165">(Mar 31 2020 at 05:15)</a>:</h4>
<p>there's also <a href="https://github.com/rust-lang/rust/issues/66961" title="https://github.com/rust-lang/rust/issues/66961">https://github.com/rust-lang/rust/issues/66961</a></p>



<a name="192389469"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/excessive%20disk%20usage/near/192389469" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> pnkfelix <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/excessive.20disk.20usage.html#192389469">(Mar 31 2020 at 13:32)</a>:</h4>
<p><span class="user-mention silent" data-user-id="119009">eddyb</span> <a href="#narrow/stream/131828-t-compiler/topic/excessive.20disk.20usage/near/192345332" title="#narrow/stream/131828-t-compiler/topic/excessive.20disk.20usage/near/192345332">said</a>:</p>
<blockquote>
<p>it's gonna be a while before <a href="https://github.com/rust-lang/rust/pull/69080" title="https://github.com/rust-lang/rust/pull/69080">https://github.com/rust-lang/rust/pull/69080</a> reaches beta</p>
</blockquote>
<p>maybe we should consider backporting it...</p>



<a name="192393420"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/excessive%20disk%20usage/near/192393420" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> eddyb <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/excessive.20disk.20usage.html#192393420">(Mar 31 2020 at 14:00)</a>:</h4>
<p>feel free to nominate it, I guess</p>



<a name="192556876"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/excessive%20disk%20usage/near/192556876" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> mark-i-m <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/excessive.20disk.20usage.html#192556876">(Apr 01 2020 at 16:43)</a>:</h4>
<p>Just ran into this again, btw:</p>
<div class="codehilite"><pre><span></span>86G     ./rust
91G     ./rust2
75G     ./rust3
</pre></div>


<div class="codehilite"><pre><span></span>$ du -hsc ./build/*
7.2G    ./build/bootstrap
2.0G    ./build/cache
6.4M    ./build/tmp
188K    ./build/tmp-dry-run
812K    ./build/tmp-rustbuild-tests
66G     ./build/x86_64-unknown-linux-gnu
75G     total
</pre></div>


<div class="codehilite"><pre><span></span>$ du -hsc ./build/x86_64-unknown-linux-gnu/*
4.0K    ./build/x86_64-unknown-linux-gnu/compiler-doc
225M    ./build/x86_64-unknown-linux-gnu/crate-docs
112M    ./build/x86_64-unknown-linux-gnu/doc
1.4G    ./build/x86_64-unknown-linux-gnu/llvm
1.6M    ./build/x86_64-unknown-linux-gnu/md-doc
44K     ./build/x86_64-unknown-linux-gnu/native
377M    ./build/x86_64-unknown-linux-gnu/stage0
1.9G    ./build/x86_64-unknown-linux-gnu/stage0-bootstrap-tools
12G     ./build/x86_64-unknown-linux-gnu/stage0-rustc
214M    ./build/x86_64-unknown-linux-gnu/stage0-std
145M    ./build/x86_64-unknown-linux-gnu/stage0-sysroot
2.3G    ./build/x86_64-unknown-linux-gnu/stage0-tools
4.0K    ./build/x86_64-unknown-linux-gnu/stage0-tools-bin
5.2G    ./build/x86_64-unknown-linux-gnu/stage1
29G     ./build/x86_64-unknown-linux-gnu/stage1-rustc
70M     ./build/x86_64-unknown-linux-gnu/stage1-std
2.0G    ./build/x86_64-unknown-linux-gnu/stage1-tools
145M    ./build/x86_64-unknown-linux-gnu/stage2
61M     ./build/x86_64-unknown-linux-gnu/stage2-std
600M    ./build/x86_64-unknown-linux-gnu/stage2-tools
4.0K    ./build/x86_64-unknown-linux-gnu/stage2-tools-bin
11G     ./build/x86_64-unknown-linux-gnu/test
66G     total
</pre></div>



<a name="192556895"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/excessive%20disk%20usage/near/192556895" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> mark-i-m <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/excessive.20disk.20usage.html#192556895">(Apr 01 2020 at 16:43)</a>:</h4>
<p>I'm glad to provide more data if it's helpful</p>



<a name="192556960"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/excessive%20disk%20usage/near/192556960" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> eddyb <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/excessive.20disk.20usage.html#192556960">(Apr 01 2020 at 16:43)</a>:</h4>
<p>that's similar to what I'm seeing</p>



<a name="192557046"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/excessive%20disk%20usage/near/192557046" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> eddyb <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/excessive.20disk.20usage.html#192557046">(Apr 01 2020 at 16:44)</a>:</h4>
<p>if you nuke non-LLVM dirs you can recover some of the space usage</p>



<a name="192557088"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/excessive%20disk%20usage/near/192557088" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> eddyb <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/excessive.20disk.20usage.html#192557088">(Apr 01 2020 at 16:44)</a>:</h4>
<p>I usually use <code>rm -rf build/*/stage*</code> for this</p>



<a name="192974442"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/excessive%20disk%20usage/near/192974442" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> eddyb <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/excessive.20disk.20usage.html#192974442">(Apr 05 2020 at 19:39)</a>:</h4>
<p>almost forgot about the duplication between incremental and regular artifacts, opened <a href="https://github.com/rust-lang/rust/issues/70823" title="https://github.com/rust-lang/rust/issues/70823">#70823</a> just now</p>



<a name="192979193"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/excessive%20disk%20usage/near/192979193" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Eric Huss <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/excessive.20disk.20usage.html#192979193">(Apr 05 2020 at 21:30)</a>:</h4>
<p>I posted <a href="https://github.com/rust-lang/cargo/pull/8073" title="https://github.com/rust-lang/cargo/pull/8073">https://github.com/rust-lang/cargo/pull/8073</a> to use the same filenames between nightly versions.  From my tests, I think it should be safe, though it can always be reverted or put behind a config option if it is a problem.  Ofc this won't help rustc development until the next release.</p>



<a name="192979280"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/excessive%20disk%20usage/near/192979280" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> eddyb <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/excessive.20disk.20usage.html#192979280">(Apr 05 2020 at 21:32)</a>:</h4>
<p><span class="user-mention" data-user-id="120518">@Eric Huss</span> will Cargo still rebuild artifacts correctly?</p>



<a name="192979285"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/excessive%20disk%20usage/near/192979285" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> eddyb <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/excessive.20disk.20usage.html#192979285">(Apr 05 2020 at 21:32)</a>:</h4>
<p>i.e. does it still use the full version <em>elsewhere</em>?</p>



<a name="192979289"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/excessive%20disk%20usage/near/192979289" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Eric Huss <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/excessive.20disk.20usage.html#192979289">(Apr 05 2020 at 21:32)</a>:</h4>
<p>Yes, the full version is in the fingerprint.</p>



<a name="192979293"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/excessive%20disk%20usage/near/192979293" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> eddyb <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/excessive.20disk.20usage.html#192979293">(Apr 05 2020 at 21:32)</a>:</h4>
<p>does your PR passes the same <code>-C metadata</code> for all nightlies?</p>



<a name="192979296"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/excessive%20disk%20usage/near/192979296" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Eric Huss <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/excessive.20disk.20usage.html#192979296">(Apr 05 2020 at 21:32)</a>:</h4>
<p>yes</p>



<a name="192979300"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/excessive%20disk%20usage/near/192979300" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> eddyb <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/excessive.20disk.20usage.html#192979300">(Apr 05 2020 at 21:33)</a>:</h4>
<p>because uhhh this might fix a perf nightmare in a simpler way, no <code>-Z build-std</code> hacks</p>



<a name="192979305"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/excessive%20disk%20usage/near/192979305" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Eric Huss <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/excessive.20disk.20usage.html#192979305">(Apr 05 2020 at 21:33)</a>:</h4>
<p>what is that?</p>



<a name="192979313"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/excessive%20disk%20usage/near/192979313" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> eddyb <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/excessive.20disk.20usage.html#192979313">(Apr 05 2020 at 21:33)</a>:</h4>
<p><span class="user-mention" data-user-id="120518">@Eric Huss</span> <a href="https://github.com/rust-lang/rust/issues/69060#issuecomment-604928032" title="https://github.com/rust-lang/rust/issues/69060#issuecomment-604928032">https://github.com/rust-lang/rust/issues/69060#issuecomment-604928032</a></p>



<a name="192979321"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/excessive%20disk%20usage/near/192979321" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> eddyb <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/excessive.20disk.20usage.html#192979321">(Apr 05 2020 at 21:33)</a>:</h4>
<p>the compiler is non-deterministic in <code>-C metadata</code> content</p>



<a name="192979363"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/excessive%20disk%20usage/near/192979363" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> eddyb <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/excessive.20disk.20usage.html#192979363">(Apr 05 2020 at 21:34)</a>:</h4>
<p>because crate hashes are sort of the "roots" of all hashes and they are used to sort things in incrementally-stable ways</p>



<a name="192979378"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/excessive%20disk%20usage/near/192979378" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> eddyb <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/excessive.20disk.20usage.html#192979378">(Apr 05 2020 at 21:35)</a>:</h4>
<p>so when we compare two compilers, the simple fact <em>that they accurately report their versions</em> is enough to cause, through Cargo, up to 3% or so noise on syn-opt, and a bit less on other crates</p>



<a name="192979391"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/excessive%20disk%20usage/near/192979391" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> eddyb <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/excessive.20disk.20usage.html#192979391">(Apr 05 2020 at 21:35)</a>:</h4>
<p>results are much more stable if the compiler is built with the <code>dev</code> instead of <code>nightly</code> channel</p>



<a name="192979626"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/excessive%20disk%20usage/near/192979626" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Eric Huss <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/excessive.20disk.20usage.html#192979626">(Apr 05 2020 at 21:41)</a>:</h4>
<p>Hm.  Well let me know if it causes a problem.  I'm not sure if it is relevant, but I also noticed that the incremental cache fingerprint includes the full release version (with git hash).  I'm not sure if that's relevant to what you're talking about, but could be part of why <code>-dev</code> works better (because it doesn't have a git hash).</p>



<a name="192979695"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/excessive%20disk%20usage/near/192979695" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> eddyb <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/excessive.20disk.20usage.html#192979695">(Apr 05 2020 at 21:42)</a>:</h4>
<p><span class="user-mention" data-user-id="120518">@Eric Huss</span> nah we know it's <code>-C metadata</code></p>



<a name="192979705"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/excessive%20disk%20usage/near/192979705" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> eddyb <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/excessive.20disk.20usage.html#192979705">(Apr 05 2020 at 21:43)</a>:</h4>
<p>without it there's no change in hashes inside the compiler and no order differences</p>



<a name="192979789"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/excessive%20disk%20usage/near/192979789" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> eddyb <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/excessive.20disk.20usage.html#192979789">(Apr 05 2020 at 21:45)</a>:</h4>
<p>the version the compiler knows doesn't flow into any hashes AFAIK, it's just used for sanity checks</p>



<a name="192980015"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/excessive%20disk%20usage/near/192980015" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> eddyb <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/excessive.20disk.20usage.html#192980015">(Apr 05 2020 at 21:50)</a>:</h4>
<p><span class="user-mention" data-user-id="120518">@Eric Huss</span> anyway whenever we start shipping a Cargo with your changes, <a href="http://perf.rust-lang.org" title="http://perf.rust-lang.org">perf.rust-lang.org</a> should stop being so noisy</p>



<hr><p>Last updated: Apr 12 2022 at 20:01 UTC</p>
</html>