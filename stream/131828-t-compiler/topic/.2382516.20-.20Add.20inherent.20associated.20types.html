<html>
<head><meta charset="utf-8"><title>#82516 - Add inherent associated types · t-compiler · Zulip Chat Archive</title></head>
<h2>Stream: <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/index.html">t-compiler</a></h2>
<h3>Topic: <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/.2382516.20-.20Add.20inherent.20associated.20types.html">#82516 - Add inherent associated types</a></h3>

<hr>

<base href="https://rust-lang.zulipchat.com">

<head><link href="https://zulip-archive.rust-lang.org/style.css" rel="stylesheet"></head>

<a name="227768203"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/%2382516%20-%20Add%20inherent%20associated%20types/near/227768203" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Olivier FAURE <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/.2382516.20-.20Add.20inherent.20associated.20types.html#227768203">(Feb 25 2021 at 13:42)</a>:</h4>
<p>Mentored by <span class="user-mention" data-user-id="124288">@oli</span>, see github issue for details</p>



<a name="227768334"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/%2382516%20-%20Add%20inherent%20associated%20types/near/227768334" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Olivier FAURE <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/.2382516.20-.20Add.20inherent.20associated.20types.html#227768334">(Feb 25 2021 at 13:43)</a>:</h4>
<p>Anyway, once the initial part passes CI (hopefully), I think the obvious next step is to fix <code>let x : Foo::Bar;</code></p>



<a name="227769019"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/%2382516%20-%20Add%20inherent%20associated%20types/near/227769019" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Olivier FAURE <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/.2382516.20-.20Add.20inherent.20associated.20types.html#227769019">(Feb 25 2021 at 13:48)</a>:</h4>
<p>CI passes \o/</p>



<a name="227783664"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/%2382516%20-%20Add%20inherent%20associated%20types/near/227783664" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Olivier FAURE <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/.2382516.20-.20Add.20inherent.20associated.20types.html#227783664">(Feb 25 2021 at 15:21)</a>:</h4>
<p>Okay, so thinking out loud about next steps:</p>
<ul>
<li>I know the diagnostic is emitted from <code>fn report_ambiguous_associated_type</code></li>
<li>I should probably get a callstack with that "throw on compile error" flag</li>
<li>Figure out how the code handles resolution and stuff, I guess.</li>
</ul>



<a name="227784019"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/%2382516%20-%20Add%20inherent%20associated%20types/near/227784019" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> oli <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/.2382516.20-.20Add.20inherent.20associated.20types.html#227784019">(Feb 25 2021 at 15:23)</a>:</h4>
<p>the flag you're looking for is <code>-Ztreat-err-as-bug=1</code> (or another number to choose a later error)</p>



<a name="227784077"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/%2382516%20-%20Add%20inherent%20associated%20types/near/227784077" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Olivier FAURE <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/.2382516.20-.20Add.20inherent.20associated.20types.html#227784077">(Feb 25 2021 at 15:23)</a>:</h4>
<p>Yeah, I just found it</p>



<a name="227784094"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/%2382516%20-%20Add%20inherent%20associated%20types/near/227784094" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Olivier FAURE <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/.2382516.20-.20Add.20inherent.20associated.20types.html#227784094">(Feb 25 2021 at 15:23)</a>:</h4>
<p>Is there a way to pass it to x.py?</p>



<a name="227784095"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/%2382516%20-%20Add%20inherent%20associated%20types/near/227784095" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> oli <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/.2382516.20-.20Add.20inherent.20associated.20types.html#227784095">(Feb 25 2021 at 15:23)</a>:</h4>
<p>I think you should also compare this with how associated consts are resolved, as these already work both for traits and inherent impls</p>



<a name="227784160"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/%2382516%20-%20Add%20inherent%20associated%20types/near/227784160" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> oli <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/.2382516.20-.20Add.20inherent.20associated.20types.html#227784160">(Feb 25 2021 at 15:24)</a>:</h4>
<p>nope, but when your test fails, it will tell you its command line</p>



<a name="227784188"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/%2382516%20-%20Add%20inherent%20associated%20types/near/227784188" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> oli <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/.2382516.20-.20Add.20inherent.20associated.20types.html#227784188">(Feb 25 2021 at 15:24)</a>:</h4>
<p>you can then copy that and add the new flag</p>



<a name="227784247"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/%2382516%20-%20Add%20inherent%20associated%20types/near/227784247" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> oli <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/.2382516.20-.20Add.20inherent.20associated.20types.html#227784247">(Feb 25 2021 at 15:24)</a>:</h4>
<p>though you'll lose any nice diagnostics because of the =json flag that emits diagnostics as json, so remove that</p>



<a name="227784269"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/%2382516%20-%20Add%20inherent%20associated%20types/near/227784269" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> oli <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/.2382516.20-.20Add.20inherent.20associated.20types.html#227784269">(Feb 25 2021 at 15:24)</a>:</h4>
<p>aaaaand we should probably make this a better experience</p>



<a name="227784381"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/%2382516%20-%20Add%20inherent%20associated%20types/near/227784381" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Olivier FAURE <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/.2382516.20-.20Add.20inherent.20associated.20types.html#227784381">(Feb 25 2021 at 15:25)</a>:</h4>
<p>Add that to the next sprint, I guess</p>



<a name="227785398"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/%2382516%20-%20Add%20inherent%20associated%20types/near/227785398" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Olivier FAURE <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/.2382516.20-.20Add.20inherent.20associated.20types.html#227785398">(Feb 25 2021 at 15:31)</a>:</h4>
<p>Also, the "crash on error" trick isn't that helpful with delayed errors =/</p>



<a name="227785823"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/%2382516%20-%20Add%20inherent%20associated%20types/near/227785823" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> oli <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/.2382516.20-.20Add.20inherent.20associated.20types.html#227785823">(Feb 25 2021 at 15:33)</a>:</h4>
<p>huh... delayed errors also use that flag</p>



<a name="227785981"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/%2382516%20-%20Add%20inherent%20associated%20types/near/227785981" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Olivier FAURE <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/.2382516.20-.20Add.20inherent.20associated.20types.html#227785981">(Feb 25 2021 at 15:34)</a>:</h4>
<p>Yeah, but I think once they produce a crash the control flow has already left the part that interests me, so the crash's call stack isn't super useful</p>



<a name="227786688"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/%2382516%20-%20Add%20inherent%20associated%20types/near/227786688" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> oli <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/.2382516.20-.20Add.20inherent.20associated.20types.html#227786688">(Feb 25 2021 at 15:39)</a>:</h4>
<p>hmm</p>



<a name="227786725"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/%2382516%20-%20Add%20inherent%20associated%20types/near/227786725" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> oli <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/.2382516.20-.20Add.20inherent.20associated.20types.html#227786725">(Feb 25 2021 at 15:39)</a>:</h4>
<p>I thought we were able to crash at the delaying site</p>



<a name="227786735"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/%2382516%20-%20Add%20inherent%20associated%20types/near/227786735" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Olivier FAURE <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/.2382516.20-.20Add.20inherent.20associated.20types.html#227786735">(Feb 25 2021 at 15:39)</a>:</h4>
<p>I wonder if, when <code>-Ztreat-err-as-bug</code> is called, we could just avoid delaying errors at all.</p>



<a name="227786739"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/%2382516%20-%20Add%20inherent%20associated%20types/near/227786739" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> oli <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/.2382516.20-.20Add.20inherent.20associated.20types.html#227786739">(Feb 25 2021 at 15:39)</a>:</h4>
<p>maybe that was a different flag?</p>



<a name="227786993"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/%2382516%20-%20Add%20inherent%20associated%20types/near/227786993" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joshua Nelson <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/.2382516.20-.20Add.20inherent.20associated.20types.html#227786993">(Feb 25 2021 at 15:41)</a>:</h4>
<p>Try removing =1, it sounds like the flag isn't having any effect</p>



<a name="227787199"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/%2382516%20-%20Add%20inherent%20associated%20types/near/227787199" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Matthew Jasper <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/.2382516.20-.20Add.20inherent.20associated.20types.html#227787199">(Feb 25 2021 at 15:42)</a>:</h4>
<p>You can use <code>-Z report-delayed-bugs</code> to change delayed bugs to errors (which <code>-Ztreat-err-as-bug</code> will then change to immedicate ICEs)</p>



<a name="227789250"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/%2382516%20-%20Add%20inherent%20associated%20types/near/227789250" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Olivier FAURE <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/.2382516.20-.20Add.20inherent.20associated.20types.html#227789250">(Feb 25 2021 at 15:54)</a>:</h4>
<p>Not working. I think I'm using an argument incorrectly</p>



<a name="227789349"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/%2382516%20-%20Add%20inherent%20associated%20types/near/227789349" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Olivier FAURE <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/.2382516.20-.20Add.20inherent.20associated.20types.html#227789349">(Feb 25 2021 at 15:55)</a>:</h4>
<p>Honestly what I'd like is a way to say "Screw it, just print a stack trace for every single error you emit"</p>



<a name="227789431"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/%2382516%20-%20Add%20inherent%20associated%20types/near/227789431" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Olivier FAURE <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/.2382516.20-.20Add.20inherent.20associated.20types.html#227789431">(Feb 25 2021 at 15:55)</a>:</h4>
<p>(to be clear, I <em>am</em> displaying a stack trace, but that trace doesn't include <code>report_ambiguous_associated_type</code> for some reason)</p>



<a name="227914819"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/%2382516%20-%20Add%20inherent%20associated%20types/near/227914819" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Olivier FAURE <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/.2382516.20-.20Add.20inherent.20associated.20types.html#227914819">(Feb 26 2021 at 11:33)</a>:</h4>
<p>I'm currently trying to wrap my head around <a href="https://github.com/rust-lang/rust/blob/master/compiler/rustc_hir/src/def.rs#L206-L217">this enum</a>:</p>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="k">pub</span><span class="w"> </span><span class="k">enum</span> <span class="nc">Res</span><span class="o">&lt;</span><span class="n">Id</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">hir</span>::<span class="n">HirId</span><span class="o">&gt;</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="n">Def</span><span class="p">(</span><span class="n">DefKind</span><span class="p">,</span><span class="w"> </span><span class="n">DefId</span><span class="p">),</span><span class="w"></span>

<span class="w">    </span><span class="c1">// Type namespace</span>
<span class="w">    </span><span class="n">PrimTy</span><span class="p">(</span><span class="n">hir</span>::<span class="n">PrimTy</span><span class="p">),</span><span class="w"></span>
<span class="w">    </span><span class="sd">/// `Self`, with both an optional trait and impl `DefId`. (...)</span>
<span class="w">    </span><span class="n">SelfTy</span><span class="p">(</span><span class="nb">Option</span><span class="o">&lt;</span><span class="n">DefId</span><span class="o">&gt;</span><span class="w"> </span><span class="cm">/* trait */</span><span class="p">,</span><span class="w"> </span><span class="nb">Option</span><span class="o">&lt;</span><span class="p">(</span><span class="n">DefId</span><span class="p">,</span><span class="w"> </span><span class="kt">bool</span><span class="p">)</span><span class="o">&gt;</span><span class="w"> </span><span class="cm">/* impl */</span><span class="p">),</span><span class="w"></span>
<span class="w">    </span><span class="n">ToolMod</span><span class="p">,</span><span class="w"> </span><span class="c1">// e.g., `rustfmt` in `#[rustfmt::skip]`</span>

<span class="w">    </span><span class="c1">// Value namespace</span>
<span class="w">    </span><span class="n">SelfCtor</span><span class="p">(</span><span class="n">DefId</span><span class="w"> </span><span class="cm">/* impl */</span><span class="p">),</span><span class="w"> </span><span class="c1">// `DefId` refers to the impl</span>
<span class="w">    </span><span class="n">Local</span><span class="p">(</span><span class="n">Id</span><span class="p">),</span><span class="w"></span>

<span class="w">    </span><span class="c1">// Macro namespace</span>
<span class="w">    </span><span class="n">NonMacroAttr</span><span class="p">(</span><span class="n">NonMacroAttrKind</span><span class="p">),</span><span class="w"> </span><span class="c1">// e.g., `#[inline]` or `#[rustfmt::skip]`</span>

<span class="w">    </span><span class="c1">// All namespaces</span>
<span class="w">    </span><span class="nb">Err</span><span class="p">,</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>
</code></pre></div>
<p>Could someone break down what the different variants represent for me? I get that the enum itself represents a path item (eg in <code>A::B::C</code> it represents both A, B and C), and a DefId is the id of a HIR item, but I can still figure out what some of the branches refer to.</p>



<a name="227915669"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/%2382516%20-%20Add%20inherent%20associated%20types/near/227915669" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Olivier FAURE <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/.2382516.20-.20Add.20inherent.20associated.20types.html#227915669">(Feb 26 2021 at 11:41)</a>:</h4>
<p>Specific notes/questions:</p>
<ul>
<li><code>ToolMod</code>, <code>NonMacroAttr</code> and <code>Err</code> are easy, I think. Like, in <code>#[rustfmt::skip]</code>, <code>rustfmt</code> is a ToolMod and <code>skip</code> in a NonMacroAttr. I assume Err is a poison.</li>
<li>What's the difference between <code>SelfTy</code> and <code>SelfCtor</code>? I get that they both refer to <code>Self</code>, but what are the extra params? Is it something like, <code>SelfTy</code> means <code>Self::something</code> and <code>SelfCtor</code> means <code>Self(value, value)</code>? What do <code>Option&lt;DefId&gt; /* trait */, Option&lt;(DefId, bool)&gt; /* impl */</code> and <code>DefId /* impl */</code> refer to?</li>
<li>I was going to ask what's the difference between Def and PrimTy, but I found the answer by looking into the rustc_middle and rustc_hir docs, so I guess I rubber-ducked myself on that one.</li>
</ul>



<a name="227915710"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/%2382516%20-%20Add%20inherent%20associated%20types/near/227915710" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Matthew Jasper <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/.2382516.20-.20Add.20inherent.20associated.20types.html#227915710">(Feb 26 2021 at 11:41)</a>:</h4>
<p><code>Local</code> is a local variable, <code>PrimTy</code> is one of the int or float primitive types or <code>bool</code>, <code>char</code> or <code>str</code>. <code>SelfTy</code> is <code>Self</code> used as a type <code>SelfCtor</code> is <code>Self</code> used as a (tuple) constructor (<code>impl A { fn new() -&gt; A { Self(123)  }</code>) <code>Def</code> is almost  everything else.</p>



<a name="227915953"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/%2382516%20-%20Add%20inherent%20associated%20types/near/227915953" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Olivier FAURE <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/.2382516.20-.20Add.20inherent.20associated.20types.html#227915953">(Feb 26 2021 at 11:44)</a>:</h4>
<p>Thanks!</p>
<blockquote>
<p>is Self used as a (tuple) constructor (<code>impl A { fn new() -&gt; A { Self(123)  }</code>)</p>
</blockquote>
<p>Not just a tuple constructor, I assume, since you can do <code>impl A { fn new() -&gt; A { Self { field: 0 } } }</code></p>



<a name="227916068"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/%2382516%20-%20Add%20inherent%20associated%20types/near/227916068" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Matthew Jasper <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/.2382516.20-.20Add.20inherent.20associated.20types.html#227916068">(Feb 26 2021 at 11:44)</a>:</h4>
<p>That might be <code>SelfTy</code></p>



<a name="227916087"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/%2382516%20-%20Add%20inherent%20associated%20types/near/227916087" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Olivier FAURE <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/.2382516.20-.20Add.20inherent.20associated.20types.html#227916087">(Feb 26 2021 at 11:45)</a>:</h4>
<p>Ok</p>



<a name="227916240"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/%2382516%20-%20Add%20inherent%20associated%20types/near/227916240" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Olivier FAURE <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/.2382516.20-.20Add.20inherent.20associated.20types.html#227916240">(Feb 26 2021 at 11:46)</a>:</h4>
<p>So the big question is have left is, you have these two variants:</p>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="w">    </span><span class="n">SelfTy</span><span class="p">(</span><span class="nb">Option</span><span class="o">&lt;</span><span class="n">DefId</span><span class="o">&gt;</span><span class="w"> </span><span class="cm">/* trait */</span><span class="p">,</span><span class="w"> </span><span class="nb">Option</span><span class="o">&lt;</span><span class="p">(</span><span class="n">DefId</span><span class="p">,</span><span class="w"> </span><span class="kt">bool</span><span class="p">)</span><span class="o">&gt;</span><span class="w"> </span><span class="cm">/* impl */</span><span class="p">),</span><span class="w"></span>
<span class="w">    </span><span class="n">SelfCtor</span><span class="p">(</span><span class="n">DefId</span><span class="w"> </span><span class="cm">/* impl */</span><span class="p">),</span><span class="w"> </span><span class="c1">// `DefId` refers to the impl</span>
</code></pre></div>
<p>What does the <code>/* impl */</code> field of the tuple represent, in both cases?</p>



<a name="227916280"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/%2382516%20-%20Add%20inherent%20associated%20types/near/227916280" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Matthew Jasper <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/.2382516.20-.20Add.20inherent.20associated.20types.html#227916280">(Feb 26 2021 at 11:47)</a>:</h4>
<p>For <code>SelfCtor</code> it's the DefId of the impl.</p>



<a name="227916309"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/%2382516%20-%20Add%20inherent%20associated%20types/near/227916309" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Matthew Jasper <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/.2382516.20-.20Add.20inherent.20associated.20types.html#227916309">(Feb 26 2021 at 11:47)</a>:</h4>
<p>For <code>SelfTy</code> it's <code>None</code> if it's in a trait item...</p>



<a name="227916364"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/%2382516%20-%20Add%20inherent%20associated%20types/near/227916364" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Olivier FAURE <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/.2382516.20-.20Add.20inherent.20associated.20types.html#227916364">(Feb 26 2021 at 11:47)</a>:</h4>
<p>So the two <code>Option</code>s in <code>SelfTy</code> are mutually exclusive?</p>



<a name="227916810"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/%2382516%20-%20Add%20inherent%20associated%20types/near/227916810" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Matthew Jasper <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/.2382516.20-.20Add.20inherent.20associated.20types.html#227916810">(Feb 26 2021 at 11:52)</a>:</h4>
<p>No, trait impls set both</p>



<a name="227916855"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/%2382516%20-%20Add%20inherent%20associated%20types/near/227916855" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Olivier FAURE <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/.2382516.20-.20Add.20inherent.20associated.20types.html#227916855">(Feb 26 2021 at 11:53)</a>:</h4>
<p>So when is one not set?</p>



<a name="227916883"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/%2382516%20-%20Add%20inherent%20associated%20types/near/227916883" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Olivier FAURE <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/.2382516.20-.20Add.20inherent.20associated.20types.html#227916883">(Feb 26 2021 at 11:53)</a>:</h4>
<p>I guess it wouldn't be set in the trait declaration itself</p>



<a name="227917067"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/%2382516%20-%20Add%20inherent%20associated%20types/near/227917067" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Matthew Jasper <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/.2382516.20-.20Add.20inherent.20associated.20types.html#227917067">(Feb 26 2021 at 11:55)</a>:</h4>
<p>The trait declaration does set the impl id, inherent impls don't set the trait.</p>



<a name="227917093"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/%2382516%20-%20Add%20inherent%20associated%20types/near/227917093" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> lcnr <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/.2382516.20-.20Add.20inherent.20associated.20types.html#227917093">(Feb 26 2021 at 11:55)</a>:</h4>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="k">trait</span><span class="w"> </span><span class="n">Foo</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="k">fn</span> <span class="nf">test</span><span class="p">()</span><span class="w"> </span>-&gt; <span class="nc">Self</span><span class="p">;</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>

<span class="k">impl</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;</span><span class="w"> </span><span class="n">Foo</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="nb">Vec</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="k">fn</span> <span class="nf">test</span><span class="p">()</span><span class="w"> </span>-&gt; <span class="nc">Self</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">        </span><span class="nb">Vec</span>::<span class="n">new</span><span class="p">()</span><span class="w"></span>
<span class="w">    </span><span class="p">}</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>
</code></pre></div>



<a name="227917156"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/%2382516%20-%20Add%20inherent%20associated%20types/near/227917156" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Olivier FAURE <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/.2382516.20-.20Add.20inherent.20associated.20types.html#227917156">(Feb 26 2021 at 11:56)</a>:</h4>
<p>So just to be clear, in this code:</p>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="k">struct</span> <span class="nc">A</span><span class="p">(</span><span class="kt">i32</span><span class="p">);</span><span class="w"></span>
<span class="k">impl</span><span class="w"> </span><span class="n">A</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="k">fn</span> <span class="nf">new</span><span class="p">()</span><span class="w"> </span>-&gt; <span class="nc">Self</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="bp">Self</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span><span class="w"> </span><span class="p">}</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>
</code></pre></div>
<p>The first Self is a <code>SelfTy</code>, the second is a <code>SelfCtor</code>; in both cases they refer to the id of <code>impl A</code>?</p>



<a name="227917196"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/%2382516%20-%20Add%20inherent%20associated%20types/near/227917196" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> lcnr <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/.2382516.20-.20Add.20inherent.20associated.20types.html#227917196">(Feb 26 2021 at 11:56)</a>:</h4>
<p>(in my example) the trait declaration is <code>Some, None</code>, the impl of the trait is <code>Some, Some</code> afaik</p>



<a name="227917212"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/%2382516%20-%20Add%20inherent%20associated%20types/near/227917212" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Olivier FAURE <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/.2382516.20-.20Add.20inherent.20associated.20types.html#227917212">(Feb 26 2021 at 11:56)</a>:</h4>
<p>Right, that makes sense</p>



<a name="227917271"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/%2382516%20-%20Add%20inherent%20associated%20types/near/227917271" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Olivier FAURE <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/.2382516.20-.20Add.20inherent.20associated.20types.html#227917271">(Feb 26 2021 at 11:57)</a>:</h4>
<p>Ok, I think I'm good to go, thanks!</p>



<a name="227964340"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/%2382516%20-%20Add%20inherent%20associated%20types/near/227964340" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Olivier FAURE <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/.2382516.20-.20Add.20inherent.20associated.20types.html#227964340">(Feb 26 2021 at 17:48)</a>:</h4>
<p>I have another pretty technical question: in ast_ty_to_ty_inner, there's <a href="https://github.com/rust-lang/rust/blob/master/compiler/rustc_typeck/src/astconv/mod.rs#L2217">a match arm</a> where Hir types go when processing the associated type of a type param:</p>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="kd">let</span><span class="w"> </span><span class="n">result_ty</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">match</span><span class="w"> </span><span class="n">ast_ty</span><span class="p">.</span><span class="n">kind</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="c1">// ...</span>
<span class="w">    </span><span class="n">hir</span>::<span class="n">TyKind</span>::<span class="n">Path</span><span class="p">(</span><span class="n">hir</span>::<span class="n">QPath</span>::<span class="n">TypeRelative</span><span class="p">(</span><span class="k">ref</span><span class="w"> </span><span class="n">qself</span><span class="p">,</span><span class="w"> </span><span class="k">ref</span><span class="w"> </span><span class="n">segment</span><span class="p">))</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">        </span><span class="c1">// ...</span>
<span class="w">    </span><span class="p">}</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>
</code></pre></div>



<a name="227964638"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/%2382516%20-%20Add%20inherent%20associated%20types/near/227964638" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Olivier FAURE <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/.2382516.20-.20Add.20inherent.20associated.20types.html#227964638">(Feb 26 2021 at 17:50)</a>:</h4>
<p>So for instance, this match arm will apply to <code>fn foobar&lt;T : MyTrait&gt;(...) {    T::SomeType    }</code></p>



<a name="227964761"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/%2382516%20-%20Add%20inherent%20associated%20types/near/227964761" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Olivier FAURE <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/.2382516.20-.20Add.20inherent.20associated.20types.html#227964761">(Feb 26 2021 at 17:51)</a>:</h4>
<p>However, it doesn't apply to <code>&lt;T as MyTrait&gt;::SomeType</code> and... I can't understand why?</p>



<a name="227965028"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/%2382516%20-%20Add%20inherent%20associated%20types/near/227965028" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Olivier FAURE <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/.2382516.20-.20Add.20inherent.20associated.20types.html#227965028">(Feb 26 2021 at 17:52)</a>:</h4>
<p>I think part of my confusion is I'm a little fuzzy on <code>hir::Ty</code> vs <code>ty::TyS</code>, so I tend to be confused when code switches a lot between the two1</p>



<a name="227987150"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/%2382516%20-%20Add%20inherent%20associated%20types/near/227987150" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Matthew Jasper <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/.2382516.20-.20Add.20inherent.20associated.20types.html#227987150">(Feb 26 2021 at 20:20)</a>:</h4>
<p><code>&lt;T as MyTrait&gt;::SomeType</code> is <code>QPath::Resolved(Some("T"), "MyTrait::SomeType")</code></p>



<a name="227996239"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/%2382516%20-%20Add%20inherent%20associated%20types/near/227996239" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Olivier FAURE <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/.2382516.20-.20Add.20inherent.20associated.20types.html#227996239">(Feb 26 2021 at 21:22)</a>:</h4>
<p>I kind of don't get the abstraction at work here.</p>



<a name="227996530"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/%2382516%20-%20Add%20inherent%20associated%20types/near/227996530" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Olivier FAURE <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/.2382516.20-.20Add.20inherent.20associated.20types.html#227996530">(Feb 26 2021 at 21:24)</a>:</h4>
<p>Like, depending on whether you have <code>T::AssociatedType</code> or <code>&lt;T&gt;::AssociatedType</code> or <code>&lt;T as MyTrait&gt;::AssociatedType</code>, the HIR representation is different, and the method for resolving it is completely different, even though in all three cases the compiler has exactly the same information as its disposal.</p>



<a name="227996846"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/%2382516%20-%20Add%20inherent%20associated%20types/near/227996846" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Olivier FAURE <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/.2382516.20-.20Add.20inherent.20associated.20types.html#227996846">(Feb 26 2021 at 21:27)</a>:</h4>
<p>To give another example that confuses me:</p>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="k">trait</span><span class="w"> </span><span class="n">MyTrait1</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="k">type</span> <span class="nc">Bar</span><span class="p">;</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>

<span class="k">trait</span><span class="w"> </span><span class="n">MyTrait2</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="k">type</span> <span class="nc">Foo</span>: <span class="nc">MyTrait1</span><span class="p">;</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>

<span class="k">fn</span> <span class="nf">take_my_trait</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;</span><span class="p">()</span><span class="w"> </span><span class="k">where</span><span class="w"> </span><span class="n">T</span>: <span class="nc">MyTrait2</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="n">x</span>: <span class="nc">T</span>::<span class="n">Foo</span>::<span class="n">Bar</span><span class="p">;</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>
</code></pre></div>



<a name="227997125"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/%2382516%20-%20Add%20inherent%20associated%20types/near/227997125" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Olivier FAURE <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/.2382516.20-.20Add.20inherent.20associated.20types.html#227997125">(Feb 26 2021 at 21:29)</a>:</h4>
<p>This gives me a compile error, but if I replace the last line with <code>let x: &lt;T::Foo as MyTrait1&gt;::TheBar;</code>, it works.</p>
<p>And looking at the <code>ast_ty_to_ty_inner</code> function, they take two completely different paths in the code; with different information "available" to the resolver; even though, intuitively, it feels like they should both be passed to the same function, with one or two parameters changed.</p>



<a name="227997467"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/%2382516%20-%20Add%20inherent%20associated%20types/near/227997467" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Olivier FAURE <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/.2382516.20-.20Add.20inherent.20associated.20types.html#227997467">(Feb 26 2021 at 21:31)</a>:</h4>
<p>Like... I'm not sure exactly what I'm asking, but... it feels like there isn't one canonical way to get the type information of an associated type given the HIR type info of its "parent", but there really should be one?</p>



<a name="227997938"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/%2382516%20-%20Add%20inherent%20associated%20types/near/227997938" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Olivier FAURE <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/.2382516.20-.20Add.20inherent.20associated.20types.html#227997938">(Feb 26 2021 at 21:34)</a>:</h4>
<p>Actually, I'm wondering the same thing about associated consts/methods. Is there a single, canonical way to the <code>Res</code> of a method, given its path and the type info of its parents? Or is it several method, depending on whether we have an inherent impl, an implicit trait bound, or an explicit <code>&lt;T as SomeTrait&gt;::</code> expression?</p>



<a name="228200193"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/%2382516%20-%20Add%20inherent%20associated%20types/near/228200193" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> oli <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/.2382516.20-.20Add.20inherent.20associated.20types.html#228200193">(Mar 01 2021 at 09:20)</a>:</h4>
<p><span class="user-mention silent" data-user-id="263609">Olivier FAURE</span> <a href="#narrow/stream/131828-t-compiler/topic/.2382516.20-.20Add.20inherent.20associated.20types/near/227996530">said</a>:</p>
<blockquote>
<p>Like, depending on whether you have <code>T::AssociatedType</code> or <code>&lt;T&gt;::AssociatedType</code> or <code>&lt;T as MyTrait&gt;::AssociatedType</code>, the HIR representation is different, and the method for resolving it is completely different, even though in all three cases the compiler has exactly the same information as its disposal.</p>
</blockquote>
<p>The compiler only <em>really</em> knows what you want in the third case. If we permitted the first two cases, then implementing another trait that has an associated type named <code>AssociatedType</code> would now make the resolution unresolvable, as we don't know which one you meant</p>



<a name="228200295"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/%2382516%20-%20Add%20inherent%20associated%20types/near/228200295" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> oli <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/.2382516.20-.20Add.20inherent.20associated.20types.html#228200295">(Mar 01 2021 at 09:21)</a>:</h4>
<p><span class="user-mention silent" data-user-id="263609">Olivier FAURE</span> <a href="#narrow/stream/131828-t-compiler/topic/.2382516.20-.20Add.20inherent.20associated.20types/near/227997125">said</a>:</p>
<blockquote>
<p>This gives me a compile error, but if I replace the last line with <code>let x: &lt;T::Foo as MyTrait1&gt;::TheBar;</code>, it works.</p>
</blockquote>
<p>Since <code>T</code> is known to only implement <code>MyTrait2</code>, we can directly look for <code>Foo</code> in the <code>impl Foo for WhateverTActuallyIs</code> block, because you can't possibly mean any other <code>Foo</code></p>



<a name="228200457"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/%2382516%20-%20Add%20inherent%20associated%20types/near/228200457" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> oli <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/.2382516.20-.20Add.20inherent.20associated.20types.html#228200457">(Mar 01 2021 at 09:22)</a>:</h4>
<p><span class="user-mention silent" data-user-id="263609">Olivier FAURE</span> <a href="#narrow/stream/131828-t-compiler/topic/.2382516.20-.20Add.20inherent.20associated.20types/near/227997938">said</a>:</p>
<blockquote>
<p>Actually, I'm wondering the same thing about associated consts/methods. Is there a single, canonical way to the <code>Res</code> of a method, given its path and the type info of its parents? Or is it several method, depending on whether we have an inherent impl, an implicit trait bound, or an explicit <code>&lt;T as SomeTrait&gt;::</code> expression?</p>
</blockquote>
<p>Yes, this is what I remember. The rules are different in so many cases, it's mostly easier to run some different logic entirely when in another situation.</p>



<a name="228213956"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/%2382516%20-%20Add%20inherent%20associated%20types/near/228213956" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Olivier FAURE <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/.2382516.20-.20Add.20inherent.20associated.20types.html#228213956">(Mar 01 2021 at 11:21)</a>:</h4>
<blockquote>
<p>If we permitted the first two cases, then implementing another trait that has an associated type named AssociatedType would now make the resolution unresolvable, as we don't know which one you meant</p>
</blockquote>
<p>That's what I thought at first, but the compiler is pretty capable of resolving these cases</p>



<a name="228214324"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/%2382516%20-%20Add%20inherent%20associated%20types/near/228214324" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Olivier FAURE <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/.2382516.20-.20Add.20inherent.20associated.20types.html#228214324">(Mar 01 2021 at 11:25)</a>:</h4>
<p>The method <code>one_bound_for_assoc_type</code> takes care of making sure the associated type only has one resolution</p>



<a name="228214839"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/%2382516%20-%20Add%20inherent%20associated%20types/near/228214839" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Olivier FAURE <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/.2382516.20-.20Add.20inherent.20associated.20types.html#228214839">(Mar 01 2021 at 11:31)</a>:</h4>
<p>Like, from a conceptual standpoint, there's not much difference between:</p>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="k">trait</span><span class="w"> </span><span class="n">MyTrait1</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="k">type</span> <span class="nc">Foobar</span><span class="p">;</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>
<span class="k">trait</span><span class="w"> </span><span class="n">MyTrait2</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="k">type</span> <span class="nc">Foobar</span><span class="p">;</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>

<span class="k">trait</span><span class="w"> </span><span class="n">MyTraitParentTrait</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="k">type</span> <span class="nc">Associated</span>: <span class="nc">MyTrait1</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">MyTrait2</span><span class="p">;</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>

<span class="k">fn</span> <span class="nf">foobar</span><span class="o">&lt;</span><span class="n">T</span>: <span class="nc">MyTraitParentTrait</span><span class="o">&gt;</span><span class="p">()</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="n">x</span>: <span class="nc">T</span>::<span class="n">Associated</span>::<span class="n">Foobar</span><span class="p">;</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>
</code></pre></div>
<p>and</p>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="k">trait</span><span class="w"> </span><span class="n">MyTrait1</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="k">type</span> <span class="nc">Foobar</span><span class="p">;</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>
<span class="k">trait</span><span class="w"> </span><span class="n">MyTrait2</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="k">type</span> <span class="nc">Foobar</span><span class="p">;</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>

<span class="k">fn</span> <span class="nf">foobar</span><span class="o">&lt;</span><span class="n">T</span>: <span class="nc">MyTrait1</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">MyTrait2</span><span class="o">&gt;</span><span class="p">()</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="n">x</span>: <span class="nc">T</span>::<span class="n">Foobar</span><span class="p">;</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>
</code></pre></div>
<p>They're both ambiguous in the same way.</p>



<a name="228215212"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/%2382516%20-%20Add%20inherent%20associated%20types/near/228215212" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Olivier FAURE <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/.2382516.20-.20Add.20inherent.20associated.20types.html#228215212">(Mar 01 2021 at 11:34)</a>:</h4>
<p>You can say that the difference is that, in the first case, <code>MyTraitParentTrait</code> could be defined in an external crate, that could add a new bound in a new version and break compilation that way. But in any case I'd think adding a bound to an associated type is a semver-breaking change anyway.</p>



<a name="228215695"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/%2382516%20-%20Add%20inherent%20associated%20types/near/228215695" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Olivier FAURE <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/.2382516.20-.20Add.20inherent.20associated.20types.html#228215695">(Mar 01 2021 at 11:39)</a>:</h4>
<p>This is a bit of a tangent from the subject of inherent associated types, though. My main point the was the whole resolution system feels a bit brittle, because it handles a few specific use-cases in a non-principled way. So the simplest way to implement inherent associated types would be to monkey-patch in another use case, but I'm worried it would add to the technical debt.</p>



<a name="228215815"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/%2382516%20-%20Add%20inherent%20associated%20types/near/228215815" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Olivier FAURE <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/.2382516.20-.20Add.20inherent.20associated.20types.html#228215815">(Mar 01 2021 at 11:40)</a>:</h4>
<p>I might look at the code in-depth again and do a write-up of what I think the principled solution would be.</p>



<hr><p>Last updated: Apr 12 2022 at 20:01 UTC</p>
</html>