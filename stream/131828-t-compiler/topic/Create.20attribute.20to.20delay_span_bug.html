<html>
<head><meta charset="utf-8"><title>Create attribute to delay_span_bug · t-compiler · Zulip Chat Archive</title></head>
<h2>Stream: <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/index.html">t-compiler</a></h2>
<h3>Topic: <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/Create.20attribute.20to.20delay_span_bug.html">Create attribute to delay_span_bug</a></h3>

<hr>

<base href="https://rust-lang.zulipchat.com">

<head><link href="https://zulip-archive.rust-lang.org/style.css" rel="stylesheet"></head>

<a name="179444603"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/Create%20attribute%20to%20delay_span_bug/near/179444603" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> traxys <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/Create.20attribute.20to.20delay_span_bug.html#179444603">(Oct 30 2019 at 15:35)</a>:</h4>
<p><span class="user-mention" data-user-id="124287">@mw</span> eddyb told me to ask you would have more clues than him on this behavior. to make a test for issue <a href="https://github.com/rust-lang/rust/issues/65401" target="_blank" title="https://github.com/rust-lang/rust/issues/65401">#65401</a>, I changed the attribute <code>rustc_error</code> to be able to take <code>rustc_error(delayed)</code> that calls <code>tcx.sess.delay_span_bug(tcx.def_span(def_id), "compilation successful");</code>, but when trying to compile twice some code with this attribute is does not exhibit the issue the snippet eddyb provided showed, do you have any idea why ?</p>



<a name="179446413"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/Create%20attribute%20to%20delay_span_bug/near/179446413" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> pnkfelix <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/Create.20attribute.20to.20delay_span_bug.html#179446413">(Oct 30 2019 at 15:51)</a>:</h4>
<p>hmm maybe the problem is more subtle, in that not <em>every</em> delay_span_bug is hidden?</p>



<a name="179446496"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/Create%20attribute%20to%20delay_span_bug/near/179446496" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> pnkfelix <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/Create.20attribute.20to.20delay_span_bug.html#179446496">(Oct 30 2019 at 15:51)</a>:</h4>
<p>I don't know if I'll have time to give your code a spin, but if I manage to allocate more time I'll try.</p>



<a name="179447268"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/Create%20attribute%20to%20delay_span_bug/near/179447268" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> traxys <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/Create.20attribute.20to.20delay_span_bug.html#179447268">(Oct 30 2019 at 15:58)</a>:</h4>
<p>The <code>check_for_rustc_errors_attr</code> is called in the first line of <code>codegen_crate</code> in <code>src/librustc_codegen_ssa/base.rs</code>, could it mean that no codegen is done ?</p>



<a name="179447283"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/Create%20attribute%20to%20delay_span_bug/near/179447283" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> mw <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/Create.20attribute.20to.20delay_span_bug.html#179447283">(Oct 30 2019 at 15:58)</a>:</h4>
<p><span class="user-mention" data-user-id="237671">@traxys</span> does the test case containing the attributes generate any other errors that might "shadow" the delayed bug?</p>



<a name="179447379"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/Create%20attribute%20to%20delay_span_bug/near/179447379" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> mw <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/Create.20attribute.20to.20delay_span_bug.html#179447379">(Oct 30 2019 at 15:59)</a>:</h4>
<p>make sure you are compiling a library with some code in it.</p>



<a name="179448272"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/Create%20attribute%20to%20delay_span_bug/near/179448272" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> traxys <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/Create.20attribute.20to.20delay_span_bug.html#179448272">(Oct 30 2019 at 16:06)</a>:</h4>
<p>the test case is</p>
<div class="codehilite"><pre><span></span><span class="cp">#![feature(rustc_attrs)]</span><span class="w"></span>

<span class="cp">#[rustc_error(delayed)]</span><span class="w"></span>
<span class="k">fn</span> <span class="nf">main</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="p">{}</span><span class="w"></span>
</pre></div>



<a name="179449111"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/Create%20attribute%20to%20delay_span_bug/near/179449111" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> traxys <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/Create.20attribute.20to.20delay_span_bug.html#179449111">(Oct 30 2019 at 16:14)</a>:</h4>
<p><span class="user-mention" data-user-id="124287">@mw</span> <span class="user-mention" data-user-id="116009">@nikomatsakis</span>: <span class="user-mention" data-user-id="119009">@eddyb</span> suggested that the problem is that <code>check_for_rustc_errors_attr</code> is properly not behind a query, and told me to ask you what should be the proper way to do it</p>



<a name="179511843"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/Create%20attribute%20to%20delay_span_bug/near/179511843" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> mw <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/Create.20attribute.20to.20delay_span_bug.html#179511843">(Oct 31 2019 at 08:55)</a>:</h4>
<p>It does not look like queries should have an influence on this.</p>



<a name="179511923"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/Create%20attribute%20to%20delay_span_bug/near/179511923" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> mw <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/Create.20attribute.20to.20delay_span_bug.html#179511923">(Oct 31 2019 at 08:56)</a>:</h4>
<p>I don't see the test case in your PR. Do you use revisions?</p>



<a name="179511945"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/Create%20attribute%20to%20delay_span_bug/near/179511945" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> mw <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/Create.20attribute.20to.20delay_span_bug.html#179511945">(Oct 31 2019 at 08:57)</a>:</h4>
<p>i.e. the test needs to be compiled twice in order for the problem to show</p>



<a name="179516785"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/Create%20attribute%20to%20delay_span_bug/near/179516785" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> traxys <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/Create.20attribute.20to.20delay_span_bug.html#179516785">(Oct 31 2019 at 10:09)</a>:</h4>
<p>I am compiling this twice by hand, calling the built rustc. The problem is that the attribute I wrote in the PR does not trigger the issue even though it triggers a delay_span_bug</p>



<a name="179518344"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/Create%20attribute%20to%20delay_span_bug/near/179518344" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> mw <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/Create.20attribute.20to.20delay_span_bug.html#179518344">(Oct 31 2019 at 10:28)</a>:</h4>
<p>did you make sure to use incremental compilation? when using <code>rustc</code>directly, you have to pass the <code>-Cincremental</code> commandline arg explicitly.</p>



<a name="179518380"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/Create%20attribute%20to%20delay_span_bug/near/179518380" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> mw <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/Create.20attribute.20to.20delay_span_bug.html#179518380">(Oct 31 2019 at 10:29)</a>:</h4>
<p>both invocations must specify the same incremental cache directory.</p>



<a name="179518481"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/Create%20attribute%20to%20delay_span_bug/near/179518481" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> mw <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/Create.20attribute.20to.20delay_span_bug.html#179518481">(Oct 31 2019 at 10:30)</a>:</h4>
<p>as in:</p>
<div class="codehilite"><pre><span></span><span class="c1"># invocation 1</span>
rustc -Cincremental<span class="o">=</span>/tmp/xyz lib.rs

<span class="c1"># invocation 2</span>
rustc -Cincremental<span class="o">=</span>/tmp/xyz lib.rs
</pre></div>



<a name="179518675"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/Create%20attribute%20to%20delay_span_bug/near/179518675" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> pnkfelix <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/Create.20attribute.20to.20delay_span_bug.html#179518675">(Oct 31 2019 at 10:33)</a>:</h4>
<p>maybe the better place to start is: <span class="user-mention" data-user-id="237671">@traxys</span> , you are able to observe the bug as originally documented, right?</p>



<a name="179518692"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/Create%20attribute%20to%20delay_span_bug/near/179518692" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> pnkfelix <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/Create.20attribute.20to.20delay_span_bug.html#179518692">(Oct 31 2019 at 10:33)</a>:</h4>
<p>(in other words, I don't want to be asking them to check (metaphorically) if their computer is plugged in if there's obvious evidence that it is)</p>



<a name="179519232"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/Create%20attribute%20to%20delay_span_bug/near/179519232" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> traxys <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/Create.20attribute.20to.20delay_span_bug.html#179519232">(Oct 31 2019 at 10:41)</a>:</h4>
<p>Yes with the snippet provided by eddyb</p>



<a name="179519865"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/Create%20attribute%20to%20delay_span_bug/near/179519865" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> traxys <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/Create.20attribute.20to.20delay_span_bug.html#179519865">(Oct 31 2019 at 10:50)</a>:</h4>
<p>(Also I think I have some correct code for turning the function into a query, should I put in the PR ?)</p>



<a name="179520125"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/Create%20attribute%20to%20delay_span_bug/near/179520125" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> eddyb <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/Create.20attribute.20to.20delay_span_bug.html#179520125">(Oct 31 2019 at 10:55)</a>:</h4>
<p><span class="user-mention" data-user-id="124287">@mw</span> without a query the <code>delay_span_bug</code> would run every time, but inside a query, the query would be cached on the first run</p>



<a name="179520226"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/Create%20attribute%20to%20delay_span_bug/near/179520226" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> traxys <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/Create.20attribute.20to.20delay_span_bug.html#179520226">(Oct 31 2019 at 10:56)</a>:</h4>
<p>@mw yes <code> ../build/x86_64-unknown-linux-gnu/stage1/bin/rustc error.rs -Cincremental=foo</code> is exactly the invocation<br>
I do it twice, and it fails, but with a correct snippet I see the issue</p>



<a name="179520249"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/Create%20attribute%20to%20delay_span_bug/near/179520249" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> traxys <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/Create.20attribute.20to.20delay_span_bug.html#179520249">(Oct 31 2019 at 10:57)</a>:</h4>
<p><span class="user-mention" data-user-id="119009">@eddyb</span> I am unsure of the code I wrote turning it into a query, but it still does not exihibit the issue</p>



<a name="179520264"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/Create%20attribute%20to%20delay_span_bug/near/179520264" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> eddyb <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/Create.20attribute.20to.20delay_span_bug.html#179520264">(Oct 31 2019 at 10:57)</a>:</h4>
<p>can you push to a branch, or gist a diff?</p>



<a name="179520277"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/Create%20attribute%20to%20delay_span_bug/near/179520277" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> eddyb <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/Create.20attribute.20to.20delay_span_bug.html#179520277">(Oct 31 2019 at 10:57)</a>:</h4>
<p><span class="user-mention" data-user-id="237671">@traxys</span> something very important is that the query shouldn't have <code>eval_always</code></p>



<a name="179520334"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/Create%20attribute%20to%20delay_span_bug/near/179520334" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> eddyb <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/Create.20attribute.20to.20delay_span_bug.html#179520334">(Oct 31 2019 at 10:58)</a>:</h4>
<p>because then I think you get the behavior that the query is never cached</p>



<a name="179520379"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/Create%20attribute%20to%20delay_span_bug/near/179520379" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> eddyb <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/Create.20attribute.20to.20delay_span_bug.html#179520379">(Oct 31 2019 at 10:59)</a>:</h4>
<p>tbh at this point it might be good to just fix the issue and not add a test - this is about ICEs, after all</p>



<a name="179520388"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/Create%20attribute%20to%20delay_span_bug/near/179520388" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> eddyb <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/Create.20attribute.20to.20delay_span_bug.html#179520388">(Oct 31 2019 at 10:59)</a>:</h4>
<p>seems like producing an ICE with just the right problems attached to it is hard</p>



<a name="179520497"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/Create%20attribute%20to%20delay_span_bug/near/179520497" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> traxys <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/Create.20attribute.20to.20delay_span_bug.html#179520497">(Oct 31 2019 at 11:01)</a>:</h4>
<p>I have really few ideas on what I did, I have no knowledge of the query structure. <a href="https://github.com/traxys/rust/tree/rustc_error_delayed" target="_blank" title="https://github.com/traxys/rust/tree/rustc_error_delayed">https://github.com/traxys/rust/tree/rustc_error_delayed</a> but the three last commits are what I did, sorry for the poor names it is my testing branch</p>



<a name="179520521"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/Create%20attribute%20to%20delay_span_bug/near/179520521" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> eddyb <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/Create.20attribute.20to.20delay_span_bug.html#179520521">(Oct 31 2019 at 11:01)</a>:</h4>
<p>if you use <code>git gui</code> then you can switch it to amend mode and keep modifying the last commit, to avoid needing many small commits</p>



<a name="179520600"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/Create%20attribute%20to%20delay_span_bug/near/179520600" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> eddyb <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/Create.20attribute.20to.20delay_span_bug.html#179520600">(Oct 31 2019 at 11:02)</a>:</h4>
<p><span class="user-mention" data-user-id="237671">@traxys</span> that looks fine</p>



<a name="179520633"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/Create%20attribute%20to%20delay_span_bug/near/179520633" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> eddyb <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/Create.20attribute.20to.20delay_span_bug.html#179520633">(Oct 31 2019 at 11:03)</a>:</h4>
<p>I wonder if you need <code>cache_on_disk_if { true }</code> or something</p>



<a name="179520760"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/Create%20attribute%20to%20delay_span_bug/near/179520760" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> traxys <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/Create.20attribute.20to.20delay_span_bug.html#179520760">(Oct 31 2019 at 11:04)</a>:</h4>
<p>I there somwhere all the attributes are described ?</p>



<a name="179521013"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/Create%20attribute%20to%20delay_span_bug/near/179521013" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> traxys <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/Create.20attribute.20to.20delay_span_bug.html#179521013">(Oct 31 2019 at 11:08)</a>:</h4>
<p>(I'll have the results in twenty minutes when rustc finishes compiling, I am not near my best computer, I need to setup SSH on it)</p>



<a name="179521116"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/Create%20attribute%20to%20delay_span_bug/near/179521116" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> traxys <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/Create.20attribute.20to.20delay_span_bug.html#179521116">(Oct 31 2019 at 11:10)</a>:</h4>
<p>Wouldn't it also need <code>load_cached(tcx, something)</code> ?</p>



<a name="179521919"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/Create%20attribute%20to%20delay_span_bug/near/179521919" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> eddyb <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/Create.20attribute.20to.20delay_span_bug.html#179521919">(Oct 31 2019 at 11:22)</a>:</h4>
<p>some queries only have <code>cache_on_disk_if</code>, I think the <code>load_cached</code> is only for unsupported types or something</p>



<a name="179523627"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/Create%20attribute%20to%20delay_span_bug/near/179523627" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> traxys <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/Create.20attribute.20to.20delay_span_bug.html#179523627">(Oct 31 2019 at 11:52)</a>:</h4>
<p><span class="user-mention" data-user-id="119009">@eddyb</span> It worked ! It shows the bug</p>



<a name="179523787"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/Create%20attribute%20to%20delay_span_bug/near/179523787" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> mw <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/Create.20attribute.20to.20delay_span_bug.html#179523787">(Oct 31 2019 at 11:55)</a>:</h4>
<p>Oh, right we want the delayed bug to happen in something that gets skipped in the second run...</p>



<a name="179523944"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/Create%20attribute%20to%20delay_span_bug/near/179523944" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> traxys <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/Create.20attribute.20to.20delay_span_bug.html#179523944">(Oct 31 2019 at 11:57)</a>:</h4>
<p>Does the <code>tcx.span_err</code> stay between runs, or did it break the bare <code>#[rustc_error]</code> for incremental compilation ?</p>



<a name="179524072"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/Create%20attribute%20to%20delay_span_bug/near/179524072" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> mw <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/Create.20attribute.20to.20delay_span_bug.html#179524072">(Oct 31 2019 at 11:59)</a>:</h4>
<p>the behavior of the regular <code>#[rustc_error]</code> should not change</p>



<a name="179524085"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/Create%20attribute%20to%20delay_span_bug/near/179524085" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> mw <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/Create.20attribute.20to.20delay_span_bug.html#179524085">(Oct 31 2019 at 11:59)</a>:</h4>
<p>so it still needs to be triggered outside of a query</p>



<a name="179524243"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/Create%20attribute%20to%20delay_span_bug/near/179524243" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> traxys <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/Create.20attribute.20to.20delay_span_bug.html#179524243">(Oct 31 2019 at 12:01)</a>:</h4>
<p>That would bring code duplication wouldn't it ? Because to check for <code>#[rustc_error(delay_span_bug)]</code> I first need to find the <code>rustc_error</code> and then check if there is the <code>delay_span_bug</code> ident</p>



<a name="179524246"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/Create%20attribute%20to%20delay_span_bug/near/179524246" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> mw <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/Create.20attribute.20to.20delay_span_bug.html#179524246">(Oct 31 2019 at 12:01)</a>:</h4>
<p>You should also be able to use <code>tcx.ensure().check_for_rustc_errors_attr()</code> instead of <code>tcx.check_for_rustc_errors_attr()</code>. Then the query result does not need to be cached on disk.</p>



<a name="179524407"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/Create%20attribute%20to%20delay_span_bug/near/179524407" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> mw <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/Create.20attribute.20to.20delay_span_bug.html#179524407">(Oct 31 2019 at 12:04)</a>:</h4>
<blockquote>
<p>That would bring code duplication wouldn't it ? Because to check for <code>#[rustc_error(delay_span_bug)]</code> I first need to find the <code>rustc_error</code> and then check if there is the <code>delay_span_bug</code> ident</p>
</blockquote>
<p>finding the attribute can still happen outside of any query. It's just the triggering of <code>delay_span_bug</code> that needs to happen inside the query</p>



<a name="179524462"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/Create%20attribute%20to%20delay_span_bug/near/179524462" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> traxys <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/Create.20attribute.20to.20delay_span_bug.html#179524462">(Oct 31 2019 at 12:05)</a>:</h4>
<p>So a query named <code>rustc_error_delay_span_bug</code> for example ? That just calls delay_span_bug ?</p>



<a name="179524489"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/Create%20attribute%20to%20delay_span_bug/near/179524489" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> mw <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/Create.20attribute.20to.20delay_span_bug.html#179524489">(Oct 31 2019 at 12:05)</a>:</h4>
<p>so I would:</p>
<ul>
<li>create a query called <code>trigger_delay_span_bug</code> and</li>
<li>rename <code>#[rustc_error(delayed)]</code> to <code>#[rustc_error(delayed_from_inside_query)]</code></li>
</ul>



<a name="179524599"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/Create%20attribute%20to%20delay_span_bug/near/179524599" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> mw <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/Create.20attribute.20to.20delay_span_bug.html#179524599">(Oct 31 2019 at 12:07)</a>:</h4>
<p>then this code can just call the <code>trigger_delay_span_bug</code> query:<br>
<a href="https://github.com/traxys/rust/commit/31a7cc84d038f355860d2e627ef14104f0432335#diff-9a36a3f0dd5416d91736e46c7c1cb614R45" target="_blank" title="https://github.com/traxys/rust/commit/31a7cc84d038f355860d2e627ef14104f0432335#diff-9a36a3f0dd5416d91736e46c7c1cb614R45">https://github.com/traxys/rust/commit/31a7cc84d038f355860d2e627ef14104f0432335#diff-9a36a3f0dd5416d91736e46c7c1cb614R45</a></p>



<a name="179524626"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/Create%20attribute%20to%20delay_span_bug/near/179524626" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> traxys <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/Create.20attribute.20to.20delay_span_bug.html#179524626">(Oct 31 2019 at 12:07)</a>:</h4>
<p>I had renamed to <code>delay_span_bug</code> (eddyb told it made more sense because span_bug was not called before), so <code>delay_span_bug_from_query</code> on <code>delayed_from_inside_query</code> ?</p>



<a name="179524697"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/Create%20attribute%20to%20delay_span_bug/near/179524697" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> mw <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/Create.20attribute.20to.20delay_span_bug.html#179524697">(Oct 31 2019 at 12:08)</a>:</h4>
<p><code>delay_span_bug_from_inside_query</code> sounds good</p>



<a name="179524712"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/Create%20attribute%20to%20delay_span_bug/near/179524712" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> mw <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/Create.20attribute.20to.20delay_span_bug.html#179524712">(Oct 31 2019 at 12:08)</a>:</h4>
<p>it's fine if it's a verbose name</p>



<a name="179524717"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/Create%20attribute%20to%20delay_span_bug/near/179524717" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> mw <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/Create.20attribute.20to.20delay_span_bug.html#179524717">(Oct 31 2019 at 12:08)</a>:</h4>
<p>better to be explicit</p>



<a name="179524723"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/Create%20attribute%20to%20delay_span_bug/near/179524723" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> traxys <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/Create.20attribute.20to.20delay_span_bug.html#179524723">(Oct 31 2019 at 12:08)</a>:</h4>
<p>I don't see many other uses for it than this test</p>



<a name="179524765"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/Create%20attribute%20to%20delay_span_bug/near/179524765" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> mw <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/Create.20attribute.20to.20delay_span_bug.html#179524765">(Oct 31 2019 at 12:09)</a>:</h4>
<p>for some context about "ensuring" a query:</p>



<a name="179524820"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/Create%20attribute%20to%20delay_span_bug/near/179524820" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> mw <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/Create.20attribute.20to.20delay_span_bug.html#179524820">(Oct 31 2019 at 12:10)</a>:</h4>
<p>it's the same as calling a query but then throwing away the result</p>



<a name="179524853"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/Create%20attribute%20to%20delay_span_bug/near/179524853" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> mw <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/Create.20attribute.20to.20delay_span_bug.html#179524853">(Oct 31 2019 at 12:10)</a>:</h4>
<p>you only use it when you really only care about the side effects of a query (like emitting errors)</p>



<a name="179524889"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/Create%20attribute%20to%20delay_span_bug/near/179524889" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> mw <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/Create.20attribute.20to.20delay_span_bug.html#179524889">(Oct 31 2019 at 12:11)</a>:</h4>
<p>(hm, now I wonder if this would actually work in that case, let me take a look...)</p>



<a name="179525082"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/Create%20attribute%20to%20delay_span_bug/near/179525082" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> mw <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/Create.20attribute.20to.20delay_span_bug.html#179525082">(Oct 31 2019 at 12:14)</a>:</h4>
<p>yes, it should work</p>



<a name="179525256"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/Create%20attribute%20to%20delay_span_bug/near/179525256" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> traxys <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/Create.20attribute.20to.20delay_span_bug.html#179525256">(Oct 31 2019 at 12:17)</a>:</h4>
<p>what should be the query input ? the CrateNum ?</p>



<a name="179525370"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/Create%20attribute%20to%20delay_span_bug/near/179525370" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> mw <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/Create.20attribute.20to.20delay_span_bug.html#179525370">(Oct 31 2019 at 12:18)</a>:</h4>
<p>yes, CrateNum is fine</p>



<a name="179526693"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/Create%20attribute%20to%20delay_span_bug/near/179526693" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> eddyb <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/Create.20attribute.20to.20delay_span_bug.html#179526693">(Oct 31 2019 at 12:37)</a>:</h4>
<p>btw, <span class="user-mention" data-user-id="124287">@mw</span> I was thinking we should have a <code>LocalCrate</code> ZST that we use instead of <code>CrateNum</code> for queries where it's always <code>LOCAL_CRATE</code> (I'd rather not use <code>()</code> because that somewhat obscures the intent)</p>



<a name="179526716"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/Create%20attribute%20to%20delay_span_bug/near/179526716" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> eddyb <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/Create.20attribute.20to.20delay_span_bug.html#179526716">(Oct 31 2019 at 12:38)</a>:</h4>
<p>kinda like <code>LocalDefId</code> (which I'm using to replace <code>DefIndex</code> in a few places as we speak)</p>



<a name="179526808"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/Create%20attribute%20to%20delay_span_bug/near/179526808" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> mw <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/Create.20attribute.20to.20delay_span_bug.html#179526808">(Oct 31 2019 at 12:39)</a>:</h4>
<p>Yes, that has been suggested before I think it's a good idea</p>



<a name="179526832"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/Create%20attribute%20to%20delay_span_bug/near/179526832" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> eddyb <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/Create.20attribute.20to.20delay_span_bug.html#179526832">(Oct 31 2019 at 12:39)</a>:</h4>
<p>it's on my "at some point in the next decade" TODO list</p>



<a name="179531819"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/Create%20attribute%20to%20delay_span_bug/near/179531819" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Zoxc <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/Create.20attribute.20to.20delay_span_bug.html#179531819">(Oct 31 2019 at 13:41)</a>:</h4>
<p>My PRs which moves the queries earlier added a <code>LocalCrate</code> type, but I changed it to <code>()</code> =P</p>



<a name="179531825"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/Create%20attribute%20to%20delay_span_bug/near/179531825" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> traxys <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/Create.20attribute.20to.20delay_span_bug.html#179531825">(Oct 31 2019 at 13:41)</a>:</h4>
<p>Where should the test be ? <code>src/test/ui/throw_incorrect_artifacts.rs</code> ?</p>



<a name="179532126"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/Create%20attribute%20to%20delay_span_bug/near/179532126" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> mw <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/Create.20attribute.20to.20delay_span_bug.html#179532126">(Oct 31 2019 at 13:45)</a>:</h4>
<p><code>src/test/incremental/delayed_span_bug.rs</code> maybe?</p>



<a name="179532710"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/Create%20attribute%20to%20delay_span_bug/near/179532710" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> traxys <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/Create.20attribute.20to.20delay_span_bug.html#179532710">(Oct 31 2019 at 13:52)</a>:</h4>
<p>Also the <code>//~ ERROR</code> annotation won't work with an ICE won't it ? I'll need to manually specify stderr ? (Not very fluent with tests)</p>



<a name="179534440"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/Create%20attribute%20to%20delay_span_bug/near/179534440" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> eddyb <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/Create.20attribute.20to.20delay_span_bug.html#179534440">(Oct 31 2019 at 14:10)</a>:</h4>
<p>there should be some ICE tests already, probably added by <span class="user-mention" data-user-id="124288">@oli</span> to test some CTFE-related edge cases</p>



<a name="179534483"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/Create%20attribute%20to%20delay_span_bug/near/179534483" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> eddyb <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/Create.20attribute.20to.20delay_span_bug.html#179534483">(Oct 31 2019 at 14:11)</a>:</h4>
<p>just grep for part of the ICE message (some part that always shows up) in <code>src/test/ui</code></p>



<a name="179536045"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/Create%20attribute%20to%20delay_span_bug/near/179536045" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> traxys <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/Create.20attribute.20to.20delay_span_bug.html#179536045">(Oct 31 2019 at 14:27)</a>:</h4>
<p>the only tests that match <code>stderr</code> are the <code>ui</code> tests ? So I should just check for any error in both passes in <code>incremental</code> ?</p>



<a name="179536744"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/Create%20attribute%20to%20delay_span_bug/near/179536744" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> traxys <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/Create.20attribute.20to.20delay_span_bug.html#179536744">(Oct 31 2019 at 14:34)</a>:</h4>
<div class="codehilite"><pre><span></span><span class="c1">// revisions: cfail1 fail2</span>
<span class="c1">// rustc-env:RUST_BACKTRACE=0</span>
<span class="c1">// failure-status: 101</span>
<span class="c1">// should-fail</span>

<span class="cp">#![feature(rustc_attrs)]</span><span class="w"></span>

<span class="cp">#[rustc_error(delay_span_bug)]</span><span class="w"></span>
<span class="k">fn</span> <span class="nf">main</span><span class="p">()</span><span class="w"> </span><span class="p">{}</span><span class="w"></span>
</pre></div>


<p>This is my test so far, but the problem is that is passes on a branch where the issue is not fixed, as though the incremental state is not saved<br>
Should I pass a flag <code>-Cincremental=foo</code> ?</p>



<a name="179536891"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/Create%20attribute%20to%20delay_span_bug/near/179536891" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> eddyb <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/Create.20attribute.20to.20delay_span_bug.html#179536891">(Oct 31 2019 at 14:36)</a>:</h4>
<p>oh huh I didn't think about incremental vs UI</p>



<a name="179537888"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/Create%20attribute%20to%20delay_span_bug/near/179537888" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> traxys <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/Create.20attribute.20to.20delay_span_bug.html#179537888">(Oct 31 2019 at 14:46)</a>:</h4>
<p>I think the problem here is that <code>should-fail</code> does not check that both revision fail, only the first one</p>



<a name="179538696"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/Create%20attribute%20to%20delay_span_bug/near/179538696" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> traxys <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/Create.20attribute.20to.20delay_span_bug.html#179538696">(Oct 31 2019 at 14:54)</a>:</h4>
<p>I see a lot of <code>rustc_partition_reused</code>, is it needed ?</p>



<a name="179577491"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/Create%20attribute%20to%20delay_span_bug/near/179577491" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> traxys <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/Create.20attribute.20to.20delay_span_bug.html#179577491">(Oct 31 2019 at 21:15)</a>:</h4>
<p>I checked the code for <code>cfail</code>, and it checks that there was no panic, should I add a header to disable this check ?</p>



<a name="179630257"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/Create%20attribute%20to%20delay_span_bug/near/179630257" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> traxys <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/Create.20attribute.20to.20delay_span_bug.html#179630257">(Nov 01 2019 at 14:26)</a>:</h4>
<p>After looking at the doc and code of compiletest I really see no other way than to add either a revision kind <code>cice</code> or a flag along the lines of <code>// expect-ice</code></p>



<a name="179630403"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/Create%20attribute%20to%20delay_span_bug/near/179630403" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> pnkfelix <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/Create.20attribute.20to.20delay_span_bug.html#179630403">(Nov 01 2019 at 14:28)</a>:</h4>
<p>hmm. You cannot use <code>error-pattern</code> here?</p>



<a name="179630429"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/Create%20attribute%20to%20delay_span_bug/near/179630429" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> pnkfelix <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/Create.20attribute.20to.20delay_span_bug.html#179630429">(Nov 01 2019 at 14:28)</a>:</h4>
<p>that is sort of our catch-all when you cannot make a nice UI test...</p>



<a name="179631528"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/Create%20attribute%20to%20delay_span_bug/near/179631528" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> traxys <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/Create.20attribute.20to.20delay_span_bug.html#179631528">(Nov 01 2019 at 14:41)</a>:</h4>
<p>I'll look I'm very unfamilliar with the test harness</p>



<a name="179631694"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/Create%20attribute%20to%20delay_span_bug/near/179631694" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> traxys <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/Create.20attribute.20to.20delay_span_bug.html#179631694">(Nov 01 2019 at 14:43)</a>:</h4>
<p>(Because it is not a UI but incremental test)</p>



<a name="179632054"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/Create%20attribute%20to%20delay_span_bug/near/179632054" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> traxys <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/Create.20attribute.20to.20delay_span_bug.html#179632054">(Nov 01 2019 at 14:47)</a>:</h4>
<p>The problem I have I think is this function</p>
<div class="codehilite"><pre><span></span><span class="w"> </span><span class="k">fn</span> <span class="nf">run_cfail_test</span><span class="p">(</span><span class="o">&amp;</span><span class="bp">self</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">         </span><span class="kd">let</span><span class="w"> </span><span class="n">proc_res</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="bp">self</span><span class="p">.</span><span class="n">compile_test</span><span class="p">();</span><span class="w"></span>
<span class="w">         </span><span class="bp">self</span><span class="p">.</span><span class="n">check_if_test_should_compile</span><span class="p">(</span><span class="o">&amp;</span><span class="n">proc_res</span><span class="p">);</span><span class="w"></span>
<span class="w">         </span><span class="bp">self</span><span class="p">.</span><span class="n">check_no_compiler_crash</span><span class="p">(</span><span class="o">&amp;</span><span class="n">proc_res</span><span class="p">);</span><span class="w"></span>
<span class="p">...</span><span class="w"></span>
</pre></div>



<a name="179632168"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/Create%20attribute%20to%20delay_span_bug/near/179632168" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> pnkfelix <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/Create.20attribute.20to.20delay_span_bug.html#179632168">(Nov 01 2019 at 14:48)</a>:</h4>
<p>ah, and this is definitely a compiler "crash"</p>



<a name="179632174"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/Create%20attribute%20to%20delay_span_bug/near/179632174" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> traxys <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/Create.20attribute.20to.20delay_span_bug.html#179632174">(Nov 01 2019 at 14:48)</a>:</h4>
<p>Yes</p>



<a name="179632227"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/Create%20attribute%20to%20delay_span_bug/near/179632227" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> traxys <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/Create.20attribute.20to.20delay_span_bug.html#179632227">(Nov 01 2019 at 14:49)</a>:</h4>
<p>So I would think I would need a way to disable a part of the check if a certain header is present</p>



<a name="179632262"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/Create%20attribute%20to%20delay_span_bug/near/179632262" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> pnkfelix <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/Create.20attribute.20to.20delay_span_bug.html#179632262">(Nov 01 2019 at 14:50)</a>:</h4>
<p>By the way, <span class="user-mention" data-user-id="237671">@traxys</span></p>



<a name="179632320"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/Create%20attribute%20to%20delay_span_bug/near/179632320" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> pnkfelix <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/Create.20attribute.20to.20delay_span_bug.html#179632320">(Nov 01 2019 at 14:50)</a>:</h4>
<p>i think <span class="user-mention" data-user-id="119009">@eddyb</span> suggested yesterday that we might want to land the effect of your PR <em>without</em> a test</p>



<a name="179632345"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/Create%20attribute%20to%20delay_span_bug/near/179632345" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> pnkfelix <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/Create.20attribute.20to.20delay_span_bug.html#179632345">(Nov 01 2019 at 14:50)</a>:</h4>
<p>because the change is important enough that we may not want to delay on resolving the questions surrounding how to test it properly</p>



<a name="179632388"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/Create%20attribute%20to%20delay_span_bug/near/179632388" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> traxys <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/Create.20attribute.20to.20delay_span_bug.html#179632388">(Nov 01 2019 at 14:51)</a>:</h4>
<p>Yes, so I should put the commits for creating the test in another PR ?</p>



<a name="179632410"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/Create%20attribute%20to%20delay_span_bug/near/179632410" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> traxys <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/Create.20attribute.20to.20delay_span_bug.html#179632410">(Nov 01 2019 at 14:51)</a>:</h4>
<p>And let this one be merged ?</p>



<a name="179632417"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/Create%20attribute%20to%20delay_span_bug/near/179632417" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> traxys <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/Create.20attribute.20to.20delay_span_bug.html#179632417">(Nov 01 2019 at 14:51)</a>:</h4>
<p>(the bug fix)</p>



<a name="179632477"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/Create%20attribute%20to%20delay_span_bug/near/179632477" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> pnkfelix <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/Create.20attribute.20to.20delay_span_bug.html#179632477">(Nov 01 2019 at 14:52)</a>:</h4>
<p>I think so. <span class="user-mention" data-user-id="119009">@eddyb</span> , did I summarize your viewpoint accurately?</p>



<a name="179632552"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/Create%20attribute%20to%20delay_span_bug/near/179632552" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> eddyb <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/Create.20attribute.20to.20delay_span_bug.html#179632552">(Nov 01 2019 at 14:53)</a>:</h4>
<p>yeah, we can land the very tiny fix even if we have no way to test it</p>



<a name="179632680"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/Create%20attribute%20to%20delay_span_bug/near/179632680" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> traxys <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/Create.20attribute.20to.20delay_span_bug.html#179632680">(Nov 01 2019 at 14:54)</a>:</h4>
<p>How do I revert properly the test commits on the PR ? with a local git revert and then rebase ?</p>



<a name="179632694"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/Create%20attribute%20to%20delay_span_bug/near/179632694" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> eddyb <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/Create.20attribute.20to.20delay_span_bug.html#179632694">(Nov 01 2019 at 14:55)</a>:</h4>
<p>testing around ICEs is cool/interesting in general, but I doubt it's as important</p>



<a name="179632705"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/Create%20attribute%20to%20delay_span_bug/near/179632705" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> eddyb <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/Create.20attribute.20to.20delay_span_bug.html#179632705">(Nov 01 2019 at 14:55)</a>:</h4>
<p><span class="user-mention" data-user-id="237671">@traxys</span> it's simpler than that</p>



<a name="179632711"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/Create%20attribute%20to%20delay_span_bug/near/179632711" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> eddyb <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/Create.20attribute.20to.20delay_span_bug.html#179632711">(Nov 01 2019 at 14:55)</a>:</h4>
<p>you can <code>git checkout some-commit-hash -b new-branch-name</code></p>



<a name="179632825"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/Create%20attribute%20to%20delay_span_bug/near/179632825" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> traxys <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/Create.20attribute.20to.20delay_span_bug.html#179632825">(Nov 01 2019 at 14:56)</a>:</h4>
<p>The commit hash being the place I want the PR to be at ?</p>



<a name="179632826"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/Create%20attribute%20to%20delay_span_bug/near/179632826" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> eddyb <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/Create.20attribute.20to.20delay_span_bug.html#179632826">(Nov 01 2019 at 14:56)</a>:</h4>
<p>or <code>git checkout HEAD~15 -b new-branch-name</code> if you want to make a new branch without the last 15 commits in it</p>



<a name="179632859"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/Create%20attribute%20to%20delay_span_bug/near/179632859" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> traxys <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/Create.20attribute.20to.20delay_span_bug.html#179632859">(Nov 01 2019 at 14:57)</a>:</h4>
<p>Ok so I need to switch the PR from one branch to another ?</p>



<a name="179632861"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/Create%20attribute%20to%20delay_span_bug/near/179632861" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> eddyb <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/Create.20attribute.20to.20delay_span_bug.html#179632861">(Nov 01 2019 at 14:57)</a>:</h4>
<p>wait, do you want to make a new PR without the test changes, or do you want the current one to not have the test changes?</p>



<a name="179632907"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/Create%20attribute%20to%20delay_span_bug/near/179632907" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> traxys <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/Create.20attribute.20to.20delay_span_bug.html#179632907">(Nov 01 2019 at 14:57)</a>:</h4>
<p>The second one I would think, but I could leave them in and wait for the PR to be merged to implement the rest of the test</p>



<a name="179632969"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/Create%20attribute%20to%20delay_span_bug/near/179632969" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> eddyb <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/Create.20attribute.20to.20delay_span_bug.html#179632969">(Nov 01 2019 at 14:58)</a>:</h4>
<p>you can also do <code>git branch new-branch-name</code> to save the current branch to a new name, and then you can do whatever you want with the current branch</p>



<a name="179633010"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/Create%20attribute%20to%20delay_span_bug/near/179633010" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> eddyb <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/Create.20attribute.20to.20delay_span_bug.html#179633010">(Nov 01 2019 at 14:58)</a>:</h4>
<p>oh, since you mentioned revert+rebase: there's a simpler way to do that thing too: in the file <code>git rebase -i</code> opens up you can just remove some of the <code>pick</code> lines</p>



<a name="179633017"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/Create%20attribute%20to%20delay_span_bug/near/179633017" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> eddyb <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/Create.20attribute.20to.20delay_span_bug.html#179633017">(Nov 01 2019 at 14:59)</a>:</h4>
<p>(or comment them out I think?)</p>



<a name="179633050"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/Create%20attribute%20to%20delay_span_bug/near/179633050" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> eddyb <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/Create.20attribute.20to.20delay_span_bug.html#179633050">(Nov 01 2019 at 14:59)</a>:</h4>
<p>and that will mean those commits will be gone after the rebase</p>



<a name="179633062"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/Create%20attribute%20to%20delay_span_bug/near/179633062" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> eddyb <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/Create.20attribute.20to.20delay_span_bug.html#179633062">(Nov 01 2019 at 14:59)</a>:</h4>
<p>sorry for offering several options, and I didn't even mention <code>git reset</code> :P</p>



<a name="179633121"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/Create%20attribute%20to%20delay_span_bug/near/179633121" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> pnkfelix <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/Create.20attribute.20to.20delay_span_bug.html#179633121">(Nov 01 2019 at 15:00)</a>:</h4>
<p><code>git reset --hard</code>, even ...</p>



<a name="179633122"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/Create%20attribute%20to%20delay_span_bug/near/179633122" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> eddyb <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/Create.20attribute.20to.20delay_span_bug.html#179633122">(Nov 01 2019 at 15:00)</a>:</h4>
<p>(<code>git</code> is really bad at having one single good way to do any one common task, sadly)</p>



<a name="179633155"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/Create%20attribute%20to%20delay_span_bug/near/179633155" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> traxys <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/Create.20attribute.20to.20delay_span_bug.html#179633155">(Nov 01 2019 at 15:00)</a>:</h4>
<p>I never worked with a large project on git so I never had to use those options before x)</p>



<a name="179633766"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/Create%20attribute%20to%20delay_span_bug/near/179633766" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> traxys <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/Create.20attribute.20to.20delay_span_bug.html#179633766">(Nov 01 2019 at 15:07)</a>:</h4>
<p>I removed the changes for the test and put them in another branch, <span class="user-mention" data-user-id="124287">@mw</span> suggested that the fix is good</p>



<a name="179634083"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/Create%20attribute%20to%20delay_span_bug/near/179634083" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> eddyb <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/Create.20attribute.20to.20delay_span_bug.html#179634083">(Nov 01 2019 at 15:11)</a>:</h4>
<p>testing it by hand on that one ICE that's not fixed yet (or any others that might be hinted at in <code>src/test/ui</code>), should be good</p>



<a name="179654448"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/Create%20attribute%20to%20delay_span_bug/near/179654448" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> traxys <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/Create.20attribute.20to.20delay_span_bug.html#179654448">(Nov 01 2019 at 18:59)</a>:</h4>
<p>So for creating the test should I add a flag to disable the panic test ? like <code>// should-ice</code> ?</p>



<a name="179654521"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/Create%20attribute%20to%20delay_span_bug/near/179654521" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> traxys <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/Create.20attribute.20to.20delay_span_bug.html#179654521">(Nov 01 2019 at 19:00)</a>:</h4>
<p>or <code> // error-as-ice</code> ?</p>



<hr><p>Last updated: Apr 12 2022 at 20:01 UTC</p>
</html>