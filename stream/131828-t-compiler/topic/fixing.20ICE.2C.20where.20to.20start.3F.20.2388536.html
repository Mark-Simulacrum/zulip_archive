<html>
<head><meta charset="utf-8"><title>fixing ICE, where to start? #88536 · t-compiler · Zulip Chat Archive</title></head>
<h2>Stream: <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/index.html">t-compiler</a></h2>
<h3>Topic: <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/fixing.20ICE.2C.20where.20to.20start.3F.20.2388536.html">fixing ICE, where to start? #88536</a></h3>

<hr>

<base href="https://rust-lang.zulipchat.com">

<head><link href="https://zulip-archive.rust-lang.org/style.css" rel="stylesheet"></head>

<a name="262478536"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/fixing%20ICE%2C%20where%20to%20start%3F%20%2388536/near/262478536" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Christian Poveda <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/fixing.20ICE.2C.20where.20to.20start.3F.20.2388536.html#262478536">(Nov 23 2021 at 16:24)</a>:</h4>
<p>putting the constant in their own <code>const</code> definition and then using it in the alias doesn't panic either</p>



<a name="262480067"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/fixing%20ICE%2C%20where%20to%20start%3F%20%2388536/near/262480067" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Christian Poveda <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/fixing.20ICE.2C.20where.20to.20start.3F.20.2388536.html#262480067">(Nov 23 2021 at 16:37)</a>:</h4>
<p>ok I got the logs <a href="/user_uploads/4715/Dt0oQtezluYcMrwDySyLc-nn/logs.txt">logs.txt</a></p>



<a name="262480465"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/fixing%20ICE%2C%20where%20to%20start%3F%20%2388536/near/262480465" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Christian Poveda <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/fixing.20ICE.2C.20where.20to.20start.3F.20.2388536.html#262480465">(Nov 23 2021 at 16:40)</a>:</h4>
<p>it seems this is happening when calling <code>process_method_call</code> for the <code>end</code> method.</p>



<a name="262480785"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/fixing%20ICE%2C%20where%20to%20start%3F%20%2388536/near/262480785" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Christian Poveda <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/fixing.20ICE.2C.20where.20to.20start.3F.20.2388536.html#262480785">(Nov 23 2021 at 16:43)</a>:</h4>
<p>so I guess nobody is setting the <code>typeck_results</code> to <code>Some(_)</code> for exprs inside type aliases</p>



<a name="262481783"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/fixing%20ICE%2C%20where%20to%20start%3F%20%2388536/near/262481783" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Christian Poveda <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/fixing.20ICE.2C.20where.20to.20start.3F.20.2388536.html#262481783">(Nov 23 2021 at 16:52)</a>:</h4>
<p>The only method setting <code>maybe_typeck_results</code> is <code>nest_typeck_results</code> so I'd say it needs to be called before we visit the TyAlias item.</p>



<a name="262483154"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/fixing%20ICE%2C%20where%20to%20start%3F%20%2388536/near/262483154" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joshua Nelson <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/fixing.20ICE.2C.20where.20to.20start.3F.20.2388536.html#262483154">(Nov 23 2021 at 17:00)</a>:</h4>
<p>seems reasonable :) <span class="user-mention" data-user-id="232957">@Jack Huey</span> would know better than me though</p>



<a name="262483342"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/fixing%20ICE%2C%20where%20to%20start%3F%20%2388536/near/262483342" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/fixing.20ICE.2C.20where.20to.20start.3F.20.2388536.html#262483342">(Nov 23 2021 at 17:02)</a>:</h4>
<p>I'm actually not quite sure tbh</p>



<a name="262485229"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/fixing%20ICE%2C%20where%20to%20start%3F%20%2388536/near/262485229" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Christian Poveda <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/fixing.20ICE.2C.20where.20to.20start.3F.20.2388536.html#262485229">(Nov 23 2021 at 17:16)</a>:</h4>
<p>Ok so inside <code>visit_ty</code> there is this arm for <code>Path</code>s</p>



<a name="262485257"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/fixing%20ICE%2C%20where%20to%20start%3F%20%2388536/near/262485257" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Christian Poveda <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/fixing.20ICE.2C.20where.20to.20start.3F.20.2388536.html#262485257">(Nov 23 2021 at 17:16)</a>:</h4>
<p>I think nobody is processing the constants inside the generic parameters of the segments</p>



<a name="262489741"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/fixing%20ICE%2C%20where%20to%20start%3F%20%2388536/near/262489741" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Christian Poveda <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/fixing.20ICE.2C.20where.20to.20start.3F.20.2388536.html#262489741">(Nov 23 2021 at 17:47)</a>:</h4>
<p>and then when we visit said constant we get the panic</p>



<a name="262497997"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/fixing%20ICE%2C%20where%20to%20start%3F%20%2388536/near/262497997" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Christian Poveda <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/fixing.20ICE.2C.20where.20to.20start.3F.20.2388536.html#262497997">(Nov 23 2021 at 18:54)</a>:</h4>
<p>I tried to call <code>nest_typeck_results</code> while processing a type alias and these are the logs:</p>
<div class="codehilite"><pre><span></span><code>INFO rustc_save_analysis Dumping crate playground
DEBUG rustc_save_analysis::dump_visitor visit_item Item { ident: #0, def_id: DefId(0:1 ~ playground[19ef]::{misc#0}), ...
DEBUG rustc_save_analysis::dump_visitor visit_item Item { ident: std#1, def_id: DefId(0:2 ~ playground[19ef]::std), ...
DEBUG rustc_save_analysis::dump_visitor visit_item Item { ident: Foo#0, def_id: DefId(0:3 ~ playground[19ef]::Foo),  ...
DEBUG rustc_save_analysis::dump_visitor process_struct Item { ident: Foo#0, def_id: DefId(0:3 ~ playground[19ef]::Foo), ...
DEBUG rustc_save_analysis::dump_visitor nest_typeck_results DefId(0:3 ~ playground[19ef]::Foo)
DEBUG rustc_save_analysis::dump_visitor visit_item Item { ident: Bar#0, def_id: DefId(0:6 ~ playground[19ef]::Bar), ...
DEBUG rustc_save_analysis::dump_visitor nest_typeck_results DefId(0:6 ~ playground[19ef]::Bar)
DEBUG rustc_save_analysis::dump_visitor visit_expr Block(Block { stmts: [], expr: Some(Expr { hir_id: HirId { owner: DefId(0:6 ~ playground[19ef]::Bar), local_id: 9 }, ...
DEBUG rustc_save_analysis::dump_visitor visit_expr Unary(Deref, Expr { hir_id: HirId { owner: DefId(0:6 ~ playground[19ef]::Bar), local_id: 8 }, ...
DEBUG rustc_save_analysis::dump_visitor visit_expr MethodCall(PathSegment { ident: end#0, hir_id: Some(HirId { owner: DefId(0:6 ~ playground[19ef]::Bar), local_id: 3 }), ...
DEBUG rustc_save_analysis::dump_visitor process_method_call Expr { hir_id: HirId { owner: DefId(0:6 ~ playground[19ef]::Bar), local_id: 8 }, ...
</code></pre></div>



<a name="262498129"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/fixing%20ICE%2C%20where%20to%20start%3F%20%2388536/near/262498129" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Christian Poveda <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/fixing.20ICE.2C.20where.20to.20start.3F.20.2388536.html#262498129">(Nov 23 2021 at 18:55)</a>:</h4>
<p>So I'm calling <code>nest_typeck_results</code> on <code>DefId(0:6 ~ playground[19ef]::Bar)</code> (which is the alias) but then when <code>process_method_call</code> gets called it still panics.</p>



<hr><p>Last updated: Apr 12 2022 at 20:01 UTC</p>
</html>