<html>
<head><meta charset="utf-8"><title>dev-guide suggests disabling RA proc macros · t-compiler · Zulip Chat Archive</title></head>
<h2>Stream: <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/index.html">t-compiler</a></h2>
<h3>Topic: <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/dev-guide.20suggests.20disabling.20RA.20proc.20macros.html">dev-guide suggests disabling RA proc macros</a></h3>

<hr>

<base href="https://rust-lang.zulipchat.com">

<head><link href="https://zulip-archive.rust-lang.org/style.css" rel="stylesheet"></head>

<a name="269033065"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/dev-guide%20suggests%20disabling%20RA%20proc%20macros/near/269033065" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> eddyb <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/dev-guide.20suggests.20disabling.20RA.20proc.20macros.html#269033065">(Jan 23 2022 at 18:52)</a>:</h4>
<p><a href="https://rustc-dev-guide.rust-lang.org/building/suggested.html#configuring-rust-analyzer-for-rustc">https://rustc-dev-guide.rust-lang.org/building/suggested.html#configuring-rust-analyzer-for-rustc</a><br>
contains this line:</p>
<div class="codehilite" data-code-language="JSON"><pre><span></span><code><span class="nt">"rust-analyzer.procMacro.enable"</span><span class="p">:</span> <span class="kc">false</span>
</code></pre></div>



<a name="269033091"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/dev-guide%20suggests%20disabling%20RA%20proc%20macros/near/269033091" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> eddyb <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/dev-guide.20suggests.20disabling.20RA.20proc.20macros.html#269033091">(Jan 23 2022 at 18:53)</a>:</h4>
<p>this breaks anything involving queries, because that (unfortunately) goes through a proc macro</p>



<a name="269033151"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/dev-guide%20suggests%20disabling%20RA%20proc%20macros/near/269033151" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> eddyb <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/dev-guide.20suggests.20disabling.20RA.20proc.20macros.html#269033151">(Jan 23 2022 at 18:54)</a>:</h4>
<p><span class="user-mention" data-user-id="326176">@Boxy [she/her]</span> mentioned it to me in the past, but I didn't really understand what going on until I was looking closer, while trying to use RA myself</p>



<a name="269033241"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/dev-guide%20suggests%20disabling%20RA%20proc%20macros/near/269033241" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> eddyb <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/dev-guide.20suggests.20disabling.20RA.20proc.20macros.html#269033241">(Jan 23 2022 at 18:56)</a>:</h4>
<p>cc <span class="user-mention" data-user-id="133247">@bjorn3</span> <span class="user-mention" data-user-id="200146">@Daniel Mcnab</span> what was the intention here?</p>



<a name="269033255"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/dev-guide%20suggests%20disabling%20RA%20proc%20macros/near/269033255" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> eddyb <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/dev-guide.20suggests.20disabling.20RA.20proc.20macros.html#269033255">(Jan 23 2022 at 18:56)</a>:</h4>
<p>enabling proc macros doesn't outright work by itself, because it enables build scripts, that won't run for some reason, but this sounds like a different problem that should be fixed instead of worked around?</p>



<a name="269033449"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/dev-guide%20suggests%20disabling%20RA%20proc%20macros/near/269033449" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> eddyb <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/dev-guide.20suggests.20disabling.20RA.20proc.20macros.html#269033449">(Jan 23 2022 at 19:00)</a>:</h4>
<p>it seems to be getting stuck on compiling <code>library</code> crates, and not making progress from there</p>



<a name="269033750"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/dev-guide%20suggests%20disabling%20RA%20proc%20macros/near/269033750" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> eddyb <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/dev-guide.20suggests.20disabling.20RA.20proc.20macros.html#269033750">(Jan 23 2022 at 19:06)</a>:</h4>
<p>it's really frustrating that RA seems to be losing the messages so I don't even know what's wrong with those unrelated build scripts</p>



<a name="269034146"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/dev-guide%20suggests%20disabling%20RA%20proc%20macros/near/269034146" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> eddyb <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/dev-guide.20suggests.20disabling.20RA.20proc.20macros.html#269034146">(Jan 23 2022 at 19:15)</a>:</h4>
<p>the <code>core</code> errors that it's not showing, seem to go away if I update nightly, so that might be one workaround</p>



<a name="269034364"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/dev-guide%20suggests%20disabling%20RA%20proc%20macros/near/269034364" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> eddyb <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/dev-guide.20suggests.20disabling.20RA.20proc.20macros.html#269034364">(Jan 23 2022 at 19:19)</a>:</h4>
<div class="codehilite"><pre><span></span><code>[ERROR rust_analyzer::reload] failed to switch build data: rust-analyzer failed to run build scripts:
error: could not compile `crc32fast` due to 138 previous errors
error: build failed
</code></pre></div>



<a name="269034367"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/dev-guide%20suggests%20disabling%20RA%20proc%20macros/near/269034367" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> eddyb <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/dev-guide.20suggests.20disabling.20RA.20proc.20macros.html#269034367">(Jan 23 2022 at 19:19)</a>:</h4>
<p>it would be useful if the rest of that wasn't lost :/</p>



<a name="269034466"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/dev-guide%20suggests%20disabling%20RA%20proc%20macros/near/269034466" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> eddyb <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/dev-guide.20suggests.20disabling.20RA.20proc.20macros.html#269034466">(Jan 23 2022 at 19:21)</a>:</h4>
<p>hmm I can run <code>cargo check -p crc32fast</code> to see the failure. so it is the <code>rustc-std-workspace-core</code> stuff that's causing issues</p>



<a name="269034525"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/dev-guide%20suggests%20disabling%20RA%20proc%20macros/near/269034525" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> eddyb <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/dev-guide.20suggests.20disabling.20RA.20proc.20macros.html#269034525">(Jan 23 2022 at 19:22)</a>:</h4>
<p>heh, <code>compiler_builtins</code> breaks if I comment out the <code>rustc-std-workspace-*</code> overrides in <code>Cargo.toml</code></p>



<a name="269034979"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/dev-guide%20suggests%20disabling%20RA%20proc%20macros/near/269034979" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> eddyb <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/dev-guide.20suggests.20disabling.20RA.20proc.20macros.html#269034979">(Jan 23 2022 at 19:32)</a>:</h4>
<p>oh, I finally found <a href="https://github.com/rust-analyzer/rust-analyzer/issues/9201">https://github.com/rust-analyzer/rust-analyzer/issues/9201</a></p>



<a name="269034989"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/dev-guide%20suggests%20disabling%20RA%20proc%20macros/near/269034989" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> eddyb <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/dev-guide.20suggests.20disabling.20RA.20proc.20macros.html#269034989">(Jan 23 2022 at 19:32)</a>:</h4>
<p>(couldn't find it when I was searching for what I thought was the problem)</p>



<a name="269035233"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/dev-guide%20suggests%20disabling%20RA%20proc%20macros/near/269035233" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> eddyb <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/dev-guide.20suggests.20disabling.20RA.20proc.20macros.html#269035233">(Jan 23 2022 at 19:38)</a>:</h4>
<p>this worked for me:</p>
<div class="codehilite" data-code-language="Bash"><pre><span></span><code>env <span class="nv">CFG_RELEASE</span><span class="o">=</span> <span class="nv">CFG_RELEASE_CHANNEL</span><span class="o">=</span> <span class="nv">RUSTC_INSTALL_BINDIR</span><span class="o">=</span> cargo check -p rustc_driver
</code></pre></div>



<a name="269035598"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/dev-guide%20suggests%20disabling%20RA%20proc%20macros/near/269035598" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> eddyb <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/dev-guide.20suggests.20disabling.20RA.20proc.20macros.html#269035598">(Jan 23 2022 at 19:46)</a>:</h4>
<p>left a comment at <a href="https://github.com/rust-analyzer/rust-analyzer/issues/9201#issuecomment-1019554086">https://github.com/rust-analyzer/rust-analyzer/issues/9201#issuecomment-1019554086</a></p>



<a name="269077592"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/dev-guide%20suggests%20disabling%20RA%20proc%20macros/near/269077592" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Daniel Mcnab <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/dev-guide.20suggests.20disabling.20RA.20proc.20macros.html#269077592">(Jan 24 2022 at 09:20)</a>:</h4>
<p>I don't know what happens, but I agree it's annoying<br>
Fwiw, this also affects working in rust-gpu, specifically because Providers doesn't get expanded for some reason<br>
I haven't tried to root cause it</p>



<a name="269086225"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/dev-guide%20suggests%20disabling%20RA%20proc%20macros/near/269086225" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> eddyb <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/dev-guide.20suggests.20disabling.20RA.20proc.20macros.html#269086225">(Jan 24 2022 at 10:38)</a>:</h4>
<p>yupp, that is indeed how I first noticed it myself</p>



<hr><p>Last updated: Apr 12 2022 at 20:01 UTC</p>
</html>