<html>
<head><meta charset="utf-8"><title>riscv bootstrap fails · t-compiler · Zulip Chat Archive</title></head>
<h2>Stream: <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/index.html">t-compiler</a></h2>
<h3>Topic: <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/riscv.20bootstrap.20fails.html">riscv bootstrap fails</a></h3>

<hr>

<base href="https://rust-lang.zulipchat.com">

<head><link href="https://zulip-archive.rust-lang.org/style.css" rel="stylesheet"></head>

<a name="277822993"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/riscv%20bootstrap%20fails/near/277822993" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ahmed Charles <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/riscv.20bootstrap.20fails.html#277822993">(Apr 05 2022 at 03:18)</a>:</h4>
<p>The following commit seems to have broken bootstrap on 1.59 by using <code>.insn</code> while 1.58.1 does not implement <code>.insn</code>, though 1.59 does (this part I'm fuzzy on). Is there coverage/tests for bootstrapping on riscv?<br>
<a href="https://github.com/rust-lang/stdarch/commit/2adc17a5442614dbe34626fdd9b32de7c07b8086">https://github.com/rust-lang/stdarch/commit/2adc17a5442614dbe34626fdd9b32de7c07b8086</a></p>



<a name="277823034"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/riscv%20bootstrap%20fails/near/277823034" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joshua Nelson <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/riscv.20bootstrap.20fails.html#277823034">(Apr 05 2022 at 03:19)</a>:</h4>
<p>There are tests that it builds, but not that it runs.<br>
<a href="https://doc.rust-lang.org/nightly/rustc/platform-support.html">https://doc.rust-lang.org/nightly/rustc/platform-support.html</a></p>



<a name="277823090"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/riscv%20bootstrap%20fails/near/277823090" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ahmed Charles <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/riscv.20bootstrap.20fails.html#277823090">(Apr 05 2022 at 03:20)</a>:</h4>
<p>On riscv natively or cross?</p>



<a name="277823097"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/riscv%20bootstrap%20fails/near/277823097" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ahmed Charles <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/riscv.20bootstrap.20fails.html#277823097">(Apr 05 2022 at 03:20)</a>:</h4>
<p>I'm not sure whether it fails on cross compile.</p>



<a name="277823136"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/riscv%20bootstrap%20fails/near/277823136" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joshua Nelson <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/riscv.20bootstrap.20fails.html#277823136">(Apr 05 2022 at 03:21)</a>:</h4>
<p>Cross, pretty sure only tier 1 targets are built natively.</p>



<a name="277823417"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/riscv%20bootstrap%20fails/near/277823417" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ahmed Charles <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/riscv.20bootstrap.20fails.html#277823417">(Apr 05 2022 at 03:27)</a>:</h4>
<p>I guess cross builds can't be bootstrap builds by definition and therefore, only the last stage is built for the target arch?</p>



<a name="277823423"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/riscv%20bootstrap%20fails/near/277823423" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joshua Nelson <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/riscv.20bootstrap.20fails.html#277823423">(Apr 05 2022 at 03:27)</a>:</h4>
<p>Correct.</p>



<a name="277823526"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/riscv%20bootstrap%20fails/near/277823526" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ahmed Charles <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/riscv.20bootstrap.20fails.html#277823526">(Apr 05 2022 at 03:29)</a>:</h4>
<p>So, is this bug worth filing? It will be fixed in 1.60 by virtue of it using 1.59, which works (I tested it).</p>



<a name="277823616"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/riscv%20bootstrap%20fails/near/277823616" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joshua Nelson <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/riscv.20bootstrap.20fails.html#277823616">(Apr 05 2022 at 03:30)</a>:</h4>
<p>Probably not. It's very unlikely the fix will be backported to stable this late in the release cycle, and even if we wanted to support riscv as a tier 1 target I don't think GitHub has native runners for it.</p>



<a name="277823647"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/riscv%20bootstrap%20fails/near/277823647" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joshua Nelson <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/riscv.20bootstrap.20fails.html#277823647">(Apr 05 2022 at 03:31)</a>:</h4>
<p>FWIW 1.60 will be stable this Thursday :)</p>



<a name="277823734"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/riscv%20bootstrap%20fails/near/277823734" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ahmed Charles <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/riscv.20bootstrap.20fails.html#277823734">(Apr 05 2022 at 03:33)</a>:</h4>
<p>Well, I suppose I could try to bootstrap it and see if it works natively. I've been building using gentoo (great way to test compiles for everything on riscv), so I haven't dealt with the rust build directly in a while.</p>



<a name="277823795"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/riscv%20bootstrap%20fails/near/277823795" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joshua Nelson <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/riscv.20bootstrap.20fails.html#277823795">(Apr 05 2022 at 03:34)</a>:</h4>
<p>happy to help debug any build issues you run into :)</p>



<a name="277823872"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/riscv%20bootstrap%20fails/near/277823872" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ahmed Charles <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/riscv.20bootstrap.20fails.html#277823872">(Apr 05 2022 at 03:36)</a>:</h4>
<p><a href="https://github.com/rust-lang/rust/tree/beta">https://github.com/rust-lang/rust/tree/beta</a> That's the right branch that I should test if I want to report beta bugs?</p>



<a name="277823878"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/riscv%20bootstrap%20fails/near/277823878" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ahmed Charles <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/riscv.20bootstrap.20fails.html#277823878">(Apr 05 2022 at 03:36)</a>:</h4>
<p>And <a href="https://rustc-dev-guide.rust-lang.org/building/how-to-build-and-run.html">https://rustc-dev-guide.rust-lang.org/building/how-to-build-and-run.html</a> instructions should work just fine for that branch?</p>



<a name="277823902"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/riscv%20bootstrap%20fails/near/277823902" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joshua Nelson <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/riscv.20bootstrap.20fails.html#277823902">(Apr 05 2022 at 03:37)</a>:</h4>
<p>Yes, there's not been many changes to bootstrap in the last 6 weeks.</p>



<a name="277823910"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/riscv%20bootstrap%20fails/near/277823910" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joshua Nelson <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/riscv.20bootstrap.20fails.html#277823910">(Apr 05 2022 at 03:38)</a>:</h4>
<p>not sure how gentoo distributes rustc (do they distribute the tarball or do you just build from git sources?)</p>



<a name="277823952"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/riscv%20bootstrap%20fails/near/277823952" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ahmed Charles <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/riscv.20bootstrap.20fails.html#277823952">(Apr 05 2022 at 03:38)</a>:</h4>
<p>Ok, I'll try building it, I hope it finishes before Thursday (the unmatched isn't particularly fast. :P)</p>



<a name="277823975"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/riscv%20bootstrap%20fails/near/277823975" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joshua Nelson <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/riscv.20bootstrap.20fails.html#277823975">(Apr 05 2022 at 03:39)</a>:</h4>
<p>fwiw if you just want to test it compiles natively, you can run <code>x.py check</code> which should be much faster. even on relatively slow machines it shouldn't take more than a couple hours (I have a summary of hardware I use for building rustc at <a href="https://gist.github.com/jyn514/5476c7b6122a3cb18825e1b883c18a33">https://gist.github.com/jyn514/5476c7b6122a3cb18825e1b883c18a33</a>)</p>



<a name="277823989"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/riscv%20bootstrap%20fails/near/277823989" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joshua Nelson <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/riscv.20bootstrap.20fails.html#277823989">(Apr 05 2022 at 03:39)</a>:</h4>
<p>that said if you want to compile this on a Pentium it will probably take days lol</p>



<a name="277824045"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/riscv%20bootstrap%20fails/near/277824045" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ahmed Charles <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/riscv.20bootstrap.20fails.html#277824045">(Apr 05 2022 at 03:40)</a>:</h4>
<p>Gentoo downloads from <a href="https://static.rust-lang.org/dist/">https://static.rust-lang.org/dist/</a></p>



<a name="277824224"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/riscv%20bootstrap%20fails/near/277824224" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ahmed Charles <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/riscv.20bootstrap.20fails.html#277824224">(Apr 05 2022 at 03:43)</a>:</h4>
<p>I noticed gentoo should support compiling beta fairly easily, so I'll likely try that first and see.</p>



<a name="278061103"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/riscv%20bootstrap%20fails/near/278061103" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ahmed Charles <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/riscv.20bootstrap.20fails.html#278061103">(Apr 06 2022 at 17:50)</a>:</h4>
<p><code>Build completed successfully in 9:50:57</code> (It was a stage 2 build, at least.)</p>



<a name="278061244"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/riscv%20bootstrap%20fails/near/278061244" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ahmed Charles <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/riscv.20bootstrap.20fails.html#278061244">(Apr 06 2022 at 17:51)</a>:</h4>
<p>On commit <code>0f231250ba7fe3a3f98a18aee9abfd65b104fb92</code></p>



<a name="278095917"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/riscv%20bootstrap%20fails/near/278095917" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ahmed Charles <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/riscv.20bootstrap.20fails.html#278095917">(Apr 06 2022 at 22:42)</a>:</h4>
<p>Somewhat related question, I noticed that <code>riscv64gc-unknown-linux-musl</code> is only tier 3, which doesn't have official builds and therefore, can't bootstrap at all. If I cross compile (using config.toml, I assume), would I then be able to bootstrap from release to release after that (or at least, try to)?</p>



<a name="278097550"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/riscv%20bootstrap%20fails/near/278097550" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> bjorn3 <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/riscv.20bootstrap.20fails.html#278097550">(Apr 06 2022 at 23:00)</a>:</h4>
<p>It should be possible. At least on tier 1 platforms we always bootstrap rustc using the previous version.</p>



<a name="278122099"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/riscv%20bootstrap%20fails/near/278122099" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ahmed Charles <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/riscv.20bootstrap.20fails.html#278122099">(Apr 07 2022 at 06:28)</a>:</h4>
<p>Oh, while I'm at it, is there a way to have <code>riscv64-gentoo-linux-musl</code> be an alias for <code>riscv64gc-unknown-linux-musl</code>?</p>



<a name="278122695"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/riscv%20bootstrap%20fails/near/278122695" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> bjorn3 <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/riscv.20bootstrap.20fails.html#278122695">(Apr 07 2022 at 06:38)</a>:</h4>
<p>No, we don't support aliases.</p>



<a name="278122721"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/riscv%20bootstrap%20fails/near/278122721" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> bjorn3 <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/riscv.20bootstrap.20fails.html#278122721">(Apr 07 2022 at 06:39)</a>:</h4>
<p>What have you changed between the two by the way? Just crt_static being disabled by default? For that there is an open MCP to switch the musl targets to dynamic linking by default.</p>



<a name="278127342"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/riscv%20bootstrap%20fails/near/278127342" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ahmed Charles <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/riscv.20bootstrap.20fails.html#278127342">(Apr 07 2022 at 07:40)</a>:</h4>
<p>I'm not entirely sure what it changes, it's just what gentoo uses as the target and so various rust projects fail to compile due to passing a target that rust doesn't know about.</p>



<a name="278127491"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/riscv%20bootstrap%20fails/near/278127491" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ahmed Charles <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/riscv.20bootstrap.20fails.html#278127491">(Apr 07 2022 at 07:42)</a>:</h4>
<p>And technically, users can override crt_static if they want. And this is similar for x86_64, and the other musl targets for gentoo, I assume.</p>



<a name="278131863"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/riscv%20bootstrap%20fails/near/278131863" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> bjorn3 <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/riscv.20bootstrap.20fails.html#278131863">(Apr 07 2022 at 08:28)</a>:</h4>
<p>The only change is disabling crt-static by default: <a href="https://gitweb.gentoo.org/repo/gentoo.git/tree/dev-lang/rust/files/1.49.0-gentoo-musl-target-specs.patch?id=26de1e52b1122ef6cbd081048d75757ce8736d01">https://gitweb.gentoo.org/repo/gentoo.git/tree/dev-lang/rust/files/1.49.0-gentoo-musl-target-specs.patch?id=26de1e52b1122ef6cbd081048d75757ce8736d01</a></p>



<a name="278145905"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/riscv%20bootstrap%20fails/near/278145905" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ahmed Charles <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/riscv.20bootstrap.20fails.html#278145905">(Apr 07 2022 at 10:57)</a>:</h4>
<p>Interesting, thanks for pointing that out.</p>



<a name="278263819"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/riscv%20bootstrap%20fails/near/278263819" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ahmed Charles <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/riscv.20bootstrap.20fails.html#278263819">(Apr 08 2022 at 07:01)</a>:</h4>
<p>It seems that <code>x86_64-unknown-linux-musl</code> depends on <code>libgcc_s.so</code> but I'm unsure why that is. Which <code>config.toml</code> is used to build that target?</p>



<hr><p>Last updated: Apr 12 2022 at 20:01 UTC</p>
</html>