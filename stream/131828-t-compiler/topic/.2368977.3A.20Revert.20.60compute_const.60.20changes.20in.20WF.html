<html>
<head><meta charset="utf-8"><title>#68977: Revert `compute_const` changes in WF · t-compiler · Zulip Chat Archive</title></head>
<h2>Stream: <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/index.html">t-compiler</a></h2>
<h3>Topic: <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/.2368977.3A.20Revert.20.60compute_const.60.20changes.20in.20WF.html">#68977: Revert `compute_const` changes in WF</a></h3>

<hr>

<base href="https://rust-lang.zulipchat.com">

<head><link href="https://rust-lang.github.io/zulip_archive/style.css" rel="stylesheet"></head>

<a name="190982647"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/%2368977%3A%20Revert%20%60compute_const%60%20changes%20in%20WF/near/190982647" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> lcnr <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/.2368977.3A.20Revert.20.60compute_const.60.20changes.20in.20WF.html#190982647">(Mar 18 2020 at 13:54)</a>:</h4>
<p>I am currently trying to fix <a href="https://github.com/rust-lang/rust/issues/68977" target="_blank" title="https://github.com/rust-lang/rust/issues/68977">https://github.com/rust-lang/rust/issues/68977</a> and need some mentoring</p>
<p><span class="user-mention" data-user-id="121053">@varkor</span>  <span class="user-mention" data-user-id="119009">@eddyb</span></p>



<a name="190982838"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/%2368977%3A%20Revert%20%60compute_const%60%20changes%20in%20WF/near/190982838" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> eddyb <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/.2368977.3A.20Revert.20.60compute_const.60.20changes.20in.20WF.html#190982838">(Mar 18 2020 at 13:56)</a>:</h4>
<p>well, the first step would be to rename it from <code>compute_array_len</code> back to <code>compute_const</code> and fix the comment</p>



<a name="190982898"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/%2368977%3A%20Revert%20%60compute_const%60%20changes%20in%20WF/near/190982898" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> lcnr <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/.2368977.3A.20Revert.20.60compute_const.60.20changes.20in.20WF.html#190982898">(Mar 18 2020 at 13:56)</a>:</h4>
<p>as far as I understand the following changes have to be made:</p>
<ol>
<li>rename <code>compute_array_len</code> to <code>compute_const</code></li>
<li>in WfPredicates::compute, call compute_const for const parameters of adts</li>
<li>add test mentioned in the issue</li>
</ol>



<a name="190983328"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/%2368977%3A%20Revert%20%60compute_const%60%20changes%20in%20WF/near/190983328" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> eddyb <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/.2368977.3A.20Revert.20.60compute_const.60.20changes.20in.20WF.html#190983328">(Mar 18 2020 at 14:00)</a>:</h4>
<blockquote>
<p>in WfPredicates::compute, call compute_const for const parameters of adts</p>
</blockquote>
<p>ideally it would be tied to <code>Substs</code> in general, but I guess the WF code is too messy for that</p>



<a name="190983469"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/%2368977%3A%20Revert%20%60compute_const%60%20changes%20in%20WF/near/190983469" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> eddyb <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/.2368977.3A.20Revert.20.60compute_const.60.20changes.20in.20WF.html#190983469">(Mar 18 2020 at 14:01)</a>:</h4>
<p>if you add it to <code>nominal_obligations</code> that's the best way to ensure everything that has substs will be checked</p>



<a name="190983515"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/%2368977%3A%20Revert%20%60compute_const%60%20changes%20in%20WF/near/190983515" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> eddyb <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/.2368977.3A.20Revert.20.60compute_const.60.20changes.20in.20WF.html#190983515">(Mar 18 2020 at 14:01)</a>:</h4>
<p>funnily enough I just realized <code>compute_const</code> will be able to recurse through <code>nominal_obligations</code> back to <code>compute_const</code>, which is a case I missed</p>



<a name="190983611"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/%2368977%3A%20Revert%20%60compute_const%60%20changes%20in%20WF/near/190983611" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> eddyb <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/.2368977.3A.20Revert.20.60compute_const.60.20changes.20in.20WF.html#190983611">(Mar 18 2020 at 14:02)</a>:</h4>
<p>(associated consts, for example, can have their own <code>const</code> generic parameters in scope, so they also need to be checked)</p>



<a name="190984466"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/%2368977%3A%20Revert%20%60compute_const%60%20changes%20in%20WF/near/190984466" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> lcnr <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/.2368977.3A.20Revert.20.60compute_const.60.20changes.20in.20WF.html#190984466">(Mar 18 2020 at 14:08)</a>:</h4>
<p>thanks.</p>
<p>Is there a good source on what nominal in <code>nominal_obligations</code>means?</p>



<a name="190984496"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/%2368977%3A%20Revert%20%60compute_const%60%20changes%20in%20WF/near/190984496" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> eddyb <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/.2368977.3A.20Revert.20.60compute_const.60.20changes.20in.20WF.html#190984496">(Mar 18 2020 at 14:08)</a>:</h4>
<p>nominal vs structural types</p>



<a name="190984516"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/%2368977%3A%20Revert%20%60compute_const%60%20changes%20in%20WF/near/190984516" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> eddyb <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/.2368977.3A.20Revert.20.60compute_const.60.20changes.20in.20WF.html#190984516">(Mar 18 2020 at 14:09)</a>:</h4>
<p>literally "has a name". in this case, has a <code>DefId</code></p>



<a name="190984568"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/%2368977%3A%20Revert%20%60compute_const%60%20changes%20in%20WF/near/190984568" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> eddyb <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/.2368977.3A.20Revert.20.60compute_const.60.20changes.20in.20WF.html#190984568">(Mar 18 2020 at 14:09)</a>:</h4>
<p>user-defined types are nominal, a tuple or array type is structural</p>



<a name="190984611"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/%2368977%3A%20Revert%20%60compute_const%60%20changes%20in%20WF/near/190984611" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> eddyb <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/.2368977.3A.20Revert.20.60compute_const.60.20changes.20in.20WF.html#190984611">(Mar 18 2020 at 14:09)</a>:</h4>
<p><span class="user-mention" data-user-id="216206">@Bastian Kauschke</span> <a href="https://en.wikipedia.org/wiki/Nominal_type_system" target="_blank" title="https://en.wikipedia.org/wiki/Nominal_type_system">https://en.wikipedia.org/wiki/Nominal_type_system</a></p>



<a name="190988198"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/%2368977%3A%20Revert%20%60compute_const%60%20changes%20in%20WF/near/190988198" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> lcnr <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/.2368977.3A.20Revert.20.60compute_const.60.20changes.20in.20WF.html#190988198">(Mar 18 2020 at 14:34)</a>:</h4>
<p>is there a reason why <code>WfPredicate::cause</code> requires <code>&amp;mut self</code>?</p>



<a name="190988302"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/%2368977%3A%20Revert%20%60compute_const%60%20changes%20in%20WF/near/190988302" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> lcnr <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/.2368977.3A.20Revert.20.60compute_const.60.20changes.20in.20WF.html#190988302">(Mar 18 2020 at 14:35)</a>:</h4>
<div class="codehilite"><pre><span></span><span class="k">fn</span> <span class="nf">cause</span><span class="p">(</span><span class="o">&amp;</span><span class="k">mut</span><span class="w"> </span><span class="bp">self</span><span class="p">,</span><span class="w"> </span><span class="n">code</span>: <span class="nc">traits</span>::<span class="n">ObligationCauseCode</span><span class="o">&lt;</span><span class="na">&#39;tcx</span><span class="o">&gt;</span><span class="p">)</span><span class="w"> </span>-&gt; <span class="nc">traits</span>::<span class="n">ObligationCause</span><span class="o">&lt;</span><span class="na">&#39;tcx</span><span class="o">&gt;</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="n">traits</span>::<span class="n">ObligationCause</span>::<span class="n">new</span><span class="p">(</span><span class="bp">self</span><span class="p">.</span><span class="n">span</span><span class="p">,</span><span class="w"> </span><span class="bp">self</span><span class="p">.</span><span class="n">body_id</span><span class="p">,</span><span class="w"> </span><span class="n">code</span><span class="p">)</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>
</pre></div>



<a name="190988519"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/%2368977%3A%20Revert%20%60compute_const%60%20changes%20in%20WF/near/190988519" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> eddyb <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/.2368977.3A.20Revert.20.60compute_const.60.20changes.20in.20WF.html#190988519">(Mar 18 2020 at 14:36)</a>:</h4>
<p>doesn't look like it, lol</p>



<a name="190988539"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/%2368977%3A%20Revert%20%60compute_const%60%20changes%20in%20WF/near/190988539" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> eddyb <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/.2368977.3A.20Revert.20.60compute_const.60.20changes.20in.20WF.html#190988539">(Mar 18 2020 at 14:36)</a>:</h4>
<p>probably copy-paste mistake</p>



<a name="190992020"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/%2368977%3A%20Revert%20%60compute_const%60%20changes%20in%20WF/near/190992020" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> lcnr <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/.2368977.3A.20Revert.20.60compute_const.60.20changes.20in.20WF.html#190992020">(Mar 18 2020 at 14:58)</a>:</h4>
<p><span class="user-mention silent" data-user-id="119009">eddyb</span> <a href="#narrow/stream/131828-t-compiler/topic/.2368977.3A.20Revert.20.60compute_const.60.20changes.20in.20WF/near/190983469" title="#narrow/stream/131828-t-compiler/topic/.2368977.3A.20Revert.20.60compute_const.60.20changes.20in.20WF/near/190983469">said</a>:</p>
<blockquote>
<p>if you add it to <code>nominal_obligations</code> that's the best way to ensure everything that has substs will be checked</p>
</blockquote>
<p>Not quite sure how this should be done.</p>



<a name="190994241"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/%2368977%3A%20Revert%20%60compute_const%60%20changes%20in%20WF/near/190994241" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> lcnr <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/.2368977.3A.20Revert.20.60compute_const.60.20changes.20in.20WF.html#190994241">(Mar 18 2020 at 15:12)</a>:</h4>
<p>nm, should be solved</p>



<a name="190996060"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/%2368977%3A%20Revert%20%60compute_const%60%20changes%20in%20WF/near/190996060" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> lcnr <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/.2368977.3A.20Revert.20.60compute_const.60.20changes.20in.20WF.html#190996060">(Mar 18 2020 at 15:24)</a>:</h4>
<p><a href="https://github.com/rust-lang/rust/pull/70107" target="_blank" title="https://github.com/rust-lang/rust/pull/70107">https://github.com/rust-lang/rust/pull/70107</a> not yet tested</p>



<a name="190997130"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/%2368977%3A%20Revert%20%60compute_const%60%20changes%20in%20WF/near/190997130" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> lcnr <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/.2368977.3A.20Revert.20.60compute_const.60.20changes.20in.20WF.html#190997130">(Mar 18 2020 at 15:30)</a>:</h4>
<p>how should I test that the substs must now be const evaluatable?</p>



<a name="191000474"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/%2368977%3A%20Revert%20%60compute_const%60%20changes%20in%20WF/near/191000474" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> eddyb <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/.2368977.3A.20Revert.20.60compute_const.60.20changes.20in.20WF.html#191000474">(Mar 18 2020 at 15:53)</a>:</h4>
<p><span class="user-mention" data-user-id="216206">@Bastian Kauschke</span> you don't need to return anything, you can push to <code>self.out</code> directly</p>



<a name="191000533"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/%2368977%3A%20Revert%20%60compute_const%60%20changes%20in%20WF/near/191000533" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> eddyb <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/.2368977.3A.20Revert.20.60compute_const.60.20changes.20in.20WF.html#191000533">(Mar 18 2020 at 15:53)</a>:</h4>
<p>that is, this would be a side-effect of <code>nominal_obligations</code>, not part of what it returns</p>



<a name="191003341"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/%2368977%3A%20Revert%20%60compute_const%60%20changes%20in%20WF/near/191003341" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> eddyb <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/.2368977.3A.20Revert.20.60compute_const.60.20changes.20in.20WF.html#191003341">(Mar 18 2020 at 16:10)</a>:</h4>
<p>like, <code>nominal_obligations</code> is just a good place to hijack</p>



<a name="191003432"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/%2368977%3A%20Revert%20%60compute_const%60%20changes%20in%20WF/near/191003432" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> lcnr <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/.2368977.3A.20Revert.20.60compute_const.60.20changes.20in.20WF.html#191003432">(Mar 18 2020 at 16:11)</a>:</h4>
<p>Isn't that kind of ugly though? returning something that is added to <code>self.out</code> 5 out of 6 times and modifying <code>self.out</code> internally at the same time?</p>



<a name="191003493"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/%2368977%3A%20Revert%20%60compute_const%60%20changes%20in%20WF/near/191003493" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> eddyb <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/.2368977.3A.20Revert.20.60compute_const.60.20changes.20in.20WF.html#191003493">(Mar 18 2020 at 16:11)</a>:</h4>
<p>it is but that's because this entire system is using <code>Ty::walk</code></p>



<a name="191003505"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/%2368977%3A%20Revert%20%60compute_const%60%20changes%20in%20WF/near/191003505" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> eddyb <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/.2368977.3A.20Revert.20.60compute_const.60.20changes.20in.20WF.html#191003505">(Mar 18 2020 at 16:11)</a>:</h4>
<p>which is IMO terrible</p>



<a name="191003533"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/%2368977%3A%20Revert%20%60compute_const%60%20changes%20in%20WF/near/191003533" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> eddyb <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/.2368977.3A.20Revert.20.60compute_const.60.20changes.20in.20WF.html#191003533">(Mar 18 2020 at 16:11)</a>:</h4>
<p><span class="user-mention" data-user-id="116009">@nikomatsakis</span> ^^ more evidence <code>Ty::walk</code> is bad :P</p>



<a name="191003611"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/%2368977%3A%20Revert%20%60compute_const%60%20changes%20in%20WF/near/191003611" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> eddyb <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/.2368977.3A.20Revert.20.60compute_const.60.20changes.20in.20WF.html#191003611">(Mar 18 2020 at 16:12)</a>:</h4>
<p>if <code>wf</code> used <code>TypeVisitor</code> you'd just add <code>visit_const</code> and that'd be that</p>



<a name="191003736"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/%2368977%3A%20Revert%20%60compute_const%60%20changes%20in%20WF/near/191003736" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> eddyb <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/.2368977.3A.20Revert.20.60compute_const.60.20changes.20in.20WF.html#191003736">(Mar 18 2020 at 16:13)</a>:</h4>
<p>frankly this bug would likely be impossible with <code>TypeVisitor</code></p>



<a name="191003748"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/%2368977%3A%20Revert%20%60compute_const%60%20changes%20in%20WF/near/191003748" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> eddyb <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/.2368977.3A.20Revert.20.60compute_const.60.20changes.20in.20WF.html#191003748">(Mar 18 2020 at 16:13)</a>:</h4>
<p>you'd have to go out of your way to get it wrong</p>



<a name="191003965"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/%2368977%3A%20Revert%20%60compute_const%60%20changes%20in%20WF/near/191003965" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> lcnr <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/.2368977.3A.20Revert.20.60compute_const.60.20changes.20in.20WF.html#191003965">(Mar 18 2020 at 16:14)</a>:</h4>
<p>As tests are breaking compute_const shall be reverted :)</p>
<blockquote>
<p>if wf used TypeVisitor you'd just add visit_const and that'd be that</p>
</blockquote>
<p>want me to try and do this <span aria-label="thinking" class="emoji emoji-1f914" role="img" title="thinking">:thinking:</span></p>



<a name="191004093"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/%2368977%3A%20Revert%20%60compute_const%60%20changes%20in%20WF/near/191004093" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> eddyb <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/.2368977.3A.20Revert.20.60compute_const.60.20changes.20in.20WF.html#191004093">(Mar 18 2020 at 16:15)</a>:</h4>
<blockquote>
<p>want me to try and do this <span aria-label="thinking" class="emoji emoji-1f914" role="img" title="thinking">:thinking:</span></p>
</blockquote>
<p>you could try but it's probably painful</p>



<a name="191010794"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/%2368977%3A%20Revert%20%60compute_const%60%20changes%20in%20WF/near/191010794" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> lcnr <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/.2368977.3A.20Revert.20.60compute_const.60.20changes.20in.20WF.html#191010794">(Mar 18 2020 at 17:02)</a>:</h4>
<p>compute const has been reverted. Still has 2 failing ui tests and I don't know whats going on there</p>



<a name="191010934"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/%2368977%3A%20Revert%20%60compute_const%60%20changes%20in%20WF/near/191010934" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> lcnr <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/.2368977.3A.20Revert.20.60compute_const.60.20changes.20in.20WF.html#191010934">(Mar 18 2020 at 17:03)</a>:</h4>
<div class="codehilite"><pre><span></span>// check-pass

#![allow(incomplete_features, dead_code, unconditional_recursion)]
#![feature(const_generics)]

fn fact&lt;const N: usize&gt;() {
    fact::&lt;{ N - 1 }&gt;();
}

fn main() {}
</pre></div>


<p>fails with</p>
<div class="codehilite"><pre><span></span>error: internal compiler error: broken MIR in DefId(0:3 ~ issue_66205[317d]::fact[0]) (CanonicalUserTypeAnnotation { user_ty: Canonical { max_universe: U0, variables: [], value: TypeOf(DefId(0:3 ~ issue_66205[317d]::fact[0]), UserSubsts { substs: [Const { ty: usize, val: Unevaluated(DefId(0:5 ~ issue_66205[317d]::fact[0]::{{constant}}[0]), [Const { ty: usize, val: Param(N/#0) }], None) }], user_self_ty: None }) }, span: /home/programming/rust/src/test/ui/const-generics/issues/issue-66205.rs:7:5: 7:22, inferred_ty: fn() {fact::&lt;{ N - 1 }&gt;} }): bad user type AscribeUserType(fn() {fact::&lt;{ N - 1 }&gt;}, DefId(0:3 ~ issue_66205[317d]::fact[0]) UserSubsts { substs: [Const { ty: usize, val: Unevaluated(DefId(0:5 ~ issue_66205[317d]::fact[0]::{{constant}}[0]), [Const { ty: usize, val: Param(N/#0) }], None) }], user_self_ty: None }): NoSolution

thread &#39;rustc&#39; panicked at &#39;no errors encountered even though `delay_span_bug` issued&#39;, src/librustc_errors/lib.rs:360:17
note: run with `RUST_BACKTRACE=1` environment variable to display a backtrace
</pre></div>



<a name="191011061"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/%2368977%3A%20Revert%20%60compute_const%60%20changes%20in%20WF/near/191011061" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> eddyb <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/.2368977.3A.20Revert.20.60compute_const.60.20changes.20in.20WF.html#191011061">(Mar 18 2020 at 17:04)</a>:</h4>
<p>I uhhh</p>



<a name="191011144"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/%2368977%3A%20Revert%20%60compute_const%60%20changes%20in%20WF/near/191011144" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> lcnr <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/.2368977.3A.20Revert.20.60compute_const.60.20changes.20in.20WF.html#191011144">(Mar 18 2020 at 17:05)</a>:</h4>
<p>and </p>
<div class="codehilite"><pre><span></span><span class="c1">// check-pass</span>

<span class="cp">#![feature(const_generics)]</span><span class="w"></span>
<span class="c1">//~^ WARN the feature `const_generics` is incomplete and may cause the compiler to crash</span>

<span class="k">struct</span> <span class="nc">Const</span><span class="o">&lt;</span><span class="k">const</span><span class="w"> </span><span class="n">N</span>: <span class="kt">usize</span><span class="o">&gt;</span><span class="p">;</span><span class="w"></span>

<span class="k">impl</span><span class="o">&lt;</span><span class="k">const</span><span class="w"> </span><span class="n">C</span>: <span class="kt">usize</span><span class="o">&gt;</span><span class="w"> </span><span class="n">Const</span><span class="o">&lt;</span><span class="p">{</span><span class="n">C</span><span class="p">}</span><span class="o">&gt;</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="k">fn</span> <span class="nf">successor</span><span class="p">()</span><span class="w"> </span>-&gt; <span class="nc">Const</span><span class="o">&lt;</span><span class="p">{</span><span class="n">C</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span><span class="p">}</span><span class="o">&gt;</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">        </span><span class="n">Const</span><span class="w"></span>
<span class="w">    </span><span class="p">}</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>

<span class="k">fn</span> <span class="nf">main</span><span class="p">()</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="n">_x</span>: <span class="nc">Const</span>::<span class="o">&lt;</span><span class="mi">2</span><span class="o">&gt;</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Const</span>::<span class="o">&lt;</span><span class="mi">1</span><span class="o">&gt;</span>::<span class="n">successor</span><span class="p">();</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>
</pre></div>


<p>fails with (this might actually be a wrong test? As the error is somewhat sensible</p>
<div class="codehilite"><pre><span></span><span class="n">warning</span>: <span class="nc">the</span><span class="w"> </span><span class="n">feature</span><span class="w"> </span><span class="err">`</span><span class="n">const_generics</span><span class="err">`</span><span class="w"> </span><span class="n">is</span><span class="w"> </span><span class="n">incomplete</span><span class="w"> </span><span class="n">and</span><span class="w"> </span><span class="n">may</span><span class="w"> </span><span class="n">cause</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">compiler</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="n">crash</span><span class="w"></span>
<span class="w">  </span><span class="o">-</span>-&gt; <span class="o">/</span><span class="n">home</span><span class="o">/</span><span class="n">programming</span><span class="o">/</span><span class="n">rust</span><span class="o">/</span><span class="n">src</span><span class="o">/</span><span class="n">test</span><span class="o">/</span><span class="n">ui</span><span class="o">/</span><span class="k">const</span><span class="o">-</span><span class="n">generics</span><span class="o">/</span><span class="n">issues</span><span class="o">/</span><span class="n">issue</span><span class="o">-</span><span class="mf">61747.</span><span class="n">rs</span>:<span class="mi">3</span>:<span class="mi">12</span><span class="w"></span>
<span class="w">   </span><span class="o">|</span><span class="w"></span>
<span class="n">LL</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="cp">#![feature(const_generics)]</span><span class="w"></span>
<span class="w">   </span><span class="o">|</span><span class="w">            </span><span class="o">^^^^^^^^^^^^^^</span><span class="w"></span>
<span class="w">   </span><span class="o">|</span><span class="w"></span>
<span class="w">   </span><span class="o">=</span><span class="w"> </span><span class="n">note</span>: <span class="err">`</span><span class="cp">#[warn(incomplete_features)]</span><span class="err">`</span><span class="w"> </span><span class="n">on</span><span class="w"> </span><span class="n">by</span><span class="w"> </span><span class="n">default</span><span class="w"></span>

<span class="n">error</span>: <span class="nc">constant</span><span class="w"> </span><span class="n">expression</span><span class="w"> </span><span class="n">depends</span><span class="w"> </span><span class="n">on</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="n">generic</span><span class="w"> </span><span class="n">parameter</span><span class="w"></span>
<span class="w">  </span><span class="o">-</span>-&gt; <span class="o">/</span><span class="n">home</span><span class="o">/</span><span class="n">programming</span><span class="o">/</span><span class="n">rust</span><span class="o">/</span><span class="n">src</span><span class="o">/</span><span class="n">test</span><span class="o">/</span><span class="n">ui</span><span class="o">/</span><span class="k">const</span><span class="o">-</span><span class="n">generics</span><span class="o">/</span><span class="n">issues</span><span class="o">/</span><span class="n">issue</span><span class="o">-</span><span class="mf">61747.</span><span class="n">rs</span>:<span class="mi">9</span>:<span class="mi">23</span><span class="w"></span>
<span class="w">   </span><span class="o">|</span><span class="w"></span>
<span class="n">LL</span><span class="w"> </span><span class="o">|</span><span class="w">     </span><span class="k">fn</span> <span class="nf">successor</span><span class="p">()</span><span class="w"> </span>-&gt; <span class="nc">Const</span><span class="o">&lt;</span><span class="p">{</span><span class="n">C</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span><span class="p">}</span><span class="o">&gt;</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">   </span><span class="o">|</span><span class="w">                       </span><span class="o">^^^^^^^^^^^^^^</span><span class="w"></span>
<span class="w">   </span><span class="o">|</span><span class="w"></span>
<span class="w">   </span><span class="o">=</span><span class="w"> </span><span class="n">note</span>: <span class="nc">this</span><span class="w"> </span><span class="n">may</span><span class="w"> </span><span class="n">fail</span><span class="w"> </span><span class="n">depending</span><span class="w"> </span><span class="n">on</span><span class="w"> </span><span class="n">what</span><span class="w"> </span><span class="n">value</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">parameter</span><span class="w"> </span><span class="n">takes</span><span class="w"></span>

<span class="n">error</span>: <span class="nc">aborting</span><span class="w"> </span><span class="n">due</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="n">previous</span><span class="w"> </span><span class="n">error</span><span class="w"></span>
</pre></div>



<a name="191011190"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/%2368977%3A%20Revert%20%60compute_const%60%20changes%20in%20WF/near/191011190" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> eddyb <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/.2368977.3A.20Revert.20.60compute_const.60.20changes.20in.20WF.html#191011190">(Mar 18 2020 at 17:05)</a>:</h4>
<p>that one is correct</p>



<a name="191011211"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/%2368977%3A%20Revert%20%60compute_const%60%20changes%20in%20WF/near/191011211" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> eddyb <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/.2368977.3A.20Revert.20.60compute_const.60.20changes.20in.20WF.html#191011211">(Mar 18 2020 at 17:05)</a>:</h4>
<p>it's equivalent to the one <span class="user-mention" data-user-id="121053">@varkor</span> linked</p>



<a name="191011228"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/%2368977%3A%20Revert%20%60compute_const%60%20changes%20in%20WF/near/191011228" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> eddyb <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/.2368977.3A.20Revert.20.60compute_const.60.20changes.20in.20WF.html#191011228">(Mar 18 2020 at 17:05)</a>:</h4>
<p>as in, it should error</p>



<a name="191011348"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/%2368977%3A%20Revert%20%60compute_const%60%20changes%20in%20WF/near/191011348" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> lcnr <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/.2368977.3A.20Revert.20.60compute_const.60.20changes.20in.20WF.html#191011348">(Mar 18 2020 at 17:06)</a>:</h4>
<p>great! that leaves me with <code>src/test/ui/const-generics/issues/issue-66205.rs</code></p>



<a name="191011432"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/%2368977%3A%20Revert%20%60compute_const%60%20changes%20in%20WF/near/191011432" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> eddyb <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/.2368977.3A.20Revert.20.60compute_const.60.20changes.20in.20WF.html#191011432">(Mar 18 2020 at 17:07)</a>:</h4>
<p>that one is weird as heck</p>



<a name="191011438"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/%2368977%3A%20Revert%20%60compute_const%60%20changes%20in%20WF/near/191011438" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> eddyb <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/.2368977.3A.20Revert.20.60compute_const.60.20changes.20in.20WF.html#191011438">(Mar 18 2020 at 17:07)</a>:</h4>
<p>how does it not fail type-checking?</p>



<a name="191011463"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/%2368977%3A%20Revert%20%60compute_const%60%20changes%20in%20WF/near/191011463" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> eddyb <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/.2368977.3A.20Revert.20.60compute_const.60.20changes.20in.20WF.html#191011463">(Mar 18 2020 at 17:07)</a>:</h4>
<p><code>fact::&lt;{ N - 1 }&gt;</code> shouldn't be WF</p>



<a name="191012540"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/%2368977%3A%20Revert%20%60compute_const%60%20changes%20in%20WF/near/191012540" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> lcnr <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/.2368977.3A.20Revert.20.60compute_const.60.20changes.20in.20WF.html#191012540">(Mar 18 2020 at 17:15)</a>:</h4>
<p>currently rerunning all tests as I might have started this test while I was not yet finished, even if I am doubtful.</p>



<a name="191016324"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/%2368977%3A%20Revert%20%60compute_const%60%20changes%20in%20WF/near/191016324" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> lcnr <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/.2368977.3A.20Revert.20.60compute_const.60.20changes.20in.20WF.html#191016324">(Mar 18 2020 at 17:40)</a>:</h4>
<p>seems like this is an actual bug <span aria-label="shrug" class="emoji emoji-1f937" role="img" title="shrug">:shrug:</span></p>



<a name="191116628"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/%2368977%3A%20Revert%20%60compute_const%60%20changes%20in%20WF/near/191116628" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> lcnr <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/.2368977.3A.20Revert.20.60compute_const.60.20changes.20in.20WF.html#191116628">(Mar 19 2020 at 14:00)</a>:</h4>
<p>do you know where the  WF of generic params of expressions are checked?</p>
<p><code>let a = expr::&lt;Ty&gt;()</code></p>



<a name="191117726"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/%2368977%3A%20Revert%20%60compute_const%60%20changes%20in%20WF/near/191117726" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> eddyb <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/.2368977.3A.20Revert.20.60compute_const.60.20changes.20in.20WF.html#191117726">(Mar 19 2020 at 14:08)</a>:</h4>
<p><span class="user-mention" data-user-id="216206">@Bastian Kauschke</span> let me look, I forgot about it</p>



<a name="191117817"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/%2368977%3A%20Revert%20%60compute_const%60%20changes%20in%20WF/near/191117817" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> eddyb <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/.2368977.3A.20Revert.20.60compute_const.60.20changes.20in.20WF.html#191117817">(Mar 19 2020 at 14:09)</a>:</h4>
<p>so this handles the overall process <a href="https://github.com/rust-lang/rust/blob/master/src/librustc_typeck/check/mod.rs#L5339" target="_blank" title="https://github.com/rust-lang/rust/blob/master/src/librustc_typeck/check/mod.rs#L5339">https://github.com/rust-lang/rust/blob/master/src/librustc_typeck/check/mod.rs#L5339</a></p>



<a name="191118006"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/%2368977%3A%20Revert%20%60compute_const%60%20changes%20in%20WF/near/191118006" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> eddyb <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/.2368977.3A.20Revert.20.60compute_const.60.20changes.20in.20WF.html#191118006">(Mar 19 2020 at 14:10)</a>:</h4>
<p>not seeing any WF checks in any of this <a href="https://github.com/rust-lang/rust/blob/master/src/librustc_typeck/check/mod.rs#L5495-L5611" target="_blank" title="https://github.com/rust-lang/rust/blob/master/src/librustc_typeck/check/mod.rs#L5495-L5611">https://github.com/rust-lang/rust/blob/master/src/librustc_typeck/check/mod.rs#L5495-L5611</a></p>



<a name="191118052"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/%2368977%3A%20Revert%20%60compute_const%60%20changes%20in%20WF/near/191118052" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> eddyb <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/.2368977.3A.20Revert.20.60compute_const.60.20changes.20in.20WF.html#191118052">(Mar 19 2020 at 14:10)</a>:</h4>
<p>/me pokes <span class="user-mention" data-user-id="116009">@nikomatsakis</span> - where is WF for value paths supposed to be checked?</p>



<a name="191118118"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/%2368977%3A%20Revert%20%60compute_const%60%20changes%20in%20WF/near/191118118" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> eddyb <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/.2368977.3A.20Revert.20.60compute_const.60.20changes.20in.20WF.html#191118118">(Mar 19 2020 at 14:11)</a>:</h4>
<p><span class="user-mention" data-user-id="216206">@Bastian Kauschke</span> does <code>drop::&lt;Foo&lt;{ N - 1 }&gt;&gt;;</code> (not calling just mentioning the type) cause an error?</p>



<a name="191118404"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/%2368977%3A%20Revert%20%60compute_const%60%20changes%20in%20WF/near/191118404" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/.2368977.3A.20Revert.20.60compute_const.60.20changes.20in.20WF.html#191118404">(Mar 19 2020 at 14:13)</a>:</h4>
<p>mmmmmmm let me remember :)</p>



<a name="191118431"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/%2368977%3A%20Revert%20%60compute_const%60%20changes%20in%20WF/near/191118431" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> eddyb <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/.2368977.3A.20Revert.20.60compute_const.60.20changes.20in.20WF.html#191118431">(Mar 19 2020 at 14:13)</a>:</h4>
<p>oh so <code>to_ty</code> handles it <a href="https://github.com/rust-lang/rust/blob/master/src/librustc_typeck/check/mod.rs#L3267-L3271" target="_blank" title="https://github.com/rust-lang/rust/blob/master/src/librustc_typeck/check/mod.rs#L3267-L3271">https://github.com/rust-lang/rust/blob/master/src/librustc_typeck/check/mod.rs#L3267-L3271</a></p>



<a name="191118503"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/%2368977%3A%20Revert%20%60compute_const%60%20changes%20in%20WF/near/191118503" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> eddyb <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/.2368977.3A.20Revert.20.60compute_const.60.20changes.20in.20WF.html#191118503">(Mar 19 2020 at 14:14)</a>:</h4>
<p>kind of disturbing that one could accidentally call <code>AstConv::ast_ty_to_ty</code> which will let things pass through</p>



<a name="191118524"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/%2368977%3A%20Revert%20%60compute_const%60%20changes%20in%20WF/near/191118524" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> eddyb <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/.2368977.3A.20Revert.20.60compute_const.60.20changes.20in.20WF.html#191118524">(Mar 19 2020 at 14:14)</a>:</h4>
<p><span class="user-mention" data-user-id="116009">@nikomatsakis</span> thank goodness MIR typeck exists</p>



<a name="191118704"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/%2368977%3A%20Revert%20%60compute_const%60%20changes%20in%20WF/near/191118704" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> eddyb <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/.2368977.3A.20Revert.20.60compute_const.60.20changes.20in.20WF.html#191118704">(Mar 19 2020 at 14:15)</a>:</h4>
<p>wat <a href="https://github.com/rust-lang/rust/search?q=add_wf_bounds&amp;unscoped_q=add_wf_bounds" target="_blank" title="https://github.com/rust-lang/rust/search?q=add_wf_bounds&amp;unscoped_q=add_wf_bounds">https://github.com/rust-lang/rust/search?q=add_wf_bounds&amp;unscoped_q=add_wf_bounds</a></p>



<a name="191118874"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/%2368977%3A%20Revert%20%60compute_const%60%20changes%20in%20WF/near/191118874" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> lcnr <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/.2368977.3A.20Revert.20.60compute_const.60.20changes.20in.20WF.html#191118874">(Mar 19 2020 at 14:16)</a>:</h4>
<div class="codehilite"><pre><span></span><span class="cp">#![feature(const_generics)]</span><span class="w"></span>

<span class="k">struct</span> <span class="nc">Foo</span><span class="o">&lt;</span><span class="k">const</span><span class="w"> </span><span class="n">N</span>: <span class="kt">usize</span><span class="o">&gt;</span><span class="p">;</span><span class="w"></span>

<span class="k">fn</span> <span class="nf">test</span><span class="o">&lt;</span><span class="k">const</span><span class="w"> </span><span class="n">N</span>: <span class="kt">usize</span><span class="o">&gt;</span><span class="p">()</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="n">drop_fn</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">std</span>::<span class="n">mem</span>::<span class="n">drop</span>::<span class="o">&lt;</span><span class="n">Foo</span><span class="o">&lt;</span><span class="p">{</span><span class="n">N</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="mi">1</span><span class="p">}</span><span class="o">&gt;&gt;</span><span class="p">;</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>

<span class="k">fn</span> <span class="nf">main</span><span class="p">()</span><span class="w"> </span><span class="p">{}</span><span class="w"></span>
</pre></div>


<p>returns the desired error</p>



<a name="191118905"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/%2368977%3A%20Revert%20%60compute_const%60%20changes%20in%20WF/near/191118905" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> eddyb <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/.2368977.3A.20Revert.20.60compute_const.60.20changes.20in.20WF.html#191118905">(Mar 19 2020 at 14:16)</a>:</h4>
<p>anyway this is where substitutions to value paths get checked <a href="https://github.com/rust-lang/rust/blob/master/src/librustc_typeck/check/expr.rs#L534" target="_blank" title="https://github.com/rust-lang/rust/blob/master/src/librustc_typeck/check/expr.rs#L534">https://github.com/rust-lang/rust/blob/master/src/librustc_typeck/check/expr.rs#L534</a></p>



<a name="191118998"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/%2368977%3A%20Revert%20%60compute_const%60%20changes%20in%20WF/near/191118998" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> eddyb <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/.2368977.3A.20Revert.20.60compute_const.60.20changes.20in.20WF.html#191118998">(Mar 19 2020 at 14:17)</a>:</h4>
<p><span class="user-mention" data-user-id="216206">@Bastian Kauschke</span> so you'd have to somehow handle consts here <a href="https://github.com/rust-lang/rust/blob/master/src/librustc_typeck/check/mod.rs#L3341-L3348" target="_blank" title="https://github.com/rust-lang/rust/blob/master/src/librustc_typeck/check/mod.rs#L3341-L3348">https://github.com/rust-lang/rust/blob/master/src/librustc_typeck/check/mod.rs#L3341-L3348</a></p>



<a name="191119057"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/%2368977%3A%20Revert%20%60compute_const%60%20changes%20in%20WF/near/191119057" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> eddyb <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/.2368977.3A.20Revert.20.60compute_const.60.20changes.20in.20WF.html#191119057">(Mar 19 2020 at 14:17)</a>:</h4>
<p>maybe we can replace the <code>ConstEvaluatable</code> bound with <code>WellFormedConst</code> that takes a <code>&amp;'tcx ty::Const&lt;'tcx&gt;</code>, or something</p>



<a name="191119138"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/%2368977%3A%20Revert%20%60compute_const%60%20changes%20in%20WF/near/191119138" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> eddyb <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/.2368977.3A.20Revert.20.60compute_const.60.20changes.20in.20WF.html#191119138">(Mar 19 2020 at 14:18)</a>:</h4>
<p>wait, we have to, otherwise const inference variables wouldn't get checked</p>



<a name="191119175"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/%2368977%3A%20Revert%20%60compute_const%60%20changes%20in%20WF/near/191119175" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> eddyb <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/.2368977.3A.20Revert.20.60compute_const.60.20changes.20in.20WF.html#191119175">(Mar 19 2020 at 14:18)</a>:</h4>
<p><span class="user-mention" data-user-id="121053">@varkor</span> <span class="user-mention" data-user-id="218608">@yodal</span> ^^ oops how did I miss this</p>



<a name="191119249"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/%2368977%3A%20Revert%20%60compute_const%60%20changes%20in%20WF/near/191119249" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> eddyb <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/.2368977.3A.20Revert.20.60compute_const.60.20changes.20in.20WF.html#191119249">(Mar 19 2020 at 14:19)</a>:</h4>
<p><a href="https://github.com/rust-lang/rust/blob/master/src/librustc_trait_selection/traits/wf.rs#L556-L593" target="_blank" title="https://github.com/rust-lang/rust/blob/master/src/librustc_trait_selection/traits/wf.rs#L556-L593">https://github.com/rust-lang/rust/blob/master/src/librustc_trait_selection/traits/wf.rs#L556-L593</a> needs a const analogue</p>



<a name="191121539"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/%2368977%3A%20Revert%20%60compute_const%60%20changes%20in%20WF/near/191121539" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> varkor <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/.2368977.3A.20Revert.20.60compute_const.60.20changes.20in.20WF.html#191121539">(Mar 19 2020 at 14:34)</a>:</h4>
<p>there were so many things to make sure we replicated for consts; it's not surprising that a few have slipped through, even till now</p>



<a name="191121595"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/%2368977%3A%20Revert%20%60compute_const%60%20changes%20in%20WF/near/191121595" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> varkor <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/.2368977.3A.20Revert.20.60compute_const.60.20changes.20in.20WF.html#191121595">(Mar 19 2020 at 14:34)</a>:</h4>
<p>maybe uses of <code>substs.types()</code> are a bit of a red flag</p>



<a name="191121614"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/%2368977%3A%20Revert%20%60compute_const%60%20changes%20in%20WF/near/191121614" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> varkor <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/.2368977.3A.20Revert.20.60compute_const.60.20changes.20in.20WF.html#191121614">(Mar 19 2020 at 14:35)</a>:</h4>
<p>or, at the least, we should audit them</p>



<a name="191122414"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/%2368977%3A%20Revert%20%60compute_const%60%20changes%20in%20WF/near/191122414" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> eddyb <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/.2368977.3A.20Revert.20.60compute_const.60.20changes.20in.20WF.html#191122414">(Mar 19 2020 at 14:41)</a>:</h4>
<p>yeaaah</p>



<a name="191122474"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/%2368977%3A%20Revert%20%60compute_const%60%20changes%20in%20WF/near/191122474" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> eddyb <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/.2368977.3A.20Revert.20.60compute_const.60.20changes.20in.20WF.html#191122474">(Mar 19 2020 at 14:41)</a>:</h4>
<p><span class="user-mention" data-user-id="121053">@varkor</span> maybe I should go try and get rid of as many uses of <code>Ty::walk</code> as possible</p>



<a name="191122589"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/%2368977%3A%20Revert%20%60compute_const%60%20changes%20in%20WF/near/191122589" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> eddyb <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/.2368977.3A.20Revert.20.60compute_const.60.20changes.20in.20WF.html#191122589">(Mar 19 2020 at 14:41)</a>:</h4>
<p>it's cute but <code>Visitor</code> makes more sense - the other option is changing it to give you <code>GenericArg</code>s which... idk</p>



<a name="191122655"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/%2368977%3A%20Revert%20%60compute_const%60%20changes%20in%20WF/near/191122655" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> varkor <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/.2368977.3A.20Revert.20.60compute_const.60.20changes.20in.20WF.html#191122655">(Mar 19 2020 at 14:42)</a>:</h4>
<p>I'm sure you'd come across a bug or two if you did</p>



<a name="191122656"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/%2368977%3A%20Revert%20%60compute_const%60%20changes%20in%20WF/near/191122656" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> eddyb <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/.2368977.3A.20Revert.20.60compute_const.60.20changes.20in.20WF.html#191122656">(Mar 19 2020 at 14:42)</a>:</h4>
<p>the name <code>GenericArg</code> still bothers me when used outside <code>Substs</code> :P</p>



<a name="191122852"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/%2368977%3A%20Revert%20%60compute_const%60%20changes%20in%20WF/near/191122852" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> varkor <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/.2368977.3A.20Revert.20.60compute_const.60.20changes.20in.20WF.html#191122852">(Mar 19 2020 at 14:43)</a>:</h4>
<p>speaking of refactorings, I'd like to go through and make sure that nothing depends on parameter order anywhere</p>



<a name="191122902"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/%2368977%3A%20Revert%20%60compute_const%60%20changes%20in%20WF/near/191122902" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> varkor <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/.2368977.3A.20Revert.20.60compute_const.60.20changes.20in.20WF.html#191122902">(Mar 19 2020 at 14:43)</a>:</h4>
<p>but I just don't have enough time at the moment :|</p>



<a name="191123019"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/%2368977%3A%20Revert%20%60compute_const%60%20changes%20in%20WF/near/191123019" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> varkor <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/.2368977.3A.20Revert.20.60compute_const.60.20changes.20in.20WF.html#191123019">(Mar 19 2020 at 14:44)</a>:</h4>
<p>I'm reasonably satisfied with the names we have at the moment :P</p>



<a name="191123046"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/%2368977%3A%20Revert%20%60compute_const%60%20changes%20in%20WF/near/191123046" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> varkor <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/.2368977.3A.20Revert.20.60compute_const.60.20changes.20in.20WF.html#191123046">(Mar 19 2020 at 14:44)</a>:</h4>
<p>but maybe just because they changed so frequently</p>



<a name="191125291"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/%2368977%3A%20Revert%20%60compute_const%60%20changes%20in%20WF/near/191125291" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> lcnr <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/.2368977.3A.20Revert.20.60compute_const.60.20changes.20in.20WF.html#191125291">(Mar 19 2020 at 14:59)</a>:</h4>
<p>what is that error? <span aria-label="laughing" class="emoji emoji-1f606" role="img" title="laughing">:laughing:</span> </p>
<div class="codehilite"><pre><span></span>error[E0261]: use of undeclared lifetime name `&#39;txc`
    --&gt; src/librustc/ty/mod.rs:1236:22
     |
1236 |     WellFormedConst(&amp;&#39;txc ty::Const&lt;&#39;tcx&gt;),
     |                      ^^^^ undeclared lifetime
     |
help: consider introducing lifetime `&#39;txc` here
     |
1201 | pub enum Predicate&lt;&#39;txc, &#39;tcx&gt; {
     |                    ^^^^^
help: consider introducing lifetime `&#39;txc` here
     |
1199 | #[derive(&lt;&#39;txc&gt;, Copy, PartialEq, Eq, Hash, RustcEncodable, RustcDecodable)]
     |          ^^^^^^
</pre></div>



<a name="191125350"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/%2368977%3A%20Revert%20%60compute_const%60%20changes%20in%20WF/near/191125350" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> lcnr <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/.2368977.3A.20Revert.20.60compute_const.60.20changes.20in.20WF.html#191125350">(Mar 19 2020 at 14:59)</a>:</h4>
<p>since when can lifetimes be derived</p>



<a name="191126754"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/%2368977%3A%20Revert%20%60compute_const%60%20changes%20in%20WF/near/191126754" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> eddyb <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/.2368977.3A.20Revert.20.60compute_const.60.20changes.20in.20WF.html#191126754">(Mar 19 2020 at 15:08)</a>:</h4>
<p>open an issue about "considering introducing lifetime here" I guess, it shouldn't propose a suggestion at the second span</p>



<a name="191128017"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/%2368977%3A%20Revert%20%60compute_const%60%20changes%20in%20WF/near/191128017" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> lcnr <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/.2368977.3A.20Revert.20.60compute_const.60.20changes.20in.20WF.html#191128017">(Mar 19 2020 at 15:17)</a>:</h4>
<p><a href="https://play.rust-lang.org/?version=stable&amp;mode=debug&amp;edition=2018&amp;gist=f20a60d4dcff2873ee83bfa8d4c0f677" target="_blank" title="https://play.rust-lang.org/?version=stable&amp;mode=debug&amp;edition=2018&amp;gist=f20a60d4dcff2873ee83bfa8d4c0f677">https://play.rust-lang.org/?version=stable&amp;mode=debug&amp;edition=2018&amp;gist=f20a60d4dcff2873ee83bfa8d4c0f677</a> </p>
<p>And I thought that compilers make some kind of sense.</p>



<a name="191129012"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/%2368977%3A%20Revert%20%60compute_const%60%20changes%20in%20WF/near/191129012" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> eddyb <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/.2368977.3A.20Revert.20.60compute_const.60.20changes.20in.20WF.html#191129012">(Mar 19 2020 at 15:24)</a>:</h4>
<p>oh god many of the <code>input_types</code> uses are coupled with <code>Ty::walk</code>, so I have to fix that to iterate over <code>GenericArg</code> first</p>



<a name="191129194"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/%2368977%3A%20Revert%20%60compute_const%60%20changes%20in%20WF/near/191129194" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> lcnr <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/.2368977.3A.20Revert.20.60compute_const.60.20changes.20in.20WF.html#191129194">(Mar 19 2020 at 15:25)</a>:</h4>
<p><span class="user-mention" data-user-id="119009">@eddyb</span>  should I try and replace ConstEvaluatable with WellFormedConst or would this clash with your current efforts?</p>



<a name="191129397"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/%2368977%3A%20Revert%20%60compute_const%60%20changes%20in%20WF/near/191129397" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> eddyb <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/.2368977.3A.20Revert.20.60compute_const.60.20changes.20in.20WF.html#191129397">(Mar 19 2020 at 15:27)</a>:</h4>
<p>it might idk</p>



<a name="191129446"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/%2368977%3A%20Revert%20%60compute_const%60%20changes%20in%20WF/near/191129446" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> eddyb <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/.2368977.3A.20Revert.20.60compute_const.60.20changes.20in.20WF.html#191129446">(Mar 19 2020 at 15:27)</a>:</h4>
<p>if I change <code>Ty::walk</code> to be all about <code>GenericArg</code>, we can do the main change of the PR much better</p>



<a name="191132925"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/%2368977%3A%20Revert%20%60compute_const%60%20changes%20in%20WF/near/191132925" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> lcnr <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/.2368977.3A.20Revert.20.60compute_const.60.20changes.20in.20WF.html#191132925">(Mar 19 2020 at 15:51)</a>:</h4>
<p>hmm,</p>
<p>are there other issues I might help with?</p>



<a name="191133018"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/%2368977%3A%20Revert%20%60compute_const%60%20changes%20in%20WF/near/191133018" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> lcnr <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/.2368977.3A.20Revert.20.60compute_const.60.20changes.20in.20WF.html#191133018">(Mar 19 2020 at 15:52)</a>:</h4>
<p>Will stop working on this for now until you re done</p>



<a name="191163313"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/%2368977%3A%20Revert%20%60compute_const%60%20changes%20in%20WF/near/191163313" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> eddyb <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/.2368977.3A.20Revert.20.60compute_const.60.20changes.20in.20WF.html#191163313">(Mar 19 2020 at 19:25)</a>:</h4>
<p><span class="user-mention" data-user-id="216206">@Bastian Kauschke</span> okay this is my first step <a href="https://github.com/rust-lang/rust/pull/70164" target="_blank" title="https://github.com/rust-lang/rust/pull/70164">https://github.com/rust-lang/rust/pull/70164</a></p>



<a name="191163383"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/%2368977%3A%20Revert%20%60compute_const%60%20changes%20in%20WF/near/191163383" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> eddyb <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/.2368977.3A.20Revert.20.60compute_const.60.20changes.20in.20WF.html#191163383">(Mar 19 2020 at 19:26)</a>:</h4>
<p>if perf doesn't look too bad, I'll proceed to implement it fully</p>



<a name="191165239"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/%2368977%3A%20Revert%20%60compute_const%60%20changes%20in%20WF/near/191165239" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> eddyb <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/.2368977.3A.20Revert.20.60compute_const.60.20changes.20in.20WF.html#191165239">(Mar 19 2020 at 19:42)</a>:</h4>
<p><span class="user-mention" data-user-id="216206">@Bastian Kauschke</span> I think you could add <code>WellFormedConst</code> today <a href="https://github.com/rust-lang/rust/pull/70107#issuecomment-601379924" target="_blank" title="https://github.com/rust-lang/rust/pull/70107#issuecomment-601379924">https://github.com/rust-lang/rust/pull/70107#issuecomment-601379924</a></p>



<a name="191165298"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/%2368977%3A%20Revert%20%60compute_const%60%20changes%20in%20WF/near/191165298" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> eddyb <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/.2368977.3A.20Revert.20.60compute_const.60.20changes.20in.20WF.html#191165298">(Mar 19 2020 at 19:42)</a>:</h4>
<p>it would suck a bit but not as much as I thought originally</p>



<a name="191165336"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/%2368977%3A%20Revert%20%60compute_const%60%20changes%20in%20WF/near/191165336" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> eddyb <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/.2368977.3A.20Revert.20.60compute_const.60.20changes.20in.20WF.html#191165336">(Mar 19 2020 at 19:42)</a>:</h4>
<p>you'd just need another entry-point in <code>wf.rs</code> that takes a <code>ty::Const</code> and calls <code>compute_const</code></p>



<a name="191165999"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/%2368977%3A%20Revert%20%60compute_const%60%20changes%20in%20WF/near/191165999" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> lcnr <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/.2368977.3A.20Revert.20.60compute_const.60.20changes.20in.20WF.html#191165999">(Mar 19 2020 at 19:48)</a>:</h4>
<p>will try</p>



<a name="191167858"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/%2368977%3A%20Revert%20%60compute_const%60%20changes%20in%20WF/near/191167858" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> lcnr <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/.2368977.3A.20Revert.20.60compute_const.60.20changes.20in.20WF.html#191167858">(Mar 19 2020 at 20:02)</a>:</h4>
<p>am i right that calling <code>shallow_resolve</code> on a <code>InferConst</code> would not not do anything?</p>
<p>Am kind of stuck on what I can and should do with a const inference variable</p>



<a name="191176351"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/%2368977%3A%20Revert%20%60compute_const%60%20changes%20in%20WF/near/191176351" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> lcnr <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/.2368977.3A.20Revert.20.60compute_const.60.20changes.20in.20WF.html#191176351">(Mar 19 2020 at 21:15)</a>:</h4>
<div class="codehilite"><pre><span></span><span class="sd">/// Registers an obligation for checking later, during regionck, that the type `ty` must</span>
<span class="w">    </span><span class="sd">/// outlive the region `r`.</span>
<span class="w">    </span><span class="k">pub</span><span class="w"> </span><span class="k">fn</span> <span class="nf">register_wf_obligation</span><span class="p">(</span><span class="w"></span>
<span class="w">        </span><span class="o">&amp;</span><span class="bp">self</span><span class="p">,</span><span class="w"></span>
<span class="w">        </span><span class="n">ty</span>: <span class="nc">Ty</span><span class="o">&lt;</span><span class="na">&#39;tcx</span><span class="o">&gt;</span><span class="p">,</span><span class="w"></span>
<span class="w">        </span><span class="n">span</span>: <span class="nc">Span</span><span class="p">,</span><span class="w"></span>
<span class="w">        </span><span class="n">code</span>: <span class="nc">traits</span>::<span class="n">ObligationCauseCode</span><span class="o">&lt;</span><span class="na">&#39;tcx</span><span class="o">&gt;</span><span class="p">,</span><span class="w"></span>
<span class="w">    </span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">        </span><span class="c1">// WF obligations never themselves fail, so no real need to give a detailed cause:</span>
<span class="w">        </span><span class="kd">let</span><span class="w"> </span><span class="n">cause</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">traits</span>::<span class="n">ObligationCause</span>::<span class="n">new</span><span class="p">(</span><span class="n">span</span><span class="p">,</span><span class="w"> </span><span class="bp">self</span><span class="p">.</span><span class="n">body_id</span><span class="p">,</span><span class="w"> </span><span class="n">code</span><span class="p">);</span><span class="w"></span>
<span class="w">        </span><span class="bp">self</span><span class="p">.</span><span class="n">register_predicate</span><span class="p">(</span><span class="n">traits</span>::<span class="n">Obligation</span>::<span class="n">new</span><span class="p">(</span><span class="w"></span>
<span class="w">            </span><span class="n">cause</span><span class="p">,</span><span class="w"></span>
<span class="w">            </span><span class="bp">self</span><span class="p">.</span><span class="n">param_env</span><span class="p">,</span><span class="w"></span>
<span class="w">            </span><span class="n">ty</span>::<span class="n">Predicate</span>::<span class="n">WellFormed</span><span class="p">(</span><span class="n">ty</span><span class="p">),</span><span class="w"></span>
<span class="w">        </span><span class="p">));</span><span class="w"></span>
<span class="w">    </span><span class="p">}</span><span class="w"></span>
</pre></div>


<p>Is this a copy paster error?</p>



<a name="191179981"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/%2368977%3A%20Revert%20%60compute_const%60%20changes%20in%20WF/near/191179981" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> eddyb <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/.2368977.3A.20Revert.20.60compute_const.60.20changes.20in.20WF.html#191179981">(Mar 19 2020 at 21:52)</a>:</h4>
<p><span class="user-mention silent" data-user-id="216206">Bastian Kauschke</span> <a href="#narrow/stream/131828-t-compiler/topic/.2368977.3A.20Revert.20.60compute_const.60.20changes.20in.20WF/near/191167858" title="#narrow/stream/131828-t-compiler/topic/.2368977.3A.20Revert.20.60compute_const.60.20changes.20in.20WF/near/191167858">said</a>:</p>
<blockquote>
<p>am i right that calling <code>shallow_resolve</code> on a <code>InferConst</code> would not not do anything?</p>
<p>Am kind of stuck on what I can and should do with a const inference variable</p>
</blockquote>
<p>no, it would resolve the inference variable if it's since been unified</p>



<a name="191180131"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/%2368977%3A%20Revert%20%60compute_const%60%20changes%20in%20WF/near/191180131" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> eddyb <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/.2368977.3A.20Revert.20.60compute_const.60.20changes.20in.20WF.html#191180131">(Mar 19 2020 at 21:53)</a>:</h4>
<p>and what's a copy-paste error?</p>



<a name="191180188"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/%2368977%3A%20Revert%20%60compute_const%60%20changes%20in%20WF/near/191180188" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> eddyb <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/.2368977.3A.20Revert.20.60compute_const.60.20changes.20in.20WF.html#191180188">(Mar 19 2020 at 21:54)</a>:</h4>
<p>oh, the comment?</p>



<a name="191180233"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/%2368977%3A%20Revert%20%60compute_const%60%20changes%20in%20WF/near/191180233" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> eddyb <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/.2368977.3A.20Revert.20.60compute_const.60.20changes.20in.20WF.html#191180233">(Mar 19 2020 at 21:54)</a>:</h4>
<p>linking the lines on github would be clearer btw, without losing context <a href="https://github.com/rust-lang/rust/blob/master/src/librustc_typeck/check/mod.rs#L3324-L3325" target="_blank" title="https://github.com/rust-lang/rust/blob/master/src/librustc_typeck/check/mod.rs#L3324-L3325">https://github.com/rust-lang/rust/blob/master/src/librustc_typeck/check/mod.rs#L3324-L3325</a></p>



<a name="191180242"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/%2368977%3A%20Revert%20%60compute_const%60%20changes%20in%20WF/near/191180242" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> eddyb <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/.2368977.3A.20Revert.20.60compute_const.60.20changes.20in.20WF.html#191180242">(Mar 19 2020 at 21:54)</a>:</h4>
<p>and yeah it does look like that lmao</p>



<a name="191180730"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/%2368977%3A%20Revert%20%60compute_const%60%20changes%20in%20WF/near/191180730" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> lcnr <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/.2368977.3A.20Revert.20.60compute_const.60.20changes.20in.20WF.html#191180730">(Mar 19 2020 at 21:59)</a>:</h4>
<blockquote>
<p>linking the lines on github would be clearer btw, without losing context <a href="https://github.com/rust-lang/rust/blob/master/src/librustc_typeck/check/mod.rs#L3324-L3325" target="_blank" title="https://github.com/rust-lang/rust/blob/master/src/librustc_typeck/check/mod.rs#L3324-L3325">https://github.com/rust-lang/rust/blob/master/src/librustc_typeck/check/mod.rs#L3324-L3325</a></p>
</blockquote>
<p>will do! First working version is now on github. Will probably still need some cleanup/clarification!!!11</p>



<a name="191181086"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/%2368977%3A%20Revert%20%60compute_const%60%20changes%20in%20WF/near/191181086" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> eddyb <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/.2368977.3A.20Revert.20.60compute_const.60.20changes.20in.20WF.html#191181086">(Mar 19 2020 at 22:03)</a>:</h4>
<p>forgot to mention this comment, I hope you saw it <a href="https://github.com/rust-lang/rust/pull/70107#issuecomment-601434764" target="_blank" title="https://github.com/rust-lang/rust/pull/70107#issuecomment-601434764">https://github.com/rust-lang/rust/pull/70107#issuecomment-601434764</a></p>



<a name="191181128"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/%2368977%3A%20Revert%20%60compute_const%60%20changes%20in%20WF/near/191181128" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> eddyb <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/.2368977.3A.20Revert.20.60compute_const.60.20changes.20in.20WF.html#191181128">(Mar 19 2020 at 22:03)</a>:</h4>
<p>anyway using the blame function, found this: <a href="https://github.com/rust-lang/rust/commit/8d98877112d4deb3786de521457418757e010c69#diff-1d1b0d29a2e8da97c6bfb6e364d920c7R1672-R1673" target="_blank" title="https://github.com/rust-lang/rust/commit/8d98877112d4deb3786de521457418757e010c69#diff-1d1b0d29a2e8da97c6bfb6e364d920c7R1672-R1673">https://github.com/rust-lang/rust/commit/8d98877112d4deb3786de521457418757e010c69#diff-1d1b0d29a2e8da97c6bfb6e364d920c7R1672-R1673</a></p>



<a name="191181186"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/%2368977%3A%20Revert%20%60compute_const%60%20changes%20in%20WF/near/191181186" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> eddyb <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/.2368977.3A.20Revert.20.60compute_const.60.20changes.20in.20WF.html#191181186">(Mar 19 2020 at 22:04)</a>:</h4>
<p>looks like the comment was wrong from the start (cc <span class="user-mention" data-user-id="116009">@nikomatsakis</span>)</p>



<a name="191181201"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/%2368977%3A%20Revert%20%60compute_const%60%20changes%20in%20WF/near/191181201" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> eddyb <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/.2368977.3A.20Revert.20.60compute_const.60.20changes.20in.20WF.html#191181201">(Mar 19 2020 at 22:04)</a>:</h4>
<p>and in 5 years, nobody saw</p>



<a name="191181372"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/%2368977%3A%20Revert%20%60compute_const%60%20changes%20in%20WF/near/191181372" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> lcnr <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/.2368977.3A.20Revert.20.60compute_const.60.20changes.20in.20WF.html#191181372">(Mar 19 2020 at 22:06)</a>:</h4>
<blockquote>
<p>and in 5 years, nobody saw</p>
</blockquote>
<p>The Biggest Ancient Mysteries That No One Has Ever Been Able To Solve</p>



<a name="191185550"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/%2368977%3A%20Revert%20%60compute_const%60%20changes%20in%20WF/near/191185550" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> eddyb <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/.2368977.3A.20Revert.20.60compute_const.60.20changes.20in.20WF.html#191185550">(Mar 19 2020 at 23:02)</a>:</h4>
<p><span class="user-mention" data-user-id="216206">@Bastian Kauschke</span> just went through all instances of <code>WellFormed(</code> in the codebase and reviewed <a href="https://github.com/rust-lang/rust/pull/70107/commits/49b5cdb5785e736a17e0216268bca2c0d1f7934d" target="_blank" title="https://github.com/rust-lang/rust/pull/70107/commits/49b5cdb5785e736a17e0216268bca2c0d1f7934d">https://github.com/rust-lang/rust/pull/70107/commits/49b5cdb5785e736a17e0216268bca2c0d1f7934d</a></p>



<a name="191185741"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/%2368977%3A%20Revert%20%60compute_const%60%20changes%20in%20WF/near/191185741" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> eddyb <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/.2368977.3A.20Revert.20.60compute_const.60.20changes.20in.20WF.html#191185741">(Mar 19 2020 at 23:05)</a>:</h4>
<p>can you update the PR description to mention <code>compute_const</code>, <code>wf::const_obligations</code> and <code>Predicate::WellFormedConst</code>?</p>



<a name="191185823"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/%2368977%3A%20Revert%20%60compute_const%60%20changes%20in%20WF/near/191185823" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> eddyb <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/.2368977.3A.20Revert.20.60compute_const.60.20changes.20in.20WF.html#191185823">(Mar 19 2020 at 23:06)</a>:</h4>
<p>I changed the PR title, hope you don't mind</p>



<a name="191185855"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/%2368977%3A%20Revert%20%60compute_const%60%20changes%20in%20WF/near/191185855" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> varkor <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/.2368977.3A.20Revert.20.60compute_const.60.20changes.20in.20WF.html#191185855">(Mar 19 2020 at 23:07)</a>:</h4>
<p>thanks for tackling this <span class="user-mention" data-user-id="216206">@Bastian Kauschke</span>!</p>



<a name="191185974"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/%2368977%3A%20Revert%20%60compute_const%60%20changes%20in%20WF/near/191185974" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> lcnr <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/.2368977.3A.20Revert.20.60compute_const.60.20changes.20in.20WF.html#191185974">(Mar 19 2020 at 23:08)</a>:</h4>
<blockquote>
<p>can you update the PR description to mention compute_const, wf::const_obligations and Predicate::WellFormedConst?</p>
</blockquote>
<p>y</p>



<a name="191186148"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/%2368977%3A%20Revert%20%60compute_const%60%20changes%20in%20WF/near/191186148" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> eddyb <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/.2368977.3A.20Revert.20.60compute_const.60.20changes.20in.20WF.html#191186148">(Mar 19 2020 at 23:10)</a>:</h4>
<p>WF is such a stressful part of the compiler (because of how important it is) and the cowboy way the implementation looks to be makes my skin crawl</p>



<a name="191186189"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/%2368977%3A%20Revert%20%60compute_const%60%20changes%20in%20WF/near/191186189" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> eddyb <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/.2368977.3A.20Revert.20.60compute_const.60.20changes.20in.20WF.html#191186189">(Mar 19 2020 at 23:11)</a>:</h4>
<p><span class="user-mention" data-user-id="216206">@Bastian Kauschke</span> you're brave :P</p>



<a name="191186200"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/%2368977%3A%20Revert%20%60compute_const%60%20changes%20in%20WF/near/191186200" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> lcnr <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/.2368977.3A.20Revert.20.60compute_const.60.20changes.20in.20WF.html#191186200">(Mar 19 2020 at 23:11)</a>:</h4>
<p>or stupid ^^</p>



<a name="191186286"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/%2368977%3A%20Revert%20%60compute_const%60%20changes%20in%20WF/near/191186286" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> eddyb <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/.2368977.3A.20Revert.20.60compute_const.60.20changes.20in.20WF.html#191186286">(Mar 19 2020 at 23:12)</a>:</h4>
<p>the size of the PR disagrees :)</p>



<a name="191186294"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/%2368977%3A%20Revert%20%60compute_const%60%20changes%20in%20WF/near/191186294" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> lcnr <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/.2368977.3A.20Revert.20.60compute_const.60.20changes.20in.20WF.html#191186294">(Mar 19 2020 at 23:12)</a>:</h4>
<p>Considering that WellFormedConst only adds requirements, I at least don't really worry that I cause UB</p>



<a name="191186335"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/%2368977%3A%20Revert%20%60compute_const%60%20changes%20in%20WF/near/191186335" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> eddyb <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/.2368977.3A.20Revert.20.60compute_const.60.20changes.20in.20WF.html#191186335">(Mar 19 2020 at 23:12)</a>:</h4>
<p>oh yeah you're only removing bugs :P</p>



<a name="191186369"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/%2368977%3A%20Revert%20%60compute_const%60%20changes%20in%20WF/near/191186369" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> eddyb <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/.2368977.3A.20Revert.20.60compute_const.60.20changes.20in.20WF.html#191186369">(Mar 19 2020 at 23:13)</a>:</h4>
<p>I'm just being as strict as I can to make sure we remove all the bugs not just some</p>



<a name="191187852"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/%2368977%3A%20Revert%20%60compute_const%60%20changes%20in%20WF/near/191187852" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> lcnr <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/.2368977.3A.20Revert.20.60compute_const.60.20changes.20in.20WF.html#191187852">(Mar 19 2020 at 23:33)</a>:</h4>
<p>tbh I really want a good way to test this. I just improved like 5 different things and don't know if and when any of them actually helps <span aria-label="shock" class="emoji emoji-1f628" role="img" title="shock">:shock:</span></p>



<a name="191187917"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/%2368977%3A%20Revert%20%60compute_const%60%20changes%20in%20WF/near/191187917" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> eddyb <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/.2368977.3A.20Revert.20.60compute_const.60.20changes.20in.20WF.html#191187917">(Mar 19 2020 at 23:34)</a>:</h4>
<p>it's... tricky</p>



<a name="191187940"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/%2368977%3A%20Revert%20%60compute_const%60%20changes%20in%20WF/near/191187940" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> eddyb <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/.2368977.3A.20Revert.20.60compute_const.60.20changes.20in.20WF.html#191187940">(Mar 19 2020 at 23:34)</a>:</h4>
<p><span class="user-mention" data-user-id="116009">@nikomatsakis</span> is pretty good at this but he also doesn't have a lot of free time. I might have to hang on him the fact that this is WF and <em>we need to</em> get it right</p>



<a name="191189455"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/%2368977%3A%20Revert%20%60compute_const%60%20changes%20in%20WF/near/191189455" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> eddyb <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/.2368977.3A.20Revert.20.60compute_const.60.20changes.20in.20WF.html#191189455">(Mar 19 2020 at 23:58)</a>:</h4>
<p><span class="user-mention" data-user-id="216206">@Bastian Kauschke</span> with the changes in <a href="https://github.com/rust-lang/rust/pull/70170" target="_blank" title="https://github.com/rust-lang/rust/pull/70170">https://github.com/rust-lang/rust/pull/70170</a> it should be much easier to make the entire <code>wf</code> module correct wrt inference variables</p>



<a name="191217392"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/%2368977%3A%20Revert%20%60compute_const%60%20changes%20in%20WF/near/191217392" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> lcnr <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/.2368977.3A.20Revert.20.60compute_const.60.20changes.20in.20WF.html#191217392">(Mar 20 2020 at 09:23)</a>:</h4>
<p>seems like we are slightly too strict now.</p>



<a name="191234933"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/%2368977%3A%20Revert%20%60compute_const%60%20changes%20in%20WF/near/191234933" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> lcnr <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/.2368977.3A.20Revert.20.60compute_const.60.20changes.20in.20WF.html#191234933">(Mar 20 2020 at 12:22)</a>:</h4>
<p><span class="user-mention" data-user-id="119009">@eddyb</span> can you help me out here?</p>
<p>The compiler currently fails in libcore due to ambiguity: <a href="https://github.com/rust-lang/rust/blob/4cdfa8a5c162f35058bc53526989741b639a6389/src/libcore/array/iter.rs#L193" target="_blank" title="https://github.com/rust-lang/rust/blob/4cdfa8a5c162f35058bc53526989741b639a6389/src/libcore/array/iter.rs#L193">https://github.com/rust-lang/rust/blob/4cdfa8a5c162f35058bc53526989741b639a6389/src/libcore/array/iter.rs#L193</a></p>
<p>The error gets reported here: <a href="https://github.com/rust-lang/rust/pull/70107/files#r395598086" target="_blank" title="https://github.com/rust-lang/rust/pull/70107/files#r395598086">https://github.com/rust-lang/rust/pull/70107/files#r395598086</a></p>
<p>and was introduced in these changes: <a href="https://github.com/rust-lang/rust/pull/70107/files/49b5cdb5785e736a17e0216268bca2c0d1f7934d..bba3a8faa43f7664fe2f36ef61904dca147982ad" target="_blank" title="https://github.com/rust-lang/rust/pull/70107/files/49b5cdb5785e736a17e0216268bca2c0d1f7934d..bba3a8faa43f7664fe2f36ef61904dca147982ad">https://github.com/rust-lang/rust/pull/70107/files/49b5cdb5785e736a17e0216268bca2c0d1f7934d..bba3a8faa43f7664fe2f36ef61904dca147982ad</a><br>
Do you have an idea why this fails?<br>
I don't really make any progress here atm, it is probably caused by wf::const_obligations not always causing a <code>ProcessResult::Changed</code> but that seems like it should be the correct behavior.</p>



<a name="191239795"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/%2368977%3A%20Revert%20%60compute_const%60%20changes%20in%20WF/near/191239795" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> lcnr <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/.2368977.3A.20Revert.20.60compute_const.60.20changes.20in.20WF.html#191239795">(Mar 20 2020 at 13:08)</a>:</h4>
<p>(deleted)</p>



<a name="191241248"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/%2368977%3A%20Revert%20%60compute_const%60%20changes%20in%20WF/near/191241248" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> lcnr <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/.2368977.3A.20Revert.20.60compute_const.60.20changes.20in.20WF.html#191241248">(Mar 20 2020 at 13:21)</a>:</h4>
<p>commit: <a href="https://github.com/rust-lang/rust/pull/70107/commits/81ee6613311bf2ad5970b43f02cf718bad65a03b" target="_blank" title="https://github.com/rust-lang/rust/pull/70107/commits/81ee6613311bf2ad5970b43f02cf718bad65a03b">https://github.com/rust-lang/rust/pull/70107/commits/81ee6613311bf2ad5970b43f02cf718bad65a03b</a></p>



<a name="191246037"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/%2368977%3A%20Revert%20%60compute_const%60%20changes%20in%20WF/near/191246037" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> eddyb <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/.2368977.3A.20Revert.20.60compute_const.60.20changes.20in.20WF.html#191246037">(Mar 20 2020 at 14:02)</a>:</h4>
<p><span class="user-mention" data-user-id="216206">@Bastian Kauschke</span> I opened an issue <a href="https://github.com/rust-lang/rust/issues/70180" target="_blank" title="https://github.com/rust-lang/rust/issues/70180">https://github.com/rust-lang/rust/issues/70180</a></p>



<a name="191247053"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/%2368977%3A%20Revert%20%60compute_const%60%20changes%20in%20WF/near/191247053" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> lcnr <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/.2368977.3A.20Revert.20.60compute_const.60.20changes.20in.20WF.html#191247053">(Mar 20 2020 at 14:10)</a>:</h4>
<p>I found a different error in my diffs. which should be the reason why <code>core</code> failed to compile.  <a href="https://github.com/rust-lang/rust/issues/70180" target="_blank" title="https://github.com/rust-lang/rust/issues/70180">https://github.com/rust-lang/rust/issues/70180</a> is probably still relevant for const WF though. <span aria-label="sweat smile" class="emoji emoji-1f605" role="img" title="sweat smile">:sweat_smile:</span></p>



<a name="191247210"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/%2368977%3A%20Revert%20%60compute_const%60%20changes%20in%20WF/near/191247210" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> eddyb <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/.2368977.3A.20Revert.20.60compute_const.60.20changes.20in.20WF.html#191247210">(Mar 20 2020 at 14:11)</a>:</h4>
<p>basically if you've had to adapt <code>stalled_on</code> code to be different for consts than for types, it was likely wrong :P</p>



<a name="191247271"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/%2368977%3A%20Revert%20%60compute_const%60%20changes%20in%20WF/near/191247271" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> eddyb <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/.2368977.3A.20Revert.20.60compute_const.60.20changes.20in.20WF.html#191247271">(Mar 20 2020 at 14:11)</a>:</h4>
<p>it should be very symmetrical, as inference variables of each can equally stall solving obligations</p>



<a name="191248295"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/%2368977%3A%20Revert%20%60compute_const%60%20changes%20in%20WF/near/191248295" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> lcnr <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/.2368977.3A.20Revert.20.60compute_const.60.20changes.20in.20WF.html#191248295">(Mar 20 2020 at 14:19)</a>:</h4>
<p>My fix works! <span aria-label="happy" class="emoji emoji-1f600" role="img" title="happy">:happy:</span>  I didn't touch <code>stalled_on</code> at all, so there might be some snippets which cannot be resolved!</p>



<a name="191248704"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/%2368977%3A%20Revert%20%60compute_const%60%20changes%20in%20WF/near/191248704" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> eddyb <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/.2368977.3A.20Revert.20.60compute_const.60.20changes.20in.20WF.html#191248704">(Mar 20 2020 at 14:22)</a>:</h4>
<p>and so it begins <a href="https://github.com/rust-lang/rust/pull/70181#issuecomment-601726100" target="_blank" title="https://github.com/rust-lang/rust/pull/70181#issuecomment-601726100">https://github.com/rust-lang/rust/pull/70181#issuecomment-601726100</a></p>



<a name="191248726"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/%2368977%3A%20Revert%20%60compute_const%60%20changes%20in%20WF/near/191248726" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> eddyb <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/.2368977.3A.20Revert.20.60compute_const.60.20changes.20in.20WF.html#191248726">(Mar 20 2020 at 14:23)</a>:</h4>
<p>will probably spend a day on just perf testing</p>



<a name="191248787"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/%2368977%3A%20Revert%20%60compute_const%60%20changes%20in%20WF/near/191248787" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> lcnr <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/.2368977.3A.20Revert.20.60compute_const.60.20changes.20in.20WF.html#191248787">(Mar 20 2020 at 14:23)</a>:</h4>
<p>ok</p>
<div class="codehilite"><pre><span></span><span class="n">warning</span>: <span class="nc">the</span><span class="w"> </span><span class="n">feature</span><span class="w"> </span><span class="err">`</span><span class="n">const_generics</span><span class="err">`</span><span class="w"> </span><span class="n">is</span><span class="w"> </span><span class="n">incomplete</span><span class="w"> </span><span class="n">and</span><span class="w"> </span><span class="n">may</span><span class="w"> </span><span class="n">cause</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">compiler</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="n">crash</span><span class="w"></span>
<span class="w">  </span><span class="o">-</span>-&gt; <span class="cp">$DIR</span><span class="o">/</span><span class="n">cannot</span><span class="o">-</span><span class="n">infer</span><span class="o">-</span><span class="k">const</span><span class="o">-</span><span class="n">args</span><span class="p">.</span><span class="n">rs</span>:<span class="mi">1</span>:<span class="mi">12</span><span class="w"></span>
<span class="w">   </span><span class="o">|</span><span class="w"></span>
<span class="n">LL</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="cp">#![feature(const_generics)]</span><span class="w"></span>
<span class="w">   </span><span class="o">|</span><span class="w">            </span><span class="o">^^^^^^^^^^^^^^</span><span class="w"></span>
<span class="w">   </span><span class="o">|</span><span class="w"></span>
<span class="w">   </span><span class="o">=</span><span class="w"> </span><span class="n">note</span>: <span class="err">`</span><span class="cp">#[warn(incomplete_features)]</span><span class="err">`</span><span class="w"> </span><span class="n">on</span><span class="w"> </span><span class="n">by</span><span class="w"> </span><span class="n">default</span><span class="w"></span>

<span class="n">error</span><span class="p">[</span><span class="n">E0282</span><span class="p">]</span>: <span class="nc">type</span><span class="w"> </span><span class="n">annotations</span><span class="w"> </span><span class="n">needed</span><span class="w"></span>
<span class="w">  </span><span class="o">-</span>-&gt; <span class="cp">$DIR</span><span class="o">/</span><span class="n">cannot</span><span class="o">-</span><span class="n">infer</span><span class="o">-</span><span class="k">const</span><span class="o">-</span><span class="n">args</span><span class="p">.</span><span class="n">rs</span>:<span class="mi">9</span>:<span class="mi">5</span><span class="w"></span>
<span class="w">   </span><span class="o">|</span><span class="w"></span>
<span class="n">LL</span><span class="w"> </span><span class="o">|</span><span class="w">     </span><span class="n">foo</span><span class="p">();</span><span class="w"></span>
<span class="w">   </span><span class="o">|</span><span class="w">     </span><span class="o">^^^</span><span class="w"> </span><span class="n">cannot</span><span class="w"> </span><span class="n">infer</span><span class="w"> </span><span class="k">type</span> <span class="nc">for</span><span class="w"> </span><span class="k">type</span> <span class="err">`</span><span class="kt">usize</span><span class="err">`</span><span class="w"></span>

<span class="n">error</span>: <span class="nc">aborting</span><span class="w"> </span><span class="n">due</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="n">previous</span><span class="w"> </span><span class="n">error</span><span class="w"></span>

<span class="n">For</span><span class="w"> </span><span class="n">more</span><span class="w"> </span><span class="n">information</span><span class="w"> </span><span class="n">about</span><span class="w"> </span><span class="n">this</span><span class="w"> </span><span class="n">error</span><span class="p">,</span><span class="w"> </span><span class="k">try</span><span class="w"> </span><span class="err">`</span><span class="n">rustc</span><span class="w"> </span><span class="o">--</span><span class="n">explain</span><span class="w"> </span><span class="n">E0282</span><span class="err">`</span><span class="p">.</span><span class="w"></span>
</pre></div>



<a name="191248909"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/%2368977%3A%20Revert%20%60compute_const%60%20changes%20in%20WF/near/191248909" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> bjorn3 <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/.2368977.3A.20Revert.20.60compute_const.60.20changes.20in.20WF.html#191248909">(Mar 20 2020 at 14:24)</a>:</h4>
<p><code>cannot infer type for type</code> <span aria-label="laughter tears" class="emoji emoji-1f602" role="img" title="laughter tears">:laughter_tears:</span></p>



<a name="191248939"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/%2368977%3A%20Revert%20%60compute_const%60%20changes%20in%20WF/near/191248939" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> lcnr <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/.2368977.3A.20Revert.20.60compute_const.60.20changes.20in.20WF.html#191248939">(Mar 20 2020 at 14:24)</a>:</h4>
<p>big brain move</p>



<a name="191249334"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/%2368977%3A%20Revert%20%60compute_const%60%20changes%20in%20WF/near/191249334" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> lcnr <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/.2368977.3A.20Revert.20.60compute_const.60.20changes.20in.20WF.html#191249334">(Mar 20 2020 at 14:27)</a>:</h4>
<p><span class="user-mention" data-user-id="119009">@eddyb</span> <a href="https://github.com/rust-lang/rust/pull/70107" target="_blank" title="https://github.com/rust-lang/rust/pull/70107">https://github.com/rust-lang/rust/pull/70107</a> should once again be ready for review. All ui tests pass</p>



<a name="191252117"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/%2368977%3A%20Revert%20%60compute_const%60%20changes%20in%20WF/near/191252117" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> eddyb <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/.2368977.3A.20Revert.20.60compute_const.60.20changes.20in.20WF.html#191252117">(Mar 20 2020 at 14:48)</a>:</h4>
<p><span class="user-mention" data-user-id="216206">@Bastian Kauschke</span> are you okay with me blocking it on fixing <code>walk</code> and <code>stalled_on</code>?</p>



<a name="191252161"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/%2368977%3A%20Revert%20%60compute_const%60%20changes%20in%20WF/near/191252161" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> eddyb <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/.2368977.3A.20Revert.20.60compute_const.60.20changes.20in.20WF.html#191252161">(Mar 20 2020 at 14:48)</a>:</h4>
<p>I want to make sure your PR can do the correct thing</p>



<a name="191253918"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/%2368977%3A%20Revert%20%60compute_const%60%20changes%20in%20WF/near/191253918" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> lcnr <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/.2368977.3A.20Revert.20.60compute_const.60.20changes.20in.20WF.html#191253918">(Mar 20 2020 at 15:02)</a>:</h4>
<blockquote>
<p>are you okay with me blocking it on fixing walk and stalled_on?</p>
</blockquote>
<p>Yeah, as long as I have something else to work on in the meantime <span aria-label="thinking" class="emoji emoji-1f914" role="img" title="thinking">:thinking:</span></p>



<a name="191254015"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/%2368977%3A%20Revert%20%60compute_const%60%20changes%20in%20WF/near/191254015" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> eddyb <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/.2368977.3A.20Revert.20.60compute_const.60.20changes.20in.20WF.html#191254015">(Mar 20 2020 at 15:03)</a>:</h4>
<p>that I don't know about</p>



<a name="191254043"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/%2368977%3A%20Revert%20%60compute_const%60%20changes%20in%20WF/near/191254043" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> eddyb <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/.2368977.3A.20Revert.20.60compute_const.60.20changes.20in.20WF.html#191254043">(Mar 20 2020 at 15:03)</a>:</h4>
<p>heck I don't know what to do either, while I'm waiting for perf results</p>



<a name="191254075"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/%2368977%3A%20Revert%20%60compute_const%60%20changes%20in%20WF/near/191254075" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> eddyb <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/.2368977.3A.20Revert.20.60compute_const.60.20changes.20in.20WF.html#191254075">(Mar 20 2020 at 15:03)</a>:</h4>
<p>if they're bad I'd have to redo my approach altogether</p>



<a name="191256519"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/%2368977%3A%20Revert%20%60compute_const%60%20changes%20in%20WF/near/191256519" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> lcnr <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/.2368977.3A.20Revert.20.60compute_const.60.20changes.20in.20WF.html#191256519">(Mar 20 2020 at 15:20)</a>:</h4>
<p><span class="user-mention" data-user-id="119009">@eddyb</span> I believe that this should compile: <a href="https://play.rust-lang.org/?version=nightly&amp;mode=debug&amp;edition=2018&amp;gist=74462bd2658e83e8cfeb6c2bf80d47d9" target="_blank" title="https://play.rust-lang.org/?version=nightly&amp;mode=debug&amp;edition=2018&amp;gist=74462bd2658e83e8cfeb6c2bf80d47d9">https://play.rust-lang.org/?version=nightly&amp;mode=debug&amp;edition=2018&amp;gist=74462bd2658e83e8cfeb6c2bf80d47d9</a> (minimized version of <a href="https://github.com/rust-lang/rust/issues/70167" target="_blank" title="https://github.com/rust-lang/rust/issues/70167">https://github.com/rust-lang/rust/issues/70167</a>)</p>



<a name="191256692"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/%2368977%3A%20Revert%20%60compute_const%60%20changes%20in%20WF/near/191256692" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> eddyb <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/.2368977.3A.20Revert.20.60compute_const.60.20changes.20in.20WF.html#191256692">(Mar 20 2020 at 15:21)</a>:</h4>
<p>lmao</p>



<a name="191256810"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/%2368977%3A%20Revert%20%60compute_const%60%20changes%20in%20WF/near/191256810" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> eddyb <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/.2368977.3A.20Revert.20.60compute_const.60.20changes.20in.20WF.html#191256810">(Mar 20 2020 at 15:21)</a>:</h4>
<p>also you have to use round parens, square brackets will  break links</p>



<a name="191257119"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/%2368977%3A%20Revert%20%60compute_const%60%20changes%20in%20WF/near/191257119" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> lcnr <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/.2368977.3A.20Revert.20.60compute_const.60.20changes.20in.20WF.html#191257119">(Mar 20 2020 at 15:23)</a>:</h4>
<p>will just work on this then <span aria-label="shrug" class="emoji emoji-1f937" role="img" title="shrug">:shrug:</span></p>



<a name="191257215"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/%2368977%3A%20Revert%20%60compute_const%60%20changes%20in%20WF/near/191257215" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> eddyb <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/.2368977.3A.20Revert.20.60compute_const.60.20changes.20in.20WF.html#191257215">(Mar 20 2020 at 15:24)</a>:</h4>
<p>from glancing at it, I'm guessing <code>rustc_typeck::astconv</code> is to blame here</p>



<a name="191273559"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/%2368977%3A%20Revert%20%60compute_const%60%20changes%20in%20WF/near/191273559" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> lcnr <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/.2368977.3A.20Revert.20.60compute_const.60.20changes.20in.20WF.html#191273559">(Mar 20 2020 at 17:14)</a>:</h4>
<p>ast_ty_to_ty seems fine afaict,  will look backwards from where the error originated. Seems like a good oportunity to familiarize myself with the compiler <span aria-label="laughing" class="emoji emoji-1f606" role="img" title="laughing">:laughing:</span></p>



<a name="191293135"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/%2368977%3A%20Revert%20%60compute_const%60%20changes%20in%20WF/near/191293135" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> lcnr <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/.2368977.3A.20Revert.20.60compute_const.60.20changes.20in.20WF.html#191293135">(Mar 20 2020 at 19:45)</a>:</h4>
<p>(deleted)</p>



<a name="191303885"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/%2368977%3A%20Revert%20%60compute_const%60%20changes%20in%20WF/near/191303885" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> lcnr <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/.2368977.3A.20Revert.20.60compute_const.60.20changes.20in.20WF.html#191303885">(Mar 20 2020 at 21:19)</a>:</h4>
<p>afaict type check does not emit an error but returns ty::Error. <span class="user-mention" data-user-id="119009">@eddyb</span> any tips on checking where this might happen?</p>



<a name="191324235"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/%2368977%3A%20Revert%20%60compute_const%60%20changes%20in%20WF/near/191324235" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> mark-i-m <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/.2368977.3A.20Revert.20.60compute_const.60.20changes.20in.20WF.html#191324235">(Mar 21 2020 at 02:34)</a>:</h4>
<p><span class="user-mention" data-user-id="216206">@Bastian Kauschke</span> if that's true, the there is a compiler bug. <code>ty::Error</code> should never be returned unless an error is either emitted or queued.</p>



<a name="191324688"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/%2368977%3A%20Revert%20%60compute_const%60%20changes%20in%20WF/near/191324688" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> eddyb <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/.2368977.3A.20Revert.20.60compute_const.60.20changes.20in.20WF.html#191324688">(Mar 21 2020 at 02:49)</a>:</h4>
<p><span class="user-mention" data-user-id="216206">@Bastian Kauschke</span> damn I was right to not keep working on that branch: <a href="https://github.com/rust-lang/rust/pull/70181#issuecomment-601982865" target="_blank" title="https://github.com/rust-lang/rust/pull/70181#issuecomment-601982865">https://github.com/rust-lang/rust/pull/70181#issuecomment-601982865</a></p>



<a name="191334383"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/%2368977%3A%20Revert%20%60compute_const%60%20changes%20in%20WF/near/191334383" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> eddyb <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/.2368977.3A.20Revert.20.60compute_const.60.20changes.20in.20WF.html#191334383">(Mar 21 2020 at 08:11)</a>:</h4>
<p>this is the (hopefully faster) second take <a href="https://github.com/rust-lang/rust/pull/70213" target="_blank" title="https://github.com/rust-lang/rust/pull/70213">https://github.com/rust-lang/rust/pull/70213</a></p>



<a name="191335152"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/%2368977%3A%20Revert%20%60compute_const%60%20changes%20in%20WF/near/191335152" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> lcnr <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/.2368977.3A.20Revert.20.60compute_const.60.20changes.20in.20WF.html#191335152">(Mar 21 2020 at 08:34)</a>:</h4>
<p><span class="user-mention" data-user-id="198054">@mark-i-m</span>  well it is... I just don't know where</p>



<a name="191335620"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/%2368977%3A%20Revert%20%60compute_const%60%20changes%20in%20WF/near/191335620" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> eddyb <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/.2368977.3A.20Revert.20.60compute_const.60.20changes.20in.20WF.html#191335620">(Mar 21 2020 at 08:48)</a>:</h4>
<p>presumably the thing that computes the type of an <code>AnonConst</code>?</p>



<a name="191335637"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/%2368977%3A%20Revert%20%60compute_const%60%20changes%20in%20WF/near/191335637" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> eddyb <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/.2368977.3A.20Revert.20.60compute_const.60.20changes.20in.20WF.html#191335637">(Mar 21 2020 at 08:49)</a>:</h4>
<p>AAAAAAAH <a href="https://github.com/rust-lang/rust/blob/master/src/librustc_typeck/collect/type_of.rs#L199" target="_blank" title="https://github.com/rust-lang/rust/blob/master/src/librustc_typeck/collect/type_of.rs#L199">https://github.com/rust-lang/rust/blob/master/src/librustc_typeck/collect/type_of.rs#L199</a></p>



<a name="191335639"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/%2368977%3A%20Revert%20%60compute_const%60%20changes%20in%20WF/near/191335639" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> eddyb <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/.2368977.3A.20Revert.20.60compute_const.60.20changes.20in.20WF.html#191335639">(Mar 21 2020 at 08:49)</a>:</h4>
<p>how does this not trigger? <a href="https://github.com/rust-lang/rust/blob/master/src/librustc_typeck/collect/type_of.rs#L297-L303" target="_blank" title="https://github.com/rust-lang/rust/blob/master/src/librustc_typeck/collect/type_of.rs#L297-L303">https://github.com/rust-lang/rust/blob/master/src/librustc_typeck/collect/type_of.rs#L297-L303</a></p>



<a name="191335690"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/%2368977%3A%20Revert%20%60compute_const%60%20changes%20in%20WF/near/191335690" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> eddyb <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/.2368977.3A.20Revert.20.60compute_const.60.20changes.20in.20WF.html#191335690">(Mar 21 2020 at 08:50)</a>:</h4>
<p>wait no it's handled? <a href="https://github.com/rust-lang/rust/blob/master/src/librustc_typeck/collect/type_of.rs#L217" target="_blank" title="https://github.com/rust-lang/rust/blob/master/src/librustc_typeck/collect/type_of.rs#L217">https://github.com/rust-lang/rust/blob/master/src/librustc_typeck/collect/type_of.rs#L217</a></p>



<a name="191335701"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/%2368977%3A%20Revert%20%60compute_const%60%20changes%20in%20WF/near/191335701" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> eddyb <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/.2368977.3A.20Revert.20.60compute_const.60.20changes.20in.20WF.html#191335701">(Mar 21 2020 at 08:51)</a>:</h4>
<p>oooh it's a QPath</p>



<a name="191335897"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/%2368977%3A%20Revert%20%60compute_const%60%20changes%20in%20WF/near/191335897" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> eddyb <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/.2368977.3A.20Revert.20.60compute_const.60.20changes.20in.20WF.html#191335897">(Mar 21 2020 at 08:57)</a>:</h4>
<p><span class="user-mention" data-user-id="216206">@Bastian Kauschke</span> I think I found it <a href="https://github.com/rust-lang/rust/blob/master/src/librustc_typeck/collect/type_of.rs#L285-L287" target="_blank" title="https://github.com/rust-lang/rust/blob/master/src/librustc_typeck/collect/type_of.rs#L285-L287">https://github.com/rust-lang/rust/blob/master/src/librustc_typeck/collect/type_of.rs#L285-L287</a></p>



<a name="191335959"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/%2368977%3A%20Revert%20%60compute_const%60%20changes%20in%20WF/near/191335959" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> lcnr <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/.2368977.3A.20Revert.20.60compute_const.60.20changes.20in.20WF.html#191335959">(Mar 21 2020 at 08:59)</a>:</h4>
<p>well, even if it is not, it might be a good idea to add a delay span bug! Thanks, will look into it</p>



<a name="191335963"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/%2368977%3A%20Revert%20%60compute_const%60%20changes%20in%20WF/near/191335963" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> eddyb <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/.2368977.3A.20Revert.20.60compute_const.60.20changes.20in.20WF.html#191335963">(Mar 21 2020 at 08:59)</a>:</h4>
<p><a href="https://github.com/rust-lang/rust/issues/70167#issuecomment-602016086" target="_blank" title="https://github.com/rust-lang/rust/issues/70167#issuecomment-602016086">https://github.com/rust-lang/rust/issues/70167#issuecomment-602016086</a></p>



<a name="191335968"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/%2368977%3A%20Revert%20%60compute_const%60%20changes%20in%20WF/near/191335968" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> eddyb <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/.2368977.3A.20Revert.20.60compute_const.60.20changes.20in.20WF.html#191335968">(Mar 21 2020 at 08:59)</a>:</h4>
<p>yeah, <code>delay_span_bug!</code> there would be good, and I also mentioned a potential fix</p>



<a name="191336140"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/%2368977%3A%20Revert%20%60compute_const%60%20changes%20in%20WF/near/191336140" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> eddyb <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/.2368977.3A.20Revert.20.60compute_const.60.20changes.20in.20WF.html#191336140">(Mar 21 2020 at 09:04)</a>:</h4>
<p><a href="https://github.com/rust-lang/rust/issues/70167#issuecomment-602016539" target="_blank" title="https://github.com/rust-lang/rust/issues/70167#issuecomment-602016539">https://github.com/rust-lang/rust/issues/70167#issuecomment-602016539</a></p>



<a name="191336362"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/%2368977%3A%20Revert%20%60compute_const%60%20changes%20in%20WF/near/191336362" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> lcnr <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/.2368977.3A.20Revert.20.60compute_const.60.20changes.20in.20WF.html#191336362">(Mar 21 2020 at 09:12)</a>:</h4>
<p>jup, the delay span_bug is triggered in <del>all</del> <em>some</em> relevant tests. You're a beast!</p>



<a name="191336555"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/%2368977%3A%20Revert%20%60compute_const%60%20changes%20in%20WF/near/191336555" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> eddyb <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/.2368977.3A.20Revert.20.60compute_const.60.20changes.20in.20WF.html#191336555">(Mar 21 2020 at 09:19)</a>:</h4>
<p>note that my method example triggers an existing <code>delay_span_bug</code> already</p>



<a name="191336717"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/%2368977%3A%20Revert%20%60compute_const%60%20changes%20in%20WF/near/191336717" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> lcnr <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/.2368977.3A.20Revert.20.60compute_const.60.20changes.20in.20WF.html#191336717">(Mar 21 2020 at 09:22)</a>:</h4>
<p>is hir pretty print of AnonConst broken? <code>Struct&lt;&gt;::method::&lt;&gt;</code></p>



<a name="191336721"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/%2368977%3A%20Revert%20%60compute_const%60%20changes%20in%20WF/near/191336721" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> eddyb <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/.2368977.3A.20Revert.20.60compute_const.60.20changes.20in.20WF.html#191336721">(Mar 21 2020 at 09:22)</a>:</h4>
<p>likely yeah</p>



<a name="191336726"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/%2368977%3A%20Revert%20%60compute_const%60%20changes%20in%20WF/near/191336726" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> eddyb <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/.2368977.3A.20Revert.20.60compute_const.60.20changes.20in.20WF.html#191336726">(Mar 21 2020 at 09:23)</a>:</h4>
<p>it's possible the parameters are injected with no name</p>



<a name="191337210"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/%2368977%3A%20Revert%20%60compute_const%60%20changes%20in%20WF/near/191337210" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> lcnr <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/.2368977.3A.20Revert.20.60compute_const.60.20changes.20in.20WF.html#191337210">(Mar 21 2020 at 09:35)</a>:</h4>
<p>do I have to worry about AssocOpaqueTy as well?</p>



<a name="191337249"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/%2368977%3A%20Revert%20%60compute_const%60%20changes%20in%20WF/near/191337249" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> eddyb <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/.2368977.3A.20Revert.20.60compute_const.60.20changes.20in.20WF.html#191337249">(Mar 21 2020 at 09:36)</a>:</h4>
<p>uhhh maybe not? there are two bug fixes btw</p>



<a name="191337252"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/%2368977%3A%20Revert%20%60compute_const%60%20changes%20in%20WF/near/191337252" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> eddyb <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/.2368977.3A.20Revert.20.60compute_const.60.20changes.20in.20WF.html#191337252">(Mar 21 2020 at 09:37)</a>:</h4>
<p>either special-casing associated types, or using the segment <code>Res</code></p>



<a name="191337256"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/%2368977%3A%20Revert%20%60compute_const%60%20changes%20in%20WF/near/191337256" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> eddyb <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/.2368977.3A.20Revert.20.60compute_const.60.20changes.20in.20WF.html#191337256">(Mar 21 2020 at 09:37)</a>:</h4>
<p>the latter means you don't need the former</p>



<a name="191337259"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/%2368977%3A%20Revert%20%60compute_const%60%20changes%20in%20WF/near/191337259" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> eddyb <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/.2368977.3A.20Revert.20.60compute_const.60.20changes.20in.20WF.html#191337259">(Mar 21 2020 at 09:37)</a>:</h4>
<p>(if it works)</p>



<a name="191337290"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/%2368977%3A%20Revert%20%60compute_const%60%20changes%20in%20WF/near/191337290" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> lcnr <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/.2368977.3A.20Revert.20.60compute_const.60.20changes.20in.20WF.html#191337290">(Mar 21 2020 at 09:37)</a>:</h4>
<p>segment <code>Res</code> seems cleaner I guess. So I might just try this and fix the fallout</p>



<a name="191337349"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/%2368977%3A%20Revert%20%60compute_const%60%20changes%20in%20WF/near/191337349" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> eddyb <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/.2368977.3A.20Revert.20.60compute_const.60.20changes.20in.20WF.html#191337349">(Mar 21 2020 at 09:38)</a>:</h4>
<p>it should be a very local change</p>



<a name="191337355"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/%2368977%3A%20Revert%20%60compute_const%60%20changes%20in%20WF/near/191337355" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> eddyb <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/.2368977.3A.20Revert.20.60compute_const.60.20changes.20in.20WF.html#191337355">(Mar 21 2020 at 09:39)</a>:</h4>
<p>basically get the right <code>Res</code> at the same time you're getting the index inside the segment</p>



<a name="191337539"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/%2368977%3A%20Revert%20%60compute_const%60%20changes%20in%20WF/near/191337539" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> lcnr <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/.2368977.3A.20Revert.20.60compute_const.60.20changes.20in.20WF.html#191337539">(Mar 21 2020 at 09:44)</a>:</h4>
<p>are all path segments expected to have a res, considering that it's <code>Option&lt;Res&gt;</code>?https://doc.rust-lang.org/nightly/nightly-rustc/rustc_hir/struct.PathSegment.html</p>



<a name="191337618"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/%2368977%3A%20Revert%20%60compute_const%60%20changes%20in%20WF/near/191337618" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> eddyb <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/.2368977.3A.20Revert.20.60compute_const.60.20changes.20in.20WF.html#191337618">(Mar 21 2020 at 09:47)</a>:</h4>
<p>that I'm not sure about</p>



<a name="191337760"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/%2368977%3A%20Revert%20%60compute_const%60%20changes%20in%20WF/near/191337760" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> eddyb <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/.2368977.3A.20Revert.20.60compute_const.60.20changes.20in.20WF.html#191337760">(Mar 21 2020 at 09:51)</a>:</h4>
<p><span class="user-mention" data-user-id="216206">@Bastian Kauschke</span> wait I'm an idiot, the method example can't be solved for a while, so you should go with the associated type special-casing</p>



<a name="191337765"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/%2368977%3A%20Revert%20%60compute_const%60%20changes%20in%20WF/near/191337765" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> eddyb <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/.2368977.3A.20Revert.20.60compute_const.60.20changes.20in.20WF.html#191337765">(Mar 21 2020 at 09:51)</a>:</h4>
<p>or maybe use <code>segment_res.unwrap_or(path.res)</code></p>



<a name="191337837"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/%2368977%3A%20Revert%20%60compute_const%60%20changes%20in%20WF/near/191337837" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> eddyb <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/.2368977.3A.20Revert.20.60compute_const.60.20changes.20in.20WF.html#191337837">(Mar 21 2020 at 09:53)</a>:</h4>
<p>ooh, I see, the <code>M</code> in the method example hits <code>QPath::TypeRelative</code></p>



<a name="191338052"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/%2368977%3A%20Revert%20%60compute_const%60%20changes%20in%20WF/near/191338052" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> eddyb <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/.2368977.3A.20Revert.20.60compute_const.60.20changes.20in.20WF.html#191338052">(Mar 21 2020 at 09:59)</a>:</h4>
<p><span class="user-mention" data-user-id="216206">@Bastian Kauschke</span> edited <a href="https://github.com/rust-lang/rust/issues/70167#issuecomment-602016539" target="_blank" title="https://github.com/rust-lang/rust/issues/70167#issuecomment-602016539">https://github.com/rust-lang/rust/issues/70167#issuecomment-602016539</a></p>



<a name="191338426"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/%2368977%3A%20Revert%20%60compute_const%60%20changes%20in%20WF/near/191338426" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> lcnr <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/.2368977.3A.20Revert.20.60compute_const.60.20changes.20in.20WF.html#191338426">(Mar 21 2020 at 10:09)</a>:</h4>
<p>fixed the issue! <span aria-label="laughing" class="emoji emoji-1f606" role="img" title="laughing">:laughing:</span> even if I don't quite know what I am doing. Should I open a new issue for the method call?</p>



<a name="191338527"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/%2368977%3A%20Revert%20%60compute_const%60%20changes%20in%20WF/near/191338527" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> eddyb <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/.2368977.3A.20Revert.20.60compute_const.60.20changes.20in.20WF.html#191338527">(Mar 21 2020 at 10:12)</a>:</h4>
<p>I guess?</p>



<a name="191338972"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/%2368977%3A%20Revert%20%60compute_const%60%20changes%20in%20WF/near/191338972" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> lcnr <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/.2368977.3A.20Revert.20.60compute_const.60.20changes.20in.20WF.html#191338972">(Mar 21 2020 at 10:26)</a>:</h4>
<p>nm, breaking core again</p>



<a name="191342705"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/%2368977%3A%20Revert%20%60compute_const%60%20changes%20in%20WF/near/191342705" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> lcnr <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/.2368977.3A.20Revert.20.60compute_const.60.20changes.20in.20WF.html#191342705">(Mar 21 2020 at 12:08)</a>:</h4>
<p>fffff, directly using <code>Res</code> of path segments doesnt work, As the res of path segments in types are <code>Some(Res::Err)</code>.</p>
<p>The currently fix ended up being exactly 1 line <span aria-label="cry" class="emoji emoji-1f622" role="img" title="cry">:cry:</span>  That's kinda disappointing</p>



<a name="191343218"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/%2368977%3A%20Revert%20%60compute_const%60%20changes%20in%20WF/near/191343218" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> lcnr <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/.2368977.3A.20Revert.20.60compute_const.60.20changes.20in.20WF.html#191343218">(Mar 21 2020 at 12:24)</a>:</h4>
<p>@eddyb <a href="https://github.com/rust-lang/rust/pull/70223" target="_blank" title="https://github.com/rust-lang/rust/pull/70223">https://github.com/rust-lang/rust/pull/70223</a></p>



<a name="191416061"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/%2368977%3A%20Revert%20%60compute_const%60%20changes%20in%20WF/near/191416061" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> eddyb <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/.2368977.3A.20Revert.20.60compute_const.60.20changes.20in.20WF.html#191416061">(Mar 22 2020 at 21:03)</a>:</h4>
<p>wheee I finally reached the last <code>walk</code> change, in <code>fulfill</code></p>



<a name="191433779"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/%2368977%3A%20Revert%20%60compute_const%60%20changes%20in%20WF/near/191433779" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> eddyb <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/.2368977.3A.20Revert.20.60compute_const.60.20changes.20in.20WF.html#191433779">(Mar 23 2020 at 05:23)</a>:</h4>
<p><span class="user-mention" data-user-id="216206">@Bastian Kauschke</span> okay <a href="https://github.com/rust-lang/rust/pull/70164" target="_blank" title="https://github.com/rust-lang/rust/pull/70164">https://github.com/rust-lang/rust/pull/70164</a> should be done</p>



<a name="191528385"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/%2368977%3A%20Revert%20%60compute_const%60%20changes%20in%20WF/near/191528385" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> eddyb <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/.2368977.3A.20Revert.20.60compute_const.60.20changes.20in.20WF.html#191528385">(Mar 23 2020 at 20:01)</a>:</h4>
<p><span class="user-mention" data-user-id="216206">@Bastian Kauschke</span> <a href="https://github.com/rust-lang/rust/pull/70213#issuecomment-602816331" target="_blank" title="https://github.com/rust-lang/rust/pull/70213#issuecomment-602816331">https://github.com/rust-lang/rust/pull/70213#issuecomment-602816331</a></p>



<a name="191528480"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/%2368977%3A%20Revert%20%60compute_const%60%20changes%20in%20WF/near/191528480" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> eddyb <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/.2368977.3A.20Revert.20.60compute_const.60.20changes.20in.20WF.html#191528480">(Mar 23 2020 at 20:01)</a>:</h4>
<p>you can rebase over my PR if you want btw</p>



<a name="191528568"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/%2368977%3A%20Revert%20%60compute_const%60%20changes%20in%20WF/near/191528568" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> eddyb <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/.2368977.3A.20Revert.20.60compute_const.60.20changes.20in.20WF.html#191528568">(Mar 23 2020 at 20:02)</a>:</h4>
<p>it might unbreak some things in your PR (I forget if there are any tests that still don't work)</p>



<a name="191528641"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/%2368977%3A%20Revert%20%60compute_const%60%20changes%20in%20WF/near/191528641" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> eddyb <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/.2368977.3A.20Revert.20.60compute_const.60.20changes.20in.20WF.html#191528641">(Mar 23 2020 at 20:02)</a>:</h4>
<p>even without my <code>walk</code> changes, it would let you handle <code>WellFormedConst</code> like <code>WellFormed</code> in terms of <code>stalled_on</code></p>



<a name="191734184"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/%2368977%3A%20Revert%20%60compute_const%60%20changes%20in%20WF/near/191734184" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> lcnr <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/.2368977.3A.20Revert.20.60compute_const.60.20changes.20in.20WF.html#191734184">(Mar 25 2020 at 12:00)</a>:</h4>
<p><span class="user-mention" data-user-id="119009">@eddyb</span> I looked a bit more into <a href="https://github.com/rust-lang/rust/blob/master/src/test/ui/consts/associated_const_generic.rs" title="https://github.com/rust-lang/rust/blob/master/src/test/ui/consts/associated_const_generic.rs">src/test/ui/consts/associated_const_generic.rs</a> of <a href="https://github.com/rust-lang/rust/pull/70107" title="https://github.com/rust-lang/rust/pull/70107">https://github.com/rust-lang/rust/pull/70107</a>.</p>
<p>As far as I can tell <code>WellFormedConst</code> adds a <code>ConstEvaluable</code> predicate for <code>B::Value</code>, which calls the query <code>const_eval_resolve</code> -&gt;<code>ty::Instance::resolve</code> -&gt;s <code>resolve_instance</code> -&gt;  <a href="https://github.com/rust-lang/rust/blob/cdb50c6f2507319f29104a25765bfb79ad53395c/src/librustc_ty/instance.rs#L62" title="https://github.com/rust-lang/rust/blob/cdb50c6f2507319f29104a25765bfb79ad53395c/src/librustc_ty/instance.rs#L62">resolve_associated_item</a>. </p>
<p><code>B::Value</code> has  a <code>VtableImpl</code> and then returns none as <code>param_env.reveal</code> is <code>Reveal::UserFacing</code>, which causes the function to return <code>None</code> <a href="https://github.com/rust-lang/rust/blob/cdb50c6f2507319f29104a25765bfb79ad53395c/src/librustc_ty/instance.rs#L99" title="https://github.com/rust-lang/rust/blob/cdb50c6f2507319f29104a25765bfb79ad53395c/src/librustc_ty/instance.rs#L99">here</a>. At least in my understanding everything up to the branch on <code>param_env.reveal == traits::Reveal::All</code> seems correct.</p>
<p>Looking at the comment for <code>Reveal</code>: <a href="https://doc.rust-lang.org/nightly/nightly-rustc/rustc/traits/enum.Reveal.html" title="https://doc.rust-lang.org/nightly/nightly-rustc/rustc/traits/enum.Reveal.html">https://doc.rust-lang.org/nightly/nightly-rustc/rustc/traits/enum.Reveal.html</a></p>
<blockquote>
<p>However, we could allow projections in fully-monomorphic cases. We choose not to, because we prefer for default type to force the type definition to be treated abstractly by any consumers of the impl. </p>
</blockquote>
<p>This seems like to culprit, as the test case is fully monomorphic afaict. </p>
<p>Does my analysis seem correct and if so, how could I proceed?</p>



<a name="191758429"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/%2368977%3A%20Revert%20%60compute_const%60%20changes%20in%20WF/near/191758429" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> eddyb <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/.2368977.3A.20Revert.20.60compute_const.60.20changes.20in.20WF.html#191758429">(Mar 25 2020 at 15:02)</a>:</h4>
<p>wait why is it using <code>UserFacing</code>?</p>



<a name="191758827"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/%2368977%3A%20Revert%20%60compute_const%60%20changes%20in%20WF/near/191758827" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> eddyb <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/.2368977.3A.20Revert.20.60compute_const.60.20changes.20in.20WF.html#191758827">(Mar 25 2020 at 15:05)</a>:</h4>
<p>hmm, this uses <code>with_reveal_all</code> <a href="https://github.com/rust-lang/rust/blob/bfc32dd106f0fe191b8bcd9b76348a8875c30a60/src/librustc/mir/interpret/queries.rs#L21" title="https://github.com/rust-lang/rust/blob/bfc32dd106f0fe191b8bcd9b76348a8875c30a60/src/librustc/mir/interpret/queries.rs#L21">https://github.com/rust-lang/rust/blob/bfc32dd106f0fe191b8bcd9b76348a8875c30a60/src/librustc/mir/interpret/queries.rs#L21</a></p>



<a name="191758909"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/%2368977%3A%20Revert%20%60compute_const%60%20changes%20in%20WF/near/191758909" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> eddyb <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/.2368977.3A.20Revert.20.60compute_const.60.20changes.20in.20WF.html#191758909">(Mar 25 2020 at 15:06)</a>:</h4>
<p>I wonder if users of <code>const_eval_resolve</code> have to do it themselves or something</p>



<a name="191759290"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/%2368977%3A%20Revert%20%60compute_const%60%20changes%20in%20WF/near/191759290" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> eddyb <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/.2368977.3A.20Revert.20.60compute_const.60.20changes.20in.20WF.html#191759290">(Mar 25 2020 at 15:08)</a>:</h4>
<p>this uses <code>with_reveal_all</code> <a href="https://github.com/rust-lang/rust/blob/342c5f33d097b2dc07a2dbc0ca45a37379d2ff60/src/librustc/ty/sty.rs#L2401" title="https://github.com/rust-lang/rust/blob/342c5f33d097b2dc07a2dbc0ca45a37379d2ff60/src/librustc/ty/sty.rs#L2401">https://github.com/rust-lang/rust/blob/342c5f33d097b2dc07a2dbc0ca45a37379d2ff60/src/librustc/ty/sty.rs#L2401</a></p>



<a name="191759847"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/%2368977%3A%20Revert%20%60compute_const%60%20changes%20in%20WF/near/191759847" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> eddyb <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/.2368977.3A.20Revert.20.60compute_const.60.20changes.20in.20WF.html#191759847">(Mar 25 2020 at 15:11)</a>:</h4>
<p>this is funny given that the <code>ParamEnv</code> matters little apparently <a href="https://github.com/rust-lang/rust/blob/e0f5df017368dc3f7cb458fc6d5a5e0420e1d2e5/src/librustc_mir_build/hair/pattern/mod.rs#L768" title="https://github.com/rust-lang/rust/blob/e0f5df017368dc3f7cb458fc6d5a5e0420e1d2e5/src/librustc_mir_build/hair/pattern/mod.rs#L768">https://github.com/rust-lang/rust/blob/e0f5df017368dc3f7cb458fc6d5a5e0420e1d2e5/src/librustc_mir_build/hair/pattern/mod.rs#L768</a></p>



<a name="191760406"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/%2368977%3A%20Revert%20%60compute_const%60%20changes%20in%20WF/near/191760406" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> eddyb <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/.2368977.3A.20Revert.20.60compute_const.60.20changes.20in.20WF.html#191760406">(Mar 25 2020 at 15:14)</a>:</h4>
<p><span class="user-mention" data-user-id="216206">@Bastian Kauschke</span> okay so you can either add <code>.with_reveal_all()</code> to these files:</p>
<ul>
<li><a href="https://github.com/rust-lang/rust/blob/5aa8f199c398644d9fc2bb9ac8cffd14f985686d/src/librustc_trait_selection/traits/select.rs#L496" title="https://github.com/rust-lang/rust/blob/5aa8f199c398644d9fc2bb9ac8cffd14f985686d/src/librustc_trait_selection/traits/select.rs#L496">https://github.com/rust-lang/rust/blob/5aa8f199c398644d9fc2bb9ac8cffd14f985686d/src/librustc_trait_selection/traits/select.rs#L496</a> </li>
<li><a href="https://github.com/rust-lang/rust/blob/9d0ae58d30523198dec60a9cd840c30c2bd9c4c0/src/librustc_trait_selection/traits/fulfill.rs#L505" title="https://github.com/rust-lang/rust/blob/9d0ae58d30523198dec60a9cd840c30c2bd9c4c0/src/librustc_trait_selection/traits/fulfill.rs#L505">https://github.com/rust-lang/rust/blob/9d0ae58d30523198dec60a9cd840c30c2bd9c4c0/src/librustc_trait_selection/traits/fulfill.rs#L505</a></li>
</ul>
<p>or just here: <a href="https://github.com/rust-lang/rust/blob/bfc32dd106f0fe191b8bcd9b76348a8875c30a60/src/librustc/mir/interpret/queries.rs#L41" title="https://github.com/rust-lang/rust/blob/bfc32dd106f0fe191b8bcd9b76348a8875c30a60/src/librustc/mir/interpret/queries.rs#L41">https://github.com/rust-lang/rust/blob/bfc32dd106f0fe191b8bcd9b76348a8875c30a60/src/librustc/mir/interpret/queries.rs#L41</a></p>
<p>cc <span class="user-mention" data-user-id="124288">@oli</span> <span class="user-mention" data-user-id="125250">@Wesley Wiser</span> <span class="user-mention" data-user-id="121053">@varkor</span> I really don't know if anything at the <em>value</em> levels respects <code>Reveal::UserFacing</code> <em>at all</em>, since we seem to leave that for types (associated type defaults and <code>impl Trait</code>)</p>



<a name="191760521"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/%2368977%3A%20Revert%20%60compute_const%60%20changes%20in%20WF/near/191760521" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> oli <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/.2368977.3A.20Revert.20.60compute_const.60.20changes.20in.20WF.html#191760521">(Mar 25 2020 at 15:14)</a>:</h4>
<p>probably not</p>



<a name="191760589"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/%2368977%3A%20Revert%20%60compute_const%60%20changes%20in%20WF/near/191760589" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> oli <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/.2368977.3A.20Revert.20.60compute_const.60.20changes.20in.20WF.html#191760589">(Mar 25 2020 at 15:15)</a>:</h4>
<p>I never took any care to handle <code>Reveal::UserFacing</code>, because I didn't understand it when it was relevant</p>



<a name="191760598"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/%2368977%3A%20Revert%20%60compute_const%60%20changes%20in%20WF/near/191760598" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> eddyb <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/.2368977.3A.20Revert.20.60compute_const.60.20changes.20in.20WF.html#191760598">(Mar 25 2020 at 15:15)</a>:</h4>
<p>then we can change <code>const_eval_resolve</code> I suppose</p>



<a name="191761609"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/%2368977%3A%20Revert%20%60compute_const%60%20changes%20in%20WF/near/191761609" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> eddyb <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/.2368977.3A.20Revert.20.60compute_const.60.20changes.20in.20WF.html#191761609">(Mar 25 2020 at 15:20)</a>:</h4>
<p>(and remove <code>.with_reveal_all()</code> from callsites)</p>



<a name="191762190"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/%2368977%3A%20Revert%20%60compute_const%60%20changes%20in%20WF/near/191762190" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> lcnr <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/.2368977.3A.20Revert.20.60compute_const.60.20changes.20in.20WF.html#191762190">(Mar 25 2020 at 15:23)</a>:</h4>
<p>Currently testing with updated <code>const_eval_resolve</code>.</p>
<p>When is <code>Reveal::UserFacing</code> needed then, only for default assoc types?</p>



<a name="196052320"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/%2368977%3A%20Revert%20%60compute_const%60%20changes%20in%20WF/near/196052320" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> lcnr <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/.2368977.3A.20Revert.20.60compute_const.60.20changes.20in.20WF.html#196052320">(May 02 2020 at 13:45)</a>:</h4>
<p><span class="user-mention" data-user-id="119009">@eddyb</span> I heard that you have a lot of free time right now. <span aria-label="heart" class="emoji emoji-2764" role="img" title="heart">:heart:</span> </p>
<p>As I feared that you might not know what to do in the following weeks I rebased and improved<br>
<a href="https://github.com/rust-lang/rust/pull/70107" title="https://github.com/rust-lang/rust/pull/70107">https://github.com/rust-lang/rust/pull/70107</a>, meaning that it should be ready for review again <span aria-label="sparkles" class="emoji emoji-2728" role="img" title="sparkles">:sparkles:</span></p>



<a name="196054312"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/%2368977%3A%20Revert%20%60compute_const%60%20changes%20in%20WF/near/196054312" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> lcnr <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/.2368977.3A.20Revert.20.60compute_const.60.20changes.20in.20WF.html#196054312">(May 02 2020 at 14:30)</a>:</h4>
<p>Nevermind, it's not... Forgot to implement a previously mentioned change <span aria-label="sweat smile" class="emoji emoji-1f605" role="img" title="sweat smile">:sweat_smile:</span></p>



<a name="196058940"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/%2368977%3A%20Revert%20%60compute_const%60%20changes%20in%20WF/near/196058940" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> lcnr <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/.2368977.3A.20Revert.20.60compute_const.60.20changes.20in.20WF.html#196058940">(May 02 2020 at 16:19)</a>:</h4>
<p>Ok, I now generalized <code>compute</code> and removed <code>compute_const</code>. Now its actually ready</p>



<a name="198861137"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/%2368977%3A%20Revert%20%60compute_const%60%20changes%20in%20WF/near/198861137" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> lcnr <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/.2368977.3A.20Revert.20.60compute_const.60.20changes.20in.20WF.html#198861137">(May 27 2020 at 08:06)</a>:</h4>
<p>Can someone start another perf run for <a href="https://github.com/rust-lang/rust/pull/70107">https://github.com/rust-lang/rust/pull/70107</a>?</p>



<a name="198895626"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/%2368977%3A%20Revert%20%60compute_const%60%20changes%20in%20WF/near/198895626" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/.2368977.3A.20Revert.20.60compute_const.60.20changes.20in.20WF.html#198895626">(May 27 2020 at 14:09)</a>:</h4>
<p>(looks like it was done)</p>



<hr><p>Last updated: Aug 07 2021 at 22:04 UTC</p>
</html>