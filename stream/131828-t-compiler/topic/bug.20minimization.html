<html>
<head><meta charset="utf-8"><title>bug minimization · t-compiler · Zulip Chat Archive</title></head>
<h2>Stream: <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/index.html">t-compiler</a></h2>
<h3>Topic: <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/bug.20minimization.html">bug minimization</a></h3>

<hr>

<base href="https://rust-lang.zulipchat.com">

<head><link href="https://zulip-archive.rust-lang.org/style.css" rel="stylesheet"></head>

<a name="260742937"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/bug%20minimization/near/260742937" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joshua Nelson <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/bug.20minimization.html#260742937">(Nov 09 2021 at 01:21)</a>:</h4>
<p><span class="user-mention" data-user-id="116083">@pnkfelix</span> I wanted to give you a big thank you for writing <a href="http://blog.pnkfx.org/blog/2019/11/18/rust-bug-minimization-patterns">http://blog.pnkfx.org/blog/2019/11/18/rust-bug-minimization-patterns</a>, it was super helpful for <a href="https://github.com/rust-lang/rust/pull/90489">https://github.com/rust-lang/rust/pull/90489</a> ! :) "cfgmenting" especially was super useful. I also wanted to suggest another technique I didn't see in your blog - usually, when I cfg out a module, it's still used, but only one or two of the items. So I'll end up doing a transformation like:</p>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="k">mod</span> <span class="nn">some_really_long_module</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="c1">// 500+ lines of code</span>
<span class="p">}</span><span class="w"></span>
</code></pre></div>
<p>to</p>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="k">mod</span> <span class="nn">some_really_long_module</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">  </span><span class="k">pub</span><span class="w"> </span><span class="k">struct</span> <span class="nc">A</span><span class="p">;</span><span class="w"> </span><span class="k">pub</span><span class="w"> </span><span class="k">struct</span> <span class="nc">B</span><span class="p">;</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>

<span class="cp">#[cfg(FALSE)]</span><span class="w"></span>
<span class="k">mod</span> <span class="nn">some_really_long_module</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="c1">// 500+ lines of code</span>
<span class="p">}</span><span class="w"></span>
</code></pre></div>
<p>and then if that compiles, delete the original module</p>



<a name="260743076"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/bug%20minimization/near/260743076" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joshua Nelson <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/bug.20minimization.html#260743076">(Nov 09 2021 at 01:23)</a>:</h4>
<p>some of the techniques were less helpful for rustdoc (e.g. deleting function bodies almost never causes the bug to stop reproducing, and deleting doc-comments usually goes too far and doesn't reproduce the bug), but a lot of them were super useful</p>



<a name="260743143"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/bug%20minimization/near/260743143" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joshua Nelson <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/bug.20minimization.html#260743143">(Nov 09 2021 at 01:24)</a>:</h4>
<p>also now I'm motivated to make everybody_loops smarter and delete more haha, like remove non-doc-comments and unused imports</p>



<a name="260743404"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/bug%20minimization/near/260743404" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> pnkfelix <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/bug.20minimization.html#260743404">(Nov 09 2021 at 01:28)</a>:</h4>
<p>Hmm, I think the transformation you describe might be expressible by composing the transformations I did document? I’m not sure, I know I definitely do things like what you describe… its possible I simply didn’t categorize it because it requires too much “thinking” to do in one step and I was trying to focus on purely mechanical transformations.</p>



<a name="260743414"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/bug%20minimization/near/260743414" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> pnkfelix <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/bug.20minimization.html#260743414">(Nov 09 2021 at 01:28)</a>:</h4>
<p>In any case, I’m super glad it came in helpful for someone!</p>



<a name="260743491"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/bug%20minimization/near/260743491" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> pnkfelix <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/bug.20minimization.html#260743491">(Nov 09 2021 at 01:29)</a>:</h4>
<p>(And yes, I can imagine in the special case of rustdoc, you indeed need to pay way more attention to doc-comments and way less attention to function bodies. Indeed, I imagine there <em>are</em> a number of special transformations solely oriented around reducing doc-comment structure.)</p>



<a name="260743562"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/bug%20minimization/near/260743562" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joshua Nelson <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/bug.20minimization.html#260743562">(Nov 09 2021 at 01:30)</a>:</h4>
<p>haha yup - fortunately most of the issues are related to intra-doc links and there's debug logging that prints the exact docs for each item being resolved, so it's not too hard to narrow down</p>



<a name="260743602"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/bug%20minimization/near/260743602" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joshua Nelson <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/bug.20minimization.html#260743602">(Nov 09 2021 at 01:31)</a>:</h4>
<p>e.g. I knew <code>[objr]</code> was the cause of the crash in <a href="https://github.com/jyn514/objr/commit/59bb084a8745761c64b59add0b3ace2a3460724f">https://github.com/jyn514/objr/commit/59bb084a8745761c64b59add0b3ace2a3460724f</a> while it was still 4k+ lines</p>



<a name="260743631"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/bug%20minimization/near/260743631" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joshua Nelson <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/bug.20minimization.html#260743631">(Nov 09 2021 at 01:31)</a>:</h4>
<p>but yeah <a href="https://github.com/rust-lang/rust/pull/90489#issuecomment-962858127">https://github.com/rust-lang/rust/pull/90489#issuecomment-962858127</a> would have taken me like 5x as long to come up with if not for the techniques you suggested :)</p>



<a name="260743711"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/bug%20minimization/near/260743711" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joshua Nelson <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/bug.20minimization.html#260743711">(Nov 09 2021 at 01:32)</a>:</h4>
<p>if you look at the edit history, I still didn't understand the bug very well even after I posted the MCVE <span aria-label="sweat smile" class="emoji emoji-1f605" role="img" title="sweat smile">:sweat_smile:</span> so having it be mostly mindless was very helpful</p>



<hr><p>Last updated: Apr 12 2022 at 20:01 UTC</p>
</html>