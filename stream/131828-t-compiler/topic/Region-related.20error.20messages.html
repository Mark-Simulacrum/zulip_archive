<html>
<head><meta charset="utf-8"><title>Region-related error messages · t-compiler · Zulip Chat Archive</title></head>
<h2>Stream: <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/index.html">t-compiler</a></h2>
<h3>Topic: <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/Region-related.20error.20messages.html">Region-related error messages</a></h3>

<hr>

<base href="https://rust-lang.zulipchat.com">

<head><link href="https://zulip-archive.rust-lang.org/style.css" rel="stylesheet"></head>

<a name="269974364"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/Region-related%20error%20messages/near/269974364" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nnethercote <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/Region-related.20error.20messages.html#269974364">(Jan 31 2022 at 02:56)</a>:</h4>
<p>I am fiddling with the <code>Region</code> type, for <a href="https://github.com/rust-lang/rust/issues/93148">#93148</a>. I have two ui test failures, but they seem like the new form of the errors may be acceptable, or even preferable?</p>
<div class="codehilite"><pre><span></span><code>---- [ui] ui/issues/issue-35570.rs stdout ----
diff of stderr:

1   error[E0277]: the trait bound `for&lt;&#39;a&gt; (): Trait2&lt;&#39;a&gt;` is not satisfied
-     --&gt; $DIR/issue-35570.rs:8:4
+     --&gt; $DIR/issue-35570.rs:8:40
3      |
4   LL | fn _ice(param: Box&lt;dyn for &lt;&#39;a&gt; Trait1&lt;&lt;() as Trait2&lt;&#39;a&gt;&gt;::Ty&gt;&gt;) {
-      |    ^^^^ the trait `for&lt;&#39;a&gt; Trait2&lt;&#39;a&gt;` is not implemented for `()`
+      |                                        ^^^^^^^^^^^^^^^^^^^^^^ the trait `for&lt;&#39;a&gt; Trait2&lt;&#39;a&gt;` is not implemented for `()`
6
7   error: aborting due to previous error
8
</code></pre></div>
<p>and</p>
<div class="codehilite"><pre><span></span><code>---- [ui] ui/regions/regions-implied-bounds-projection-gap-hr-1.rs stdout ----
diff of stderr:

1   error[E0277]: the trait bound `for&lt;&#39;z&gt; T: Trait2&lt;&#39;y, &#39;z&gt;` is not satisfied
-     --&gt; $DIR/regions-implied-bounds-projection-gap-hr-1.rs:21:4
+     --&gt; $DIR/regions-implied-bounds-projection-gap-hr-1.rs:21:49
3      |
4   LL | fn callee&lt;&#39;x, &#39;y, T&gt;(t: &amp;&#39;x dyn for&lt;&#39;z&gt; Trait1&lt; &lt;T as Trait2&lt;&#39;y, &#39;z&gt;&gt;::Foo &gt;)
-      |    ^^^^^^ the trait `for&lt;&#39;z&gt; Trait2&lt;&#39;y, &#39;z&gt;` is not implemented for `T`
+      |                                                 ^^^^^^^^^^^^^^^^^^^^^^^^^^ the trait `for&lt;&#39;z&gt; Trait2&lt;&#39;y, &#39;z&gt;` is not implemented for `T`
6      |
7   help: consider restricting type parameter `T`
8      |
</code></pre></div>
<p>Anyone have opinions about this?</p>



<a name="269978076"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/Region-related%20error%20messages/near/269978076" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nnethercote <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/Region-related.20error.20messages.html#269978076">(Jan 31 2022 at 04:13)</a>:</h4>
<p>I don't know how the change occurred, my refactoring is supposed to not affect behaviour...</p>



<a name="270004798"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/Region-related%20error%20messages/near/270004798" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> oli <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/Region-related.20error.20messages.html#270004798">(Jan 31 2022 at 09:53)</a>:</h4>
<p>The diagnostic code extracts information in ways that can be very fragile. It may be simply that you fixed an obligation span from a dummy span to something useful. cc <span class="user-group-mention" data-user-group-id="1187">@WG-diagnostics</span> this change def seems good to me</p>



<a name="270058767"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/Region-related%20error%20messages/near/270058767" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Esteban Küber <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/Region-related.20error.20messages.html#270058767">(Jan 31 2022 at 16:19)</a>:</h4>
<p>Agree, this change is a fix</p>



<a name="270097287"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/Region-related%20error%20messages/near/270097287" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nnethercote <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/Region-related.20error.20messages.html#270097287">(Jan 31 2022 at 20:12)</a>:</h4>
<p>I'm glad to hear it, though I have no idea how my change touches spans <span aria-label="smile" class="emoji emoji-1f642" role="img" title="smile">:smile:</span></p>



<a name="270097313"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/Region-related%20error%20messages/near/270097313" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nnethercote <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/Region-related.20error.20messages.html#270097313">(Jan 31 2022 at 20:12)</a>:</h4>
<p>Thanks for the info</p>



<a name="270101829"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/Region-related%20error%20messages/near/270101829" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Aaron Hill <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/Region-related.20error.20messages.html#270101829">(Jan 31 2022 at 20:44)</a>:</h4>
<p>My guess would be that you ended up changing the eq/hash behavior of something</p>



<a name="270101886"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/Region-related%20error%20messages/near/270101886" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Aaron Hill <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/Region-related.20error.20messages.html#270101886">(Jan 31 2022 at 20:45)</a>:</h4>
<p>which affected some of the diagnostic that does a hashmap lookup to determine what kind of diagnostic it should emit</p>



<a name="270102564"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/Region-related%20error%20messages/near/270102564" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Aaron Hill <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/Region-related.20error.20messages.html#270102564">(Jan 31 2022 at 20:51)</a>:</h4>
<p>oh, wait, that looks like an error message created by the HIR wf check</p>



<a name="270102650"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/Region-related%20error%20messages/near/270102650" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Aaron Hill <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/Region-related.20error.20messages.html#270102650">(Jan 31 2022 at 20:52)</a>:</h4>
<p><span class="user-mention" data-user-id="120989">@nnethercote</span> Can you push your latest code? I can take a look and try to figure out where the diagnostic change is coming from</p>



<a name="270108907"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/Region-related%20error%20messages/near/270108907" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nnethercote <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/Region-related.20error.20messages.html#270108907">(Jan 31 2022 at 21:35)</a>:</h4>
<p><span class="user-mention" data-user-id="125294">@Aaron Hill</span> Good guess, this change very much does change the Eq/Hash behaviour of <code>Region</code></p>



<a name="270109062"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/Region-related%20error%20messages/near/270109062" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nnethercote <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/Region-related.20error.20messages.html#270109062">(Jan 31 2022 at 21:36)</a>:</h4>
<p>I've updated the code in <a href="https://github.com/rust-lang/rust/issues/93148">#93148</a>, it's the 3rd commit that changes the error message</p>



<a name="270127822"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/Region-related%20error%20messages/near/270127822" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Michael Goulet (compiler-errors) <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/Region-related.20error.20messages.html#270127822">(Feb 01 2022 at 00:01)</a>:</h4>
<p><span class="user-mention silent" data-user-id="120989">nnethercote</span> <a href="#narrow/stream/131828-t-compiler/topic/Region-related.20error.20messages/near/269978076">said</a>:</p>
<blockquote>
<p>I don't know how the change occurred, my refactoring is supposed to not affect behaviour...</p>
</blockquote>
<p>Perhaps something is hashing region (<code>as *const RegionKind</code> instead of by reference) to associate regions with spans for that diagnostic, which now collide because the regions are pointer-equal?</p>
<p>edit: did not refresh to see Aaron's message, hehe, sorry for the spam.</p>



<a name="270128053"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/Region-related%20error%20messages/near/270128053" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Michael Goulet (compiler-errors) <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/Region-related.20error.20messages.html#270128053">(Feb 01 2022 at 00:02)</a>:</h4>
<p>It might be <code>GenericArg</code>, which hashes according to pointer according to its <code>derive(Hash, PartialEq, Eq)</code>?</p>



<hr><p>Last updated: Apr 12 2022 at 20:01 UTC</p>
</html>