<html>
<head><meta charset="utf-8"><title>overflow checks asserting in rustc #89639 · t-compiler · Zulip Chat Archive</title></head>
<h2>Stream: <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/index.html">t-compiler</a></h2>
<h3>Topic: <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/overflow.20checks.20asserting.20in.20rustc.20.2389639.html">overflow checks asserting in rustc #89639</a></h3>

<hr>

<base href="https://rust-lang.zulipchat.com">

<head><link href="https://zulip-archive.rust-lang.org/style.css" rel="stylesheet"></head>

<a name="257218830"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/overflow%20checks%20asserting%20in%20rustc%20%2389639/near/257218830" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> pnkfelix <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/overflow.20checks.20asserting.20in.20rustc.20.2389639.html#257218830">(Oct 12 2021 at 15:09)</a>:</h4>
<p>Hey <span class="user-mention" data-user-id="232957">@Jack Huey</span>  do you think you’ll get a chance in the near future to follow up on <a href="https://github.com/rust-lang/rust/issues/89639">#89639</a>? If not, I’m happy to take a stab at it for you. (I tend to make debug builds locally, and thus I end up hitting issues like this when I run the test suite.)</p>



<a name="257219106"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/overflow%20checks%20asserting%20in%20rustc%20%2389639/near/257219106" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/overflow.20checks.20asserting.20in.20rustc.20.2389639.html#257219106">(Oct 12 2021 at 15:11)</a>:</h4>
<p>I can open up a PR later today, but I'm pretty confident it just needs the + and - terms to be switched</p>



<a name="257219243"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/overflow%20checks%20asserting%20in%20rustc%20%2389639/near/257219243" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> pnkfelix <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/overflow.20checks.20asserting.20in.20rustc.20.2389639.html#257219243">(Oct 12 2021 at 15:12)</a>:</h4>
<p>Okay, great. Let me know if you run out of time.</p>



<a name="257219363"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/overflow%20checks%20asserting%20in%20rustc%20%2389639/near/257219363" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joshua Nelson <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/overflow.20checks.20asserting.20in.20rustc.20.2389639.html#257219363">(Oct 12 2021 at 15:13)</a>:</h4>
<p>I wonder if it makes sense to enable debug assertions on some of the merge tests</p>



<a name="257219422"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/overflow%20checks%20asserting%20in%20rustc%20%2389639/near/257219422" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> pnkfelix <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/overflow.20checks.20asserting.20in.20rustc.20.2389639.html#257219422">(Oct 12 2021 at 15:13)</a>:</h4>
<p>I think someone linked a proposal to enable <em>just</em> the overflow checks in CI</p>



<a name="257219437"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/overflow%20checks%20asserting%20in%20rustc%20%2389639/near/257219437" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joshua Nelson <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/overflow.20checks.20asserting.20in.20rustc.20.2389639.html#257219437">(Oct 12 2021 at 15:13)</a>:</h4>
<p>The Linux builders don't take much time compared to the apple ones</p>



<a name="257219530"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/overflow%20checks%20asserting%20in%20rustc%20%2389639/near/257219530" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> pnkfelix <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/overflow.20checks.20asserting.20in.20rustc.20.2389639.html#257219530">(Oct 12 2021 at 15:14)</a>:</h4>
<p>but I would definitely like <em>one</em> debug-enabled CI. I think I’ve suggested it a number of times.</p>



<a name="257219570"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/overflow%20checks%20asserting%20in%20rustc%20%2389639/near/257219570" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> pnkfelix <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/overflow.20checks.20asserting.20in.20rustc.20.2389639.html#257219570">(Oct 12 2021 at 15:14)</a>:</h4>
<p>(did I make an MCP for it? I cannot remember.)</p>



<a name="257219686"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/overflow%20checks%20asserting%20in%20rustc%20%2389639/near/257219686" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Urgau <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/overflow.20checks.20asserting.20in.20rustc.20.2389639.html#257219686">(Oct 12 2021 at 15:15)</a>:</h4>
<p><a href="https://github.com/rust-lang/rust/pull/89776">CI: Enable overflow checks for test (non-dist) builds</a></p>



<a name="257219760"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/overflow%20checks%20asserting%20in%20rustc%20%2389639/near/257219760" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/overflow.20checks.20asserting.20in.20rustc.20.2389639.html#257219760">(Oct 12 2021 at 15:15)</a>:</h4>
<p>I actually am just going to open a PR now</p>



<a name="257219775"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/overflow%20checks%20asserting%20in%20rustc%20%2389639/near/257219775" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/overflow.20checks.20asserting.20in.20rustc.20.2389639.html#257219775">(Oct 12 2021 at 15:16)</a>:</h4>
<p><span class="user-mention" data-user-id="116083">@pnkfelix</span> I'll r? you</p>



<a name="257219909"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/overflow%20checks%20asserting%20in%20rustc%20%2389639/near/257219909" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> The 8472 <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/overflow.20checks.20asserting.20in.20rustc.20.2389639.html#257219909">(Oct 12 2021 at 15:16)</a>:</h4>
<p>running stage1 instead 2 for debug might be enough?</p>



<a name="257223874"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/overflow%20checks%20asserting%20in%20rustc%20%2389639/near/257223874" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joshua Nelson <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/overflow.20checks.20asserting.20in.20rustc.20.2389639.html#257223874">(Oct 12 2021 at 15:41)</a>:</h4>
<p><span class="user-mention" data-user-id="116083">@pnkfelix</span> you made an MCP for testing stage1, I don't think you mentioned debug assertions</p>



<a name="257233280"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/overflow%20checks%20asserting%20in%20rustc%20%2389639/near/257233280" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Hans Kratz <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/overflow.20checks.20asserting.20in.20rustc.20.2389639.html#257233280">(Oct 12 2021 at 16:39)</a>:</h4>
<p>I opened the overflow checks PR (as a delayed follow-up to adding the options in <a href="https://github.com/rust-lang/rust/issues/87784">#87784</a>). Debug assertions are already enabled for all non-dist non-Apple builds so I think after enabling overflow checks we essentially have full debug CIs?</p>



<a name="257234604"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/overflow%20checks%20asserting%20in%20rustc%20%2389639/near/257234604" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> pnkfelix <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/overflow.20checks.20asserting.20in.20rustc.20.2389639.html#257234604">(Oct 12 2021 at 16:48)</a>:</h4>
<p><span class="user-mention silent" data-user-id="407656">Hans Kratz</span> <a href="#narrow/stream/131828-t-compiler/topic/overflow.20checks.20asserting.20in.20rustc.20.2389639/near/257233280">said</a>:</p>
<blockquote>
<p>I opened the overflow checks PR (as a delayed follow-up to adding the options in <a href="https://github.com/rust-lang/rust/issues/87784">#87784</a>). Debug assertions are already enabled for all non-dist non-Apple builds so I think after enabling overflow checks we essentially have full debug CIs?</p>
</blockquote>
<p>from discussion on <a href="https://github.com/rust-lang/rust/issues/73288">#73288</a>, namely <a href="https://github.com/rust-lang/rust/issues/73288#issuecomment-643556753">this comment</a>, I think we need to go a step further and have a build where <code>libstd</code> itself is built with debug assertions?</p>



<a name="257236511"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/overflow%20checks%20asserting%20in%20rustc%20%2389639/near/257236511" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Hans Kratz <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/overflow.20checks.20asserting.20in.20rustc.20.2389639.html#257236511">(Oct 12 2021 at 17:00)</a>:</h4>
<p><span class="user-mention silent" data-user-id="116083">pnkfelix</span> <a href="#narrow/stream/131828-t-compiler/topic/overflow.20checks.20asserting.20in.20rustc.20.2389639/near/257234604">said</a>:</p>
<blockquote>
<p>from discussion on <a href="https://github.com/rust-lang/rust/issues/73288">#73288</a>, namely <a href="https://github.com/rust-lang/rust/issues/73288#issuecomment-643556753">this comment</a>, I think we need to go a step further and have a build where <code>libstd</code> itself is built with debug assertions?</p>
</blockquote>
<p>AFAICS std is already built with debug assertions. The <a href="https://github.com/rust-lang/rust/blob/9475e609b8458fff9e444934a6017d2e590642cf/src/bootstrap/config.rs#L982">default</a> for <code>rust.debug-assertions-std</code> is <code>rust.debug-assertions</code> which seems to be already <a href="https://github.com/rust-lang/rust/blob/9475e609b8458fff9e444934a6017d2e590642cf/src/ci/run.sh#L89">enabled for non-dist non-apple builds</a>.</p>



<a name="257679063"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/overflow%20checks%20asserting%20in%20rustc%20%2389639/near/257679063" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> pnkfelix <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/overflow.20checks.20asserting.20in.20rustc.20.2389639.html#257679063">(Oct 15 2021 at 10:56)</a>:</h4>
<p>Hmm. I had thought there was still a recurring issue where my local attempts to build with <code>debug=true</code> would not pass the test suite. (And I still suspect I do run into that.) But its possible my issues are apple-specific (though I had thought they plauged other targets as well.)</p>



<a name="257679126"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/overflow%20checks%20asserting%20in%20rustc%20%2389639/near/257679126" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> pnkfelix <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/overflow.20checks.20asserting.20in.20rustc.20.2389639.html#257679126">(Oct 15 2021 at 10:57)</a>:</h4>
<p>But the evidence presented by <span class="user-mention" data-user-id="407656">@Hans Kratz</span> seems to indicate that there is at least an <em>intent</em> to have some CI’s that build with debug-assertions turned on. That’s not necessarily everything that <em>I</em> want (since I often want debuginfo too), but it sounds better than what I had thought the status quo was.</p>



<a name="257689994"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/overflow%20checks%20asserting%20in%20rustc%20%2389639/near/257689994" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Hans Kratz <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/overflow.20checks.20asserting.20in.20rustc.20.2389639.html#257689994">(Oct 15 2021 at 12:33)</a>:</h4>
<p><span class="user-mention silent" data-user-id="116083">pnkfelix</span> <a href="#narrow/stream/131828-t-compiler/topic/overflow.20checks.20asserting.20in.20rustc.20.2389639/near/257679063">said</a>:</p>
<blockquote>
<p>Hmm. I had thought there was still a recurring issue where my local attempts to build with <code>debug=true</code> would not pass the test suite. (And I still suspect I do run into that.) But its possible my issues are apple-specific (though I had thought they plauged other targets as well.)</p>
</blockquote>
<p>Macos Intel or Macos ARM? There were a few Macos ARM-specific issues. I fixed/worked around some of those, for the latest one I submitted a PR earlier today:</p>
<ul>
<li><a href="https://github.com/rust-lang/rust/issues/89170">#89170</a> (merged)</li>
<li><a href="https://github.com/rust-lang/rust/issues/89171">#89171</a> (merged)</li>
<li><a href="https://github.com/rust-lang/rust/issues/89902">#89902</a> (submitted today)</li>
</ul>
<p>With that last one fixed <code>./x.py test --stage 2</code> passes for me locally on an M1 mac with <code>debug = true</code> + <code>overflow-checks = true</code>.</p>



<a name="257694432"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/overflow%20checks%20asserting%20in%20rustc%20%2389639/near/257694432" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> pnkfelix <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/overflow.20checks.20asserting.20in.20rustc.20.2389639.html#257694432">(Oct 15 2021 at 13:06)</a>:</h4>
<p>Mac OS Intel, at the moment</p>



<a name="257694475"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/overflow%20checks%20asserting%20in%20rustc%20%2389639/near/257694475" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> pnkfelix <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/overflow.20checks.20asserting.20in.20rustc.20.2389639.html#257694475">(Oct 15 2021 at 13:07)</a>:</h4>
<p>but, like, here is my latest instance of a <code>debug=true</code> problem</p>



<a name="257694485"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/overflow%20checks%20asserting%20in%20rustc%20%2389639/near/257694485" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> pnkfelix <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/overflow.20checks.20asserting.20in.20rustc.20.2389639.html#257694485">(Oct 15 2021 at 13:07)</a>:</h4>
<p>(this time on Linux)</p>



<a name="257694499"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/overflow%20checks%20asserting%20in%20rustc%20%2389639/near/257694499" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> pnkfelix <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/overflow.20checks.20asserting.20in.20rustc.20.2389639.html#257694499">(Oct 15 2021 at 13:07)</a>:</h4>
<p>"reproducible-build-2 fails if debug=true (on Linux this time)” <a href="https://github.com/rust-lang/rust/issues/89911">#89911</a></p>



<a name="257694622"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/overflow%20checks%20asserting%20in%20rustc%20%2389639/near/257694622" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> pnkfelix <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/overflow.20checks.20asserting.20in.20rustc.20.2389639.html#257694622">(Oct 15 2021 at 13:08)</a>:</h4>
<p><span class="user-mention silent" data-user-id="116083">pnkfelix</span> <a href="#narrow/stream/131828-t-compiler/topic/overflow.20checks.20asserting.20in.20rustc.20.2389639/near/257219530">said</a>:</p>
<blockquote>
<p>but I would definitely like <em>one</em> debug-enabled CI. I think I’ve suggested it a number of times.</p>
</blockquote>
<p>its possible that I wasn’t clear about what I was asking for when I said this. I believe that <code>debug=true</code> is a broader change than just turning on debug-assertions...</p>



<hr><p>Last updated: Apr 12 2022 at 20:01 UTC</p>
</html>