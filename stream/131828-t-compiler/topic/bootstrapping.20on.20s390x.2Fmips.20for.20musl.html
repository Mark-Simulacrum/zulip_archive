<html>
<head><meta charset="utf-8"><title>bootstrapping on s390x/mips for musl · t-compiler · Zulip Chat Archive</title></head>
<h2>Stream: <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/index.html">t-compiler</a></h2>
<h3>Topic: <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/bootstrapping.20on.20s390x.2Fmips.20for.20musl.html">bootstrapping on s390x/mips for musl</a></h3>

<hr>

<base href="https://rust-lang.zulipchat.com">

<head><link href="https://rust-lang.github.io/zulip_archive/style.css" rel="stylesheet"></head>

<a name="225769549"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/bootstrapping%20on%20s390x/mips%20for%20musl/near/225769549" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Alex Gaynor <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/bootstrapping.20on.20s390x.2Fmips.20for.20musl.html#225769549">(Feb 09 2021 at 22:49)</a>:</h4>
<p><span aria-label="wave" class="emoji emoji-1f44b" role="img" title="wave">:wave:</span>, I'm one of the developers of the pyca/cryptography Python library (probably  the most popular python crypto lib), we just shipped a first release that includes Rust code. <span aria-label="tada" class="emoji emoji-1f389" role="img" title="tada">:tada:</span>  (I'm also part of the secure code working group) This has raise a number of platform compatibility issues to the forefront, one of them is that Alpine Linux (which uses musl libc) is having trouble bootstrapping rustc on some of their platforms (s390x and MIPS specifically). If they had support for Rust on all the architectures, this would be a big help to them in terms of adoption of Rust for them.</p>
<p>I'm in a slightly odd place here of acting as a go-between, but: They would like to work with someone who understands rustc bootstrapping. Myself and other pyca/cryptography developers are potentially interested in sponsoring this work, if that's the impediment to getting it done. Is there an existing rustc dev interested in this problem? Is there some structure for finding someone if we were going to pay for it?</p>
<p>(And my apologies if this is the wrong stream for this!)</p>



<a name="225773831"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/bootstrapping%20on%20s390x/mips%20for%20musl/near/225773831" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nagisa <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/bootstrapping.20on.20s390x.2Fmips.20for.20musl.html#225773831">(Feb 09 2021 at 23:35)</a>:</h4>
<p>has any work towards that been done at all so far? I think primarily its going to be just adding the targets in question.</p>



<a name="225773880"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/bootstrapping%20on%20s390x/mips%20for%20musl/near/225773880" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nagisa <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/bootstrapping.20on.20s390x.2Fmips.20for.20musl.html#225773880">(Feb 09 2021 at 23:35)</a>:</h4>
<p>what issues were encountered bootstrapping MIPS?</p>



<a name="225774036"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/bootstrapping%20on%20s390x/mips%20for%20musl/near/225774036" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Alex Gaynor <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/bootstrapping.20on.20s390x.2Fmips.20for.20musl.html#225774036">(Feb 09 2021 at 23:37)</a>:</h4>
<p><a href="https://doc.rust-lang.org/nightly/rustc/platform-support.html">https://doc.rust-lang.org/nightly/rustc/platform-support.html</a> has mips musl but not s390x. What I have from them is:</p>
<blockquote>
<p>Basically, what happens is that when building a cross-compiler (in the<br>
same way as you would cross compile GCC in order to bring up a new<br>
architecture), the process dies after building stage0.  We are not sure<br>
why the process dies, it could be something very trivial that we are<br>
missing.</p>
</blockquote>



<a name="225774240"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/bootstrapping%20on%20s390x/mips%20for%20musl/near/225774240" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nagisa <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/bootstrapping.20on.20s390x.2Fmips.20for.20musl.html#225774240">(Feb 09 2021 at 23:39)</a>:</h4>
<p>that's… not very much to start with. Lack of the s390x musl target is a blocker for bootstrap either way… I would suspect that maybe a wrong <code>--target</code> triple was specified for mips?</p>



<a name="225774447"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/bootstrapping%20on%20s390x/mips%20for%20musl/near/225774447" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Alex Gaynor <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/bootstrapping.20on.20s390x.2Fmips.20for.20musl.html#225774447">(Feb 09 2021 at 23:41)</a>:</h4>
<p>Yes I agree it's not really enough to debug on :-) ATM I'm as interested in the meta-question of how to get the alpine folks help from a rustc developer, and if it requires sponsorship, as I am in the specific question of "why it dies".</p>



<a name="225774493"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/bootstrapping%20on%20s390x/mips%20for%20musl/near/225774493" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Alex Gaynor <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/bootstrapping.20on.20s390x.2Fmips.20for.20musl.html#225774493">(Feb 09 2021 at 23:41)</a>:</h4>
<p>And perhaps the answer is as simple as "some alpine folks should join this stream" as a starting point.</p>



<a name="225774836"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/bootstrapping%20on%20s390x/mips%20for%20musl/near/225774836" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nagisa <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/bootstrapping.20on.20s390x.2Fmips.20for.20musl.html#225774836">(Feb 09 2021 at 23:44)</a>:</h4>
<p>I don't anticipate this to be much work at all given that both architectures have been proven to work (though perhaps not those exact targets), and we have working musl support (at least on x86_64) as well. So its to me sounds mostly just aligning the lego pieces right (and adding the targets).</p>
<p>I'm happy to PR a s390x-musl target if nobody gets to it before me this coming weekend.</p>



<a name="225774890"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/bootstrapping%20on%20s390x/mips%20for%20musl/near/225774890" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nagisa <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/bootstrapping.20on.20s390x.2Fmips.20for.20musl.html#225774890">(Feb 09 2021 at 23:45)</a>:</h4>
<p>Another question: is the mips bootstrap attempted for the bigendian variant or the little endian?</p>



<a name="225774955"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/bootstrapping%20on%20s390x/mips%20for%20musl/near/225774955" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nagisa <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/bootstrapping.20on.20s390x.2Fmips.20for.20musl.html#225774955">(Feb 09 2021 at 23:46)</a>:</h4>
<p>(alternatively, maybe alpine also targets something like sparc?)</p>



<a name="225774975"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/bootstrapping%20on%20s390x/mips%20for%20musl/near/225774975" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nagisa <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/bootstrapping.20on.20s390x.2Fmips.20for.20musl.html#225774975">(Feb 09 2021 at 23:46)</a>:</h4>
<p>(or a big-endian ppc)</p>



<a name="225775094"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/bootstrapping%20on%20s390x/mips%20for%20musl/near/225775094" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nagisa <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/bootstrapping.20on.20s390x.2Fmips.20for.20musl.html#225775094">(Feb 09 2021 at 23:47)</a>:</h4>
<p>endianess bugs have bitten us in the past, but to really tell we'd just need more information as to how exactly things are failing.</p>
<p>So I would suggest starting there.</p>



<a name="225775696"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/bootstrapping%20on%20s390x/mips%20for%20musl/near/225775696" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nagisa <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/bootstrapping.20on.20s390x.2Fmips.20for.20musl.html#225775696">(Feb 09 2021 at 23:55)</a>:</h4>
<p>As for the sponsorship: its a hard question. It… depends? I imagine that it might be difficult to get a-hold of a dedicated person to work woth, if a more difficult problem were to arise. Many of us are volunteers after all. Paying somebody to be available and/or work on the problem would likely help to some extent, but then there are plenty of examples where bounties weren't of much help in getting things to progress, either.</p>



<a name="225775976"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/bootstrapping%20on%20s390x/mips%20for%20musl/near/225775976" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Alex Gaynor <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/bootstrapping.20on.20s390x.2Fmips.20for.20musl.html#225775976">(Feb 09 2021 at 23:58)</a>:</h4>
<p>Thanks, I appreciate it!</p>



<a name="225776195"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/bootstrapping%20on%20s390x/mips%20for%20musl/near/225776195" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Alex Gaynor <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/bootstrapping.20on.20s390x.2Fmips.20for.20musl.html#225776195">(Feb 10 2021 at 00:00)</a>:</h4>
<p>For s390x it looks like they have a patch <a href="https://github.com/alpinelinux/aports/blob/master/community/rust/musl-add-s390x-target.patch">https://github.com/alpinelinux/aports/blob/master/community/rust/musl-add-s390x-target.patch</a></p>



<a name="225780290"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/bootstrapping%20on%20s390x/mips%20for%20musl/near/225780290" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ariadne Conill <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/bootstrapping.20on.20s390x.2Fmips.20for.20musl.html#225780290">(Feb 10 2021 at 00:46)</a>:</h4>
<p>Hi everyone.  That s390x patch is incomplete, but not related to the actual issue.</p>
<p>The main issue is that we cannot successfully cross compile <em>any</em> rust compiler, e.g. build a rustc that runs on aarch64 from an x86_64 host.  That is the main prerequisite for enabling s390x and mips64[el] and the other ports that presently lack rustc.</p>
<p>You can see how we do it by looking at our APKBUILD, <a href="https://github.com/alpinelinux/aports/blob/master/community/rust/APKBUILD">https://github.com/alpinelinux/aports/blob/master/community/rust/APKBUILD</a>.  Does anyone have any ideas on what to do?  I last brought this up in October, but nobody could figure it out then.</p>



<a name="225780492"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/bootstrapping%20on%20s390x/mips%20for%20musl/near/225780492" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ariadne Conill <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/bootstrapping.20on.20s390x.2Fmips.20for.20musl.html#225780492">(Feb 10 2021 at 00:49)</a>:</h4>
<p>Most likely it is something stupid that is missing that we simply do not understand.  I think once that issue is tackled, it is just a matter of adding the additional targets and doing the bootstrap.</p>
<p>I suspect the targets we add may be defective in some way -- Void Linux, for example, is able to cross-compile their rust packaging, but instead of adding new targets, they modify the generic musl targets to have similar behavior as glibc (e.g. removing the static linking defaults).  We do the same, but through adding new targets which derive from the generic musl ones.</p>



<a name="225781171"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/bootstrapping%20on%20s390x/mips%20for%20musl/near/225781171" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> cuviper <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/bootstrapping.20on.20s390x.2Fmips.20for.20musl.html#225781171">(Feb 10 2021 at 00:57)</a>:</h4>
<p>for s390x in particular, we have an issue with cross-compiling that has not been fully diagnosed, <a href="https://github.com/rust-lang/rust/issues/80810">#80810</a></p>



<a name="225781259"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/bootstrapping%20on%20s390x/mips%20for%20musl/near/225781259" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> cuviper <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/bootstrapping.20on.20s390x.2Fmips.20for.20musl.html#225781259">(Feb 10 2021 at 00:58)</a>:</h4>
<p>but in general, I'd look at the way we set cross-compiling variables in src/ci/docker/...</p>



<a name="225781393"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/bootstrapping%20on%20s390x/mips%20for%20musl/near/225781393" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> cuviper <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/bootstrapping.20on.20s390x.2Fmips.20for.20musl.html#225781393">(Feb 10 2021 at 01:00)</a>:</h4>
<p>some are using crosstool-ng for the toolchain, and others just ubuntu cross tools, but you can at least learn from the environment variables we set</p>



<a name="225783769"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/bootstrapping%20on%20s390x/mips%20for%20musl/near/225783769" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ariadne Conill <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/bootstrapping.20on.20s390x.2Fmips.20for.20musl.html#225783769">(Feb 10 2021 at 01:32)</a>:</h4>
<p>yeah <a href="https://github.com/rust-lang/rust/issues/80810">#80810</a> isn’t related here.  we don’t get any tool chain at all.</p>



<a name="225787203"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/bootstrapping%20on%20s390x/mips%20for%20musl/near/225787203" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joshua Nelson <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/bootstrapping.20on.20s390x.2Fmips.20for.20musl.html#225787203">(Feb 10 2021 at 02:28)</a>:</h4>
<blockquote>
<p>I last brought this up in October, but nobody could figure it out then.</p>
</blockquote>
<p>do you have a link?</p>



<a name="225788061"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/bootstrapping%20on%20s390x/mips%20for%20musl/near/225788061" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ariadne Conill <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/bootstrapping.20on.20s390x.2Fmips.20for.20musl.html#225788061">(Feb 10 2021 at 02:43)</a>:</h4>
<p>hang on, trying to figure out how to get the link to that zulip thread</p>



<a name="225788072"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/bootstrapping%20on%20s390x/mips%20for%20musl/near/225788072" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joshua Nelson <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/bootstrapping.20on.20s390x.2Fmips.20for.20musl.html#225788072">(Feb 10 2021 at 02:43)</a>:</h4>
<p><a href="http://zulip-archive.rust-lang.org/">zulip-archive.rust-lang.org/</a> will probably be easier than trying to use search</p>



<a name="225788158"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/bootstrapping%20on%20s390x/mips%20for%20musl/near/225788158" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ariadne Conill <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/bootstrapping.20on.20s390x.2Fmips.20for.20musl.html#225788158">(Feb 10 2021 at 02:45)</a>:</h4>
<p><a href="https://zulip-archive.rust-lang.org/182449tcompilerhelp/94495crosscompilationandmissingrdlallocandfriends.html">https://zulip-archive.rust-lang.org/182449tcompilerhelp/94495crosscompilationandmissingrdlallocandfriends.html</a></p>



<a name="225788623"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/bootstrapping%20on%20s390x/mips%20for%20musl/near/225788623" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ariadne Conill <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/bootstrapping.20on.20s390x.2Fmips.20for.20musl.html#225788623">(Feb 10 2021 at 02:53)</a>:</h4>
<p>so anyway, i’m still stumped on this, but it’s becoming more urgent to solve as more things require rust</p>



<a name="225788683"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/bootstrapping%20on%20s390x/mips%20for%20musl/near/225788683" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joshua Nelson <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/bootstrapping.20on.20s390x.2Fmips.20for.20musl.html#225788683">(Feb 10 2021 at 02:54)</a>:</h4>
<p>(sorry, I can help after I finish a thing for work)</p>



<a name="225788796"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/bootstrapping%20on%20s390x/mips%20for%20musl/near/225788796" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ariadne Conill <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/bootstrapping.20on.20s390x.2Fmips.20for.20musl.html#225788796">(Feb 10 2021 at 02:57)</a>:</h4>
<p>no rush :)</p>



<a name="225789085"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/bootstrapping%20on%20s390x/mips%20for%20musl/near/225789085" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joshua Nelson <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/bootstrapping.20on.20s390x.2Fmips.20for.20musl.html#225789085">(Feb 10 2021 at 03:02)</a>:</h4>
<p>oh heh I was on that thread too</p>



<a name="225790062"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/bootstrapping%20on%20s390x/mips%20for%20musl/near/225790062" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ariadne Conill <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/bootstrapping.20on.20s390x.2Fmips.20for.20musl.html#225790062">(Feb 10 2021 at 03:23)</a>:</h4>
<p>indeed</p>



<a name="225790085"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/bootstrapping%20on%20s390x/mips%20for%20musl/near/225790085" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ariadne Conill <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/bootstrapping.20on.20s390x.2Fmips.20for.20musl.html#225790085">(Feb 10 2021 at 03:23)</a>:</h4>
<p>unfortunately higher priority projects came up, but we can revisit this now</p>



<a name="225790657"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/bootstrapping%20on%20s390x/mips%20for%20musl/near/225790657" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> simulacrum <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/bootstrapping.20on.20s390x.2Fmips.20for.20musl.html#225790657">(Feb 10 2021 at 03:34)</a>:</h4>
<p><span class="user-mention" data-user-id="360752">@Ariadne Conill</span> I think my main recommendation is to switch to x.py dist (and/or install) which generally are much better at producing what folks expect; build currently has some bugs around cross compilation. Dist and install also have significantly more stable interfaces generally speaking.</p>



<a name="225790724"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/bootstrapping%20on%20s390x/mips%20for%20musl/near/225790724" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ariadne Conill <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/bootstrapping.20on.20s390x.2Fmips.20for.20musl.html#225790724">(Feb 10 2021 at 03:36)</a>:</h4>
<p>what would that look like?</p>



<a name="225790818"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/bootstrapping%20on%20s390x/mips%20for%20musl/near/225790818" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> simulacrum <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/bootstrapping.20on.20s390x.2Fmips.20for.20musl.html#225790818">(Feb 10 2021 at 03:38)</a>:</h4>
<p>So, x.py dist produces tarballs in build/dist and x.py install will default to putting rustc in e.g. /usr/bin, but you can configure that. I'm not sure if that answers your question - if you replace x.py build in the file you linked with dist or install I would expect you to get the artifacts you want.</p>



<a name="225790834"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/bootstrapping%20on%20s390x/mips%20for%20musl/near/225790834" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> simulacrum <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/bootstrapping.20on.20s390x.2Fmips.20for.20musl.html#225790834">(Feb 10 2021 at 03:39)</a>:</h4>
<p>Both will build the compiler and other necessary components directly; you don't need to invoke build first.</p>



<a name="225790841"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/bootstrapping%20on%20s390x/mips%20for%20musl/near/225790841" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> simulacrum <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/bootstrapping.20on.20s390x.2Fmips.20for.20musl.html#225790841">(Feb 10 2021 at 03:39)</a>:</h4>
<p>I personally would use x.py install for this sort of use case.</p>



<a name="225791006"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/bootstrapping%20on%20s390x/mips%20for%20musl/near/225791006" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ariadne Conill <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/bootstrapping.20on.20s390x.2Fmips.20for.20musl.html#225791006">(Feb 10 2021 at 03:42)</a>:</h4>
<p>so the reason we cannot do that, is because there's a build phase and a package phase</p>



<a name="225791020"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/bootstrapping%20on%20s390x/mips%20for%20musl/near/225791020" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ariadne Conill <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/bootstrapping.20on.20s390x.2Fmips.20for.20musl.html#225791020">(Feb 10 2021 at 03:43)</a>:</h4>
<p>we want to build the artifacts without using fakeroot, and then we use fakeroot to set up the package filesystem</p>



<a name="225791109"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/bootstrapping%20on%20s390x/mips%20for%20musl/near/225791109" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ariadne Conill <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/bootstrapping.20on.20s390x.2Fmips.20for.20musl.html#225791109">(Feb 10 2021 at 03:45)</a>:</h4>
<p>though i am confused as to why this would make a difference, void linux uses x.py build to cross compile and it works fine for them.</p>
<p>the key difference between us and void is that we add new targets for dynamically-linked musl distributions, while void linux modifies the targets to remove the "static linking by default" setting.  they can cross compile just fine, but we can't.</p>



<a name="225791204"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/bootstrapping%20on%20s390x/mips%20for%20musl/near/225791204" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ariadne Conill <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/bootstrapping.20on.20s390x.2Fmips.20for.20musl.html#225791204">(Feb 10 2021 at 03:47)</a>:</h4>
<p>(it is an open question whether or not we are taking the right approach there, or whether or not the "static linking by default" setting of the generic musl targets are appropriate)</p>



<a name="225791229"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/bootstrapping%20on%20s390x/mips%20for%20musl/near/225791229" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ariadne Conill <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/bootstrapping.20on.20s390x.2Fmips.20for.20musl.html#225791229">(Feb 10 2021 at 03:47)</a>:</h4>
<p>(while your average end user looking to build software linked against musl probably does want static linking in that case, distros definitely don't, and glibc is treated differently.)</p>



<a name="225791375"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/bootstrapping%20on%20s390x/mips%20for%20musl/near/225791375" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> simulacrum <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/bootstrapping.20on.20s390x.2Fmips.20for.20musl.html#225791375">(Feb 10 2021 at 03:50)</a>:</h4>
<p>So, unless I'm missing something, you would just want to set your prefix to e.g. build/prefix, and then do whatever you do today to copy the files out of that directory after x.py install.</p>



<a name="225791456"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/bootstrapping%20on%20s390x/mips%20for%20musl/near/225791456" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> simulacrum <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/bootstrapping.20on.20s390x.2Fmips.20for.20musl.html#225791456">(Feb 10 2021 at 03:52)</a>:</h4>
<p>If you still see empty artifact directories after trying this, please file an issue and ping me (@Mark-Simulacrum), I'd be happy to take a more detailed look.</p>



<a name="225791465"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/bootstrapping%20on%20s390x/mips%20for%20musl/near/225791465" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ariadne Conill <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/bootstrapping.20on.20s390x.2Fmips.20for.20musl.html#225791465">(Feb 10 2021 at 03:52)</a>:</h4>
<p>and there won't be hardcoded paths in the binary?</p>



<a name="225791485"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/bootstrapping%20on%20s390x/mips%20for%20musl/near/225791485" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> simulacrum <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/bootstrapping.20on.20s390x.2Fmips.20for.20musl.html#225791485">(Feb 10 2021 at 03:53)</a>:</h4>
<p>No, there's not really any difference in produced binaries either way - it's just x.py dist and install do the right thing for packagers/cross compilation in more cases today.</p>



<a name="225791571"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/bootstrapping%20on%20s390x/mips%20for%20musl/near/225791571" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ariadne Conill <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/bootstrapping.20on.20s390x.2Fmips.20for.20musl.html#225791571">(Feb 10 2021 at 03:55)</a>:</h4>
<p>okay.  in autoconf world, messing with <code>--prefix</code> can result in that prefix being hardcoded in the binary.  for example, you can't relocate GCC paths as a result of that.</p>
<p>but i can look into x.py install case if there is an example somewhere</p>



<a name="225791647"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/bootstrapping%20on%20s390x/mips%20for%20musl/near/225791647" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joshua Nelson <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/bootstrapping.20on.20s390x.2Fmips.20for.20musl.html#225791647">(Feb 10 2021 at 03:57)</a>:</h4>
<p>just now finished <span aria-label="laughing" class="emoji emoji-1f606" role="img" title="laughing">:laughing:</span> </p>
<blockquote>
<p>if there is an example somewhere</p>
</blockquote>
<p>try this:</p>
<div class="codehilite"><pre><span></span><code>$ cat config.toml
[install]
prefix = &quot;build/prefix&quot;
$ ./x.py install
</code></pre></div>
<p>(with appropriate --target flags)</p>



<a name="225791795"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/bootstrapping%20on%20s390x/mips%20for%20musl/near/225791795" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ariadne Conill <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/bootstrapping.20on.20s390x.2Fmips.20for.20musl.html#225791795">(Feb 10 2021 at 04:00)</a>:</h4>
<p>but what does <code>build/prefix</code> do to the actual packaging?</p>



<a name="225791799"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/bootstrapping%20on%20s390x/mips%20for%20musl/near/225791799" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ariadne Conill <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/bootstrapping.20on.20s390x.2Fmips.20for.20musl.html#225791799">(Feb 10 2021 at 04:00)</a>:</h4>
<p>we want to wind up with rustc in /usr/bin</p>



<a name="225791821"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/bootstrapping%20on%20s390x/mips%20for%20musl/near/225791821" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joshua Nelson <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/bootstrapping.20on.20s390x.2Fmips.20for.20musl.html#225791821">(Feb 10 2021 at 04:01)</a>:</h4>
<p>it doesn't. It's just a way to build the artifacts without installing them, which you said you wanted</p>



<a name="225791827"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/bootstrapping%20on%20s390x/mips%20for%20musl/near/225791827" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joshua Nelson <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/bootstrapping.20on.20s390x.2Fmips.20for.20musl.html#225791827">(Feb 10 2021 at 04:01)</a>:</h4>
<p>then in the packaging step you can copy build/prefix to /usr/bin</p>



<a name="225791922"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/bootstrapping%20on%20s390x/mips%20for%20musl/near/225791922" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joshua Nelson <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/bootstrapping.20on.20s390x.2Fmips.20for.20musl.html#225791922">(Feb 10 2021 at 04:03)</a>:</h4>
<p><span class="user-mention silent" data-user-id="116122">simulacrum</span> <a href="#narrow/stream/131828-t-compiler/topic/bootstraping.20on.20s390x.2Fmips.20for.20musl/near/225790657">said</a>:</p>
<blockquote>
<p><span class="user-mention silent" data-user-id="360752">Ariadne Conill</span> I think my main recommendation is to switch to x.py dist (and/or install) which generally are much better at producing what folks expect; build currently has some bugs around cross compilation. Dist and install also have significantly more stable interfaces generally speaking.</p>
</blockquote>
<p>btw, why is build more unstable than <code>install</code> and <code>dist</code>?</p>



<a name="225791952"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/bootstrapping%20on%20s390x/mips%20for%20musl/near/225791952" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ariadne Conill <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/bootstrapping.20on.20s390x.2Fmips.20for.20musl.html#225791952">(Feb 10 2021 at 04:03)</a>:</h4>
<p>yes, i am not convinced that this is the problem at all.  i am 100% certain it is related to our use of custom targets instead of just patching the generic targets to fit our requirements</p>



<a name="225792167"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/bootstrapping%20on%20s390x/mips%20for%20musl/near/225792167" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ariadne Conill <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/bootstrapping.20on.20s390x.2Fmips.20for.20musl.html#225792167">(Feb 10 2021 at 04:07)</a>:</h4>
<p>the reason i am not convinced is because void uses x.py build and can cross, and we can't, and the primary substantive difference is the custom targets.  i should be able to at least build an aarch64 cross compiler on an x86_64 host, which void can do in their packaging, but we cannot.</p>



<a name="225792275"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/bootstrapping%20on%20s390x/mips%20for%20musl/near/225792275" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ariadne Conill <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/bootstrapping.20on.20s390x.2Fmips.20for.20musl.html#225792275">(Feb 10 2021 at 04:09)</a>:</h4>
<p>oh huh, void did switch to x.py dist.  ok i'll investigate that</p>



<a name="225792352"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/bootstrapping%20on%20s390x/mips%20for%20musl/near/225792352" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ariadne Conill <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/bootstrapping.20on.20s390x.2Fmips.20for.20musl.html#225792352">(Feb 10 2021 at 04:11)</a>:</h4>
<p>i need to wait for a cross toolchain to finish building tho</p>



<a name="225792510"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/bootstrapping%20on%20s390x/mips%20for%20musl/near/225792510" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joshua Nelson <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/bootstrapping.20on.20s390x.2Fmips.20for.20musl.html#225792510">(Feb 10 2021 at 04:14)</a>:</h4>
<p>the point is not so much "x.py build is causing the bug" as much as "x.py build is known to have bugs and it's hard to tell if this is an existing bug or an actual problem"</p>



<a name="225792532"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/bootstrapping%20on%20s390x/mips%20for%20musl/near/225792532" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ariadne Conill <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/bootstrapping.20on.20s390x.2Fmips.20for.20musl.html#225792532">(Feb 10 2021 at 04:15)</a>:</h4>
<p>yeah we can check it out.  right now i'm building a cross toolchain for aarch64.  that way s390x is not even an issue to fight.</p>



<a name="225792646"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/bootstrapping%20on%20s390x/mips%20for%20musl/near/225792646" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ariadne Conill <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/bootstrapping.20on.20s390x.2Fmips.20for.20musl.html#225792646">(Feb 10 2021 at 04:17)</a>:</h4>
<p>i think our current plan of attack will be:</p>
<ul>
<li>make it cross x86_64 -&gt; aarch64</li>
<li>upgrade to 1.48 from 1.47</li>
<li>attempt to cross x86_64 -&gt; s390x</li>
<li>attempt to cross the remaining targets</li>
</ul>



<a name="225792832"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/bootstrapping%20on%20s390x/mips%20for%20musl/near/225792832" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joshua Nelson <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/bootstrapping.20on.20s390x.2Fmips.20for.20musl.html#225792832">(Feb 10 2021 at 04:20)</a>:</h4>
<p>I've never been patient enough to do a full stage2 build haha, I can help with conceptual things but I've never tried cross-compiling</p>



<a name="225792858"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/bootstrapping%20on%20s390x/mips%20for%20musl/near/225792858" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ariadne Conill <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/bootstrapping.20on.20s390x.2Fmips.20for.20musl.html#225792858">(Feb 10 2021 at 04:20)</a>:</h4>
<p>thankfully i have dual AMD EPYC 7742 system that i can use for this</p>



<a name="225793356"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/bootstrapping%20on%20s390x/mips%20for%20musl/near/225793356" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ariadne Conill <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/bootstrapping.20on.20s390x.2Fmips.20for.20musl.html#225793356">(Feb 10 2021 at 04:31)</a>:</h4>
<p>now to the longest part, LLVM</p>



<a name="225793418"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/bootstrapping%20on%20s390x/mips%20for%20musl/near/225793418" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joshua Nelson <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/bootstrapping.20on.20s390x.2Fmips.20for.20musl.html#225793418">(Feb 10 2021 at 04:32)</a>:</h4>
<p>I don't know your distros requirements - if you're ok downloading things, you can set <code>download-ci-llvm</code> so you don't have to build from source</p>



<a name="225793428"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/bootstrapping%20on%20s390x/mips%20for%20musl/near/225793428" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joshua Nelson <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/bootstrapping.20on.20s390x.2Fmips.20for.20musl.html#225793428">(Feb 10 2021 at 04:32)</a>:</h4>
<p>oh well that probably doesn't work if it's not a tier 1 platform anyway</p>



<a name="225793476"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/bootstrapping%20on%20s390x/mips%20for%20musl/near/225793476" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ariadne Conill <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/bootstrapping.20on.20s390x.2Fmips.20for.20musl.html#225793476">(Feb 10 2021 at 04:33)</a>:</h4>
<p>we have to cross compile LLVM for the target, then rust</p>



<a name="225793798"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/bootstrapping%20on%20s390x/mips%20for%20musl/near/225793798" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ariadne Conill <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/bootstrapping.20on.20s390x.2Fmips.20for.20musl.html#225793798">(Feb 10 2021 at 04:39)</a>:</h4>
<p>basically, Alpine has this mega script, <code>bootstrap.sh</code>, which when complete, spits out a set of packages and an ISO you can boot on regular hardware to get a builder up and rebuild the entire distro from, so it has to build everything, including rust's dependencies</p>



<a name="225793844"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/bootstrapping%20on%20s390x/mips%20for%20musl/near/225793844" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ariadne Conill <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/bootstrapping.20on.20s390x.2Fmips.20for.20musl.html#225793844">(Feb 10 2021 at 04:40)</a>:</h4>
<p>(in some cases, it's not an ISO, but that is the situation for most archs)</p>



<a name="225797507"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/bootstrapping%20on%20s390x/mips%20for%20musl/near/225797507" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ariadne Conill <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/bootstrapping.20on.20s390x.2Fmips.20for.20musl.html#225797507">(Feb 10 2021 at 06:00)</a>:</h4>
<p>looks like cross might work for x86_64 -&gt; aarch64 with x.py build.</p>



<a name="225797542"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/bootstrapping%20on%20s390x/mips%20for%20musl/near/225797542" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ariadne Conill <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/bootstrapping.20on.20s390x.2Fmips.20for.20musl.html#225797542">(Feb 10 2021 at 06:00)</a>:</h4>
<p>i also noticed something about the s390x triplet.  it may be wrong :)</p>



<a name="225797589"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/bootstrapping%20on%20s390x/mips%20for%20musl/near/225797589" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ariadne Conill <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/bootstrapping.20on.20s390x.2Fmips.20for.20musl.html#225797589">(Feb 10 2021 at 06:01)</a>:</h4>
<p>but so far the x86_64 -&gt; aarch64 cross hasn't bombed out, and we're much farther in than i was getting before</p>



<a name="225797721"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/bootstrapping%20on%20s390x/mips%20for%20musl/near/225797721" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ariadne Conill <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/bootstrapping.20on.20s390x.2Fmips.20for.20musl.html#225797721">(Feb 10 2021 at 06:03)</a>:</h4>
<p>the real nightmare is going to be mips64, all the MIPS ports are softfloat because Octeon FPU is buggy</p>



<a name="225797773"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/bootstrapping%20on%20s390x/mips%20for%20musl/near/225797773" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ariadne Conill <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/bootstrapping.20on.20s390x.2Fmips.20for.20musl.html#225797773">(Feb 10 2021 at 06:04)</a>:</h4>
<p>(Loongson may be hardfloat.  I need to set up the board and check it.)</p>



<a name="225798528"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/bootstrapping%20on%20s390x/mips%20for%20musl/near/225798528" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ariadne Conill <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/bootstrapping.20on.20s390x.2Fmips.20for.20musl.html#225798528">(Feb 10 2021 at 06:19)</a>:</h4>
<div class="codehilite"><pre><span></span><code>Assembling stage1 compiler (aarch64-alpine-linux-musl)
Building stage1 std artifacts (aarch64-alpine-linux-musl -&gt; x86_64-alpine-linux-musl)
error: process didn&#39;t exit successfully: `/home/kaniini/aports/community/rust/src/rustc-1.47.0-src/build/bootstrap/debug/rustc -vV` (exit code: 101)
--- stderr
thread &#39;main&#39; panicked at &#39;
Failed to run:
&quot;/home/kaniini/aports/community/rust/src/rustc-1.47.0-src/build/aarch64-alpine-linux-musl/stage1/bin/rustc&quot; &quot;-vV&quot; &quot;-Wrust_2018_idioms&quot; &quot;-Wunused_lifetimes&quot; &quot;-Clinker=aarch64-alpine-linux-musl-gcc&quot; &quot;-C&quot; &quot;target-feature=-crt-static&quot; &quot;-Z&quot; &quot;force-unstable-if-unmarked&quot;
-------------: Os { code: 8, kind: Other, message: &quot;Exec format error&quot; }&#39;, src/bootstrap/bin/rustc.rs:152:22
stack backtrace:
   0: rust_begin_unwind
   1: core::panicking::panic_fmt
   2: core::result::unwrap_failed
   3: core::result::Result&lt;T,E&gt;::expect
             at ./library/core/src/result.rs:933
   4: rustc::main
             at ./src/bootstrap/bin/rustc.rs:152
   5: core::ops::function::FnOnce::call_once
             at ./library/core/src/ops/function.rs:227
note: Some details are omitted, run with `RUST_BACKTRACE=full` for a verbose backtrace.

command did not execute successfully: &quot;/usr/bin/cargo&quot; &quot;build&quot; &quot;--target&quot; &quot;x86_64-alpine-linux-musl&quot; &quot;-Zbinary-dep-depinfo&quot; &quot;-j&quot; &quot;256&quot; &quot;--release&quot; &quot;--locked&quot; &quot;--frozen&quot; &quot;--features&quot; &quot;panic-unwind backtrace&quot; &quot;--manifest-path&quot; &quot;/home/kaniini/aports/community/rust/src/rustc
-1.47.0-src/library/test/Cargo.toml&quot; &quot;--message-format&quot; &quot;json-render-diagnostics&quot;
expected success, got: exit code: 101
failed to run: /home/kaniini/aports/community/rust/src/rustc-1.47.0-src/build/bootstrap/debug/bootstrap build --jobs 256
</code></pre></div>



<a name="225798577"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/bootstrapping%20on%20s390x/mips%20for%20musl/near/225798577" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ariadne Conill <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/bootstrapping.20on.20s390x.2Fmips.20for.20musl.html#225798577">(Feb 10 2021 at 06:20)</a>:</h4>
<p>welp... it tried to run the aarch64 compiler.  i guess there is something to this dist stuff after all</p>



<a name="225798666"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/bootstrapping%20on%20s390x/mips%20for%20musl/near/225798666" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ariadne Conill <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/bootstrapping.20on.20s390x.2Fmips.20for.20musl.html#225798666">(Feb 10 2021 at 06:22)</a>:</h4>
<p>going to retry with x.py dist</p>



<a name="225800255"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/bootstrapping%20on%20s390x/mips%20for%20musl/near/225800255" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joshua Nelson <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/bootstrapping.20on.20s390x.2Fmips.20for.20musl.html#225800255">(Feb 10 2021 at 06:57)</a>:</h4>
<p>Hmm, that's weird that the target compiler is in stage1 and not stage2</p>



<a name="225800280"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/bootstrapping%20on%20s390x/mips%20for%20musl/near/225800280" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joshua Nelson <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/bootstrapping.20on.20s390x.2Fmips.20for.20musl.html#225800280">(Feb 10 2021 at 06:57)</a>:</h4>
<p>Did you pass --host or something?</p>



<a name="225800371"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/bootstrapping%20on%20s390x/mips%20for%20musl/near/225800371" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ariadne Conill <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/bootstrapping.20on.20s390x.2Fmips.20for.20musl.html#225800371">(Feb 10 2021 at 06:59)</a>:</h4>
<p>huh.  we do pass <code>--host="$_target"</code>.  perhaps <code>--host="$_build"</code> makes more sense :)</p>



<a name="225800386"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/bootstrapping%20on%20s390x/mips%20for%20musl/near/225800386" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ariadne Conill <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/bootstrapping.20on.20s390x.2Fmips.20for.20musl.html#225800386">(Feb 10 2021 at 06:59)</a>:</h4>
<p>or perhaps we do not need <code>--host</code> at all</p>



<a name="225800607"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/bootstrapping%20on%20s390x/mips%20for%20musl/near/225800607" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joshua Nelson <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/bootstrapping.20on.20s390x.2Fmips.20for.20musl.html#225800607">(Feb 10 2021 at 07:03)</a>:</h4>
<p>I would see what happens if you remove --host</p>



<a name="225800669"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/bootstrapping%20on%20s390x/mips%20for%20musl/near/225800669" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ariadne Conill <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/bootstrapping.20on.20s390x.2Fmips.20for.20musl.html#225800669">(Feb 10 2021 at 07:04)</a>:</h4>
<p>so, the goal is to wind up with a rustc that i can run on aarch64 in this case.</p>
<p><a href="https://github.com/rust-lang/rust/blob/master/config.toml.example#L168-L188">https://github.com/rust-lang/rust/blob/master/config.toml.example#L168-L188</a> indicates that host and target must be set the same for this.</p>



<a name="225800685"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/bootstrapping%20on%20s390x/mips%20for%20musl/near/225800685" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ariadne Conill <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/bootstrapping.20on.20s390x.2Fmips.20for.20musl.html#225800685">(Feb 10 2021 at 07:04)</a>:</h4>
<p>this view is backed up with <a href="https://github.com/void-linux/void-packages/blob/master/srcpkgs/rust/template#L226-L228">https://github.com/void-linux/void-packages/blob/master/srcpkgs/rust/template#L226-L228</a> which does precisely the same</p>



<a name="225800708"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/bootstrapping%20on%20s390x/mips%20for%20musl/near/225800708" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ariadne Conill <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/bootstrapping.20on.20s390x.2Fmips.20for.20musl.html#225800708">(Feb 10 2021 at 07:05)</a>:</h4>
<p>i'm skeptical that if i remove --host that i will get a compiler that can run on aarch64.</p>



<a name="225800808"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/bootstrapping%20on%20s390x/mips%20for%20musl/near/225800808" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ariadne Conill <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/bootstrapping.20on.20s390x.2Fmips.20for.20musl.html#225800808">(Feb 10 2021 at 07:07)</a>:</h4>
<p>About <code>--target</code> the example config says: </p>
<div class="codehilite"><pre><span></span><code># Defaults to `host`. If you set this explicitly, you likely want to add all
# host triples to this list as well in order for those host toolchains to be
# able to compile programs for their native target.
</code></pre></div>
<p>So I think <code>--host</code> is needed and <code>--target</code> is technically optional.  But it's harmless if they are the same.</p>



<a name="225800906"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/bootstrapping%20on%20s390x/mips%20for%20musl/near/225800906" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joshua Nelson <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/bootstrapping.20on.20s390x.2Fmips.20for.20musl.html#225800906">(Feb 10 2021 at 07:09)</a>:</h4>
<p>Oh wait I misread</p>
<div class="codehilite"><pre><span></span><code>--build BUILD   build target of the stage0 compiler
        --host HOST     host targets to build
</code></pre></div>
<p>So I would expect --build to be what's going wrong</p>



<a name="225800928"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/bootstrapping%20on%20s390x/mips%20for%20musl/near/225800928" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ariadne Conill <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/bootstrapping.20on.20s390x.2Fmips.20for.20musl.html#225800928">(Feb 10 2021 at 07:09)</a>:</h4>
<p>--build is x86_64-alpine-linux-musl</p>



<a name="225800970"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/bootstrapping%20on%20s390x/mips%20for%20musl/near/225800970" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joshua Nelson <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/bootstrapping.20on.20s390x.2Fmips.20for.20musl.html#225800970">(Feb 10 2021 at 07:10)</a>:</h4>
<p>Hmm, I'm not sure then</p>



<a name="225800996"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/bootstrapping%20on%20s390x/mips%20for%20musl/near/225800996" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ariadne Conill <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/bootstrapping.20on.20s390x.2Fmips.20for.20musl.html#225800996">(Feb 10 2021 at 07:11)</a>:</h4>
<p>i will try to collect a verbose build log with dist instead of build.  maybe this is dist vs build after all.  but i need to go to bed soon :)</p>



<a name="225807250"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/bootstrapping%20on%20s390x/mips%20for%20musl/near/225807250" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ariadne Conill <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/bootstrapping.20on.20s390x.2Fmips.20for.20musl.html#225807250">(Feb 10 2021 at 08:44)</a>:</h4>
<p>switching to <code>dist</code> only changed the way it bombed.  <a href="https://distfiles.dereferenced.org/rust-build.txt">https://distfiles.dereferenced.org/rust-build.txt</a></p>



<a name="225807478"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/bootstrapping%20on%20s390x/mips%20for%20musl/near/225807478" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> bjorn3 <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/bootstrapping.20on.20s390x.2Fmips.20for.20musl.html#225807478">(Feb 10 2021 at 08:46)</a>:</h4>
<div class="codehilite"><pre><span></span><code>/usr/lib/gcc/x86_64-alpine-linux-musl/10.2.1/../../../../x86_64-alpine-linux-musl/bin/ld: skipping incompatible /home/kaniini/sysroot-aarch64/lib/libz.so when searching for -lz
</code></pre></div>
<p>Did you set the linker for the aarch64 target?</p>



<a name="225807527"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/bootstrapping%20on%20s390x/mips%20for%20musl/near/225807527" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ariadne Conill <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/bootstrapping.20on.20s390x.2Fmips.20for.20musl.html#225807527">(Feb 10 2021 at 08:47)</a>:</h4>
<p>no, it's dumber than that.  i need zlib-dev on host too.</p>



<a name="225807537"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/bootstrapping%20on%20s390x/mips%20for%20musl/near/225807537" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ariadne Conill <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/bootstrapping.20on.20s390x.2Fmips.20for.20musl.html#225807537">(Feb 10 2021 at 08:47)</a>:</h4>
<p>trying again</p>



<a name="226003832"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/bootstrapping%20on%20s390x/mips%20for%20musl/near/226003832" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ariadne Conill <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/bootstrapping.20on.20s390x.2Fmips.20for.20musl.html#226003832">(Feb 11 2021 at 15:06)</a>:</h4>
<p>ok, looks like x.py dist gets the job done here.  now going to attempt an s390x bootstrap</p>



<a name="226004432"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/bootstrapping%20on%20s390x/mips%20for%20musl/near/226004432" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Alex Gaynor <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/bootstrapping.20on.20s390x.2Fmips.20for.20musl.html#226004432">(Feb 11 2021 at 15:10)</a>:</h4>
<p>Meaning aarch64 bootstraps now?</p>



<a name="226004707"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/bootstrapping%20on%20s390x/mips%20for%20musl/near/226004707" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ariadne Conill <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/bootstrapping.20on.20s390x.2Fmips.20for.20musl.html#226004707">(Feb 11 2021 at 15:12)</a>:</h4>
<p>yes, i was able to generate an aarch64 rust package from an x86_64 host (and vice versa)</p>



<a name="226006413"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/bootstrapping%20on%20s390x/mips%20for%20musl/near/226006413" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ariadne Conill <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/bootstrapping.20on.20s390x.2Fmips.20for.20musl.html#226006413">(Feb 11 2021 at 15:23)</a>:</h4>
<p>now... we should talk about our triplets.  i can upstream them, but i think it makes more sense to introduce generic targets for any musl-based distro, as distros are going to want the behaviour we define in our targets (e.g. musl treated same as glibc re: linking)</p>



<a name="226006707"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/bootstrapping%20on%20s390x/mips%20for%20musl/near/226006707" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joshua Nelson <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/bootstrapping.20on.20s390x.2Fmips.20for.20musl.html#226006707">(Feb 11 2021 at 15:25)</a>:</h4>
<p>it sounds like you're asking a change to the target file format? That would probably need an MCP</p>



<a name="226006725"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/bootstrapping%20on%20s390x/mips%20for%20musl/near/226006725" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joshua Nelson <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/bootstrapping.20on.20s390x.2Fmips.20for.20musl.html#226006725">(Feb 11 2021 at 15:25)</a>:</h4>
<p><a href="https://forge.rust-lang.org/compiler/mcp.html">https://forge.rust-lang.org/compiler/mcp.html</a></p>



<a name="226007075"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/bootstrapping%20on%20s390x/mips%20for%20musl/near/226007075" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ariadne Conill <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/bootstrapping.20on.20s390x.2Fmips.20for.20musl.html#226007075">(Feb 11 2021 at 15:27)</a>:</h4>
<p>no, the target format doesnt need to change</p>



<a name="226007167"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/bootstrapping%20on%20s390x/mips%20for%20musl/near/226007167" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joshua Nelson <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/bootstrapping.20on.20s390x.2Fmips.20for.20musl.html#226007167">(Feb 11 2021 at 15:28)</a>:</h4>
<p>I'm unsure what you're asking for then</p>



<a name="226007172"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/bootstrapping%20on%20s390x/mips%20for%20musl/near/226007172" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ariadne Conill <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/bootstrapping.20on.20s390x.2Fmips.20for.20musl.html#226007172">(Feb 11 2021 at 15:28)</a>:</h4>
<p>rust assumes on musl that you want staticly linked binaries, distros want the C dependencies to be dynamic</p>



<a name="226007382"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/bootstrapping%20on%20s390x/mips%20for%20musl/near/226007382" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joshua Nelson <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/bootstrapping.20on.20s390x.2Fmips.20for.20musl.html#226007382">(Feb 11 2021 at 15:29)</a>:</h4>
<p>oh I see, this is some default that gets set during codegen</p>



<a name="226007395"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/bootstrapping%20on%20s390x/mips%20for%20musl/near/226007395" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joshua Nelson <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/bootstrapping.20on.20s390x.2Fmips.20for.20musl.html#226007395">(Feb 11 2021 at 15:29)</a>:</h4>
<p>you could probably make a PR fixing that</p>



<a name="226007459"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/bootstrapping%20on%20s390x/mips%20for%20musl/near/226007459" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ariadne Conill <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/bootstrapping.20on.20s390x.2Fmips.20for.20musl.html#226007459">(Feb 11 2021 at 15:29)</a>:</h4>
<p>well, it is a political situation.  the people who originally enabled rust on musl want static linking by default, despite this being inappropriate for distros</p>



<a name="226007642"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/bootstrapping%20on%20s390x/mips%20for%20musl/near/226007642" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joshua Nelson <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/bootstrapping.20on.20s390x.2Fmips.20for.20musl.html#226007642">(Feb 11 2021 at 15:30)</a>:</h4>
<p>ok, then an MCP is probably the right approach after all <span aria-label="laughing" class="emoji emoji-1f606" role="img" title="laughing">:laughing:</span></p>



<a name="226008702"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/bootstrapping%20on%20s390x/mips%20for%20musl/near/226008702" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ariadne Conill <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/bootstrapping.20on.20s390x.2Fmips.20for.20musl.html#226008702">(Feb 11 2021 at 15:36)</a>:</h4>
<p>what is an MCP?</p>



<a name="226008713"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/bootstrapping%20on%20s390x/mips%20for%20musl/near/226008713" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nagisa <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/bootstrapping.20on.20s390x.2Fmips.20for.20musl.html#226008713">(Feb 11 2021 at 15:36)</a>:</h4>
<p>I'm pretty sure the solution to this is pretty much just "more" targets.</p>



<a name="226008767"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/bootstrapping%20on%20s390x/mips%20for%20musl/near/226008767" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joshua Nelson <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/bootstrapping.20on.20s390x.2Fmips.20for.20musl.html#226008767">(Feb 11 2021 at 15:36)</a>:</h4>
<p><span class="user-mention silent" data-user-id="360752">Ariadne Conill</span> <a href="#narrow/stream/131828-t-compiler/topic/bootstraping.20on.20s390x.2Fmips.20for.20musl/near/226008702">said</a>:</p>
<blockquote>
<p>what is an MCP?</p>
</blockquote>
<p><a href="https://forge.rust-lang.org/compiler/mcp.html">https://forge.rust-lang.org/compiler/mcp.html</a></p>



<a name="226008821"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/bootstrapping%20on%20s390x/mips%20for%20musl/near/226008821" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ariadne Conill <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/bootstrapping.20on.20s390x.2Fmips.20for.20musl.html#226008821">(Feb 11 2021 at 15:37)</a>:</h4>
<p>yes, but it seems pointless to have targets for every single musl distro when musl distros all largely want the same thing</p>



<a name="226009086"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/bootstrapping%20on%20s390x/mips%20for%20musl/near/226009086" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ariadne Conill <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/bootstrapping.20on.20s390x.2Fmips.20for.20musl.html#226009086">(Feb 11 2021 at 15:38)</a>:</h4>
<p>hince why i bring this up :)</p>
<p>more targets are fine, but it is wasted work to have custom targets for every distro.  so would be nice to solve that somehow :)</p>



<a name="226009282"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/bootstrapping%20on%20s390x/mips%20for%20musl/near/226009282" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nagisa <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/bootstrapping.20on.20s390x.2Fmips.20for.20musl.html#226009282">(Feb 11 2021 at 15:39)</a>:</h4>
<p>Yeah you probably wouldn't add a target for each distro, just a set of musl targets where <code>static-crt</code> is unset.</p>



<a name="226009435"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/bootstrapping%20on%20s390x/mips%20for%20musl/near/226009435" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ariadne Conill <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/bootstrapping.20on.20s390x.2Fmips.20for.20musl.html#226009435">(Feb 11 2021 at 15:40)</a>:</h4>
<p>one thought would be to add a set of <code>dynmusl</code> targets based on the alpine ones :)</p>



<a name="226020030"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/bootstrapping%20on%20s390x/mips%20for%20musl/near/226020030" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ariadne Conill <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/bootstrapping.20on.20s390x.2Fmips.20for.20musl.html#226020030">(Feb 11 2021 at 16:42)</a>:</h4>
<p>i have AMD EPYC 7742P and rust just sits there wasting cpu on ipc overhead if you try to use -j256.  sweet spot seems to be -j32 or perhaps -j64.</p>



<a name="226020620"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/bootstrapping%20on%20s390x/mips%20for%20musl/near/226020620" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Alex Gaynor <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/bootstrapping.20on.20s390x.2Fmips.20for.20musl.html#226020620">(Feb 11 2021 at 16:46)</a>:</h4>
<p>All those poor wasted cores. I guess you can use the remaining ones for youtube.</p>



<a name="226021114"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/bootstrapping%20on%20s390x/mips%20for%20musl/near/226021114" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ariadne Conill <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/bootstrapping.20on.20s390x.2Fmips.20for.20musl.html#226021114">(Feb 11 2021 at 16:49)</a>:</h4>
<p>it might be worth investigating why there is so much ipc overhead at some point :)</p>



<a name="226021135"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/bootstrapping%20on%20s390x/mips%20for%20musl/near/226021135" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joshua Nelson <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/bootstrapping.20on.20s390x.2Fmips.20for.20musl.html#226021135">(Feb 11 2021 at 16:49)</a>:</h4>
<p>when you say IPC overhead, what processes do you mean?</p>



<a name="226021147"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/bootstrapping%20on%20s390x/mips%20for%20musl/near/226021147" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joshua Nelson <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/bootstrapping.20on.20s390x.2Fmips.20for.20musl.html#226021147">(Feb 11 2021 at 16:49)</a>:</h4>
<p>is this between cargo and rustc?</p>



<a name="226021259"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/bootstrapping%20on%20s390x/mips%20for%20musl/near/226021259" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joshua Nelson <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/bootstrapping.20on.20s390x.2Fmips.20for.20musl.html#226021259">(Feb 11 2021 at 16:50)</a>:</h4>
<p>you could open a thread in <a class="stream" data-stream-id="246057" href="/#narrow/stream/246057-t-cargo">#t-cargo</a> maybe</p>



<a name="226022429"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/bootstrapping%20on%20s390x/mips%20for%20musl/near/226022429" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ariadne Conill <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/bootstrapping.20on.20s390x.2Fmips.20for.20musl.html#226022429">(Feb 11 2021 at 16:58)</a>:</h4>
<p>inside rustc itself.  if you look at cpu utilization using htop, it's all in-kernel, so i presume it is ipc overhead between processes</p>



<a name="226022496"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/bootstrapping%20on%20s390x/mips%20for%20musl/near/226022496" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ariadne Conill <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/bootstrapping.20on.20s390x.2Fmips.20for.20musl.html#226022496">(Feb 11 2021 at 16:58)</a>:</h4>
<p>i'll dig into it with perf at some point :)</p>



<a name="226022661"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/bootstrapping%20on%20s390x/mips%20for%20musl/near/226022661" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joshua Nelson <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/bootstrapping.20on.20s390x.2Fmips.20for.20musl.html#226022661">(Feb 11 2021 at 16:59)</a>:</h4>
<p>oh interesting</p>



<a name="226022717"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/bootstrapping%20on%20s390x/mips%20for%20musl/near/226022717" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joshua Nelson <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/bootstrapping.20on.20s390x.2Fmips.20for.20musl.html#226022717">(Feb 11 2021 at 16:59)</a>:</h4>
<p>that might be LLVM since it's dynamically linked? Rust doesn't do much IPC other than the linker</p>



<a name="226024082"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/bootstrapping%20on%20s390x/mips%20for%20musl/near/226024082" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wesley Wiser <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/bootstrapping.20on.20s390x.2Fmips.20for.20musl.html#226024082">(Feb 11 2021 at 17:08)</a>:</h4>
<p>Might also be rustc trying to acquire/release <a href="https://docs.rs/jobserver/0.1.21/jobserver/">jobserver</a> tokens but I haven't seen this issue so that's just a guess.</p>



<a name="226025473"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/bootstrapping%20on%20s390x/mips%20for%20musl/near/226025473" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nagisa <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/bootstrapping.20on.20s390x.2Fmips.20for.20musl.html#226025473">(Feb 11 2021 at 17:16)</a>:</h4>
<p>it could be pagefaulting a lot on some shared memory, though conceptually llvm codegen units should all be pretty independent.</p>



<a name="226026095"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/bootstrapping%20on%20s390x/mips%20for%20musl/near/226026095" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ariadne Conill <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/bootstrapping.20on.20s390x.2Fmips.20for.20musl.html#226026095">(Feb 11 2021 at 17:21)</a>:</h4>
<p>s390x bootstrap failed with the <code>__rdl_alloc</code> stuff as it did last october</p>



<a name="226026170"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/bootstrapping%20on%20s390x/mips%20for%20musl/near/226026170" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joshua Nelson <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/bootstrapping.20on.20s390x.2Fmips.20for.20musl.html#226026170">(Feb 11 2021 at 17:21)</a>:</h4>
<p>(<a href="https://zulip-archive.rust-lang.org/182449tcompilerhelp/94495crosscompilationandmissingrdlallocandfriends.html">https://zulip-archive.rust-lang.org/182449tcompilerhelp/94495crosscompilationandmissingrdlallocandfriends.html</a>)</p>



<a name="226026395"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/bootstrapping%20on%20s390x/mips%20for%20musl/near/226026395" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ariadne Conill <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/bootstrapping.20on.20s390x.2Fmips.20for.20musl.html#226026395">(Feb 11 2021 at 17:22)</a>:</h4>
<p>we are updating to rust 1.48 atm.  i will try again with 1.48</p>



<a name="226027071"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/bootstrapping%20on%20s390x/mips%20for%20musl/near/226027071" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joshua Nelson <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/bootstrapping.20on.20s390x.2Fmips.20for.20musl.html#226027071">(Feb 11 2021 at 17:27)</a>:</h4>
<blockquote>
<p>yes, what i am wondering is if the buildsystem is slipping in test as a cfg variable</p>
</blockquote>
<p>fyi you can test this by adding <code>#[cfg(not(test))] compile_error!();</code> or something</p>



<a name="226027148"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/bootstrapping%20on%20s390x/mips%20for%20musl/near/226027148" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joshua Nelson <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/bootstrapping.20on.20s390x.2Fmips.20for.20musl.html#226027148">(Feb 11 2021 at 17:27)</a>:</h4>
<p>if something goes wrong here I would expect it to have something to do with <code>rustc_std_internal_symbol</code> being magic</p>



<a name="226027262"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/bootstrapping%20on%20s390x/mips%20for%20musl/near/226027262" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joshua Nelson <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/bootstrapping.20on.20s390x.2Fmips.20for.20musl.html#226027262">(Feb 11 2021 at 17:28)</a>:</h4>
<p>yeah, all those __rdl functions have it</p>



<a name="226027331"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/bootstrapping%20on%20s390x/mips%20for%20musl/near/226027331" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Alex Gaynor <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/bootstrapping.20on.20s390x.2Fmips.20for.20musl.html#226027331">(Feb 11 2021 at 17:29)</a>:</h4>
<p>A quick grep suggests that the only other place that uses <code>rustc_std_internal_symbol</code> is unwinding.</p>



<a name="226027383"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/bootstrapping%20on%20s390x/mips%20for%20musl/near/226027383" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Alex Gaynor <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/bootstrapping.20on.20s390x.2Fmips.20for.20musl.html#226027383">(Feb 11 2021 at 17:29)</a>:</h4>
<p>Well, panicking in general.</p>



<a name="226027393"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/bootstrapping%20on%20s390x/mips%20for%20musl/near/226027393" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joshua Nelson <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/bootstrapping.20on.20s390x.2Fmips.20for.20musl.html#226027393">(Feb 11 2021 at 17:29)</a>:</h4>
<blockquote>
<p>this symbol is a "weird symbol"</p>
</blockquote>
<p>great .... <a href="https://doc.rust-lang.org/nightly/nightly-rustc/rustc_middle/middle/codegen_fn_attrs/struct.CodegenFnAttrFlags.html#associatedconstant.RUSTC_STD_INTERNAL_SYMBOL">https://doc.rust-lang.org/nightly/nightly-rustc/rustc_middle/middle/codegen_fn_attrs/struct.CodegenFnAttrFlags.html#associatedconstant.RUSTC_STD_INTERNAL_SYMBOL</a></p>



<a name="226027667"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/bootstrapping%20on%20s390x/mips%20for%20musl/near/226027667" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joshua Nelson <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/bootstrapping.20on.20s390x.2Fmips.20for.20musl.html#226027667">(Feb 11 2021 at 17:31)</a>:</h4>
<p>apparently that's a "global allocator span" and also implies <code>#[used]</code>, <code>#[no_mangle]</code>, and <code>#[weak]</code>:</p>
<ul>
<li><a href="https://github.com/rust-lang/rust/blob/26e5bcd22025a0d949b76766af76e92ed4434199/compiler/rustc_metadata/src/creader.rs#L992">https://github.com/rust-lang/rust/blob/26e5bcd22025a0d949b76766af76e92ed4434199/compiler/rustc_metadata/src/creader.rs#L992</a></li>
<li><a href="https://github.com/rust-lang/rust/blob/26e5bcd22025a0d949b76766af76e92ed4434199/compiler/rustc_feature/src/builtin_attrs.rs#L438">https://github.com/rust-lang/rust/blob/26e5bcd22025a0d949b76766af76e92ed4434199/compiler/rustc_feature/src/builtin_attrs.rs#L438</a></li>
<li><a href="https://github.com/rust-lang/rust/blob/26e5bcd22025a0d949b76766af76e92ed4434199/compiler/rustc_typeck/src/collect.rs#L2925">https://github.com/rust-lang/rust/blob/26e5bcd22025a0d949b76766af76e92ed4434199/compiler/rustc_typeck/src/collect.rs#L2925</a></li>
<li><a href="https://github.com/rust-lang/rust/blob/26e5bcd22025a0d949b76766af76e92ed4434199/compiler/rustc_typeck/src/collect.rs#L2906">https://github.com/rust-lang/rust/blob/26e5bcd22025a0d949b76766af76e92ed4434199/compiler/rustc_typeck/src/collect.rs#L2906</a></li>
</ul>



<a name="226028224"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/bootstrapping%20on%20s390x/mips%20for%20musl/near/226028224" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joshua Nelson <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/bootstrapping.20on.20s390x.2Fmips.20for.20musl.html#226028224">(Feb 11 2021 at 17:35)</a>:</h4>
<p>and it is only exported for <code>dylibs</code> and <code>rlibs</code>: <a href="https://doc.rust-lang.org/nightly/nightly-rustc/rustc_middle/middle/exported_symbols/enum.SymbolExportLevel.html">https://doc.rust-lang.org/nightly/nightly-rustc/rustc_middle/middle/exported_symbols/enum.SymbolExportLevel.html</a><br>
<a href="https://github.com/rust-lang/rust/blob/26e5bcd22025a0d949b76766af76e92ed4434199/compiler/rustc_codegen_ssa/src/back/symbol_export.rs#L382-L386">https://github.com/rust-lang/rust/blob/26e5bcd22025a0d949b76766af76e92ed4434199/compiler/rustc_codegen_ssa/src/back/symbol_export.rs#L382-L386</a></p>



<a name="226028750"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/bootstrapping%20on%20s390x/mips%20for%20musl/near/226028750" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joshua Nelson <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/bootstrapping.20on.20s390x.2Fmips.20for.20musl.html#226028750">(Feb 11 2021 at 17:39)</a>:</h4>
<p>and then there's a page-long comment about why it gets marked as "hidden": <a href="https://github.com/rust-lang/rust/blob/26e5bcd22025a0d949b76766af76e92ed4434199/compiler/rustc_mir/src/monomorphize/partitioning/default.rs#L491-L528">https://github.com/rust-lang/rust/blob/26e5bcd22025a0d949b76766af76e92ed4434199/compiler/rustc_mir/src/monomorphize/partitioning/default.rs#L491-L528</a></p>



<a name="226029226"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/bootstrapping%20on%20s390x/mips%20for%20musl/near/226029226" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joshua Nelson <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/bootstrapping.20on.20s390x.2Fmips.20for.20musl.html#226029226">(Feb 11 2021 at 17:42)</a>:</h4>
<p>not sure how much this is actually helping lol</p>



<a name="226031994"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/bootstrapping%20on%20s390x/mips%20for%20musl/near/226031994" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ariadne Conill <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/bootstrapping.20on.20s390x.2Fmips.20for.20musl.html#226031994">(Feb 11 2021 at 17:59)</a>:</h4>
<p>this is the part where i need a rustc developer.  i think my target is missing something.</p>



<a name="226132859"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/bootstrapping%20on%20s390x/mips%20for%20musl/near/226132859" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Laurențiu <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/bootstrapping.20on.20s390x.2Fmips.20for.20musl.html#226132859">(Feb 12 2021 at 12:55)</a>:</h4>
<p>A bit off-topic, but does <code>-Ctarget-feature=-crt-static</code> work for anyone on <code>x86_64-unknown-linux-musl</code>? I get linker errors for some pthread functions, even on an empty program.</p>



<a name="226133060"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/bootstrapping%20on%20s390x/mips%20for%20musl/near/226133060" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nagisa <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/bootstrapping.20on.20s390x.2Fmips.20for.20musl.html#226133060">(Feb 12 2021 at 12:57)</a>:</h4>
<p>Do you have a dynamic musl libc to link against?</p>



<a name="226133089"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/bootstrapping%20on%20s390x/mips%20for%20musl/near/226133089" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nagisa <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/bootstrapping.20on.20s390x.2Fmips.20for.20musl.html#226133089">(Feb 12 2021 at 12:57)</a>:</h4>
<p>(empty programs will still need some pthread libraries to set-up the main thread before <code>fn main() {}</code> is invoked)</p>



<a name="226136636"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/bootstrapping%20on%20s390x/mips%20for%20musl/near/226136636" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Laurențiu <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/bootstrapping.20on.20s390x.2Fmips.20for.20musl.html#226136636">(Feb 12 2021 at 13:31)</a>:</h4>
<p>Good question... I have a <code>/usr/lib/musl/lib/libc.so</code></p>



<a name="226136755"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/bootstrapping%20on%20s390x/mips%20for%20musl/near/226136755" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Laurențiu <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/bootstrapping.20on.20s390x.2Fmips.20for.20musl.html#226136755">(Feb 12 2021 at 13:32)</a>:</h4>
<p>Progress: <code>-Clinker=musl-gcc</code> fails with <code>cannot find -lgcc_s</code></p>



<a name="226158945"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/bootstrapping%20on%20s390x/mips%20for%20musl/near/226158945" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joshua Nelson <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/bootstrapping.20on.20s390x.2Fmips.20for.20musl.html#226158945">(Feb 12 2021 at 16:22)</a>:</h4>
<p><span class="user-mention silent" data-user-id="360752">Ariadne Conill</span> <a href="#narrow/stream/131828-t-compiler/topic/bootstrapping.20on.20s390x.2Fmips.20for.20musl/near/226026095">said</a>:</p>
<blockquote>
<p>s390x bootstrap failed with the <code>__rdl_alloc</code> stuff as it did last october</p>
</blockquote>
<p><span class="user-mention" data-user-id="360752">@Ariadne Conill</span> you said void had this working with a custom target? What do they do differently?</p>



<a name="226167005"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/bootstrapping%20on%20s390x/mips%20for%20musl/near/226167005" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ariadne Conill <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/bootstrapping.20on.20s390x.2Fmips.20for.20musl.html#226167005">(Feb 12 2021 at 17:17)</a>:</h4>
<p>not s390x but crossing in general</p>



<a name="226167114"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/bootstrapping%20on%20s390x/mips%20for%20musl/near/226167114" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joshua Nelson <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/bootstrapping.20on.20s390x.2Fmips.20for.20musl.html#226167114">(Feb 12 2021 at 17:18)</a>:</h4>
<p>oh I see</p>



<a name="226167205"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/bootstrapping%20on%20s390x/mips%20for%20musl/near/226167205" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Alex Gaynor <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/bootstrapping.20on.20s390x.2Fmips.20for.20musl.html#226167205">(Feb 12 2021 at 17:18)</a>:</h4>
<p>They modify the upstream targets to dynamically link crt, while alpine creates new targets that are theoretically identical, right?</p>



<a name="226184990"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/bootstrapping%20on%20s390x/mips%20for%20musl/near/226184990" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> pnkfelix <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/bootstrapping.20on.20s390x.2Fmips.20for.20musl.html#226184990">(Feb 12 2021 at 19:35)</a>:</h4>
<p><span class="user-mention silent" data-user-id="360752">Ariadne Conill</span> <a href="#narrow/stream/131828-t-compiler/topic/bootstrapping.20on.20s390x.2Fmips.20for.20musl/near/226020030">said</a>:</p>
<blockquote>
<p>i have AMD EPYC 7742P and rust just sits there wasting cpu on ipc overhead if you try to use -j256.  sweet spot seems to be -j32 or perhaps -j64.</p>
</blockquote>
<p>Am I right that I should be able to use <code>htop</code> and immediately witness a top of in-kernel overhead? I guess I will just trying it and see. Is this during a <code>x.py build</code> bootstrap in particular? Could you share the <code>config.toml</code> and <code>x.py</code> invocation you are using?</p>



<a name="226189436"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/bootstrapping%20on%20s390x/mips%20for%20musl/near/226189436" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> pnkfelix <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/bootstrapping.20on.20s390x.2Fmips.20for.20musl.html#226189436">(Feb 12 2021 at 20:09)</a>:</h4>
<p>(Also, <span class="user-mention" data-user-id="360752">@Ariadne Conill</span> , how much RAM do you have on your box? I’m wondering at the outset whether virt. mem. swapping could be part of of the story here.)</p>



<a name="226254223"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/bootstrapping%20on%20s390x/mips%20for%20musl/near/226254223" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ariadne Conill <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/bootstrapping.20on.20s390x.2Fmips.20for.20musl.html#226254223">(Feb 13 2021 at 16:42)</a>:</h4>
<p>512gb on that host.  no swap :)</p>



<a name="226257019"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/bootstrapping%20on%20s390x/mips%20for%20musl/near/226257019" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nagisa <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/bootstrapping.20on.20s390x.2Fmips.20for.20musl.html#226257019">(Feb 13 2021 at 17:35)</a>:</h4>
<p>I suspect that its going to be migration/numa losses, primarily.</p>



<a name="226345214"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/bootstrapping%20on%20s390x/mips%20for%20musl/near/226345214" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ariadne Conill <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/bootstrapping.20on.20s390x.2Fmips.20for.20musl.html#226345214">(Feb 15 2021 at 04:51)</a>:</h4>
<p>seems reasonable.  will have time to work on this bootstrap issue again tomorrow if people wanna tackle it</p>



<a name="226351383"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/bootstrapping%20on%20s390x/mips%20for%20musl/near/226351383" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joshua Nelson <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/bootstrapping.20on.20s390x.2Fmips.20for.20musl.html#226351383">(Feb 15 2021 at 07:13)</a>:</h4>
<p><span class="user-mention silent" data-user-id="232545">Joshua Nelson</span> <a href="#narrow/stream/131828-t-compiler/topic/bootstrapping.20on.20s390x.2Fmips.20for.20musl/near/226027148">said</a>:</p>
<blockquote>
<p>if something goes wrong here I would expect it to have something to do with <code>rustc_std_internal_symbol</code> being magic</p>
</blockquote>
<p>ok I did some git archeology and found that it was introduced in <a href="https://github.com/rust-lang/rust/commit/fbf98697021173a30b84d9145df0966a23a2f9d2">fbf98697021173a30b84d9145df0966a23a2f9d2</a>. So maybe <span class="user-mention" data-user-id="116015">@Alex Crichton</span> will have some idea what's going wrong?</p>
<p>For context, <span class="user-mention silent" data-user-id="360752">Ariadne Conill</span> is trying to bootstrap on s390x and is getting errors about <code>__rdl_alloc</code> not being defined.</p>



<a name="226395277"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/bootstrapping%20on%20s390x/mips%20for%20musl/near/226395277" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Alex Gaynor <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/bootstrapping.20on.20s390x.2Fmips.20for.20musl.html#226395277">(Feb 15 2021 at 15:13)</a>:</h4>
<p>I wonder if this has something to do with different linker behaviors between the platforms. What linker is being used on s390x?</p>



<a name="226400258"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/bootstrapping%20on%20s390x/mips%20for%20musl/near/226400258" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Alex Crichton <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/bootstrapping.20on.20s390x.2Fmips.20for.20musl.html#226400258">(Feb 15 2021 at 15:56)</a>:</h4>
<p>Sure I can try to help out, the most useful thing would be to gist the exact error message and preserve a build dir</p>



<a name="226400323"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/bootstrapping%20on%20s390x/mips%20for%20musl/near/226400323" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Alex Crichton <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/bootstrapping.20on.20s390x.2Fmips.20for.20musl.html#226400323">(Feb 15 2021 at 15:57)</a>:</h4>
<p>Given the error message there's probably a few files to poke around in where I'd expect the symbol to exist to try to narrow down where the bug is</p>



<a name="226400434"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/bootstrapping%20on%20s390x/mips%20for%20musl/near/226400434" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joshua Nelson <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/bootstrapping.20on.20s390x.2Fmips.20for.20musl.html#226400434">(Feb 15 2021 at 15:58)</a>:</h4>
<p>here's a build log (from <a href="#narrow/stream/182449-t-compiler.2Fhelp/topic/cross.20compilation.20and.20missing.20__rdl_alloc.20and.20friends/near/215213649">https://rust-lang.zulipchat.com/#narrow/stream/182449-t-compiler.2Fhelp/topic/cross.20compilation.20and.20missing.20__rdl_alloc.20and.20friends/near/215213649</a>): <a href="https://tpaste.us/ejvV">https://tpaste.us/ejvV</a></p>



<a name="226400466"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/bootstrapping%20on%20s390x/mips%20for%20musl/near/226400466" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joshua Nelson <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/bootstrapping.20on.20s390x.2Fmips.20for.20musl.html#226400466">(Feb 15 2021 at 15:58)</a>:</h4>
<p>cc <span class="user-mention" data-user-id="360752">@Ariadne Conill</span> :)</p>



<a name="226401180"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/bootstrapping%20on%20s390x/mips%20for%20musl/near/226401180" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Alex Crichton <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/bootstrapping.20on.20s390x.2Fmips.20for.20musl.html#226401180">(Feb 15 2021 at 16:01)</a>:</h4>
<p>I'm on a phone right now so limited capabilities, but that thread mentioned y'all digging around in rlibs but if things haven't changed since I last looked I think that the rdl symbols should appear in libstds object files, not the rlib</p>



<a name="226401355"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/bootstrapping%20on%20s390x/mips%20for%20musl/near/226401355" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Alex Crichton <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/bootstrapping.20on.20s390x.2Fmips.20for.20musl.html#226401355">(Feb 15 2021 at 16:02)</a>:</h4>
<p>I know that musl also has a default mode in the compiler whether it's static or dynamic but I don't think that would affect this, it's another vector something could possibly go wrong though</p>



<a name="226401645"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/bootstrapping%20on%20s390x/mips%20for%20musl/near/226401645" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joshua Nelson <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/bootstrapping.20on.20s390x.2Fmips.20for.20musl.html#226401645">(Feb 15 2021 at 16:03)</a>:</h4>
<p><span class="user-mention silent" data-user-id="116015">Alex Crichton</span> <a href="#narrow/stream/131828-t-compiler/topic/bootstrapping.20on.20s390x.2Fmips.20for.20musl/near/226401355">said</a>:</p>
<blockquote>
<p>I know that musl also has a default mode in the compiler whether it's static or dynamic but I don't think that would affect this, it's another vector something could possibly go wrong though</p>
</blockquote>
<p>I think <span class="user-mention silent" data-user-id="360752">Ariadne Conill</span> patched that to use dynamic by default IIRC</p>



<a name="226401829"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/bootstrapping%20on%20s390x/mips%20for%20musl/near/226401829" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Alex Gaynor <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/bootstrapping.20on.20s390x.2Fmips.20for.20musl.html#226401829">(Feb 15 2021 at 16:04)</a>:</h4>
<p>FWIW, alpine didn't patch the existing targets, it added new targets that are the same except for that opt</p>



<a name="226421868"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/bootstrapping%20on%20s390x/mips%20for%20musl/near/226421868" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ariadne Conill <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/bootstrapping.20on.20s390x.2Fmips.20for.20musl.html#226421868">(Feb 15 2021 at 19:23)</a>:</h4>
<p>we use the cross gcc for linking on the target</p>



<a name="226421939"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/bootstrapping%20on%20s390x/mips%20for%20musl/near/226421939" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ariadne Conill <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/bootstrapping.20on.20s390x.2Fmips.20for.20musl.html#226421939">(Feb 15 2021 at 19:24)</a>:</h4>
<p>s390x doesn’t have a musl target so i made one.  i don’t think mine is correct and so we wind up with no allocator implementation</p>



<a name="226424048"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/bootstrapping%20on%20s390x/mips%20for%20musl/near/226424048" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ariadne Conill <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/bootstrapping.20on.20s390x.2Fmips.20for.20musl.html#226424048">(Feb 15 2021 at 19:48)</a>:</h4>
<p>anyway rust has been updated so going to reattempt the bootstrap in a few</p>



<a name="226429344"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/bootstrapping%20on%20s390x/mips%20for%20musl/near/226429344" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ariadne Conill <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/bootstrapping.20on.20s390x.2Fmips.20for.20musl.html#226429344">(Feb 15 2021 at 20:59)</a>:</h4>
<p>the bootstrap procedure failed to build libc crate for s390x, i am rerunning it while capturing logs (oops)</p>



<a name="226429361"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/bootstrapping%20on%20s390x/mips%20for%20musl/near/226429361" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ariadne Conill <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/bootstrapping.20on.20s390x.2Fmips.20for.20musl.html#226429361">(Feb 15 2021 at 20:59)</a>:</h4>
<p>this is on 1.50</p>



<a name="226429385"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/bootstrapping%20on%20s390x/mips%20for%20musl/near/226429385" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Alex Gaynor <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/bootstrapping.20on.20s390x.2Fmips.20for.20musl.html#226429385">(Feb 15 2021 at 20:59)</a>:</h4>
<p>This is a new error yeah? Further along than befor?</p>



<a name="226429396"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/bootstrapping%20on%20s390x/mips%20for%20musl/near/226429396" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ariadne Conill <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/bootstrapping.20on.20s390x.2Fmips.20for.20musl.html#226429396">(Feb 15 2021 at 20:59)</a>:</h4>
<p>yes, new error</p>



<a name="226429410"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/bootstrapping%20on%20s390x/mips%20for%20musl/near/226429410" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ariadne Conill <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/bootstrapping.20on.20s390x.2Fmips.20for.20musl.html#226429410">(Feb 15 2021 at 21:00)</a>:</h4>
<p>i think we got past the std error</p>



<a name="226429556"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/bootstrapping%20on%20s390x/mips%20for%20musl/near/226429556" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ariadne Conill <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/bootstrapping.20on.20s390x.2Fmips.20for.20musl.html#226429556">(Feb 15 2021 at 21:01)</a>:</h4>
<p>(of course the real test will be making sure the cross compiler can compile itself on my frankenstein z13 mainframe that i built out of 5 broken ones bought from salvage auctions)</p>



<a name="226432198"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/bootstrapping%20on%20s390x/mips%20for%20musl/near/226432198" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ariadne Conill <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/bootstrapping.20on.20s390x.2Fmips.20for.20musl.html#226432198">(Feb 15 2021 at 21:34)</a>:</h4>
<p>and here's the log: <a href="https://distfiles.dereferenced.org/rust-cross-s390x-1.50-1.log.txt">https://distfiles.dereferenced.org/rust-cross-s390x-1.50-1.log.txt</a></p>



<a name="226432459"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/bootstrapping%20on%20s390x/mips%20for%20musl/near/226432459" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ariadne Conill <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/bootstrapping.20on.20s390x.2Fmips.20for.20musl.html#226432459">(Feb 15 2021 at 21:38)</a>:</h4>
<p>i'm not sure if this is progress or a step backwards tbh</p>



<a name="226432813"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/bootstrapping%20on%20s390x/mips%20for%20musl/near/226432813" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joshua Nelson <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/bootstrapping.20on.20s390x.2Fmips.20for.20musl.html#226432813">(Feb 15 2021 at 21:43)</a>:</h4>
<p>yeah that looks like it didn't get as far :( it errors when type checking, not linking. On the bright side, it looks like "just" a bug in libc, you might be able to add your own definitions or open a bug report</p>



<a name="226432888"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/bootstrapping%20on%20s390x/mips%20for%20musl/near/226432888" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nagisa <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/bootstrapping.20on.20s390x.2Fmips.20for.20musl.html#226432888">(Feb 15 2021 at 21:44)</a>:</h4>
<p>it could be just a bug in libc, but it could also be a bug in the compiler which makes it fail to accept valid code (which we had happening in the past due to e.g. sandiness differences)</p>



<a name="226433207"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/bootstrapping%20on%20s390x/mips%20for%20musl/near/226433207" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Esteban Küber <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/bootstrapping.20on.20s390x.2Fmips.20for.20musl.html#226433207">(Feb 15 2021 at 21:49)</a>:</h4>
<p>could it be an incorrect <code>cfg</code> flag that doesn't account for this platform?</p>



<a name="226433223"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/bootstrapping%20on%20s390x/mips%20for%20musl/near/226433223" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ariadne Conill <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/bootstrapping.20on.20s390x.2Fmips.20for.20musl.html#226433223">(Feb 15 2021 at 21:49)</a>:</h4>
<p>from what i see, the definitions are already there</p>



<a name="226433240"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/bootstrapping%20on%20s390x/mips%20for%20musl/near/226433240" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ariadne Conill <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/bootstrapping.20on.20s390x.2Fmips.20for.20musl.html#226433240">(Feb 15 2021 at 21:50)</a>:</h4>
<p>it could be that the s390x-generic-linux-musl target i added is wrong.  can somebody check it?</p>



<a name="226433293"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/bootstrapping%20on%20s390x/mips%20for%20musl/near/226433293" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nagisa <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/bootstrapping.20on.20s390x.2Fmips.20for.20musl.html#226433293">(Feb 15 2021 at 21:50)</a>:</h4>
<p>Yeah it could be a target not specifying correct values and so cfgs don't end up being set right</p>



<a name="226433306"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/bootstrapping%20on%20s390x/mips%20for%20musl/near/226433306" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nagisa <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/bootstrapping.20on.20s390x.2Fmips.20for.20musl.html#226433306">(Feb 15 2021 at 21:50)</a>:</h4>
<p><span class="user-mention" data-user-id="360752">@Ariadne Conill</span> are you in a position to run the rustc that was used in the failing compilation?</p>



<a name="226433331"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/bootstrapping%20on%20s390x/mips%20for%20musl/near/226433331" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ariadne Conill <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/bootstrapping.20on.20s390x.2Fmips.20for.20musl.html#226433331">(Feb 15 2021 at 21:51)</a>:</h4>
<p>uhhh... in theory yes</p>



<a name="226433341"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/bootstrapping%20on%20s390x/mips%20for%20musl/near/226433341" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nagisa <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/bootstrapping.20on.20s390x.2Fmips.20for.20musl.html#226433341">(Feb 15 2021 at 21:51)</a>:</h4>
<p>in particular <code>/home/kaniini/aports/community/rust/src/rustc-1.50.0-src/build/x86_64-alpine-linux-musl/stage1/bin/rustc --target=s390x-alpine-linux-musl --print cfg</code></p>



<a name="226433342"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/bootstrapping%20on%20s390x/mips%20for%20musl/near/226433342" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joshua Nelson <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/bootstrapping.20on.20s390x.2Fmips.20for.20musl.html#226433342">(Feb 15 2021 at 21:51)</a>:</h4>
<p><a href="https://rustc-dev-guide.rust-lang.org/building/how-to-build-and-run.html?highlight=rustup,link#creating-a-rustup-toolchain">https://rustc-dev-guide.rust-lang.org/building/how-to-build-and-run.html?highlight=rustup,link#creating-a-rustup-toolchain</a></p>



<a name="226433344"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/bootstrapping%20on%20s390x/mips%20for%20musl/near/226433344" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ariadne Conill <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/bootstrapping.20on.20s390x.2Fmips.20for.20musl.html#226433344">(Feb 15 2021 at 21:51)</a>:</h4>
<p>i will have to manually set up the buildroot again, but the artifacts are still there</p>



<a name="226433666"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/bootstrapping%20on%20s390x/mips%20for%20musl/near/226433666" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ariadne Conill <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/bootstrapping.20on.20s390x.2Fmips.20for.20musl.html#226433666">(Feb 15 2021 at 21:56)</a>:</h4>
<div class="codehilite"><pre><span></span><code>treefort:~/aports/community/rust/src/rustc-1.50.0-src/build/x86_64-alpine-linux-musl/stage1/bin$ ./rustc --target=s390x-alpine-linux-musl --print cfg
debug_assertions
target_arch=&quot;s390x&quot;
target_endian=&quot;big&quot;
target_env=&quot;musl&quot;
target_family=&quot;unix&quot;
target_os=&quot;linux&quot;
target_pointer_width=&quot;64&quot;
target_vendor=&quot;alpine&quot;
unix
</code></pre></div>



<a name="226433713"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/bootstrapping%20on%20s390x/mips%20for%20musl/near/226433713" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ariadne Conill <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/bootstrapping.20on.20s390x.2Fmips.20for.20musl.html#226433713">(Feb 15 2021 at 21:57)</a>:</h4>
<p>that looks reasonable to me</p>



<a name="226433768"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/bootstrapping%20on%20s390x/mips%20for%20musl/near/226433768" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nagisa <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/bootstrapping.20on.20s390x.2Fmips.20for.20musl.html#226433768">(Feb 15 2021 at 21:57)</a>:</h4>
<p>I think the reason is that libc doesn't actually have musl s390x code: <a href="https://github.com/rust-lang/libc/blob/master/src/unix/linux_like/linux/musl/b64/mod.rs#L154">https://github.com/rust-lang/libc/blob/master/src/unix/linux_like/linux/musl/b64/mod.rs#L154</a></p>



<a name="226433836"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/bootstrapping%20on%20s390x/mips%20for%20musl/near/226433836" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nagisa <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/bootstrapping.20on.20s390x.2Fmips.20for.20musl.html#226433836">(Feb 15 2021 at 21:58)</a>:</h4>
<p>(I accidentally ended up looking at the gnu folder before heh)</p>



<a name="226433887"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/bootstrapping%20on%20s390x/mips%20for%20musl/near/226433887" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nagisa <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/bootstrapping.20on.20s390x.2Fmips.20for.20musl.html#226433887">(Feb 15 2021 at 21:59)</a>:</h4>
<p>yeah the cfgs look reasonable enough to me.</p>



<a name="226434035"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/bootstrapping%20on%20s390x/mips%20for%20musl/near/226434035" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ariadne Conill <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/bootstrapping.20on.20s390x.2Fmips.20for.20musl.html#226434035">(Feb 15 2021 at 22:00)</a>:</h4>
<p>hmm, this would also likely explain why __rdl_alloc was missing before.</p>



<a name="226434076"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/bootstrapping%20on%20s390x/mips%20for%20musl/near/226434076" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ariadne Conill <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/bootstrapping.20on.20s390x.2Fmips.20for.20musl.html#226434076">(Feb 15 2021 at 22:00)</a>:</h4>
<p>if i were to guess, libc comes into play there somehow :)</p>



<a name="226434573"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/bootstrapping%20on%20s390x/mips%20for%20musl/near/226434573" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ariadne Conill <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/bootstrapping.20on.20s390x.2Fmips.20for.20musl.html#226434573">(Feb 15 2021 at 22:02)</a>:</h4>
<p>looks like i could adapt the glibc s390x libc code, basically removing the ucontext functions.  the rest of the ABI is identical to glibc on s390x</p>



<a name="226436219"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/bootstrapping%20on%20s390x/mips%20for%20musl/near/226436219" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ariadne Conill <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/bootstrapping.20on.20s390x.2Fmips.20for.20musl.html#226436219">(Feb 15 2021 at 22:12)</a>:</h4>
<p>since we have the theoretical ability to crosscompile with cargo to s390x on x86_64 in the alpine packages we ship now, i'll try to generate an s390x patch for libc crate</p>



<a name="226437105"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/bootstrapping%20on%20s390x/mips%20for%20musl/near/226437105" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> cuviper <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/bootstrapping.20on.20s390x.2Fmips.20for.20musl.html#226437105">(Feb 15 2021 at 22:21)</a>:</h4>
<p>I'd suggest sticking to 1.49, because 1.50 has some problem on s390x -- <a href="https://github.com/rust-lang/rust/issues/80810">#80810</a></p>



<a name="226437198"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/bootstrapping%20on%20s390x/mips%20for%20musl/near/226437198" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ariadne Conill <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/bootstrapping.20on.20s390x.2Fmips.20for.20musl.html#226437198">(Feb 15 2021 at 22:23)</a>:</h4>
<p>its too late, alpine already moved to 1.50</p>



<a name="226452068"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/bootstrapping%20on%20s390x/mips%20for%20musl/near/226452068" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> cuviper <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/bootstrapping.20on.20s390x.2Fmips.20for.20musl.html#226452068">(Feb 15 2021 at 22:38)</a>:</h4>
<p>well, if that bug manifests for you too, I'd welcome any help in tracking it down...</p>



<a name="226452700"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/bootstrapping%20on%20s390x/mips%20for%20musl/near/226452700" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ariadne Conill <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/bootstrapping.20on.20s390x.2Fmips.20for.20musl.html#226452700">(Feb 15 2021 at 22:46)</a>:</h4>
<p>looks like std and libc will need some help first</p>



<a name="226452746"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/bootstrapping%20on%20s390x/mips%20for%20musl/near/226452746" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ariadne Conill <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/bootstrapping.20on.20s390x.2Fmips.20for.20musl.html#226452746">(Feb 15 2021 at 22:47)</a>:</h4>
<p>if its still around by the time that's done, i can dig into it</p>



<a name="226453716"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/bootstrapping%20on%20s390x/mips%20for%20musl/near/226453716" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ariadne Conill <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/bootstrapping.20on.20s390x.2Fmips.20for.20musl.html#226453716">(Feb 15 2021 at 23:03)</a>:</h4>
<div class="codehilite"><pre><span></span><code>$ rustc --target s390x-alpine-linux-musl -Z unstable-options --print target-spec-json
error: the option `Z` is only accepted on the nightly compiler
</code></pre></div>
<p>sigh.  is there any downside to us as a downstream package just switching the channel to nightly?</p>



<a name="226453756"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/bootstrapping%20on%20s390x/mips%20for%20musl/near/226453756" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ariadne Conill <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/bootstrapping.20on.20s390x.2Fmips.20for.20musl.html#226453756">(Feb 15 2021 at 23:03)</a>:</h4>
<p>because i like when my tools do what i say instead of treating me like an idiot</p>



<a name="226453924"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/bootstrapping%20on%20s390x/mips%20for%20musl/near/226453924" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ariadne Conill <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/bootstrapping.20on.20s390x.2Fmips.20for.20musl.html#226453924">(Feb 15 2021 at 23:05)</a>:</h4>
<p>or perhaps just making -Z work on stable makes more sense.  who knows</p>



<a name="226453983"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/bootstrapping%20on%20s390x/mips%20for%20musl/near/226453983" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> cuviper <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/bootstrapping.20on.20s390x.2Fmips.20for.20musl.html#226453983">(Feb 15 2021 at 23:06)</a>:</h4>
<p><code>-Z</code> is explicitly meant to be the unstable version of <code>-C</code></p>



<a name="226453993"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/bootstrapping%20on%20s390x/mips%20for%20musl/near/226453993" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> cuviper <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/bootstrapping.20on.20s390x.2Fmips.20for.20musl.html#226453993">(Feb 15 2021 at 23:06)</a>:</h4>
<p>i.e. they are stabilized by moving to <code>-C</code></p>



<a name="226453996"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/bootstrapping%20on%20s390x/mips%20for%20musl/near/226453996" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nagisa <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/bootstrapping.20on.20s390x.2Fmips.20for.20musl.html#226453996">(Feb 15 2021 at 23:06)</a>:</h4>
<p>You can temporarily allow unstable features by setting <code>RUSTC_BOOTSTRAP</code>. But yes, -Z flags explicitly guard unstable behaviour.</p>



<a name="226454001"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/bootstrapping%20on%20s390x/mips%20for%20musl/near/226454001" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ariadne Conill <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/bootstrapping.20on.20s390x.2Fmips.20for.20musl.html#226454001">(Feb 15 2021 at 23:06)</a>:</h4>
<p>that's cool.  in the real world, we like when our tools don't gaslight us.</p>



<a name="226454030"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/bootstrapping%20on%20s390x/mips%20for%20musl/near/226454030" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ariadne Conill <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/bootstrapping.20on.20s390x.2Fmips.20for.20musl.html#226454030">(Feb 15 2021 at 23:07)</a>:</h4>
<p>thanks for the tip re: <code>RUSTC_BOOTSTRAP</code>.  can we stabilize "--print target-spec-json"?</p>



<a name="226454095"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/bootstrapping%20on%20s390x/mips%20for%20musl/near/226454095" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ariadne Conill <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/bootstrapping.20on.20s390x.2Fmips.20for.20musl.html#226454095">(Feb 15 2021 at 23:08)</a>:</h4>
<p>sorry if i seem grouchy, it's because i'm grouchy :)</p>



<a name="226454118"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/bootstrapping%20on%20s390x/mips%20for%20musl/near/226454118" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> cuviper <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/bootstrapping.20on.20s390x.2Fmips.20for.20musl.html#226454118">(Feb 15 2021 at 23:09)</a>:</h4>
<p>the target json is not considered stable, nevermind printing it</p>



<a name="226454120"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/bootstrapping%20on%20s390x/mips%20for%20musl/near/226454120" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nagisa <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/bootstrapping.20on.20s390x.2Fmips.20for.20musl.html#226454120">(Feb 15 2021 at 23:09)</a>:</h4>
<p>JSON target specification are pretty unstable, but I don't see why having this output in some other more informational form would not be fine. I suspect the primary reason there is no stable form of this is because nobody _really_ needed it.</p>



<a name="226454133"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/bootstrapping%20on%20s390x/mips%20for%20musl/near/226454133" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ariadne Conill <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/bootstrapping.20on.20s390x.2Fmips.20for.20musl.html#226454133">(Feb 15 2021 at 23:09)</a>:</h4>
<p>well the problem is that you do occasionally need it, like when setting up CI for libc crate</p>



<a name="226454252"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/bootstrapping%20on%20s390x/mips%20for%20musl/near/226454252" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ariadne Conill <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/bootstrapping.20on.20s390x.2Fmips.20for.20musl.html#226454252">(Feb 15 2021 at 23:11)</a>:</h4>
<p>it might be nice to mention <code>RUSTC_BOOTSTRAP</code> on that error message, like</p>



<a name="226454258"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/bootstrapping%20on%20s390x/mips%20for%20musl/near/226454258" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joshua Nelson <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/bootstrapping.20on.20s390x.2Fmips.20for.20musl.html#226454258">(Feb 15 2021 at 23:11)</a>:</h4>
<p><span class="user-mention silent" data-user-id="360752">Ariadne Conill</span> <a href="#narrow/stream/131828-t-compiler/topic/bootstrapping.20on.20s390x.2Fmips.20for.20musl/near/226454252">said</a>:</p>
<blockquote>
<p>it might be nice to mention <code>RUSTC_BOOTSTRAP</code> on that error message, like</p>
</blockquote>
<p>it's explicitly not recommended though</p>



<a name="226454269"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/bootstrapping%20on%20s390x/mips%20for%20musl/near/226454269" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joshua Nelson <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/bootstrapping.20on.20s390x.2Fmips.20for.20musl.html#226454269">(Feb 15 2021 at 23:11)</a>:</h4>
<p>like, bootstrapping is the <em>one</em> time you should use it</p>



<a name="226454273"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/bootstrapping%20on%20s390x/mips%20for%20musl/near/226454273" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ariadne Conill <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/bootstrapping.20on.20s390x.2Fmips.20for.20musl.html#226454273">(Feb 15 2021 at 23:11)</a>:</h4>
<p><code>error: the option Z is only accepted on the nightly compiler; use RUSTC_BOOTSTRAP if you know what you're doing</code></p>



<a name="226454329"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/bootstrapping%20on%20s390x/mips%20for%20musl/near/226454329" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ariadne Conill <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/bootstrapping.20on.20s390x.2Fmips.20for.20musl.html#226454329">(Feb 15 2021 at 23:12)</a>:</h4>
<p>yes, well, in the real world, people are going to do things they shouldn't</p>



<a name="226454333"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/bootstrapping%20on%20s390x/mips%20for%20musl/near/226454333" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joshua Nelson <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/bootstrapping.20on.20s390x.2Fmips.20for.20musl.html#226454333">(Feb 15 2021 at 23:12)</a>:</h4>
<p>ugh</p>



<a name="226454338"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/bootstrapping%20on%20s390x/mips%20for%20musl/near/226454338" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joshua Nelson <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/bootstrapping.20on.20s390x.2Fmips.20for.20musl.html#226454338">(Feb 15 2021 at 23:12)</a>:</h4>
<p>let me find the stream where you can argue about this</p>



<a name="226454347"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/bootstrapping%20on%20s390x/mips%20for%20musl/near/226454347" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ariadne Conill <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/bootstrapping.20on.20s390x.2Fmips.20for.20musl.html#226454347">(Feb 15 2021 at 23:12)</a>:</h4>
<p>gatekeeping that knowledge just makes people angry at rust</p>



<a name="226454388"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/bootstrapping%20on%20s390x/mips%20for%20musl/near/226454388" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joshua Nelson <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/bootstrapping.20on.20s390x.2Fmips.20for.20musl.html#226454388">(Feb 15 2021 at 23:13)</a>:</h4>
<p>you can complain here: <a href="#narrow/stream/233931-xxx/topic/Require.20users.20to.20confirm.20they.20know.20RUSTC_.E2.80.A6.20compiler-team.23350">https://rust-lang.zulipchat.com/#narrow/stream/233931-xxx/topic/Require.20users.20to.20confirm.20they.20know.20RUSTC_.E2.80.A6.20compiler-team.23350</a></p>



<a name="226454603"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/bootstrapping%20on%20s390x/mips%20for%20musl/near/226454603" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ariadne Conill <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/bootstrapping.20on.20s390x.2Fmips.20for.20musl.html#226454603">(Feb 15 2021 at 23:16)</a>:</h4>
<p>anyway, back on topic.  mips64 has all the magic bits it seems, so i am going to try to go for that one first.</p>



<a name="226455572"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/bootstrapping%20on%20s390x/mips%20for%20musl/near/226455572" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ariadne Conill <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/bootstrapping.20on.20s390x.2Fmips.20for.20musl.html#226455572">(Feb 15 2021 at 23:30)</a>:</h4>
<p>and we get to do all of this for riscv64 too, which misses all the same bits as s390x-musl</p>



<a name="226455592"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/bootstrapping%20on%20s390x/mips%20for%20musl/near/226455592" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ariadne Conill <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/bootstrapping.20on.20s390x.2Fmips.20for.20musl.html#226455592">(Feb 15 2021 at 23:31)</a>:</h4>
<p>the good news is, now there is a person on github who did all of this for mips64, so i can follow the same path that person did</p>



<a name="226457031"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/bootstrapping%20on%20s390x/mips%20for%20musl/near/226457031" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ariadne Conill <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/bootstrapping.20on.20s390x.2Fmips.20for.20musl.html#226457031">(Feb 15 2021 at 23:56)</a>:</h4>
<p>ok, so step 1 seems to be submit the <code>s390x-unknown-linux-musl</code> target to rust devs.  then we can enable CI for the libc crate.</p>



<a name="226460355"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/bootstrapping%20on%20s390x/mips%20for%20musl/near/226460355" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ariadne Conill <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/bootstrapping.20on.20s390x.2Fmips.20for.20musl.html#226460355">(Feb 16 2021 at 00:57)</a>:</h4>
<p>that is done here if somebody wishes to review it.  <a href="https://github.com/rust-lang/rust/pull/82166">https://github.com/rust-lang/rust/pull/82166</a></p>



<a name="226464598"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/bootstrapping%20on%20s390x/mips%20for%20musl/near/226464598" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ariadne Conill <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/bootstrapping.20on.20s390x.2Fmips.20for.20musl.html#226464598">(Feb 16 2021 at 02:27)</a>:</h4>
<p>hmm...</p>
<div class="codehilite"><pre><span></span><code>/usr/lib/gcc/mips64-alpine-linux-musl/10.2.1/../../../../mips64-alpine-linux-musl/bin/ld: warning: /home/kaniini/aports/community/rust/src/rustc-1.50.0-src/build/x86_64-alpine-linux-musl/stage1-std/mips64-alpine-linux-musl/release/deps/libstd-1f066723f7203cd7.
so uses -msoft-float (set by /home/kaniini/sysroot-mips64/usr/lib/../lib/crti.o), /home/kaniini/aports/community/rust/src/rustc-1.50.0-src/build/x86_64-alpine-linux-musl/stage1-std/mips64-alpine-linux-musl/release/deps/std-1f066723f7203cd7.std.9yg3cm60-cgu.1.rcgu.o uses
 -mhard-float
</code></pre></div>



<a name="226464604"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/bootstrapping%20on%20s390x/mips%20for%20musl/near/226464604" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ariadne Conill <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/bootstrapping.20on.20s390x.2Fmips.20for.20musl.html#226464604">(Feb 16 2021 at 02:27)</a>:</h4>
<p>how do i tell rust i want soft-float?</p>



<a name="226464609"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/bootstrapping%20on%20s390x/mips%20for%20musl/near/226464609" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ariadne Conill <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/bootstrapping.20on.20s390x.2Fmips.20for.20musl.html#226464609">(Feb 16 2021 at 02:27)</a>:</h4>
<p>other than that, it built me a rustc.  just failed to link cause hard float</p>



<a name="226465240"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/bootstrapping%20on%20s390x/mips%20for%20musl/near/226465240" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joshua Nelson <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/bootstrapping.20on.20s390x.2Fmips.20for.20musl.html#226465240">(Feb 16 2021 at 02:43)</a>:</h4>
<p>I think <span class="user-mention" data-user-id="332271">@Grommish</span> got soft-float working at some point</p>



<a name="226465314"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/bootstrapping%20on%20s390x/mips%20for%20musl/near/226465314" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joshua Nelson <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/bootstrapping.20on.20s390x.2Fmips.20for.20musl.html#226465314">(Feb 16 2021 at 02:45)</a>:</h4>
<p>Here, it goes in the target json file: <a href="https://github.com/openwrt/packages/pull/13916/files?file-filters%5B%5D=.mk&amp;file-filters%5B%5D=.patch&amp;file-filters%5B%5D=.sh&amp;file-filters%5B%5D=No+extension#diff-06b70a60a4749faaeb6148bd8b0cab4d4072bad41addc24d2782cfd9151150d5R9">https://github.com/openwrt/packages/pull/13916/files?file-filters%5B%5D=.mk&amp;file-filters%5B%5D=.patch&amp;file-filters%5B%5D=.sh&amp;file-filters%5B%5D=No+extension#diff-06b70a60a4749faaeb6148bd8b0cab4d4072bad41addc24d2782cfd9151150d5R9</a></p>



<a name="226465316"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/bootstrapping%20on%20s390x/mips%20for%20musl/near/226465316" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joshua Nelson <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/bootstrapping.20on.20s390x.2Fmips.20for.20musl.html#226465316">(Feb 16 2021 at 02:45)</a>:</h4>
<p>Oh God GitHub what is that url lol</p>



<a name="226465377"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/bootstrapping%20on%20s390x/mips%20for%20musl/near/226465377" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ariadne Conill <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/bootstrapping.20on.20s390x.2Fmips.20for.20musl.html#226465377">(Feb 16 2021 at 02:47)</a>:</h4>
<p>cool ok, i'll patch the target :)</p>



<a name="226465924"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/bootstrapping%20on%20s390x/mips%20for%20musl/near/226465924" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ariadne Conill <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/bootstrapping.20on.20s390x.2Fmips.20for.20musl.html#226465924">(Feb 16 2021 at 02:59)</a>:</h4>
<p>alright, doing another mips build :)</p>



<a name="226466161"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/bootstrapping%20on%20s390x/mips%20for%20musl/near/226466161" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joshua Nelson <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/bootstrapping.20on.20s390x.2Fmips.20for.20musl.html#226466161">(Feb 16 2021 at 03:03)</a>:</h4>
<p>You're rebuilding enough you may want to turn on incremental so it doesn't take as long</p>



<a name="226466172"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/bootstrapping%20on%20s390x/mips%20for%20musl/near/226466172" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joshua Nelson <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/bootstrapping.20on.20s390x.2Fmips.20for.20musl.html#226466172">(Feb 16 2021 at 03:03)</a>:</h4>
<p><code>incremental = true</code> in config.toml, I think it goes under <code>[rust]</code></p>



<a name="226467627"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/bootstrapping%20on%20s390x/mips%20for%20musl/near/226467627" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ariadne Conill <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/bootstrapping.20on.20s390x.2Fmips.20for.20musl.html#226467627">(Feb 16 2021 at 03:37)</a>:</h4>
<p>still more linking problems.  <a href="https://tpaste.us/BEzk">https://tpaste.us/BEzk</a></p>



<a name="226467769"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/bootstrapping%20on%20s390x/mips%20for%20musl/near/226467769" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ariadne Conill <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/bootstrapping.20on.20s390x.2Fmips.20for.20musl.html#226467769">(Feb 16 2021 at 03:40)</a>:</h4>
<p>ok cool i figured out how to use incremental to make my life more pleasant</p>



<a name="226467772"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/bootstrapping%20on%20s390x/mips%20for%20musl/near/226467772" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joshua Nelson <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/bootstrapping.20on.20s390x.2Fmips.20for.20musl.html#226467772">(Feb 16 2021 at 03:40)</a>:</h4>
<div class="codehilite"><pre><span></span><code>          /usr/lib/gcc/mips64-alpine-linux-musl/10.2.1/../../../../mips64-alpine-linux-musl/bin/ld: BFD (GNU Binutils) 2.35.1 assertion fail elfxx-mips.c:3591
          /usr/lib/gcc/mips64-alpine-linux-musl/10.2.1/../../../../mips64-alpine-linux-musl/bin/ld: BFD (GNU Binutils) 2.35.1 assertion fail elfxx-mips.c:3591
</code></pre></div>
<p>this looks like a bug in the linker <span aria-label="eyes" class="emoji emoji-1f440" role="img" title="eyes">:eyes:</span></p>



<a name="226467787"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/bootstrapping%20on%20s390x/mips%20for%20musl/near/226467787" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ariadne Conill <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/bootstrapping.20on.20s390x.2Fmips.20for.20musl.html#226467787">(Feb 16 2021 at 03:41)</a>:</h4>
<p>its not</p>



<a name="226467788"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/bootstrapping%20on%20s390x/mips%20for%20musl/near/226467788" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ariadne Conill <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/bootstrapping.20on.20s390x.2Fmips.20for.20musl.html#226467788">(Feb 16 2021 at 03:41)</a>:</h4>
<p>unless you mean rust's linker</p>



<a name="226467793"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/bootstrapping%20on%20s390x/mips%20for%20musl/near/226467793" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ariadne Conill <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/bootstrapping.20on.20s390x.2Fmips.20for.20musl.html#226467793">(Feb 16 2021 at 03:41)</a>:</h4>
<p>that toolchain compiled the entire alpine base system before compiling rust.  it's fine</p>



<a name="226467803"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/bootstrapping%20on%20s390x/mips%20for%20musl/near/226467803" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joshua Nelson <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/bootstrapping.20on.20s390x.2Fmips.20for.20musl.html#226467803">(Feb 16 2021 at 03:42)</a>:</h4>
<p>I mean, compiling alpine and having a bug on code generated by rustc are not mutually exclusive</p>



<a name="226467847"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/bootstrapping%20on%20s390x/mips%20for%20musl/near/226467847" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joshua Nelson <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/bootstrapping.20on.20s390x.2Fmips.20for.20musl.html#226467847">(Feb 16 2021 at 03:42)</a>:</h4>
<p>I don't know what this means though:</p>
<div class="codehilite"><pre><span></span><code>  = note: /usr/lib/gcc/mips64-alpine-linux-musl/10.2.1/../../../../mips64-alpine-linux-musl/bin/ld: skipping incompatible /usr/lib/libssp_nonshared.a when searching for -lssp_nonshared
          /usr/lib/gcc/mips64-alpine-linux-musl/10.2.1/../../../../mips64-alpine-linux-musl/bin/ld: skipping incompatible /usr/lib/libgcc_s.so.1 when searching for libgcc_s.so.1
          /usr/lib/gcc/mips64-alpine-linux-musl/10.2.1/../../../../mips64-alpine-linux-musl/bin/ld: skipping incompatible /usr/lib/libgcc_s.so.1 when searching for libgcc_s.so.1
          /usr/lib/gcc/mips64-alpine-linux-musl/10.2.1/../../../../mips64-alpine-linux-musl/bin/ld: skipping incompatible /usr/lib/libc.so when searching for -lc
          /usr/lib/gcc/mips64-alpine-linux-musl/10.2.1/../../../../mips64-alpine-linux-musl/bin/ld: skipping incompatible /usr/lib/libc.a when searching for -lc
</code></pre></div>



<a name="226468243"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/bootstrapping%20on%20s390x/mips%20for%20musl/near/226468243" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ariadne Conill <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/bootstrapping.20on.20s390x.2Fmips.20for.20musl.html#226468243">(Feb 16 2021 at 03:51)</a>:</h4>
<p><code>"-L" "native=/usr/lib"</code></p>



<a name="226468250"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/bootstrapping%20on%20s390x/mips%20for%20musl/near/226468250" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ariadne Conill <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/bootstrapping.20on.20s390x.2Fmips.20for.20musl.html#226468250">(Feb 16 2021 at 03:51)</a>:</h4>
<p>should this not be the sysroot path?</p>



<a name="226469269"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/bootstrapping%20on%20s390x/mips%20for%20musl/near/226469269" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joshua Nelson <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/bootstrapping.20on.20s390x.2Fmips.20for.20musl.html#226469269">(Feb 16 2021 at 04:08)</a>:</h4>
<p>you could see what cargo passes for <code>-L</code> maybe</p>



<a name="226469430"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/bootstrapping%20on%20s390x/mips%20for%20musl/near/226469430" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ariadne Conill <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/bootstrapping.20on.20s390x.2Fmips.20for.20musl.html#226469430">(Feb 16 2021 at 04:11)</a>:</h4>
<p>nah its something else.</p>
<div class="codehilite"><pre><span></span><code>treefort:~/aports/community/rust$ mips64-alpine-linux-musl-gcc -o foo foo.c
/usr/lib/gcc/mips64-alpine-linux-musl/10.2.1/../../../../mips64-alpine-linux-musl/bin/ld: cannot find Scrt1.o: No such file or directory
/usr/lib/gcc/mips64-alpine-linux-musl/10.2.1/../../../../mips64-alpine-linux-musl/bin/ld: cannot find crti.o: No such file or directory
/usr/lib/gcc/mips64-alpine-linux-musl/10.2.1/../../../../mips64-alpine-linux-musl/bin/ld: cannot find -lssp_nonshared
collect2: error: ld returned 1 exit status
</code></pre></div>



<a name="226469445"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/bootstrapping%20on%20s390x/mips%20for%20musl/near/226469445" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ariadne Conill <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/bootstrapping.20on.20s390x.2Fmips.20for.20musl.html#226469445">(Feb 16 2021 at 04:11)</a>:</h4>
<p>i reconstructed the environment wrong it seems</p>



<a name="226469843"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/bootstrapping%20on%20s390x/mips%20for%20musl/near/226469843" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ariadne Conill <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/bootstrapping.20on.20s390x.2Fmips.20for.20musl.html#226469843">(Feb 16 2021 at 04:19)</a>:</h4>
<p>ok got it now</p>



<a name="226470331"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/bootstrapping%20on%20s390x/mips%20for%20musl/near/226470331" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ariadne Conill <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/bootstrapping.20on.20s390x.2Fmips.20for.20musl.html#226470331">(Feb 16 2021 at 04:27)</a>:</h4>
<p>hmm, how can i make it not delete the tmpdir it makes</p>



<a name="226470344"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/bootstrapping%20on%20s390x/mips%20for%20musl/near/226470344" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joshua Nelson <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/bootstrapping.20on.20s390x.2Fmips.20for.20musl.html#226470344">(Feb 16 2021 at 04:27)</a>:</h4>
<p><code>rustc -C save-temps=yes</code></p>



<a name="226470412"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/bootstrapping%20on%20s390x/mips%20for%20musl/near/226470412" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ariadne Conill <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/bootstrapping.20on.20s390x.2Fmips.20for.20musl.html#226470412">(Feb 16 2021 at 04:28)</a>:</h4>
<p>how do i do that with this x.py thing</p>



<a name="226470419"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/bootstrapping%20on%20s390x/mips%20for%20musl/near/226470419" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joshua Nelson <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/bootstrapping.20on.20s390x.2Fmips.20for.20musl.html#226470419">(Feb 16 2021 at 04:28)</a>:</h4>
<p>hmm, depends what stage fails to build</p>



<a name="226470429"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/bootstrapping%20on%20s390x/mips%20for%20musl/near/226470429" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joshua Nelson <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/bootstrapping.20on.20s390x.2Fmips.20for.20musl.html#226470429">(Feb 16 2021 at 04:29)</a>:</h4>
<p>can you run <em>without</em> -vv and show me the output just before the error?</p>



<a name="226470438"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/bootstrapping%20on%20s390x/mips%20for%20musl/near/226470438" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joshua Nelson <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/bootstrapping.20on.20s390x.2Fmips.20for.20musl.html#226470438">(Feb 16 2021 at 04:29)</a>:</h4>
<p>for stage0 it will be <code>RUSTFLAGS_BOOTSTRAP</code>, for everything else it's <code>RUSTFLAGS_NOT_BOOTSTRAP</code></p>



<a name="226470527"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/bootstrapping%20on%20s390x/mips%20for%20musl/near/226470527" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ariadne Conill <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/bootstrapping.20on.20s390x.2Fmips.20for.20musl.html#226470527">(Feb 16 2021 at 04:30)</a>:</h4>
<p>wow, setting that is making it rebuild everything</p>



<a name="226470528"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/bootstrapping%20on%20s390x/mips%20for%20musl/near/226470528" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ariadne Conill <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/bootstrapping.20on.20s390x.2Fmips.20for.20musl.html#226470528">(Feb 16 2021 at 04:30)</a>:</h4>
<p>grrrrr</p>



<a name="226470567"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/bootstrapping%20on%20s390x/mips%20for%20musl/near/226470567" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joshua Nelson <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/bootstrapping.20on.20s390x.2Fmips.20for.20musl.html#226470567">(Feb 16 2021 at 04:31)</a>:</h4>
<p>next time you could find the last command it executes and just tack the flag onto that</p>



<a name="226470571"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/bootstrapping%20on%20s390x/mips%20for%20musl/near/226470571" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joshua Nelson <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/bootstrapping.20on.20s390x.2Fmips.20for.20musl.html#226470571">(Feb 16 2021 at 04:31)</a>:</h4>
<p>instead of going through x.py</p>



<a name="226470625"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/bootstrapping%20on%20s390x/mips%20for%20musl/near/226470625" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ariadne Conill <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/bootstrapping.20on.20s390x.2Fmips.20for.20musl.html#226470625">(Feb 16 2021 at 04:32)</a>:</h4>
<p>yeah <code>ash</code> has a limit to how much you can input at once</p>



<a name="226470635"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/bootstrapping%20on%20s390x/mips%20for%20musl/near/226470635" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joshua Nelson <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/bootstrapping.20on.20s390x.2Fmips.20for.20musl.html#226470635">(Feb 16 2021 at 04:32)</a>:</h4>
<p>you could save it to a tempfile and run that maybe</p>



<a name="226470952"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/bootstrapping%20on%20s390x/mips%20for%20musl/near/226470952" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ariadne Conill <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/bootstrapping.20on.20s390x.2Fmips.20for.20musl.html#226470952">(Feb 16 2021 at 04:37)</a>:</h4>
<p>with my luck it will just work now</p>



<a name="226471034"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/bootstrapping%20on%20s390x/mips%20for%20musl/near/226471034" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ariadne Conill <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/bootstrapping.20on.20s390x.2Fmips.20for.20musl.html#226471034">(Feb 16 2021 at 04:38)</a>:</h4>
<p>hmm.  actually, this elfxx-mips thing might be "it"</p>



<a name="226471163"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/bootstrapping%20on%20s390x/mips%20for%20musl/near/226471163" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ariadne Conill <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/bootstrapping.20on.20s390x.2Fmips.20for.20musl.html#226471163">(Feb 16 2021 at 04:40)</a>:</h4>
<div class="codehilite"><pre><span></span><code>  /* Once we determine the global GOT entry with the lowest dynamic
     symbol table index, we must put all dynamic symbols with greater
     indices into the primary GOT.  That makes it easy to calculate the
     GOT offset.  */
  BFD_ASSERT (h-&gt;dynindx &gt;= global_got_dynindx);
</code></pre></div>



<a name="226471173"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/bootstrapping%20on%20s390x/mips%20for%20musl/near/226471173" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ariadne Conill <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/bootstrapping.20on.20s390x.2Fmips.20for.20musl.html#226471173">(Feb 16 2021 at 04:40)</a>:</h4>
<p>this is endianness bug i bet</p>



<a name="226471218"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/bootstrapping%20on%20s390x/mips%20for%20musl/near/226471218" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ariadne Conill <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/bootstrapping.20on.20s390x.2Fmips.20for.20musl.html#226471218">(Feb 16 2021 at 04:41)</a>:</h4>
<p>h-&gt;dynindx is saved in wrong endianness, evaluates less than 0</p>



<a name="226471318"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/bootstrapping%20on%20s390x/mips%20for%20musl/near/226471318" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ariadne Conill <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/bootstrapping.20on.20s390x.2Fmips.20for.20musl.html#226471318">(Feb 16 2021 at 04:42)</a>:</h4>
<p>does rustc generate its own binaries at any stage during compilation</p>



<a name="226471321"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/bootstrapping%20on%20s390x/mips%20for%20musl/near/226471321" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ariadne Conill <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/bootstrapping.20on.20s390x.2Fmips.20for.20musl.html#226471321">(Feb 16 2021 at 04:42)</a>:</h4>
<p>rlib etc</p>



<a name="226471326"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/bootstrapping%20on%20s390x/mips%20for%20musl/near/226471326" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ariadne Conill <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/bootstrapping.20on.20s390x.2Fmips.20for.20musl.html#226471326">(Feb 16 2021 at 04:42)</a>:</h4>
<p>or are those packaged up with the system toolchain</p>



<a name="226471405"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/bootstrapping%20on%20s390x/mips%20for%20musl/near/226471405" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joshua Nelson <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/bootstrapping.20on.20s390x.2Fmips.20for.20musl.html#226471405">(Feb 16 2021 at 04:44)</a>:</h4>
<p>I'm not sure. <a href="https://doc.rust-lang.org/nightly/nightly-rustc/rustc_codegen_ssa/">https://doc.rust-lang.org/nightly/nightly-rustc/rustc_codegen_ssa/</a> is the place to look, <span class="user-mention" data-user-id="133247">@bjorn3</span> may know more</p>



<a name="226471520"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/bootstrapping%20on%20s390x/mips%20for%20musl/near/226471520" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ariadne Conill <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/bootstrapping.20on.20s390x.2Fmips.20for.20musl.html#226471520">(Feb 16 2021 at 04:47)</a>:</h4>
<p>yeah i’m pretty sure that’s what’s going on</p>



<a name="226471526"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/bootstrapping%20on%20s390x/mips%20for%20musl/near/226471526" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ariadne Conill <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/bootstrapping.20on.20s390x.2Fmips.20for.20musl.html#226471526">(Feb 16 2021 at 04:47)</a>:</h4>
<p>the ELF headers are probably being written in host byte order instead of the correct order</p>



<a name="226471612"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/bootstrapping%20on%20s390x/mips%20for%20musl/near/226471612" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ariadne Conill <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/bootstrapping.20on.20s390x.2Fmips.20for.20musl.html#226471612">(Feb 16 2021 at 04:48)</a>:</h4>
<p>there is a way we can find out, but i’m going to take a break first</p>



<a name="226471619"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/bootstrapping%20on%20s390x/mips%20for%20musl/near/226471619" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ariadne Conill <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/bootstrapping.20on.20s390x.2Fmips.20for.20musl.html#226471619">(Feb 16 2021 at 04:49)</a>:</h4>
<p>we could cross to mips64el</p>



<a name="226471640"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/bootstrapping%20on%20s390x/mips%20for%20musl/near/226471640" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ariadne Conill <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/bootstrapping.20on.20s390x.2Fmips.20for.20musl.html#226471640">(Feb 16 2021 at 04:49)</a>:</h4>
<p>if that works then we have an endianness problem</p>



<a name="226474094"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/bootstrapping%20on%20s390x/mips%20for%20musl/near/226474094" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ariadne Conill <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/bootstrapping.20on.20s390x.2Fmips.20for.20musl.html#226474094">(Feb 16 2021 at 05:36)</a>:</h4>
<p>monitoring what processes get spawned i don’t see anything traditional, looks like rustc emits the .o and .rlib itself</p>



<a name="226474108"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/bootstrapping%20on%20s390x/mips%20for%20musl/near/226474108" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ariadne Conill <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/bootstrapping.20on.20s390x.2Fmips.20for.20musl.html#226474108">(Feb 16 2021 at 05:36)</a>:</h4>
<p>to confirm this theory going to kick off mips64el build</p>



<a name="226474116"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/bootstrapping%20on%20s390x/mips%20for%20musl/near/226474116" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ariadne Conill <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/bootstrapping.20on.20s390x.2Fmips.20for.20musl.html#226474116">(Feb 16 2021 at 05:37)</a>:</h4>
<p>though that isn’t an actual release arch yet</p>



<a name="226474560"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/bootstrapping%20on%20s390x/mips%20for%20musl/near/226474560" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grommish <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/bootstrapping.20on.20s390x.2Fmips.20for.20musl.html#226474560">(Feb 16 2021 at 05:45)</a>:</h4>
<p>When you added your custom target for mips64-alpine-linux-musl, did you create the <a href="http://mips64_alpine_linux_musl.rs">mips64_alpine_linux_musl.rs</a> file and edit <a href="http://mod.rs">mod.rs</a> to know about it?  Also, you'll need to you set MUSL to dynamically linked rather than statically linked in <a href="http://linux_musl_base.rs">linux_musl_base.rs</a> by changing base.crt_static_default = true; to base.crt_static_default = false;</p>



<a name="226474571"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/bootstrapping%20on%20s390x/mips%20for%20musl/near/226474571" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ariadne Conill <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/bootstrapping.20on.20s390x.2Fmips.20for.20musl.html#226474571">(Feb 16 2021 at 05:46)</a>:</h4>
<p>yes, i did</p>



<a name="226474628"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/bootstrapping%20on%20s390x/mips%20for%20musl/near/226474628" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ariadne Conill <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/bootstrapping.20on.20s390x.2Fmips.20for.20musl.html#226474628">(Feb 16 2021 at 05:46)</a>:</h4>
<p>that’s definitely not what’s happening here</p>



<a name="226474633"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/bootstrapping%20on%20s390x/mips%20for%20musl/near/226474633" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grommish <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/bootstrapping.20on.20s390x.2Fmips.20for.20musl.html#226474633">(Feb 16 2021 at 05:46)</a>:</h4>
<p>Ok, sorry I'm playing catchup because I didn't reinstall zulip once I blew my system up :)  What issues are you having?</p>



<a name="226474646"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/bootstrapping%20on%20s390x/mips%20for%20musl/near/226474646" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ariadne Conill <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/bootstrapping.20on.20s390x.2Fmips.20for.20musl.html#226474646">(Feb 16 2021 at 05:47)</a>:</h4>
<p>i’m chasing an issue with binutils 2.35.1 assertion failure</p>



<a name="226474649"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/bootstrapping%20on%20s390x/mips%20for%20musl/near/226474649" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ariadne Conill <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/bootstrapping.20on.20s390x.2Fmips.20for.20musl.html#226474649">(Feb 16 2021 at 05:47)</a>:</h4>
<p>maybe it is worth upgrading binutils</p>



<a name="226474658"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/bootstrapping%20on%20s390x/mips%20for%20musl/near/226474658" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ariadne Conill <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/bootstrapping.20on.20s390x.2Fmips.20for.20musl.html#226474658">(Feb 16 2021 at 05:47)</a>:</h4>
<p>but i think the symbol gnu_hash table is being written with incorrect endianness</p>



<a name="226474673"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/bootstrapping%20on%20s390x/mips%20for%20musl/near/226474673" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grommish <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/bootstrapping.20on.20s390x.2Fmips.20for.20musl.html#226474673">(Feb 16 2021 at 05:48)</a>:</h4>
<p>I'm running rust 1.49.0 for mips64-musl under Openwrt with gcc10.2 and 2.35.1 binutils.. Got any logs?</p>



<a name="226474709"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/bootstrapping%20on%20s390x/mips%20for%20musl/near/226474709" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ariadne Conill <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/bootstrapping.20on.20s390x.2Fmips.20for.20musl.html#226474709">(Feb 16 2021 at 05:48)</a>:</h4>
<p>the assertion failure would be consistent with that</p>



<a name="226474714"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/bootstrapping%20on%20s390x/mips%20for%20musl/near/226474714" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ariadne Conill <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/bootstrapping.20on.20s390x.2Fmips.20for.20musl.html#226474714">(Feb 16 2021 at 05:48)</a>:</h4>
<p>this is 1.50</p>



<a name="226474728"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/bootstrapping%20on%20s390x/mips%20for%20musl/near/226474728" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ariadne Conill <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/bootstrapping.20on.20s390x.2Fmips.20for.20musl.html#226474728">(Feb 16 2021 at 05:48)</a>:</h4>
<p>because other people decided to not listen and upgraded all the way to 1.50</p>



<a name="226474732"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/bootstrapping%20on%20s390x/mips%20for%20musl/near/226474732" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grommish <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/bootstrapping.20on.20s390x.2Fmips.20for.20musl.html#226474732">(Feb 16 2021 at 05:48)</a>:</h4>
<p>I can bump the version to test if you think it'll help, but it'll take a few hours sto build out</p>



<a name="226474753"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/bootstrapping%20on%20s390x/mips%20for%20musl/near/226474753" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ariadne Conill <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/bootstrapping.20on.20s390x.2Fmips.20for.20musl.html#226474753">(Feb 16 2021 at 05:49)</a>:</h4>
<p>well i can gather a new build log or i can test my theory with mips64el</p>



<a name="226474755"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/bootstrapping%20on%20s390x/mips%20for%20musl/near/226474755" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ariadne Conill <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/bootstrapping.20on.20s390x.2Fmips.20for.20musl.html#226474755">(Feb 16 2021 at 05:49)</a>:</h4>
<p>:)</p>



<a name="226474763"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/bootstrapping%20on%20s390x/mips%20for%20musl/near/226474763" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ariadne Conill <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/bootstrapping.20on.20s390x.2Fmips.20for.20musl.html#226474763">(Feb 16 2021 at 05:49)</a>:</h4>
<p>i think mips64el is better approach</p>



<a name="226474765"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/bootstrapping%20on%20s390x/mips%20for%20musl/near/226474765" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ariadne Conill <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/bootstrapping.20on.20s390x.2Fmips.20for.20musl.html#226474765">(Feb 16 2021 at 05:49)</a>:</h4>
<p>one question though.</p>



<a name="226474810"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/bootstrapping%20on%20s390x/mips%20for%20musl/near/226474810" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grommish <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/bootstrapping.20on.20s390x.2Fmips.20for.20musl.html#226474810">(Feb 16 2021 at 05:50)</a>:</h4>
<p>Ok.. I've got an Octeon3, so I've got a BE SoC</p>



<a name="226474811"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/bootstrapping%20on%20s390x/mips%20for%20musl/near/226474811" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ariadne Conill <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/bootstrapping.20on.20s390x.2Fmips.20for.20musl.html#226474811">(Feb 16 2021 at 05:50)</a>:</h4>
<p>do you use regular GNU ld</p>



<a name="226474819"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/bootstrapping%20on%20s390x/mips%20for%20musl/near/226474819" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ariadne Conill <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/bootstrapping.20on.20s390x.2Fmips.20for.20musl.html#226474819">(Feb 16 2021 at 05:50)</a>:</h4>
<p>or do you use gold</p>



<a name="226474829"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/bootstrapping%20on%20s390x/mips%20for%20musl/near/226474829" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grommish <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/bootstrapping.20on.20s390x.2Fmips.20for.20musl.html#226474829">(Feb 16 2021 at 05:50)</a>:</h4>
<p>gnu</p>



<a name="226474838"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/bootstrapping%20on%20s390x/mips%20for%20musl/near/226474838" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ariadne Conill <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/bootstrapping.20on.20s390x.2Fmips.20for.20musl.html#226474838">(Feb 16 2021 at 05:50)</a>:</h4>
<p>are you 100% sure</p>



<a name="226474974"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/bootstrapping%20on%20s390x/mips%20for%20musl/near/226474974" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grommish <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/bootstrapping.20on.20s390x.2Fmips.20for.20musl.html#226474974">(Feb 16 2021 at 05:53)</a>:</h4>
<p>Yes.. Its the OpenWRT build system</p>



<a name="226474991"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/bootstrapping%20on%20s390x/mips%20for%20musl/near/226474991" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grommish <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/bootstrapping.20on.20s390x.2Fmips.20for.20musl.html#226474991">(Feb 16 2021 at 05:53)</a>:</h4>
<p>Cross compiling from x86_64 to mips64</p>



<a name="226475095"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/bootstrapping%20on%20s390x/mips%20for%20musl/near/226475095" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ariadne Conill <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/bootstrapping.20on.20s390x.2Fmips.20for.20musl.html#226475095">(Feb 16 2021 at 05:55)</a>:</h4>
<p>i am incidentally curious about which o3 board you have</p>



<a name="226475103"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/bootstrapping%20on%20s390x/mips%20for%20musl/near/226475103" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ariadne Conill <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/bootstrapping.20on.20s390x.2Fmips.20for.20musl.html#226475103">(Feb 16 2021 at 05:55)</a>:</h4>
<p>we have a few ubiquiti edgerouter infinity boards</p>



<a name="226475161"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/bootstrapping%20on%20s390x/mips%20for%20musl/near/226475161" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grommish <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/bootstrapping.20on.20s390x.2Fmips.20for.20musl.html#226475161">(Feb 16 2021 at 05:56)</a>:</h4>
<p>Its a CN7020AAP1.2 from a network security device that was part of a limited &lt;500 device run.. an Itus Networks Shield</p>



<a name="226475297"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/bootstrapping%20on%20s390x/mips%20for%20musl/near/226475297" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ariadne Conill <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/bootstrapping.20on.20s390x.2Fmips.20for.20musl.html#226475297">(Feb 16 2021 at 05:59)</a>:</h4>
<p>dunno that sku</p>



<a name="226475348"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/bootstrapping%20on%20s390x/mips%20for%20musl/near/226475348" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grommish <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/bootstrapping.20on.20s390x.2Fmips.20for.20musl.html#226475348">(Feb 16 2021 at 06:00)</a>:</h4>
<p>Dual core 1ghz SOC</p>



<a name="226475656"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/bootstrapping%20on%20s390x/mips%20for%20musl/near/226475656" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ariadne Conill <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/bootstrapping.20on.20s390x.2Fmips.20for.20musl.html#226475656">(Feb 16 2021 at 06:06)</a>:</h4>
<p>hmm</p>



<a name="226475690"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/bootstrapping%20on%20s390x/mips%20for%20musl/near/226475690" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ariadne Conill <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/bootstrapping.20on.20s390x.2Fmips.20for.20musl.html#226475690">(Feb 16 2021 at 06:06)</a>:</h4>
<p>i have an idea</p>



<a name="226475704"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/bootstrapping%20on%20s390x/mips%20for%20musl/near/226475704" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ariadne Conill <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/bootstrapping.20on.20s390x.2Fmips.20for.20musl.html#226475704">(Feb 16 2021 at 06:06)</a>:</h4>
<p>i'm going to patch binutils to show me what's up</p>



<a name="226475716"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/bootstrapping%20on%20s390x/mips%20for%20musl/near/226475716" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grommish <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/bootstrapping.20on.20s390x.2Fmips.20for.20musl.html#226475716">(Feb 16 2021 at 06:06)</a>:</h4>
<p>I've got a build going for 1.50.0, we'll see what happens :)</p>



<a name="226475764"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/bootstrapping%20on%20s390x/mips%20for%20musl/near/226475764" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ariadne Conill <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/bootstrapping.20on.20s390x.2Fmips.20for.20musl.html#226475764">(Feb 16 2021 at 06:08)</a>:</h4>
<p>cross i assume</p>



<a name="226475796"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/bootstrapping%20on%20s390x/mips%20for%20musl/near/226475796" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ariadne Conill <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/bootstrapping.20on.20s390x.2Fmips.20for.20musl.html#226475796">(Feb 16 2021 at 06:08)</a>:</h4>
<p>in the meantime, i am going to dig into this issue a bit</p>



<a name="226475802"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/bootstrapping%20on%20s390x/mips%20for%20musl/near/226475802" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grommish <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/bootstrapping.20on.20s390x.2Fmips.20for.20musl.html#226475802">(Feb 16 2021 at 06:08)</a>:</h4>
<p>I build both stage1/stage2.. the stage2 are mips64</p>



<a name="226475806"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/bootstrapping%20on%20s390x/mips%20for%20musl/near/226475806" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grommish <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/bootstrapping.20on.20s390x.2Fmips.20for.20musl.html#226475806">(Feb 16 2021 at 06:08)</a>:</h4>
<p>stage1 is x86_64</p>



<a name="226475817"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/bootstrapping%20on%20s390x/mips%20for%20musl/near/226475817" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ariadne Conill <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/bootstrapping.20on.20s390x.2Fmips.20for.20musl.html#226475817">(Feb 16 2021 at 06:09)</a>:</h4>
<p>i think if i can get it to output what file is open in the assertion failure that would help</p>



<a name="226476251"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/bootstrapping%20on%20s390x/mips%20for%20musl/near/226476251" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ariadne Conill <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/bootstrapping.20on.20s390x.2Fmips.20for.20musl.html#226476251">(Feb 16 2021 at 06:16)</a>:</h4>
<p>alright, got a hacked binutils in place, lets see what it says</p>



<a name="226476296"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/bootstrapping%20on%20s390x/mips%20for%20musl/near/226476296" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ariadne Conill <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/bootstrapping.20on.20s390x.2Fmips.20for.20musl.html#226476296">(Feb 16 2021 at 06:17)</a>:</h4>
<p><code>WTF condition, file /home/kaniini/aports/community/rust/src/rustc-1.50.0-src/build/x86_64-alpine-linux-musl/stage1-std/mips64-alpine-linux-musl/release/deps/libstd-1f066723f7203cd7.so, dynindx a, global_got_dynindx c</code></p>



<a name="226476323"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/bootstrapping%20on%20s390x/mips%20for%20musl/near/226476323" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ariadne Conill <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/bootstrapping.20on.20s390x.2Fmips.20for.20musl.html#226476323">(Feb 16 2021 at 06:18)</a>:</h4>
<p>well... that was unexpected</p>



<a name="226476356"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/bootstrapping%20on%20s390x/mips%20for%20musl/near/226476356" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ariadne Conill <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/bootstrapping.20on.20s390x.2Fmips.20for.20musl.html#226476356">(Feb 16 2021 at 06:18)</a>:</h4>
<p>ok perhaps this is not an endianness issue after all</p>



<a name="226476366"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/bootstrapping%20on%20s390x/mips%20for%20musl/near/226476366" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ariadne Conill <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/bootstrapping.20on.20s390x.2Fmips.20for.20musl.html#226476366">(Feb 16 2021 at 06:19)</a>:</h4>
<p>does openwrt do any patching to its binutils?</p>



<a name="226476448"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/bootstrapping%20on%20s390x/mips%20for%20musl/near/226476448" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grommish <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/bootstrapping.20on.20s390x.2Fmips.20for.20musl.html#226476448">(Feb 16 2021 at 06:20)</a>:</h4>
<p><a href="https://github.com/openwrt/openwrt/tree/master/toolchain/binutils/patches/2.35.1">https://github.com/openwrt/openwrt/tree/master/toolchain/binutils/patches/2.35.1</a></p>



<a name="226476773"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/bootstrapping%20on%20s390x/mips%20for%20musl/near/226476773" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ariadne Conill <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/bootstrapping.20on.20s390x.2Fmips.20for.20musl.html#226476773">(Feb 16 2021 at 06:26)</a>:</h4>
<p>ok, i applied the patches openwrt uses, lets see if that changes anything</p>



<a name="226476894"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/bootstrapping%20on%20s390x/mips%20for%20musl/near/226476894" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ariadne Conill <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/bootstrapping.20on.20s390x.2Fmips.20for.20musl.html#226476894">(Feb 16 2021 at 06:28)</a>:</h4>
<p>ok that didn't change anything</p>



<a name="226476902"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/bootstrapping%20on%20s390x/mips%20for%20musl/near/226476902" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ariadne Conill <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/bootstrapping.20on.20s390x.2Fmips.20for.20musl.html#226476902">(Feb 16 2021 at 06:28)</a>:</h4>
<p>lets have a laugh and delete the assert</p>



<a name="226477239"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/bootstrapping%20on%20s390x/mips%20for%20musl/near/226477239" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ariadne Conill <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/bootstrapping.20on.20s390x.2Fmips.20for.20musl.html#226477239">(Feb 16 2021 at 06:34)</a>:</h4>
<p>ok assert deleted</p>



<a name="226477254"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/bootstrapping%20on%20s390x/mips%20for%20musl/near/226477254" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ariadne Conill <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/bootstrapping.20on.20s390x.2Fmips.20for.20musl.html#226477254">(Feb 16 2021 at 06:34)</a>:</h4>
<p>we are now in YOLO territory :)</p>



<a name="226477262"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/bootstrapping%20on%20s390x/mips%20for%20musl/near/226477262" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ariadne Conill <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/bootstrapping.20on.20s390x.2Fmips.20for.20musl.html#226477262">(Feb 16 2021 at 06:34)</a>:</h4>
<p>HOLY FUCK IT BUILT</p>



<a name="226477277"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/bootstrapping%20on%20s390x/mips%20for%20musl/near/226477277" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ariadne Conill <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/bootstrapping.20on.20s390x.2Fmips.20for.20musl.html#226477277">(Feb 16 2021 at 06:35)</a>:</h4>
<p>i wasn't expecting that, but whatever</p>



<a name="226477387"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/bootstrapping%20on%20s390x/mips%20for%20musl/near/226477387" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grommish <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/bootstrapping.20on.20s390x.2Fmips.20for.20musl.html#226477387">(Feb 16 2021 at 06:37)</a>:</h4>
<p>:D</p>



<a name="226477455"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/bootstrapping%20on%20s390x/mips%20for%20musl/near/226477455" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ariadne Conill <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/bootstrapping.20on.20s390x.2Fmips.20for.20musl.html#226477455">(Feb 16 2021 at 06:38)</a>:</h4>
<p>and then stage1 x86_64 failed with __rdl_alloc</p>



<a name="226477717"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/bootstrapping%20on%20s390x/mips%20for%20musl/near/226477717" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ariadne Conill <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/bootstrapping.20on.20s390x.2Fmips.20for.20musl.html#226477717">(Feb 16 2021 at 06:43)</a>:</h4>
<p>guess that means we're back to verifying a known good cross still works</p>



<a name="226477793"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/bootstrapping%20on%20s390x/mips%20for%20musl/near/226477793" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grommish <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/bootstrapping.20on.20s390x.2Fmips.20for.20musl.html#226477793">(Feb 16 2021 at 06:45)</a>:</h4>
<p>Can you post your <a href="http://mips-alpine-linux-musl.rs">mips-alpine-linux-musl.rs</a> somewhere so i can look at it?</p>



<a name="226478005"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/bootstrapping%20on%20s390x/mips%20for%20musl/near/226478005" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ariadne Conill <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/bootstrapping.20on.20s390x.2Fmips.20for.20musl.html#226478005">(Feb 16 2021 at 06:48)</a>:</h4>
<p><a href="https://tpaste.us/byx1">https://tpaste.us/byx1</a></p>



<a name="226478138"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/bootstrapping%20on%20s390x/mips%20for%20musl/near/226478138" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grommish <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/bootstrapping.20on.20s390x.2Fmips.20for.20musl.html#226478138">(Feb 16 2021 at 06:51)</a>:</h4>
<p>Thanks :) I'll play with it after I verify 1.50 builds out and let you know if i come up with something</p>



<a name="226478365"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/bootstrapping%20on%20s390x/mips%20for%20musl/near/226478365" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ariadne Conill <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/bootstrapping.20on.20s390x.2Fmips.20for.20musl.html#226478365">(Feb 16 2021 at 06:55)</a>:</h4>
<p>sounds good!</p>



<a name="226494363"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/bootstrapping%20on%20s390x/mips%20for%20musl/near/226494363" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ariadne Conill <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/bootstrapping.20on.20s390x.2Fmips.20for.20musl.html#226494363">(Feb 16 2021 at 10:08)</a>:</h4>
<p>hmm, and now i am not able to cross x86_64 to aarch64 on 1.50</p>



<a name="226494377"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/bootstrapping%20on%20s390x/mips%20for%20musl/near/226494377" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ariadne Conill <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/bootstrapping.20on.20s390x.2Fmips.20for.20musl.html#226494377">(Feb 16 2021 at 10:08)</a>:</h4>
<p>it fails trying to build cargo</p>



<a name="226494395"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/bootstrapping%20on%20s390x/mips%20for%20musl/near/226494395" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ariadne Conill <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/bootstrapping.20on.20s390x.2Fmips.20for.20musl.html#226494395">(Feb 16 2021 at 10:08)</a>:</h4>
<p>say std and other crates are not present</p>



<a name="226494475"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/bootstrapping%20on%20s390x/mips%20for%20musl/near/226494475" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ariadne Conill <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/bootstrapping.20on.20s390x.2Fmips.20for.20musl.html#226494475">(Feb 16 2021 at 10:09)</a>:</h4>
<p>well this is certainly a setback</p>



<a name="226549502"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/bootstrapping%20on%20s390x/mips%20for%20musl/near/226549502" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grommish <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/bootstrapping.20on.20s390x.2Fmips.20for.20musl.html#226549502">(Feb 16 2021 at 17:49)</a>:</h4>
<p>I've got 1.50.0 build for a x86_64-mips64 to build..  I'll try making an alpine define and see what happens</p>



<a name="226549962"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/bootstrapping%20on%20s390x/mips%20for%20musl/near/226549962" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grommish <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/bootstrapping.20on.20s390x.2Fmips.20for.20musl.html#226549962">(Feb 16 2021 at 17:52)</a>:</h4>
<p>Your target is going to be the s390x MUSL, correct?</p>



<a name="226552882"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/bootstrapping%20on%20s390x/mips%20for%20musl/near/226552882" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grommish <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/bootstrapping.20on.20s390x.2Fmips.20for.20musl.html#226552882">(Feb 16 2021 at 18:14)</a>:</h4>
<p>I'm not sure how to test this because I don't have an alpine target to build for..  But, try using this as your triple  <a href="/user_uploads/4715/gfdywLvwjDH1kbzp4IMmjS9G/s390x_alpine_linux_musl.rs">s390x_alpine_linux_musl.rs</a></p>



<a name="226553003"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/bootstrapping%20on%20s390x/mips%20for%20musl/near/226553003" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grommish <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/bootstrapping.20on.20s390x.2Fmips.20for.20musl.html#226553003">(Feb 16 2021 at 18:14)</a>:</h4>
<p>and remember to add the line to <a href="http://mod.rs">mod.rs</a> for it</p>



<a name="226589430"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/bootstrapping%20on%20s390x/mips%20for%20musl/near/226589430" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ariadne Conill <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/bootstrapping.20on.20s390x.2Fmips.20for.20musl.html#226589430">(Feb 16 2021 at 22:38)</a>:</h4>
<p>Ultimately we need to bootstrap on s390x, mips64[el] and riscv64 to get rust on all release archs.</p>



<a name="226596125"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/bootstrapping%20on%20s390x/mips%20for%20musl/near/226596125" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ariadne Conill <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/bootstrapping.20on.20s390x.2Fmips.20for.20musl.html#226596125">(Feb 16 2021 at 23:54)</a>:</h4>
<p>s390x and riscv64 need some actual coding to be done in libc and std crates</p>



<a name="226596277"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/bootstrapping%20on%20s390x/mips%20for%20musl/near/226596277" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ariadne Conill <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/bootstrapping.20on.20s390x.2Fmips.20for.20musl.html#226596277">(Feb 16 2021 at 23:56)</a>:</h4>
<p><span class="user-mention" data-user-id="332271">@Grommish</span> where is the latest rust packaging source for openwrt?</p>



<a name="226605958"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/bootstrapping%20on%20s390x/mips%20for%20musl/near/226605958" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grommish <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/bootstrapping.20on.20s390x.2Fmips.20for.20musl.html#226605958">(Feb 17 2021 at 02:20)</a>:</h4>
<p><span class="user-mention" data-user-id="360752">@Ariadne Conill</span> There isn't one yet  I'm still working on integration for use in the repo.  My draft PR (<a href="https://github.com/openwrt/packages/pull/13916">https://github.com/openwrt/packages/pull/13916</a>) works for Mips64 and should work for mips64el, though I don't have a device to test it on.  As I go further and further along with the draft, I'm filling in toolchain targets.</p>



<a name="226606052"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/bootstrapping%20on%20s390x/mips%20for%20musl/near/226606052" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grommish <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/bootstrapping.20on.20s390x.2Fmips.20for.20musl.html#226606052">(Feb 17 2021 at 02:22)</a>:</h4>
<p>The Rust integration to the OpenWrt build system will take a while, I suspect, at least officially..  I've used the mips64 toolchain to build/run Suricata6 (which requires rust) on my device, so I know at least that part works :)</p>



<a name="226606248"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/bootstrapping%20on%20s390x/mips%20for%20musl/near/226606248" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grommish <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/bootstrapping.20on.20s390x.2Fmips.20for.20musl.html#226606248">(Feb 17 2021 at 02:26)</a>:</h4>
<p>Im hoping interest picks up as rust becomes more mainstream and other packages start to use it  (eg: <a href="https://github.com/pyca/cryptography/issues/5799">https://github.com/pyca/cryptography/issues/5799</a>) which will help with testing.  Being able to get help with rust compiler options will also be a boon.. I am not a programmers, nor have I ever used Rust.  <span class="user-mention" data-user-id="232545">@Joshua Nelson</span> helped me through the initial stuff as much as he could, given he doesn't know the OpenWrt build system</p>



<a name="226607664"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/bootstrapping%20on%20s390x/mips%20for%20musl/near/226607664" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ariadne Conill <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/bootstrapping.20on.20s390x.2Fmips.20for.20musl.html#226607664">(Feb 17 2021 at 02:55)</a>:</h4>
<p>hmm, i notice you have --host and --build the same</p>



<a name="226607668"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/bootstrapping%20on%20s390x/mips%20for%20musl/near/226607668" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ariadne Conill <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/bootstrapping.20on.20s390x.2Fmips.20for.20musl.html#226607668">(Feb 17 2021 at 02:55)</a>:</h4>
<p>maybe i should try that</p>



<a name="226607846"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/bootstrapping%20on%20s390x/mips%20for%20musl/near/226607846" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ariadne Conill <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/bootstrapping.20on.20s390x.2Fmips.20for.20musl.html#226607846">(Feb 17 2021 at 02:59)</a>:</h4>
<p>to clarify: we want to wind up with a rustc that runs on a mips64 or s390x or riscv64 machine</p>



<a name="226608288"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/bootstrapping%20on%20s390x/mips%20for%20musl/near/226608288" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grommish <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/bootstrapping.20on.20s390x.2Fmips.20for.20musl.html#226608288">(Feb 17 2021 at 03:07)</a>:</h4>
<p>That would be up to the Rust devs to move those Archs to at least a tier 1.5 support then.  Currently, I build everything I do on a Ubuntu 20.04 WSL2 environment for use ON a Mips64 device, but it's cross-compiled. However, my rustc/cargo is MIPS64..</p>
<p><code>grommish@DESKTOP-N35LRJ4:~/openwrt/staging_dir/hostpkg/bin$ file rustc
rustc: ELF 64-bit LSB shared object, x86-64, version 1 (SYSV), dynamically linked, interpreter /lib64/ld-linux-x86-64.so.2, BuildID[sha1]=328487cbd30837b4305b2ccc3618e94495ac069e, for GNU/Linux 3.2.0, not stripped</code></p>
<p><code>grommish@DESKTOP-N35LRJ4:~/openwrt/staging_dir/hostpkg/bin$ file cargo
cargo: ELF 64-bit LSB shared object, x86-64, version 1 (SYSV), dynamically linked, interpreter /lib64/ld-linux-x86-64.so.2, BuildID[sha1]=49283db987f1a84804d63250e6843164c09e5b71, for GNU/Linux 3.2.0, not stripped</code></p>



<a name="226608910"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/bootstrapping%20on%20s390x/mips%20for%20musl/near/226608910" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grommish <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/bootstrapping.20on.20s390x.2Fmips.20for.20musl.html#226608910">(Feb 17 2021 at 03:21)</a>:</h4>
<p>Or rather, they know how to cross for Mips64</p>



<a name="226609747"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/bootstrapping%20on%20s390x/mips%20for%20musl/near/226609747" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ariadne Conill <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/bootstrapping.20on.20s390x.2Fmips.20for.20musl.html#226609747">(Feb 17 2021 at 03:39)</a>:</h4>
<p>yeah we need to get rustc/cargo on s390x/mips/riscv64 :)</p>



<a name="226614411"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/bootstrapping%20on%20s390x/mips%20for%20musl/near/226614411" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grommish <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/bootstrapping.20on.20s390x.2Fmips.20for.20musl.html#226614411">(Feb 17 2021 at 05:03)</a>:</h4>
<p>If <span class="user-mention" data-user-id="232545">@Joshua Nelson</span> can direct me, or direct me to someone who can direct me, I have no issues helping get rustc/cargo for mips64.  In the OpenWrt environment, I can build the installation ipk packages to go on the device once they are built</p>



<a name="226614464"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/bootstrapping%20on%20s390x/mips%20for%20musl/near/226614464" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joshua Nelson <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/bootstrapping.20on.20s390x.2Fmips.20for.20musl.html#226614464">(Feb 17 2021 at 05:04)</a>:</h4>
<p>are you asking how to promote mips64 to tier 2 so the components are available from rustup?</p>



<a name="226614470"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/bootstrapping%20on%20s390x/mips%20for%20musl/near/226614470" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joshua Nelson <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/bootstrapping.20on.20s390x.2Fmips.20for.20musl.html#226614470">(Feb 17 2021 at 05:04)</a>:</h4>
<p>you can already cross-compile them yourself</p>



<a name="226615743"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/bootstrapping%20on%20s390x/mips%20for%20musl/near/226615743" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ariadne Conill <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/bootstrapping.20on.20s390x.2Fmips.20for.20musl.html#226615743">(Feb 17 2021 at 05:30)</a>:</h4>
<p>well, that's the problem: for whatever reason, i can't even cross aarch64 anymore on 1.50</p>



<a name="226615751"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/bootstrapping%20on%20s390x/mips%20for%20musl/near/226615751" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ariadne Conill <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/bootstrapping.20on.20s390x.2Fmips.20for.20musl.html#226615751">(Feb 17 2021 at 05:30)</a>:</h4>
<p>this cross compilation procedure seems very fragile, i think we need to work on improving it</p>



<a name="226615763"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/bootstrapping%20on%20s390x/mips%20for%20musl/near/226615763" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joshua Nelson <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/bootstrapping.20on.20s390x.2Fmips.20for.20musl.html#226615763">(Feb 17 2021 at 05:31)</a>:</h4>
<p>understatement of the year lol</p>



<a name="226615837"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/bootstrapping%20on%20s390x/mips%20for%20musl/near/226615837" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ariadne Conill <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/bootstrapping.20on.20s390x.2Fmips.20for.20musl.html#226615837">(Feb 17 2021 at 05:33)</a>:</h4>
<p>well, we are all learning together at least.</p>



<a name="226619657"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/bootstrapping%20on%20s390x/mips%20for%20musl/near/226619657" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> bjorn3 <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/bootstrapping.20on.20s390x.2Fmips.20for.20musl.html#226619657">(Feb 17 2021 at 06:51)</a>:</h4>
<p>(deleted)</p>



<a name="226686737"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/bootstrapping%20on%20s390x/mips%20for%20musl/near/226686737" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grommish <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/bootstrapping.20on.20s390x.2Fmips.20for.20musl.html#226686737">(Feb 17 2021 at 16:47)</a>:</h4>
<p><span class="user-mention" data-user-id="232545">@Joshua Nelson</span> I can create the x86_64-&gt;MIPS64 aware rustc/cargo, yes, but I've yet to create a MIPS64 rustc/cargo binary that can be ran, as a compiler, on a MIPS64 device (at least, that I'm aware of).   I can use my artifacts to compile FOR MIPS64 - from x86_64 - but not _on_ MIPS64, if that makes any sense.  And having rustc/cargo _on_ MIPS64 seems to be <span class="user-mention" data-user-id="360752">@Ariadne Conill</span> goal</p>



<a name="226686828"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/bootstrapping%20on%20s390x/mips%20for%20musl/near/226686828" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joshua Nelson <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/bootstrapping.20on.20s390x.2Fmips.20for.20musl.html#226686828">(Feb 17 2021 at 16:47)</a>:</h4>
<p>have you cross-compiled a rustc that runs natively on MIPS64?</p>



<a name="226686929"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/bootstrapping%20on%20s390x/mips%20for%20musl/near/226686929" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joshua Nelson <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/bootstrapping.20on.20s390x.2Fmips.20for.20musl.html#226686929">(Feb 17 2021 at 16:48)</a>:</h4>
<p>oh wait that's what you said, you haven't</p>



<a name="226686975"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/bootstrapping%20on%20s390x/mips%20for%20musl/near/226686975" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joshua Nelson <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/bootstrapping.20on.20s390x.2Fmips.20for.20musl.html#226686975">(Feb 17 2021 at 16:48)</a>:</h4>
<p>ok yeah that's the next step, I would look how CI does this for tier 2 targets</p>



<a name="226687070"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/bootstrapping%20on%20s390x/mips%20for%20musl/near/226687070" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grommish <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/bootstrapping.20on.20s390x.2Fmips.20for.20musl.html#226687070">(Feb 17 2021 at 16:49)</a>:</h4>
<p>That's the ultimate goal..  I can use my x86_64-&gt;MIPS64 yto create binaries for MIPS64 of things I compile with Rustc, but not rustc itself.. Thanks :) I'll look</p>



<a name="226687471"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/bootstrapping%20on%20s390x/mips%20for%20musl/near/226687471" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nagisa <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/bootstrapping.20on.20s390x.2Fmips.20for.20musl.html#226687471">(Feb 17 2021 at 16:52)</a>:</h4>
<p>did you set <code>build=["mips..."]</code>?</p>



<a name="226687645"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/bootstrapping%20on%20s390x/mips%20for%20musl/near/226687645" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nagisa <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/bootstrapping.20on.20s390x.2Fmips.20for.20musl.html#226687645">(Feb 17 2021 at 16:52)</a>:</h4>
<p>from what you described it sounds like you've only set <code>target</code> rather than <code>build</code>.</p>



<a name="226687909"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/bootstrapping%20on%20s390x/mips%20for%20musl/near/226687909" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grommish <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/bootstrapping.20on.20s390x.2Fmips.20for.20musl.html#226687909">(Feb 17 2021 at 16:54)</a>:</h4>
<p><a href="https://github.com/openwrt/packages/pull/13916/files#diff-000828b821201f172a6a3c1b97c5a89fd38753d46e7b0c11e475b7e61a99a24cR35-R53">https://github.com/openwrt/packages/pull/13916/files#diff-000828b821201f172a6a3c1b97c5a89fd38753d46e7b0c11e475b7e61a99a24cR35-R53</a></p>



<a name="226688036"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/bootstrapping%20on%20s390x/mips%20for%20musl/near/226688036" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grommish <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/bootstrapping.20on.20s390x.2Fmips.20for.20musl.html#226688036">(Feb 17 2021 at 16:55)</a>:</h4>
<p>Those get passed for every target, and extra are added on top if they choose those options</p>



<a name="226688201"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/bootstrapping%20on%20s390x/mips%20for%20musl/near/226688201" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nagisa <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/bootstrapping.20on.20s390x.2Fmips.20for.20musl.html#226688201">(Feb 17 2021 at 16:56)</a>:</h4>
<p>--build=$(RUSTC_HOST_ARCH)</p>



<a name="226688316"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/bootstrapping%20on%20s390x/mips%20for%20musl/near/226688316" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nagisa <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/bootstrapping.20on.20s390x.2Fmips.20for.20musl.html#226688316">(Feb 17 2021 at 16:56)</a>:</h4>
<p>if I'm reading this right that's indeed what's going to be happening, you're building a compiler that runs on $HOST and can target the $TARGET</p>



<a name="226688416"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/bootstrapping%20on%20s390x/mips%20for%20musl/near/226688416" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grommish <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/bootstrapping.20on.20s390x.2Fmips.20for.20musl.html#226688416">(Feb 17 2021 at 16:57)</a>:</h4>
<p>Right.. Which is what I need to do for OpenWrt's Build system, because people don't compile on MIPS64 or ARMv7.. yet :)</p>



<a name="226688453"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/bootstrapping%20on%20s390x/mips%20for%20musl/near/226688453" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nagisa <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/bootstrapping.20on.20s390x.2Fmips.20for.20musl.html#226688453">(Feb 17 2021 at 16:57)</a>:</h4>
<p>I believe you'll want <code>--host=$(RUSTC_HOST_ARCH) --build=$(RUSTC_TARGET_ARCH) --target=$(RUSTC_TARGET_ARCH)</code> if you want to run the resulting compiler on mips/etc.</p>



<a name="226688620"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/bootstrapping%20on%20s390x/mips%20for%20musl/near/226688620" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grommish <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/bootstrapping.20on.20s390x.2Fmips.20for.20musl.html#226688620">(Feb 17 2021 at 16:58)</a>:</h4>
<p>Is there a way to cross-compile Rustc/Cargo to MIPS64 using the existing x86_64-&gt;MIP64 rustc?</p>



<a name="226688662"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/bootstrapping%20on%20s390x/mips%20for%20musl/near/226688662" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grommish <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/bootstrapping.20on.20s390x.2Fmips.20for.20musl.html#226688662">(Feb 17 2021 at 16:58)</a>:</h4>
<p>Do I just build it again?</p>



<a name="226688676"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/bootstrapping%20on%20s390x/mips%20for%20musl/near/226688676" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joshua Nelson <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/bootstrapping.20on.20s390x.2Fmips.20for.20musl.html#226688676">(Feb 17 2021 at 16:58)</a>:</h4>
<p>you can set <code>rustc = /path/to/rustc</code> in config.toml</p>



<a name="226688732"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/bootstrapping%20on%20s390x/mips%20for%20musl/near/226688732" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joshua Nelson <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/bootstrapping.20on.20s390x.2Fmips.20for.20musl.html#226688732">(Feb 17 2021 at 16:59)</a>:</h4>
<p>in a new git worktree</p>



<a name="226688787"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/bootstrapping%20on%20s390x/mips%20for%20musl/near/226688787" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joshua Nelson <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/bootstrapping.20on.20s390x.2Fmips.20for.20musl.html#226688787">(Feb 17 2021 at 16:59)</a>:</h4>
<p><a href="https://rustc-dev-guide.rust-lang.org/building/suggested.html?highlight=worktree#working-on-multiple-branches-at-the-same-time">https://rustc-dev-guide.rust-lang.org/building/suggested.html?highlight=worktree#working-on-multiple-branches-at-the-same-time</a></p>



<a name="226688972"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/bootstrapping%20on%20s390x/mips%20for%20musl/near/226688972" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grommish <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/bootstrapping.20on.20s390x.2Fmips.20for.20musl.html#226688972">(Feb 17 2021 at 17:00)</a>:</h4>
<p>Ok.. So I should run the compile twice.. Once for the cross-enabled chain, and again with that chain to create the target version?  I think I can do that</p>



<a name="226689111"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/bootstrapping%20on%20s390x/mips%20for%20musl/near/226689111" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joshua Nelson <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/bootstrapping.20on.20s390x.2Fmips.20for.20musl.html#226689111">(Feb 17 2021 at 17:01)</a>:</h4>
<p>hmm I feel like x.py should be able to do this automatically</p>



<a name="226689125"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/bootstrapping%20on%20s390x/mips%20for%20musl/near/226689125" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joshua Nelson <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/bootstrapping.20on.20s390x.2Fmips.20for.20musl.html#226689125">(Feb 17 2021 at 17:01)</a>:</h4>
<p>that's kind of the point of 2-stage builds</p>



<a name="226689216"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/bootstrapping%20on%20s390x/mips%20for%20musl/near/226689216" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grommish <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/bootstrapping.20on.20s390x.2Fmips.20for.20musl.html#226689216">(Feb 17 2021 at 17:02)</a>:</h4>
<p>You know I consider x.py scary voodoo magik.. But I'm willing to try :D</p>



<a name="226689379"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/bootstrapping%20on%20s390x/mips%20for%20musl/near/226689379" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grommish <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/bootstrapping.20on.20s390x.2Fmips.20for.20musl.html#226689379">(Feb 17 2021 at 17:02)</a>:</h4>
<p>BTW&gt;.  Getting rid of the full bootstrap saved me about 20 minutes</p>



<a name="226689704"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/bootstrapping%20on%20s390x/mips%20for%20musl/near/226689704" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joshua Nelson <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/bootstrapping.20on.20s390x.2Fmips.20for.20musl.html#226689704">(Feb 17 2021 at 17:04)</a>:</h4>
<p><span class="user-mention silent" data-user-id="332271">Grommish</span> <a href="#narrow/stream/131828-t-compiler/topic/bootstrapping.20on.20s390x.2Fmips.20for.20musl/near/226689216">said</a>:</p>
<blockquote>
<p>You know I consider x.py scary voodoo magik.. But I'm willing to try :D</p>
</blockquote>
<p>I think <span class="user-mention silent" data-user-id="123586">nagisa</span> 's suggestion should work: <code>--host=$(RUSTC_HOST_ARCH) --build=$(RUSTC_TARGET_ARCH) --target=$(RUSTC_TARGET_ARCH) </code></p>



<a name="226690054"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/bootstrapping%20on%20s390x/mips%20for%20musl/near/226690054" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> bjorn3 <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/bootstrapping.20on.20s390x.2Fmips.20for.20musl.html#226690054">(Feb 17 2021 at 17:06)</a>:</h4>
<p><code>--build</code> needs to be the system on which you are bootstrapping as far as I know. <code>--host</code> and <code>--target</code> describe what to build. <code>--host</code> says what target rustc must be built for. <code>--target</code> says what target libstd must be built for.</p>



<a name="226690406"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/bootstrapping%20on%20s390x/mips%20for%20musl/near/226690406" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nagisa <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/bootstrapping.20on.20s390x.2Fmips.20for.20musl.html#226690406">(Feb 17 2021 at 17:08)</a>:</h4>
<p>Ah right, i might very well have mixed the two up.</p>



<a name="226690473"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/bootstrapping%20on%20s390x/mips%20for%20musl/near/226690473" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nagisa <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/bootstrapping.20on.20s390x.2Fmips.20for.20musl.html#226690473">(Feb 17 2021 at 17:09)</a>:</h4>
<p>I never get them right ^^</p>



<a name="226690538"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/bootstrapping%20on%20s390x/mips%20for%20musl/near/226690538" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> simulacrum <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/bootstrapping.20on.20s390x.2Fmips.20for.20musl.html#226690538">(Feb 17 2021 at 17:09)</a>:</h4>
<p><span class="user-mention silent" data-user-id="133247">bjorn3</span> <a href="#narrow/stream/131828-t-compiler/topic/bootstrapping.20on.20s390x.2Fmips.20for.20musl/near/226690054">said</a>:</p>
<blockquote>
<p><code>--build</code> needs to be the system on which you are bootstrapping as far as I know. <code>--host</code> and <code>--target</code> describe what to build. <code>--host</code> says what target rustc must be built for. <code>--target</code> says what target libstd must be built for.</p>
</blockquote>
<p>This is correct :)</p>



<a name="226765891"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/bootstrapping%20on%20s390x/mips%20for%20musl/near/226765891" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grommish <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/bootstrapping.20on.20s390x.2Fmips.20for.20musl.html#226765891">(Feb 18 2021 at 05:09)</a>:</h4>
<p>Do I need to compile for the HOST Build system first, then rebuild for the "Host" Target system?  IE: BUild for the x86_64/MIPS64 before building for Mips64/Mips64?  Also, <span class="user-mention" data-user-id="116122">@simulacrum</span> , If I <code>x.py dist</code> do I need to specify the other segments?  Currently, I'm using <code>RUST_BACKTRACE=full $(PYTHON) x.py --config ./config.toml dist cargo extended library/std llvm-tools miri</code></p>



<a name="226773501"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/bootstrapping%20on%20s390x/mips%20for%20musl/near/226773501" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grommish <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/bootstrapping.20on.20s390x.2Fmips.20for.20musl.html#226773501">(Feb 18 2021 at 07:26)</a>:</h4>
<p>Well.. Building with <code>--host</code> and <code>--target</code> set to the MIPS64 with <code>--build</code> as x86_64 falls on its face with libunwind.</p>
<p><a href="https://gist.github.com/Grommish/f9f7790f1326be8e334586ca12e77dd0">https://gist.github.com/Grommish/f9f7790f1326be8e334586ca12e77dd0</a>  if anyone wants to look.  My apologise to <span class="user-mention" data-user-id="360752">@Ariadne Conill</span> for seemingly hijacking the thread, but since this isn't a supported arch use case, I kinda don't want to start a new thread on it.  (If it's an issue, I will however)</p>



<a name="226774601"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/bootstrapping%20on%20s390x/mips%20for%20musl/near/226774601" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ariadne Conill <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/bootstrapping.20on.20s390x.2Fmips.20for.20musl.html#226774601">(Feb 18 2021 at 07:43)</a>:</h4>
<p>i mean i appreciate your work on this</p>



<a name="226774833"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/bootstrapping%20on%20s390x/mips%20for%20musl/near/226774833" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grommish <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/bootstrapping.20on.20s390x.2Fmips.20for.20musl.html#226774833">(Feb 18 2021 at 07:47)</a>:</h4>
<p>Well, just let me know :) I don't mind and I want to remain respectful :)  We will see if anyone sees anything in the error log they can fix or if it's something different.</p>



<a name="226792519"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/bootstrapping%20on%20s390x/mips%20for%20musl/near/226792519" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> simulacrum <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/bootstrapping.20on.20s390x.2Fmips.20for.20musl.html#226792519">(Feb 18 2021 at 10:44)</a>:</h4>
<p>Not sure what you mean by segments. I don't think there should be any problem with specifying as many hosts or targets as you want (comma separated, IIRC, if on CLI).</p>



<a name="226792762"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/bootstrapping%20on%20s390x/mips%20for%20musl/near/226792762" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> simulacrum <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/bootstrapping.20on.20s390x.2Fmips.20for.20musl.html#226792762">(Feb 18 2021 at 10:46)</a>:</h4>
<p>That error looks sort of external to me, presumably LLVM isn't configured right somehow - you might try playing with system libunwind enabling in config.toml, but IIRC that's for rustc, not the llvm build.</p>



<a name="226794848"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/bootstrapping%20on%20s390x/mips%20for%20musl/near/226794848" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grommish <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/bootstrapping.20on.20s390x.2Fmips.20for.20musl.html#226794848">(Feb 18 2021 at 11:07)</a>:</h4>
<p>Meaning, if I use <code>./x.py dist</code> do I need to specify the <code>cargo extended library/std llvm-tools miri</code> or is it redundant? </p>
<p>That error is when I try to use the mips64 as the host/target and x86 as the build, but if I have host/build as x86 and target as mips64, it builds fine.  Dunno.. Again, i know it's outside the supported archs for rustc/cargo, but wanted to see if I could get a mips64 rustc/cargo binaries. (rather than x86_64 binaries that knows how to cross-compile for mips64)</p>



<a name="226795813"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/bootstrapping%20on%20s390x/mips%20for%20musl/near/226795813" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> simulacrum <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/bootstrapping.20on.20s390x.2Fmips.20for.20musl.html#226795813">(Feb 18 2021 at 11:17)</a>:</h4>
<p>Yes, you do, if you want just those - otherwise you'd get more artifacts :)</p>



<a name="226795885"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/bootstrapping%20on%20s390x/mips%20for%20musl/near/226795885" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> simulacrum <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/bootstrapping.20on.20s390x.2Fmips.20for.20musl.html#226795885">(Feb 18 2021 at 11:18)</a>:</h4>
<p>The error stops happening without a host mips64 because we then don't need to build LLVM for mips64, I imagine</p>



<a name="226795987"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/bootstrapping%20on%20s390x/mips%20for%20musl/near/226795987" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grommish <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/bootstrapping.20on.20s390x.2Fmips.20for.20musl.html#226795987">(Feb 18 2021 at 11:19)</a>:</h4>
<p>Gotcha.. I kinda want everything right now for testing..  Ah, see, my knowledge base when it comes to the code is almost nil, so I'm feeling my way through it</p>



<a name="226905701"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/bootstrapping%20on%20s390x/mips%20for%20musl/near/226905701" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ariadne Conill <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/bootstrapping.20on.20s390x.2Fmips.20for.20musl.html#226905701">(Feb 19 2021 at 00:40)</a>:</h4>
<p>In our case, we have an LLVM for the target already, which we use</p>



<a name="226916342"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/bootstrapping%20on%20s390x/mips%20for%20musl/near/226916342" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grommish <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/bootstrapping.20on.20s390x.2Fmips.20for.20musl.html#226916342">(Feb 19 2021 at 03:31)</a>:</h4>
<p><span class="user-mention silent" data-user-id="360752">Ariadne Conill</span> <a href="#narrow/stream/131828-t-compiler/topic/bootstrapping.20on.20s390x.2Fmips.20for.20musl/near/226905701">said</a>:</p>
<blockquote>
<p>In our case, we have an LLVM for the target already, which we use</p>
</blockquote>
<p><span class="user-mention" data-user-id="360752">@Ariadne Conill</span> I don't do programming..  LLVM is like an assembler?  What else woukd it be called that I might know it as under mips64?</p>



<a name="226916409"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/bootstrapping%20on%20s390x/mips%20for%20musl/near/226916409" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ariadne Conill <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/bootstrapping.20on.20s390x.2Fmips.20for.20musl.html#226916409">(Feb 19 2021 at 03:32)</a>:</h4>
<p>LLVM is a library which consumes IR from rustc and generates assembly / machine object code</p>



<a name="226916543"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/bootstrapping%20on%20s390x/mips%20for%20musl/near/226916543" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grommish <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/bootstrapping.20on.20s390x.2Fmips.20for.20musl.html#226916543">(Feb 19 2021 at 03:34)</a>:</h4>
<p>Ok, but if LLVM doesn't support mips64, we are dead-ended if it won't build without.  The only other option might be a mip64 n32 build to see if mips llvm can be used?</p>



<a name="226916587"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/bootstrapping%20on%20s390x/mips%20for%20musl/near/226916587" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grommish <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/bootstrapping.20on.20s390x.2Fmips.20for.20musl.html#226916587">(Feb 19 2021 at 03:35)</a>:</h4>
<p>Unless you've got something else I can use in it's place?  I can just add the alternate package to the build system and point rust at it</p>



<a name="226916852"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/bootstrapping%20on%20s390x/mips%20for%20musl/near/226916852" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grommish <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/bootstrapping.20on.20s390x.2Fmips.20for.20musl.html#226916852">(Feb 19 2021 at 03:41)</a>:</h4>
<p>Sorry, I know it's frustrating.  I don't ever have to use what gets built, so I don't know about the various pieces.. I just make them work, if possible.  But, I'm persistent, so if there is a way, you are welcome to help me with the info I don't know :)</p>



<a name="226917153"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/bootstrapping%20on%20s390x/mips%20for%20musl/near/226917153" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joshua Nelson <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/bootstrapping.20on.20s390x.2Fmips.20for.20musl.html#226917153">(Feb 19 2021 at 03:47)</a>:</h4>
<p><span class="user-mention silent" data-user-id="332271">Grommish</span> <a href="#narrow/stream/131828-t-compiler/topic/bootstrapping.20on.20s390x.2Fmips.20for.20musl/near/226916543">said</a>:</p>
<blockquote>
<p>Ok, but if LLVM doesn't support mips64, we are dead-ended if it won't build without.  The only other option might be a mip64 n32 build to see if mips llvm can be used?</p>
</blockquote>
<p><span class="user-mention silent" data-user-id="360752">Ariadne Conill</span> said they already have a pre-built llvm, so it shouldn't be an issue</p>



<a name="226917391"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/bootstrapping%20on%20s390x/mips%20for%20musl/near/226917391" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Thom Chiovoloni <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/bootstrapping.20on.20s390x.2Fmips.20for.20musl.html#226917391">(Feb 19 2021 at 03:52)</a>:</h4>
<p>Yeah LLVM definitely supports mips64</p>



<a name="226917483"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/bootstrapping%20on%20s390x/mips%20for%20musl/near/226917483" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grommish <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/bootstrapping.20on.20s390x.2Fmips.20for.20musl.html#226917483">(Feb 19 2021 at 03:54)</a>:</h4>
<p><span class="user-mention" data-user-id="209168">@Thom Chiovoloni</span> Any thoughts on the llvm error above when attempting to builds a mips64 rustc target?  I'm building all the submodules from the repo, so I'm using the llvm included</p>



<a name="226917502"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/bootstrapping%20on%20s390x/mips%20for%20musl/near/226917502" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Thom Chiovoloni <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/bootstrapping.20on.20s390x.2Fmips.20for.20musl.html#226917502">(Feb 19 2021 at 03:55)</a>:</h4>
<p>Sadly no :(</p>



<a name="226917522"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/bootstrapping%20on%20s390x/mips%20for%20musl/near/226917522" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grommish <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/bootstrapping.20on.20s390x.2Fmips.20for.20musl.html#226917522">(Feb 19 2021 at 03:55)</a>:</h4>
<p><span class="user-mention" data-user-id="232545">@Joshua Nelson</span> Ah, ok, unless I can get a copy of it, I'm finished with what I can do.  Woudl that be possibel <span class="user-mention" data-user-id="360752">@Ariadne Conill</span> ?</p>



<a name="226917578"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/bootstrapping%20on%20s390x/mips%20for%20musl/near/226917578" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grommish <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/bootstrapping.20on.20s390x.2Fmips.20for.20musl.html#226917578">(Feb 19 2021 at 03:56)</a>:</h4>
<p>If not, i can just update the repo to patch for the s390x-musl target in case you want to fork it and continue locally</p>



<a name="226917581"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/bootstrapping%20on%20s390x/mips%20for%20musl/near/226917581" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ariadne Conill <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/bootstrapping.20on.20s390x.2Fmips.20for.20musl.html#226917581">(Feb 19 2021 at 03:56)</a>:</h4>
<p>you can probably just download the llvm mips64 packages from alpine and use those inside your sysroot</p>



<a name="226917741"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/bootstrapping%20on%20s390x/mips%20for%20musl/near/226917741" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grommish <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/bootstrapping.20on.20s390x.2Fmips.20for.20musl.html#226917741">(Feb 19 2021 at 04:00)</a>:</h4>
<p><a href="https://pkgs.alpinelinux.org/packages?name=llvm*&amp;branch=edge&amp;arch=mips64">https://pkgs.alpinelinux.org/packages?name=llvm*&amp;branch=edge&amp;arch=mips64</a> ?  These?</p>



<a name="226920343"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/bootstrapping%20on%20s390x/mips%20for%20musl/near/226920343" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ariadne Conill <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/bootstrapping.20on.20s390x.2Fmips.20for.20musl.html#226920343">(Feb 19 2021 at 04:50)</a>:</h4>
<p>yeah</p>



<a name="226958238"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/bootstrapping%20on%20s390x/mips%20for%20musl/near/226958238" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ariadne Conill <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/bootstrapping.20on.20s390x.2Fmips.20for.20musl.html#226958238">(Feb 19 2021 at 12:46)</a>:</h4>
<p>so, i'm not sure how to proceed.  would it be helpful if i set up an alpine dev environment with cross-toolchain that people can SSH into and play with?</p>



<a name="227039592"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/bootstrapping%20on%20s390x/mips%20for%20musl/near/227039592" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grommish <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/bootstrapping.20on.20s390x.2Fmips.20for.20musl.html#227039592">(Feb 19 2021 at 22:27)</a>:</h4>
<p>Since that llvm is already in mips64, i can't use it to build with.. so, I'll look at a qemu system to try</p>



<a name="227039670"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/bootstrapping%20on%20s390x/mips%20for%20musl/near/227039670" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grommish <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/bootstrapping.20on.20s390x.2Fmips.20for.20musl.html#227039670">(Feb 19 2021 at 22:27)</a>:</h4>
<p>In which case I'll be using Win10 WSL2 to Ubunto 20.04 to QEMU Mips Malta to build.. oh boy, what could go wrong</p>



<a name="227039808"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/bootstrapping%20on%20s390x/mips%20for%20musl/near/227039808" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grommish <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/bootstrapping.20on.20s390x.2Fmips.20for.20musl.html#227039808">(Feb 19 2021 at 22:29)</a>:</h4>
<p>and I'll tryh to get the octeon stretch working instead of malta, but I want to see what success looks like</p>



<a name="227276836"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/bootstrapping%20on%20s390x/mips%20for%20musl/near/227276836" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ariadne Conill <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/bootstrapping.20on.20s390x.2Fmips.20for.20musl.html#227276836">(Feb 22 2021 at 14:46)</a>:</h4>
<p>i'm still confused as to why rust 1.50  broke cross compiling period.  i can't cross compile between known good targets anymore, which i was able to do with 1.47</p>



<a name="227276887"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/bootstrapping%20on%20s390x/mips%20for%20musl/near/227276887" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ariadne Conill <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/bootstrapping.20on.20s390x.2Fmips.20for.20musl.html#227276887">(Feb 22 2021 at 14:47)</a>:</h4>
<p>i think that we're going to need to attack that somehow, before we can continue bootstrap process</p>



<a name="227294301"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/bootstrapping%20on%20s390x/mips%20for%20musl/near/227294301" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ariadne Conill <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/bootstrapping.20on.20s390x.2Fmips.20for.20musl.html#227294301">(Feb 22 2021 at 16:25)</a>:</h4>
<p>hooray, now curl is going rust.  guess that means this is now even more urgent.</p>



<a name="227294346"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/bootstrapping%20on%20s390x/mips%20for%20musl/near/227294346" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joshua Nelson <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/bootstrapping.20on.20s390x.2Fmips.20for.20musl.html#227294346">(Feb 22 2021 at 16:25)</a>:</h4>
<p>I thought curl just had an optional rust backend?</p>



<a name="227294509"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/bootstrapping%20on%20s390x/mips%20for%20musl/near/227294509" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Léo Lanteri Thauvin <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/bootstrapping.20on.20s390x.2Fmips.20for.20musl.html#227294509">(Feb 22 2021 at 16:26)</a>:</h4>
<p>It now supports rustls as a TLS backend IIRC</p>



<a name="227294584"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/bootstrapping%20on%20s390x/mips%20for%20musl/near/227294584" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Alex Gaynor <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/bootstrapping.20on.20s390x.2Fmips.20for.20musl.html#227294584">(Feb 22 2021 at 16:27)</a>:</h4>
<p>It also gaining support for hyper as an H1 and H2 implementation.</p>



<a name="227295224"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/bootstrapping%20on%20s390x/mips%20for%20musl/near/227295224" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ariadne Conill <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/bootstrapping.20on.20s390x.2Fmips.20for.20musl.html#227295224">(Feb 22 2021 at 16:30)</a>:</h4>
<p>yes, and <code>curl</code> is now restricted in alpine, because we can't enable those</p>



<a name="227295261"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/bootstrapping%20on%20s390x/mips%20for%20musl/near/227295261" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ariadne Conill <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/bootstrapping.20on.20s390x.2Fmips.20for.20musl.html#227295261">(Feb 22 2021 at 16:31)</a>:</h4>
<p>because i have been toiling in the rustc cross-compilation mines with no success for the past month</p>



<a name="227295339"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/bootstrapping%20on%20s390x/mips%20for%20musl/near/227295339" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ariadne Conill <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/bootstrapping.20on.20s390x.2Fmips.20for.20musl.html#227295339">(Feb 22 2021 at 16:31)</a>:</h4>
<p>this has been failure, after failure, and i don't know what to do</p>



<a name="227295442"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/bootstrapping%20on%20s390x/mips%20for%20musl/near/227295442" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ariadne Conill <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/bootstrapping.20on.20s390x.2Fmips.20for.20musl.html#227295442">(Feb 22 2021 at 16:32)</a>:</h4>
<p>i had working cross compilation (to known-good targets) with 1.47 and <code>x.py dist</code>, but 1.50 is broken again</p>



<a name="227295498"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/bootstrapping%20on%20s390x/mips%20for%20musl/near/227295498" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ariadne Conill <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/bootstrapping.20on.20s390x.2Fmips.20for.20musl.html#227295498">(Feb 22 2021 at 16:32)</a>:</h4>
<p>i am so very tired</p>



<a name="227295616"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/bootstrapping%20on%20s390x/mips%20for%20musl/near/227295616" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ariadne Conill <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/bootstrapping.20on.20s390x.2Fmips.20for.20musl.html#227295616">(Feb 22 2021 at 16:33)</a>:</h4>
<p>i do not think mgorny's behavior towards the python-cryptography team was acceptable, but i can understand it.</p>



<a name="227295734"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/bootstrapping%20on%20s390x/mips%20for%20musl/near/227295734" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ariadne Conill <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/bootstrapping.20on.20s390x.2Fmips.20for.20musl.html#227295734">(Feb 22 2021 at 16:34)</a>:</h4>
<p>making rust work on these missing archs has driven my imposter syndrome to new highs i did not even know existed</p>



<a name="227295800"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/bootstrapping%20on%20s390x/mips%20for%20musl/near/227295800" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ariadne Conill <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/bootstrapping.20on.20s390x.2Fmips.20for.20musl.html#227295800">(Feb 22 2021 at 16:34)</a>:</h4>
<p>this task has literally caused mental health issues for me</p>



<a name="227295808"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/bootstrapping%20on%20s390x/mips%20for%20musl/near/227295808" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joshua Nelson <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/bootstrapping.20on.20s390x.2Fmips.20for.20musl.html#227295808">(Feb 22 2021 at 16:34)</a>:</h4>
<p><span class="user-mention silent" data-user-id="360752">Ariadne Conill</span> <a href="#narrow/stream/131828-t-compiler/topic/bootstrapping.20on.20s390x.2Fmips.20for.20musl/near/227295734">said</a>:</p>
<blockquote>
<p>making rust work on these missing archs has driven my imposter syndrome to new highs i did not even know existed</p>
</blockquote>
<p>if it makes you feel better, every one I've talked to has had trouble cross-compiling :/</p>



<a name="227295825"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/bootstrapping%20on%20s390x/mips%20for%20musl/near/227295825" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joshua Nelson <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/bootstrapping.20on.20s390x.2Fmips.20for.20musl.html#227295825">(Feb 22 2021 at 16:34)</a>:</h4>
<p>@infinity0 on github might have suggestions</p>



<a name="227295859"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/bootstrapping%20on%20s390x/mips%20for%20musl/near/227295859" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joshua Nelson <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/bootstrapping.20on.20s390x.2Fmips.20for.20musl.html#227295859">(Feb 22 2021 at 16:35)</a>:</h4>
<p><span class="user-mention silent" data-user-id="360752">Ariadne Conill</span> <a href="#narrow/stream/131828-t-compiler/topic/bootstrapping.20on.20s390x.2Fmips.20for.20musl/near/227295800">said</a>:</p>
<blockquote>
<p>this task has literally caused mental health issues for me</p>
</blockquote>
<p>have you considered taking a break?</p>



<a name="227296008"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/bootstrapping%20on%20s390x/mips%20for%20musl/near/227296008" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ariadne Conill <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/bootstrapping.20on.20s390x.2Fmips.20for.20musl.html#227296008">(Feb 22 2021 at 16:36)</a>:</h4>
<p>i don't need to take a break, i did that this weekend.  what i need is to figure out a solution.</p>



<a name="227296063"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/bootstrapping%20on%20s390x/mips%20for%20musl/near/227296063" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ariadne Conill <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/bootstrapping.20on.20s390x.2Fmips.20for.20musl.html#227296063">(Feb 22 2021 at 16:36)</a>:</h4>
<p>at this point, this is going to bug me until we have a win.</p>



<a name="227296217"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/bootstrapping%20on%20s390x/mips%20for%20musl/near/227296217" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joshua Nelson <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/bootstrapping.20on.20s390x.2Fmips.20for.20musl.html#227296217">(Feb 22 2021 at 16:37)</a>:</h4>
<p><span class="user-mention silent" data-user-id="360752">Ariadne Conill</span> <a href="#narrow/stream/131828-t-compiler/topic/bootstrapping.20on.20s390x.2Fmips.20for.20musl/near/226494395">said</a>:</p>
<blockquote>
<p>say std and other crates are not present</p>
</blockquote>
<p>can you post that full error?</p>



<a name="227298013"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/bootstrapping%20on%20s390x/mips%20for%20musl/near/227298013" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ariadne Conill <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/bootstrapping.20on.20s390x.2Fmips.20for.20musl.html#227298013">(Feb 22 2021 at 16:49)</a>:</h4>
<p>let me see what i can come up with, i think we can do an incremental build</p>



<a name="227298110"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/bootstrapping%20on%20s390x/mips%20for%20musl/near/227298110" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joshua Nelson <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/bootstrapping.20on.20s390x.2Fmips.20for.20musl.html#227298110">(Feb 22 2021 at 16:49)</a>:</h4>
<p>incremental should speed this up a lot, yeah</p>



<a name="227298565"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/bootstrapping%20on%20s390x/mips%20for%20musl/near/227298565" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ariadne Conill <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/bootstrapping.20on.20s390x.2Fmips.20for.20musl.html#227298565">(Feb 22 2021 at 16:52)</a>:</h4>
<p>i still have the artifacts from an aarch64 cross attempt (which was working in 1.47)</p>



<a name="227298723"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/bootstrapping%20on%20s390x/mips%20for%20musl/near/227298723" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joshua Nelson <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/bootstrapping.20on.20s390x.2Fmips.20for.20musl.html#227298723">(Feb 22 2021 at 16:53)</a>:</h4>
<p>well, if you have incremental artifacts from 1.47 they won't be usable with a 1.50 toolchain</p>



<a name="227298768"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/bootstrapping%20on%20s390x/mips%20for%20musl/near/227298768" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ariadne Conill <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/bootstrapping.20on.20s390x.2Fmips.20for.20musl.html#227298768">(Feb 22 2021 at 16:53)</a>:</h4>
<p>what i mean is, x86_64 -&gt; aarch64 broke again in 1.50, the artifacts are from 1.50</p>



<a name="227298861"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/bootstrapping%20on%20s390x/mips%20for%20musl/near/227298861" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joshua Nelson <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/bootstrapping.20on.20s390x.2Fmips.20for.20musl.html#227298861">(Feb 22 2021 at 16:54)</a>:</h4>
<p>it might be useful to get 1.47 working first, since it sounds like there was a regression in bootstrap</p>



<a name="227298918"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/bootstrapping%20on%20s390x/mips%20for%20musl/near/227298918" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ariadne Conill <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/bootstrapping.20on.20s390x.2Fmips.20for.20musl.html#227298918">(Feb 22 2021 at 16:54)</a>:</h4>
<p>i can't</p>



<a name="227298938"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/bootstrapping%20on%20s390x/mips%20for%20musl/near/227298938" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ariadne Conill <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/bootstrapping.20on.20s390x.2Fmips.20for.20musl.html#227298938">(Feb 22 2021 at 16:54)</a>:</h4>
<p>that would involve downgrading rust to 1.47</p>



<a name="227298951"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/bootstrapping%20on%20s390x/mips%20for%20musl/near/227298951" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joshua Nelson <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/bootstrapping.20on.20s390x.2Fmips.20for.20musl.html#227298951">(Feb 22 2021 at 16:54)</a>:</h4>
<p>ah well fair enough</p>



<a name="227299027"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/bootstrapping%20on%20s390x/mips%20for%20musl/near/227299027" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ariadne Conill <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/bootstrapping.20on.20s390x.2Fmips.20for.20musl.html#227299027">(Feb 22 2021 at 16:55)</a>:</h4>
<p>and that does us nothing useful anyway, because s390x-musl and riscv64-musl are missing things there</p>



<a name="227299289"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/bootstrapping%20on%20s390x/mips%20for%20musl/near/227299289" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ariadne Conill <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/bootstrapping.20on.20s390x.2Fmips.20for.20musl.html#227299289">(Feb 22 2021 at 16:56)</a>:</h4>
<p>ok, i had to blast away the artifacts because they were broken</p>



<a name="227299325"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/bootstrapping%20on%20s390x/mips%20for%20musl/near/227299325" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ariadne Conill <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/bootstrapping.20on.20s390x.2Fmips.20for.20musl.html#227299325">(Feb 22 2021 at 16:56)</a>:</h4>
<p>see you in 45 min</p>



<a name="227299411"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/bootstrapping%20on%20s390x/mips%20for%20musl/near/227299411" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joshua Nelson <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/bootstrapping.20on.20s390x.2Fmips.20for.20musl.html#227299411">(Feb 22 2021 at 16:57)</a>:</h4>
<p>fwiw the bootstrap times went down like 20% last week, if you rebase you'd get faster compiles</p>



<a name="227299436"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/bootstrapping%20on%20s390x/mips%20for%20musl/near/227299436" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joshua Nelson <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/bootstrapping.20on.20s390x.2Fmips.20for.20musl.html#227299436">(Feb 22 2021 at 16:57)</a>:</h4>
<p><a href="#narrow/stream/247081-t-compiler.2Fperformance/topic/bootstrap.20times.20went.20down.2020.25.20percent.20on.20Feb.2020">https://rust-lang.zulipchat.com/#narrow/stream/247081-t-compiler.2Fperformance/topic/bootstrap.20times.20went.20down.2020.25.20percent.20on.20Feb.2020</a></p>



<a name="227299595"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/bootstrapping%20on%20s390x/mips%20for%20musl/near/227299595" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nagisa <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/bootstrapping.20on.20s390x.2Fmips.20for.20musl.html#227299595">(Feb 22 2021 at 16:58)</a>:</h4>
<p>That's going to give a nightly, not 1.50, sadly.</p>



<a name="227299639"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/bootstrapping%20on%20s390x/mips%20for%20musl/near/227299639" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joshua Nelson <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/bootstrapping.20on.20s390x.2Fmips.20for.20musl.html#227299639">(Feb 22 2021 at 16:58)</a>:</h4>
<p>oh right, I forgot this is for a distro</p>



<a name="227299706"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/bootstrapping%20on%20s390x/mips%20for%20musl/near/227299706" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ariadne Conill <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/bootstrapping.20on.20s390x.2Fmips.20for.20musl.html#227299706">(Feb 22 2021 at 16:59)</a>:</h4>
<p>i look forward to that feature in 1.51</p>



<a name="227299726"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/bootstrapping%20on%20s390x/mips%20for%20musl/near/227299726" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joshua Nelson <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/bootstrapping.20on.20s390x.2Fmips.20for.20musl.html#227299726">(Feb 22 2021 at 16:59)</a>:</h4>
<p>it will be in 1.52</p>



<a name="227299739"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/bootstrapping%20on%20s390x/mips%20for%20musl/near/227299739" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joshua Nelson <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/bootstrapping.20on.20s390x.2Fmips.20for.20musl.html#227299739">(Feb 22 2021 at 16:59)</a>:</h4>
<p>1.51 is currently in beta</p>



<a name="227299756"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/bootstrapping%20on%20s390x/mips%20for%20musl/near/227299756" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ariadne Conill <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/bootstrapping.20on.20s390x.2Fmips.20for.20musl.html#227299756">(Feb 22 2021 at 16:59)</a>:</h4>
<p>oh, ok</p>



<a name="227299781"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/bootstrapping%20on%20s390x/mips%20for%20musl/near/227299781" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ariadne Conill <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/bootstrapping.20on.20s390x.2Fmips.20for.20musl.html#227299781">(Feb 22 2021 at 16:59)</a>:</h4>
<p>well 1.52 will likely be out before alpine 3.14 is cut</p>



<a name="227299788"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/bootstrapping%20on%20s390x/mips%20for%20musl/near/227299788" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joshua Nelson <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/bootstrapping.20on.20s390x.2Fmips.20for.20musl.html#227299788">(Feb 22 2021 at 16:59)</a>:</h4>
<p><a href="https://forge.rust-lang.org/#current-release-versions">https://forge.rust-lang.org/#current-release-versions</a></p>



<a name="227300109"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/bootstrapping%20on%20s390x/mips%20for%20musl/near/227300109" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ariadne Conill <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/bootstrapping.20on.20s390x.2Fmips.20for.20musl.html#227300109">(Feb 22 2021 at 17:01)</a>:</h4>
<p>i figure the s390x/riscv64 libc/std crate work will be in 1.52</p>



<a name="227300150"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/bootstrapping%20on%20s390x/mips%20for%20musl/near/227300150" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ariadne Conill <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/bootstrapping.20on.20s390x.2Fmips.20for.20musl.html#227300150">(Feb 22 2021 at 17:01)</a>:</h4>
<p>immediate goal is mips64 since everything should theoretically be there for that</p>



<a name="227300199"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/bootstrapping%20on%20s390x/mips%20for%20musl/near/227300199" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ariadne Conill <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/bootstrapping.20on.20s390x.2Fmips.20for.20musl.html#227300199">(Feb 22 2021 at 17:01)</a>:</h4>
<p>but before even that, aarch64 is the goal, since we know we can do that one (we did it in 1.47)</p>



<a name="227300248"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/bootstrapping%20on%20s390x/mips%20for%20musl/near/227300248" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joshua Nelson <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/bootstrapping.20on.20s390x.2Fmips.20for.20musl.html#227300248">(Feb 22 2021 at 17:01)</a>:</h4>
<p><span class="user-mention silent" data-user-id="360752">Ariadne Conill</span> <a href="#narrow/stream/131828-t-compiler/topic/bootstrapping.20on.20s390x.2Fmips.20for.20musl/near/227300199">said</a>:</p>
<blockquote>
<p>but before even that, aarch64 is the goal, since we know we can do that one (we did it in 1.47)</p>
</blockquote>
<p>CI builds for aarch64 I think</p>



<a name="227300265"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/bootstrapping%20on%20s390x/mips%20for%20musl/near/227300265" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joshua Nelson <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/bootstrapping.20on.20s390x.2Fmips.20for.20musl.html#227300265">(Feb 22 2021 at 17:01)</a>:</h4>
<p>you should be able to just copy what it does</p>



<a name="227300377"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/bootstrapping%20on%20s390x/mips%20for%20musl/near/227300377" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ariadne Conill <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/bootstrapping.20on.20s390x.2Fmips.20for.20musl.html#227300377">(Feb 22 2021 at 17:02)</a>:</h4>
<p>to be clear: we have rust working fine on aarch64</p>



<a name="227300398"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/bootstrapping%20on%20s390x/mips%20for%20musl/near/227300398" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ariadne Conill <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/bootstrapping.20on.20s390x.2Fmips.20for.20musl.html#227300398">(Feb 22 2021 at 17:02)</a>:</h4>
<p>this is just to make sure the cross is working</p>



<a name="227300428"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/bootstrapping%20on%20s390x/mips%20for%20musl/near/227300428" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joshua Nelson <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/bootstrapping.20on.20s390x.2Fmips.20for.20musl.html#227300428">(Feb 22 2021 at 17:02)</a>:</h4>
<p>right, CI also cross compiles</p>



<a name="227300452"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/bootstrapping%20on%20s390x/mips%20for%20musl/near/227300452" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joshua Nelson <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/bootstrapping.20on.20s390x.2Fmips.20for.20musl.html#227300452">(Feb 22 2021 at 17:02)</a>:</h4>
<p>we don't have any aarch64 hosts AFAIK</p>



<a name="227300462"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/bootstrapping%20on%20s390x/mips%20for%20musl/near/227300462" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ariadne Conill <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/bootstrapping.20on.20s390x.2Fmips.20for.20musl.html#227300462">(Feb 22 2021 at 17:02)</a>:</h4>
<p>do you want one?</p>



<a name="227300480"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/bootstrapping%20on%20s390x/mips%20for%20musl/near/227300480" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joshua Nelson <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/bootstrapping.20on.20s390x.2Fmips.20for.20musl.html#227300480">(Feb 22 2021 at 17:03)</a>:</h4>
<p>heh, that's a question for <a class="stream" data-stream-id="242791" href="/#narrow/stream/242791-t-infra">#t-infra</a></p>



<a name="227300547"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/bootstrapping%20on%20s390x/mips%20for%20musl/near/227300547" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ariadne Conill <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/bootstrapping.20on.20s390x.2Fmips.20for.20musl.html#227300547">(Feb 22 2021 at 17:03)</a>:</h4>
<p>let me put it this way, i'll make it rain infra if it makes my life easier</p>



<a name="227300605"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/bootstrapping%20on%20s390x/mips%20for%20musl/near/227300605" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joshua Nelson <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/bootstrapping.20on.20s390x.2Fmips.20for.20musl.html#227300605">(Feb 22 2021 at 17:03)</a>:</h4>
<p><span class="user-mention" data-user-id="116122">@simulacrum</span> is that something t-infra is interested in? having native aarch64 hosts for CI?</p>



<a name="227300722"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/bootstrapping%20on%20s390x/mips%20for%20musl/near/227300722" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Alex Gaynor <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/bootstrapping.20on.20s390x.2Fmips.20for.20musl.html#227300722">(Feb 22 2021 at 17:04)</a>:</h4>
<p>FWIW there is an aarch64 host that runs tests, donated by some vendor. It was a requirement for aarch64-linux-glibc going tier 1.</p>



<a name="227300756"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/bootstrapping%20on%20s390x/mips%20for%20musl/near/227300756" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> simulacrum <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/bootstrapping.20on.20s390x.2Fmips.20for.20musl.html#227300756">(Feb 22 2021 at 17:04)</a>:</h4>
<p>Yeah, I think we do have at least one.</p>



<a name="227300770"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/bootstrapping%20on%20s390x/mips%20for%20musl/near/227300770" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ariadne Conill <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/bootstrapping.20on.20s390x.2Fmips.20for.20musl.html#227300770">(Feb 22 2021 at 17:04)</a>:</h4>
<p>i want to make dynamicly linked musl tier 1</p>



<a name="227300791"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/bootstrapping%20on%20s390x/mips%20for%20musl/near/227300791" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joshua Nelson <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/bootstrapping.20on.20s390x.2Fmips.20for.20musl.html#227300791">(Feb 22 2021 at 17:04)</a>:</h4>
<p>oh right, it was aarch64-darwin that we couldn't find hosts for</p>



<a name="227300797"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/bootstrapping%20on%20s390x/mips%20for%20musl/near/227300797" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ariadne Conill <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/bootstrapping.20on.20s390x.2Fmips.20for.20musl.html#227300797">(Feb 22 2021 at 17:05)</a>:</h4>
<p>because then my life is really easy</p>



<a name="227300828"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/bootstrapping%20on%20s390x/mips%20for%20musl/near/227300828" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joshua Nelson <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/bootstrapping.20on.20s390x.2Fmips.20for.20musl.html#227300828">(Feb 22 2021 at 17:05)</a>:</h4>
<p>because all they had was M1 laptops <span aria-label="joy" class="emoji emoji-1f602" role="img" title="joy">:joy:</span></p>



<a name="227300848"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/bootstrapping%20on%20s390x/mips%20for%20musl/near/227300848" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ariadne Conill <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/bootstrapping.20on.20s390x.2Fmips.20for.20musl.html#227300848">(Feb 22 2021 at 17:05)</a>:</h4>
<p>oh, i cannot help you there.</p>



<a name="227300903"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/bootstrapping%20on%20s390x/mips%20for%20musl/near/227300903" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> simulacrum <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/bootstrapping.20on.20s390x.2Fmips.20for.20musl.html#227300903">(Feb 22 2021 at 17:05)</a>:</h4>
<p>It should be possible to make it tier 1 in the long run, I imagine, but I also think tier 2 would likely meet most of your needs :)</p>



<a name="227300913"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/bootstrapping%20on%20s390x/mips%20for%20musl/near/227300913" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ariadne Conill <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/bootstrapping.20on.20s390x.2Fmips.20for.20musl.html#227300913">(Feb 22 2021 at 17:05)</a>:</h4>
<p>the only aarch64 machines i have are thunderx2 and honeycomb boards</p>



<a name="227301086"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/bootstrapping%20on%20s390x/mips%20for%20musl/near/227301086" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ariadne Conill <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/bootstrapping.20on.20s390x.2Fmips.20for.20musl.html#227301086">(Feb 22 2021 at 17:06)</a>:</h4>
<p>i think today i will submit the riscv64 musl target, and perhaps begin work on a set of dynamic musl targets (<code>-dynmusl</code> seems to be the preferred name)</p>



<a name="227301220"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/bootstrapping%20on%20s390x/mips%20for%20musl/near/227301220" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ariadne Conill <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/bootstrapping.20on.20s390x.2Fmips.20for.20musl.html#227301220">(Feb 22 2021 at 17:07)</a>:</h4>
<p>just getting dynmusl done in 1.52 would make life a lot easier</p>



<a name="227301269"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/bootstrapping%20on%20s390x/mips%20for%20musl/near/227301269" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ariadne Conill <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/bootstrapping.20on.20s390x.2Fmips.20for.20musl.html#227301269">(Feb 22 2021 at 17:07)</a>:</h4>
<p>that would basically take our patch count down to zero</p>



<a name="227302365"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/bootstrapping%20on%20s390x/mips%20for%20musl/near/227302365" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ariadne Conill <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/bootstrapping.20on.20s390x.2Fmips.20for.20musl.html#227302365">(Feb 22 2021 at 17:14)</a>:</h4>
<p>hmmph, that s390x target still hasn't been merged</p>



<a name="227302622"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/bootstrapping%20on%20s390x/mips%20for%20musl/near/227302622" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joshua Nelson <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/bootstrapping.20on.20s390x.2Fmips.20for.20musl.html#227302622">(Feb 22 2021 at 17:15)</a>:</h4>
<p>yeah bors has been behind the last week or so</p>



<a name="227302998"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/bootstrapping%20on%20s390x/mips%20for%20musl/near/227302998" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ariadne Conill <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/bootstrapping.20on.20s390x.2Fmips.20for.20musl.html#227302998">(Feb 22 2021 at 17:17)</a>:</h4>
<p>oh, there is a riscv64gc-unknown-linux-musl target now</p>



<a name="227303020"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/bootstrapping%20on%20s390x/mips%20for%20musl/near/227303020" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ariadne Conill <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/bootstrapping.20on.20s390x.2Fmips.20for.20musl.html#227303020">(Feb 22 2021 at 17:17)</a>:</h4>
<p>cool, work i don't have to do :)</p>



<a name="227303365"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/bootstrapping%20on%20s390x/mips%20for%20musl/near/227303365" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nagisa <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/bootstrapping.20on.20s390x.2Fmips.20for.20musl.html#227303365">(Feb 22 2021 at 17:19)</a>:</h4>
<p>The queue is <a href="https://bors.rust-lang.org/queue/rust">pretty long</a>, yeah.</p>



<a name="227303493"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/bootstrapping%20on%20s390x/mips%20for%20musl/near/227303493" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ariadne Conill <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/bootstrapping.20on.20s390x.2Fmips.20for.20musl.html#227303493">(Feb 22 2021 at 17:20)</a>:</h4>
<p>going to try to get some more alpine devs in here</p>



<a name="227303644"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/bootstrapping%20on%20s390x/mips%20for%20musl/near/227303644" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ariadne Conill <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/bootstrapping.20on.20s390x.2Fmips.20for.20musl.html#227303644">(Feb 22 2021 at 17:20)</a>:</h4>
<p>Building stage1 std artifacts (x86_64-alpine-linux-musl -&gt; aarch64-alpine-linux-musl)</p>



<a name="227303661"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/bootstrapping%20on%20s390x/mips%20for%20musl/near/227303661" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ariadne Conill <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/bootstrapping.20on.20s390x.2Fmips.20for.20musl.html#227303661">(Feb 22 2021 at 17:20)</a>:</h4>
<p>ok it should explode momentarily</p>



<a name="227304427"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/bootstrapping%20on%20s390x/mips%20for%20musl/near/227304427" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ariadne Conill <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/bootstrapping.20on.20s390x.2Fmips.20for.20musl.html#227304427">(Feb 22 2021 at 17:25)</a>:</h4>
<p>redoing this as an incremental build</p>



<a name="227305461"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/bootstrapping%20on%20s390x/mips%20for%20musl/near/227305461" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ariadne Conill <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/bootstrapping.20on.20s390x.2Fmips.20for.20musl.html#227305461">(Feb 22 2021 at 17:32)</a>:</h4>
<p>ok, i've been fighting a fuckup of my own doing</p>



<a name="227305776"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/bootstrapping%20on%20s390x/mips%20for%20musl/near/227305776" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ariadne Conill <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/bootstrapping.20on.20s390x.2Fmips.20for.20musl.html#227305776">(Feb 22 2021 at 17:34)</a>:</h4>
<p>i was using the wrong <code>$EXTRADEPENDS</code> env vars so the cross env was not properly set up</p>



<a name="227305822"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/bootstrapping%20on%20s390x/mips%20for%20musl/near/227305822" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ariadne Conill <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/bootstrapping.20on.20s390x.2Fmips.20for.20musl.html#227305822">(Feb 22 2021 at 17:34)</a>:</h4>
<p>(that's an alpine thing)</p>



<a name="227308910"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/bootstrapping%20on%20s390x/mips%20for%20musl/near/227308910" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ariadne Conill <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/bootstrapping.20on.20s390x.2Fmips.20for.20musl.html#227308910">(Feb 22 2021 at 17:53)</a>:</h4>
<p>ok, it appears aarch64 cross might actually work after all.  fingers crossed.</p>



<a name="227308945"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/bootstrapping%20on%20s390x/mips%20for%20musl/near/227308945" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ariadne Conill <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/bootstrapping.20on.20s390x.2Fmips.20for.20musl.html#227308945">(Feb 22 2021 at 17:53)</a>:</h4>
<p>if so, then i will try again with mips64</p>



<a name="227308997"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/bootstrapping%20on%20s390x/mips%20for%20musl/near/227308997" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ariadne Conill <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/bootstrapping.20on.20s390x.2Fmips.20for.20musl.html#227308997">(Feb 22 2021 at 17:53)</a>:</h4>
<p>that means the next objective would be the <code>dynmusl</code> targets, so we can drop our patches</p>



<a name="227309521"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/bootstrapping%20on%20s390x/mips%20for%20musl/near/227309521" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ariadne Conill <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/bootstrapping.20on.20s390x.2Fmips.20for.20musl.html#227309521">(Feb 22 2021 at 17:57)</a>:</h4>
<p>ok, aarch64 cross has gotten to <code>rustdoc</code></p>



<a name="227309567"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/bootstrapping%20on%20s390x/mips%20for%20musl/near/227309567" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ariadne Conill <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/bootstrapping.20on.20s390x.2Fmips.20for.20musl.html#227309567">(Feb 22 2021 at 17:57)</a>:</h4>
<p>i think its gonna work</p>



<a name="227309785"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/bootstrapping%20on%20s390x/mips%20for%20musl/near/227309785" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joshua Nelson <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/bootstrapping.20on.20s390x.2Fmips.20for.20musl.html#227309785">(Feb 22 2021 at 17:58)</a>:</h4>
<p>Congrats!</p>



<a name="227310770"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/bootstrapping%20on%20s390x/mips%20for%20musl/near/227310770" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ariadne Conill <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/bootstrapping.20on.20s390x.2Fmips.20for.20musl.html#227310770">(Feb 22 2021 at 18:04)</a>:</h4>
<p>Dist rustc-dev-1.50.0-aarch64-alpine-linux-musl</p>



<a name="227310790"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/bootstrapping%20on%20s390x/mips%20for%20musl/near/227310790" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ariadne Conill <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/bootstrapping.20on.20s390x.2Fmips.20for.20musl.html#227310790">(Feb 22 2021 at 18:04)</a>:</h4>
<p>ok, it's going to work</p>



<a name="227311311"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/bootstrapping%20on%20s390x/mips%20for%20musl/near/227311311" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ariadne Conill <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/bootstrapping.20on.20s390x.2Fmips.20for.20musl.html#227311311">(Feb 22 2021 at 18:08)</a>:</h4>
<p>now its building <code>cargo</code></p>



<a name="227311346"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/bootstrapping%20on%20s390x/mips%20for%20musl/near/227311346" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jubilee <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/bootstrapping.20on.20s390x.2Fmips.20for.20musl.html#227311346">(Feb 22 2021 at 18:08)</a>:</h4>
<p>So most of the stoppages have been in rustbuild?</p>



<a name="227311428"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/bootstrapping%20on%20s390x/mips%20for%20musl/near/227311428" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ariadne Conill <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/bootstrapping.20on.20s390x.2Fmips.20for.20musl.html#227311428">(Feb 22 2021 at 18:09)</a>:</h4>
<p>yeah</p>



<a name="227311558"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/bootstrapping%20on%20s390x/mips%20for%20musl/near/227311558" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ariadne Conill <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/bootstrapping.20on.20s390x.2Fmips.20for.20musl.html#227311558">(Feb 22 2021 at 18:10)</a>:</h4>
<p>i spent 4 months figuring out that <code>x.py build</code> is broken and <code>x.py dist</code> is not</p>



<a name="227311632"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/bootstrapping%20on%20s390x/mips%20for%20musl/near/227311632" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jubilee <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/bootstrapping.20on.20s390x.2Fmips.20for.20musl.html#227311632">(Feb 22 2021 at 18:10)</a>:</h4>
<p>So when you actually get to the point of building cargo it's usually home safe, sounds like.</p>



<a name="227311648"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/bootstrapping%20on%20s390x/mips%20for%20musl/near/227311648" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ariadne Conill <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/bootstrapping.20on.20s390x.2Fmips.20for.20musl.html#227311648">(Feb 22 2021 at 18:10)</a>:</h4>
<p>well, we will see :)</p>



<a name="227311656"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/bootstrapping%20on%20s390x/mips%20for%20musl/near/227311656" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ariadne Conill <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/bootstrapping.20on.20s390x.2Fmips.20for.20musl.html#227311656">(Feb 22 2021 at 18:11)</a>:</h4>
<p>it has failed to link cargo before</p>



<a name="227311874"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/bootstrapping%20on%20s390x/mips%20for%20musl/near/227311874" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ariadne Conill <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/bootstrapping.20on.20s390x.2Fmips.20for.20musl.html#227311874">(Feb 22 2021 at 18:12)</a>:</h4>
<p>it has also succeeded in linking cargo</p>



<a name="227311902"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/bootstrapping%20on%20s390x/mips%20for%20musl/near/227311902" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ariadne Conill <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/bootstrapping.20on.20s390x.2Fmips.20for.20musl.html#227311902">(Feb 22 2021 at 18:12)</a>:</h4>
<p>we will know soon enough :D</p>



<a name="227312457"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/bootstrapping%20on%20s390x/mips%20for%20musl/near/227312457" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jubilee <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/bootstrapping.20on.20s390x.2Fmips.20for.20musl.html#227312457">(Feb 22 2021 at 18:16)</a>:</h4>
<p>I saw a few tickets up thread but is there a ticket tracking the issues in rustbuild that you've run into?</p>



<a name="227312508"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/bootstrapping%20on%20s390x/mips%20for%20musl/near/227312508" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ariadne Conill <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/bootstrapping.20on.20s390x.2Fmips.20for.20musl.html#227312508">(Feb 22 2021 at 18:16)</a>:</h4>
<div class="codehilite"><pre><span></span><code>Finished release [optimized] target(s) in 9m 19s
</code></pre></div>



<a name="227312518"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/bootstrapping%20on%20s390x/mips%20for%20musl/near/227312518" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ariadne Conill <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/bootstrapping.20on.20s390x.2Fmips.20for.20musl.html#227312518">(Feb 22 2021 at 18:16)</a>:</h4>
<p>holy shit</p>



<a name="227312551"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/bootstrapping%20on%20s390x/mips%20for%20musl/near/227312551" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ariadne Conill <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/bootstrapping.20on.20s390x.2Fmips.20for.20musl.html#227312551">(Feb 22 2021 at 18:17)</a>:</h4>
<p>uhh, i'll make one about the x.py build vs dist</p>



<a name="227312640"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/bootstrapping%20on%20s390x/mips%20for%20musl/near/227312640" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ariadne Conill <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/bootstrapping.20on.20s390x.2Fmips.20for.20musl.html#227312640">(Feb 22 2021 at 18:17)</a>:</h4>
<p>if you read through this one, you'll see someone told me x.py build is broken and once that info was disseminated we made some progress</p>



<a name="227312770"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/bootstrapping%20on%20s390x/mips%20for%20musl/near/227312770" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> simulacrum <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/bootstrapping.20on.20s390x.2Fmips.20for.20musl.html#227312770">(Feb 22 2021 at 18:18)</a>:</h4>
<p>yes there's an existing one about that</p>



<a name="227312782"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/bootstrapping%20on%20s390x/mips%20for%20musl/near/227312782" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> simulacrum <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/bootstrapping.20on.20s390x.2Fmips.20for.20musl.html#227312782">(Feb 22 2021 at 18:18)</a>:</h4>
<p>no need to file more :)</p>



<a name="227312845"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/bootstrapping%20on%20s390x/mips%20for%20musl/near/227312845" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> simulacrum <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/bootstrapping.20on.20s390x.2Fmips.20for.20musl.html#227312845">(Feb 22 2021 at 18:18)</a>:</h4>
<p><a href="https://github.com/rust-lang/rust/issues/81702">https://github.com/rust-lang/rust/issues/81702</a> at least</p>



<a name="227312860"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/bootstrapping%20on%20s390x/mips%20for%20musl/near/227312860" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ariadne Conill <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/bootstrapping.20on.20s390x.2Fmips.20for.20musl.html#227312860">(Feb 22 2021 at 18:19)</a>:</h4>
<p>cool</p>



<a name="227312926"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/bootstrapping%20on%20s390x/mips%20for%20musl/near/227312926" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jubilee <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/bootstrapping.20on.20s390x.2Fmips.20for.20musl.html#227312926">(Feb 22 2021 at 18:19)</a>:</h4>
<p>Oh OK, I saw some of the tickets but wasn't sure if all the issues that had come up were being tracked already even after reading <span aria-label="sweat smile" class="emoji emoji-1f605" role="img" title="sweat smile">:sweat_smile:</span> <br>
<span aria-label="sparkling heart" class="emoji emoji-1f496" role="img" title="sparkling heart">:sparkling_heart:</span></p>



<a name="227313052"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/bootstrapping%20on%20s390x/mips%20for%20musl/near/227313052" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ariadne Conill <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/bootstrapping.20on.20s390x.2Fmips.20for.20musl.html#227313052">(Feb 22 2021 at 18:20)</a>:</h4>
<p>should i note in that ticket that 1.47 was also broken?</p>



<a name="227313078"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/bootstrapping%20on%20s390x/mips%20for%20musl/near/227313078" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Alex Gaynor <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/bootstrapping.20on.20s390x.2Fmips.20for.20musl.html#227313078">(Feb 22 2021 at 18:20)</a>:</h4>
<p>Do we expect that this solves all of Alpine's needs, modulo upstreaming the dynmusl targets. Or are there other steps required?</p>



<a name="227313154"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/bootstrapping%20on%20s390x/mips%20for%20musl/near/227313154" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ariadne Conill <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/bootstrapping.20on.20s390x.2Fmips.20for.20musl.html#227313154">(Feb 22 2021 at 18:21)</a>:</h4>
<p>no, we need to get s390x and riscv64 musl support finished</p>



<a name="227313186"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/bootstrapping%20on%20s390x/mips%20for%20musl/near/227313186" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ariadne Conill <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/bootstrapping.20on.20s390x.2Fmips.20for.20musl.html#227313186">(Feb 22 2021 at 18:21)</a>:</h4>
<p>actual code needs to be written for that</p>



<a name="227313197"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/bootstrapping%20on%20s390x/mips%20for%20musl/near/227313197" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jubilee <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/bootstrapping.20on.20s390x.2Fmips.20for.20musl.html#227313197">(Feb 22 2021 at 18:21)</a>:</h4>
<p><span class="user-mention" data-user-id="360752">@Ariadne Conill</span> Yes, that's useful for tracking where the regression/problem began.</p>



<a name="227316956"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/bootstrapping%20on%20s390x/mips%20for%20musl/near/227316956" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ariadne Conill <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/bootstrapping.20on.20s390x.2Fmips.20for.20musl.html#227316956">(Feb 22 2021 at 18:48)</a>:</h4>
<p><code>Build completed successfully in 1:17:00</code></p>



<a name="227317002"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/bootstrapping%20on%20s390x/mips%20for%20musl/near/227317002" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ariadne Conill <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/bootstrapping.20on.20s390x.2Fmips.20for.20musl.html#227317002">(Feb 22 2021 at 18:48)</a>:</h4>
<p>going to turn that into APKs just to be sure :)</p>



<a name="227321195"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/bootstrapping%20on%20s390x/mips%20for%20musl/near/227321195" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ariadne Conill <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/bootstrapping.20on.20s390x.2Fmips.20for.20musl.html#227321195">(Feb 22 2021 at 19:14)</a>:</h4>
<div class="codehilite"><pre><span></span><code>&gt;&gt;&gt; rust-dbg*: Running split function dbg...
aarch64-alpine-linux-musl-objcopy: Unable to recognise the format of the input file `rust-llvm-dwp&#39;
</code></pre></div>
<div class="codehilite"><pre><span></span><code>~/aports/community/rust $ file pkg/rust/usr/lib/rustlib/aarch64-alpine-linux-musl/bin/rust-llvm-dwp
pkg/rust/usr/lib/rustlib/aarch64-alpine-linux-musl/bin/rust-llvm-dwp: ELF 64-bit LSB pie executable, x86-64, version 1 (SYSV), dynamically linked, interpreter /lib/ld-musl-x86_64.so.1, stripped
</code></pre></div>



<a name="227321220"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/bootstrapping%20on%20s390x/mips%20for%20musl/near/227321220" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ariadne Conill <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/bootstrapping.20on.20s390x.2Fmips.20for.20musl.html#227321220">(Feb 22 2021 at 19:14)</a>:</h4>
<p>what is rust-llvm-dwp?</p>



<a name="227321318"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/bootstrapping%20on%20s390x/mips%20for%20musl/near/227321318" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joshua Nelson <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/bootstrapping.20on.20s390x.2Fmips.20for.20musl.html#227321318">(Feb 22 2021 at 19:15)</a>:</h4>
<p>it's used for split-dwarf I think: <a href="https://github.com/rust-lang/rust/pull/80087">https://github.com/rust-lang/rust/pull/80087</a></p>



<a name="227321348"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/bootstrapping%20on%20s390x/mips%20for%20musl/near/227321348" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ariadne Conill <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/bootstrapping.20on.20s390x.2Fmips.20for.20musl.html#227321348">(Feb 22 2021 at 19:15)</a>:</h4>
<p>looks like fedora just nukes it</p>



<a name="227321349"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/bootstrapping%20on%20s390x/mips%20for%20musl/near/227321349" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joshua Nelson <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/bootstrapping.20on.20s390x.2Fmips.20for.20musl.html#227321349">(Feb 22 2021 at 19:15)</a>:</h4>
<p>It should be optional IIRC</p>



<a name="227321374"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/bootstrapping%20on%20s390x/mips%20for%20musl/near/227321374" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ariadne Conill <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/bootstrapping.20on.20s390x.2Fmips.20for.20musl.html#227321374">(Feb 22 2021 at 19:15)</a>:</h4>
<p>going to do what fedora does</p>



<a name="227321388"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/bootstrapping%20on%20s390x/mips%20for%20musl/near/227321388" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jubilee <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/bootstrapping.20on.20s390x.2Fmips.20for.20musl.html#227321388">(Feb 22 2021 at 19:15)</a>:</h4>
<p>BOMBS AWAY</p>



<a name="227322538"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/bootstrapping%20on%20s390x/mips%20for%20musl/near/227322538" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nagisa <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/bootstrapping.20on.20s390x.2Fmips.20for.20musl.html#227322538">(Feb 22 2021 at 19:24)</a>:</h4>
<p>llvm-dwp is necessary for a currently unstable feature <code>-Csplit-debuginfo=packed</code></p>



<a name="227322632"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/bootstrapping%20on%20s390x/mips%20for%20musl/near/227322632" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nagisa <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/bootstrapping.20on.20s390x.2Fmips.20for.20musl.html#227322632">(Feb 22 2021 at 19:24)</a>:</h4>
<p>Not  a blocker or a huge deal, but probably will become more important over time.</p>



<a name="227322723"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/bootstrapping%20on%20s390x/mips%20for%20musl/near/227322723" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nagisa <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/bootstrapping.20on.20s390x.2Fmips.20for.20musl.html#227322723">(Feb 22 2021 at 19:25)</a>:</h4>
<p>looks like its a bug that we put a x86_64 llvm-dwp into a aarch64 toolchain?</p>



<a name="227323216"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/bootstrapping%20on%20s390x/mips%20for%20musl/near/227323216" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ariadne Conill <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/bootstrapping.20on.20s390x.2Fmips.20for.20musl.html#227323216">(Feb 22 2021 at 19:28)</a>:</h4>
<p>that may be my bug.  i call the host llvm-config</p>



<a name="227323287"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/bootstrapping%20on%20s390x/mips%20for%20musl/near/227323287" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ariadne Conill <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/bootstrapping.20on.20s390x.2Fmips.20for.20musl.html#227323287">(Feb 22 2021 at 19:29)</a>:</h4>
<p>but llvm-dwp is on the host regardless if rustc is installed</p>



<a name="227323299"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/bootstrapping%20on%20s390x/mips%20for%20musl/near/227323299" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ariadne Conill <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/bootstrapping.20on.20s390x.2Fmips.20for.20musl.html#227323299">(Feb 22 2021 at 19:29)</a>:</h4>
<p>so the internal rust copy isnt needed</p>



<a name="227324844"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/bootstrapping%20on%20s390x/mips%20for%20musl/near/227324844" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nagisa <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/bootstrapping.20on.20s390x.2Fmips.20for.20musl.html#227324844">(Feb 22 2021 at 19:39)</a>:</h4>
<p>well, <code>rustc</code> invokes <code>rust-llvm-dwp</code>, not <code>llvm-dwp</code> so you may want to symlink.</p>



<a name="227324982"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/bootstrapping%20on%20s390x/mips%20for%20musl/near/227324982" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nagisa <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/bootstrapping.20on.20s390x.2Fmips.20for.20musl.html#227324982">(Feb 22 2021 at 19:39)</a>:</h4>
<p>but again its a pretty fresh part of the codebase so a) nobody is using that functionality quite yet; b) its probably borken in various ways.</p>



<a name="227325107"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/bootstrapping%20on%20s390x/mips%20for%20musl/near/227325107" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ariadne Conill <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/bootstrapping.20on.20s390x.2Fmips.20for.20musl.html#227325107">(Feb 22 2021 at 19:40)</a>:</h4>
<p>okay, i've made a mental note</p>



<a name="227325283"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/bootstrapping%20on%20s390x/mips%20for%20musl/near/227325283" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Alex Gaynor <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/bootstrapping.20on.20s390x.2Fmips.20for.20musl.html#227325283">(Feb 22 2021 at 19:41)</a>:</h4>
<p>FWIW I seem to recall seeing a thread about how the author of llvm-dwp didn't think it was a very good codebase and maybe people shouldn't really use it, so there might be evolution in the tooling rust uses for split debuginfo anyways.</p>



<a name="227325338"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/bootstrapping%20on%20s390x/mips%20for%20musl/near/227325338" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ariadne Conill <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/bootstrapping.20on.20s390x.2Fmips.20for.20musl.html#227325338">(Feb 22 2021 at 19:41)</a>:</h4>
<p>mips64 did not go well</p>



<a name="227325397"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/bootstrapping%20on%20s390x/mips%20for%20musl/near/227325397" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ariadne Conill <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/bootstrapping.20on.20s390x.2Fmips.20for.20musl.html#227325397">(Feb 22 2021 at 19:42)</a>:</h4>
<p>capturing a build log</p>



<a name="227325439"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/bootstrapping%20on%20s390x/mips%20for%20musl/near/227325439" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nagisa <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/bootstrapping.20on.20s390x.2Fmips.20for.20musl.html#227325439">(Feb 22 2021 at 19:42)</a>:</h4>
<p><span class="user-mention" data-user-id="130046">@Alex Gaynor</span> <a href="#narrow/stream/131828-t-compiler/topic/llvm-dwp.20is.20not.20recommended">https://rust-lang.zulipchat.com/#narrow/stream/131828-t-compiler/topic/llvm-dwp.20is.20not.20recommended</a>?</p>



<a name="227325790"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/bootstrapping%20on%20s390x/mips%20for%20musl/near/227325790" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ariadne Conill <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/bootstrapping.20on.20s390x.2Fmips.20for.20musl.html#227325790">(Feb 22 2021 at 19:44)</a>:</h4>
<p><a href="https://tpaste.us/5V1j">https://tpaste.us/5V1j</a></p>



<a name="227325796"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/bootstrapping%20on%20s390x/mips%20for%20musl/near/227325796" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ariadne Conill <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/bootstrapping.20on.20s390x.2Fmips.20for.20musl.html#227325796">(Feb 22 2021 at 19:44)</a>:</h4>
<p>build log :)</p>



<a name="227326015"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/bootstrapping%20on%20s390x/mips%20for%20musl/near/227326015" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joshua Nelson <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/bootstrapping.20on.20s390x.2Fmips.20for.20musl.html#227326015">(Feb 22 2021 at 19:45)</a>:</h4>
<p>this is the same error we ran into before, right? with __rdl_alloc?</p>



<a name="227326261"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/bootstrapping%20on%20s390x/mips%20for%20musl/near/227326261" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ariadne Conill <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/bootstrapping.20on.20s390x.2Fmips.20for.20musl.html#227326261">(Feb 22 2021 at 19:47)</a>:</h4>
<p>yes</p>



<a name="227326359"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/bootstrapping%20on%20s390x/mips%20for%20musl/near/227326359" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ariadne Conill <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/bootstrapping.20on.20s390x.2Fmips.20for.20musl.html#227326359">(Feb 22 2021 at 19:48)</a>:</h4>
<p>i can try a non-incremental build</p>



<a name="227326819"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/bootstrapping%20on%20s390x/mips%20for%20musl/near/227326819" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ariadne Conill <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/bootstrapping.20on.20s390x.2Fmips.20for.20musl.html#227326819">(Feb 22 2021 at 19:51)</a>:</h4>
<p>/me runs <code>CHOST=mips64 abuild clean unpack prepare build &amp;&gt;build.log</code></p>



<a name="227326836"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/bootstrapping%20on%20s390x/mips%20for%20musl/near/227326836" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ariadne Conill <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/bootstrapping.20on.20s390x.2Fmips.20for.20musl.html#227326836">(Feb 22 2021 at 19:51)</a>:</h4>
<p>i dont think this will do any actual good, but...</p>



<a name="227332079"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/bootstrapping%20on%20s390x/mips%20for%20musl/near/227332079" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ariadne Conill <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/bootstrapping.20on.20s390x.2Fmips.20for.20musl.html#227332079">(Feb 22 2021 at 20:28)</a>:</h4>
<p>yeah didnt do any good, same error</p>



<a name="227332139"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/bootstrapping%20on%20s390x/mips%20for%20musl/near/227332139" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ariadne Conill <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/bootstrapping.20on.20s390x.2Fmips.20for.20musl.html#227332139">(Feb 22 2021 at 20:28)</a>:</h4>
<p>what is strange is that the failure happens in stage0</p>



<a name="227332159"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/bootstrapping%20on%20s390x/mips%20for%20musl/near/227332159" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ariadne Conill <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/bootstrapping.20on.20s390x.2Fmips.20for.20musl.html#227332159">(Feb 22 2021 at 20:28)</a>:</h4>
<p>which is pre-cross, isn't it?</p>



<a name="227332451"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/bootstrapping%20on%20s390x/mips%20for%20musl/near/227332451" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jubilee <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/bootstrapping.20on.20s390x.2Fmips.20for.20musl.html#227332451">(Feb 22 2021 at 20:31)</a>:</h4>
<p>stage0 is where it pulls in a compiler and starts building a new std so it can build the next compiler, if memory serves.</p>



<a name="227333393"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/bootstrapping%20on%20s390x/mips%20for%20musl/near/227333393" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joshua Nelson <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/bootstrapping.20on.20s390x.2Fmips.20for.20musl.html#227333393">(Feb 22 2021 at 20:38)</a>:</h4>
<p>this happens when building stage1-std, which is for the host</p>



<a name="227333444"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/bootstrapping%20on%20s390x/mips%20for%20musl/near/227333444" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joshua Nelson <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/bootstrapping.20on.20s390x.2Fmips.20for.20musl.html#227333444">(Feb 22 2021 at 20:38)</a>:</h4>
<p>"stage0" is not really defined, it is using the stage 0 compiler though: <a href="http://rustc-dev-guide.rust-lang.org/building/bootstrapping.html#understanding-stages-of-bootstrap">rustc-dev-guide.rust-lang.org/building/bootstrapping.html#understanding-stages-of-bootstrap</a></p>



<a name="227333729"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/bootstrapping%20on%20s390x/mips%20for%20musl/near/227333729" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joshua Nelson <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/bootstrapping.20on.20s390x.2Fmips.20for.20musl.html#227333729">(Feb 22 2021 at 20:40)</a>:</h4>
<p>(you can tell stage1-std is for the host because the directory says <code>stage1-std/x86_64-alpine-linux-musl</code>, not mips64)</p>



<a name="227349377"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/bootstrapping%20on%20s390x/mips%20for%20musl/near/227349377" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Alex Gaynor <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/bootstrapping.20on.20s390x.2Fmips.20for.20musl.html#227349377">(Feb 22 2021 at 22:21)</a>:</h4>
<p>If someone wants to reproduce this from scratch, is there an easy way to do so?</p>



<a name="227381885"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/bootstrapping%20on%20s390x/mips%20for%20musl/near/227381885" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ariadne Conill <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/bootstrapping.20on.20s390x.2Fmips.20for.20musl.html#227381885">(Feb 23 2021 at 04:42)</a>:</h4>
<p>yes.  all you have to do is install alpine, checkout aports.git, run <code>sh scripts/bootstrap.sh mips64</code> to generate a cross-compiler, then you can do <code>CHOST=mips64 abuild -r</code> inside community/rust after adding mips64 to the arch list</p>



<a name="227383484"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/bootstrapping%20on%20s390x/mips%20for%20musl/near/227383484" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ariadne Conill <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/bootstrapping.20on.20s390x.2Fmips.20for.20musl.html#227383484">(Feb 23 2021 at 05:09)</a>:</h4>
<p>if it would help, i can create a VM with all of that done ahead of time.</p>



<a name="227389751"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/bootstrapping%20on%20s390x/mips%20for%20musl/near/227389751" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ariadne Conill <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/bootstrapping.20on.20s390x.2Fmips.20for.20musl.html#227389751">(Feb 23 2021 at 07:00)</a>:</h4>
<p>my next attempt is going to be to target the mips64-unknown-linux-musl target</p>



<a name="227389774"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/bootstrapping%20on%20s390x/mips%20for%20musl/near/227389774" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ariadne Conill <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/bootstrapping.20on.20s390x.2Fmips.20for.20musl.html#227389774">(Feb 23 2021 at 07:01)</a>:</h4>
<p>maybe our target is broken</p>



<a name="227389921"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/bootstrapping%20on%20s390x/mips%20for%20musl/near/227389921" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ariadne Conill <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/bootstrapping.20on.20s390x.2Fmips.20for.20musl.html#227389921">(Feb 23 2021 at 07:03)</a>:</h4>
<p>sending it :)</p>



<a name="227391632"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/bootstrapping%20on%20s390x/mips%20for%20musl/near/227391632" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ariadne Conill <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/bootstrapping.20on.20s390x.2Fmips.20for.20musl.html#227391632">(Feb 23 2021 at 07:31)</a>:</h4>
<p>alright, lets see if it blows up</p>



<a name="227391634"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/bootstrapping%20on%20s390x/mips%20for%20musl/near/227391634" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ariadne Conill <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/bootstrapping.20on.20s390x.2Fmips.20for.20musl.html#227391634">(Feb 23 2021 at 07:31)</a>:</h4>
<p>Building stage1 std artifacts (x86_64-alpine-linux-musl -&gt; x86_64-alpine-linux-musl) :)</p>



<a name="227392819"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/bootstrapping%20on%20s390x/mips%20for%20musl/near/227392819" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ariadne Conill <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/bootstrapping.20on.20s390x.2Fmips.20for.20musl.html#227392819">(Feb 23 2021 at 07:48)</a>:</h4>
<p>that didn't do any good, going to try to blast away that <code>[cfg(test)]</code></p>



<a name="227392960"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/bootstrapping%20on%20s390x/mips%20for%20musl/near/227392960" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ariadne Conill <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/bootstrapping.20on.20s390x.2Fmips.20for.20musl.html#227392960">(Feb 23 2021 at 07:50)</a>:</h4>
<p>err, <code>[cfg(not(test))]</code></p>



<a name="227393437"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/bootstrapping%20on%20s390x/mips%20for%20musl/near/227393437" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ariadne Conill <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/bootstrapping.20on.20s390x.2Fmips.20for.20musl.html#227393437">(Feb 23 2021 at 07:57)</a>:</h4>
<div class="codehilite"><pre><span></span><code>075983c70ba2 src/libstd/alloc.rs      (Ralf Jung      2018-11-12 09:00:39 +0100 341)     // These magic symbol names are used as a fallback for implementing the
99e0d8ed7996 src/libstd/alloc.rs      (Yuki Okushi    2020-04-03 19:03:13 +0900 342)     // `__rust_alloc` etc symbols (see `src/liballoc/alloc.rs`) when there is
075983c70ba2 src/libstd/alloc.rs      (Ralf Jung      2018-11-12 09:00:39 +0100 343)     // no `#[global_allocator]` attribute.
</code></pre></div>



<a name="227393443"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/bootstrapping%20on%20s390x/mips%20for%20musl/near/227393443" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ariadne Conill <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/bootstrapping.20on.20s390x.2Fmips.20for.20musl.html#227393443">(Feb 23 2021 at 07:57)</a>:</h4>
<p>hmm, so there is no #[global_allocator]</p>



<a name="227393784"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/bootstrapping%20on%20s390x/mips%20for%20musl/near/227393784" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ariadne Conill <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/bootstrapping.20on.20s390x.2Fmips.20for.20musl.html#227393784">(Feb 23 2021 at 08:01)</a>:</h4>
<p><code>library/core/src/macros/mod.rs:    pub macro global_allocator($item:item) {</code></p>



<a name="227393815"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/bootstrapping%20on%20s390x/mips%20for%20musl/near/227393815" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ariadne Conill <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/bootstrapping.20on.20s390x.2Fmips.20for.20musl.html#227393815">(Feb 23 2021 at 08:01)</a>:</h4>
<p>which is a compiler-builtin</p>



<a name="227393997"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/bootstrapping%20on%20s390x/mips%20for%20musl/near/227393997" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ariadne Conill <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/bootstrapping.20on.20s390x.2Fmips.20for.20musl.html#227393997">(Feb 23 2021 at 08:03)</a>:</h4>
<p><code>compiler/rustc_metadata/src/creader.rs:            if !data.has_global_allocator() {</code></p>



<a name="227394004"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/bootstrapping%20on%20s390x/mips%20for%20musl/near/227394004" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ariadne Conill <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/bootstrapping.20on.20s390x.2Fmips.20for.20musl.html#227394004">(Feb 23 2021 at 08:03)</a>:</h4>
<p>this looks promising</p>



<a name="227394083"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/bootstrapping%20on%20s390x/mips%20for%20musl/near/227394083" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ariadne Conill <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/bootstrapping.20on.20s390x.2Fmips.20for.20musl.html#227394083">(Feb 23 2021 at 08:04)</a>:</h4>
<p>hmm, not really</p>



<a name="227394134"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/bootstrapping%20on%20s390x/mips%20for%20musl/near/227394134" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ariadne Conill <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/bootstrapping.20on.20s390x.2Fmips.20for.20musl.html#227394134">(Feb 23 2021 at 08:05)</a>:</h4>
<p>digging a little further...</p>
<div class="codehilite"><pre><span></span><code>        // Ok we haven&#39;t found a global allocator but we still need an
        // allocator. At this point our allocator request is typically fulfilled
        // by the standard library, denoted by the `#![default_lib_allocator]`
        // attribute.
        let mut has_default = self.sess.contains_name(&amp;krate.attrs, sym::default_lib_allocator);
</code></pre></div>



<a name="227394151"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/bootstrapping%20on%20s390x/mips%20for%20musl/near/227394151" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ariadne Conill <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/bootstrapping.20on.20s390x.2Fmips.20for.20musl.html#227394151">(Feb 23 2021 at 08:05)</a>:</h4>
<p>looking for <code>default_lib_allocator</code>...</p>



<a name="227394238"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/bootstrapping%20on%20s390x/mips%20for%20musl/near/227394238" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ariadne Conill <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/bootstrapping.20on.20s390x.2Fmips.20for.20musl.html#227394238">(Feb 23 2021 at 08:06)</a>:</h4>
<p><code>library/std/src/lib.rs:#![default_lib_allocator]</code></p>



<a name="227394264"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/bootstrapping%20on%20s390x/mips%20for%20musl/near/227394264" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ariadne Conill <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/bootstrapping.20on.20s390x.2Fmips.20for.20musl.html#227394264">(Feb 23 2021 at 08:07)</a>:</h4>
<div class="codehilite"><pre><span></span><code>// NB: the above list is sorted to minimize merge conflicts.
#![default_lib_allocator]
</code></pre></div>



<a name="227394273"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/bootstrapping%20on%20s390x/mips%20for%20musl/near/227394273" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ariadne Conill <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/bootstrapping.20on.20s390x.2Fmips.20for.20musl.html#227394273">(Feb 23 2021 at 08:07)</a>:</h4>
<p>hmm</p>



<a name="227394278"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/bootstrapping%20on%20s390x/mips%20for%20musl/near/227394278" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ariadne Conill <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/bootstrapping.20on.20s390x.2Fmips.20for.20musl.html#227394278">(Feb 23 2021 at 08:07)</a>:</h4>
<p>well, that is a dead end kinda</p>



<a name="227394293"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/bootstrapping%20on%20s390x/mips%20for%20musl/near/227394293" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ariadne Conill <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/bootstrapping.20on.20s390x.2Fmips.20for.20musl.html#227394293">(Feb 23 2021 at 08:07)</a>:</h4>
<p>except:</p>



<a name="227394303"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/bootstrapping%20on%20s390x/mips%20for%20musl/near/227394303" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ariadne Conill <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/bootstrapping.20on.20s390x.2Fmips.20for.20musl.html#227394303">(Feb 23 2021 at 08:07)</a>:</h4>
<div class="codehilite"><pre><span></span><code>#[allow(unused_imports)] // macros from `alloc` are not used on all platforms
#[macro_use]
extern crate alloc as alloc_crate;
#[doc(masked)]
#[allow(unused_extern_crates)]
extern crate libc;
</code></pre></div>



<a name="227394317"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/bootstrapping%20on%20s390x/mips%20for%20musl/near/227394317" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ariadne Conill <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/bootstrapping.20on.20s390x.2Fmips.20for.20musl.html#227394317">(Feb 23 2021 at 08:07)</a>:</h4>
<p>so then perhaps the malloc is learned from libc crate</p>



<a name="227394975"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/bootstrapping%20on%20s390x/mips%20for%20musl/near/227394975" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ariadne Conill <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/bootstrapping.20on.20s390x.2Fmips.20for.20musl.html#227394975">(Feb 23 2021 at 08:15)</a>:</h4>
<div class="codehilite"><pre><span></span><code>library/std/src/sys_common/alloc.rs:use crate::alloc::{GlobalAlloc, Layout, System};
library/std/src/sys_common/alloc.rs:    alloc: &amp;System,
</code></pre></div>



<a name="227395191"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/bootstrapping%20on%20s390x/mips%20for%20musl/near/227395191" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ariadne Conill <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/bootstrapping.20on.20s390x.2Fmips.20for.20musl.html#227395191">(Feb 23 2021 at 08:17)</a>:</h4>
<p>[...]</p>



<a name="227395214"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/bootstrapping%20on%20s390x/mips%20for%20musl/near/227395214" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ariadne Conill <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/bootstrapping.20on.20s390x.2Fmips.20for.20musl.html#227395214">(Feb 23 2021 at 08:17)</a>:</h4>
<p><code>            libc::malloc(layout.size()) as *mut u8</code></p>



<a name="227395226"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/bootstrapping%20on%20s390x/mips%20for%20musl/near/227395226" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ariadne Conill <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/bootstrapping.20on.20s390x.2Fmips.20for.20musl.html#227395226">(Feb 23 2021 at 08:18)</a>:</h4>
<p>so, allocator knowledge is wrapped but ultimately originates in libc crate.</p>



<a name="227395913"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/bootstrapping%20on%20s390x/mips%20for%20musl/near/227395913" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ariadne Conill <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/bootstrapping.20on.20s390x.2Fmips.20for.20musl.html#227395913">(Feb 23 2021 at 08:25)</a>:</h4>
<p>which makes sense, because the s390x and riscv64 targets had the same behavior on 1.47 where libc crate had no awareness</p>



<a name="227395936"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/bootstrapping%20on%20s390x/mips%20for%20musl/near/227395936" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ariadne Conill <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/bootstrapping.20on.20s390x.2Fmips.20for.20musl.html#227395936">(Feb 23 2021 at 08:25)</a>:</h4>
<p>so, lets see what libc crate got included into 1.50</p>



<a name="227396078"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/bootstrapping%20on%20s390x/mips%20for%20musl/near/227396078" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ariadne Conill <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/bootstrapping.20on.20s390x.2Fmips.20for.20musl.html#227396078">(Feb 23 2021 at 08:26)</a>:</h4>
<p>theres 3 different libc crates vendored</p>



<a name="227396288"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/bootstrapping%20on%20s390x/mips%20for%20musl/near/227396288" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ariadne Conill <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/bootstrapping.20on.20s390x.2Fmips.20for.20musl.html#227396288">(Feb 23 2021 at 08:29)</a>:</h4>
<p>hmm, all those libc crates have the mips64 stuff</p>



<a name="227396316"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/bootstrapping%20on%20s390x/mips%20for%20musl/near/227396316" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ariadne Conill <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/bootstrapping.20on.20s390x.2Fmips.20for.20musl.html#227396316">(Feb 23 2021 at 08:29)</a>:</h4>
<p>so that's not it</p>



<a name="227397676"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/bootstrapping%20on%20s390x/mips%20for%20musl/near/227397676" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ariadne Conill <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/bootstrapping.20on.20s390x.2Fmips.20for.20musl.html#227397676">(Feb 23 2021 at 08:43)</a>:</h4>
<p>welp i’m out of ideas for now</p>



<a name="227429386"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/bootstrapping%20on%20s390x/mips%20for%20musl/near/227429386" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joshua Nelson <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/bootstrapping.20on.20s390x.2Fmips.20for.20musl.html#227429386">(Feb 23 2021 at 13:29)</a>:</h4>
<p>Is there a <code>#[cfg]</code> or <code>cfg_if!</code> in front of libc::malloc in the standard library?</p>



<a name="227433924"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/bootstrapping%20on%20s390x/mips%20for%20musl/near/227433924" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joshua Nelson <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/bootstrapping.20on.20s390x.2Fmips.20for.20musl.html#227433924">(Feb 23 2021 at 14:02)</a>:</h4>
<p>ok yeah this is in <code>sys::unix</code>, which is platform-dependent. Are you sure it's actually being compiled?</p>



<a name="227434089"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/bootstrapping%20on%20s390x/mips%20for%20musl/near/227434089" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joshua Nelson <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/bootstrapping.20on.20s390x.2Fmips.20for.20musl.html#227434089">(Feb 23 2021 at 14:03)</a>:</h4>
<p>hmm, it's for any <code>cfg(unix)</code> platform, which I would expect to include s390x: <a href="https://github.com/rust-lang/rust/blob/446d4533e89db04f9568be4199e56b5fce0d176d/library/std/src/sys/mod.rs#L29">https://github.com/rust-lang/rust/blob/446d4533e89db04f9568be4199e56b5fce0d176d/library/std/src/sys/mod.rs#L29</a></p>



<a name="227434161"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/bootstrapping%20on%20s390x/mips%20for%20musl/near/227434161" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ariadne Conill <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/bootstrapping.20on.20s390x.2Fmips.20for.20musl.html#227434161">(Feb 23 2021 at 14:04)</a>:</h4>
<p>this is mips64</p>



<a name="227434212"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/bootstrapping%20on%20s390x/mips%20for%20musl/near/227434212" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ariadne Conill <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/bootstrapping.20on.20s390x.2Fmips.20for.20musl.html#227434212">(Feb 23 2021 at 14:04)</a>:</h4>
<p>all of the code to support mips64 on musl is allegedly present in 1.50</p>



<a name="227434310"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/bootstrapping%20on%20s390x/mips%20for%20musl/near/227434310" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joshua Nelson <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/bootstrapping.20on.20s390x.2Fmips.20for.20musl.html#227434310">(Feb 23 2021 at 14:05)</a>:</h4>
<p>I am confused. So people have gotten mips64 working in the past, but it's failing for you now?</p>



<a name="227434536"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/bootstrapping%20on%20s390x/mips%20for%20musl/near/227434536" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ariadne Conill <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/bootstrapping.20on.20s390x.2Fmips.20for.20musl.html#227434536">(Feb 23 2021 at 14:06)</a>:</h4>
<p>nobody has gotten rust mips64 working on alpine, but it appears to have all the needed bits.</p>



<a name="227434578"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/bootstrapping%20on%20s390x/mips%20for%20musl/near/227434578" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ariadne Conill <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/bootstrapping.20on.20s390x.2Fmips.20for.20musl.html#227434578">(Feb 23 2021 at 14:06)</a>:</h4>
<p>presumably, somebody else has gotten mips64 rust working on musl at some point (as there is code for it)</p>



<a name="227434662"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/bootstrapping%20on%20s390x/mips%20for%20musl/near/227434662" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ariadne Conill <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/bootstrapping.20on.20s390x.2Fmips.20for.20musl.html#227434662">(Feb 23 2021 at 14:07)</a>:</h4>
<p>if i were to guess, it would be loongson team that contributed that code.</p>



<a name="227434679"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/bootstrapping%20on%20s390x/mips%20for%20musl/near/227434679" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joshua Nelson <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/bootstrapping.20on.20s390x.2Fmips.20for.20musl.html#227434679">(Feb 23 2021 at 14:07)</a>:</h4>
<p>Ok. In that case I would not assume it's working <span aria-label="laughing" class="emoji emoji-1f606" role="img" title="laughing">:laughing:</span> If you cross-compile this program for mips64, does it work?</p>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="cp">#[cfg(unix)]</span><span class="w"></span>
<span class="k">fn</span> <span class="nf">main</span><span class="p">()</span><span class="w"> </span><span class="p">{}</span><span class="w"></span>
</code></pre></div>



<a name="227434724"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/bootstrapping%20on%20s390x/mips%20for%20musl/near/227434724" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ariadne Conill <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/bootstrapping.20on.20s390x.2Fmips.20for.20musl.html#227434724">(Feb 23 2021 at 14:07)</a>:</h4>
<p>we're not even at that stage</p>



<a name="227434801"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/bootstrapping%20on%20s390x/mips%20for%20musl/near/227434801" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joshua Nelson <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/bootstrapping.20on.20s390x.2Fmips.20for.20musl.html#227434801">(Feb 23 2021 at 14:08)</a>:</h4>
<p>if you can't cross-compile <em>any</em> program for mips, you certainly can't cross-compile the standard library</p>



<a name="227434845"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/bootstrapping%20on%20s390x/mips%20for%20musl/near/227434845" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joshua Nelson <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/bootstrapping.20on.20s390x.2Fmips.20for.20musl.html#227434845">(Feb 23 2021 at 14:08)</a>:</h4>
<p>you might need <code>#![no_std]</code> though</p>



<a name="227434855"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/bootstrapping%20on%20s390x/mips%20for%20musl/near/227434855" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ariadne Conill <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/bootstrapping.20on.20s390x.2Fmips.20for.20musl.html#227434855">(Feb 23 2021 at 14:08)</a>:</h4>
<p>you're not understanding what i mean</p>



<a name="227434939"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/bootstrapping%20on%20s390x/mips%20for%20musl/near/227434939" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joshua Nelson <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/bootstrapping.20on.20s390x.2Fmips.20for.20musl.html#227434939">(Feb 23 2021 at 14:09)</a>:</h4>
<p>What do you mean?</p>



<a name="227434940"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/bootstrapping%20on%20s390x/mips%20for%20musl/near/227434940" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ariadne Conill <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/bootstrapping.20on.20s390x.2Fmips.20for.20musl.html#227434940">(Feb 23 2021 at 14:09)</a>:</h4>
<p>i am trying to build a cross toolchain for mips64-unknown-linux-muslabi64</p>



<a name="227435016"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/bootstrapping%20on%20s390x/mips%20for%20musl/near/227435016" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ariadne Conill <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/bootstrapping.20on.20s390x.2Fmips.20for.20musl.html#227435016">(Feb 23 2021 at 14:09)</a>:</h4>
<p>we do not get remotely close to that stage</p>



<a name="227435083"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/bootstrapping%20on%20s390x/mips%20for%20musl/near/227435083" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ariadne Conill <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/bootstrapping.20on.20s390x.2Fmips.20for.20musl.html#227435083">(Feb 23 2021 at 14:09)</a>:</h4>
<p>because we fail to build x86_64 compiler (stage 1) first</p>



<a name="227435176"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/bootstrapping%20on%20s390x/mips%20for%20musl/near/227435176" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ariadne Conill <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/bootstrapping.20on.20s390x.2Fmips.20for.20musl.html#227435176">(Feb 23 2021 at 14:10)</a>:</h4>
<p>HOWEVER</p>



<a name="227435189"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/bootstrapping%20on%20s390x/mips%20for%20musl/near/227435189" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ariadne Conill <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/bootstrapping.20on.20s390x.2Fmips.20for.20musl.html#227435189">(Feb 23 2021 at 14:10)</a>:</h4>
<p>if we try to cross to aarch64-unknown-linux-musl</p>



<a name="227435231"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/bootstrapping%20on%20s390x/mips%20for%20musl/near/227435231" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ariadne Conill <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/bootstrapping.20on.20s390x.2Fmips.20for.20musl.html#227435231">(Feb 23 2021 at 14:10)</a>:</h4>
<p>the x86_64 compiler (stage 1) builds fine</p>



<a name="227435278"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/bootstrapping%20on%20s390x/mips%20for%20musl/near/227435278" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ariadne Conill <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/bootstrapping.20on.20s390x.2Fmips.20for.20musl.html#227435278">(Feb 23 2021 at 14:11)</a>:</h4>
<p>this has nothing to do with mips and everything to do with the build system</p>



<a name="227435291"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/bootstrapping%20on%20s390x/mips%20for%20musl/near/227435291" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joshua Nelson <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/bootstrapping.20on.20s390x.2Fmips.20for.20musl.html#227435291">(Feb 23 2021 at 14:11)</a>:</h4>
<p>something is wrong with either your or my mental model of bootstrapping, because the target should never affect the host AFAIK</p>



<a name="227435555"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/bootstrapping%20on%20s390x/mips%20for%20musl/near/227435555" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joshua Nelson <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/bootstrapping.20on.20s390x.2Fmips.20for.20musl.html#227435555">(Feb 23 2021 at 14:12)</a>:</h4>
<p>stage1-std should be exactly the same regardless of what you're cross-compiling for</p>



<a name="227435576"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/bootstrapping%20on%20s390x/mips%20for%20musl/near/227435576" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ariadne Conill <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/bootstrapping.20on.20s390x.2Fmips.20for.20musl.html#227435576">(Feb 23 2021 at 14:12)</a>:</h4>
<p>yes, i agree</p>



<a name="227435588"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/bootstrapping%20on%20s390x/mips%20for%20musl/near/227435588" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ariadne Conill <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/bootstrapping.20on.20s390x.2Fmips.20for.20musl.html#227435588">(Feb 23 2021 at 14:12)</a>:</h4>
<p>but that's not happening</p>



<a name="227435631"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/bootstrapping%20on%20s390x/mips%20for%20musl/near/227435631" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ariadne Conill <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/bootstrapping.20on.20s390x.2Fmips.20for.20musl.html#227435631">(Feb 23 2021 at 14:13)</a>:</h4>
<p>if we cross-compile for aarch64, stage1-std builds fine.</p>



<a name="227435652"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/bootstrapping%20on%20s390x/mips%20for%20musl/near/227435652" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ariadne Conill <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/bootstrapping.20on.20s390x.2Fmips.20for.20musl.html#227435652">(Feb 23 2021 at 14:13)</a>:</h4>
<p>if we cross-compile for mips64, it dies.</p>



<a name="227435682"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/bootstrapping%20on%20s390x/mips%20for%20musl/near/227435682" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joshua Nelson <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/bootstrapping.20on.20s390x.2Fmips.20for.20musl.html#227435682">(Feb 23 2021 at 14:13)</a>:</h4>
<p><span class="user-mention" data-user-id="116122">@simulacrum</span> do you know why <em>stage1-std</em> would fail to build when cross-compiling? I'd expect it for stage2, but not stage1</p>



<a name="227435691"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/bootstrapping%20on%20s390x/mips%20for%20musl/near/227435691" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ariadne Conill <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/bootstrapping.20on.20s390x.2Fmips.20for.20musl.html#227435691">(Feb 23 2021 at 14:13)</a>:</h4>
<p>i have no idea why.</p>



<a name="227435720"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/bootstrapping%20on%20s390x/mips%20for%20musl/near/227435720" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joshua Nelson <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/bootstrapping.20on.20s390x.2Fmips.20for.20musl.html#227435720">(Feb 23 2021 at 14:13)</a>:</h4>
<p>here's the build log: <a href="https://tpaste.us/5V1j">https://tpaste.us/5V1j</a></p>



<a name="227435755"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/bootstrapping%20on%20s390x/mips%20for%20musl/near/227435755" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ariadne Conill <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/bootstrapping.20on.20s390x.2Fmips.20for.20musl.html#227435755">(Feb 23 2021 at 14:13)</a>:</h4>
<p>if you look at the build log, you can see mips64 is not even in the picture.  the only difference is the final target.</p>



<a name="227435779"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/bootstrapping%20on%20s390x/mips%20for%20musl/near/227435779" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ariadne Conill <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/bootstrapping.20on.20s390x.2Fmips.20for.20musl.html#227435779">(Feb 23 2021 at 14:14)</a>:</h4>
<p>aarch64 = fine, mips64|s390x|riscv64 = not fine</p>



<a name="227435863"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/bootstrapping%20on%20s390x/mips%20for%20musl/near/227435863" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ariadne Conill <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/bootstrapping.20on.20s390x.2Fmips.20for.20musl.html#227435863">(Feb 23 2021 at 14:14)</a>:</h4>
<p>if you don't believe me i can do aarch64 again and upload a build log</p>



<a name="227435879"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/bootstrapping%20on%20s390x/mips%20for%20musl/near/227435879" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joshua Nelson <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/bootstrapping.20on.20s390x.2Fmips.20for.20musl.html#227435879">(Feb 23 2021 at 14:14)</a>:</h4>
<p>no no I believe you</p>



<a name="227435890"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/bootstrapping%20on%20s390x/mips%20for%20musl/near/227435890" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joshua Nelson <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/bootstrapping.20on.20s390x.2Fmips.20for.20musl.html#227435890">(Feb 23 2021 at 14:14)</a>:</h4>
<p>I'm just super confused lol</p>



<a name="227436089"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/bootstrapping%20on%20s390x/mips%20for%20musl/near/227436089" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> simulacrum <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/bootstrapping.20on.20s390x.2Fmips.20for.20musl.html#227436089">(Feb 23 2021 at 14:15)</a>:</h4>
<p>hm, have you tried to inspect the rlibs (which IIRC are just .ar in disguise) with nm or something to confirm the symbols aren't present?</p>



<a name="227436166"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/bootstrapping%20on%20s390x/mips%20for%20musl/near/227436166" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> simulacrum <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/bootstrapping.20on.20s390x.2Fmips.20for.20musl.html#227436166">(Feb 23 2021 at 14:16)</a>:</h4>
<p>i.e., are they getting removed by the linker perhaps?</p>



<a name="227436213"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/bootstrapping%20on%20s390x/mips%20for%20musl/near/227436213" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ariadne Conill <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/bootstrapping.20on.20s390x.2Fmips.20for.20musl.html#227436213">(Feb 23 2021 at 14:16)</a>:</h4>
<p>yes, back in october</p>



<a name="227436224"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/bootstrapping%20on%20s390x/mips%20for%20musl/near/227436224" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> simulacrum <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/bootstrapping.20on.20s390x.2Fmips.20for.20musl.html#227436224">(Feb 23 2021 at 14:16)</a>:</h4>
<p>I admit to knowing next to nothing about linkers</p>



<a name="227436347"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/bootstrapping%20on%20s390x/mips%20for%20musl/near/227436347" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> simulacrum <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/bootstrapping.20on.20s390x.2Fmips.20for.20musl.html#227436347">(Feb 23 2021 at 14:17)</a>:</h4>
<p><span class="user-mention silent" data-user-id="360752">Ariadne Conill</span> <a href="#narrow/stream/131828-t-compiler/topic/bootstrapping.20on.20s390x.2Fmips.20for.20musl/near/227436213">said</a>:</p>
<blockquote>
<p>yes, back in october</p>
</blockquote>
<p>so the symbol is there?</p>



<a name="227436553"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/bootstrapping%20on%20s390x/mips%20for%20musl/near/227436553" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ariadne Conill <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/bootstrapping.20on.20s390x.2Fmips.20for.20musl.html#227436553">(Feb 23 2021 at 14:18)</a>:</h4>
<p>no, the symbol is not anywhere to be seen</p>



<a name="227436876"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/bootstrapping%20on%20s390x/mips%20for%20musl/near/227436876" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ariadne Conill <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/bootstrapping.20on.20s390x.2Fmips.20for.20musl.html#227436876">(Feb 23 2021 at 14:21)</a>:</h4>
<p>in fact, <code>nm</code> on these rlibs produces a bunch of .o files with no symbols at all</p>



<a name="227436923"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/bootstrapping%20on%20s390x/mips%20for%20musl/near/227436923" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> simulacrum <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/bootstrapping.20on.20s390x.2Fmips.20for.20musl.html#227436923">(Feb 23 2021 at 14:21)</a>:</h4>
<p>hm, that's odd (but perhaps indicative of the problem)</p>



<a name="227436952"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/bootstrapping%20on%20s390x/mips%20for%20musl/near/227436952" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ariadne Conill <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/bootstrapping.20on.20s390x.2Fmips.20for.20musl.html#227436952">(Feb 23 2021 at 14:21)</a>:</h4>
<p><a href="https://tpaste.us/5V1M">https://tpaste.us/5V1M</a></p>



<a name="227437006"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/bootstrapping%20on%20s390x/mips%20for%20musl/near/227437006" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ariadne Conill <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/bootstrapping.20on.20s390x.2Fmips.20for.20musl.html#227437006">(Feb 23 2021 at 14:22)</a>:</h4>
<p>i assume there should be symbols in these</p>



<a name="227437089"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/bootstrapping%20on%20s390x/mips%20for%20musl/near/227437089" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ariadne Conill <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/bootstrapping.20on.20s390x.2Fmips.20for.20musl.html#227437089">(Feb 23 2021 at 14:22)</a>:</h4>
<p>other than libc crate which is incorporating musl's libc</p>



<a name="227437092"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/bootstrapping%20on%20s390x/mips%20for%20musl/near/227437092" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> simulacrum <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/bootstrapping.20on.20s390x.2Fmips.20for.20musl.html#227437092">(Feb 23 2021 at 14:22)</a>:</h4>
<p>which rlib is that?</p>



<a name="227437114"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/bootstrapping%20on%20s390x/mips%20for%20musl/near/227437114" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ariadne Conill <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/bootstrapping.20on.20s390x.2Fmips.20for.20musl.html#227437114">(Feb 23 2021 at 14:22)</a>:</h4>
<p>that is all of the rlibs</p>



<a name="227437129"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/bootstrapping%20on%20s390x/mips%20for%20musl/near/227437129" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ariadne Conill <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/bootstrapping.20on.20s390x.2Fmips.20for.20musl.html#227437129">(Feb 23 2021 at 14:22)</a>:</h4>
<p>literally i did nm *.rlib | tpaste</p>



<a name="227437157"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/bootstrapping%20on%20s390x/mips%20for%20musl/near/227437157" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> simulacrum <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/bootstrapping.20on.20s390x.2Fmips.20for.20musl.html#227437157">(Feb 23 2021 at 14:22)</a>:</h4>
<p>can you try on the equivalent of build/x86_64-unknown-linux-gnu/stage1-std/x86_64-unknown-linux-gnu/release/deps/libstd-8a326c40d2ce3e0b.rlib ?</p>



<a name="227437241"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/bootstrapping%20on%20s390x/mips%20for%20musl/near/227437241" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ariadne Conill <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/bootstrapping.20on.20s390x.2Fmips.20for.20musl.html#227437241">(Feb 23 2021 at 14:23)</a>:</h4>
<p>that doesn't exist</p>



<a name="227437260"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/bootstrapping%20on%20s390x/mips%20for%20musl/near/227437260" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ariadne Conill <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/bootstrapping.20on.20s390x.2Fmips.20for.20musl.html#227437260">(Feb 23 2021 at 14:23)</a>:</h4>
<p>there is no libstd.rlib</p>



<a name="227437281"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/bootstrapping%20on%20s390x/mips%20for%20musl/near/227437281" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> simulacrum <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/bootstrapping.20on.20s390x.2Fmips.20for.20musl.html#227437281">(Feb 23 2021 at 14:23)</a>:</h4>
<p>hm, right, because it's not linking</p>



<a name="227437285"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/bootstrapping%20on%20s390x/mips%20for%20musl/near/227437285" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ariadne Conill <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/bootstrapping.20on.20s390x.2Fmips.20for.20musl.html#227437285">(Feb 23 2021 at 14:23)</a>:</h4>
<p>i do have .o files that look equivalent</p>



<a name="227437373"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/bootstrapping%20on%20s390x/mips%20for%20musl/near/227437373" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> simulacrum <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/bootstrapping.20on.20s390x.2Fmips.20for.20musl.html#227437373">(Feb 23 2021 at 14:24)</a>:</h4>
<p>ah ok, so something like std-8a326c40d2ce3e0b.std.ee2dvkrm-cgu.0.rcgu.o?</p>



<a name="227437391"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/bootstrapping%20on%20s390x/mips%20for%20musl/near/227437391" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ariadne Conill <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/bootstrapping.20on.20s390x.2Fmips.20for.20musl.html#227437391">(Feb 23 2021 at 14:24)</a>:</h4>
<p><a href="https://tpaste.us/vZ95">https://tpaste.us/vZ95</a></p>



<a name="227437414"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/bootstrapping%20on%20s390x/mips%20for%20musl/near/227437414" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ariadne Conill <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/bootstrapping.20on.20s390x.2Fmips.20for.20musl.html#227437414">(Feb 23 2021 at 14:24)</a>:</h4>
<p><code>nm std*.o | tpaste</code></p>



<a name="227437454"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/bootstrapping%20on%20s390x/mips%20for%20musl/near/227437454" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> simulacrum <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/bootstrapping.20on.20s390x.2Fmips.20for.20musl.html#227437454">(Feb 23 2021 at 14:24)</a>:</h4>
<p>what directory is that in?</p>



<a name="227437495"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/bootstrapping%20on%20s390x/mips%20for%20musl/near/227437495" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> simulacrum <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/bootstrapping.20on.20s390x.2Fmips.20for.20musl.html#227437495">(Feb 23 2021 at 14:25)</a>:</h4>
<p>can you confirm that the same rlib/.o files for the working target don't see this behavior?</p>



<a name="227437507"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/bootstrapping%20on%20s390x/mips%20for%20musl/near/227437507" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ariadne Conill <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/bootstrapping.20on.20s390x.2Fmips.20for.20musl.html#227437507">(Feb 23 2021 at 14:25)</a>:</h4>
<p><code>build/x86_64-alpine-linux-musl/stage1-std/x86_64-alpine-linux-musl/release/deps</code></p>



<a name="227437557"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/bootstrapping%20on%20s390x/mips%20for%20musl/near/227437557" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ariadne Conill <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/bootstrapping.20on.20s390x.2Fmips.20for.20musl.html#227437557">(Feb 23 2021 at 14:25)</a>:</h4>
<p>sure, but i will have to blow everything away and rebuild again</p>



<a name="227437569"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/bootstrapping%20on%20s390x/mips%20for%20musl/near/227437569" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> simulacrum <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/bootstrapping.20on.20s390x.2Fmips.20for.20musl.html#227437569">(Feb 23 2021 at 14:25)</a>:</h4>
<p>hm</p>



<a name="227437580"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/bootstrapping%20on%20s390x/mips%20for%20musl/near/227437580" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> simulacrum <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/bootstrapping.20on.20s390x.2Fmips.20for.20musl.html#227437580">(Feb 23 2021 at 14:25)</a>:</h4>
<p>don't do that yet then</p>



<a name="227437606"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/bootstrapping%20on%20s390x/mips%20for%20musl/near/227437606" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> simulacrum <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/bootstrapping.20on.20s390x.2Fmips.20for.20musl.html#227437606">(Feb 23 2021 at 14:25)</a>:</h4>
<p>can you dump the target spec json for this target?</p>



<a name="227437745"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/bootstrapping%20on%20s390x/mips%20for%20musl/near/227437745" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ariadne Conill <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/bootstrapping.20on.20s390x.2Fmips.20for.20musl.html#227437745">(Feb 23 2021 at 14:26)</a>:</h4>
<p>too late i already did it</p>



<a name="227437752"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/bootstrapping%20on%20s390x/mips%20for%20musl/near/227437752" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> simulacrum <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/bootstrapping.20on.20s390x.2Fmips.20for.20musl.html#227437752">(Feb 23 2021 at 14:26)</a>:</h4>
<p>--print target-spec-json --target x86_64-alpine-linux-musl -Zunstable-options</p>



<a name="227437923"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/bootstrapping%20on%20s390x/mips%20for%20musl/near/227437923" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ariadne Conill <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/bootstrapping.20on.20s390x.2Fmips.20for.20musl.html#227437923">(Feb 23 2021 at 14:27)</a>:</h4>
<div class="codehilite"><pre><span></span><code>~/rust $ RUSTC_BOOTSTRAP=1 rustc -Z unstable-options --print target-spec-json --target mips64-unknown-linux-muslabi64
{
  &quot;arch&quot;: &quot;mips64&quot;,
  &quot;cpu&quot;: &quot;mips64r2&quot;,
  &quot;crt-static-respected&quot;: true,
  &quot;data-layout&quot;: &quot;E-m:e-i8:8:32-i16:16:32-i64:64-n32:64-S128&quot;,
  &quot;dynamic-linking&quot;: true,
  &quot;env&quot;: &quot;musl&quot;,
  &quot;executables&quot;: true,
  &quot;features&quot;: &quot;+mips64r2&quot;,
  &quot;has-elf-tls&quot;: true,
  &quot;has-rpath&quot;: true,
  &quot;is-builtin&quot;: true,
  &quot;linker-is-gnu&quot;: true,
  &quot;llvm-target&quot;: &quot;mips64-unknown-linux-musl&quot;,
  &quot;max-atomic-width&quot;: 64,
  &quot;os&quot;: &quot;linux&quot;,
  &quot;position-independent-executables&quot;: true,
  &quot;pre-link-args&quot;: {
    &quot;gcc&quot;: [
      &quot;-Wl,--as-needed&quot;,
      &quot;-Wl,-z,noexecstack&quot;
    ]
  },
  &quot;relro-level&quot;: &quot;full&quot;,
  &quot;target-endian&quot;: &quot;big&quot;,
  &quot;target-family&quot;: &quot;unix&quot;,
  &quot;target-mcount&quot;: &quot;_mcount&quot;,
  &quot;target-pointer-width&quot;: &quot;64&quot;
}
</code></pre></div>



<a name="227438111"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/bootstrapping%20on%20s390x/mips%20for%20musl/near/227438111" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ariadne Conill <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/bootstrapping.20on.20s390x.2Fmips.20for.20musl.html#227438111">(Feb 23 2021 at 14:28)</a>:</h4>
<div class="codehilite"><pre><span></span><code>~/rust $ RUSTC_BOOTSTRAP=1 rustc -Z unstable-options --print target-spec-json --target x86_64-alpine-linux-musl
{
  &quot;arch&quot;: &quot;x86_64&quot;,
  &quot;cpu&quot;: &quot;x86-64&quot;,
  &quot;crt-static-respected&quot;: true,
  &quot;data-layout&quot;: &quot;e-m:e-p270:32:32-p271:32:32-p272:64:64-i64:64-f80:128-n8:16:32:64-S128&quot;,
  &quot;dynamic-linking&quot;: true,
  &quot;env&quot;: &quot;musl&quot;,
  &quot;executables&quot;: true,
  &quot;has-elf-tls&quot;: true,
  &quot;has-rpath&quot;: true,
  &quot;is-builtin&quot;: true,
  &quot;linker-is-gnu&quot;: true,
  &quot;llvm-target&quot;: &quot;x86_64-alpine-linux-musl&quot;,
  &quot;max-atomic-width&quot;: 64,
  &quot;need-rpath&quot;: true,
  &quot;os&quot;: &quot;linux&quot;,
  &quot;position-independent-executables&quot;: true,
  &quot;pre-link-args&quot;: {
    &quot;gcc&quot;: [
      &quot;-Wl,--as-needed&quot;,
      &quot;-Wl,-z,noexecstack&quot;,
      &quot;-m64&quot;
    ]
  },
  &quot;relro-level&quot;: &quot;full&quot;,
  &quot;stack-probes&quot;: true,
  &quot;static-position-independent-executables&quot;: true,
  &quot;target-family&quot;: &quot;unix&quot;,
  &quot;target-pointer-width&quot;: &quot;64&quot;,
  &quot;vendor&quot;: &quot;alpine&quot;
}
</code></pre></div>



<a name="227438121"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/bootstrapping%20on%20s390x/mips%20for%20musl/near/227438121" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ariadne Conill <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/bootstrapping.20on.20s390x.2Fmips.20for.20musl.html#227438121">(Feb 23 2021 at 14:28)</a>:</h4>
<p>or do you want it from the bootstrap rustc</p>



<a name="227438193"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/bootstrapping%20on%20s390x/mips%20for%20musl/near/227438193" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> simulacrum <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/bootstrapping.20on.20s390x.2Fmips.20for.20musl.html#227438193">(Feb 23 2021 at 14:29)</a>:</h4>
<p>ideally from the stage1/bin/rustc, which is the one compiling stage1-std</p>



<a name="227438227"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/bootstrapping%20on%20s390x/mips%20for%20musl/near/227438227" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> simulacrum <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/bootstrapping.20on.20s390x.2Fmips.20for.20musl.html#227438227">(Feb 23 2021 at 14:29)</a>:</h4>
<p>it sounds like the bootstrap rustc does work for you</p>



<a name="227438310"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/bootstrapping%20on%20s390x/mips%20for%20musl/near/227438310" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ariadne Conill <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/bootstrapping.20on.20s390x.2Fmips.20for.20musl.html#227438310">(Feb 23 2021 at 14:29)</a>:</h4>
<p>ok, well right now i am building aarch64 again</p>



<a name="227438369"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/bootstrapping%20on%20s390x/mips%20for%20musl/near/227438369" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ariadne Conill <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/bootstrapping.20on.20s390x.2Fmips.20for.20musl.html#227438369">(Feb 23 2021 at 14:30)</a>:</h4>
<p>i'll stop it once it starts building stage1 std</p>



<a name="227438670"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/bootstrapping%20on%20s390x/mips%20for%20musl/near/227438670" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ariadne Conill <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/bootstrapping.20on.20s390x.2Fmips.20for.20musl.html#227438670">(Feb 23 2021 at 14:32)</a>:</h4>
<p>but yeah if the rlibs have no symbols that would be a problem :)</p>



<a name="227438944"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/bootstrapping%20on%20s390x/mips%20for%20musl/near/227438944" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nagisa <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/bootstrapping.20on.20s390x.2Fmips.20for.20musl.html#227438944">(Feb 23 2021 at 14:33)</a>:</h4>
<p><span class="user-mention" data-user-id="360752">@Ariadne Conill</span> you mentioned you can produce images/VMs to look at. I could take a short look at this if you had a gcloud image (or, I guess, a docker container with standard development environment) that I could create a gcloud VM from.</p>



<a name="227438951"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/bootstrapping%20on%20s390x/mips%20for%20musl/near/227438951" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> simulacrum <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/bootstrapping.20on.20s390x.2Fmips.20for.20musl.html#227438951">(Feb 23 2021 at 14:34)</a>:</h4>
<p>I honestly don't know what could cause that</p>



<a name="227439157"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/bootstrapping%20on%20s390x/mips%20for%20musl/near/227439157" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nagisa <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/bootstrapping.20on.20s390x.2Fmips.20for.20musl.html#227439157">(Feb 23 2021 at 14:35)</a>:</h4>
<p><code>rlib</code>s don't necessarily need to contain machine code, not for the rust libraries.</p>



<a name="227439231"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/bootstrapping%20on%20s390x/mips%20for%20musl/near/227439231" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> simulacrum <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/bootstrapping.20on.20s390x.2Fmips.20for.20musl.html#227439231">(Feb 23 2021 at 14:36)</a>:</h4>
<p>hm, but if they have .o they should, right? I'd expect there's cases where they're "just mir" but then that's all in metadata I'd expect?</p>



<a name="227439410"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/bootstrapping%20on%20s390x/mips%20for%20musl/near/227439410" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nagisa <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/bootstrapping.20on.20s390x.2Fmips.20for.20musl.html#227439410">(Feb 23 2021 at 14:37)</a>:</h4>
<p>Not necessarily. I mean, it does make sense to me that you'd see _some_ rust symbols, especially for libstd, but if the crate is all generics, the codegen units can very well be just empty.</p>



<a name="227439444"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/bootstrapping%20on%20s390x/mips%20for%20musl/near/227439444" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> simulacrum <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/bootstrapping.20on.20s390x.2Fmips.20for.20musl.html#227439444">(Feb 23 2021 at 14:37)</a>:</h4>
<p>ah, sure, yeah</p>



<a name="227439480"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/bootstrapping%20on%20s390x/mips%20for%20musl/near/227439480" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> simulacrum <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/bootstrapping.20on.20s390x.2Fmips.20for.20musl.html#227439480">(Feb 23 2021 at 14:37)</a>:</h4>
<p>but these rust allocator symbols are definitely non-generic</p>



<a name="227439968"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/bootstrapping%20on%20s390x/mips%20for%20musl/near/227439968" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nagisa <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/bootstrapping.20on.20s390x.2Fmips.20for.20musl.html#227439968">(Feb 23 2021 at 14:40)</a>:</h4>
<p>I wonder if it helps if you compile with -Ccodegen-units=1</p>



<a name="227440023"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/bootstrapping%20on%20s390x/mips%20for%20musl/near/227440023" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ariadne Conill <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/bootstrapping.20on.20s390x.2Fmips.20for.20musl.html#227440023">(Feb 23 2021 at 14:41)</a>:</h4>
<p>how do i do that</p>



<a name="227440529"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/bootstrapping%20on%20s390x/mips%20for%20musl/near/227440529" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nagisa <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/bootstrapping.20on.20s390x.2Fmips.20for.20musl.html#227440529">(Feb 23 2021 at 14:42)</a>:</h4>
<p>There're <code>codegen-units</code> and <code>codegen-units-std</code> settings in config.toml, I think you can set those through something like <code>--set rust.codegen-units-std=1</code> if you're using <code>./configure</code>?</p>



<a name="227440535"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/bootstrapping%20on%20s390x/mips%20for%20musl/near/227440535" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joshua Nelson <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/bootstrapping.20on.20s390x.2Fmips.20for.20musl.html#227440535">(Feb 23 2021 at 14:42)</a>:</h4>
<p><code>RUSTFLAGS_NOT_BOOTSTRAP=-Ccodegen-units=1</code></p>



<a name="227440549"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/bootstrapping%20on%20s390x/mips%20for%20musl/near/227440549" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joshua Nelson <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/bootstrapping.20on.20s390x.2Fmips.20for.20musl.html#227440549">(Feb 23 2021 at 14:42)</a>:</h4>
<p>oh or that lol</p>



<a name="227441007"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/bootstrapping%20on%20s390x/mips%20for%20musl/near/227441007" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ariadne Conill <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/bootstrapping.20on.20s390x.2Fmips.20for.20musl.html#227441007">(Feb 23 2021 at 14:44)</a>:</h4>
<p>what does codegen-units do</p>



<a name="227441115"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/bootstrapping%20on%20s390x/mips%20for%20musl/near/227441115" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nagisa <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/bootstrapping.20on.20s390x.2Fmips.20for.20musl.html#227441115">(Feb 23 2021 at 14:44)</a>:</h4>
<p>it configures into how many <code>.o</code> to split a crate into when building a crate.</p>



<a name="227441187"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/bootstrapping%20on%20s390x/mips%20for%20musl/near/227441187" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nagisa <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/bootstrapping.20on.20s390x.2Fmips.20for.20musl.html#227441187">(Feb 23 2021 at 14:45)</a>:</h4>
<p>For parallelization purposes.</p>



<a name="227441238"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/bootstrapping%20on%20s390x/mips%20for%20musl/near/227441238" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ariadne Conill <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/bootstrapping.20on.20s390x.2Fmips.20for.20musl.html#227441238">(Feb 23 2021 at 14:45)</a>:</h4>
<p>ah</p>



<a name="227441341"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/bootstrapping%20on%20s390x/mips%20for%20musl/near/227441341" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nagisa <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/bootstrapping.20on.20s390x.2Fmips.20for.20musl.html#227441341">(Feb 23 2021 at 14:45)</a>:</h4>
<p>Another shot in the dark is to set <code>-Clink-dead-code</code> that should enable eager monomorphization collection.</p>



<a name="227441484"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/bootstrapping%20on%20s390x/mips%20for%20musl/near/227441484" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nagisa <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/bootstrapping.20on.20s390x.2Fmips.20for.20musl.html#227441484">(Feb 23 2021 at 14:46)</a>:</h4>
<p>(I don't think that has a config.toml option, so you'd need to use environment)</p>



<a name="227442077"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/bootstrapping%20on%20s390x/mips%20for%20musl/near/227442077" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ariadne Conill <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/bootstrapping.20on.20s390x.2Fmips.20for.20musl.html#227442077">(Feb 23 2021 at 14:49)</a>:</h4>
<p>gonna try codegen-units=1</p>



<a name="227442971"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/bootstrapping%20on%20s390x/mips%20for%20musl/near/227442971" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ariadne Conill <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/bootstrapping.20on.20s390x.2Fmips.20for.20musl.html#227442971">(Feb 23 2021 at 14:54)</a>:</h4>
<p>void linux uses codegen-units=1 so it may be related</p>



<a name="227443078"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/bootstrapping%20on%20s390x/mips%20for%20musl/near/227443078" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> simulacrum <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/bootstrapping.20on.20s390x.2Fmips.20for.20musl.html#227443078">(Feb 23 2021 at 14:55)</a>:</h4>
<p>all of rust's ci also builds std with 1 codegen unit fwiw, so it's not impossible not doing so may cause some unexpected behavior</p>



<a name="227443112"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/bootstrapping%20on%20s390x/mips%20for%20musl/near/227443112" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> simulacrum <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/bootstrapping.20on.20s390x.2Fmips.20for.20musl.html#227443112">(Feb 23 2021 at 14:55)</a>:</h4>
<p>(though it's a bug if that's the case)</p>



<a name="227443227"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/bootstrapping%20on%20s390x/mips%20for%20musl/near/227443227" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nagisa <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/bootstrapping.20on.20s390x.2Fmips.20for.20musl.html#227443227">(Feb 23 2021 at 14:56)</a>:</h4>
<p>codegen-units-std is 1 by default it seems.</p>



<a name="227443286"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/bootstrapping%20on%20s390x/mips%20for%20musl/near/227443286" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> simulacrum <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/bootstrapping.20on.20s390x.2Fmips.20for.20musl.html#227443286">(Feb 23 2021 at 14:56)</a>:</h4>
<p>hm? CI sets it explicitly, but I don't think it's the default. I might be misremembering</p>



<a name="227443342"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/bootstrapping%20on%20s390x/mips%20for%20musl/near/227443342" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nagisa <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/bootstrapping.20on.20s390x.2Fmips.20for.20musl.html#227443342">(Feb 23 2021 at 14:57)</a>:</h4>
<p>that's what it shows up as a commented out option in my config.toml.</p>



<a name="227443357"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/bootstrapping%20on%20s390x/mips%20for%20musl/near/227443357" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ariadne Conill <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/bootstrapping.20on.20s390x.2Fmips.20for.20musl.html#227443357">(Feb 23 2021 at 14:57)</a>:</h4>
<p>weird</p>



<a name="227443426"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/bootstrapping%20on%20s390x/mips%20for%20musl/near/227443426" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> simulacrum <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/bootstrapping.20on.20s390x.2Fmips.20for.20musl.html#227443426">(Feb 23 2021 at 14:57)</a>:</h4>
<p><span class="user-mention silent" data-user-id="123586">nagisa</span> <a href="#narrow/stream/131828-t-compiler/topic/bootstrapping.20on.20s390x.2Fmips.20for.20musl/near/227443342">said</a>:</p>
<blockquote>
<p>that's what it shows up as a commented out option in my config.toml.</p>
</blockquote>
<p>yeah it's num cpus by default afaict</p>



<a name="227443656"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/bootstrapping%20on%20s390x/mips%20for%20musl/near/227443656" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ariadne Conill <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/bootstrapping.20on.20s390x.2Fmips.20for.20musl.html#227443656">(Feb 23 2021 at 14:59)</a>:</h4>
<p>its strange though.  aarch64 was crossing reliably, so i am not sure this is it</p>



<a name="227443682"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/bootstrapping%20on%20s390x/mips%20for%20musl/near/227443682" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ariadne Conill <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/bootstrapping.20on.20s390x.2Fmips.20for.20musl.html#227443682">(Feb 23 2021 at 14:59)</a>:</h4>
<p>we will see</p>



<a name="227443697"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/bootstrapping%20on%20s390x/mips%20for%20musl/near/227443697" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ariadne Conill <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/bootstrapping.20on.20s390x.2Fmips.20for.20musl.html#227443697">(Feb 23 2021 at 14:59)</a>:</h4>
<p>then again, i was skeptical on x.py dist</p>



<a name="227447462"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/bootstrapping%20on%20s390x/mips%20for%20musl/near/227447462" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> bjorn3 <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/bootstrapping.20on.20s390x.2Fmips.20for.20musl.html#227447462">(Feb 23 2021 at 15:22)</a>:</h4>
<p>What are the missing symbols? There are too much messages in this thread to find it again.</p>



<a name="227447757"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/bootstrapping%20on%20s390x/mips%20for%20musl/near/227447757" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> bjorn3 <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/bootstrapping.20on.20s390x.2Fmips.20for.20musl.html#227447757">(Feb 23 2021 at 15:24)</a>:</h4>
<p><span class="user-mention" data-user-id="360752">@Ariadne Conill</span></p>



<a name="227448072"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/bootstrapping%20on%20s390x/mips%20for%20musl/near/227448072" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joshua Nelson <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/bootstrapping.20on.20s390x.2Fmips.20for.20musl.html#227448072">(Feb 23 2021 at 15:26)</a>:</h4>
<p><span class="user-mention" data-user-id="133247">@bjorn3</span> __rdl_alloc and a few more allocator symbols</p>



<a name="227448545"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/bootstrapping%20on%20s390x/mips%20for%20musl/near/227448545" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ariadne Conill <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/bootstrapping.20on.20s390x.2Fmips.20for.20musl.html#227448545">(Feb 23 2021 at 15:29)</a>:</h4>
<p>i can tell you that codegen-units-std is definitely not default to 1</p>



<a name="227448567"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/bootstrapping%20on%20s390x/mips%20for%20musl/near/227448567" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ariadne Conill <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/bootstrapping.20on.20s390x.2Fmips.20for.20musl.html#227448567">(Feb 23 2021 at 15:30)</a>:</h4>
<p>this is a lot slower</p>



<a name="227448658"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/bootstrapping%20on%20s390x/mips%20for%20musl/near/227448658" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> bjorn3 <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/bootstrapping.20on.20s390x.2Fmips.20for.20musl.html#227448658">(Feb 23 2021 at 15:30)</a>:</h4>
<p>Huh, <a href="https://tpaste.us/vZ95">https://tpaste.us/vZ95</a> lists literally no symbols except for inside the allocator shim. The allocator shim is where <code>__rdl_alloc</code> and others are used.</p>



<a name="227448683"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/bootstrapping%20on%20s390x/mips%20for%20musl/near/227448683" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ariadne Conill <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/bootstrapping.20on.20s390x.2Fmips.20for.20musl.html#227448683">(Feb 23 2021 at 15:30)</a>:</h4>
<p>yeah, this is hella confusing to everyone :)</p>



<a name="227449133"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/bootstrapping%20on%20s390x/mips%20for%20musl/near/227449133" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> bjorn3 <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/bootstrapping.20on.20s390x.2Fmips.20for.20musl.html#227449133">(Feb 23 2021 at 15:33)</a>:</h4>
<p>Can you try compiling <a href="https://github.com/bjorn3/rustc_codegen_cranelift/blob/c24744657021aa20bb577eb0e23cc8dcee55805c/example/mini_core.rs">https://github.com/bjorn3/rustc_codegen_cranelift/blob/c24744657021aa20bb577eb0e23cc8dcee55805c/example/mini_core.rs</a> using the compiler that gives the empty object files for the target for which it gives empty object files? Does it contain any symbols? If not can you send it to me, so I can take a look?</p>



<a name="227452645"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/bootstrapping%20on%20s390x/mips%20for%20musl/near/227452645" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ariadne Conill <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/bootstrapping.20on.20s390x.2Fmips.20for.20musl.html#227452645">(Feb 23 2021 at 15:54)</a>:</h4>
<p>if i wind up with a new compiler that does that, sure</p>



<a name="227464656"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/bootstrapping%20on%20s390x/mips%20for%20musl/near/227464656" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ariadne Conill <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/bootstrapping.20on.20s390x.2Fmips.20for.20musl.html#227464656">(Feb 23 2021 at 16:57)</a>:</h4>
<p><a href="https://tpaste.us/W7zB">https://tpaste.us/W7zB</a></p>



<a name="227464689"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/bootstrapping%20on%20s390x/mips%20for%20musl/near/227464689" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ariadne Conill <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/bootstrapping.20on.20s390x.2Fmips.20for.20musl.html#227464689">(Feb 23 2021 at 16:57)</a>:</h4>
<p>we got a bit farther this time with codegen-units=1</p>



<a name="227464819"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/bootstrapping%20on%20s390x/mips%20for%20musl/near/227464819" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ariadne Conill <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/bootstrapping.20on.20s390x.2Fmips.20for.20musl.html#227464819">(Feb 23 2021 at 16:58)</a>:</h4>
<p>namely, std built</p>



<a name="227464836"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/bootstrapping%20on%20s390x/mips%20for%20musl/near/227464836" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joshua Nelson <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/bootstrapping.20on.20s390x.2Fmips.20for.20musl.html#227464836">(Feb 23 2021 at 16:58)</a>:</h4>
<p>ok that's a very good sign</p>



<a name="227464886"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/bootstrapping%20on%20s390x/mips%20for%20musl/near/227464886" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joshua Nelson <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/bootstrapping.20on.20s390x.2Fmips.20for.20musl.html#227464886">(Feb 23 2021 at 16:58)</a>:</h4>
<p>that's "just" a bug in some library that assumed <code>c_int</code> is 64 bits</p>



<a name="227465952"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/bootstrapping%20on%20s390x/mips%20for%20musl/near/227465952" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nagisa <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/bootstrapping.20on.20s390x.2Fmips.20for.20musl.html#227465952">(Feb 23 2021 at 17:05)</a>:</h4>
<p>This is actually trying to cross-compile now.</p>



<a name="227465979"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/bootstrapping%20on%20s390x/mips%20for%20musl/near/227465979" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nagisa <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/bootstrapping.20on.20s390x.2Fmips.20for.20musl.html#227465979">(Feb 23 2021 at 17:05)</a>:</h4>
<p>so its "just" broken libraries in the ecosystem that need fixing.</p>



<a name="227466009"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/bootstrapping%20on%20s390x/mips%20for%20musl/near/227466009" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Alex Gaynor <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/bootstrapping.20on.20s390x.2Fmips.20for.20musl.html#227466009">(Feb 23 2021 at 17:05)</a>:</h4>
<p>So there's a bug with codegen units?</p>



<a name="227466216"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/bootstrapping%20on%20s390x/mips%20for%20musl/near/227466216" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joshua Nelson <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/bootstrapping.20on.20s390x.2Fmips.20for.20musl.html#227466216">(Feb 23 2021 at 17:07)</a>:</h4>
<p><span class="user-mention silent" data-user-id="130046">Alex Gaynor</span> <a href="#narrow/stream/131828-t-compiler/topic/bootstrapping.20on.20s390x.2Fmips.20for.20musl/near/227466009">said</a>:</p>
<blockquote>
<p>So there's a bug with codegen units?</p>
</blockquote>
<p>I can mention this as part of <a href="#narrow/stream/131828-t-compiler/topic/bootstrap.20defaults">https://rust-lang.zulipchat.com/#narrow/stream/131828-t-compiler/topic/bootstrap.20defaults</a></p>



<a name="227466294"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/bootstrapping%20on%20s390x/mips%20for%20musl/near/227466294" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jubilee <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/bootstrapping.20on.20s390x.2Fmips.20for.20musl.html#227466294">(Feb 23 2021 at 17:07)</a>:</h4>
<p><span class="user-mention" data-user-id="232545">@Joshua Nelson</span> It's not assuming a c_int is 64 bits, it's assuming a const that has a varying C-type based on platform, according to our libc libraries, is 64 bits.</p>



<a name="227466374"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/bootstrapping%20on%20s390x/mips%20for%20musl/near/227466374" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jubilee <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/bootstrapping.20on.20s390x.2Fmips.20for.20musl.html#227466374">(Feb 23 2021 at 17:08)</a>:</h4>
<p>so either our libc bindings are wrong or the library is, and I'm checking on which it is now.</p>



<a name="227466608"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/bootstrapping%20on%20s390x/mips%20for%20musl/near/227466608" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jubilee <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/bootstrapping.20on.20s390x.2Fmips.20for.20musl.html#227466608">(Feb 23 2021 at 17:09)</a>:</h4>
<p>Ah, this issue was previously patched and our libc bindings are correct here, so time to file a bug against termize. Or just fix it.</p>



<a name="227466743"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/bootstrapping%20on%20s390x/mips%20for%20musl/near/227466743" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joshua Nelson <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/bootstrapping.20on.20s390x.2Fmips.20for.20musl.html#227466743">(Feb 23 2021 at 17:10)</a>:</h4>
<p>what do you mean by patched?</p>



<a name="227467514"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/bootstrapping%20on%20s390x/mips%20for%20musl/near/227467514" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jubilee <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/bootstrapping.20on.20s390x.2Fmips.20for.20musl.html#227467514">(Feb 23 2021 at 17:15)</a>:</h4>
<p>Er, sorry. I meant that the issue has previously come up on the libc crate and someone fixed it there then, but termize did not adjust, as a dependent, to the different possible rules re: function signature.</p>



<a name="227469254"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/bootstrapping%20on%20s390x/mips%20for%20musl/near/227469254" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jubilee <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/bootstrapping.20on.20s390x.2Fmips.20for.20musl.html#227469254">(Feb 23 2021 at 17:26)</a>:</h4>
<p>...the constant that is being coerced into the function signature seems to even have a different C-type based on platform, that can also change independently of the function signature.</p>



<a name="227474275"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/bootstrapping%20on%20s390x/mips%20for%20musl/near/227474275" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jubilee <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/bootstrapping.20on.20s390x.2Fmips.20for.20musl.html#227474275">(Feb 23 2021 at 17:56)</a>:</h4>
<p>...no, wait, maybe the issue is in our libc bindings, the C-type was changed for some platforms and not others.</p>



<a name="227478708"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/bootstrapping%20on%20s390x/mips%20for%20musl/near/227478708" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ariadne Conill <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/bootstrapping.20on.20s390x.2Fmips.20for.20musl.html#227478708">(Feb 23 2021 at 18:23)</a>:</h4>
<p>:D</p>



<a name="227478841"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/bootstrapping%20on%20s390x/mips%20for%20musl/near/227478841" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ariadne Conill <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/bootstrapping.20on.20s390x.2Fmips.20for.20musl.html#227478841">(Feb 23 2021 at 18:24)</a>:</h4>
<p>i had to step away from this for the past hour, there were some technical difficulties with this cumulus linux garbage switches i thought were a good purchase decision</p>



<a name="227479642"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/bootstrapping%20on%20s390x/mips%20for%20musl/near/227479642" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jubilee <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/bootstrapping.20on.20s390x.2Fmips.20for.20musl.html#227479642">(Feb 23 2021 at 18:29)</a>:</h4>
<p><span class="user-mention" data-user-id="360752">@Ariadne Conill</span> You don't happen to know off the top of your head why TIOCGWINSZ is so much more _interesting_ on mips64-musl than on, say, aarch64-musl?</p>



<a name="227479907"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/bootstrapping%20on%20s390x/mips%20for%20musl/near/227479907" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ariadne Conill <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/bootstrapping.20on.20s390x.2Fmips.20for.20musl.html#227479907">(Feb 23 2021 at 18:30)</a>:</h4>
<p>i remember encountering a similar issue but do not remember the details</p>



<a name="227479914"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/bootstrapping%20on%20s390x/mips%20for%20musl/near/227479914" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ariadne Conill <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/bootstrapping.20on.20s390x.2Fmips.20for.20musl.html#227479914">(Feb 23 2021 at 18:30)</a>:</h4>
<p>sorry :)</p>



<a name="227492632"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/bootstrapping%20on%20s390x/mips%20for%20musl/near/227492632" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jubilee <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/bootstrapping.20on.20s390x.2Fmips.20for.20musl.html#227492632">(Feb 23 2021 at 19:52)</a>:</h4>
<p>alright, opened <a href="https://github.com/rust-lang/libc/pull/2078">https://github.com/rust-lang/libc/pull/2078</a></p>



<a name="227493793"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/bootstrapping%20on%20s390x/mips%20for%20musl/near/227493793" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ariadne Conill <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/bootstrapping.20on.20s390x.2Fmips.20for.20musl.html#227493793">(Feb 23 2021 at 19:59)</a>:</h4>
<p>cool, i'll turn that into a patch against the vendored libc crates</p>



<a name="227495311"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/bootstrapping%20on%20s390x/mips%20for%20musl/near/227495311" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jubilee <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/bootstrapping.20on.20s390x.2Fmips.20for.20musl.html#227495311">(Feb 23 2021 at 20:09)</a>:</h4>
<p>....Hm, might've messed up. That'd be fun.</p>



<a name="227495438"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/bootstrapping%20on%20s390x/mips%20for%20musl/near/227495438" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ariadne Conill <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/bootstrapping.20on.20s390x.2Fmips.20for.20musl.html#227495438">(Feb 23 2021 at 20:10)</a>:</h4>
<p>i'm waiting on it to be ack'd first :P</p>



<a name="227498847"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/bootstrapping%20on%20s390x/mips%20for%20musl/near/227498847" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jubilee <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/bootstrapping.20on.20s390x.2Fmips.20for.20musl.html#227498847">(Feb 23 2021 at 20:33)</a>:</h4>
<p>Hmm, the math is correct, but musl is still expecting a c_int, but the range of the values of 0x8...etc. are out of range for an i32 (which is expecting only 0x7FFFFFFF at most), so those need to be persuaded they're bitfields first, and <strong>then</strong> cast to i32, isn't type coercion fun. :D</p>



<a name="227503162"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/bootstrapping%20on%20s390x/mips%20for%20musl/near/227503162" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jubilee <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/bootstrapping.20on.20s390x.2Fmips.20for.20musl.html#227503162">(Feb 23 2021 at 21:05)</a>:</h4>
<p>but if you print it back out using <code>:x</code> formatting, even though it's an i32, it prints the same hex value as C would because of course it does. :D</p>



<a name="227503888"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/bootstrapping%20on%20s390x/mips%20for%20musl/near/227503888" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nagisa <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/bootstrapping.20on.20s390x.2Fmips.20for.20musl.html#227503888">(Feb 23 2021 at 21:10)</a>:</h4>
<p>using i32 and then setting its sign bit for a bitmask seems super weird.</p>



<a name="227505069"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/bootstrapping%20on%20s390x/mips%20for%20musl/near/227505069" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jubilee <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/bootstrapping.20on.20s390x.2Fmips.20for.20musl.html#227505069">(Feb 23 2021 at 21:19)</a>:</h4>
<p>That is why I almost didn't fix it in the PR, but then I caught it :D</p>



<a name="227513093"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/bootstrapping%20on%20s390x/mips%20for%20musl/near/227513093" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jubilee <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/bootstrapping.20on.20s390x.2Fmips.20for.20musl.html#227513093">(Feb 23 2021 at 22:09)</a>:</h4>
<p><span class="user-mention" data-user-id="360752">@Ariadne Conill</span> it has been acked and merged, can you check if that gives us the goods?</p>



<a name="227513694"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/bootstrapping%20on%20s390x/mips%20for%20musl/near/227513694" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jubilee <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/bootstrapping.20on.20s390x.2Fmips.20for.20musl.html#227513694">(Feb 23 2021 at 22:12)</a>:</h4>
<p>Feel free to throw rotten tomatos at me if libc needs further patching.</p>



<a name="227514177"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/bootstrapping%20on%20s390x/mips%20for%20musl/near/227514177" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Alex Gaynor <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/bootstrapping.20on.20s390x.2Fmips.20for.20musl.html#227514177">(Feb 23 2021 at 22:14)</a>:</h4>
<p>It's not actually merged yet, but will be in a few minutes :-)</p>



<a name="227514226"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/bootstrapping%20on%20s390x/mips%20for%20musl/near/227514226" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jubilee <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/bootstrapping.20on.20s390x.2Fmips.20for.20musl.html#227514226">(Feb 23 2021 at 22:14)</a>:</h4>
<p>oh right</p>



<a name="227514265"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/bootstrapping%20on%20s390x/mips%20for%20musl/near/227514265" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jubilee <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/bootstrapping.20on.20s390x.2Fmips.20for.20musl.html#227514265">(Feb 23 2021 at 22:15)</a>:</h4>
<p>it's in the bors queue! SAME DIFFERENCE!!!! <em>cough</em> (no)</p>



<a name="227523526"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/bootstrapping%20on%20s390x/mips%20for%20musl/near/227523526" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ariadne Conill <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/bootstrapping.20on.20s390x.2Fmips.20for.20musl.html#227523526">(Feb 23 2021 at 23:33)</a>:</h4>
<p>@Jubilee i'll check it in a little while, i have been dealing with this cumulus issue all day</p>



<a name="227523646"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/bootstrapping%20on%20s390x/mips%20for%20musl/near/227523646" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nagisa <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/bootstrapping.20on.20s390x.2Fmips.20for.20musl.html#227523646">(Feb 23 2021 at 23:34)</a>:</h4>
<p>I've been oscillating between "codegen-units=1 fixing this makes no sense" and "of course codegen-units=1 fixes this, duh" the entire day today.</p>



<a name="227523685"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/bootstrapping%20on%20s390x/mips%20for%20musl/near/227523685" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ariadne Conill <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/bootstrapping.20on.20s390x.2Fmips.20for.20musl.html#227523685">(Feb 23 2021 at 23:35)</a>:</h4>
<p>yes, it shouldn't have fixed it</p>



<a name="227523690"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/bootstrapping%20on%20s390x/mips%20for%20musl/near/227523690" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ariadne Conill <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/bootstrapping.20on.20s390x.2Fmips.20for.20musl.html#227523690">(Feb 23 2021 at 23:35)</a>:</h4>
<p>but it appears to have</p>



<a name="227523815"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/bootstrapping%20on%20s390x/mips%20for%20musl/near/227523815" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nagisa <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/bootstrapping.20on.20s390x.2Fmips.20for.20musl.html#227523815">(Feb 23 2021 at 23:36)</a>:</h4>
<p>I think I have a vague idea why it did, probably has to do something with symbol visibility.</p>



<a name="227524138"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/bootstrapping%20on%20s390x/mips%20for%20musl/near/227524138" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ariadne Conill <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/bootstrapping.20on.20s390x.2Fmips.20for.20musl.html#227524138">(Feb 23 2021 at 23:39)</a>:</h4>
<p>ok patched those crates up</p>



<a name="227524225"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/bootstrapping%20on%20s390x/mips%20for%20musl/near/227524225" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ariadne Conill <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/bootstrapping.20on.20s390x.2Fmips.20for.20musl.html#227524225">(Feb 23 2021 at 23:40)</a>:</h4>
<p>did not appear to do anything</p>



<a name="227524234"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/bootstrapping%20on%20s390x/mips%20for%20musl/near/227524234" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ariadne Conill <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/bootstrapping.20on.20s390x.2Fmips.20for.20musl.html#227524234">(Feb 23 2021 at 23:40)</a>:</h4>
<p>do i need to rebuild from scratch?</p>



<a name="227524308"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/bootstrapping%20on%20s390x/mips%20for%20musl/near/227524308" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joshua Nelson <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/bootstrapping.20on.20s390x.2Fmips.20for.20musl.html#227524308">(Feb 23 2021 at 23:41)</a>:</h4>
<p>hmm cargo may be caching the output</p>



<a name="227524399"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/bootstrapping%20on%20s390x/mips%20for%20musl/near/227524399" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joshua Nelson <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/bootstrapping.20on.20s390x.2Fmips.20for.20musl.html#227524399">(Feb 23 2021 at 23:42)</a>:</h4>
<p>try <code>touch compiler/rustc_apfloat/src/lib.rs</code> maybe?</p>



<a name="227524440"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/bootstrapping%20on%20s390x/mips%20for%20musl/near/227524440" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joshua Nelson <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/bootstrapping.20on.20s390x.2Fmips.20for.20musl.html#227524440">(Feb 23 2021 at 23:42)</a>:</h4>
<p>err I guess that hurts the stage0 build cache too</p>



<a name="227524490"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/bootstrapping%20on%20s390x/mips%20for%20musl/near/227524490" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joshua Nelson <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/bootstrapping.20on.20s390x.2Fmips.20for.20musl.html#227524490">(Feb 23 2021 at 23:43)</a>:</h4>
<p><code>rm -r build/$mips-target-name/stage1-rustc</code> might work without rebuilding the stage1 compiler</p>



<a name="227524539"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/bootstrapping%20on%20s390x/mips%20for%20musl/near/227524539" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ariadne Conill <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/bootstrapping.20on.20s390x.2Fmips.20for.20musl.html#227524539">(Feb 23 2021 at 23:43)</a>:</h4>
<p>oh well, plenty of tim</p>



<a name="227524544"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/bootstrapping%20on%20s390x/mips%20for%20musl/near/227524544" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joshua Nelson <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/bootstrapping.20on.20s390x.2Fmips.20for.20musl.html#227524544">(Feb 23 2021 at 23:43)</a>:</h4>
<p>(the terminology is really bad, sorry: <a href="https://rustc-dev-guide.rust-lang.org/building/bootstrapping.html#understanding-stages-of-bootstrap">https://rustc-dev-guide.rust-lang.org/building/bootstrapping.html#understanding-stages-of-bootstrap</a>)</p>



<a name="227524546"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/bootstrapping%20on%20s390x/mips%20for%20musl/near/227524546" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ariadne Conill <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/bootstrapping.20on.20s390x.2Fmips.20for.20musl.html#227524546">(Feb 23 2021 at 23:43)</a>:</h4>
<p>e</p>



<a name="227531434"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/bootstrapping%20on%20s390x/mips%20for%20musl/near/227531434" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ariadne Conill <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/bootstrapping.20on.20s390x.2Fmips.20for.20musl.html#227531434">(Feb 24 2021 at 00:52)</a>:</h4>
<p>how do you all propose i patch the libc crate</p>



<a name="227531440"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/bootstrapping%20on%20s390x/mips%20for%20musl/near/227531440" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ariadne Conill <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/bootstrapping.20on.20s390x.2Fmips.20for.20musl.html#227531440">(Feb 24 2021 at 00:52)</a>:</h4>
<p>i do not wish to deal with vendoring</p>



<a name="227532093"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/bootstrapping%20on%20s390x/mips%20for%20musl/near/227532093" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jubilee <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/bootstrapping.20on.20s390x.2Fmips.20for.20musl.html#227532093">(Feb 24 2021 at 01:01)</a>:</h4>
<p><span class="user-mention" data-user-id="360752">@Ariadne Conill</span> I am not sure what you are asking exactly but you may be interested in <a href="https://doc.rust-lang.org/cargo/reference/overriding-dependencies.html">https://doc.rust-lang.org/cargo/reference/overriding-dependencies.html</a></p>



<a name="227532186"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/bootstrapping%20on%20s390x/mips%20for%20musl/near/227532186" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ariadne Conill <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/bootstrapping.20on.20s390x.2Fmips.20for.20musl.html#227532186">(Feb 24 2021 at 01:02)</a>:</h4>
<p>oh my god</p>



<a name="227532254"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/bootstrapping%20on%20s390x/mips%20for%20musl/near/227532254" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ariadne Conill <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/bootstrapping.20on.20s390x.2Fmips.20for.20musl.html#227532254">(Feb 24 2021 at 01:03)</a>:</h4>
<p>this is so not workable for distros</p>



<a name="227532328"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/bootstrapping%20on%20s390x/mips%20for%20musl/near/227532328" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ariadne Conill <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/bootstrapping.20on.20s390x.2Fmips.20for.20musl.html#227532328">(Feb 24 2021 at 01:04)</a>:</h4>
<p>here is what distros do: we have .patch files.  we patch things.</p>



<a name="227532368"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/bootstrapping%20on%20s390x/mips%20for%20musl/near/227532368" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ariadne Conill <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/bootstrapping.20on.20s390x.2Fmips.20for.20musl.html#227532368">(Feb 24 2021 at 01:04)</a>:</h4>
<p>here is what rust did: came up with an entirely different workflow that completely ruins that</p>



<a name="227532410"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/bootstrapping%20on%20s390x/mips%20for%20musl/near/227532410" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ariadne Conill <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/bootstrapping.20on.20s390x.2Fmips.20for.20musl.html#227532410">(Feb 24 2021 at 01:05)</a>:</h4>
<p>i have a .patch file.  i want to apply it.  i want cargo to do what i say instead of making me appease IT.</p>



<a name="227532467"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/bootstrapping%20on%20s390x/mips%20for%20musl/near/227532467" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ariadne Conill <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/bootstrapping.20on.20s390x.2Fmips.20for.20musl.html#227532467">(Feb 24 2021 at 01:06)</a>:</h4>
<p>i want to turn off checksum verification.  that is what i want.</p>



<a name="227532661"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/bootstrapping%20on%20s390x/mips%20for%20musl/near/227532661" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ariadne Conill <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/bootstrapping.20on.20s390x.2Fmips.20for.20musl.html#227532661">(Feb 24 2021 at 01:08)</a>:</h4>
<p>how do i turn off the checksum verification</p>



<a name="227532861"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/bootstrapping%20on%20s390x/mips%20for%20musl/near/227532861" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ariadne Conill <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/bootstrapping.20on.20s390x.2Fmips.20for.20musl.html#227532861">(Feb 24 2021 at 01:11)</a>:</h4>
<p>every step of the way, these rust tools have fought me</p>



<a name="227532918"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/bootstrapping%20on%20s390x/mips%20for%20musl/near/227532918" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ariadne Conill <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/bootstrapping.20on.20s390x.2Fmips.20for.20musl.html#227532918">(Feb 24 2021 at 01:11)</a>:</h4>
<p>it is the same attitude as systemd.  rust devs know best for all use cases.</p>



<a name="227533029"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/bootstrapping%20on%20s390x/mips%20for%20musl/near/227533029" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jubilee <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/bootstrapping.20on.20s390x.2Fmips.20for.20musl.html#227533029">(Feb 24 2021 at 01:12)</a>:</h4>
<p>...I am pretty sure the [patch] table and pointing it to a local repo actually does effectively disable checksum verification, or at least, inform it you only care about what's in that repo.</p>



<a name="227533040"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/bootstrapping%20on%20s390x/mips%20for%20musl/near/227533040" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ariadne Conill <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/bootstrapping.20on.20s390x.2Fmips.20for.20musl.html#227533040">(Feb 24 2021 at 01:13)</a>:</h4>
<p>and now, to PATCH something, i have to COPY THE ENTIRE CRATE, AND EDIT A BUNCH OF CONFIG FILES</p>



<a name="227533108"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/bootstrapping%20on%20s390x/mips%20for%20musl/near/227533108" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jubilee <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/bootstrapping.20on.20s390x.2Fmips.20for.20musl.html#227533108">(Feb 24 2021 at 01:13)</a>:</h4>
<p>I am not sure how a patch works without a copy of the crate in question, honestly.</p>



<a name="227533179"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/bootstrapping%20on%20s390x/mips%20for%20musl/near/227533179" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ariadne Conill <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/bootstrapping.20on.20s390x.2Fmips.20for.20musl.html#227533179">(Feb 24 2021 at 01:14)</a>:</h4>
<p>the copy of the crate already exists, actually rust-1.50 ships with three copies of libc crate</p>



<a name="227533247"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/bootstrapping%20on%20s390x/mips%20for%20musl/near/227533247" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jubilee <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/bootstrapping.20on.20s390x.2Fmips.20for.20musl.html#227533247">(Feb 24 2021 at 01:15)</a>:</h4>
<p>That's odd, there's only one specified in the rustc repository's lockfile.</p>



<a name="227533260"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/bootstrapping%20on%20s390x/mips%20for%20musl/near/227533260" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ariadne Conill <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/bootstrapping.20on.20s390x.2Fmips.20for.20musl.html#227533260">(Feb 24 2021 at 01:15)</a>:</h4>
<p>this is insane</p>



<a name="227533338"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/bootstrapping%20on%20s390x/mips%20for%20musl/near/227533338" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ariadne Conill <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/bootstrapping.20on.20s390x.2Fmips.20for.20musl.html#227533338">(Feb 24 2021 at 01:16)</a>:</h4>
<p>if i download gcc sources, i can modify them all i want, and <code>make</code> does not complain about checksums</p>



<a name="227533365"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/bootstrapping%20on%20s390x/mips%20for%20musl/near/227533365" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ariadne Conill <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/bootstrapping.20on.20s390x.2Fmips.20for.20musl.html#227533365">(Feb 24 2021 at 01:17)</a>:</h4>
<p>but, no instead now i have to COPY YET AGAIN and PATCH THAT</p>



<a name="227533369"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/bootstrapping%20on%20s390x/mips%20for%20musl/near/227533369" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ariadne Conill <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/bootstrapping.20on.20s390x.2Fmips.20for.20musl.html#227533369">(Feb 24 2021 at 01:17)</a>:</h4>
<p>and then edit god knows what to make it actually use the copy</p>



<a name="227533449"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/bootstrapping%20on%20s390x/mips%20for%20musl/near/227533449" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ariadne Conill <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/bootstrapping.20on.20s390x.2Fmips.20for.20musl.html#227533449">(Feb 24 2021 at 01:18)</a>:</h4>
<p>and rustaceans wonder why people get angry about rust.  this, right here.  the damn tool is fighting me.</p>



<a name="227533478"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/bootstrapping%20on%20s390x/mips%20for%20musl/near/227533478" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ariadne Conill <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/bootstrapping.20on.20s390x.2Fmips.20for.20musl.html#227533478">(Feb 24 2021 at 01:18)</a>:</h4>
<p>there needs to be a <code>CARGO_I_AM_NOT_AN_IDIOT_TURN_EVERYTHING_OFF=1</code> which disables all of this lockfile checking stuff</p>



<a name="227533607"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/bootstrapping%20on%20s390x/mips%20for%20musl/near/227533607" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ariadne Conill <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/bootstrapping.20on.20s390x.2Fmips.20for.20musl.html#227533607">(Feb 24 2021 at 01:20)</a>:</h4>
<div class="codehilite"><pre><span></span><code>~/aports/community/rust/src/rustc-1.50.0-src/vendor $ ls -alh | grep libc
drwxr-xr-x   4 kaniini kaniini 4.0K Feb 24 00:54 libc
drwxr-xr-x   4 kaniini kaniini 4.0K Feb 24 00:54 libc-0.2.77
drwxr-xr-x   4 kaniini kaniini 4.0K Feb 24 00:54 libc-0.2.79
</code></pre></div>



<a name="227533623"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/bootstrapping%20on%20s390x/mips%20for%20musl/near/227533623" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ariadne Conill <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/bootstrapping.20on.20s390x.2Fmips.20for.20musl.html#227533623">(Feb 24 2021 at 01:20)</a>:</h4>
<p>how does this stuff work?  which one do i patch?  how do i copy it and make sure it actually gets respected 300 crates down</p>



<a name="227533678"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/bootstrapping%20on%20s390x/mips%20for%20musl/near/227533678" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ariadne Conill <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/bootstrapping.20on.20s390x.2Fmips.20for.20musl.html#227533678">(Feb 24 2021 at 01:21)</a>:</h4>
<p>sorry, i am just very frustrated with this</p>



<a name="227534101"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/bootstrapping%20on%20s390x/mips%20for%20musl/near/227534101" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ariadne Conill <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/bootstrapping.20on.20s390x.2Fmips.20for.20musl.html#227534101">(Feb 24 2021 at 01:27)</a>:</h4>
<p>real answer: modify <code>std</code> Cargo.toml file</p>



<a name="227534107"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/bootstrapping%20on%20s390x/mips%20for%20musl/near/227534107" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jubilee <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/bootstrapping.20on.20s390x.2Fmips.20for.20musl.html#227534107">(Feb 24 2021 at 01:27)</a>:</h4>
<p>My understanding is that Rust was in fact built mostly with makefiles at one point in time, and there were several motivating factors that gave rise to the Rust build systems and specifically Cargo.</p>
<p>When you specify a patch in the patches table in a Cargo.toml, my observational understanding has been that override is what Cargo sees, and it basically stops caring about checksum stuff because then it only cares about validating against that version, basically, and you can specify a local repo. ( and it applies this override recursively afaik )<br>
There are also various ways to pretend you're a registry, as it were. <a href="https://doc.rust-lang.org/cargo/reference/source-replacement.html">https://doc.rust-lang.org/cargo/reference/source-replacement.html</a><br>
And it's completely understandable to want to be able to dictate sources more specifically and more easily.</p>



<a name="227534224"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/bootstrapping%20on%20s390x/mips%20for%20musl/near/227534224" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ariadne Conill <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/bootstrapping.20on.20s390x.2Fmips.20for.20musl.html#227534224">(Feb 24 2021 at 01:29)</a>:</h4>
<div class="codehilite"><pre><span></span><code>error: the lock file /home/kaniini/aports/community/rust/src/rustc-1.50.0-src/Cargo.lock needs to be updated but --frozen was passed to prevent this
</code></pre></div>



<a name="227534234"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/bootstrapping%20on%20s390x/mips%20for%20musl/near/227534234" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ariadne Conill <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/bootstrapping.20on.20s390x.2Fmips.20for.20musl.html#227534234">(Feb 24 2021 at 01:29)</a>:</h4>
<p>oh my fucking god</p>



<a name="227534241"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/bootstrapping%20on%20s390x/mips%20for%20musl/near/227534241" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ariadne Conill <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/bootstrapping.20on.20s390x.2Fmips.20for.20musl.html#227534241">(Feb 24 2021 at 01:29)</a>:</h4>
<p>i should just remove rust from alpine and call it a day</p>



<a name="227534244"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/bootstrapping%20on%20s390x/mips%20for%20musl/near/227534244" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jubilee <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/bootstrapping.20on.20s390x.2Fmips.20for.20musl.html#227534244">(Feb 24 2021 at 01:29)</a>:</h4>
<p><span aria-label="rolling eyes" class="emoji emoji-1f644" role="img" title="rolling eyes">:rolling_eyes:</span></p>



<a name="227534251"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/bootstrapping%20on%20s390x/mips%20for%20musl/near/227534251" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ariadne Conill <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/bootstrapping.20on.20s390x.2Fmips.20for.20musl.html#227534251">(Feb 24 2021 at 01:29)</a>:</h4>
<p>i'm about 30 seconds away from doing so</p>



<a name="227534255"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/bootstrapping%20on%20s390x/mips%20for%20musl/near/227534255" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jubilee <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/bootstrapping.20on.20s390x.2Fmips.20for.20musl.html#227534255">(Feb 24 2021 at 01:29)</a>:</h4>
<p>yeah cargo is being kinda silly.</p>



<a name="227534362"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/bootstrapping%20on%20s390x/mips%20for%20musl/near/227534362" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ariadne Conill <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/bootstrapping.20on.20s390x.2Fmips.20for.20musl.html#227534362">(Feb 24 2021 at 01:30)</a>:</h4>
<p>like, i did the whole <code>[patch.blahblahblah]</code> thing and put it in the right place.  and pointed it to <code>patched-crates/libc</code>.</p>



<a name="227534382"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/bootstrapping%20on%20s390x/mips%20for%20musl/near/227534382" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ariadne Conill <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/bootstrapping.20on.20s390x.2Fmips.20for.20musl.html#227534382">(Feb 24 2021 at 01:30)</a>:</h4>
<p>and now cargo tells me to do something that is not possible to do on a builder</p>



<a name="227534388"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/bootstrapping%20on%20s390x/mips%20for%20musl/near/227534388" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jubilee <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/bootstrapping.20on.20s390x.2Fmips.20for.20musl.html#227534388">(Feb 24 2021 at 01:30)</a>:</h4>
<p>hmmm.</p>



<a name="227534424"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/bootstrapping%20on%20s390x/mips%20for%20musl/near/227534424" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jubilee <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/bootstrapping.20on.20s390x.2Fmips.20for.20musl.html#227534424">(Feb 24 2021 at 01:31)</a>:</h4>
<p>apparently this is done by rustbuild specifically <strong>if</strong> it is told to use vendored sources.<br>
what.</p>



<a name="227534427"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/bootstrapping%20on%20s390x/mips%20for%20musl/near/227534427" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jubilee <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/bootstrapping.20on.20s390x.2Fmips.20for.20musl.html#227534427">(Feb 24 2021 at 01:31)</a>:</h4>
<p>what.</p>



<a name="227534431"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/bootstrapping%20on%20s390x/mips%20for%20musl/near/227534431" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jubilee <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/bootstrapping.20on.20s390x.2Fmips.20for.20musl.html#227534431">(Feb 24 2021 at 01:31)</a>:</h4>
<p>????????????????????????</p>



<a name="227534435"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/bootstrapping%20on%20s390x/mips%20for%20musl/near/227534435" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ariadne Conill <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/bootstrapping.20on.20s390x.2Fmips.20for.20musl.html#227534435">(Feb 24 2021 at 01:31)</a>:</h4>
<p>that's what i am saying</p>



<a name="227534446"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/bootstrapping%20on%20s390x/mips%20for%20musl/near/227534446" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ariadne Conill <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/bootstrapping.20on.20s390x.2Fmips.20for.20musl.html#227534446">(Feb 24 2021 at 01:31)</a>:</h4>
<p>i want to patch the vendored sources and i want cargo to just be chill about it</p>



<a name="227534521"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/bootstrapping%20on%20s390x/mips%20for%20musl/near/227534521" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ariadne Conill <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/bootstrapping.20on.20s390x.2Fmips.20for.20musl.html#227534521">(Feb 24 2021 at 01:32)</a>:</h4>
<p>which you can theoretically do by changing <code>.cargo-checksums.json</code>, but then it tells me that error</p>



<a name="227534526"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/bootstrapping%20on%20s390x/mips%20for%20musl/near/227534526" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ariadne Conill <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/bootstrapping.20on.20s390x.2Fmips.20for.20musl.html#227534526">(Feb 24 2021 at 01:32)</a>:</h4>
<p>this [patch] approach gives me that error</p>



<a name="227534537"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/bootstrapping%20on%20s390x/mips%20for%20musl/near/227534537" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ariadne Conill <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/bootstrapping.20on.20s390x.2Fmips.20for.20musl.html#227534537">(Feb 24 2021 at 01:32)</a>:</h4>
<p>all paths give me this error</p>



<a name="227534741"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/bootstrapping%20on%20s390x/mips%20for%20musl/near/227534741" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jubilee <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/bootstrapping.20on.20s390x.2Fmips.20for.20musl.html#227534741">(Feb 24 2021 at 01:35)</a>:</h4>
<p>and <code>cargo update</code> doesn't work, I imagine.<br>
...because cargo doesn't exist yet, right?</p>



<a name="227534749"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/bootstrapping%20on%20s390x/mips%20for%20musl/near/227534749" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joshua Nelson <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/bootstrapping.20on.20s390x.2Fmips.20for.20musl.html#227534749">(Feb 24 2021 at 01:35)</a>:</h4>
<p>What happens if you don't pass <code>--frozen</code>?</p>



<a name="227534765"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/bootstrapping%20on%20s390x/mips%20for%20musl/near/227534765" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jubilee <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/bootstrapping.20on.20s390x.2Fmips.20for.20musl.html#227534765">(Feb 24 2021 at 01:35)</a>:</h4>
<p>I believe the build is automatically passing <code>--frozen</code>, Joshua.</p>



<a name="227534786"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/bootstrapping%20on%20s390x/mips%20for%20musl/near/227534786" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ariadne Conill <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/bootstrapping.20on.20s390x.2Fmips.20for.20musl.html#227534786">(Feb 24 2021 at 01:36)</a>:</h4>
<p>yes, i <em>can</em> do cargo update</p>



<a name="227534824"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/bootstrapping%20on%20s390x/mips%20for%20musl/near/227534824" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jubilee <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/bootstrapping.20on.20s390x.2Fmips.20for.20musl.html#227534824">(Feb 24 2021 at 01:36)</a>:</h4>
<p>Oh okay.</p>



<a name="227534830"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/bootstrapping%20on%20s390x/mips%20for%20musl/near/227534830" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ariadne Conill <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/bootstrapping.20on.20s390x.2Fmips.20for.20musl.html#227534830">(Feb 24 2021 at 01:36)</a>:</h4>
<p>because we have a host cargo</p>



<a name="227534853"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/bootstrapping%20on%20s390x/mips%20for%20musl/near/227534853" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jubilee <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/bootstrapping.20on.20s390x.2Fmips.20for.20musl.html#227534853">(Feb 24 2021 at 01:36)</a>:</h4>
<p>and that doesn't work?<br>
Also can I see the rest of that build log so it's obvious where exactly it stopped? There's two spaces it decides to override and specify <code>--frozen</code>.</p>



<a name="227534865"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/bootstrapping%20on%20s390x/mips%20for%20musl/near/227534865" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jubilee <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/bootstrapping.20on.20s390x.2Fmips.20for.20musl.html#227534865">(Feb 24 2021 at 01:36)</a>:</h4>
<p>in spite of the user not requesting such. <span aria-label="eyes" class="emoji emoji-1f440" role="img" title="eyes">:eyes:</span></p>



<a name="227534915"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/bootstrapping%20on%20s390x/mips%20for%20musl/near/227534915" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ariadne Conill <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/bootstrapping.20on.20s390x.2Fmips.20for.20musl.html#227534915">(Feb 24 2021 at 01:37)</a>:</h4>
<p>oh my god, <code>cargo update</code> made it even worse</p>



<a name="227534916"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/bootstrapping%20on%20s390x/mips%20for%20musl/near/227534916" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ariadne Conill <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/bootstrapping.20on.20s390x.2Fmips.20for.20musl.html#227534916">(Feb 24 2021 at 01:37)</a>:</h4>
<p>i give up</p>



<a name="227534917"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/bootstrapping%20on%20s390x/mips%20for%20musl/near/227534917" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jubilee <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/bootstrapping.20on.20s390x.2Fmips.20for.20musl.html#227534917">(Feb 24 2021 at 01:37)</a>:</h4>
<p>welp.</p>



<a name="227535017"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/bootstrapping%20on%20s390x/mips%20for%20musl/near/227535017" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ariadne Conill <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/bootstrapping.20on.20s390x.2Fmips.20for.20musl.html#227535017">(Feb 24 2021 at 01:38)</a>:</h4>
<p>time to blast away the rust source tree again</p>



<a name="227535048"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/bootstrapping%20on%20s390x/mips%20for%20musl/near/227535048" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joshua Nelson <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/bootstrapping.20on.20s390x.2Fmips.20for.20musl.html#227535048">(Feb 24 2021 at 01:39)</a>:</h4>
<p>You can check out Cargo.lock from git</p>



<a name="227535070"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/bootstrapping%20on%20s390x/mips%20for%20musl/near/227535070" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joshua Nelson <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/bootstrapping.20on.20s390x.2Fmips.20for.20musl.html#227535070">(Feb 24 2021 at 01:39)</a>:</h4>
<p>So you don't lose the build cache</p>



<a name="227535081"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/bootstrapping%20on%20s390x/mips%20for%20musl/near/227535081" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jubilee <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/bootstrapping.20on.20s390x.2Fmips.20for.20musl.html#227535081">(Feb 24 2021 at 01:39)</a>:</h4>
<p>F.<br>
<span class="user-mention" data-user-id="232545">@Joshua Nelson</span> <a href="https://github.com/rust-lang/rust/blob/185de5f41a64e1b790524d5873dc1f7e368f64ab/src/bootstrap/bootstrap.py#L892-L897">https://github.com/rust-lang/rust/blob/185de5f41a64e1b790524d5873dc1f7e368f64ab/src/bootstrap/bootstrap.py#L892-L897</a><br>
<a href="https://github.com/rust-lang/rust/blob/cd64446196a02e593c5f50b8d863161306da43f7/src/bootstrap/builder.rs#L1454-L1459">https://github.com/rust-lang/rust/blob/cd64446196a02e593c5f50b8d863161306da43f7/src/bootstrap/builder.rs#L1454-L1459</a></p>



<a name="227535163"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/bootstrapping%20on%20s390x/mips%20for%20musl/near/227535163" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joshua Nelson <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/bootstrapping.20on.20s390x.2Fmips.20for.20musl.html#227535163">(Feb 24 2021 at 01:40)</a>:</h4>
<div class="codehilite"><pre><span></span><code>--frozen                   Require Cargo.lock and cache are up to date
--locked                   Require Cargo.lock is up to date
</code></pre></div>
<p>hmm, why does vendoring pass --frozen instead of --locked?</p>



<a name="227535166"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/bootstrapping%20on%20s390x/mips%20for%20musl/near/227535166" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ariadne Conill <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/bootstrapping.20on.20s390x.2Fmips.20for.20musl.html#227535166">(Feb 24 2021 at 01:40)</a>:</h4>
<p><span class="user-mention silent" data-user-id="232545">Joshua Nelson</span> <a href="#narrow/stream/131828-t-compiler/topic/bootstrapping.20on.20s390x.2Fmips.20for.20musl/near/227535048">said</a>:</p>
<blockquote>
<p>You can check out Cargo.lock from git</p>
</blockquote>
<p>that wasnt the problem.  the problem was that cargo added all these <code>.cargo-checksum.json</code> files everywhere.  aka: the things i don't wanna use</p>



<a name="227535172"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/bootstrapping%20on%20s390x/mips%20for%20musl/near/227535172" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joshua Nelson <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/bootstrapping.20on.20s390x.2Fmips.20for.20musl.html#227535172">(Feb 24 2021 at 01:40)</a>:</h4>
<p>you can delete those <span aria-label="shrug" class="emoji emoji-1f937" role="img" title="shrug">:shrug:</span></p>



<a name="227535178"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/bootstrapping%20on%20s390x/mips%20for%20musl/near/227535178" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ariadne Conill <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/bootstrapping.20on.20s390x.2Fmips.20for.20musl.html#227535178">(Feb 24 2021 at 01:40)</a>:</h4>
<p>yes</p>



<a name="227535180"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/bootstrapping%20on%20s390x/mips%20for%20musl/near/227535180" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ariadne Conill <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/bootstrapping.20on.20s390x.2Fmips.20for.20musl.html#227535180">(Feb 24 2021 at 01:41)</a>:</h4>
<p>i can</p>



<a name="227535213"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/bootstrapping%20on%20s390x/mips%20for%20musl/near/227535213" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ariadne Conill <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/bootstrapping.20on.20s390x.2Fmips.20for.20musl.html#227535213">(Feb 24 2021 at 01:41)</a>:</h4>
<p>they definitely got deleted when i ran <code>abuild clean</code></p>



<a name="227535394"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/bootstrapping%20on%20s390x/mips%20for%20musl/near/227535394" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ariadne Conill <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/bootstrapping.20on.20s390x.2Fmips.20for.20musl.html#227535394">(Feb 24 2021 at 01:44)</a>:</h4>
<p><code>locked-deps = false</code></p>



<a name="227535460"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/bootstrapping%20on%20s390x/mips%20for%20musl/near/227535460" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ariadne Conill <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/bootstrapping.20on.20s390x.2Fmips.20for.20musl.html#227535460">(Feb 24 2021 at 01:45)</a>:</h4>
<p>or just patch bootstrap.py/builder.rs</p>



<a name="227535654"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/bootstrapping%20on%20s390x/mips%20for%20musl/near/227535654" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jubilee <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/bootstrapping.20on.20s390x.2Fmips.20for.20musl.html#227535654">(Feb 24 2021 at 01:48)</a>:</h4>
<p>like so? <a href="https://mystb.in/SurgeonDeadlinePursue.lua">https://mystb.in/SurgeonDeadlinePursue.lua</a></p>



<a name="227535717"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/bootstrapping%20on%20s390x/mips%20for%20musl/near/227535717" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ariadne Conill <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/bootstrapping.20on.20s390x.2Fmips.20for.20musl.html#227535717">(Feb 24 2021 at 01:50)</a>:</h4>
<p>yeah</p>



<a name="227535783"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/bootstrapping%20on%20s390x/mips%20for%20musl/near/227535783" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ariadne Conill <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/bootstrapping.20on.20s390x.2Fmips.20for.20musl.html#227535783">(Feb 24 2021 at 01:50)</a>:</h4>
<p>that gave rustbuild the lobotomy it needed</p>



<a name="227535825"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/bootstrapping%20on%20s390x/mips%20for%20musl/near/227535825" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ariadne Conill <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/bootstrapping.20on.20s390x.2Fmips.20for.20musl.html#227535825">(Feb 24 2021 at 01:51)</a>:</h4>
<p>Compiling libc v0.2.80</p>



<a name="227535834"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/bootstrapping%20on%20s390x/mips%20for%20musl/near/227535834" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ariadne Conill <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/bootstrapping.20on.20s390x.2Fmips.20for.20musl.html#227535834">(Feb 24 2021 at 01:51)</a>:</h4>
<p>oh, but it chose to use the new version</p>



<a name="227535842"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/bootstrapping%20on%20s390x/mips%20for%20musl/near/227535842" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jubilee <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/bootstrapping.20on.20s390x.2Fmips.20for.20musl.html#227535842">(Feb 24 2021 at 01:51)</a>:</h4>
<p>hm</p>



<a name="227535901"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/bootstrapping%20on%20s390x/mips%20for%20musl/near/227535901" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joshua Nelson <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/bootstrapping.20on.20s390x.2Fmips.20for.20musl.html#227535901">(Feb 24 2021 at 01:52)</a>:</h4>
<p>what happens if you only remove <code>frozen</code> and not <code>locked</code>?</p>



<a name="227535923"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/bootstrapping%20on%20s390x/mips%20for%20musl/near/227535923" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jubilee <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/bootstrapping.20on.20s390x.2Fmips.20for.20musl.html#227535923">(Feb 24 2021 at 01:52)</a>:</h4>
<p>Maybe I made it too dumb. :^)</p>



<a name="227536001"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/bootstrapping%20on%20s390x/mips%20for%20musl/near/227536001" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ariadne Conill <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/bootstrapping.20on.20s390x.2Fmips.20for.20musl.html#227536001">(Feb 24 2021 at 01:53)</a>:</h4>
<p>no they both have to go</p>



<a name="227536070"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/bootstrapping%20on%20s390x/mips%20for%20musl/near/227536070" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ariadne Conill <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/bootstrapping.20on.20s390x.2Fmips.20for.20musl.html#227536070">(Feb 24 2021 at 01:54)</a>:</h4>
<p>preferring libc 0.2.80 is fine by me</p>



<a name="227536076"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/bootstrapping%20on%20s390x/mips%20for%20musl/near/227536076" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joshua Nelson <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/bootstrapping.20on.20s390x.2Fmips.20for.20musl.html#227536076">(Feb 24 2021 at 01:54)</a>:</h4>
<p>hmm, ok</p>



<a name="227536139"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/bootstrapping%20on%20s390x/mips%20for%20musl/near/227536139" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jubilee <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/bootstrapping.20on.20s390x.2Fmips.20for.20musl.html#227536139">(Feb 24 2021 at 01:55)</a>:</h4>
<p>cool~<br>
As long as it's making it happen for ya. something something warranty void linux'd.</p>



<a name="227536156"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/bootstrapping%20on%20s390x/mips%20for%20musl/near/227536156" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joshua Nelson <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/bootstrapping.20on.20s390x.2Fmips.20for.20musl.html#227536156">(Feb 24 2021 at 01:55)</a>:</h4>
<p><span class="user-mention" data-user-id="281757">@Jubilee</span> remind me never to go on a car ride with you <span aria-label="laughing" class="emoji emoji-1f606" role="img" title="laughing">:laughing:</span></p>



<a name="227536211"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/bootstrapping%20on%20s390x/mips%20for%20musl/near/227536211" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ariadne Conill <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/bootstrapping.20on.20s390x.2Fmips.20for.20musl.html#227536211">(Feb 24 2021 at 01:56)</a>:</h4>
<p>well these are temporary measures anyway</p>



<a name="227536218"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/bootstrapping%20on%20s390x/mips%20for%20musl/near/227536218" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ariadne Conill <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/bootstrapping.20on.20s390x.2Fmips.20for.20musl.html#227536218">(Feb 24 2021 at 01:56)</a>:</h4>
<p>i am sure by 1.52 it will be non-issue</p>



<a name="227536253"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/bootstrapping%20on%20s390x/mips%20for%20musl/near/227536253" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jubilee <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/bootstrapping.20on.20s390x.2Fmips.20for.20musl.html#227536253">(Feb 24 2021 at 01:57)</a>:</h4>
<p>something will be figured out I'm sure. :^)</p>



<a name="227536346"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/bootstrapping%20on%20s390x/mips%20for%20musl/near/227536346" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ariadne Conill <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/bootstrapping.20on.20s390x.2Fmips.20for.20musl.html#227536346">(Feb 24 2021 at 01:58)</a>:</h4>
<p>allowing me to actually patch the vendored sources without jumping through hoops is the goal, and lobotomizing rustbuild got it done</p>



<a name="227536966"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/bootstrapping%20on%20s390x/mips%20for%20musl/near/227536966" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ariadne Conill <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/bootstrapping.20on.20s390x.2Fmips.20for.20musl.html#227536966">(Feb 24 2021 at 02:06)</a>:</h4>
<p>besides, i had no warranty to begin with (:</p>



<a name="227537173"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/bootstrapping%20on%20s390x/mips%20for%20musl/near/227537173" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jubilee <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/bootstrapping.20on.20s390x.2Fmips.20for.20musl.html#227537173">(Feb 24 2021 at 02:09)</a>:</h4>
<p>I wonder which is easiest to augment from until rustbuild/cargo works best for your purposes, of the <code>paths</code> array in <code>.cargo/config.toml</code>, <code>cargo vendor</code>, or <a href="https://crates.io/crates/cargo-local-registry">https://crates.io/crates/cargo-local-registry</a></p>



<a name="227537244"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/bootstrapping%20on%20s390x/mips%20for%20musl/near/227537244" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ariadne Conill <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/bootstrapping.20on.20s390x.2Fmips.20for.20musl.html#227537244">(Feb 24 2021 at 02:10)</a>:</h4>
<p>it has to be fully automated</p>



<a name="227537273"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/bootstrapping%20on%20s390x/mips%20for%20musl/near/227537273" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ariadne Conill <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/bootstrapping.20on.20s390x.2Fmips.20for.20musl.html#227537273">(Feb 24 2021 at 02:11)</a>:</h4>
<p>and network access is technically disallowed (but not presently enforced by the build software)</p>



<a name="227537701"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/bootstrapping%20on%20s390x/mips%20for%20musl/near/227537701" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> cuviper <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/bootstrapping.20on.20s390x.2Fmips.20for.20musl.html#227537701">(Feb 24 2021 at 02:16)</a>:</h4>
<div class="codehilite"><pre><span></span><code>find vendor -name .cargo-checksum.json \
  -exec sed -i.uncheck -e &#39;s/&quot;files&quot;:{[^}]*}/&quot;files&quot;:{ }/&#39; &#39;{}&#39; &#39;+&#39;
</code></pre></div>



<a name="227537724"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/bootstrapping%20on%20s390x/mips%20for%20musl/near/227537724" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> cuviper <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/bootstrapping.20on.20s390x.2Fmips.20for.20musl.html#227537724">(Feb 24 2021 at 02:17)</a>:</h4>
<p>^ look, no files to check!</p>



<a name="227537755"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/bootstrapping%20on%20s390x/mips%20for%20musl/near/227537755" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> simulacrum <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/bootstrapping.20on.20s390x.2Fmips.20for.20musl.html#227537755">(Feb 24 2021 at 02:17)</a>:</h4>
<p>cargo update is potentially likely to cause problems; you're updating dependencies that in theory follow semver but you then get an untested build. My recommendation is "cargo metadata" or similar which will regenerate the lockfile with your patch section applied but without complaining otherwise. I'm not sure if there's a way to avoid the lockfile update entirely; it's sort of there intentionally to guard against messing with sources like you're doing :)</p>
<p>It would be great to document the expected workflow for applying patches to dependencies, though; I'd be happy to accept a PR which adds a note to the "using vendored sources" message we already print today, or something similar.</p>



<a name="227538039"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/bootstrapping%20on%20s390x/mips%20for%20musl/near/227538039" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jubilee <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/bootstrapping.20on.20s390x.2Fmips.20for.20musl.html#227538039">(Feb 24 2021 at 02:21)</a>:</h4>
<p>ran cargo metadata and whoa.</p>



<a name="227539232"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/bootstrapping%20on%20s390x/mips%20for%20musl/near/227539232" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jubilee <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/bootstrapping.20on.20s390x.2Fmips.20for.20musl.html#227539232">(Feb 24 2021 at 02:39)</a>:</h4>
<p>mm, <code>cargo vendor</code> whines that it isn't intended to be used for modifications, and points back to [replace] (actually it means the patches table).<br>
but the patches table has to be specified on a per-project basis which seems to be a bit much.</p>



<a name="227540291"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/bootstrapping%20on%20s390x/mips%20for%20musl/near/227540291" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jubilee <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/bootstrapping.20on.20s390x.2Fmips.20for.20musl.html#227540291">(Feb 24 2021 at 02:54)</a>:</h4>
<p>yet, cargo vendor does enable pointing to a directory. hm.</p>



<a name="227540417"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/bootstrapping%20on%20s390x/mips%20for%20musl/near/227540417" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jubilee <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/bootstrapping.20on.20s390x.2Fmips.20for.20musl.html#227540417">(Feb 24 2021 at 02:57)</a>:</h4>
<p>enabling patches-but-it's-an-entire-registry seems possible.</p>



<a name="227548323"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/bootstrapping%20on%20s390x/mips%20for%20musl/near/227548323" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ariadne Conill <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/bootstrapping.20on.20s390x.2Fmips.20for.20musl.html#227548323">(Feb 24 2021 at 04:57)</a>:</h4>
<p>current status: <code>error: Error relocating /home/kaniini/aports/community/rust/src/rustc-1.50.0-src/build/x86_64-alpine-linux-musl/stage1-rustc/release/deps/libchalk_derive-5d1d56a171b894b4.so: __muloti4: symbol not found</code></p>



<a name="227548399"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/bootstrapping%20on%20s390x/mips%20for%20musl/near/227548399" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joshua Nelson <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/bootstrapping.20on.20s390x.2Fmips.20for.20musl.html#227548399">(Feb 24 2021 at 04:58)</a>:</h4>
<p>I don't see that symbol used in <code>compiler/</code> or <code>library/</code>, just llvm-project/</p>



<a name="227548402"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/bootstrapping%20on%20s390x/mips%20for%20musl/near/227548402" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joshua Nelson <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/bootstrapping.20on.20s390x.2Fmips.20for.20musl.html#227548402">(Feb 24 2021 at 04:58)</a>:</h4>
<p>maybe this is an LLVM bug?</p>



<a name="227548437"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/bootstrapping%20on%20s390x/mips%20for%20musl/near/227548437" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joshua Nelson <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/bootstrapping.20on.20s390x.2Fmips.20for.20musl.html#227548437">(Feb 24 2021 at 04:59)</a>:</h4>
<p><a href="https://bugs.llvm.org/show_bug.cgi?id=16404">https://bugs.llvm.org/show_bug.cgi?id=16404</a> looks related</p>



<a name="227548563"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/bootstrapping%20on%20s390x/mips%20for%20musl/near/227548563" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joshua Nelson <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/bootstrapping.20on.20s390x.2Fmips.20for.20musl.html#227548563">(Feb 24 2021 at 05:01)</a>:</h4>
<p>hmm, if you pass <code>RUSTFLAGS_NOT_BOOTSTRAP=-Clink-arg=-rtlib=compiler-rt</code> does it help? I guess that will require rebuilding stage1-rustc :/ not sure if there's a way around that</p>



<a name="227548566"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/bootstrapping%20on%20s390x/mips%20for%20musl/near/227548566" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joshua Nelson <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/bootstrapping.20on.20s390x.2Fmips.20for.20musl.html#227548566">(Feb 24 2021 at 05:01)</a>:</h4>
<p>maybe just copy/paste that final command line with the link arg added to start</p>



<a name="227548641"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/bootstrapping%20on%20s390x/mips%20for%20musl/near/227548641" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joshua Nelson <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/bootstrapping.20on.20s390x.2Fmips.20for.20musl.html#227548641">(Feb 24 2021 at 05:03)</a>:</h4>
<p>hmm, <code>rg compiler-rt compiler/</code> at least has some hits</p>
<div class="codehilite"><pre><span></span><code>compiler/rustc_target/src/spec/android_base.rs
6:    // Many of the symbols defined in compiler-rt are also defined in libgcc.

compiler/rustc_codegen_llvm/src/mono_item.rs
62:        // compiler-rt, then we want to implicitly compile everything with hidden

compiler/rustc_codegen_ssa/src/back/link.rs
2062:            // compiler-builtins crate (e.g., compiler-rt) because it&#39;ll get

compiler/rustc_feature/src/builtin_attrs.rs
422:        which contains compiler-rt intrinsics and will never be stable&quot;,
</code></pre></div>



<a name="227548855"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/bootstrapping%20on%20s390x/mips%20for%20musl/near/227548855" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ariadne Conill <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/bootstrapping.20on.20s390x.2Fmips.20for.20musl.html#227548855">(Feb 24 2021 at 05:06)</a>:</h4>
<p>libgcc ok</p>



<a name="227548876"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/bootstrapping%20on%20s390x/mips%20for%20musl/near/227548876" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joshua Nelson <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/bootstrapping.20on.20s390x.2Fmips.20for.20musl.html#227548876">(Feb 24 2021 at 05:06)</a>:</h4>
<p>hmm?</p>



<a name="227548879"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/bootstrapping%20on%20s390x/mips%20for%20musl/near/227548879" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ariadne Conill <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/bootstrapping.20on.20s390x.2Fmips.20for.20musl.html#227548879">(Feb 24 2021 at 05:06)</a>:</h4>
<p>hmm yeah no _muloti4 in libgcc</p>



<a name="227548894"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/bootstrapping%20on%20s390x/mips%20for%20musl/near/227548894" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joshua Nelson <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/bootstrapping.20on.20s390x.2Fmips.20for.20musl.html#227548894">(Feb 24 2021 at 05:07)</a>:</h4>
<p>oh I guess I should ask - are you using clang or gcc as the linker?</p>



<a name="227550154"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/bootstrapping%20on%20s390x/mips%20for%20musl/near/227550154" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ariadne Conill <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/bootstrapping.20on.20s390x.2Fmips.20for.20musl.html#227550154">(Feb 24 2021 at 05:26)</a>:</h4>
<p>gcc</p>



<a name="227550174"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/bootstrapping%20on%20s390x/mips%20for%20musl/near/227550174" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joshua Nelson <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/bootstrapping.20on.20s390x.2Fmips.20for.20musl.html#227550174">(Feb 24 2021 at 05:27)</a>:</h4>
<p>I don't know how this worked before then :/ maybe this symbol never got emitted?</p>



<a name="227550177"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/bootstrapping%20on%20s390x/mips%20for%20musl/near/227550177" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joshua Nelson <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/bootstrapping.20on.20s390x.2Fmips.20for.20musl.html#227550177">(Feb 24 2021 at 05:27)</a>:</h4>
<p>let me see if <code>nm</code> shows it on a tier 1 platform</p>



<a name="227550241"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/bootstrapping%20on%20s390x/mips%20for%20musl/near/227550241" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joshua Nelson <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/bootstrapping.20on.20s390x.2Fmips.20for.20musl.html#227550241">(Feb 24 2021 at 05:28)</a>:</h4>
<p>yup apparently this symbol doesn't exist on other platforms:</p>
<div class="codehilite"><pre><span></span><code>&gt; nm /home/joshua/.local/lib/rustup/toolchains/nightly-x86_64-unknown-linux-gnu/bin/rustc | less | grep __mu | wc -l
0
</code></pre></div>



<a name="227552537"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/bootstrapping%20on%20s390x/mips%20for%20musl/near/227552537" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ariadne Conill <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/bootstrapping.20on.20s390x.2Fmips.20for.20musl.html#227552537">(Feb 24 2021 at 06:05)</a>:</h4>
<p>yeah idk</p>



<a name="227553932"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/bootstrapping%20on%20s390x/mips%20for%20musl/near/227553932" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ariadne Conill <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/bootstrapping.20on.20s390x.2Fmips.20for.20musl.html#227553932">(Feb 24 2021 at 06:26)</a>:</h4>
<p>enough toiling in the rust mines for today :)</p>



<a name="227567244"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/bootstrapping%20on%20s390x/mips%20for%20musl/near/227567244" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> bjorn3 <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/bootstrapping.20on.20s390x.2Fmips.20for.20musl.html#227567244">(Feb 24 2021 at 08:59)</a>:</h4>
<p><code>__muloti4</code> should be defined by compiler-builtins.: <a href="https://github.com/rust-lang/compiler-builtins/blob/b8c2585ce3a70ad6e95961947ddc3f1b2ad22490/src/int/mul.rs#L124">https://github.com/rust-lang/compiler-builtins/blob/b8c2585ce3a70ad6e95961947ddc3f1b2ad22490/src/int/mul.rs#L124</a></p>
<p>Note that <code>nm rustc</code> won't ever show it as it has a hidden visibility and as such is never exported from linked artifacts.</p>



<a name="227599616"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/bootstrapping%20on%20s390x/mips%20for%20musl/near/227599616" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ariadne Conill <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/bootstrapping.20on.20s390x.2Fmips.20for.20musl.html#227599616">(Feb 24 2021 at 13:44)</a>:</h4>
<p>yeah, strange.  i dunno why it doesn't get included in the binary then.  maybe my lobotomization of rustbuild had unanticipated side effects?</p>



<a name="227603720"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/bootstrapping%20on%20s390x/mips%20for%20musl/near/227603720" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jubilee <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/bootstrapping.20on.20s390x.2Fmips.20for.20musl.html#227603720">(Feb 24 2021 at 14:13)</a>:</h4>
<p>I doubt it.</p>



<a name="227622491"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/bootstrapping%20on%20s390x/mips%20for%20musl/near/227622491" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jubilee <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/bootstrapping.20on.20s390x.2Fmips.20for.20musl.html#227622491">(Feb 24 2021 at 16:04)</a>:</h4>
<p>Running the rustc test suite with the security lobotomy in place on my i7-7700, if it's just the lobotomy that will immediately show a problem.</p>



<a name="227639429"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/bootstrapping%20on%20s390x/mips%20for%20musl/near/227639429" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jubilee <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/bootstrapping.20on.20s390x.2Fmips.20for.20musl.html#227639429">(Feb 24 2021 at 17:34)</a>:</h4>
<p>had to comment out a few more bits that were checking for sudo to make the lobotomy take effect but now it's building and testing just ifne.</p>



<a name="227640343"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/bootstrapping%20on%20s390x/mips%20for%20musl/near/227640343" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ariadne Conill <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/bootstrapping.20on.20s390x.2Fmips.20for.20musl.html#227640343">(Feb 24 2021 at 17:39)</a>:</h4>
<p>strange :)</p>



<a name="227658966"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/bootstrapping%20on%20s390x/mips%20for%20musl/near/227658966" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ariadne Conill <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/bootstrapping.20on.20s390x.2Fmips.20for.20musl.html#227658966">(Feb 24 2021 at 19:39)</a>:</h4>
<p>so my conclusion is that perhaps the next steps are to try to focus on staging all the libc/std work that will be needed to bring up {mips64, s390x, riscv64} ports and retry bootstrap in 1.52</p>



<a name="227669989"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/bootstrapping%20on%20s390x/mips%20for%20musl/near/227669989" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jubilee <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/bootstrapping.20on.20s390x.2Fmips.20for.20musl.html#227669989">(Feb 24 2021 at 20:50)</a>:</h4>
<p>Sounds sane!</p>



<a name="227673105"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/bootstrapping%20on%20s390x/mips%20for%20musl/near/227673105" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jubilee <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/bootstrapping.20on.20s390x.2Fmips.20for.20musl.html#227673105">(Feb 24 2021 at 21:09)</a>:</h4>
<p>I think the musl stuff should probably be reorganized a bit, the function definition for ioctl doesn't need to be respecified for each and every arch since it remains constant across the libc.</p>



<a name="227926955"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/bootstrapping%20on%20s390x/mips%20for%20musl/near/227926955" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ariadne Conill <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/bootstrapping.20on.20s390x.2Fmips.20for.20musl.html#227926955">(Feb 26 2021 at 13:27)</a>:</h4>
<p>yes, seems reasonable</p>



<a name="227926977"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/bootstrapping%20on%20s390x/mips%20for%20musl/near/227926977" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ariadne Conill <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/bootstrapping.20on.20s390x.2Fmips.20for.20musl.html#227926977">(Feb 26 2021 at 13:27)</a>:</h4>
<p>i'll work on the dynmusl targets today</p>



<a name="227927019"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/bootstrapping%20on%20s390x/mips%20for%20musl/near/227927019" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ariadne Conill <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/bootstrapping.20on.20s390x.2Fmips.20for.20musl.html#227927019">(Feb 26 2021 at 13:27)</a>:</h4>
<p>i think if we can get bootstrap working in git, it will make it a lot simpler to get working in a release</p>



<a name="227957925"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/bootstrapping%20on%20s390x/mips%20for%20musl/near/227957925" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ariadne Conill <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/bootstrapping.20on.20s390x.2Fmips.20for.20musl.html#227957925">(Feb 26 2021 at 17:04)</a>:</h4>
<p><a href="https://github.com/rust-lang/rust/pull/82556">https://github.com/rust-lang/rust/pull/82556</a> is the dynmusl targets</p>



<a name="227960827"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/bootstrapping%20on%20s390x/mips%20for%20musl/near/227960827" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nagisa <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/bootstrapping.20on.20s390x.2Fmips.20for.20musl.html#227960827">(Feb 26 2021 at 17:25)</a>:</h4>
<p><span class="user-mention" data-user-id="360752">@Ariadne Conill</span> am I correct in understanding that these targets as they have been submitted have been tested in alpine to some extent already?</p>



<a name="227960988"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/bootstrapping%20on%20s390x/mips%20for%20musl/near/227960988" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nagisa <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/bootstrapping.20on.20s390x.2Fmips.20for.20musl.html#227960988">(Feb 26 2021 at 17:26)</a>:</h4>
<p>In particular I'm somewhat concerned about using the static musl targets as a base, because some of them set up some things that seem fairly unconventional and possibly relevant only for self-contained/statically linked musl.</p>



<a name="227961074"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/bootstrapping%20on%20s390x/mips%20for%20musl/near/227961074" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ariadne Conill <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/bootstrapping.20on.20s390x.2Fmips.20for.20musl.html#227961074">(Feb 26 2021 at 17:27)</a>:</h4>
<p>yes, that patch comes directly out of alpine, though some of my sed work got chewed up</p>



<a name="227961079"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/bootstrapping%20on%20s390x/mips%20for%20musl/near/227961079" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ariadne Conill <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/bootstrapping.20on.20s390x.2Fmips.20for.20musl.html#227961079">(Feb 26 2021 at 17:27)</a>:</h4>
<p>one should never innovate with sed</p>



<a name="227961093"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/bootstrapping%20on%20s390x/mips%20for%20musl/near/227961093" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nagisa <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/bootstrapping.20on.20s390x.2Fmips.20for.20musl.html#227961093">(Feb 26 2021 at 17:27)</a>:</h4>
<p>Great.</p>



<a name="227961137"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/bootstrapping%20on%20s390x/mips%20for%20musl/near/227961137" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nagisa <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/bootstrapping.20on.20s390x.2Fmips.20for.20musl.html#227961137">(Feb 26 2021 at 17:27)</a>:</h4>
<p>(I was thinking that e.g. <a href="https://github.com/rust-lang/rust/blob/master/compiler/rustc_target/src/spec/i686_unknown_linux_musl.rs">https://github.com/rust-lang/rust/blob/master/compiler/rustc_target/src/spec/i686_unknown_linux_musl.rs</a> file looked sketchy, in particular the frame pointer elimination stuff or the linker flags)</p>



<a name="227961199"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/bootstrapping%20on%20s390x/mips%20for%20musl/near/227961199" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ariadne Conill <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/bootstrapping.20on.20s390x.2Fmips.20for.20musl.html#227961199">(Feb 26 2021 at 17:28)</a>:</h4>
<p>yes, theres a lot of sketchy stuff in the musl targets</p>



<a name="227961767"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/bootstrapping%20on%20s390x/mips%20for%20musl/near/227961767" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ariadne Conill <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/bootstrapping.20on.20s390x.2Fmips.20for.20musl.html#227961767">(Feb 26 2021 at 17:32)</a>:</h4>
<p>who is petrochenkov?</p>



<a name="227962118"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/bootstrapping%20on%20s390x/mips%20for%20musl/near/227962118" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ariadne Conill <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/bootstrapping.20on.20s390x.2Fmips.20for.20musl.html#227962118">(Feb 26 2021 at 17:34)</a>:</h4>
<p><span class="user-mention" data-user-id="123856">@Vadim Petrochenkov</span> hi, why did you self-assign my PR to you?</p>



<a name="227962273"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/bootstrapping%20on%20s390x/mips%20for%20musl/near/227962273" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nagisa <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/bootstrapping.20on.20s390x.2Fmips.20for.20musl.html#227962273">(Feb 26 2021 at 17:36)</a>:</h4>
<p>They assign themselves to PRs they want to take a look at later AFAIK.</p>



<a name="227964594"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/bootstrapping%20on%20s390x/mips%20for%20musl/near/227964594" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ariadne Conill <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/bootstrapping.20on.20s390x.2Fmips.20for.20musl.html#227964594">(Feb 26 2021 at 17:50)</a>:</h4>
<p>ok... well, the :/ response is concerning</p>



<a name="227964672"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/bootstrapping%20on%20s390x/mips%20for%20musl/near/227964672" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ariadne Conill <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/bootstrapping.20on.20s390x.2Fmips.20for.20musl.html#227964672">(Feb 26 2021 at 17:50)</a>:</h4>
<p>i really do not want my work on this to wind up blocked by some person who does not wish to talk about their concerns</p>



<a name="227964789"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/bootstrapping%20on%20s390x/mips%20for%20musl/near/227964789" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ariadne Conill <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/bootstrapping.20on.20s390x.2Fmips.20for.20musl.html#227964789">(Feb 26 2021 at 17:51)</a>:</h4>
<p>hopefully that is understandable :)</p>



<a name="227966596"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/bootstrapping%20on%20s390x/mips%20for%20musl/near/227966596" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jubilee <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/bootstrapping.20on.20s390x.2Fmips.20for.20musl.html#227966596">(Feb 26 2021 at 18:01)</a>:</h4>
<p>There is possibly a Timezone Thing going on.</p>



<a name="227967154"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/bootstrapping%20on%20s390x/mips%20for%20musl/near/227967154" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ariadne Conill <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/bootstrapping.20on.20s390x.2Fmips.20for.20musl.html#227967154">(Feb 26 2021 at 18:04)</a>:</h4>
<p>well, really, i think that this approach is good for solving what distros want, while being minimally intrusive to the rust team.  it's not ideal, but it's something we can all live with.  our inability to make a compromise on this will only serve to benefit the people who view rust as a threat in the same way they view systemd as a threat.  so i really hope this person does not show up and ruin everything.</p>



<a name="227967650"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/bootstrapping%20on%20s390x/mips%20for%20musl/near/227967650" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ariadne Conill <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/bootstrapping.20on.20s390x.2Fmips.20for.20musl.html#227967650">(Feb 26 2021 at 18:08)</a>:</h4>
<p>and... if you are unfamiliar with how those people react, you can ask the python-cryptography team ;)</p>



<a name="227967845"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/bootstrapping%20on%20s390x/mips%20for%20musl/near/227967845" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ariadne Conill <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/bootstrapping.20on.20s390x.2Fmips.20for.20musl.html#227967845">(Feb 26 2021 at 18:10)</a>:</h4>
<p>ok.  how do i set these pre/post crt object fallbacks to an empty set</p>



<a name="227967859"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/bootstrapping%20on%20s390x/mips%20for%20musl/near/227967859" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ariadne Conill <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/bootstrapping.20on.20s390x.2Fmips.20for.20musl.html#227967859">(Feb 26 2021 at 18:10)</a>:</h4>
<p>my answer is apparently not satisfying CI</p>



<a name="227967923"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/bootstrapping%20on%20s390x/mips%20for%20musl/near/227967923" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jubilee <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/bootstrapping.20on.20s390x.2Fmips.20for.20musl.html#227967923">(Feb 26 2021 at 18:11)</a>:</h4>
<p>I agree and currently remain optimistic that nothing of serious consequence will happen and Petrochenkov just flitted by, noticed something odd, and made a mark to take another look later and crashed out asleep or went to get dinner because of TZ differences or something.</p>



<a name="227968358"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/bootstrapping%20on%20s390x/mips%20for%20musl/near/227968358" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ariadne Conill <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/bootstrapping.20on.20s390x.2Fmips.20for.20musl.html#227968358">(Feb 26 2021 at 18:13)</a>:</h4>
<p>well, i hope that he does not drop in and go "but why would anyone want dynmusl" targets and just sit there and block it</p>



<a name="227969232"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/bootstrapping%20on%20s390x/mips%20for%20musl/near/227969232" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jubilee <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/bootstrapping.20on.20s390x.2Fmips.20for.20musl.html#227969232">(Feb 26 2021 at 18:19)</a>:</h4>
<p>I don't think that would happen. Tier3 basically exists for "hi I'm doing something weird and I've done the work to make this work and I expect a whole 5 people would want to use this target, would you mind this target spec sitting in the Rust repo? cool."</p>



<a name="227969678"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/bootstrapping%20on%20s390x/mips%20for%20musl/near/227969678" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nagisa <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/bootstrapping.20on.20s390x.2Fmips.20for.20musl.html#227969678">(Feb 26 2021 at 18:22)</a>:</h4>
<p><span class="user-mention" data-user-id="360752">@Ariadne Conill</span> <code>Default::default()</code> should work.</p>



<a name="227969743"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/bootstrapping%20on%20s390x/mips%20for%20musl/near/227969743" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ariadne Conill <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/bootstrapping.20on.20s390x.2Fmips.20for.20musl.html#227969743">(Feb 26 2021 at 18:23)</a>:</h4>
<p>i found a different solution, but we can try that one too</p>



<a name="227969758"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/bootstrapping%20on%20s390x/mips%20for%20musl/near/227969758" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nagisa <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/bootstrapping.20on.20s390x.2Fmips.20for.20musl.html#227969758">(Feb 26 2021 at 18:23)</a>:</h4>
<p>(its a <code>BTreeMap</code> so other way would be to say <code>BTreeMap::new()</code>, however for that you'd need to <code>use</code> things, and nobody wants to <code>use</code> things)</p>



<a name="227969902"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/bootstrapping%20on%20s390x/mips%20for%20musl/near/227969902" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nagisa <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/bootstrapping.20on.20s390x.2Fmips.20for.20musl.html#227969902">(Feb 26 2021 at 18:24)</a>:</h4>
<p>Ah, I see, you can use the <code>new</code> function too, yeah.</p>



<a name="227969975"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/bootstrapping%20on%20s390x/mips%20for%20musl/near/227969975" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nagisa <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/bootstrapping.20on.20s390x.2Fmips.20for.20musl.html#227969975">(Feb 26 2021 at 18:25)</a>:</h4>
<p>I think all of the options are fine ^^</p>



<a name="227970497"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/bootstrapping%20on%20s390x/mips%20for%20musl/near/227970497" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ariadne Conill <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/bootstrapping.20on.20s390x.2Fmips.20for.20musl.html#227970497">(Feb 26 2021 at 18:28)</a>:</h4>
<p>my assumption is that he just does not know why anyone would want this.  hopefully my comment explains it</p>



<a name="227970542"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/bootstrapping%20on%20s390x/mips%20for%20musl/near/227970542" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ariadne Conill <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/bootstrapping.20on.20s390x.2Fmips.20for.20musl.html#227970542">(Feb 26 2021 at 18:29)</a>:</h4>
<p>in rust land, the concept of a musl-based distro is not what most people think when they think musl</p>



<a name="227970752"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/bootstrapping%20on%20s390x/mips%20for%20musl/near/227970752" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Esteban Küber <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/bootstrapping.20on.20s390x.2Fmips.20for.20musl.html#227970752">(Feb 26 2021 at 18:30)</a>:</h4>
<p>That's likely the <span aria-label="confused" class="emoji emoji-1f615" role="img" title="confused">:confused:</span> reaction, but I wouldn't expect anyone in the team to block this, given that there's a very clear rationale.</p>



<a name="227971345"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/bootstrapping%20on%20s390x/mips%20for%20musl/near/227971345" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Laurențiu <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/bootstrapping.20on.20s390x.2Fmips.20for.20musl.html#227971345">(Feb 26 2021 at 18:34)</a>:</h4>
<p>I wouldn't read too much into a <span aria-label="confused" class="emoji emoji-1f615" role="img" title="confused">:confused:</span> reaction, at least I use them all the time for all sorts of stuff, ranging from "you have this bug which ate my cat" to "here, I've fixed a cat-eating bug you had".</p>



<a name="227971402"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/bootstrapping%20on%20s390x/mips%20for%20musl/near/227971402" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Esteban Küber <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/bootstrapping.20on.20s390x.2Fmips.20for.20musl.html#227971402">(Feb 26 2021 at 18:34)</a>:</h4>
<p><span class="user-mention" data-user-id="360752">@Ariadne Conill</span> would you mind adding part of your comment to petrochenkov to the description of the PR? That way it'll end up as part of the merge commit as well.</p>



<a name="227971467"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/bootstrapping%20on%20s390x/mips%20for%20musl/near/227971467" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ariadne Conill <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/bootstrapping.20on.20s390x.2Fmips.20for.20musl.html#227971467">(Feb 26 2021 at 18:35)</a>:</h4>
<p>yes sounds like a plan</p>



<a name="227971653"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/bootstrapping%20on%20s390x/mips%20for%20musl/near/227971653" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ariadne Conill <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/bootstrapping.20on.20s390x.2Fmips.20for.20musl.html#227971653">(Feb 26 2021 at 18:36)</a>:</h4>
<p>done!</p>



<a name="227972837"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/bootstrapping%20on%20s390x/mips%20for%20musl/near/227972837" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nagisa <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/bootstrapping.20on.20s390x.2Fmips.20for.20musl.html#227972837">(Feb 26 2021 at 18:44)</a>:</h4>
<p>Last thing that's probably good to do at this point is to squash the commits a little so that once merged we end up with a more meaningful history. Other than that this looks ready to r+ to me.</p>



<a name="227972929"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/bootstrapping%20on%20s390x/mips%20for%20musl/near/227972929" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joshua Nelson <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/bootstrapping.20on.20s390x.2Fmips.20for.20musl.html#227972929">(Feb 26 2021 at 18:45)</a>:</h4>
<p>you might want to give petrochenkov a few days to review first</p>



<a name="227973972"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/bootstrapping%20on%20s390x/mips%20for%20musl/near/227973972" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ariadne Conill <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/bootstrapping.20on.20s390x.2Fmips.20for.20musl.html#227973972">(Feb 26 2021 at 18:52)</a>:</h4>
<p>is there a way to override his r- :)</p>



<a name="227974240"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/bootstrapping%20on%20s390x/mips%20for%20musl/near/227974240" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jubilee <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/bootstrapping.20on.20s390x.2Fmips.20for.20musl.html#227974240">(Feb 26 2021 at 18:54)</a>:</h4>
<p>Oh, also it's worth noting in terms of salience that Petrochenkov has touched the compiler's target handling code many times, so your target specs were always functionally subject to Petrochenkov's attention as embodied in the rustc compiler anyways. :^)</p>



<a name="227976169"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/bootstrapping%20on%20s390x/mips%20for%20musl/near/227976169" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ariadne Conill <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/bootstrapping.20on.20s390x.2Fmips.20for.20musl.html#227976169">(Feb 26 2021 at 19:07)</a>:</h4>
<p>sure, but it comes down to how much further resources are worth spending on something doomed to failure because a single senior contributor has his own opinion on dynamically linked musl environments</p>



<a name="227976483"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/bootstrapping%20on%20s390x/mips%20for%20musl/near/227976483" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nagisa <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/bootstrapping.20on.20s390x.2Fmips.20for.20musl.html#227976483">(Feb 26 2021 at 19:09)</a>:</h4>
<p>Have they expressed an opposing opinion anywhere else?</p>



<a name="227976616"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/bootstrapping%20on%20s390x/mips%20for%20musl/near/227976616" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ariadne Conill <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/bootstrapping.20on.20s390x.2Fmips.20for.20musl.html#227976616">(Feb 26 2021 at 19:10)</a>:</h4>
<p>they have not yet, but based on knowledge and experience (having done this exact thing to block a PR) one can speculate on the outcome</p>



<a name="227976730"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/bootstrapping%20on%20s390x/mips%20for%20musl/near/227976730" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ariadne Conill <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/bootstrapping.20on.20s390x.2Fmips.20for.20musl.html#227976730">(Feb 26 2021 at 19:11)</a>:</h4>
<p>so, i believe the question is relevant -- whether or not there is a process to get this merged over his future objections</p>



<a name="227977019"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/bootstrapping%20on%20s390x/mips%20for%20musl/near/227977019" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jubilee <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/bootstrapping.20on.20s390x.2Fmips.20for.20musl.html#227977019">(Feb 26 2021 at 19:13)</a>:</h4>
<p>I think that kind of behavior would actually run up against the Rust CoC pretty quickly in actual practice, so I do not recommend doing that here.</p>



<a name="227977222"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/bootstrapping%20on%20s390x/mips%20for%20musl/near/227977222" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ariadne Conill <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/bootstrapping.20on.20s390x.2Fmips.20for.20musl.html#227977222">(Feb 26 2021 at 19:14)</a>:</h4>
<p>do not recommend doing which?  asking about governance processes?</p>



<a name="227977329"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/bootstrapping%20on%20s390x/mips%20for%20musl/near/227977329" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jubilee <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/bootstrapping.20on.20s390x.2Fmips.20for.20musl.html#227977329">(Feb 26 2021 at 19:15)</a>:</h4>
<p>Trying to block PRs using blatant power plays, I mean. :^)<br>
The questions are legitimate, I'm not sure what the process is!</p>



<a name="227977330"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/bootstrapping%20on%20s390x/mips%20for%20musl/near/227977330" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nagisa <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/bootstrapping.20on.20s390x.2Fmips.20for.20musl.html#227977330">(Feb 26 2021 at 19:15)</a>:</h4>
<p>I would say its too early to call anything based on a PR reaction. In my experience Vadim is a very reasonable person. </p>
<p>That said, Rust's decision making process is consensus based, so there's definitely a danger that a change gets rejected, especially the PRs that have far reaching consequences. Historically, however, adding new targets was never such a change.</p>



<a name="227977404"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/bootstrapping%20on%20s390x/mips%20for%20musl/near/227977404" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ariadne Conill <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/bootstrapping.20on.20s390x.2Fmips.20for.20musl.html#227977404">(Feb 26 2021 at 19:16)</a>:</h4>
<p>oh ok</p>



<a name="227977450"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/bootstrapping%20on%20s390x/mips%20for%20musl/near/227977450" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jubilee <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/bootstrapping.20on.20s390x.2Fmips.20for.20musl.html#227977450">(Feb 26 2021 at 19:16)</a>:</h4>
<p>yeah, there's a reason I noted that adding a tier3 target has <strong>very</strong> low standards.</p>



<a name="227977498"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/bootstrapping%20on%20s390x/mips%20for%20musl/near/227977498" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nagisa <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/bootstrapping.20on.20s390x.2Fmips.20for.20musl.html#227977498">(Feb 26 2021 at 19:16)</a>:</h4>
<p>If a well motivated PR is rejected, it generally is expected to be followed by a good rationale, and typically an alternative design to solve the problems that the original PR set out to solve.</p>



<a name="227977829"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/bootstrapping%20on%20s390x/mips%20for%20musl/near/227977829" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ariadne Conill <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/bootstrapping.20on.20s390x.2Fmips.20for.20musl.html#227977829">(Feb 26 2021 at 19:18)</a>:</h4>
<p>on the other hand, the confusion might be "why are the -musl targets making musl distros unhappy"</p>



<a name="227978064"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/bootstrapping%20on%20s390x/mips%20for%20musl/near/227978064" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ariadne Conill <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/bootstrapping.20on.20s390x.2Fmips.20for.20musl.html#227978064">(Feb 26 2021 at 19:20)</a>:</h4>
<p>which, if that's the situation, then maybe it can lead to a redesign of the <code>-musl</code> targets instead of introducing <code>-dynmusl</code> targets</p>



<a name="227978177"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/bootstrapping%20on%20s390x/mips%20for%20musl/near/227978177" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jubilee <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/bootstrapping.20on.20s390x.2Fmips.20for.20musl.html#227978177">(Feb 26 2021 at 19:21)</a>:</h4>
<p>there are indeed reasons like that to be optimistic, yes. :^)</p>



<a name="227978289"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/bootstrapping%20on%20s390x/mips%20for%20musl/near/227978289" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ariadne Conill <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/bootstrapping.20on.20s390x.2Fmips.20for.20musl.html#227978289">(Feb 26 2021 at 19:22)</a>:</h4>
<p>the lack of actionable data makes me anxious though</p>



<a name="227978343"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/bootstrapping%20on%20s390x/mips%20for%20musl/near/227978343" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ariadne Conill <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/bootstrapping.20on.20s390x.2Fmips.20for.20musl.html#227978343">(Feb 26 2021 at 19:22)</a>:</h4>
<p>i am somebody who thinks about every possible outcome in order to stay at least 1 step ahead :)</p>



<a name="227978603"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/bootstrapping%20on%20s390x/mips%20for%20musl/near/227978603" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ariadne Conill <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/bootstrapping.20on.20s390x.2Fmips.20for.20musl.html#227978603">(Feb 26 2021 at 19:24)</a>:</h4>
<p>at any rate, my goal is to wind up in a situation where musl distros are able to have a rustc that does not require hacks on hacks to work as any other program they install would work</p>



<a name="227978657"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/bootstrapping%20on%20s390x/mips%20for%20musl/near/227978657" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ariadne Conill <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/bootstrapping.20on.20s390x.2Fmips.20for.20musl.html#227978657">(Feb 26 2021 at 19:24)</a>:</h4>
<p>because the hacks on hacks are not helping anyone</p>



<a name="227979341"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/bootstrapping%20on%20s390x/mips%20for%20musl/near/227979341" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ariadne Conill <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/bootstrapping.20on.20s390x.2Fmips.20for.20musl.html#227979341">(Feb 26 2021 at 19:29)</a>:</h4>
<p>speaking of hacks on hacks, i wonder if it makes sense to rework the libc crate to move all of the common stuff musl defines into the common code</p>



<a name="227979591"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/bootstrapping%20on%20s390x/mips%20for%20musl/near/227979591" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jubilee <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/bootstrapping.20on.20s390x.2Fmips.20for.20musl.html#227979591">(Feb 26 2021 at 19:31)</a>:</h4>
<p>Yeah, I was reading the libc crate and it's actually <em>supposed</em> to work that way, i.e. that everything along the common paths for a target gets imported, people just were overly conservative about doing it for musl because, I presume, they didn't know what they were doing.</p>



<a name="227979771"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/bootstrapping%20on%20s390x/mips%20for%20musl/near/227979771" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ariadne Conill <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/bootstrapping.20on.20s390x.2Fmips.20for.20musl.html#227979771">(Feb 26 2021 at 19:32)</a>:</h4>
<p>well i definitely don't know what i am doing (which is why people who do know what they're doing going :/ makes me anxious), but i do know musl as i literally maintain the package on alpine</p>



<a name="227979779"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/bootstrapping%20on%20s390x/mips%20for%20musl/near/227979779" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ariadne Conill <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/bootstrapping.20on.20s390x.2Fmips.20for.20musl.html#227979779">(Feb 26 2021 at 19:32)</a>:</h4>
<p>:P</p>



<a name="227981287"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/bootstrapping%20on%20s390x/mips%20for%20musl/near/227981287" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ariadne Conill <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/bootstrapping.20on.20s390x.2Fmips.20for.20musl.html#227981287">(Feb 26 2021 at 19:41)</a>:</h4>
<p>but even when i was doing the s390x definitions, i noticed that it was strange that i had to copy a lot of commonly defined stuff.</p>



<a name="227981417"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/bootstrapping%20on%20s390x/mips%20for%20musl/near/227981417" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ariadne Conill <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/bootstrapping.20on.20s390x.2Fmips.20for.20musl.html#227981417">(Feb 26 2021 at 19:42)</a>:</h4>
<p>i think the libc crate should mimic the <code>arch/$arch/bits/*.h</code> in musl.</p>



<a name="227981457"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/bootstrapping%20on%20s390x/mips%20for%20musl/near/227981457" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ariadne Conill <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/bootstrapping.20on.20s390x.2Fmips.20for.20musl.html#227981457">(Feb 26 2021 at 19:42)</a>:</h4>
<p>e.g. everything that is common in the base, then the arch-specific overrides.</p>



<a name="227981742"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/bootstrapping%20on%20s390x/mips%20for%20musl/near/227981742" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jubilee <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/bootstrapping.20on.20s390x.2Fmips.20for.20musl.html#227981742">(Feb 26 2021 at 19:44)</a>:</h4>
<p>And I deeply understand that kind of anxiety, which is why I am talking it out with you, yes. ^_^<br>
Yeah, it kind of seems like that's how it's supposed to be organized according to libc's CONTRIBUTING.md anyways!</p>



<a name="227984121"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/bootstrapping%20on%20s390x/mips%20for%20musl/near/227984121" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jubilee <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/bootstrapping.20on.20s390x.2Fmips.20for.20musl.html#227984121">(Feb 26 2021 at 20:01)</a>:</h4>
<p><span class="user-mention" data-user-id="360752">@Ariadne Conill</span> Specifically, because we don't really "do" #undef then #ifdef here in Rust (that I'm aware of), the common stuff should probably be in its own module (possibly with further segmentation into submodules) so that you then can import that module for every arch it applies to. Not Quite Overrides, But Close.</p>



<a name="227984366"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/bootstrapping%20on%20s390x/mips%20for%20musl/near/227984366" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ariadne Conill <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/bootstrapping.20on.20s390x.2Fmips.20for.20musl.html#227984366">(Feb 26 2021 at 20:02)</a>:</h4>
<p>yeah seems like a reasonable design.  i would like to clean this stuff up.</p>



<a name="227984480"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/bootstrapping%20on%20s390x/mips%20for%20musl/near/227984480" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ariadne Conill <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/bootstrapping.20on.20s390x.2Fmips.20for.20musl.html#227984480">(Feb 26 2021 at 20:03)</a>:</h4>
<p>as it stands now, i found the libc musl support code to not be what i understand to be idiomatic rust, nor what i understand to be reflective of musl itself</p>



<a name="227984561"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/bootstrapping%20on%20s390x/mips%20for%20musl/near/227984561" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ariadne Conill <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/bootstrapping.20on.20s390x.2Fmips.20for.20musl.html#227984561">(Feb 26 2021 at 20:04)</a>:</h4>
<p>and rust noob i may totally be, i am not a musl noob :)</p>



<a name="227984665"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/bootstrapping%20on%20s390x/mips%20for%20musl/near/227984665" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jubilee <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/bootstrapping.20on.20s390x.2Fmips.20for.20musl.html#227984665">(Feb 26 2021 at 20:04)</a>:</h4>
<p>Go for it imo. It'd also be nice if we could get smFifteen's <a href="https://github.com/rust-lang/libc/pull/1662">https://github.com/rust-lang/libc/pull/1662</a> rebased and reviewed as that would help a lot.</p>



<a name="227984812"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/bootstrapping%20on%20s390x/mips%20for%20musl/near/227984812" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jubilee <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/bootstrapping.20on.20s390x.2Fmips.20for.20musl.html#227984812">(Feb 26 2021 at 20:05)</a>:</h4>
<p>also <a href="https://github.com/rust-lang/libc/pull/2078">https://github.com/rust-lang/libc/pull/2078</a> finally landed on libc's master after <span aria-label="sparkles" class="emoji emoji-2728" role="img" title="sparkles">:sparkles:</span>  CI fun <span aria-label="sparkles" class="emoji emoji-2728" role="img" title="sparkles">:sparkles:</span>.</p>



<a name="227985810"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/bootstrapping%20on%20s390x/mips%20for%20musl/near/227985810" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ariadne Conill <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/bootstrapping.20on.20s390x.2Fmips.20for.20musl.html#227985810">(Feb 26 2021 at 20:12)</a>:</h4>
<p>also, #undef is a no-no in the musl definition headers</p>



<a name="227985946"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/bootstrapping%20on%20s390x/mips%20for%20musl/near/227985946" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joshua Nelson <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/bootstrapping.20on.20s390x.2Fmips.20for.20musl.html#227985946">(Feb 26 2021 at 20:13)</a>:</h4>
<p><span class="user-mention silent" data-user-id="360752">Ariadne Conill</span> <a href="#narrow/stream/131828-t-compiler/topic/bootstrapping.20on.20s390x.2Fmips.20for.20musl/near/227985810">said</a>:</p>
<blockquote>
<p>also, #undef is a no-no in the musl definition headers</p>
</blockquote>
<p>lol that reminds me of <a href="http://conal.net/blog/posts/the-c-language-is-purely-functional">http://conal.net/blog/posts/the-c-language-is-purely-functional</a></p>



<a name="227986539"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/bootstrapping%20on%20s390x/mips%20for%20musl/near/227986539" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jubilee <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/bootstrapping.20on.20s390x.2Fmips.20for.20musl.html#227986539">(Feb 26 2021 at 20:16)</a>:</h4>
<p>yes :D</p>



<a name="227986979"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/bootstrapping%20on%20s390x/mips%20for%20musl/near/227986979" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ariadne Conill <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/bootstrapping.20on.20s390x.2Fmips.20for.20musl.html#227986979">(Feb 26 2021 at 20:19)</a>:</h4>
<p>cursed</p>



<a name="227994493"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/bootstrapping%20on%20s390x/mips%20for%20musl/near/227994493" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ariadne Conill <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/bootstrapping.20on.20s390x.2Fmips.20for.20musl.html#227994493">(Feb 26 2021 at 21:10)</a>:</h4>
<p>oh, huh.  it is possible for issues to have multiple assignees on github</p>



<a name="227994948"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/bootstrapping%20on%20s390x/mips%20for%20musl/near/227994948" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ariadne Conill <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/bootstrapping.20on.20s390x.2Fmips.20for.20musl.html#227994948">(Feb 26 2021 at 21:13)</a>:</h4>
<p>the way it looked to me was that petrochenkov took assignment from nagisa and then reacted with <span aria-label="confused" class="emoji emoji-1f615" role="img" title="confused">:confused:</span></p>



<a name="227995135"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/bootstrapping%20on%20s390x/mips%20for%20musl/near/227995135" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ariadne Conill <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/bootstrapping.20on.20s390x.2Fmips.20for.20musl.html#227995135">(Feb 26 2021 at 21:14)</a>:</h4>
<p>github should do something to better clarify changes like that</p>



<a name="228001260"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/bootstrapping%20on%20s390x/mips%20for%20musl/near/228001260" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jubilee <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/bootstrapping.20on.20s390x.2Fmips.20for.20musl.html#228001260">(Feb 26 2021 at 21:56)</a>:</h4>
<p>yes, GH's UI still leaves much to be desired, in spite of being... adequate for many purposes.</p>



<a name="228021312"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/bootstrapping%20on%20s390x/mips%20for%20musl/near/228021312" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ariadne Conill <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/bootstrapping.20on.20s390x.2Fmips.20for.20musl.html#228021312">(Feb 27 2021 at 01:16)</a>:</h4>
<p>grr.  to be absolutely clear: transparent behavior without patching is a hard requirement for musl-based distros</p>



<a name="228021998"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/bootstrapping%20on%20s390x/mips%20for%20musl/near/228021998" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jubilee <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/bootstrapping.20on.20s390x.2Fmips.20for.20musl.html#228021998">(Feb 27 2021 at 01:26)</a>:</h4>
<p>in this case my thought re: configuration bits would be essentially that something like .cargo/config would have the feature flag already set on RUSTFLAGS so that when you ran cargo it would just Do The Thing, and if you wanted to stop it from doing so it would be done by poking .cargo/config so that it doesn't.</p>



<a name="228022033"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/bootstrapping%20on%20s390x/mips%20for%20musl/near/228022033" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jubilee <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/bootstrapping.20on.20s390x.2Fmips.20for.20musl.html#228022033">(Feb 27 2021 at 01:26)</a>:</h4>
<p>And we'd just arrange for that config file to already have that one entry on it.</p>



<a name="228022092"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/bootstrapping%20on%20s390x/mips%20for%20musl/near/228022092" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ariadne Conill <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/bootstrapping.20on.20s390x.2Fmips.20for.20musl.html#228022092">(Feb 27 2021 at 01:27)</a>:</h4>
<p>that sounds too fragile, people used to mess with our gcc specs file</p>



<a name="228022144"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/bootstrapping%20on%20s390x/mips%20for%20musl/near/228022144" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jubilee <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/bootstrapping.20on.20s390x.2Fmips.20for.20musl.html#228022144">(Feb 27 2021 at 01:28)</a>:</h4>
<p>Yeah, that's why I said "but oof, configuration management over time".</p>



<a name="228022186"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/bootstrapping%20on%20s390x/mips%20for%20musl/near/228022186" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ariadne Conill <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/bootstrapping.20on.20s390x.2Fmips.20for.20musl.html#228022186">(Feb 27 2021 at 01:28)</a>:</h4>
<p>i have horrors of people following half-baked stack overflow solutions and breaking rustc entirely</p>



<a name="228022217"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/bootstrapping%20on%20s390x/mips%20for%20musl/near/228022217" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jubilee <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/bootstrapping.20on.20s390x.2Fmips.20for.20musl.html#228022217">(Feb 27 2021 at 01:29)</a>:</h4>
<p>man stack overflow needs to stop... something.</p>



<a name="228022218"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/bootstrapping%20on%20s390x/mips%20for%20musl/near/228022218" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ariadne Conill <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/bootstrapping.20on.20s390x.2Fmips.20for.20musl.html#228022218">(Feb 27 2021 at 01:29)</a>:</h4>
<p>as they used to do in order to remove security features from our gcc in order to avoid fixing their broken code :)</p>



<a name="228022221"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/bootstrapping%20on%20s390x/mips%20for%20musl/near/228022221" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jubilee <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/bootstrapping.20on.20s390x.2Fmips.20for.20musl.html#228022221">(Feb 27 2021 at 01:29)</a>:</h4>
<p>...anyways.</p>



<a name="228022243"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/bootstrapping%20on%20s390x/mips%20for%20musl/near/228022243" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ariadne Conill <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/bootstrapping.20on.20s390x.2Fmips.20for.20musl.html#228022243">(Feb 27 2021 at 01:29)</a>:</h4>
<p>that site like most sites is hit or miss</p>



<a name="228022334"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/bootstrapping%20on%20s390x/mips%20for%20musl/near/228022334" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jubilee <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/bootstrapping.20on.20s390x.2Fmips.20for.20musl.html#228022334">(Feb 27 2021 at 01:30)</a>:</h4>
<p>It's a website that has not heard of clearing caches, ironically.</p>



<a name="228022335"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/bootstrapping%20on%20s390x/mips%20for%20musl/near/228022335" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ariadne Conill <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/bootstrapping.20on.20s390x.2Fmips.20for.20musl.html#228022335">(Feb 27 2021 at 01:30)</a>:</h4>
<p>the problem is that for a while, people were suggesting to patch out FORTIFY by editing the gcc specs file, which lead to problems, because it is not stable across releases</p>



<a name="228022814"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/bootstrapping%20on%20s390x/mips%20for%20musl/near/228022814" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jubilee <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/bootstrapping.20on.20s390x.2Fmips.20for.20musl.html#228022814">(Feb 27 2021 at 01:36)</a>:</h4>
<p>so, something something, someone should run a destructor on half the Stack Overflow questions. :^)<br>
shepmaster has done a lot of hard work on making most them good for Rust, Generally, dunno about "for Alpine" though!</p>



<a name="228022943"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/bootstrapping%20on%20s390x/mips%20for%20musl/near/228022943" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ariadne Conill <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/bootstrapping.20on.20s390x.2Fmips.20for.20musl.html#228022943">(Feb 27 2021 at 01:37)</a>:</h4>
<p>anyway i'm weary to have another scenario like that with rust</p>



<a name="228056646"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/bootstrapping%20on%20s390x/mips%20for%20musl/near/228056646" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Laurențiu <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/bootstrapping.20on.20s390x.2Fmips.20for.20musl.html#228056646">(Feb 27 2021 at 12:52)</a>:</h4>
<p>Just curious (as I don't have much experience with Alpine or musl), what's the problem with static linking by default on Alpine? Does it not work at all, or is it just discouraged?</p>



<a name="228056654"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/bootstrapping%20on%20s390x/mips%20for%20musl/near/228056654" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Laurențiu <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/bootstrapping.20on.20s390x.2Fmips.20for.20musl.html#228056654">(Feb 27 2021 at 12:52)</a>:</h4>
<p>I cam imagine that <code>rustc</code> itself needs to be linked dynamically for <code>dlopen</code></p>



<a name="228056681"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/bootstrapping%20on%20s390x/mips%20for%20musl/near/228056681" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Laurențiu <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/bootstrapping.20on.20s390x.2Fmips.20for.20musl.html#228056681">(Feb 27 2021 at 12:53)</a>:</h4>
<p>Re the PR itself, I totally agree, it's better to have a reasonable target in the compiler than to ask every user of the compiler to set <code>-C target-feature=-crt-static</code>.</p>



<a name="228056867"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/bootstrapping%20on%20s390x/mips%20for%20musl/near/228056867" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ariadne Conill <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/bootstrapping.20on.20s390x.2Fmips.20for.20musl.html#228056867">(Feb 27 2021 at 12:57)</a>:</h4>
<p>it is a policy violation</p>



<a name="228056923"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/bootstrapping%20on%20s390x/mips%20for%20musl/near/228056923" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Laurențiu <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/bootstrapping.20on.20s390x.2Fmips.20for.20musl.html#228056923">(Feb 27 2021 at 12:58)</a>:</h4>
<p>Ah, okay</p>



<a name="228056924"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/bootstrapping%20on%20s390x/mips%20for%20musl/near/228056924" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ariadne Conill <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/bootstrapping.20on.20s390x.2Fmips.20for.20musl.html#228056924">(Feb 27 2021 at 12:58)</a>:</h4>
<p>if the end user wishes to use static linking, it works fine.  but for alpine itself, it is a policy violation, and we are unwilling to ship a toolchain that violates policy by default.</p>



<a name="228056925"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/bootstrapping%20on%20s390x/mips%20for%20musl/near/228056925" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Laurențiu <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/bootstrapping.20on.20s390x.2Fmips.20for.20musl.html#228056925">(Feb 27 2021 at 12:58)</a>:</h4>
<p>So the static target works fine, too?</p>



<a name="228056931"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/bootstrapping%20on%20s390x/mips%20for%20musl/near/228056931" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ariadne Conill <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/bootstrapping.20on.20s390x.2Fmips.20for.20musl.html#228056931">(Feb 27 2021 at 12:58)</a>:</h4>
<p>yes</p>



<a name="228056951"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/bootstrapping%20on%20s390x/mips%20for%20musl/near/228056951" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ariadne Conill <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/bootstrapping.20on.20s390x.2Fmips.20for.20musl.html#228056951">(Feb 27 2021 at 12:59)</a>:</h4>
<p>i don't know if the static target works after the requested modifications for <code>-dynmusl</code> btw.</p>



<a name="228056957"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/bootstrapping%20on%20s390x/mips%20for%20musl/near/228056957" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Laurențiu <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/bootstrapping.20on.20s390x.2Fmips.20for.20musl.html#228056957">(Feb 27 2021 at 13:00)</a>:</h4>
<p>Cool. TBH, <code>dlopen</code> not working with static musl is a good enough reason to prefer dynamic linking. Not to mention any libc updates.</p>



<a name="228057020"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/bootstrapping%20on%20s390x/mips%20for%20musl/near/228057020" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ariadne Conill <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/bootstrapping.20on.20s390x.2Fmips.20for.20musl.html#228057020">(Feb 27 2021 at 13:00)</a>:</h4>
<p>yes, dlopen does not work at all in staticly linked musl.</p>



<a name="228057029"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/bootstrapping%20on%20s390x/mips%20for%20musl/near/228057029" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nagisa <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/bootstrapping.20on.20s390x.2Fmips.20for.20musl.html#228057029">(Feb 27 2021 at 13:00)</a>:</h4>
<p>It also does not work well if you mix and match dynamically linked dependencies and the statically linked musl</p>



<a name="228057045"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/bootstrapping%20on%20s390x/mips%20for%20musl/near/228057045" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nagisa <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/bootstrapping.20on.20s390x.2Fmips.20for.20musl.html#228057045">(Feb 27 2021 at 13:01)</a>:</h4>
<p>which can happen if you pull in a crate that depends on native libraries.</p>



<a name="228057057"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/bootstrapping%20on%20s390x/mips%20for%20musl/near/228057057" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ariadne Conill <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/bootstrapping.20on.20s390x.2Fmips.20for.20musl.html#228057057">(Feb 27 2021 at 13:01)</a>:</h4>
<p>i basically see this as a matter of equity.  whoever did the initial bringup for musl support in rust did not consult musl-based distributions.</p>



<a name="228057059"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/bootstrapping%20on%20s390x/mips%20for%20musl/near/228057059" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nagisa <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/bootstrapping.20on.20s390x.2Fmips.20for.20musl.html#228057059">(Feb 27 2021 at 13:01)</a>:</h4>
<p>A common example that comes up is panics not working right, or things crashing in weird ways.</p>



<a name="228057063"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/bootstrapping%20on%20s390x/mips%20for%20musl/near/228057063" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ariadne Conill <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/bootstrapping.20on.20s390x.2Fmips.20for.20musl.html#228057063">(Feb 27 2021 at 13:01)</a>:</h4>
<p>(because if they had, the -musl target would be the same as the other conventional targets)</p>



<a name="228057176"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/bootstrapping%20on%20s390x/mips%20for%20musl/near/228057176" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Laurențiu <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/bootstrapping.20on.20s390x.2Fmips.20for.20musl.html#228057176">(Feb 27 2021 at 13:03)</a>:</h4>
<p><span class="user-mention silent" data-user-id="123586">nagisa</span> <a href="#narrow/stream/131828-t-compiler/topic/bootstrapping.20on.20s390x.2Fmips.20for.20musl/near/228057059">said</a>:</p>
<blockquote>
<p>A common example that comes up is panics not working right, or things crashing in weird ways.</p>
</blockquote>
<p>Yeah, there was a nice example of that in <a href="#narrow/stream/122651-general/topic/.2Bcrt-static.20musl.20library.20and.20C.2B.2B.20exceptions">https://rust-lang.zulipchat.com/#narrow/stream/122651-general/topic/.2Bcrt-static.20musl.20library.20and.20C.2B.2B.20exceptions</a></p>



<a name="228057180"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/bootstrapping%20on%20s390x/mips%20for%20musl/near/228057180" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ariadne Conill <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/bootstrapping.20on.20s390x.2Fmips.20for.20musl.html#228057180">(Feb 27 2021 at 13:03)</a>:</h4>
<p>it is fine that the <code>-musl</code> targets exist, but it is misleading to users that believe that the <code>-musl</code> targets exhibit appropriate behavior on musl-based distros</p>



<a name="228057208"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/bootstrapping%20on%20s390x/mips%20for%20musl/near/228057208" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ariadne Conill <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/bootstrapping.20on.20s390x.2Fmips.20for.20musl.html#228057208">(Feb 27 2021 at 13:04)</a>:</h4>
<p>so in my view i think it is important to have a set of common targets that behave appropriately</p>



<a name="228057234"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/bootstrapping%20on%20s390x/mips%20for%20musl/near/228057234" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Laurențiu <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/bootstrapping.20on.20s390x.2Fmips.20for.20musl.html#228057234">(Feb 27 2021 at 13:04)</a>:</h4>
<p><span class="user-mention silent" data-user-id="360752">Ariadne Conill</span> <a href="#narrow/stream/131828-t-compiler/topic/bootstrapping.20on.20s390x.2Fmips.20for.20musl/near/228056867">said</a>:</p>
<blockquote>
<p>it is a policy violation</p>
</blockquote>
<p>Should that be mentioned in the PR description? It wasn't obvious to me why the targets were actually needed.</p>



<a name="228057266"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/bootstrapping%20on%20s390x/mips%20for%20musl/near/228057266" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ariadne Conill <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/bootstrapping.20on.20s390x.2Fmips.20for.20musl.html#228057266">(Feb 27 2021 at 13:05)</a>:</h4>
<p>though i agree with <span class="user-mention" data-user-id="123856">@Vadim Petrochenkov</span> that using targets for this purpose is overkill.  i don't see a better solution that can be easily implemented though.</p>



<a name="228057353"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/bootstrapping%20on%20s390x/mips%20for%20musl/near/228057353" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ariadne Conill <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/bootstrapping.20on.20s390x.2Fmips.20for.20musl.html#228057353">(Feb 27 2021 at 13:06)</a>:</h4>
<p>(the right solution would be to fix the <code>-musl</code> targets to have the same behavior as the other conventional targets, but users are presumably already using these targets assuming the behavior for their specific usecase, and we don't want to break those users)</p>



<a name="228057359"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/bootstrapping%20on%20s390x/mips%20for%20musl/near/228057359" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Laurențiu <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/bootstrapping.20on.20s390x.2Fmips.20for.20musl.html#228057359">(Feb 27 2021 at 13:06)</a>:</h4>
<p><span class="user-mention silent" data-user-id="360752">Ariadne Conill</span> <a href="#narrow/stream/131828-t-compiler/topic/bootstrapping.20on.20s390x.2Fmips.20for.20musl/near/228057266">said</a>:</p>
<blockquote>
<p>though i agree with <span class="user-mention silent" data-user-id="123856">Vadim Petrochenkov</span> that using targets for this purpose is overkill.  i don't see a better solution that can be easily implemented though.</p>
</blockquote>
<p>Aren't targets a bit weird? Each comes with its own copy of the standard library (if you add <code>rust-src</code>), docs etc., but they're identical</p>



<a name="228057437"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/bootstrapping%20on%20s390x/mips%20for%20musl/near/228057437" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ariadne Conill <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/bootstrapping.20on.20s390x.2Fmips.20for.20musl.html#228057437">(Feb 27 2021 at 13:08)</a>:</h4>
<p>anyway, my goal is to wind up with an out of box experience for musl-based distros that is the same as glibc-based distros</p>



<a name="228057455"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/bootstrapping%20on%20s390x/mips%20for%20musl/near/228057455" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ariadne Conill <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/bootstrapping.20on.20s390x.2Fmips.20for.20musl.html#228057455">(Feb 27 2021 at 13:08)</a>:</h4>
<p>i assume the rust community would find that to be valuable too</p>



<a name="228057609"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/bootstrapping%20on%20s390x/mips%20for%20musl/near/228057609" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ariadne Conill <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/bootstrapping.20on.20s390x.2Fmips.20for.20musl.html#228057609">(Feb 27 2021 at 13:11)</a>:</h4>
<p>(there are some staticly-linked musl distros, like Sabotage.  but rust is very incompatible with the Sabotage philosophy, so I don't think that is a helpful data point.)</p>



<a name="228057611"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/bootstrapping%20on%20s390x/mips%20for%20musl/near/228057611" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Laurențiu <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/bootstrapping.20on.20s390x.2Fmips.20for.20musl.html#228057611">(Feb 27 2021 at 13:11)</a>:</h4>
<p>(removed, this ended up being posted twice)</p>



<a name="228057785"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/bootstrapping%20on%20s390x/mips%20for%20musl/near/228057785" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ariadne Conill <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/bootstrapping.20on.20s390x.2Fmips.20for.20musl.html#228057785">(Feb 27 2021 at 13:14)</a>:</h4>
<p>I added that to the description.</p>



<a name="228057788"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/bootstrapping%20on%20s390x/mips%20for%20musl/near/228057788" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ariadne Conill <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/bootstrapping.20on.20s390x.2Fmips.20for.20musl.html#228057788">(Feb 27 2021 at 13:14)</a>:</h4>
<blockquote>
<p>These targets are required because Linux distributions generally consider static linking by default to be a policy violation. It is a policy violation in Alpine, Void and Adelie Linux, which are the top three musl-based distributions. Though it should also be said that there are staticly-linked musl distributions such as Sabotage, which would continue to be served by the -musl targets directly (if they ship Rust at all, I haven't checked).</p>
</blockquote>



<a name="228062203"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/bootstrapping%20on%20s390x/mips%20for%20musl/near/228062203" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ariadne Conill <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/bootstrapping.20on.20s390x.2Fmips.20for.20musl.html#228062203">(Feb 27 2021 at 14:42)</a>:</h4>
<p><span class="user-mention" data-user-id="123856">@Vadim Petrochenkov</span>'s solution is more elegant than introducing <code>-dynmusl</code> targets.  I like it.</p>



<a name="228063044"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/bootstrapping%20on%20s390x/mips%20for%20musl/near/228063044" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nagisa <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/bootstrapping.20on.20s390x.2Fmips.20for.20musl.html#228063044">(Feb 27 2021 at 14:59)</a>:</h4>
<p>It has downsides too, though. For example people who want to produce entirely static binaries and are on musl-based host will be confused by pretty much every blog post etc out there that suggests just adding a <code>--target=*-musl</code> is sufficient.</p>



<a name="228063206"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/bootstrapping%20on%20s390x/mips%20for%20musl/near/228063206" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nagisa <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/bootstrapping.20on.20s390x.2Fmips.20for.20musl.html#228063206">(Feb 27 2021 at 15:02)</a>:</h4>
<p>Another question comes up when we want to distribute pre-built rustc builds. What exactly does a <code>x86_64-unknown-linux-musl</code> rustc mean then?</p>



<a name="228063354"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/bootstrapping%20on%20s390x/mips%20for%20musl/near/228063354" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nagisa <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/bootstrapping.20on.20s390x.2Fmips.20for.20musl.html#228063354">(Feb 27 2021 at 15:04)</a>:</h4>
<p>this is particularly relevant for libstd and libcore probably, as they already come pre-compiled in those instances.</p>



<a name="228063512"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/bootstrapping%20on%20s390x/mips%20for%20musl/near/228063512" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ariadne Conill <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/bootstrapping.20on.20s390x.2Fmips.20for.20musl.html#228063512">(Feb 27 2021 at 15:08)</a>:</h4>
<p>should raise those points :)</p>



<a name="228063579"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/bootstrapping%20on%20s390x/mips%20for%20musl/near/228063579" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ariadne Conill <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/bootstrapping.20on.20s390x.2Fmips.20for.20musl.html#228063579">(Feb 27 2021 at 15:08)</a>:</h4>
<p>personally, i like the idea of just fixing the <code>-musl</code> targets.  they should never have been implemented that way to begin with, and conversation with the musl author would have confirmed that.</p>



<a name="228063959"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/bootstrapping%20on%20s390x/mips%20for%20musl/near/228063959" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ariadne Conill <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/bootstrapping.20on.20s390x.2Fmips.20for.20musl.html#228063959">(Feb 27 2021 at 15:15)</a>:</h4>
<p>incidentally, rich felker agrees that <code>-musl</code> should not be staticly linked in <em>any</em> case by default</p>



<a name="228063968"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/bootstrapping%20on%20s390x/mips%20for%20musl/near/228063968" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ariadne Conill <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/bootstrapping.20on.20s390x.2Fmips.20for.20musl.html#228063968">(Feb 27 2021 at 15:15)</a>:</h4>
<p>so i think if people want to fix <code>-musl</code> target, it should be fixed in a consistent way</p>



<a name="228064083"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/bootstrapping%20on%20s390x/mips%20for%20musl/near/228064083" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ariadne Conill <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/bootstrapping.20on.20s390x.2Fmips.20for.20musl.html#228064083">(Feb 27 2021 at 15:17)</a>:</h4>
<div class="codehilite"><pre><span></span><code>[07:49:23] &lt;Ariadne&gt; so -dynmusl isn&#39;t going to happen after all, and -musl is just going to be fixed
[07:52:05] &lt;dalias&gt; good
[07:52:19] &lt;dalias&gt; the &quot;differently static by default&quot; makes no sense
[07:52:25] &lt;dalias&gt; if you want a static binary just pass -static
[07:52:27] &lt;dalias&gt; same as all targets
[07:53:02] &lt;Cogitri&gt; Sure, but it&#39;ll be a rather huge break from the previous behaviour, so my understanding was that they didn&#39;t want to do rhat
[07:53:23] &lt;dalias&gt; *sigh*
[07:53:43] &lt;Ariadne&gt; Cogitri: they are adding backwards compatibility code to handle that for glibc hosts
[07:53:53] &lt;dalias&gt; ...
[07:53:58] &lt;Ariadne&gt; so if you do rust build on a glibc host with musl, it will still be static
[07:54:09] &lt;dalias&gt; that&#39;s so broken -- isn&#39;t it going to break the rather normal case of cross compiling?
[07:54:10] &lt;Ariadne&gt; if you do rust build on musl host with musl it will be dynamic
[07:54:35] &lt;Ariadne&gt; dalias: no, it will keep the behavior the same as it is now for cross compiling
[07:54:45] &lt;dalias&gt; the behavior now IS BROKEN
[07:54:52] &lt;Ariadne&gt; yes, i agree
[07:55:00] &lt;Ariadne&gt; but i don&#39;t care about glibc to musl cross :P
[07:55:04] &lt;dalias&gt; if i want to cross compile for arm-linux-musleabihf and don&#39;t put -static i want dynamic binaries
[07:55:15] &lt;dalias&gt; and doing that from glibc host is a fairly common thing ppl do
[07:55:36] &lt;Ariadne&gt; for that case, you just use -C features=-crt-static
[07:55:41] &lt;Ariadne&gt; as you do now :P
[07:55:49] &lt;dalias&gt; ...
[07:55:58] &lt;dalias&gt; no, now i don&#39;t use rust
[07:56:10] &lt;dalias&gt; but if/when i do, i want it not to violate least-surprise in stupid ways
</code></pre></div>



<a name="228064476"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/bootstrapping%20on%20s390x/mips%20for%20musl/near/228064476" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jubilee <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/bootstrapping.20on.20s390x.2Fmips.20for.20musl.html#228064476">(Feb 27 2021 at 15:24)</a>:</h4>
<p>( Rich Felker is dalias. )</p>



<a name="228064582"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/bootstrapping%20on%20s390x/mips%20for%20musl/near/228064582" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ariadne Conill <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/bootstrapping.20on.20s390x.2Fmips.20for.20musl.html#228064582">(Feb 27 2021 at 15:26)</a>:</h4>
<p>i have to say, if people talked to the musl community instead of making assumptions about musl 5 years ago, we would probably not be having this conversation now :P</p>



<a name="228064619"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/bootstrapping%20on%20s390x/mips%20for%20musl/near/228064619" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ariadne Conill <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/bootstrapping.20on.20s390x.2Fmips.20for.20musl.html#228064619">(Feb 27 2021 at 15:27)</a>:</h4>
<p>anyway i asked rich to comment on the PR</p>



<a name="228064626"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/bootstrapping%20on%20s390x/mips%20for%20musl/near/228064626" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ariadne Conill <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/bootstrapping.20on.20s390x.2Fmips.20for.20musl.html#228064626">(Feb 27 2021 at 15:27)</a>:</h4>
<p>i would like to withdraw any merge until we completely talk this through</p>



<a name="228064636"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/bootstrapping%20on%20s390x/mips%20for%20musl/near/228064636" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ariadne Conill <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/bootstrapping.20on.20s390x.2Fmips.20for.20musl.html#228064636">(Feb 27 2021 at 15:28)</a>:</h4>
<p>because ultimately i think we need to just solve this once and for all and <code>-dynmusl</code> is walking around the elephant in the room</p>



<a name="228064720"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/bootstrapping%20on%20s390x/mips%20for%20musl/near/228064720" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ariadne Conill <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/bootstrapping.20on.20s390x.2Fmips.20for.20musl.html#228064720">(Feb 27 2021 at 15:29)</a>:</h4>
<p>and i think that is ultimately <span class="user-mention" data-user-id="123856">@Vadim Petrochenkov</span>'s point, that we're not solving the real problem here</p>



<a name="228064723"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/bootstrapping%20on%20s390x/mips%20for%20musl/near/228064723" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jubilee <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/bootstrapping.20on.20s390x.2Fmips.20for.20musl.html#228064723">(Feb 27 2021 at 15:29)</a>:</h4>
<p>You don't have to worry about this being merged prematurely, even if everyone voted NOW, it would not immediately get merged.</p>



<a name="228064780"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/bootstrapping%20on%20s390x/mips%20for%20musl/near/228064780" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jubilee <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/bootstrapping.20on.20s390x.2Fmips.20for.20musl.html#228064780">(Feb 27 2021 at 15:30)</a>:</h4>
<p>and uh, it takes more than a second to round up all the <del>cats</del> compiler developers.</p>



<a name="228064978"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/bootstrapping%20on%20s390x/mips%20for%20musl/near/228064978" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jubilee <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/bootstrapping.20on.20s390x.2Fmips.20for.20musl.html#228064978">(Feb 27 2021 at 15:33)</a>:</h4>
<p>The final comment period would then be open for about 10 days, so apologies if you had a tight deadline for this. :^)</p>



<a name="228065246"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/bootstrapping%20on%20s390x/mips%20for%20musl/near/228065246" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ariadne Conill <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/bootstrapping.20on.20s390x.2Fmips.20for.20musl.html#228065246">(Feb 27 2021 at 15:38)</a>:</h4>
<p>i do not have a tight deadline, we do not ship alpine 3.14 until may or june :)</p>



<a name="228065254"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/bootstrapping%20on%20s390x/mips%20for%20musl/near/228065254" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ariadne Conill <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/bootstrapping.20on.20s390x.2Fmips.20for.20musl.html#228065254">(Feb 27 2021 at 15:38)</a>:</h4>
<p>but hey, if we're going to go through RFC process, we might as well just fix <code>-musl</code> targets properly.</p>



<a name="228065279"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/bootstrapping%20on%20s390x/mips%20for%20musl/near/228065279" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Alex Gaynor <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/bootstrapping.20on.20s390x.2Fmips.20for.20musl.html#228065279">(Feb 27 2021 at 15:39)</a>:</h4>
<p>Does Rust's backwards compatibility policy permit this change?</p>



<a name="228065282"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/bootstrapping%20on%20s390x/mips%20for%20musl/near/228065282" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ariadne Conill <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/bootstrapping.20on.20s390x.2Fmips.20for.20musl.html#228065282">(Feb 27 2021 at 15:39)</a>:</h4>
<p>considering rust did something that if musl had a trademark policy, it would be suing rust over...</p>



<a name="228065334"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/bootstrapping%20on%20s390x/mips%20for%20musl/near/228065334" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ariadne Conill <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/bootstrapping.20on.20s390x.2Fmips.20for.20musl.html#228065334">(Feb 27 2021 at 15:40)</a>:</h4>
<p>well maybe suing is too strong a word, but :P</p>



<a name="228065343"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/bootstrapping%20on%20s390x/mips%20for%20musl/near/228065343" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Alex Gaynor <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/bootstrapping.20on.20s390x.2Fmips.20for.20musl.html#228065343">(Feb 27 2021 at 15:40)</a>:</h4>
<p>I've actually never seen a backwards compatibility policy with a litigation exception :P Security is the usual exception.</p>



<a name="228065374"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/bootstrapping%20on%20s390x/mips%20for%20musl/near/228065374" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ariadne Conill <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/bootstrapping.20on.20s390x.2Fmips.20for.20musl.html#228065374">(Feb 27 2021 at 15:41)</a>:</h4>
<p>i'm not sure what to do re: that policy, but this whole situation boils down to somebody getting something merged without doing the proper communications with their other stakeholders (the people who actually hack on musl, like me and rich and so on)</p>



<a name="228065377"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/bootstrapping%20on%20s390x/mips%20for%20musl/near/228065377" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ariadne Conill <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/bootstrapping.20on.20s390x.2Fmips.20for.20musl.html#228065377">(Feb 27 2021 at 15:41)</a>:</h4>
<p>i would certainly hope a backwards compatibility policy has some allowances for correcting mistakes</p>



<a name="228065444"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/bootstrapping%20on%20s390x/mips%20for%20musl/near/228065444" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Alex Gaynor <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/bootstrapping.20on.20s390x.2Fmips.20for.20musl.html#228065444">(Feb 27 2021 at 15:42)</a>:</h4>
<p>I don't know. I'm genuinely asking.</p>



<a name="228065451"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/bootstrapping%20on%20s390x/mips%20for%20musl/near/228065451" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ariadne Conill <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/bootstrapping.20on.20s390x.2Fmips.20for.20musl.html#228065451">(Feb 27 2021 at 15:42)</a>:</h4>
<p>there was a whole "musl is for static linking" meme on hacker news, my guess would be that's where this mistake originated from</p>



<a name="228065471"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/bootstrapping%20on%20s390x/mips%20for%20musl/near/228065471" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Laurențiu <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/bootstrapping.20on.20s390x.2Fmips.20for.20musl.html#228065471">(Feb 27 2021 at 15:43)</a>:</h4>
<p>Maybe deprecate the original target and add a new, <code>dynmusl</code> one <span aria-label="confused" class="emoji emoji-1f615" role="img" title="confused">:confused:</span></p>



<a name="228065479"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/bootstrapping%20on%20s390x/mips%20for%20musl/near/228065479" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jubilee <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/bootstrapping.20on.20s390x.2Fmips.20for.20musl.html#228065479">(Feb 27 2021 at 15:43)</a>:</h4>
<p>I do not believe the backwards compatibility guarantees substantively apply here. They strongly apply to <em>code</em>, and <strong>types</strong>.</p>



<a name="228065546"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/bootstrapping%20on%20s390x/mips%20for%20musl/near/228065546" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ariadne Conill <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/bootstrapping.20on.20s390x.2Fmips.20for.20musl.html#228065546">(Feb 27 2021 at 15:44)</a>:</h4>
<p>yes, at least from my side (Alpine and also as a musl contributor), i see this as a well overdue bugfix and <code>-dynmusl</code> as a workaround</p>



<a name="228065556"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/bootstrapping%20on%20s390x/mips%20for%20musl/near/228065556" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ariadne Conill <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/bootstrapping.20on.20s390x.2Fmips.20for.20musl.html#228065556">(Feb 27 2021 at 15:44)</a>:</h4>
<p><span class="user-mention" data-user-id="123856">@Vadim Petrochenkov</span> indicated he wants to see an actual bugfix and not a workaround :P</p>



<a name="228065575"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/bootstrapping%20on%20s390x/mips%20for%20musl/near/228065575" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jubilee <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/bootstrapping.20on.20s390x.2Fmips.20for.20musl.html#228065575">(Feb 27 2021 at 15:45)</a>:</h4>
<p>And even then the famed Rust "backwards compatibility policy" is actually more of a specification of what <strong>won't</strong> be considered as subject to backwards compatibility concerns, since the passive policy in many other langs is to, when you find out that you implemented something in an unsound way, go "oh well".</p>



<a name="228065593"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/bootstrapping%20on%20s390x/mips%20for%20musl/near/228065593" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jubilee <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/bootstrapping.20on.20s390x.2Fmips.20for.20musl.html#228065593">(Feb 27 2021 at 15:45)</a>:</h4>
<p>instead of breaking it.</p>



<a name="228065604"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/bootstrapping%20on%20s390x/mips%20for%20musl/near/228065604" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ariadne Conill <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/bootstrapping.20on.20s390x.2Fmips.20for.20musl.html#228065604">(Feb 27 2021 at 15:45)</a>:</h4>
<p>however i do admit there is a lot of (wrong) advice that says if you want staticly linked rust binaries use <code>--target=*-musl</code></p>



<a name="228065652"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/bootstrapping%20on%20s390x/mips%20for%20musl/near/228065652" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ariadne Conill <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/bootstrapping.20on.20s390x.2Fmips.20for.20musl.html#228065652">(Feb 27 2021 at 15:46)</a>:</h4>
<p>so, some way of managing expectations seems appropriate</p>



<a name="228065664"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/bootstrapping%20on%20s390x/mips%20for%20musl/near/228065664" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jubilee <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/bootstrapping.20on.20s390x.2Fmips.20for.20musl.html#228065664">(Feb 27 2021 at 15:46)</a>:</h4>
<p>So, Rust actually promises to break you if something unsound is discovered. :^)<br>
Indeed, though I would say <em>any</em> change here requires heavy marketing.</p>



<a name="228065695"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/bootstrapping%20on%20s390x/mips%20for%20musl/near/228065695" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ariadne Conill <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/bootstrapping.20on.20s390x.2Fmips.20for.20musl.html#228065695">(Feb 27 2021 at 15:47)</a>:</h4>
<p>on the bug i proposed fixing the <code>-musl</code> targets and having it print a warning.  musl distros can just patch out that warning for now.</p>



<a name="228065707"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/bootstrapping%20on%20s390x/mips%20for%20musl/near/228065707" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ariadne Conill <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/bootstrapping.20on.20s390x.2Fmips.20for.20musl.html#228065707">(Feb 27 2021 at 15:47)</a>:</h4>
<p>i think this is a reasonable approach that aligns the rust musl target with reality</p>



<a name="228065803"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/bootstrapping%20on%20s390x/mips%20for%20musl/near/228065803" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nagisa <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/bootstrapping.20on.20s390x.2Fmips.20for.20musl.html#228065803">(Feb 27 2021 at 15:49)</a>:</h4>
<p><span class="user-mention silent" data-user-id="130046">Alex Gaynor</span> <a href="#narrow/stream/131828-t-compiler/topic/bootstrapping.20on.20s390x.2Fmips.20for.20musl/near/228065279">said</a>:</p>
<blockquote>
<p>Does Rust's backwards compatibility policy permit this change?</p>
</blockquote>
<p>Targets historically haven't been following the strict interpretation of backwards compatibility that APIs do. In recent memory we both downgraded target tiers and removed existing unmaintained/unused targets.</p>



<a name="228065871"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/bootstrapping%20on%20s390x/mips%20for%20musl/near/228065871" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nagisa <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/bootstrapping.20on.20s390x.2Fmips.20for.20musl.html#228065871">(Feb 27 2021 at 15:50)</a>:</h4>
<p>/me remembers <a href="https://github.com/rust-lang/rust/issues/81514">https://github.com/rust-lang/rust/issues/81514</a> and goes to delete the target in question.</p>



<a name="228065891"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/bootstrapping%20on%20s390x/mips%20for%20musl/near/228065891" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ariadne Conill <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/bootstrapping.20on.20s390x.2Fmips.20for.20musl.html#228065891">(Feb 27 2021 at 15:51)</a>:</h4>
<p>i wonder if there should be some documented best practices for target maintainers too</p>



<a name="228065900"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/bootstrapping%20on%20s390x/mips%20for%20musl/near/228065900" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ariadne Conill <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/bootstrapping.20on.20s390x.2Fmips.20for.20musl.html#228065900">(Feb 27 2021 at 15:51)</a>:</h4>
<p>like i said, lack of communication is why we find ourselves in this mess with musl :)</p>



<a name="228065976"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/bootstrapping%20on%20s390x/mips%20for%20musl/near/228065976" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Nikita Popov <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/bootstrapping.20on.20s390x.2Fmips.20for.20musl.html#228065976">(Feb 27 2021 at 15:52)</a>:</h4>
<p>It would be nice to specify points of contact for targets and docker images</p>



<a name="228066005"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/bootstrapping%20on%20s390x/mips%20for%20musl/near/228066005" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ariadne Conill <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/bootstrapping.20on.20s390x.2Fmips.20for.20musl.html#228066005">(Feb 27 2021 at 15:53)</a>:</h4>
<p>also if there is anything alpine or the musl community at large can provide to rust, let me know and i'll try to get it going</p>



<a name="228066011"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/bootstrapping%20on%20s390x/mips%20for%20musl/near/228066011" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jubilee <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/bootstrapping.20on.20s390x.2Fmips.20for.20musl.html#228066011">(Feb 27 2021 at 15:53)</a>:</h4>
<p>It could be just my perception, but based on what I've noticed, targets are often introduced by people who have a desire to compile for that target, who have their own motivations that may not be aligned with the Rust compiler's long term interests nor the target's long term interests.</p>



<a name="228066018"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/bootstrapping%20on%20s390x/mips%20for%20musl/near/228066018" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ariadne Conill <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/bootstrapping.20on.20s390x.2Fmips.20for.20musl.html#228066018">(Feb 27 2021 at 15:53)</a>:</h4>
<p>we are working on providing some musl-based systems for Python CI :)</p>



<a name="228066118"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/bootstrapping%20on%20s390x/mips%20for%20musl/near/228066118" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ariadne Conill <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/bootstrapping.20on.20s390x.2Fmips.20for.20musl.html#228066118">(Feb 27 2021 at 15:55)</a>:</h4>
<p>yes, absolutely.  and when i say communication, i mean that FOSS world at large could stand to have better communication.</p>



<a name="228066171"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/bootstrapping%20on%20s390x/mips%20for%20musl/near/228066171" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ariadne Conill <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/bootstrapping.20on.20s390x.2Fmips.20for.20musl.html#228066171">(Feb 27 2021 at 15:56)</a>:</h4>
<p>the musl community should have been more proactive in engaging with the rust team</p>



<a name="228066173"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/bootstrapping%20on%20s390x/mips%20for%20musl/near/228066173" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jubilee <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/bootstrapping.20on.20s390x.2Fmips.20for.20musl.html#228066173">(Feb 27 2021 at 15:56)</a>:</h4>
<p>So without knowing the history per se, I think that the null hypothesis is that it wasn't even necessarily a misunderstanding that caused musl to be static linked by default so much as the person adding musl targets just wanted a musl target that does static linking. <span aria-label="shrug" class="emoji emoji-1f937" role="img" title="shrug">:shrug:</span></p>



<a name="228066180"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/bootstrapping%20on%20s390x/mips%20for%20musl/near/228066180" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nagisa <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/bootstrapping.20on.20s390x.2Fmips.20for.20musl.html#228066180">(Feb 27 2021 at 15:56)</a>:</h4>
<p><span class="user-mention silent" data-user-id="281757">Jubilee</span> <a href="#narrow/stream/131828-t-compiler/topic/bootstrapping.20on.20s390x.2Fmips.20for.20musl/near/228066011">said</a>:</p>
<blockquote>
<p>It could be just my perception, but based on what I've noticed, targets are often introduced by people who have a desire to compile for that target, who have their own motivations that may not be aligned with the Rust compiler's long term interests nor the target's long term interests.</p>
</blockquote>
<p>Yes, the <code>musl</code> targets were introduced with a primary motivation of being able to quickly build self-contained things without needing to set anything up – that's why they ship the entire musl with the libstd.</p>



<a name="228066204"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/bootstrapping%20on%20s390x/mips%20for%20musl/near/228066204" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ariadne Conill <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/bootstrapping.20on.20s390x.2Fmips.20for.20musl.html#228066204">(Feb 27 2021 at 15:57)</a>:</h4>
<p>and that's fine, but the targets should have been named appropriately</p>



<a name="228066213"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/bootstrapping%20on%20s390x/mips%20for%20musl/near/228066213" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ariadne Conill <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/bootstrapping.20on.20s390x.2Fmips.20for.20musl.html#228066213">(Feb 27 2021 at 15:57)</a>:</h4>
<p>because now we've been patching since 2015 :)</p>



<a name="228066271"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/bootstrapping%20on%20s390x/mips%20for%20musl/near/228066271" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nagisa <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/bootstrapping.20on.20s390x.2Fmips.20for.20musl.html#228066271">(Feb 27 2021 at 15:58)</a>:</h4>
<p><a href="https://github.com/rust-lang/rust/pull/24777">https://github.com/rust-lang/rust/pull/24777</a></p>



<a name="228066292"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/bootstrapping%20on%20s390x/mips%20for%20musl/near/228066292" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nagisa <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/bootstrapping.20on.20s390x.2Fmips.20for.20musl.html#228066292">(Feb 27 2021 at 15:59)</a>:</h4>
<blockquote>
<p>The outcome here is that there are 0 compile-time dependencies for a MUSL-targeting build except for a linker.</p>
</blockquote>



<a name="228066308"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/bootstrapping%20on%20s390x/mips%20for%20musl/near/228066308" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jubilee <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/bootstrapping.20on.20s390x.2Fmips.20for.20musl.html#228066308">(Feb 27 2021 at 15:59)</a>:</h4>
<p>yep.</p>



<a name="228066316"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/bootstrapping%20on%20s390x/mips%20for%20musl/near/228066316" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ariadne Conill <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/bootstrapping.20on.20s390x.2Fmips.20for.20musl.html#228066316">(Feb 27 2021 at 15:59)</a>:</h4>
<p>yeah good deal for alex, bad deal for the ecosystem at large :P</p>



<a name="228066457"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/bootstrapping%20on%20s390x/mips%20for%20musl/near/228066457" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jubilee <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/bootstrapping.20on.20s390x.2Fmips.20for.20musl.html#228066457">(Feb 27 2021 at 16:01)</a>:</h4>
<p>Believing someone would just fix it within the next year or two if it was a big issue probably seemed like a sane assumption at the time. :^)</p>



<a name="228066477"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/bootstrapping%20on%20s390x/mips%20for%20musl/near/228066477" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ariadne Conill <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/bootstrapping.20on.20s390x.2Fmips.20for.20musl.html#228066477">(Feb 27 2021 at 16:02)</a>:</h4>
<p>we were busy dealing with the whole docker revolution</p>



<a name="228066549"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/bootstrapping%20on%20s390x/mips%20for%20musl/near/228066549" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ariadne Conill <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/bootstrapping.20on.20s390x.2Fmips.20for.20musl.html#228066549">(Feb 27 2021 at 16:02)</a>:</h4>
<p>prior to docker, there were maybe 10,000 people using musl-based distros</p>



<a name="228066551"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/bootstrapping%20on%20s390x/mips%20for%20musl/near/228066551" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jubilee <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/bootstrapping.20on.20s390x.2Fmips.20for.20musl.html#228066551">(Feb 27 2021 at 16:02)</a>:</h4>
<p>oh dear.</p>



<a name="228066581"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/bootstrapping%20on%20s390x/mips%20for%20musl/near/228066581" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jubilee <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/bootstrapping.20on.20s390x.2Fmips.20for.20musl.html#228066581">(Feb 27 2021 at 16:03)</a>:</h4>
<p>then people noticed they could get tiny images on Alpine Linux or whatever</p>



<a name="228066613"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/bootstrapping%20on%20s390x/mips%20for%20musl/near/228066613" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ariadne Conill <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/bootstrapping.20on.20s390x.2Fmips.20for.20musl.html#228066613">(Feb 27 2021 at 16:03)</a>:</h4>
<p>well, that's not exactly what happened</p>



<a name="228066661"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/bootstrapping%20on%20s390x/mips%20for%20musl/near/228066661" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ariadne Conill <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/bootstrapping.20on.20s390x.2Fmips.20for.20musl.html#228066661">(Feb 27 2021 at 16:04)</a>:</h4>
<p>Solomon did the Alpine deal as a big middle finger to Canonical because they pissed him off</p>



<a name="228066673"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/bootstrapping%20on%20s390x/mips%20for%20musl/near/228066673" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ariadne Conill <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/bootstrapping.20on.20s390x.2Fmips.20for.20musl.html#228066673">(Feb 27 2021 at 16:04)</a>:</h4>
<p>something about competing with his company while saying they weren't (:</p>



<a name="228066720"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/bootstrapping%20on%20s390x/mips%20for%20musl/near/228066720" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ariadne Conill <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/bootstrapping.20on.20s390x.2Fmips.20for.20musl.html#228066720">(Feb 27 2021 at 16:05)</a>:</h4>
<p>Alpine was a good target for Docker to base on because it was small, but more importantly because they could employ a good chunk of the dev team.</p>



<a name="228066735"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/bootstrapping%20on%20s390x/mips%20for%20musl/near/228066735" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ariadne Conill <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/bootstrapping.20on.20s390x.2Fmips.20for.20musl.html#228066735">(Feb 27 2021 at 16:05)</a>:</h4>
<p>and if you have a good chunk of a distro's dev team on your payroll, you tend to get what you want done</p>



<a name="228066833"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/bootstrapping%20on%20s390x/mips%20for%20musl/near/228066833" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ariadne Conill <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/bootstrapping.20on.20s390x.2Fmips.20for.20musl.html#228066833">(Feb 27 2021 at 16:07)</a>:</h4>
<p>but as a result of that we went from being a small distro to being a mainstream distro in about a year</p>



<a name="228066838"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/bootstrapping%20on%20s390x/mips%20for%20musl/near/228066838" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ariadne Conill <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/bootstrapping.20on.20s390x.2Fmips.20for.20musl.html#228066838">(Feb 27 2021 at 16:07)</a>:</h4>
<p>and that was going on at the same time as rust growing musl support</p>



<a name="228080418"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/bootstrapping%20on%20s390x/mips%20for%20musl/near/228080418" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ariadne Conill <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/bootstrapping.20on.20s390x.2Fmips.20for.20musl.html#228080418">(Feb 27 2021 at 20:17)</a>:</h4>
<p>well if y’all don’t hate me already you’ll hate my next initiative after sorting the musl mess</p>



<a name="228080470"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/bootstrapping%20on%20s390x/mips%20for%20musl/near/228080470" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ariadne Conill <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/bootstrapping.20on.20s390x.2Fmips.20for.20musl.html#228080470">(Feb 27 2021 at 20:18)</a>:</h4>
<p>which is going to be figure out how to slim down the overhead of libstd</p>



<a name="228080518"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/bootstrapping%20on%20s390x/mips%20for%20musl/near/228080518" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ariadne Conill <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/bootstrapping.20on.20s390x.2Fmips.20for.20musl.html#228080518">(Feb 27 2021 at 20:19)</a>:</h4>
<p>i would like to start porting alpine user space components to rust, but going from 55kb to 500+kb for ifupdown-ng as an example, is going to get people wanting to burn a witch</p>



<a name="228080525"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/bootstrapping%20on%20s390x/mips%20for%20musl/near/228080525" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> bjorn3 <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/bootstrapping.20on.20s390x.2Fmips.20for.20musl.html#228080525">(Feb 27 2021 at 20:19)</a>:</h4>
<p><code>-Clto=yes -Oz</code></p>



<a name="228080526"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/bootstrapping%20on%20s390x/mips%20for%20musl/near/228080526" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ariadne Conill <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/bootstrapping.20on.20s390x.2Fmips.20for.20musl.html#228080526">(Feb 27 2021 at 20:19)</a>:</h4>
<p>hot damn</p>



<a name="228080536"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/bootstrapping%20on%20s390x/mips%20for%20musl/near/228080536" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ariadne Conill <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/bootstrapping.20on.20s390x.2Fmips.20for.20musl.html#228080536">(Feb 27 2021 at 20:20)</a>:</h4>
<p>going to have to check that out</p>



<a name="228080633"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/bootstrapping%20on%20s390x/mips%20for%20musl/near/228080633" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> bjorn3 <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/bootstrapping.20on.20s390x.2Fmips.20for.20musl.html#228080633">(Feb 27 2021 at 20:21)</a>:</h4>
<p>LTO is often very effective at stripping away big chunks of libstd. Even <code>--gc-sections</code>, which is passed by rustc by default, doesn't help as much as LTO at removing dead code.</p>



<a name="228080708"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/bootstrapping%20on%20s390x/mips%20for%20musl/near/228080708" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ariadne Conill <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/bootstrapping.20on.20s390x.2Fmips.20for.20musl.html#228080708">(Feb 27 2021 at 20:22)</a>:</h4>
<p>well it would be nice if we had dynamic linking for crates too</p>



<a name="228080709"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/bootstrapping%20on%20s390x/mips%20for%20musl/near/228080709" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> bjorn3 <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/bootstrapping.20on.20s390x.2Fmips.20for.20musl.html#228080709">(Feb 27 2021 at 20:22)</a>:</h4>
<p>You can also use <code>-Cprefer-dynamic</code> to dynamically link the standard library.</p>



<a name="228080710"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/bootstrapping%20on%20s390x/mips%20for%20musl/near/228080710" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ariadne Conill <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/bootstrapping.20on.20s390x.2Fmips.20for.20musl.html#228080710">(Feb 27 2021 at 20:22)</a>:</h4>
<p>that would help a lot</p>



<a name="228080712"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/bootstrapping%20on%20s390x/mips%20for%20musl/near/228080712" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ariadne Conill <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/bootstrapping.20on.20s390x.2Fmips.20for.20musl.html#228080712">(Feb 27 2021 at 20:22)</a>:</h4>
<p>o...</p>



<a name="228080715"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/bootstrapping%20on%20s390x/mips%20for%20musl/near/228080715" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ariadne Conill <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/bootstrapping.20on.20s390x.2Fmips.20for.20musl.html#228080715">(Feb 27 2021 at 20:22)</a>:</h4>
<p>huh</p>



<a name="228080757"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/bootstrapping%20on%20s390x/mips%20for%20musl/near/228080757" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> bjorn3 <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/bootstrapping.20on.20s390x.2Fmips.20for.20musl.html#228080757">(Feb 27 2021 at 20:23)</a>:</h4>
<p>You do need the corresponding libstd, but given that the filename changes for every rustc version, that shouldn't cause any conflicts.</p>



<a name="228080886"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/bootstrapping%20on%20s390x/mips%20for%20musl/near/228080886" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ariadne Conill <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/bootstrapping.20on.20s390x.2Fmips.20for.20musl.html#228080886">(Feb 27 2021 at 20:25)</a>:</h4>
<p>seems to me i could slot the libstd crate</p>



<a name="228080899"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/bootstrapping%20on%20s390x/mips%20for%20musl/near/228080899" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ariadne Conill <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/bootstrapping.20on.20s390x.2Fmips.20for.20musl.html#228080899">(Feb 27 2021 at 20:25)</a>:</h4>
<p>that would allow multiple <a href="http://libstd.so">libstd.so</a> to be managed by apk at the same time</p>



<a name="228081163"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/bootstrapping%20on%20s390x/mips%20for%20musl/near/228081163" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ariadne Conill <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/bootstrapping.20on.20s390x.2Fmips.20for.20musl.html#228081163">(Feb 27 2021 at 20:30)</a>:</h4>
<p>well then it’s very likely that we will replace busybox with a rust replacement</p>



<a name="228081212"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/bootstrapping%20on%20s390x/mips%20for%20musl/near/228081212" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> bjorn3 <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/bootstrapping.20on.20s390x.2Fmips.20for.20musl.html#228081212">(Feb 27 2021 at 20:31)</a>:</h4>
<p>Something like <a href="https://github.com/uutils/coreutils">https://github.com/uutils/coreutils</a> you mean?</p>



<a name="228081241"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/bootstrapping%20on%20s390x/mips%20for%20musl/near/228081241" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> bjorn3 <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/bootstrapping.20on.20s390x.2Fmips.20for.20musl.html#228081241">(Feb 27 2021 at 20:31)</a>:</h4>
<p>Or <a href="https://github.com/mesalock-linux/mesabox">https://github.com/mesalock-linux/mesabox</a>?</p>



<a name="228081700"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/bootstrapping%20on%20s390x/mips%20for%20musl/near/228081700" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> bjorn3 <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/bootstrapping.20on.20s390x.2Fmips.20for.20musl.html#228081700">(Feb 27 2021 at 20:38)</a>:</h4>
<p>In rust dylibs don't have the best ergonomics currently. They will link into themself all their rlib dependencies. If two dylibs depend on the same rlib, rustc will throw an error as that would cause the rlib to be included twice. Most crates don't specify a dylib as possible crate type, so it rarely causes problems, but it does happen a bit more often when using <code>-Cprefer-dynamic</code> as that will cause dylibs to be preferred over rlibs when both are available. It is probably not something to worry about, but just in case you happen to encounter it, I am telling this.</p>



<a name="228081938"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/bootstrapping%20on%20s390x/mips%20for%20musl/near/228081938" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ariadne Conill <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/bootstrapping.20on.20s390x.2Fmips.20for.20musl.html#228081938">(Feb 27 2021 at 20:42)</a>:</h4>
<p>yeah my understanding is dylibs are very experimental still</p>



<a name="228082440"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/bootstrapping%20on%20s390x/mips%20for%20musl/near/228082440" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> bjorn3 <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/bootstrapping.20on.20s390x.2Fmips.20for.20musl.html#228082440">(Feb 27 2021 at 20:52)</a>:</h4>
<p>I would very much love the rough edges to be gone. The jit mode of cg_clif doesn't support loading unlinked rlibs, only linked dylibs using dlopen, so it needs dylibs.</p>



<a name="228082724"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/bootstrapping%20on%20s390x/mips%20for%20musl/near/228082724" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jubilee <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/bootstrapping.20on.20s390x.2Fmips.20for.20musl.html#228082724">(Feb 27 2021 at 20:58)</a>:</h4>
<p>Yes I think while it technically is not marked by an unstable flag, "overly much messing with linker stuff" seems to have "All hope abandon ye who enter here" somewhere around it.</p>



<a name="228082746"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/bootstrapping%20on%20s390x/mips%20for%20musl/near/228082746" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ariadne Conill <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/bootstrapping.20on.20s390x.2Fmips.20for.20musl.html#228082746">(Feb 27 2021 at 20:59)</a>:</h4>
<p>with <code>-Cprefer-dynamic</code> a stripped hello world program is 14kb</p>



<a name="228082751"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/bootstrapping%20on%20s390x/mips%20for%20musl/near/228082751" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ariadne Conill <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/bootstrapping.20on.20s390x.2Fmips.20for.20musl.html#228082751">(Feb 27 2021 at 20:59)</a>:</h4>
<p>which is "sellable"</p>



<a name="228082855"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/bootstrapping%20on%20s390x/mips%20for%20musl/near/228082855" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jubilee <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/bootstrapping.20on.20s390x.2Fmips.20for.20musl.html#228082855">(Feb 27 2021 at 21:01)</a>:</h4>
<p>I think I already mentioned that there's also been efforts to use gold or lld as a linker, which may be better/worse at GCing like that.</p>



<a name="228082972"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/bootstrapping%20on%20s390x/mips%20for%20musl/near/228082972" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> bjorn3 <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/bootstrapping.20on.20s390x.2Fmips.20for.20musl.html#228082972">(Feb 27 2021 at 21:03)</a>:</h4>
<p>lld is a bit worse. 15k</p>



<a name="228082983"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/bootstrapping%20on%20s390x/mips%20for%20musl/near/228082983" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jubilee <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/bootstrapping.20on.20s390x.2Fmips.20for.20musl.html#228082983">(Feb 27 2021 at 21:03)</a>:</h4>
<p>Interesting. I wonder if they have different performance on larger projects.</p>



<a name="228082985"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/bootstrapping%20on%20s390x/mips%20for%20musl/near/228082985" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> bjorn3 <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/bootstrapping.20on.20s390x.2Fmips.20for.20musl.html#228082985">(Feb 27 2021 at 21:03)</a>:</h4>
<p>gold is better. 11k<br>
edit: rounding</p>



<a name="228082986"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/bootstrapping%20on%20s390x/mips%20for%20musl/near/228082986" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jubilee <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/bootstrapping.20on.20s390x.2Fmips.20for.20musl.html#228082986">(Feb 27 2021 at 21:03)</a>:</h4>
<p>aah, nice.</p>



<a name="228083043"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/bootstrapping%20on%20s390x/mips%20for%20musl/near/228083043" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> bjorn3 <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/bootstrapping.20on.20s390x.2Fmips.20for.20musl.html#228083043">(Feb 27 2021 at 21:04)</a>:</h4>
<p>With optimizations and gold just 6k.</p>



<a name="228083210"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/bootstrapping%20on%20s390x/mips%20for%20musl/near/228083210" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> bjorn3 <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/bootstrapping.20on.20s390x.2Fmips.20for.20musl.html#228083210">(Feb 27 2021 at 21:07)</a>:</h4>
<p>For the default linker and lld optimizations barely matter. <del>For lld it even made it a bit worse.</del></p>



<a name="228083217"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/bootstrapping%20on%20s390x/mips%20for%20musl/near/228083217" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ariadne Conill <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/bootstrapping.20on.20s390x.2Fmips.20for.20musl.html#228083217">(Feb 27 2021 at 21:07)</a>:</h4>
<p><code>-Oz</code> seems to not work on 1.50</p>



<a name="228083258"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/bootstrapping%20on%20s390x/mips%20for%20musl/near/228083258" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> bjorn3 <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/bootstrapping.20on.20s390x.2Fmips.20for.20musl.html#228083258">(Feb 27 2021 at 21:08)</a>:</h4>
<p>Use <code>-Copt-level=z</code>.</p>



<a name="228083278"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/bootstrapping%20on%20s390x/mips%20for%20musl/near/228083278" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> bjorn3 <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/bootstrapping.20on.20s390x.2Fmips.20for.20musl.html#228083278">(Feb 27 2021 at 21:08)</a>:</h4>
<p>Doesn't change the result over <code>-Copt-level=3</code> in this case though for me.</p>



<a name="228083285"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/bootstrapping%20on%20s390x/mips%20for%20musl/near/228083285" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ariadne Conill <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/bootstrapping.20on.20s390x.2Fmips.20for.20musl.html#228083285">(Feb 27 2021 at 21:08)</a>:</h4>
<p>still 14k :P</p>



<a name="228083310"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/bootstrapping%20on%20s390x/mips%20for%20musl/near/228083310" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jubilee <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/bootstrapping.20on.20s390x.2Fmips.20for.20musl.html#228083310">(Feb 27 2021 at 21:09)</a>:</h4>
<p><a href="https://github.com/rust-lang/rust/issues/54026">https://github.com/rust-lang/rust/issues/54026</a></p>



<a name="228083311"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/bootstrapping%20on%20s390x/mips%20for%20musl/near/228083311" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ariadne Conill <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/bootstrapping.20on.20s390x.2Fmips.20for.20musl.html#228083311">(Feb 27 2021 at 21:09)</a>:</h4>
<p>without -Cprefer-dynamic, it's 283kb</p>



<a name="228083313"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/bootstrapping%20on%20s390x/mips%20for%20musl/near/228083313" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ariadne Conill <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/bootstrapping.20on.20s390x.2Fmips.20for.20musl.html#228083313">(Feb 27 2021 at 21:10)</a>:</h4>
<p>which is not bad for a staticly linked program, but :P</p>



<a name="228083483"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/bootstrapping%20on%20s390x/mips%20for%20musl/near/228083483" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jubilee <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/bootstrapping.20on.20s390x.2Fmips.20for.20musl.html#228083483">(Feb 27 2021 at 21:12)</a>:</h4>
<p>oh <span class="user-mention" data-user-id="360752">@Ariadne Conill</span> what's your baseline for x86_64 support out of curiosity.</p>



<a name="228083583"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/bootstrapping%20on%20s390x/mips%20for%20musl/near/228083583" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ariadne Conill <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/bootstrapping.20on.20s390x.2Fmips.20for.20musl.html#228083583">(Feb 27 2021 at 21:14)</a>:</h4>
<p>baseline in what way?</p>



<a name="228083590"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/bootstrapping%20on%20s390x/mips%20for%20musl/near/228083590" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ariadne Conill <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/bootstrapping.20on.20s390x.2Fmips.20for.20musl.html#228083590">(Feb 27 2021 at 21:14)</a>:</h4>
<p>we go all the way back to original AMD K8</p>



<a name="228083725"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/bootstrapping%20on%20s390x/mips%20for%20musl/near/228083725" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ariadne Conill <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/bootstrapping.20on.20s390x.2Fmips.20for.20musl.html#228083725">(Feb 27 2021 at 21:17)</a>:</h4>
<p>in fact, i still have a few Athlon 64 3200+ machines in service at various sites running alpine</p>



<a name="228084086"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/bootstrapping%20on%20s390x/mips%20for%20musl/near/228084086" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ariadne Conill <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/bootstrapping.20on.20s390x.2Fmips.20for.20musl.html#228084086">(Feb 27 2021 at 21:25)</a>:</h4>
<p>in the science community, there is a very strong "if it ain't broke, don't fix it" mentality.  so if you set up VPN concentrator or something like that, it will just stay in service until it is physically dead or the service is no longer needed</p>



<a name="228084149"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/bootstrapping%20on%20s390x/mips%20for%20musl/near/228084149" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ariadne Conill <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/bootstrapping.20on.20s390x.2Fmips.20for.20musl.html#228084149">(Feb 27 2021 at 21:26)</a>:</h4>
<p>since alpine runs from ram, and compactflash IDE storage is quite robust, it is possible to have appliances in service across multiple decades</p>



<a name="228084152"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/bootstrapping%20on%20s390x/mips%20for%20musl/near/228084152" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jubilee <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/bootstrapping.20on.20s390x.2Fmips.20for.20musl.html#228084152">(Feb 27 2021 at 21:26)</a>:</h4>
<p>yeah, minimal arch support was what I was wondering! got it, SSE2 then~</p>



<a name="228084154"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/bootstrapping%20on%20s390x/mips%20for%20musl/near/228084154" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ariadne Conill <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/bootstrapping.20on.20s390x.2Fmips.20for.20musl.html#228084154">(Feb 27 2021 at 21:26)</a>:</h4>
<p>which is basically what we built alpine to do :)</p>



<a name="228084195"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/bootstrapping%20on%20s390x/mips%20for%20musl/near/228084195" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ariadne Conill <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/bootstrapping.20on.20s390x.2Fmips.20for.20musl.html#228084195">(Feb 27 2021 at 21:27)</a>:</h4>
<p>(alpine was basically started by people in the networking research community.  we started it because emdebian wasn't getting the job done anymore.)</p>



<a name="228084254"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/bootstrapping%20on%20s390x/mips%20for%20musl/near/228084254" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ariadne Conill <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/bootstrapping.20on.20s390x.2Fmips.20for.20musl.html#228084254">(Feb 27 2021 at 21:28)</a>:</h4>
<p>musl also comes from that community and so on</p>



<a name="228084328"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/bootstrapping%20on%20s390x/mips%20for%20musl/near/228084328" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ariadne Conill <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/bootstrapping.20on.20s390x.2Fmips.20for.20musl.html#228084328">(Feb 27 2021 at 21:30)</a>:</h4>
<p>our x86 baseline is i586 AMD Geode</p>



<a name="228084344"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/bootstrapping%20on%20s390x/mips%20for%20musl/near/228084344" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jubilee <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/bootstrapping.20on.20s390x.2Fmips.20for.20musl.html#228084344">(Feb 27 2021 at 21:30)</a>:</h4>
<p>There is that part of the science community and then there is also the part of the science community that has very, very, very big machines that run the bleedingest edgest AVX instructions, and sometimes there is some surprising overlap, which is why I figured I'd ask. :^)</p>



<a name="228084354"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/bootstrapping%20on%20s390x/mips%20for%20musl/near/228084354" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ariadne Conill <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/bootstrapping.20on.20s390x.2Fmips.20for.20musl.html#228084354">(Feb 27 2021 at 21:30)</a>:</h4>
<p>oh, people do that with alpine too now :)</p>



<a name="228084376"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/bootstrapping%20on%20s390x/mips%20for%20musl/near/228084376" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ariadne Conill <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/bootstrapping.20on.20s390x.2Fmips.20for.20musl.html#228084376">(Feb 27 2021 at 21:31)</a>:</h4>
<p>same reason for geode btw, there's still a lot of embedded SBCs with that chip in service</p>



<a name="228084380"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/bootstrapping%20on%20s390x/mips%20for%20musl/near/228084380" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ariadne Conill <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/bootstrapping.20on.20s390x.2Fmips.20for.20musl.html#228084380">(Feb 27 2021 at 21:31)</a>:</h4>
<p>we try to choose practical baseline targets for support, based on what people are likely to have in service</p>



<a name="228084436"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/bootstrapping%20on%20s390x/mips%20for%20musl/near/228084436" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ariadne Conill <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/bootstrapping.20on.20s390x.2Fmips.20for.20musl.html#228084436">(Feb 27 2021 at 21:32)</a>:</h4>
<p>this is why mips64 is soft-float mips64r2, for example.  we want to target the Octeon appliances out there which do not have usable FPUs</p>



<a name="228086169"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/bootstrapping%20on%20s390x/mips%20for%20musl/near/228086169" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> bjorn3 <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/bootstrapping.20on.20s390x.2Fmips.20for.20musl.html#228086169">(Feb 27 2021 at 22:08)</a>:</h4>
<p>Rust uses i686 as baseline though I think there are also i586 targets for some OS + libc combinations.</p>



<a name="228086175"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/bootstrapping%20on%20s390x/mips%20for%20musl/near/228086175" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ariadne Conill <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/bootstrapping.20on.20s390x.2Fmips.20for.20musl.html#228086175">(Feb 27 2021 at 22:08)</a>:</h4>
<p>yes, alpine uses an i586 target :)</p>



<a name="228086424"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/bootstrapping%20on%20s390x/mips%20for%20musl/near/228086424" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ariadne Conill <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/bootstrapping.20on.20s390x.2Fmips.20for.20musl.html#228086424">(Feb 27 2021 at 22:14)</a>:</h4>
<p>baseline for alpine was originally i486, but we moved to i586 for practical reasons (namely, it is difficult to make modern kernel boot on i486)</p>



<a name="228092413"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/bootstrapping%20on%20s390x/mips%20for%20musl/near/228092413" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ariadne Conill <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/bootstrapping.20on.20s390x.2Fmips.20for.20musl.html#228092413">(Feb 28 2021 at 00:12)</a>:</h4>
<p>the more i work with rust, the more it fits what i already know from ML.  in that way, it feels like an old friend.</p>



<a name="228094225"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/bootstrapping%20on%20s390x/mips%20for%20musl/near/228094225" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jubilee <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/bootstrapping.20on.20s390x.2Fmips.20for.20musl.html#228094225">(Feb 28 2021 at 00:51)</a>:</h4>
<p>It can't really hide that it started as OCaml and a bunch of PPX. :^)</p>



<a name="228857589"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/bootstrapping%20on%20s390x/mips%20for%20musl/near/228857589" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Darley Barreto <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/bootstrapping.20on.20s390x.2Fmips.20for.20musl.html#228857589">(Mar 04 2021 at 21:56)</a>:</h4>
<p><span class="user-mention silent" data-user-id="360752">Ariadne Conill</span> <a href="#narrow/stream/131828-t-compiler/topic/bootstrapping.20on.20s390x.2Fmips.20for.20musl/near/228081163">said</a>:</p>
<blockquote>
<p>well then it’s very likely that we will replace busybox with a rust replacement</p>
</blockquote>
<p>Is there a place/forum I could follow discussions on this part? :D</p>



<a name="229006898"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/bootstrapping%20on%20s390x/mips%20for%20musl/near/229006898" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Triplett <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/bootstrapping.20on.20s390x.2Fmips.20for.20musl.html#229006898">(Mar 05 2021 at 19:04)</a>:</h4>
<p><span class="user-mention" data-user-id="360752">@Ariadne Conill</span> You asked if there was anything musl could do on your end, to make musl and rust work better together?</p>



<a name="229007250"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/bootstrapping%20on%20s390x/mips%20for%20musl/near/229007250" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Triplett <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/bootstrapping.20on.20s390x.2Fmips.20for.20musl.html#229007250">(Mar 05 2021 at 19:06)</a>:</h4>
<p>There is something that comes up very often in the rust libc crate.</p>



<a name="229007366"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/bootstrapping%20on%20s390x/mips%20for%20musl/near/229007366" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Triplett <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/bootstrapping.20on.20s390x.2Fmips.20for.20musl.html#229007366">(Mar 05 2021 at 19:07)</a>:</h4>
<p>We have tests in CI to make sure that any definitions we add match the C library, and we run those tests on both glibc and musl targets (in addition to other targets like Windows and macOS).</p>



<a name="229007483"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/bootstrapping%20on%20s390x/mips%20for%20musl/near/229007483" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Triplett <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/bootstrapping.20on.20s390x.2Fmips.20for.20musl.html#229007483">(Mar 05 2021 at 19:08)</a>:</h4>
<p>So when we add something on Linux, for instance, it has to match the definitions in both glibc and musl, or it fails CI and we have to either the definition or add an exception in CI. This helps make sure we don't have portability issues on some targets.</p>



<a name="229007684"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/bootstrapping%20on%20s390x/mips%20for%20musl/near/229007684" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Triplett <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/bootstrapping.20on.20s390x.2Fmips.20for.20musl.html#229007684">(Mar 05 2021 at 19:09)</a>:</h4>
<p>However, a really common problem that arises (for which we regularly end up having to add exceptions to CI) is when we're adding a definition from the Linux kernel headers, glibc has it because glibc systems use the actual kernel headers, and musl systems don't have it. So we typically end up having to add a CI exception, because the definition will be the same on all Linux platforms, and it depends on the kernel and not the C library.</p>



<a name="229007880"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/bootstrapping%20on%20s390x/mips%20for%20musl/near/229007880" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Triplett <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/bootstrapping.20on.20s390x.2Fmips.20for.20musl.html#229007880">(Mar 05 2021 at 19:11)</a>:</h4>
<p>There isn't a trivial way to match "all kernel-specific definitions", or I think we'd have long since added a blanket "ignore musl compatibility for everything from the kernel headers".</p>



<a name="229009246"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/bootstrapping%20on%20s390x/mips%20for%20musl/near/229009246" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Triplett <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/bootstrapping.20on.20s390x.2Fmips.20for.20musl.html#229009246">(Mar 05 2021 at 19:19)</a>:</h4>
<p>I have the general impression (third-hand, not first-hand) that there's something going on with musl's handling of kernel headers that makes it tend to not have the latest kernel definitions, in a way that doesn't seem to happen with glibc. I don't know if this is an accurate impression, and I don't know what the underlying issue is.</p>



<a name="229009659"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/bootstrapping%20on%20s390x/mips%20for%20musl/near/229009659" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Triplett <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/bootstrapping.20on.20s390x.2Fmips.20for.20musl.html#229009659">(Mar 05 2021 at 19:22)</a>:</h4>
<p>But in general, it'd be extremely helpful if we could rely on musl having all the up-to-date definitions from the kernel headers, at least as up-to-date as the definitions from a reasonably recent glibc. That'd go a long way towards making the musl targets easier to maintain and update.</p>



<a name="229015666"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/bootstrapping%20on%20s390x/mips%20for%20musl/near/229015666" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ariadne Conill <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/bootstrapping.20on.20s390x.2Fmips.20for.20musl.html#229015666">(Mar 05 2021 at 20:02)</a>:</h4>
<p>err musl uses the actual kernel headers too</p>



<a name="229016065"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/bootstrapping%20on%20s390x/mips%20for%20musl/near/229016065" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ariadne Conill <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/bootstrapping.20on.20s390x.2Fmips.20for.20musl.html#229016065">(Mar 05 2021 at 20:05)</a>:</h4>
<p>at one time, the kernel headers required patching, but for the past several years, the kernel headers have been used in an unmodified state</p>



<a name="229017261"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/bootstrapping%20on%20s390x/mips%20for%20musl/near/229017261" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ariadne Conill <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/bootstrapping.20on.20s390x.2Fmips.20for.20musl.html#229017261">(Mar 05 2021 at 20:13)</a>:</h4>
<p>so it sounds to me like something about the CI is out of date</p>



<a name="229034000"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/bootstrapping%20on%20s390x/mips%20for%20musl/near/229034000" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> NeoRaider <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/bootstrapping.20on.20s390x.2Fmips.20for.20musl.html#229034000">(Mar 05 2021 at 22:17)</a>:</h4>
<p><span class="user-mention silent" data-user-id="360752">Ariadne Conill</span> <a href="#narrow/stream/131828-t-compiler/topic/bootstrapping.20on.20s390x.2Fmips.20for.20musl/near/229015666">said</a>:</p>
<blockquote>
<p>err musl uses the actual kernel headers too</p>
</blockquote>
<p>This is incorrect. musl has <em>supported</em> including actual kernel headers for a while now, but unlike glibc, the musl headers are self-contained, while glibc headers actually include kernel headers for various definitions.</p>



<a name="229034205"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/bootstrapping%20on%20s390x/mips%20for%20musl/near/229034205" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> NeoRaider <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/bootstrapping.20on.20s390x.2Fmips.20for.20musl.html#229034205">(Mar 05 2021 at 22:19)</a>:</h4>
<p>So for many Linux-specific parts, e.g. new fcntl flags, glibc gets the definitions "for free", while they have to be mirrored in musl to become usable.</p>



<a name="229034229"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/bootstrapping%20on%20s390x/mips%20for%20musl/near/229034229" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> NeoRaider <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/bootstrapping.20on.20s390x.2Fmips.20for.20musl.html#229034229">(Mar 05 2021 at 22:19)</a>:</h4>
<p>I have no idea how exactly this affects the Rust libc though</p>



<a name="229055462"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/bootstrapping%20on%20s390x/mips%20for%20musl/near/229055462" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ariadne Conill <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/bootstrapping.20on.20s390x.2Fmips.20for.20musl.html#229055462">(Mar 06 2021 at 02:13)</a>:</h4>
<p>oh, good point.  well, that is somewhat a philosophical decision on musl's part</p>



<a name="229117312"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/bootstrapping%20on%20s390x/mips%20for%20musl/near/229117312" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Triplett <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/bootstrapping.20on.20s390x.2Fmips.20for.20musl.html#229117312">(Mar 06 2021 at 18:12)</a>:</h4>
<p>It seems problematic when it's leaving a flag defined that the kernel headers define, and that can't reasonably be defined any other way than the kernel defines it.</p>



<a name="229117337"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/bootstrapping%20on%20s390x/mips%20for%20musl/near/229117337" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Triplett <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/bootstrapping.20on.20s390x.2Fmips.20for.20musl.html#229117337">(Mar 06 2021 at 18:13)</a>:</h4>
<p>This affects the rust libc when we try to define such a flag and the musl CI fails because the musl headers don't define it</p>



<a name="229117468"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/bootstrapping%20on%20s390x/mips%20for%20musl/near/229117468" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Triplett <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/bootstrapping.20on.20s390x.2Fmips.20for.20musl.html#229117468">(Mar 06 2021 at 18:14)</a>:</h4>
<p>It doesn't deeply matter to me whether the definitions come from kernel headers or musl headers, except insofar as it prevents using constant definitions from the kernel.</p>



<a name="229265898"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/bootstrapping%20on%20s390x/mips%20for%20musl/near/229265898" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ariadne Conill <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/bootstrapping.20on.20s390x.2Fmips.20for.20musl.html#229265898">(Mar 08 2021 at 08:52)</a>:</h4>
<p>so, in musl, you're supposed to #include the linux headers directly for that.</p>



<a name="229795150"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/bootstrapping%20on%20s390x/mips%20for%20musl/near/229795150" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Triplett <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/bootstrapping.20on.20s390x.2Fmips.20for.20musl.html#229795150">(Mar 11 2021 at 05:09)</a>:</h4>
<p>Interesting. I had had the impression that musl discouraged that. Do musl's headers avoid conflicts and duplicate definitions there?</p>



<a name="229934086"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/bootstrapping%20on%20s390x/mips%20for%20musl/near/229934086" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wesley Wiser <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/bootstrapping.20on.20s390x.2Fmips.20for.20musl.html#229934086">(Mar 11 2021 at 21:59)</a>:</h4>
<p>Hi <span class="user-mention" data-user-id="360752">@Ariadne Conill</span> et al, I just wanted to let you know I've submitted a <a href="https://github.com/rust-lang/compiler-team/issues/416">compiler team meeting proposal</a> to discuss <a href="https://github.com/rust-lang/rust/issues/82556">#82556</a>. Thanks for your patience while we've worked through the right way to resolve this issue! </p>
<p>Tomorrow morning we have a planning meeting in <a class="stream" data-stream-id="238009" href="/#narrow/stream/238009-t-compiler.2Fmeetings">#t-compiler/meetings</a>  at <time datetime="2021-03-12T15:00:00Z">2021-03-12T10:00:00-05:00</time>  to schedule these meetings over the coming weeks (meetings are always held at that time on Fridays). If you would like to attend tomorrow's meeting and help us find a time that works for you so we can discuss next steps that would be great! Or, if you just want to let me know which Fridays over the next month works for you, I can make sure we schedule that meeting on a day you've said. </p>
<p>(Also, if the meeting proposal isn't accurate or you feel it is missing important questions that should be resolved, please let me know and I will fix it)</p>



<a name="229941387"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/bootstrapping%20on%20s390x/mips%20for%20musl/near/229941387" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ariadne Conill <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/bootstrapping.20on.20s390x.2Fmips.20for.20musl.html#229941387">(Mar 11 2021 at 22:40)</a>:</h4>
<p><span class="user-mention" data-user-id="125250">@Wesley Wiser</span> is it appropriate to ask other stakeholders to attend the scheduling meeting?</p>



<a name="229941434"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/bootstrapping%20on%20s390x/mips%20for%20musl/near/229941434" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ariadne Conill <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/bootstrapping.20on.20s390x.2Fmips.20for.20musl.html#229941434">(Mar 11 2021 at 22:41)</a>:</h4>
<blockquote>
<p>Interesting. I had had the impression that musl discouraged that. Do musl's headers avoid conflicts and duplicate definitions there?</p>
</blockquote>
<p>yes</p>



<a name="229941467"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/bootstrapping%20on%20s390x/mips%20for%20musl/near/229941467" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ariadne Conill <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/bootstrapping.20on.20s390x.2Fmips.20for.20musl.html#229941467">(Mar 11 2021 at 22:41)</a>:</h4>
<p>if you wish to use linux-specific APIs, you should use the linux headers that define them</p>



<a name="229941486"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/bootstrapping%20on%20s390x/mips%20for%20musl/near/229941486" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ariadne Conill <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/bootstrapping.20on.20s390x.2Fmips.20for.20musl.html#229941486">(Mar 11 2021 at 22:41)</a>:</h4>
<p>you should NOT use linux-specific headers that define POSIX interfaces</p>



<a name="229941540"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/bootstrapping%20on%20s390x/mips%20for%20musl/near/229941540" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wesley Wiser <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/bootstrapping.20on.20s390x.2Fmips.20for.20musl.html#229941540">(Mar 11 2021 at 22:42)</a>:</h4>
<p>Sure! Our meetings are open for anyone to attend. If there are other people that should be included in the actual meeting to discuss <a href="https://github.com/rust-lang/rust/issues/82556">#82556</a> then it would be great if we can find a day that works for them as well.</p>



<a name="229945874"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/bootstrapping%20on%20s390x/mips%20for%20musl/near/229945874" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ariadne Conill <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/bootstrapping.20on.20s390x.2Fmips.20for.20musl.html#229945874">(Mar 11 2021 at 23:19)</a>:</h4>
<p><span class="user-mention" data-user-id="125250">@Wesley Wiser</span> alright, i've asked ericonr from void and rich felker to attend the scheduling meeting</p>



<a name="230040910"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/bootstrapping%20on%20s390x/mips%20for%20musl/near/230040910" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wesley Wiser <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/bootstrapping.20on.20s390x.2Fmips.20for.20musl.html#230040910">(Mar 12 2021 at 14:50)</a>:</h4>
<p>Thank you!</p>



<a name="231011382"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/bootstrapping%20on%20s390x/mips%20for%20musl/near/231011382" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ariadne Conill <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/bootstrapping.20on.20s390x.2Fmips.20for.20musl.html#231011382">(Mar 19 2021 at 11:56)</a>:</h4>
<p>tmhoang, an alpine contributor from IBM is going to likely take over the actual bootstrap work on s390x since i am busy right now with other tasks</p>



<a name="231011408"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/bootstrapping%20on%20s390x/mips%20for%20musl/near/231011408" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ariadne Conill <a href="https://rust-lang.github.io/zulip_archive/stream/131828-t-compiler/topic/bootstrapping.20on.20s390x.2Fmips.20for.20musl.html#231011408">(Mar 19 2021 at 11:56)</a>:</h4>
<p>i linked him this thread, so he can get up to date on the situation :)</p>



<hr><p>Last updated: Aug 07 2021 at 22:04 UTC</p>
</html>