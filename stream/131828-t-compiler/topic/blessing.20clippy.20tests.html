<html>
<head><meta charset="utf-8"><title>blessing clippy tests · t-compiler · Zulip Chat Archive</title></head>
<h2>Stream: <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/index.html">t-compiler</a></h2>
<h3>Topic: <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/blessing.20clippy.20tests.html">blessing clippy tests</a></h3>

<hr>

<base href="https://rust-lang.zulipchat.com">

<head><link href="https://zulip-archive.rust-lang.org/style.css" rel="stylesheet"></head>

<a name="209329795"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/blessing%20clippy%20tests/near/209329795" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Aaron Hill <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/blessing.20clippy.20tests.html#209329795">(Sep 07 2020 at 21:56)</a>:</h4>
<p><code>./x.py test src/tools/clippy --bless</code> does not seem to actually bless clippy test stderr</p>



<a name="209329803"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/blessing%20clippy%20tests/near/209329803" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Aaron Hill <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/blessing.20clippy.20tests.html#209329803">(Sep 07 2020 at 21:56)</a>:</h4>
<p>how can I bless clippy tests from within a rust checkout?</p>



<a name="209330421"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/blessing%20clippy%20tests/near/209330421" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> simulacrum <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/blessing.20clippy.20tests.html#209330421">(Sep 07 2020 at 22:10)</a>:</h4>
<p>You'll need to run the clippy tooling, probably?</p>



<a name="209330426"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/blessing%20clippy%20tests/near/209330426" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> simulacrum <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/blessing.20clippy.20tests.html#209330426">(Sep 07 2020 at 22:10)</a>:</h4>
<p>We should fix x.py though</p>



<a name="209330435"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/blessing%20clippy%20tests/near/209330435" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> simulacrum <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/blessing.20clippy.20tests.html#209330435">(Sep 07 2020 at 22:10)</a>:</h4>
<p>If you figure out how please document it in an issue or PR</p>



<a name="209351484"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/blessing%20clippy%20tests/near/209351484" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> matthiaskrgr <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/blessing.20clippy.20tests.html#209351484">(Sep 08 2020 at 07:03)</a>:</h4>
<p><a href="https://github.com/rust-lang/rust-clippy/blob/master/tests/ui/update-all-references.sh">https://github.com/rust-lang/rust-clippy/blob/master/tests/ui/update-all-references.sh</a></p>



<a name="209351506"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/blessing%20clippy%20tests/near/209351506" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> matthiaskrgr <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/blessing.20clippy.20tests.html#209351506">(Sep 08 2020 at 07:03)</a>:</h4>
<p>we use this when working in the clippy repo</p>



<a name="209351637"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/blessing%20clippy%20tests/near/209351637" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> matthiaskrgr <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/blessing.20clippy.20tests.html#209351637">(Sep 08 2020 at 07:05)</a>:</h4>
<p>from the clippy tests, then from the clippy repo root, run the update script, this might work, thought i have not yet tried this from the rustc subrepo I think....</p>



<a name="234426410"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/blessing%20clippy%20tests/near/234426410" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Aaron Hill <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/blessing.20clippy.20tests.html#234426410">(Apr 14 2021 at 01:11)</a>:</h4>
<p>Blessing the clippy tests now apparently requires running <code>cargo dev bless</code>, which doesn't work from a submodule due to workspace issues</p>



<a name="234426461"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/blessing%20clippy%20tests/near/234426461" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Aaron Hill <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/blessing.20clippy.20tests.html#234426461">(Apr 14 2021 at 01:12)</a>:</h4>
<p>This is a really serious problem for any rust PR that affects clippy tests</p>



<a name="234481565"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/blessing%20clippy%20tests/near/234481565" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> pnkfelix <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/blessing.20clippy.20tests.html#234481565">(Apr 14 2021 at 11:22)</a>:</h4>
<p>Is there an issue on rust-lang/rust about this yet?</p>



<a name="234481590"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/blessing%20clippy%20tests/near/234481590" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> pnkfelix <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/blessing.20clippy.20tests.html#234481590">(Apr 14 2021 at 11:22)</a>:</h4>
<p>Sounds like something we might want to nominate for discussion at T-compiler triage meeting tomorrow.</p>



<a name="234486945"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/blessing%20clippy%20tests/near/234486945" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> simulacrum <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/blessing.20clippy.20tests.html#234486945">(Apr 14 2021 at 12:10)</a>:</h4>
<p>I don't know that discussion is necessary - I had forgotten about this. It feels naively like we can make x.py make the right invocations, someone needs to investigate what those are. I... May have time? I don't know.</p>



<a name="234496085"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/blessing%20clippy%20tests/near/234496085" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joshua Nelson <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/blessing.20clippy.20tests.html#234496085">(Apr 14 2021 at 13:15)</a>:</h4>
<p>It should be possible to fix the workspace issues by adding the folder to workspace.exclude</p>



<a name="234496163"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/blessing%20clippy%20tests/near/234496163" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> simulacrum <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/blessing.20clippy.20tests.html#234496163">(Apr 14 2021 at 13:15)</a>:</h4>
<p>That doesn't seem right, we do want clippy in the workspace <em>in general</em>.</p>



<a name="234496208"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/blessing%20clippy%20tests/near/234496208" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joshua Nelson <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/blessing.20clippy.20tests.html#234496208">(Apr 14 2021 at 13:15)</a>:</h4>
<p>Yes, we want clippy, but not clippy-dev</p>



<a name="234496211"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/blessing%20clippy%20tests/near/234496211" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> simulacrum <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/blessing.20clippy.20tests.html#234496211">(Apr 14 2021 at 13:15)</a>:</h4>
<p>I don't really know what the workspace issues being referenced are though.</p>



<a name="234496218"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/blessing%20clippy%20tests/near/234496218" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joshua Nelson <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/blessing.20clippy.20tests.html#234496218">(Apr 14 2021 at 13:15)</a>:</h4>
<p>They are different crates</p>



<a name="234496287"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/blessing%20clippy%20tests/near/234496287" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> simulacrum <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/blessing.20clippy.20tests.html#234496287">(Apr 14 2021 at 13:16)</a>:</h4>
<p><span aria-label="shrug" class="emoji emoji-1f937" role="img" title="shrug">:shrug:</span> I don't have enough context to say.</p>



<a name="234496315"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/blessing%20clippy%20tests/near/234496315" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> simulacrum <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/blessing.20clippy.20tests.html#234496315">(Apr 14 2021 at 13:16)</a>:</h4>
<p>But generally speaking that doesn't sound like the right fix.</p>



<a name="234496456"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/blessing%20clippy%20tests/near/234496456" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joshua Nelson <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/blessing.20clippy.20tests.html#234496456">(Apr 14 2021 at 13:17)</a>:</h4>
<p><span class="user-mention" data-user-id="116122">@simulacrum</span> </p>
<div class="codehilite"><pre><span></span><code>error: current package believes it&#39;s in a workspace when it&#39;s not:
current:   /home/joshua/rustc/src/tools/clippy/clippy_dev/Cargo.toml
workspace: /home/joshua/rustc/Cargo.toml

this may be fixable by adding `src/tools/clippy/clippy_dev` to the `workspace.members` array of the manifest located at: /home/joshua/rustc/Cargo.toml
Alternatively, to keep it out of the workspace, add the package to the `workspace.exclude` array, or add an empty `[workspace]` table to the package&#39;s manifest.
</code></pre></div>



<a name="234496559"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/blessing%20clippy%20tests/near/234496559" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> simulacrum <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/blessing.20clippy.20tests.html#234496559">(Apr 14 2021 at 13:18)</a>:</h4>
<p>Maybe it should be.... added?</p>



<a name="234496589"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/blessing%20clippy%20tests/near/234496589" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joshua Nelson <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/blessing.20clippy.20tests.html#234496589">(Apr 14 2021 at 13:18)</a>:</h4>
<p>sure? either will work</p>



<a name="234496662"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/blessing%20clippy%20tests/near/234496662" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Aaron Hill <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/blessing.20clippy.20tests.html#234496662">(Apr 14 2021 at 13:18)</a>:</h4>
<p><span class="user-mention silent" data-user-id="116083">pnkfelix</span> <a href="#narrow/stream/131828-t-compiler/topic/blessing.20clippy.20tests/near/234481565">said</a>:</p>
<blockquote>
<p>Is there an issue on rust-lang/rust about this yet?</p>
</blockquote>
<p><a href="https://github.com/rust-lang/rust/issues/76495">https://github.com/rust-lang/rust/issues/76495</a> mentions this</p>



<a name="234496683"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/blessing%20clippy%20tests/near/234496683" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> simulacrum <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/blessing.20clippy.20tests.html#234496683">(Apr 14 2021 at 13:18)</a>:</h4>
<p>if that fixes things, feels great. we generally want the workspace to include things rather than not.</p>



<a name="234496861"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/blessing%20clippy%20tests/near/234496861" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joshua Nelson <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/blessing.20clippy.20tests.html#234496861">(Apr 14 2021 at 13:19)</a>:</h4>
<p>ok, doing that now</p>



<a name="234497243"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/blessing%20clippy%20tests/near/234497243" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joshua Nelson <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/blessing.20clippy.20tests.html#234497243">(Apr 14 2021 at 13:22)</a>:</h4>
<p><a href="https://github.com/rust-lang/rust/pull/84189">https://github.com/rust-lang/rust/pull/84189</a></p>



<a name="234497489"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/blessing%20clippy%20tests/near/234497489" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joshua Nelson <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/blessing.20clippy.20tests.html#234497489">(Apr 14 2021 at 13:23)</a>:</h4>
<p>it still doesn't appear to do anything but I guess it's better than a hard error? <a href="#narrow/stream/257328-clippy/topic/How.20can.20I.20run.20clippy.20tests.20from.20rust-lang.2Frust.3F/near/233838821">https://rust-lang.zulipchat.com/#narrow/stream/257328-clippy/topic/How.20can.20I.20run.20clippy.20tests.20from.20rust-lang.2Frust.3F/near/233838821</a></p>



<a name="234499488"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/blessing%20clippy%20tests/near/234499488" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> simulacrum <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/blessing.20clippy.20tests.html#234499488">(Apr 14 2021 at 13:35)</a>:</h4>
<p>I'd prefer not to make it do nothing but not be a hard error, that seems just worse.</p>



<a name="234551720"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/blessing%20clippy%20tests/near/234551720" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joshua Nelson <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/blessing.20clippy.20tests.html#234551720">(Apr 14 2021 at 18:36)</a>:</h4>
<p>ok, I implemented <code>x.py test --bless</code> for clippy</p>



<hr><p>Last updated: Apr 12 2022 at 20:01 UTC</p>
</html>