<html>
<head><meta charset="utf-8"><title>thread &#x27;main&#x27; panicked at &#x27;fs::read(stamp)...&#x27; · t-compiler · Zulip Chat Archive</title></head>
<h2>Stream: <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/index.html">t-compiler</a></h2>
<h3>Topic: <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/thread.20&#x27;main&#x27;.20panicked.20at.20&#x27;fs.3A.3Aread(stamp).2E.2E.2E&#x27;.html">thread &#x27;main&#x27; panicked at &#x27;fs::read(stamp)...&#x27;</a></h3>

<hr>

<base href="https://rust-lang.zulipchat.com">

<head><link href="https://zulip-archive.rust-lang.org/style.css" rel="stylesheet"></head>

<a name="260603298"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/thread%20%27main%27%20panicked%20at%20%27fs%3A%3Aread%28stamp%29...%27/near/260603298" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> njn <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/thread.20&#x27;main&#x27;.20panicked.20at.20&#x27;fs.3A.3Aread(stamp).2E.2E.2E&#x27;.html#260603298">(Nov 07 2021 at 23:58)</a>:</h4>
<p>I am compiling rustc for the first time in a while. I have this <code>config.toml</code>:</p>
<div class="codehilite"><pre><span></span><code>changelog-seen = 2
[llvm]
release-debuginfo = true
[rust]
debuginfo-level = 1
</code></pre></div>
<p>And I have built it with this command:</p>
<div class="codehilite"><pre><span></span><code>RUSTFLAGS=&quot;-C link-arg=-fuse-ld=lld&quot; ./x.py build --stage 2 compiler/rustc
</code></pre></div>
<p>It successfully builds <code>/home/njn/dev/rust0/build/x86_64-unknown-linux-gnu/stage1/bin/rustc</code>. Then I get a possibly harmless but disconcerting error:</p>
<div class="codehilite"><pre><span></span><code>    Finished release [optimized + debuginfo] target(s) in 3m 35s
Copying stage1 rustc from stage1 (x86_64-unknown-linux-gnu -&gt; x86_64-unknown-linux-gnu / x86_64-unknown-linux-gnu)
Assembling stage2 compiler (x86_64-unknown-linux-gnu)
Uplifting stage1 std (x86_64-unknown-linux-gnu -&gt; x86_64-unknown-linux-gnu)
Copying stage2 std from stage1 (x86_64-unknown-linux-gnu -&gt; x86_64-unknown-linux-gnu / x86_64-unknown-linux-gnu)
Uplifting stage1 rustc (x86_64-unknown-linux-gnu -&gt; x86_64-unknown-linux-gnu)
Copying stage2 rustc from stage1 (x86_64-unknown-linux-gnu -&gt; x86_64-unknown-linux-gnu / x86_64-unknown-linux-gnu)
Assembling stage3 compiler (x86_64-unknown-linux-gnu)
thread &#39;main&#39; panicked at &#39;fs::read(stamp) failed with No such file or directory (os error 2) (&quot;/home/njn/dev/rust0/build/x86_64-unknown-linux-gnu/stage2-rustc/x86_64-unknown-linux-gnu/release/.librustc.stamp&quot;)&#39;, src/bootstrap/lib.rs:1295:24
note: run with `RUST_BACKTRACE=1` environment variable to display a backtrace
Build completed unsuccessfully in 0:07:31
</code></pre></div>
<p>I don't know why <code>Assembling stage3 compiler</code> is even running.<br>
Has anyone else seen this? If I just run <code>RUSTFLAGS="-C link-arg=-fuse-ld=lld" ./x.py build</code> I don't have this problem.</p>



<a name="260603765"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/thread%20%27main%27%20panicked%20at%20%27fs%3A%3Aread%28stamp%29...%27/near/260603765" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> njn <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/thread.20&#x27;main&#x27;.20panicked.20at.20&#x27;fs.3A.3Aread(stamp).2E.2E.2E&#x27;.html#260603765">(Nov 08 2021 at 00:06)</a>:</h4>
<p>Oh, maybe <code>x.py build</code> worked because it doesn't build the stage 2 compiler.</p>



<a name="260603820"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/thread%20%27main%27%20panicked%20at%20%27fs%3A%3Aread%28stamp%29...%27/near/260603820" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joshua Nelson <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/thread.20&#x27;main&#x27;.20panicked.20at.20&#x27;fs.3A.3Aread(stamp).2E.2E.2E&#x27;.html#260603820">(Nov 08 2021 at 00:08)</a>:</h4>
<p><span class="user-mention" data-user-id="120989">@njn</span>  <code>build --stage 2 compiler/rustc</code> means "build the stage 2 compiler and then using it to rebuild the compiler</p>



<a name="260603825"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/thread%20%27main%27%20panicked%20at%20%27fs%3A%3Aread%28stamp%29...%27/near/260603825" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joshua Nelson <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/thread.20&#x27;main&#x27;.20panicked.20at.20&#x27;fs.3A.3Aread(stamp).2E.2E.2E&#x27;.html#260603825">(Nov 08 2021 at 00:08)</a>:</h4>
<p>If you want stage 2 you just need <code>build --stage 2</code></p>



<a name="260603837"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/thread%20%27main%27%20panicked%20at%20%27fs%3A%3Aread%28stamp%29...%27/near/260603837" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joshua Nelson <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/thread.20&#x27;main&#x27;.20panicked.20at.20&#x27;fs.3A.3Aread(stamp).2E.2E.2E&#x27;.html#260603837">(Nov 08 2021 at 00:08)</a>:</h4>
<p><a href="https://rustc-dev-guide.rust-lang.org/building/bootstrapping.html#understanding-stages-of-bootstrap">https://rustc-dev-guide.rust-lang.org/building/bootstrapping.html#understanding-stages-of-bootstrap</a></p>



<a name="260603849"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/thread%20%27main%27%20panicked%20at%20%27fs%3A%3Aread%28stamp%29...%27/near/260603849" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> njn <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/thread.20&#x27;main&#x27;.20panicked.20at.20&#x27;fs.3A.3Aread(stamp).2E.2E.2E&#x27;.html#260603849">(Nov 08 2021 at 00:09)</a>:</h4>
<p><span class="user-mention" data-user-id="232545">@Joshua Nelson</span> <code>build --stage 2 compiler/rustc</code> is what I've been using since forever for my compiler profiling work... but it could well be that it's not optimal</p>



<a name="260603904"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/thread%20%27main%27%20panicked%20at%20%27fs%3A%3Aread%28stamp%29...%27/near/260603904" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joshua Nelson <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/thread.20&#x27;main&#x27;.20panicked.20at.20&#x27;fs.3A.3Aread(stamp).2E.2E.2E&#x27;.html#260603904">(Nov 08 2021 at 00:10)</a>:</h4>
<p>Well, the stage 3 compiler should theoretically be identical to stage 2</p>



<a name="260603913"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/thread%20%27main%27%20panicked%20at%20%27fs%3A%3Aread%28stamp%29...%27/near/260603913" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joshua Nelson <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/thread.20&#x27;main&#x27;.20panicked.20at.20&#x27;fs.3A.3Aread(stamp).2E.2E.2E&#x27;.html#260603913">(Nov 08 2021 at 00:10)</a>:</h4>
<p>(but yeah stage3 is broken right now, there's an issue open somewhere)</p>



<a name="260603924"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/thread%20%27main%27%20panicked%20at%20%27fs%3A%3Aread%28stamp%29...%27/near/260603924" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> njn <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/thread.20&#x27;main&#x27;.20panicked.20at.20&#x27;fs.3A.3Aread(stamp).2E.2E.2E&#x27;.html#260603924">(Nov 08 2021 at 00:10)</a>:</h4>
<p>What command should I use to get a nicely optimized, representative stage 2 compiler?</p>



<a name="260603930"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/thread%20%27main%27%20panicked%20at%20%27fs%3A%3Aread%28stamp%29...%27/near/260603930" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> njn <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/thread.20&#x27;main&#x27;.20panicked.20at.20&#x27;fs.3A.3Aread(stamp).2E.2E.2E&#x27;.html#260603930">(Nov 08 2021 at 00:10)</a>:</h4>
<p>(Suitable for profiling)</p>



<a name="260603952"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/thread%20%27main%27%20panicked%20at%20%27fs%3A%3Aread%28stamp%29...%27/near/260603952" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joshua Nelson <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/thread.20&#x27;main&#x27;.20panicked.20at.20&#x27;fs.3A.3Aread(stamp).2E.2E.2E&#x27;.html#260603952">(Nov 08 2021 at 00:11)</a>:</h4>
<p>I don't know what suitable for profiling means, but <code>build --stage 2</code> gets you a stage 2 compiler</p>



<a name="260604023"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/thread%20%27main%27%20panicked%20at%20%27fs%3A%3Aread%28stamp%29...%27/near/260604023" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> njn <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/thread.20&#x27;main&#x27;.20panicked.20at.20&#x27;fs.3A.3Aread(stamp).2E.2E.2E&#x27;.html#260604023">(Nov 08 2021 at 00:13)</a>:</h4>
<p>"Suitable for profiling" means I want to profile rustc itself, in order to speed it up. This requires a few things like: an optimized build, non-incremental (because that can result in slower code), debuginfo=1 for line numbers, etc.</p>



<a name="260604030"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/thread%20%27main%27%20panicked%20at%20%27fs%3A%3Aread%28stamp%29...%27/near/260604030" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joshua Nelson <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/thread.20&#x27;main&#x27;.20panicked.20at.20&#x27;fs.3A.3Aread(stamp).2E.2E.2E&#x27;.html#260604030">(Nov 08 2021 at 00:14)</a>:</h4>
<p>Those should all be on by default, except for debuginfo which you've already configured :)</p>



<a name="260604080"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/thread%20%27main%27%20panicked%20at%20%27fs%3A%3Aread%28stamp%29...%27/near/260604080" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> njn <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/thread.20&#x27;main&#x27;.20panicked.20at.20&#x27;fs.3A.3Aread(stamp).2E.2E.2E&#x27;.html#260604080">(Nov 08 2021 at 00:14)</a>:</h4>
<p>Yes. I'm just answering your implicit question about what "suitable for profiling" means, in case it's helpful :)</p>



<a name="260604097"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/thread%20%27main%27%20panicked%20at%20%27fs%3A%3Aread%28stamp%29...%27/near/260604097" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> njn <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/thread.20&#x27;main&#x27;.20panicked.20at.20&#x27;fs.3A.3Aread(stamp).2E.2E.2E&#x27;.html#260604097">(Nov 08 2021 at 00:15)</a>:</h4>
<p>The whole thing of "explain broadly what you're doing" rather than asking a specific question</p>



<a name="260604149"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/thread%20%27main%27%20panicked%20at%20%27fs%3A%3Aread%28stamp%29...%27/near/260604149" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> njn <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/thread.20&#x27;main&#x27;.20panicked.20at.20&#x27;fs.3A.3Aread(stamp).2E.2E.2E&#x27;.html#260604149">(Nov 08 2021 at 00:16)</a>:</h4>
<p>I'm happy to question anything and everything about this, including e.g. "do I even need to profile a stage 2 compiler, could I profile a stage 1 compiler?"</p>



<a name="260604175"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/thread%20%27main%27%20panicked%20at%20%27fs%3A%3Aread%28stamp%29...%27/near/260604175" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joshua Nelson <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/thread.20&#x27;main&#x27;.20panicked.20at.20&#x27;fs.3A.3Aread(stamp).2E.2E.2E&#x27;.html#260604175">(Nov 08 2021 at 00:17)</a>:</h4>
<p>Yes, you can profile a stage 1 compiler. It may not be representative of stage 2 though (e.g. if nightly has MIR opts on by default that beta doesn't)</p>



<a name="260604181"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/thread%20%27main%27%20panicked%20at%20%27fs%3A%3Aread%28stamp%29...%27/near/260604181" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joshua Nelson <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/thread.20&#x27;main&#x27;.20panicked.20at.20&#x27;fs.3A.3Aread(stamp).2E.2E.2E&#x27;.html#260604181">(Nov 08 2021 at 00:17)</a>:</h4>
<p>But I would expect it to be very close most of the time</p>



<a name="260604184"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/thread%20%27main%27%20panicked%20at%20%27fs%3A%3Aread%28stamp%29...%27/near/260604184" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joshua Nelson <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/thread.20&#x27;main&#x27;.20panicked.20at.20&#x27;fs.3A.3Aread(stamp).2E.2E.2E&#x27;.html#260604184">(Nov 08 2021 at 00:17)</a>:</h4>
<p>I usually only use stage 1 for profiling rustdoc</p>



<a name="260604244"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/thread%20%27main%27%20panicked%20at%20%27fs%3A%3Aread%28stamp%29...%27/near/260604244" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> njn <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/thread.20&#x27;main&#x27;.20panicked.20at.20&#x27;fs.3A.3Aread(stamp).2E.2E.2E&#x27;.html#260604244">(Nov 08 2021 at 00:19)</a>:</h4>
<p>I'm re-reading the early parts of <a href="https://rustc-dev-guide.rust-lang.org/getting-started.html">https://rustc-dev-guide.rust-lang.org/getting-started.html</a>, but this use case is still unclear, even with <a href="https://rustc-dev-guide.rust-lang.org/profiling.html">https://rustc-dev-guide.rust-lang.org/profiling.html</a></p>



<a name="260604314"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/thread%20%27main%27%20panicked%20at%20%27fs%3A%3Aread%28stamp%29...%27/near/260604314" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joshua Nelson <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/thread.20&#x27;main&#x27;.20panicked.20at.20&#x27;fs.3A.3Aread(stamp).2E.2E.2E&#x27;.html#260604314">(Nov 08 2021 at 00:20)</a>:</h4>
<p>When you say "this use case", you mean whether you should use stage 1 or 2? I don't know if that's something with a definite answer ... Stage 1 is definitely a ton faster to build, and it's <em>almost</em> the same, but it's not what's distributed with rustup</p>



<a name="260604390"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/thread%20%27main%27%20panicked%20at%20%27fs%3A%3Aread%28stamp%29...%27/near/260604390" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> njn <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/thread.20&#x27;main&#x27;.20panicked.20at.20&#x27;fs.3A.3Aread(stamp).2E.2E.2E&#x27;.html#260604390">(Nov 08 2021 at 00:22)</a>:</h4>
<p>Right, that's useful: stage 2 is the most representative thing to profile, but if stage 1 is similar enough it can be used instead</p>



<a name="260604409"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/thread%20%27main%27%20panicked%20at%20%27fs%3A%3Aread%28stamp%29...%27/near/260604409" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> njn <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/thread.20&#x27;main&#x27;.20panicked.20at.20&#x27;fs.3A.3Aread(stamp).2E.2E.2E&#x27;.html#260604409">(Nov 08 2021 at 00:23)</a>:</h4>
<p>All this reminds me of <a href="https://github.com/rust-lang/rust/issues/59864">https://github.com/rust-lang/rust/issues/59864</a>, alas</p>



<a name="260604448"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/thread%20%27main%27%20panicked%20at%20%27fs%3A%3Aread%28stamp%29...%27/near/260604448" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joshua Nelson <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/thread.20&#x27;main&#x27;.20panicked.20at.20&#x27;fs.3A.3Aread(stamp).2E.2E.2E&#x27;.html#260604448">(Nov 08 2021 at 00:24)</a>:</h4>
<p>Because it's not clear the difference between stage 1 and stage 2?</p>



<a name="260604458"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/thread%20%27main%27%20panicked%20at%20%27fs%3A%3Aread%28stamp%29...%27/near/260604458" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joshua Nelson <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/thread.20&#x27;main&#x27;.20panicked.20at.20&#x27;fs.3A.3Aread(stamp).2E.2E.2E&#x27;.html#260604458">(Nov 08 2021 at 00:24)</a>:</h4>
<p>I thought was explained reasonably well in the bootstrap page I linked ...</p>



<a name="260604463"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/thread%20%27main%27%20panicked%20at%20%27fs%3A%3Aread%28stamp%29...%27/near/260604463" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> simulacrum <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/thread.20&#x27;main&#x27;.20panicked.20at.20&#x27;fs.3A.3Aread(stamp).2E.2E.2E&#x27;.html#260604463">(Nov 08 2021 at 00:24)</a>:</h4>
<p>This particular panic is just a bug</p>



<a name="260604464"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/thread%20%27main%27%20panicked%20at%20%27fs%3A%3Aread%28stamp%29...%27/near/260604464" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> simulacrum <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/thread.20&#x27;main&#x27;.20panicked.20at.20&#x27;fs.3A.3Aread(stamp).2E.2E.2E&#x27;.html#260604464">(Nov 08 2021 at 00:24)</a>:</h4>
<p>there's an issue already</p>



<a name="260604490"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/thread%20%27main%27%20panicked%20at%20%27fs%3A%3Aread%28stamp%29...%27/near/260604490" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> simulacrum <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/thread.20&#x27;main&#x27;.20panicked.20at.20&#x27;fs.3A.3Aread(stamp).2E.2E.2E&#x27;.html#260604490">(Nov 08 2021 at 00:25)</a>:</h4>
<p>you probably want download-llvm = true, unless you're intending to optimize LLVM (that'll give you a PGO'd llvm on x86_64-unknown-linux-gnu, which is a nice speedup)</p>



<a name="260604544"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/thread%20%27main%27%20panicked%20at%20%27fs%3A%3Aread%28stamp%29...%27/near/260604544" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> simulacrum <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/thread.20&#x27;main&#x27;.20panicked.20at.20&#x27;fs.3A.3Aread(stamp).2E.2E.2E&#x27;.html#260604544">(Nov 08 2021 at 00:26)</a>:</h4>
<p>But for profiling I'd recommend using x.py build --stage 1 library/test and the stage1/bin/rustc produced by that</p>



<a name="260604555"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/thread%20%27main%27%20panicked%20at%20%27fs%3A%3Aread%28stamp%29...%27/near/260604555" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> simulacrum <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/thread.20&#x27;main&#x27;.20panicked.20at.20&#x27;fs.3A.3Aread(stamp).2E.2E.2E&#x27;.html#260604555">(Nov 08 2021 at 00:27)</a>:</h4>
<p>if you're seeing inconsistent results on perf.rlo, then the likely cause is PGO -- that's pretty annoying to setup locally, but you can look at src/ci/pgo.sh for what CI does</p>



<a name="260604558"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/thread%20%27main%27%20panicked%20at%20%27fs%3A%3Aread%28stamp%29...%27/near/260604558" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> simulacrum <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/thread.20&#x27;main&#x27;.20panicked.20at.20&#x27;fs.3A.3Aread(stamp).2E.2E.2E&#x27;.html#260604558">(Nov 08 2021 at 00:27)</a>:</h4>
<p>(it's actually fairly easy to get it running locally, more of a time sink)</p>



<a name="260604561"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/thread%20%27main%27%20panicked%20at%20%27fs%3A%3Aread%28stamp%29...%27/near/260604561" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> njn <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/thread.20&#x27;main&#x27;.20panicked.20at.20&#x27;fs.3A.3Aread(stamp).2E.2E.2E&#x27;.html#260604561">(Nov 08 2021 at 00:27)</a>:</h4>
<p>Ok, thanks</p>



<a name="260604580"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/thread%20%27main%27%20panicked%20at%20%27fs%3A%3Aread%28stamp%29...%27/near/260604580" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> njn <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/thread.20&#x27;main&#x27;.20panicked.20at.20&#x27;fs.3A.3Aread(stamp).2E.2E.2E&#x27;.html#260604580">(Nov 08 2021 at 00:28)</a>:</h4>
<p>I admit I still find the <code>library/test</code>/<code>compiler/rustc</code> stuff confusing too</p>



<a name="260604627"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/thread%20%27main%27%20panicked%20at%20%27fs%3A%3Aread%28stamp%29...%27/near/260604627" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joshua Nelson <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/thread.20&#x27;main&#x27;.20panicked.20at.20&#x27;fs.3A.3Aread(stamp).2E.2E.2E&#x27;.html#260604627">(Nov 08 2021 at 00:29)</a>:</h4>
<p><span class="user-mention" data-user-id="120989">@njn</span> I really recommend looking through that bootstrap page if you haven't read it in the last ~6 months since I reworked it</p>



<a name="260604680"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/thread%20%27main%27%20panicked%20at%20%27fs%3A%3Aread%28stamp%29...%27/near/260604680" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joshua Nelson <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/thread.20&#x27;main&#x27;.20panicked.20at.20&#x27;fs.3A.3Aread(stamp).2E.2E.2E&#x27;.html#260604680">(Nov 08 2021 at 00:30)</a>:</h4>
<p>Happy to answer any questions you still have afterwards :)</p>



<a name="260604773"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/thread%20%27main%27%20panicked%20at%20%27fs%3A%3Aread%28stamp%29...%27/near/260604773" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> njn <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/thread.20&#x27;main&#x27;.20panicked.20at.20&#x27;fs.3A.3Aread(stamp).2E.2E.2E&#x27;.html#260604773">(Nov 08 2021 at 00:33)</a>:</h4>
<p>I just consulted some old notes I had from the last time I was confused by all this. I think the possible "targets" (might be the wrong word) for <code>x.py build</code> are:</p>
<ul>
<li>src/libstd</li>
<li>src/libtest</li>
<li>src/rustc</li>
<li>src/codegen</li>
</ul>



<a name="260604821"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/thread%20%27main%27%20panicked%20at%20%27fs%3A%3Aread%28stamp%29...%27/near/260604821" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joshua Nelson <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/thread.20&#x27;main&#x27;.20panicked.20at.20&#x27;fs.3A.3Aread(stamp).2E.2E.2E&#x27;.html#260604821">(Nov 08 2021 at 00:34)</a>:</h4>
<p>Err most of those have been shuffled to different directories</p>



<a name="260604824"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/thread%20%27main%27%20panicked%20at%20%27fs%3A%3Aread%28stamp%29...%27/near/260604824" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joshua Nelson <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/thread.20&#x27;main&#x27;.20panicked.20at.20&#x27;fs.3A.3Aread(stamp).2E.2E.2E&#x27;.html#260604824">(Nov 08 2021 at 00:35)</a>:</h4>
<p>E.g. <code>src/libstd</code> is now <code>library/std</code></p>



<a name="260604826"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/thread%20%27main%27%20panicked%20at%20%27fs%3A%3Aread%28stamp%29...%27/near/260604826" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> njn <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/thread.20&#x27;main&#x27;.20panicked.20at.20&#x27;fs.3A.3Aread(stamp).2E.2E.2E&#x27;.html#260604826">(Nov 08 2021 at 00:35)</a>:</h4>
<p>Mmm, ok</p>



<a name="260604833"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/thread%20%27main%27%20panicked%20at%20%27fs%3A%3Aread%28stamp%29...%27/near/260604833" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joshua Nelson <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/thread.20&#x27;main&#x27;.20panicked.20at.20&#x27;fs.3A.3Aread(stamp).2E.2E.2E&#x27;.html#260604833">(Nov 08 2021 at 00:35)</a>:</h4>
<p>And <code>src/rustc</code> is now <code>compiler/rustc</code></p>



<a name="260604893"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/thread%20%27main%27%20panicked%20at%20%27fs%3A%3Aread%28stamp%29...%27/near/260604893" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joshua Nelson <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/thread.20&#x27;main&#x27;.20panicked.20at.20&#x27;fs.3A.3Aread(stamp).2E.2E.2E&#x27;.html#260604893">(Nov 08 2021 at 00:36)</a>:</h4>
<p>(not sure what the codegen directory used to build)</p>



<a name="260604973"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/thread%20%27main%27%20panicked%20at%20%27fs%3A%3Aread%28stamp%29...%27/near/260604973" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> njn <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/thread.20&#x27;main&#x27;.20panicked.20at.20&#x27;fs.3A.3Aread(stamp).2E.2E.2E&#x27;.html#260604973">(Nov 08 2021 at 00:38)</a>:</h4>
<p>So, @simulacrum's <code>x.py build --stage 1 library/test</code> means "build the stage 1 compiler with the stage 0 compiler, plus also the stage2 stdlib (plus its tests?) with the stage 1 compiler...?"</p>



<a name="260604997"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/thread%20%27main%27%20panicked%20at%20%27fs%3A%3Aread%28stamp%29...%27/near/260604997" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joshua Nelson <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/thread.20&#x27;main&#x27;.20panicked.20at.20&#x27;fs.3A.3Aread(stamp).2E.2E.2E&#x27;.html#260604997">(Nov 08 2021 at 00:39)</a>:</h4>
<p><span class="user-mention" data-user-id="120989">@njn</span> I think you're using "stage2 stdlib" in a different sense than the dev guide does, but yes, that builds the standard library with the stage 1 compiler</p>



<a name="260605001"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/thread%20%27main%27%20panicked%20at%20%27fs%3A%3Aread%28stamp%29...%27/near/260605001" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> simulacrum <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/thread.20&#x27;main&#x27;.20panicked.20at.20&#x27;fs.3A.3Aread(stamp).2E.2E.2E&#x27;.html#260605001">(Nov 08 2021 at 00:39)</a>:</h4>
<p>hm, well, in some sense yes, but that's also the stage 1 libstd (we do the library copy thing)</p>
<p>library/test is just the test harness (i.e. code that runs when you do <code>#[test]</code>), it's not actual tests</p>



<a name="260605002"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/thread%20%27main%27%20panicked%20at%20%27fs%3A%3Aread%28stamp%29...%27/near/260605002" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> njn <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/thread.20&#x27;main&#x27;.20panicked.20at.20&#x27;fs.3A.3Aread(stamp).2E.2E.2E&#x27;.html#260605002">(Nov 08 2021 at 00:39)</a>:</h4>
<p>I guess I'm not sure what the effect of the <code>library/test</code>is there</p>



<a name="260605052"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/thread%20%27main%27%20panicked%20at%20%27fs%3A%3Aread%28stamp%29...%27/near/260605052" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> simulacrum <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/thread.20&#x27;main&#x27;.20panicked.20at.20&#x27;fs.3A.3Aread(stamp).2E.2E.2E&#x27;.html#260605052">(Nov 08 2021 at 00:40)</a>:</h4>
<p>it stops you from building the stage 2 compiler (i.e., the second rustc build)</p>



<a name="260605056"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/thread%20%27main%27%20panicked%20at%20%27fs%3A%3Aread%28stamp%29...%27/near/260605056" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joshua Nelson <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/thread.20&#x27;main&#x27;.20panicked.20at.20&#x27;fs.3A.3Aread(stamp).2E.2E.2E&#x27;.html#260605056">(Nov 08 2021 at 00:40)</a>:</h4>
<p><span class="user-mention" data-user-id="116122">@simulacrum</span> not since I changed the defaults</p>



<a name="260605060"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/thread%20%27main%27%20panicked%20at%20%27fs%3A%3Aread%28stamp%29...%27/near/260605060" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> simulacrum <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/thread.20&#x27;main&#x27;.20panicked.20at.20&#x27;fs.3A.3Aread(stamp).2E.2E.2E&#x27;.html#260605060">(Nov 08 2021 at 00:40)</a>:</h4>
<p>oh, well, then maybe it's not actually necessary</p>



<a name="260605062"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/thread%20%27main%27%20panicked%20at%20%27fs%3A%3Aread%28stamp%29...%27/near/260605062" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joshua Nelson <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/thread.20&#x27;main&#x27;.20panicked.20at.20&#x27;fs.3A.3Aread(stamp).2E.2E.2E&#x27;.html#260605062">(Nov 08 2021 at 00:40)</a>:</h4>
<p>Now it just prevents building rustdoc</p>



<a name="260605066"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/thread%20%27main%27%20panicked%20at%20%27fs%3A%3Aread%28stamp%29...%27/near/260605066" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> simulacrum <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/thread.20&#x27;main&#x27;.20panicked.20at.20&#x27;fs.3A.3Aread(stamp).2E.2E.2E&#x27;.html#260605066">(Nov 08 2021 at 00:40)</a>:</h4>
<p>ok, prevents doing probably-useless work :)</p>



<a name="260605072"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/thread%20%27main%27%20panicked%20at%20%27fs%3A%3Aread%28stamp%29...%27/near/260605072" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> simulacrum <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/thread.20&#x27;main&#x27;.20panicked.20at.20&#x27;fs.3A.3Aread(stamp).2E.2E.2E&#x27;.html#260605072">(Nov 08 2021 at 00:41)</a>:</h4>
<p>for me, anyway</p>



<a name="260605078"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/thread%20%27main%27%20panicked%20at%20%27fs%3A%3Aread%28stamp%29...%27/near/260605078" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joshua Nelson <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/thread.20&#x27;main&#x27;.20panicked.20at.20&#x27;fs.3A.3Aread(stamp).2E.2E.2E&#x27;.html#260605078">(Nov 08 2021 at 00:41)</a>:</h4>
<p>(I wanted to make rustdoc off by default too but people complained)</p>



<a name="260605237"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/thread%20%27main%27%20panicked%20at%20%27fs%3A%3Aread%28stamp%29...%27/near/260605237" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> njn <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/thread.20&#x27;main&#x27;.20panicked.20at.20&#x27;fs.3A.3Aread(stamp).2E.2E.2E&#x27;.html#260605237">(Nov 08 2021 at 00:45)</a>:</h4>
<p>Ok, I will try using <code>x.py build --stage 1 library/test</code> and <code>stage1/bin/rustc</code>, thanks. I have always found this stuff confusing :(</p>



<a name="260605303"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/thread%20%27main%27%20panicked%20at%20%27fs%3A%3Aread%28stamp%29...%27/near/260605303" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> njn <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/thread.20&#x27;main&#x27;.20panicked.20at.20&#x27;fs.3A.3Aread(stamp).2E.2E.2E&#x27;.html#260605303">(Nov 08 2021 at 00:47)</a>:</h4>
<p>Oh, is <code>RUSTFLAGS="-C link-arg=-fuse-ld=lld"</code> still useful/needed on Linux?</p>



<a name="260605308"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/thread%20%27main%27%20panicked%20at%20%27fs%3A%3Aread%28stamp%29...%27/near/260605308" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> simulacrum <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/thread.20&#x27;main&#x27;.20panicked.20at.20&#x27;fs.3A.3Aread(stamp).2E.2E.2E&#x27;.html#260605308">(Nov 08 2021 at 00:47)</a>:</h4>
<p>I think you can specify it via use-lld or some such in config.toml these days and it'll adjust slightly more</p>



<a name="260605309"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/thread%20%27main%27%20panicked%20at%20%27fs%3A%3Aread%28stamp%29...%27/near/260605309" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> simulacrum <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/thread.20&#x27;main&#x27;.20panicked.20at.20&#x27;fs.3A.3Aread(stamp).2E.2E.2E&#x27;.html#260605309">(Nov 08 2021 at 00:47)</a>:</h4>
<p>but yes, IIRC, still useful</p>



<a name="260605360"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/thread%20%27main%27%20panicked%20at%20%27fs%3A%3Aread%28stamp%29...%27/near/260605360" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joshua Nelson <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/thread.20&#x27;main&#x27;.20panicked.20at.20&#x27;fs.3A.3Aread(stamp).2E.2E.2E&#x27;.html#260605360">(Nov 08 2021 at 00:48)</a>:</h4>
<p>(there's an issue open somewhere to turn it on by default)</p>



<a name="260605392"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/thread%20%27main%27%20panicked%20at%20%27fs%3A%3Aread%28stamp%29...%27/near/260605392" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> njn <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/thread.20&#x27;main&#x27;.20panicked.20at.20&#x27;fs.3A.3Aread(stamp).2E.2E.2E&#x27;.html#260605392">(Nov 08 2021 at 00:49)</a>:</h4>
<p>Ah, looks like <code>[rust] use-lld=true</code></p>



<a name="260605447"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/thread%20%27main%27%20panicked%20at%20%27fs%3A%3Aread%28stamp%29...%27/near/260605447" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> njn <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/thread.20&#x27;main&#x27;.20panicked.20at.20&#x27;fs.3A.3Aread(stamp).2E.2E.2E&#x27;.html#260605447">(Nov 08 2021 at 00:50)</a>:</h4>
<p>I also learned about <code>[llvm] link-jobs = 2</code> today because the LLVM linking OOM'd my 32GiB-of-RAM machine O_o</p>



<a name="260605464"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/thread%20%27main%27%20panicked%20at%20%27fs%3A%3Aread%28stamp%29...%27/near/260605464" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> njn <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/thread.20&#x27;main&#x27;.20panicked.20at.20&#x27;fs.3A.3Aread(stamp).2E.2E.2E&#x27;.html#260605464">(Nov 08 2021 at 00:50)</a>:</h4>
<p>I had four linking jobs that each got up to about 7 GiB before they were killed</p>



<a name="260605466"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/thread%20%27main%27%20panicked%20at%20%27fs%3A%3Aread%28stamp%29...%27/near/260605466" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joshua Nelson <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/thread.20&#x27;main&#x27;.20panicked.20at.20&#x27;fs.3A.3Aread(stamp).2E.2E.2E&#x27;.html#260605466">(Nov 08 2021 at 00:50)</a>:</h4>
<p>Did you have LTO on or something? That seems unusually high even for llvm</p>



<a name="260605486"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/thread%20%27main%27%20panicked%20at%20%27fs%3A%3Aread%28stamp%29...%27/near/260605486" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> njn <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/thread.20&#x27;main&#x27;.20panicked.20at.20&#x27;fs.3A.3Aread(stamp).2E.2E.2E&#x27;.html#260605486">(Nov 08 2021 at 00:51)</a>:</h4>
<p>Just the config.toml mentioned above, nothing fancy other than <code>[llvm] release-debuginfo = true</code></p>



<a name="260605498"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/thread%20%27main%27%20panicked%20at%20%27fs%3A%3Aread%28stamp%29...%27/near/260605498" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joshua Nelson <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/thread.20&#x27;main&#x27;.20panicked.20at.20&#x27;fs.3A.3Aread(stamp).2E.2E.2E&#x27;.html#260605498">(Nov 08 2021 at 00:51)</a>:</h4>
<p>Oof, ok. FWIW you should be able to download LLVM without needing to link it locally</p>



<a name="260605558"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/thread%20%27main%27%20panicked%20at%20%27fs%3A%3Aread%28stamp%29...%27/near/260605558" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> njn <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/thread.20&#x27;main&#x27;.20panicked.20at.20&#x27;fs.3A.3Aread(stamp).2E.2E.2E&#x27;.html#260605558">(Nov 08 2021 at 00:52)</a>:</h4>
<p>But will that have the debuginfo in it? That's useful when profiling</p>



<a name="260605563"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/thread%20%27main%27%20panicked%20at%20%27fs%3A%3Aread%28stamp%29...%27/near/260605563" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joshua Nelson <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/thread.20&#x27;main&#x27;.20panicked.20at.20&#x27;fs.3A.3Aread(stamp).2E.2E.2E&#x27;.html#260605563">(Nov 08 2021 at 00:52)</a>:</h4>
<p>I think so, yes - there's an "llvm-alt" component which I believe has debuginfo</p>



<a name="260605567"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/thread%20%27main%27%20panicked%20at%20%27fs%3A%3Aread%28stamp%29...%27/near/260605567" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> simulacrum <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/thread.20&#x27;main&#x27;.20panicked.20at.20&#x27;fs.3A.3Aread(stamp).2E.2E.2E&#x27;.html#260605567">(Nov 08 2021 at 00:53)</a>:</h4>
<p>you probably want to build locally if you want llvm debuginfo</p>



<a name="260605573"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/thread%20%27main%27%20panicked%20at%20%27fs%3A%3Aread%28stamp%29...%27/near/260605573" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joshua Nelson <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/thread.20&#x27;main&#x27;.20panicked.20at.20&#x27;fs.3A.3Aread(stamp).2E.2E.2E&#x27;.html#260605573">(Nov 08 2021 at 00:53)</a>:</h4>
<p>Oh right, -alt is assertions</p>



<a name="260605574"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/thread%20%27main%27%20panicked%20at%20%27fs%3A%3Aread%28stamp%29...%27/near/260605574" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> simulacrum <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/thread.20&#x27;main&#x27;.20panicked.20at.20&#x27;fs.3A.3Aread(stamp).2E.2E.2E&#x27;.html#260605574">(Nov 08 2021 at 00:53)</a>:</h4>
<p>I don't think we ship debuginfo llvm's, the alt builds have assertions on but that's... different</p>



<a name="260605625"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/thread%20%27main%27%20panicked%20at%20%27fs%3A%3Aread%28stamp%29...%27/near/260605625" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joshua Nelson <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/thread.20&#x27;main&#x27;.20panicked.20at.20&#x27;fs.3A.3Aread(stamp).2E.2E.2E&#x27;.html#260605625">(Nov 08 2021 at 00:54)</a>:</h4>
<p>(and fwiw you shouldn't need to memorize this, x.py will give a hard error if you configure an LLVM setting that isn't available for downloads)</p>



<a name="260605780"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/thread%20%27main%27%20panicked%20at%20%27fs%3A%3Aread%28stamp%29...%27/near/260605780" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> njn <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/thread.20&#x27;main&#x27;.20panicked.20at.20&#x27;fs.3A.3Aread(stamp).2E.2E.2E&#x27;.html#260605780">(Nov 08 2021 at 00:58)</a>:</h4>
<p>LOL, I have a million bash aliases for all this stuff that I'm having to update</p>



<a name="260606127"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/thread%20%27main%27%20panicked%20at%20%27fs%3A%3Aread%28stamp%29...%27/near/260606127" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> njn <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/thread.20&#x27;main&#x27;.20panicked.20at.20&#x27;fs.3A.3Aread(stamp).2E.2E.2E&#x27;.html#260606127">(Nov 08 2021 at 01:06)</a>:</h4>
<p><a href="https://rustc-dev-guide.rust-lang.org/building/how-to-build-and-run.html">https://rustc-dev-guide.rust-lang.org/building/how-to-build-and-run.html</a> suggests creating a toolchain with rustup</p>



<a name="260606133"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/thread%20%27main%27%20panicked%20at%20%27fs%3A%3Aread%28stamp%29...%27/near/260606133" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> njn <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/thread.20&#x27;main&#x27;.20panicked.20at.20&#x27;fs.3A.3Aread(stamp).2E.2E.2E&#x27;.html#260606133">(Nov 08 2021 at 01:06)</a>:</h4>
<p>Is there anything wrong with just e.g. running <code>$HOME/dev/rust0/build/x86_64-unknown-linux-gnu/stage1/bin/rustc</code>?</p>



<a name="260606147"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/thread%20%27main%27%20panicked%20at%20%27fs%3A%3Aread%28stamp%29...%27/near/260606147" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joshua Nelson <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/thread.20&#x27;main&#x27;.20panicked.20at.20&#x27;fs.3A.3Aread(stamp).2E.2E.2E&#x27;.html#260606147">(Nov 08 2021 at 01:07)</a>:</h4>
<p>that works, it's just more annoying</p>



<a name="260606203"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/thread%20%27main%27%20panicked%20at%20%27fs%3A%3Aread%28stamp%29...%27/near/260606203" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> njn <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/thread.20&#x27;main&#x27;.20panicked.20at.20&#x27;fs.3A.3Aread(stamp).2E.2E.2E&#x27;.html#260606203">(Nov 08 2021 at 01:08)</a>:</h4>
<p>I'm used to it :) I have this:</p>
<div class="codehilite"><pre><span></span><code>export RUSTC0=&quot;$HOME/dev/rust0/build/x86_64-unknown-linux-gnu/stage1/bin/rustc&quot;
</code></pre></div>



<a name="260606205"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/thread%20%27main%27%20panicked%20at%20%27fs%3A%3Aread%28stamp%29...%27/near/260606205" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> njn <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/thread.20&#x27;main&#x27;.20panicked.20at.20&#x27;fs.3A.3Aread(stamp).2E.2E.2E&#x27;.html#260606205">(Nov 08 2021 at 01:08)</a>:</h4>
<p>I just run <code>$RUSTC0 a.rs</code>, etc.</p>



<a name="260606212"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/thread%20%27main%27%20panicked%20at%20%27fs%3A%3Aread%28stamp%29...%27/near/260606212" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> njn <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/thread.20&#x27;main&#x27;.20panicked.20at.20&#x27;fs.3A.3Aread(stamp).2E.2E.2E&#x27;.html#260606212">(Nov 08 2021 at 01:08)</a>:</h4>
<p>Just wanted to make sure there wasn't something deeper going on with the toolchain</p>



<a name="260606216"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/thread%20%27main%27%20panicked%20at%20%27fs%3A%3Aread%28stamp%29...%27/near/260606216" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joshua Nelson <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/thread.20&#x27;main&#x27;.20panicked.20at.20&#x27;fs.3A.3Aread(stamp).2E.2E.2E&#x27;.html#260606216">(Nov 08 2021 at 01:08)</a>:</h4>
<p>not to my knowledge, no - it does let you run rustdoc and things more easily, but I don't think it changes any behavior</p>



<a name="260608762"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/thread%20%27main%27%20panicked%20at%20%27fs%3A%3Aread%28stamp%29...%27/near/260608762" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> njn <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/thread.20&#x27;main&#x27;.20panicked.20at.20&#x27;fs.3A.3Aread(stamp).2E.2E.2E&#x27;.html#260608762">(Nov 08 2021 at 02:14)</a>:</h4>
<p>Hmm, running <code>x.py test</code> I get lots of link errors like this:</p>
<div class="codehilite"><pre><span></span><code>error: linking with `cc` failed: exit status: 1
   |
   = note: &quot;cc&quot; &quot;-m64&quot; &quot;/home/njn/dev/rust1/build/x86_64-unknown-linux-gnu/test/ui/z-crate-attr/a.z_crate_attr.d6e75bc1-cgu.0.rcgu.o&quot; &quot;-Wl,--as-needed&quot; &quot;-L&quot; &quot;/home/njn/dev/rust1/build/x86_64-unknown-linux-gnu/native/rust-test-helpers&quot; &quot;-L&quot; &quot;/home/njn/dev/rust1/build/x86_64-unknown-linux-gnu/test/ui/z-crate-attr/auxiliary&quot; &quot;-L&quot; &quot;/home/njn/dev/rust1/build/x86_64-unknown-linux-gnu/stage1/lib/rustlib/x86_64-unknown-linux-gnu/lib&quot; &quot;-Wl,--start-group&quot; &quot;-L&quot; &quot;/home/njn/dev/rust1/build/x86_64-unknown-linux-gnu/stage1/lib/rustlib/x86_64-unknown-linux-gnu/lib&quot; &quot;-lstd-45222600de877f18&quot; &quot;-Wl,--end-group&quot; &quot;-Wl,-Bstatic&quot; &quot;/home/njn/dev/rust1/build/x86_64-unknown-linux-gnu/stage1/lib/rustlib/x86_64-unknown-linux-gnu/lib/libcompiler_builtins-82dfd1ba81d743bb.rlib&quot; &quot;-Wl,-Bdynamic&quot; &quot;-lgcc_s&quot; &quot;-lutil&quot; &quot;-lrt&quot; &quot;-lpthread&quot; &quot;-lm&quot; &quot;-ldl&quot; &quot;-lc&quot; &quot;-Wl,--eh-frame-hdr&quot; &quot;-Wl,-znoexecstack&quot; &quot;-L&quot; &quot;/home/njn/dev/rust1/build/x86_64-unknown-linux-gnu/stage1/lib/rustlib/x86_64-unknown-linux-gnu/lib&quot; &quot;-o&quot; &quot;/home/njn/dev/rust1/build/x86_64-unknown-linux-gnu/test/ui/z-crate-attr/a&quot; &quot;-Wl,--gc-sections&quot; &quot;-pie&quot; &quot;-Wl,-zrelro&quot; &quot;-Wl,-znow&quot; &quot;-Wl,-O1&quot; &quot;-nodefaultlibs&quot; &quot;-Wl,-rpath,$ORIGIN/../../../stage1/lib/rustlib/x86_64-unknown-linux-gnu/lib&quot; &quot;-Wl,--enable-new-dtags&quot; &quot;-fuse-ld=lld&quot; &quot;-Wl,--threads=1&quot;
   = note: ld.lld: error: unknown argument &#39;--threads=1&#39;
           collect2: error: ld returned 1 exit status
</code></pre></div>



<a name="260608769"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/thread%20%27main%27%20panicked%20at%20%27fs%3A%3Aread%28stamp%29...%27/near/260608769" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> njn <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/thread.20&#x27;main&#x27;.20panicked.20at.20&#x27;fs.3A.3Aread(stamp).2E.2E.2E&#x27;.html#260608769">(Nov 08 2021 at 02:14)</a>:</h4>
<p>I wonder if <code>use-lld</code> in <code>config.toml</code> is broken</p>



<a name="260608789"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/thread%20%27main%27%20panicked%20at%20%27fs%3A%3Aread%28stamp%29...%27/near/260608789" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joshua Nelson <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/thread.20&#x27;main&#x27;.20panicked.20at.20&#x27;fs.3A.3Aread(stamp).2E.2E.2E&#x27;.html#260608789">(Nov 08 2021 at 02:15)</a>:</h4>
<p>hmm, the only place I see -Wl,--threads=1 is in <code>src/bootstrap/bin/rustdoc.rs</code></p>



<a name="260608791"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/thread%20%27main%27%20panicked%20at%20%27fs%3A%3Aread%28stamp%29...%27/near/260608791" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> njn <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/thread.20&#x27;main&#x27;.20panicked.20at.20&#x27;fs.3A.3Aread(stamp).2E.2E.2E&#x27;.html#260608791">(Nov 08 2021 at 02:15)</a>:</h4>
<p>I have lld 10.0.0</p>



<a name="260608792"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/thread%20%27main%27%20panicked%20at%20%27fs%3A%3Aread%28stamp%29...%27/near/260608792" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joshua Nelson <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/thread.20&#x27;main&#x27;.20panicked.20at.20&#x27;fs.3A.3Aread(stamp).2E.2E.2E&#x27;.html#260608792">(Nov 08 2021 at 02:15)</a>:</h4>
<p>are you setting it in RUSTFLAGS?</p>



<a name="260608794"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/thread%20%27main%27%20panicked%20at%20%27fs%3A%3Aread%28stamp%29...%27/near/260608794" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> njn <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/thread.20&#x27;main&#x27;.20panicked.20at.20&#x27;fs.3A.3Aread(stamp).2E.2E.2E&#x27;.html#260608794">(Nov 08 2021 at 02:16)</a>:</h4>
<p>no</p>



<a name="260608838"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/thread%20%27main%27%20panicked%20at%20%27fs%3A%3Aread%28stamp%29...%27/near/260608838" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> njn <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/thread.20&#x27;main&#x27;.20panicked.20at.20&#x27;fs.3A.3Aread(stamp).2E.2E.2E&#x27;.html#260608838">(Nov 08 2021 at 02:16)</a>:</h4>
<p><code>git grep threads=1</code> shows lots of hits</p>



<a name="260608849"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/thread%20%27main%27%20panicked%20at%20%27fs%3A%3Aread%28stamp%29...%27/near/260608849" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joshua Nelson <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/thread.20&#x27;main&#x27;.20panicked.20at.20&#x27;fs.3A.3Aread(stamp).2E.2E.2E&#x27;.html#260608849">(Nov 08 2021 at 02:17)</a>:</h4>
<p><code>test-threads</code> is something different though</p>



<a name="260608856"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/thread%20%27main%27%20panicked%20at%20%27fs%3A%3Aread%28stamp%29...%27/near/260608856" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joshua Nelson <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/thread.20&#x27;main&#x27;.20panicked.20at.20&#x27;fs.3A.3Aread(stamp).2E.2E.2E&#x27;.html#260608856">(Nov 08 2021 at 02:17)</a>:</h4>
<p>the only hit I see besides rustdoc is</p>
<div class="codehilite"><pre><span></span><code>src/bootstrap/lib.rs
1042:            let threads = if target.contains(&quot;windows&quot;) { &quot;/threads:1&quot; } else { &quot;--threads=1&quot; };
</code></pre></div>



<a name="260608857"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/thread%20%27main%27%20panicked%20at%20%27fs%3A%3Aread%28stamp%29...%27/near/260608857" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> njn <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/thread.20&#x27;main&#x27;.20panicked.20at.20&#x27;fs.3A.3Aread(stamp).2E.2E.2E&#x27;.html#260608857">(Nov 08 2021 at 02:17)</a>:</h4>
<p>src/bootstrap/lib.rs has something</p>



<a name="260608859"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/thread%20%27main%27%20panicked%20at%20%27fs%3A%3Aread%28stamp%29...%27/near/260608859" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> njn <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/thread.20&#x27;main&#x27;.20panicked.20at.20&#x27;fs.3A.3Aread(stamp).2E.2E.2E&#x27;.html#260608859">(Nov 08 2021 at 02:17)</a>:</h4>
<p>yeah</p>



<a name="260608919"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/thread%20%27main%27%20panicked%20at%20%27fs%3A%3Aread%28stamp%29...%27/near/260608919" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joshua Nelson <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/thread.20&#x27;main&#x27;.20panicked.20at.20&#x27;fs.3A.3Aread(stamp).2E.2E.2E&#x27;.html#260608919">(Nov 08 2021 at 02:18)</a>:</h4>
<p>added in <a href="https://github.com/rust-lang/rust/commit/0ddc3afbb59bde6a14068b3e7887aa41cd58277f">https://github.com/rust-lang/rust/commit/0ddc3afbb59bde6a14068b3e7887aa41cd58277f</a></p>



<a name="260608921"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/thread%20%27main%27%20panicked%20at%20%27fs%3A%3Aread%28stamp%29...%27/near/260608921" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joshua Nelson <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/thread.20&#x27;main&#x27;.20panicked.20at.20&#x27;fs.3A.3Aread(stamp).2E.2E.2E&#x27;.html#260608921">(Nov 08 2021 at 02:18)</a>:</h4>
<p>cc <span class="user-mention" data-user-id="330154">@The 8472</span> , apparently this doesn't work on all versions of ldd</p>



<a name="260608925"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/thread%20%27main%27%20panicked%20at%20%27fs%3A%3Aread%28stamp%29...%27/near/260608925" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> simulacrum <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/thread.20&#x27;main&#x27;.20panicked.20at.20&#x27;fs.3A.3Aread(stamp).2E.2E.2E&#x27;.html#260608925">(Nov 08 2021 at 02:19)</a>:</h4>
<p>hm</p>



<a name="260608928"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/thread%20%27main%27%20panicked%20at%20%27fs%3A%3Aread%28stamp%29...%27/near/260608928" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> simulacrum <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/thread.20&#x27;main&#x27;.20panicked.20at.20&#x27;fs.3A.3Aread(stamp).2E.2E.2E&#x27;.html#260608928">(Nov 08 2021 at 02:19)</a>:</h4>
<p>I thought we used rust-lld from the beta, which should always work</p>



<a name="260608933"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/thread%20%27main%27%20panicked%20at%20%27fs%3A%3Aread%28stamp%29...%27/near/260608933" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> njn <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/thread.20&#x27;main&#x27;.20panicked.20at.20&#x27;fs.3A.3Aread(stamp).2E.2E.2E&#x27;.html#260608933">(Nov 08 2021 at 02:19)</a>:</h4>
<p>my system ld.lld accepts <code>--threads</code>, but not <code>--threads=1</code></p>



<a name="260608934"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/thread%20%27main%27%20panicked%20at%20%27fs%3A%3Aread%28stamp%29...%27/near/260608934" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> simulacrum <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/thread.20&#x27;main&#x27;.20panicked.20at.20&#x27;fs.3A.3Aread(stamp).2E.2E.2E&#x27;.html#260608934">(Nov 08 2021 at 02:19)</a>:</h4>
<p>$ ls -trl <code>which lld</code><br>
lrwxrwxrwx 1 mark mark 112 Sep 19 10:50 /home/mark/bin/lld -&gt; /home/mark/.rustup/toolchains/nightly-x86_64-unknown-linux-gnu/lib/rustlib/x86_64-unknown-linux-gnu/bin/rust-lld</p>



<a name="260608973"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/thread%20%27main%27%20panicked%20at%20%27fs%3A%3Aread%28stamp%29...%27/near/260608973" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> simulacrum <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/thread.20&#x27;main&#x27;.20panicked.20at.20&#x27;fs.3A.3Aread(stamp).2E.2E.2E&#x27;.html#260608973">(Nov 08 2021 at 02:20)</a>:</h4>
<p>So I guess you can do something similar</p>



<a name="260609000"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/thread%20%27main%27%20panicked%20at%20%27fs%3A%3Aread%28stamp%29...%27/near/260609000" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> njn <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/thread.20&#x27;main&#x27;.20panicked.20at.20&#x27;fs.3A.3Aread(stamp).2E.2E.2E&#x27;.html#260609000">(Nov 08 2021 at 02:21)</a>:</h4>
<p>As a workaround?</p>



<a name="260609010"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/thread%20%27main%27%20panicked%20at%20%27fs%3A%3Aread%28stamp%29...%27/near/260609010" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> simulacrum <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/thread.20&#x27;main&#x27;.20panicked.20at.20&#x27;fs.3A.3Aread(stamp).2E.2E.2E&#x27;.html#260609010">(Nov 08 2021 at 02:21)</a>:</h4>
<p>well, I mean, it just gets you ~latest stable lld</p>



<a name="260609014"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/thread%20%27main%27%20panicked%20at%20%27fs%3A%3Aread%28stamp%29...%27/near/260609014" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> simulacrum <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/thread.20&#x27;main&#x27;.20panicked.20at.20&#x27;fs.3A.3Aread(stamp).2E.2E.2E&#x27;.html#260609014">(Nov 08 2021 at 02:21)</a>:</h4>
<p>(currently v13)</p>



<a name="260609015"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/thread%20%27main%27%20panicked%20at%20%27fs%3A%3Aread%28stamp%29...%27/near/260609015" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> simulacrum <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/thread.20&#x27;main&#x27;.20panicked.20at.20&#x27;fs.3A.3Aread(stamp).2E.2E.2E&#x27;.html#260609015">(Nov 08 2021 at 02:21)</a>:</h4>
<p>since we upgrade LLVM pretty quickly</p>



<a name="260609023"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/thread%20%27main%27%20panicked%20at%20%27fs%3A%3Aread%28stamp%29...%27/near/260609023" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> simulacrum <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/thread.20&#x27;main&#x27;.20panicked.20at.20&#x27;fs.3A.3Aread(stamp).2E.2E.2E&#x27;.html#260609023">(Nov 08 2021 at 02:21)</a>:</h4>
<p>but yeah, it'll "fix" the issue</p>



<a name="260609061"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/thread%20%27main%27%20panicked%20at%20%27fs%3A%3Aread%28stamp%29...%27/near/260609061" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> simulacrum <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/thread.20&#x27;main&#x27;.20panicked.20at.20&#x27;fs.3A.3Aread(stamp).2E.2E.2E&#x27;.html#260609061">(Nov 08 2021 at 02:22)</a>:</h4>
<p>UI tests run a good bit faster with this threads=1</p>



<a name="260609305"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/thread%20%27main%27%20panicked%20at%20%27fs%3A%3Aread%28stamp%29...%27/near/260609305" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> njn <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/thread.20&#x27;main&#x27;.20panicked.20at.20&#x27;fs.3A.3Aread(stamp).2E.2E.2E&#x27;.html#260609305">(Nov 08 2021 at 02:29)</a>:</h4>
<p><span class="user-mention" data-user-id="116122">@simulacrum</span></p>
<div class="codehilite"><pre><span></span><code> [gulf:~] .rustup/toolchains/nightly-x86_64-unknown-linux-gnu/lib/rustlib/x86_64-unknown-linux-gnu/bin/rust-lld
.rustup/toolchains/nightly-x86_64-unknown-linux-gnu/lib/rustlib/x86_64-unknown-linux-gnu/bin/rust-lld: error while loading shared libraries: libLLVM-13-rust-1.58.0-nightly.so: cannot open shared object file: No such file or directory
</code></pre></div>



<a name="260609354"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/thread%20%27main%27%20panicked%20at%20%27fs%3A%3Aread%28stamp%29...%27/near/260609354" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> simulacrum <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/thread.20&#x27;main&#x27;.20panicked.20at.20&#x27;fs.3A.3Aread(stamp).2E.2E.2E&#x27;.html#260609354">(Nov 08 2021 at 02:30)</a>:</h4>
<p>hm</p>



<a name="260609358"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/thread%20%27main%27%20panicked%20at%20%27fs%3A%3Aread%28stamp%29...%27/near/260609358" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joshua Nelson <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/thread.20&#x27;main&#x27;.20panicked.20at.20&#x27;fs.3A.3Aread(stamp).2E.2E.2E&#x27;.html#260609358">(Nov 08 2021 at 02:30)</a>:</h4>
<p><span class="user-mention" data-user-id="120989">@njn</span> does <code>rustup component add llvm-tools-preview</code> help?</p>



<a name="260609378"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/thread%20%27main%27%20panicked%20at%20%27fs%3A%3Aread%28stamp%29...%27/near/260609378" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> simulacrum <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/thread.20&#x27;main&#x27;.20panicked.20at.20&#x27;fs.3A.3Aread(stamp).2E.2E.2E&#x27;.html#260609378">(Nov 08 2021 at 02:31)</a>:</h4>
<p>it seems to work for me, I don't have LD_LIBRARY_PATH...</p>



<a name="260609391"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/thread%20%27main%27%20panicked%20at%20%27fs%3A%3Aread%28stamp%29...%27/near/260609391" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> njn <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/thread.20&#x27;main&#x27;.20panicked.20at.20&#x27;fs.3A.3Aread(stamp).2E.2E.2E&#x27;.html#260609391">(Nov 08 2021 at 02:31)</a>:</h4>
<p>I have <code>LD_LIBRARY_PATH=/home/njn/local/lib:</code></p>



<a name="260609436"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/thread%20%27main%27%20panicked%20at%20%27fs%3A%3Aread%28stamp%29...%27/near/260609436" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> njn <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/thread.20&#x27;main&#x27;.20panicked.20at.20&#x27;fs.3A.3Aread(stamp).2E.2E.2E&#x27;.html#260609436">(Nov 08 2021 at 02:32)</a>:</h4>
<p>I think I'll disable <code>use-lld</code>, go back to using RUSTFLAGS</p>



<a name="260610029"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/thread%20%27main%27%20panicked%20at%20%27fs%3A%3Aread%28stamp%29...%27/near/260610029" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> njn <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/thread.20&#x27;main&#x27;.20panicked.20at.20&#x27;fs.3A.3Aread(stamp).2E.2E.2E&#x27;.html#260610029">(Nov 08 2021 at 02:45)</a>:</h4>
<p>I might retry <code>use-lld</code> later, but I need to get basic stuff just working again, even if it involves sub-optimal stuff</p>



<a name="260610410"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/thread%20%27main%27%20panicked%20at%20%27fs%3A%3Aread%28stamp%29...%27/near/260610410" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> njn <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/thread.20&#x27;main&#x27;.20panicked.20at.20&#x27;fs.3A.3Aread(stamp).2E.2E.2E&#x27;.html#260610410">(Nov 08 2021 at 02:55)</a>:</h4>
<p>Oh, RUSTFLAGS still has the same problem. I guess I'll switch away from lld for the moment</p>



<a name="260611672"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/thread%20%27main%27%20panicked%20at%20%27fs%3A%3Aread%28stamp%29...%27/near/260611672" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> njn <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/thread.20&#x27;main&#x27;.20panicked.20at.20&#x27;fs.3A.3Aread(stamp).2E.2E.2E&#x27;.html#260611672">(Nov 08 2021 at 03:24)</a>:</h4>
<p>And on the stage 1 vs stage 2 choice, I just re-read this note in the rustc-perf docs:</p>
<blockquote>
<p>&lt;RUSTC&gt;: a path (relative or absolute) to a rustc executable that will be benchmarked. Some benchmarks use plugins, which require a stage 2 compiler. Therefore, the value is likely to be something like $RUST/build/x86_64-unknown-linux-gnu/stage2/bin/rustc, where $RUST is a path (relative or absolute) to a rust repository.</p>
</blockquote>



<a name="260611685"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/thread%20%27main%27%20panicked%20at%20%27fs%3A%3Aread%28stamp%29...%27/near/260611685" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joshua Nelson <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/thread.20&#x27;main&#x27;.20panicked.20at.20&#x27;fs.3A.3Aread(stamp).2E.2E.2E&#x27;.html#260611685">(Nov 08 2021 at 03:24)</a>:</h4>
<p>I think servo is the only one that uses plugins (do they still have plugins?)</p>



<a name="260611691"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/thread%20%27main%27%20panicked%20at%20%27fs%3A%3Aread%28stamp%29...%27/near/260611691" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joshua Nelson <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/thread.20&#x27;main&#x27;.20panicked.20at.20&#x27;fs.3A.3Aread(stamp).2E.2E.2E&#x27;.html#260611691">(Nov 08 2021 at 03:25)</a>:</h4>
<p>and I remember you saying a while ago you very rarely run servo because it's so expensive and dependent on CGU partitioning</p>



<a name="260611697"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/thread%20%27main%27%20panicked%20at%20%27fs%3A%3Aread%28stamp%29...%27/near/260611697" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> njn <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/thread.20&#x27;main&#x27;.20panicked.20at.20&#x27;fs.3A.3Aread(stamp).2E.2E.2E&#x27;.html#260611697">(Nov 08 2021 at 03:25)</a>:</h4>
<p>Good to know :)</p>



<a name="260612104"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/thread%20%27main%27%20panicked%20at%20%27fs%3A%3Aread%28stamp%29...%27/near/260612104" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> njn <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/thread.20&#x27;main&#x27;.20panicked.20at.20&#x27;fs.3A.3Aread(stamp).2E.2E.2E&#x27;.html#260612104">(Nov 08 2021 at 03:35)</a>:</h4>
<p>I don't even know what plugins are</p>



<a name="260612106"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/thread%20%27main%27%20panicked%20at%20%27fs%3A%3Aread%28stamp%29...%27/near/260612106" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> njn <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/thread.20&#x27;main&#x27;.20panicked.20at.20&#x27;fs.3A.3Aread(stamp).2E.2E.2E&#x27;.html#260612106">(Nov 08 2021 at 03:35)</a>:</h4>
<p>I thought stage2 might have been needed for benchmarks using procmacros, but I could be wrong about that</p>



<a name="260612142"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/thread%20%27main%27%20panicked%20at%20%27fs%3A%3Aread%28stamp%29...%27/near/260612142" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joshua Nelson <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/thread.20&#x27;main&#x27;.20panicked.20at.20&#x27;fs.3A.3Aread(stamp).2E.2E.2E&#x27;.html#260612142">(Nov 08 2021 at 03:36)</a>:</h4>
<p>my understanding is that plugins are type-aware proc-macros</p>



<a name="260612146"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/thread%20%27main%27%20panicked%20at%20%27fs%3A%3Aread%28stamp%29...%27/near/260612146" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joshua Nelson <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/thread.20&#x27;main&#x27;.20panicked.20at.20&#x27;fs.3A.3Aread(stamp).2E.2E.2E&#x27;.html#260612146">(Nov 08 2021 at 03:36)</a>:</h4>
<p><span class="user-mention silent" data-user-id="120989">njn</span> <a href="#narrow/stream/131828-t-compiler/topic/thread.20'main'.20panicked.20at.20'fs.3A.3Aread.28stamp.29.2E.2E.2E'/near/260612106">said</a>:</p>
<blockquote>
<p>I thought stage2 might have been needed for benchmarks using procmacros, but I could be wrong about that</p>
</blockquote>
<p>it used to be, but no longer</p>



<a name="260612554"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/thread%20%27main%27%20panicked%20at%20%27fs%3A%3Aread%28stamp%29...%27/near/260612554" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> njn <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/thread.20&#x27;main&#x27;.20panicked.20at.20&#x27;fs.3A.3Aread(stamp).2E.2E.2E&#x27;.html#260612554">(Nov 08 2021 at 03:46)</a>:</h4>
<blockquote>
<p>it used to be, but no longer</p>
</blockquote>
<p>That's the theme for this entire thread</p>



<a name="260612617"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/thread%20%27main%27%20panicked%20at%20%27fs%3A%3Aread%28stamp%29...%27/near/260612617" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joshua Nelson <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/thread.20&#x27;main&#x27;.20panicked.20at.20&#x27;fs.3A.3Aread(stamp).2E.2E.2E&#x27;.html#260612617">(Nov 08 2021 at 03:48)</a>:</h4>
<p>hopefully most of those changes are positive and not just churn <span aria-label="sweat smile" class="emoji emoji-1f605" role="img" title="sweat smile">:sweat_smile:</span></p>



<a name="260629632"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/thread%20%27main%27%20panicked%20at%20%27fs%3A%3Aread%28stamp%29...%27/near/260629632" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> The 8472 <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/thread.20&#x27;main&#x27;.20panicked.20at.20&#x27;fs.3A.3Aread(stamp).2E.2E.2E&#x27;.html#260629632">(Nov 08 2021 at 09:03)</a>:</h4>
<p><span class="user-mention silent" data-user-id="232545">Joshua Nelson</span> <a href="#narrow/stream/131828-t-compiler/topic/thread.20'main'.20panicked.20at.20'fs.3A.3Aread.28stamp.29.2E.2E.2E'/near/260608921">said</a>:</p>
<blockquote>
<p>cc <span class="user-mention silent" data-user-id="330154">The 8472</span> , apparently this doesn't work on all versions of ldd</p>
</blockquote>
<p>Hrm, it has been working for me with 11 and 12. And I assume it also works with 13 since CI builds that</p>



<a name="260629776"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/thread%20%27main%27%20panicked%20at%20%27fs%3A%3Aread%28stamp%29...%27/near/260629776" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> The 8472 <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/thread.20&#x27;main&#x27;.20panicked.20at.20&#x27;fs.3A.3Aread(stamp).2E.2E.2E&#x27;.html#260629776">(Nov 08 2021 at 09:04)</a>:</h4>
<p>Oh yeah I think 10 only had --threads/--no-threads or something like that.</p>



<a name="260631214"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/thread%20%27main%27%20panicked%20at%20%27fs%3A%3Aread%28stamp%29...%27/near/260631214" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> njn <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/thread.20&#x27;main&#x27;.20panicked.20at.20&#x27;fs.3A.3Aread(stamp).2E.2E.2E&#x27;.html#260631214">(Nov 08 2021 at 09:18)</a>:</h4>
<p>This might prompt me to get off Ubuntu 20.04 LTS onto the 6-montly releases again</p>



<a name="260631672"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/thread%20%27main%27%20panicked%20at%20%27fs%3A%3Aread%28stamp%29...%27/near/260631672" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Hans Kratz <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/thread.20&#x27;main&#x27;.20panicked.20at.20&#x27;fs.3A.3Aread(stamp).2E.2E.2E&#x27;.html#260631672">(Nov 08 2021 at 09:22)</a>:</h4>
<p>We could make <code>rust.use-lld</code> use rust-lld with <code>-Zgcc-ld=lld</code>? Currently we use <code>-Clink-args=-fuse-ld=lld</code> which uses whatever lld is in PATH, in contrast to what is documented in config.toml.example. For stage 2 this would only work if <code>rust.lld</code>is set to true though.</p>



<a name="260649764"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/thread%20%27main%27%20panicked%20at%20%27fs%3A%3Aread%28stamp%29...%27/near/260649764" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> simulacrum <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/thread.20&#x27;main&#x27;.20panicked.20at.20&#x27;fs.3A.3Aread(stamp).2E.2E.2E&#x27;.html#260649764">(Nov 08 2021 at 12:26)</a>:</h4>
<p>Lld is pretty fast to build, so I think defaulting to building it with use-lld should be fine. We can also consider detecting the version and failing early.</p>



<a name="262392044"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/thread%20%27main%27%20panicked%20at%20%27fs%3A%3Aread%28stamp%29...%27/near/262392044" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nnethercote <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/thread.20&#x27;main&#x27;.20panicked.20at.20&#x27;fs.3A.3Aread(stamp).2E.2E.2E&#x27;.html#262392044">(Nov 22 2021 at 23:27)</a>:</h4>
<p>I just tried this change:</p>
<div class="codehilite"><pre><span></span><code>diff --git a/src/bootstrap/lib.rs b/src/bootstrap/lib.rs
index 3b3c8a9227d..408dbce6589 100644
--- a/src/bootstrap/lib.rs
+++ b/src/bootstrap/lib.rs
@@ -1036,7 +1036,8 @@ fn lld_flags(&amp;self, target: TargetSelection) -&gt; impl Iterator&lt;Item = String&gt; {

         if self.config.use_lld {
             if self.is_fuse_ld_lld(target) {
-                options[0] = Some(&quot;-Clink-arg=-fuse-ld=lld&quot;.to_string());
+                //options[0] = Some(&quot;-Clink-arg=-fuse-ld=lld&quot;.to_string());
+                options[0] = Some(&quot;-Zgcc-ld=lld&quot;.to_string());
             }

             let threads = if target.contains(&quot;windows&quot;) { &quot;/threads:1&quot; } else { &quot;--threads=1&quot; };
</code></pre></div>
<p>And enabled <code>use-lld = true</code>and everything worked fine, even <code>./x.py build --stage 2</code>. And I confirmed by looking at <code>top</code> that it was using <code>ld.lld</code> instead of <code>ld</code> when doing linking.</p>



<a name="262392066"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/thread%20%27main%27%20panicked%20at%20%27fs%3A%3Aread%28stamp%29...%27/near/262392066" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nnethercote <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/thread.20&#x27;main&#x27;.20panicked.20at.20&#x27;fs.3A.3Aread(stamp).2E.2E.2E&#x27;.html#262392066">(Nov 22 2021 at 23:27)</a>:</h4>
<p>So it seems like the fix for this is even simpler than people thought? I can file a PR, is there anything else I should check/try?</p>



<a name="262392262"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/thread%20%27main%27%20panicked%20at%20%27fs%3A%3Aread%28stamp%29...%27/near/262392262" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nnethercote <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/thread.20&#x27;main&#x27;.20panicked.20at.20&#x27;fs.3A.3Aread(stamp).2E.2E.2E&#x27;.html#262392262">(Nov 22 2021 at 23:30)</a>:</h4>
<p>Oh, I just ran tests <span aria-label="smile" class="emoji emoji-1f642" role="img" title="smile">:smile:</span></p>



<a name="262392271"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/thread%20%27main%27%20panicked%20at%20%27fs%3A%3Aread%28stamp%29...%27/near/262392271" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nnethercote <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/thread.20&#x27;main&#x27;.20panicked.20at.20&#x27;fs.3A.3Aread(stamp).2E.2E.2E&#x27;.html#262392271">(Nov 22 2021 at 23:30)</a>:</h4>
<p>Tons of <code>error: rust-lld (as ld) not found</code> failures</p>



<a name="262393822"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/thread%20%27main%27%20panicked%20at%20%27fs%3A%3Aread%28stamp%29...%27/near/262393822" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nnethercote <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/thread.20&#x27;main&#x27;.20panicked.20at.20&#x27;fs.3A.3Aread(stamp).2E.2E.2E&#x27;.html#262393822">(Nov 22 2021 at 23:47)</a>:</h4>
<p>I added this:</p>
<div class="codehilite"><pre><span></span><code>diff --git a/src/bootstrap/config.rs b/src/bootstrap/config.rs
index 68e20f90b7f..bd3666b1d96 100644
--- a/src/bootstrap/config.rs
+++ b/src/bootstrap/config.rs
@@ -895,6 +895,10 @@ pub fn parse(args: &amp;[String]) -&gt; Config {
             }
             set(&amp;mut config.use_lld, rust.use_lld);
             set(&amp;mut config.lld_enabled, rust.lld);
+            if let Some(true) = rust.use_lld {
+                // Need a local `lld` built in order to use it.
+                config.lld_enabled = true;
+            }
             set(&amp;mut config.llvm_tools_enabled, rust.llvm_tools);
             config.rustc_parallel = rust.parallel_compiler.unwrap_or(false);
             config.rustc_default_linker = rust.default_linker;
</code></pre></div>
<p>And things are looking better. Just a single <code>ui</code> failure now, for <code>ui/linkage-attr/issue-10755.rs</code>.</p>



<a name="262393945"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/thread%20%27main%27%20panicked%20at%20%27fs%3A%3Aread%28stamp%29...%27/near/262393945" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nnethercote <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/thread.20&#x27;main&#x27;.20panicked.20at.20&#x27;fs.3A.3Aread(stamp).2E.2E.2E&#x27;.html#262393945">(Nov 22 2021 at 23:49)</a>:</h4>
<p>It uses <code>compile-flags: -C linker=llllll -C linker-flavor=ld</code>.</p>
<p>It is supposed to fail with <code>linker 'llllll' not found</code>.</p>
<p>But instead it fails with <code>option '-Z gcc-ld' is used even though linker flavor is not gcc</code>, hmm.</p>



<a name="262394101"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/thread%20%27main%27%20panicked%20at%20%27fs%3A%3Aread%28stamp%29...%27/near/262394101" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nnethercote <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/thread.20&#x27;main&#x27;.20panicked.20at.20&#x27;fs.3A.3Aread(stamp).2E.2E.2E&#x27;.html#262394101">(Nov 22 2021 at 23:50)</a>:</h4>
<p>Is there a way to unset <code>-Zgcc-ld</code>?</p>



<a name="262397561"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/thread%20%27main%27%20panicked%20at%20%27fs%3A%3Aread%28stamp%29...%27/near/262397561" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> The 8472 <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/thread.20&#x27;main&#x27;.20panicked.20at.20&#x27;fs.3A.3Aread(stamp).2E.2E.2E&#x27;.html#262397561">(Nov 23 2021 at 00:30)</a>:</h4>
<p>I think that would make stage 0 doc tests slower?</p>



<a name="262397627"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/thread%20%27main%27%20panicked%20at%20%27fs%3A%3Aread%28stamp%29...%27/near/262397627" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> The 8472 <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/thread.20&#x27;main&#x27;.20panicked.20at.20&#x27;fs.3A.3Aread(stamp).2E.2E.2E&#x27;.html#262397627">(Nov 23 2021 at 00:31)</a>:</h4>
<p>I added those flags to make lib doctests (stage 0) and UI tests (stage1) run faster.</p>



<a name="262397843"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/thread%20%27main%27%20panicked%20at%20%27fs%3A%3Aread%28stamp%29...%27/near/262397843" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nnethercote <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/thread.20&#x27;main&#x27;.20panicked.20at.20&#x27;fs.3A.3Aread(stamp).2E.2E.2E&#x27;.html#262397843">(Nov 23 2021 at 00:34)</a>:</h4>
<p>Just using <code>-Zgcc-ld</code> works. <span class="user-mention" data-user-id="330154">@The 8472</span> I'm just asking about disabling it for a single test</p>



<a name="262397995"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/thread%20%27main%27%20panicked%20at%20%27fs%3A%3Aread%28stamp%29...%27/near/262397995" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> The 8472 <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/thread.20&#x27;main&#x27;.20panicked.20at.20&#x27;fs.3A.3Aread(stamp).2E.2E.2E&#x27;.html#262397995">(Nov 23 2021 at 00:37)</a>:</h4>
<p>ah, maybe compiletest needs to detect when the test requests a different linker and not pass in the flags from bootstrap</p>



<a name="262398201"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/thread%20%27main%27%20panicked%20at%20%27fs%3A%3Aread%28stamp%29...%27/near/262398201" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> The 8472 <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/thread.20&#x27;main&#x27;.20panicked.20at.20&#x27;fs.3A.3Aread(stamp).2E.2E.2E&#x27;.html#262398201">(Nov 23 2021 at 00:39)</a>:</h4>
<p>But I think instead of adding more opt-in/opt-out back and forth it might be easier to check if lld supports the thread argument once in some place and adjust the arguments accordingly.</p>



<a name="262398336"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/thread%20%27main%27%20panicked%20at%20%27fs%3A%3Aread%28stamp%29...%27/near/262398336" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nnethercote <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/thread.20&#x27;main&#x27;.20panicked.20at.20&#x27;fs.3A.3Aread(stamp).2E.2E.2E&#x27;.html#262398336">(Nov 23 2021 at 00:41)</a>:</h4>
<p><span class="user-mention" data-user-id="330154">@The 8472</span> That would be the "use system lld" approach, rather than the "use our own lld" approach that I'm trying out</p>



<a name="262398371"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/thread%20%27main%27%20panicked%20at%20%27fs%3A%3Aread%28stamp%29...%27/near/262398371" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> The 8472 <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/thread.20&#x27;main&#x27;.20panicked.20at.20&#x27;fs.3A.3Aread(stamp).2E.2E.2E&#x27;.html#262398371">(Nov 23 2021 at 00:42)</a>:</h4>
<p>"our own lld" is only built when you do stage 1 builds (I think), so it wouldn't help library developers</p>



<a name="262398627"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/thread%20%27main%27%20panicked%20at%20%27fs%3A%3Aread%28stamp%29...%27/near/262398627" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nnethercote <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/thread.20&#x27;main&#x27;.20panicked.20at.20&#x27;fs.3A.3Aread(stamp).2E.2E.2E&#x27;.html#262398627">(Nov 23 2021 at 00:45)</a>:</h4>
<p>How/where would I check for <code>--thread</code> support?</p>



<a name="262398773"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/thread%20%27main%27%20panicked%20at%20%27fs%3A%3Aread%28stamp%29...%27/near/262398773" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> The 8472 <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/thread.20&#x27;main&#x27;.20panicked.20at.20&#x27;fs.3A.3Aread(stamp).2E.2E.2E&#x27;.html#262398773">(Nov 23 2021 at 00:47)</a>:</h4>
<p>try <code>ld.lld -V --threads=1; echo $?</code>, i'd expect it to return exit code 1 if it's not supported 0 otherwise</p>



<a name="262398782"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/thread%20%27main%27%20panicked%20at%20%27fs%3A%3Aread%28stamp%29...%27/near/262398782" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nnethercote <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/thread.20&#x27;main&#x27;.20panicked.20at.20&#x27;fs.3A.3Aread(stamp).2E.2E.2E&#x27;.html#262398782">(Nov 23 2021 at 00:47)</a>:</h4>
<p>(My current branch just passed <code>x.py test</code>, FWIW)</p>



<a name="262398840"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/thread%20%27main%27%20panicked%20at%20%27fs%3A%3Aread%28stamp%29...%27/near/262398840" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> The 8472 <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/thread.20&#x27;main&#x27;.20panicked.20at.20&#x27;fs.3A.3Aread(stamp).2E.2E.2E&#x27;.html#262398840">(Nov 23 2021 at 00:48)</a>:</h4>
<p>try <code>./x.py test library/std --stage 0</code></p>



<a name="262398976"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/thread%20%27main%27%20panicked%20at%20%27fs%3A%3Aread%28stamp%29...%27/near/262398976" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nnethercote <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/thread.20&#x27;main&#x27;.20panicked.20at.20&#x27;fs.3A.3Aread(stamp).2E.2E.2E&#x27;.html#262398976">(Nov 23 2021 at 00:50)</a>:</h4>
<p>Lots of failures: <code>error: rust-lld (as ld) not found</code></p>



<a name="262398991"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/thread%20%27main%27%20panicked%20at%20%27fs%3A%3Aread%28stamp%29...%27/near/262398991" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nnethercote <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/thread.20&#x27;main&#x27;.20panicked.20at.20&#x27;fs.3A.3Aread(stamp).2E.2E.2E&#x27;.html#262398991">(Nov 23 2021 at 00:50)</a>:</h4>
<p>I wish I understood rustc's build system</p>



<a name="262399009"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/thread%20%27main%27%20panicked%20at%20%27fs%3A%3Aread%28stamp%29...%27/near/262399009" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nnethercote <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/thread.20&#x27;main&#x27;.20panicked.20at.20&#x27;fs.3A.3Aread(stamp).2E.2E.2E&#x27;.html#262399009">(Nov 23 2021 at 00:51)</a>:</h4>
<p>The <code>ld.lld -V</code> thing works, where would I run that test?</p>



<a name="262399042"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/thread%20%27main%27%20panicked%20at%20%27fs%3A%3Aread%28stamp%29...%27/near/262399042" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nnethercote <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/thread.20&#x27;main&#x27;.20panicked.20at.20&#x27;fs.3A.3Aread(stamp).2E.2E.2E&#x27;.html#262399042">(Nov 23 2021 at 00:51)</a>:</h4>
<p>Presumably somewhere within <code>bootstrap/</code>?</p>



<a name="262399124"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/thread%20%27main%27%20panicked%20at%20%27fs%3A%3Aread%28stamp%29...%27/near/262399124" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nnethercote <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/thread.20&#x27;main&#x27;.20panicked.20at.20&#x27;fs.3A.3Aread(stamp).2E.2E.2E&#x27;.html#262399124">(Nov 23 2021 at 00:52)</a>:</h4>
<p><code>test.rs</code> seems to have stuff like that</p>



<a name="262399287"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/thread%20%27main%27%20panicked%20at%20%27fs%3A%3Aread%28stamp%29...%27/near/262399287" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> The 8472 <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/thread.20&#x27;main&#x27;.20panicked.20at.20&#x27;fs.3A.3Aread(stamp).2E.2E.2E&#x27;.html#262399287">(Nov 23 2021 at 00:52)</a>:</h4>
<p>yeah, just some helper function that populates a <code>Lazy</code> or <code>Once</code> so it's not probed all the time and then use that in the helper function that sets the thread parameters.</p>



<a name="262399396"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/thread%20%27main%27%20panicked%20at%20%27fs%3A%3Aread%28stamp%29...%27/near/262399396" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nnethercote <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/thread.20&#x27;main&#x27;.20panicked.20at.20&#x27;fs.3A.3Aread(stamp).2E.2E.2E&#x27;.html#262399396">(Nov 23 2021 at 00:54)</a>:</h4>
<p>Or I could just find a way to update lld on my system and forget about this, because it'll become a less relevant problem as these old versions of lld become less common over time...</p>



<a name="262399438"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/thread%20%27main%27%20panicked%20at%20%27fs%3A%3Aread%28stamp%29...%27/near/262399438" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> The 8472 <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/thread.20&#x27;main&#x27;.20panicked.20at.20&#x27;fs.3A.3Aread(stamp).2E.2E.2E&#x27;.html#262399438">(Nov 23 2021 at 00:55)</a>:</h4>
<p>heh, sure. no llvm backports?</p>



<a name="262399457"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/thread%20%27main%27%20panicked%20at%20%27fs%3A%3Aread%28stamp%29...%27/near/262399457" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nnethercote <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/thread.20&#x27;main&#x27;.20panicked.20at.20&#x27;fs.3A.3Aread(stamp).2E.2E.2E&#x27;.html#262399457">(Nov 23 2021 at 00:55)</a>:</h4>
<p>Sorry, I don't understand the question</p>



<a name="262399568"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/thread%20%27main%27%20panicked%20at%20%27fs%3A%3Aread%28stamp%29...%27/near/262399568" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> The 8472 <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/thread.20&#x27;main&#x27;.20panicked.20at.20&#x27;fs.3A.3Aread(stamp).2E.2E.2E&#x27;.html#262399568">(Nov 23 2021 at 00:56)</a>:</h4>
<p>well, debian has backports repositories where one can selectively pull in packages that have been backported from the next version to the current one. I think you were on ubuntu? I think they have something like that too.</p>



<a name="262399712"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/thread%20%27main%27%20panicked%20at%20%27fs%3A%3Aread%28stamp%29...%27/near/262399712" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> The 8472 <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/thread.20&#x27;main&#x27;.20panicked.20at.20&#x27;fs.3A.3Aread(stamp).2E.2E.2E&#x27;.html#262399712">(Nov 23 2021 at 00:57)</a>:</h4>
<p><a href="https://help.ubuntu.com/community/UbuntuBackports">https://help.ubuntu.com/community/UbuntuBackports</a> maybe there's a newer llvm/lld in there.</p>



<a name="262400456"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/thread%20%27main%27%20panicked%20at%20%27fs%3A%3Aread%28stamp%29...%27/near/262400456" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nnethercote <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/thread.20&#x27;main&#x27;.20panicked.20at.20&#x27;fs.3A.3Aread(stamp).2E.2E.2E&#x27;.html#262400456">(Nov 23 2021 at 01:06)</a>:</h4>
<p>I see, thanks!  I'm considering just upgrading from 20.04 LTS to 21.10 anyway</p>



<a name="262400605"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/thread%20%27main%27%20panicked%20at%20%27fs%3A%3Aread%28stamp%29...%27/near/262400605" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nnethercote <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/thread.20&#x27;main&#x27;.20panicked.20at.20&#x27;fs.3A.3Aread(stamp).2E.2E.2E&#x27;.html#262400605">(Nov 23 2021 at 01:08)</a>:</h4>
<p>Though now I see that probably requires a fresh install</p>



<a name="262400790"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/thread%20%27main%27%20panicked%20at%20%27fs%3A%3Aread%28stamp%29...%27/near/262400790" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> The 8472 <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/thread.20&#x27;main&#x27;.20panicked.20at.20&#x27;fs.3A.3Aread(stamp).2E.2E.2E&#x27;.html#262400790">(Nov 23 2021 at 01:11)</a>:</h4>
<p>ubuntu ships with update tools that should let you go from LTS to the next normal release. idk if you can skip straight to 21.10 though.</p>



<a name="262411837"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/thread%20%27main%27%20panicked%20at%20%27fs%3A%3Aread%28stamp%29...%27/near/262411837" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nnethercote <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/thread.20&#x27;main&#x27;.20panicked.20at.20&#x27;fs.3A.3Aread(stamp).2E.2E.2E&#x27;.html#262411837">(Nov 23 2021 at 04:32)</a>:</h4>
<p>In the end I was able to upgrade 20.04 to 21.04, and then to 21.10</p>



<hr><p>Last updated: Apr 12 2022 at 20:01 UTC</p>
</html>