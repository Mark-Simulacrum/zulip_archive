<html>
<head><meta charset="utf-8"><title>severe performance regression after #65186 · t-compiler · Zulip Chat Archive</title></head>
<h2>Stream: <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/index.html">t-compiler</a></h2>
<h3>Topic: <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/severe.20performance.20regression.20after.20.2365186.html">severe performance regression after #65186</a></h3>

<hr>

<base href="https://rust-lang.zulipchat.com">

<head><link href="https://zulip-archive.rust-lang.org/style.css" rel="stylesheet"></head>

<a name="177705289"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/severe%20performance%20regression%20after%20%2365186/near/177705289" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> mw <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/severe.20performance.20regression.20after.20.2365186.html#177705289">(Oct 09 2019 at 11:48)</a>:</h4>
<p><a href="https://perf.rust-lang.org/compare.html?start=59a31c8c676bdc9f50490d5798b1b4e884b7d7ae&amp;end=d304f5c1ff0b86b07f643e733f9fe2d9cd13753e&amp;stat=instructions:u" target="_blank" title="https://perf.rust-lang.org/compare.html?start=59a31c8c676bdc9f50490d5798b1b4e884b7d7ae&amp;end=d304f5c1ff0b86b07f643e733f9fe2d9cd13753e&amp;stat=instructions:u">https://perf.rust-lang.org/compare.html?start=59a31c8c676bdc9f50490d5798b1b4e884b7d7ae&amp;end=d304f5c1ff0b86b07f643e733f9fe2d9cd13753e&amp;stat=instructions:u</a></p>



<a name="177705316"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/severe%20performance%20regression%20after%20%2365186/near/177705316" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> pnkfelix <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/severe.20performance.20regression.20after.20.2365186.html#177705316">(Oct 09 2019 at 11:49)</a>:</h4>
<p>eek</p>



<a name="177705322"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/severe%20performance%20regression%20after%20%2365186/near/177705322" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> mw <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/severe.20performance.20regression.20after.20.2365186.html#177705322">(Oct 09 2019 at 11:49)</a>:</h4>
<p><code>deeply-nested-opt</code> is 538126.0% slower :P</p>



<a name="177705331"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/severe%20performance%20regression%20after%20%2365186/near/177705331" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> pnkfelix <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/severe.20performance.20regression.20after.20.2365186.html#177705331">(Oct 09 2019 at 11:49)</a>:</h4>
<p>well, <em>at worst</em></p>



<a name="177705339"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/severe%20performance%20regression%20after%20%2365186/near/177705339" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> mw <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/severe.20performance.20regression.20after.20.2365186.html#177705339">(Oct 09 2019 at 11:49)</a>:</h4>
<p>it might be a fluke, maybe we should wait for the next perf run</p>



<a name="177705342"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/severe%20performance%20regression%20after%20%2365186/near/177705342" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> pnkfelix <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/severe.20performance.20regression.20after.20.2365186.html#177705342">(Oct 09 2019 at 11:49)</a>:</h4>
<p>On average its "only" 348058% slower</p>



<a name="177705399"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/severe%20performance%20regression%20after%20%2365186/near/177705399" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> pnkfelix <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/severe.20performance.20regression.20after.20.2365186.html#177705399">(Oct 09 2019 at 11:50)</a>:</h4>
<p>how many runs are those averages based on?</p>



<a name="177705427"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/severe%20performance%20regression%20after%20%2365186/near/177705427" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> mw <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/severe.20performance.20regression.20after.20.2365186.html#177705427">(Oct 09 2019 at 11:50)</a>:</h4>
<p><span class="user-mention" data-user-id="116122">@simulacrum</span> would know best. I think it's taking the fastest out of 5 for the smaller benchmarks</p>



<a name="177705452"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/severe%20performance%20regression%20after%20%2365186/near/177705452" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> simulacrum <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/severe.20performance.20regression.20after.20.2365186.html#177705452">(Oct 09 2019 at 11:51)</a>:</h4>
<p>Heh at best 2 I think</p>



<a name="177705489"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/severe%20performance%20regression%20after%20%2365186/near/177705489" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> mw <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/severe.20performance.20regression.20after.20.2365186.html#177705489">(Oct 09 2019 at 11:51)</a>:</h4>
<p>what? we have a sample of 2?</p>



<a name="177705539"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/severe%20performance%20regression%20after%20%2365186/near/177705539" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> mw <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/severe.20performance.20regression.20after.20.2365186.html#177705539">(Oct 09 2019 at 11:52)</a>:</h4>
<p>that does not sound good :)</p>



<a name="177705587"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/severe%20performance%20regression%20after%20%2365186/near/177705587" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> simulacrum <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/severe.20performance.20regression.20after.20.2365186.html#177705587">(Oct 09 2019 at 11:53)</a>:</h4>
<p>well, we take the minimum</p>



<a name="177705596"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/severe%20performance%20regression%20after%20%2365186/near/177705596" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> simulacrum <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/severe.20performance.20regression.20after.20.2365186.html#177705596">(Oct 09 2019 at 11:53)</a>:</h4>
<p>this is in fact fairly reliable</p>



<a name="177705605"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/severe%20performance%20regression%20after%20%2365186/near/177705605" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> simulacrum <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/severe.20performance.20regression.20after.20.2365186.html#177705605">(Oct 09 2019 at 11:53)</a>:</h4>
<p>for most "core" regressions you are actually running something like 2 * 4 (each run type) so you can usually see spurious stuff fairly well</p>



<a name="177705652"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/severe%20performance%20regression%20after%20%2365186/near/177705652" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> simulacrum <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/severe.20performance.20regression.20after.20.2365186.html#177705652">(Oct 09 2019 at 11:54)</a>:</h4>
<p>in any case this specific regression has been there for a while I believe</p>



<a name="177705658"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/severe%20performance%20regression%20after%20%2365186/near/177705658" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> simulacrum <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/severe.20performance.20regression.20after.20.2365186.html#177705658">(Oct 09 2019 at 11:54)</a>:</h4>
<p>i.e., we have multiple commits backing it up</p>



<a name="177705663"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/severe%20performance%20regression%20after%20%2365186/near/177705663" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> simulacrum <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/severe.20performance.20regression.20after.20.2365186.html#177705663">(Oct 09 2019 at 11:54)</a>:</h4>
<p>I've not tried reproducing locally yet though</p>



<a name="177705843"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/severe%20performance%20regression%20after%20%2365186/near/177705843" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> mw <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/severe.20performance.20regression.20after.20.2365186.html#177705843">(Oct 09 2019 at 11:57)</a>:</h4>
<p><span class="user-mention" data-user-id="116122">@simulacrum</span> will perf.rlo test the commits before?</p>



<a name="177705860"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/severe%20performance%20regression%20after%20%2365186/near/177705860" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> simulacrum <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/severe.20performance.20regression.20after.20.2365186.html#177705860">(Oct 09 2019 at 11:57)</a>:</h4>
<p>hm?</p>



<a name="177705865"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/severe%20performance%20regression%20after%20%2365186/near/177705865" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> simulacrum <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/severe.20performance.20regression.20after.20.2365186.html#177705865">(Oct 09 2019 at 11:57)</a>:</h4>
<p>before what?</p>



<a name="177705912"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/severe%20performance%20regression%20after%20%2365186/near/177705912" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> simulacrum <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/severe.20performance.20regression.20after.20.2365186.html#177705912">(Oct 09 2019 at 11:58)</a>:</h4>
<p>you can see the queue here: <a href="https://perf.rust-lang.org/status.html" target="_blank" title="https://perf.rust-lang.org/status.html">https://perf.rust-lang.org/status.html</a></p>



<a name="177705921"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/severe%20performance%20regression%20after%20%2365186/near/177705921" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> simulacrum <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/severe.20performance.20regression.20after.20.2365186.html#177705921">(Oct 09 2019 at 11:58)</a>:</h4>
<p>the length is part of why I suspect this is genuine</p>



<a name="177705975"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/severe%20performance%20regression%20after%20%2365186/near/177705975" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> mw <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/severe.20performance.20regression.20after.20.2365186.html#177705975">(Oct 09 2019 at 11:59)</a>:</h4>
<p>I meant: will perf.rlo test the (as of yet untested) commit range, so we can better pinpoint the regression?</p>



<a name="177705982"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/severe%20performance%20regression%20after%20%2365186/near/177705982" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> mw <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/severe.20performance.20regression.20after.20.2365186.html#177705982">(Oct 09 2019 at 11:59)</a>:</h4>
<p>the list on the status page probably has the answer :)</p>



<a name="177706092"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/severe%20performance%20regression%20after%20%2365186/near/177706092" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> simulacrum <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/severe.20performance.20regression.20after.20.2365186.html#177706092">(Oct 09 2019 at 12:00)</a>:</h4>
<p>Yes, if there's bors commits in between we'll test them eventually</p>



<a name="177706239"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/severe%20performance%20regression%20after%20%2365186/near/177706239" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> HeroicKatora <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/severe.20performance.20regression.20after.20.2365186.html#177706239">(Oct 09 2019 at 12:02)</a>:</h4>
<p>According to the graphs/numbers only baseline incremental and clean is affected that hard.</p>



<a name="177706308"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/severe%20performance%20regression%20after%20%2365186/near/177706308" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> HeroicKatora <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/severe.20performance.20regression.20after.20.2365186.html#177706308">(Oct 09 2019 at 12:03)</a>:</h4>
<p>What's the difference about those and a clean incremental run?</p>



<a name="177709135"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/severe%20performance%20regression%20after%20%2365186/near/177709135" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> simulacrum <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/severe.20performance.20regression.20after.20.2365186.html#177709135">(Oct 09 2019 at 12:40)</a>:</h4>
<p>whatever it is is cached by an incremental run</p>



<a name="177709152"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/severe%20performance%20regression%20after%20%2365186/near/177709152" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> simulacrum <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/severe.20performance.20regression.20after.20.2365186.html#177709152">(Oct 09 2019 at 12:40)</a>:</h4>
<p>there's descriptions of the variants at the bottom of the compare page</p>



<a name="177786361"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/severe%20performance%20regression%20after%20%2365186/near/177786361" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> mw <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/severe.20performance.20regression.20after.20.2365186.html#177786361">(Oct 10 2019 at 07:38)</a>:</h4>
<p><a href="https://github.com/rust-lang/rust/pull/65249" target="_blank" title="https://github.com/rust-lang/rust/pull/65249">https://github.com/rust-lang/rust/pull/65249</a> should undo the regression. Thanks <span class="user-mention" data-user-id="116118">@Matthew Jasper</span> and <span class="user-mention" data-user-id="120989">@nnethercote</span> for looking into it!</p>



<hr><p>Last updated: Apr 12 2022 at 20:01 UTC</p>
</html>